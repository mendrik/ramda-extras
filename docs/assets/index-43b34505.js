var li=Object.defineProperty;var ci=(K,C,W)=>C in K?li(K,C,{enumerable:!0,configurable:!0,writable:!0,value:W}):K[C]=W;var et=(K,C,W)=>(ci(K,typeof C!="symbol"?C+"":C,W),W);(function(){const C=document.createElement("link").relList;if(C&&C.supports&&C.supports("modulepreload"))return;for(const U of document.querySelectorAll('link[rel="modulepreload"]'))V(U);new MutationObserver(U=>{for(const G of U)if(G.type==="childList")for(const Z of G.addedNodes)Z.tagName==="LINK"&&Z.rel==="modulepreload"&&V(Z)}).observe(document,{childList:!0,subtree:!0});function W(U){const G={};return U.integrity&&(G.integrity=U.integrity),U.referrerPolicy&&(G.referrerPolicy=U.referrerPolicy),U.crossOrigin==="use-credentials"?G.credentials="include":U.crossOrigin==="anonymous"?G.credentials="omit":G.credentials="same-origin",G}function V(U){if(U.ep)return;U.ep=!0;const G=W(U);fetch(U.href,G)}})();var n,l$3,u$2,t$2,i$2,o$5,r$2,f$2,c$2={},s$1=[],a$2=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i,v$2=Array.isArray;function h$1(K,C){for(var W in C)K[W]=C[W];return K}function p$3(K){var C=K.parentNode;C&&C.removeChild(K)}function y$1(K,C,W){var V,U,G,Z={};for(G in C)G=="key"?V=C[G]:G=="ref"?U=C[G]:Z[G]=C[G];if(arguments.length>2&&(Z.children=arguments.length>3?n.call(arguments,2):W),typeof K=="function"&&K.defaultProps!=null)for(G in K.defaultProps)Z[G]===void 0&&(Z[G]=K.defaultProps[G]);return d$3(K,Z,V,U,null)}function d$3(K,C,W,V,U){var G={type:K,props:C,key:W,ref:V,__k:null,__:null,__b:0,__e:null,__d:void 0,__c:null,__h:null,constructor:void 0,__v:U??++u$2};return U==null&&l$3.vnode!=null&&l$3.vnode(G),G}function k$1(K){return K.children}function b$2(K,C){this.props=K,this.context=C}function g$2(K,C){if(C==null)return K.__?g$2(K.__,K.__.__k.indexOf(K)+1):null;for(var W;C<K.__k.length;C++)if((W=K.__k[C])!=null&&W.__e!=null)return W.__d||W.__e;return typeof K.type=="function"?g$2(K):null}function m$1(K){var C,W;if((K=K.__)!=null&&K.__c!=null){for(K.__e=K.__c.base=null,C=0;C<K.__k.length;C++)if((W=K.__k[C])!=null&&W.__e!=null){K.__e=K.__c.base=W.__e;break}return m$1(K)}}function w$2(K){(!K.__d&&(K.__d=!0)&&i$2.push(K)&&!x$1.__r++||o$5!==l$3.debounceRendering)&&((o$5=l$3.debounceRendering)||r$2)(x$1)}function x$1(){var K,C,W,V,U,G,Z,X,Q;for(i$2.sort(f$2);K=i$2.shift();)K.__d&&(C=i$2.length,V=void 0,U=void 0,G=void 0,X=(Z=(W=K).__v).__e,(Q=W.__P)&&(V=[],U=[],(G=h$1({},Z)).__v=Z.__v+1,z$1(Q,Z,G,W.__n,Q.ownerSVGElement!==void 0,Z.__h!=null?[X]:null,V,X??g$2(Z),Z.__h,U),L(V,Z,U),Z.__e!=X&&m$1(Z)),i$2.length>C&&i$2.sort(f$2));x$1.__r=0}function P$1(K,C,W,V,U,G,Z,X,Q,J,ee){var te,ie,ne,oe,re,ae,se,le,ce,de=0,ue=V&&V.__k||s$1,ge=ue.length,he=ge,fe=C.length;for(W.__k=[],te=0;te<fe;te++)(oe=W.__k[te]=(oe=C[te])==null||typeof oe=="boolean"||typeof oe=="function"?null:typeof oe=="string"||typeof oe=="number"||typeof oe=="bigint"?d$3(null,oe,null,null,oe):v$2(oe)?d$3(k$1,{children:oe},null,null,null):oe.__b>0?d$3(oe.type,oe.props,oe.key,oe.ref?oe.ref:null,oe.__v):oe)!=null?(oe.__=W,oe.__b=W.__b+1,(le=A(oe,ue,se=te+de,he))===-1?ne=c$2:(ne=ue[le]||c$2,ue[le]=void 0,he--),z$1(K,oe,ne,U,G,Z,X,Q,J,ee),re=oe.__e,(ie=oe.ref)&&ne.ref!=ie&&(ne.ref&&N(ne.ref,null,oe),ee.push(ie,oe.__c||re,oe)),re!=null&&(ae==null&&(ae=re),(ce=ne===c$2||ne.__v===null)?le==-1&&de--:le!==se&&(le===se+1?de++:le>se?he>fe-se?de+=le-se:de--:de=le<se&&le==se-1?le-se:0),se=te+de,typeof oe.type!="function"||le===se&&ne.__k!==oe.__k?typeof oe.type=="function"||le===se&&!ce?oe.__d!==void 0?(Q=oe.__d,oe.__d=void 0):Q=re.nextSibling:Q=S(K,re,Q):Q=$$e(oe,Q,K),typeof W.type=="function"&&(W.__d=Q))):(ne=ue[te])&&ne.key==null&&ne.__e&&(ne.__e==Q&&(ne.__=V,Q=g$2(ne)),O$1(ne,ne,!1),ue[te]=null);for(W.__e=ae,te=ge;te--;)ue[te]!=null&&(typeof W.type=="function"&&ue[te].__e!=null&&ue[te].__e==W.__d&&(W.__d=ue[te].__e.nextSibling),O$1(ue[te],ue[te]))}function $$e(K,C,W){for(var V,U=K.__k,G=0;U&&G<U.length;G++)(V=U[G])&&(V.__=K,C=typeof V.type=="function"?$$e(V,C,W):S(W,V.__e,C));return C}function S(K,C,W){return W==null||W.parentNode!==K?K.insertBefore(C,null):C==W&&C.parentNode!=null||K.insertBefore(C,W),C.nextSibling}function A(K,C,W,V){var U=K.key,G=K.type,Z=W-1,X=W+1,Q=C[W];if(Q===null||Q&&U==Q.key&&G===Q.type)return W;if(V>(Q!=null?1:0))for(;Z>=0||X<C.length;){if(Z>=0){if((Q=C[Z])&&U==Q.key&&G===Q.type)return Z;Z--}if(X<C.length){if((Q=C[X])&&U==Q.key&&G===Q.type)return X;X++}}return-1}function D(K,C,W,V,U){var G;for(G in W)G==="children"||G==="key"||G in C||I(K,G,null,W[G],V);for(G in C)U&&typeof C[G]!="function"||G==="children"||G==="key"||G==="value"||G==="checked"||W[G]===C[G]||I(K,G,C[G],W[G],V)}function H(K,C,W){C[0]==="-"?K.setProperty(C,W??""):K[C]=W==null?"":typeof W!="number"||a$2.test(C)?W:W+"px"}function I(K,C,W,V,U){var G;e:if(C==="style")if(typeof W=="string")K.style.cssText=W;else{if(typeof V=="string"&&(K.style.cssText=V=""),V)for(C in V)W&&C in W||H(K.style,C,"");if(W)for(C in W)V&&W[C]===V[C]||H(K.style,C,W[C])}else if(C[0]==="o"&&C[1]==="n")G=C!==(C=C.replace(/(PointerCapture)$|Capture$/,"$1")),C=C.toLowerCase()in K?C.toLowerCase().slice(2):C.slice(2),K.l||(K.l={}),K.l[C+G]=W,W?V?W.u=V.u:(W.u=Date.now(),K.addEventListener(C,G?j$1:T$2,G)):K.removeEventListener(C,G?j$1:T$2,G);else if(C!=="dangerouslySetInnerHTML"){if(U)C=C.replace(/xlink(H|:h)/,"h").replace(/sName$/,"s");else if(C!=="width"&&C!=="height"&&C!=="href"&&C!=="list"&&C!=="form"&&C!=="tabIndex"&&C!=="download"&&C!=="rowSpan"&&C!=="colSpan"&&C!=="role"&&C in K)try{K[C]=W??"";break e}catch{}typeof W=="function"||(W==null||W===!1&&C[4]!=="-"?K.removeAttribute(C):K.setAttribute(C,W))}}function T$2(K){var C=this.l[K.type+!1];if(K.t){if(K.t<=C.u)return}else K.t=Date.now();return C(l$3.event?l$3.event(K):K)}function j$1(K){return this.l[K.type+!0](l$3.event?l$3.event(K):K)}function z$1(K,C,W,V,U,G,Z,X,Q,J){var ee,te,ie,ne,oe,re,ae,se,le,ce,de,ue,ge,he,fe,pe=C.type;if(C.constructor!==void 0)return null;W.__h!=null&&(Q=W.__h,X=C.__e=W.__e,C.__h=null,G=[X]),(ee=l$3.__b)&&ee(C);e:if(typeof pe=="function")try{if(se=C.props,le=(ee=pe.contextType)&&V[ee.__c],ce=ee?le?le.props.value:ee.__:V,W.__c?ae=(te=C.__c=W.__c).__=te.__E:("prototype"in pe&&pe.prototype.render?C.__c=te=new pe(se,ce):(C.__c=te=new b$2(se,ce),te.constructor=pe,te.render=q),le&&le.sub(te),te.props=se,te.state||(te.state={}),te.context=ce,te.__n=V,ie=te.__d=!0,te.__h=[],te._sb=[]),te.__s==null&&(te.__s=te.state),pe.getDerivedStateFromProps!=null&&(te.__s==te.state&&(te.__s=h$1({},te.__s)),h$1(te.__s,pe.getDerivedStateFromProps(se,te.__s))),ne=te.props,oe=te.state,te.__v=C,ie)pe.getDerivedStateFromProps==null&&te.componentWillMount!=null&&te.componentWillMount(),te.componentDidMount!=null&&te.__h.push(te.componentDidMount);else{if(pe.getDerivedStateFromProps==null&&se!==ne&&te.componentWillReceiveProps!=null&&te.componentWillReceiveProps(se,ce),!te.__e&&(te.shouldComponentUpdate!=null&&te.shouldComponentUpdate(se,te.__s,ce)===!1||C.__v===W.__v)){for(C.__v!==W.__v&&(te.props=se,te.state=te.__s,te.__d=!1),C.__e=W.__e,C.__k=W.__k,C.__k.forEach(function(Se){Se&&(Se.__=C)}),de=0;de<te._sb.length;de++)te.__h.push(te._sb[de]);te._sb=[],te.__h.length&&Z.push(te);break e}te.componentWillUpdate!=null&&te.componentWillUpdate(se,te.__s,ce),te.componentDidUpdate!=null&&te.__h.push(function(){te.componentDidUpdate(ne,oe,re)})}if(te.context=ce,te.props=se,te.__P=K,te.__e=!1,ue=l$3.__r,ge=0,"prototype"in pe&&pe.prototype.render){for(te.state=te.__s,te.__d=!1,ue&&ue(C),ee=te.render(te.props,te.state,te.context),he=0;he<te._sb.length;he++)te.__h.push(te._sb[he]);te._sb=[]}else do te.__d=!1,ue&&ue(C),ee=te.render(te.props,te.state,te.context),te.state=te.__s;while(te.__d&&++ge<25);te.state=te.__s,te.getChildContext!=null&&(V=h$1(h$1({},V),te.getChildContext())),ie||te.getSnapshotBeforeUpdate==null||(re=te.getSnapshotBeforeUpdate(ne,oe)),P$1(K,v$2(fe=ee!=null&&ee.type===k$1&&ee.key==null?ee.props.children:ee)?fe:[fe],C,W,V,U,G,Z,X,Q,J),te.base=C.__e,C.__h=null,te.__h.length&&Z.push(te),ae&&(te.__E=te.__=null)}catch(Se){C.__v=null,(Q||G!=null)&&(C.__e=X,C.__h=!!Q,G[G.indexOf(X)]=null),l$3.__e(Se,C,W)}else G==null&&C.__v===W.__v?(C.__k=W.__k,C.__e=W.__e):C.__e=M(W.__e,C,W,V,U,G,Z,Q,J);(ee=l$3.diffed)&&ee(C)}function L(K,C,W){for(var V=0;V<W.length;V++)N(W[V],W[++V],W[++V]);l$3.__c&&l$3.__c(C,K),K.some(function(U){try{K=U.__h,U.__h=[],K.some(function(G){G.call(U)})}catch(G){l$3.__e(G,U.__v)}})}function M(K,C,W,V,U,G,Z,X,Q){var J,ee,te,ie=W.props,ne=C.props,oe=C.type,re=0;if(oe==="svg"&&(U=!0),G!=null){for(;re<G.length;re++)if((J=G[re])&&"setAttribute"in J==!!oe&&(oe?J.localName===oe:J.nodeType===3)){K=J,G[re]=null;break}}if(K==null){if(oe===null)return document.createTextNode(ne);K=U?document.createElementNS("http://www.w3.org/2000/svg",oe):document.createElement(oe,ne.is&&ne),G=null,X=!1}if(oe===null)ie===ne||X&&K.data===ne||(K.data=ne);else{if(G=G&&n.call(K.childNodes),ee=(ie=W.props||c$2).dangerouslySetInnerHTML,te=ne.dangerouslySetInnerHTML,!X){if(G!=null)for(ie={},re=0;re<K.attributes.length;re++)ie[K.attributes[re].name]=K.attributes[re].value;(te||ee)&&(te&&(ee&&te.__html==ee.__html||te.__html===K.innerHTML)||(K.innerHTML=te&&te.__html||""))}if(D(K,ne,ie,U,X),te)C.__k=[];else if(P$1(K,v$2(re=C.props.children)?re:[re],C,W,V,U&&oe!=="foreignObject",G,Z,G?G[0]:W.__k&&g$2(W,0),X,Q),G!=null)for(re=G.length;re--;)G[re]!=null&&p$3(G[re]);X||("value"in ne&&(re=ne.value)!==void 0&&(re!==K.value||oe==="progress"&&!re||oe==="option"&&re!==ie.value)&&I(K,"value",re,ie.value,!1),"checked"in ne&&(re=ne.checked)!==void 0&&re!==K.checked&&I(K,"checked",re,ie.checked,!1))}return K}function N(K,C,W){try{typeof K=="function"?K(C):K.current=C}catch(V){l$3.__e(V,W)}}function O$1(K,C,W){var V,U;if(l$3.unmount&&l$3.unmount(K),(V=K.ref)&&(V.current&&V.current!==K.__e||N(V,null,C)),(V=K.__c)!=null){if(V.componentWillUnmount)try{V.componentWillUnmount()}catch(G){l$3.__e(G,C)}V.base=V.__P=null,K.__c=void 0}if(V=K.__k)for(U=0;U<V.length;U++)V[U]&&O$1(V[U],C,W||typeof K.type!="function");W||K.__e==null||p$3(K.__e),K.__=K.__e=K.__d=void 0}function q(K,C,W){return this.constructor(K,W)}function B(K,C,W){var V,U,G,Z;l$3.__&&l$3.__(K,C),U=(V=typeof W=="function")?null:W&&W.__k||C.__k,G=[],Z=[],z$1(C,K=(!V&&W||C).__k=y$1(k$1,null,[K]),U||c$2,c$2,C.ownerSVGElement!==void 0,!V&&W?[W]:U?null:C.firstChild?n.call(C.childNodes):null,G,!V&&W?W:U?U.__e:C.firstChild,V,Z),L(G,K,Z)}n=s$1.slice,l$3={__e:function(K,C,W,V){for(var U,G,Z;C=C.__;)if((U=C.__c)&&!U.__)try{if((G=U.constructor)&&G.getDerivedStateFromError!=null&&(U.setState(G.getDerivedStateFromError(K)),Z=U.__d),U.componentDidCatch!=null&&(U.componentDidCatch(K,V||{}),Z=U.__d),Z)return U.__E=U}catch(X){K=X}throw K}},u$2=0,t$2=function(K){return K!=null&&K.constructor===void 0},b$2.prototype.setState=function(K,C){var W;W=this.__s!=null&&this.__s!==this.state?this.__s:this.__s=h$1({},this.state),typeof K=="function"&&(K=K(h$1({},W),this.props)),K&&h$1(W,K),K!=null&&this.__v&&(C&&this._sb.push(C),w$2(this))},b$2.prototype.forceUpdate=function(K){this.__v&&(this.__e=!0,K&&this.__h.push(K),w$2(this))},b$2.prototype.render=k$1,i$2=[],r$2=typeof Promise=="function"?Promise.prototype.then.bind(Promise.resolve()):setTimeout,f$2=function(K,C){return K.__v.__b-C.__v.__b},x$1.__r=0;const index="";let wasm;const heap=new Array(128).fill(void 0);heap.push(void 0,null,!0,!1);function getObject(K){return heap[K]}let heap_next=heap.length;function dropObject(K){K<132||(heap[K]=heap_next,heap_next=K)}function takeObject(K){const C=getObject(K);return dropObject(K),C}const cachedTextDecoder=new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0});cachedTextDecoder.decode();let cachedUint8Memory0=null;function getUint8Memory0(){return(cachedUint8Memory0===null||cachedUint8Memory0.byteLength===0)&&(cachedUint8Memory0=new Uint8Array(wasm.memory.buffer)),cachedUint8Memory0}function getStringFromWasm0(K,C){return cachedTextDecoder.decode(getUint8Memory0().subarray(K,K+C))}function addHeapObject(K){heap_next===heap.length&&heap.push(heap.length+1);const C=heap_next;return heap_next=heap[C],heap[C]=K,C}let WASM_VECTOR_LEN=0;const cachedTextEncoder=new TextEncoder("utf-8"),encodeString=typeof cachedTextEncoder.encodeInto=="function"?function(K,C){return cachedTextEncoder.encodeInto(K,C)}:function(K,C){const W=cachedTextEncoder.encode(K);return C.set(W),{read:K.length,written:W.length}};function passStringToWasm0(K,C,W){if(W===void 0){const X=cachedTextEncoder.encode(K),Q=C(X.length);return getUint8Memory0().subarray(Q,Q+X.length).set(X),WASM_VECTOR_LEN=X.length,Q}let V=K.length,U=C(V);const G=getUint8Memory0();let Z=0;for(;Z<V;Z++){const X=K.charCodeAt(Z);if(X>127)break;G[U+Z]=X}if(Z!==V){Z!==0&&(K=K.slice(Z)),U=W(U,V,V=Z+K.length*3);const X=getUint8Memory0().subarray(U+Z,U+V),Q=encodeString(K,X);Z+=Q.written}return WASM_VECTOR_LEN=Z,U}function isLikeNone(K){return K==null}let cachedInt32Memory0=null;function getInt32Memory0(){return(cachedInt32Memory0===null||cachedInt32Memory0.byteLength===0)&&(cachedInt32Memory0=new Int32Array(wasm.memory.buffer)),cachedInt32Memory0}let cachedBigInt64Memory0=null;function getBigInt64Memory0(){return(cachedBigInt64Memory0===null||cachedBigInt64Memory0.byteLength===0)&&(cachedBigInt64Memory0=new BigInt64Array(wasm.memory.buffer)),cachedBigInt64Memory0}let cachedFloat64Memory0=null;function getFloat64Memory0(){return(cachedFloat64Memory0===null||cachedFloat64Memory0.byteLength===0)&&(cachedFloat64Memory0=new Float64Array(wasm.memory.buffer)),cachedFloat64Memory0}function debugString(K){const C=typeof K;if(C=="number"||C=="boolean"||K==null)return`${K}`;if(C=="string")return`"${K}"`;if(C=="symbol"){const U=K.description;return U==null?"Symbol":`Symbol(${U})`}if(C=="function"){const U=K.name;return typeof U=="string"&&U.length>0?`Function(${U})`:"Function"}if(Array.isArray(K)){const U=K.length;let G="[";U>0&&(G+=debugString(K[0]));for(let Z=1;Z<U;Z++)G+=", "+debugString(K[Z]);return G+="]",G}const W=/\[object ([^\]]+)\]/.exec(toString.call(K));let V;if(W.length>1)V=W[1];else return toString.call(K);if(V=="Object")try{return"Object("+JSON.stringify(K)+")"}catch{return"Object"}return K instanceof Error?`${K.name}: ${K.message}
${K.stack}`:V}function makeMutClosure(K,C,W,V){const U={a:K,b:C,cnt:1,dtor:W},G=(...Z)=>{U.cnt++;const X=U.a;U.a=0;try{return V(X,U.b,...Z)}finally{--U.cnt===0?wasm.__wbindgen_export_2.get(U.dtor)(X,U.b):U.a=X}};return G.original=U,G}function __wbg_adapter_50(K,C,W){wasm.__wbindgen_export_3(K,C,addHeapObject(W))}function transformSync(K,C,W){try{const Z=wasm.__wbindgen_add_to_stack_pointer(-16);wasm.transformSync(Z,addHeapObject(K),addHeapObject(C),addHeapObject(W));var V=getInt32Memory0()[Z/4+0],U=getInt32Memory0()[Z/4+1],G=getInt32Memory0()[Z/4+2];if(G)throw takeObject(U);return takeObject(V)}finally{wasm.__wbindgen_add_to_stack_pointer(16)}}function getCachedStringFromWasm0(K,C){return K===0?getObject(C):getStringFromWasm0(K,C)}function handleError(K,C){try{return K.apply(this,C)}catch(W){wasm.__wbindgen_export_5(addHeapObject(W))}}function __wbg_adapter_126(K,C,W,V){wasm.__wbindgen_export_6(K,C,addHeapObject(W),addHeapObject(V))}async function load(K,C){if(typeof Response=="function"&&K instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(K,C)}catch(V){if(K.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",V);else throw V}const W=await K.arrayBuffer();return await WebAssembly.instantiate(W,C)}else{const W=await WebAssembly.instantiate(K,C);return W instanceof WebAssembly.Instance?{instance:W,module:K}:W}}function getImports(){const K={};return K.wbg={},K.wbg.__wbindgen_object_drop_ref=function(C){takeObject(C)},K.wbg.__wbg_next_88560ec06a094dea=function(){return handleError(function(C){const W=getObject(C).next();return addHeapObject(W)},arguments)},K.wbg.__wbg_done_1ebec03bbd919843=function(C){return getObject(C).done},K.wbg.__wbg_value_6ac8da5cc5b3efda=function(C){const W=getObject(C).value;return addHeapObject(W)},K.wbg.__wbg_get_27fe3dac1c4d0224=function(C,W){const V=getObject(C)[W>>>0];return addHeapObject(V)},K.wbg.__wbg_new_f9876326328f45ed=function(){const C=new Object;return addHeapObject(C)},K.wbg.__wbindgen_string_new=function(C,W){const V=getStringFromWasm0(C,W);return addHeapObject(V)},K.wbg.__wbg_set_20cbc34131e76824=function(C,W,V){getObject(C)[takeObject(W)]=takeObject(V)},K.wbg.__wbg_new_b525de17f44a8943=function(){const C=new Array;return addHeapObject(C)},K.wbg.__wbg_set_17224bc548dd1d7b=function(C,W,V){getObject(C)[W>>>0]=takeObject(V)},K.wbg.__wbg_new_f841cc6f2098f4b5=function(){return addHeapObject(new Map)},K.wbg.__wbg_set_388c4c6422704173=function(C,W,V){const U=getObject(C).set(getObject(W),getObject(V));return addHeapObject(U)},K.wbg.__wbindgen_is_string=function(C){return typeof getObject(C)=="string"},K.wbg.__wbg_call_9495de66fdbe016b=function(){return handleError(function(C,W,V){const U=getObject(C).call(getObject(W),getObject(V));return addHeapObject(U)},arguments)},K.wbg.__wbindgen_string_get=function(C,W){const V=getObject(W),U=typeof V=="string"?V:void 0;var G=isLikeNone(U)?0:passStringToWasm0(U,wasm.__wbindgen_export_0,wasm.__wbindgen_export_1),Z=WASM_VECTOR_LEN;getInt32Memory0()[C/4+1]=Z,getInt32Memory0()[C/4+0]=G},K.wbg.__wbindgen_jsval_loose_eq=function(C,W){return getObject(C)==getObject(W)},K.wbg.__wbindgen_is_object=function(C){const W=getObject(C);return typeof W=="object"&&W!==null},K.wbg.__wbg_entries_4e1315b774245952=function(C){const W=Object.entries(getObject(C));return addHeapObject(W)},K.wbg.__wbg_length_e498fbc24f9c1d4f=function(C){return getObject(C).length},K.wbg.__wbg_getwithrefkey_15c62c2b8546208d=function(C,W){const V=getObject(C)[getObject(W)];return addHeapObject(V)},K.wbg.__wbindgen_is_undefined=function(C){return getObject(C)===void 0},K.wbg.__wbindgen_in=function(C,W){return getObject(C)in getObject(W)},K.wbg.__wbindgen_error_new=function(C,W){const V=new Error(getStringFromWasm0(C,W));return addHeapObject(V)},K.wbg.__wbindgen_is_null=function(C){return getObject(C)===null},K.wbg.__wbg_new_9d3a9ce4282a18a8=function(C,W){try{var V={a:C,b:W},U=(Z,X)=>{const Q=V.a;V.a=0;try{return __wbg_adapter_126(Q,V.b,Z,X)}finally{V.a=Q}};const G=new Promise(U);return addHeapObject(G)}finally{V.a=V.b=0}},K.wbg.__wbindgen_boolean_get=function(C){const W=getObject(C);return typeof W=="boolean"?W?1:0:2},K.wbg.__wbindgen_is_bigint=function(C){return typeof getObject(C)=="bigint"},K.wbg.__wbindgen_bigint_get_as_i64=function(C,W){const V=getObject(W),U=typeof V=="bigint"?V:void 0;getBigInt64Memory0()[C/8+1]=isLikeNone(U)?BigInt(0):U,getInt32Memory0()[C/4+0]=!isLikeNone(U)},K.wbg.__wbindgen_bigint_from_i64=function(C){return addHeapObject(C)},K.wbg.__wbindgen_jsval_eq=function(C,W){return getObject(C)===getObject(W)},K.wbg.__wbindgen_bigint_from_u64=function(C){const W=BigInt.asUintN(64,C);return addHeapObject(W)},K.wbg.__wbindgen_number_get=function(C,W){const V=getObject(W),U=typeof V=="number"?V:void 0;getFloat64Memory0()[C/8+1]=isLikeNone(U)?0:U,getInt32Memory0()[C/4+0]=!isLikeNone(U)},K.wbg.__wbg_isSafeInteger_8c4789029e885159=function(C){return Number.isSafeInteger(getObject(C))},K.wbg.__wbg_isArray_39d28997bf6b96b4=function(C){return Array.isArray(getObject(C))},K.wbg.__wbg_iterator_55f114446221aa5a=function(){return addHeapObject(Symbol.iterator)},K.wbg.__wbindgen_number_new=function(C){return addHeapObject(C)},K.wbg.__wbg_new0_25059e40b1c02766=function(){return addHeapObject(new Date)},K.wbg.__wbg_getTimezoneOffset_2a6b27fb18493a56=function(C){return getObject(C).getTimezoneOffset()},K.wbg.__wbg_get_baf4855f9a986186=function(){return handleError(function(C,W){const V=Reflect.get(getObject(C),getObject(W));return addHeapObject(V)},arguments)},K.wbg.__wbg_getTime_7c59072d1651a3cf=function(C){return getObject(C).getTime()},K.wbg.__wbg_new_abda76e883ba8a5f=function(){const C=new Error;return addHeapObject(C)},K.wbg.__wbg_stack_658279fe44541cf6=function(C,W){const V=getObject(W).stack,U=passStringToWasm0(V,wasm.__wbindgen_export_0,wasm.__wbindgen_export_1),G=WASM_VECTOR_LEN;getInt32Memory0()[C/4+1]=G,getInt32Memory0()[C/4+0]=U},K.wbg.__wbg_error_f851667af71bcfc6=function(C,W){var V=getCachedStringFromWasm0(C,W);C!==0&&wasm.__wbindgen_export_4(C,W),console.error(V)},K.wbg.__wbg_subarray_7526649b91a252a6=function(C,W,V){const U=getObject(C).subarray(W>>>0,V>>>0);return addHeapObject(U)},K.wbg.__wbg_getRandomValues_37fa2ca9e4e07fab=function(){return handleError(function(C,W){getObject(C).getRandomValues(getObject(W))},arguments)},K.wbg.__wbindgen_memory=function(){const C=wasm.memory;return addHeapObject(C)},K.wbg.__wbg_buffer_cf65c07de34b9a08=function(C){const W=getObject(C).buffer;return addHeapObject(W)},K.wbg.__wbg_newwithbyteoffsetandlength_9fb2f11355ecadf5=function(C,W,V){const U=new Uint8Array(getObject(C),W>>>0,V>>>0);return addHeapObject(U)},K.wbg.__wbg_randomFillSync_dc1e9a60c158336d=function(){return handleError(function(C,W){getObject(C).randomFillSync(takeObject(W))},arguments)},K.wbg.__wbg_new_537b7341ce90bb31=function(C){const W=new Uint8Array(getObject(C));return addHeapObject(W)},K.wbg.__wbg_set_17499e8aa4003ebd=function(C,W,V){getObject(C).set(getObject(W),V>>>0)},K.wbg.__wbg_crypto_c48a774b022d20ac=function(C){const W=getObject(C).crypto;return addHeapObject(W)},K.wbg.__wbg_process_298734cf255a885d=function(C){const W=getObject(C).process;return addHeapObject(W)},K.wbg.__wbg_versions_e2e78e134e3e5d01=function(C){const W=getObject(C).versions;return addHeapObject(W)},K.wbg.__wbg_node_1cd7a5d853dbea79=function(C){const W=getObject(C).node;return addHeapObject(W)},K.wbg.__wbg_msCrypto_bcb970640f50a1e8=function(C){const W=getObject(C).msCrypto;return addHeapObject(W)},K.wbg.__wbg_newwithlength_b56c882b57805732=function(C){const W=new Uint8Array(C>>>0);return addHeapObject(W)},K.wbg.__wbg_require_8f08ceecec0f4fee=function(){return handleError(function(){const C=module.require;return addHeapObject(C)},arguments)},K.wbg.__wbindgen_is_function=function(C){return typeof getObject(C)=="function"},K.wbg.__wbg_call_95d1ea488d03e4e8=function(){return handleError(function(C,W){const V=getObject(C).call(getObject(W));return addHeapObject(V)},arguments)},K.wbg.__wbg_next_b7d530c04fd8b217=function(C){const W=getObject(C).next;return addHeapObject(W)},K.wbg.__wbg_self_e7c1f827057f6584=function(){return handleError(function(){const C=self.self;return addHeapObject(C)},arguments)},K.wbg.__wbg_window_a09ec664e14b1b81=function(){return handleError(function(){const C=window.window;return addHeapObject(C)},arguments)},K.wbg.__wbg_globalThis_87cbb8506fecf3a9=function(){return handleError(function(){const C=globalThis.globalThis;return addHeapObject(C)},arguments)},K.wbg.__wbg_global_c85a9259e621f3db=function(){return handleError(function(){const C=global.global;return addHeapObject(C)},arguments)},K.wbg.__wbg_newnoargs_2b8b6bd7753c76ba=function(C,W){var V=getCachedStringFromWasm0(C,W);const U=new Function(V);return addHeapObject(U)},K.wbg.__wbindgen_object_clone_ref=function(C){const W=getObject(C);return addHeapObject(W)},K.wbg.__wbg_length_27a2afe8ab42b09f=function(C){return getObject(C).length},K.wbg.__wbindgen_debug_string=function(C,W){const V=debugString(getObject(W)),U=passStringToWasm0(V,wasm.__wbindgen_export_0,wasm.__wbindgen_export_1),G=WASM_VECTOR_LEN;getInt32Memory0()[C/4+1]=G,getInt32Memory0()[C/4+0]=U},K.wbg.__wbg_instanceof_Uint8Array_01cebe79ca606cca=function(C){let W;try{W=getObject(C)instanceof Uint8Array}catch{W=!1}return W},K.wbg.__wbg_instanceof_ArrayBuffer_a69f02ee4c4f5065=function(C){let W;try{W=getObject(C)instanceof ArrayBuffer}catch{W=!1}return W},K.wbg.__wbg_String_91fba7ded13ba54c=function(C,W){const V=String(getObject(W)),U=passStringToWasm0(V,wasm.__wbindgen_export_0,wasm.__wbindgen_export_1),G=WASM_VECTOR_LEN;getInt32Memory0()[C/4+1]=G,getInt32Memory0()[C/4+0]=U},K.wbg.__wbindgen_throw=function(C,W){throw new Error(getStringFromWasm0(C,W))},K.wbg.__wbg_resolve_fd40f858d9db1a04=function(C){const W=Promise.resolve(getObject(C));return addHeapObject(W)},K.wbg.__wbindgen_cb_drop=function(C){const W=takeObject(C).original;return W.cnt--==1?(W.a=0,!0):!1},K.wbg.__wbg_then_ec5db6d509eb475f=function(C,W){const V=getObject(C).then(getObject(W));return addHeapObject(V)},K.wbg.__wbindgen_closure_wrapper15965=function(C,W,V){const U=makeMutClosure(C,W,220,__wbg_adapter_50);return addHeapObject(U)},K}function finalizeInit(K,C){return wasm=K.exports,init$3.__wbindgen_wasm_module=C,cachedBigInt64Memory0=null,cachedFloat64Memory0=null,cachedInt32Memory0=null,cachedUint8Memory0=null,wasm}async function init$3(K){typeof K>"u"&&(K=new URL("/assets/wasm-web_bg-d2b08de2.wasm",self.location));const C=getImports();(typeof K=="string"||typeof Request=="function"&&K instanceof Request||typeof URL=="function"&&K instanceof URL)&&(K=fetch(K));const{instance:W,module:V}=await load(await K,C);return finalizeInit(W,V)}function WorkerWrapper$4(){return new Worker("/assets/editor.worker-94ffd778.js")}function WorkerWrapper$3(){return new Worker("/assets/css.worker-c3850ceb.js")}function WorkerWrapper$2(){return new Worker("/assets/html.worker-88b237e1.js")}function WorkerWrapper$1(){return new Worker("/assets/json.worker-8dd963f3.js")}function WorkerWrapper(){return new Worker("/assets/ts.worker-72c9fe54.js")}const Either={of(K){return right(K)},lefts(K){let C=[];for(const W of K)W.isLeft()&&C.push(W.extract());return C},rights(K){let C=[];for(const W of K)W.isRight()&&C.push(W.extract());return C},encase(K){try{return right(K())}catch(C){return left(C)}},sequence(K){let C=[];for(const W of K){if(W.isLeft())return W;C.push(W.extract())}return right(C)},isEither(K){return K instanceof Left||K instanceof Right},"fantasy-land/of"(K){return Either.of(K)}};class Right{constructor(C){this.__value=C,this._="R",this["fantasy-land/bimap"]=this.bimap,this["fantasy-land/map"]=this.map,this["fantasy-land/ap"]=this.ap,this["fantasy-land/equals"]=this.equals,this["fantasy-land/chain"]=this.chain,this["fantasy-land/alt"]=this.alt,this["fantasy-land/reduce"]=this.reduce,this["fantasy-land/extend"]=this.extend}isLeft(){return!1}isRight(){return!0}toJSON(){return this.__value}inspect(){return`Right(${this.__value})`}toString(){return this.inspect()}bimap(C,W){return right(W(this.__value))}map(C){return right(C(this.__value))}mapLeft(C){return this}ap(C){return C.isRight()?this.map(C.extract()):C}equals(C){return C.isRight()?this.__value===C.extract():!1}chain(C){return C(this.__value)}chainLeft(C){return this}join(){return this.__value}alt(C){return this}altLazy(C){return this}reduce(C,W){return C(W,this.__value)}extend(C){return right(C(this))}unsafeCoerce(){return this.__value}caseOf(C){return"_"in C?C._():C.Right(this.__value)}leftOrDefault(C){return C}orDefault(C){return this.__value}orDefaultLazy(C){return this.__value}leftOrDefaultLazy(C){return C()}ifLeft(C){return this}ifRight(C){return C(this.__value),this}toMaybe(){return just(this.__value)}leftToMaybe(){return nothing}extract(){return this.__value}swap(){return left(this.__value)}}Right.prototype.constructor=Either;class Left{constructor(C){this.__value=C,this._="L",this["fantasy-land/bimap"]=this.bimap,this["fantasy-land/map"]=this.map,this["fantasy-land/ap"]=this.ap,this["fantasy-land/equals"]=this.equals,this["fantasy-land/chain"]=this.chain,this["fantasy-land/alt"]=this.alt,this["fantasy-land/reduce"]=this.reduce,this["fantasy-land/extend"]=this.extend}isLeft(){return!0}isRight(){return!1}toJSON(){return this.__value}inspect(){return`Left(${JSON.stringify(this.__value)})`}toString(){return this.inspect()}bimap(C,W){return left(C(this.__value))}map(C){return this}mapLeft(C){return left(C(this.__value))}ap(C){return C.isLeft()?C:this}equals(C){return C.isLeft()?C.extract()===this.__value:!1}chain(C){return this}chainLeft(C){return C(this.__value)}join(){return this}alt(C){return C}altLazy(C){return C()}reduce(C,W){return W}extend(C){return this}unsafeCoerce(){throw this.__value instanceof Error?this.__value:new Error("Either#unsafeCoerce was ran on a Left")}caseOf(C){return"_"in C?C._():C.Left(this.__value)}leftOrDefault(C){return this.__value}orDefault(C){return C}orDefaultLazy(C){return C()}leftOrDefaultLazy(C){return this.__value}ifLeft(C){return C(this.__value),this}ifRight(C){return this}toMaybe(){return nothing}leftToMaybe(){return just(this.__value)}extract(){return this.__value}swap(){return right(this.__value)}}Left.prototype.constructor=Either;const left=K=>new Left(K),right=K=>new Right(K),Maybe={of(K){return just(K)},empty(){return nothing},zero(){return nothing},fromNullable(K){return K==null?nothing:just(K)},fromFalsy(K){return K?just(K):nothing},fromPredicate(K,C){switch(arguments.length){case 1:return W=>Maybe.fromPredicate(K,W);default:return K(C)?just(C):nothing}},mapMaybe(K,C){switch(arguments.length){case 1:return W=>Maybe.mapMaybe(K,W);default:return Maybe.catMaybes(C.map(K))}},catMaybes(K){let C=[];for(const W of K)W.isJust()&&C.push(W.extract());return C},encase(K){try{return just(K())}catch{return nothing}},isMaybe(K){return K instanceof Just||K instanceof Nothing},sequence(K){let C=[];for(const W of K)if(W.isJust())C.push(W.extract());else return nothing;return just(C)},"fantasy-land/of"(K){return this.of(K)},"fantasy-land/empty"(){return this.empty()},"fantasy-land/zero"(){return this.zero()}};class Just{constructor(C){this.__value=C,this["fantasy-land/equals"]=this.equals,this["fantasy-land/map"]=this.map,this["fantasy-land/ap"]=this.ap,this["fantasy-land/alt"]=this.alt,this["fantasy-land/chain"]=this.chain,this["fantasy-land/reduce"]=this.reduce,this["fantasy-land/extend"]=this.extend,this["fantasy-land/filter"]=this.filter}isJust(){return!0}isNothing(){return!1}inspect(){return`Just(${this.__value})`}toString(){return this.inspect()}toJSON(){const C=this.__value;return C instanceof Date?C.toJSON():C}equals(C){return this.extract()===C.extract()}map(C){return just(C(this.__value))}ap(C){return C.isJust()?this.map(C.extract()):nothing}alt(C){return this}altLazy(C){return this}chain(C){return C(this.__value)}chainNullable(C){return Maybe.fromNullable(C(this.__value))}join(){return this.__value}reduce(C,W){return C(W,this.__value)}extend(C){return just(C(this))}unsafeCoerce(){return this.__value}caseOf(C){return"_"in C?C._():C.Just(this.__value)}orDefault(C){return this.__value}orDefaultLazy(C){return this.__value}toList(){return[this.__value]}mapOrDefault(C,W){return C(this.__value)}extract(){return this.__value}extractNullable(){return this.__value}toEither(C){return right(this.__value)}ifJust(C){return C(this.__value),this}ifNothing(C){return this}filter(C){return C(this.__value)?just(this.__value):nothing}}Just.prototype.constructor=Maybe;class Nothing{constructor(){this["fantasy-land/equals"]=this.equals,this["fantasy-land/map"]=this.map,this["fantasy-land/ap"]=this.ap,this["fantasy-land/alt"]=this.alt,this["fantasy-land/chain"]=this.chain,this["fantasy-land/reduce"]=this.reduce,this["fantasy-land/extend"]=this.extend,this["fantasy-land/filter"]=this.filter}isJust(){return!1}isNothing(){return!0}inspect(){return"Nothing"}toString(){return this.inspect()}toJSON(){return this.__value}equals(C){return this.extract()===C.extract()}map(C){return nothing}ap(C){return nothing}alt(C){return C}altLazy(C){return C()}chain(C){return nothing}chainNullable(C){return nothing}join(){return nothing}reduce(C,W){return W}extend(C){return nothing}unsafeCoerce(){throw new Error("Maybe#unsafeCoerce was ran on a Nothing")}caseOf(C){return"_"in C?C._():C.Nothing()}orDefault(C){return C}orDefaultLazy(C){return C()}toList(){return[]}mapOrDefault(C,W){return W}extract(){}extractNullable(){return null}toEither(C){return left(C)}ifJust(C){return this}ifNothing(C){return C(),this}filter(C){return nothing}}Nothing.prototype.constructor=Maybe;const just=K=>new Just(K),nothing=new Nothing;var _a$6;const helpers$1={liftEither(K){if(K.isRight())return Promise.resolve(K.extract());throw K.extract()},fromPromise(K){return K.then(helpers$1.liftEither)},throwE(K){throw K}};class EitherAsyncImpl{constructor(C){this.runPromise=C,this[_a$6]="EitherAsync",this["fantasy-land/chain"]=this.chain,this["fantasy-land/alt"]=this.alt,this.then=(W,V)=>this.run().then(W,V)}leftOrDefault(C){return this.run().then(W=>W.leftOrDefault(C))}orDefault(C){return this.run().then(W=>W.orDefault(C))}join(){return EitherAsync(async C=>{const W=await this;if(W.isRight()){const V=await W.extract();return C.liftEither(V)}return C.liftEither(W)})}ap(C){return EitherAsync(async W=>{const V=await C;if(V.isRight()){const U=await this.run();return U.isRight()?V.extract()(U.extract()):W.liftEither(U)}return W.liftEither(V)})}alt(C){return EitherAsync(async W=>{const V=await this.run();if(V.isRight())return V.extract();{const U=await C;return W.liftEither(U)}})}extend(C){return EitherAsync(async W=>{const V=await this.run();if(V.isRight()){const U=EitherAsync.liftEither(V);return W.liftEither(right(C(U)))}return W.liftEither(V)})}async run(){try{return right(await this.runPromise(helpers$1))}catch(C){return left(C)}}bimap(C,W){return EitherAsync(async V=>{const U=await this.run();return V.liftEither(U.bimap(C,W))})}map(C){return EitherAsync(W=>this.runPromise(W).then(C))}mapLeft(C){return EitherAsync(async W=>{try{return await this.runPromise(W)}catch(V){throw await C(V)}})}chain(C){return EitherAsync(async W=>{const V=await this.runPromise(W);return W.fromPromise(C(V))})}chainLeft(C){return EitherAsync(async W=>{try{return await this.runPromise(W)}catch(V){return W.fromPromise(C(V))}})}toMaybeAsync(){return MaybeAsync(async({liftMaybe:C})=>{const W=await this.run();return C(W.toMaybe())})}swap(){return EitherAsync(async C=>{const W=await this.run();return W.isRight()&&C.throwE(W.extract()),C.liftEither(right(W.extract()))})}ifLeft(C){return EitherAsync(async W=>{const V=await this.run();return V.ifLeft(C),W.liftEither(V)})}ifRight(C){return EitherAsync(async W=>{const V=await this.run();return V.ifRight(C),W.liftEither(V)})}void(){return this.map(C=>{})}caseOf(C){return this.run().then(W=>W.caseOf(C))}finally(C){return EitherAsync(({fromPromise:W})=>W(this.run().finally(C)))}}_a$6=Symbol.toStringTag;const EitherAsync=Object.assign(K=>new EitherAsyncImpl(K),{fromPromise:K=>EitherAsync(({fromPromise:C})=>C(K())),liftEither:K=>EitherAsync(({liftEither:C})=>C(K)),lefts:K=>Promise.all(K.map(C=>C.run())).then(Either.lefts),rights:K=>Promise.all(K.map(C=>C.run())).then(Either.rights),sequence:K=>EitherAsync(async C=>{let W=[];for await(const V of K){if(V.isLeft())return C.liftEither(V);W.push(V.extract())}return C.liftEither(right(W))}),all:K=>EitherAsync.fromPromise(async()=>Promise.all(K).then(Either.sequence))});EitherAsyncImpl.prototype.constructor=EitherAsync;var _a$5;const helpers={liftMaybe(K){if(K.isJust())return Promise.resolve(K.extract());throw nothing},fromPromise(K){return K.then(helpers.liftMaybe)}};class MaybeAsyncImpl{constructor(C){this.runPromise=C,this[_a$5]="MaybeAsync",this["fantasy-land/chain"]=this.chain,this["fantasy-land/filter"]=this.filter,this["fantasy-land/alt"]=this.alt}orDefault(C){return this.run().then(W=>W.orDefault(C))}join(){return MaybeAsync(async C=>{const W=await this.run();if(W.isJust()){const V=await W.extract();return C.liftMaybe(V)}return C.liftMaybe(nothing)})}ap(C){return MaybeAsync(async W=>{const V=await C;if(V.isJust()){const U=await this.run();return U.isJust()?V.extract()(U.extract()):W.liftMaybe(nothing)}return W.liftMaybe(nothing)})}alt(C){return MaybeAsync(async W=>{const V=await this.run();if(V.isJust())return V.extract();{const U=await C;return W.liftMaybe(U)}})}extend(C){return MaybeAsync(async W=>{const V=await this.run();if(V.isJust()){const U=MaybeAsync.liftMaybe(V);return W.liftMaybe(just(C(U)))}return W.liftMaybe(nothing)})}filter(C){return MaybeAsync(async W=>{const V=await this.run();return W.liftMaybe(V.filter(C))})}async run(){try{return just(await this.runPromise(helpers))}catch{return nothing}}map(C){return MaybeAsync(W=>this.runPromise(W).then(C))}chain(C){return MaybeAsync(async W=>{const V=await this.runPromise(W);return W.fromPromise(C(V))})}toEitherAsync(C){return EitherAsync(async({liftEither:W})=>{const V=await this.run();return W(V.toEither(C))})}ifJust(C){return MaybeAsync(async W=>{const V=await this.run();return V.ifJust(C),W.liftMaybe(V)})}ifNothing(C){return MaybeAsync(async W=>{const V=await this.run();return V.ifNothing(C),W.liftMaybe(V)})}void(){return this.map(C=>{})}caseOf(C){return this.run().then(W=>W.caseOf(C))}finally(C){return MaybeAsync(({fromPromise:W})=>W(this.run().finally(C)))}then(C,W){return this.run().then(C,W)}}_a$5=Symbol.toStringTag;const MaybeAsync=Object.assign(K=>new MaybeAsyncImpl(K),{catMaybes:K=>Promise.all(K).then(Maybe.catMaybes),fromPromise:K=>MaybeAsync(({fromPromise:C})=>C(K())),liftMaybe:K=>MaybeAsync(({liftMaybe:C})=>C(K))});MaybeAsyncImpl.prototype.constructor=MaybeAsync;var t$1,r$1,u$1,i$1,o$4=0,f$1=[],c$1=[],e$1=l$3.__b,a$1=l$3.__r,v$1=l$3.diffed,l$2=l$3.__c,m=l$3.unmount;function d$2(K,C){l$3.__h&&l$3.__h(r$1,K,o$4||C),o$4=0;var W=r$1.__H||(r$1.__H={__:[],__h:[]});return K>=W.__.length&&W.__.push({__V:c$1}),W.__[K]}function p$2(K,C){var W=d$2(t$1++,3);!l$3.__s&&z(W.__H,C)&&(W.__=K,W.i=C,r$1.__H.__h.push(W))}function _$3(K){return o$4=5,F$2(function(){return{current:K}},[])}function F$2(K,C){var W=d$2(t$1++,7);return z(W.__H,C)?(W.__V=K(),W.i=C,W.__h=K,W.__V):W.__}function b$1(){for(var K;K=f$1.shift();)if(K.__P&&K.__H)try{K.__H.__h.forEach(k),K.__H.__h.forEach(w$1),K.__H.__h=[]}catch(C){K.__H.__h=[],l$3.__e(C,K.__v)}}l$3.__b=function(K){r$1=null,e$1&&e$1(K)},l$3.__r=function(K){a$1&&a$1(K),t$1=0;var C=(r$1=K.__c).__H;C&&(u$1===r$1?(C.__h=[],r$1.__h=[],C.__.forEach(function(W){W.__N&&(W.__=W.__N),W.__V=c$1,W.__N=W.i=void 0})):(C.__h.forEach(k),C.__h.forEach(w$1),C.__h=[],t$1=0)),u$1=r$1},l$3.diffed=function(K){v$1&&v$1(K);var C=K.__c;C&&C.__H&&(C.__H.__h.length&&(f$1.push(C)!==1&&i$1===l$3.requestAnimationFrame||((i$1=l$3.requestAnimationFrame)||j)(b$1)),C.__H.__.forEach(function(W){W.i&&(W.__H=W.i),W.__V!==c$1&&(W.__=W.__V),W.i=void 0,W.__V=c$1})),u$1=r$1=null},l$3.__c=function(K,C){C.some(function(W){try{W.__h.forEach(k),W.__h=W.__h.filter(function(V){return!V.__||w$1(V)})}catch(V){C.some(function(U){U.__h&&(U.__h=[])}),C=[],l$3.__e(V,W.__v)}}),l$2&&l$2(K,C)},l$3.unmount=function(K){m&&m(K);var C,W=K.__c;W&&W.__H&&(W.__H.__.forEach(function(V){try{k(V)}catch(U){C=U}}),W.__H=void 0,C&&l$3.__e(C,W.__v))};var g$1=typeof requestAnimationFrame=="function";function j(K){var C,W=function(){clearTimeout(V),g$1&&cancelAnimationFrame(C),setTimeout(K)},V=setTimeout(W,100);g$1&&(C=requestAnimationFrame(W))}function k(K){var C=r$1,W=K.__c;typeof W=="function"&&(K.__c=void 0,W()),r$1=C}function w$1(K){var C=r$1;K.__c=K.__(),r$1=C}function z(K,C){return!K||K.length!==C.length||C.some(function(W,V){return W!==K[V]})}const app$1="";function i(){throw new Error("Cycle detected")}var t=Symbol.for("preact-signals");function r(){if(v>1)v--;else{for(var K,C=!1;f!==void 0;){var W=f;for(f=void 0,e++;W!==void 0;){var V=W.o;if(W.o=void 0,W.f&=-3,!(8&W.f)&&l$1(W))try{W.c()}catch(U){C||(K=U,C=!0)}W=V}}if(e=0,v--,C)throw K}}var o$3=void 0,f=void 0,v=0,e=0,u=0;function c(K){if(o$3!==void 0){var C=K.n;if(C===void 0||C.t!==o$3)return C={i:0,S:K,p:o$3.s,n:void 0,t:o$3,e:void 0,x:void 0,r:C},o$3.s!==void 0&&(o$3.s.n=C),o$3.s=C,K.n=C,32&o$3.f&&K.S(C),C;if(C.i===-1)return C.i=0,C.n!==void 0&&(C.n.p=C.p,C.p!==void 0&&(C.p.n=C.n),C.p=o$3.s,C.n=void 0,o$3.s.n=C,o$3.s=C),C}}function d$1(K){this.v=K,this.i=0,this.n=void 0,this.t=void 0}d$1.prototype.brand=t;d$1.prototype.h=function(){return!0};d$1.prototype.S=function(K){this.t!==K&&K.e===void 0&&(K.x=this.t,this.t!==void 0&&(this.t.e=K),this.t=K)};d$1.prototype.U=function(K){if(this.t!==void 0){var C=K.e,W=K.x;C!==void 0&&(C.x=W,K.e=void 0),W!==void 0&&(W.e=C,K.x=void 0),K===this.t&&(this.t=W)}};d$1.prototype.subscribe=function(K){var C=this;return O(function(){var W=C.value,V=32&this.f;this.f&=-33;try{K(W)}finally{this.f|=V}})};d$1.prototype.valueOf=function(){return this.value};d$1.prototype.toString=function(){return this.value+""};d$1.prototype.toJSON=function(){return this.value};d$1.prototype.peek=function(){return this.v};Object.defineProperty(d$1.prototype,"value",{get:function(){var K=c(this);return K!==void 0&&(K.i=this.i),this.v},set:function(K){if(o$3 instanceof _$2&&function(){throw new Error("Computed cannot have side-effects")}(),K!==this.v){e>100&&i(),this.v=K,this.i++,u++,v++;try{for(var C=this.t;C!==void 0;C=C.x)C.t.N()}finally{r()}}}});function a(K){return new d$1(K)}function l$1(K){for(var C=K.s;C!==void 0;C=C.n)if(C.S.i!==C.i||!C.S.h()||C.S.i!==C.i)return!0;return!1}function y(K){for(var C=K.s;C!==void 0;C=C.n){var W=C.S.n;if(W!==void 0&&(C.r=W),C.S.n=C,C.i=-1,C.n===void 0){K.s=C;break}}}function w(K){for(var C=K.s,W=void 0;C!==void 0;){var V=C.p;C.i===-1?(C.S.U(C),V!==void 0&&(V.n=C.n),C.n!==void 0&&(C.n.p=V)):W=C,C.S.n=C.r,C.r!==void 0&&(C.r=void 0),C=V}K.s=W}function _$2(K){d$1.call(this,void 0),this.x=K,this.s=void 0,this.g=u-1,this.f=4}(_$2.prototype=new d$1).h=function(){if(this.f&=-3,1&this.f)return!1;if((36&this.f)==32||(this.f&=-5,this.g===u))return!0;if(this.g=u,this.f|=1,this.i>0&&!l$1(this))return this.f&=-2,!0;var K=o$3;try{y(this),o$3=this;var C=this.x();(16&this.f||this.v!==C||this.i===0)&&(this.v=C,this.f&=-17,this.i++)}catch(W){this.v=W,this.f|=16,this.i++}return o$3=K,w(this),this.f&=-2,!0};_$2.prototype.S=function(K){if(this.t===void 0){this.f|=36;for(var C=this.s;C!==void 0;C=C.n)C.S.S(C)}d$1.prototype.S.call(this,K)};_$2.prototype.U=function(K){if(this.t!==void 0&&(d$1.prototype.U.call(this,K),this.t===void 0)){this.f&=-33;for(var C=this.s;C!==void 0;C=C.n)C.S.U(C)}};_$2.prototype.N=function(){if(!(2&this.f)){this.f|=6;for(var K=this.t;K!==void 0;K=K.x)K.t.N()}};_$2.prototype.peek=function(){if(this.h()||i(),16&this.f)throw this.v;return this.v};Object.defineProperty(_$2.prototype,"value",{get:function(){1&this.f&&i();var K=c(this);if(this.h(),K!==void 0&&(K.i=this.i),16&this.f)throw this.v;return this.v}});function p$1(K){return new _$2(K)}function g(K){var C=K.u;if(K.u=void 0,typeof C=="function"){v++;var W=o$3;o$3=void 0;try{C()}catch(V){throw K.f&=-2,K.f|=8,b(K),V}finally{o$3=W,r()}}}function b(K){for(var C=K.s;C!==void 0;C=C.n)C.S.U(C);K.x=void 0,K.s=void 0,g(K)}function x(K){if(o$3!==this)throw new Error("Out-of-order effect");w(this),o$3=K,this.f&=-2,8&this.f&&b(this),r()}function E(K){this.x=K,this.u=void 0,this.s=void 0,this.o=void 0,this.f=32}E.prototype.c=function(){var K=this.S();try{if(8&this.f||this.x===void 0)return;var C=this.x();typeof C=="function"&&(this.u=C)}finally{K()}};E.prototype.S=function(){1&this.f&&i(),this.f|=1,this.f&=-9,g(this),y(this),v++;var K=o$3;return o$3=this,x.bind(this,K)};E.prototype.N=function(){2&this.f||(this.f|=2,this.o=f,f=this)};E.prototype.d=function(){this.f|=8,1&this.f||b(this)};function O(K){var C=new E(K);try{C.c()}catch(W){throw C.d(),W}return C.d.bind(C)}var s;function l(K,C){l$3[K]=C.bind(null,l$3[K]||function(){})}function d(K){s&&s(),s=K&&K.S()}function p(K){var C=this,W=K.data,V=useSignal(W);V.value=W;var U=F$2(function(){for(var G=C.__v;G=G.__;)if(G.__c){G.__c.__$f|=4;break}return C.__$u.c=function(){var Z;!t$2(U.peek())&&((Z=C.base)==null?void 0:Z.nodeType)===3?C.base.data=U.peek():(C.__$f|=1,C.setState({}))},p$1(function(){var Z=V.value.value;return Z===0?0:Z===!0?"":Z||""})},[]);return U.value}p.displayName="_st";Object.defineProperties(d$1.prototype,{constructor:{configurable:!0,value:void 0},type:{configurable:!0,value:p},props:{configurable:!0,get:function(){return{data:this}}},__b:{configurable:!0,value:1}});l("__b",function(K,C){if(typeof C.type=="string"){var W,V=C.props;for(var U in V)if(U!=="children"){var G=V[U];G instanceof d$1&&(W||(C.__np=W={}),W[U]=G,V[U]=G.peek())}}K(C)});l("__r",function(K,C){d();var W,V=C.__c;V&&(V.__$f&=-2,(W=V.__$u)===void 0&&(V.__$u=W=function(U){var G;return O(function(){G=this}),G.c=function(){V.__$f|=1,V.setState({})},G}())),d(W),K(C)});l("__e",function(K,C,W,V){d(),K(C,W,V)});l("diffed",function(K,C){d();var W;if(typeof C.type=="string"&&(W=C.__e)){var V=C.__np,U=C.props;if(V){var G=W.U;if(G)for(var Z in G){var X=G[Z];X!==void 0&&!(Z in V)&&(X.d(),G[Z]=void 0)}else W.U=G={};for(var Q in V){var J=G[Q],ee=V[Q];J===void 0?(J=_$1(W,Q,ee,U),G[Q]=J):J.o(ee,U)}}}K(C)});function _$1(K,C,W,V){var U=C in K&&K.ownerSVGElement===void 0,G=a(W);return{o:function(Z,X){G.value=Z,V=X},d:O(function(){var Z=G.value.value;V[C]!==Z&&(V[C]=Z,U?K[C]=Z:Z?K.setAttribute(C,Z):K.removeAttribute(C))})}}l("unmount",function(K,C){if(typeof C.type=="string"){var W=C.__e;if(W){var V=W.U;if(V){W.U=void 0;for(var U in V){var G=V[U];G&&G.d()}}}}else{var Z=C.__c;if(Z){var X=Z.__$u;X&&(Z.__$u=void 0,X.d())}}K(C)});l("__h",function(K,C,W,V){(V<3||V===9)&&(C.__$f|=2),K(C,W,V)});b$2.prototype.shouldComponentUpdate=function(K,C){var W=this.__$u;if(!(W&&W.s!==void 0||4&this.__$f)||3&this.__$f)return!0;for(var V in C)return!0;for(var U in K)if(U!=="__source"&&K[U]!==this.props[U])return!0;for(var G in this.props)if(!(G in K))return!0;return!1};function useSignal(K){return F$2(function(){return a(K)},[])}function tail$3(K,C=0){return K[K.length-(1+C)]}function tail2(K){if(K.length===0)throw new Error("Invalid tail call");return[K.slice(0,K.length-1),K[K.length-1]]}function equals$5(K,C,W=(V,U)=>V===U){if(K===C)return!0;if(!K||!C||K.length!==C.length)return!1;for(let V=0,U=K.length;V<U;V++)if(!W(K[V],C[V]))return!1;return!0}function removeFastWithoutKeepingOrder(K,C){const W=K.length-1;C<W&&(K[C]=K[W]),K.pop()}function binarySearch(K,C,W){return binarySearch2(K.length,V=>W(K[V],C))}function binarySearch2(K,C){let W=0,V=K-1;for(;W<=V;){const U=(W+V)/2|0,G=C(U);if(G<0)W=U+1;else if(G>0)V=U-1;else return U}return-(W+1)}function quickSelect(K,C,W){if(K=K|0,K>=C.length)throw new TypeError("invalid index");const V=C[Math.floor(C.length*Math.random())],U=[],G=[],Z=[];for(const X of C){const Q=W(X,V);Q<0?U.push(X):Q>0?G.push(X):Z.push(X)}return K<U.length?quickSelect(K,U,W):K<U.length+Z.length?Z[0]:quickSelect(K-(U.length+Z.length),G,W)}function groupBy$2(K,C){const W=[];let V;for(const U of K.slice(0).sort(C))!V||C(V[0],U)!==0?(V=[U],W.push(V)):V.push(U);return W}function*groupAdjacentBy(K,C){let W,V;for(const U of K)V!==void 0&&C(V,U)?W.push(U):(W&&(yield W),W=[U]),V=U;W&&(yield W)}function forEachAdjacent(K,C){for(let W=0;W<=K.length;W++)C(W===0?void 0:K[W-1],W===K.length?void 0:K[W])}function forEachWithNeighbors(K,C){for(let W=0;W<K.length;W++)C(W===0?void 0:K[W-1],K[W],W+1===K.length?void 0:K[W+1])}function coalesce(K){return K.filter(C=>!!C)}function coalesceInPlace(K){let C=0;for(let W=0;W<K.length;W++)K[W]&&(K[C]=K[W],C+=1);K.length=C}function isFalsyOrEmpty(K){return!Array.isArray(K)||K.length===0}function isNonEmptyArray$2(K){return Array.isArray(K)&&K.length>0}function distinct(K,C=W=>W){const W=new Set;return K.filter(V=>{const U=C(V);return W.has(U)?!1:(W.add(U),!0)})}function firstOrDefault(K,C){return K.length>0?K[0]:C}function range$2(K,C){let W=typeof C=="number"?K:0;typeof C=="number"?W=K:(W=0,C=K);const V=[];if(W<=C)for(let U=W;U<C;U++)V.push(U);else for(let U=W;U>C;U--)V.push(U);return V}function arrayInsert(K,C,W){const V=K.slice(0,C),U=K.slice(C);return V.concat(W,U)}function pushToStart(K,C){const W=K.indexOf(C);W>-1&&(K.splice(W,1),K.unshift(C))}function pushToEnd(K,C){const W=K.indexOf(C);W>-1&&(K.splice(W,1),K.push(C))}function pushMany(K,C){for(const W of C)K.push(W)}function asArray(K){return Array.isArray(K)?K:[K]}function insertInto(K,C,W){const V=getActualStartIndex(K,C),U=K.length,G=W.length;K.length=U+G;for(let Z=U-1;Z>=V;Z--)K[Z+G]=K[Z];for(let Z=0;Z<G;Z++)K[Z+V]=W[Z]}function splice$1(K,C,W,V){const U=getActualStartIndex(K,C);let G=K.splice(U,W);return G===void 0&&(G=[]),insertInto(K,U,V),G}function getActualStartIndex(K,C){return C<0?Math.max(C+K.length,0):Math.min(C,K.length)}var CompareResult;(function(K){function C(G){return G<0}K.isLessThan=C;function W(G){return G<=0}K.isLessThanOrEqual=W;function V(G){return G>0}K.isGreaterThan=V;function U(G){return G===0}K.isNeitherLessOrGreaterThan=U,K.greaterThan=1,K.lessThan=-1,K.neitherLessOrGreaterThan=0})(CompareResult||(CompareResult={}));function compareBy(K,C){return(W,V)=>C(K(W),K(V))}function tieBreakComparators(...K){return(C,W)=>{for(const V of K){const U=V(C,W);if(!CompareResult.isNeitherLessOrGreaterThan(U))return U}return CompareResult.neitherLessOrGreaterThan}}const numberComparator=(K,C)=>K-C,booleanComparator=(K,C)=>numberComparator(K?1:0,C?1:0);function reverseOrder(K){return(C,W)=>-K(C,W)}class ArrayQueue{constructor(C){this.items=C,this.firstIdx=0,this.lastIdx=this.items.length-1}get length(){return this.lastIdx-this.firstIdx+1}takeWhile(C){let W=this.firstIdx;for(;W<this.items.length&&C(this.items[W]);)W++;const V=W===this.firstIdx?null:this.items.slice(this.firstIdx,W);return this.firstIdx=W,V}takeFromEndWhile(C){let W=this.lastIdx;for(;W>=0&&C(this.items[W]);)W--;const V=W===this.lastIdx?null:this.items.slice(W+1,this.lastIdx+1);return this.lastIdx=W,V}peek(){if(this.length!==0)return this.items[this.firstIdx]}dequeue(){const C=this.items[this.firstIdx];return this.firstIdx++,C}takeCount(C){const W=this.items.slice(this.firstIdx,this.firstIdx+C);return this.firstIdx+=C,W}}class CallbackIterable{constructor(C){this.iterate=C}toArray(){const C=[];return this.iterate(W=>(C.push(W),!0)),C}filter(C){return new CallbackIterable(W=>this.iterate(V=>C(V)?W(V):!0))}map(C){return new CallbackIterable(W=>this.iterate(V=>W(C(V))))}findLast(C){let W;return this.iterate(V=>(C(V)&&(W=V),!0)),W}findLastMaxBy(C){let W,V=!0;return this.iterate(U=>((V||CompareResult.isGreaterThan(C(U,W)))&&(V=!1,W=U),!0)),W}}CallbackIterable.empty=new CallbackIterable(K=>{});function isString$3(K){return typeof K=="string"}function isObject$2(K){return typeof K=="object"&&K!==null&&!Array.isArray(K)&&!(K instanceof RegExp)&&!(K instanceof Date)}function isTypedArray(K){const C=Object.getPrototypeOf(Uint8Array);return typeof K=="object"&&K instanceof C}function isNumber$3(K){return typeof K=="number"&&!isNaN(K)}function isIterable$2(K){return!!K&&typeof K[Symbol.iterator]=="function"}function isBoolean$2(K){return K===!0||K===!1}function isUndefined$2(K){return typeof K>"u"}function isDefined(K){return!isUndefinedOrNull(K)}function isUndefinedOrNull(K){return isUndefined$2(K)||K===null}function assertType(K,C){if(!K)throw new Error(C?`Unexpected type, expected '${C}'`:"Unexpected type")}function assertIsDefined(K){if(isUndefinedOrNull(K))throw new Error("Assertion Failed: argument is undefined or null");return K}function isFunction$2(K){return typeof K=="function"}function validateConstraints(K,C){const W=Math.min(K.length,C.length);for(let V=0;V<W;V++)validateConstraint(K[V],C[V])}function validateConstraint(K,C){if(isString$3(C)){if(typeof K!==C)throw new Error(`argument does not match constraint: typeof ${C}`)}else if(isFunction$2(C)){try{if(K instanceof C)return}catch{}if(!isUndefinedOrNull(K)&&K.constructor===C||C.length===1&&C.call(void 0,K)===!0)return;throw new Error("argument does not match one of these constraints: arg instanceof constraint, arg.constructor === constraint, nor constraint(arg) === true")}}function deepClone(K){if(!K||typeof K!="object"||K instanceof RegExp)return K;const C=Array.isArray(K)?[]:{};return Object.entries(K).forEach(([W,V])=>{C[W]=V&&typeof V=="object"?deepClone(V):V}),C}function deepFreeze(K){if(!K||typeof K!="object")return K;const C=[K];for(;C.length>0;){const W=C.shift();Object.freeze(W);for(const V in W)if(_hasOwnProperty.call(W,V)){const U=W[V];typeof U=="object"&&!Object.isFrozen(U)&&!isTypedArray(U)&&C.push(U)}}return K}const _hasOwnProperty=Object.prototype.hasOwnProperty;function cloneAndChange(K,C){return _cloneAndChange(K,C,new Set)}function _cloneAndChange(K,C,W){if(isUndefinedOrNull(K))return K;const V=C(K);if(typeof V<"u")return V;if(Array.isArray(K)){const U=[];for(const G of K)U.push(_cloneAndChange(G,C,W));return U}if(isObject$2(K)){if(W.has(K))throw new Error("Cannot clone recursive data-structure");W.add(K);const U={};for(const G in K)_hasOwnProperty.call(K,G)&&(U[G]=_cloneAndChange(K[G],C,W));return W.delete(K),U}return K}function mixin(K,C,W=!0){return isObject$2(K)?(isObject$2(C)&&Object.keys(C).forEach(V=>{V in K?W&&(isObject$2(K[V])&&isObject$2(C[V])?mixin(K[V],C[V],W):K[V]=C[V]):K[V]=C[V]}),K):C}function equals$4(K,C){if(K===C)return!0;if(K==null||C===null||C===void 0||typeof K!=typeof C||typeof K!="object"||Array.isArray(K)!==Array.isArray(C))return!1;let W,V;if(Array.isArray(K)){if(K.length!==C.length)return!1;for(W=0;W<K.length;W++)if(!equals$4(K[W],C[W]))return!1}else{const U=[];for(V in K)U.push(V);U.sort();const G=[];for(V in C)G.push(V);if(G.sort(),!equals$4(U,G))return!1;for(W=0;W<U.length;W++)if(!equals$4(K[U[W]],C[U[W]]))return!1}return!0}function getAllPropertyNames(K){let C=[];for(;Object.prototype!==K;)C=C.concat(Object.getOwnPropertyNames(K)),K=Object.getPrototypeOf(K);return C}function getAllMethodNames(K){const C=[];for(const W of getAllPropertyNames(K))typeof K[W]=="function"&&C.push(W);return C}function createProxyObject$1(K,C){const W=U=>function(){const G=Array.prototype.slice.call(arguments,0);return C(U,G)},V={};for(const U of K)V[U]=W(U);return V}globalThis&&globalThis.__awaiter;let isPseudo=typeof document<"u"&&document.location&&document.location.hash.indexOf("pseudo=true")>=0;function _format$1(K,C){let W;return C.length===0?W=K:W=K.replace(/\{(\d+)\}/g,(V,U)=>{const G=U[0],Z=C[G];let X=V;return typeof Z=="string"?X=Z:(typeof Z=="number"||typeof Z=="boolean"||Z===void 0||Z===null)&&(X=String(Z)),X}),isPseudo&&(W="［"+W.replace(/[aouei]/g,"$&$&")+"］"),W}function localize(K,C,...W){return _format$1(C,W)}function getConfiguredDefaultLocale(K){}var _a$4;const LANGUAGE_DEFAULT="en";let _isWindows=!1,_isMacintosh=!1,_isLinux=!1,_isNative=!1,_isWeb=!1,_isIOS=!1,_isMobile=!1,_locale,_language=LANGUAGE_DEFAULT,_platformLocale=LANGUAGE_DEFAULT,_translationsConfigFile,_userAgent;const globals=typeof self=="object"?self:typeof global=="object"?global:{};let nodeProcess;typeof globals.vscode<"u"&&typeof globals.vscode.process<"u"?nodeProcess=globals.vscode.process:typeof process<"u"&&(nodeProcess=process);const isElectronProcess=typeof((_a$4=nodeProcess==null?void 0:nodeProcess.versions)===null||_a$4===void 0?void 0:_a$4.electron)=="string",isElectronRenderer=isElectronProcess&&(nodeProcess==null?void 0:nodeProcess.type)==="renderer";if(typeof navigator=="object"&&!isElectronRenderer)_userAgent=navigator.userAgent,_isWindows=_userAgent.indexOf("Windows")>=0,_isMacintosh=_userAgent.indexOf("Macintosh")>=0,_isIOS=(_userAgent.indexOf("Macintosh")>=0||_userAgent.indexOf("iPad")>=0||_userAgent.indexOf("iPhone")>=0)&&!!navigator.maxTouchPoints&&navigator.maxTouchPoints>0,_isLinux=_userAgent.indexOf("Linux")>=0,_isMobile=(_userAgent==null?void 0:_userAgent.indexOf("Mobi"))>=0,_isWeb=!0,localize({key:"ensureLoaderPluginIsLoaded",comment:["{Locked}"]},"_"),_locale=LANGUAGE_DEFAULT,_language=_locale,_platformLocale=navigator.language;else if(typeof nodeProcess=="object"){_isWindows=nodeProcess.platform==="win32",_isMacintosh=nodeProcess.platform==="darwin",_isLinux=nodeProcess.platform==="linux",_isLinux&&nodeProcess.env.SNAP&&nodeProcess.env.SNAP_REVISION,nodeProcess.env.CI||nodeProcess.env.BUILD_ARTIFACTSTAGINGDIRECTORY,_locale=LANGUAGE_DEFAULT,_language=LANGUAGE_DEFAULT;const K=nodeProcess.env.VSCODE_NLS_CONFIG;if(K)try{const C=JSON.parse(K),W=C.availableLanguages["*"];_locale=C.locale,_platformLocale=C.osLocale,_language=W||LANGUAGE_DEFAULT,_translationsConfigFile=C._translationsConfigFile}catch{}_isNative=!0}else console.error("Unable to resolve platform.");const isWindows=_isWindows,isMacintosh=_isMacintosh,isLinux=_isLinux,isNative=_isNative,isWeb=_isWeb,isWebWorker=_isWeb&&typeof globals.importScripts=="function",isIOS=_isIOS,isMobile=_isMobile,userAgent$1=_userAgent,language$1=_language,setTimeout0IsFaster=typeof globals.postMessage=="function"&&!globals.importScripts,setTimeout0=(()=>{if(setTimeout0IsFaster){const K=[];globals.addEventListener("message",W=>{if(W.data&&W.data.vscodeScheduleAsyncWork)for(let V=0,U=K.length;V<U;V++){const G=K[V];if(G.id===W.data.vscodeScheduleAsyncWork){K.splice(V,1),G.callback();return}}});let C=0;return W=>{const V=++C;K.push({id:V,callback:W}),globals.postMessage({vscodeScheduleAsyncWork:V},"*")}}return K=>setTimeout(K)})(),OS=_isMacintosh||_isIOS?2:_isWindows?1:3;let _isLittleEndian=!0,_isLittleEndianComputed=!1;function isLittleEndian(){if(!_isLittleEndianComputed){_isLittleEndianComputed=!0;const K=new Uint8Array(2);K[0]=1,K[1]=2,_isLittleEndian=new Uint16Array(K.buffer)[0]===512+1}return _isLittleEndian}const isChrome$1=!!(userAgent$1&&userAgent$1.indexOf("Chrome")>=0),isFirefox$1=!!(userAgent$1&&userAgent$1.indexOf("Firefox")>=0),isSafari$1=!!(!isChrome$1&&userAgent$1&&userAgent$1.indexOf("Safari")>=0),isEdge=!!(userAgent$1&&userAgent$1.indexOf("Edg/")>=0);userAgent$1&&userAgent$1.indexOf("Android")>=0;const EDITOR_MODEL_DEFAULTS={tabSize:4,indentSize:4,insertSpaces:!0,detectIndentation:!0,trimAutoWhitespace:!0,largeFileOptimizations:!0,bracketPairColorizationOptions:{enabled:!0,independentColorPoolPerBracketType:!1}};var Iterable;(function(K){function C(le){return le&&typeof le=="object"&&typeof le[Symbol.iterator]=="function"}K.is=C;const W=Object.freeze([]);function V(){return W}K.empty=V;function*U(le){yield le}K.single=U;function G(le){return C(le)?le:U(le)}K.wrap=G;function Z(le){return le||W}K.from=Z;function*X(le){for(let ce=le.length-1;ce>=0;ce--)yield le[ce]}K.reverse=X;function Q(le){return!le||le[Symbol.iterator]().next().done===!0}K.isEmpty=Q;function J(le){return le[Symbol.iterator]().next().value}K.first=J;function ee(le,ce){for(const de of le)if(ce(de))return!0;return!1}K.some=ee;function te(le,ce){for(const de of le)if(ce(de))return de}K.find=te;function*ie(le,ce){for(const de of le)ce(de)&&(yield de)}K.filter=ie;function*ne(le,ce){let de=0;for(const ue of le)yield ce(ue,de++)}K.map=ne;function*oe(...le){for(const ce of le)for(const de of ce)yield de}K.concat=oe;function re(le,ce,de){let ue=de;for(const ge of le)ue=ce(ue,ge);return ue}K.reduce=re;function*ae(le,ce,de=le.length){for(ce<0&&(ce+=le.length),de<0?de+=le.length:de>le.length&&(de=le.length);ce<de;ce++)yield le[ce]}K.slice=ae;function se(le,ce=Number.POSITIVE_INFINITY){const de=[];if(ce===0)return[de,le];const ue=le[Symbol.iterator]();for(let ge=0;ge<ce;ge++){const he=ue.next();if(he.done)return[de,K.empty()];de.push(he.value)}return[de,{[Symbol.iterator](){return ue}}]}K.consume=se})(Iterable||(Iterable={}));let Node$2=class Zt{constructor(C){this.element=C,this.next=Zt.Undefined,this.prev=Zt.Undefined}};Node$2.Undefined=new Node$2(void 0);class LinkedList{constructor(){this._first=Node$2.Undefined,this._last=Node$2.Undefined,this._size=0}get size(){return this._size}isEmpty(){return this._first===Node$2.Undefined}clear(){let C=this._first;for(;C!==Node$2.Undefined;){const W=C.next;C.prev=Node$2.Undefined,C.next=Node$2.Undefined,C=W}this._first=Node$2.Undefined,this._last=Node$2.Undefined,this._size=0}unshift(C){return this._insert(C,!1)}push(C){return this._insert(C,!0)}_insert(C,W){const V=new Node$2(C);if(this._first===Node$2.Undefined)this._first=V,this._last=V;else if(W){const G=this._last;this._last=V,V.prev=G,G.next=V}else{const G=this._first;this._first=V,V.next=G,G.prev=V}this._size+=1;let U=!1;return()=>{U||(U=!0,this._remove(V))}}shift(){if(this._first!==Node$2.Undefined){const C=this._first.element;return this._remove(this._first),C}}pop(){if(this._last!==Node$2.Undefined){const C=this._last.element;return this._remove(this._last),C}}_remove(C){if(C.prev!==Node$2.Undefined&&C.next!==Node$2.Undefined){const W=C.prev;W.next=C.next,C.next.prev=W}else C.prev===Node$2.Undefined&&C.next===Node$2.Undefined?(this._first=Node$2.Undefined,this._last=Node$2.Undefined):C.next===Node$2.Undefined?(this._last=this._last.prev,this._last.next=Node$2.Undefined):C.prev===Node$2.Undefined&&(this._first=this._first.next,this._first.prev=Node$2.Undefined);this._size-=1}*[Symbol.iterator](){let C=this._first;for(;C!==Node$2.Undefined;)yield C.element,C=C.next}}const USUAL_WORD_SEPARATORS="`~!@#$%^&*()-=+[{]}\\|;:'\",.<>/?";function createWordRegExp(K=""){let C="(-?\\d*\\.\\d\\w*)|([^";for(const W of USUAL_WORD_SEPARATORS)K.indexOf(W)>=0||(C+="\\"+W);return C+="\\s]+)",new RegExp(C,"g")}const DEFAULT_WORD_REGEXP=createWordRegExp();function ensureValidWordDefinition(K){let C=DEFAULT_WORD_REGEXP;if(K&&K instanceof RegExp)if(K.global)C=K;else{let W="g";K.ignoreCase&&(W+="i"),K.multiline&&(W+="m"),K.unicode&&(W+="u"),C=new RegExp(K.source,W)}return C.lastIndex=0,C}const _defaultConfig=new LinkedList;_defaultConfig.unshift({maxLen:1e3,windowSize:15,timeBudget:150});function getWordAtText(K,C,W,V,U){if(U||(U=Iterable.first(_defaultConfig)),W.length>U.maxLen){let J=K-U.maxLen/2;return J<0?J=0:V+=J,W=W.substring(J,K+U.maxLen/2),getWordAtText(K,C,W,V,U)}const G=Date.now(),Z=K-1-V;let X=-1,Q=null;for(let J=1;!(Date.now()-G>=U.timeBudget);J++){const ee=Z-U.windowSize*J;C.lastIndex=Math.max(0,ee);const te=_findRegexMatchEnclosingPosition(C,W,Z,X);if(!te&&Q||(Q=te,ee<=0))break;X=ee}if(Q){const J={word:Q[0],startColumn:V+1+Q.index,endColumn:V+1+Q.index+Q[0].length};return C.lastIndex=0,J}return null}function _findRegexMatchEnclosingPosition(K,C,W,V){let U;for(;U=K.exec(C);){const G=U.index||0;if(G<=W&&K.lastIndex>=W)return U;if(V>0&&G>V)return null}return null}const MINIMAP_GUTTER_WIDTH=8;class ConfigurationChangedEvent{constructor(C){this._values=C}hasChanged(C){return this._values[C]}}class ComputeOptionsMemory{constructor(){this.stableMinimapLayoutInput=null,this.stableFitMaxMinimapScale=0,this.stableFitRemainingWidth=0}}class BaseEditorOption{constructor(C,W,V,U){this.id=C,this.name=W,this.defaultValue=V,this.schema=U}applyUpdate(C,W){return applyUpdate(C,W)}compute(C,W,V){return V}}class ApplyUpdateResult{constructor(C,W){this.newValue=C,this.didChange=W}}function applyUpdate(K,C){if(typeof K!="object"||typeof C!="object"||!K||!C)return new ApplyUpdateResult(C,K!==C);if(Array.isArray(K)||Array.isArray(C)){const V=Array.isArray(K)&&Array.isArray(C)&&equals$5(K,C);return new ApplyUpdateResult(C,!V)}let W=!1;for(const V in C)if(C.hasOwnProperty(V)){const U=applyUpdate(K[V],C[V]);U.didChange&&(K[V]=U.newValue,W=!0)}return new ApplyUpdateResult(K,W)}class ComputedEditorOption{constructor(C){this.schema=void 0,this.id=C,this.name="_never_",this.defaultValue=void 0}applyUpdate(C,W){return applyUpdate(C,W)}validate(C){return this.defaultValue}}class SimpleEditorOption{constructor(C,W,V,U){this.id=C,this.name=W,this.defaultValue=V,this.schema=U}applyUpdate(C,W){return applyUpdate(C,W)}validate(C){return typeof C>"u"?this.defaultValue:C}compute(C,W,V){return V}}function boolean$1(K,C){return typeof K>"u"?C:K==="false"?!1:!!K}class EditorBooleanOption extends SimpleEditorOption{constructor(C,W,V,U=void 0){typeof U<"u"&&(U.type="boolean",U.default=V),super(C,W,V,U)}validate(C){return boolean$1(C,this.defaultValue)}}function clampedInt(K,C,W,V){if(typeof K>"u")return C;let U=parseInt(K,10);return isNaN(U)?C:(U=Math.max(W,U),U=Math.min(V,U),U|0)}class EditorIntOption extends SimpleEditorOption{static clampedInt(C,W,V,U){return clampedInt(C,W,V,U)}constructor(C,W,V,U,G,Z=void 0){typeof Z<"u"&&(Z.type="integer",Z.default=V,Z.minimum=U,Z.maximum=G),super(C,W,V,Z),this.minimum=U,this.maximum=G}validate(C){return EditorIntOption.clampedInt(C,this.defaultValue,this.minimum,this.maximum)}}function clampedFloat(K,C,W,V){if(typeof K>"u")return C;const U=EditorFloatOption.float(K,C);return EditorFloatOption.clamp(U,W,V)}class EditorFloatOption extends SimpleEditorOption{static clamp(C,W,V){return C<W?W:C>V?V:C}static float(C,W){if(typeof C=="number")return C;if(typeof C>"u")return W;const V=parseFloat(C);return isNaN(V)?W:V}constructor(C,W,V,U,G){typeof G<"u"&&(G.type="number",G.default=V),super(C,W,V,G),this.validationFn=U}validate(C){return this.validationFn(EditorFloatOption.float(C,this.defaultValue))}}class EditorStringOption extends SimpleEditorOption{static string(C,W){return typeof C!="string"?W:C}constructor(C,W,V,U=void 0){typeof U<"u"&&(U.type="string",U.default=V),super(C,W,V,U)}validate(C){return EditorStringOption.string(C,this.defaultValue)}}function stringSet(K,C,W,V){return typeof K!="string"?C:V&&K in V?V[K]:W.indexOf(K)===-1?C:K}class EditorStringEnumOption extends SimpleEditorOption{constructor(C,W,V,U,G=void 0){typeof G<"u"&&(G.type="string",G.enum=U,G.default=V),super(C,W,V,G),this._allowedValues=U}validate(C){return stringSet(C,this.defaultValue,this._allowedValues)}}class EditorEnumOption extends BaseEditorOption{constructor(C,W,V,U,G,Z,X=void 0){typeof X<"u"&&(X.type="string",X.enum=G,X.default=U),super(C,W,V,X),this._allowedValues=G,this._convert=Z}validate(C){return typeof C!="string"?this.defaultValue:this._allowedValues.indexOf(C)===-1?this.defaultValue:this._convert(C)}}function _autoIndentFromString(K){switch(K){case"none":return 0;case"keep":return 1;case"brackets":return 2;case"advanced":return 3;case"full":return 4}}class EditorAccessibilitySupport extends BaseEditorOption{constructor(){super(2,"accessibilitySupport",0,{type:"string",enum:["auto","on","off"],enumDescriptions:[localize("accessibilitySupport.auto","Use platform APIs to detect when a Screen Reader is attached"),localize("accessibilitySupport.on","Optimize for usage with a Screen Reader"),localize("accessibilitySupport.off","Assume a screen reader is not attached")],default:"auto",tags:["accessibility"],description:localize("accessibilitySupport","Controls if the UI should run in a mode where it is optimized for screen readers.")})}validate(C){switch(C){case"auto":return 0;case"off":return 1;case"on":return 2}return this.defaultValue}compute(C,W,V){return V===0?C.accessibilitySupport:V}}class EditorComments extends BaseEditorOption{constructor(){const C={insertSpace:!0,ignoreEmptyLines:!0};super(23,"comments",C,{"editor.comments.insertSpace":{type:"boolean",default:C.insertSpace,description:localize("comments.insertSpace","Controls whether a space character is inserted when commenting.")},"editor.comments.ignoreEmptyLines":{type:"boolean",default:C.ignoreEmptyLines,description:localize("comments.ignoreEmptyLines","Controls if empty lines should be ignored with toggle, add or remove actions for line comments.")}})}validate(C){if(!C||typeof C!="object")return this.defaultValue;const W=C;return{insertSpace:boolean$1(W.insertSpace,this.defaultValue.insertSpace),ignoreEmptyLines:boolean$1(W.ignoreEmptyLines,this.defaultValue.ignoreEmptyLines)}}}function _cursorBlinkingStyleFromString(K){switch(K){case"blink":return 1;case"smooth":return 2;case"phase":return 3;case"expand":return 4;case"solid":return 5}}var TextEditorCursorStyle$1;(function(K){K[K.Line=1]="Line",K[K.Block=2]="Block",K[K.Underline=3]="Underline",K[K.LineThin=4]="LineThin",K[K.BlockOutline=5]="BlockOutline",K[K.UnderlineThin=6]="UnderlineThin"})(TextEditorCursorStyle$1||(TextEditorCursorStyle$1={}));function _cursorStyleFromString(K){switch(K){case"line":return TextEditorCursorStyle$1.Line;case"block":return TextEditorCursorStyle$1.Block;case"underline":return TextEditorCursorStyle$1.Underline;case"line-thin":return TextEditorCursorStyle$1.LineThin;case"block-outline":return TextEditorCursorStyle$1.BlockOutline;case"underline-thin":return TextEditorCursorStyle$1.UnderlineThin}}class EditorClassName extends ComputedEditorOption{constructor(){super(140)}compute(C,W,V){const U=["monaco-editor"];return W.get(39)&&U.push(W.get(39)),C.extraEditorClassName&&U.push(C.extraEditorClassName),W.get(73)==="default"?U.push("mouse-default"):W.get(73)==="copy"&&U.push("mouse-copy"),W.get(110)&&U.push("showUnused"),W.get(138)&&U.push("showDeprecated"),U.join(" ")}}class EditorEmptySelectionClipboard extends EditorBooleanOption{constructor(){super(37,"emptySelectionClipboard",!0,{description:localize("emptySelectionClipboard","Controls whether copying without a selection copies the current line.")})}compute(C,W,V){return V&&C.emptySelectionClipboard}}class EditorFind extends BaseEditorOption{constructor(){const C={cursorMoveOnType:!0,seedSearchStringFromSelection:"always",autoFindInSelection:"never",globalFindClipboard:!1,addExtraSpaceOnTop:!0,loop:!0};super(41,"find",C,{"editor.find.cursorMoveOnType":{type:"boolean",default:C.cursorMoveOnType,description:localize("find.cursorMoveOnType","Controls whether the cursor should jump to find matches while typing.")},"editor.find.seedSearchStringFromSelection":{type:"string",enum:["never","always","selection"],default:C.seedSearchStringFromSelection,enumDescriptions:[localize("editor.find.seedSearchStringFromSelection.never","Never seed search string from the editor selection."),localize("editor.find.seedSearchStringFromSelection.always","Always seed search string from the editor selection, including word at cursor position."),localize("editor.find.seedSearchStringFromSelection.selection","Only seed search string from the editor selection.")],description:localize("find.seedSearchStringFromSelection","Controls whether the search string in the Find Widget is seeded from the editor selection.")},"editor.find.autoFindInSelection":{type:"string",enum:["never","always","multiline"],default:C.autoFindInSelection,enumDescriptions:[localize("editor.find.autoFindInSelection.never","Never turn on Find in Selection automatically (default)."),localize("editor.find.autoFindInSelection.always","Always turn on Find in Selection automatically."),localize("editor.find.autoFindInSelection.multiline","Turn on Find in Selection automatically when multiple lines of content are selected.")],description:localize("find.autoFindInSelection","Controls the condition for turning on Find in Selection automatically.")},"editor.find.globalFindClipboard":{type:"boolean",default:C.globalFindClipboard,description:localize("find.globalFindClipboard","Controls whether the Find Widget should read or modify the shared find clipboard on macOS."),included:isMacintosh},"editor.find.addExtraSpaceOnTop":{type:"boolean",default:C.addExtraSpaceOnTop,description:localize("find.addExtraSpaceOnTop","Controls whether the Find Widget should add extra lines on top of the editor. When true, you can scroll beyond the first line when the Find Widget is visible.")},"editor.find.loop":{type:"boolean",default:C.loop,description:localize("find.loop","Controls whether the search automatically restarts from the beginning (or the end) when no further matches can be found.")}})}validate(C){if(!C||typeof C!="object")return this.defaultValue;const W=C;return{cursorMoveOnType:boolean$1(W.cursorMoveOnType,this.defaultValue.cursorMoveOnType),seedSearchStringFromSelection:typeof C.seedSearchStringFromSelection=="boolean"?C.seedSearchStringFromSelection?"always":"never":stringSet(W.seedSearchStringFromSelection,this.defaultValue.seedSearchStringFromSelection,["never","always","selection"]),autoFindInSelection:typeof C.autoFindInSelection=="boolean"?C.autoFindInSelection?"always":"never":stringSet(W.autoFindInSelection,this.defaultValue.autoFindInSelection,["never","always","multiline"]),globalFindClipboard:boolean$1(W.globalFindClipboard,this.defaultValue.globalFindClipboard),addExtraSpaceOnTop:boolean$1(W.addExtraSpaceOnTop,this.defaultValue.addExtraSpaceOnTop),loop:boolean$1(W.loop,this.defaultValue.loop)}}}class EditorFontLigatures extends BaseEditorOption{constructor(){super(51,"fontLigatures",EditorFontLigatures.OFF,{anyOf:[{type:"boolean",description:localize("fontLigatures","Enables/Disables font ligatures ('calt' and 'liga' font features). Change this to a string for fine-grained control of the 'font-feature-settings' CSS property.")},{type:"string",description:localize("fontFeatureSettings","Explicit 'font-feature-settings' CSS property. A boolean can be passed instead if one only needs to turn on/off ligatures.")}],description:localize("fontLigaturesGeneral","Configures font ligatures or font features. Can be either a boolean to enable/disable ligatures or a string for the value of the CSS 'font-feature-settings' property."),default:!1})}validate(C){return typeof C>"u"?this.defaultValue:typeof C=="string"?C==="false"?EditorFontLigatures.OFF:C==="true"?EditorFontLigatures.ON:C:C?EditorFontLigatures.ON:EditorFontLigatures.OFF}}EditorFontLigatures.OFF='"liga" off, "calt" off';EditorFontLigatures.ON='"liga" on, "calt" on';class EditorFontVariations extends BaseEditorOption{constructor(){super(54,"fontVariations",EditorFontVariations.OFF,{anyOf:[{type:"boolean",description:localize("fontVariations","Enables/Disables the translation from font-weight to font-variation-settings. Change this to a string for fine-grained control of the 'font-variation-settings' CSS property.")},{type:"string",description:localize("fontVariationSettings","Explicit 'font-variation-settings' CSS property. A boolean can be passed instead if one only needs to translate font-weight to font-variation-settings.")}],description:localize("fontVariationsGeneral","Configures font variations. Can be either a boolean to enable/disable the translation from font-weight to font-variation-settings or a string for the value of the CSS 'font-variation-settings' property."),default:!1})}validate(C){return typeof C>"u"?this.defaultValue:typeof C=="string"?C==="false"?EditorFontVariations.OFF:C==="true"?EditorFontVariations.TRANSLATE:C:C?EditorFontVariations.TRANSLATE:EditorFontVariations.OFF}compute(C,W,V){return C.fontInfo.fontVariationSettings}}EditorFontVariations.OFF="normal";EditorFontVariations.TRANSLATE="translate";class EditorFontInfo extends ComputedEditorOption{constructor(){super(50)}compute(C,W,V){return C.fontInfo}}class EditorFontSize extends SimpleEditorOption{constructor(){super(52,"fontSize",EDITOR_FONT_DEFAULTS.fontSize,{type:"number",minimum:6,maximum:100,default:EDITOR_FONT_DEFAULTS.fontSize,description:localize("fontSize","Controls the font size in pixels.")})}validate(C){const W=EditorFloatOption.float(C,this.defaultValue);return W===0?EDITOR_FONT_DEFAULTS.fontSize:EditorFloatOption.clamp(W,6,100)}compute(C,W,V){return C.fontInfo.fontSize}}class EditorFontWeight extends BaseEditorOption{constructor(){super(53,"fontWeight",EDITOR_FONT_DEFAULTS.fontWeight,{anyOf:[{type:"number",minimum:EditorFontWeight.MINIMUM_VALUE,maximum:EditorFontWeight.MAXIMUM_VALUE,errorMessage:localize("fontWeightErrorMessage",'Only "normal" and "bold" keywords or numbers between 1 and 1000 are allowed.')},{type:"string",pattern:"^(normal|bold|1000|[1-9][0-9]{0,2})$"},{enum:EditorFontWeight.SUGGESTION_VALUES}],default:EDITOR_FONT_DEFAULTS.fontWeight,description:localize("fontWeight",'Controls the font weight. Accepts "normal" and "bold" keywords or numbers between 1 and 1000.')})}validate(C){return C==="normal"||C==="bold"?C:String(EditorIntOption.clampedInt(C,EDITOR_FONT_DEFAULTS.fontWeight,EditorFontWeight.MINIMUM_VALUE,EditorFontWeight.MAXIMUM_VALUE))}}EditorFontWeight.SUGGESTION_VALUES=["normal","bold","100","200","300","400","500","600","700","800","900"];EditorFontWeight.MINIMUM_VALUE=1;EditorFontWeight.MAXIMUM_VALUE=1e3;class EditorGoToLocation extends BaseEditorOption{constructor(){const C={multiple:"peek",multipleDefinitions:"peek",multipleTypeDefinitions:"peek",multipleDeclarations:"peek",multipleImplementations:"peek",multipleReferences:"peek",alternativeDefinitionCommand:"editor.action.goToReferences",alternativeTypeDefinitionCommand:"editor.action.goToReferences",alternativeDeclarationCommand:"editor.action.goToReferences",alternativeImplementationCommand:"",alternativeReferenceCommand:""},W={type:"string",enum:["peek","gotoAndPeek","goto"],default:C.multiple,enumDescriptions:[localize("editor.gotoLocation.multiple.peek","Show Peek view of the results (default)"),localize("editor.gotoLocation.multiple.gotoAndPeek","Go to the primary result and show a Peek view"),localize("editor.gotoLocation.multiple.goto","Go to the primary result and enable Peek-less navigation to others")]},V=["","editor.action.referenceSearch.trigger","editor.action.goToReferences","editor.action.peekImplementation","editor.action.goToImplementation","editor.action.peekTypeDefinition","editor.action.goToTypeDefinition","editor.action.peekDeclaration","editor.action.revealDeclaration","editor.action.peekDefinition","editor.action.revealDefinitionAside","editor.action.revealDefinition"];super(58,"gotoLocation",C,{"editor.gotoLocation.multiple":{deprecationMessage:localize("editor.gotoLocation.multiple.deprecated","This setting is deprecated, please use separate settings like 'editor.editor.gotoLocation.multipleDefinitions' or 'editor.editor.gotoLocation.multipleImplementations' instead.")},"editor.gotoLocation.multipleDefinitions":Object.assign({description:localize("editor.editor.gotoLocation.multipleDefinitions","Controls the behavior the 'Go to Definition'-command when multiple target locations exist.")},W),"editor.gotoLocation.multipleTypeDefinitions":Object.assign({description:localize("editor.editor.gotoLocation.multipleTypeDefinitions","Controls the behavior the 'Go to Type Definition'-command when multiple target locations exist.")},W),"editor.gotoLocation.multipleDeclarations":Object.assign({description:localize("editor.editor.gotoLocation.multipleDeclarations","Controls the behavior the 'Go to Declaration'-command when multiple target locations exist.")},W),"editor.gotoLocation.multipleImplementations":Object.assign({description:localize("editor.editor.gotoLocation.multipleImplemenattions","Controls the behavior the 'Go to Implementations'-command when multiple target locations exist.")},W),"editor.gotoLocation.multipleReferences":Object.assign({description:localize("editor.editor.gotoLocation.multipleReferences","Controls the behavior the 'Go to References'-command when multiple target locations exist.")},W),"editor.gotoLocation.alternativeDefinitionCommand":{type:"string",default:C.alternativeDefinitionCommand,enum:V,description:localize("alternativeDefinitionCommand","Alternative command id that is being executed when the result of 'Go to Definition' is the current location.")},"editor.gotoLocation.alternativeTypeDefinitionCommand":{type:"string",default:C.alternativeTypeDefinitionCommand,enum:V,description:localize("alternativeTypeDefinitionCommand","Alternative command id that is being executed when the result of 'Go to Type Definition' is the current location.")},"editor.gotoLocation.alternativeDeclarationCommand":{type:"string",default:C.alternativeDeclarationCommand,enum:V,description:localize("alternativeDeclarationCommand","Alternative command id that is being executed when the result of 'Go to Declaration' is the current location.")},"editor.gotoLocation.alternativeImplementationCommand":{type:"string",default:C.alternativeImplementationCommand,enum:V,description:localize("alternativeImplementationCommand","Alternative command id that is being executed when the result of 'Go to Implementation' is the current location.")},"editor.gotoLocation.alternativeReferenceCommand":{type:"string",default:C.alternativeReferenceCommand,enum:V,description:localize("alternativeReferenceCommand","Alternative command id that is being executed when the result of 'Go to Reference' is the current location.")}})}validate(C){var W,V,U,G,Z;if(!C||typeof C!="object")return this.defaultValue;const X=C;return{multiple:stringSet(X.multiple,this.defaultValue.multiple,["peek","gotoAndPeek","goto"]),multipleDefinitions:(W=X.multipleDefinitions)!==null&&W!==void 0?W:stringSet(X.multipleDefinitions,"peek",["peek","gotoAndPeek","goto"]),multipleTypeDefinitions:(V=X.multipleTypeDefinitions)!==null&&V!==void 0?V:stringSet(X.multipleTypeDefinitions,"peek",["peek","gotoAndPeek","goto"]),multipleDeclarations:(U=X.multipleDeclarations)!==null&&U!==void 0?U:stringSet(X.multipleDeclarations,"peek",["peek","gotoAndPeek","goto"]),multipleImplementations:(G=X.multipleImplementations)!==null&&G!==void 0?G:stringSet(X.multipleImplementations,"peek",["peek","gotoAndPeek","goto"]),multipleReferences:(Z=X.multipleReferences)!==null&&Z!==void 0?Z:stringSet(X.multipleReferences,"peek",["peek","gotoAndPeek","goto"]),alternativeDefinitionCommand:EditorStringOption.string(X.alternativeDefinitionCommand,this.defaultValue.alternativeDefinitionCommand),alternativeTypeDefinitionCommand:EditorStringOption.string(X.alternativeTypeDefinitionCommand,this.defaultValue.alternativeTypeDefinitionCommand),alternativeDeclarationCommand:EditorStringOption.string(X.alternativeDeclarationCommand,this.defaultValue.alternativeDeclarationCommand),alternativeImplementationCommand:EditorStringOption.string(X.alternativeImplementationCommand,this.defaultValue.alternativeImplementationCommand),alternativeReferenceCommand:EditorStringOption.string(X.alternativeReferenceCommand,this.defaultValue.alternativeReferenceCommand)}}}class EditorHover extends BaseEditorOption{constructor(){const C={enabled:!0,delay:300,hidingDelay:300,sticky:!0,above:!0};super(60,"hover",C,{"editor.hover.enabled":{type:"boolean",default:C.enabled,description:localize("hover.enabled","Controls whether the hover is shown.")},"editor.hover.delay":{type:"number",default:C.delay,minimum:0,maximum:1e4,description:localize("hover.delay","Controls the delay in milliseconds after which the hover is shown.")},"editor.hover.sticky":{type:"boolean",default:C.sticky,description:localize("hover.sticky","Controls whether the hover should remain visible when mouse is moved over it.")},"editor.hover.hidingDelay":{type:"integer",minimum:0,default:C.hidingDelay,description:localize("hover.hidingDelay","Controls the delay in milliseconds after thich the hover is hidden. Requires `editor.hover.sticky` to be enabled.")},"editor.hover.above":{type:"boolean",default:C.above,description:localize("hover.above","Prefer showing hovers above the line, if there's space.")}})}validate(C){if(!C||typeof C!="object")return this.defaultValue;const W=C;return{enabled:boolean$1(W.enabled,this.defaultValue.enabled),delay:EditorIntOption.clampedInt(W.delay,this.defaultValue.delay,0,1e4),sticky:boolean$1(W.sticky,this.defaultValue.sticky),hidingDelay:EditorIntOption.clampedInt(W.hidingDelay,this.defaultValue.hidingDelay,0,6e5),above:boolean$1(W.above,this.defaultValue.above)}}}class EditorLayoutInfoComputer extends ComputedEditorOption{constructor(){super(143)}compute(C,W,V){return EditorLayoutInfoComputer.computeLayout(W,{memory:C.memory,outerWidth:C.outerWidth,outerHeight:C.outerHeight,isDominatedByLongLines:C.isDominatedByLongLines,lineHeight:C.fontInfo.lineHeight,viewLineCount:C.viewLineCount,lineNumbersDigitCount:C.lineNumbersDigitCount,typicalHalfwidthCharacterWidth:C.fontInfo.typicalHalfwidthCharacterWidth,maxDigitWidth:C.fontInfo.maxDigitWidth,pixelRatio:C.pixelRatio,glyphMarginDecorationLaneCount:C.glyphMarginDecorationLaneCount})}static computeContainedMinimapLineCount(C){const W=C.height/C.lineHeight,V=Math.floor(C.paddingTop/C.lineHeight);let U=Math.floor(C.paddingBottom/C.lineHeight);C.scrollBeyondLastLine&&(U=Math.max(U,W-1));const G=(V+C.viewLineCount+U)/(C.pixelRatio*C.height),Z=Math.floor(C.viewLineCount/G);return{typicalViewportLineCount:W,extraLinesBeforeFirstLine:V,extraLinesBeyondLastLine:U,desiredRatio:G,minimapLineCount:Z}}static _computeMinimapLayout(C,W){const V=C.outerWidth,U=C.outerHeight,G=C.pixelRatio;if(!C.minimap.enabled)return{renderMinimap:0,minimapLeft:0,minimapWidth:0,minimapHeightIsEditorHeight:!1,minimapIsSampling:!1,minimapScale:1,minimapLineHeight:1,minimapCanvasInnerWidth:0,minimapCanvasInnerHeight:Math.floor(G*U),minimapCanvasOuterWidth:0,minimapCanvasOuterHeight:U};const Z=W.stableMinimapLayoutInput,X=Z&&C.outerHeight===Z.outerHeight&&C.lineHeight===Z.lineHeight&&C.typicalHalfwidthCharacterWidth===Z.typicalHalfwidthCharacterWidth&&C.pixelRatio===Z.pixelRatio&&C.scrollBeyondLastLine===Z.scrollBeyondLastLine&&C.paddingTop===Z.paddingTop&&C.paddingBottom===Z.paddingBottom&&C.minimap.enabled===Z.minimap.enabled&&C.minimap.side===Z.minimap.side&&C.minimap.size===Z.minimap.size&&C.minimap.showSlider===Z.minimap.showSlider&&C.minimap.renderCharacters===Z.minimap.renderCharacters&&C.minimap.maxColumn===Z.minimap.maxColumn&&C.minimap.scale===Z.minimap.scale&&C.verticalScrollbarWidth===Z.verticalScrollbarWidth&&C.isViewportWrapping===Z.isViewportWrapping,Q=C.lineHeight,J=C.typicalHalfwidthCharacterWidth,ee=C.scrollBeyondLastLine,te=C.minimap.renderCharacters;let ie=G>=2?Math.round(C.minimap.scale*2):C.minimap.scale;const ne=C.minimap.maxColumn,oe=C.minimap.size,re=C.minimap.side,ae=C.verticalScrollbarWidth,se=C.viewLineCount,le=C.remainingWidth,ce=C.isViewportWrapping,de=te?2:3;let ue=Math.floor(G*U);const ge=ue/G;let he=!1,fe=!1,pe=de*ie,Se=ie/G,Le=1;if(oe==="fill"||oe==="fit"){const{typicalViewportLineCount:Be,extraLinesBeforeFirstLine:Pe,extraLinesBeyondLastLine:Ue,desiredRatio:ze,minimapLineCount:Fe}=EditorLayoutInfoComputer.computeContainedMinimapLineCount({viewLineCount:se,scrollBeyondLastLine:ee,paddingTop:C.paddingTop,paddingBottom:C.paddingBottom,height:U,lineHeight:Q,pixelRatio:G});if(se/Fe>1)he=!0,fe=!0,ie=1,pe=1,Se=ie/G;else{let ot=!1,ft=ie+1;if(oe==="fit"){const rt=Math.ceil((Pe+se+Ue)*pe);ce&&X&&le<=W.stableFitRemainingWidth?(ot=!0,ft=W.stableFitMaxMinimapScale):ot=rt>ue}if(oe==="fill"||ot){he=!0;const rt=ie;pe=Math.min(Q*G,Math.max(1,Math.floor(1/ze))),ce&&X&&le<=W.stableFitRemainingWidth&&(ft=W.stableFitMaxMinimapScale),ie=Math.min(ft,Math.max(1,Math.floor(pe/de))),ie>rt&&(Le=Math.min(2,ie/rt)),Se=ie/G/Le,ue=Math.ceil(Math.max(Be,Pe+se+Ue)*pe),ce?(W.stableMinimapLayoutInput=C,W.stableFitRemainingWidth=le,W.stableFitMaxMinimapScale=ie):(W.stableMinimapLayoutInput=null,W.stableFitRemainingWidth=0)}}}const be=Math.floor(ne*Se),Ce=Math.min(be,Math.max(0,Math.floor((le-ae-2)*Se/(J+Se)))+MINIMAP_GUTTER_WIDTH);let De=Math.floor(G*Ce);const ke=De/G;De=Math.floor(De*Le);const Me=te?1:2,Oe=re==="left"?0:V-Ce-ae;return{renderMinimap:Me,minimapLeft:Oe,minimapWidth:Ce,minimapHeightIsEditorHeight:he,minimapIsSampling:fe,minimapScale:ie,minimapLineHeight:pe,minimapCanvasInnerWidth:De,minimapCanvasInnerHeight:ue,minimapCanvasOuterWidth:ke,minimapCanvasOuterHeight:ge}}static computeLayout(C,W){const V=W.outerWidth|0,U=W.outerHeight|0,G=W.lineHeight|0,Z=W.lineNumbersDigitCount|0,X=W.typicalHalfwidthCharacterWidth,Q=W.maxDigitWidth,J=W.pixelRatio,ee=W.viewLineCount,te=C.get(135),ie=te==="inherit"?C.get(134):te,ne=ie==="inherit"?C.get(130):ie,oe=C.get(133),re=W.isDominatedByLongLines,ae=C.get(57),se=C.get(67).renderType!==0,le=C.get(68),ce=C.get(104),de=C.get(83),ue=C.get(72),ge=C.get(102),he=ge.verticalScrollbarSize,fe=ge.verticalHasArrows,pe=ge.arrowSize,Se=ge.horizontalScrollbarSize,Le=C.get(43),be=C.get(109)!=="never";let Ce=C.get(65);Le&&be&&(Ce+=16);let De=0;if(se){const ct=Math.max(Z,le);De=Math.round(ct*Q)}let ke=0;ae&&(ke=G*W.glyphMarginDecorationLaneCount);let Me=0,Oe=Me+ke,Be=Oe+De,Pe=Be+Ce;const Ue=V-ke-De-Ce;let ze=!1,Fe=!1,Ae=-1;ie==="inherit"&&re?(ze=!0,Fe=!0):ne==="on"||ne==="bounded"?Fe=!0:ne==="wordWrapColumn"&&(Ae=oe);const ot=EditorLayoutInfoComputer._computeMinimapLayout({outerWidth:V,outerHeight:U,lineHeight:G,typicalHalfwidthCharacterWidth:X,pixelRatio:J,scrollBeyondLastLine:ce,paddingTop:de.top,paddingBottom:de.bottom,minimap:ue,verticalScrollbarWidth:he,viewLineCount:ee,remainingWidth:Ue,isViewportWrapping:Fe},W.memory||new ComputeOptionsMemory);ot.renderMinimap!==0&&ot.minimapLeft===0&&(Me+=ot.minimapWidth,Oe+=ot.minimapWidth,Be+=ot.minimapWidth,Pe+=ot.minimapWidth);const ft=Ue-ot.minimapWidth,rt=Math.max(1,Math.floor((ft-he-2)/X)),Xe=fe?pe:0;return Fe&&(Ae=Math.max(1,rt),ne==="bounded"&&(Ae=Math.min(Ae,oe))),{width:V,height:U,glyphMarginLeft:Me,glyphMarginWidth:ke,glyphMarginDecorationLaneCount:W.glyphMarginDecorationLaneCount,lineNumbersLeft:Oe,lineNumbersWidth:De,decorationsLeft:Be,decorationsWidth:Ce,contentLeft:Pe,contentWidth:ft,minimap:ot,viewportColumn:rt,isWordWrapMinified:ze,isViewportWrapping:Fe,wrappingColumn:Ae,verticalScrollbarWidth:he,horizontalScrollbarHeight:Se,overviewRuler:{top:Xe,width:he,height:U-2*Xe,right:0}}}}class WrappingStrategy extends BaseEditorOption{constructor(){super(137,"wrappingStrategy","simple",{"editor.wrappingStrategy":{enumDescriptions:[localize("wrappingStrategy.simple","Assumes that all characters are of the same width. This is a fast algorithm that works correctly for monospace fonts and certain scripts (like Latin characters) where glyphs are of equal width."),localize("wrappingStrategy.advanced","Delegates wrapping points computation to the browser. This is a slow algorithm, that might cause freezes for large files, but it works correctly in all cases.")],type:"string",enum:["simple","advanced"],default:"simple",description:localize("wrappingStrategy","Controls the algorithm that computes wrapping points. Note that when in accessibility mode, advanced will be used for the best experience.")}})}validate(C){return stringSet(C,"simple",["simple","advanced"])}compute(C,W,V){return W.get(2)===2?"advanced":V}}class EditorLightbulb extends BaseEditorOption{constructor(){const C={enabled:!0};super(64,"lightbulb",C,{"editor.lightbulb.enabled":{type:"boolean",default:C.enabled,description:localize("codeActions","Enables the Code Action lightbulb in the editor.")}})}validate(C){return!C||typeof C!="object"?this.defaultValue:{enabled:boolean$1(C.enabled,this.defaultValue.enabled)}}}class EditorStickyScroll extends BaseEditorOption{constructor(){const C={enabled:!1,maxLineCount:5,defaultModel:"outlineModel",scrollWithEditor:!0};super(114,"stickyScroll",C,{"editor.stickyScroll.enabled":{type:"boolean",default:C.enabled,description:localize("editor.stickyScroll.enabled","Shows the nested current scopes during the scroll at the top of the editor.")},"editor.stickyScroll.maxLineCount":{type:"number",default:C.maxLineCount,minimum:1,maximum:10,description:localize("editor.stickyScroll.maxLineCount","Defines the maximum number of sticky lines to show.")},"editor.stickyScroll.defaultModel":{type:"string",enum:["outlineModel","foldingProviderModel","indentationModel"],default:C.defaultModel,description:localize("editor.stickyScroll.defaultModel","Defines the model to use for determining which lines to stick. If the outline model does not exist, it will fall back on the folding provider model which falls back on the indentation model. This order is respected in all three cases.")},"editor.stickyScroll.scrollWithEditor":{type:"boolean",default:C.scrollWithEditor,description:localize("editor.stickyScroll.scrollWithEditor","Enable scrolling of the sticky scroll widget with the editor's horizontal scrollbar.")}})}validate(C){if(!C||typeof C!="object")return this.defaultValue;const W=C;return{enabled:boolean$1(W.enabled,this.defaultValue.enabled),maxLineCount:EditorIntOption.clampedInt(W.maxLineCount,this.defaultValue.maxLineCount,1,10),defaultModel:stringSet(W.defaultModel,this.defaultValue.defaultModel,["outlineModel","foldingProviderModel","indentationModel"]),scrollWithEditor:boolean$1(W.scrollWithEditor,this.defaultValue.scrollWithEditor)}}}class EditorInlayHints extends BaseEditorOption{constructor(){const C={enabled:"on",fontSize:0,fontFamily:"",padding:!1};super(139,"inlayHints",C,{"editor.inlayHints.enabled":{type:"string",default:C.enabled,description:localize("inlayHints.enable","Enables the inlay hints in the editor."),enum:["on","onUnlessPressed","offUnlessPressed","off"],markdownEnumDescriptions:[localize("editor.inlayHints.on","Inlay hints are enabled"),localize("editor.inlayHints.onUnlessPressed","Inlay hints are showing by default and hide when holding {0}",isMacintosh?"Ctrl+Option":"Ctrl+Alt"),localize("editor.inlayHints.offUnlessPressed","Inlay hints are hidden by default and show when holding {0}",isMacintosh?"Ctrl+Option":"Ctrl+Alt"),localize("editor.inlayHints.off","Inlay hints are disabled")]},"editor.inlayHints.fontSize":{type:"number",default:C.fontSize,markdownDescription:localize("inlayHints.fontSize","Controls font size of inlay hints in the editor. As default the {0} is used when the configured value is less than {1} or greater than the editor font size.","`#editor.fontSize#`","`5`")},"editor.inlayHints.fontFamily":{type:"string",default:C.fontFamily,markdownDescription:localize("inlayHints.fontFamily","Controls font family of inlay hints in the editor. When set to empty, the {0} is used.","`#editor.fontFamily#`")},"editor.inlayHints.padding":{type:"boolean",default:C.padding,description:localize("inlayHints.padding","Enables the padding around the inlay hints in the editor.")}})}validate(C){if(!C||typeof C!="object")return this.defaultValue;const W=C;return typeof W.enabled=="boolean"&&(W.enabled=W.enabled?"on":"off"),{enabled:stringSet(W.enabled,this.defaultValue.enabled,["on","off","offUnlessPressed","onUnlessPressed"]),fontSize:EditorIntOption.clampedInt(W.fontSize,this.defaultValue.fontSize,0,100),fontFamily:EditorStringOption.string(W.fontFamily,this.defaultValue.fontFamily),padding:boolean$1(W.padding,this.defaultValue.padding)}}}class EditorLineDecorationsWidth extends BaseEditorOption{constructor(){super(65,"lineDecorationsWidth",10)}validate(C){return typeof C=="string"&&/^\d+(\.\d+)?ch$/.test(C)?-parseFloat(C.substring(0,C.length-2)):EditorIntOption.clampedInt(C,this.defaultValue,0,1e3)}compute(C,W,V){return V<0?EditorIntOption.clampedInt(-V*C.fontInfo.typicalHalfwidthCharacterWidth,this.defaultValue,0,1e3):V}}class EditorLineHeight extends EditorFloatOption{constructor(){super(66,"lineHeight",EDITOR_FONT_DEFAULTS.lineHeight,C=>EditorFloatOption.clamp(C,0,150),{markdownDescription:localize("lineHeight",`Controls the line height. 
 - Use 0 to automatically compute the line height from the font size.
 - Values between 0 and 8 will be used as a multiplier with the font size.
 - Values greater than or equal to 8 will be used as effective values.`)})}compute(C,W,V){return C.fontInfo.lineHeight}}class EditorMinimap extends BaseEditorOption{constructor(){const C={enabled:!0,size:"proportional",side:"right",showSlider:"mouseover",autohide:!1,renderCharacters:!0,maxColumn:120,scale:1};super(72,"minimap",C,{"editor.minimap.enabled":{type:"boolean",default:C.enabled,description:localize("minimap.enabled","Controls whether the minimap is shown.")},"editor.minimap.autohide":{type:"boolean",default:C.autohide,description:localize("minimap.autohide","Controls whether the minimap is hidden automatically.")},"editor.minimap.size":{type:"string",enum:["proportional","fill","fit"],enumDescriptions:[localize("minimap.size.proportional","The minimap has the same size as the editor contents (and might scroll)."),localize("minimap.size.fill","The minimap will stretch or shrink as necessary to fill the height of the editor (no scrolling)."),localize("minimap.size.fit","The minimap will shrink as necessary to never be larger than the editor (no scrolling).")],default:C.size,description:localize("minimap.size","Controls the size of the minimap.")},"editor.minimap.side":{type:"string",enum:["left","right"],default:C.side,description:localize("minimap.side","Controls the side where to render the minimap.")},"editor.minimap.showSlider":{type:"string",enum:["always","mouseover"],default:C.showSlider,description:localize("minimap.showSlider","Controls when the minimap slider is shown.")},"editor.minimap.scale":{type:"number",default:C.scale,minimum:1,maximum:3,enum:[1,2,3],description:localize("minimap.scale","Scale of content drawn in the minimap: 1, 2 or 3.")},"editor.minimap.renderCharacters":{type:"boolean",default:C.renderCharacters,description:localize("minimap.renderCharacters","Render the actual characters on a line as opposed to color blocks.")},"editor.minimap.maxColumn":{type:"number",default:C.maxColumn,description:localize("minimap.maxColumn","Limit the width of the minimap to render at most a certain number of columns.")}})}validate(C){if(!C||typeof C!="object")return this.defaultValue;const W=C;return{enabled:boolean$1(W.enabled,this.defaultValue.enabled),autohide:boolean$1(W.autohide,this.defaultValue.autohide),size:stringSet(W.size,this.defaultValue.size,["proportional","fill","fit"]),side:stringSet(W.side,this.defaultValue.side,["right","left"]),showSlider:stringSet(W.showSlider,this.defaultValue.showSlider,["always","mouseover"]),renderCharacters:boolean$1(W.renderCharacters,this.defaultValue.renderCharacters),scale:EditorIntOption.clampedInt(W.scale,1,1,3),maxColumn:EditorIntOption.clampedInt(W.maxColumn,this.defaultValue.maxColumn,1,1e4)}}}function _multiCursorModifierFromString(K){return K==="ctrlCmd"?isMacintosh?"metaKey":"ctrlKey":"altKey"}class EditorPadding extends BaseEditorOption{constructor(){super(83,"padding",{top:0,bottom:0},{"editor.padding.top":{type:"number",default:0,minimum:0,maximum:1e3,description:localize("padding.top","Controls the amount of space between the top edge of the editor and the first line.")},"editor.padding.bottom":{type:"number",default:0,minimum:0,maximum:1e3,description:localize("padding.bottom","Controls the amount of space between the bottom edge of the editor and the last line.")}})}validate(C){if(!C||typeof C!="object")return this.defaultValue;const W=C;return{top:EditorIntOption.clampedInt(W.top,0,0,1e3),bottom:EditorIntOption.clampedInt(W.bottom,0,0,1e3)}}}class EditorParameterHints extends BaseEditorOption{constructor(){const C={enabled:!0,cycle:!0};super(85,"parameterHints",C,{"editor.parameterHints.enabled":{type:"boolean",default:C.enabled,description:localize("parameterHints.enabled","Enables a pop-up that shows parameter documentation and type information as you type.")},"editor.parameterHints.cycle":{type:"boolean",default:C.cycle,description:localize("parameterHints.cycle","Controls whether the parameter hints menu cycles or closes when reaching the end of the list.")}})}validate(C){if(!C||typeof C!="object")return this.defaultValue;const W=C;return{enabled:boolean$1(W.enabled,this.defaultValue.enabled),cycle:boolean$1(W.cycle,this.defaultValue.cycle)}}}class EditorPixelRatio extends ComputedEditorOption{constructor(){super(141)}compute(C,W,V){return C.pixelRatio}}class EditorQuickSuggestions extends BaseEditorOption{constructor(){const C={other:"on",comments:"off",strings:"off"},W=[{type:"boolean"},{type:"string",enum:["on","inline","off"],enumDescriptions:[localize("on","Quick suggestions show inside the suggest widget"),localize("inline","Quick suggestions show as ghost text"),localize("off","Quick suggestions are disabled")]}];super(88,"quickSuggestions",C,{type:"object",additionalProperties:!1,properties:{strings:{anyOf:W,default:C.strings,description:localize("quickSuggestions.strings","Enable quick suggestions inside strings.")},comments:{anyOf:W,default:C.comments,description:localize("quickSuggestions.comments","Enable quick suggestions inside comments.")},other:{anyOf:W,default:C.other,description:localize("quickSuggestions.other","Enable quick suggestions outside of strings and comments.")}},default:C,markdownDescription:localize("quickSuggestions","Controls whether suggestions should automatically show up while typing. This can be controlled for typing in comments, strings, and other code. Quick suggestion can be configured to show as ghost text or with the suggest widget. Also be aware of the '{0}'-setting which controls if suggestions are triggered by special characters.","#editor.suggestOnTriggerCharacters#")}),this.defaultValue=C}validate(C){if(typeof C=="boolean"){const J=C?"on":"off";return{comments:J,strings:J,other:J}}if(!C||typeof C!="object")return this.defaultValue;const{other:W,comments:V,strings:U}=C,G=["on","inline","off"];let Z,X,Q;return typeof W=="boolean"?Z=W?"on":"off":Z=stringSet(W,this.defaultValue.other,G),typeof V=="boolean"?X=V?"on":"off":X=stringSet(V,this.defaultValue.comments,G),typeof U=="boolean"?Q=U?"on":"off":Q=stringSet(U,this.defaultValue.strings,G),{other:Z,comments:X,strings:Q}}}class EditorRenderLineNumbersOption extends BaseEditorOption{constructor(){super(67,"lineNumbers",{renderType:1,renderFn:null},{type:"string",enum:["off","on","relative","interval"],enumDescriptions:[localize("lineNumbers.off","Line numbers are not rendered."),localize("lineNumbers.on","Line numbers are rendered as absolute number."),localize("lineNumbers.relative","Line numbers are rendered as distance in lines to cursor position."),localize("lineNumbers.interval","Line numbers are rendered every 10 lines.")],default:"on",description:localize("lineNumbers","Controls the display of line numbers.")})}validate(C){let W=this.defaultValue.renderType,V=this.defaultValue.renderFn;return typeof C<"u"&&(typeof C=="function"?(W=4,V=C):C==="interval"?W=3:C==="relative"?W=2:C==="on"?W=1:W=0),{renderType:W,renderFn:V}}}function filterValidationDecorations(K){const C=K.get(97);return C==="editable"?K.get(90):C!=="on"}class EditorRulers extends BaseEditorOption{constructor(){const C=[],W={type:"number",description:localize("rulers.size","Number of monospace characters at which this editor ruler will render.")};super(101,"rulers",C,{type:"array",items:{anyOf:[W,{type:["object"],properties:{column:W,color:{type:"string",description:localize("rulers.color","Color of this editor ruler."),format:"color-hex"}}}]},default:C,description:localize("rulers","Render vertical rulers after a certain number of monospace characters. Use multiple values for multiple rulers. No rulers are drawn if array is empty.")})}validate(C){if(Array.isArray(C)){const W=[];for(const V of C)if(typeof V=="number")W.push({column:EditorIntOption.clampedInt(V,0,0,1e4),color:null});else if(V&&typeof V=="object"){const U=V;W.push({column:EditorIntOption.clampedInt(U.column,0,0,1e4),color:U.color})}return W.sort((V,U)=>V.column-U.column),W}return this.defaultValue}}class ReadonlyMessage extends BaseEditorOption{constructor(){super(91,"readOnlyMessage",void 0)}validate(C){return!C||typeof C!="object"?this.defaultValue:C}}function _scrollbarVisibilityFromString(K,C){if(typeof K!="string")return C;switch(K){case"hidden":return 2;case"visible":return 3;default:return 1}}let EditorScrollbar$1=class extends BaseEditorOption{constructor(){const C={vertical:1,horizontal:1,arrowSize:11,useShadows:!0,verticalHasArrows:!1,horizontalHasArrows:!1,horizontalScrollbarSize:12,horizontalSliderSize:12,verticalScrollbarSize:14,verticalSliderSize:14,handleMouseWheel:!0,alwaysConsumeMouseWheel:!0,scrollByPage:!1};super(102,"scrollbar",C,{"editor.scrollbar.vertical":{type:"string",enum:["auto","visible","hidden"],enumDescriptions:[localize("scrollbar.vertical.auto","The vertical scrollbar will be visible only when necessary."),localize("scrollbar.vertical.visible","The vertical scrollbar will always be visible."),localize("scrollbar.vertical.fit","The vertical scrollbar will always be hidden.")],default:"auto",description:localize("scrollbar.vertical","Controls the visibility of the vertical scrollbar.")},"editor.scrollbar.horizontal":{type:"string",enum:["auto","visible","hidden"],enumDescriptions:[localize("scrollbar.horizontal.auto","The horizontal scrollbar will be visible only when necessary."),localize("scrollbar.horizontal.visible","The horizontal scrollbar will always be visible."),localize("scrollbar.horizontal.fit","The horizontal scrollbar will always be hidden.")],default:"auto",description:localize("scrollbar.horizontal","Controls the visibility of the horizontal scrollbar.")},"editor.scrollbar.verticalScrollbarSize":{type:"number",default:C.verticalScrollbarSize,description:localize("scrollbar.verticalScrollbarSize","The width of the vertical scrollbar.")},"editor.scrollbar.horizontalScrollbarSize":{type:"number",default:C.horizontalScrollbarSize,description:localize("scrollbar.horizontalScrollbarSize","The height of the horizontal scrollbar.")},"editor.scrollbar.scrollByPage":{type:"boolean",default:C.scrollByPage,description:localize("scrollbar.scrollByPage","Controls whether clicks scroll by page or jump to click position.")}})}validate(C){if(!C||typeof C!="object")return this.defaultValue;const W=C,V=EditorIntOption.clampedInt(W.horizontalScrollbarSize,this.defaultValue.horizontalScrollbarSize,0,1e3),U=EditorIntOption.clampedInt(W.verticalScrollbarSize,this.defaultValue.verticalScrollbarSize,0,1e3);return{arrowSize:EditorIntOption.clampedInt(W.arrowSize,this.defaultValue.arrowSize,0,1e3),vertical:_scrollbarVisibilityFromString(W.vertical,this.defaultValue.vertical),horizontal:_scrollbarVisibilityFromString(W.horizontal,this.defaultValue.horizontal),useShadows:boolean$1(W.useShadows,this.defaultValue.useShadows),verticalHasArrows:boolean$1(W.verticalHasArrows,this.defaultValue.verticalHasArrows),horizontalHasArrows:boolean$1(W.horizontalHasArrows,this.defaultValue.horizontalHasArrows),handleMouseWheel:boolean$1(W.handleMouseWheel,this.defaultValue.handleMouseWheel),alwaysConsumeMouseWheel:boolean$1(W.alwaysConsumeMouseWheel,this.defaultValue.alwaysConsumeMouseWheel),horizontalScrollbarSize:V,horizontalSliderSize:EditorIntOption.clampedInt(W.horizontalSliderSize,V,0,1e3),verticalScrollbarSize:U,verticalSliderSize:EditorIntOption.clampedInt(W.verticalSliderSize,U,0,1e3),scrollByPage:boolean$1(W.scrollByPage,this.defaultValue.scrollByPage)}}};const inUntrustedWorkspace="inUntrustedWorkspace",unicodeHighlightConfigKeys={allowedCharacters:"editor.unicodeHighlight.allowedCharacters",invisibleCharacters:"editor.unicodeHighlight.invisibleCharacters",nonBasicASCII:"editor.unicodeHighlight.nonBasicASCII",ambiguousCharacters:"editor.unicodeHighlight.ambiguousCharacters",includeComments:"editor.unicodeHighlight.includeComments",includeStrings:"editor.unicodeHighlight.includeStrings",allowedLocales:"editor.unicodeHighlight.allowedLocales"};class UnicodeHighlight extends BaseEditorOption{constructor(){const C={nonBasicASCII:inUntrustedWorkspace,invisibleCharacters:!0,ambiguousCharacters:!0,includeComments:inUntrustedWorkspace,includeStrings:!0,allowedCharacters:{},allowedLocales:{_os:!0,_vscode:!0}};super(124,"unicodeHighlight",C,{[unicodeHighlightConfigKeys.nonBasicASCII]:{restricted:!0,type:["boolean","string"],enum:[!0,!1,inUntrustedWorkspace],default:C.nonBasicASCII,description:localize("unicodeHighlight.nonBasicASCII","Controls whether all non-basic ASCII characters are highlighted. Only characters between U+0020 and U+007E, tab, line-feed and carriage-return are considered basic ASCII.")},[unicodeHighlightConfigKeys.invisibleCharacters]:{restricted:!0,type:"boolean",default:C.invisibleCharacters,description:localize("unicodeHighlight.invisibleCharacters","Controls whether characters that just reserve space or have no width at all are highlighted.")},[unicodeHighlightConfigKeys.ambiguousCharacters]:{restricted:!0,type:"boolean",default:C.ambiguousCharacters,description:localize("unicodeHighlight.ambiguousCharacters","Controls whether characters are highlighted that can be confused with basic ASCII characters, except those that are common in the current user locale.")},[unicodeHighlightConfigKeys.includeComments]:{restricted:!0,type:["boolean","string"],enum:[!0,!1,inUntrustedWorkspace],default:C.includeComments,description:localize("unicodeHighlight.includeComments","Controls whether characters in comments should also be subject to Unicode highlighting.")},[unicodeHighlightConfigKeys.includeStrings]:{restricted:!0,type:["boolean","string"],enum:[!0,!1,inUntrustedWorkspace],default:C.includeStrings,description:localize("unicodeHighlight.includeStrings","Controls whether characters in strings should also be subject to Unicode highlighting.")},[unicodeHighlightConfigKeys.allowedCharacters]:{restricted:!0,type:"object",default:C.allowedCharacters,description:localize("unicodeHighlight.allowedCharacters","Defines allowed characters that are not being highlighted."),additionalProperties:{type:"boolean"}},[unicodeHighlightConfigKeys.allowedLocales]:{restricted:!0,type:"object",additionalProperties:{type:"boolean"},default:C.allowedLocales,description:localize("unicodeHighlight.allowedLocales","Unicode characters that are common in allowed locales are not being highlighted.")}})}applyUpdate(C,W){let V=!1;W.allowedCharacters&&C&&(equals$4(C.allowedCharacters,W.allowedCharacters)||(C=Object.assign(Object.assign({},C),{allowedCharacters:W.allowedCharacters}),V=!0)),W.allowedLocales&&C&&(equals$4(C.allowedLocales,W.allowedLocales)||(C=Object.assign(Object.assign({},C),{allowedLocales:W.allowedLocales}),V=!0));const U=super.applyUpdate(C,W);return V?new ApplyUpdateResult(U.newValue,!0):U}validate(C){if(!C||typeof C!="object")return this.defaultValue;const W=C;return{nonBasicASCII:primitiveSet(W.nonBasicASCII,inUntrustedWorkspace,[!0,!1,inUntrustedWorkspace]),invisibleCharacters:boolean$1(W.invisibleCharacters,this.defaultValue.invisibleCharacters),ambiguousCharacters:boolean$1(W.ambiguousCharacters,this.defaultValue.ambiguousCharacters),includeComments:primitiveSet(W.includeComments,inUntrustedWorkspace,[!0,!1,inUntrustedWorkspace]),includeStrings:primitiveSet(W.includeStrings,inUntrustedWorkspace,[!0,!1,inUntrustedWorkspace]),allowedCharacters:this.validateBooleanMap(C.allowedCharacters,this.defaultValue.allowedCharacters),allowedLocales:this.validateBooleanMap(C.allowedLocales,this.defaultValue.allowedLocales)}}validateBooleanMap(C,W){if(typeof C!="object"||!C)return W;const V={};for(const[U,G]of Object.entries(C))G===!0&&(V[U]=!0);return V}}class InlineEditorSuggest extends BaseEditorOption{constructor(){const C={enabled:!0,mode:"subwordSmart",showToolbar:"onHover",suppressSuggestions:!1,keepOnBlur:!1};super(62,"inlineSuggest",C,{"editor.inlineSuggest.enabled":{type:"boolean",default:C.enabled,description:localize("inlineSuggest.enabled","Controls whether to automatically show inline suggestions in the editor.")},"editor.inlineSuggest.showToolbar":{type:"string",default:C.showToolbar,enum:["always","onHover"],enumDescriptions:[localize("inlineSuggest.showToolbar.always","Show the inline suggestion toolbar whenever an inline suggestion is shown."),localize("inlineSuggest.showToolbar.onHover","Show the inline suggestion toolbar when hovering over an inline suggestion.")],description:localize("inlineSuggest.showToolbar","Controls when to show the inline suggestion toolbar.")},"editor.inlineSuggest.suppressSuggestions":{type:"boolean",default:C.suppressSuggestions,description:localize("inlineSuggest.suppressSuggestions","Controls how inline suggestions interact with the suggest widget. If enabled, the suggest widget is not shown automatically when inline suggestions are available.")}})}validate(C){if(!C||typeof C!="object")return this.defaultValue;const W=C;return{enabled:boolean$1(W.enabled,this.defaultValue.enabled),mode:stringSet(W.mode,this.defaultValue.mode,["prefix","subword","subwordSmart"]),showToolbar:stringSet(W.showToolbar,this.defaultValue.showToolbar,["always","onHover"]),suppressSuggestions:boolean$1(W.suppressSuggestions,this.defaultValue.suppressSuggestions),keepOnBlur:boolean$1(W.keepOnBlur,this.defaultValue.keepOnBlur)}}}class BracketPairColorization extends BaseEditorOption{constructor(){const C={enabled:EDITOR_MODEL_DEFAULTS.bracketPairColorizationOptions.enabled,independentColorPoolPerBracketType:EDITOR_MODEL_DEFAULTS.bracketPairColorizationOptions.independentColorPoolPerBracketType};super(15,"bracketPairColorization",C,{"editor.bracketPairColorization.enabled":{type:"boolean",default:C.enabled,markdownDescription:localize("bracketPairColorization.enabled","Controls whether bracket pair colorization is enabled or not. Use {0} to override the bracket highlight colors.","`#workbench.colorCustomizations#`")},"editor.bracketPairColorization.independentColorPoolPerBracketType":{type:"boolean",default:C.independentColorPoolPerBracketType,description:localize("bracketPairColorization.independentColorPoolPerBracketType","Controls whether each bracket type has its own independent color pool.")}})}validate(C){if(!C||typeof C!="object")return this.defaultValue;const W=C;return{enabled:boolean$1(W.enabled,this.defaultValue.enabled),independentColorPoolPerBracketType:boolean$1(W.independentColorPoolPerBracketType,this.defaultValue.independentColorPoolPerBracketType)}}}class GuideOptions extends BaseEditorOption{constructor(){const C={bracketPairs:!1,bracketPairsHorizontal:"active",highlightActiveBracketPair:!0,indentation:!0,highlightActiveIndentation:!0};super(16,"guides",C,{"editor.guides.bracketPairs":{type:["boolean","string"],enum:[!0,"active",!1],enumDescriptions:[localize("editor.guides.bracketPairs.true","Enables bracket pair guides."),localize("editor.guides.bracketPairs.active","Enables bracket pair guides only for the active bracket pair."),localize("editor.guides.bracketPairs.false","Disables bracket pair guides.")],default:C.bracketPairs,description:localize("editor.guides.bracketPairs","Controls whether bracket pair guides are enabled or not.")},"editor.guides.bracketPairsHorizontal":{type:["boolean","string"],enum:[!0,"active",!1],enumDescriptions:[localize("editor.guides.bracketPairsHorizontal.true","Enables horizontal guides as addition to vertical bracket pair guides."),localize("editor.guides.bracketPairsHorizontal.active","Enables horizontal guides only for the active bracket pair."),localize("editor.guides.bracketPairsHorizontal.false","Disables horizontal bracket pair guides.")],default:C.bracketPairsHorizontal,description:localize("editor.guides.bracketPairsHorizontal","Controls whether horizontal bracket pair guides are enabled or not.")},"editor.guides.highlightActiveBracketPair":{type:"boolean",default:C.highlightActiveBracketPair,description:localize("editor.guides.highlightActiveBracketPair","Controls whether the editor should highlight the active bracket pair.")},"editor.guides.indentation":{type:"boolean",default:C.indentation,description:localize("editor.guides.indentation","Controls whether the editor should render indent guides.")},"editor.guides.highlightActiveIndentation":{type:["boolean","string"],enum:[!0,"always",!1],enumDescriptions:[localize("editor.guides.highlightActiveIndentation.true","Highlights the active indent guide."),localize("editor.guides.highlightActiveIndentation.always","Highlights the active indent guide even if bracket guides are highlighted."),localize("editor.guides.highlightActiveIndentation.false","Do not highlight the active indent guide.")],default:C.highlightActiveIndentation,description:localize("editor.guides.highlightActiveIndentation","Controls whether the editor should highlight the active indent guide.")}})}validate(C){if(!C||typeof C!="object")return this.defaultValue;const W=C;return{bracketPairs:primitiveSet(W.bracketPairs,this.defaultValue.bracketPairs,[!0,!1,"active"]),bracketPairsHorizontal:primitiveSet(W.bracketPairsHorizontal,this.defaultValue.bracketPairsHorizontal,[!0,!1,"active"]),highlightActiveBracketPair:boolean$1(W.highlightActiveBracketPair,this.defaultValue.highlightActiveBracketPair),indentation:boolean$1(W.indentation,this.defaultValue.indentation),highlightActiveIndentation:primitiveSet(W.highlightActiveIndentation,this.defaultValue.highlightActiveIndentation,[!0,!1,"always"])}}}function primitiveSet(K,C,W){const V=W.indexOf(K);return V===-1?C:W[V]}class EditorSuggest extends BaseEditorOption{constructor(){const C={insertMode:"insert",filterGraceful:!0,snippetsPreventQuickSuggestions:!1,localityBonus:!1,shareSuggestSelections:!1,selectionMode:"always",showIcons:!0,showStatusBar:!1,preview:!1,previewMode:"subwordSmart",showInlineDetails:!0,showMethods:!0,showFunctions:!0,showConstructors:!0,showDeprecated:!0,matchOnWordStartOnly:!0,showFields:!0,showVariables:!0,showClasses:!0,showStructs:!0,showInterfaces:!0,showModules:!0,showProperties:!0,showEvents:!0,showOperators:!0,showUnits:!0,showValues:!0,showConstants:!0,showEnums:!0,showEnumMembers:!0,showKeywords:!0,showWords:!0,showColors:!0,showFiles:!0,showReferences:!0,showFolders:!0,showTypeParameters:!0,showSnippets:!0,showUsers:!0,showIssues:!0};super(117,"suggest",C,{"editor.suggest.insertMode":{type:"string",enum:["insert","replace"],enumDescriptions:[localize("suggest.insertMode.insert","Insert suggestion without overwriting text right of the cursor."),localize("suggest.insertMode.replace","Insert suggestion and overwrite text right of the cursor.")],default:C.insertMode,description:localize("suggest.insertMode","Controls whether words are overwritten when accepting completions. Note that this depends on extensions opting into this feature.")},"editor.suggest.filterGraceful":{type:"boolean",default:C.filterGraceful,description:localize("suggest.filterGraceful","Controls whether filtering and sorting suggestions accounts for small typos.")},"editor.suggest.localityBonus":{type:"boolean",default:C.localityBonus,description:localize("suggest.localityBonus","Controls whether sorting favors words that appear close to the cursor.")},"editor.suggest.shareSuggestSelections":{type:"boolean",default:C.shareSuggestSelections,markdownDescription:localize("suggest.shareSuggestSelections","Controls whether remembered suggestion selections are shared between multiple workspaces and windows (needs `#editor.suggestSelection#`).")},"editor.suggest.selectionMode":{type:"string",enum:["always","never","whenTriggerCharacter","whenQuickSuggestion"],enumDescriptions:[localize("suggest.insertMode.always","Always select a suggestion when automatically triggering IntelliSense."),localize("suggest.insertMode.never","Never select a suggestion when automatically triggering IntelliSense."),localize("suggest.insertMode.whenTriggerCharacter","Select a suggestion only when triggering IntelliSense from a trigger character."),localize("suggest.insertMode.whenQuickSuggestion","Select a suggestion only when triggering IntelliSense as you type.")],default:C.selectionMode,markdownDescription:localize("suggest.selectionMode","Controls whether a suggestion is selected when the widget shows. Note that this only applies to automatically triggered suggestions (`#editor.quickSuggestions#` and `#editor.suggestOnTriggerCharacters#`) and that a suggestion is always selected when explicitly invoked, e.g via `Ctrl+Space`.")},"editor.suggest.snippetsPreventQuickSuggestions":{type:"boolean",default:C.snippetsPreventQuickSuggestions,description:localize("suggest.snippetsPreventQuickSuggestions","Controls whether an active snippet prevents quick suggestions.")},"editor.suggest.showIcons":{type:"boolean",default:C.showIcons,description:localize("suggest.showIcons","Controls whether to show or hide icons in suggestions.")},"editor.suggest.showStatusBar":{type:"boolean",default:C.showStatusBar,description:localize("suggest.showStatusBar","Controls the visibility of the status bar at the bottom of the suggest widget.")},"editor.suggest.preview":{type:"boolean",default:C.preview,description:localize("suggest.preview","Controls whether to preview the suggestion outcome in the editor.")},"editor.suggest.showInlineDetails":{type:"boolean",default:C.showInlineDetails,description:localize("suggest.showInlineDetails","Controls whether suggest details show inline with the label or only in the details widget.")},"editor.suggest.maxVisibleSuggestions":{type:"number",deprecationMessage:localize("suggest.maxVisibleSuggestions.dep","This setting is deprecated. The suggest widget can now be resized.")},"editor.suggest.filteredTypes":{type:"object",deprecationMessage:localize("deprecated","This setting is deprecated, please use separate settings like 'editor.suggest.showKeywords' or 'editor.suggest.showSnippets' instead.")},"editor.suggest.showMethods":{type:"boolean",default:!0,markdownDescription:localize("editor.suggest.showMethods","When enabled IntelliSense shows `method`-suggestions.")},"editor.suggest.showFunctions":{type:"boolean",default:!0,markdownDescription:localize("editor.suggest.showFunctions","When enabled IntelliSense shows `function`-suggestions.")},"editor.suggest.showConstructors":{type:"boolean",default:!0,markdownDescription:localize("editor.suggest.showConstructors","When enabled IntelliSense shows `constructor`-suggestions.")},"editor.suggest.showDeprecated":{type:"boolean",default:!0,markdownDescription:localize("editor.suggest.showDeprecated","When enabled IntelliSense shows `deprecated`-suggestions.")},"editor.suggest.matchOnWordStartOnly":{type:"boolean",default:!0,markdownDescription:localize("editor.suggest.matchOnWordStartOnly","When enabled IntelliSense filtering requires that the first character matches on a word start. For example, `c` on `Console` or `WebContext` but _not_ on `description`. When disabled IntelliSense will show more results but still sorts them by match quality.")},"editor.suggest.showFields":{type:"boolean",default:!0,markdownDescription:localize("editor.suggest.showFields","When enabled IntelliSense shows `field`-suggestions.")},"editor.suggest.showVariables":{type:"boolean",default:!0,markdownDescription:localize("editor.suggest.showVariables","When enabled IntelliSense shows `variable`-suggestions.")},"editor.suggest.showClasses":{type:"boolean",default:!0,markdownDescription:localize("editor.suggest.showClasss","When enabled IntelliSense shows `class`-suggestions.")},"editor.suggest.showStructs":{type:"boolean",default:!0,markdownDescription:localize("editor.suggest.showStructs","When enabled IntelliSense shows `struct`-suggestions.")},"editor.suggest.showInterfaces":{type:"boolean",default:!0,markdownDescription:localize("editor.suggest.showInterfaces","When enabled IntelliSense shows `interface`-suggestions.")},"editor.suggest.showModules":{type:"boolean",default:!0,markdownDescription:localize("editor.suggest.showModules","When enabled IntelliSense shows `module`-suggestions.")},"editor.suggest.showProperties":{type:"boolean",default:!0,markdownDescription:localize("editor.suggest.showPropertys","When enabled IntelliSense shows `property`-suggestions.")},"editor.suggest.showEvents":{type:"boolean",default:!0,markdownDescription:localize("editor.suggest.showEvents","When enabled IntelliSense shows `event`-suggestions.")},"editor.suggest.showOperators":{type:"boolean",default:!0,markdownDescription:localize("editor.suggest.showOperators","When enabled IntelliSense shows `operator`-suggestions.")},"editor.suggest.showUnits":{type:"boolean",default:!0,markdownDescription:localize("editor.suggest.showUnits","When enabled IntelliSense shows `unit`-suggestions.")},"editor.suggest.showValues":{type:"boolean",default:!0,markdownDescription:localize("editor.suggest.showValues","When enabled IntelliSense shows `value`-suggestions.")},"editor.suggest.showConstants":{type:"boolean",default:!0,markdownDescription:localize("editor.suggest.showConstants","When enabled IntelliSense shows `constant`-suggestions.")},"editor.suggest.showEnums":{type:"boolean",default:!0,markdownDescription:localize("editor.suggest.showEnums","When enabled IntelliSense shows `enum`-suggestions.")},"editor.suggest.showEnumMembers":{type:"boolean",default:!0,markdownDescription:localize("editor.suggest.showEnumMembers","When enabled IntelliSense shows `enumMember`-suggestions.")},"editor.suggest.showKeywords":{type:"boolean",default:!0,markdownDescription:localize("editor.suggest.showKeywords","When enabled IntelliSense shows `keyword`-suggestions.")},"editor.suggest.showWords":{type:"boolean",default:!0,markdownDescription:localize("editor.suggest.showTexts","When enabled IntelliSense shows `text`-suggestions.")},"editor.suggest.showColors":{type:"boolean",default:!0,markdownDescription:localize("editor.suggest.showColors","When enabled IntelliSense shows `color`-suggestions.")},"editor.suggest.showFiles":{type:"boolean",default:!0,markdownDescription:localize("editor.suggest.showFiles","When enabled IntelliSense shows `file`-suggestions.")},"editor.suggest.showReferences":{type:"boolean",default:!0,markdownDescription:localize("editor.suggest.showReferences","When enabled IntelliSense shows `reference`-suggestions.")},"editor.suggest.showCustomcolors":{type:"boolean",default:!0,markdownDescription:localize("editor.suggest.showCustomcolors","When enabled IntelliSense shows `customcolor`-suggestions.")},"editor.suggest.showFolders":{type:"boolean",default:!0,markdownDescription:localize("editor.suggest.showFolders","When enabled IntelliSense shows `folder`-suggestions.")},"editor.suggest.showTypeParameters":{type:"boolean",default:!0,markdownDescription:localize("editor.suggest.showTypeParameters","When enabled IntelliSense shows `typeParameter`-suggestions.")},"editor.suggest.showSnippets":{type:"boolean",default:!0,markdownDescription:localize("editor.suggest.showSnippets","When enabled IntelliSense shows `snippet`-suggestions.")},"editor.suggest.showUsers":{type:"boolean",default:!0,markdownDescription:localize("editor.suggest.showUsers","When enabled IntelliSense shows `user`-suggestions.")},"editor.suggest.showIssues":{type:"boolean",default:!0,markdownDescription:localize("editor.suggest.showIssues","When enabled IntelliSense shows `issues`-suggestions.")}})}validate(C){if(!C||typeof C!="object")return this.defaultValue;const W=C;return{insertMode:stringSet(W.insertMode,this.defaultValue.insertMode,["insert","replace"]),filterGraceful:boolean$1(W.filterGraceful,this.defaultValue.filterGraceful),snippetsPreventQuickSuggestions:boolean$1(W.snippetsPreventQuickSuggestions,this.defaultValue.filterGraceful),localityBonus:boolean$1(W.localityBonus,this.defaultValue.localityBonus),shareSuggestSelections:boolean$1(W.shareSuggestSelections,this.defaultValue.shareSuggestSelections),selectionMode:stringSet(W.selectionMode,this.defaultValue.selectionMode,["always","never","whenQuickSuggestion","whenTriggerCharacter"]),showIcons:boolean$1(W.showIcons,this.defaultValue.showIcons),showStatusBar:boolean$1(W.showStatusBar,this.defaultValue.showStatusBar),preview:boolean$1(W.preview,this.defaultValue.preview),previewMode:stringSet(W.previewMode,this.defaultValue.previewMode,["prefix","subword","subwordSmart"]),showInlineDetails:boolean$1(W.showInlineDetails,this.defaultValue.showInlineDetails),showMethods:boolean$1(W.showMethods,this.defaultValue.showMethods),showFunctions:boolean$1(W.showFunctions,this.defaultValue.showFunctions),showConstructors:boolean$1(W.showConstructors,this.defaultValue.showConstructors),showDeprecated:boolean$1(W.showDeprecated,this.defaultValue.showDeprecated),matchOnWordStartOnly:boolean$1(W.matchOnWordStartOnly,this.defaultValue.matchOnWordStartOnly),showFields:boolean$1(W.showFields,this.defaultValue.showFields),showVariables:boolean$1(W.showVariables,this.defaultValue.showVariables),showClasses:boolean$1(W.showClasses,this.defaultValue.showClasses),showStructs:boolean$1(W.showStructs,this.defaultValue.showStructs),showInterfaces:boolean$1(W.showInterfaces,this.defaultValue.showInterfaces),showModules:boolean$1(W.showModules,this.defaultValue.showModules),showProperties:boolean$1(W.showProperties,this.defaultValue.showProperties),showEvents:boolean$1(W.showEvents,this.defaultValue.showEvents),showOperators:boolean$1(W.showOperators,this.defaultValue.showOperators),showUnits:boolean$1(W.showUnits,this.defaultValue.showUnits),showValues:boolean$1(W.showValues,this.defaultValue.showValues),showConstants:boolean$1(W.showConstants,this.defaultValue.showConstants),showEnums:boolean$1(W.showEnums,this.defaultValue.showEnums),showEnumMembers:boolean$1(W.showEnumMembers,this.defaultValue.showEnumMembers),showKeywords:boolean$1(W.showKeywords,this.defaultValue.showKeywords),showWords:boolean$1(W.showWords,this.defaultValue.showWords),showColors:boolean$1(W.showColors,this.defaultValue.showColors),showFiles:boolean$1(W.showFiles,this.defaultValue.showFiles),showReferences:boolean$1(W.showReferences,this.defaultValue.showReferences),showFolders:boolean$1(W.showFolders,this.defaultValue.showFolders),showTypeParameters:boolean$1(W.showTypeParameters,this.defaultValue.showTypeParameters),showSnippets:boolean$1(W.showSnippets,this.defaultValue.showSnippets),showUsers:boolean$1(W.showUsers,this.defaultValue.showUsers),showIssues:boolean$1(W.showIssues,this.defaultValue.showIssues)}}}class SmartSelect extends BaseEditorOption{constructor(){super(112,"smartSelect",{selectLeadingAndTrailingWhitespace:!0,selectSubwords:!0},{"editor.smartSelect.selectLeadingAndTrailingWhitespace":{description:localize("selectLeadingAndTrailingWhitespace","Whether leading and trailing whitespace should always be selected."),default:!0,type:"boolean"},"editor.smartSelect.selectSubwords":{description:localize("selectSubwords","Whether subwords (like 'foo' in 'fooBar' or 'foo_bar') should be selected."),default:!0,type:"boolean"}})}validate(C){return!C||typeof C!="object"?this.defaultValue:{selectLeadingAndTrailingWhitespace:boolean$1(C.selectLeadingAndTrailingWhitespace,this.defaultValue.selectLeadingAndTrailingWhitespace),selectSubwords:boolean$1(C.selectSubwords,this.defaultValue.selectSubwords)}}}class WrappingIndentOption extends BaseEditorOption{constructor(){super(136,"wrappingIndent",1,{"editor.wrappingIndent":{type:"string",enum:["none","same","indent","deepIndent"],enumDescriptions:[localize("wrappingIndent.none","No indentation. Wrapped lines begin at column 1."),localize("wrappingIndent.same","Wrapped lines get the same indentation as the parent."),localize("wrappingIndent.indent","Wrapped lines get +1 indentation toward the parent."),localize("wrappingIndent.deepIndent","Wrapped lines get +2 indentation toward the parent.")],description:localize("wrappingIndent","Controls the indentation of wrapped lines."),default:"same"}})}validate(C){switch(C){case"none":return 0;case"same":return 1;case"indent":return 2;case"deepIndent":return 3}return 1}compute(C,W,V){return W.get(2)===2?0:V}}class EditorWrappingInfoComputer extends ComputedEditorOption{constructor(){super(144)}compute(C,W,V){const U=W.get(143);return{isDominatedByLongLines:C.isDominatedByLongLines,isWordWrapMinified:U.isWordWrapMinified,isViewportWrapping:U.isViewportWrapping,wrappingColumn:U.wrappingColumn}}}class EditorDropIntoEditor extends BaseEditorOption{constructor(){const C={enabled:!0,showDropSelector:"afterDrop"};super(36,"dropIntoEditor",C,{"editor.dropIntoEditor.enabled":{type:"boolean",default:C.enabled,markdownDescription:localize("dropIntoEditor.enabled","Controls whether you can drag and drop a file into a text editor by holding down `shift` (instead of opening the file in an editor).")},"editor.dropIntoEditor.showDropSelector":{type:"string",markdownDescription:localize("dropIntoEditor.showDropSelector","Controls if a widget is shown when dropping files into the editor. This widget lets you control how the file is dropped."),enum:["afterDrop","never"],enumDescriptions:[localize("dropIntoEditor.showDropSelector.afterDrop","Show the drop selector widget after a file is dropped into the editor."),localize("dropIntoEditor.showDropSelector.never","Never show the drop selector widget. Instead the default drop provider is always used.")],default:"afterDrop"}})}validate(C){if(!C||typeof C!="object")return this.defaultValue;const W=C;return{enabled:boolean$1(W.enabled,this.defaultValue.enabled),showDropSelector:stringSet(W.showDropSelector,this.defaultValue.showDropSelector,["afterDrop","never"])}}}class EditorPasteAs extends BaseEditorOption{constructor(){const C={enabled:!0,showPasteSelector:"afterPaste"};super(84,"pasteAs",C,{"editor.pasteAs.enabled":{type:"boolean",default:C.enabled,markdownDescription:localize("pasteAs.enabled","Controls whether you can paste content in different ways.")},"editor.pasteAs.showPasteSelector":{type:"string",markdownDescription:localize("pasteAs.showPasteSelector","Controls if a widget is shown when pasting content in to the editor. This widget lets you control how the file is pasted."),enum:["afterPaste","never"],enumDescriptions:[localize("pasteAs.showPasteSelector.afterPaste","Show the paste selector widget after content is pasted into the editor."),localize("pasteAs.showPasteSelector.never","Never show the paste selector widget. Instead the default pasting behavior is always used.")],default:"afterPaste"}})}validate(C){if(!C||typeof C!="object")return this.defaultValue;const W=C;return{enabled:boolean$1(W.enabled,this.defaultValue.enabled),showPasteSelector:stringSet(W.showPasteSelector,this.defaultValue.showPasteSelector,["afterPaste","never"])}}}const DEFAULT_WINDOWS_FONT_FAMILY="Consolas, 'Courier New', monospace",DEFAULT_MAC_FONT_FAMILY="Menlo, Monaco, 'Courier New', monospace",DEFAULT_LINUX_FONT_FAMILY="'Droid Sans Mono', 'monospace', monospace",EDITOR_FONT_DEFAULTS={fontFamily:isMacintosh?DEFAULT_MAC_FONT_FAMILY:isLinux?DEFAULT_LINUX_FONT_FAMILY:DEFAULT_WINDOWS_FONT_FAMILY,fontWeight:"normal",fontSize:isMacintosh?12:14,lineHeight:0,letterSpacing:0},editorOptionsRegistry=[];function register$2(K){return editorOptionsRegistry[K.id]=K,K}const EditorOptions={acceptSuggestionOnCommitCharacter:register$2(new EditorBooleanOption(0,"acceptSuggestionOnCommitCharacter",!0,{markdownDescription:localize("acceptSuggestionOnCommitCharacter","Controls whether suggestions should be accepted on commit characters. For example, in JavaScript, the semi-colon (`;`) can be a commit character that accepts a suggestion and types that character.")})),acceptSuggestionOnEnter:register$2(new EditorStringEnumOption(1,"acceptSuggestionOnEnter","on",["on","smart","off"],{markdownEnumDescriptions:["",localize("acceptSuggestionOnEnterSmart","Only accept a suggestion with `Enter` when it makes a textual change."),""],markdownDescription:localize("acceptSuggestionOnEnter","Controls whether suggestions should be accepted on `Enter`, in addition to `Tab`. Helps to avoid ambiguity between inserting new lines or accepting suggestions.")})),accessibilitySupport:register$2(new EditorAccessibilitySupport),accessibilityPageSize:register$2(new EditorIntOption(3,"accessibilityPageSize",10,1,1073741824,{description:localize("accessibilityPageSize","Controls the number of lines in the editor that can be read out by a screen reader at once. When we detect a screen reader we automatically set the default to be 500. Warning: this has a performance implication for numbers larger than the default."),tags:["accessibility"]})),ariaLabel:register$2(new EditorStringOption(4,"ariaLabel",localize("editorViewAccessibleLabel","Editor content"))),ariaRequired:register$2(new EditorBooleanOption(5,"ariaRequired",!1,void 0)),screenReaderAnnounceInlineSuggestion:register$2(new EditorBooleanOption(8,"screenReaderAnnounceInlineSuggestion",!0,{description:localize("screenReaderAnnounceInlineSuggestion","Control whether inline suggestions are announced by a screen reader."),tags:["accessibility"]})),autoClosingBrackets:register$2(new EditorStringEnumOption(6,"autoClosingBrackets","languageDefined",["always","languageDefined","beforeWhitespace","never"],{enumDescriptions:["",localize("editor.autoClosingBrackets.languageDefined","Use language configurations to determine when to autoclose brackets."),localize("editor.autoClosingBrackets.beforeWhitespace","Autoclose brackets only when the cursor is to the left of whitespace."),""],description:localize("autoClosingBrackets","Controls whether the editor should automatically close brackets after the user adds an opening bracket.")})),autoClosingComments:register$2(new EditorStringEnumOption(7,"autoClosingComments","languageDefined",["always","languageDefined","beforeWhitespace","never"],{enumDescriptions:["",localize("editor.autoClosingComments.languageDefined","Use language configurations to determine when to autoclose comments."),localize("editor.autoClosingComments.beforeWhitespace","Autoclose comments only when the cursor is to the left of whitespace."),""],description:localize("autoClosingComments","Controls whether the editor should automatically close comments after the user adds an opening comment.")})),autoClosingDelete:register$2(new EditorStringEnumOption(9,"autoClosingDelete","auto",["always","auto","never"],{enumDescriptions:["",localize("editor.autoClosingDelete.auto","Remove adjacent closing quotes or brackets only if they were automatically inserted."),""],description:localize("autoClosingDelete","Controls whether the editor should remove adjacent closing quotes or brackets when deleting.")})),autoClosingOvertype:register$2(new EditorStringEnumOption(10,"autoClosingOvertype","auto",["always","auto","never"],{enumDescriptions:["",localize("editor.autoClosingOvertype.auto","Type over closing quotes or brackets only if they were automatically inserted."),""],description:localize("autoClosingOvertype","Controls whether the editor should type over closing quotes or brackets.")})),autoClosingQuotes:register$2(new EditorStringEnumOption(11,"autoClosingQuotes","languageDefined",["always","languageDefined","beforeWhitespace","never"],{enumDescriptions:["",localize("editor.autoClosingQuotes.languageDefined","Use language configurations to determine when to autoclose quotes."),localize("editor.autoClosingQuotes.beforeWhitespace","Autoclose quotes only when the cursor is to the left of whitespace."),""],description:localize("autoClosingQuotes","Controls whether the editor should automatically close quotes after the user adds an opening quote.")})),autoIndent:register$2(new EditorEnumOption(12,"autoIndent",4,"full",["none","keep","brackets","advanced","full"],_autoIndentFromString,{enumDescriptions:[localize("editor.autoIndent.none","The editor will not insert indentation automatically."),localize("editor.autoIndent.keep","The editor will keep the current line's indentation."),localize("editor.autoIndent.brackets","The editor will keep the current line's indentation and honor language defined brackets."),localize("editor.autoIndent.advanced","The editor will keep the current line's indentation, honor language defined brackets and invoke special onEnterRules defined by languages."),localize("editor.autoIndent.full","The editor will keep the current line's indentation, honor language defined brackets, invoke special onEnterRules defined by languages, and honor indentationRules defined by languages.")],description:localize("autoIndent","Controls whether the editor should automatically adjust the indentation when users type, paste, move or indent lines.")})),automaticLayout:register$2(new EditorBooleanOption(13,"automaticLayout",!1)),autoSurround:register$2(new EditorStringEnumOption(14,"autoSurround","languageDefined",["languageDefined","quotes","brackets","never"],{enumDescriptions:[localize("editor.autoSurround.languageDefined","Use language configurations to determine when to automatically surround selections."),localize("editor.autoSurround.quotes","Surround with quotes but not brackets."),localize("editor.autoSurround.brackets","Surround with brackets but not quotes."),""],description:localize("autoSurround","Controls whether the editor should automatically surround selections when typing quotes or brackets.")})),bracketPairColorization:register$2(new BracketPairColorization),bracketPairGuides:register$2(new GuideOptions),stickyTabStops:register$2(new EditorBooleanOption(115,"stickyTabStops",!1,{description:localize("stickyTabStops","Emulate selection behavior of tab characters when using spaces for indentation. Selection will stick to tab stops.")})),codeLens:register$2(new EditorBooleanOption(17,"codeLens",!0,{description:localize("codeLens","Controls whether the editor shows CodeLens.")})),codeLensFontFamily:register$2(new EditorStringOption(18,"codeLensFontFamily","",{description:localize("codeLensFontFamily","Controls the font family for CodeLens.")})),codeLensFontSize:register$2(new EditorIntOption(19,"codeLensFontSize",0,0,100,{type:"number",default:0,minimum:0,maximum:100,markdownDescription:localize("codeLensFontSize","Controls the font size in pixels for CodeLens. When set to 0, 90% of `#editor.fontSize#` is used.")})),colorDecorators:register$2(new EditorBooleanOption(20,"colorDecorators",!0,{description:localize("colorDecorators","Controls whether the editor should render the inline color decorators and color picker.")})),colorDecoratorActivatedOn:register$2(new EditorStringEnumOption(146,"colorDecoratorsActivatedOn","clickAndHover",["clickAndHover","hover","click"],{enumDescriptions:[localize("editor.colorDecoratorActivatedOn.clickAndHover","Make the color picker appear both on click and hover of the color decorator"),localize("editor.colorDecoratorActivatedOn.hover","Make the color picker appear on hover of the color decorator"),localize("editor.colorDecoratorActivatedOn.click","Make the color picker appear on click of the color decorator")],description:localize("colorDecoratorActivatedOn","Controls the condition to make a color picker appear from a color decorator")})),colorDecoratorsLimit:register$2(new EditorIntOption(21,"colorDecoratorsLimit",500,1,1e6,{markdownDescription:localize("colorDecoratorsLimit","Controls the max number of color decorators that can be rendered in an editor at once.")})),columnSelection:register$2(new EditorBooleanOption(22,"columnSelection",!1,{description:localize("columnSelection","Enable that the selection with the mouse and keys is doing column selection.")})),comments:register$2(new EditorComments),contextmenu:register$2(new EditorBooleanOption(24,"contextmenu",!0)),copyWithSyntaxHighlighting:register$2(new EditorBooleanOption(25,"copyWithSyntaxHighlighting",!0,{description:localize("copyWithSyntaxHighlighting","Controls whether syntax highlighting should be copied into the clipboard.")})),cursorBlinking:register$2(new EditorEnumOption(26,"cursorBlinking",1,"blink",["blink","smooth","phase","expand","solid"],_cursorBlinkingStyleFromString,{description:localize("cursorBlinking","Control the cursor animation style.")})),cursorSmoothCaretAnimation:register$2(new EditorStringEnumOption(27,"cursorSmoothCaretAnimation","off",["off","explicit","on"],{enumDescriptions:[localize("cursorSmoothCaretAnimation.off","Smooth caret animation is disabled."),localize("cursorSmoothCaretAnimation.explicit","Smooth caret animation is enabled only when the user moves the cursor with an explicit gesture."),localize("cursorSmoothCaretAnimation.on","Smooth caret animation is always enabled.")],description:localize("cursorSmoothCaretAnimation","Controls whether the smooth caret animation should be enabled.")})),cursorStyle:register$2(new EditorEnumOption(28,"cursorStyle",TextEditorCursorStyle$1.Line,"line",["line","block","underline","line-thin","block-outline","underline-thin"],_cursorStyleFromString,{description:localize("cursorStyle","Controls the cursor style.")})),cursorSurroundingLines:register$2(new EditorIntOption(29,"cursorSurroundingLines",0,0,1073741824,{description:localize("cursorSurroundingLines","Controls the minimal number of visible leading lines (minimum 0) and trailing lines (minimum 1) surrounding the cursor. Known as 'scrollOff' or 'scrollOffset' in some other editors.")})),cursorSurroundingLinesStyle:register$2(new EditorStringEnumOption(30,"cursorSurroundingLinesStyle","default",["default","all"],{enumDescriptions:[localize("cursorSurroundingLinesStyle.default","`cursorSurroundingLines` is enforced only when triggered via the keyboard or API."),localize("cursorSurroundingLinesStyle.all","`cursorSurroundingLines` is enforced always.")],markdownDescription:localize("cursorSurroundingLinesStyle","Controls when `#cursorSurroundingLines#` should be enforced.")})),cursorWidth:register$2(new EditorIntOption(31,"cursorWidth",0,0,1073741824,{markdownDescription:localize("cursorWidth","Controls the width of the cursor when `#editor.cursorStyle#` is set to `line`.")})),disableLayerHinting:register$2(new EditorBooleanOption(32,"disableLayerHinting",!1)),disableMonospaceOptimizations:register$2(new EditorBooleanOption(33,"disableMonospaceOptimizations",!1)),domReadOnly:register$2(new EditorBooleanOption(34,"domReadOnly",!1)),dragAndDrop:register$2(new EditorBooleanOption(35,"dragAndDrop",!0,{description:localize("dragAndDrop","Controls whether the editor should allow moving selections via drag and drop.")})),emptySelectionClipboard:register$2(new EditorEmptySelectionClipboard),dropIntoEditor:register$2(new EditorDropIntoEditor),stickyScroll:register$2(new EditorStickyScroll),experimentalWhitespaceRendering:register$2(new EditorStringEnumOption(38,"experimentalWhitespaceRendering","svg",["svg","font","off"],{enumDescriptions:[localize("experimentalWhitespaceRendering.svg","Use a new rendering method with svgs."),localize("experimentalWhitespaceRendering.font","Use a new rendering method with font characters."),localize("experimentalWhitespaceRendering.off","Use the stable rendering method.")],description:localize("experimentalWhitespaceRendering","Controls whether whitespace is rendered with a new, experimental method.")})),extraEditorClassName:register$2(new EditorStringOption(39,"extraEditorClassName","")),fastScrollSensitivity:register$2(new EditorFloatOption(40,"fastScrollSensitivity",5,K=>K<=0?5:K,{markdownDescription:localize("fastScrollSensitivity","Scrolling speed multiplier when pressing `Alt`.")})),find:register$2(new EditorFind),fixedOverflowWidgets:register$2(new EditorBooleanOption(42,"fixedOverflowWidgets",!1)),folding:register$2(new EditorBooleanOption(43,"folding",!0,{description:localize("folding","Controls whether the editor has code folding enabled.")})),foldingStrategy:register$2(new EditorStringEnumOption(44,"foldingStrategy","auto",["auto","indentation"],{enumDescriptions:[localize("foldingStrategy.auto","Use a language-specific folding strategy if available, else the indentation-based one."),localize("foldingStrategy.indentation","Use the indentation-based folding strategy.")],description:localize("foldingStrategy","Controls the strategy for computing folding ranges.")})),foldingHighlight:register$2(new EditorBooleanOption(45,"foldingHighlight",!0,{description:localize("foldingHighlight","Controls whether the editor should highlight folded ranges.")})),foldingImportsByDefault:register$2(new EditorBooleanOption(46,"foldingImportsByDefault",!1,{description:localize("foldingImportsByDefault","Controls whether the editor automatically collapses import ranges.")})),foldingMaximumRegions:register$2(new EditorIntOption(47,"foldingMaximumRegions",5e3,10,65e3,{description:localize("foldingMaximumRegions","The maximum number of foldable regions. Increasing this value may result in the editor becoming less responsive when the current source has a large number of foldable regions.")})),unfoldOnClickAfterEndOfLine:register$2(new EditorBooleanOption(48,"unfoldOnClickAfterEndOfLine",!1,{description:localize("unfoldOnClickAfterEndOfLine","Controls whether clicking on the empty content after a folded line will unfold the line.")})),fontFamily:register$2(new EditorStringOption(49,"fontFamily",EDITOR_FONT_DEFAULTS.fontFamily,{description:localize("fontFamily","Controls the font family.")})),fontInfo:register$2(new EditorFontInfo),fontLigatures2:register$2(new EditorFontLigatures),fontSize:register$2(new EditorFontSize),fontWeight:register$2(new EditorFontWeight),fontVariations:register$2(new EditorFontVariations),formatOnPaste:register$2(new EditorBooleanOption(55,"formatOnPaste",!1,{description:localize("formatOnPaste","Controls whether the editor should automatically format the pasted content. A formatter must be available and the formatter should be able to format a range in a document.")})),formatOnType:register$2(new EditorBooleanOption(56,"formatOnType",!1,{description:localize("formatOnType","Controls whether the editor should automatically format the line after typing.")})),glyphMargin:register$2(new EditorBooleanOption(57,"glyphMargin",!0,{description:localize("glyphMargin","Controls whether the editor should render the vertical glyph margin. Glyph margin is mostly used for debugging.")})),gotoLocation:register$2(new EditorGoToLocation),hideCursorInOverviewRuler:register$2(new EditorBooleanOption(59,"hideCursorInOverviewRuler",!1,{description:localize("hideCursorInOverviewRuler","Controls whether the cursor should be hidden in the overview ruler.")})),hover:register$2(new EditorHover),inDiffEditor:register$2(new EditorBooleanOption(61,"inDiffEditor",!1)),letterSpacing:register$2(new EditorFloatOption(63,"letterSpacing",EDITOR_FONT_DEFAULTS.letterSpacing,K=>EditorFloatOption.clamp(K,-5,20),{description:localize("letterSpacing","Controls the letter spacing in pixels.")})),lightbulb:register$2(new EditorLightbulb),lineDecorationsWidth:register$2(new EditorLineDecorationsWidth),lineHeight:register$2(new EditorLineHeight),lineNumbers:register$2(new EditorRenderLineNumbersOption),lineNumbersMinChars:register$2(new EditorIntOption(68,"lineNumbersMinChars",5,1,300)),linkedEditing:register$2(new EditorBooleanOption(69,"linkedEditing",!1,{description:localize("linkedEditing","Controls whether the editor has linked editing enabled. Depending on the language, related symbols such as HTML tags, are updated while editing.")})),links:register$2(new EditorBooleanOption(70,"links",!0,{description:localize("links","Controls whether the editor should detect links and make them clickable.")})),matchBrackets:register$2(new EditorStringEnumOption(71,"matchBrackets","always",["always","near","never"],{description:localize("matchBrackets","Highlight matching brackets.")})),minimap:register$2(new EditorMinimap),mouseStyle:register$2(new EditorStringEnumOption(73,"mouseStyle","text",["text","default","copy"])),mouseWheelScrollSensitivity:register$2(new EditorFloatOption(74,"mouseWheelScrollSensitivity",1,K=>K===0?1:K,{markdownDescription:localize("mouseWheelScrollSensitivity","A multiplier to be used on the `deltaX` and `deltaY` of mouse wheel scroll events.")})),mouseWheelZoom:register$2(new EditorBooleanOption(75,"mouseWheelZoom",!1,{markdownDescription:localize("mouseWheelZoom","Zoom the font of the editor when using mouse wheel and holding `Ctrl`.")})),multiCursorMergeOverlapping:register$2(new EditorBooleanOption(76,"multiCursorMergeOverlapping",!0,{description:localize("multiCursorMergeOverlapping","Merge multiple cursors when they are overlapping.")})),multiCursorModifier:register$2(new EditorEnumOption(77,"multiCursorModifier","altKey","alt",["ctrlCmd","alt"],_multiCursorModifierFromString,{markdownEnumDescriptions:[localize("multiCursorModifier.ctrlCmd","Maps to `Control` on Windows and Linux and to `Command` on macOS."),localize("multiCursorModifier.alt","Maps to `Alt` on Windows and Linux and to `Option` on macOS.")],markdownDescription:localize({key:"multiCursorModifier",comment:["- `ctrlCmd` refers to a value the setting can take and should not be localized.","- `Control` and `Command` refer to the modifier keys Ctrl or Cmd on the keyboard and can be localized."]},"The modifier to be used to add multiple cursors with the mouse. The Go to Definition and Open Link mouse gestures will adapt such that they do not conflict with the [multicursor modifier](https://code.visualstudio.com/docs/editor/codebasics#_multicursor-modifier).")})),multiCursorPaste:register$2(new EditorStringEnumOption(78,"multiCursorPaste","spread",["spread","full"],{markdownEnumDescriptions:[localize("multiCursorPaste.spread","Each cursor pastes a single line of the text."),localize("multiCursorPaste.full","Each cursor pastes the full text.")],markdownDescription:localize("multiCursorPaste","Controls pasting when the line count of the pasted text matches the cursor count.")})),multiCursorLimit:register$2(new EditorIntOption(79,"multiCursorLimit",1e4,1,1e5,{markdownDescription:localize("multiCursorLimit","Controls the max number of cursors that can be in an active editor at once.")})),occurrencesHighlight:register$2(new EditorBooleanOption(80,"occurrencesHighlight",!0,{description:localize("occurrencesHighlight","Controls whether the editor should highlight semantic symbol occurrences.")})),overviewRulerBorder:register$2(new EditorBooleanOption(81,"overviewRulerBorder",!0,{description:localize("overviewRulerBorder","Controls whether a border should be drawn around the overview ruler.")})),overviewRulerLanes:register$2(new EditorIntOption(82,"overviewRulerLanes",3,0,3)),padding:register$2(new EditorPadding),pasteAs:register$2(new EditorPasteAs),parameterHints:register$2(new EditorParameterHints),peekWidgetDefaultFocus:register$2(new EditorStringEnumOption(86,"peekWidgetDefaultFocus","tree",["tree","editor"],{enumDescriptions:[localize("peekWidgetDefaultFocus.tree","Focus the tree when opening peek"),localize("peekWidgetDefaultFocus.editor","Focus the editor when opening peek")],description:localize("peekWidgetDefaultFocus","Controls whether to focus the inline editor or the tree in the peek widget.")})),definitionLinkOpensInPeek:register$2(new EditorBooleanOption(87,"definitionLinkOpensInPeek",!1,{description:localize("definitionLinkOpensInPeek","Controls whether the Go to Definition mouse gesture always opens the peek widget.")})),quickSuggestions:register$2(new EditorQuickSuggestions),quickSuggestionsDelay:register$2(new EditorIntOption(89,"quickSuggestionsDelay",10,0,1073741824,{description:localize("quickSuggestionsDelay","Controls the delay in milliseconds after which quick suggestions will show up.")})),readOnly:register$2(new EditorBooleanOption(90,"readOnly",!1)),readOnlyMessage:register$2(new ReadonlyMessage),renameOnType:register$2(new EditorBooleanOption(92,"renameOnType",!1,{description:localize("renameOnType","Controls whether the editor auto renames on type."),markdownDeprecationMessage:localize("renameOnTypeDeprecate","Deprecated, use `editor.linkedEditing` instead.")})),renderControlCharacters:register$2(new EditorBooleanOption(93,"renderControlCharacters",!0,{description:localize("renderControlCharacters","Controls whether the editor should render control characters."),restricted:!0})),renderFinalNewline:register$2(new EditorStringEnumOption(94,"renderFinalNewline",isLinux?"dimmed":"on",["off","on","dimmed"],{description:localize("renderFinalNewline","Render last line number when the file ends with a newline.")})),renderLineHighlight:register$2(new EditorStringEnumOption(95,"renderLineHighlight","line",["none","gutter","line","all"],{enumDescriptions:["","","",localize("renderLineHighlight.all","Highlights both the gutter and the current line.")],description:localize("renderLineHighlight","Controls how the editor should render the current line highlight.")})),renderLineHighlightOnlyWhenFocus:register$2(new EditorBooleanOption(96,"renderLineHighlightOnlyWhenFocus",!1,{description:localize("renderLineHighlightOnlyWhenFocus","Controls if the editor should render the current line highlight only when the editor is focused.")})),renderValidationDecorations:register$2(new EditorStringEnumOption(97,"renderValidationDecorations","editable",["editable","on","off"])),renderWhitespace:register$2(new EditorStringEnumOption(98,"renderWhitespace","selection",["none","boundary","selection","trailing","all"],{enumDescriptions:["",localize("renderWhitespace.boundary","Render whitespace characters except for single spaces between words."),localize("renderWhitespace.selection","Render whitespace characters only on selected text."),localize("renderWhitespace.trailing","Render only trailing whitespace characters."),""],description:localize("renderWhitespace","Controls how the editor should render whitespace characters.")})),revealHorizontalRightPadding:register$2(new EditorIntOption(99,"revealHorizontalRightPadding",15,0,1e3)),roundedSelection:register$2(new EditorBooleanOption(100,"roundedSelection",!0,{description:localize("roundedSelection","Controls whether selections should have rounded corners.")})),rulers:register$2(new EditorRulers),scrollbar:register$2(new EditorScrollbar$1),scrollBeyondLastColumn:register$2(new EditorIntOption(103,"scrollBeyondLastColumn",4,0,1073741824,{description:localize("scrollBeyondLastColumn","Controls the number of extra characters beyond which the editor will scroll horizontally.")})),scrollBeyondLastLine:register$2(new EditorBooleanOption(104,"scrollBeyondLastLine",!0,{description:localize("scrollBeyondLastLine","Controls whether the editor will scroll beyond the last line.")})),scrollPredominantAxis:register$2(new EditorBooleanOption(105,"scrollPredominantAxis",!0,{description:localize("scrollPredominantAxis","Scroll only along the predominant axis when scrolling both vertically and horizontally at the same time. Prevents horizontal drift when scrolling vertically on a trackpad.")})),selectionClipboard:register$2(new EditorBooleanOption(106,"selectionClipboard",!0,{description:localize("selectionClipboard","Controls whether the Linux primary clipboard should be supported."),included:isLinux})),selectionHighlight:register$2(new EditorBooleanOption(107,"selectionHighlight",!0,{description:localize("selectionHighlight","Controls whether the editor should highlight matches similar to the selection.")})),selectOnLineNumbers:register$2(new EditorBooleanOption(108,"selectOnLineNumbers",!0)),showFoldingControls:register$2(new EditorStringEnumOption(109,"showFoldingControls","mouseover",["always","never","mouseover"],{enumDescriptions:[localize("showFoldingControls.always","Always show the folding controls."),localize("showFoldingControls.never","Never show the folding controls and reduce the gutter size."),localize("showFoldingControls.mouseover","Only show the folding controls when the mouse is over the gutter.")],description:localize("showFoldingControls","Controls when the folding controls on the gutter are shown.")})),showUnused:register$2(new EditorBooleanOption(110,"showUnused",!0,{description:localize("showUnused","Controls fading out of unused code.")})),showDeprecated:register$2(new EditorBooleanOption(138,"showDeprecated",!0,{description:localize("showDeprecated","Controls strikethrough deprecated variables.")})),inlayHints:register$2(new EditorInlayHints),snippetSuggestions:register$2(new EditorStringEnumOption(111,"snippetSuggestions","inline",["top","bottom","inline","none"],{enumDescriptions:[localize("snippetSuggestions.top","Show snippet suggestions on top of other suggestions."),localize("snippetSuggestions.bottom","Show snippet suggestions below other suggestions."),localize("snippetSuggestions.inline","Show snippets suggestions with other suggestions."),localize("snippetSuggestions.none","Do not show snippet suggestions.")],description:localize("snippetSuggestions","Controls whether snippets are shown with other suggestions and how they are sorted.")})),smartSelect:register$2(new SmartSelect),smoothScrolling:register$2(new EditorBooleanOption(113,"smoothScrolling",!1,{description:localize("smoothScrolling","Controls whether the editor will scroll using an animation.")})),stopRenderingLineAfter:register$2(new EditorIntOption(116,"stopRenderingLineAfter",1e4,-1,1073741824)),suggest:register$2(new EditorSuggest),inlineSuggest:register$2(new InlineEditorSuggest),inlineCompletionsAccessibilityVerbose:register$2(new EditorBooleanOption(147,"inlineCompletionsAccessibilityVerbose",!1,{description:localize("inlineCompletionsAccessibilityVerbose","Controls whether the accessibility hint should be provided to screen reader users when an inline completion is shown.")})),suggestFontSize:register$2(new EditorIntOption(118,"suggestFontSize",0,0,1e3,{markdownDescription:localize("suggestFontSize","Font size for the suggest widget. When set to {0}, the value of {1} is used.","`0`","`#editor.fontSize#`")})),suggestLineHeight:register$2(new EditorIntOption(119,"suggestLineHeight",0,0,1e3,{markdownDescription:localize("suggestLineHeight","Line height for the suggest widget. When set to {0}, the value of {1} is used. The minimum value is 8.","`0`","`#editor.lineHeight#`")})),suggestOnTriggerCharacters:register$2(new EditorBooleanOption(120,"suggestOnTriggerCharacters",!0,{description:localize("suggestOnTriggerCharacters","Controls whether suggestions should automatically show up when typing trigger characters.")})),suggestSelection:register$2(new EditorStringEnumOption(121,"suggestSelection","first",["first","recentlyUsed","recentlyUsedByPrefix"],{markdownEnumDescriptions:[localize("suggestSelection.first","Always select the first suggestion."),localize("suggestSelection.recentlyUsed","Select recent suggestions unless further typing selects one, e.g. `console.| -> console.log` because `log` has been completed recently."),localize("suggestSelection.recentlyUsedByPrefix","Select suggestions based on previous prefixes that have completed those suggestions, e.g. `co -> console` and `con -> const`.")],description:localize("suggestSelection","Controls how suggestions are pre-selected when showing the suggest list.")})),tabCompletion:register$2(new EditorStringEnumOption(122,"tabCompletion","off",["on","off","onlySnippets"],{enumDescriptions:[localize("tabCompletion.on","Tab complete will insert the best matching suggestion when pressing tab."),localize("tabCompletion.off","Disable tab completions."),localize("tabCompletion.onlySnippets","Tab complete snippets when their prefix match. Works best when 'quickSuggestions' aren't enabled.")],description:localize("tabCompletion","Enables tab completions.")})),tabIndex:register$2(new EditorIntOption(123,"tabIndex",0,-1,1073741824)),unicodeHighlight:register$2(new UnicodeHighlight),unusualLineTerminators:register$2(new EditorStringEnumOption(125,"unusualLineTerminators","prompt",["auto","off","prompt"],{enumDescriptions:[localize("unusualLineTerminators.auto","Unusual line terminators are automatically removed."),localize("unusualLineTerminators.off","Unusual line terminators are ignored."),localize("unusualLineTerminators.prompt","Unusual line terminators prompt to be removed.")],description:localize("unusualLineTerminators","Remove unusual line terminators that might cause problems.")})),useShadowDOM:register$2(new EditorBooleanOption(126,"useShadowDOM",!0)),useTabStops:register$2(new EditorBooleanOption(127,"useTabStops",!0,{description:localize("useTabStops","Inserting and deleting whitespace follows tab stops.")})),wordBreak:register$2(new EditorStringEnumOption(128,"wordBreak","normal",["normal","keepAll"],{markdownEnumDescriptions:[localize("wordBreak.normal","Use the default line break rule."),localize("wordBreak.keepAll","Word breaks should not be used for Chinese/Japanese/Korean (CJK) text. Non-CJK text behavior is the same as for normal.")],description:localize("wordBreak","Controls the word break rules used for Chinese/Japanese/Korean (CJK) text.")})),wordSeparators:register$2(new EditorStringOption(129,"wordSeparators",USUAL_WORD_SEPARATORS,{description:localize("wordSeparators","Characters that will be used as word separators when doing word related navigations or operations.")})),wordWrap:register$2(new EditorStringEnumOption(130,"wordWrap","off",["off","on","wordWrapColumn","bounded"],{markdownEnumDescriptions:[localize("wordWrap.off","Lines will never wrap."),localize("wordWrap.on","Lines will wrap at the viewport width."),localize({key:"wordWrap.wordWrapColumn",comment:["- `editor.wordWrapColumn` refers to a different setting and should not be localized."]},"Lines will wrap at `#editor.wordWrapColumn#`."),localize({key:"wordWrap.bounded",comment:["- viewport means the edge of the visible window size.","- `editor.wordWrapColumn` refers to a different setting and should not be localized."]},"Lines will wrap at the minimum of viewport and `#editor.wordWrapColumn#`.")],description:localize({key:"wordWrap",comment:["- 'off', 'on', 'wordWrapColumn' and 'bounded' refer to values the setting can take and should not be localized.","- `editor.wordWrapColumn` refers to a different setting and should not be localized."]},"Controls how lines should wrap.")})),wordWrapBreakAfterCharacters:register$2(new EditorStringOption(131,"wordWrapBreakAfterCharacters"," 	})]?|/&.,;¢°′″‰℃、。｡､￠，．：；？！％・･ゝゞヽヾーァィゥェォッャュョヮヵヶぁぃぅぇぉっゃゅょゎゕゖㇰㇱㇲㇳㇴㇵㇶㇷㇸㇹㇺㇻㇼㇽㇾㇿ々〻ｧｨｩｪｫｬｭｮｯｰ”〉》」』】〕）］｝｣")),wordWrapBreakBeforeCharacters:register$2(new EditorStringOption(132,"wordWrapBreakBeforeCharacters","([{‘“〈《「『【〔（［｛｢£¥＄￡￥+＋")),wordWrapColumn:register$2(new EditorIntOption(133,"wordWrapColumn",80,1,1073741824,{markdownDescription:localize({key:"wordWrapColumn",comment:["- `editor.wordWrap` refers to a different setting and should not be localized.","- 'wordWrapColumn' and 'bounded' refer to values the different setting can take and should not be localized."]},"Controls the wrapping column of the editor when `#editor.wordWrap#` is `wordWrapColumn` or `bounded`.")})),wordWrapOverride1:register$2(new EditorStringEnumOption(134,"wordWrapOverride1","inherit",["off","on","inherit"])),wordWrapOverride2:register$2(new EditorStringEnumOption(135,"wordWrapOverride2","inherit",["off","on","inherit"])),editorClassName:register$2(new EditorClassName),defaultColorDecorators:register$2(new EditorBooleanOption(145,"defaultColorDecorators",!1,{markdownDescription:localize("defaultColorDecorators","Controls whether inline color decorations should be shown using the default document color provider")})),pixelRatio:register$2(new EditorPixelRatio),tabFocusMode:register$2(new EditorBooleanOption(142,"tabFocusMode",!1,{markdownDescription:localize("tabFocusMode","Controls whether the editor receives tabs or defers them to the workbench for navigation.")})),layoutInfo:register$2(new EditorLayoutInfoComputer),wrappingInfo:register$2(new EditorWrappingInfoComputer),wrappingIndent:register$2(new WrappingIndentOption),wrappingStrategy:register$2(new WrappingStrategy)};class ErrorHandler{constructor(){this.listeners=[],this.unexpectedErrorHandler=function(C){setTimeout(()=>{throw C.stack?ErrorNoTelemetry.isErrorNoTelemetry(C)?new ErrorNoTelemetry(C.message+`

`+C.stack):new Error(C.message+`

`+C.stack):C},0)}}emit(C){this.listeners.forEach(W=>{W(C)})}onUnexpectedError(C){this.unexpectedErrorHandler(C),this.emit(C)}onUnexpectedExternalError(C){this.unexpectedErrorHandler(C)}}const errorHandler=new ErrorHandler;function onUnexpectedError(K){isCancellationError(K)||errorHandler.onUnexpectedError(K)}function onUnexpectedExternalError(K){isCancellationError(K)||errorHandler.onUnexpectedExternalError(K)}function transformErrorForSerialization(K){if(K instanceof Error){const{name:C,message:W}=K,V=K.stacktrace||K.stack;return{$isError:!0,name:C,message:W,stack:V,noTelemetry:ErrorNoTelemetry.isErrorNoTelemetry(K)}}return K}const canceledName="Canceled";function isCancellationError(K){return K instanceof CancellationError?!0:K instanceof Error&&K.name===canceledName&&K.message===canceledName}class CancellationError extends Error{constructor(){super(canceledName),this.name=this.message}}function canceled(){const K=new Error(canceledName);return K.name=K.message,K}function illegalArgument(K){return K?new Error(`Illegal argument: ${K}`):new Error("Illegal argument")}function illegalState(K){return K?new Error(`Illegal state: ${K}`):new Error("Illegal state")}class NotSupportedError extends Error{constructor(C){super("NotSupported"),C&&(this.message=C)}}class ErrorNoTelemetry extends Error{constructor(C){super(C),this.name="CodeExpectedError"}static fromError(C){if(C instanceof ErrorNoTelemetry)return C;const W=new ErrorNoTelemetry;return W.message=C.message,W.stack=C.stack,W}static isErrorNoTelemetry(C){return C.name==="CodeExpectedError"}}class BugIndicatingError extends Error{constructor(C){super(C||"An unexpected bug occurred."),Object.setPrototypeOf(this,BugIndicatingError.prototype)}}function createSingleCallFunction(K){const C=this;let W=!1,V;return function(){return W||(W=!0,V=K.apply(C,arguments)),V}}function trackDisposable(K){return K}function setParentOfDisposable(K,C){}function markAsSingleton(K){return K}function isDisposable(K){return typeof K.dispose=="function"&&K.dispose.length===0}function dispose(K){if(Iterable.is(K)){const C=[];for(const W of K)if(W)try{W.dispose()}catch(V){C.push(V)}if(C.length===1)throw C[0];if(C.length>1)throw new AggregateError(C,"Encountered errors while disposing of store");return Array.isArray(K)?[]:K}else if(K)return K.dispose(),K}function combinedDisposable(...K){return toDisposable(()=>dispose(K))}function toDisposable(K){return{dispose:createSingleCallFunction(()=>{K()})}}class DisposableStore{constructor(){this._toDispose=new Set,this._isDisposed=!1}dispose(){this._isDisposed||(this._isDisposed=!0,this.clear())}get isDisposed(){return this._isDisposed}clear(){if(this._toDispose.size!==0)try{dispose(this._toDispose)}finally{this._toDispose.clear()}}add(C){if(!C)return C;if(C===this)throw new Error("Cannot register a disposable on itself!");return this._isDisposed?DisposableStore.DISABLE_DISPOSED_WARNING||console.warn(new Error("Trying to add a disposable to a DisposableStore that has already been disposed of. The added object will be leaked!").stack):this._toDispose.add(C),C}deleteAndLeak(C){C&&this._toDispose.has(C)&&this._toDispose.delete(C)}}DisposableStore.DISABLE_DISPOSED_WARNING=!1;class Disposable{constructor(){this._store=new DisposableStore,this._store}dispose(){this._store.dispose()}_register(C){if(C===this)throw new Error("Cannot register a disposable on itself!");return this._store.add(C)}}Disposable.None=Object.freeze({dispose(){}});class MutableDisposable{constructor(){this._isDisposed=!1}get value(){return this._isDisposed?void 0:this._value}set value(C){var W;this._isDisposed||C===this._value||((W=this._value)===null||W===void 0||W.dispose(),this._value=C)}clear(){this.value=void 0}dispose(){var C;this._isDisposed=!0,(C=this._value)===null||C===void 0||C.dispose(),this._value=void 0}}class RefCountedDisposable{constructor(C){this._disposable=C,this._counter=1}acquire(){return this._counter++,this}release(){return--this._counter===0&&this._disposable.dispose(),this}}class ImmortalReference{constructor(C){this.object=C}dispose(){}}class DisposableMap{constructor(){this._store=new Map,this._isDisposed=!1}dispose(){this._isDisposed=!0,this.clearAndDisposeAll()}clearAndDisposeAll(){if(this._store.size)try{dispose(this._store.values())}finally{this._store.clear()}}get(C){return this._store.get(C)}set(C,W,V=!1){var U;this._isDisposed&&console.warn(new Error("Trying to add a disposable to a DisposableMap that has already been disposed of. The added object will be leaked!").stack),V||(U=this._store.get(C))===null||U===void 0||U.dispose(),this._store.set(C,W)}deleteAndDispose(C){var W;(W=this._store.get(C))===null||W===void 0||W.dispose(),this._store.delete(C)}[Symbol.iterator](){return this._store[Symbol.iterator]()}}const hasPerformanceNow=globalThis.performance&&typeof globalThis.performance.now=="function";class StopWatch{static create(C){return new StopWatch(C)}constructor(C){this._now=hasPerformanceNow&&C===!1?Date.now:globalThis.performance.now.bind(globalThis.performance),this._startTime=this._now(),this._stopTime=-1}stop(){this._stopTime=this._now()}elapsed(){return this._stopTime!==-1?this._stopTime-this._startTime:this._now()-this._startTime}}var Event$1;(function(K){K.None=()=>Disposable.None;function C(be,Ce){return te(be,()=>{},0,void 0,!0,void 0,Ce)}K.defer=C;function W(be){return(Ce,De=null,ke)=>{let Me=!1,Oe;return Oe=be(Be=>{if(!Me)return Oe?Oe.dispose():Me=!0,Ce.call(De,Be)},null,ke),Me&&Oe.dispose(),Oe}}K.once=W;function V(be,Ce,De){return J((ke,Me=null,Oe)=>be(Be=>ke.call(Me,Ce(Be)),null,Oe),De)}K.map=V;function U(be,Ce,De){return J((ke,Me=null,Oe)=>be(Be=>{Ce(Be),ke.call(Me,Be)},null,Oe),De)}K.forEach=U;function G(be,Ce,De){return J((ke,Me=null,Oe)=>be(Be=>Ce(Be)&&ke.call(Me,Be),null,Oe),De)}K.filter=G;function Z(be){return be}K.signal=Z;function X(...be){return(Ce,De=null,ke)=>{const Me=combinedDisposable(...be.map(Oe=>Oe(Be=>Ce.call(De,Be))));return ee(Me,ke)}}K.any=X;function Q(be,Ce,De,ke){let Me=De;return V(be,Oe=>(Me=Ce(Me,Oe),Me),ke)}K.reduce=Q;function J(be,Ce){let De;const ke={onWillAddFirstListener(){De=be(Me.fire,Me)},onDidRemoveLastListener(){De==null||De.dispose()}},Me=new Emitter$1(ke);return Ce==null||Ce.add(Me),Me.event}function ee(be,Ce){return Ce instanceof Array?Ce.push(be):Ce&&Ce.add(be),be}function te(be,Ce,De=100,ke=!1,Me=!1,Oe,Be){let Pe,Ue,ze,Fe=0,Ae;const ot={leakWarningThreshold:Oe,onWillAddFirstListener(){Pe=be(rt=>{Fe++,Ue=Ce(Ue,rt),ke&&!ze&&(ft.fire(Ue),Ue=void 0),Ae=()=>{const Xe=Ue;Ue=void 0,ze=void 0,(!ke||Fe>1)&&ft.fire(Xe),Fe=0},typeof De=="number"?(clearTimeout(ze),ze=setTimeout(Ae,De)):ze===void 0&&(ze=0,queueMicrotask(Ae))})},onWillRemoveListener(){Me&&Fe>0&&(Ae==null||Ae())},onDidRemoveLastListener(){Ae=void 0,Pe.dispose()}},ft=new Emitter$1(ot);return Be==null||Be.add(ft),ft.event}K.debounce=te;function ie(be,Ce=0,De){return K.debounce(be,(ke,Me)=>ke?(ke.push(Me),ke):[Me],Ce,void 0,!0,void 0,De)}K.accumulate=ie;function ne(be,Ce=(ke,Me)=>ke===Me,De){let ke=!0,Me;return G(be,Oe=>{const Be=ke||!Ce(Oe,Me);return ke=!1,Me=Oe,Be},De)}K.latch=ne;function oe(be,Ce,De){return[K.filter(be,Ce,De),K.filter(be,ke=>!Ce(ke),De)]}K.split=oe;function re(be,Ce=!1,De=[],ke){let Me=De.slice(),Oe=be(Ue=>{Me?Me.push(Ue):Pe.fire(Ue)});ke&&ke.add(Oe);const Be=()=>{Me==null||Me.forEach(Ue=>Pe.fire(Ue)),Me=null},Pe=new Emitter$1({onWillAddFirstListener(){Oe||(Oe=be(Ue=>Pe.fire(Ue)),ke&&ke.add(Oe))},onDidAddFirstListener(){Me&&(Ce?setTimeout(Be):Be())},onDidRemoveLastListener(){Oe&&Oe.dispose(),Oe=null}});return ke&&ke.add(Pe),Pe.event}K.buffer=re;function ae(be,Ce){return(ke,Me,Oe)=>{const Be=Ce(new le);return be(function(Pe){const Ue=Be.evaluate(Pe);Ue!==se&&ke.call(Me,Ue)},void 0,Oe)}}K.chain=ae;const se=Symbol("HaltChainable");class le{constructor(){this.steps=[]}map(Ce){return this.steps.push(Ce),this}forEach(Ce){return this.steps.push(De=>(Ce(De),De)),this}filter(Ce){return this.steps.push(De=>Ce(De)?De:se),this}reduce(Ce,De){let ke=De;return this.steps.push(Me=>(ke=Ce(ke,Me),ke)),this}latch(Ce=(De,ke)=>De===ke){let De=!0,ke;return this.steps.push(Me=>{const Oe=De||!Ce(Me,ke);return De=!1,ke=Me,Oe?Me:se}),this}evaluate(Ce){for(const De of this.steps)if(Ce=De(Ce),Ce===se)break;return Ce}}function ce(be,Ce,De=ke=>ke){const ke=(...Pe)=>Be.fire(De(...Pe)),Me=()=>be.on(Ce,ke),Oe=()=>be.removeListener(Ce,ke),Be=new Emitter$1({onWillAddFirstListener:Me,onDidRemoveLastListener:Oe});return Be.event}K.fromNodeEventEmitter=ce;function de(be,Ce,De=ke=>ke){const ke=(...Pe)=>Be.fire(De(...Pe)),Me=()=>be.addEventListener(Ce,ke),Oe=()=>be.removeEventListener(Ce,ke),Be=new Emitter$1({onWillAddFirstListener:Me,onDidRemoveLastListener:Oe});return Be.event}K.fromDOMEventEmitter=de;function ue(be){return new Promise(Ce=>W(be)(Ce))}K.toPromise=ue;function ge(be){const Ce=new Emitter$1;return be.then(De=>{Ce.fire(De)},()=>{Ce.fire(void 0)}).finally(()=>{Ce.dispose()}),Ce.event}K.fromPromise=ge;function he(be,Ce){return Ce(void 0),be(De=>Ce(De))}K.runAndSubscribe=he;function fe(be,Ce){let De=null;function ke(Oe){De==null||De.dispose(),De=new DisposableStore,Ce(Oe,De)}ke(void 0);const Me=be(Oe=>ke(Oe));return toDisposable(()=>{Me.dispose(),De==null||De.dispose()})}K.runAndSubscribeWithStore=fe;class pe{constructor(Ce,De){this._observable=Ce,this._counter=0,this._hasChanged=!1;const ke={onWillAddFirstListener:()=>{Ce.addObserver(this)},onDidRemoveLastListener:()=>{Ce.removeObserver(this)}};this.emitter=new Emitter$1(ke),De&&De.add(this.emitter)}beginUpdate(Ce){this._counter++}handlePossibleChange(Ce){}handleChange(Ce,De){this._hasChanged=!0}endUpdate(Ce){this._counter--,this._counter===0&&(this._observable.reportChanges(),this._hasChanged&&(this._hasChanged=!1,this.emitter.fire(this._observable.get())))}}function Se(be,Ce){return new pe(be,Ce).emitter.event}K.fromObservable=Se;function Le(be){return Ce=>{let De=0,ke=!1;const Me={beginUpdate(){De++},endUpdate(){De--,De===0&&(be.reportChanges(),ke&&(ke=!1,Ce()))},handlePossibleChange(){},handleChange(){ke=!0}};return be.addObserver(Me),be.reportChanges(),{dispose(){be.removeObserver(Me)}}}}K.fromObservableLight=Le})(Event$1||(Event$1={}));class EventProfiling{constructor(C){this.listenerCount=0,this.invocationCount=0,this.elapsedOverall=0,this.durations=[],this.name=`${C}_${EventProfiling._idPool++}`,EventProfiling.all.add(this)}start(C){this._stopWatch=new StopWatch,this.listenerCount=C}stop(){if(this._stopWatch){const C=this._stopWatch.elapsed();this.durations.push(C),this.elapsedOverall+=C,this.invocationCount+=1,this._stopWatch=void 0}}}EventProfiling.all=new Set;EventProfiling._idPool=0;let _globalLeakWarningThreshold=-1;class LeakageMonitor{constructor(C,W=Math.random().toString(18).slice(2,5)){this.threshold=C,this.name=W,this._warnCountdown=0}dispose(){var C;(C=this._stacks)===null||C===void 0||C.clear()}check(C,W){const V=this.threshold;if(V<=0||W<V)return;this._stacks||(this._stacks=new Map);const U=this._stacks.get(C.value)||0;if(this._stacks.set(C.value,U+1),this._warnCountdown-=1,this._warnCountdown<=0){this._warnCountdown=V*.5;let G,Z=0;for(const[X,Q]of this._stacks)(!G||Z<Q)&&(G=X,Z=Q);console.warn(`[${this.name}] potential listener LEAK detected, having ${W} listeners already. MOST frequent listener (${Z}):`),console.warn(G)}return()=>{const G=this._stacks.get(C.value)||0;this._stacks.set(C.value,G-1)}}}class Stacktrace{static create(){var C;return new Stacktrace((C=new Error().stack)!==null&&C!==void 0?C:"")}constructor(C){this.value=C}print(){console.warn(this.value.split(`
`).slice(2).join(`
`))}}class UniqueContainer{constructor(C){this.value=C}}const compactionThreshold=2;let Emitter$1=class{constructor(C){var W,V,U,G,Z;this._size=0,this._options=C,this._leakageMon=!((W=this._options)===null||W===void 0)&&W.leakWarningThreshold?new LeakageMonitor((U=(V=this._options)===null||V===void 0?void 0:V.leakWarningThreshold)!==null&&U!==void 0?U:_globalLeakWarningThreshold):void 0,this._perfMon=!((G=this._options)===null||G===void 0)&&G._profName?new EventProfiling(this._options._profName):void 0,this._deliveryQueue=(Z=this._options)===null||Z===void 0?void 0:Z.deliveryQueue}dispose(){var C,W,V,U;this._disposed||(this._disposed=!0,((C=this._deliveryQueue)===null||C===void 0?void 0:C.current)===this&&this._deliveryQueue.reset(),this._listeners&&(this._listeners=void 0,this._size=0),(V=(W=this._options)===null||W===void 0?void 0:W.onDidRemoveLastListener)===null||V===void 0||V.call(W),(U=this._leakageMon)===null||U===void 0||U.dispose())}get event(){var C;return(C=this._event)!==null&&C!==void 0||(this._event=(W,V,U)=>{var G,Z,X,Q,J;if(this._leakageMon&&this._size>this._leakageMon.threshold*3)return console.warn(`[${this._leakageMon.name}] REFUSES to accept new listeners because it exceeded its threshold by far`),Disposable.None;if(this._disposed)return Disposable.None;V&&(W=W.bind(V));const ee=new UniqueContainer(W);let te;this._leakageMon&&this._size>=Math.ceil(this._leakageMon.threshold*.2)&&(ee.stack=Stacktrace.create(),te=this._leakageMon.check(ee.stack,this._size+1)),this._listeners?this._listeners instanceof UniqueContainer?((J=this._deliveryQueue)!==null&&J!==void 0||(this._deliveryQueue=new EventDeliveryQueuePrivate),this._listeners=[this._listeners,ee]):this._listeners.push(ee):((Z=(G=this._options)===null||G===void 0?void 0:G.onWillAddFirstListener)===null||Z===void 0||Z.call(G,this),this._listeners=ee,(Q=(X=this._options)===null||X===void 0?void 0:X.onDidAddFirstListener)===null||Q===void 0||Q.call(X,this)),this._size++;const ie=toDisposable(()=>{te==null||te(),this._removeListener(ee)});return U instanceof DisposableStore?U.add(ie):Array.isArray(U)&&U.push(ie),ie}),this._event}_removeListener(C){var W,V,U,G;if((V=(W=this._options)===null||W===void 0?void 0:W.onWillRemoveListener)===null||V===void 0||V.call(W,this),!this._listeners)return;if(this._size===1){this._listeners=void 0,(G=(U=this._options)===null||U===void 0?void 0:U.onDidRemoveLastListener)===null||G===void 0||G.call(U,this),this._size=0;return}const Z=this._listeners,X=Z.indexOf(C);if(X===-1)throw console.log("disposed?",this._disposed),console.log("size?",this._size),console.log("arr?",JSON.stringify(this._listeners)),new Error("Attempted to dispose unknown listener");this._size--,Z[X]=void 0;const Q=this._deliveryQueue.current===this;if(this._size*compactionThreshold<=Z.length){let J=0;for(let ee=0;ee<Z.length;ee++)Z[ee]?Z[J++]=Z[ee]:Q&&(this._deliveryQueue.end--,J<this._deliveryQueue.i&&this._deliveryQueue.i--);Z.length=J}}_deliver(C,W){var V;if(!C)return;const U=((V=this._options)===null||V===void 0?void 0:V.onListenerError)||onUnexpectedError;if(!U){C.value(W);return}try{C.value(W)}catch(G){U(G)}}_deliverQueue(C){const W=C.current._listeners;for(;C.i<C.end;)this._deliver(W[C.i++],C.value);C.reset()}fire(C){var W,V,U,G;if(!((W=this._deliveryQueue)===null||W===void 0)&&W.current&&(this._deliverQueue(this._deliveryQueue),(V=this._perfMon)===null||V===void 0||V.stop()),(U=this._perfMon)===null||U===void 0||U.start(this._size),this._listeners)if(this._listeners instanceof UniqueContainer)this._deliver(this._listeners,C);else{const Z=this._deliveryQueue;Z.enqueue(this,C,this._listeners.length),this._deliverQueue(Z)}(G=this._perfMon)===null||G===void 0||G.stop()}hasListeners(){return this._size>0}};const createEventDeliveryQueue=()=>new EventDeliveryQueuePrivate;class EventDeliveryQueuePrivate{constructor(){this.i=-1,this.end=0}enqueue(C,W,V){this.i=0,this.end=V,this.current=C,this.value=W}reset(){this.i=this.end,this.current=void 0,this.value=void 0}}class PauseableEmitter extends Emitter$1{constructor(C){super(C),this._isPaused=0,this._eventQueue=new LinkedList,this._mergeFn=C==null?void 0:C.merge}pause(){this._isPaused++}resume(){if(this._isPaused!==0&&--this._isPaused===0)if(this._mergeFn){if(this._eventQueue.size>0){const C=Array.from(this._eventQueue);this._eventQueue.clear(),super.fire(this._mergeFn(C))}}else for(;!this._isPaused&&this._eventQueue.size!==0;)super.fire(this._eventQueue.shift())}fire(C){this._size&&(this._isPaused!==0?this._eventQueue.push(C):super.fire(C))}}class DebounceEmitter extends PauseableEmitter{constructor(C){var W;super(C),this._delay=(W=C.delay)!==null&&W!==void 0?W:100}fire(C){this._handle||(this.pause(),this._handle=setTimeout(()=>{this._handle=void 0,this.resume()},this._delay)),super.fire(C)}}class MicrotaskEmitter extends Emitter$1{constructor(C){super(C),this._queuedEvents=[],this._mergeFn=C==null?void 0:C.merge}fire(C){this.hasListeners()&&(this._queuedEvents.push(C),this._queuedEvents.length===1&&queueMicrotask(()=>{this._mergeFn?super.fire(this._mergeFn(this._queuedEvents)):this._queuedEvents.forEach(W=>super.fire(W)),this._queuedEvents=[]}))}}class EventMultiplexer{constructor(){this.hasListeners=!1,this.events=[],this.emitter=new Emitter$1({onWillAddFirstListener:()=>this.onFirstListenerAdd(),onDidRemoveLastListener:()=>this.onLastListenerRemove()})}get event(){return this.emitter.event}add(C){const W={event:C,listener:null};return this.events.push(W),this.hasListeners&&this.hook(W),toDisposable(createSingleCallFunction(()=>{this.hasListeners&&this.unhook(W);const U=this.events.indexOf(W);this.events.splice(U,1)}))}onFirstListenerAdd(){this.hasListeners=!0,this.events.forEach(C=>this.hook(C))}onLastListenerRemove(){this.hasListeners=!1,this.events.forEach(C=>this.unhook(C))}hook(C){C.listener=C.event(W=>this.emitter.fire(W))}unhook(C){C.listener&&C.listener.dispose(),C.listener=null}dispose(){this.emitter.dispose()}}class EventBufferer{constructor(){this.buffers=[]}wrapEvent(C){return(W,V,U)=>C(G=>{const Z=this.buffers[this.buffers.length-1];Z?Z.push(()=>W.call(V,G)):W.call(V,G)},void 0,U)}bufferEvents(C){const W=[];this.buffers.push(W);const V=C();return this.buffers.pop(),W.forEach(U=>U()),V}}class Relay{constructor(){this.listening=!1,this.inputEvent=Event$1.None,this.inputEventListener=Disposable.None,this.emitter=new Emitter$1({onDidAddFirstListener:()=>{this.listening=!0,this.inputEventListener=this.inputEvent(this.emitter.fire,this.emitter)},onDidRemoveLastListener:()=>{this.listening=!1,this.inputEventListener.dispose()}}),this.event=this.emitter.event}set input(C){this.inputEvent=C,this.listening&&(this.inputEventListener.dispose(),this.inputEventListener=C(this.emitter.fire,this.emitter))}dispose(){this.inputEventListener.dispose(),this.emitter.dispose()}}const shortcutEvent=Object.freeze(function(K,C){const W=setTimeout(K.bind(C),0);return{dispose(){clearTimeout(W)}}});var CancellationToken;(function(K){function C(W){return W===K.None||W===K.Cancelled||W instanceof MutableToken?!0:!W||typeof W!="object"?!1:typeof W.isCancellationRequested=="boolean"&&typeof W.onCancellationRequested=="function"}K.isCancellationToken=C,K.None=Object.freeze({isCancellationRequested:!1,onCancellationRequested:Event$1.None}),K.Cancelled=Object.freeze({isCancellationRequested:!0,onCancellationRequested:shortcutEvent})})(CancellationToken||(CancellationToken={}));class MutableToken{constructor(){this._isCancelled=!1,this._emitter=null}cancel(){this._isCancelled||(this._isCancelled=!0,this._emitter&&(this._emitter.fire(void 0),this.dispose()))}get isCancellationRequested(){return this._isCancelled}get onCancellationRequested(){return this._isCancelled?shortcutEvent:(this._emitter||(this._emitter=new Emitter$1),this._emitter.event)}dispose(){this._emitter&&(this._emitter.dispose(),this._emitter=null)}}let CancellationTokenSource$1=class{constructor(C){this._token=void 0,this._parentListener=void 0,this._parentListener=C&&C.onCancellationRequested(this.cancel,this)}get token(){return this._token||(this._token=new MutableToken),this._token}cancel(){this._token?this._token instanceof MutableToken&&this._token.cancel():this._token=CancellationToken.Cancelled}dispose(C=!1){var W;C&&this.cancel(),(W=this._parentListener)===null||W===void 0||W.dispose(),this._token?this._token instanceof MutableToken&&this._token.dispose():this._token=CancellationToken.None}};class KeyCodeStrMap{constructor(){this._keyCodeToStr=[],this._strToKeyCode=Object.create(null)}define(C,W){this._keyCodeToStr[C]=W,this._strToKeyCode[W.toLowerCase()]=C}keyCodeToStr(C){return this._keyCodeToStr[C]}strToKeyCode(C){return this._strToKeyCode[C.toLowerCase()]||0}}const uiMap=new KeyCodeStrMap,userSettingsUSMap=new KeyCodeStrMap,userSettingsGeneralMap=new KeyCodeStrMap,EVENT_KEY_CODE_MAP=new Array(230),scanCodeStrToInt=Object.create(null),scanCodeLowerCaseStrToInt=Object.create(null),IMMUTABLE_CODE_TO_KEY_CODE=[];for(let K=0;K<=193;K++)IMMUTABLE_CODE_TO_KEY_CODE[K]=-1;(function(){const K="",C=[[1,0,"None",0,"unknown",0,"VK_UNKNOWN",K,K],[1,1,"Hyper",0,K,0,K,K,K],[1,2,"Super",0,K,0,K,K,K],[1,3,"Fn",0,K,0,K,K,K],[1,4,"FnLock",0,K,0,K,K,K],[1,5,"Suspend",0,K,0,K,K,K],[1,6,"Resume",0,K,0,K,K,K],[1,7,"Turbo",0,K,0,K,K,K],[1,8,"Sleep",0,K,0,"VK_SLEEP",K,K],[1,9,"WakeUp",0,K,0,K,K,K],[0,10,"KeyA",31,"A",65,"VK_A",K,K],[0,11,"KeyB",32,"B",66,"VK_B",K,K],[0,12,"KeyC",33,"C",67,"VK_C",K,K],[0,13,"KeyD",34,"D",68,"VK_D",K,K],[0,14,"KeyE",35,"E",69,"VK_E",K,K],[0,15,"KeyF",36,"F",70,"VK_F",K,K],[0,16,"KeyG",37,"G",71,"VK_G",K,K],[0,17,"KeyH",38,"H",72,"VK_H",K,K],[0,18,"KeyI",39,"I",73,"VK_I",K,K],[0,19,"KeyJ",40,"J",74,"VK_J",K,K],[0,20,"KeyK",41,"K",75,"VK_K",K,K],[0,21,"KeyL",42,"L",76,"VK_L",K,K],[0,22,"KeyM",43,"M",77,"VK_M",K,K],[0,23,"KeyN",44,"N",78,"VK_N",K,K],[0,24,"KeyO",45,"O",79,"VK_O",K,K],[0,25,"KeyP",46,"P",80,"VK_P",K,K],[0,26,"KeyQ",47,"Q",81,"VK_Q",K,K],[0,27,"KeyR",48,"R",82,"VK_R",K,K],[0,28,"KeyS",49,"S",83,"VK_S",K,K],[0,29,"KeyT",50,"T",84,"VK_T",K,K],[0,30,"KeyU",51,"U",85,"VK_U",K,K],[0,31,"KeyV",52,"V",86,"VK_V",K,K],[0,32,"KeyW",53,"W",87,"VK_W",K,K],[0,33,"KeyX",54,"X",88,"VK_X",K,K],[0,34,"KeyY",55,"Y",89,"VK_Y",K,K],[0,35,"KeyZ",56,"Z",90,"VK_Z",K,K],[0,36,"Digit1",22,"1",49,"VK_1",K,K],[0,37,"Digit2",23,"2",50,"VK_2",K,K],[0,38,"Digit3",24,"3",51,"VK_3",K,K],[0,39,"Digit4",25,"4",52,"VK_4",K,K],[0,40,"Digit5",26,"5",53,"VK_5",K,K],[0,41,"Digit6",27,"6",54,"VK_6",K,K],[0,42,"Digit7",28,"7",55,"VK_7",K,K],[0,43,"Digit8",29,"8",56,"VK_8",K,K],[0,44,"Digit9",30,"9",57,"VK_9",K,K],[0,45,"Digit0",21,"0",48,"VK_0",K,K],[1,46,"Enter",3,"Enter",13,"VK_RETURN",K,K],[1,47,"Escape",9,"Escape",27,"VK_ESCAPE",K,K],[1,48,"Backspace",1,"Backspace",8,"VK_BACK",K,K],[1,49,"Tab",2,"Tab",9,"VK_TAB",K,K],[1,50,"Space",10,"Space",32,"VK_SPACE",K,K],[0,51,"Minus",88,"-",189,"VK_OEM_MINUS","-","OEM_MINUS"],[0,52,"Equal",86,"=",187,"VK_OEM_PLUS","=","OEM_PLUS"],[0,53,"BracketLeft",92,"[",219,"VK_OEM_4","[","OEM_4"],[0,54,"BracketRight",94,"]",221,"VK_OEM_6","]","OEM_6"],[0,55,"Backslash",93,"\\",220,"VK_OEM_5","\\","OEM_5"],[0,56,"IntlHash",0,K,0,K,K,K],[0,57,"Semicolon",85,";",186,"VK_OEM_1",";","OEM_1"],[0,58,"Quote",95,"'",222,"VK_OEM_7","'","OEM_7"],[0,59,"Backquote",91,"`",192,"VK_OEM_3","`","OEM_3"],[0,60,"Comma",87,",",188,"VK_OEM_COMMA",",","OEM_COMMA"],[0,61,"Period",89,".",190,"VK_OEM_PERIOD",".","OEM_PERIOD"],[0,62,"Slash",90,"/",191,"VK_OEM_2","/","OEM_2"],[1,63,"CapsLock",8,"CapsLock",20,"VK_CAPITAL",K,K],[1,64,"F1",59,"F1",112,"VK_F1",K,K],[1,65,"F2",60,"F2",113,"VK_F2",K,K],[1,66,"F3",61,"F3",114,"VK_F3",K,K],[1,67,"F4",62,"F4",115,"VK_F4",K,K],[1,68,"F5",63,"F5",116,"VK_F5",K,K],[1,69,"F6",64,"F6",117,"VK_F6",K,K],[1,70,"F7",65,"F7",118,"VK_F7",K,K],[1,71,"F8",66,"F8",119,"VK_F8",K,K],[1,72,"F9",67,"F9",120,"VK_F9",K,K],[1,73,"F10",68,"F10",121,"VK_F10",K,K],[1,74,"F11",69,"F11",122,"VK_F11",K,K],[1,75,"F12",70,"F12",123,"VK_F12",K,K],[1,76,"PrintScreen",0,K,0,K,K,K],[1,77,"ScrollLock",84,"ScrollLock",145,"VK_SCROLL",K,K],[1,78,"Pause",7,"PauseBreak",19,"VK_PAUSE",K,K],[1,79,"Insert",19,"Insert",45,"VK_INSERT",K,K],[1,80,"Home",14,"Home",36,"VK_HOME",K,K],[1,81,"PageUp",11,"PageUp",33,"VK_PRIOR",K,K],[1,82,"Delete",20,"Delete",46,"VK_DELETE",K,K],[1,83,"End",13,"End",35,"VK_END",K,K],[1,84,"PageDown",12,"PageDown",34,"VK_NEXT",K,K],[1,85,"ArrowRight",17,"RightArrow",39,"VK_RIGHT","Right",K],[1,86,"ArrowLeft",15,"LeftArrow",37,"VK_LEFT","Left",K],[1,87,"ArrowDown",18,"DownArrow",40,"VK_DOWN","Down",K],[1,88,"ArrowUp",16,"UpArrow",38,"VK_UP","Up",K],[1,89,"NumLock",83,"NumLock",144,"VK_NUMLOCK",K,K],[1,90,"NumpadDivide",113,"NumPad_Divide",111,"VK_DIVIDE",K,K],[1,91,"NumpadMultiply",108,"NumPad_Multiply",106,"VK_MULTIPLY",K,K],[1,92,"NumpadSubtract",111,"NumPad_Subtract",109,"VK_SUBTRACT",K,K],[1,93,"NumpadAdd",109,"NumPad_Add",107,"VK_ADD",K,K],[1,94,"NumpadEnter",3,K,0,K,K,K],[1,95,"Numpad1",99,"NumPad1",97,"VK_NUMPAD1",K,K],[1,96,"Numpad2",100,"NumPad2",98,"VK_NUMPAD2",K,K],[1,97,"Numpad3",101,"NumPad3",99,"VK_NUMPAD3",K,K],[1,98,"Numpad4",102,"NumPad4",100,"VK_NUMPAD4",K,K],[1,99,"Numpad5",103,"NumPad5",101,"VK_NUMPAD5",K,K],[1,100,"Numpad6",104,"NumPad6",102,"VK_NUMPAD6",K,K],[1,101,"Numpad7",105,"NumPad7",103,"VK_NUMPAD7",K,K],[1,102,"Numpad8",106,"NumPad8",104,"VK_NUMPAD8",K,K],[1,103,"Numpad9",107,"NumPad9",105,"VK_NUMPAD9",K,K],[1,104,"Numpad0",98,"NumPad0",96,"VK_NUMPAD0",K,K],[1,105,"NumpadDecimal",112,"NumPad_Decimal",110,"VK_DECIMAL",K,K],[0,106,"IntlBackslash",97,"OEM_102",226,"VK_OEM_102",K,K],[1,107,"ContextMenu",58,"ContextMenu",93,K,K,K],[1,108,"Power",0,K,0,K,K,K],[1,109,"NumpadEqual",0,K,0,K,K,K],[1,110,"F13",71,"F13",124,"VK_F13",K,K],[1,111,"F14",72,"F14",125,"VK_F14",K,K],[1,112,"F15",73,"F15",126,"VK_F15",K,K],[1,113,"F16",74,"F16",127,"VK_F16",K,K],[1,114,"F17",75,"F17",128,"VK_F17",K,K],[1,115,"F18",76,"F18",129,"VK_F18",K,K],[1,116,"F19",77,"F19",130,"VK_F19",K,K],[1,117,"F20",78,"F20",131,"VK_F20",K,K],[1,118,"F21",79,"F21",132,"VK_F21",K,K],[1,119,"F22",80,"F22",133,"VK_F22",K,K],[1,120,"F23",81,"F23",134,"VK_F23",K,K],[1,121,"F24",82,"F24",135,"VK_F24",K,K],[1,122,"Open",0,K,0,K,K,K],[1,123,"Help",0,K,0,K,K,K],[1,124,"Select",0,K,0,K,K,K],[1,125,"Again",0,K,0,K,K,K],[1,126,"Undo",0,K,0,K,K,K],[1,127,"Cut",0,K,0,K,K,K],[1,128,"Copy",0,K,0,K,K,K],[1,129,"Paste",0,K,0,K,K,K],[1,130,"Find",0,K,0,K,K,K],[1,131,"AudioVolumeMute",117,"AudioVolumeMute",173,"VK_VOLUME_MUTE",K,K],[1,132,"AudioVolumeUp",118,"AudioVolumeUp",175,"VK_VOLUME_UP",K,K],[1,133,"AudioVolumeDown",119,"AudioVolumeDown",174,"VK_VOLUME_DOWN",K,K],[1,134,"NumpadComma",110,"NumPad_Separator",108,"VK_SEPARATOR",K,K],[0,135,"IntlRo",115,"ABNT_C1",193,"VK_ABNT_C1",K,K],[1,136,"KanaMode",0,K,0,K,K,K],[0,137,"IntlYen",0,K,0,K,K,K],[1,138,"Convert",0,K,0,K,K,K],[1,139,"NonConvert",0,K,0,K,K,K],[1,140,"Lang1",0,K,0,K,K,K],[1,141,"Lang2",0,K,0,K,K,K],[1,142,"Lang3",0,K,0,K,K,K],[1,143,"Lang4",0,K,0,K,K,K],[1,144,"Lang5",0,K,0,K,K,K],[1,145,"Abort",0,K,0,K,K,K],[1,146,"Props",0,K,0,K,K,K],[1,147,"NumpadParenLeft",0,K,0,K,K,K],[1,148,"NumpadParenRight",0,K,0,K,K,K],[1,149,"NumpadBackspace",0,K,0,K,K,K],[1,150,"NumpadMemoryStore",0,K,0,K,K,K],[1,151,"NumpadMemoryRecall",0,K,0,K,K,K],[1,152,"NumpadMemoryClear",0,K,0,K,K,K],[1,153,"NumpadMemoryAdd",0,K,0,K,K,K],[1,154,"NumpadMemorySubtract",0,K,0,K,K,K],[1,155,"NumpadClear",131,"Clear",12,"VK_CLEAR",K,K],[1,156,"NumpadClearEntry",0,K,0,K,K,K],[1,0,K,5,"Ctrl",17,"VK_CONTROL",K,K],[1,0,K,4,"Shift",16,"VK_SHIFT",K,K],[1,0,K,6,"Alt",18,"VK_MENU",K,K],[1,0,K,57,"Meta",91,"VK_COMMAND",K,K],[1,157,"ControlLeft",5,K,0,"VK_LCONTROL",K,K],[1,158,"ShiftLeft",4,K,0,"VK_LSHIFT",K,K],[1,159,"AltLeft",6,K,0,"VK_LMENU",K,K],[1,160,"MetaLeft",57,K,0,"VK_LWIN",K,K],[1,161,"ControlRight",5,K,0,"VK_RCONTROL",K,K],[1,162,"ShiftRight",4,K,0,"VK_RSHIFT",K,K],[1,163,"AltRight",6,K,0,"VK_RMENU",K,K],[1,164,"MetaRight",57,K,0,"VK_RWIN",K,K],[1,165,"BrightnessUp",0,K,0,K,K,K],[1,166,"BrightnessDown",0,K,0,K,K,K],[1,167,"MediaPlay",0,K,0,K,K,K],[1,168,"MediaRecord",0,K,0,K,K,K],[1,169,"MediaFastForward",0,K,0,K,K,K],[1,170,"MediaRewind",0,K,0,K,K,K],[1,171,"MediaTrackNext",124,"MediaTrackNext",176,"VK_MEDIA_NEXT_TRACK",K,K],[1,172,"MediaTrackPrevious",125,"MediaTrackPrevious",177,"VK_MEDIA_PREV_TRACK",K,K],[1,173,"MediaStop",126,"MediaStop",178,"VK_MEDIA_STOP",K,K],[1,174,"Eject",0,K,0,K,K,K],[1,175,"MediaPlayPause",127,"MediaPlayPause",179,"VK_MEDIA_PLAY_PAUSE",K,K],[1,176,"MediaSelect",128,"LaunchMediaPlayer",181,"VK_MEDIA_LAUNCH_MEDIA_SELECT",K,K],[1,177,"LaunchMail",129,"LaunchMail",180,"VK_MEDIA_LAUNCH_MAIL",K,K],[1,178,"LaunchApp2",130,"LaunchApp2",183,"VK_MEDIA_LAUNCH_APP2",K,K],[1,179,"LaunchApp1",0,K,0,"VK_MEDIA_LAUNCH_APP1",K,K],[1,180,"SelectTask",0,K,0,K,K,K],[1,181,"LaunchScreenSaver",0,K,0,K,K,K],[1,182,"BrowserSearch",120,"BrowserSearch",170,"VK_BROWSER_SEARCH",K,K],[1,183,"BrowserHome",121,"BrowserHome",172,"VK_BROWSER_HOME",K,K],[1,184,"BrowserBack",122,"BrowserBack",166,"VK_BROWSER_BACK",K,K],[1,185,"BrowserForward",123,"BrowserForward",167,"VK_BROWSER_FORWARD",K,K],[1,186,"BrowserStop",0,K,0,"VK_BROWSER_STOP",K,K],[1,187,"BrowserRefresh",0,K,0,"VK_BROWSER_REFRESH",K,K],[1,188,"BrowserFavorites",0,K,0,"VK_BROWSER_FAVORITES",K,K],[1,189,"ZoomToggle",0,K,0,K,K,K],[1,190,"MailReply",0,K,0,K,K,K],[1,191,"MailForward",0,K,0,K,K,K],[1,192,"MailSend",0,K,0,K,K,K],[1,0,K,114,"KeyInComposition",229,K,K,K],[1,0,K,116,"ABNT_C2",194,"VK_ABNT_C2",K,K],[1,0,K,96,"OEM_8",223,"VK_OEM_8",K,K],[1,0,K,0,K,0,"VK_KANA",K,K],[1,0,K,0,K,0,"VK_HANGUL",K,K],[1,0,K,0,K,0,"VK_JUNJA",K,K],[1,0,K,0,K,0,"VK_FINAL",K,K],[1,0,K,0,K,0,"VK_HANJA",K,K],[1,0,K,0,K,0,"VK_KANJI",K,K],[1,0,K,0,K,0,"VK_CONVERT",K,K],[1,0,K,0,K,0,"VK_NONCONVERT",K,K],[1,0,K,0,K,0,"VK_ACCEPT",K,K],[1,0,K,0,K,0,"VK_MODECHANGE",K,K],[1,0,K,0,K,0,"VK_SELECT",K,K],[1,0,K,0,K,0,"VK_PRINT",K,K],[1,0,K,0,K,0,"VK_EXECUTE",K,K],[1,0,K,0,K,0,"VK_SNAPSHOT",K,K],[1,0,K,0,K,0,"VK_HELP",K,K],[1,0,K,0,K,0,"VK_APPS",K,K],[1,0,K,0,K,0,"VK_PROCESSKEY",K,K],[1,0,K,0,K,0,"VK_PACKET",K,K],[1,0,K,0,K,0,"VK_DBE_SBCSCHAR",K,K],[1,0,K,0,K,0,"VK_DBE_DBCSCHAR",K,K],[1,0,K,0,K,0,"VK_ATTN",K,K],[1,0,K,0,K,0,"VK_CRSEL",K,K],[1,0,K,0,K,0,"VK_EXSEL",K,K],[1,0,K,0,K,0,"VK_EREOF",K,K],[1,0,K,0,K,0,"VK_PLAY",K,K],[1,0,K,0,K,0,"VK_ZOOM",K,K],[1,0,K,0,K,0,"VK_NONAME",K,K],[1,0,K,0,K,0,"VK_PA1",K,K],[1,0,K,0,K,0,"VK_OEM_CLEAR",K,K]],W=[],V=[];for(const U of C){const[G,Z,X,Q,J,ee,te,ie,ne]=U;if(V[Z]||(V[Z]=!0,scanCodeStrToInt[X]=Z,scanCodeLowerCaseStrToInt[X.toLowerCase()]=Z,G&&(IMMUTABLE_CODE_TO_KEY_CODE[Z]=Q)),!W[Q]){if(W[Q]=!0,!J)throw new Error(`String representation missing for key code ${Q} around scan code ${X}`);uiMap.define(Q,J),userSettingsUSMap.define(Q,ie||J),userSettingsGeneralMap.define(Q,ne||ie||J)}ee&&(EVENT_KEY_CODE_MAP[ee]=Q)}})();var KeyCodeUtils;(function(K){function C(X){return uiMap.keyCodeToStr(X)}K.toString=C;function W(X){return uiMap.strToKeyCode(X)}K.fromString=W;function V(X){return userSettingsUSMap.keyCodeToStr(X)}K.toUserSettingsUS=V;function U(X){return userSettingsGeneralMap.keyCodeToStr(X)}K.toUserSettingsGeneral=U;function G(X){return userSettingsUSMap.strToKeyCode(X)||userSettingsGeneralMap.strToKeyCode(X)}K.fromUserSettings=G;function Z(X){if(X>=98&&X<=113)return null;switch(X){case 16:return"Up";case 18:return"Down";case 15:return"Left";case 17:return"Right"}return uiMap.keyCodeToStr(X)}K.toElectronAccelerator=Z})(KeyCodeUtils||(KeyCodeUtils={}));function KeyChord(K,C){const W=(C&65535)<<16>>>0;return(K|W)>>>0}let safeProcess;if(typeof globals.vscode<"u"&&typeof globals.vscode.process<"u"){const K=globals.vscode.process;safeProcess={get platform(){return K.platform},get arch(){return K.arch},get env(){return K.env},cwd(){return K.cwd()}}}else typeof process<"u"?safeProcess={get platform(){return process.platform},get arch(){return process.arch},get env(){return process.env},cwd(){return process.env.VSCODE_CWD||process.cwd()}}:safeProcess={get platform(){return isWindows?"win32":isMacintosh?"darwin":"linux"},get arch(){},get env(){return{}},cwd(){return"/"}};const cwd=safeProcess.cwd,env=safeProcess.env,platform=safeProcess.platform,CHAR_UPPERCASE_A=65,CHAR_LOWERCASE_A=97,CHAR_UPPERCASE_Z=90,CHAR_LOWERCASE_Z=122,CHAR_DOT=46,CHAR_FORWARD_SLASH=47,CHAR_BACKWARD_SLASH=92,CHAR_COLON=58,CHAR_QUESTION_MARK=63;class ErrorInvalidArgType extends Error{constructor(C,W,V){let U;typeof W=="string"&&W.indexOf("not ")===0?(U="must not be",W=W.replace(/^not /,"")):U="must be";const G=C.indexOf(".")!==-1?"property":"argument";let Z=`The "${C}" ${G} ${U} of type ${W}`;Z+=`. Received type ${typeof V}`,super(Z),this.code="ERR_INVALID_ARG_TYPE"}}function validateObject(K,C){if(K===null||typeof K!="object")throw new ErrorInvalidArgType(C,"Object",K)}function validateString(K,C){if(typeof K!="string")throw new ErrorInvalidArgType(C,"string",K)}const platformIsWin32=platform==="win32";function isPathSeparator$1(K){return K===CHAR_FORWARD_SLASH||K===CHAR_BACKWARD_SLASH}function isPosixPathSeparator(K){return K===CHAR_FORWARD_SLASH}function isWindowsDeviceRoot(K){return K>=CHAR_UPPERCASE_A&&K<=CHAR_UPPERCASE_Z||K>=CHAR_LOWERCASE_A&&K<=CHAR_LOWERCASE_Z}function normalizeString(K,C,W,V){let U="",G=0,Z=-1,X=0,Q=0;for(let J=0;J<=K.length;++J){if(J<K.length)Q=K.charCodeAt(J);else{if(V(Q))break;Q=CHAR_FORWARD_SLASH}if(V(Q)){if(!(Z===J-1||X===1))if(X===2){if(U.length<2||G!==2||U.charCodeAt(U.length-1)!==CHAR_DOT||U.charCodeAt(U.length-2)!==CHAR_DOT){if(U.length>2){const ee=U.lastIndexOf(W);ee===-1?(U="",G=0):(U=U.slice(0,ee),G=U.length-1-U.lastIndexOf(W)),Z=J,X=0;continue}else if(U.length!==0){U="",G=0,Z=J,X=0;continue}}C&&(U+=U.length>0?`${W}..`:"..",G=2)}else U.length>0?U+=`${W}${K.slice(Z+1,J)}`:U=K.slice(Z+1,J),G=J-Z-1;Z=J,X=0}else Q===CHAR_DOT&&X!==-1?++X:X=-1}return U}function _format(K,C){validateObject(C,"pathObject");const W=C.dir||C.root,V=C.base||`${C.name||""}${C.ext||""}`;return W?W===C.root?`${W}${V}`:`${W}${K}${V}`:V}const win32={resolve(...K){let C="",W="",V=!1;for(let U=K.length-1;U>=-1;U--){let G;if(U>=0){if(G=K[U],validateString(G,"path"),G.length===0)continue}else C.length===0?G=cwd():(G=env[`=${C}`]||cwd(),(G===void 0||G.slice(0,2).toLowerCase()!==C.toLowerCase()&&G.charCodeAt(2)===CHAR_BACKWARD_SLASH)&&(G=`${C}\\`));const Z=G.length;let X=0,Q="",J=!1;const ee=G.charCodeAt(0);if(Z===1)isPathSeparator$1(ee)&&(X=1,J=!0);else if(isPathSeparator$1(ee))if(J=!0,isPathSeparator$1(G.charCodeAt(1))){let te=2,ie=te;for(;te<Z&&!isPathSeparator$1(G.charCodeAt(te));)te++;if(te<Z&&te!==ie){const ne=G.slice(ie,te);for(ie=te;te<Z&&isPathSeparator$1(G.charCodeAt(te));)te++;if(te<Z&&te!==ie){for(ie=te;te<Z&&!isPathSeparator$1(G.charCodeAt(te));)te++;(te===Z||te!==ie)&&(Q=`\\\\${ne}\\${G.slice(ie,te)}`,X=te)}}}else X=1;else isWindowsDeviceRoot(ee)&&G.charCodeAt(1)===CHAR_COLON&&(Q=G.slice(0,2),X=2,Z>2&&isPathSeparator$1(G.charCodeAt(2))&&(J=!0,X=3));if(Q.length>0)if(C.length>0){if(Q.toLowerCase()!==C.toLowerCase())continue}else C=Q;if(V){if(C.length>0)break}else if(W=`${G.slice(X)}\\${W}`,V=J,J&&C.length>0)break}return W=normalizeString(W,!V,"\\",isPathSeparator$1),V?`${C}\\${W}`:`${C}${W}`||"."},normalize(K){validateString(K,"path");const C=K.length;if(C===0)return".";let W=0,V,U=!1;const G=K.charCodeAt(0);if(C===1)return isPosixPathSeparator(G)?"\\":K;if(isPathSeparator$1(G))if(U=!0,isPathSeparator$1(K.charCodeAt(1))){let X=2,Q=X;for(;X<C&&!isPathSeparator$1(K.charCodeAt(X));)X++;if(X<C&&X!==Q){const J=K.slice(Q,X);for(Q=X;X<C&&isPathSeparator$1(K.charCodeAt(X));)X++;if(X<C&&X!==Q){for(Q=X;X<C&&!isPathSeparator$1(K.charCodeAt(X));)X++;if(X===C)return`\\\\${J}\\${K.slice(Q)}\\`;X!==Q&&(V=`\\\\${J}\\${K.slice(Q,X)}`,W=X)}}}else W=1;else isWindowsDeviceRoot(G)&&K.charCodeAt(1)===CHAR_COLON&&(V=K.slice(0,2),W=2,C>2&&isPathSeparator$1(K.charCodeAt(2))&&(U=!0,W=3));let Z=W<C?normalizeString(K.slice(W),!U,"\\",isPathSeparator$1):"";return Z.length===0&&!U&&(Z="."),Z.length>0&&isPathSeparator$1(K.charCodeAt(C-1))&&(Z+="\\"),V===void 0?U?`\\${Z}`:Z:U?`${V}\\${Z}`:`${V}${Z}`},isAbsolute(K){validateString(K,"path");const C=K.length;if(C===0)return!1;const W=K.charCodeAt(0);return isPathSeparator$1(W)||C>2&&isWindowsDeviceRoot(W)&&K.charCodeAt(1)===CHAR_COLON&&isPathSeparator$1(K.charCodeAt(2))},join(...K){if(K.length===0)return".";let C,W;for(let G=0;G<K.length;++G){const Z=K[G];validateString(Z,"path"),Z.length>0&&(C===void 0?C=W=Z:C+=`\\${Z}`)}if(C===void 0)return".";let V=!0,U=0;if(typeof W=="string"&&isPathSeparator$1(W.charCodeAt(0))){++U;const G=W.length;G>1&&isPathSeparator$1(W.charCodeAt(1))&&(++U,G>2&&(isPathSeparator$1(W.charCodeAt(2))?++U:V=!1))}if(V){for(;U<C.length&&isPathSeparator$1(C.charCodeAt(U));)U++;U>=2&&(C=`\\${C.slice(U)}`)}return win32.normalize(C)},relative(K,C){if(validateString(K,"from"),validateString(C,"to"),K===C)return"";const W=win32.resolve(K),V=win32.resolve(C);if(W===V||(K=W.toLowerCase(),C=V.toLowerCase(),K===C))return"";let U=0;for(;U<K.length&&K.charCodeAt(U)===CHAR_BACKWARD_SLASH;)U++;let G=K.length;for(;G-1>U&&K.charCodeAt(G-1)===CHAR_BACKWARD_SLASH;)G--;const Z=G-U;let X=0;for(;X<C.length&&C.charCodeAt(X)===CHAR_BACKWARD_SLASH;)X++;let Q=C.length;for(;Q-1>X&&C.charCodeAt(Q-1)===CHAR_BACKWARD_SLASH;)Q--;const J=Q-X,ee=Z<J?Z:J;let te=-1,ie=0;for(;ie<ee;ie++){const oe=K.charCodeAt(U+ie);if(oe!==C.charCodeAt(X+ie))break;oe===CHAR_BACKWARD_SLASH&&(te=ie)}if(ie!==ee){if(te===-1)return V}else{if(J>ee){if(C.charCodeAt(X+ie)===CHAR_BACKWARD_SLASH)return V.slice(X+ie+1);if(ie===2)return V.slice(X+ie)}Z>ee&&(K.charCodeAt(U+ie)===CHAR_BACKWARD_SLASH?te=ie:ie===2&&(te=3)),te===-1&&(te=0)}let ne="";for(ie=U+te+1;ie<=G;++ie)(ie===G||K.charCodeAt(ie)===CHAR_BACKWARD_SLASH)&&(ne+=ne.length===0?"..":"\\..");return X+=te,ne.length>0?`${ne}${V.slice(X,Q)}`:(V.charCodeAt(X)===CHAR_BACKWARD_SLASH&&++X,V.slice(X,Q))},toNamespacedPath(K){if(typeof K!="string"||K.length===0)return K;const C=win32.resolve(K);if(C.length<=2)return K;if(C.charCodeAt(0)===CHAR_BACKWARD_SLASH){if(C.charCodeAt(1)===CHAR_BACKWARD_SLASH){const W=C.charCodeAt(2);if(W!==CHAR_QUESTION_MARK&&W!==CHAR_DOT)return`\\\\?\\UNC\\${C.slice(2)}`}}else if(isWindowsDeviceRoot(C.charCodeAt(0))&&C.charCodeAt(1)===CHAR_COLON&&C.charCodeAt(2)===CHAR_BACKWARD_SLASH)return`\\\\?\\${C}`;return K},dirname(K){validateString(K,"path");const C=K.length;if(C===0)return".";let W=-1,V=0;const U=K.charCodeAt(0);if(C===1)return isPathSeparator$1(U)?K:".";if(isPathSeparator$1(U)){if(W=V=1,isPathSeparator$1(K.charCodeAt(1))){let X=2,Q=X;for(;X<C&&!isPathSeparator$1(K.charCodeAt(X));)X++;if(X<C&&X!==Q){for(Q=X;X<C&&isPathSeparator$1(K.charCodeAt(X));)X++;if(X<C&&X!==Q){for(Q=X;X<C&&!isPathSeparator$1(K.charCodeAt(X));)X++;if(X===C)return K;X!==Q&&(W=V=X+1)}}}}else isWindowsDeviceRoot(U)&&K.charCodeAt(1)===CHAR_COLON&&(W=C>2&&isPathSeparator$1(K.charCodeAt(2))?3:2,V=W);let G=-1,Z=!0;for(let X=C-1;X>=V;--X)if(isPathSeparator$1(K.charCodeAt(X))){if(!Z){G=X;break}}else Z=!1;if(G===-1){if(W===-1)return".";G=W}return K.slice(0,G)},basename(K,C){C!==void 0&&validateString(C,"ext"),validateString(K,"path");let W=0,V=-1,U=!0,G;if(K.length>=2&&isWindowsDeviceRoot(K.charCodeAt(0))&&K.charCodeAt(1)===CHAR_COLON&&(W=2),C!==void 0&&C.length>0&&C.length<=K.length){if(C===K)return"";let Z=C.length-1,X=-1;for(G=K.length-1;G>=W;--G){const Q=K.charCodeAt(G);if(isPathSeparator$1(Q)){if(!U){W=G+1;break}}else X===-1&&(U=!1,X=G+1),Z>=0&&(Q===C.charCodeAt(Z)?--Z===-1&&(V=G):(Z=-1,V=X))}return W===V?V=X:V===-1&&(V=K.length),K.slice(W,V)}for(G=K.length-1;G>=W;--G)if(isPathSeparator$1(K.charCodeAt(G))){if(!U){W=G+1;break}}else V===-1&&(U=!1,V=G+1);return V===-1?"":K.slice(W,V)},extname(K){validateString(K,"path");let C=0,W=-1,V=0,U=-1,G=!0,Z=0;K.length>=2&&K.charCodeAt(1)===CHAR_COLON&&isWindowsDeviceRoot(K.charCodeAt(0))&&(C=V=2);for(let X=K.length-1;X>=C;--X){const Q=K.charCodeAt(X);if(isPathSeparator$1(Q)){if(!G){V=X+1;break}continue}U===-1&&(G=!1,U=X+1),Q===CHAR_DOT?W===-1?W=X:Z!==1&&(Z=1):W!==-1&&(Z=-1)}return W===-1||U===-1||Z===0||Z===1&&W===U-1&&W===V+1?"":K.slice(W,U)},format:_format.bind(null,"\\"),parse(K){validateString(K,"path");const C={root:"",dir:"",base:"",ext:"",name:""};if(K.length===0)return C;const W=K.length;let V=0,U=K.charCodeAt(0);if(W===1)return isPathSeparator$1(U)?(C.root=C.dir=K,C):(C.base=C.name=K,C);if(isPathSeparator$1(U)){if(V=1,isPathSeparator$1(K.charCodeAt(1))){let te=2,ie=te;for(;te<W&&!isPathSeparator$1(K.charCodeAt(te));)te++;if(te<W&&te!==ie){for(ie=te;te<W&&isPathSeparator$1(K.charCodeAt(te));)te++;if(te<W&&te!==ie){for(ie=te;te<W&&!isPathSeparator$1(K.charCodeAt(te));)te++;te===W?V=te:te!==ie&&(V=te+1)}}}}else if(isWindowsDeviceRoot(U)&&K.charCodeAt(1)===CHAR_COLON){if(W<=2)return C.root=C.dir=K,C;if(V=2,isPathSeparator$1(K.charCodeAt(2))){if(W===3)return C.root=C.dir=K,C;V=3}}V>0&&(C.root=K.slice(0,V));let G=-1,Z=V,X=-1,Q=!0,J=K.length-1,ee=0;for(;J>=V;--J){if(U=K.charCodeAt(J),isPathSeparator$1(U)){if(!Q){Z=J+1;break}continue}X===-1&&(Q=!1,X=J+1),U===CHAR_DOT?G===-1?G=J:ee!==1&&(ee=1):G!==-1&&(ee=-1)}return X!==-1&&(G===-1||ee===0||ee===1&&G===X-1&&G===Z+1?C.base=C.name=K.slice(Z,X):(C.name=K.slice(Z,G),C.base=K.slice(Z,X),C.ext=K.slice(G,X))),Z>0&&Z!==V?C.dir=K.slice(0,Z-1):C.dir=C.root,C},sep:"\\",delimiter:";",win32:null,posix:null},posixCwd=(()=>{if(platformIsWin32){const K=/\\/g;return()=>{const C=cwd().replace(K,"/");return C.slice(C.indexOf("/"))}}return()=>cwd()})(),posix={resolve(...K){let C="",W=!1;for(let V=K.length-1;V>=-1&&!W;V--){const U=V>=0?K[V]:posixCwd();validateString(U,"path"),U.length!==0&&(C=`${U}/${C}`,W=U.charCodeAt(0)===CHAR_FORWARD_SLASH)}return C=normalizeString(C,!W,"/",isPosixPathSeparator),W?`/${C}`:C.length>0?C:"."},normalize(K){if(validateString(K,"path"),K.length===0)return".";const C=K.charCodeAt(0)===CHAR_FORWARD_SLASH,W=K.charCodeAt(K.length-1)===CHAR_FORWARD_SLASH;return K=normalizeString(K,!C,"/",isPosixPathSeparator),K.length===0?C?"/":W?"./":".":(W&&(K+="/"),C?`/${K}`:K)},isAbsolute(K){return validateString(K,"path"),K.length>0&&K.charCodeAt(0)===CHAR_FORWARD_SLASH},join(...K){if(K.length===0)return".";let C;for(let W=0;W<K.length;++W){const V=K[W];validateString(V,"path"),V.length>0&&(C===void 0?C=V:C+=`/${V}`)}return C===void 0?".":posix.normalize(C)},relative(K,C){if(validateString(K,"from"),validateString(C,"to"),K===C||(K=posix.resolve(K),C=posix.resolve(C),K===C))return"";const W=1,V=K.length,U=V-W,G=1,Z=C.length-G,X=U<Z?U:Z;let Q=-1,J=0;for(;J<X;J++){const te=K.charCodeAt(W+J);if(te!==C.charCodeAt(G+J))break;te===CHAR_FORWARD_SLASH&&(Q=J)}if(J===X)if(Z>X){if(C.charCodeAt(G+J)===CHAR_FORWARD_SLASH)return C.slice(G+J+1);if(J===0)return C.slice(G+J)}else U>X&&(K.charCodeAt(W+J)===CHAR_FORWARD_SLASH?Q=J:J===0&&(Q=0));let ee="";for(J=W+Q+1;J<=V;++J)(J===V||K.charCodeAt(J)===CHAR_FORWARD_SLASH)&&(ee+=ee.length===0?"..":"/..");return`${ee}${C.slice(G+Q)}`},toNamespacedPath(K){return K},dirname(K){if(validateString(K,"path"),K.length===0)return".";const C=K.charCodeAt(0)===CHAR_FORWARD_SLASH;let W=-1,V=!0;for(let U=K.length-1;U>=1;--U)if(K.charCodeAt(U)===CHAR_FORWARD_SLASH){if(!V){W=U;break}}else V=!1;return W===-1?C?"/":".":C&&W===1?"//":K.slice(0,W)},basename(K,C){C!==void 0&&validateString(C,"ext"),validateString(K,"path");let W=0,V=-1,U=!0,G;if(C!==void 0&&C.length>0&&C.length<=K.length){if(C===K)return"";let Z=C.length-1,X=-1;for(G=K.length-1;G>=0;--G){const Q=K.charCodeAt(G);if(Q===CHAR_FORWARD_SLASH){if(!U){W=G+1;break}}else X===-1&&(U=!1,X=G+1),Z>=0&&(Q===C.charCodeAt(Z)?--Z===-1&&(V=G):(Z=-1,V=X))}return W===V?V=X:V===-1&&(V=K.length),K.slice(W,V)}for(G=K.length-1;G>=0;--G)if(K.charCodeAt(G)===CHAR_FORWARD_SLASH){if(!U){W=G+1;break}}else V===-1&&(U=!1,V=G+1);return V===-1?"":K.slice(W,V)},extname(K){validateString(K,"path");let C=-1,W=0,V=-1,U=!0,G=0;for(let Z=K.length-1;Z>=0;--Z){const X=K.charCodeAt(Z);if(X===CHAR_FORWARD_SLASH){if(!U){W=Z+1;break}continue}V===-1&&(U=!1,V=Z+1),X===CHAR_DOT?C===-1?C=Z:G!==1&&(G=1):C!==-1&&(G=-1)}return C===-1||V===-1||G===0||G===1&&C===V-1&&C===W+1?"":K.slice(C,V)},format:_format.bind(null,"/"),parse(K){validateString(K,"path");const C={root:"",dir:"",base:"",ext:"",name:""};if(K.length===0)return C;const W=K.charCodeAt(0)===CHAR_FORWARD_SLASH;let V;W?(C.root="/",V=1):V=0;let U=-1,G=0,Z=-1,X=!0,Q=K.length-1,J=0;for(;Q>=V;--Q){const ee=K.charCodeAt(Q);if(ee===CHAR_FORWARD_SLASH){if(!X){G=Q+1;break}continue}Z===-1&&(X=!1,Z=Q+1),ee===CHAR_DOT?U===-1?U=Q:J!==1&&(J=1):U!==-1&&(J=-1)}if(Z!==-1){const ee=G===0&&W?1:G;U===-1||J===0||J===1&&U===Z-1&&U===G+1?C.base=C.name=K.slice(ee,Z):(C.name=K.slice(ee,U),C.base=K.slice(ee,Z),C.ext=K.slice(U,Z))}return G>0?C.dir=K.slice(0,G-1):W&&(C.dir="/"),C},sep:"/",delimiter:":",win32:null,posix:null};posix.win32=win32.win32=win32;posix.posix=win32.posix=posix;const normalize=platformIsWin32?win32.normalize:posix.normalize,resolve=platformIsWin32?win32.resolve:posix.resolve,relative=platformIsWin32?win32.relative:posix.relative,dirname$1=platformIsWin32?win32.dirname:posix.dirname,basename$1=platformIsWin32?win32.basename:posix.basename,extname$1=platformIsWin32?win32.extname:posix.extname,sep=platformIsWin32?win32.sep:posix.sep,_schemePattern=/^\w[\w\d+.-]*$/,_singleSlashStart=/^\//,_doubleSlashStart=/^\/\//;function _validateUri(K,C){if(!K.scheme&&C)throw new Error(`[UriError]: Scheme is missing: {scheme: "", authority: "${K.authority}", path: "${K.path}", query: "${K.query}", fragment: "${K.fragment}"}`);if(K.scheme&&!_schemePattern.test(K.scheme))throw new Error("[UriError]: Scheme contains illegal characters.");if(K.path){if(K.authority){if(!_singleSlashStart.test(K.path))throw new Error('[UriError]: If a URI contains an authority component, then the path component must either be empty or begin with a slash ("/") character')}else if(_doubleSlashStart.test(K.path))throw new Error('[UriError]: If a URI does not contain an authority component, then the path cannot begin with two slash characters ("//")')}}function _schemeFix(K,C){return!K&&!C?"file":K}function _referenceResolution(K,C){switch(K){case"https":case"http":case"file":C?C[0]!==_slash&&(C=_slash+C):C=_slash;break}return C}const _empty="",_slash="/",_regexp=/^(([^:/?#]+?):)?(\/\/([^/?#]*))?([^?#]*)(\?([^#]*))?(#(.*))?/;class URI{static isUri(C){return C instanceof URI?!0:C?typeof C.authority=="string"&&typeof C.fragment=="string"&&typeof C.path=="string"&&typeof C.query=="string"&&typeof C.scheme=="string"&&typeof C.fsPath=="string"&&typeof C.with=="function"&&typeof C.toString=="function":!1}constructor(C,W,V,U,G,Z=!1){typeof C=="object"?(this.scheme=C.scheme||_empty,this.authority=C.authority||_empty,this.path=C.path||_empty,this.query=C.query||_empty,this.fragment=C.fragment||_empty):(this.scheme=_schemeFix(C,Z),this.authority=W||_empty,this.path=_referenceResolution(this.scheme,V||_empty),this.query=U||_empty,this.fragment=G||_empty,_validateUri(this,Z))}get fsPath(){return uriToFsPath(this,!1)}with(C){if(!C)return this;let{scheme:W,authority:V,path:U,query:G,fragment:Z}=C;return W===void 0?W=this.scheme:W===null&&(W=_empty),V===void 0?V=this.authority:V===null&&(V=_empty),U===void 0?U=this.path:U===null&&(U=_empty),G===void 0?G=this.query:G===null&&(G=_empty),Z===void 0?Z=this.fragment:Z===null&&(Z=_empty),W===this.scheme&&V===this.authority&&U===this.path&&G===this.query&&Z===this.fragment?this:new Uri$1(W,V,U,G,Z)}static parse(C,W=!1){const V=_regexp.exec(C);return V?new Uri$1(V[2]||_empty,percentDecode(V[4]||_empty),percentDecode(V[5]||_empty),percentDecode(V[7]||_empty),percentDecode(V[9]||_empty),W):new Uri$1(_empty,_empty,_empty,_empty,_empty)}static file(C){let W=_empty;if(isWindows&&(C=C.replace(/\\/g,_slash)),C[0]===_slash&&C[1]===_slash){const V=C.indexOf(_slash,2);V===-1?(W=C.substring(2),C=_slash):(W=C.substring(2,V),C=C.substring(V)||_slash)}return new Uri$1("file",W,C,_empty,_empty)}static from(C,W){return new Uri$1(C.scheme,C.authority,C.path,C.query,C.fragment,W)}static joinPath(C,...W){if(!C.path)throw new Error("[UriError]: cannot call joinPath on URI without path");let V;return isWindows&&C.scheme==="file"?V=URI.file(win32.join(uriToFsPath(C,!0),...W)).path:V=posix.join(C.path,...W),C.with({path:V})}toString(C=!1){return _asFormatted(this,C)}toJSON(){return this}static revive(C){var W,V;if(C){if(C instanceof URI)return C;{const U=new Uri$1(C);return U._formatted=(W=C.external)!==null&&W!==void 0?W:null,U._fsPath=C._sep===_pathSepMarker&&(V=C.fsPath)!==null&&V!==void 0?V:null,U}}else return C}}const _pathSepMarker=isWindows?1:void 0;let Uri$1=class extends URI{constructor(){super(...arguments),this._formatted=null,this._fsPath=null}get fsPath(){return this._fsPath||(this._fsPath=uriToFsPath(this,!1)),this._fsPath}toString(C=!1){return C?_asFormatted(this,!0):(this._formatted||(this._formatted=_asFormatted(this,!1)),this._formatted)}toJSON(){const C={$mid:1};return this._fsPath&&(C.fsPath=this._fsPath,C._sep=_pathSepMarker),this._formatted&&(C.external=this._formatted),this.path&&(C.path=this.path),this.scheme&&(C.scheme=this.scheme),this.authority&&(C.authority=this.authority),this.query&&(C.query=this.query),this.fragment&&(C.fragment=this.fragment),C}};const encodeTable={58:"%3A",47:"%2F",63:"%3F",35:"%23",91:"%5B",93:"%5D",64:"%40",33:"%21",36:"%24",38:"%26",39:"%27",40:"%28",41:"%29",42:"%2A",43:"%2B",44:"%2C",59:"%3B",61:"%3D",32:"%20"};function encodeURIComponentFast(K,C,W){let V,U=-1;for(let G=0;G<K.length;G++){const Z=K.charCodeAt(G);if(Z>=97&&Z<=122||Z>=65&&Z<=90||Z>=48&&Z<=57||Z===45||Z===46||Z===95||Z===126||C&&Z===47||W&&Z===91||W&&Z===93||W&&Z===58)U!==-1&&(V+=encodeURIComponent(K.substring(U,G)),U=-1),V!==void 0&&(V+=K.charAt(G));else{V===void 0&&(V=K.substr(0,G));const X=encodeTable[Z];X!==void 0?(U!==-1&&(V+=encodeURIComponent(K.substring(U,G)),U=-1),V+=X):U===-1&&(U=G)}}return U!==-1&&(V+=encodeURIComponent(K.substring(U))),V!==void 0?V:K}function encodeURIComponentMinimal(K){let C;for(let W=0;W<K.length;W++){const V=K.charCodeAt(W);V===35||V===63?(C===void 0&&(C=K.substr(0,W)),C+=encodeTable[V]):C!==void 0&&(C+=K[W])}return C!==void 0?C:K}function uriToFsPath(K,C){let W;return K.authority&&K.path.length>1&&K.scheme==="file"?W=`//${K.authority}${K.path}`:K.path.charCodeAt(0)===47&&(K.path.charCodeAt(1)>=65&&K.path.charCodeAt(1)<=90||K.path.charCodeAt(1)>=97&&K.path.charCodeAt(1)<=122)&&K.path.charCodeAt(2)===58?C?W=K.path.substr(1):W=K.path[1].toLowerCase()+K.path.substr(2):W=K.path,isWindows&&(W=W.replace(/\//g,"\\")),W}function _asFormatted(K,C){const W=C?encodeURIComponentMinimal:encodeURIComponentFast;let V="",{scheme:U,authority:G,path:Z,query:X,fragment:Q}=K;if(U&&(V+=U,V+=":"),(G||U==="file")&&(V+=_slash,V+=_slash),G){let J=G.indexOf("@");if(J!==-1){const ee=G.substr(0,J);G=G.substr(J+1),J=ee.lastIndexOf(":"),J===-1?V+=W(ee,!1,!1):(V+=W(ee.substr(0,J),!1,!1),V+=":",V+=W(ee.substr(J+1),!1,!0)),V+="@"}G=G.toLowerCase(),J=G.lastIndexOf(":"),J===-1?V+=W(G,!1,!0):(V+=W(G.substr(0,J),!1,!0),V+=G.substr(J))}if(Z){if(Z.length>=3&&Z.charCodeAt(0)===47&&Z.charCodeAt(2)===58){const J=Z.charCodeAt(1);J>=65&&J<=90&&(Z=`/${String.fromCharCode(J+32)}:${Z.substr(3)}`)}else if(Z.length>=2&&Z.charCodeAt(1)===58){const J=Z.charCodeAt(0);J>=65&&J<=90&&(Z=`${String.fromCharCode(J+32)}:${Z.substr(2)}`)}V+=W(Z,!0,!1)}return X&&(V+="?",V+=W(X,!1,!1)),Q&&(V+="#",V+=C?Q:encodeURIComponentFast(Q,!1,!1)),V}function decodeURIComponentGraceful(K){try{return decodeURIComponent(K)}catch{return K.length>3?K.substr(0,3)+decodeURIComponentGraceful(K.substr(3)):K}}const _rEncodedAsHex=/(%[0-9A-Za-z][0-9A-Za-z])+/g;function percentDecode(K){return K.match(_rEncodedAsHex)?K.replace(_rEncodedAsHex,C=>decodeURIComponentGraceful(C)):K}let Position$1=class Ot{constructor(C,W){this.lineNumber=C,this.column=W}with(C=this.lineNumber,W=this.column){return C===this.lineNumber&&W===this.column?this:new Ot(C,W)}delta(C=0,W=0){return this.with(this.lineNumber+C,this.column+W)}equals(C){return Ot.equals(this,C)}static equals(C,W){return!C&&!W?!0:!!C&&!!W&&C.lineNumber===W.lineNumber&&C.column===W.column}isBefore(C){return Ot.isBefore(this,C)}static isBefore(C,W){return C.lineNumber<W.lineNumber?!0:W.lineNumber<C.lineNumber?!1:C.column<W.column}isBeforeOrEqual(C){return Ot.isBeforeOrEqual(this,C)}static isBeforeOrEqual(C,W){return C.lineNumber<W.lineNumber?!0:W.lineNumber<C.lineNumber?!1:C.column<=W.column}static compare(C,W){const V=C.lineNumber|0,U=W.lineNumber|0;if(V===U){const G=C.column|0,Z=W.column|0;return G-Z}return V-U}clone(){return new Ot(this.lineNumber,this.column)}toString(){return"("+this.lineNumber+","+this.column+")"}static lift(C){return new Ot(C.lineNumber,C.column)}static isIPosition(C){return C&&typeof C.lineNumber=="number"&&typeof C.column=="number"}},Range$2=class ht{constructor(C,W,V,U){C>V||C===V&&W>U?(this.startLineNumber=V,this.startColumn=U,this.endLineNumber=C,this.endColumn=W):(this.startLineNumber=C,this.startColumn=W,this.endLineNumber=V,this.endColumn=U)}isEmpty(){return ht.isEmpty(this)}static isEmpty(C){return C.startLineNumber===C.endLineNumber&&C.startColumn===C.endColumn}containsPosition(C){return ht.containsPosition(this,C)}static containsPosition(C,W){return!(W.lineNumber<C.startLineNumber||W.lineNumber>C.endLineNumber||W.lineNumber===C.startLineNumber&&W.column<C.startColumn||W.lineNumber===C.endLineNumber&&W.column>C.endColumn)}static strictContainsPosition(C,W){return!(W.lineNumber<C.startLineNumber||W.lineNumber>C.endLineNumber||W.lineNumber===C.startLineNumber&&W.column<=C.startColumn||W.lineNumber===C.endLineNumber&&W.column>=C.endColumn)}containsRange(C){return ht.containsRange(this,C)}static containsRange(C,W){return!(W.startLineNumber<C.startLineNumber||W.endLineNumber<C.startLineNumber||W.startLineNumber>C.endLineNumber||W.endLineNumber>C.endLineNumber||W.startLineNumber===C.startLineNumber&&W.startColumn<C.startColumn||W.endLineNumber===C.endLineNumber&&W.endColumn>C.endColumn)}strictContainsRange(C){return ht.strictContainsRange(this,C)}static strictContainsRange(C,W){return!(W.startLineNumber<C.startLineNumber||W.endLineNumber<C.startLineNumber||W.startLineNumber>C.endLineNumber||W.endLineNumber>C.endLineNumber||W.startLineNumber===C.startLineNumber&&W.startColumn<=C.startColumn||W.endLineNumber===C.endLineNumber&&W.endColumn>=C.endColumn)}plusRange(C){return ht.plusRange(this,C)}static plusRange(C,W){let V,U,G,Z;return W.startLineNumber<C.startLineNumber?(V=W.startLineNumber,U=W.startColumn):W.startLineNumber===C.startLineNumber?(V=W.startLineNumber,U=Math.min(W.startColumn,C.startColumn)):(V=C.startLineNumber,U=C.startColumn),W.endLineNumber>C.endLineNumber?(G=W.endLineNumber,Z=W.endColumn):W.endLineNumber===C.endLineNumber?(G=W.endLineNumber,Z=Math.max(W.endColumn,C.endColumn)):(G=C.endLineNumber,Z=C.endColumn),new ht(V,U,G,Z)}intersectRanges(C){return ht.intersectRanges(this,C)}static intersectRanges(C,W){let V=C.startLineNumber,U=C.startColumn,G=C.endLineNumber,Z=C.endColumn;const X=W.startLineNumber,Q=W.startColumn,J=W.endLineNumber,ee=W.endColumn;return V<X?(V=X,U=Q):V===X&&(U=Math.max(U,Q)),G>J?(G=J,Z=ee):G===J&&(Z=Math.min(Z,ee)),V>G||V===G&&U>Z?null:new ht(V,U,G,Z)}equalsRange(C){return ht.equalsRange(this,C)}static equalsRange(C,W){return!C&&!W?!0:!!C&&!!W&&C.startLineNumber===W.startLineNumber&&C.startColumn===W.startColumn&&C.endLineNumber===W.endLineNumber&&C.endColumn===W.endColumn}getEndPosition(){return ht.getEndPosition(this)}static getEndPosition(C){return new Position$1(C.endLineNumber,C.endColumn)}getStartPosition(){return ht.getStartPosition(this)}static getStartPosition(C){return new Position$1(C.startLineNumber,C.startColumn)}toString(){return"["+this.startLineNumber+","+this.startColumn+" -> "+this.endLineNumber+","+this.endColumn+"]"}setEndPosition(C,W){return new ht(this.startLineNumber,this.startColumn,C,W)}setStartPosition(C,W){return new ht(C,W,this.endLineNumber,this.endColumn)}collapseToStart(){return ht.collapseToStart(this)}static collapseToStart(C){return new ht(C.startLineNumber,C.startColumn,C.startLineNumber,C.startColumn)}collapseToEnd(){return ht.collapseToEnd(this)}static collapseToEnd(C){return new ht(C.endLineNumber,C.endColumn,C.endLineNumber,C.endColumn)}delta(C){return new ht(this.startLineNumber+C,this.startColumn,this.endLineNumber+C,this.endColumn)}static fromPositions(C,W=C){return new ht(C.lineNumber,C.column,W.lineNumber,W.column)}static lift(C){return C?new ht(C.startLineNumber,C.startColumn,C.endLineNumber,C.endColumn):null}static isIRange(C){return C&&typeof C.startLineNumber=="number"&&typeof C.startColumn=="number"&&typeof C.endLineNumber=="number"&&typeof C.endColumn=="number"}static areIntersectingOrTouching(C,W){return!(C.endLineNumber<W.startLineNumber||C.endLineNumber===W.startLineNumber&&C.endColumn<W.startColumn||W.endLineNumber<C.startLineNumber||W.endLineNumber===C.startLineNumber&&W.endColumn<C.startColumn)}static areIntersecting(C,W){return!(C.endLineNumber<W.startLineNumber||C.endLineNumber===W.startLineNumber&&C.endColumn<=W.startColumn||W.endLineNumber<C.startLineNumber||W.endLineNumber===C.startLineNumber&&W.endColumn<=C.startColumn)}static compareRangesUsingStarts(C,W){if(C&&W){const G=C.startLineNumber|0,Z=W.startLineNumber|0;if(G===Z){const X=C.startColumn|0,Q=W.startColumn|0;if(X===Q){const J=C.endLineNumber|0,ee=W.endLineNumber|0;if(J===ee){const te=C.endColumn|0,ie=W.endColumn|0;return te-ie}return J-ee}return X-Q}return G-Z}return(C?1:0)-(W?1:0)}static compareRangesUsingEnds(C,W){return C.endLineNumber===W.endLineNumber?C.endColumn===W.endColumn?C.startLineNumber===W.startLineNumber?C.startColumn-W.startColumn:C.startLineNumber-W.startLineNumber:C.endColumn-W.endColumn:C.endLineNumber-W.endLineNumber}static spansMultipleLines(C){return C.endLineNumber>C.startLineNumber}toJSON(){return this}},Selection$1=class yt extends Range$2{constructor(C,W,V,U){super(C,W,V,U),this.selectionStartLineNumber=C,this.selectionStartColumn=W,this.positionLineNumber=V,this.positionColumn=U}toString(){return"["+this.selectionStartLineNumber+","+this.selectionStartColumn+" -> "+this.positionLineNumber+","+this.positionColumn+"]"}equalsSelection(C){return yt.selectionsEqual(this,C)}static selectionsEqual(C,W){return C.selectionStartLineNumber===W.selectionStartLineNumber&&C.selectionStartColumn===W.selectionStartColumn&&C.positionLineNumber===W.positionLineNumber&&C.positionColumn===W.positionColumn}getDirection(){return this.selectionStartLineNumber===this.startLineNumber&&this.selectionStartColumn===this.startColumn?0:1}setEndPosition(C,W){return this.getDirection()===0?new yt(this.startLineNumber,this.startColumn,C,W):new yt(C,W,this.startLineNumber,this.startColumn)}getPosition(){return new Position$1(this.positionLineNumber,this.positionColumn)}getSelectionStart(){return new Position$1(this.selectionStartLineNumber,this.selectionStartColumn)}setStartPosition(C,W){return this.getDirection()===0?new yt(C,W,this.endLineNumber,this.endColumn):new yt(this.endLineNumber,this.endColumn,C,W)}static fromPositions(C,W=C){return new yt(C.lineNumber,C.column,W.lineNumber,W.column)}static fromRange(C,W){return W===0?new yt(C.startLineNumber,C.startColumn,C.endLineNumber,C.endColumn):new yt(C.endLineNumber,C.endColumn,C.startLineNumber,C.startColumn)}static liftSelection(C){return new yt(C.selectionStartLineNumber,C.selectionStartColumn,C.positionLineNumber,C.positionColumn)}static selectionsArrEqual(C,W){if(C&&!W||!C&&W)return!1;if(!C&&!W)return!0;if(C.length!==W.length)return!1;for(let V=0,U=C.length;V<U;V++)if(!this.selectionsEqual(C[V],W[V]))return!1;return!0}static isISelection(C){return C&&typeof C.selectionStartLineNumber=="number"&&typeof C.selectionStartColumn=="number"&&typeof C.positionLineNumber=="number"&&typeof C.positionColumn=="number"}static createWithDirection(C,W,V,U,G){return G===0?new yt(C,W,V,U):new yt(V,U,C,W)}};const _codiconFontCharacters=Object.create(null);function register$1(K,C){if(isString$3(C)){const W=_codiconFontCharacters[C];if(W===void 0)throw new Error(`${K} references an unknown codicon: ${C}`);C=W}return _codiconFontCharacters[K]=C,{id:K}}function getCodiconFontCharacters(){return _codiconFontCharacters}const Codicon={add:register$1("add",6e4),plus:register$1("plus",6e4),gistNew:register$1("gist-new",6e4),repoCreate:register$1("repo-create",6e4),lightbulb:register$1("lightbulb",60001),lightBulb:register$1("light-bulb",60001),repo:register$1("repo",60002),repoDelete:register$1("repo-delete",60002),gistFork:register$1("gist-fork",60003),repoForked:register$1("repo-forked",60003),gitPullRequest:register$1("git-pull-request",60004),gitPullRequestAbandoned:register$1("git-pull-request-abandoned",60004),recordKeys:register$1("record-keys",60005),keyboard:register$1("keyboard",60005),tag:register$1("tag",60006),tagAdd:register$1("tag-add",60006),tagRemove:register$1("tag-remove",60006),gitPullRequestLabel:register$1("git-pull-request-label",60006),person:register$1("person",60007),personFollow:register$1("person-follow",60007),personOutline:register$1("person-outline",60007),personFilled:register$1("person-filled",60007),gitBranch:register$1("git-branch",60008),gitBranchCreate:register$1("git-branch-create",60008),gitBranchDelete:register$1("git-branch-delete",60008),sourceControl:register$1("source-control",60008),mirror:register$1("mirror",60009),mirrorPublic:register$1("mirror-public",60009),star:register$1("star",60010),starAdd:register$1("star-add",60010),starDelete:register$1("star-delete",60010),starEmpty:register$1("star-empty",60010),comment:register$1("comment",60011),commentAdd:register$1("comment-add",60011),alert:register$1("alert",60012),warning:register$1("warning",60012),search:register$1("search",60013),searchSave:register$1("search-save",60013),logOut:register$1("log-out",60014),signOut:register$1("sign-out",60014),logIn:register$1("log-in",60015),signIn:register$1("sign-in",60015),eye:register$1("eye",60016),eyeUnwatch:register$1("eye-unwatch",60016),eyeWatch:register$1("eye-watch",60016),circleFilled:register$1("circle-filled",60017),primitiveDot:register$1("primitive-dot",60017),closeDirty:register$1("close-dirty",60017),debugBreakpoint:register$1("debug-breakpoint",60017),debugBreakpointDisabled:register$1("debug-breakpoint-disabled",60017),debugHint:register$1("debug-hint",60017),primitiveSquare:register$1("primitive-square",60018),edit:register$1("edit",60019),pencil:register$1("pencil",60019),info:register$1("info",60020),issueOpened:register$1("issue-opened",60020),gistPrivate:register$1("gist-private",60021),gitForkPrivate:register$1("git-fork-private",60021),lock:register$1("lock",60021),mirrorPrivate:register$1("mirror-private",60021),close:register$1("close",60022),removeClose:register$1("remove-close",60022),x:register$1("x",60022),repoSync:register$1("repo-sync",60023),sync:register$1("sync",60023),clone:register$1("clone",60024),desktopDownload:register$1("desktop-download",60024),beaker:register$1("beaker",60025),microscope:register$1("microscope",60025),vm:register$1("vm",60026),deviceDesktop:register$1("device-desktop",60026),file:register$1("file",60027),fileText:register$1("file-text",60027),more:register$1("more",60028),ellipsis:register$1("ellipsis",60028),kebabHorizontal:register$1("kebab-horizontal",60028),mailReply:register$1("mail-reply",60029),reply:register$1("reply",60029),organization:register$1("organization",60030),organizationFilled:register$1("organization-filled",60030),organizationOutline:register$1("organization-outline",60030),newFile:register$1("new-file",60031),fileAdd:register$1("file-add",60031),newFolder:register$1("new-folder",60032),fileDirectoryCreate:register$1("file-directory-create",60032),trash:register$1("trash",60033),trashcan:register$1("trashcan",60033),history:register$1("history",60034),clock:register$1("clock",60034),folder:register$1("folder",60035),fileDirectory:register$1("file-directory",60035),symbolFolder:register$1("symbol-folder",60035),logoGithub:register$1("logo-github",60036),markGithub:register$1("mark-github",60036),github:register$1("github",60036),terminal:register$1("terminal",60037),console:register$1("console",60037),repl:register$1("repl",60037),zap:register$1("zap",60038),symbolEvent:register$1("symbol-event",60038),error:register$1("error",60039),stop:register$1("stop",60039),variable:register$1("variable",60040),symbolVariable:register$1("symbol-variable",60040),array:register$1("array",60042),symbolArray:register$1("symbol-array",60042),symbolModule:register$1("symbol-module",60043),symbolPackage:register$1("symbol-package",60043),symbolNamespace:register$1("symbol-namespace",60043),symbolObject:register$1("symbol-object",60043),symbolMethod:register$1("symbol-method",60044),symbolFunction:register$1("symbol-function",60044),symbolConstructor:register$1("symbol-constructor",60044),symbolBoolean:register$1("symbol-boolean",60047),symbolNull:register$1("symbol-null",60047),symbolNumeric:register$1("symbol-numeric",60048),symbolNumber:register$1("symbol-number",60048),symbolStructure:register$1("symbol-structure",60049),symbolStruct:register$1("symbol-struct",60049),symbolParameter:register$1("symbol-parameter",60050),symbolTypeParameter:register$1("symbol-type-parameter",60050),symbolKey:register$1("symbol-key",60051),symbolText:register$1("symbol-text",60051),symbolReference:register$1("symbol-reference",60052),goToFile:register$1("go-to-file",60052),symbolEnum:register$1("symbol-enum",60053),symbolValue:register$1("symbol-value",60053),symbolRuler:register$1("symbol-ruler",60054),symbolUnit:register$1("symbol-unit",60054),activateBreakpoints:register$1("activate-breakpoints",60055),archive:register$1("archive",60056),arrowBoth:register$1("arrow-both",60057),arrowDown:register$1("arrow-down",60058),arrowLeft:register$1("arrow-left",60059),arrowRight:register$1("arrow-right",60060),arrowSmallDown:register$1("arrow-small-down",60061),arrowSmallLeft:register$1("arrow-small-left",60062),arrowSmallRight:register$1("arrow-small-right",60063),arrowSmallUp:register$1("arrow-small-up",60064),arrowUp:register$1("arrow-up",60065),bell:register$1("bell",60066),bold:register$1("bold",60067),book:register$1("book",60068),bookmark:register$1("bookmark",60069),debugBreakpointConditionalUnverified:register$1("debug-breakpoint-conditional-unverified",60070),debugBreakpointConditional:register$1("debug-breakpoint-conditional",60071),debugBreakpointConditionalDisabled:register$1("debug-breakpoint-conditional-disabled",60071),debugBreakpointDataUnverified:register$1("debug-breakpoint-data-unverified",60072),debugBreakpointData:register$1("debug-breakpoint-data",60073),debugBreakpointDataDisabled:register$1("debug-breakpoint-data-disabled",60073),debugBreakpointLogUnverified:register$1("debug-breakpoint-log-unverified",60074),debugBreakpointLog:register$1("debug-breakpoint-log",60075),debugBreakpointLogDisabled:register$1("debug-breakpoint-log-disabled",60075),briefcase:register$1("briefcase",60076),broadcast:register$1("broadcast",60077),browser:register$1("browser",60078),bug:register$1("bug",60079),calendar:register$1("calendar",60080),caseSensitive:register$1("case-sensitive",60081),check:register$1("check",60082),checklist:register$1("checklist",60083),chevronDown:register$1("chevron-down",60084),dropDownButton:register$1("drop-down-button",60084),chevronLeft:register$1("chevron-left",60085),chevronRight:register$1("chevron-right",60086),chevronUp:register$1("chevron-up",60087),chromeClose:register$1("chrome-close",60088),chromeMaximize:register$1("chrome-maximize",60089),chromeMinimize:register$1("chrome-minimize",60090),chromeRestore:register$1("chrome-restore",60091),circle:register$1("circle",60092),circleOutline:register$1("circle-outline",60092),debugBreakpointUnverified:register$1("debug-breakpoint-unverified",60092),circleSlash:register$1("circle-slash",60093),circuitBoard:register$1("circuit-board",60094),clearAll:register$1("clear-all",60095),clippy:register$1("clippy",60096),closeAll:register$1("close-all",60097),cloudDownload:register$1("cloud-download",60098),cloudUpload:register$1("cloud-upload",60099),code:register$1("code",60100),collapseAll:register$1("collapse-all",60101),colorMode:register$1("color-mode",60102),commentDiscussion:register$1("comment-discussion",60103),compareChanges:register$1("compare-changes",60157),creditCard:register$1("credit-card",60105),dash:register$1("dash",60108),dashboard:register$1("dashboard",60109),database:register$1("database",60110),debugContinue:register$1("debug-continue",60111),debugDisconnect:register$1("debug-disconnect",60112),debugPause:register$1("debug-pause",60113),debugRestart:register$1("debug-restart",60114),debugStart:register$1("debug-start",60115),debugStepInto:register$1("debug-step-into",60116),debugStepOut:register$1("debug-step-out",60117),debugStepOver:register$1("debug-step-over",60118),debugStop:register$1("debug-stop",60119),debug:register$1("debug",60120),deviceCameraVideo:register$1("device-camera-video",60121),deviceCamera:register$1("device-camera",60122),deviceMobile:register$1("device-mobile",60123),diffAdded:register$1("diff-added",60124),diffIgnored:register$1("diff-ignored",60125),diffModified:register$1("diff-modified",60126),diffRemoved:register$1("diff-removed",60127),diffRenamed:register$1("diff-renamed",60128),diff:register$1("diff",60129),discard:register$1("discard",60130),editorLayout:register$1("editor-layout",60131),emptyWindow:register$1("empty-window",60132),exclude:register$1("exclude",60133),extensions:register$1("extensions",60134),eyeClosed:register$1("eye-closed",60135),fileBinary:register$1("file-binary",60136),fileCode:register$1("file-code",60137),fileMedia:register$1("file-media",60138),filePdf:register$1("file-pdf",60139),fileSubmodule:register$1("file-submodule",60140),fileSymlinkDirectory:register$1("file-symlink-directory",60141),fileSymlinkFile:register$1("file-symlink-file",60142),fileZip:register$1("file-zip",60143),files:register$1("files",60144),filter:register$1("filter",60145),flame:register$1("flame",60146),foldDown:register$1("fold-down",60147),foldUp:register$1("fold-up",60148),fold:register$1("fold",60149),folderActive:register$1("folder-active",60150),folderOpened:register$1("folder-opened",60151),gear:register$1("gear",60152),gift:register$1("gift",60153),gistSecret:register$1("gist-secret",60154),gist:register$1("gist",60155),gitCommit:register$1("git-commit",60156),gitCompare:register$1("git-compare",60157),gitMerge:register$1("git-merge",60158),githubAction:register$1("github-action",60159),githubAlt:register$1("github-alt",60160),globe:register$1("globe",60161),grabber:register$1("grabber",60162),graph:register$1("graph",60163),gripper:register$1("gripper",60164),heart:register$1("heart",60165),home:register$1("home",60166),horizontalRule:register$1("horizontal-rule",60167),hubot:register$1("hubot",60168),inbox:register$1("inbox",60169),issueClosed:register$1("issue-closed",60324),issueReopened:register$1("issue-reopened",60171),issues:register$1("issues",60172),italic:register$1("italic",60173),jersey:register$1("jersey",60174),json:register$1("json",60175),bracket:register$1("bracket",60175),kebabVertical:register$1("kebab-vertical",60176),key:register$1("key",60177),law:register$1("law",60178),lightbulbAutofix:register$1("lightbulb-autofix",60179),linkExternal:register$1("link-external",60180),link:register$1("link",60181),listOrdered:register$1("list-ordered",60182),listUnordered:register$1("list-unordered",60183),liveShare:register$1("live-share",60184),loading:register$1("loading",60185),location:register$1("location",60186),mailRead:register$1("mail-read",60187),mail:register$1("mail",60188),markdown:register$1("markdown",60189),megaphone:register$1("megaphone",60190),mention:register$1("mention",60191),milestone:register$1("milestone",60192),gitPullRequestMilestone:register$1("git-pull-request-milestone",60192),mortarBoard:register$1("mortar-board",60193),move:register$1("move",60194),multipleWindows:register$1("multiple-windows",60195),mute:register$1("mute",60196),noNewline:register$1("no-newline",60197),note:register$1("note",60198),octoface:register$1("octoface",60199),openPreview:register$1("open-preview",60200),package:register$1("package",60201),paintcan:register$1("paintcan",60202),pin:register$1("pin",60203),play:register$1("play",60204),run:register$1("run",60204),plug:register$1("plug",60205),preserveCase:register$1("preserve-case",60206),preview:register$1("preview",60207),project:register$1("project",60208),pulse:register$1("pulse",60209),question:register$1("question",60210),quote:register$1("quote",60211),radioTower:register$1("radio-tower",60212),reactions:register$1("reactions",60213),references:register$1("references",60214),refresh:register$1("refresh",60215),regex:register$1("regex",60216),remoteExplorer:register$1("remote-explorer",60217),remote:register$1("remote",60218),remove:register$1("remove",60219),replaceAll:register$1("replace-all",60220),replace:register$1("replace",60221),repoClone:register$1("repo-clone",60222),repoForcePush:register$1("repo-force-push",60223),repoPull:register$1("repo-pull",60224),repoPush:register$1("repo-push",60225),report:register$1("report",60226),requestChanges:register$1("request-changes",60227),rocket:register$1("rocket",60228),rootFolderOpened:register$1("root-folder-opened",60229),rootFolder:register$1("root-folder",60230),rss:register$1("rss",60231),ruby:register$1("ruby",60232),saveAll:register$1("save-all",60233),saveAs:register$1("save-as",60234),save:register$1("save",60235),screenFull:register$1("screen-full",60236),screenNormal:register$1("screen-normal",60237),searchStop:register$1("search-stop",60238),server:register$1("server",60240),settingsGear:register$1("settings-gear",60241),settings:register$1("settings",60242),shield:register$1("shield",60243),smiley:register$1("smiley",60244),sortPrecedence:register$1("sort-precedence",60245),splitHorizontal:register$1("split-horizontal",60246),splitVertical:register$1("split-vertical",60247),squirrel:register$1("squirrel",60248),starFull:register$1("star-full",60249),starHalf:register$1("star-half",60250),symbolClass:register$1("symbol-class",60251),symbolColor:register$1("symbol-color",60252),symbolCustomColor:register$1("symbol-customcolor",60252),symbolConstant:register$1("symbol-constant",60253),symbolEnumMember:register$1("symbol-enum-member",60254),symbolField:register$1("symbol-field",60255),symbolFile:register$1("symbol-file",60256),symbolInterface:register$1("symbol-interface",60257),symbolKeyword:register$1("symbol-keyword",60258),symbolMisc:register$1("symbol-misc",60259),symbolOperator:register$1("symbol-operator",60260),symbolProperty:register$1("symbol-property",60261),wrench:register$1("wrench",60261),wrenchSubaction:register$1("wrench-subaction",60261),symbolSnippet:register$1("symbol-snippet",60262),tasklist:register$1("tasklist",60263),telescope:register$1("telescope",60264),textSize:register$1("text-size",60265),threeBars:register$1("three-bars",60266),thumbsdown:register$1("thumbsdown",60267),thumbsup:register$1("thumbsup",60268),tools:register$1("tools",60269),triangleDown:register$1("triangle-down",60270),triangleLeft:register$1("triangle-left",60271),triangleRight:register$1("triangle-right",60272),triangleUp:register$1("triangle-up",60273),twitter:register$1("twitter",60274),unfold:register$1("unfold",60275),unlock:register$1("unlock",60276),unmute:register$1("unmute",60277),unverified:register$1("unverified",60278),verified:register$1("verified",60279),versions:register$1("versions",60280),vmActive:register$1("vm-active",60281),vmOutline:register$1("vm-outline",60282),vmRunning:register$1("vm-running",60283),watch:register$1("watch",60284),whitespace:register$1("whitespace",60285),wholeWord:register$1("whole-word",60286),window:register$1("window",60287),wordWrap:register$1("word-wrap",60288),zoomIn:register$1("zoom-in",60289),zoomOut:register$1("zoom-out",60290),listFilter:register$1("list-filter",60291),listFlat:register$1("list-flat",60292),listSelection:register$1("list-selection",60293),selection:register$1("selection",60293),listTree:register$1("list-tree",60294),debugBreakpointFunctionUnverified:register$1("debug-breakpoint-function-unverified",60295),debugBreakpointFunction:register$1("debug-breakpoint-function",60296),debugBreakpointFunctionDisabled:register$1("debug-breakpoint-function-disabled",60296),debugStackframeActive:register$1("debug-stackframe-active",60297),circleSmallFilled:register$1("circle-small-filled",60298),debugStackframeDot:register$1("debug-stackframe-dot",60298),debugStackframe:register$1("debug-stackframe",60299),debugStackframeFocused:register$1("debug-stackframe-focused",60299),debugBreakpointUnsupported:register$1("debug-breakpoint-unsupported",60300),symbolString:register$1("symbol-string",60301),debugReverseContinue:register$1("debug-reverse-continue",60302),debugStepBack:register$1("debug-step-back",60303),debugRestartFrame:register$1("debug-restart-frame",60304),callIncoming:register$1("call-incoming",60306),callOutgoing:register$1("call-outgoing",60307),menu:register$1("menu",60308),expandAll:register$1("expand-all",60309),feedback:register$1("feedback",60310),gitPullRequestReviewer:register$1("git-pull-request-reviewer",60310),groupByRefType:register$1("group-by-ref-type",60311),ungroupByRefType:register$1("ungroup-by-ref-type",60312),account:register$1("account",60313),gitPullRequestAssignee:register$1("git-pull-request-assignee",60313),bellDot:register$1("bell-dot",60314),debugConsole:register$1("debug-console",60315),library:register$1("library",60316),output:register$1("output",60317),runAll:register$1("run-all",60318),syncIgnored:register$1("sync-ignored",60319),pinned:register$1("pinned",60320),githubInverted:register$1("github-inverted",60321),debugAlt:register$1("debug-alt",60305),serverProcess:register$1("server-process",60322),serverEnvironment:register$1("server-environment",60323),pass:register$1("pass",60324),stopCircle:register$1("stop-circle",60325),playCircle:register$1("play-circle",60326),record:register$1("record",60327),debugAltSmall:register$1("debug-alt-small",60328),vmConnect:register$1("vm-connect",60329),cloud:register$1("cloud",60330),merge:register$1("merge",60331),exportIcon:register$1("export",60332),graphLeft:register$1("graph-left",60333),magnet:register$1("magnet",60334),notebook:register$1("notebook",60335),redo:register$1("redo",60336),checkAll:register$1("check-all",60337),pinnedDirty:register$1("pinned-dirty",60338),passFilled:register$1("pass-filled",60339),circleLargeFilled:register$1("circle-large-filled",60340),circleLarge:register$1("circle-large",60341),circleLargeOutline:register$1("circle-large-outline",60341),combine:register$1("combine",60342),gather:register$1("gather",60342),table:register$1("table",60343),variableGroup:register$1("variable-group",60344),typeHierarchy:register$1("type-hierarchy",60345),typeHierarchySub:register$1("type-hierarchy-sub",60346),typeHierarchySuper:register$1("type-hierarchy-super",60347),gitPullRequestCreate:register$1("git-pull-request-create",60348),runAbove:register$1("run-above",60349),runBelow:register$1("run-below",60350),notebookTemplate:register$1("notebook-template",60351),debugRerun:register$1("debug-rerun",60352),workspaceTrusted:register$1("workspace-trusted",60353),workspaceUntrusted:register$1("workspace-untrusted",60354),workspaceUnspecified:register$1("workspace-unspecified",60355),terminalCmd:register$1("terminal-cmd",60356),terminalDebian:register$1("terminal-debian",60357),terminalLinux:register$1("terminal-linux",60358),terminalPowershell:register$1("terminal-powershell",60359),terminalTmux:register$1("terminal-tmux",60360),terminalUbuntu:register$1("terminal-ubuntu",60361),terminalBash:register$1("terminal-bash",60362),arrowSwap:register$1("arrow-swap",60363),copy:register$1("copy",60364),personAdd:register$1("person-add",60365),filterFilled:register$1("filter-filled",60366),wand:register$1("wand",60367),debugLineByLine:register$1("debug-line-by-line",60368),inspect:register$1("inspect",60369),layers:register$1("layers",60370),layersDot:register$1("layers-dot",60371),layersActive:register$1("layers-active",60372),compass:register$1("compass",60373),compassDot:register$1("compass-dot",60374),compassActive:register$1("compass-active",60375),azure:register$1("azure",60376),issueDraft:register$1("issue-draft",60377),gitPullRequestClosed:register$1("git-pull-request-closed",60378),gitPullRequestDraft:register$1("git-pull-request-draft",60379),debugAll:register$1("debug-all",60380),debugCoverage:register$1("debug-coverage",60381),runErrors:register$1("run-errors",60382),folderLibrary:register$1("folder-library",60383),debugContinueSmall:register$1("debug-continue-small",60384),beakerStop:register$1("beaker-stop",60385),graphLine:register$1("graph-line",60386),graphScatter:register$1("graph-scatter",60387),pieChart:register$1("pie-chart",60388),bracketDot:register$1("bracket-dot",60389),bracketError:register$1("bracket-error",60390),lockSmall:register$1("lock-small",60391),azureDevops:register$1("azure-devops",60392),verifiedFilled:register$1("verified-filled",60393),newLine:register$1("newline",60394),layout:register$1("layout",60395),layoutActivitybarLeft:register$1("layout-activitybar-left",60396),layoutActivitybarRight:register$1("layout-activitybar-right",60397),layoutPanelLeft:register$1("layout-panel-left",60398),layoutPanelCenter:register$1("layout-panel-center",60399),layoutPanelJustify:register$1("layout-panel-justify",60400),layoutPanelRight:register$1("layout-panel-right",60401),layoutPanel:register$1("layout-panel",60402),layoutSidebarLeft:register$1("layout-sidebar-left",60403),layoutSidebarRight:register$1("layout-sidebar-right",60404),layoutStatusbar:register$1("layout-statusbar",60405),layoutMenubar:register$1("layout-menubar",60406),layoutCentered:register$1("layout-centered",60407),layoutSidebarRightOff:register$1("layout-sidebar-right-off",60416),layoutPanelOff:register$1("layout-panel-off",60417),layoutSidebarLeftOff:register$1("layout-sidebar-left-off",60418),target:register$1("target",60408),indent:register$1("indent",60409),recordSmall:register$1("record-small",60410),errorSmall:register$1("error-small",60411),arrowCircleDown:register$1("arrow-circle-down",60412),arrowCircleLeft:register$1("arrow-circle-left",60413),arrowCircleRight:register$1("arrow-circle-right",60414),arrowCircleUp:register$1("arrow-circle-up",60415),heartFilled:register$1("heart-filled",60420),map:register$1("map",60421),mapFilled:register$1("map-filled",60422),circleSmall:register$1("circle-small",60423),bellSlash:register$1("bell-slash",60424),bellSlashDot:register$1("bell-slash-dot",60425),commentUnresolved:register$1("comment-unresolved",60426),gitPullRequestGoToChanges:register$1("git-pull-request-go-to-changes",60427),gitPullRequestNewChanges:register$1("git-pull-request-new-changes",60428),searchFuzzy:register$1("search-fuzzy",60429),commentDraft:register$1("comment-draft",60430),send:register$1("send",60431),sparkle:register$1("sparkle",60432),insert:register$1("insert",60433),mic:register$1("mic",60434),dialogError:register$1("dialog-error","error"),dialogWarning:register$1("dialog-warning","warning"),dialogInfo:register$1("dialog-info","info"),dialogClose:register$1("dialog-close","close"),treeItemExpanded:register$1("tree-item-expanded","chevron-down"),treeFilterOnTypeOn:register$1("tree-filter-on-type-on","list-filter"),treeFilterOnTypeOff:register$1("tree-filter-on-type-off","list-selection"),treeFilterClear:register$1("tree-filter-clear","close"),treeItemLoading:register$1("tree-item-loading","loading"),menuSelection:register$1("menu-selection","check"),menuSubmenu:register$1("menu-submenu","chevron-right"),menuBarMore:register$1("menubar-more","more"),scrollbarButtonLeft:register$1("scrollbar-button-left","triangle-left"),scrollbarButtonRight:register$1("scrollbar-button-right","triangle-right"),scrollbarButtonUp:register$1("scrollbar-button-up","triangle-up"),scrollbarButtonDown:register$1("scrollbar-button-down","triangle-down"),toolBarMore:register$1("toolbar-more","more"),quickInputBack:register$1("quick-input-back","arrow-left")};var __awaiter$1B=globalThis&&globalThis.__awaiter||function(K,C,W,V){function U(G){return G instanceof W?G:new W(function(Z){Z(G)})}return new(W||(W=Promise))(function(G,Z){function X(ee){try{J(V.next(ee))}catch(te){Z(te)}}function Q(ee){try{J(V.throw(ee))}catch(te){Z(te)}}function J(ee){ee.done?G(ee.value):U(ee.value).then(X,Q)}J((V=V.apply(K,C||[])).next())})};let TokenizationRegistry$1=class{constructor(){this._tokenizationSupports=new Map,this._factories=new Map,this._onDidChange=new Emitter$1,this.onDidChange=this._onDidChange.event,this._colorMap=null}handleChange(C){this._onDidChange.fire({changedLanguages:C,changedColorMap:!1})}register(C,W){return this._tokenizationSupports.set(C,W),this.handleChange([C]),toDisposable(()=>{this._tokenizationSupports.get(C)===W&&(this._tokenizationSupports.delete(C),this.handleChange([C]))})}get(C){return this._tokenizationSupports.get(C)||null}registerFactory(C,W){var V;(V=this._factories.get(C))===null||V===void 0||V.dispose();const U=new TokenizationSupportFactoryData(this,C,W);return this._factories.set(C,U),toDisposable(()=>{const G=this._factories.get(C);!G||G!==U||(this._factories.delete(C),G.dispose())})}getOrCreate(C){return __awaiter$1B(this,void 0,void 0,function*(){const W=this.get(C);if(W)return W;const V=this._factories.get(C);return!V||V.isResolved?null:(yield V.resolve(),this.get(C))})}isResolved(C){if(this.get(C))return!0;const V=this._factories.get(C);return!!(!V||V.isResolved)}setColorMap(C){this._colorMap=C,this._onDidChange.fire({changedLanguages:Array.from(this._tokenizationSupports.keys()),changedColorMap:!0})}getColorMap(){return this._colorMap}getDefaultBackground(){return this._colorMap&&this._colorMap.length>2?this._colorMap[2]:null}};class TokenizationSupportFactoryData extends Disposable{get isResolved(){return this._isResolved}constructor(C,W,V){super(),this._registry=C,this._languageId=W,this._factory=V,this._isDisposed=!1,this._resolvePromise=null,this._isResolved=!1}dispose(){this._isDisposed=!0,super.dispose()}resolve(){return __awaiter$1B(this,void 0,void 0,function*(){return this._resolvePromise||(this._resolvePromise=this._create()),this._resolvePromise})}_create(){return __awaiter$1B(this,void 0,void 0,function*(){const C=yield this._factory.tokenizationSupport;this._isResolved=!0,C&&!this._isDisposed&&this._register(this._registry.register(this._languageId,C))})}}let Token$2=class{constructor(C,W,V){this.offset=C,this.type=W,this.language=V,this._tokenBrand=void 0}toString(){return"("+this.offset+", "+this.type+")"}};class TokenizationResult{constructor(C,W){this.tokens=C,this.endState=W,this._tokenizationResultBrand=void 0}}class EncodedTokenizationResult{constructor(C,W){this.tokens=C,this.endState=W,this._encodedTokenizationResultBrand=void 0}}var CompletionItemKinds;(function(K){const C=new Map;C.set(0,Codicon.symbolMethod),C.set(1,Codicon.symbolFunction),C.set(2,Codicon.symbolConstructor),C.set(3,Codicon.symbolField),C.set(4,Codicon.symbolVariable),C.set(5,Codicon.symbolClass),C.set(6,Codicon.symbolStruct),C.set(7,Codicon.symbolInterface),C.set(8,Codicon.symbolModule),C.set(9,Codicon.symbolProperty),C.set(10,Codicon.symbolEvent),C.set(11,Codicon.symbolOperator),C.set(12,Codicon.symbolUnit),C.set(13,Codicon.symbolValue),C.set(15,Codicon.symbolEnum),C.set(14,Codicon.symbolConstant),C.set(15,Codicon.symbolEnum),C.set(16,Codicon.symbolEnumMember),C.set(17,Codicon.symbolKeyword),C.set(27,Codicon.symbolSnippet),C.set(18,Codicon.symbolText),C.set(19,Codicon.symbolColor),C.set(20,Codicon.symbolFile),C.set(21,Codicon.symbolReference),C.set(22,Codicon.symbolCustomColor),C.set(23,Codicon.symbolFolder),C.set(24,Codicon.symbolTypeParameter),C.set(25,Codicon.account),C.set(26,Codicon.issues);function W(G){let Z=C.get(G);return Z||(console.info("No codicon found for CompletionItemKind "+G),Z=Codicon.symbolProperty),Z}K.toIcon=W;const V=new Map;V.set("method",0),V.set("function",1),V.set("constructor",2),V.set("field",3),V.set("variable",4),V.set("class",5),V.set("struct",6),V.set("interface",7),V.set("module",8),V.set("property",9),V.set("event",10),V.set("operator",11),V.set("unit",12),V.set("value",13),V.set("constant",14),V.set("enum",15),V.set("enum-member",16),V.set("enumMember",16),V.set("keyword",17),V.set("snippet",27),V.set("text",18),V.set("color",19),V.set("file",20),V.set("reference",21),V.set("customcolor",22),V.set("folder",23),V.set("type-parameter",24),V.set("typeParameter",24),V.set("account",25),V.set("issue",26);function U(G,Z){let X=V.get(G);return typeof X>"u"&&!Z&&(X=9),X}K.fromString=U})(CompletionItemKinds||(CompletionItemKinds={}));var InlineCompletionTriggerKind$1;(function(K){K[K.Automatic=0]="Automatic",K[K.Explicit=1]="Explicit"})(InlineCompletionTriggerKind$1||(InlineCompletionTriggerKind$1={}));class SelectedSuggestionInfo{constructor(C,W,V,U){this.range=C,this.text=W,this.completionKind=V,this.isSnippetText=U}equals(C){return Range$2.lift(this.range).equalsRange(C.range)&&this.text===C.text&&this.completionKind===C.completionKind&&this.isSnippetText===C.isSnippetText}}var SignatureHelpTriggerKind$1;(function(K){K[K.Invoke=1]="Invoke",K[K.TriggerCharacter=2]="TriggerCharacter",K[K.ContentChange=3]="ContentChange"})(SignatureHelpTriggerKind$1||(SignatureHelpTriggerKind$1={}));var DocumentHighlightKind$1;(function(K){K[K.Text=0]="Text",K[K.Read=1]="Read",K[K.Write=2]="Write"})(DocumentHighlightKind$1||(DocumentHighlightKind$1={}));function isLocationLink(K){return K&&URI.isUri(K.uri)&&Range$2.isIRange(K.range)&&(Range$2.isIRange(K.originSelectionRange)||Range$2.isIRange(K.targetSelectionRange))}const symbolKindNames={17:localize("Array","array"),16:localize("Boolean","boolean"),4:localize("Class","class"),13:localize("Constant","constant"),8:localize("Constructor","constructor"),9:localize("Enum","enumeration"),21:localize("EnumMember","enumeration member"),23:localize("Event","event"),7:localize("Field","field"),0:localize("File","file"),11:localize("Function","function"),10:localize("Interface","interface"),19:localize("Key","key"),5:localize("Method","method"),1:localize("Module","module"),2:localize("Namespace","namespace"),20:localize("Null","null"),15:localize("Number","number"),18:localize("Object","object"),24:localize("Operator","operator"),3:localize("Package","package"),6:localize("Property","property"),14:localize("String","string"),22:localize("Struct","struct"),25:localize("TypeParameter","type parameter"),12:localize("Variable","variable")};function getAriaLabelForSymbol(K,C){return localize("symbolAriaLabel","{0} ({1})",K,symbolKindNames[C])}var SymbolKinds;(function(K){const C=new Map;C.set(0,Codicon.symbolFile),C.set(1,Codicon.symbolModule),C.set(2,Codicon.symbolNamespace),C.set(3,Codicon.symbolPackage),C.set(4,Codicon.symbolClass),C.set(5,Codicon.symbolMethod),C.set(6,Codicon.symbolProperty),C.set(7,Codicon.symbolField),C.set(8,Codicon.symbolConstructor),C.set(9,Codicon.symbolEnum),C.set(10,Codicon.symbolInterface),C.set(11,Codicon.symbolFunction),C.set(12,Codicon.symbolVariable),C.set(13,Codicon.symbolConstant),C.set(14,Codicon.symbolString),C.set(15,Codicon.symbolNumber),C.set(16,Codicon.symbolBoolean),C.set(17,Codicon.symbolArray),C.set(18,Codicon.symbolObject),C.set(19,Codicon.symbolKey),C.set(20,Codicon.symbolNull),C.set(21,Codicon.symbolEnumMember),C.set(22,Codicon.symbolStruct),C.set(23,Codicon.symbolEvent),C.set(24,Codicon.symbolOperator),C.set(25,Codicon.symbolTypeParameter);function W(V){let U=C.get(V);return U||(console.info("No codicon found for SymbolKind "+V),U=Codicon.symbolProperty),U}K.toIcon=W})(SymbolKinds||(SymbolKinds={}));class FoldingRangeKind{static fromValue(C){switch(C){case"comment":return FoldingRangeKind.Comment;case"imports":return FoldingRangeKind.Imports;case"region":return FoldingRangeKind.Region}return new FoldingRangeKind(C)}constructor(C){this.value=C}}FoldingRangeKind.Comment=new FoldingRangeKind("comment");FoldingRangeKind.Imports=new FoldingRangeKind("imports");FoldingRangeKind.Region=new FoldingRangeKind("region");var Command$1;(function(K){function C(W){return!W||typeof W!="object"?!1:typeof W.id=="string"&&typeof W.title=="string"}K.is=C})(Command$1||(Command$1={}));var InlayHintKind$1;(function(K){K[K.Type=1]="Type",K[K.Parameter=2]="Parameter"})(InlayHintKind$1||(InlayHintKind$1={}));class LazyTokenizationSupport{constructor(C){this.createSupport=C,this._tokenizationSupport=null}dispose(){this._tokenizationSupport&&this._tokenizationSupport.then(C=>{C&&C.dispose()})}get tokenizationSupport(){return this._tokenizationSupport||(this._tokenizationSupport=this.createSupport()),this._tokenizationSupport}}const TokenizationRegistry=new TokenizationRegistry$1;var AccessibilitySupport;(function(K){K[K.Unknown=0]="Unknown",K[K.Disabled=1]="Disabled",K[K.Enabled=2]="Enabled"})(AccessibilitySupport||(AccessibilitySupport={}));var CodeActionTriggerType;(function(K){K[K.Invoke=1]="Invoke",K[K.Auto=2]="Auto"})(CodeActionTriggerType||(CodeActionTriggerType={}));var CompletionItemInsertTextRule;(function(K){K[K.None=0]="None",K[K.KeepWhitespace=1]="KeepWhitespace",K[K.InsertAsSnippet=4]="InsertAsSnippet"})(CompletionItemInsertTextRule||(CompletionItemInsertTextRule={}));var CompletionItemKind;(function(K){K[K.Method=0]="Method",K[K.Function=1]="Function",K[K.Constructor=2]="Constructor",K[K.Field=3]="Field",K[K.Variable=4]="Variable",K[K.Class=5]="Class",K[K.Struct=6]="Struct",K[K.Interface=7]="Interface",K[K.Module=8]="Module",K[K.Property=9]="Property",K[K.Event=10]="Event",K[K.Operator=11]="Operator",K[K.Unit=12]="Unit",K[K.Value=13]="Value",K[K.Constant=14]="Constant",K[K.Enum=15]="Enum",K[K.EnumMember=16]="EnumMember",K[K.Keyword=17]="Keyword",K[K.Text=18]="Text",K[K.Color=19]="Color",K[K.File=20]="File",K[K.Reference=21]="Reference",K[K.Customcolor=22]="Customcolor",K[K.Folder=23]="Folder",K[K.TypeParameter=24]="TypeParameter",K[K.User=25]="User",K[K.Issue=26]="Issue",K[K.Snippet=27]="Snippet"})(CompletionItemKind||(CompletionItemKind={}));var CompletionItemTag;(function(K){K[K.Deprecated=1]="Deprecated"})(CompletionItemTag||(CompletionItemTag={}));var CompletionTriggerKind;(function(K){K[K.Invoke=0]="Invoke",K[K.TriggerCharacter=1]="TriggerCharacter",K[K.TriggerForIncompleteCompletions=2]="TriggerForIncompleteCompletions"})(CompletionTriggerKind||(CompletionTriggerKind={}));var ContentWidgetPositionPreference;(function(K){K[K.EXACT=0]="EXACT",K[K.ABOVE=1]="ABOVE",K[K.BELOW=2]="BELOW"})(ContentWidgetPositionPreference||(ContentWidgetPositionPreference={}));var CursorChangeReason;(function(K){K[K.NotSet=0]="NotSet",K[K.ContentFlush=1]="ContentFlush",K[K.RecoverFromMarkers=2]="RecoverFromMarkers",K[K.Explicit=3]="Explicit",K[K.Paste=4]="Paste",K[K.Undo=5]="Undo",K[K.Redo=6]="Redo"})(CursorChangeReason||(CursorChangeReason={}));var DefaultEndOfLine;(function(K){K[K.LF=1]="LF",K[K.CRLF=2]="CRLF"})(DefaultEndOfLine||(DefaultEndOfLine={}));var DocumentHighlightKind;(function(K){K[K.Text=0]="Text",K[K.Read=1]="Read",K[K.Write=2]="Write"})(DocumentHighlightKind||(DocumentHighlightKind={}));var EditorAutoIndentStrategy;(function(K){K[K.None=0]="None",K[K.Keep=1]="Keep",K[K.Brackets=2]="Brackets",K[K.Advanced=3]="Advanced",K[K.Full=4]="Full"})(EditorAutoIndentStrategy||(EditorAutoIndentStrategy={}));var EditorOption;(function(K){K[K.acceptSuggestionOnCommitCharacter=0]="acceptSuggestionOnCommitCharacter",K[K.acceptSuggestionOnEnter=1]="acceptSuggestionOnEnter",K[K.accessibilitySupport=2]="accessibilitySupport",K[K.accessibilityPageSize=3]="accessibilityPageSize",K[K.ariaLabel=4]="ariaLabel",K[K.ariaRequired=5]="ariaRequired",K[K.autoClosingBrackets=6]="autoClosingBrackets",K[K.autoClosingComments=7]="autoClosingComments",K[K.screenReaderAnnounceInlineSuggestion=8]="screenReaderAnnounceInlineSuggestion",K[K.autoClosingDelete=9]="autoClosingDelete",K[K.autoClosingOvertype=10]="autoClosingOvertype",K[K.autoClosingQuotes=11]="autoClosingQuotes",K[K.autoIndent=12]="autoIndent",K[K.automaticLayout=13]="automaticLayout",K[K.autoSurround=14]="autoSurround",K[K.bracketPairColorization=15]="bracketPairColorization",K[K.guides=16]="guides",K[K.codeLens=17]="codeLens",K[K.codeLensFontFamily=18]="codeLensFontFamily",K[K.codeLensFontSize=19]="codeLensFontSize",K[K.colorDecorators=20]="colorDecorators",K[K.colorDecoratorsLimit=21]="colorDecoratorsLimit",K[K.columnSelection=22]="columnSelection",K[K.comments=23]="comments",K[K.contextmenu=24]="contextmenu",K[K.copyWithSyntaxHighlighting=25]="copyWithSyntaxHighlighting",K[K.cursorBlinking=26]="cursorBlinking",K[K.cursorSmoothCaretAnimation=27]="cursorSmoothCaretAnimation",K[K.cursorStyle=28]="cursorStyle",K[K.cursorSurroundingLines=29]="cursorSurroundingLines",K[K.cursorSurroundingLinesStyle=30]="cursorSurroundingLinesStyle",K[K.cursorWidth=31]="cursorWidth",K[K.disableLayerHinting=32]="disableLayerHinting",K[K.disableMonospaceOptimizations=33]="disableMonospaceOptimizations",K[K.domReadOnly=34]="domReadOnly",K[K.dragAndDrop=35]="dragAndDrop",K[K.dropIntoEditor=36]="dropIntoEditor",K[K.emptySelectionClipboard=37]="emptySelectionClipboard",K[K.experimentalWhitespaceRendering=38]="experimentalWhitespaceRendering",K[K.extraEditorClassName=39]="extraEditorClassName",K[K.fastScrollSensitivity=40]="fastScrollSensitivity",K[K.find=41]="find",K[K.fixedOverflowWidgets=42]="fixedOverflowWidgets",K[K.folding=43]="folding",K[K.foldingStrategy=44]="foldingStrategy",K[K.foldingHighlight=45]="foldingHighlight",K[K.foldingImportsByDefault=46]="foldingImportsByDefault",K[K.foldingMaximumRegions=47]="foldingMaximumRegions",K[K.unfoldOnClickAfterEndOfLine=48]="unfoldOnClickAfterEndOfLine",K[K.fontFamily=49]="fontFamily",K[K.fontInfo=50]="fontInfo",K[K.fontLigatures=51]="fontLigatures",K[K.fontSize=52]="fontSize",K[K.fontWeight=53]="fontWeight",K[K.fontVariations=54]="fontVariations",K[K.formatOnPaste=55]="formatOnPaste",K[K.formatOnType=56]="formatOnType",K[K.glyphMargin=57]="glyphMargin",K[K.gotoLocation=58]="gotoLocation",K[K.hideCursorInOverviewRuler=59]="hideCursorInOverviewRuler",K[K.hover=60]="hover",K[K.inDiffEditor=61]="inDiffEditor",K[K.inlineSuggest=62]="inlineSuggest",K[K.letterSpacing=63]="letterSpacing",K[K.lightbulb=64]="lightbulb",K[K.lineDecorationsWidth=65]="lineDecorationsWidth",K[K.lineHeight=66]="lineHeight",K[K.lineNumbers=67]="lineNumbers",K[K.lineNumbersMinChars=68]="lineNumbersMinChars",K[K.linkedEditing=69]="linkedEditing",K[K.links=70]="links",K[K.matchBrackets=71]="matchBrackets",K[K.minimap=72]="minimap",K[K.mouseStyle=73]="mouseStyle",K[K.mouseWheelScrollSensitivity=74]="mouseWheelScrollSensitivity",K[K.mouseWheelZoom=75]="mouseWheelZoom",K[K.multiCursorMergeOverlapping=76]="multiCursorMergeOverlapping",K[K.multiCursorModifier=77]="multiCursorModifier",K[K.multiCursorPaste=78]="multiCursorPaste",K[K.multiCursorLimit=79]="multiCursorLimit",K[K.occurrencesHighlight=80]="occurrencesHighlight",K[K.overviewRulerBorder=81]="overviewRulerBorder",K[K.overviewRulerLanes=82]="overviewRulerLanes",K[K.padding=83]="padding",K[K.pasteAs=84]="pasteAs",K[K.parameterHints=85]="parameterHints",K[K.peekWidgetDefaultFocus=86]="peekWidgetDefaultFocus",K[K.definitionLinkOpensInPeek=87]="definitionLinkOpensInPeek",K[K.quickSuggestions=88]="quickSuggestions",K[K.quickSuggestionsDelay=89]="quickSuggestionsDelay",K[K.readOnly=90]="readOnly",K[K.readOnlyMessage=91]="readOnlyMessage",K[K.renameOnType=92]="renameOnType",K[K.renderControlCharacters=93]="renderControlCharacters",K[K.renderFinalNewline=94]="renderFinalNewline",K[K.renderLineHighlight=95]="renderLineHighlight",K[K.renderLineHighlightOnlyWhenFocus=96]="renderLineHighlightOnlyWhenFocus",K[K.renderValidationDecorations=97]="renderValidationDecorations",K[K.renderWhitespace=98]="renderWhitespace",K[K.revealHorizontalRightPadding=99]="revealHorizontalRightPadding",K[K.roundedSelection=100]="roundedSelection",K[K.rulers=101]="rulers",K[K.scrollbar=102]="scrollbar",K[K.scrollBeyondLastColumn=103]="scrollBeyondLastColumn",K[K.scrollBeyondLastLine=104]="scrollBeyondLastLine",K[K.scrollPredominantAxis=105]="scrollPredominantAxis",K[K.selectionClipboard=106]="selectionClipboard",K[K.selectionHighlight=107]="selectionHighlight",K[K.selectOnLineNumbers=108]="selectOnLineNumbers",K[K.showFoldingControls=109]="showFoldingControls",K[K.showUnused=110]="showUnused",K[K.snippetSuggestions=111]="snippetSuggestions",K[K.smartSelect=112]="smartSelect",K[K.smoothScrolling=113]="smoothScrolling",K[K.stickyScroll=114]="stickyScroll",K[K.stickyTabStops=115]="stickyTabStops",K[K.stopRenderingLineAfter=116]="stopRenderingLineAfter",K[K.suggest=117]="suggest",K[K.suggestFontSize=118]="suggestFontSize",K[K.suggestLineHeight=119]="suggestLineHeight",K[K.suggestOnTriggerCharacters=120]="suggestOnTriggerCharacters",K[K.suggestSelection=121]="suggestSelection",K[K.tabCompletion=122]="tabCompletion",K[K.tabIndex=123]="tabIndex",K[K.unicodeHighlighting=124]="unicodeHighlighting",K[K.unusualLineTerminators=125]="unusualLineTerminators",K[K.useShadowDOM=126]="useShadowDOM",K[K.useTabStops=127]="useTabStops",K[K.wordBreak=128]="wordBreak",K[K.wordSeparators=129]="wordSeparators",K[K.wordWrap=130]="wordWrap",K[K.wordWrapBreakAfterCharacters=131]="wordWrapBreakAfterCharacters",K[K.wordWrapBreakBeforeCharacters=132]="wordWrapBreakBeforeCharacters",K[K.wordWrapColumn=133]="wordWrapColumn",K[K.wordWrapOverride1=134]="wordWrapOverride1",K[K.wordWrapOverride2=135]="wordWrapOverride2",K[K.wrappingIndent=136]="wrappingIndent",K[K.wrappingStrategy=137]="wrappingStrategy",K[K.showDeprecated=138]="showDeprecated",K[K.inlayHints=139]="inlayHints",K[K.editorClassName=140]="editorClassName",K[K.pixelRatio=141]="pixelRatio",K[K.tabFocusMode=142]="tabFocusMode",K[K.layoutInfo=143]="layoutInfo",K[K.wrappingInfo=144]="wrappingInfo",K[K.defaultColorDecorators=145]="defaultColorDecorators",K[K.colorDecoratorsActivatedOn=146]="colorDecoratorsActivatedOn",K[K.inlineCompletionsAccessibilityVerbose=147]="inlineCompletionsAccessibilityVerbose"})(EditorOption||(EditorOption={}));var EndOfLinePreference;(function(K){K[K.TextDefined=0]="TextDefined",K[K.LF=1]="LF",K[K.CRLF=2]="CRLF"})(EndOfLinePreference||(EndOfLinePreference={}));var EndOfLineSequence;(function(K){K[K.LF=0]="LF",K[K.CRLF=1]="CRLF"})(EndOfLineSequence||(EndOfLineSequence={}));var GlyphMarginLane$1;(function(K){K[K.Left=1]="Left",K[K.Right=2]="Right"})(GlyphMarginLane$1||(GlyphMarginLane$1={}));var IndentAction$1;(function(K){K[K.None=0]="None",K[K.Indent=1]="Indent",K[K.IndentOutdent=2]="IndentOutdent",K[K.Outdent=3]="Outdent"})(IndentAction$1||(IndentAction$1={}));var InjectedTextCursorStops$1;(function(K){K[K.Both=0]="Both",K[K.Right=1]="Right",K[K.Left=2]="Left",K[K.None=3]="None"})(InjectedTextCursorStops$1||(InjectedTextCursorStops$1={}));var InlayHintKind;(function(K){K[K.Type=1]="Type",K[K.Parameter=2]="Parameter"})(InlayHintKind||(InlayHintKind={}));var InlineCompletionTriggerKind;(function(K){K[K.Automatic=0]="Automatic",K[K.Explicit=1]="Explicit"})(InlineCompletionTriggerKind||(InlineCompletionTriggerKind={}));var KeyCode$1;(function(K){K[K.DependsOnKbLayout=-1]="DependsOnKbLayout",K[K.Unknown=0]="Unknown",K[K.Backspace=1]="Backspace",K[K.Tab=2]="Tab",K[K.Enter=3]="Enter",K[K.Shift=4]="Shift",K[K.Ctrl=5]="Ctrl",K[K.Alt=6]="Alt",K[K.PauseBreak=7]="PauseBreak",K[K.CapsLock=8]="CapsLock",K[K.Escape=9]="Escape",K[K.Space=10]="Space",K[K.PageUp=11]="PageUp",K[K.PageDown=12]="PageDown",K[K.End=13]="End",K[K.Home=14]="Home",K[K.LeftArrow=15]="LeftArrow",K[K.UpArrow=16]="UpArrow",K[K.RightArrow=17]="RightArrow",K[K.DownArrow=18]="DownArrow",K[K.Insert=19]="Insert",K[K.Delete=20]="Delete",K[K.Digit0=21]="Digit0",K[K.Digit1=22]="Digit1",K[K.Digit2=23]="Digit2",K[K.Digit3=24]="Digit3",K[K.Digit4=25]="Digit4",K[K.Digit5=26]="Digit5",K[K.Digit6=27]="Digit6",K[K.Digit7=28]="Digit7",K[K.Digit8=29]="Digit8",K[K.Digit9=30]="Digit9",K[K.KeyA=31]="KeyA",K[K.KeyB=32]="KeyB",K[K.KeyC=33]="KeyC",K[K.KeyD=34]="KeyD",K[K.KeyE=35]="KeyE",K[K.KeyF=36]="KeyF",K[K.KeyG=37]="KeyG",K[K.KeyH=38]="KeyH",K[K.KeyI=39]="KeyI",K[K.KeyJ=40]="KeyJ",K[K.KeyK=41]="KeyK",K[K.KeyL=42]="KeyL",K[K.KeyM=43]="KeyM",K[K.KeyN=44]="KeyN",K[K.KeyO=45]="KeyO",K[K.KeyP=46]="KeyP",K[K.KeyQ=47]="KeyQ",K[K.KeyR=48]="KeyR",K[K.KeyS=49]="KeyS",K[K.KeyT=50]="KeyT",K[K.KeyU=51]="KeyU",K[K.KeyV=52]="KeyV",K[K.KeyW=53]="KeyW",K[K.KeyX=54]="KeyX",K[K.KeyY=55]="KeyY",K[K.KeyZ=56]="KeyZ",K[K.Meta=57]="Meta",K[K.ContextMenu=58]="ContextMenu",K[K.F1=59]="F1",K[K.F2=60]="F2",K[K.F3=61]="F3",K[K.F4=62]="F4",K[K.F5=63]="F5",K[K.F6=64]="F6",K[K.F7=65]="F7",K[K.F8=66]="F8",K[K.F9=67]="F9",K[K.F10=68]="F10",K[K.F11=69]="F11",K[K.F12=70]="F12",K[K.F13=71]="F13",K[K.F14=72]="F14",K[K.F15=73]="F15",K[K.F16=74]="F16",K[K.F17=75]="F17",K[K.F18=76]="F18",K[K.F19=77]="F19",K[K.F20=78]="F20",K[K.F21=79]="F21",K[K.F22=80]="F22",K[K.F23=81]="F23",K[K.F24=82]="F24",K[K.NumLock=83]="NumLock",K[K.ScrollLock=84]="ScrollLock",K[K.Semicolon=85]="Semicolon",K[K.Equal=86]="Equal",K[K.Comma=87]="Comma",K[K.Minus=88]="Minus",K[K.Period=89]="Period",K[K.Slash=90]="Slash",K[K.Backquote=91]="Backquote",K[K.BracketLeft=92]="BracketLeft",K[K.Backslash=93]="Backslash",K[K.BracketRight=94]="BracketRight",K[K.Quote=95]="Quote",K[K.OEM_8=96]="OEM_8",K[K.IntlBackslash=97]="IntlBackslash",K[K.Numpad0=98]="Numpad0",K[K.Numpad1=99]="Numpad1",K[K.Numpad2=100]="Numpad2",K[K.Numpad3=101]="Numpad3",K[K.Numpad4=102]="Numpad4",K[K.Numpad5=103]="Numpad5",K[K.Numpad6=104]="Numpad6",K[K.Numpad7=105]="Numpad7",K[K.Numpad8=106]="Numpad8",K[K.Numpad9=107]="Numpad9",K[K.NumpadMultiply=108]="NumpadMultiply",K[K.NumpadAdd=109]="NumpadAdd",K[K.NUMPAD_SEPARATOR=110]="NUMPAD_SEPARATOR",K[K.NumpadSubtract=111]="NumpadSubtract",K[K.NumpadDecimal=112]="NumpadDecimal",K[K.NumpadDivide=113]="NumpadDivide",K[K.KEY_IN_COMPOSITION=114]="KEY_IN_COMPOSITION",K[K.ABNT_C1=115]="ABNT_C1",K[K.ABNT_C2=116]="ABNT_C2",K[K.AudioVolumeMute=117]="AudioVolumeMute",K[K.AudioVolumeUp=118]="AudioVolumeUp",K[K.AudioVolumeDown=119]="AudioVolumeDown",K[K.BrowserSearch=120]="BrowserSearch",K[K.BrowserHome=121]="BrowserHome",K[K.BrowserBack=122]="BrowserBack",K[K.BrowserForward=123]="BrowserForward",K[K.MediaTrackNext=124]="MediaTrackNext",K[K.MediaTrackPrevious=125]="MediaTrackPrevious",K[K.MediaStop=126]="MediaStop",K[K.MediaPlayPause=127]="MediaPlayPause",K[K.LaunchMediaPlayer=128]="LaunchMediaPlayer",K[K.LaunchMail=129]="LaunchMail",K[K.LaunchApp2=130]="LaunchApp2",K[K.Clear=131]="Clear",K[K.MAX_VALUE=132]="MAX_VALUE"})(KeyCode$1||(KeyCode$1={}));var MarkerSeverity$2;(function(K){K[K.Hint=1]="Hint",K[K.Info=2]="Info",K[K.Warning=4]="Warning",K[K.Error=8]="Error"})(MarkerSeverity$2||(MarkerSeverity$2={}));var MarkerTag$1;(function(K){K[K.Unnecessary=1]="Unnecessary",K[K.Deprecated=2]="Deprecated"})(MarkerTag$1||(MarkerTag$1={}));var MinimapPosition$1;(function(K){K[K.Inline=1]="Inline",K[K.Gutter=2]="Gutter"})(MinimapPosition$1||(MinimapPosition$1={}));var MouseTargetType;(function(K){K[K.UNKNOWN=0]="UNKNOWN",K[K.TEXTAREA=1]="TEXTAREA",K[K.GUTTER_GLYPH_MARGIN=2]="GUTTER_GLYPH_MARGIN",K[K.GUTTER_LINE_NUMBERS=3]="GUTTER_LINE_NUMBERS",K[K.GUTTER_LINE_DECORATIONS=4]="GUTTER_LINE_DECORATIONS",K[K.GUTTER_VIEW_ZONE=5]="GUTTER_VIEW_ZONE",K[K.CONTENT_TEXT=6]="CONTENT_TEXT",K[K.CONTENT_EMPTY=7]="CONTENT_EMPTY",K[K.CONTENT_VIEW_ZONE=8]="CONTENT_VIEW_ZONE",K[K.CONTENT_WIDGET=9]="CONTENT_WIDGET",K[K.OVERVIEW_RULER=10]="OVERVIEW_RULER",K[K.SCROLLBAR=11]="SCROLLBAR",K[K.OVERLAY_WIDGET=12]="OVERLAY_WIDGET",K[K.OUTSIDE_EDITOR=13]="OUTSIDE_EDITOR"})(MouseTargetType||(MouseTargetType={}));var OverlayWidgetPositionPreference;(function(K){K[K.TOP_RIGHT_CORNER=0]="TOP_RIGHT_CORNER",K[K.BOTTOM_RIGHT_CORNER=1]="BOTTOM_RIGHT_CORNER",K[K.TOP_CENTER=2]="TOP_CENTER"})(OverlayWidgetPositionPreference||(OverlayWidgetPositionPreference={}));var OverviewRulerLane$1;(function(K){K[K.Left=1]="Left",K[K.Center=2]="Center",K[K.Right=4]="Right",K[K.Full=7]="Full"})(OverviewRulerLane$1||(OverviewRulerLane$1={}));var PositionAffinity;(function(K){K[K.Left=0]="Left",K[K.Right=1]="Right",K[K.None=2]="None",K[K.LeftOfInjectedText=3]="LeftOfInjectedText",K[K.RightOfInjectedText=4]="RightOfInjectedText"})(PositionAffinity||(PositionAffinity={}));var RenderLineNumbersType;(function(K){K[K.Off=0]="Off",K[K.On=1]="On",K[K.Relative=2]="Relative",K[K.Interval=3]="Interval",K[K.Custom=4]="Custom"})(RenderLineNumbersType||(RenderLineNumbersType={}));var RenderMinimap;(function(K){K[K.None=0]="None",K[K.Text=1]="Text",K[K.Blocks=2]="Blocks"})(RenderMinimap||(RenderMinimap={}));var ScrollType;(function(K){K[K.Smooth=0]="Smooth",K[K.Immediate=1]="Immediate"})(ScrollType||(ScrollType={}));var ScrollbarVisibility;(function(K){K[K.Auto=1]="Auto",K[K.Hidden=2]="Hidden",K[K.Visible=3]="Visible"})(ScrollbarVisibility||(ScrollbarVisibility={}));var SelectionDirection$1;(function(K){K[K.LTR=0]="LTR",K[K.RTL=1]="RTL"})(SelectionDirection$1||(SelectionDirection$1={}));var SignatureHelpTriggerKind;(function(K){K[K.Invoke=1]="Invoke",K[K.TriggerCharacter=2]="TriggerCharacter",K[K.ContentChange=3]="ContentChange"})(SignatureHelpTriggerKind||(SignatureHelpTriggerKind={}));var SymbolKind;(function(K){K[K.File=0]="File",K[K.Module=1]="Module",K[K.Namespace=2]="Namespace",K[K.Package=3]="Package",K[K.Class=4]="Class",K[K.Method=5]="Method",K[K.Property=6]="Property",K[K.Field=7]="Field",K[K.Constructor=8]="Constructor",K[K.Enum=9]="Enum",K[K.Interface=10]="Interface",K[K.Function=11]="Function",K[K.Variable=12]="Variable",K[K.Constant=13]="Constant",K[K.String=14]="String",K[K.Number=15]="Number",K[K.Boolean=16]="Boolean",K[K.Array=17]="Array",K[K.Object=18]="Object",K[K.Key=19]="Key",K[K.Null=20]="Null",K[K.EnumMember=21]="EnumMember",K[K.Struct=22]="Struct",K[K.Event=23]="Event",K[K.Operator=24]="Operator",K[K.TypeParameter=25]="TypeParameter"})(SymbolKind||(SymbolKind={}));var SymbolTag;(function(K){K[K.Deprecated=1]="Deprecated"})(SymbolTag||(SymbolTag={}));var TextEditorCursorBlinkingStyle;(function(K){K[K.Hidden=0]="Hidden",K[K.Blink=1]="Blink",K[K.Smooth=2]="Smooth",K[K.Phase=3]="Phase",K[K.Expand=4]="Expand",K[K.Solid=5]="Solid"})(TextEditorCursorBlinkingStyle||(TextEditorCursorBlinkingStyle={}));var TextEditorCursorStyle;(function(K){K[K.Line=1]="Line",K[K.Block=2]="Block",K[K.Underline=3]="Underline",K[K.LineThin=4]="LineThin",K[K.BlockOutline=5]="BlockOutline",K[K.UnderlineThin=6]="UnderlineThin"})(TextEditorCursorStyle||(TextEditorCursorStyle={}));var TrackedRangeStickiness;(function(K){K[K.AlwaysGrowsWhenTypingAtEdges=0]="AlwaysGrowsWhenTypingAtEdges",K[K.NeverGrowsWhenTypingAtEdges=1]="NeverGrowsWhenTypingAtEdges",K[K.GrowsOnlyWhenTypingBefore=2]="GrowsOnlyWhenTypingBefore",K[K.GrowsOnlyWhenTypingAfter=3]="GrowsOnlyWhenTypingAfter"})(TrackedRangeStickiness||(TrackedRangeStickiness={}));var WrappingIndent;(function(K){K[K.None=0]="None",K[K.Same=1]="Same",K[K.Indent=2]="Indent",K[K.DeepIndent=3]="DeepIndent"})(WrappingIndent||(WrappingIndent={}));let KeyMod$1=class{static chord(C,W){return KeyChord(C,W)}};KeyMod$1.CtrlCmd=2048;KeyMod$1.Shift=1024;KeyMod$1.Alt=512;KeyMod$1.WinCtrl=256;function createMonacoBaseAPI(){return{editor:void 0,languages:void 0,CancellationTokenSource:CancellationTokenSource$1,Emitter:Emitter$1,KeyCode:KeyCode$1,KeyMod:KeyMod$1,Position:Position$1,Range:Range$2,Selection:Selection$1,SelectionDirection:SelectionDirection$1,MarkerSeverity:MarkerSeverity$2,MarkerTag:MarkerTag$1,Uri:URI,Token:Token$2}}class LRUCachedFunction{constructor(C){this.fn=C,this.lastCache=void 0,this.lastArgKey=void 0}get(C){const W=JSON.stringify(C);return this.lastArgKey!==W&&(this.lastArgKey=W,this.lastCache=this.fn(C)),this.lastCache}}class CachedFunction{get cachedValues(){return this._map}constructor(C){this.fn=C,this._map=new Map}get(C){if(this._map.has(C))return this._map.get(C);const W=this.fn(C);return this._map.set(C,W),W}}class Lazy{constructor(C){this.executor=C,this._didRun=!1}get value(){if(!this._didRun)try{this._value=this.executor()}catch(C){this._error=C}finally{this._didRun=!0}if(this._error)throw this._error;return this._value}get rawValue(){return this._value}}var _a$3;function isFalsyOrWhitespace(K){return!K||typeof K!="string"?!0:K.trim().length===0}const _formatRegexp=/{(\d+)}/g;function format(K,...C){return C.length===0?K:K.replace(_formatRegexp,function(W,V){const U=parseInt(V,10);return isNaN(U)||U<0||U>=C.length?W:C[U]})}function escape(K){return K.replace(/[<>&]/g,function(C){switch(C){case"<":return"&lt;";case">":return"&gt;";case"&":return"&amp;";default:return C}})}function escapeRegExpCharacters(K){return K.replace(/[\\\{\}\*\+\?\|\^\$\.\[\]\(\)]/g,"\\$&")}function trim$2(K,C=" "){const W=ltrim(K,C);return rtrim(W,C)}function ltrim(K,C){if(!K||!C)return K;const W=C.length;if(W===0||K.length===0)return K;let V=0;for(;K.indexOf(C,V)===V;)V=V+W;return K.substring(V)}function rtrim(K,C){if(!K||!C)return K;const W=C.length,V=K.length;if(W===0||V===0)return K;let U=V,G=-1;for(;G=K.lastIndexOf(C,U-1),!(G===-1||G+W!==U);){if(G===0)return"";U=G}return K.substring(0,U)}function convertSimple2RegExpPattern(K){return K.replace(/[\-\\\{\}\+\?\|\^\$\.\,\[\]\(\)\#\s]/g,"\\$&").replace(/[\*]/g,".*")}function stripWildcards(K){return K.replace(/\*/g,"")}function createRegExp(K,C,W={}){if(!K)throw new Error("Cannot create regex from empty string");C||(K=escapeRegExpCharacters(K)),W.wholeWord&&(/\B/.test(K.charAt(0))||(K="\\b"+K),/\B/.test(K.charAt(K.length-1))||(K=K+"\\b"));let V="";return W.global&&(V+="g"),W.matchCase||(V+="i"),W.multiline&&(V+="m"),W.unicode&&(V+="u"),new RegExp(K,V)}function regExpLeadsToEndlessLoop(K){return K.source==="^"||K.source==="^$"||K.source==="$"||K.source==="^\\s*$"?!1:!!(K.exec("")&&K.lastIndex===0)}function splitLines(K){return K.split(/\r\n|\r|\n/)}function firstNonWhitespaceIndex(K){for(let C=0,W=K.length;C<W;C++){const V=K.charCodeAt(C);if(V!==32&&V!==9)return C}return-1}function getLeadingWhitespace(K,C=0,W=K.length){for(let V=C;V<W;V++){const U=K.charCodeAt(V);if(U!==32&&U!==9)return K.substring(C,V)}return K.substring(C,W)}function lastNonWhitespaceIndex(K,C=K.length-1){for(let W=C;W>=0;W--){const V=K.charCodeAt(W);if(V!==32&&V!==9)return W}return-1}function compare$1(K,C){return K<C?-1:K>C?1:0}function compareSubstring(K,C,W=0,V=K.length,U=0,G=C.length){for(;W<V&&U<G;W++,U++){const Q=K.charCodeAt(W),J=C.charCodeAt(U);if(Q<J)return-1;if(Q>J)return 1}const Z=V-W,X=G-U;return Z<X?-1:Z>X?1:0}function compareIgnoreCase(K,C){return compareSubstringIgnoreCase(K,C,0,K.length,0,C.length)}function compareSubstringIgnoreCase(K,C,W=0,V=K.length,U=0,G=C.length){for(;W<V&&U<G;W++,U++){let Q=K.charCodeAt(W),J=C.charCodeAt(U);if(Q===J)continue;if(Q>=128||J>=128)return compareSubstring(K.toLowerCase(),C.toLowerCase(),W,V,U,G);isLowerAsciiLetter(Q)&&(Q-=32),isLowerAsciiLetter(J)&&(J-=32);const ee=Q-J;if(ee!==0)return ee}const Z=V-W,X=G-U;return Z<X?-1:Z>X?1:0}function isAsciiDigit(K){return K>=48&&K<=57}function isLowerAsciiLetter(K){return K>=97&&K<=122}function isUpperAsciiLetter(K){return K>=65&&K<=90}function equalsIgnoreCase(K,C){return K.length===C.length&&compareSubstringIgnoreCase(K,C)===0}function startsWithIgnoreCase(K,C){const W=C.length;return C.length>K.length?!1:compareSubstringIgnoreCase(K,C,0,W)===0}function commonPrefixLength(K,C){const W=Math.min(K.length,C.length);let V;for(V=0;V<W;V++)if(K.charCodeAt(V)!==C.charCodeAt(V))return V;return W}function commonSuffixLength(K,C){const W=Math.min(K.length,C.length);let V;const U=K.length-1,G=C.length-1;for(V=0;V<W;V++)if(K.charCodeAt(U-V)!==C.charCodeAt(G-V))return V;return W}function isHighSurrogate(K){return 55296<=K&&K<=56319}function isLowSurrogate(K){return 56320<=K&&K<=57343}function computeCodePoint(K,C){return(K-55296<<10)+(C-56320)+65536}function getNextCodePoint(K,C,W){const V=K.charCodeAt(W);if(isHighSurrogate(V)&&W+1<C){const U=K.charCodeAt(W+1);if(isLowSurrogate(U))return computeCodePoint(V,U)}return V}function getPrevCodePoint(K,C){const W=K.charCodeAt(C-1);if(isLowSurrogate(W)&&C>1){const V=K.charCodeAt(C-2);if(isHighSurrogate(V))return computeCodePoint(V,W)}return W}class CodePointIterator{get offset(){return this._offset}constructor(C,W=0){this._str=C,this._len=C.length,this._offset=W}setOffset(C){this._offset=C}prevCodePoint(){const C=getPrevCodePoint(this._str,this._offset);return this._offset-=C>=65536?2:1,C}nextCodePoint(){const C=getNextCodePoint(this._str,this._len,this._offset);return this._offset+=C>=65536?2:1,C}eol(){return this._offset>=this._len}}class GraphemeIterator{get offset(){return this._iterator.offset}constructor(C,W=0){this._iterator=new CodePointIterator(C,W)}nextGraphemeLength(){const C=GraphemeBreakTree.getInstance(),W=this._iterator,V=W.offset;let U=C.getGraphemeBreakType(W.nextCodePoint());for(;!W.eol();){const G=W.offset,Z=C.getGraphemeBreakType(W.nextCodePoint());if(breakBetweenGraphemeBreakType(U,Z)){W.setOffset(G);break}U=Z}return W.offset-V}prevGraphemeLength(){const C=GraphemeBreakTree.getInstance(),W=this._iterator,V=W.offset;let U=C.getGraphemeBreakType(W.prevCodePoint());for(;W.offset>0;){const G=W.offset,Z=C.getGraphemeBreakType(W.prevCodePoint());if(breakBetweenGraphemeBreakType(Z,U)){W.setOffset(G);break}U=Z}return V-W.offset}eol(){return this._iterator.eol()}}function nextCharLength(K,C){return new GraphemeIterator(K,C).nextGraphemeLength()}function prevCharLength(K,C){return new GraphemeIterator(K,C).prevGraphemeLength()}function getCharContainingOffset(K,C){C>0&&isLowSurrogate(K.charCodeAt(C))&&C--;const W=C+nextCharLength(K,C);return[W-prevCharLength(K,W),W]}let CONTAINS_RTL;function makeContainsRtl(){return/(?:[\u05BE\u05C0\u05C3\u05C6\u05D0-\u05F4\u0608\u060B\u060D\u061B-\u064A\u066D-\u066F\u0671-\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u0710\u0712-\u072F\u074D-\u07A5\u07B1-\u07EA\u07F4\u07F5\u07FA\u07FE-\u0815\u081A\u0824\u0828\u0830-\u0858\u085E-\u088E\u08A0-\u08C9\u200F\uFB1D\uFB1F-\uFB28\uFB2A-\uFD3D\uFD50-\uFDC7\uFDF0-\uFDFC\uFE70-\uFEFC]|\uD802[\uDC00-\uDD1B\uDD20-\uDE00\uDE10-\uDE35\uDE40-\uDEE4\uDEEB-\uDF35\uDF40-\uDFFF]|\uD803[\uDC00-\uDD23\uDE80-\uDEA9\uDEAD-\uDF45\uDF51-\uDF81\uDF86-\uDFF6]|\uD83A[\uDC00-\uDCCF\uDD00-\uDD43\uDD4B-\uDFFF]|\uD83B[\uDC00-\uDEBB])/}function containsRTL(K){return CONTAINS_RTL||(CONTAINS_RTL=makeContainsRtl()),CONTAINS_RTL.test(K)}const IS_BASIC_ASCII=/^[\t\n\r\x20-\x7E]*$/;function isBasicASCII(K){return IS_BASIC_ASCII.test(K)}const UNUSUAL_LINE_TERMINATORS=/[\u2028\u2029]/;function containsUnusualLineTerminators(K){return UNUSUAL_LINE_TERMINATORS.test(K)}function isFullWidthCharacter(K){return K>=11904&&K<=55215||K>=63744&&K<=64255||K>=65281&&K<=65374}function isEmojiImprecise(K){return K>=127462&&K<=127487||K===8986||K===8987||K===9200||K===9203||K>=9728&&K<=10175||K===11088||K===11093||K>=127744&&K<=128591||K>=128640&&K<=128764||K>=128992&&K<=129008||K>=129280&&K<=129535||K>=129648&&K<=129782}const UTF8_BOM_CHARACTER=String.fromCharCode(65279);function startsWithUTF8BOM(K){return!!(K&&K.length>0&&K.charCodeAt(0)===65279)}function containsUppercaseCharacter(K,C=!1){return K?(C&&(K=K.replace(/\\./g,"")),K.toLowerCase()!==K):!1}function singleLetterHash(K){return K=K%(2*26),K<26?String.fromCharCode(97+K):String.fromCharCode(65+K-26)}function breakBetweenGraphemeBreakType(K,C){return K===0?C!==5&&C!==7:K===2&&C===3?!1:K===4||K===2||K===3||C===4||C===2||C===3?!0:!(K===8&&(C===8||C===9||C===11||C===12)||(K===11||K===9)&&(C===9||C===10)||(K===12||K===10)&&C===10||C===5||C===13||C===7||K===1||K===13&&C===14||K===6&&C===6)}class GraphemeBreakTree{static getInstance(){return GraphemeBreakTree._INSTANCE||(GraphemeBreakTree._INSTANCE=new GraphemeBreakTree),GraphemeBreakTree._INSTANCE}constructor(){this._data=getGraphemeBreakRawData()}getGraphemeBreakType(C){if(C<32)return C===10?3:C===13?2:4;if(C<127)return 0;const W=this._data,V=W.length/3;let U=1;for(;U<=V;)if(C<W[3*U])U=2*U;else if(C>W[3*U+1])U=2*U+1;else return W[3*U+2];return 0}}GraphemeBreakTree._INSTANCE=null;function getGraphemeBreakRawData(){return JSON.parse("[0,0,0,51229,51255,12,44061,44087,12,127462,127487,6,7083,7085,5,47645,47671,12,54813,54839,12,128678,128678,14,3270,3270,5,9919,9923,14,45853,45879,12,49437,49463,12,53021,53047,12,71216,71218,7,128398,128399,14,129360,129374,14,2519,2519,5,4448,4519,9,9742,9742,14,12336,12336,14,44957,44983,12,46749,46775,12,48541,48567,12,50333,50359,12,52125,52151,12,53917,53943,12,69888,69890,5,73018,73018,5,127990,127990,14,128558,128559,14,128759,128760,14,129653,129655,14,2027,2035,5,2891,2892,7,3761,3761,5,6683,6683,5,8293,8293,4,9825,9826,14,9999,9999,14,43452,43453,5,44509,44535,12,45405,45431,12,46301,46327,12,47197,47223,12,48093,48119,12,48989,49015,12,49885,49911,12,50781,50807,12,51677,51703,12,52573,52599,12,53469,53495,12,54365,54391,12,65279,65279,4,70471,70472,7,72145,72147,7,119173,119179,5,127799,127818,14,128240,128244,14,128512,128512,14,128652,128652,14,128721,128722,14,129292,129292,14,129445,129450,14,129734,129743,14,1476,1477,5,2366,2368,7,2750,2752,7,3076,3076,5,3415,3415,5,4141,4144,5,6109,6109,5,6964,6964,5,7394,7400,5,9197,9198,14,9770,9770,14,9877,9877,14,9968,9969,14,10084,10084,14,43052,43052,5,43713,43713,5,44285,44311,12,44733,44759,12,45181,45207,12,45629,45655,12,46077,46103,12,46525,46551,12,46973,46999,12,47421,47447,12,47869,47895,12,48317,48343,12,48765,48791,12,49213,49239,12,49661,49687,12,50109,50135,12,50557,50583,12,51005,51031,12,51453,51479,12,51901,51927,12,52349,52375,12,52797,52823,12,53245,53271,12,53693,53719,12,54141,54167,12,54589,54615,12,55037,55063,12,69506,69509,5,70191,70193,5,70841,70841,7,71463,71467,5,72330,72342,5,94031,94031,5,123628,123631,5,127763,127765,14,127941,127941,14,128043,128062,14,128302,128317,14,128465,128467,14,128539,128539,14,128640,128640,14,128662,128662,14,128703,128703,14,128745,128745,14,129004,129007,14,129329,129330,14,129402,129402,14,129483,129483,14,129686,129704,14,130048,131069,14,173,173,4,1757,1757,1,2200,2207,5,2434,2435,7,2631,2632,5,2817,2817,5,3008,3008,5,3201,3201,5,3387,3388,5,3542,3542,5,3902,3903,7,4190,4192,5,6002,6003,5,6439,6440,5,6765,6770,7,7019,7027,5,7154,7155,7,8205,8205,13,8505,8505,14,9654,9654,14,9757,9757,14,9792,9792,14,9852,9853,14,9890,9894,14,9937,9937,14,9981,9981,14,10035,10036,14,11035,11036,14,42654,42655,5,43346,43347,7,43587,43587,5,44006,44007,7,44173,44199,12,44397,44423,12,44621,44647,12,44845,44871,12,45069,45095,12,45293,45319,12,45517,45543,12,45741,45767,12,45965,45991,12,46189,46215,12,46413,46439,12,46637,46663,12,46861,46887,12,47085,47111,12,47309,47335,12,47533,47559,12,47757,47783,12,47981,48007,12,48205,48231,12,48429,48455,12,48653,48679,12,48877,48903,12,49101,49127,12,49325,49351,12,49549,49575,12,49773,49799,12,49997,50023,12,50221,50247,12,50445,50471,12,50669,50695,12,50893,50919,12,51117,51143,12,51341,51367,12,51565,51591,12,51789,51815,12,52013,52039,12,52237,52263,12,52461,52487,12,52685,52711,12,52909,52935,12,53133,53159,12,53357,53383,12,53581,53607,12,53805,53831,12,54029,54055,12,54253,54279,12,54477,54503,12,54701,54727,12,54925,54951,12,55149,55175,12,68101,68102,5,69762,69762,7,70067,70069,7,70371,70378,5,70720,70721,7,71087,71087,5,71341,71341,5,71995,71996,5,72249,72249,7,72850,72871,5,73109,73109,5,118576,118598,5,121505,121519,5,127245,127247,14,127568,127569,14,127777,127777,14,127872,127891,14,127956,127967,14,128015,128016,14,128110,128172,14,128259,128259,14,128367,128368,14,128424,128424,14,128488,128488,14,128530,128532,14,128550,128551,14,128566,128566,14,128647,128647,14,128656,128656,14,128667,128673,14,128691,128693,14,128715,128715,14,128728,128732,14,128752,128752,14,128765,128767,14,129096,129103,14,129311,129311,14,129344,129349,14,129394,129394,14,129413,129425,14,129466,129471,14,129511,129535,14,129664,129666,14,129719,129722,14,129760,129767,14,917536,917631,5,13,13,2,1160,1161,5,1564,1564,4,1807,1807,1,2085,2087,5,2307,2307,7,2382,2383,7,2497,2500,5,2563,2563,7,2677,2677,5,2763,2764,7,2879,2879,5,2914,2915,5,3021,3021,5,3142,3144,5,3263,3263,5,3285,3286,5,3398,3400,7,3530,3530,5,3633,3633,5,3864,3865,5,3974,3975,5,4155,4156,7,4229,4230,5,5909,5909,7,6078,6085,7,6277,6278,5,6451,6456,7,6744,6750,5,6846,6846,5,6972,6972,5,7074,7077,5,7146,7148,7,7222,7223,5,7416,7417,5,8234,8238,4,8417,8417,5,9000,9000,14,9203,9203,14,9730,9731,14,9748,9749,14,9762,9763,14,9776,9783,14,9800,9811,14,9831,9831,14,9872,9873,14,9882,9882,14,9900,9903,14,9929,9933,14,9941,9960,14,9974,9974,14,9989,9989,14,10006,10006,14,10062,10062,14,10160,10160,14,11647,11647,5,12953,12953,14,43019,43019,5,43232,43249,5,43443,43443,5,43567,43568,7,43696,43696,5,43765,43765,7,44013,44013,5,44117,44143,12,44229,44255,12,44341,44367,12,44453,44479,12,44565,44591,12,44677,44703,12,44789,44815,12,44901,44927,12,45013,45039,12,45125,45151,12,45237,45263,12,45349,45375,12,45461,45487,12,45573,45599,12,45685,45711,12,45797,45823,12,45909,45935,12,46021,46047,12,46133,46159,12,46245,46271,12,46357,46383,12,46469,46495,12,46581,46607,12,46693,46719,12,46805,46831,12,46917,46943,12,47029,47055,12,47141,47167,12,47253,47279,12,47365,47391,12,47477,47503,12,47589,47615,12,47701,47727,12,47813,47839,12,47925,47951,12,48037,48063,12,48149,48175,12,48261,48287,12,48373,48399,12,48485,48511,12,48597,48623,12,48709,48735,12,48821,48847,12,48933,48959,12,49045,49071,12,49157,49183,12,49269,49295,12,49381,49407,12,49493,49519,12,49605,49631,12,49717,49743,12,49829,49855,12,49941,49967,12,50053,50079,12,50165,50191,12,50277,50303,12,50389,50415,12,50501,50527,12,50613,50639,12,50725,50751,12,50837,50863,12,50949,50975,12,51061,51087,12,51173,51199,12,51285,51311,12,51397,51423,12,51509,51535,12,51621,51647,12,51733,51759,12,51845,51871,12,51957,51983,12,52069,52095,12,52181,52207,12,52293,52319,12,52405,52431,12,52517,52543,12,52629,52655,12,52741,52767,12,52853,52879,12,52965,52991,12,53077,53103,12,53189,53215,12,53301,53327,12,53413,53439,12,53525,53551,12,53637,53663,12,53749,53775,12,53861,53887,12,53973,53999,12,54085,54111,12,54197,54223,12,54309,54335,12,54421,54447,12,54533,54559,12,54645,54671,12,54757,54783,12,54869,54895,12,54981,55007,12,55093,55119,12,55243,55291,10,66045,66045,5,68325,68326,5,69688,69702,5,69817,69818,5,69957,69958,7,70089,70092,5,70198,70199,5,70462,70462,5,70502,70508,5,70750,70750,5,70846,70846,7,71100,71101,5,71230,71230,7,71351,71351,5,71737,71738,5,72000,72000,7,72160,72160,5,72273,72278,5,72752,72758,5,72882,72883,5,73031,73031,5,73461,73462,7,94192,94193,7,119149,119149,7,121403,121452,5,122915,122916,5,126980,126980,14,127358,127359,14,127535,127535,14,127759,127759,14,127771,127771,14,127792,127793,14,127825,127867,14,127897,127899,14,127945,127945,14,127985,127986,14,128000,128007,14,128021,128021,14,128066,128100,14,128184,128235,14,128249,128252,14,128266,128276,14,128335,128335,14,128379,128390,14,128407,128419,14,128444,128444,14,128481,128481,14,128499,128499,14,128526,128526,14,128536,128536,14,128543,128543,14,128556,128556,14,128564,128564,14,128577,128580,14,128643,128645,14,128649,128649,14,128654,128654,14,128660,128660,14,128664,128664,14,128675,128675,14,128686,128689,14,128695,128696,14,128705,128709,14,128717,128719,14,128725,128725,14,128736,128741,14,128747,128748,14,128755,128755,14,128762,128762,14,128981,128991,14,129009,129023,14,129160,129167,14,129296,129304,14,129320,129327,14,129340,129342,14,129356,129356,14,129388,129392,14,129399,129400,14,129404,129407,14,129432,129442,14,129454,129455,14,129473,129474,14,129485,129487,14,129648,129651,14,129659,129660,14,129671,129679,14,129709,129711,14,129728,129730,14,129751,129753,14,129776,129782,14,917505,917505,4,917760,917999,5,10,10,3,127,159,4,768,879,5,1471,1471,5,1536,1541,1,1648,1648,5,1767,1768,5,1840,1866,5,2070,2073,5,2137,2139,5,2274,2274,1,2363,2363,7,2377,2380,7,2402,2403,5,2494,2494,5,2507,2508,7,2558,2558,5,2622,2624,7,2641,2641,5,2691,2691,7,2759,2760,5,2786,2787,5,2876,2876,5,2881,2884,5,2901,2902,5,3006,3006,5,3014,3016,7,3072,3072,5,3134,3136,5,3157,3158,5,3260,3260,5,3266,3266,5,3274,3275,7,3328,3329,5,3391,3392,7,3405,3405,5,3457,3457,5,3536,3537,7,3551,3551,5,3636,3642,5,3764,3772,5,3895,3895,5,3967,3967,7,3993,4028,5,4146,4151,5,4182,4183,7,4226,4226,5,4253,4253,5,4957,4959,5,5940,5940,7,6070,6070,7,6087,6088,7,6158,6158,4,6432,6434,5,6448,6449,7,6679,6680,5,6742,6742,5,6754,6754,5,6783,6783,5,6912,6915,5,6966,6970,5,6978,6978,5,7042,7042,7,7080,7081,5,7143,7143,7,7150,7150,7,7212,7219,5,7380,7392,5,7412,7412,5,8203,8203,4,8232,8232,4,8265,8265,14,8400,8412,5,8421,8432,5,8617,8618,14,9167,9167,14,9200,9200,14,9410,9410,14,9723,9726,14,9733,9733,14,9745,9745,14,9752,9752,14,9760,9760,14,9766,9766,14,9774,9774,14,9786,9786,14,9794,9794,14,9823,9823,14,9828,9828,14,9833,9850,14,9855,9855,14,9875,9875,14,9880,9880,14,9885,9887,14,9896,9897,14,9906,9916,14,9926,9927,14,9935,9935,14,9939,9939,14,9962,9962,14,9972,9972,14,9978,9978,14,9986,9986,14,9997,9997,14,10002,10002,14,10017,10017,14,10055,10055,14,10071,10071,14,10133,10135,14,10548,10549,14,11093,11093,14,12330,12333,5,12441,12442,5,42608,42610,5,43010,43010,5,43045,43046,5,43188,43203,7,43302,43309,5,43392,43394,5,43446,43449,5,43493,43493,5,43571,43572,7,43597,43597,7,43703,43704,5,43756,43757,5,44003,44004,7,44009,44010,7,44033,44059,12,44089,44115,12,44145,44171,12,44201,44227,12,44257,44283,12,44313,44339,12,44369,44395,12,44425,44451,12,44481,44507,12,44537,44563,12,44593,44619,12,44649,44675,12,44705,44731,12,44761,44787,12,44817,44843,12,44873,44899,12,44929,44955,12,44985,45011,12,45041,45067,12,45097,45123,12,45153,45179,12,45209,45235,12,45265,45291,12,45321,45347,12,45377,45403,12,45433,45459,12,45489,45515,12,45545,45571,12,45601,45627,12,45657,45683,12,45713,45739,12,45769,45795,12,45825,45851,12,45881,45907,12,45937,45963,12,45993,46019,12,46049,46075,12,46105,46131,12,46161,46187,12,46217,46243,12,46273,46299,12,46329,46355,12,46385,46411,12,46441,46467,12,46497,46523,12,46553,46579,12,46609,46635,12,46665,46691,12,46721,46747,12,46777,46803,12,46833,46859,12,46889,46915,12,46945,46971,12,47001,47027,12,47057,47083,12,47113,47139,12,47169,47195,12,47225,47251,12,47281,47307,12,47337,47363,12,47393,47419,12,47449,47475,12,47505,47531,12,47561,47587,12,47617,47643,12,47673,47699,12,47729,47755,12,47785,47811,12,47841,47867,12,47897,47923,12,47953,47979,12,48009,48035,12,48065,48091,12,48121,48147,12,48177,48203,12,48233,48259,12,48289,48315,12,48345,48371,12,48401,48427,12,48457,48483,12,48513,48539,12,48569,48595,12,48625,48651,12,48681,48707,12,48737,48763,12,48793,48819,12,48849,48875,12,48905,48931,12,48961,48987,12,49017,49043,12,49073,49099,12,49129,49155,12,49185,49211,12,49241,49267,12,49297,49323,12,49353,49379,12,49409,49435,12,49465,49491,12,49521,49547,12,49577,49603,12,49633,49659,12,49689,49715,12,49745,49771,12,49801,49827,12,49857,49883,12,49913,49939,12,49969,49995,12,50025,50051,12,50081,50107,12,50137,50163,12,50193,50219,12,50249,50275,12,50305,50331,12,50361,50387,12,50417,50443,12,50473,50499,12,50529,50555,12,50585,50611,12,50641,50667,12,50697,50723,12,50753,50779,12,50809,50835,12,50865,50891,12,50921,50947,12,50977,51003,12,51033,51059,12,51089,51115,12,51145,51171,12,51201,51227,12,51257,51283,12,51313,51339,12,51369,51395,12,51425,51451,12,51481,51507,12,51537,51563,12,51593,51619,12,51649,51675,12,51705,51731,12,51761,51787,12,51817,51843,12,51873,51899,12,51929,51955,12,51985,52011,12,52041,52067,12,52097,52123,12,52153,52179,12,52209,52235,12,52265,52291,12,52321,52347,12,52377,52403,12,52433,52459,12,52489,52515,12,52545,52571,12,52601,52627,12,52657,52683,12,52713,52739,12,52769,52795,12,52825,52851,12,52881,52907,12,52937,52963,12,52993,53019,12,53049,53075,12,53105,53131,12,53161,53187,12,53217,53243,12,53273,53299,12,53329,53355,12,53385,53411,12,53441,53467,12,53497,53523,12,53553,53579,12,53609,53635,12,53665,53691,12,53721,53747,12,53777,53803,12,53833,53859,12,53889,53915,12,53945,53971,12,54001,54027,12,54057,54083,12,54113,54139,12,54169,54195,12,54225,54251,12,54281,54307,12,54337,54363,12,54393,54419,12,54449,54475,12,54505,54531,12,54561,54587,12,54617,54643,12,54673,54699,12,54729,54755,12,54785,54811,12,54841,54867,12,54897,54923,12,54953,54979,12,55009,55035,12,55065,55091,12,55121,55147,12,55177,55203,12,65024,65039,5,65520,65528,4,66422,66426,5,68152,68154,5,69291,69292,5,69633,69633,5,69747,69748,5,69811,69814,5,69826,69826,5,69932,69932,7,70016,70017,5,70079,70080,7,70095,70095,5,70196,70196,5,70367,70367,5,70402,70403,7,70464,70464,5,70487,70487,5,70709,70711,7,70725,70725,7,70833,70834,7,70843,70844,7,70849,70849,7,71090,71093,5,71103,71104,5,71227,71228,7,71339,71339,5,71344,71349,5,71458,71461,5,71727,71735,5,71985,71989,7,71998,71998,5,72002,72002,7,72154,72155,5,72193,72202,5,72251,72254,5,72281,72283,5,72344,72345,5,72766,72766,7,72874,72880,5,72885,72886,5,73023,73029,5,73104,73105,5,73111,73111,5,92912,92916,5,94095,94098,5,113824,113827,4,119142,119142,7,119155,119162,4,119362,119364,5,121476,121476,5,122888,122904,5,123184,123190,5,125252,125258,5,127183,127183,14,127340,127343,14,127377,127386,14,127491,127503,14,127548,127551,14,127744,127756,14,127761,127761,14,127769,127769,14,127773,127774,14,127780,127788,14,127796,127797,14,127820,127823,14,127869,127869,14,127894,127895,14,127902,127903,14,127943,127943,14,127947,127950,14,127972,127972,14,127988,127988,14,127992,127994,14,128009,128011,14,128019,128019,14,128023,128041,14,128064,128064,14,128102,128107,14,128174,128181,14,128238,128238,14,128246,128247,14,128254,128254,14,128264,128264,14,128278,128299,14,128329,128330,14,128348,128359,14,128371,128377,14,128392,128393,14,128401,128404,14,128421,128421,14,128433,128434,14,128450,128452,14,128476,128478,14,128483,128483,14,128495,128495,14,128506,128506,14,128519,128520,14,128528,128528,14,128534,128534,14,128538,128538,14,128540,128542,14,128544,128549,14,128552,128555,14,128557,128557,14,128560,128563,14,128565,128565,14,128567,128576,14,128581,128591,14,128641,128642,14,128646,128646,14,128648,128648,14,128650,128651,14,128653,128653,14,128655,128655,14,128657,128659,14,128661,128661,14,128663,128663,14,128665,128666,14,128674,128674,14,128676,128677,14,128679,128685,14,128690,128690,14,128694,128694,14,128697,128702,14,128704,128704,14,128710,128714,14,128716,128716,14,128720,128720,14,128723,128724,14,128726,128727,14,128733,128735,14,128742,128744,14,128746,128746,14,128749,128751,14,128753,128754,14,128756,128758,14,128761,128761,14,128763,128764,14,128884,128895,14,128992,129003,14,129008,129008,14,129036,129039,14,129114,129119,14,129198,129279,14,129293,129295,14,129305,129310,14,129312,129319,14,129328,129328,14,129331,129338,14,129343,129343,14,129351,129355,14,129357,129359,14,129375,129387,14,129393,129393,14,129395,129398,14,129401,129401,14,129403,129403,14,129408,129412,14,129426,129431,14,129443,129444,14,129451,129453,14,129456,129465,14,129472,129472,14,129475,129482,14,129484,129484,14,129488,129510,14,129536,129647,14,129652,129652,14,129656,129658,14,129661,129663,14,129667,129670,14,129680,129685,14,129705,129708,14,129712,129718,14,129723,129727,14,129731,129733,14,129744,129750,14,129754,129759,14,129768,129775,14,129783,129791,14,917504,917504,4,917506,917535,4,917632,917759,4,918000,921599,4,0,9,4,11,12,4,14,31,4,169,169,14,174,174,14,1155,1159,5,1425,1469,5,1473,1474,5,1479,1479,5,1552,1562,5,1611,1631,5,1750,1756,5,1759,1764,5,1770,1773,5,1809,1809,5,1958,1968,5,2045,2045,5,2075,2083,5,2089,2093,5,2192,2193,1,2250,2273,5,2275,2306,5,2362,2362,5,2364,2364,5,2369,2376,5,2381,2381,5,2385,2391,5,2433,2433,5,2492,2492,5,2495,2496,7,2503,2504,7,2509,2509,5,2530,2531,5,2561,2562,5,2620,2620,5,2625,2626,5,2635,2637,5,2672,2673,5,2689,2690,5,2748,2748,5,2753,2757,5,2761,2761,7,2765,2765,5,2810,2815,5,2818,2819,7,2878,2878,5,2880,2880,7,2887,2888,7,2893,2893,5,2903,2903,5,2946,2946,5,3007,3007,7,3009,3010,7,3018,3020,7,3031,3031,5,3073,3075,7,3132,3132,5,3137,3140,7,3146,3149,5,3170,3171,5,3202,3203,7,3262,3262,7,3264,3265,7,3267,3268,7,3271,3272,7,3276,3277,5,3298,3299,5,3330,3331,7,3390,3390,5,3393,3396,5,3402,3404,7,3406,3406,1,3426,3427,5,3458,3459,7,3535,3535,5,3538,3540,5,3544,3550,7,3570,3571,7,3635,3635,7,3655,3662,5,3763,3763,7,3784,3789,5,3893,3893,5,3897,3897,5,3953,3966,5,3968,3972,5,3981,3991,5,4038,4038,5,4145,4145,7,4153,4154,5,4157,4158,5,4184,4185,5,4209,4212,5,4228,4228,7,4237,4237,5,4352,4447,8,4520,4607,10,5906,5908,5,5938,5939,5,5970,5971,5,6068,6069,5,6071,6077,5,6086,6086,5,6089,6099,5,6155,6157,5,6159,6159,5,6313,6313,5,6435,6438,7,6441,6443,7,6450,6450,5,6457,6459,5,6681,6682,7,6741,6741,7,6743,6743,7,6752,6752,5,6757,6764,5,6771,6780,5,6832,6845,5,6847,6862,5,6916,6916,7,6965,6965,5,6971,6971,7,6973,6977,7,6979,6980,7,7040,7041,5,7073,7073,7,7078,7079,7,7082,7082,7,7142,7142,5,7144,7145,5,7149,7149,5,7151,7153,5,7204,7211,7,7220,7221,7,7376,7378,5,7393,7393,7,7405,7405,5,7415,7415,7,7616,7679,5,8204,8204,5,8206,8207,4,8233,8233,4,8252,8252,14,8288,8292,4,8294,8303,4,8413,8416,5,8418,8420,5,8482,8482,14,8596,8601,14,8986,8987,14,9096,9096,14,9193,9196,14,9199,9199,14,9201,9202,14,9208,9210,14,9642,9643,14,9664,9664,14,9728,9729,14,9732,9732,14,9735,9741,14,9743,9744,14,9746,9746,14,9750,9751,14,9753,9756,14,9758,9759,14,9761,9761,14,9764,9765,14,9767,9769,14,9771,9773,14,9775,9775,14,9784,9785,14,9787,9791,14,9793,9793,14,9795,9799,14,9812,9822,14,9824,9824,14,9827,9827,14,9829,9830,14,9832,9832,14,9851,9851,14,9854,9854,14,9856,9861,14,9874,9874,14,9876,9876,14,9878,9879,14,9881,9881,14,9883,9884,14,9888,9889,14,9895,9895,14,9898,9899,14,9904,9905,14,9917,9918,14,9924,9925,14,9928,9928,14,9934,9934,14,9936,9936,14,9938,9938,14,9940,9940,14,9961,9961,14,9963,9967,14,9970,9971,14,9973,9973,14,9975,9977,14,9979,9980,14,9982,9985,14,9987,9988,14,9992,9996,14,9998,9998,14,10000,10001,14,10004,10004,14,10013,10013,14,10024,10024,14,10052,10052,14,10060,10060,14,10067,10069,14,10083,10083,14,10085,10087,14,10145,10145,14,10175,10175,14,11013,11015,14,11088,11088,14,11503,11505,5,11744,11775,5,12334,12335,5,12349,12349,14,12951,12951,14,42607,42607,5,42612,42621,5,42736,42737,5,43014,43014,5,43043,43044,7,43047,43047,7,43136,43137,7,43204,43205,5,43263,43263,5,43335,43345,5,43360,43388,8,43395,43395,7,43444,43445,7,43450,43451,7,43454,43456,7,43561,43566,5,43569,43570,5,43573,43574,5,43596,43596,5,43644,43644,5,43698,43700,5,43710,43711,5,43755,43755,7,43758,43759,7,43766,43766,5,44005,44005,5,44008,44008,5,44012,44012,7,44032,44032,11,44060,44060,11,44088,44088,11,44116,44116,11,44144,44144,11,44172,44172,11,44200,44200,11,44228,44228,11,44256,44256,11,44284,44284,11,44312,44312,11,44340,44340,11,44368,44368,11,44396,44396,11,44424,44424,11,44452,44452,11,44480,44480,11,44508,44508,11,44536,44536,11,44564,44564,11,44592,44592,11,44620,44620,11,44648,44648,11,44676,44676,11,44704,44704,11,44732,44732,11,44760,44760,11,44788,44788,11,44816,44816,11,44844,44844,11,44872,44872,11,44900,44900,11,44928,44928,11,44956,44956,11,44984,44984,11,45012,45012,11,45040,45040,11,45068,45068,11,45096,45096,11,45124,45124,11,45152,45152,11,45180,45180,11,45208,45208,11,45236,45236,11,45264,45264,11,45292,45292,11,45320,45320,11,45348,45348,11,45376,45376,11,45404,45404,11,45432,45432,11,45460,45460,11,45488,45488,11,45516,45516,11,45544,45544,11,45572,45572,11,45600,45600,11,45628,45628,11,45656,45656,11,45684,45684,11,45712,45712,11,45740,45740,11,45768,45768,11,45796,45796,11,45824,45824,11,45852,45852,11,45880,45880,11,45908,45908,11,45936,45936,11,45964,45964,11,45992,45992,11,46020,46020,11,46048,46048,11,46076,46076,11,46104,46104,11,46132,46132,11,46160,46160,11,46188,46188,11,46216,46216,11,46244,46244,11,46272,46272,11,46300,46300,11,46328,46328,11,46356,46356,11,46384,46384,11,46412,46412,11,46440,46440,11,46468,46468,11,46496,46496,11,46524,46524,11,46552,46552,11,46580,46580,11,46608,46608,11,46636,46636,11,46664,46664,11,46692,46692,11,46720,46720,11,46748,46748,11,46776,46776,11,46804,46804,11,46832,46832,11,46860,46860,11,46888,46888,11,46916,46916,11,46944,46944,11,46972,46972,11,47000,47000,11,47028,47028,11,47056,47056,11,47084,47084,11,47112,47112,11,47140,47140,11,47168,47168,11,47196,47196,11,47224,47224,11,47252,47252,11,47280,47280,11,47308,47308,11,47336,47336,11,47364,47364,11,47392,47392,11,47420,47420,11,47448,47448,11,47476,47476,11,47504,47504,11,47532,47532,11,47560,47560,11,47588,47588,11,47616,47616,11,47644,47644,11,47672,47672,11,47700,47700,11,47728,47728,11,47756,47756,11,47784,47784,11,47812,47812,11,47840,47840,11,47868,47868,11,47896,47896,11,47924,47924,11,47952,47952,11,47980,47980,11,48008,48008,11,48036,48036,11,48064,48064,11,48092,48092,11,48120,48120,11,48148,48148,11,48176,48176,11,48204,48204,11,48232,48232,11,48260,48260,11,48288,48288,11,48316,48316,11,48344,48344,11,48372,48372,11,48400,48400,11,48428,48428,11,48456,48456,11,48484,48484,11,48512,48512,11,48540,48540,11,48568,48568,11,48596,48596,11,48624,48624,11,48652,48652,11,48680,48680,11,48708,48708,11,48736,48736,11,48764,48764,11,48792,48792,11,48820,48820,11,48848,48848,11,48876,48876,11,48904,48904,11,48932,48932,11,48960,48960,11,48988,48988,11,49016,49016,11,49044,49044,11,49072,49072,11,49100,49100,11,49128,49128,11,49156,49156,11,49184,49184,11,49212,49212,11,49240,49240,11,49268,49268,11,49296,49296,11,49324,49324,11,49352,49352,11,49380,49380,11,49408,49408,11,49436,49436,11,49464,49464,11,49492,49492,11,49520,49520,11,49548,49548,11,49576,49576,11,49604,49604,11,49632,49632,11,49660,49660,11,49688,49688,11,49716,49716,11,49744,49744,11,49772,49772,11,49800,49800,11,49828,49828,11,49856,49856,11,49884,49884,11,49912,49912,11,49940,49940,11,49968,49968,11,49996,49996,11,50024,50024,11,50052,50052,11,50080,50080,11,50108,50108,11,50136,50136,11,50164,50164,11,50192,50192,11,50220,50220,11,50248,50248,11,50276,50276,11,50304,50304,11,50332,50332,11,50360,50360,11,50388,50388,11,50416,50416,11,50444,50444,11,50472,50472,11,50500,50500,11,50528,50528,11,50556,50556,11,50584,50584,11,50612,50612,11,50640,50640,11,50668,50668,11,50696,50696,11,50724,50724,11,50752,50752,11,50780,50780,11,50808,50808,11,50836,50836,11,50864,50864,11,50892,50892,11,50920,50920,11,50948,50948,11,50976,50976,11,51004,51004,11,51032,51032,11,51060,51060,11,51088,51088,11,51116,51116,11,51144,51144,11,51172,51172,11,51200,51200,11,51228,51228,11,51256,51256,11,51284,51284,11,51312,51312,11,51340,51340,11,51368,51368,11,51396,51396,11,51424,51424,11,51452,51452,11,51480,51480,11,51508,51508,11,51536,51536,11,51564,51564,11,51592,51592,11,51620,51620,11,51648,51648,11,51676,51676,11,51704,51704,11,51732,51732,11,51760,51760,11,51788,51788,11,51816,51816,11,51844,51844,11,51872,51872,11,51900,51900,11,51928,51928,11,51956,51956,11,51984,51984,11,52012,52012,11,52040,52040,11,52068,52068,11,52096,52096,11,52124,52124,11,52152,52152,11,52180,52180,11,52208,52208,11,52236,52236,11,52264,52264,11,52292,52292,11,52320,52320,11,52348,52348,11,52376,52376,11,52404,52404,11,52432,52432,11,52460,52460,11,52488,52488,11,52516,52516,11,52544,52544,11,52572,52572,11,52600,52600,11,52628,52628,11,52656,52656,11,52684,52684,11,52712,52712,11,52740,52740,11,52768,52768,11,52796,52796,11,52824,52824,11,52852,52852,11,52880,52880,11,52908,52908,11,52936,52936,11,52964,52964,11,52992,52992,11,53020,53020,11,53048,53048,11,53076,53076,11,53104,53104,11,53132,53132,11,53160,53160,11,53188,53188,11,53216,53216,11,53244,53244,11,53272,53272,11,53300,53300,11,53328,53328,11,53356,53356,11,53384,53384,11,53412,53412,11,53440,53440,11,53468,53468,11,53496,53496,11,53524,53524,11,53552,53552,11,53580,53580,11,53608,53608,11,53636,53636,11,53664,53664,11,53692,53692,11,53720,53720,11,53748,53748,11,53776,53776,11,53804,53804,11,53832,53832,11,53860,53860,11,53888,53888,11,53916,53916,11,53944,53944,11,53972,53972,11,54000,54000,11,54028,54028,11,54056,54056,11,54084,54084,11,54112,54112,11,54140,54140,11,54168,54168,11,54196,54196,11,54224,54224,11,54252,54252,11,54280,54280,11,54308,54308,11,54336,54336,11,54364,54364,11,54392,54392,11,54420,54420,11,54448,54448,11,54476,54476,11,54504,54504,11,54532,54532,11,54560,54560,11,54588,54588,11,54616,54616,11,54644,54644,11,54672,54672,11,54700,54700,11,54728,54728,11,54756,54756,11,54784,54784,11,54812,54812,11,54840,54840,11,54868,54868,11,54896,54896,11,54924,54924,11,54952,54952,11,54980,54980,11,55008,55008,11,55036,55036,11,55064,55064,11,55092,55092,11,55120,55120,11,55148,55148,11,55176,55176,11,55216,55238,9,64286,64286,5,65056,65071,5,65438,65439,5,65529,65531,4,66272,66272,5,68097,68099,5,68108,68111,5,68159,68159,5,68900,68903,5,69446,69456,5,69632,69632,7,69634,69634,7,69744,69744,5,69759,69761,5,69808,69810,7,69815,69816,7,69821,69821,1,69837,69837,1,69927,69931,5,69933,69940,5,70003,70003,5,70018,70018,7,70070,70078,5,70082,70083,1,70094,70094,7,70188,70190,7,70194,70195,7,70197,70197,7,70206,70206,5,70368,70370,7,70400,70401,5,70459,70460,5,70463,70463,7,70465,70468,7,70475,70477,7,70498,70499,7,70512,70516,5,70712,70719,5,70722,70724,5,70726,70726,5,70832,70832,5,70835,70840,5,70842,70842,5,70845,70845,5,70847,70848,5,70850,70851,5,71088,71089,7,71096,71099,7,71102,71102,7,71132,71133,5,71219,71226,5,71229,71229,5,71231,71232,5,71340,71340,7,71342,71343,7,71350,71350,7,71453,71455,5,71462,71462,7,71724,71726,7,71736,71736,7,71984,71984,5,71991,71992,7,71997,71997,7,71999,71999,1,72001,72001,1,72003,72003,5,72148,72151,5,72156,72159,7,72164,72164,7,72243,72248,5,72250,72250,1,72263,72263,5,72279,72280,7,72324,72329,1,72343,72343,7,72751,72751,7,72760,72765,5,72767,72767,5,72873,72873,7,72881,72881,7,72884,72884,7,73009,73014,5,73020,73021,5,73030,73030,1,73098,73102,7,73107,73108,7,73110,73110,7,73459,73460,5,78896,78904,4,92976,92982,5,94033,94087,7,94180,94180,5,113821,113822,5,118528,118573,5,119141,119141,5,119143,119145,5,119150,119154,5,119163,119170,5,119210,119213,5,121344,121398,5,121461,121461,5,121499,121503,5,122880,122886,5,122907,122913,5,122918,122922,5,123566,123566,5,125136,125142,5,126976,126979,14,126981,127182,14,127184,127231,14,127279,127279,14,127344,127345,14,127374,127374,14,127405,127461,14,127489,127490,14,127514,127514,14,127538,127546,14,127561,127567,14,127570,127743,14,127757,127758,14,127760,127760,14,127762,127762,14,127766,127768,14,127770,127770,14,127772,127772,14,127775,127776,14,127778,127779,14,127789,127791,14,127794,127795,14,127798,127798,14,127819,127819,14,127824,127824,14,127868,127868,14,127870,127871,14,127892,127893,14,127896,127896,14,127900,127901,14,127904,127940,14,127942,127942,14,127944,127944,14,127946,127946,14,127951,127955,14,127968,127971,14,127973,127984,14,127987,127987,14,127989,127989,14,127991,127991,14,127995,127999,5,128008,128008,14,128012,128014,14,128017,128018,14,128020,128020,14,128022,128022,14,128042,128042,14,128063,128063,14,128065,128065,14,128101,128101,14,128108,128109,14,128173,128173,14,128182,128183,14,128236,128237,14,128239,128239,14,128245,128245,14,128248,128248,14,128253,128253,14,128255,128258,14,128260,128263,14,128265,128265,14,128277,128277,14,128300,128301,14,128326,128328,14,128331,128334,14,128336,128347,14,128360,128366,14,128369,128370,14,128378,128378,14,128391,128391,14,128394,128397,14,128400,128400,14,128405,128406,14,128420,128420,14,128422,128423,14,128425,128432,14,128435,128443,14,128445,128449,14,128453,128464,14,128468,128475,14,128479,128480,14,128482,128482,14,128484,128487,14,128489,128494,14,128496,128498,14,128500,128505,14,128507,128511,14,128513,128518,14,128521,128525,14,128527,128527,14,128529,128529,14,128533,128533,14,128535,128535,14,128537,128537,14]")}function getLeftDeleteOffset(K,C){if(K===0)return 0;const W=getOffsetBeforeLastEmojiComponent(K,C);if(W!==void 0)return W;const V=new CodePointIterator(C,K);return V.prevCodePoint(),V.offset}function getOffsetBeforeLastEmojiComponent(K,C){const W=new CodePointIterator(C,K);let V=W.prevCodePoint();for(;isEmojiModifier(V)||V===65039||V===8419;){if(W.offset===0)return;V=W.prevCodePoint()}if(!isEmojiImprecise(V))return;let U=W.offset;return U>0&&W.prevCodePoint()===8205&&(U=W.offset),U}function isEmojiModifier(K){return 127995<=K&&K<=127999}const noBreakWhitespace=" ";class AmbiguousCharacters{static getInstance(C){return _a$3.cache.get(Array.from(C))}static getLocales(){return _a$3._locales.value}constructor(C){this.confusableDictionary=C}isAmbiguous(C){return this.confusableDictionary.has(C)}getPrimaryConfusable(C){return this.confusableDictionary.get(C)}getConfusableCodePoints(){return new Set(this.confusableDictionary.keys())}}_a$3=AmbiguousCharacters;AmbiguousCharacters.ambiguousCharacterData=new Lazy(()=>JSON.parse('{"_common":[8232,32,8233,32,5760,32,8192,32,8193,32,8194,32,8195,32,8196,32,8197,32,8198,32,8200,32,8201,32,8202,32,8287,32,8199,32,8239,32,2042,95,65101,95,65102,95,65103,95,8208,45,8209,45,8210,45,65112,45,1748,45,8259,45,727,45,8722,45,10134,45,11450,45,1549,44,1643,44,8218,44,184,44,42233,44,894,59,2307,58,2691,58,1417,58,1795,58,1796,58,5868,58,65072,58,6147,58,6153,58,8282,58,1475,58,760,58,42889,58,8758,58,720,58,42237,58,451,33,11601,33,660,63,577,63,2429,63,5038,63,42731,63,119149,46,8228,46,1793,46,1794,46,42510,46,68176,46,1632,46,1776,46,42232,46,1373,96,65287,96,8219,96,8242,96,1370,96,1523,96,8175,96,65344,96,900,96,8189,96,8125,96,8127,96,8190,96,697,96,884,96,712,96,714,96,715,96,756,96,699,96,701,96,700,96,702,96,42892,96,1497,96,2036,96,2037,96,5194,96,5836,96,94033,96,94034,96,65339,91,10088,40,10098,40,12308,40,64830,40,65341,93,10089,41,10099,41,12309,41,64831,41,10100,123,119060,123,10101,125,65342,94,8270,42,1645,42,8727,42,66335,42,5941,47,8257,47,8725,47,8260,47,9585,47,10187,47,10744,47,119354,47,12755,47,12339,47,11462,47,20031,47,12035,47,65340,92,65128,92,8726,92,10189,92,10741,92,10745,92,119311,92,119355,92,12756,92,20022,92,12034,92,42872,38,708,94,710,94,5869,43,10133,43,66203,43,8249,60,10094,60,706,60,119350,60,5176,60,5810,60,5120,61,11840,61,12448,61,42239,61,8250,62,10095,62,707,62,119351,62,5171,62,94015,62,8275,126,732,126,8128,126,8764,126,65372,124,65293,45,120784,50,120794,50,120804,50,120814,50,120824,50,130034,50,42842,50,423,50,1000,50,42564,50,5311,50,42735,50,119302,51,120785,51,120795,51,120805,51,120815,51,120825,51,130035,51,42923,51,540,51,439,51,42858,51,11468,51,1248,51,94011,51,71882,51,120786,52,120796,52,120806,52,120816,52,120826,52,130036,52,5070,52,71855,52,120787,53,120797,53,120807,53,120817,53,120827,53,130037,53,444,53,71867,53,120788,54,120798,54,120808,54,120818,54,120828,54,130038,54,11474,54,5102,54,71893,54,119314,55,120789,55,120799,55,120809,55,120819,55,120829,55,130039,55,66770,55,71878,55,2819,56,2538,56,2666,56,125131,56,120790,56,120800,56,120810,56,120820,56,120830,56,130040,56,547,56,546,56,66330,56,2663,57,2920,57,2541,57,3437,57,120791,57,120801,57,120811,57,120821,57,120831,57,130041,57,42862,57,11466,57,71884,57,71852,57,71894,57,9082,97,65345,97,119834,97,119886,97,119938,97,119990,97,120042,97,120094,97,120146,97,120198,97,120250,97,120302,97,120354,97,120406,97,120458,97,593,97,945,97,120514,97,120572,97,120630,97,120688,97,120746,97,65313,65,119808,65,119860,65,119912,65,119964,65,120016,65,120068,65,120120,65,120172,65,120224,65,120276,65,120328,65,120380,65,120432,65,913,65,120488,65,120546,65,120604,65,120662,65,120720,65,5034,65,5573,65,42222,65,94016,65,66208,65,119835,98,119887,98,119939,98,119991,98,120043,98,120095,98,120147,98,120199,98,120251,98,120303,98,120355,98,120407,98,120459,98,388,98,5071,98,5234,98,5551,98,65314,66,8492,66,119809,66,119861,66,119913,66,120017,66,120069,66,120121,66,120173,66,120225,66,120277,66,120329,66,120381,66,120433,66,42932,66,914,66,120489,66,120547,66,120605,66,120663,66,120721,66,5108,66,5623,66,42192,66,66178,66,66209,66,66305,66,65347,99,8573,99,119836,99,119888,99,119940,99,119992,99,120044,99,120096,99,120148,99,120200,99,120252,99,120304,99,120356,99,120408,99,120460,99,7428,99,1010,99,11429,99,43951,99,66621,99,128844,67,71922,67,71913,67,65315,67,8557,67,8450,67,8493,67,119810,67,119862,67,119914,67,119966,67,120018,67,120174,67,120226,67,120278,67,120330,67,120382,67,120434,67,1017,67,11428,67,5087,67,42202,67,66210,67,66306,67,66581,67,66844,67,8574,100,8518,100,119837,100,119889,100,119941,100,119993,100,120045,100,120097,100,120149,100,120201,100,120253,100,120305,100,120357,100,120409,100,120461,100,1281,100,5095,100,5231,100,42194,100,8558,68,8517,68,119811,68,119863,68,119915,68,119967,68,120019,68,120071,68,120123,68,120175,68,120227,68,120279,68,120331,68,120383,68,120435,68,5024,68,5598,68,5610,68,42195,68,8494,101,65349,101,8495,101,8519,101,119838,101,119890,101,119942,101,120046,101,120098,101,120150,101,120202,101,120254,101,120306,101,120358,101,120410,101,120462,101,43826,101,1213,101,8959,69,65317,69,8496,69,119812,69,119864,69,119916,69,120020,69,120072,69,120124,69,120176,69,120228,69,120280,69,120332,69,120384,69,120436,69,917,69,120492,69,120550,69,120608,69,120666,69,120724,69,11577,69,5036,69,42224,69,71846,69,71854,69,66182,69,119839,102,119891,102,119943,102,119995,102,120047,102,120099,102,120151,102,120203,102,120255,102,120307,102,120359,102,120411,102,120463,102,43829,102,42905,102,383,102,7837,102,1412,102,119315,70,8497,70,119813,70,119865,70,119917,70,120021,70,120073,70,120125,70,120177,70,120229,70,120281,70,120333,70,120385,70,120437,70,42904,70,988,70,120778,70,5556,70,42205,70,71874,70,71842,70,66183,70,66213,70,66853,70,65351,103,8458,103,119840,103,119892,103,119944,103,120048,103,120100,103,120152,103,120204,103,120256,103,120308,103,120360,103,120412,103,120464,103,609,103,7555,103,397,103,1409,103,119814,71,119866,71,119918,71,119970,71,120022,71,120074,71,120126,71,120178,71,120230,71,120282,71,120334,71,120386,71,120438,71,1292,71,5056,71,5107,71,42198,71,65352,104,8462,104,119841,104,119945,104,119997,104,120049,104,120101,104,120153,104,120205,104,120257,104,120309,104,120361,104,120413,104,120465,104,1211,104,1392,104,5058,104,65320,72,8459,72,8460,72,8461,72,119815,72,119867,72,119919,72,120023,72,120179,72,120231,72,120283,72,120335,72,120387,72,120439,72,919,72,120494,72,120552,72,120610,72,120668,72,120726,72,11406,72,5051,72,5500,72,42215,72,66255,72,731,105,9075,105,65353,105,8560,105,8505,105,8520,105,119842,105,119894,105,119946,105,119998,105,120050,105,120102,105,120154,105,120206,105,120258,105,120310,105,120362,105,120414,105,120466,105,120484,105,618,105,617,105,953,105,8126,105,890,105,120522,105,120580,105,120638,105,120696,105,120754,105,1110,105,42567,105,1231,105,43893,105,5029,105,71875,105,65354,106,8521,106,119843,106,119895,106,119947,106,119999,106,120051,106,120103,106,120155,106,120207,106,120259,106,120311,106,120363,106,120415,106,120467,106,1011,106,1112,106,65322,74,119817,74,119869,74,119921,74,119973,74,120025,74,120077,74,120129,74,120181,74,120233,74,120285,74,120337,74,120389,74,120441,74,42930,74,895,74,1032,74,5035,74,5261,74,42201,74,119844,107,119896,107,119948,107,120000,107,120052,107,120104,107,120156,107,120208,107,120260,107,120312,107,120364,107,120416,107,120468,107,8490,75,65323,75,119818,75,119870,75,119922,75,119974,75,120026,75,120078,75,120130,75,120182,75,120234,75,120286,75,120338,75,120390,75,120442,75,922,75,120497,75,120555,75,120613,75,120671,75,120729,75,11412,75,5094,75,5845,75,42199,75,66840,75,1472,108,8739,73,9213,73,65512,73,1633,108,1777,73,66336,108,125127,108,120783,73,120793,73,120803,73,120813,73,120823,73,130033,73,65321,73,8544,73,8464,73,8465,73,119816,73,119868,73,119920,73,120024,73,120128,73,120180,73,120232,73,120284,73,120336,73,120388,73,120440,73,65356,108,8572,73,8467,108,119845,108,119897,108,119949,108,120001,108,120053,108,120105,73,120157,73,120209,73,120261,73,120313,73,120365,73,120417,73,120469,73,448,73,120496,73,120554,73,120612,73,120670,73,120728,73,11410,73,1030,73,1216,73,1493,108,1503,108,1575,108,126464,108,126592,108,65166,108,65165,108,1994,108,11599,73,5825,73,42226,73,93992,73,66186,124,66313,124,119338,76,8556,76,8466,76,119819,76,119871,76,119923,76,120027,76,120079,76,120131,76,120183,76,120235,76,120287,76,120339,76,120391,76,120443,76,11472,76,5086,76,5290,76,42209,76,93974,76,71843,76,71858,76,66587,76,66854,76,65325,77,8559,77,8499,77,119820,77,119872,77,119924,77,120028,77,120080,77,120132,77,120184,77,120236,77,120288,77,120340,77,120392,77,120444,77,924,77,120499,77,120557,77,120615,77,120673,77,120731,77,1018,77,11416,77,5047,77,5616,77,5846,77,42207,77,66224,77,66321,77,119847,110,119899,110,119951,110,120003,110,120055,110,120107,110,120159,110,120211,110,120263,110,120315,110,120367,110,120419,110,120471,110,1400,110,1404,110,65326,78,8469,78,119821,78,119873,78,119925,78,119977,78,120029,78,120081,78,120185,78,120237,78,120289,78,120341,78,120393,78,120445,78,925,78,120500,78,120558,78,120616,78,120674,78,120732,78,11418,78,42208,78,66835,78,3074,111,3202,111,3330,111,3458,111,2406,111,2662,111,2790,111,3046,111,3174,111,3302,111,3430,111,3664,111,3792,111,4160,111,1637,111,1781,111,65359,111,8500,111,119848,111,119900,111,119952,111,120056,111,120108,111,120160,111,120212,111,120264,111,120316,111,120368,111,120420,111,120472,111,7439,111,7441,111,43837,111,959,111,120528,111,120586,111,120644,111,120702,111,120760,111,963,111,120532,111,120590,111,120648,111,120706,111,120764,111,11423,111,4351,111,1413,111,1505,111,1607,111,126500,111,126564,111,126596,111,65259,111,65260,111,65258,111,65257,111,1726,111,64428,111,64429,111,64427,111,64426,111,1729,111,64424,111,64425,111,64423,111,64422,111,1749,111,3360,111,4125,111,66794,111,71880,111,71895,111,66604,111,1984,79,2534,79,2918,79,12295,79,70864,79,71904,79,120782,79,120792,79,120802,79,120812,79,120822,79,130032,79,65327,79,119822,79,119874,79,119926,79,119978,79,120030,79,120082,79,120134,79,120186,79,120238,79,120290,79,120342,79,120394,79,120446,79,927,79,120502,79,120560,79,120618,79,120676,79,120734,79,11422,79,1365,79,11604,79,4816,79,2848,79,66754,79,42227,79,71861,79,66194,79,66219,79,66564,79,66838,79,9076,112,65360,112,119849,112,119901,112,119953,112,120005,112,120057,112,120109,112,120161,112,120213,112,120265,112,120317,112,120369,112,120421,112,120473,112,961,112,120530,112,120544,112,120588,112,120602,112,120646,112,120660,112,120704,112,120718,112,120762,112,120776,112,11427,112,65328,80,8473,80,119823,80,119875,80,119927,80,119979,80,120031,80,120083,80,120187,80,120239,80,120291,80,120343,80,120395,80,120447,80,929,80,120504,80,120562,80,120620,80,120678,80,120736,80,11426,80,5090,80,5229,80,42193,80,66197,80,119850,113,119902,113,119954,113,120006,113,120058,113,120110,113,120162,113,120214,113,120266,113,120318,113,120370,113,120422,113,120474,113,1307,113,1379,113,1382,113,8474,81,119824,81,119876,81,119928,81,119980,81,120032,81,120084,81,120188,81,120240,81,120292,81,120344,81,120396,81,120448,81,11605,81,119851,114,119903,114,119955,114,120007,114,120059,114,120111,114,120163,114,120215,114,120267,114,120319,114,120371,114,120423,114,120475,114,43847,114,43848,114,7462,114,11397,114,43905,114,119318,82,8475,82,8476,82,8477,82,119825,82,119877,82,119929,82,120033,82,120189,82,120241,82,120293,82,120345,82,120397,82,120449,82,422,82,5025,82,5074,82,66740,82,5511,82,42211,82,94005,82,65363,115,119852,115,119904,115,119956,115,120008,115,120060,115,120112,115,120164,115,120216,115,120268,115,120320,115,120372,115,120424,115,120476,115,42801,115,445,115,1109,115,43946,115,71873,115,66632,115,65331,83,119826,83,119878,83,119930,83,119982,83,120034,83,120086,83,120138,83,120190,83,120242,83,120294,83,120346,83,120398,83,120450,83,1029,83,1359,83,5077,83,5082,83,42210,83,94010,83,66198,83,66592,83,119853,116,119905,116,119957,116,120009,116,120061,116,120113,116,120165,116,120217,116,120269,116,120321,116,120373,116,120425,116,120477,116,8868,84,10201,84,128872,84,65332,84,119827,84,119879,84,119931,84,119983,84,120035,84,120087,84,120139,84,120191,84,120243,84,120295,84,120347,84,120399,84,120451,84,932,84,120507,84,120565,84,120623,84,120681,84,120739,84,11430,84,5026,84,42196,84,93962,84,71868,84,66199,84,66225,84,66325,84,119854,117,119906,117,119958,117,120010,117,120062,117,120114,117,120166,117,120218,117,120270,117,120322,117,120374,117,120426,117,120478,117,42911,117,7452,117,43854,117,43858,117,651,117,965,117,120534,117,120592,117,120650,117,120708,117,120766,117,1405,117,66806,117,71896,117,8746,85,8899,85,119828,85,119880,85,119932,85,119984,85,120036,85,120088,85,120140,85,120192,85,120244,85,120296,85,120348,85,120400,85,120452,85,1357,85,4608,85,66766,85,5196,85,42228,85,94018,85,71864,85,8744,118,8897,118,65366,118,8564,118,119855,118,119907,118,119959,118,120011,118,120063,118,120115,118,120167,118,120219,118,120271,118,120323,118,120375,118,120427,118,120479,118,7456,118,957,118,120526,118,120584,118,120642,118,120700,118,120758,118,1141,118,1496,118,71430,118,43945,118,71872,118,119309,86,1639,86,1783,86,8548,86,119829,86,119881,86,119933,86,119985,86,120037,86,120089,86,120141,86,120193,86,120245,86,120297,86,120349,86,120401,86,120453,86,1140,86,11576,86,5081,86,5167,86,42719,86,42214,86,93960,86,71840,86,66845,86,623,119,119856,119,119908,119,119960,119,120012,119,120064,119,120116,119,120168,119,120220,119,120272,119,120324,119,120376,119,120428,119,120480,119,7457,119,1121,119,1309,119,1377,119,71434,119,71438,119,71439,119,43907,119,71919,87,71910,87,119830,87,119882,87,119934,87,119986,87,120038,87,120090,87,120142,87,120194,87,120246,87,120298,87,120350,87,120402,87,120454,87,1308,87,5043,87,5076,87,42218,87,5742,120,10539,120,10540,120,10799,120,65368,120,8569,120,119857,120,119909,120,119961,120,120013,120,120065,120,120117,120,120169,120,120221,120,120273,120,120325,120,120377,120,120429,120,120481,120,5441,120,5501,120,5741,88,9587,88,66338,88,71916,88,65336,88,8553,88,119831,88,119883,88,119935,88,119987,88,120039,88,120091,88,120143,88,120195,88,120247,88,120299,88,120351,88,120403,88,120455,88,42931,88,935,88,120510,88,120568,88,120626,88,120684,88,120742,88,11436,88,11613,88,5815,88,42219,88,66192,88,66228,88,66327,88,66855,88,611,121,7564,121,65369,121,119858,121,119910,121,119962,121,120014,121,120066,121,120118,121,120170,121,120222,121,120274,121,120326,121,120378,121,120430,121,120482,121,655,121,7935,121,43866,121,947,121,8509,121,120516,121,120574,121,120632,121,120690,121,120748,121,1199,121,4327,121,71900,121,65337,89,119832,89,119884,89,119936,89,119988,89,120040,89,120092,89,120144,89,120196,89,120248,89,120300,89,120352,89,120404,89,120456,89,933,89,978,89,120508,89,120566,89,120624,89,120682,89,120740,89,11432,89,1198,89,5033,89,5053,89,42220,89,94019,89,71844,89,66226,89,119859,122,119911,122,119963,122,120015,122,120067,122,120119,122,120171,122,120223,122,120275,122,120327,122,120379,122,120431,122,120483,122,7458,122,43923,122,71876,122,66293,90,71909,90,65338,90,8484,90,8488,90,119833,90,119885,90,119937,90,119989,90,120041,90,120197,90,120249,90,120301,90,120353,90,120405,90,120457,90,918,90,120493,90,120551,90,120609,90,120667,90,120725,90,5059,90,42204,90,71849,90,65282,34,65284,36,65285,37,65286,38,65290,42,65291,43,65294,46,65295,47,65296,48,65297,49,65298,50,65299,51,65300,52,65301,53,65302,54,65303,55,65304,56,65305,57,65308,60,65309,61,65310,62,65312,64,65316,68,65318,70,65319,71,65324,76,65329,81,65330,82,65333,85,65334,86,65335,87,65343,95,65346,98,65348,100,65350,102,65355,107,65357,109,65358,110,65361,113,65362,114,65364,116,65365,117,65367,119,65370,122,65371,123,65373,125,119846,109],"_default":[160,32,8211,45,65374,126,65306,58,65281,33,8216,96,8217,96,8245,96,180,96,12494,47,1047,51,1073,54,1072,97,1040,65,1068,98,1042,66,1089,99,1057,67,1077,101,1045,69,1053,72,305,105,1050,75,921,73,1052,77,1086,111,1054,79,1009,112,1088,112,1056,80,1075,114,1058,84,215,120,1093,120,1061,88,1091,121,1059,89,65283,35,65288,40,65289,41,65292,44,65307,59,65311,63],"cs":[65374,126,65306,58,65281,33,8216,96,8217,96,8245,96,180,96,12494,47,1047,51,1073,54,1072,97,1040,65,1068,98,1042,66,1089,99,1057,67,1077,101,1045,69,1053,72,305,105,1050,75,921,73,1052,77,1086,111,1054,79,1009,112,1088,112,1056,80,1075,114,1058,84,1093,120,1061,88,1091,121,1059,89,65283,35,65288,40,65289,41,65292,44,65307,59,65311,63],"de":[65374,126,65306,58,65281,33,8216,96,8217,96,8245,96,180,96,12494,47,1047,51,1073,54,1072,97,1040,65,1068,98,1042,66,1089,99,1057,67,1077,101,1045,69,1053,72,305,105,1050,75,921,73,1052,77,1086,111,1054,79,1009,112,1088,112,1056,80,1075,114,1058,84,1093,120,1061,88,1091,121,1059,89,65283,35,65288,40,65289,41,65292,44,65307,59,65311,63],"es":[8211,45,65374,126,65306,58,65281,33,8245,96,180,96,12494,47,1047,51,1073,54,1072,97,1040,65,1068,98,1042,66,1089,99,1057,67,1077,101,1045,69,1053,72,305,105,1050,75,1052,77,1086,111,1054,79,1009,112,1088,112,1056,80,1075,114,1058,84,215,120,1093,120,1061,88,1091,121,1059,89,65283,35,65288,40,65289,41,65292,44,65307,59,65311,63],"fr":[65374,126,65306,58,65281,33,8216,96,8245,96,12494,47,1047,51,1073,54,1072,97,1040,65,1068,98,1042,66,1089,99,1057,67,1077,101,1045,69,1053,72,305,105,1050,75,921,73,1052,77,1086,111,1054,79,1009,112,1088,112,1056,80,1075,114,1058,84,215,120,1093,120,1061,88,1091,121,1059,89,65283,35,65288,40,65289,41,65292,44,65307,59,65311,63],"it":[160,32,8211,45,65374,126,65306,58,65281,33,8216,96,8245,96,180,96,12494,47,1047,51,1073,54,1072,97,1040,65,1068,98,1042,66,1089,99,1057,67,1077,101,1045,69,1053,72,305,105,1050,75,921,73,1052,77,1086,111,1054,79,1009,112,1088,112,1056,80,1075,114,1058,84,215,120,1093,120,1061,88,1091,121,1059,89,65283,35,65288,40,65289,41,65292,44,65307,59,65311,63],"ja":[8211,45,65306,58,65281,33,8216,96,8217,96,8245,96,180,96,1047,51,1073,54,1072,97,1040,65,1068,98,1042,66,1089,99,1057,67,1077,101,1045,69,1053,72,305,105,1050,75,921,73,1052,77,1086,111,1054,79,1009,112,1088,112,1056,80,1075,114,1058,84,215,120,1093,120,1061,88,1091,121,1059,89,65283,35,65292,44,65307,59],"ko":[8211,45,65374,126,65306,58,65281,33,8245,96,180,96,12494,47,1047,51,1073,54,1072,97,1040,65,1068,98,1042,66,1089,99,1057,67,1077,101,1045,69,1053,72,305,105,1050,75,921,73,1052,77,1086,111,1054,79,1009,112,1088,112,1056,80,1075,114,1058,84,215,120,1093,120,1061,88,1091,121,1059,89,65283,35,65288,40,65289,41,65292,44,65307,59,65311,63],"pl":[65374,126,65306,58,65281,33,8216,96,8217,96,8245,96,180,96,12494,47,1047,51,1073,54,1072,97,1040,65,1068,98,1042,66,1089,99,1057,67,1077,101,1045,69,1053,72,305,105,1050,75,921,73,1052,77,1086,111,1054,79,1009,112,1088,112,1056,80,1075,114,1058,84,215,120,1093,120,1061,88,1091,121,1059,89,65283,35,65288,40,65289,41,65292,44,65307,59,65311,63],"pt-BR":[65374,126,65306,58,65281,33,8216,96,8217,96,8245,96,180,96,12494,47,1047,51,1073,54,1072,97,1040,65,1068,98,1042,66,1089,99,1057,67,1077,101,1045,69,1053,72,305,105,1050,75,921,73,1052,77,1086,111,1054,79,1009,112,1088,112,1056,80,1075,114,1058,84,215,120,1093,120,1061,88,1091,121,1059,89,65283,35,65288,40,65289,41,65292,44,65307,59,65311,63],"qps-ploc":[160,32,8211,45,65374,126,65306,58,65281,33,8216,96,8217,96,8245,96,180,96,12494,47,1047,51,1073,54,1072,97,1040,65,1068,98,1042,66,1089,99,1057,67,1077,101,1045,69,1053,72,305,105,1050,75,921,73,1052,77,1086,111,1054,79,1088,112,1056,80,1075,114,1058,84,215,120,1093,120,1061,88,1091,121,1059,89,65283,35,65288,40,65289,41,65292,44,65307,59,65311,63],"ru":[65374,126,65306,58,65281,33,8216,96,8217,96,8245,96,180,96,12494,47,305,105,921,73,1009,112,215,120,65283,35,65288,40,65289,41,65292,44,65307,59,65311,63],"tr":[160,32,8211,45,65374,126,65306,58,65281,33,8245,96,180,96,12494,47,1047,51,1073,54,1072,97,1040,65,1068,98,1042,66,1089,99,1057,67,1077,101,1045,69,1053,72,1050,75,921,73,1052,77,1086,111,1054,79,1009,112,1088,112,1056,80,1075,114,1058,84,215,120,1093,120,1061,88,1091,121,1059,89,65283,35,65288,40,65289,41,65292,44,65307,59,65311,63],"zh-hans":[65374,126,65306,58,65281,33,8245,96,180,96,12494,47,1047,51,1073,54,1072,97,1040,65,1068,98,1042,66,1089,99,1057,67,1077,101,1045,69,1053,72,305,105,1050,75,921,73,1052,77,1086,111,1054,79,1009,112,1088,112,1056,80,1075,114,1058,84,215,120,1093,120,1061,88,1091,121,1059,89,65288,40,65289,41],"zh-hant":[8211,45,65374,126,180,96,12494,47,1047,51,1073,54,1072,97,1040,65,1068,98,1042,66,1089,99,1057,67,1077,101,1045,69,1053,72,305,105,1050,75,921,73,1052,77,1086,111,1054,79,1009,112,1088,112,1056,80,1075,114,1058,84,215,120,1093,120,1061,88,1091,121,1059,89,65283,35,65307,59]}'));AmbiguousCharacters.cache=new LRUCachedFunction(K=>{function C(J){const ee=new Map;for(let te=0;te<J.length;te+=2)ee.set(J[te],J[te+1]);return ee}function W(J,ee){const te=new Map(J);for(const[ie,ne]of ee)te.set(ie,ne);return te}function V(J,ee){if(!J)return ee;const te=new Map;for(const[ie,ne]of J)ee.has(ie)&&te.set(ie,ne);return te}const U=_a$3.ambiguousCharacterData.value;let G=K.filter(J=>!J.startsWith("_")&&J in U);G.length===0&&(G=["_default"]);let Z;for(const J of G){const ee=C(U[J]);Z=V(Z,ee)}const X=C(U._common),Q=W(X,Z);return new _a$3(Q)});AmbiguousCharacters._locales=new Lazy(()=>Object.keys(_a$3.ambiguousCharacterData.value).filter(K=>!K.startsWith("_")));class InvisibleCharacters{static getRawData(){return JSON.parse("[9,10,11,12,13,32,127,160,173,847,1564,4447,4448,6068,6069,6155,6156,6157,6158,7355,7356,8192,8193,8194,8195,8196,8197,8198,8199,8200,8201,8202,8203,8204,8205,8206,8207,8234,8235,8236,8237,8238,8239,8287,8288,8289,8290,8291,8292,8293,8294,8295,8296,8297,8298,8299,8300,8301,8302,8303,10240,12288,12644,65024,65025,65026,65027,65028,65029,65030,65031,65032,65033,65034,65035,65036,65037,65038,65039,65279,65440,65520,65521,65522,65523,65524,65525,65526,65527,65528,65532,78844,119155,119156,119157,119158,119159,119160,119161,119162,917504,917505,917506,917507,917508,917509,917510,917511,917512,917513,917514,917515,917516,917517,917518,917519,917520,917521,917522,917523,917524,917525,917526,917527,917528,917529,917530,917531,917532,917533,917534,917535,917536,917537,917538,917539,917540,917541,917542,917543,917544,917545,917546,917547,917548,917549,917550,917551,917552,917553,917554,917555,917556,917557,917558,917559,917560,917561,917562,917563,917564,917565,917566,917567,917568,917569,917570,917571,917572,917573,917574,917575,917576,917577,917578,917579,917580,917581,917582,917583,917584,917585,917586,917587,917588,917589,917590,917591,917592,917593,917594,917595,917596,917597,917598,917599,917600,917601,917602,917603,917604,917605,917606,917607,917608,917609,917610,917611,917612,917613,917614,917615,917616,917617,917618,917619,917620,917621,917622,917623,917624,917625,917626,917627,917628,917629,917630,917631,917760,917761,917762,917763,917764,917765,917766,917767,917768,917769,917770,917771,917772,917773,917774,917775,917776,917777,917778,917779,917780,917781,917782,917783,917784,917785,917786,917787,917788,917789,917790,917791,917792,917793,917794,917795,917796,917797,917798,917799,917800,917801,917802,917803,917804,917805,917806,917807,917808,917809,917810,917811,917812,917813,917814,917815,917816,917817,917818,917819,917820,917821,917822,917823,917824,917825,917826,917827,917828,917829,917830,917831,917832,917833,917834,917835,917836,917837,917838,917839,917840,917841,917842,917843,917844,917845,917846,917847,917848,917849,917850,917851,917852,917853,917854,917855,917856,917857,917858,917859,917860,917861,917862,917863,917864,917865,917866,917867,917868,917869,917870,917871,917872,917873,917874,917875,917876,917877,917878,917879,917880,917881,917882,917883,917884,917885,917886,917887,917888,917889,917890,917891,917892,917893,917894,917895,917896,917897,917898,917899,917900,917901,917902,917903,917904,917905,917906,917907,917908,917909,917910,917911,917912,917913,917914,917915,917916,917917,917918,917919,917920,917921,917922,917923,917924,917925,917926,917927,917928,917929,917930,917931,917932,917933,917934,917935,917936,917937,917938,917939,917940,917941,917942,917943,917944,917945,917946,917947,917948,917949,917950,917951,917952,917953,917954,917955,917956,917957,917958,917959,917960,917961,917962,917963,917964,917965,917966,917967,917968,917969,917970,917971,917972,917973,917974,917975,917976,917977,917978,917979,917980,917981,917982,917983,917984,917985,917986,917987,917988,917989,917990,917991,917992,917993,917994,917995,917996,917997,917998,917999]")}static getData(){return this._data||(this._data=new Set(InvisibleCharacters.getRawData())),this._data}static isInvisibleCharacter(C){return InvisibleCharacters.getData().has(C)}static get codePoints(){return InvisibleCharacters.getData()}}InvisibleCharacters._data=void 0;const standaloneTokens="";class WindowManager{constructor(){this._zoomFactor=1}getZoomFactor(){return this._zoomFactor}}WindowManager.INSTANCE=new WindowManager;class DevicePixelRatioMonitor extends Disposable{constructor(){super(),this._onDidChange=this._register(new Emitter$1),this.onDidChange=this._onDidChange.event,this._listener=()=>this._handleChange(!0),this._mediaQueryList=null,this._handleChange(!1)}_handleChange(C){var W;(W=this._mediaQueryList)===null||W===void 0||W.removeEventListener("change",this._listener),this._mediaQueryList=window.matchMedia(`(resolution: ${window.devicePixelRatio}dppx)`),this._mediaQueryList.addEventListener("change",this._listener),C&&this._onDidChange.fire()}}class PixelRatioImpl extends Disposable{get value(){return this._value}constructor(){super(),this._onDidChange=this._register(new Emitter$1),this.onDidChange=this._onDidChange.event,this._value=this._getPixelRatio();const C=this._register(new DevicePixelRatioMonitor);this._register(C.onDidChange(()=>{this._value=this._getPixelRatio(),this._onDidChange.fire(this._value)}))}_getPixelRatio(){const C=document.createElement("canvas").getContext("2d"),W=window.devicePixelRatio||1,V=C.webkitBackingStorePixelRatio||C.mozBackingStorePixelRatio||C.msBackingStorePixelRatio||C.oBackingStorePixelRatio||C.backingStorePixelRatio||1;return W/V}}class PixelRatioFacade{constructor(){this._pixelRatioMonitor=null}_getOrCreatePixelRatioMonitor(){return this._pixelRatioMonitor||(this._pixelRatioMonitor=new PixelRatioImpl),this._pixelRatioMonitor}get value(){return this._getOrCreatePixelRatioMonitor().value}get onDidChange(){return this._getOrCreatePixelRatioMonitor().onDidChange}}function addMatchMediaChangeListener(K,C){typeof K=="string"&&(K=window.matchMedia(K)),K.addEventListener("change",C)}const PixelRatio=new PixelRatioFacade;function getZoomFactor(){return WindowManager.INSTANCE.getZoomFactor()}const userAgent=navigator.userAgent,isFirefox=userAgent.indexOf("Firefox")>=0,isWebKit=userAgent.indexOf("AppleWebKit")>=0,isChrome=userAgent.indexOf("Chrome")>=0,isSafari=!isChrome&&userAgent.indexOf("Safari")>=0,isWebkitWebView=!isChrome&&!isSafari&&isWebKit;userAgent.indexOf("Electron/")>=0;const isAndroid=userAgent.indexOf("Android")>=0;let standalone=!1;if(window.matchMedia){const K=window.matchMedia("(display-mode: standalone) or (display-mode: window-controls-overlay)"),C=window.matchMedia("(display-mode: fullscreen)");standalone=K.matches,addMatchMediaChangeListener(K,({matches:W})=>{standalone&&C.matches||(standalone=W)})}function isStandalone(){return standalone}class FastDomNode{constructor(C){this.domNode=C,this._maxWidth="",this._width="",this._height="",this._top="",this._left="",this._bottom="",this._right="",this._paddingLeft="",this._fontFamily="",this._fontWeight="",this._fontSize="",this._fontStyle="",this._fontFeatureSettings="",this._fontVariationSettings="",this._textDecoration="",this._lineHeight="",this._letterSpacing="",this._className="",this._display="",this._position="",this._visibility="",this._color="",this._backgroundColor="",this._layerHint=!1,this._contain="none",this._boxShadow=""}setMaxWidth(C){const W=numberAsPixels(C);this._maxWidth!==W&&(this._maxWidth=W,this.domNode.style.maxWidth=this._maxWidth)}setWidth(C){const W=numberAsPixels(C);this._width!==W&&(this._width=W,this.domNode.style.width=this._width)}setHeight(C){const W=numberAsPixels(C);this._height!==W&&(this._height=W,this.domNode.style.height=this._height)}setTop(C){const W=numberAsPixels(C);this._top!==W&&(this._top=W,this.domNode.style.top=this._top)}setLeft(C){const W=numberAsPixels(C);this._left!==W&&(this._left=W,this.domNode.style.left=this._left)}setBottom(C){const W=numberAsPixels(C);this._bottom!==W&&(this._bottom=W,this.domNode.style.bottom=this._bottom)}setRight(C){const W=numberAsPixels(C);this._right!==W&&(this._right=W,this.domNode.style.right=this._right)}setPaddingLeft(C){const W=numberAsPixels(C);this._paddingLeft!==W&&(this._paddingLeft=W,this.domNode.style.paddingLeft=this._paddingLeft)}setFontFamily(C){this._fontFamily!==C&&(this._fontFamily=C,this.domNode.style.fontFamily=this._fontFamily)}setFontWeight(C){this._fontWeight!==C&&(this._fontWeight=C,this.domNode.style.fontWeight=this._fontWeight)}setFontSize(C){const W=numberAsPixels(C);this._fontSize!==W&&(this._fontSize=W,this.domNode.style.fontSize=this._fontSize)}setFontStyle(C){this._fontStyle!==C&&(this._fontStyle=C,this.domNode.style.fontStyle=this._fontStyle)}setFontFeatureSettings(C){this._fontFeatureSettings!==C&&(this._fontFeatureSettings=C,this.domNode.style.fontFeatureSettings=this._fontFeatureSettings)}setFontVariationSettings(C){this._fontVariationSettings!==C&&(this._fontVariationSettings=C,this.domNode.style.fontVariationSettings=this._fontVariationSettings)}setTextDecoration(C){this._textDecoration!==C&&(this._textDecoration=C,this.domNode.style.textDecoration=this._textDecoration)}setLineHeight(C){const W=numberAsPixels(C);this._lineHeight!==W&&(this._lineHeight=W,this.domNode.style.lineHeight=this._lineHeight)}setLetterSpacing(C){const W=numberAsPixels(C);this._letterSpacing!==W&&(this._letterSpacing=W,this.domNode.style.letterSpacing=this._letterSpacing)}setClassName(C){this._className!==C&&(this._className=C,this.domNode.className=this._className)}toggleClassName(C,W){this.domNode.classList.toggle(C,W),this._className=this.domNode.className}setDisplay(C){this._display!==C&&(this._display=C,this.domNode.style.display=this._display)}setPosition(C){this._position!==C&&(this._position=C,this.domNode.style.position=this._position)}setVisibility(C){this._visibility!==C&&(this._visibility=C,this.domNode.style.visibility=this._visibility)}setColor(C){this._color!==C&&(this._color=C,this.domNode.style.color=this._color)}setBackgroundColor(C){this._backgroundColor!==C&&(this._backgroundColor=C,this.domNode.style.backgroundColor=this._backgroundColor)}setLayerHinting(C){this._layerHint!==C&&(this._layerHint=C,this.domNode.style.transform=this._layerHint?"translate3d(0px, 0px, 0px)":"")}setBoxShadow(C){this._boxShadow!==C&&(this._boxShadow=C,this.domNode.style.boxShadow=C)}setContain(C){this._contain!==C&&(this._contain=C,this.domNode.style.contain=this._contain)}setAttribute(C,W){this.domNode.setAttribute(C,W)}removeAttribute(C){this.domNode.removeAttribute(C)}appendChild(C){this.domNode.appendChild(C.domNode)}removeChild(C){this.domNode.removeChild(C.domNode)}}function numberAsPixels(K){return typeof K=="number"?`${K}px`:K}function createFastDomNode(K){return new FastDomNode(K)}function applyFontInfo(K,C){K instanceof FastDomNode?(K.setFontFamily(C.getMassagedFontFamily()),K.setFontWeight(C.fontWeight),K.setFontSize(C.fontSize),K.setFontFeatureSettings(C.fontFeatureSettings),K.setFontVariationSettings(C.fontVariationSettings),K.setLineHeight(C.lineHeight),K.setLetterSpacing(C.letterSpacing)):(K.style.fontFamily=C.getMassagedFontFamily(),K.style.fontWeight=C.fontWeight,K.style.fontSize=C.fontSize+"px",K.style.fontFeatureSettings=C.fontFeatureSettings,K.style.fontVariationSettings=C.fontVariationSettings,K.style.lineHeight=C.lineHeight+"px",K.style.letterSpacing=C.letterSpacing+"px")}class CharWidthRequest{constructor(C,W){this.chr=C,this.type=W,this.width=0}fulfill(C){this.width=C}}class DomCharWidthReader{constructor(C,W){this._bareFontInfo=C,this._requests=W,this._container=null,this._testElements=null}read(){this._createDomElements(),document.body.appendChild(this._container),this._readFromDomElements(),document.body.removeChild(this._container),this._container=null,this._testElements=null}_createDomElements(){const C=document.createElement("div");C.style.position="absolute",C.style.top="-50000px",C.style.width="50000px";const W=document.createElement("div");applyFontInfo(W,this._bareFontInfo),C.appendChild(W);const V=document.createElement("div");applyFontInfo(V,this._bareFontInfo),V.style.fontWeight="bold",C.appendChild(V);const U=document.createElement("div");applyFontInfo(U,this._bareFontInfo),U.style.fontStyle="italic",C.appendChild(U);const G=[];for(const Z of this._requests){let X;Z.type===0&&(X=W),Z.type===2&&(X=V),Z.type===1&&(X=U),X.appendChild(document.createElement("br"));const Q=document.createElement("span");DomCharWidthReader._render(Q,Z),X.appendChild(Q),G.push(Q)}this._container=C,this._testElements=G}static _render(C,W){if(W.chr===" "){let V=" ";for(let U=0;U<8;U++)V+=V;C.innerText=V}else{let V=W.chr;for(let U=0;U<8;U++)V+=V;C.textContent=V}}_readFromDomElements(){for(let C=0,W=this._requests.length;C<W;C++){const V=this._requests[C],U=this._testElements[C];V.fulfill(U.offsetWidth/256)}}}function readCharWidths(K,C){new DomCharWidthReader(K,C).read()}const EditorZoom=new class{constructor(){this._zoomLevel=0,this._onDidChangeZoomLevel=new Emitter$1,this.onDidChangeZoomLevel=this._onDidChangeZoomLevel.event}getZoomLevel(){return this._zoomLevel}setZoomLevel(K){K=Math.min(Math.max(-5,K),20),this._zoomLevel!==K&&(this._zoomLevel=K,this._onDidChangeZoomLevel.fire(this._zoomLevel))}},GOLDEN_LINE_HEIGHT_RATIO=isMacintosh?1.5:1.35,MINIMUM_LINE_HEIGHT=8;class BareFontInfo{static createFromValidatedSettings(C,W,V){const U=C.get(49),G=C.get(53),Z=C.get(52),X=C.get(51),Q=C.get(54),J=C.get(66),ee=C.get(63);return BareFontInfo._create(U,G,Z,X,Q,J,ee,W,V)}static _create(C,W,V,U,G,Z,X,Q,J){Z===0?Z=GOLDEN_LINE_HEIGHT_RATIO*V:Z<MINIMUM_LINE_HEIGHT&&(Z=Z*V),Z=Math.round(Z),Z<MINIMUM_LINE_HEIGHT&&(Z=MINIMUM_LINE_HEIGHT);const ee=1+(J?0:EditorZoom.getZoomLevel()*.1);return V*=ee,Z*=ee,G===EditorFontVariations.TRANSLATE&&(W==="normal"||W==="bold"?G=EditorFontVariations.OFF:(G=`'wght' ${parseInt(W,10)}`,W="normal")),new BareFontInfo({pixelRatio:Q,fontFamily:C,fontWeight:W,fontSize:V,fontFeatureSettings:U,fontVariationSettings:G,lineHeight:Z,letterSpacing:X})}constructor(C){this._bareFontInfoBrand=void 0,this.pixelRatio=C.pixelRatio,this.fontFamily=String(C.fontFamily),this.fontWeight=String(C.fontWeight),this.fontSize=C.fontSize,this.fontFeatureSettings=C.fontFeatureSettings,this.fontVariationSettings=C.fontVariationSettings,this.lineHeight=C.lineHeight|0,this.letterSpacing=C.letterSpacing}getId(){return`${this.pixelRatio}-${this.fontFamily}-${this.fontWeight}-${this.fontSize}-${this.fontFeatureSettings}-${this.fontVariationSettings}-${this.lineHeight}-${this.letterSpacing}`}getMassagedFontFamily(){const C=EDITOR_FONT_DEFAULTS.fontFamily,W=BareFontInfo._wrapInQuotes(this.fontFamily);return C&&this.fontFamily!==C?`${W}, ${C}`:W}static _wrapInQuotes(C){return/[,"']/.test(C)?C:/[+ ]/.test(C)?`"${C}"`:C}}const SERIALIZED_FONT_INFO_VERSION=2;class FontInfo extends BareFontInfo{constructor(C,W){super(C),this._editorStylingBrand=void 0,this.version=SERIALIZED_FONT_INFO_VERSION,this.isTrusted=W,this.isMonospace=C.isMonospace,this.typicalHalfwidthCharacterWidth=C.typicalHalfwidthCharacterWidth,this.typicalFullwidthCharacterWidth=C.typicalFullwidthCharacterWidth,this.canUseHalfwidthRightwardsArrow=C.canUseHalfwidthRightwardsArrow,this.spaceWidth=C.spaceWidth,this.middotWidth=C.middotWidth,this.wsmiddotWidth=C.wsmiddotWidth,this.maxDigitWidth=C.maxDigitWidth}equals(C){return this.fontFamily===C.fontFamily&&this.fontWeight===C.fontWeight&&this.fontSize===C.fontSize&&this.fontFeatureSettings===C.fontFeatureSettings&&this.fontVariationSettings===C.fontVariationSettings&&this.lineHeight===C.lineHeight&&this.letterSpacing===C.letterSpacing&&this.typicalHalfwidthCharacterWidth===C.typicalHalfwidthCharacterWidth&&this.typicalFullwidthCharacterWidth===C.typicalFullwidthCharacterWidth&&this.canUseHalfwidthRightwardsArrow===C.canUseHalfwidthRightwardsArrow&&this.spaceWidth===C.spaceWidth&&this.middotWidth===C.middotWidth&&this.wsmiddotWidth===C.wsmiddotWidth&&this.maxDigitWidth===C.maxDigitWidth}}class FontMeasurementsImpl extends Disposable{constructor(){super(),this._onDidChange=this._register(new Emitter$1),this.onDidChange=this._onDidChange.event,this._cache=new FontMeasurementsCache,this._evictUntrustedReadingsTimeout=-1}dispose(){this._evictUntrustedReadingsTimeout!==-1&&(window.clearTimeout(this._evictUntrustedReadingsTimeout),this._evictUntrustedReadingsTimeout=-1),super.dispose()}clearAllFontInfos(){this._cache=new FontMeasurementsCache,this._onDidChange.fire()}_writeToCache(C,W){this._cache.put(C,W),!W.isTrusted&&this._evictUntrustedReadingsTimeout===-1&&(this._evictUntrustedReadingsTimeout=window.setTimeout(()=>{this._evictUntrustedReadingsTimeout=-1,this._evictUntrustedReadings()},5e3))}_evictUntrustedReadings(){const C=this._cache.getValues();let W=!1;for(const V of C)V.isTrusted||(W=!0,this._cache.remove(V));W&&this._onDidChange.fire()}readFontInfo(C){if(!this._cache.has(C)){let W=this._actualReadFontInfo(C);(W.typicalHalfwidthCharacterWidth<=2||W.typicalFullwidthCharacterWidth<=2||W.spaceWidth<=2||W.maxDigitWidth<=2)&&(W=new FontInfo({pixelRatio:PixelRatio.value,fontFamily:W.fontFamily,fontWeight:W.fontWeight,fontSize:W.fontSize,fontFeatureSettings:W.fontFeatureSettings,fontVariationSettings:W.fontVariationSettings,lineHeight:W.lineHeight,letterSpacing:W.letterSpacing,isMonospace:W.isMonospace,typicalHalfwidthCharacterWidth:Math.max(W.typicalHalfwidthCharacterWidth,5),typicalFullwidthCharacterWidth:Math.max(W.typicalFullwidthCharacterWidth,5),canUseHalfwidthRightwardsArrow:W.canUseHalfwidthRightwardsArrow,spaceWidth:Math.max(W.spaceWidth,5),middotWidth:Math.max(W.middotWidth,5),wsmiddotWidth:Math.max(W.wsmiddotWidth,5),maxDigitWidth:Math.max(W.maxDigitWidth,5)},!1)),this._writeToCache(C,W)}return this._cache.get(C)}_createRequest(C,W,V,U){const G=new CharWidthRequest(C,W);return V.push(G),U==null||U.push(G),G}_actualReadFontInfo(C){const W=[],V=[],U=this._createRequest("n",0,W,V),G=this._createRequest("ｍ",0,W,null),Z=this._createRequest(" ",0,W,V),X=this._createRequest("0",0,W,V),Q=this._createRequest("1",0,W,V),J=this._createRequest("2",0,W,V),ee=this._createRequest("3",0,W,V),te=this._createRequest("4",0,W,V),ie=this._createRequest("5",0,W,V),ne=this._createRequest("6",0,W,V),oe=this._createRequest("7",0,W,V),re=this._createRequest("8",0,W,V),ae=this._createRequest("9",0,W,V),se=this._createRequest("→",0,W,V),le=this._createRequest("￫",0,W,null),ce=this._createRequest("·",0,W,V),de=this._createRequest(String.fromCharCode(11825),0,W,null),ue="|/-_ilm%";for(let Se=0,Le=ue.length;Se<Le;Se++)this._createRequest(ue.charAt(Se),0,W,V),this._createRequest(ue.charAt(Se),1,W,V),this._createRequest(ue.charAt(Se),2,W,V);readCharWidths(C,W);const ge=Math.max(X.width,Q.width,J.width,ee.width,te.width,ie.width,ne.width,oe.width,re.width,ae.width);let he=C.fontFeatureSettings===EditorFontLigatures.OFF;const fe=V[0].width;for(let Se=1,Le=V.length;he&&Se<Le;Se++){const be=fe-V[Se].width;if(be<-.001||be>.001){he=!1;break}}let pe=!0;return he&&le.width!==fe&&(pe=!1),le.width>se.width&&(pe=!1),new FontInfo({pixelRatio:PixelRatio.value,fontFamily:C.fontFamily,fontWeight:C.fontWeight,fontSize:C.fontSize,fontFeatureSettings:C.fontFeatureSettings,fontVariationSettings:C.fontVariationSettings,lineHeight:C.lineHeight,letterSpacing:C.letterSpacing,isMonospace:he,typicalHalfwidthCharacterWidth:U.width,typicalFullwidthCharacterWidth:G.width,canUseHalfwidthRightwardsArrow:pe,spaceWidth:Z.width,middotWidth:ce.width,wsmiddotWidth:de.width,maxDigitWidth:ge},!0)}}class FontMeasurementsCache{constructor(){this._keys=Object.create(null),this._values=Object.create(null)}has(C){const W=C.getId();return!!this._values[W]}get(C){const W=C.getId();return this._values[W]}put(C,W){const V=C.getId();this._keys[V]=C,this._values[V]=W}remove(C){const W=C.getId();delete this._keys[W],delete this._values[W]}getValues(){return Object.keys(this._keys).map(C=>this._values[C])}}const FontMeasurements=new FontMeasurementsImpl;var _util;(function(K){K.serviceIds=new Map,K.DI_TARGET="$di$target",K.DI_DEPENDENCIES="$di$dependencies";function C(W){return W[K.DI_DEPENDENCIES]||[]}K.getServiceDependencies=C})(_util||(_util={}));const IInstantiationService=createDecorator("instantiationService");function storeServiceDependency(K,C,W){C[_util.DI_TARGET]===C?C[_util.DI_DEPENDENCIES].push({id:K,index:W}):(C[_util.DI_DEPENDENCIES]=[{id:K,index:W}],C[_util.DI_TARGET]=C)}function createDecorator(K){if(_util.serviceIds.has(K))return _util.serviceIds.get(K);const C=function(W,V,U){if(arguments.length!==3)throw new Error("@IServiceName-decorator can only be used to decorate a parameter");storeServiceDependency(C,W,U)};return C.toString=()=>K,_util.serviceIds.set(K,C),C}const ICodeEditorService=createDecorator("codeEditorService"),IModelService=createDecorator("modelService"),ITextModelService=createDecorator("textModelService");var __awaiter$1A=globalThis&&globalThis.__awaiter||function(K,C,W,V){function U(G){return G instanceof W?G:new W(function(Z){Z(G)})}return new(W||(W=Promise))(function(G,Z){function X(ee){try{J(V.next(ee))}catch(te){Z(te)}}function Q(ee){try{J(V.throw(ee))}catch(te){Z(te)}}function J(ee){ee.done?G(ee.value):U(ee.value).then(X,Q)}J((V=V.apply(K,C||[])).next())})};class Action extends Disposable{constructor(C,W="",V="",U=!0,G){super(),this._onDidChange=this._register(new Emitter$1),this.onDidChange=this._onDidChange.event,this._enabled=!0,this._id=C,this._label=W,this._cssClass=V,this._enabled=U,this._actionCallback=G}get id(){return this._id}get label(){return this._label}set label(C){this._setLabel(C)}_setLabel(C){this._label!==C&&(this._label=C,this._onDidChange.fire({label:C}))}get tooltip(){return this._tooltip||""}set tooltip(C){this._setTooltip(C)}_setTooltip(C){this._tooltip!==C&&(this._tooltip=C,this._onDidChange.fire({tooltip:C}))}get class(){return this._cssClass}set class(C){this._setClass(C)}_setClass(C){this._cssClass!==C&&(this._cssClass=C,this._onDidChange.fire({class:C}))}get enabled(){return this._enabled}set enabled(C){this._setEnabled(C)}_setEnabled(C){this._enabled!==C&&(this._enabled=C,this._onDidChange.fire({enabled:C}))}get checked(){return this._checked}set checked(C){this._setChecked(C)}_setChecked(C){this._checked!==C&&(this._checked=C,this._onDidChange.fire({checked:C}))}run(C,W){return __awaiter$1A(this,void 0,void 0,function*(){this._actionCallback&&(yield this._actionCallback(C))})}}class ActionRunner extends Disposable{constructor(){super(...arguments),this._onWillRun=this._register(new Emitter$1),this.onWillRun=this._onWillRun.event,this._onDidRun=this._register(new Emitter$1),this.onDidRun=this._onDidRun.event}run(C,W){return __awaiter$1A(this,void 0,void 0,function*(){if(!C.enabled)return;this._onWillRun.fire({action:C});let V;try{yield this.runAction(C,W)}catch(U){V=U}this._onDidRun.fire({action:C,error:V})})}runAction(C,W){return __awaiter$1A(this,void 0,void 0,function*(){yield C.run(W)})}}class Separator{constructor(){this.id=Separator.ID,this.label="",this.tooltip="",this.class="separator",this.enabled=!1,this.checked=!1}static join(...C){let W=[];for(const V of C)V.length&&(W.length?W=[...W,new Separator,...V]:W=V);return W}run(){return __awaiter$1A(this,void 0,void 0,function*(){})}}Separator.ID="vs.actions.separator";class SubmenuAction{get actions(){return this._actions}constructor(C,W,V,U){this.tooltip="",this.enabled=!0,this.checked=void 0,this.id=C,this.label=W,this.class=U,this._actions=V}run(){return __awaiter$1A(this,void 0,void 0,function*(){})}}class EmptySubmenuAction extends Action{constructor(){super(EmptySubmenuAction.ID,localize("submenu.empty","(empty)"),void 0,!1)}}EmptySubmenuAction.ID="vs.actions.empty";function toAction(K){var C,W;return{id:K.id,label:K.label,class:void 0,enabled:(C=K.enabled)!==null&&C!==void 0?C:!0,checked:(W=K.checked)!==null&&W!==void 0?W:!1,run:(...V)=>__awaiter$1A(this,void 0,void 0,function*(){return K.run(...V)}),tooltip:K.label}}var ThemeColor;(function(K){function C(W){return W&&typeof W=="object"&&typeof W.id=="string"}K.isThemeColor=C})(ThemeColor||(ThemeColor={}));var ThemeIcon;(function(K){K.iconNameSegment="[A-Za-z0-9]+",K.iconNameExpression="[A-Za-z0-9-]+",K.iconModifierExpression="~[A-Za-z]+",K.iconNameCharacter="[A-Za-z0-9~-]";const C=new RegExp(`^(${K.iconNameExpression})(${K.iconModifierExpression})?$`);function W(ie){const ne=C.exec(ie.id);if(!ne)return W(Codicon.error);const[,oe,re]=ne,ae=["codicon","codicon-"+oe];return re&&ae.push("codicon-modifier-"+re.substring(1)),ae}K.asClassNameArray=W;function V(ie){return W(ie).join(" ")}K.asClassName=V;function U(ie){return"."+W(ie).join(".")}K.asCSSSelector=U;function G(ie){return ie&&typeof ie=="object"&&typeof ie.id=="string"&&(typeof ie.color>"u"||ThemeColor.isThemeColor(ie.color))}K.isThemeIcon=G;const Z=new RegExp(`^\\$\\((${K.iconNameExpression}(?:${K.iconModifierExpression})?)\\)$`);function X(ie){const ne=Z.exec(ie);if(!ne)return;const[,oe]=ne;return{id:oe}}K.fromString=X;function Q(ie){return{id:ie}}K.fromId=Q;function J(ie,ne){let oe=ie.id;const re=oe.lastIndexOf("~");return re!==-1&&(oe=oe.substring(0,re)),ne&&(oe=`${oe}~${ne}`),{id:oe}}K.modify=J;function ee(ie){const ne=ie.id.lastIndexOf("~");if(ne!==-1)return ie.id.substring(ne+1)}K.getModifier=ee;function te(ie,ne){var oe,re;return ie.id===ne.id&&((oe=ie.color)===null||oe===void 0?void 0:oe.id)===((re=ne.color)===null||re===void 0?void 0:re.id)}K.isEqual=te})(ThemeIcon||(ThemeIcon={}));const ICommandService=createDecorator("commandService"),CommandsRegistry=new class{constructor(){this._commands=new Map,this._onDidRegisterCommand=new Emitter$1,this.onDidRegisterCommand=this._onDidRegisterCommand.event}registerCommand(K,C){if(!K)throw new Error("invalid command");if(typeof K=="string"){if(!C)throw new Error("invalid command");return this.registerCommand({id:K,handler:C})}if(K.description){const Z=[];for(const Q of K.description.args)Z.push(Q.constraint);const X=K.handler;K.handler=function(Q,...J){return validateConstraints(J,Z),X(Q,...J)}}const{id:W}=K;let V=this._commands.get(W);V||(V=new LinkedList,this._commands.set(W,V));const U=V.unshift(K),G=toDisposable(()=>{U();const Z=this._commands.get(W);Z!=null&&Z.isEmpty()&&this._commands.delete(W)});return this._onDidRegisterCommand.fire(W),G}registerCommandAlias(K,C){return CommandsRegistry.registerCommand(K,(W,...V)=>W.get(ICommandService).executeCommand(C,...V))}getCommand(K){const C=this._commands.get(K);if(!(!C||C.isEmpty()))return Iterable.first(C)}getCommands(){const K=new Map;for(const C of this._commands.keys()){const W=this.getCommand(C);W&&K.set(C,W)}return K}};CommandsRegistry.registerCommand("noop",()=>{});function hintDidYouMean(...K){switch(K.length){case 1:return localize("contextkey.scanner.hint.didYouMean1","Did you mean {0}?",K[0]);case 2:return localize("contextkey.scanner.hint.didYouMean2","Did you mean {0} or {1}?",K[0],K[1]);case 3:return localize("contextkey.scanner.hint.didYouMean3","Did you mean {0}, {1} or {2}?",K[0],K[1],K[2]);default:return}}const hintDidYouForgetToOpenOrCloseQuote=localize("contextkey.scanner.hint.didYouForgetToOpenOrCloseQuote","Did you forget to open or close the quote?"),hintDidYouForgetToEscapeSlash=localize("contextkey.scanner.hint.didYouForgetToEscapeSlash","Did you forget to escape the '/' (slash) character? Put two backslashes before it to escape, e.g., '\\\\/'.");let Scanner$1=class Xt{constructor(){this._input="",this._start=0,this._current=0,this._tokens=[],this._errors=[],this.stringRe=/[a-zA-Z0-9_<>\-\./\\:\*\?\+\[\]\^,#@;"%\$\p{L}-]+/uy}static getLexeme(C){switch(C.type){case 0:return"(";case 1:return")";case 2:return"!";case 3:return C.isTripleEq?"===":"==";case 4:return C.isTripleEq?"!==":"!=";case 5:return"<";case 6:return"<=";case 7:return">=";case 8:return">=";case 9:return"=~";case 10:return C.lexeme;case 11:return"true";case 12:return"false";case 13:return"in";case 14:return"not";case 15:return"&&";case 16:return"||";case 17:return C.lexeme;case 18:return C.lexeme;case 19:return C.lexeme;case 20:return"EOF";default:throw illegalState(`unhandled token type: ${JSON.stringify(C)}; have you forgotten to add a case?`)}}reset(C){return this._input=C,this._start=0,this._current=0,this._tokens=[],this._errors=[],this}scan(){for(;!this._isAtEnd();)switch(this._start=this._current,this._advance()){case 40:this._addToken(0);break;case 41:this._addToken(1);break;case 33:if(this._match(61)){const W=this._match(61);this._tokens.push({type:4,offset:this._start,isTripleEq:W})}else this._addToken(2);break;case 39:this._quotedString();break;case 47:this._regex();break;case 61:if(this._match(61)){const W=this._match(61);this._tokens.push({type:3,offset:this._start,isTripleEq:W})}else this._match(126)?this._addToken(9):this._error(hintDidYouMean("==","=~"));break;case 60:this._addToken(this._match(61)?6:5);break;case 62:this._addToken(this._match(61)?8:7);break;case 38:this._match(38)?this._addToken(15):this._error(hintDidYouMean("&&"));break;case 124:this._match(124)?this._addToken(16):this._error(hintDidYouMean("||"));break;case 32:case 13:case 9:case 10:case 160:break;default:this._string()}return this._start=this._current,this._addToken(20),Array.from(this._tokens)}_match(C){return this._isAtEnd()||this._input.charCodeAt(this._current)!==C?!1:(this._current++,!0)}_advance(){return this._input.charCodeAt(this._current++)}_peek(){return this._isAtEnd()?0:this._input.charCodeAt(this._current)}_addToken(C){this._tokens.push({type:C,offset:this._start})}_error(C){const W=this._start,V=this._input.substring(this._start,this._current),U={type:19,offset:this._start,lexeme:V};this._errors.push({offset:W,lexeme:V,additionalInfo:C}),this._tokens.push(U)}_string(){this.stringRe.lastIndex=this._start;const C=this.stringRe.exec(this._input);if(C){this._current=this._start+C[0].length;const W=this._input.substring(this._start,this._current),V=Xt._keywords.get(W);V?this._addToken(V):this._tokens.push({type:17,lexeme:W,offset:this._start})}}_quotedString(){for(;this._peek()!==39&&!this._isAtEnd();)this._advance();if(this._isAtEnd()){this._error(hintDidYouForgetToOpenOrCloseQuote);return}this._advance(),this._tokens.push({type:18,lexeme:this._input.substring(this._start+1,this._current-1),offset:this._start+1})}_regex(){let C=this._current,W=!1,V=!1;for(;;){if(C>=this._input.length){this._current=C,this._error(hintDidYouForgetToEscapeSlash);return}const G=this._input.charCodeAt(C);if(W)W=!1;else if(G===47&&!V){C++;break}else G===91?V=!0:G===92?W=!0:G===93&&(V=!1);C++}for(;C<this._input.length&&Xt._regexFlags.has(this._input.charCodeAt(C));)C++;this._current=C;const U=this._input.substring(this._start,this._current);this._tokens.push({type:10,lexeme:U,offset:this._start})}_isAtEnd(){return this._current>=this._input.length}};Scanner$1._regexFlags=new Set(["i","g","s","m","y","u"].map(K=>K.charCodeAt(0)));Scanner$1._keywords=new Map([["not",14],["in",13],["false",12],["true",11]]);const CONSTANT_VALUES=new Map;CONSTANT_VALUES.set("false",!1);CONSTANT_VALUES.set("true",!0);CONSTANT_VALUES.set("isMac",isMacintosh);CONSTANT_VALUES.set("isLinux",isLinux);CONSTANT_VALUES.set("isWindows",isWindows);CONSTANT_VALUES.set("isWeb",isWeb);CONSTANT_VALUES.set("isMacNative",isMacintosh&&!isWeb);CONSTANT_VALUES.set("isEdge",isEdge);CONSTANT_VALUES.set("isFirefox",isFirefox$1);CONSTANT_VALUES.set("isChrome",isChrome$1);CONSTANT_VALUES.set("isSafari",isSafari$1);const hasOwnProperty$1=Object.prototype.hasOwnProperty,defaultConfig={regexParsingWithErrorRecovery:!0},errorEmptyString=localize("contextkey.parser.error.emptyString","Empty context key expression"),hintEmptyString=localize("contextkey.parser.error.emptyString.hint","Did you forget to write an expression? You can also put 'false' or 'true' to always evaluate to false or true, respectively."),errorNoInAfterNot=localize("contextkey.parser.error.noInAfterNot","'in' after 'not'."),errorClosingParenthesis=localize("contextkey.parser.error.closingParenthesis","closing parenthesis ')'"),errorUnexpectedToken=localize("contextkey.parser.error.unexpectedToken","Unexpected token"),hintUnexpectedToken=localize("contextkey.parser.error.unexpectedToken.hint","Did you forget to put && or || before the token?"),errorUnexpectedEOF=localize("contextkey.parser.error.unexpectedEOF","Unexpected end of expression"),hintUnexpectedEOF=localize("contextkey.parser.error.unexpectedEOF.hint","Did you forget to put a context key?");let Parser$1=class Ht{constructor(C=defaultConfig){this._config=C,this._scanner=new Scanner$1,this._tokens=[],this._current=0,this._parsingErrors=[],this._flagsGYRe=/g|y/g}parse(C){if(C===""){this._parsingErrors.push({message:errorEmptyString,offset:0,lexeme:"",additionalInfo:hintEmptyString});return}this._tokens=this._scanner.reset(C).scan(),this._current=0,this._parsingErrors=[];try{const W=this._expr();if(!this._isAtEnd()){const V=this._peek(),U=V.type===17?hintUnexpectedToken:void 0;throw this._parsingErrors.push({message:errorUnexpectedToken,offset:V.offset,lexeme:Scanner$1.getLexeme(V),additionalInfo:U}),Ht._parseError}return W}catch(W){if(W!==Ht._parseError)throw W;return}}_expr(){return this._or()}_or(){const C=[this._and()];for(;this._matchOne(16);){const W=this._and();C.push(W)}return C.length===1?C[0]:ContextKeyExpr.or(...C)}_and(){const C=[this._term()];for(;this._matchOne(15);){const W=this._term();C.push(W)}return C.length===1?C[0]:ContextKeyExpr.and(...C)}_term(){if(this._matchOne(2)){const C=this._peek();switch(C.type){case 11:return this._advance(),ContextKeyFalseExpr.INSTANCE;case 12:return this._advance(),ContextKeyTrueExpr.INSTANCE;case 0:{this._advance();const W=this._expr();return this._consume(1,errorClosingParenthesis),W==null?void 0:W.negate()}case 17:return this._advance(),ContextKeyNotExpr.create(C.lexeme);default:throw this._errExpectedButGot("KEY | true | false | '(' expression ')'",C)}}return this._primary()}_primary(){const C=this._peek();switch(C.type){case 11:return this._advance(),ContextKeyExpr.true();case 12:return this._advance(),ContextKeyExpr.false();case 0:{this._advance();const W=this._expr();return this._consume(1,errorClosingParenthesis),W}case 17:{const W=C.lexeme;if(this._advance(),this._matchOne(9)){const U=this._peek();if(!this._config.regexParsingWithErrorRecovery){if(this._advance(),U.type!==10)throw this._errExpectedButGot("REGEX",U);const G=U.lexeme,Z=G.lastIndexOf("/"),X=Z===G.length-1?void 0:this._removeFlagsGY(G.substring(Z+1));let Q;try{Q=new RegExp(G.substring(1,Z),X)}catch{throw this._errExpectedButGot("REGEX",U)}return ContextKeyRegexExpr.create(W,Q)}switch(U.type){case 10:case 19:{const G=[U.lexeme];this._advance();let Z=this._peek(),X=0;for(let ie=0;ie<U.lexeme.length;ie++)U.lexeme.charCodeAt(ie)===40?X++:U.lexeme.charCodeAt(ie)===41&&X--;for(;!this._isAtEnd()&&Z.type!==15&&Z.type!==16;){switch(Z.type){case 0:X++;break;case 1:X--;break;case 10:case 18:for(let ie=0;ie<Z.lexeme.length;ie++)Z.lexeme.charCodeAt(ie)===40?X++:U.lexeme.charCodeAt(ie)===41&&X--}if(X<0)break;G.push(Scanner$1.getLexeme(Z)),this._advance(),Z=this._peek()}const Q=G.join(""),J=Q.lastIndexOf("/"),ee=J===Q.length-1?void 0:this._removeFlagsGY(Q.substring(J+1));let te;try{te=new RegExp(Q.substring(1,J),ee)}catch{throw this._errExpectedButGot("REGEX",U)}return ContextKeyExpr.regex(W,te)}case 18:{const G=U.lexeme;this._advance();let Z=null;if(!isFalsyOrWhitespace(G)){const X=G.indexOf("/"),Q=G.lastIndexOf("/");if(X!==Q&&X>=0){const J=G.slice(X+1,Q),ee=G[Q+1]==="i"?"i":"";try{Z=new RegExp(J,ee)}catch{throw this._errExpectedButGot("REGEX",U)}}}if(Z===null)throw this._errExpectedButGot("REGEX",U);return ContextKeyRegexExpr.create(W,Z)}default:throw this._errExpectedButGot("REGEX",this._peek())}}if(this._matchOne(14)){this._consume(13,errorNoInAfterNot);const U=this._value();return ContextKeyExpr.notIn(W,U)}switch(this._peek().type){case 3:{this._advance();const U=this._value();if(this._previous().type===18)return ContextKeyExpr.equals(W,U);switch(U){case"true":return ContextKeyExpr.has(W);case"false":return ContextKeyExpr.not(W);default:return ContextKeyExpr.equals(W,U)}}case 4:{this._advance();const U=this._value();if(this._previous().type===18)return ContextKeyExpr.notEquals(W,U);switch(U){case"true":return ContextKeyExpr.not(W);case"false":return ContextKeyExpr.has(W);default:return ContextKeyExpr.notEquals(W,U)}}case 5:return this._advance(),ContextKeySmallerExpr.create(W,this._value());case 6:return this._advance(),ContextKeySmallerEqualsExpr.create(W,this._value());case 7:return this._advance(),ContextKeyGreaterExpr.create(W,this._value());case 8:return this._advance(),ContextKeyGreaterEqualsExpr.create(W,this._value());case 13:return this._advance(),ContextKeyExpr.in(W,this._value());default:return ContextKeyExpr.has(W)}}case 20:throw this._parsingErrors.push({message:errorUnexpectedEOF,offset:C.offset,lexeme:"",additionalInfo:hintUnexpectedEOF}),Ht._parseError;default:throw this._errExpectedButGot(`true | false | KEY 
	| KEY '=~' REGEX 
	| KEY ('==' | '!=' | '<' | '<=' | '>' | '>=' | 'in' | 'not' 'in') value`,this._peek())}}_value(){const C=this._peek();switch(C.type){case 17:case 18:return this._advance(),C.lexeme;case 11:return this._advance(),"true";case 12:return this._advance(),"false";case 13:return this._advance(),"in";default:return""}}_removeFlagsGY(C){return C.replaceAll(this._flagsGYRe,"")}_previous(){return this._tokens[this._current-1]}_matchOne(C){return this._check(C)?(this._advance(),!0):!1}_advance(){return this._isAtEnd()||this._current++,this._previous()}_consume(C,W){if(this._check(C))return this._advance();throw this._errExpectedButGot(W,this._peek())}_errExpectedButGot(C,W,V){const U=localize("contextkey.parser.error.expectedButGot",`Expected: {0}
Received: '{1}'.`,C,Scanner$1.getLexeme(W)),G=W.offset,Z=Scanner$1.getLexeme(W);return this._parsingErrors.push({message:U,offset:G,lexeme:Z,additionalInfo:V}),Ht._parseError}_check(C){return this._peek().type===C}_peek(){return this._tokens[this._current]}_isAtEnd(){return this._peek().type===20}};Parser$1._parseError=new Error;class ContextKeyExpr{static false(){return ContextKeyFalseExpr.INSTANCE}static true(){return ContextKeyTrueExpr.INSTANCE}static has(C){return ContextKeyDefinedExpr.create(C)}static equals(C,W){return ContextKeyEqualsExpr.create(C,W)}static notEquals(C,W){return ContextKeyNotEqualsExpr.create(C,W)}static regex(C,W){return ContextKeyRegexExpr.create(C,W)}static in(C,W){return ContextKeyInExpr.create(C,W)}static notIn(C,W){return ContextKeyNotInExpr.create(C,W)}static not(C){return ContextKeyNotExpr.create(C)}static and(...C){return ContextKeyAndExpr.create(C,null,!0)}static or(...C){return ContextKeyOrExpr.create(C,null,!0)}static deserialize(C){return C==null?void 0:this._parser.parse(C)}}ContextKeyExpr._parser=new Parser$1({regexParsingWithErrorRecovery:!1});function expressionsAreEqualWithConstantSubstitution(K,C){const W=K?K.substituteConstants():void 0,V=C?C.substituteConstants():void 0;return!W&&!V?!0:!W||!V?!1:W.equals(V)}function cmp(K,C){return K.cmp(C)}class ContextKeyFalseExpr{constructor(){this.type=0}cmp(C){return this.type-C.type}equals(C){return C.type===this.type}substituteConstants(){return this}evaluate(C){return!1}serialize(){return"false"}keys(){return[]}negate(){return ContextKeyTrueExpr.INSTANCE}}ContextKeyFalseExpr.INSTANCE=new ContextKeyFalseExpr;class ContextKeyTrueExpr{constructor(){this.type=1}cmp(C){return this.type-C.type}equals(C){return C.type===this.type}substituteConstants(){return this}evaluate(C){return!0}serialize(){return"true"}keys(){return[]}negate(){return ContextKeyFalseExpr.INSTANCE}}ContextKeyTrueExpr.INSTANCE=new ContextKeyTrueExpr;class ContextKeyDefinedExpr{static create(C,W=null){const V=CONSTANT_VALUES.get(C);return typeof V=="boolean"?V?ContextKeyTrueExpr.INSTANCE:ContextKeyFalseExpr.INSTANCE:new ContextKeyDefinedExpr(C,W)}constructor(C,W){this.key=C,this.negated=W,this.type=2}cmp(C){return C.type!==this.type?this.type-C.type:cmp1(this.key,C.key)}equals(C){return C.type===this.type?this.key===C.key:!1}substituteConstants(){const C=CONSTANT_VALUES.get(this.key);return typeof C=="boolean"?C?ContextKeyTrueExpr.INSTANCE:ContextKeyFalseExpr.INSTANCE:this}evaluate(C){return!!C.getValue(this.key)}serialize(){return this.key}keys(){return[this.key]}negate(){return this.negated||(this.negated=ContextKeyNotExpr.create(this.key,this)),this.negated}}class ContextKeyEqualsExpr{static create(C,W,V=null){if(typeof W=="boolean")return W?ContextKeyDefinedExpr.create(C,V):ContextKeyNotExpr.create(C,V);const U=CONSTANT_VALUES.get(C);return typeof U=="boolean"?W===(U?"true":"false")?ContextKeyTrueExpr.INSTANCE:ContextKeyFalseExpr.INSTANCE:new ContextKeyEqualsExpr(C,W,V)}constructor(C,W,V){this.key=C,this.value=W,this.negated=V,this.type=4}cmp(C){return C.type!==this.type?this.type-C.type:cmp2(this.key,this.value,C.key,C.value)}equals(C){return C.type===this.type?this.key===C.key&&this.value===C.value:!1}substituteConstants(){const C=CONSTANT_VALUES.get(this.key);if(typeof C=="boolean"){const W=C?"true":"false";return this.value===W?ContextKeyTrueExpr.INSTANCE:ContextKeyFalseExpr.INSTANCE}return this}evaluate(C){return C.getValue(this.key)==this.value}serialize(){return`${this.key} == '${this.value}'`}keys(){return[this.key]}negate(){return this.negated||(this.negated=ContextKeyNotEqualsExpr.create(this.key,this.value,this)),this.negated}}class ContextKeyInExpr{static create(C,W){return new ContextKeyInExpr(C,W)}constructor(C,W){this.key=C,this.valueKey=W,this.type=10,this.negated=null}cmp(C){return C.type!==this.type?this.type-C.type:cmp2(this.key,this.valueKey,C.key,C.valueKey)}equals(C){return C.type===this.type?this.key===C.key&&this.valueKey===C.valueKey:!1}substituteConstants(){return this}evaluate(C){const W=C.getValue(this.valueKey),V=C.getValue(this.key);return Array.isArray(W)?W.includes(V):typeof V=="string"&&typeof W=="object"&&W!==null?hasOwnProperty$1.call(W,V):!1}serialize(){return`${this.key} in '${this.valueKey}'`}keys(){return[this.key,this.valueKey]}negate(){return this.negated||(this.negated=ContextKeyNotInExpr.create(this.key,this.valueKey)),this.negated}}class ContextKeyNotInExpr{static create(C,W){return new ContextKeyNotInExpr(C,W)}constructor(C,W){this.key=C,this.valueKey=W,this.type=11,this._negated=ContextKeyInExpr.create(C,W)}cmp(C){return C.type!==this.type?this.type-C.type:this._negated.cmp(C._negated)}equals(C){return C.type===this.type?this._negated.equals(C._negated):!1}substituteConstants(){return this}evaluate(C){return!this._negated.evaluate(C)}serialize(){return`${this.key} not in '${this.valueKey}'`}keys(){return this._negated.keys()}negate(){return this._negated}}class ContextKeyNotEqualsExpr{static create(C,W,V=null){if(typeof W=="boolean")return W?ContextKeyNotExpr.create(C,V):ContextKeyDefinedExpr.create(C,V);const U=CONSTANT_VALUES.get(C);return typeof U=="boolean"?W===(U?"true":"false")?ContextKeyFalseExpr.INSTANCE:ContextKeyTrueExpr.INSTANCE:new ContextKeyNotEqualsExpr(C,W,V)}constructor(C,W,V){this.key=C,this.value=W,this.negated=V,this.type=5}cmp(C){return C.type!==this.type?this.type-C.type:cmp2(this.key,this.value,C.key,C.value)}equals(C){return C.type===this.type?this.key===C.key&&this.value===C.value:!1}substituteConstants(){const C=CONSTANT_VALUES.get(this.key);if(typeof C=="boolean"){const W=C?"true":"false";return this.value===W?ContextKeyFalseExpr.INSTANCE:ContextKeyTrueExpr.INSTANCE}return this}evaluate(C){return C.getValue(this.key)!=this.value}serialize(){return`${this.key} != '${this.value}'`}keys(){return[this.key]}negate(){return this.negated||(this.negated=ContextKeyEqualsExpr.create(this.key,this.value,this)),this.negated}}class ContextKeyNotExpr{static create(C,W=null){const V=CONSTANT_VALUES.get(C);return typeof V=="boolean"?V?ContextKeyFalseExpr.INSTANCE:ContextKeyTrueExpr.INSTANCE:new ContextKeyNotExpr(C,W)}constructor(C,W){this.key=C,this.negated=W,this.type=3}cmp(C){return C.type!==this.type?this.type-C.type:cmp1(this.key,C.key)}equals(C){return C.type===this.type?this.key===C.key:!1}substituteConstants(){const C=CONSTANT_VALUES.get(this.key);return typeof C=="boolean"?C?ContextKeyFalseExpr.INSTANCE:ContextKeyTrueExpr.INSTANCE:this}evaluate(C){return!C.getValue(this.key)}serialize(){return`!${this.key}`}keys(){return[this.key]}negate(){return this.negated||(this.negated=ContextKeyDefinedExpr.create(this.key,this)),this.negated}}function withFloatOrStr(K,C){if(typeof K=="string"){const W=parseFloat(K);isNaN(W)||(K=W)}return typeof K=="string"||typeof K=="number"?C(K):ContextKeyFalseExpr.INSTANCE}class ContextKeyGreaterExpr{static create(C,W,V=null){return withFloatOrStr(W,U=>new ContextKeyGreaterExpr(C,U,V))}constructor(C,W,V){this.key=C,this.value=W,this.negated=V,this.type=12}cmp(C){return C.type!==this.type?this.type-C.type:cmp2(this.key,this.value,C.key,C.value)}equals(C){return C.type===this.type?this.key===C.key&&this.value===C.value:!1}substituteConstants(){return this}evaluate(C){return typeof this.value=="string"?!1:parseFloat(C.getValue(this.key))>this.value}serialize(){return`${this.key} > ${this.value}`}keys(){return[this.key]}negate(){return this.negated||(this.negated=ContextKeySmallerEqualsExpr.create(this.key,this.value,this)),this.negated}}class ContextKeyGreaterEqualsExpr{static create(C,W,V=null){return withFloatOrStr(W,U=>new ContextKeyGreaterEqualsExpr(C,U,V))}constructor(C,W,V){this.key=C,this.value=W,this.negated=V,this.type=13}cmp(C){return C.type!==this.type?this.type-C.type:cmp2(this.key,this.value,C.key,C.value)}equals(C){return C.type===this.type?this.key===C.key&&this.value===C.value:!1}substituteConstants(){return this}evaluate(C){return typeof this.value=="string"?!1:parseFloat(C.getValue(this.key))>=this.value}serialize(){return`${this.key} >= ${this.value}`}keys(){return[this.key]}negate(){return this.negated||(this.negated=ContextKeySmallerExpr.create(this.key,this.value,this)),this.negated}}class ContextKeySmallerExpr{static create(C,W,V=null){return withFloatOrStr(W,U=>new ContextKeySmallerExpr(C,U,V))}constructor(C,W,V){this.key=C,this.value=W,this.negated=V,this.type=14}cmp(C){return C.type!==this.type?this.type-C.type:cmp2(this.key,this.value,C.key,C.value)}equals(C){return C.type===this.type?this.key===C.key&&this.value===C.value:!1}substituteConstants(){return this}evaluate(C){return typeof this.value=="string"?!1:parseFloat(C.getValue(this.key))<this.value}serialize(){return`${this.key} < ${this.value}`}keys(){return[this.key]}negate(){return this.negated||(this.negated=ContextKeyGreaterEqualsExpr.create(this.key,this.value,this)),this.negated}}class ContextKeySmallerEqualsExpr{static create(C,W,V=null){return withFloatOrStr(W,U=>new ContextKeySmallerEqualsExpr(C,U,V))}constructor(C,W,V){this.key=C,this.value=W,this.negated=V,this.type=15}cmp(C){return C.type!==this.type?this.type-C.type:cmp2(this.key,this.value,C.key,C.value)}equals(C){return C.type===this.type?this.key===C.key&&this.value===C.value:!1}substituteConstants(){return this}evaluate(C){return typeof this.value=="string"?!1:parseFloat(C.getValue(this.key))<=this.value}serialize(){return`${this.key} <= ${this.value}`}keys(){return[this.key]}negate(){return this.negated||(this.negated=ContextKeyGreaterExpr.create(this.key,this.value,this)),this.negated}}class ContextKeyRegexExpr{static create(C,W){return new ContextKeyRegexExpr(C,W)}constructor(C,W){this.key=C,this.regexp=W,this.type=7,this.negated=null}cmp(C){if(C.type!==this.type)return this.type-C.type;if(this.key<C.key)return-1;if(this.key>C.key)return 1;const W=this.regexp?this.regexp.source:"",V=C.regexp?C.regexp.source:"";return W<V?-1:W>V?1:0}equals(C){if(C.type===this.type){const W=this.regexp?this.regexp.source:"",V=C.regexp?C.regexp.source:"";return this.key===C.key&&W===V}return!1}substituteConstants(){return this}evaluate(C){const W=C.getValue(this.key);return this.regexp?this.regexp.test(W):!1}serialize(){const C=this.regexp?`/${this.regexp.source}/${this.regexp.flags}`:"/invalid/";return`${this.key} =~ ${C}`}keys(){return[this.key]}negate(){return this.negated||(this.negated=ContextKeyNotRegexExpr.create(this)),this.negated}}class ContextKeyNotRegexExpr{static create(C){return new ContextKeyNotRegexExpr(C)}constructor(C){this._actual=C,this.type=8}cmp(C){return C.type!==this.type?this.type-C.type:this._actual.cmp(C._actual)}equals(C){return C.type===this.type?this._actual.equals(C._actual):!1}substituteConstants(){return this}evaluate(C){return!this._actual.evaluate(C)}serialize(){return`!(${this._actual.serialize()})`}keys(){return this._actual.keys()}negate(){return this._actual}}function eliminateConstantsInArray(K){let C=null;for(let W=0,V=K.length;W<V;W++){const U=K[W].substituteConstants();if(K[W]!==U&&C===null){C=[];for(let G=0;G<W;G++)C[G]=K[G]}C!==null&&(C[W]=U)}return C===null?K:C}class ContextKeyAndExpr{static create(C,W,V){return ContextKeyAndExpr._normalizeArr(C,W,V)}constructor(C,W){this.expr=C,this.negated=W,this.type=6}cmp(C){if(C.type!==this.type)return this.type-C.type;if(this.expr.length<C.expr.length)return-1;if(this.expr.length>C.expr.length)return 1;for(let W=0,V=this.expr.length;W<V;W++){const U=cmp(this.expr[W],C.expr[W]);if(U!==0)return U}return 0}equals(C){if(C.type===this.type){if(this.expr.length!==C.expr.length)return!1;for(let W=0,V=this.expr.length;W<V;W++)if(!this.expr[W].equals(C.expr[W]))return!1;return!0}return!1}substituteConstants(){const C=eliminateConstantsInArray(this.expr);return C===this.expr?this:ContextKeyAndExpr.create(C,this.negated,!1)}evaluate(C){for(let W=0,V=this.expr.length;W<V;W++)if(!this.expr[W].evaluate(C))return!1;return!0}static _normalizeArr(C,W,V){const U=[];let G=!1;for(const Z of C)if(Z){if(Z.type===1){G=!0;continue}if(Z.type===0)return ContextKeyFalseExpr.INSTANCE;if(Z.type===6){U.push(...Z.expr);continue}U.push(Z)}if(U.length===0&&G)return ContextKeyTrueExpr.INSTANCE;if(U.length!==0){if(U.length===1)return U[0];U.sort(cmp);for(let Z=1;Z<U.length;Z++)U[Z-1].equals(U[Z])&&(U.splice(Z,1),Z--);if(U.length===1)return U[0];for(;U.length>1;){const Z=U[U.length-1];if(Z.type!==9)break;U.pop();const X=U.pop(),Q=U.length===0,J=ContextKeyOrExpr.create(Z.expr.map(ee=>ContextKeyAndExpr.create([ee,X],null,V)),null,Q);J&&(U.push(J),U.sort(cmp))}if(U.length===1)return U[0];if(V){for(let Z=0;Z<U.length;Z++)for(let X=Z+1;X<U.length;X++)if(U[Z].negate().equals(U[X]))return ContextKeyFalseExpr.INSTANCE;if(U.length===1)return U[0]}return new ContextKeyAndExpr(U,W)}}serialize(){return this.expr.map(C=>C.serialize()).join(" && ")}keys(){const C=[];for(const W of this.expr)C.push(...W.keys());return C}negate(){if(!this.negated){const C=[];for(const W of this.expr)C.push(W.negate());this.negated=ContextKeyOrExpr.create(C,this,!0)}return this.negated}}class ContextKeyOrExpr{static create(C,W,V){return ContextKeyOrExpr._normalizeArr(C,W,V)}constructor(C,W){this.expr=C,this.negated=W,this.type=9}cmp(C){if(C.type!==this.type)return this.type-C.type;if(this.expr.length<C.expr.length)return-1;if(this.expr.length>C.expr.length)return 1;for(let W=0,V=this.expr.length;W<V;W++){const U=cmp(this.expr[W],C.expr[W]);if(U!==0)return U}return 0}equals(C){if(C.type===this.type){if(this.expr.length!==C.expr.length)return!1;for(let W=0,V=this.expr.length;W<V;W++)if(!this.expr[W].equals(C.expr[W]))return!1;return!0}return!1}substituteConstants(){const C=eliminateConstantsInArray(this.expr);return C===this.expr?this:ContextKeyOrExpr.create(C,this.negated,!1)}evaluate(C){for(let W=0,V=this.expr.length;W<V;W++)if(this.expr[W].evaluate(C))return!0;return!1}static _normalizeArr(C,W,V){let U=[],G=!1;if(C){for(let Z=0,X=C.length;Z<X;Z++){const Q=C[Z];if(Q){if(Q.type===0){G=!0;continue}if(Q.type===1)return ContextKeyTrueExpr.INSTANCE;if(Q.type===9){U=U.concat(Q.expr);continue}U.push(Q)}}if(U.length===0&&G)return ContextKeyFalseExpr.INSTANCE;U.sort(cmp)}if(U.length!==0){if(U.length===1)return U[0];for(let Z=1;Z<U.length;Z++)U[Z-1].equals(U[Z])&&(U.splice(Z,1),Z--);if(U.length===1)return U[0];if(V){for(let Z=0;Z<U.length;Z++)for(let X=Z+1;X<U.length;X++)if(U[Z].negate().equals(U[X]))return ContextKeyTrueExpr.INSTANCE;if(U.length===1)return U[0]}return new ContextKeyOrExpr(U,W)}}serialize(){return this.expr.map(C=>C.serialize()).join(" || ")}keys(){const C=[];for(const W of this.expr)C.push(...W.keys());return C}negate(){if(!this.negated){const C=[];for(const W of this.expr)C.push(W.negate());for(;C.length>1;){const W=C.shift(),V=C.shift(),U=[];for(const G of getTerminals(W))for(const Z of getTerminals(V))U.push(ContextKeyAndExpr.create([G,Z],null,!1));C.unshift(ContextKeyOrExpr.create(U,null,!1))}this.negated=ContextKeyOrExpr.create(C,this,!0)}return this.negated}}class RawContextKey extends ContextKeyDefinedExpr{static all(){return RawContextKey._info.values()}constructor(C,W,V){super(C,null),this._defaultValue=W,typeof V=="object"?RawContextKey._info.push(Object.assign(Object.assign({},V),{key:C})):V!==!0&&RawContextKey._info.push({key:C,description:V,type:W!=null?typeof W:void 0})}bindTo(C){return C.createKey(this.key,this._defaultValue)}getValue(C){return C.getContextKeyValue(this.key)}toNegated(){return this.negate()}isEqualTo(C){return ContextKeyEqualsExpr.create(this.key,C)}}RawContextKey._info=[];const IContextKeyService=createDecorator("contextKeyService");function cmp1(K,C){return K<C?-1:K>C?1:0}function cmp2(K,C,W,V){return K<W?-1:K>W?1:C<V?-1:C>V?1:0}function implies(K,C){if(K.type===0||C.type===1)return!0;if(K.type===9)return C.type===9?allElementsIncluded(K.expr,C.expr):!1;if(C.type===9){for(const W of C.expr)if(implies(K,W))return!0;return!1}if(K.type===6){if(C.type===6)return allElementsIncluded(C.expr,K.expr);for(const W of K.expr)if(implies(W,C))return!0;return!1}return K.equals(C)}function allElementsIncluded(K,C){let W=0,V=0;for(;W<K.length&&V<C.length;){const U=K[W].cmp(C[V]);if(U<0)return!1;U===0&&W++,V++}return W===K.length}function getTerminals(K){return K.type===9?K.expr:[K]}function decodeKeybinding(K,C){if(typeof K=="number"){if(K===0)return null;const W=(K&65535)>>>0,V=(K&4294901760)>>>16;return V!==0?new Keybinding([createSimpleKeybinding(W,C),createSimpleKeybinding(V,C)]):new Keybinding([createSimpleKeybinding(W,C)])}else{const W=[];for(let V=0;V<K.length;V++)W.push(createSimpleKeybinding(K[V],C));return new Keybinding(W)}}function createSimpleKeybinding(K,C){const W=!!(K&2048),V=!!(K&256),U=C===2?V:W,G=!!(K&1024),Z=!!(K&512),X=C===2?W:V,Q=K&255;return new KeyCodeChord(U,G,Z,X,Q)}class KeyCodeChord{constructor(C,W,V,U,G){this.ctrlKey=C,this.shiftKey=W,this.altKey=V,this.metaKey=U,this.keyCode=G}equals(C){return C instanceof KeyCodeChord&&this.ctrlKey===C.ctrlKey&&this.shiftKey===C.shiftKey&&this.altKey===C.altKey&&this.metaKey===C.metaKey&&this.keyCode===C.keyCode}isModifierKey(){return this.keyCode===0||this.keyCode===5||this.keyCode===57||this.keyCode===6||this.keyCode===4}isDuplicateModifierCase(){return this.ctrlKey&&this.keyCode===5||this.shiftKey&&this.keyCode===4||this.altKey&&this.keyCode===6||this.metaKey&&this.keyCode===57}}class Keybinding{constructor(C){if(C.length===0)throw illegalArgument("chords");this.chords=C}}class ResolvedChord{constructor(C,W,V,U,G,Z){this.ctrlKey=C,this.shiftKey=W,this.altKey=V,this.metaKey=U,this.keyLabel=G,this.keyAriaLabel=Z}}class ResolvedKeybinding{}function ok(K,C){if(!K)throw new Error(C?`Assertion failed (${C})`:"Assertion Failed")}function assertNever(K,C="Unreachable"){throw new Error(C)}function assertFn(K){if(!K()){debugger;K(),onUnexpectedError(new BugIndicatingError("Assertion Failed"))}}function checkAdjacentItems(K,C){let W=0;for(;W<K.length-1;){const V=K[W],U=K[W+1];if(!C(V,U))return!1;W++}return!0}class RegistryImpl{constructor(){this.data=new Map}add(C,W){ok(isString$3(C)),ok(isObject$2(W)),ok(!this.data.has(C),"There is already an extension with this id"),this.data.set(C,W)}as(C){return this.data.get(C)||null}}const Registry=new RegistryImpl;class KeybindingsRegistryImpl{constructor(){this._coreKeybindings=new LinkedList,this._extensionKeybindings=[],this._cachedMergedKeybindings=null}static bindToCurrentPlatform(C){if(OS===1){if(C&&C.win)return C.win}else if(OS===2){if(C&&C.mac)return C.mac}else if(C&&C.linux)return C.linux;return C}registerKeybindingRule(C){const W=KeybindingsRegistryImpl.bindToCurrentPlatform(C),V=new DisposableStore;if(W&&W.primary){const U=decodeKeybinding(W.primary,OS);U&&V.add(this._registerDefaultKeybinding(U,C.id,C.args,C.weight,0,C.when))}if(W&&Array.isArray(W.secondary))for(let U=0,G=W.secondary.length;U<G;U++){const Z=W.secondary[U],X=decodeKeybinding(Z,OS);X&&V.add(this._registerDefaultKeybinding(X,C.id,C.args,C.weight,-U-1,C.when))}return V}registerCommandAndKeybindingRule(C){return combinedDisposable(this.registerKeybindingRule(C),CommandsRegistry.registerCommand(C))}_registerDefaultKeybinding(C,W,V,U,G,Z){const X=this._coreKeybindings.push({keybinding:C,command:W,commandArgs:V,when:Z,weight1:U,weight2:G,extensionId:null,isBuiltinExtension:!1});return this._cachedMergedKeybindings=null,toDisposable(()=>{X(),this._cachedMergedKeybindings=null})}getDefaultKeybindings(){return this._cachedMergedKeybindings||(this._cachedMergedKeybindings=Array.from(this._coreKeybindings).concat(this._extensionKeybindings),this._cachedMergedKeybindings.sort(sorter)),this._cachedMergedKeybindings.slice(0)}}const KeybindingsRegistry=new KeybindingsRegistryImpl,Extensions$9={EditorModes:"platform.keybindingsRegistry"};Registry.add(Extensions$9.EditorModes,KeybindingsRegistry);function sorter(K,C){if(K.weight1!==C.weight1)return K.weight1-C.weight1;if(K.command&&C.command){if(K.command<C.command)return-1;if(K.command>C.command)return 1}return K.weight2-C.weight2}var __decorate$2b=globalThis&&globalThis.__decorate||function(K,C,W,V){var U=arguments.length,G=U<3?C:V===null?V=Object.getOwnPropertyDescriptor(C,W):V,Z;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")G=Reflect.decorate(K,C,W,V);else for(var X=K.length-1;X>=0;X--)(Z=K[X])&&(G=(U<3?Z(G):U>3?Z(C,W,G):Z(C,W))||G);return U>3&&G&&Object.defineProperty(C,W,G),G},__param$24=globalThis&&globalThis.__param||function(K,C){return function(W,V){C(W,V,K)}},__rest=globalThis&&globalThis.__rest||function(K,C){var W={};for(var V in K)Object.prototype.hasOwnProperty.call(K,V)&&C.indexOf(V)<0&&(W[V]=K[V]);if(K!=null&&typeof Object.getOwnPropertySymbols=="function")for(var U=0,V=Object.getOwnPropertySymbols(K);U<V.length;U++)C.indexOf(V[U])<0&&Object.prototype.propertyIsEnumerable.call(K,V[U])&&(W[V[U]]=K[V[U]]);return W},MenuItemAction_1;function isIMenuItem(K){return K.command!==void 0}function isISubmenuItem(K){return K.submenu!==void 0}class MenuId{constructor(C){if(MenuId._instances.has(C))throw new TypeError(`MenuId with identifier '${C}' already exists. Use MenuId.for(ident) or a unique identifier`);MenuId._instances.set(C,this),this.id=C}}MenuId._instances=new Map;MenuId.CommandPalette=new MenuId("CommandPalette");MenuId.DebugBreakpointsContext=new MenuId("DebugBreakpointsContext");MenuId.DebugCallStackContext=new MenuId("DebugCallStackContext");MenuId.DebugConsoleContext=new MenuId("DebugConsoleContext");MenuId.DebugVariablesContext=new MenuId("DebugVariablesContext");MenuId.DebugWatchContext=new MenuId("DebugWatchContext");MenuId.DebugToolBar=new MenuId("DebugToolBar");MenuId.DebugToolBarStop=new MenuId("DebugToolBarStop");MenuId.EditorContext=new MenuId("EditorContext");MenuId.SimpleEditorContext=new MenuId("SimpleEditorContext");MenuId.EditorContent=new MenuId("EditorContent");MenuId.EditorLineNumberContext=new MenuId("EditorLineNumberContext");MenuId.EditorContextCopy=new MenuId("EditorContextCopy");MenuId.EditorContextPeek=new MenuId("EditorContextPeek");MenuId.EditorContextShare=new MenuId("EditorContextShare");MenuId.EditorTitle=new MenuId("EditorTitle");MenuId.EditorTitleRun=new MenuId("EditorTitleRun");MenuId.EditorTitleContext=new MenuId("EditorTitleContext");MenuId.EditorTitleContextShare=new MenuId("EditorTitleContextShare");MenuId.EmptyEditorGroup=new MenuId("EmptyEditorGroup");MenuId.EmptyEditorGroupContext=new MenuId("EmptyEditorGroupContext");MenuId.EditorTabsBarContext=new MenuId("EditorTabsBarContext");MenuId.ExplorerContext=new MenuId("ExplorerContext");MenuId.ExplorerContextShare=new MenuId("ExplorerContextShare");MenuId.ExtensionContext=new MenuId("ExtensionContext");MenuId.GlobalActivity=new MenuId("GlobalActivity");MenuId.CommandCenter=new MenuId("CommandCenter");MenuId.CommandCenterCenter=new MenuId("CommandCenterCenter");MenuId.LayoutControlMenuSubmenu=new MenuId("LayoutControlMenuSubmenu");MenuId.LayoutControlMenu=new MenuId("LayoutControlMenu");MenuId.MenubarMainMenu=new MenuId("MenubarMainMenu");MenuId.MenubarAppearanceMenu=new MenuId("MenubarAppearanceMenu");MenuId.MenubarDebugMenu=new MenuId("MenubarDebugMenu");MenuId.MenubarEditMenu=new MenuId("MenubarEditMenu");MenuId.MenubarCopy=new MenuId("MenubarCopy");MenuId.MenubarFileMenu=new MenuId("MenubarFileMenu");MenuId.MenubarGoMenu=new MenuId("MenubarGoMenu");MenuId.MenubarHelpMenu=new MenuId("MenubarHelpMenu");MenuId.MenubarLayoutMenu=new MenuId("MenubarLayoutMenu");MenuId.MenubarNewBreakpointMenu=new MenuId("MenubarNewBreakpointMenu");MenuId.PanelAlignmentMenu=new MenuId("PanelAlignmentMenu");MenuId.PanelPositionMenu=new MenuId("PanelPositionMenu");MenuId.MenubarPreferencesMenu=new MenuId("MenubarPreferencesMenu");MenuId.MenubarRecentMenu=new MenuId("MenubarRecentMenu");MenuId.MenubarSelectionMenu=new MenuId("MenubarSelectionMenu");MenuId.MenubarShare=new MenuId("MenubarShare");MenuId.MenubarSwitchEditorMenu=new MenuId("MenubarSwitchEditorMenu");MenuId.MenubarSwitchGroupMenu=new MenuId("MenubarSwitchGroupMenu");MenuId.MenubarTerminalMenu=new MenuId("MenubarTerminalMenu");MenuId.MenubarViewMenu=new MenuId("MenubarViewMenu");MenuId.MenubarHomeMenu=new MenuId("MenubarHomeMenu");MenuId.OpenEditorsContext=new MenuId("OpenEditorsContext");MenuId.OpenEditorsContextShare=new MenuId("OpenEditorsContextShare");MenuId.ProblemsPanelContext=new MenuId("ProblemsPanelContext");MenuId.SCMChangeContext=new MenuId("SCMChangeContext");MenuId.SCMResourceContext=new MenuId("SCMResourceContext");MenuId.SCMResourceContextShare=new MenuId("SCMResourceContextShare");MenuId.SCMResourceFolderContext=new MenuId("SCMResourceFolderContext");MenuId.SCMResourceGroupContext=new MenuId("SCMResourceGroupContext");MenuId.SCMSourceControl=new MenuId("SCMSourceControl");MenuId.SCMTitle=new MenuId("SCMTitle");MenuId.SearchContext=new MenuId("SearchContext");MenuId.SearchActionMenu=new MenuId("SearchActionContext");MenuId.StatusBarWindowIndicatorMenu=new MenuId("StatusBarWindowIndicatorMenu");MenuId.StatusBarRemoteIndicatorMenu=new MenuId("StatusBarRemoteIndicatorMenu");MenuId.StickyScrollContext=new MenuId("StickyScrollContext");MenuId.TestItem=new MenuId("TestItem");MenuId.TestItemGutter=new MenuId("TestItemGutter");MenuId.TestMessageContext=new MenuId("TestMessageContext");MenuId.TestMessageContent=new MenuId("TestMessageContent");MenuId.TestPeekElement=new MenuId("TestPeekElement");MenuId.TestPeekTitle=new MenuId("TestPeekTitle");MenuId.TouchBarContext=new MenuId("TouchBarContext");MenuId.TitleBarContext=new MenuId("TitleBarContext");MenuId.TitleBarTitleContext=new MenuId("TitleBarTitleContext");MenuId.TunnelContext=new MenuId("TunnelContext");MenuId.TunnelPrivacy=new MenuId("TunnelPrivacy");MenuId.TunnelProtocol=new MenuId("TunnelProtocol");MenuId.TunnelPortInline=new MenuId("TunnelInline");MenuId.TunnelTitle=new MenuId("TunnelTitle");MenuId.TunnelLocalAddressInline=new MenuId("TunnelLocalAddressInline");MenuId.TunnelOriginInline=new MenuId("TunnelOriginInline");MenuId.ViewItemContext=new MenuId("ViewItemContext");MenuId.ViewContainerTitle=new MenuId("ViewContainerTitle");MenuId.ViewContainerTitleContext=new MenuId("ViewContainerTitleContext");MenuId.ViewTitle=new MenuId("ViewTitle");MenuId.ViewTitleContext=new MenuId("ViewTitleContext");MenuId.CommentEditorActions=new MenuId("CommentEditorActions");MenuId.CommentThreadTitle=new MenuId("CommentThreadTitle");MenuId.CommentThreadActions=new MenuId("CommentThreadActions");MenuId.CommentThreadAdditionalActions=new MenuId("CommentThreadAdditionalActions");MenuId.CommentThreadTitleContext=new MenuId("CommentThreadTitleContext");MenuId.CommentThreadCommentContext=new MenuId("CommentThreadCommentContext");MenuId.CommentTitle=new MenuId("CommentTitle");MenuId.CommentActions=new MenuId("CommentActions");MenuId.InteractiveToolbar=new MenuId("InteractiveToolbar");MenuId.InteractiveCellTitle=new MenuId("InteractiveCellTitle");MenuId.InteractiveCellDelete=new MenuId("InteractiveCellDelete");MenuId.InteractiveCellExecute=new MenuId("InteractiveCellExecute");MenuId.InteractiveInputExecute=new MenuId("InteractiveInputExecute");MenuId.NotebookToolbar=new MenuId("NotebookToolbar");MenuId.NotebookStickyScrollContext=new MenuId("NotebookStickyScrollContext");MenuId.NotebookCellTitle=new MenuId("NotebookCellTitle");MenuId.NotebookCellDelete=new MenuId("NotebookCellDelete");MenuId.NotebookCellInsert=new MenuId("NotebookCellInsert");MenuId.NotebookCellBetween=new MenuId("NotebookCellBetween");MenuId.NotebookCellListTop=new MenuId("NotebookCellTop");MenuId.NotebookCellExecute=new MenuId("NotebookCellExecute");MenuId.NotebookCellExecutePrimary=new MenuId("NotebookCellExecutePrimary");MenuId.NotebookDiffCellInputTitle=new MenuId("NotebookDiffCellInputTitle");MenuId.NotebookDiffCellMetadataTitle=new MenuId("NotebookDiffCellMetadataTitle");MenuId.NotebookDiffCellOutputsTitle=new MenuId("NotebookDiffCellOutputsTitle");MenuId.NotebookOutputToolbar=new MenuId("NotebookOutputToolbar");MenuId.NotebookEditorLayoutConfigure=new MenuId("NotebookEditorLayoutConfigure");MenuId.NotebookKernelSource=new MenuId("NotebookKernelSource");MenuId.BulkEditTitle=new MenuId("BulkEditTitle");MenuId.BulkEditContext=new MenuId("BulkEditContext");MenuId.TimelineItemContext=new MenuId("TimelineItemContext");MenuId.TimelineTitle=new MenuId("TimelineTitle");MenuId.TimelineTitleContext=new MenuId("TimelineTitleContext");MenuId.TimelineFilterSubMenu=new MenuId("TimelineFilterSubMenu");MenuId.AccountsContext=new MenuId("AccountsContext");MenuId.PanelTitle=new MenuId("PanelTitle");MenuId.AuxiliaryBarTitle=new MenuId("AuxiliaryBarTitle");MenuId.TerminalInstanceContext=new MenuId("TerminalInstanceContext");MenuId.TerminalEditorInstanceContext=new MenuId("TerminalEditorInstanceContext");MenuId.TerminalNewDropdownContext=new MenuId("TerminalNewDropdownContext");MenuId.TerminalTabContext=new MenuId("TerminalTabContext");MenuId.TerminalTabEmptyAreaContext=new MenuId("TerminalTabEmptyAreaContext");MenuId.WebviewContext=new MenuId("WebviewContext");MenuId.InlineCompletionsActions=new MenuId("InlineCompletionsActions");MenuId.NewFile=new MenuId("NewFile");MenuId.MergeInput1Toolbar=new MenuId("MergeToolbar1Toolbar");MenuId.MergeInput2Toolbar=new MenuId("MergeToolbar2Toolbar");MenuId.MergeBaseToolbar=new MenuId("MergeBaseToolbar");MenuId.MergeInputResultToolbar=new MenuId("MergeToolbarResultToolbar");MenuId.InlineSuggestionToolbar=new MenuId("InlineSuggestionToolbar");MenuId.ChatContext=new MenuId("ChatContext");MenuId.ChatCodeBlock=new MenuId("ChatCodeblock");MenuId.ChatMessageTitle=new MenuId("ChatMessageTitle");MenuId.ChatExecute=new MenuId("ChatExecute");MenuId.ChatInputSide=new MenuId("ChatInputSide");MenuId.AccessibleView=new MenuId("AccessibleView");const IMenuService=createDecorator("menuService");class MenuRegistryChangeEvent{static for(C){let W=this._all.get(C);return W||(W=new MenuRegistryChangeEvent(C),this._all.set(C,W)),W}static merge(C){const W=new Set;for(const V of C)V instanceof MenuRegistryChangeEvent&&W.add(V.id);return W}constructor(C){this.id=C,this.has=W=>W===C}}MenuRegistryChangeEvent._all=new Map;const MenuRegistry=new class{constructor(){this._commands=new Map,this._menuItems=new Map,this._onDidChangeMenu=new MicrotaskEmitter({merge:MenuRegistryChangeEvent.merge}),this.onDidChangeMenu=this._onDidChangeMenu.event}addCommand(K){return this._commands.set(K.id,K),this._onDidChangeMenu.fire(MenuRegistryChangeEvent.for(MenuId.CommandPalette)),toDisposable(()=>{this._commands.delete(K.id)&&this._onDidChangeMenu.fire(MenuRegistryChangeEvent.for(MenuId.CommandPalette))})}getCommand(K){return this._commands.get(K)}getCommands(){const K=new Map;return this._commands.forEach((C,W)=>K.set(W,C)),K}appendMenuItem(K,C){let W=this._menuItems.get(K);W||(W=new LinkedList,this._menuItems.set(K,W));const V=W.push(C);return this._onDidChangeMenu.fire(MenuRegistryChangeEvent.for(K)),toDisposable(()=>{V(),this._onDidChangeMenu.fire(MenuRegistryChangeEvent.for(K))})}appendMenuItems(K){const C=new DisposableStore;for(const{id:W,item:V}of K)C.add(this.appendMenuItem(W,V));return C}getMenuItems(K){let C;return this._menuItems.has(K)?C=[...this._menuItems.get(K)]:C=[],K===MenuId.CommandPalette&&this._appendImplicitItems(C),C}_appendImplicitItems(K){const C=new Set;for(const W of K)isIMenuItem(W)&&(C.add(W.command.id),W.alt&&C.add(W.alt.id));this._commands.forEach((W,V)=>{C.has(V)||K.push({command:W})})}};class SubmenuItemAction extends SubmenuAction{constructor(C,W,V){super(`submenuitem.${C.submenu.id}`,typeof C.title=="string"?C.title:C.title.value,V,"submenu"),this.item=C,this.hideActions=W}}let MenuItemAction=MenuItemAction_1=class{static label(C,W){return W!=null&&W.renderShortTitle&&C.shortTitle?typeof C.shortTitle=="string"?C.shortTitle:C.shortTitle.value:typeof C.title=="string"?C.title:C.title.value}constructor(C,W,V,U,G,Z){var X,Q;this.hideActions=U,this._commandService=Z,this.id=C.id,this.label=MenuItemAction_1.label(C,V),this.tooltip=(Q=typeof C.tooltip=="string"?C.tooltip:(X=C.tooltip)===null||X===void 0?void 0:X.value)!==null&&Q!==void 0?Q:"",this.enabled=!C.precondition||G.contextMatchesRules(C.precondition),this.checked=void 0;let J;if(C.toggled){const ee=C.toggled.condition?C.toggled:{condition:C.toggled};this.checked=G.contextMatchesRules(ee.condition),this.checked&&ee.tooltip&&(this.tooltip=typeof ee.tooltip=="string"?ee.tooltip:ee.tooltip.value),this.checked&&ThemeIcon.isThemeIcon(ee.icon)&&(J=ee.icon),this.checked&&ee.title&&(this.label=typeof ee.title=="string"?ee.title:ee.title.value)}J||(J=ThemeIcon.isThemeIcon(C.icon)?C.icon:void 0),this.item=C,this.alt=W?new MenuItemAction_1(W,void 0,V,U,G,Z):void 0,this._options=V,this.class=J&&ThemeIcon.asClassName(J)}run(...C){var W,V;let U=[];return!((W=this._options)===null||W===void 0)&&W.arg&&(U=[...U,this._options.arg]),!((V=this._options)===null||V===void 0)&&V.shouldForwardArgs&&(U=[...U,...C]),this._commandService.executeCommand(this.id,...U)}};MenuItemAction=MenuItemAction_1=__decorate$2b([__param$24(4,IContextKeyService),__param$24(5,ICommandService)],MenuItemAction);class Action2{constructor(C){this.desc=C}}function registerAction2(K){const C=new DisposableStore,W=new K,V=W.desc,{f1:U,menu:G,keybinding:Z,description:X}=V,Q=__rest(V,["f1","menu","keybinding","description"]);if(C.add(CommandsRegistry.registerCommand({id:Q.id,handler:(J,...ee)=>W.run(J,...ee),description:X})),Array.isArray(G))for(const J of G)C.add(MenuRegistry.appendMenuItem(J.id,Object.assign({command:Object.assign(Object.assign({},Q),{precondition:J.precondition===null?void 0:Q.precondition})},J)));else G&&C.add(MenuRegistry.appendMenuItem(G.id,Object.assign({command:Object.assign(Object.assign({},Q),{precondition:G.precondition===null?void 0:Q.precondition})},G)));if(U&&(C.add(MenuRegistry.appendMenuItem(MenuId.CommandPalette,{command:Q,when:Q.precondition})),C.add(MenuRegistry.addCommand(Q))),Array.isArray(Z))for(const J of Z)C.add(KeybindingsRegistry.registerKeybindingRule(Object.assign(Object.assign({},J),{id:Q.id,when:Q.precondition?ContextKeyExpr.and(Q.precondition,J.when):J.when})));else Z&&C.add(KeybindingsRegistry.registerKeybindingRule(Object.assign(Object.assign({},Z),{id:Q.id,when:Q.precondition?ContextKeyExpr.and(Q.precondition,Z.when):Z.when})));return C}const ITelemetryService=createDecorator("telemetryService"),ILogService=createDecorator("logService");var LogLevel;(function(K){K[K.Off=0]="Off",K[K.Trace=1]="Trace",K[K.Debug=2]="Debug",K[K.Info=3]="Info",K[K.Warning=4]="Warning",K[K.Error=5]="Error"})(LogLevel||(LogLevel={}));const DEFAULT_LOG_LEVEL=LogLevel.Info;class AbstractLogger extends Disposable{constructor(){super(...arguments),this.level=DEFAULT_LOG_LEVEL,this._onDidChangeLogLevel=this._register(new Emitter$1),this.onDidChangeLogLevel=this._onDidChangeLogLevel.event}setLevel(C){this.level!==C&&(this.level=C,this._onDidChangeLogLevel.fire(this.level))}getLevel(){return this.level}checkLogLevel(C){return this.level!==LogLevel.Off&&this.level<=C}}class ConsoleLogger extends AbstractLogger{constructor(C=DEFAULT_LOG_LEVEL,W=!0){super(),this.useColors=W,this.setLevel(C)}trace(C,...W){this.checkLogLevel(LogLevel.Trace)&&(this.useColors?console.log("%cTRACE","color: #888",C,...W):console.log(C,...W))}debug(C,...W){this.checkLogLevel(LogLevel.Debug)&&(this.useColors?console.log("%cDEBUG","background: #eee; color: #888",C,...W):console.log(C,...W))}info(C,...W){this.checkLogLevel(LogLevel.Info)&&(this.useColors?console.log("%c INFO","color: #33f",C,...W):console.log(C,...W))}warn(C,...W){this.checkLogLevel(LogLevel.Warning)&&(this.useColors?console.log("%c WARN","color: #993",C,...W):console.log(C,...W))}error(C,...W){this.checkLogLevel(LogLevel.Error)&&(this.useColors?console.log("%c  ERR","color: #f33",C,...W):console.error(C,...W))}dispose(){}}class MultiplexLogger extends AbstractLogger{constructor(C){super(),this.loggers=C,C.length&&this.setLevel(C[0].getLevel())}setLevel(C){for(const W of this.loggers)W.setLevel(C);super.setLevel(C)}trace(C,...W){for(const V of this.loggers)V.trace(C,...W)}debug(C,...W){for(const V of this.loggers)V.debug(C,...W)}info(C,...W){for(const V of this.loggers)V.info(C,...W)}warn(C,...W){for(const V of this.loggers)V.warn(C,...W)}error(C,...W){for(const V of this.loggers)V.error(C,...W)}dispose(){for(const C of this.loggers)C.dispose()}}function LogLevelToString(K){switch(K){case LogLevel.Trace:return"trace";case LogLevel.Debug:return"debug";case LogLevel.Info:return"info";case LogLevel.Warning:return"warn";case LogLevel.Error:return"error";case LogLevel.Off:return"off"}}new RawContextKey("logLevel",LogLevelToString(LogLevel.Info));const BrowserFeatures={clipboard:{writeText:isNative||document.queryCommandSupported&&document.queryCommandSupported("copy")||!!(navigator&&navigator.clipboard&&navigator.clipboard.writeText),readText:isNative||!!(navigator&&navigator.clipboard&&navigator.clipboard.readText)},keyboard:(()=>isNative||isStandalone()?0:navigator.keyboard||isSafari?1:2)(),touch:"ontouchstart"in window||navigator.maxTouchPoints>0,pointerEvents:window.PointerEvent&&("ontouchstart"in window||window.navigator.maxTouchPoints>0||navigator.maxTouchPoints>0)};function extractKeyCode(K){if(K.charCode){const W=String.fromCharCode(K.charCode).toUpperCase();return KeyCodeUtils.fromString(W)}const C=K.keyCode;if(C===3)return 7;if(isFirefox)switch(C){case 59:return 85;case 60:if(isLinux)return 97;break;case 61:return 86;case 107:return 109;case 109:return 111;case 173:return 88;case 224:if(isMacintosh)return 57;break}else if(isWebKit){if(isMacintosh&&C===93)return 57;if(!isMacintosh&&C===92)return 57}return EVENT_KEY_CODE_MAP[C]||0}const ctrlKeyMod$1=isMacintosh?256:2048,altKeyMod=512,shiftKeyMod=1024,metaKeyMod=isMacintosh?2048:256;class StandardKeyboardEvent{constructor(C){this._standardKeyboardEventBrand=!0;const W=C;this.browserEvent=W,this.target=W.target,this.ctrlKey=W.ctrlKey,this.shiftKey=W.shiftKey,this.altKey=W.altKey,this.metaKey=W.metaKey,this.altGraphKey=W.getModifierState("AltGraph"),this.keyCode=extractKeyCode(W),this.code=W.code,this.ctrlKey=this.ctrlKey||this.keyCode===5,this.altKey=this.altKey||this.keyCode===6,this.shiftKey=this.shiftKey||this.keyCode===4,this.metaKey=this.metaKey||this.keyCode===57,this._asKeybinding=this._computeKeybinding(),this._asKeyCodeChord=this._computeKeyCodeChord()}preventDefault(){this.browserEvent&&this.browserEvent.preventDefault&&this.browserEvent.preventDefault()}stopPropagation(){this.browserEvent&&this.browserEvent.stopPropagation&&this.browserEvent.stopPropagation()}toKeyCodeChord(){return this._asKeyCodeChord}equals(C){return this._asKeybinding===C}_computeKeybinding(){let C=0;this.keyCode!==5&&this.keyCode!==4&&this.keyCode!==6&&this.keyCode!==57&&(C=this.keyCode);let W=0;return this.ctrlKey&&(W|=ctrlKeyMod$1),this.altKey&&(W|=altKeyMod),this.shiftKey&&(W|=shiftKeyMod),this.metaKey&&(W|=metaKeyMod),W|=C,W}_computeKeyCodeChord(){let C=0;return this.keyCode!==5&&this.keyCode!==4&&this.keyCode!==6&&this.keyCode!==57&&(C=this.keyCode),new KeyCodeChord(this.ctrlKey,this.shiftKey,this.altKey,this.metaKey,C)}}let hasDifferentOriginAncestorFlag=!1,sameOriginWindowChainCache=null;function getParentWindowIfSameOrigin(K){if(!K.parent||K.parent===K)return null;try{const C=K.location,W=K.parent.location;if(C.origin!=="null"&&W.origin!=="null"&&C.origin!==W.origin)return hasDifferentOriginAncestorFlag=!0,null}catch{return hasDifferentOriginAncestorFlag=!0,null}return K.parent}class IframeUtils{static getSameOriginWindowChain(){if(!sameOriginWindowChainCache){sameOriginWindowChainCache=[];let C=window,W;do W=getParentWindowIfSameOrigin(C),W?sameOriginWindowChainCache.push({window:C,iframeElement:C.frameElement||null}):sameOriginWindowChainCache.push({window:C,iframeElement:null}),C=W;while(C)}return sameOriginWindowChainCache.slice(0)}static getPositionOfChildWindowRelativeToAncestorWindow(C,W){if(!W||C===W)return{top:0,left:0};let V=0,U=0;const G=this.getSameOriginWindowChain();for(const Z of G){if(V+=Z.window.scrollY,U+=Z.window.scrollX,Z.window===W||!Z.iframeElement)break;const X=Z.iframeElement.getBoundingClientRect();V+=X.top,U+=X.left}return{top:V,left:U}}}class StandardMouseEvent{constructor(C){this.timestamp=Date.now(),this.browserEvent=C,this.leftButton=C.button===0,this.middleButton=C.button===1,this.rightButton=C.button===2,this.buttons=C.buttons,this.target=C.target,this.detail=C.detail||1,C.type==="dblclick"&&(this.detail=2),this.ctrlKey=C.ctrlKey,this.shiftKey=C.shiftKey,this.altKey=C.altKey,this.metaKey=C.metaKey,typeof C.pageX=="number"?(this.posx=C.pageX,this.posy=C.pageY):(this.posx=C.clientX+this.target.ownerDocument.body.scrollLeft+this.target.ownerDocument.documentElement.scrollLeft,this.posy=C.clientY+this.target.ownerDocument.body.scrollTop+this.target.ownerDocument.documentElement.scrollTop);const W=IframeUtils.getPositionOfChildWindowRelativeToAncestorWindow(window,C.view);this.posx-=W.left,this.posy-=W.top}preventDefault(){this.browserEvent.preventDefault()}stopPropagation(){this.browserEvent.stopPropagation()}}class StandardWheelEvent{constructor(C,W=0,V=0){if(this.browserEvent=C||null,this.target=C?C.target||C.targetNode||C.srcElement:null,this.deltaY=V,this.deltaX=W,C){const U=C,G=C;if(typeof U.wheelDeltaY<"u")this.deltaY=U.wheelDeltaY/120;else if(typeof G.VERTICAL_AXIS<"u"&&G.axis===G.VERTICAL_AXIS)this.deltaY=-G.detail/3;else if(C.type==="wheel"){const Z=C;Z.deltaMode===Z.DOM_DELTA_LINE?isFirefox&&!isMacintosh?this.deltaY=-C.deltaY/3:this.deltaY=-C.deltaY:this.deltaY=-C.deltaY/40}if(typeof U.wheelDeltaX<"u")isSafari&&isWindows?this.deltaX=-(U.wheelDeltaX/120):this.deltaX=U.wheelDeltaX/120;else if(typeof G.HORIZONTAL_AXIS<"u"&&G.axis===G.HORIZONTAL_AXIS)this.deltaX=-C.detail/3;else if(C.type==="wheel"){const Z=C;Z.deltaMode===Z.DOM_DELTA_LINE?isFirefox&&!isMacintosh?this.deltaX=-C.deltaX/3:this.deltaX=-C.deltaX:this.deltaX=-C.deltaX/40}this.deltaY===0&&this.deltaX===0&&C.wheelDelta&&(this.deltaY=C.wheelDelta/120)}}preventDefault(){var C;(C=this.browserEvent)===null||C===void 0||C.preventDefault()}stopPropagation(){var C;(C=this.browserEvent)===null||C===void 0||C.stopPropagation()}}/*! @license DOMPurify 3.0.5 | (c) Cure53 and other contributors | Released under the Apache license 2.0 and Mozilla Public License 2.0 | github.com/cure53/DOMPurify/blob/3.0.5/LICENSE */const{entries,setPrototypeOf,isFrozen,getPrototypeOf,getOwnPropertyDescriptor}=Object;let{freeze:freeze$1,seal,create:create$1}=Object,{apply:apply$2,construct:construct$2}=typeof Reflect<"u"&&Reflect;apply$2||(apply$2=function(C,W,V){return C.apply(W,V)});freeze$1||(freeze$1=function(C){return C});seal||(seal=function(C){return C});construct$2||(construct$2=function(C,W){return new C(...W)});const arrayForEach=unapply$2(Array.prototype.forEach),arrayPop=unapply$2(Array.prototype.pop),arrayPush=unapply$2(Array.prototype.push),stringToLowerCase=unapply$2(String.prototype.toLowerCase),stringToString=unapply$2(String.prototype.toString),stringMatch=unapply$2(String.prototype.match),stringReplace=unapply$2(String.prototype.replace),stringIndexOf=unapply$2(String.prototype.indexOf),stringTrim=unapply$2(String.prototype.trim),regExpTest=unapply$2(RegExp.prototype.test),typeErrorCreate=unconstruct(TypeError);function unapply$2(K){return function(C){for(var W=arguments.length,V=new Array(W>1?W-1:0),U=1;U<W;U++)V[U-1]=arguments[U];return apply$2(K,C,V)}}function unconstruct(K){return function(){for(var C=arguments.length,W=new Array(C),V=0;V<C;V++)W[V]=arguments[V];return construct$2(K,W)}}function addToSet(K,C,W){var V;W=(V=W)!==null&&V!==void 0?V:stringToLowerCase,setPrototypeOf&&setPrototypeOf(K,null);let U=C.length;for(;U--;){let G=C[U];if(typeof G=="string"){const Z=W(G);Z!==G&&(isFrozen(C)||(C[U]=Z),G=Z)}K[G]=!0}return K}function clone$2(K){const C=create$1(null);for(const[W,V]of entries(K))C[W]=V;return C}function lookupGetter(K,C){for(;K!==null;){const V=getOwnPropertyDescriptor(K,C);if(V){if(V.get)return unapply$2(V.get);if(typeof V.value=="function")return unapply$2(V.value)}K=getPrototypeOf(K)}function W(V){return console.warn("fallback value for",V),null}return W}const html$1=freeze$1(["a","abbr","acronym","address","area","article","aside","audio","b","bdi","bdo","big","blink","blockquote","body","br","button","canvas","caption","center","cite","code","col","colgroup","content","data","datalist","dd","decorator","del","details","dfn","dialog","dir","div","dl","dt","element","em","fieldset","figcaption","figure","font","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","img","input","ins","kbd","label","legend","li","main","map","mark","marquee","menu","menuitem","meter","nav","nobr","ol","optgroup","option","output","p","picture","pre","progress","q","rp","rt","ruby","s","samp","section","select","shadow","small","source","spacer","span","strike","strong","style","sub","summary","sup","table","tbody","td","template","textarea","tfoot","th","thead","time","tr","track","tt","u","ul","var","video","wbr"]),svg$1=freeze$1(["svg","a","altglyph","altglyphdef","altglyphitem","animatecolor","animatemotion","animatetransform","circle","clippath","defs","desc","ellipse","filter","font","g","glyph","glyphref","hkern","image","line","lineargradient","marker","mask","metadata","mpath","path","pattern","polygon","polyline","radialgradient","rect","stop","style","switch","symbol","text","textpath","title","tref","tspan","view","vkern"]),svgFilters=freeze$1(["feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feDropShadow","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence"]),svgDisallowed=freeze$1(["animate","color-profile","cursor","discard","font-face","font-face-format","font-face-name","font-face-src","font-face-uri","foreignobject","hatch","hatchpath","mesh","meshgradient","meshpatch","meshrow","missing-glyph","script","set","solidcolor","unknown","use"]),mathMl$1=freeze$1(["math","menclose","merror","mfenced","mfrac","mglyph","mi","mlabeledtr","mmultiscripts","mn","mo","mover","mpadded","mphantom","mroot","mrow","ms","mspace","msqrt","mstyle","msub","msup","msubsup","mtable","mtd","mtext","mtr","munder","munderover","mprescripts"]),mathMlDisallowed=freeze$1(["maction","maligngroup","malignmark","mlongdiv","mscarries","mscarry","msgroup","mstack","msline","msrow","semantics","annotation","annotation-xml","mprescripts","none"]),text=freeze$1(["#text"]),html=freeze$1(["accept","action","align","alt","autocapitalize","autocomplete","autopictureinpicture","autoplay","background","bgcolor","border","capture","cellpadding","cellspacing","checked","cite","class","clear","color","cols","colspan","controls","controlslist","coords","crossorigin","datetime","decoding","default","dir","disabled","disablepictureinpicture","disableremoteplayback","download","draggable","enctype","enterkeyhint","face","for","headers","height","hidden","high","href","hreflang","id","inputmode","integrity","ismap","kind","label","lang","list","loading","loop","low","max","maxlength","media","method","min","minlength","multiple","muted","name","nonce","noshade","novalidate","nowrap","open","optimum","pattern","placeholder","playsinline","poster","preload","pubdate","radiogroup","readonly","rel","required","rev","reversed","role","rows","rowspan","spellcheck","scope","selected","shape","size","sizes","span","srclang","start","src","srcset","step","style","summary","tabindex","title","translate","type","usemap","valign","value","width","xmlns","slot"]),svg=freeze$1(["accent-height","accumulate","additive","alignment-baseline","ascent","attributename","attributetype","azimuth","basefrequency","baseline-shift","begin","bias","by","class","clip","clippathunits","clip-path","clip-rule","color","color-interpolation","color-interpolation-filters","color-profile","color-rendering","cx","cy","d","dx","dy","diffuseconstant","direction","display","divisor","dur","edgemode","elevation","end","fill","fill-opacity","fill-rule","filter","filterunits","flood-color","flood-opacity","font-family","font-size","font-size-adjust","font-stretch","font-style","font-variant","font-weight","fx","fy","g1","g2","glyph-name","glyphref","gradientunits","gradienttransform","height","href","id","image-rendering","in","in2","k","k1","k2","k3","k4","kerning","keypoints","keysplines","keytimes","lang","lengthadjust","letter-spacing","kernelmatrix","kernelunitlength","lighting-color","local","marker-end","marker-mid","marker-start","markerheight","markerunits","markerwidth","maskcontentunits","maskunits","max","mask","media","method","mode","min","name","numoctaves","offset","operator","opacity","order","orient","orientation","origin","overflow","paint-order","path","pathlength","patterncontentunits","patterntransform","patternunits","points","preservealpha","preserveaspectratio","primitiveunits","r","rx","ry","radius","refx","refy","repeatcount","repeatdur","restart","result","rotate","scale","seed","shape-rendering","specularconstant","specularexponent","spreadmethod","startoffset","stddeviation","stitchtiles","stop-color","stop-opacity","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke","stroke-width","style","surfacescale","systemlanguage","tabindex","targetx","targety","transform","transform-origin","text-anchor","text-decoration","text-rendering","textlength","type","u1","u2","unicode","values","viewbox","visibility","version","vert-adv-y","vert-origin-x","vert-origin-y","width","word-spacing","wrap","writing-mode","xchannelselector","ychannelselector","x","x1","x2","xmlns","y","y1","y2","z","zoomandpan"]),mathMl=freeze$1(["accent","accentunder","align","bevelled","close","columnsalign","columnlines","columnspan","denomalign","depth","dir","display","displaystyle","encoding","fence","frame","height","href","id","largeop","length","linethickness","lspace","lquote","mathbackground","mathcolor","mathsize","mathvariant","maxsize","minsize","movablelimits","notation","numalign","open","rowalign","rowlines","rowspacing","rowspan","rspace","rquote","scriptlevel","scriptminsize","scriptsizemultiplier","selection","separator","separators","stretchy","subscriptshift","supscriptshift","symmetric","voffset","width","xmlns"]),xml=freeze$1(["xlink:href","xml:id","xlink:title","xml:space","xmlns:xlink"]),MUSTACHE_EXPR=seal(/\{\{[\w\W]*|[\w\W]*\}\}/gm),ERB_EXPR=seal(/<%[\w\W]*|[\w\W]*%>/gm),TMPLIT_EXPR=seal(/\${[\w\W]*}/gm),DATA_ATTR=seal(/^data-[\-\w.\u00B7-\uFFFF]/),ARIA_ATTR=seal(/^aria-[\-\w]+$/),IS_ALLOWED_URI=seal(/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|sms|cid|xmpp):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i),IS_SCRIPT_OR_DATA=seal(/^(?:\w+script|data):/i),ATTR_WHITESPACE=seal(/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205F\u3000]/g),DOCTYPE_NAME=seal(/^html$/i);var EXPRESSIONS=Object.freeze({__proto__:null,MUSTACHE_EXPR,ERB_EXPR,TMPLIT_EXPR,DATA_ATTR,ARIA_ATTR,IS_ALLOWED_URI,IS_SCRIPT_OR_DATA,ATTR_WHITESPACE,DOCTYPE_NAME});const getGlobal=()=>typeof window>"u"?null:window,_createTrustedTypesPolicy=function(C,W){if(typeof C!="object"||typeof C.createPolicy!="function")return null;let V=null;const U="data-tt-policy-suffix";W&&W.hasAttribute(U)&&(V=W.getAttribute(U));const G="dompurify"+(V?"#"+V:"");try{return C.createPolicy(G,{createHTML(Z){return Z},createScriptURL(Z){return Z}})}catch{return console.warn("TrustedTypes policy "+G+" could not be created."),null}};function createDOMPurify(){let K=arguments.length>0&&arguments[0]!==void 0?arguments[0]:getGlobal();const C=Ze=>createDOMPurify(Ze);if(C.version="3.0.5",C.removed=[],!K||!K.document||K.document.nodeType!==9)return C.isSupported=!1,C;const W=K.document,V=W.currentScript;let{document:U}=K;const{DocumentFragment:G,HTMLTemplateElement:Z,Node:X,Element:Q,NodeFilter:J,NamedNodeMap:ee=K.NamedNodeMap||K.MozNamedAttrMap,HTMLFormElement:te,DOMParser:ie,trustedTypes:ne}=K,oe=Q.prototype,re=lookupGetter(oe,"cloneNode"),ae=lookupGetter(oe,"nextSibling"),se=lookupGetter(oe,"childNodes"),le=lookupGetter(oe,"parentNode");if(typeof Z=="function"){const Ze=U.createElement("template");Ze.content&&Ze.content.ownerDocument&&(U=Ze.content.ownerDocument)}let ce,de="";const{implementation:ue,createNodeIterator:ge,createDocumentFragment:he,getElementsByTagName:fe}=U,{importNode:pe}=W;let Se={};C.isSupported=typeof entries=="function"&&typeof le=="function"&&ue&&ue.createHTMLDocument!==void 0;const{MUSTACHE_EXPR:Le,ERB_EXPR:be,TMPLIT_EXPR:Ce,DATA_ATTR:De,ARIA_ATTR:ke,IS_SCRIPT_OR_DATA:Me,ATTR_WHITESPACE:Oe}=EXPRESSIONS;let{IS_ALLOWED_URI:Be}=EXPRESSIONS,Pe=null;const Ue=addToSet({},[...html$1,...svg$1,...svgFilters,...mathMl$1,...text]);let ze=null;const Fe=addToSet({},[...html,...svg,...mathMl,...xml]);let Ae=Object.seal(Object.create(null,{tagNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},attributeNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},allowCustomizedBuiltInElements:{writable:!0,configurable:!1,enumerable:!0,value:!1}})),ot=null,ft=null,rt=!0,Xe=!0,ct=!1,vt=!0,pt=!1,je=!1,Ct=!1,wt=!1,Lt=!1,ut=!1,_t=!1,Vt=!0,zt=!1;const jt="user-content-";let Te=!0,Ie=!1,Ee={},me=null;const ve=addToSet({},["annotation-xml","audio","colgroup","desc","foreignobject","head","iframe","math","mi","mn","mo","ms","mtext","noembed","noframes","noscript","plaintext","script","style","svg","template","thead","title","video","xmp"]);let we=null;const ye=addToSet({},["audio","video","img","source","image","track"]);let Ne=null;const Re=addToSet({},["alt","class","for","id","label","name","pattern","placeholder","role","summary","title","value","style","xmlns"]),We="http://www.w3.org/1998/Math/MathML",He="http://www.w3.org/2000/svg",qe="http://www.w3.org/1999/xhtml";let Ge=qe,Je=!1,Ye=null;const Ke=addToSet({},[We,He,qe],stringToString);let tt;const it=["application/xhtml+xml","text/html"],bt="text/html";let Qe,st=null;const Nt=U.createElement("form"),At=function(xe){return xe instanceof RegExp||xe instanceof Function},Et=function(xe){if(!(st&&st===xe)){if((!xe||typeof xe!="object")&&(xe={}),xe=clone$2(xe),tt=it.indexOf(xe.PARSER_MEDIA_TYPE)===-1?tt=bt:tt=xe.PARSER_MEDIA_TYPE,Qe=tt==="application/xhtml+xml"?stringToString:stringToLowerCase,Pe="ALLOWED_TAGS"in xe?addToSet({},xe.ALLOWED_TAGS,Qe):Ue,ze="ALLOWED_ATTR"in xe?addToSet({},xe.ALLOWED_ATTR,Qe):Fe,Ye="ALLOWED_NAMESPACES"in xe?addToSet({},xe.ALLOWED_NAMESPACES,stringToString):Ke,Ne="ADD_URI_SAFE_ATTR"in xe?addToSet(clone$2(Re),xe.ADD_URI_SAFE_ATTR,Qe):Re,we="ADD_DATA_URI_TAGS"in xe?addToSet(clone$2(ye),xe.ADD_DATA_URI_TAGS,Qe):ye,me="FORBID_CONTENTS"in xe?addToSet({},xe.FORBID_CONTENTS,Qe):ve,ot="FORBID_TAGS"in xe?addToSet({},xe.FORBID_TAGS,Qe):{},ft="FORBID_ATTR"in xe?addToSet({},xe.FORBID_ATTR,Qe):{},Ee="USE_PROFILES"in xe?xe.USE_PROFILES:!1,rt=xe.ALLOW_ARIA_ATTR!==!1,Xe=xe.ALLOW_DATA_ATTR!==!1,ct=xe.ALLOW_UNKNOWN_PROTOCOLS||!1,vt=xe.ALLOW_SELF_CLOSE_IN_ATTR!==!1,pt=xe.SAFE_FOR_TEMPLATES||!1,je=xe.WHOLE_DOCUMENT||!1,Lt=xe.RETURN_DOM||!1,ut=xe.RETURN_DOM_FRAGMENT||!1,_t=xe.RETURN_TRUSTED_TYPE||!1,wt=xe.FORCE_BODY||!1,Vt=xe.SANITIZE_DOM!==!1,zt=xe.SANITIZE_NAMED_PROPS||!1,Te=xe.KEEP_CONTENT!==!1,Ie=xe.IN_PLACE||!1,Be=xe.ALLOWED_URI_REGEXP||IS_ALLOWED_URI,Ge=xe.NAMESPACE||qe,Ae=xe.CUSTOM_ELEMENT_HANDLING||{},xe.CUSTOM_ELEMENT_HANDLING&&At(xe.CUSTOM_ELEMENT_HANDLING.tagNameCheck)&&(Ae.tagNameCheck=xe.CUSTOM_ELEMENT_HANDLING.tagNameCheck),xe.CUSTOM_ELEMENT_HANDLING&&At(xe.CUSTOM_ELEMENT_HANDLING.attributeNameCheck)&&(Ae.attributeNameCheck=xe.CUSTOM_ELEMENT_HANDLING.attributeNameCheck),xe.CUSTOM_ELEMENT_HANDLING&&typeof xe.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements=="boolean"&&(Ae.allowCustomizedBuiltInElements=xe.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements),pt&&(Xe=!1),ut&&(Lt=!0),Ee&&(Pe=addToSet({},[...text]),ze=[],Ee.html===!0&&(addToSet(Pe,html$1),addToSet(ze,html)),Ee.svg===!0&&(addToSet(Pe,svg$1),addToSet(ze,svg),addToSet(ze,xml)),Ee.svgFilters===!0&&(addToSet(Pe,svgFilters),addToSet(ze,svg),addToSet(ze,xml)),Ee.mathMl===!0&&(addToSet(Pe,mathMl$1),addToSet(ze,mathMl),addToSet(ze,xml))),xe.ADD_TAGS&&(Pe===Ue&&(Pe=clone$2(Pe)),addToSet(Pe,xe.ADD_TAGS,Qe)),xe.ADD_ATTR&&(ze===Fe&&(ze=clone$2(ze)),addToSet(ze,xe.ADD_ATTR,Qe)),xe.ADD_URI_SAFE_ATTR&&addToSet(Ne,xe.ADD_URI_SAFE_ATTR,Qe),xe.FORBID_CONTENTS&&(me===ve&&(me=clone$2(me)),addToSet(me,xe.FORBID_CONTENTS,Qe)),Te&&(Pe["#text"]=!0),je&&addToSet(Pe,["html","head","body"]),Pe.table&&(addToSet(Pe,["tbody"]),delete ot.tbody),xe.TRUSTED_TYPES_POLICY){if(typeof xe.TRUSTED_TYPES_POLICY.createHTML!="function")throw typeErrorCreate('TRUSTED_TYPES_POLICY configuration option must provide a "createHTML" hook.');if(typeof xe.TRUSTED_TYPES_POLICY.createScriptURL!="function")throw typeErrorCreate('TRUSTED_TYPES_POLICY configuration option must provide a "createScriptURL" hook.');ce=xe.TRUSTED_TYPES_POLICY,de=ce.createHTML("")}else ce===void 0&&(ce=_createTrustedTypesPolicy(ne,V)),ce!==null&&typeof de=="string"&&(de=ce.createHTML(""));freeze$1&&freeze$1(xe),st=xe}},kt=addToSet({},["mi","mo","mn","ms","mtext"]),Rt=addToSet({},["foreignobject","desc","title","annotation-xml"]),Mt=addToSet({},["title","style","font","a","script"]),Ft=addToSet({},svg$1);addToSet(Ft,svgFilters),addToSet(Ft,svgDisallowed);const Pt=addToSet({},mathMl$1);addToSet(Pt,mathMlDisallowed);const Gt=function(xe){let $e=le(xe);(!$e||!$e.tagName)&&($e={namespaceURI:Ge,tagName:"template"});const Ve=stringToLowerCase(xe.tagName),nt=stringToLowerCase($e.tagName);return Ye[xe.namespaceURI]?xe.namespaceURI===He?$e.namespaceURI===qe?Ve==="svg":$e.namespaceURI===We?Ve==="svg"&&(nt==="annotation-xml"||kt[nt]):!!Ft[Ve]:xe.namespaceURI===We?$e.namespaceURI===qe?Ve==="math":$e.namespaceURI===He?Ve==="math"&&Rt[nt]:!!Pt[Ve]:xe.namespaceURI===qe?$e.namespaceURI===He&&!Rt[nt]||$e.namespaceURI===We&&!kt[nt]?!1:!Pt[Ve]&&(Mt[Ve]||!Ft[Ve]):!!(tt==="application/xhtml+xml"&&Ye[xe.namespaceURI]):!1},It=function(xe){arrayPush(C.removed,{element:xe});try{xe.parentNode.removeChild(xe)}catch{xe.remove()}},Bt=function(xe,$e){try{arrayPush(C.removed,{attribute:$e.getAttributeNode(xe),from:$e})}catch{arrayPush(C.removed,{attribute:null,from:$e})}if($e.removeAttribute(xe),xe==="is"&&!ze[xe])if(Lt||ut)try{It($e)}catch{}else try{$e.setAttribute(xe,"")}catch{}},Wt=function(xe){let $e,Ve;if(wt)xe="<remove></remove>"+xe;else{const St=stringMatch(xe,/^[\r\n\t ]+/);Ve=St&&St[0]}tt==="application/xhtml+xml"&&Ge===qe&&(xe='<html xmlns="http://www.w3.org/1999/xhtml"><head></head><body>'+xe+"</body></html>");const nt=ce?ce.createHTML(xe):xe;if(Ge===qe)try{$e=new ie().parseFromString(nt,tt)}catch{}if(!$e||!$e.documentElement){$e=ue.createDocument(Ge,"template",null);try{$e.documentElement.innerHTML=Je?de:nt}catch{}}const mt=$e.body||$e.documentElement;return xe&&Ve&&mt.insertBefore(U.createTextNode(Ve),mt.childNodes[0]||null),Ge===qe?fe.call($e,je?"html":"body")[0]:je?$e.documentElement:mt},Ut=function(xe){return ge.call(xe.ownerDocument||xe,xe,J.SHOW_ELEMENT|J.SHOW_COMMENT|J.SHOW_TEXT,null,!1)},si=function(xe){return xe instanceof te&&(typeof xe.nodeName!="string"||typeof xe.textContent!="string"||typeof xe.removeChild!="function"||!(xe.attributes instanceof ee)||typeof xe.removeAttribute!="function"||typeof xe.setAttribute!="function"||typeof xe.namespaceURI!="string"||typeof xe.insertBefore!="function"||typeof xe.hasChildNodes!="function")},Kt=function(xe){return typeof X=="object"?xe instanceof X:xe&&typeof xe=="object"&&typeof xe.nodeType=="number"&&typeof xe.nodeName=="string"},Dt=function(xe,$e,Ve){Se[xe]&&arrayForEach(Se[xe],nt=>{nt.call(C,$e,Ve,st)})},Jt=function(xe){let $e;if(Dt("beforeSanitizeElements",xe,null),si(xe))return It(xe),!0;const Ve=Qe(xe.nodeName);if(Dt("uponSanitizeElement",xe,{tagName:Ve,allowedTags:Pe}),xe.hasChildNodes()&&!Kt(xe.firstElementChild)&&(!Kt(xe.content)||!Kt(xe.content.firstElementChild))&&regExpTest(/<[/\w]/g,xe.innerHTML)&&regExpTest(/<[/\w]/g,xe.textContent))return It(xe),!0;if(!Pe[Ve]||ot[Ve]){if(!ot[Ve]&&ti(Ve)&&(Ae.tagNameCheck instanceof RegExp&&regExpTest(Ae.tagNameCheck,Ve)||Ae.tagNameCheck instanceof Function&&Ae.tagNameCheck(Ve)))return!1;if(Te&&!me[Ve]){const nt=le(xe)||xe.parentNode,mt=se(xe)||xe.childNodes;if(mt&&nt){const St=mt.length;for(let dt=St-1;dt>=0;--dt)nt.insertBefore(re(mt[dt],!0),ae(xe))}}return It(xe),!0}return xe instanceof Q&&!Gt(xe)||(Ve==="noscript"||Ve==="noembed"||Ve==="noframes")&&regExpTest(/<\/no(script|embed|frames)/i,xe.innerHTML)?(It(xe),!0):(pt&&xe.nodeType===3&&($e=xe.textContent,$e=stringReplace($e,Le," "),$e=stringReplace($e,be," "),$e=stringReplace($e,Ce," "),xe.textContent!==$e&&(arrayPush(C.removed,{element:xe.cloneNode()}),xe.textContent=$e)),Dt("afterSanitizeElements",xe,null),!1)},ei=function(xe,$e,Ve){if(Vt&&($e==="id"||$e==="name")&&(Ve in U||Ve in Nt))return!1;if(!(Xe&&!ft[$e]&&regExpTest(De,$e))){if(!(rt&&regExpTest(ke,$e))){if(!ze[$e]||ft[$e]){if(!(ti(xe)&&(Ae.tagNameCheck instanceof RegExp&&regExpTest(Ae.tagNameCheck,xe)||Ae.tagNameCheck instanceof Function&&Ae.tagNameCheck(xe))&&(Ae.attributeNameCheck instanceof RegExp&&regExpTest(Ae.attributeNameCheck,$e)||Ae.attributeNameCheck instanceof Function&&Ae.attributeNameCheck($e))||$e==="is"&&Ae.allowCustomizedBuiltInElements&&(Ae.tagNameCheck instanceof RegExp&&regExpTest(Ae.tagNameCheck,Ve)||Ae.tagNameCheck instanceof Function&&Ae.tagNameCheck(Ve))))return!1}else if(!Ne[$e]){if(!regExpTest(Be,stringReplace(Ve,Oe,""))){if(!(($e==="src"||$e==="xlink:href"||$e==="href")&&xe!=="script"&&stringIndexOf(Ve,"data:")===0&&we[xe])){if(!(ct&&!regExpTest(Me,stringReplace(Ve,Oe,"")))){if(Ve)return!1}}}}}}return!0},ti=function(xe){return xe.indexOf("-")>0},ii=function(xe){let $e,Ve,nt,mt;Dt("beforeSanitizeAttributes",xe,null);const{attributes:St}=xe;if(!St)return;const dt={attrName:"",attrValue:"",keepAttr:!0,allowedAttributes:ze};for(mt=St.length;mt--;){$e=St[mt];const{name:xt,namespaceURI:qt}=$e;if(Ve=xt==="value"?$e.value:stringTrim($e.value),nt=Qe(xt),dt.attrName=nt,dt.attrValue=Ve,dt.keepAttr=!0,dt.forceKeepAttr=void 0,Dt("uponSanitizeAttribute",xe,dt),Ve=dt.attrValue,dt.forceKeepAttr||(Bt(xt,xe),!dt.keepAttr))continue;if(!vt&&regExpTest(/\/>/i,Ve)){Bt(xt,xe);continue}pt&&(Ve=stringReplace(Ve,Le," "),Ve=stringReplace(Ve,be," "),Ve=stringReplace(Ve,Ce," "));const ni=Qe(xe.nodeName);if(ei(ni,nt,Ve)){if(zt&&(nt==="id"||nt==="name")&&(Bt(xt,xe),Ve=jt+Ve),ce&&typeof ne=="object"&&typeof ne.getAttributeType=="function"&&!qt)switch(ne.getAttributeType(ni,nt)){case"TrustedHTML":{Ve=ce.createHTML(Ve);break}case"TrustedScriptURL":{Ve=ce.createScriptURL(Ve);break}}try{qt?xe.setAttributeNS(qt,xt,Ve):xe.setAttribute(xt,Ve),arrayPop(C.removed)}catch{}}}Dt("afterSanitizeAttributes",xe,null)},ai=function Ze(xe){let $e;const Ve=Ut(xe);for(Dt("beforeSanitizeShadowDOM",xe,null);$e=Ve.nextNode();)Dt("uponSanitizeShadowNode",$e,null),!Jt($e)&&($e.content instanceof G&&Ze($e.content),ii($e));Dt("afterSanitizeShadowDOM",xe,null)};return C.sanitize=function(Ze){let xe=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},$e,Ve,nt,mt;if(Je=!Ze,Je&&(Ze="<!-->"),typeof Ze!="string"&&!Kt(Ze))if(typeof Ze.toString=="function"){if(Ze=Ze.toString(),typeof Ze!="string")throw typeErrorCreate("dirty is not a string, aborting")}else throw typeErrorCreate("toString is not a function");if(!C.isSupported)return Ze;if(Ct||Et(xe),C.removed=[],typeof Ze=="string"&&(Ie=!1),Ie){if(Ze.nodeName){const xt=Qe(Ze.nodeName);if(!Pe[xt]||ot[xt])throw typeErrorCreate("root node is forbidden and cannot be sanitized in-place")}}else if(Ze instanceof X)$e=Wt("<!---->"),Ve=$e.ownerDocument.importNode(Ze,!0),Ve.nodeType===1&&Ve.nodeName==="BODY"||Ve.nodeName==="HTML"?$e=Ve:$e.appendChild(Ve);else{if(!Lt&&!pt&&!je&&Ze.indexOf("<")===-1)return ce&&_t?ce.createHTML(Ze):Ze;if($e=Wt(Ze),!$e)return Lt?null:_t?de:""}$e&&wt&&It($e.firstChild);const St=Ut(Ie?Ze:$e);for(;nt=St.nextNode();)Jt(nt)||(nt.content instanceof G&&ai(nt.content),ii(nt));if(Ie)return Ze;if(Lt){if(ut)for(mt=he.call($e.ownerDocument);$e.firstChild;)mt.appendChild($e.firstChild);else mt=$e;return(ze.shadowroot||ze.shadowrootmode)&&(mt=pe.call(W,mt,!0)),mt}let dt=je?$e.outerHTML:$e.innerHTML;return je&&Pe["!doctype"]&&$e.ownerDocument&&$e.ownerDocument.doctype&&$e.ownerDocument.doctype.name&&regExpTest(DOCTYPE_NAME,$e.ownerDocument.doctype.name)&&(dt="<!DOCTYPE "+$e.ownerDocument.doctype.name+`>
`+dt),pt&&(dt=stringReplace(dt,Le," "),dt=stringReplace(dt,be," "),dt=stringReplace(dt,Ce," ")),ce&&_t?ce.createHTML(dt):dt},C.setConfig=function(Ze){Et(Ze),Ct=!0},C.clearConfig=function(){st=null,Ct=!1},C.isValidAttribute=function(Ze,xe,$e){st||Et({});const Ve=Qe(Ze),nt=Qe(xe);return ei(Ve,nt,$e)},C.addHook=function(Ze,xe){typeof xe=="function"&&(Se[Ze]=Se[Ze]||[],arrayPush(Se[Ze],xe))},C.removeHook=function(Ze){if(Se[Ze])return arrayPop(Se[Ze])},C.removeHooks=function(Ze){Se[Ze]&&(Se[Ze]=[])},C.removeAllHooks=function(){Se={}},C}var purify=createDOMPurify();purify.version;purify.isSupported;const sanitize$1=purify.sanitize;purify.setConfig;purify.clearConfig;purify.isValidAttribute;const addHook=purify.addHook,removeHook=purify.removeHook;purify.removeHooks;purify.removeAllHooks;var Schemas;(function(K){K.inMemory="inmemory",K.vscode="vscode",K.internal="private",K.walkThrough="walkThrough",K.walkThroughSnippet="walkThroughSnippet",K.http="http",K.https="https",K.file="file",K.mailto="mailto",K.untitled="untitled",K.data="data",K.command="command",K.vscodeRemote="vscode-remote",K.vscodeRemoteResource="vscode-remote-resource",K.vscodeManagedRemoteResource="vscode-managed-remote-resource",K.vscodeUserData="vscode-userdata",K.vscodeCustomEditor="vscode-custom-editor",K.vscodeNotebookCell="vscode-notebook-cell",K.vscodeNotebookCellMetadata="vscode-notebook-cell-metadata",K.vscodeNotebookCellOutput="vscode-notebook-cell-output",K.vscodeInteractiveInput="vscode-interactive-input",K.vscodeSettings="vscode-settings",K.vscodeWorkspaceTrust="vscode-workspace-trust",K.vscodeTerminal="vscode-terminal",K.vscodeChatSesssion="vscode-chat-editor",K.webviewPanel="webview-panel",K.vscodeWebview="vscode-webview",K.extension="extension",K.vscodeFileResource="vscode-file",K.tmp="tmp",K.vsls="vsls",K.vscodeSourceControl="vscode-scm"})(Schemas||(Schemas={}));const connectionTokenQueryName="tkn";class RemoteAuthoritiesImpl{constructor(){this._hosts=Object.create(null),this._ports=Object.create(null),this._connectionTokens=Object.create(null),this._preferredWebSchema="http",this._delegate=null,this._remoteResourcesPath=`/${Schemas.vscodeRemoteResource}`}setPreferredWebSchema(C){this._preferredWebSchema=C}rewrite(C){if(this._delegate)try{return this._delegate(C)}catch(X){return onUnexpectedError(X),C}const W=C.authority;let V=this._hosts[W];V&&V.indexOf(":")!==-1&&V.indexOf("[")===-1&&(V=`[${V}]`);const U=this._ports[W],G=this._connectionTokens[W];let Z=`path=${encodeURIComponent(C.path)}`;return typeof G=="string"&&(Z+=`&${connectionTokenQueryName}=${encodeURIComponent(G)}`),URI.from({scheme:isWeb?this._preferredWebSchema:Schemas.vscodeRemoteResource,authority:`${V}:${U}`,path:this._remoteResourcesPath,query:Z})}}const RemoteAuthorities=new RemoteAuthoritiesImpl;class FileAccessImpl{uriToBrowserUri(C){return C.scheme===Schemas.vscodeRemote?RemoteAuthorities.rewrite(C):C.scheme===Schemas.file&&(isNative||isWebWorker&&globals.origin===`${Schemas.vscodeFileResource}://${FileAccessImpl.FALLBACK_AUTHORITY}`)?C.with({scheme:Schemas.vscodeFileResource,authority:C.authority||FileAccessImpl.FALLBACK_AUTHORITY,query:null,fragment:null}):C}}FileAccessImpl.FALLBACK_AUTHORITY="vscode-app";const FileAccess=new FileAccessImpl;var COI;(function(K){const C=new Map([["1",{"Cross-Origin-Opener-Policy":"same-origin"}],["2",{"Cross-Origin-Embedder-Policy":"require-corp"}],["3",{"Cross-Origin-Opener-Policy":"same-origin","Cross-Origin-Embedder-Policy":"require-corp"}]]);K.CoopAndCoep=Object.freeze(C.get("3"));const W="vscode-coi";function V(G){let Z;typeof G=="string"?Z=new URL(G).searchParams:G instanceof URL?Z=G.searchParams:URI.isUri(G)&&(Z=new URL(G.toString(!0)).searchParams);const X=Z==null?void 0:Z.get(W);if(X)return C.get(X)}K.getHeadersFromQuery=V;function U(G,Z,X){if(!globalThis.crossOriginIsolated)return;const Q=Z&&X?"3":X?"2":"1";G instanceof URLSearchParams?G.set(W,Q):G[W]=Q}K.addSearchParam=U})(COI||(COI={}));const{registerWindow,getWindows,onDidCreateWindow}=function(){const K=[],C=new Emitter$1;return{onDidCreateWindow:C.event,registerWindow(W){K.push(W);const V=new DisposableStore;return V.add(toDisposable(()=>{const U=K.indexOf(W);U!==-1&&K.splice(U,1)})),C.fire({window:W,disposableStore:V}),V},getWindows(){return K}}}();function clearNode(K){for(;K.firstChild;)K.firstChild.remove()}function isInDOM(K){var C;return(C=K==null?void 0:K.isConnected)!==null&&C!==void 0?C:!1}class DomListener{constructor(C,W,V,U){this._node=C,this._type=W,this._handler=V,this._options=U||!1,this._node.addEventListener(this._type,this._handler,this._options)}dispose(){this._handler&&(this._node.removeEventListener(this._type,this._handler,this._options),this._node=null,this._handler=null)}}function addDisposableListener(K,C,W,V){return new DomListener(K,C,W,V)}function _wrapAsStandardMouseEvent(K){return function(C){return K(new StandardMouseEvent(C))}}function _wrapAsStandardKeyboardEvent(K){return function(C){return K(new StandardKeyboardEvent(C))}}const addStandardDisposableListener=function(C,W,V,U){let G=V;return W==="click"||W==="mousedown"?G=_wrapAsStandardMouseEvent(V):(W==="keydown"||W==="keypress"||W==="keyup")&&(G=_wrapAsStandardKeyboardEvent(V)),addDisposableListener(C,W,G,U)},addStandardDisposableGenericMouseDownListener=function(C,W,V){const U=_wrapAsStandardMouseEvent(W);return addDisposableGenericMouseDownListener(C,U,V)};function addDisposableGenericMouseDownListener(K,C,W){return addDisposableListener(K,isIOS&&BrowserFeatures.pointerEvents?EventType$1.POINTER_DOWN:EventType$1.MOUSE_DOWN,C,W)}let runAtThisOrScheduleAtNextAnimationFrame,scheduleAtNextAnimationFrame;class AnimationFrameQueueItem{constructor(C,W=0){this._runner=C,this.priority=W,this._canceled=!1}dispose(){this._canceled=!0}execute(){if(!this._canceled)try{this._runner()}catch(C){onUnexpectedError(C)}}static sort(C,W){return W.priority-C.priority}}(function(){let K=[],C=null,W=!1,V=!1;const U=()=>{for(W=!1,C=K,K=[],V=!0;C.length>0;)C.sort(AnimationFrameQueueItem.sort),C.shift().execute();V=!1};scheduleAtNextAnimationFrame=(G,Z=0)=>{const X=new AnimationFrameQueueItem(G,Z);return K.push(X),W||(W=!0,requestAnimationFrame(U)),X},runAtThisOrScheduleAtNextAnimationFrame=(G,Z)=>{if(V){const X=new AnimationFrameQueueItem(G,Z);return C.push(X),X}else return scheduleAtNextAnimationFrame(G,Z)}})();function getComputedStyle$1(K){return K.ownerDocument.defaultView.getComputedStyle(K,null)}function getClientArea(K){var C;const W=K.ownerDocument,V=(C=W.defaultView)===null||C===void 0?void 0:C.window;if(K!==W.body)return new Dimension(K.clientWidth,K.clientHeight);if(isIOS&&(V!=null&&V.visualViewport))return new Dimension(V.visualViewport.width,V.visualViewport.height);if(V!=null&&V.innerWidth&&V.innerHeight)return new Dimension(V.innerWidth,V.innerHeight);if(W.body&&W.body.clientWidth&&W.body.clientHeight)return new Dimension(W.body.clientWidth,W.body.clientHeight);if(W.documentElement&&W.documentElement.clientWidth&&W.documentElement.clientHeight)return new Dimension(W.documentElement.clientWidth,W.documentElement.clientHeight);throw new Error("Unable to figure out browser width and height")}class SizeUtils{static convertToPixels(C,W){return parseFloat(W)||0}static getDimension(C,W,V){const U=getComputedStyle$1(C),G=U?U.getPropertyValue(W):"0";return SizeUtils.convertToPixels(C,G)}static getBorderLeftWidth(C){return SizeUtils.getDimension(C,"border-left-width","borderLeftWidth")}static getBorderRightWidth(C){return SizeUtils.getDimension(C,"border-right-width","borderRightWidth")}static getBorderTopWidth(C){return SizeUtils.getDimension(C,"border-top-width","borderTopWidth")}static getBorderBottomWidth(C){return SizeUtils.getDimension(C,"border-bottom-width","borderBottomWidth")}static getPaddingLeft(C){return SizeUtils.getDimension(C,"padding-left","paddingLeft")}static getPaddingRight(C){return SizeUtils.getDimension(C,"padding-right","paddingRight")}static getPaddingTop(C){return SizeUtils.getDimension(C,"padding-top","paddingTop")}static getPaddingBottom(C){return SizeUtils.getDimension(C,"padding-bottom","paddingBottom")}static getMarginLeft(C){return SizeUtils.getDimension(C,"margin-left","marginLeft")}static getMarginTop(C){return SizeUtils.getDimension(C,"margin-top","marginTop")}static getMarginRight(C){return SizeUtils.getDimension(C,"margin-right","marginRight")}static getMarginBottom(C){return SizeUtils.getDimension(C,"margin-bottom","marginBottom")}}class Dimension{constructor(C,W){this.width=C,this.height=W}with(C=this.width,W=this.height){return C!==this.width||W!==this.height?new Dimension(C,W):this}static is(C){return typeof C=="object"&&typeof C.height=="number"&&typeof C.width=="number"}static lift(C){return C instanceof Dimension?C:new Dimension(C.width,C.height)}static equals(C,W){return C===W?!0:!C||!W?!1:C.width===W.width&&C.height===W.height}}Dimension.None=new Dimension(0,0);function getTopLeftOffset(K){let C=K.offsetParent,W=K.offsetTop,V=K.offsetLeft;for(;(K=K.parentNode)!==null&&K!==K.ownerDocument.body&&K!==K.ownerDocument.documentElement;){W-=K.scrollTop;const U=isShadowRoot(K)?null:getComputedStyle$1(K);U&&(V-=U.direction!=="rtl"?K.scrollLeft:-K.scrollLeft),K===C&&(V+=SizeUtils.getBorderLeftWidth(K),W+=SizeUtils.getBorderTopWidth(K),W+=K.offsetTop,V+=K.offsetLeft,C=K.offsetParent)}return{left:V,top:W}}function size(K,C,W){typeof C=="number"&&(K.style.width=`${C}px`),typeof W=="number"&&(K.style.height=`${W}px`)}function getDomNodePagePosition(K){var C,W,V,U;const G=K.getBoundingClientRect();return{left:G.left+((W=(C=K.ownerDocument.defaultView)===null||C===void 0?void 0:C.scrollX)!==null&&W!==void 0?W:0),top:G.top+((U=(V=K.ownerDocument.defaultView)===null||V===void 0?void 0:V.scrollY)!==null&&U!==void 0?U:0),width:G.width,height:G.height}}function getDomNodeZoomLevel(K){let C=K,W=1;do{const V=getComputedStyle$1(C).zoom;V!=null&&V!=="1"&&(W*=V),C=C.parentElement}while(C!==null&&C!==C.ownerDocument.documentElement);return W}function getTotalWidth(K){const C=SizeUtils.getMarginLeft(K)+SizeUtils.getMarginRight(K);return K.offsetWidth+C}function getContentWidth(K){const C=SizeUtils.getBorderLeftWidth(K)+SizeUtils.getBorderRightWidth(K),W=SizeUtils.getPaddingLeft(K)+SizeUtils.getPaddingRight(K);return K.offsetWidth-C-W}function getContentHeight(K){const C=SizeUtils.getBorderTopWidth(K)+SizeUtils.getBorderBottomWidth(K),W=SizeUtils.getPaddingTop(K)+SizeUtils.getPaddingBottom(K);return K.offsetHeight-C-W}function getTotalHeight(K){const C=SizeUtils.getMarginTop(K)+SizeUtils.getMarginBottom(K);return K.offsetHeight+C}function isAncestor$1(K,C){for(;K;){if(K===C)return!0;K=K.parentNode}return!1}function findParentWithClass(K,C,W){for(;K&&K.nodeType===K.ELEMENT_NODE;){if(K.classList.contains(C))return K;if(W){if(typeof W=="string"){if(K.classList.contains(W))return null}else if(K===W)return null}K=K.parentNode}return null}function hasParentWithClass(K,C,W){return!!findParentWithClass(K,C,W)}function isShadowRoot(K){return K&&!!K.host&&!!K.mode}function isInShadowDOM(K){return!!getShadowRoot(K)}function getShadowRoot(K){for(var C;K.parentNode;){if(K===((C=K.ownerDocument)===null||C===void 0?void 0:C.body))return null;K=K.parentNode}return isShadowRoot(K)?K:null}function getActiveElement(){let K=getActiveDocument().activeElement;for(;K!=null&&K.shadowRoot;)K=K.shadowRoot.activeElement;return K}function getActiveDocument(){var K;return(K=[document,...getWindows().map(W=>W.document)].find(W=>W.hasFocus()))!==null&&K!==void 0?K:document}function createStyleSheet(K=document.getElementsByTagName("head")[0],C){const W=document.createElement("style");return W.type="text/css",W.media="screen",C==null||C(W),K.appendChild(W),W}let _sharedStyleSheet=null;function getSharedStyleSheet(){return _sharedStyleSheet||(_sharedStyleSheet=createStyleSheet()),_sharedStyleSheet}function getDynamicStyleSheetRules(K){var C,W;return!((C=K==null?void 0:K.sheet)===null||C===void 0)&&C.rules?K.sheet.rules:!((W=K==null?void 0:K.sheet)===null||W===void 0)&&W.cssRules?K.sheet.cssRules:[]}function createCSSRule(K,C,W=getSharedStyleSheet()){!W||!C||W.sheet.insertRule(K+"{"+C+"}",0)}function removeCSSRulesContainingSelector(K,C=getSharedStyleSheet()){if(!C)return;const W=getDynamicStyleSheetRules(C),V=[];for(let U=0;U<W.length;U++)W[U].selectorText.indexOf(K)!==-1&&V.push(U);for(let U=V.length-1;U>=0;U--)C.sheet.deleteRule(V[U])}function isHTMLElement(K){return typeof HTMLElement=="object"?K instanceof HTMLElement:K&&typeof K=="object"&&K.nodeType===1&&typeof K.nodeName=="string"}const EventType$1={CLICK:"click",AUXCLICK:"auxclick",DBLCLICK:"dblclick",MOUSE_UP:"mouseup",MOUSE_DOWN:"mousedown",MOUSE_OVER:"mouseover",MOUSE_MOVE:"mousemove",MOUSE_OUT:"mouseout",MOUSE_ENTER:"mouseenter",MOUSE_LEAVE:"mouseleave",MOUSE_WHEEL:"wheel",POINTER_UP:"pointerup",POINTER_DOWN:"pointerdown",POINTER_MOVE:"pointermove",POINTER_LEAVE:"pointerleave",CONTEXT_MENU:"contextmenu",WHEEL:"wheel",KEY_DOWN:"keydown",KEY_PRESS:"keypress",KEY_UP:"keyup",LOAD:"load",BEFORE_UNLOAD:"beforeunload",UNLOAD:"unload",PAGE_SHOW:"pageshow",PAGE_HIDE:"pagehide",ABORT:"abort",ERROR:"error",RESIZE:"resize",SCROLL:"scroll",FULLSCREEN_CHANGE:"fullscreenchange",WK_FULLSCREEN_CHANGE:"webkitfullscreenchange",SELECT:"select",CHANGE:"change",SUBMIT:"submit",RESET:"reset",FOCUS:"focus",FOCUS_IN:"focusin",FOCUS_OUT:"focusout",BLUR:"blur",INPUT:"input",STORAGE:"storage",DRAG_START:"dragstart",DRAG:"drag",DRAG_ENTER:"dragenter",DRAG_LEAVE:"dragleave",DRAG_OVER:"dragover",DROP:"drop",DRAG_END:"dragend",ANIMATION_START:isWebKit?"webkitAnimationStart":"animationstart",ANIMATION_END:isWebKit?"webkitAnimationEnd":"animationend",ANIMATION_ITERATION:isWebKit?"webkitAnimationIteration":"animationiteration"};function isEventLike(K){const C=K;return!!(C&&typeof C.preventDefault=="function"&&typeof C.stopPropagation=="function")}const EventHelper={stop:(K,C)=>(K.preventDefault(),C&&K.stopPropagation(),K)};function saveParentsScrollTop(K){const C=[];for(let W=0;K&&K.nodeType===K.ELEMENT_NODE;W++)C[W]=K.scrollTop,K=K.parentNode;return C}function restoreParentsScrollTop(K,C){for(let W=0;K&&K.nodeType===K.ELEMENT_NODE;W++)K.scrollTop!==C[W]&&(K.scrollTop=C[W]),K=K.parentNode}class FocusTracker extends Disposable{static hasFocusWithin(C){if(isHTMLElement(C)){const W=getShadowRoot(C),V=W?W.activeElement:C.ownerDocument.activeElement;return isAncestor$1(V,C)}else return isAncestor$1(window.document.activeElement,window.document)}constructor(C){super(),this._onDidFocus=this._register(new Emitter$1),this.onDidFocus=this._onDidFocus.event,this._onDidBlur=this._register(new Emitter$1),this.onDidBlur=this._onDidBlur.event;let W=FocusTracker.hasFocusWithin(C),V=!1;const U=()=>{V=!1,W||(W=!0,this._onDidFocus.fire())},G=()=>{W&&(V=!0,window.setTimeout(()=>{V&&(V=!1,W=!1,this._onDidBlur.fire())},0))};this._refreshStateHandler=()=>{FocusTracker.hasFocusWithin(C)!==W&&(W?G():U())},this._register(addDisposableListener(C,EventType$1.FOCUS,U,!0)),this._register(addDisposableListener(C,EventType$1.BLUR,G,!0)),C instanceof HTMLElement&&(this._register(addDisposableListener(C,EventType$1.FOCUS_IN,()=>this._refreshStateHandler())),this._register(addDisposableListener(C,EventType$1.FOCUS_OUT,()=>this._refreshStateHandler())))}}function trackFocus(K){return new FocusTracker(K)}function append$3(K,...C){if(K.append(...C),C.length===1&&typeof C[0]!="string")return C[0]}function prepend$3(K,C){return K.insertBefore(C,K.firstChild),C}function reset(K,...C){K.innerText="",append$3(K,...C)}const SELECTOR_REGEX=/([\w\-]+)?(#([\w\-]+))?((\.([\w\-]+))*)/;var Namespace;(function(K){K.HTML="http://www.w3.org/1999/xhtml",K.SVG="http://www.w3.org/2000/svg"})(Namespace||(Namespace={}));function _$(K,C,W,...V){const U=SELECTOR_REGEX.exec(C);if(!U)throw new Error("Bad use of emmet");const G=U[1]||"div";let Z;return K!==Namespace.HTML?Z=document.createElementNS(K,G):Z=document.createElement(G),U[3]&&(Z.id=U[3]),U[4]&&(Z.className=U[4].replace(/\./g," ").trim()),W&&Object.entries(W).forEach(([X,Q])=>{typeof Q>"u"||(/^on\w+$/.test(X)?Z[X]=Q:X==="selected"?Q&&Z.setAttribute(X,"true"):Z.setAttribute(X,Q))}),Z.append(...V),Z}function $$d(K,C,...W){return _$(Namespace.HTML,K,C,...W)}$$d.SVG=function(K,C,...W){return _$(Namespace.SVG,K,C,...W)};function setVisibility(K,...C){K?show(...C):hide(...C)}function show(...K){for(const C of K)C.style.display="",C.removeAttribute("aria-hidden")}function hide(...K){for(const C of K)C.style.display="none",C.setAttribute("aria-hidden","true")}function computeScreenAwareSize(K){const C=window.devicePixelRatio*K;return Math.max(1,Math.floor(C))/window.devicePixelRatio}function windowOpenNoOpener(K){window.open(K,"_blank","noopener")}function animate(K){const C=()=>{K(),W=scheduleAtNextAnimationFrame(C)};let W=scheduleAtNextAnimationFrame(C);return toDisposable(()=>W.dispose())}RemoteAuthorities.setPreferredWebSchema(/^https:/.test(window.location.href)?"https":"http");function asCSSUrl(K){return K?`url('${FileAccess.uriToBrowserUri(K).toString(!0).replace(/'/g,"%27")}')`:"url('')"}function asCSSPropertyValue(K){return`'${K.replace(/'/g,"%27")}'`}function asCssValueWithDefault(K,C){if(K!==void 0){const W=K.match(/^\s*var\((.+)\)$/);if(W){const V=W[1].split(",",2);return V.length===2&&(C=asCssValueWithDefault(V[1].trim(),C)),`var(${V[0]}, ${C})`}return K}return C}function hookDomPurifyHrefAndSrcSanitizer(K,C=!1){const W=document.createElement("a");return addHook("afterSanitizeAttributes",V=>{for(const U of["href","src"])if(V.hasAttribute(U)){const G=V.getAttribute(U);if(U==="href"&&G.startsWith("#"))continue;if(W.href=G,!K.includes(W.protocol.replace(/:$/,""))){if(C&&U==="src"&&W.href.startsWith("data:"))continue;V.removeAttribute(U)}}}),toDisposable(()=>{removeHook("afterSanitizeAttributes")})}const basicMarkupHtmlTags=Object.freeze(["a","abbr","b","bdo","blockquote","br","caption","cite","code","col","colgroup","dd","del","details","dfn","div","dl","dt","em","figcaption","figure","h1","h2","h3","h4","h5","h6","hr","i","img","ins","kbd","label","li","mark","ol","p","pre","q","rp","rt","ruby","samp","small","small","source","span","strike","strong","sub","summary","sup","table","tbody","td","tfoot","th","thead","time","tr","tt","u","ul","var","video","wbr"]);class ModifierKeyEmitter extends Emitter$1{constructor(){super(),this._subscriptions=new DisposableStore,this._keyStatus={altKey:!1,shiftKey:!1,ctrlKey:!1,metaKey:!1},this._subscriptions.add(addDisposableListener(window,"keydown",C=>{if(C.defaultPrevented)return;const W=new StandardKeyboardEvent(C);if(!(W.keyCode===6&&C.repeat)){if(C.altKey&&!this._keyStatus.altKey)this._keyStatus.lastKeyPressed="alt";else if(C.ctrlKey&&!this._keyStatus.ctrlKey)this._keyStatus.lastKeyPressed="ctrl";else if(C.metaKey&&!this._keyStatus.metaKey)this._keyStatus.lastKeyPressed="meta";else if(C.shiftKey&&!this._keyStatus.shiftKey)this._keyStatus.lastKeyPressed="shift";else if(W.keyCode!==6)this._keyStatus.lastKeyPressed=void 0;else return;this._keyStatus.altKey=C.altKey,this._keyStatus.ctrlKey=C.ctrlKey,this._keyStatus.metaKey=C.metaKey,this._keyStatus.shiftKey=C.shiftKey,this._keyStatus.lastKeyPressed&&(this._keyStatus.event=C,this.fire(this._keyStatus))}},!0)),this._subscriptions.add(addDisposableListener(window,"keyup",C=>{C.defaultPrevented||(!C.altKey&&this._keyStatus.altKey?this._keyStatus.lastKeyReleased="alt":!C.ctrlKey&&this._keyStatus.ctrlKey?this._keyStatus.lastKeyReleased="ctrl":!C.metaKey&&this._keyStatus.metaKey?this._keyStatus.lastKeyReleased="meta":!C.shiftKey&&this._keyStatus.shiftKey?this._keyStatus.lastKeyReleased="shift":this._keyStatus.lastKeyReleased=void 0,this._keyStatus.lastKeyPressed!==this._keyStatus.lastKeyReleased&&(this._keyStatus.lastKeyPressed=void 0),this._keyStatus.altKey=C.altKey,this._keyStatus.ctrlKey=C.ctrlKey,this._keyStatus.metaKey=C.metaKey,this._keyStatus.shiftKey=C.shiftKey,this._keyStatus.lastKeyReleased&&(this._keyStatus.event=C,this.fire(this._keyStatus)))},!0)),this._subscriptions.add(addDisposableListener(document.body,"mousedown",()=>{this._keyStatus.lastKeyPressed=void 0},!0)),this._subscriptions.add(addDisposableListener(document.body,"mouseup",()=>{this._keyStatus.lastKeyPressed=void 0},!0)),this._subscriptions.add(addDisposableListener(document.body,"mousemove",C=>{C.buttons&&(this._keyStatus.lastKeyPressed=void 0)},!0)),this._subscriptions.add(addDisposableListener(window,"blur",()=>{this.resetKeyStatus()}))}get keyStatus(){return this._keyStatus}resetKeyStatus(){this.doResetKeyStatus(),this.fire(this._keyStatus)}doResetKeyStatus(){this._keyStatus={altKey:!1,shiftKey:!1,ctrlKey:!1,metaKey:!1}}static getInstance(){return ModifierKeyEmitter.instance||(ModifierKeyEmitter.instance=new ModifierKeyEmitter),ModifierKeyEmitter.instance}dispose(){super.dispose(),this._subscriptions.dispose()}}class DragAndDropObserver extends Disposable{constructor(C,W){super(),this.element=C,this.callbacks=W,this.counter=0,this.dragStartTime=0,this.registerListeners()}registerListeners(){this._register(addDisposableListener(this.element,EventType$1.DRAG_ENTER,C=>{this.counter++,this.dragStartTime=C.timeStamp,this.callbacks.onDragEnter(C)})),this._register(addDisposableListener(this.element,EventType$1.DRAG_OVER,C=>{var W,V;C.preventDefault(),(V=(W=this.callbacks).onDragOver)===null||V===void 0||V.call(W,C,C.timeStamp-this.dragStartTime)})),this._register(addDisposableListener(this.element,EventType$1.DRAG_LEAVE,C=>{this.counter--,this.counter===0&&(this.dragStartTime=0,this.callbacks.onDragLeave(C))})),this._register(addDisposableListener(this.element,EventType$1.DRAG_END,C=>{this.counter=0,this.dragStartTime=0,this.callbacks.onDragEnd(C)})),this._register(addDisposableListener(this.element,EventType$1.DROP,C=>{this.counter=0,this.dragStartTime=0,this.callbacks.onDrop(C)}))}}const H_REGEX=/(?<tag>[\w\-]+)?(?:#(?<id>[\w\-]+))?(?<class>(?:\.(?:[\w\-]+))*)(?:@(?<name>(?:[\w\_])+))?/;function h(K,...C){let W,V;Array.isArray(C[0])?(W={},V=C[0]):(W=C[0]||{},V=C[1]);const U=H_REGEX.exec(K);if(!U||!U.groups)throw new Error("Bad use of h");const G=U.groups.tag||"div",Z=document.createElement(G);U.groups.id&&(Z.id=U.groups.id);const X=[];if(U.groups.class)for(const J of U.groups.class.split("."))J!==""&&X.push(J);if(W.className!==void 0)for(const J of W.className.split("."))J!==""&&X.push(J);X.length>0&&(Z.className=X.join(" "));const Q={};if(U.groups.name&&(Q[U.groups.name]=Z),V)for(const J of V)J instanceof HTMLElement?Z.appendChild(J):typeof J=="string"?Z.append(J):"root"in J&&(Object.assign(Q,J),Z.appendChild(J.root));for(const[J,ee]of Object.entries(W))if(J!=="className")if(J==="style")for(const[te,ie]of Object.entries(ee))Z.style.setProperty(camelCaseToHyphenCase(te),typeof ie=="number"?ie+"px":""+ie);else J==="tabIndex"?Z.tabIndex=ee:Z.setAttribute(camelCaseToHyphenCase(J),ee.toString());return Q.root=Z,Q}function camelCaseToHyphenCase(K){return K.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()}class Command{constructor(C){this.id=C.id,this.precondition=C.precondition,this._kbOpts=C.kbOpts,this._menuOpts=C.menuOpts,this._description=C.description}register(){if(Array.isArray(this._menuOpts)?this._menuOpts.forEach(this._registerMenuItem,this):this._menuOpts&&this._registerMenuItem(this._menuOpts),this._kbOpts){const C=Array.isArray(this._kbOpts)?this._kbOpts:[this._kbOpts];for(const W of C){let V=W.kbExpr;this.precondition&&(V?V=ContextKeyExpr.and(V,this.precondition):V=this.precondition);const U={id:this.id,weight:W.weight,args:W.args,when:V,primary:W.primary,secondary:W.secondary,win:W.win,linux:W.linux,mac:W.mac};KeybindingsRegistry.registerKeybindingRule(U)}}CommandsRegistry.registerCommand({id:this.id,handler:(C,W)=>this.runCommand(C,W),description:this._description})}_registerMenuItem(C){MenuRegistry.appendMenuItem(C.menuId,{group:C.group,command:{id:this.id,title:C.title,icon:C.icon,precondition:this.precondition},when:C.when,order:C.order})}}class MultiCommand extends Command{constructor(){super(...arguments),this._implementations=[]}addImplementation(C,W,V,U){return this._implementations.push({priority:C,name:W,implementation:V,when:U}),this._implementations.sort((G,Z)=>Z.priority-G.priority),{dispose:()=>{for(let G=0;G<this._implementations.length;G++)if(this._implementations[G].implementation===V){this._implementations.splice(G,1);return}}}}runCommand(C,W){const V=C.get(ILogService),U=C.get(IContextKeyService);V.trace(`Executing Command '${this.id}' which has ${this._implementations.length} bound.`);for(const G of this._implementations){if(G.when){const X=U.getContext(getActiveElement());if(!G.when.evaluate(X))continue}const Z=G.implementation(C,W);if(Z)return V.trace(`Command '${this.id}' was handled by '${G.name}'.`),typeof Z=="boolean"?void 0:Z}V.trace(`The Command '${this.id}' was not handled by any implementation.`)}}class ProxyCommand extends Command{constructor(C,W){super(W),this.command=C}runCommand(C,W){return this.command.runCommand(C,W)}}class EditorCommand extends Command{static bindToContribution(C){return class extends EditorCommand{constructor(V){super(V),this._callback=V.handler}runEditorCommand(V,U,G){const Z=C(U);Z&&this._callback(Z,G)}}}static runEditorCommand(C,W,V,U){const G=C.get(ICodeEditorService),Z=G.getFocusedCodeEditor()||G.getActiveCodeEditor();if(Z)return Z.invokeWithinContext(X=>{if(X.get(IContextKeyService).contextMatchesRules(V??void 0))return U(X,Z,W)})}runCommand(C,W){return EditorCommand.runEditorCommand(C,W,this.precondition,(V,U,G)=>this.runEditorCommand(V,U,G))}}class EditorAction extends EditorCommand{static convertOptions(C){let W;Array.isArray(C.menuOpts)?W=C.menuOpts:C.menuOpts?W=[C.menuOpts]:W=[];function V(U){return U.menuId||(U.menuId=MenuId.EditorContext),U.title||(U.title=C.label),U.when=ContextKeyExpr.and(C.precondition,U.when),U}return Array.isArray(C.contextMenuOpts)?W.push(...C.contextMenuOpts.map(V)):C.contextMenuOpts&&W.push(V(C.contextMenuOpts)),C.menuOpts=W,C}constructor(C){super(EditorAction.convertOptions(C)),this.label=C.label,this.alias=C.alias}runEditorCommand(C,W,V){return this.reportTelemetry(C,W),this.run(C,W,V||{})}reportTelemetry(C,W){C.get(ITelemetryService).publicLog2("editorActionInvoked",{name:this.label,id:this.id})}}class MultiEditorAction extends EditorAction{constructor(){super(...arguments),this._implementations=[]}addImplementation(C,W){return this._implementations.push([C,W]),this._implementations.sort((V,U)=>U[0]-V[0]),{dispose:()=>{for(let V=0;V<this._implementations.length;V++)if(this._implementations[V][1]===W){this._implementations.splice(V,1);return}}}}run(C,W,V){for(const U of this._implementations){const G=U[1](C,W,V);if(G)return typeof G=="boolean"?void 0:G}}}class EditorAction2 extends Action2{run(C,...W){const V=C.get(ICodeEditorService),U=V.getFocusedCodeEditor()||V.getActiveCodeEditor();if(U)return U.invokeWithinContext(G=>{var Z,X;const Q=G.get(IContextKeyService),J=G.get(ILogService);if(!Q.contextMatchesRules((Z=this.desc.precondition)!==null&&Z!==void 0?Z:void 0)){J.debug("[EditorAction2] NOT running command because its precondition is FALSE",this.desc.id,(X=this.desc.precondition)===null||X===void 0?void 0:X.serialize());return}return this.runEditorCommand(G,U,...W)})}}function registerModelAndPositionCommand(K,C){CommandsRegistry.registerCommand(K,function(W,...V){const U=W.get(IInstantiationService),[G,Z]=V;assertType(URI.isUri(G)),assertType(Position$1.isIPosition(Z));const X=W.get(IModelService).getModel(G);if(X){const Q=Position$1.lift(Z);return U.invokeFunction(C,X,Q,...V.slice(2))}return W.get(ITextModelService).createModelReference(G).then(Q=>new Promise((J,ee)=>{try{const te=U.invokeFunction(C,Q.object.textEditorModel,Position$1.lift(Z),V.slice(2));J(te)}catch(te){ee(te)}}).finally(()=>{Q.dispose()}))})}function registerEditorCommand(K){return EditorContributionRegistry.INSTANCE.registerEditorCommand(K),K}function registerEditorAction(K){const C=new K;return EditorContributionRegistry.INSTANCE.registerEditorAction(C),C}function registerMultiEditorAction(K){return EditorContributionRegistry.INSTANCE.registerEditorAction(K),K}function registerInstantiatedEditorAction(K){EditorContributionRegistry.INSTANCE.registerEditorAction(K)}function registerEditorContribution(K,C,W){EditorContributionRegistry.INSTANCE.registerEditorContribution(K,C,W)}var EditorExtensionsRegistry;(function(K){function C(Z){return EditorContributionRegistry.INSTANCE.getEditorCommand(Z)}K.getEditorCommand=C;function W(){return EditorContributionRegistry.INSTANCE.getEditorActions()}K.getEditorActions=W;function V(){return EditorContributionRegistry.INSTANCE.getEditorContributions()}K.getEditorContributions=V;function U(Z){return EditorContributionRegistry.INSTANCE.getEditorContributions().filter(X=>Z.indexOf(X.id)>=0)}K.getSomeEditorContributions=U;function G(){return EditorContributionRegistry.INSTANCE.getDiffEditorContributions()}K.getDiffEditorContributions=G})(EditorExtensionsRegistry||(EditorExtensionsRegistry={}));const Extensions$8={EditorCommonContributions:"editor.contributions"};class EditorContributionRegistry{constructor(){this.editorContributions=[],this.diffEditorContributions=[],this.editorActions=[],this.editorCommands=Object.create(null)}registerEditorContribution(C,W,V){this.editorContributions.push({id:C,ctor:W,instantiation:V})}getEditorContributions(){return this.editorContributions.slice(0)}getDiffEditorContributions(){return this.diffEditorContributions.slice(0)}registerEditorAction(C){C.register(),this.editorActions.push(C)}getEditorActions(){return this.editorActions}registerEditorCommand(C){C.register(),this.editorCommands[C.id]=C}getEditorCommand(C){return this.editorCommands[C]||null}}EditorContributionRegistry.INSTANCE=new EditorContributionRegistry;Registry.add(Extensions$8.EditorCommonContributions,EditorContributionRegistry.INSTANCE);function registerCommand$3(K){return K.register(),K}const UndoCommand=registerCommand$3(new MultiCommand({id:"undo",precondition:void 0,kbOpts:{weight:0,primary:2104},menuOpts:[{menuId:MenuId.MenubarEditMenu,group:"1_do",title:localize({key:"miUndo",comment:["&& denotes a mnemonic"]},"&&Undo"),order:1},{menuId:MenuId.CommandPalette,group:"",title:localize("undo","Undo"),order:1}]}));registerCommand$3(new ProxyCommand(UndoCommand,{id:"default:undo",precondition:void 0}));const RedoCommand=registerCommand$3(new MultiCommand({id:"redo",precondition:void 0,kbOpts:{weight:0,primary:2103,secondary:[3128],mac:{primary:3128}},menuOpts:[{menuId:MenuId.MenubarEditMenu,group:"1_do",title:localize({key:"miRedo",comment:["&& denotes a mnemonic"]},"&&Redo"),order:2},{menuId:MenuId.CommandPalette,group:"",title:localize("redo","Redo"),order:1}]}));registerCommand$3(new ProxyCommand(RedoCommand,{id:"default:redo",precondition:void 0}));const SelectAllCommand=registerCommand$3(new MultiCommand({id:"editor.action.selectAll",precondition:void 0,kbOpts:{weight:0,kbExpr:null,primary:2079},menuOpts:[{menuId:MenuId.MenubarSelectionMenu,group:"1_basic",title:localize({key:"miSelectAll",comment:["&& denotes a mnemonic"]},"&&Select All"),order:1},{menuId:MenuId.CommandPalette,group:"",title:localize("selectAll","Select All"),order:1}]})),MicrotaskDelay=Symbol("MicrotaskDelay");var __awaiter$1z=globalThis&&globalThis.__awaiter||function(K,C,W,V){function U(G){return G instanceof W?G:new W(function(Z){Z(G)})}return new(W||(W=Promise))(function(G,Z){function X(ee){try{J(V.next(ee))}catch(te){Z(te)}}function Q(ee){try{J(V.throw(ee))}catch(te){Z(te)}}function J(ee){ee.done?G(ee.value):U(ee.value).then(X,Q)}J((V=V.apply(K,C||[])).next())})},__asyncValues$2=globalThis&&globalThis.__asyncValues||function(K){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var C=K[Symbol.asyncIterator],W;return C?C.call(K):(K=typeof __values=="function"?__values(K):K[Symbol.iterator](),W={},V("next"),V("throw"),V("return"),W[Symbol.asyncIterator]=function(){return this},W);function V(G){W[G]=K[G]&&function(Z){return new Promise(function(X,Q){Z=K[G](Z),U(X,Q,Z.done,Z.value)})}}function U(G,Z,X,Q){Promise.resolve(Q).then(function(J){G({value:J,done:X})},Z)}};function isThenable$3(K){return!!K&&typeof K.then=="function"}function createCancelablePromise(K){const C=new CancellationTokenSource$1,W=K(C.token),V=new Promise((U,G)=>{const Z=C.token.onCancellationRequested(()=>{Z.dispose(),C.dispose(),G(new CancellationError)});Promise.resolve(W).then(X=>{Z.dispose(),C.dispose(),U(X)},X=>{Z.dispose(),C.dispose(),G(X)})});return new class{cancel(){C.cancel()}then(U,G){return V.then(U,G)}catch(U){return this.then(void 0,U)}finally(U){return V.finally(U)}}}function raceCancellation(K,C,W){return new Promise((V,U)=>{const G=C.onCancellationRequested(()=>{G.dispose(),V(W)});K.then(V,U).finally(()=>G.dispose())})}class Throttler{constructor(){this.isDisposed=!1,this.activePromise=null,this.queuedPromise=null,this.queuedPromiseFactory=null}queue(C){if(this.isDisposed)return Promise.reject(new Error("Throttler is disposed"));if(this.activePromise){if(this.queuedPromiseFactory=C,!this.queuedPromise){const W=()=>{if(this.queuedPromise=null,this.isDisposed)return;const V=this.queue(this.queuedPromiseFactory);return this.queuedPromiseFactory=null,V};this.queuedPromise=new Promise(V=>{this.activePromise.then(W,W).then(V)})}return new Promise((W,V)=>{this.queuedPromise.then(W,V)})}return this.activePromise=C(),new Promise((W,V)=>{this.activePromise.then(U=>{this.activePromise=null,W(U)},U=>{this.activePromise=null,V(U)})})}dispose(){this.isDisposed=!0}}const timeoutDeferred=(K,C)=>{let W=!0;const V=setTimeout(()=>{W=!1,C()},K);return{isTriggered:()=>W,dispose:()=>{clearTimeout(V),W=!1}}},microtaskDeferred=K=>{let C=!0;return queueMicrotask(()=>{C&&(C=!1,K())}),{isTriggered:()=>C,dispose:()=>{C=!1}}};class Delayer{constructor(C){this.defaultDelay=C,this.deferred=null,this.completionPromise=null,this.doResolve=null,this.doReject=null,this.task=null}trigger(C,W=this.defaultDelay){this.task=C,this.cancelTimeout(),this.completionPromise||(this.completionPromise=new Promise((U,G)=>{this.doResolve=U,this.doReject=G}).then(()=>{if(this.completionPromise=null,this.doResolve=null,this.task){const U=this.task;return this.task=null,U()}}));const V=()=>{var U;this.deferred=null,(U=this.doResolve)===null||U===void 0||U.call(this,null)};return this.deferred=W===MicrotaskDelay?microtaskDeferred(V):timeoutDeferred(W,V),this.completionPromise}isTriggered(){var C;return!!(!((C=this.deferred)===null||C===void 0)&&C.isTriggered())}cancel(){var C;this.cancelTimeout(),this.completionPromise&&((C=this.doReject)===null||C===void 0||C.call(this,new CancellationError),this.completionPromise=null)}cancelTimeout(){var C;(C=this.deferred)===null||C===void 0||C.dispose(),this.deferred=null}dispose(){this.cancel()}}class ThrottledDelayer{constructor(C){this.delayer=new Delayer(C),this.throttler=new Throttler}trigger(C,W){return this.delayer.trigger(()=>this.throttler.queue(C),W)}cancel(){this.delayer.cancel()}dispose(){this.delayer.dispose(),this.throttler.dispose()}}function timeout(K,C){return C?new Promise((W,V)=>{const U=setTimeout(()=>{G.dispose(),W()},K),G=C.onCancellationRequested(()=>{clearTimeout(U),G.dispose(),V(new CancellationError)})}):createCancelablePromise(W=>timeout(K,W))}function disposableTimeout(K,C=0,W){const V=setTimeout(()=>{K(),W&&U.dispose()},C),U=toDisposable(()=>{clearTimeout(V),W==null||W.deleteAndLeak(U)});return W==null||W.add(U),U}function first(K,C=V=>!!V,W=null){let V=0;const U=K.length,G=()=>{if(V>=U)return Promise.resolve(W);const Z=K[V++];return Promise.resolve(Z()).then(Q=>C(Q)?Promise.resolve(Q):G())};return G()}class TimeoutTimer{constructor(C,W){this._token=-1,typeof C=="function"&&typeof W=="number"&&this.setIfNotSet(C,W)}dispose(){this.cancel()}cancel(){this._token!==-1&&(clearTimeout(this._token),this._token=-1)}cancelAndSet(C,W){this.cancel(),this._token=setTimeout(()=>{this._token=-1,C()},W)}setIfNotSet(C,W){this._token===-1&&(this._token=setTimeout(()=>{this._token=-1,C()},W))}}class IntervalTimer{constructor(){this._token=-1}dispose(){this.cancel()}cancel(){this._token!==-1&&(clearInterval(this._token),this._token=-1)}cancelAndSet(C,W){this.cancel(),this._token=setInterval(()=>{C()},W)}}class RunOnceScheduler{constructor(C,W){this.timeoutToken=-1,this.runner=C,this.timeout=W,this.timeoutHandler=this.onTimeout.bind(this)}dispose(){this.cancel(),this.runner=null}cancel(){this.isScheduled()&&(clearTimeout(this.timeoutToken),this.timeoutToken=-1)}schedule(C=this.timeout){this.cancel(),this.timeoutToken=setTimeout(this.timeoutHandler,C)}get delay(){return this.timeout}set delay(C){this.timeout=C}isScheduled(){return this.timeoutToken!==-1}onTimeout(){this.timeoutToken=-1,this.runner&&this.doRun()}doRun(){var C;(C=this.runner)===null||C===void 0||C.call(this)}}let runWhenIdle;(function(){typeof requestIdleCallback!="function"||typeof cancelIdleCallback!="function"?runWhenIdle=K=>{setTimeout0(()=>{if(C)return;const W=Date.now()+15;K(Object.freeze({didTimeout:!0,timeRemaining(){return Math.max(0,W-Date.now())}}))});let C=!1;return{dispose(){C||(C=!0)}}}:runWhenIdle=(K,C)=>{const W=requestIdleCallback(K,typeof C=="number"?{timeout:C}:void 0);let V=!1;return{dispose(){V||(V=!0,cancelIdleCallback(W))}}}})();class IdleValue{constructor(C){this._didRun=!1,this._executor=()=>{try{this._value=C()}catch(W){this._error=W}finally{this._didRun=!0}},this._handle=runWhenIdle(()=>this._executor())}dispose(){this._handle.dispose()}get value(){if(this._didRun||(this._handle.dispose(),this._executor()),this._error)throw this._error;return this._value}get isInitialized(){return this._didRun}}class DeferredPromise{get isRejected(){var C;return((C=this.outcome)===null||C===void 0?void 0:C.outcome)===1}get isSettled(){return!!this.outcome}constructor(){this.p=new Promise((C,W)=>{this.completeCallback=C,this.errorCallback=W})}complete(C){return new Promise(W=>{this.completeCallback(C),this.outcome={outcome:0,value:C},W()})}error(C){return new Promise(W=>{this.errorCallback(C),this.outcome={outcome:1,value:C},W()})}cancel(){return this.error(new CancellationError)}}var Promises;(function(K){function C(V){return __awaiter$1z(this,void 0,void 0,function*(){let U;const G=yield Promise.all(V.map(Z=>Z.then(X=>X,X=>{U||(U=X)})));if(typeof U<"u")throw U;return G})}K.settled=C;function W(V){return new Promise((U,G)=>__awaiter$1z(this,void 0,void 0,function*(){try{yield V(U,G)}catch(Z){G(Z)}}))}K.withAsyncBody=W})(Promises||(Promises={}));class AsyncIterableObject{static fromArray(C){return new AsyncIterableObject(W=>{W.emitMany(C)})}static fromPromise(C){return new AsyncIterableObject(W=>__awaiter$1z(this,void 0,void 0,function*(){W.emitMany(yield C)}))}static fromPromises(C){return new AsyncIterableObject(W=>__awaiter$1z(this,void 0,void 0,function*(){yield Promise.all(C.map(V=>__awaiter$1z(this,void 0,void 0,function*(){return W.emitOne(yield V)})))}))}static merge(C){return new AsyncIterableObject(W=>__awaiter$1z(this,void 0,void 0,function*(){yield Promise.all(C.map(V=>{var U,G,Z;return __awaiter$1z(this,void 0,void 0,function*(){var X,Q,J,ee;try{for(U=!0,G=__asyncValues$2(V);Z=yield G.next(),X=Z.done,!X;U=!0){ee=Z.value,U=!1;const te=ee;W.emitOne(te)}}catch(te){Q={error:te}}finally{try{!U&&!X&&(J=G.return)&&(yield J.call(G))}finally{if(Q)throw Q.error}}})}))}))}constructor(C){this._state=0,this._results=[],this._error=null,this._onStateChanged=new Emitter$1,queueMicrotask(()=>__awaiter$1z(this,void 0,void 0,function*(){const W={emitOne:V=>this.emitOne(V),emitMany:V=>this.emitMany(V),reject:V=>this.reject(V)};try{yield Promise.resolve(C(W)),this.resolve()}catch(V){this.reject(V)}finally{W.emitOne=void 0,W.emitMany=void 0,W.reject=void 0}}))}[Symbol.asyncIterator](){let C=0;return{next:()=>__awaiter$1z(this,void 0,void 0,function*(){do{if(this._state===2)throw this._error;if(C<this._results.length)return{done:!1,value:this._results[C++]};if(this._state===1)return{done:!0,value:void 0};yield Event$1.toPromise(this._onStateChanged.event)}while(!0)})}}static map(C,W){return new AsyncIterableObject(V=>__awaiter$1z(this,void 0,void 0,function*(){var U,G,Z,X;try{for(var Q=!0,J=__asyncValues$2(C),ee;ee=yield J.next(),U=ee.done,!U;Q=!0){X=ee.value,Q=!1;const te=X;V.emitOne(W(te))}}catch(te){G={error:te}}finally{try{!Q&&!U&&(Z=J.return)&&(yield Z.call(J))}finally{if(G)throw G.error}}}))}map(C){return AsyncIterableObject.map(this,C)}static filter(C,W){return new AsyncIterableObject(V=>__awaiter$1z(this,void 0,void 0,function*(){var U,G,Z,X;try{for(var Q=!0,J=__asyncValues$2(C),ee;ee=yield J.next(),U=ee.done,!U;Q=!0){X=ee.value,Q=!1;const te=X;W(te)&&V.emitOne(te)}}catch(te){G={error:te}}finally{try{!Q&&!U&&(Z=J.return)&&(yield Z.call(J))}finally{if(G)throw G.error}}}))}filter(C){return AsyncIterableObject.filter(this,C)}static coalesce(C){return AsyncIterableObject.filter(C,W=>!!W)}coalesce(){return AsyncIterableObject.coalesce(this)}static toPromise(C){var W,V,U,G,Z,X,Q;return __awaiter$1z(this,void 0,void 0,function*(){const J=[];try{for(W=!0,V=__asyncValues$2(C);U=yield V.next(),G=U.done,!G;W=!0){Q=U.value,W=!1;const ee=Q;J.push(ee)}}catch(ee){Z={error:ee}}finally{try{!W&&!G&&(X=V.return)&&(yield X.call(V))}finally{if(Z)throw Z.error}}return J})}toPromise(){return AsyncIterableObject.toPromise(this)}emitOne(C){this._state===0&&(this._results.push(C),this._onStateChanged.fire())}emitMany(C){this._state===0&&(this._results=this._results.concat(C),this._onStateChanged.fire())}resolve(){this._state===0&&(this._state=1,this._onStateChanged.fire())}reject(C){this._state===0&&(this._state=2,this._error=C,this._onStateChanged.fire())}}AsyncIterableObject.EMPTY=AsyncIterableObject.fromArray([]);class CancelableAsyncIterableObject extends AsyncIterableObject{constructor(C,W){super(W),this._source=C}cancel(){this._source.cancel()}}function createCancelableAsyncIterable(K){const C=new CancellationTokenSource$1,W=K(C.token);return new CancelableAsyncIterableObject(C,V=>__awaiter$1z(this,void 0,void 0,function*(){var U,G,Z,X;const Q=C.token.onCancellationRequested(()=>{Q.dispose(),C.dispose(),V.reject(new CancellationError)});try{try{for(var J=!0,ee=__asyncValues$2(W),te;te=yield ee.next(),U=te.done,!U;J=!0){X=te.value,J=!1;const ie=X;if(C.token.isCancellationRequested)return;V.emitOne(ie)}}catch(ie){G={error:ie}}finally{try{!J&&!U&&(Z=ee.return)&&(yield Z.call(ee))}finally{if(G)throw G.error}}Q.dispose(),C.dispose()}catch(ie){Q.dispose(),C.dispose(),V.reject(ie)}}))}const INITIALIZE="$initialize";let webWorkerWarningLogged=!1;function logOnceWebWorkerWarning(K){isWeb&&(webWorkerWarningLogged||(webWorkerWarningLogged=!0,console.warn("Could not create web worker(s). Falling back to loading web worker code in main thread, which might cause UI freezes. Please see https://github.com/microsoft/monaco-editor#faq")),console.warn(K.message))}class RequestMessage{constructor(C,W,V,U){this.vsWorker=C,this.req=W,this.method=V,this.args=U,this.type=0}}class ReplyMessage{constructor(C,W,V,U){this.vsWorker=C,this.seq=W,this.res=V,this.err=U,this.type=1}}class SubscribeEventMessage{constructor(C,W,V,U){this.vsWorker=C,this.req=W,this.eventName=V,this.arg=U,this.type=2}}class EventMessage{constructor(C,W,V){this.vsWorker=C,this.req=W,this.event=V,this.type=3}}class UnsubscribeEventMessage{constructor(C,W){this.vsWorker=C,this.req=W,this.type=4}}class SimpleWorkerProtocol{constructor(C){this._workerId=-1,this._handler=C,this._lastSentReq=0,this._pendingReplies=Object.create(null),this._pendingEmitters=new Map,this._pendingEvents=new Map}setWorkerId(C){this._workerId=C}sendMessage(C,W){const V=String(++this._lastSentReq);return new Promise((U,G)=>{this._pendingReplies[V]={resolve:U,reject:G},this._send(new RequestMessage(this._workerId,V,C,W))})}listen(C,W){let V=null;const U=new Emitter$1({onWillAddFirstListener:()=>{V=String(++this._lastSentReq),this._pendingEmitters.set(V,U),this._send(new SubscribeEventMessage(this._workerId,V,C,W))},onDidRemoveLastListener:()=>{this._pendingEmitters.delete(V),this._send(new UnsubscribeEventMessage(this._workerId,V)),V=null}});return U.event}handleMessage(C){!C||!C.vsWorker||this._workerId!==-1&&C.vsWorker!==this._workerId||this._handleMessage(C)}_handleMessage(C){switch(C.type){case 1:return this._handleReplyMessage(C);case 0:return this._handleRequestMessage(C);case 2:return this._handleSubscribeEventMessage(C);case 3:return this._handleEventMessage(C);case 4:return this._handleUnsubscribeEventMessage(C)}}_handleReplyMessage(C){if(!this._pendingReplies[C.seq]){console.warn("Got reply to unknown seq");return}const W=this._pendingReplies[C.seq];if(delete this._pendingReplies[C.seq],C.err){let V=C.err;C.err.$isError&&(V=new Error,V.name=C.err.name,V.message=C.err.message,V.stack=C.err.stack),W.reject(V);return}W.resolve(C.res)}_handleRequestMessage(C){const W=C.req;this._handler.handleMessage(C.method,C.args).then(U=>{this._send(new ReplyMessage(this._workerId,W,U,void 0))},U=>{U.detail instanceof Error&&(U.detail=transformErrorForSerialization(U.detail)),this._send(new ReplyMessage(this._workerId,W,void 0,transformErrorForSerialization(U)))})}_handleSubscribeEventMessage(C){const W=C.req,V=this._handler.handleEvent(C.eventName,C.arg)(U=>{this._send(new EventMessage(this._workerId,W,U))});this._pendingEvents.set(W,V)}_handleEventMessage(C){if(!this._pendingEmitters.has(C.req)){console.warn("Got event for unknown req");return}this._pendingEmitters.get(C.req).fire(C.event)}_handleUnsubscribeEventMessage(C){if(!this._pendingEvents.has(C.req)){console.warn("Got unsubscribe for unknown req");return}this._pendingEvents.get(C.req).dispose(),this._pendingEvents.delete(C.req)}_send(C){const W=[];if(C.type===0)for(let V=0;V<C.args.length;V++)C.args[V]instanceof ArrayBuffer&&W.push(C.args[V]);else C.type===1&&C.res instanceof ArrayBuffer&&W.push(C.res);this._handler.sendMessage(C,W)}}class SimpleWorkerClient extends Disposable{constructor(C,W,V){super();let U=null;this._worker=this._register(C.create("vs/base/common/worker/simpleWorker",ee=>{this._protocol.handleMessage(ee)},ee=>{U==null||U(ee)})),this._protocol=new SimpleWorkerProtocol({sendMessage:(ee,te)=>{this._worker.postMessage(ee,te)},handleMessage:(ee,te)=>{if(typeof V[ee]!="function")return Promise.reject(new Error("Missing method "+ee+" on main thread host."));try{return Promise.resolve(V[ee].apply(V,te))}catch(ie){return Promise.reject(ie)}},handleEvent:(ee,te)=>{if(propertyIsDynamicEvent(ee)){const ie=V[ee].call(V,te);if(typeof ie!="function")throw new Error(`Missing dynamic event ${ee} on main thread host.`);return ie}if(propertyIsEvent(ee)){const ie=V[ee];if(typeof ie!="function")throw new Error(`Missing event ${ee} on main thread host.`);return ie}throw new Error(`Malformed event name ${ee}`)}}),this._protocol.setWorkerId(this._worker.getId());let G=null;const Z=globalThis.require;typeof Z<"u"&&typeof Z.getConfig=="function"?G=Z.getConfig():typeof globalThis.requirejs<"u"&&(G=globalThis.requirejs.s.contexts._.config);const X=getAllMethodNames(V);this._onModuleLoaded=this._protocol.sendMessage(INITIALIZE,[this._worker.getId(),JSON.parse(JSON.stringify(G)),W,X]);const Q=(ee,te)=>this._request(ee,te),J=(ee,te)=>this._protocol.listen(ee,te);this._lazyProxy=new Promise((ee,te)=>{U=te,this._onModuleLoaded.then(ie=>{ee(createProxyObject(ie,Q,J))},ie=>{te(ie),this._onError("Worker failed to load "+W,ie)})})}getProxyObject(){return this._lazyProxy}_request(C,W){return new Promise((V,U)=>{this._onModuleLoaded.then(()=>{this._protocol.sendMessage(C,W).then(V,U)},U)})}_onError(C,W){console.error(C),console.info(W)}}function propertyIsEvent(K){return K[0]==="o"&&K[1]==="n"&&isUpperAsciiLetter(K.charCodeAt(2))}function propertyIsDynamicEvent(K){return/^onDynamic/.test(K)&&isUpperAsciiLetter(K.charCodeAt(9))}function createProxyObject(K,C,W){const V=Z=>function(){const X=Array.prototype.slice.call(arguments,0);return C(Z,X)},U=Z=>function(X){return W(Z,X)},G={};for(const Z of K){if(propertyIsDynamicEvent(Z)){G[Z]=U(Z);continue}if(propertyIsEvent(Z)){G[Z]=W(Z,void 0);continue}G[Z]=V(Z)}return G}function createTrustedTypesPolicy(K,C){var W;const V=globalThis.MonacoEnvironment;if(V!=null&&V.createTrustedTypesPolicy)try{return V.createTrustedTypesPolicy(K,C)}catch(U){onUnexpectedError(U);return}try{return(W=window.trustedTypes)===null||W===void 0?void 0:W.createPolicy(K,C)}catch(U){onUnexpectedError(U);return}}const ttPolicy$4=createTrustedTypesPolicy("defaultWorkerFactory",{createScriptURL:K=>K});function getWorker(K){const C=globalThis.MonacoEnvironment;if(C){if(typeof C.getWorker=="function")return C.getWorker("workerMain.js",K);if(typeof C.getWorkerUrl=="function"){const W=C.getWorkerUrl("workerMain.js",K);return new Worker(ttPolicy$4?ttPolicy$4.createScriptURL(W):W,{name:K})}}throw new Error("You must define a function MonacoEnvironment.getWorkerUrl or MonacoEnvironment.getWorker")}function isPromiseLike(K){return typeof K.then=="function"}class WebWorker{constructor(C,W,V,U,G){this.id=W,this.label=V;const Z=getWorker(V);isPromiseLike(Z)?this.worker=Z:this.worker=Promise.resolve(Z),this.postMessage(C,[]),this.worker.then(X=>{X.onmessage=function(Q){U(Q.data)},X.onmessageerror=G,typeof X.addEventListener=="function"&&X.addEventListener("error",G)})}getId(){return this.id}postMessage(C,W){var V;(V=this.worker)===null||V===void 0||V.then(U=>{try{U.postMessage(C,W)}catch(G){onUnexpectedError(G),onUnexpectedError(new Error(`FAILED to post message to '${this.label}'-worker`,{cause:G}))}})}dispose(){var C;(C=this.worker)===null||C===void 0||C.then(W=>W.terminate()),this.worker=null}}class DefaultWorkerFactory{constructor(C){this._label=C,this._webWorkerFailedBeforeError=!1}create(C,W,V){const U=++DefaultWorkerFactory.LAST_WORKER_ID;if(this._webWorkerFailedBeforeError)throw this._webWorkerFailedBeforeError;return new WebWorker(C,U,this._label||"anonymous"+U,W,G=>{logOnceWebWorkerWarning(G),this._webWorkerFailedBeforeError=G,V(G)})}}DefaultWorkerFactory.LAST_WORKER_ID=0;var IndentAction;(function(K){K[K.None=0]="None",K[K.Indent=1]="Indent",K[K.IndentOutdent=2]="IndentOutdent",K[K.Outdent=3]="Outdent"})(IndentAction||(IndentAction={}));class StandardAutoClosingPairConditional{constructor(C){if(this._neutralCharacter=null,this._neutralCharacterSearched=!1,this.open=C.open,this.close=C.close,this._inString=!0,this._inComment=!0,this._inRegEx=!0,Array.isArray(C.notIn))for(let W=0,V=C.notIn.length;W<V;W++)switch(C.notIn[W]){case"string":this._inString=!1;break;case"comment":this._inComment=!1;break;case"regex":this._inRegEx=!1;break}}isOK(C){switch(C){case 0:return!0;case 1:return this._inComment;case 2:return this._inString;case 3:return this._inRegEx}}shouldAutoClose(C,W){if(C.getTokenCount()===0)return!0;const V=C.findTokenIndexAtOffset(W-2),U=C.getStandardTokenType(V);return this.isOK(U)}_findNeutralCharacterInRange(C,W){for(let V=C;V<=W;V++){const U=String.fromCharCode(V);if(!this.open.includes(U)&&!this.close.includes(U))return U}return null}findNeutralCharacter(){return this._neutralCharacterSearched||(this._neutralCharacterSearched=!0,this._neutralCharacter||(this._neutralCharacter=this._findNeutralCharacterInRange(48,57)),this._neutralCharacter||(this._neutralCharacter=this._findNeutralCharacterInRange(97,122)),this._neutralCharacter||(this._neutralCharacter=this._findNeutralCharacterInRange(65,90))),this._neutralCharacter}}class AutoClosingPairs{constructor(C){this.autoClosingPairsOpenByStart=new Map,this.autoClosingPairsOpenByEnd=new Map,this.autoClosingPairsCloseByStart=new Map,this.autoClosingPairsCloseByEnd=new Map,this.autoClosingPairsCloseSingleChar=new Map;for(const W of C)appendEntry(this.autoClosingPairsOpenByStart,W.open.charAt(0),W),appendEntry(this.autoClosingPairsOpenByEnd,W.open.charAt(W.open.length-1),W),appendEntry(this.autoClosingPairsCloseByStart,W.close.charAt(0),W),appendEntry(this.autoClosingPairsCloseByEnd,W.close.charAt(W.close.length-1),W),W.close.length===1&&W.open.length===1&&appendEntry(this.autoClosingPairsCloseSingleChar,W.close,W)}}function appendEntry(K,C,W){K.has(C)?K.get(C).push(W):K.set(C,[W])}function createScopedLineTokens(K,C){const W=K.getCount(),V=K.findTokenIndexAtOffset(C),U=K.getLanguageId(V);let G=V;for(;G+1<W&&K.getLanguageId(G+1)===U;)G++;let Z=V;for(;Z>0&&K.getLanguageId(Z-1)===U;)Z--;return new ScopedLineTokens(K,U,Z,G+1,K.getStartOffset(Z),K.getEndOffset(G))}class ScopedLineTokens{constructor(C,W,V,U,G,Z){this._scopedLineTokensBrand=void 0,this._actual=C,this.languageId=W,this._firstTokenIndex=V,this._lastTokenIndex=U,this.firstCharOffset=G,this._lastCharOffset=Z}getLineContent(){return this._actual.getLineContent().substring(this.firstCharOffset,this._lastCharOffset)}getActualLineContentBefore(C){return this._actual.getLineContent().substring(0,this.firstCharOffset+C)}getTokenCount(){return this._lastTokenIndex-this._firstTokenIndex}findTokenIndexAtOffset(C){return this._actual.findTokenIndexAtOffset(C+this.firstCharOffset)-this._firstTokenIndex}getStandardTokenType(C){return this._actual.getStandardTokenType(C+this._firstTokenIndex)}}function ignoreBracketsInToken(K){return(K&3)!==0}class CharacterPairSupport{constructor(C){if(C.autoClosingPairs?this._autoClosingPairs=C.autoClosingPairs.map(W=>new StandardAutoClosingPairConditional(W)):C.brackets?this._autoClosingPairs=C.brackets.map(W=>new StandardAutoClosingPairConditional({open:W[0],close:W[1]})):this._autoClosingPairs=[],C.__electricCharacterSupport&&C.__electricCharacterSupport.docComment){const W=C.__electricCharacterSupport.docComment;this._autoClosingPairs.push(new StandardAutoClosingPairConditional({open:W.open,close:W.close||""}))}this._autoCloseBeforeForQuotes=typeof C.autoCloseBefore=="string"?C.autoCloseBefore:CharacterPairSupport.DEFAULT_AUTOCLOSE_BEFORE_LANGUAGE_DEFINED_QUOTES,this._autoCloseBeforeForBrackets=typeof C.autoCloseBefore=="string"?C.autoCloseBefore:CharacterPairSupport.DEFAULT_AUTOCLOSE_BEFORE_LANGUAGE_DEFINED_BRACKETS,this._surroundingPairs=C.surroundingPairs||this._autoClosingPairs}getAutoClosingPairs(){return this._autoClosingPairs}getAutoCloseBeforeSet(C){return C?this._autoCloseBeforeForQuotes:this._autoCloseBeforeForBrackets}getSurroundingPairs(){return this._surroundingPairs}}CharacterPairSupport.DEFAULT_AUTOCLOSE_BEFORE_LANGUAGE_DEFINED_QUOTES=`;:.,=}])> 
	`;CharacterPairSupport.DEFAULT_AUTOCLOSE_BEFORE_LANGUAGE_DEFINED_BRACKETS=`'"\`;:.,=}])> 
	`;const hasBuffer=typeof Buffer<"u";let textDecoder;class VSBuffer{static wrap(C){return hasBuffer&&!Buffer.isBuffer(C)&&(C=Buffer.from(C.buffer,C.byteOffset,C.byteLength)),new VSBuffer(C)}constructor(C){this.buffer=C,this.byteLength=this.buffer.byteLength}toString(){return hasBuffer?this.buffer.toString():(textDecoder||(textDecoder=new TextDecoder),textDecoder.decode(this.buffer))}}function readUInt16LE(K,C){return K[C+0]<<0>>>0|K[C+1]<<8>>>0}function writeUInt16LE(K,C,W){K[W+0]=C&255,C=C>>>8,K[W+1]=C&255}function readUInt32BE(K,C){return K[C]*Math.pow(2,24)+K[C+1]*Math.pow(2,16)+K[C+2]*Math.pow(2,8)+K[C+3]}function writeUInt32BE(K,C,W){K[W+3]=C,C=C>>>8,K[W+2]=C,C=C>>>8,K[W+1]=C,C=C>>>8,K[W]=C}function readUInt8(K,C){return K[C]}function writeUInt8(K,C,W){K[W]=C}let _utf16LE_TextDecoder;function getUTF16LE_TextDecoder(){return _utf16LE_TextDecoder||(_utf16LE_TextDecoder=new TextDecoder("UTF-16LE")),_utf16LE_TextDecoder}let _utf16BE_TextDecoder;function getUTF16BE_TextDecoder(){return _utf16BE_TextDecoder||(_utf16BE_TextDecoder=new TextDecoder("UTF-16BE")),_utf16BE_TextDecoder}let _platformTextDecoder;function getPlatformTextDecoder(){return _platformTextDecoder||(_platformTextDecoder=isLittleEndian()?getUTF16LE_TextDecoder():getUTF16BE_TextDecoder()),_platformTextDecoder}function decodeUTF16LE(K,C,W){const V=new Uint16Array(K.buffer,C,W);return W>0&&(V[0]===65279||V[0]===65534)?compatDecodeUTF16LE(K,C,W):getUTF16LE_TextDecoder().decode(V)}function compatDecodeUTF16LE(K,C,W){const V=[];let U=0;for(let G=0;G<W;G++){const Z=readUInt16LE(K,C);C+=2,V[U++]=String.fromCharCode(Z)}return V.join("")}class StringBuilder{constructor(C){this._capacity=C|0,this._buffer=new Uint16Array(this._capacity),this._completedStrings=null,this._bufferLength=0}reset(){this._completedStrings=null,this._bufferLength=0}build(){return this._completedStrings!==null?(this._flushBuffer(),this._completedStrings.join("")):this._buildBuffer()}_buildBuffer(){if(this._bufferLength===0)return"";const C=new Uint16Array(this._buffer.buffer,0,this._bufferLength);return getPlatformTextDecoder().decode(C)}_flushBuffer(){const C=this._buildBuffer();this._bufferLength=0,this._completedStrings===null?this._completedStrings=[C]:this._completedStrings[this._completedStrings.length]=C}appendCharCode(C){const W=this._capacity-this._bufferLength;W<=1&&(W===0||isHighSurrogate(C))&&this._flushBuffer(),this._buffer[this._bufferLength++]=C}appendASCIICharCode(C){this._bufferLength===this._capacity&&this._flushBuffer(),this._buffer[this._bufferLength++]=C}appendString(C){const W=C.length;if(this._bufferLength+W>=this._capacity){this._flushBuffer(),this._completedStrings[this._completedStrings.length]=C;return}for(let V=0;V<W;V++)this._buffer[this._bufferLength++]=C.charCodeAt(V)}}class RichEditBracket{constructor(C,W,V,U,G,Z){this._richEditBracketBrand=void 0,this.languageId=C,this.index=W,this.open=V,this.close=U,this.forwardRegex=G,this.reversedRegex=Z,this._openSet=RichEditBracket._toSet(this.open),this._closeSet=RichEditBracket._toSet(this.close)}isOpen(C){return this._openSet.has(C)}isClose(C){return this._closeSet.has(C)}static _toSet(C){const W=new Set;for(const V of C)W.add(V);return W}}function groupFuzzyBrackets(K){const C=K.length;K=K.map(Z=>[Z[0].toLowerCase(),Z[1].toLowerCase()]);const W=[];for(let Z=0;Z<C;Z++)W[Z]=Z;const V=(Z,X)=>{const[Q,J]=Z,[ee,te]=X;return Q===ee||Q===te||J===ee||J===te},U=(Z,X)=>{const Q=Math.min(Z,X),J=Math.max(Z,X);for(let ee=0;ee<C;ee++)W[ee]===J&&(W[ee]=Q)};for(let Z=0;Z<C;Z++){const X=K[Z];for(let Q=Z+1;Q<C;Q++){const J=K[Q];V(X,J)&&U(W[Z],W[Q])}}const G=[];for(let Z=0;Z<C;Z++){const X=[],Q=[];for(let J=0;J<C;J++)if(W[J]===Z){const[ee,te]=K[J];X.push(ee),Q.push(te)}X.length>0&&G.push({open:X,close:Q})}return G}class RichEditBrackets{constructor(C,W){this._richEditBracketsBrand=void 0;const V=groupFuzzyBrackets(W);this.brackets=V.map((U,G)=>new RichEditBracket(C,G,U.open,U.close,getRegexForBracketPair(U.open,U.close,V,G),getReversedRegexForBracketPair(U.open,U.close,V,G))),this.forwardRegex=getRegexForBrackets(this.brackets),this.reversedRegex=getReversedRegexForBrackets(this.brackets),this.textIsBracket={},this.textIsOpenBracket={},this.maxBracketLength=0;for(const U of this.brackets){for(const G of U.open)this.textIsBracket[G]=U,this.textIsOpenBracket[G]=!0,this.maxBracketLength=Math.max(this.maxBracketLength,G.length);for(const G of U.close)this.textIsBracket[G]=U,this.textIsOpenBracket[G]=!1,this.maxBracketLength=Math.max(this.maxBracketLength,G.length)}}}function collectSuperstrings(K,C,W,V){for(let U=0,G=C.length;U<G;U++){if(U===W)continue;const Z=C[U];for(const X of Z.open)X.indexOf(K)>=0&&V.push(X);for(const X of Z.close)X.indexOf(K)>=0&&V.push(X)}}function lengthcmp(K,C){return K.length-C.length}function unique(K){if(K.length<=1)return K;const C=[],W=new Set;for(const V of K)W.has(V)||(C.push(V),W.add(V));return C}function getRegexForBracketPair(K,C,W,V){let U=[];U=U.concat(K),U=U.concat(C);for(let G=0,Z=U.length;G<Z;G++)collectSuperstrings(U[G],W,V,U);return U=unique(U),U.sort(lengthcmp),U.reverse(),createBracketOrRegExp(U)}function getReversedRegexForBracketPair(K,C,W,V){let U=[];U=U.concat(K),U=U.concat(C);for(let G=0,Z=U.length;G<Z;G++)collectSuperstrings(U[G],W,V,U);return U=unique(U),U.sort(lengthcmp),U.reverse(),createBracketOrRegExp(U.map(toReversedString))}function getRegexForBrackets(K){let C=[];for(const W of K){for(const V of W.open)C.push(V);for(const V of W.close)C.push(V)}return C=unique(C),createBracketOrRegExp(C)}function getReversedRegexForBrackets(K){let C=[];for(const W of K){for(const V of W.open)C.push(V);for(const V of W.close)C.push(V)}return C=unique(C),createBracketOrRegExp(C.map(toReversedString))}function prepareBracketForRegExp$1(K){const C=/^[\w ]+$/.test(K);return K=escapeRegExpCharacters(K),C?`\\b${K}\\b`:K}function createBracketOrRegExp(K){const C=`(${K.map(prepareBracketForRegExp$1).join(")|(")})`;return createRegExp(C,!0)}const toReversedString=function(){function K(V){const U=new Uint16Array(V.length);let G=0;for(let Z=V.length-1;Z>=0;Z--)U[G++]=V.charCodeAt(Z);return getPlatformTextDecoder().decode(U)}let C=null,W=null;return function(U){return C!==U&&(C=U,W=K(C)),W}}();class BracketsUtils{static _findPrevBracketInText(C,W,V,U){const G=V.match(C);if(!G)return null;const Z=V.length-(G.index||0),X=G[0].length,Q=U+Z;return new Range$2(W,Q-X+1,W,Q+1)}static findPrevBracketInRange(C,W,V,U,G){const X=toReversedString(V).substring(V.length-G,V.length-U);return this._findPrevBracketInText(C,W,X,U)}static findNextBracketInText(C,W,V,U){const G=V.match(C);if(!G)return null;const Z=G.index||0,X=G[0].length;if(X===0)return null;const Q=U+Z;return new Range$2(W,Q+1,W,Q+1+X)}static findNextBracketInRange(C,W,V,U,G){const Z=V.substring(U,G);return this.findNextBracketInText(C,W,Z,U)}}class BracketElectricCharacterSupport{constructor(C){this._richEditBrackets=C}getElectricCharacters(){const C=[];if(this._richEditBrackets)for(const W of this._richEditBrackets.brackets)for(const V of W.close){const U=V.charAt(V.length-1);C.push(U)}return distinct(C)}onElectricCharacter(C,W,V){if(!this._richEditBrackets||this._richEditBrackets.brackets.length===0)return null;const U=W.findTokenIndexAtOffset(V-1);if(ignoreBracketsInToken(W.getStandardTokenType(U)))return null;const G=this._richEditBrackets.reversedRegex,Z=W.getLineContent().substring(0,V-1)+C,X=BracketsUtils.findPrevBracketInRange(G,1,Z,0,Z.length);if(!X)return null;const Q=Z.substring(X.startColumn-1,X.endColumn-1).toLowerCase();if(this._richEditBrackets.textIsOpenBracket[Q])return null;const ee=W.getActualLineContentBefore(X.startColumn-1);return/^\s*$/.test(ee)?{matchOpenBracket:Q}:null}}function resetGlobalRegex(K){return K.global&&(K.lastIndex=0),!0}class IndentRulesSupport{constructor(C){this._indentationRules=C}shouldIncrease(C){return!!(this._indentationRules&&this._indentationRules.increaseIndentPattern&&resetGlobalRegex(this._indentationRules.increaseIndentPattern)&&this._indentationRules.increaseIndentPattern.test(C))}shouldDecrease(C){return!!(this._indentationRules&&this._indentationRules.decreaseIndentPattern&&resetGlobalRegex(this._indentationRules.decreaseIndentPattern)&&this._indentationRules.decreaseIndentPattern.test(C))}shouldIndentNextLine(C){return!!(this._indentationRules&&this._indentationRules.indentNextLinePattern&&resetGlobalRegex(this._indentationRules.indentNextLinePattern)&&this._indentationRules.indentNextLinePattern.test(C))}shouldIgnore(C){return!!(this._indentationRules&&this._indentationRules.unIndentedLinePattern&&resetGlobalRegex(this._indentationRules.unIndentedLinePattern)&&this._indentationRules.unIndentedLinePattern.test(C))}getIndentMetadata(C){let W=0;return this.shouldIncrease(C)&&(W+=1),this.shouldDecrease(C)&&(W+=2),this.shouldIndentNextLine(C)&&(W+=4),this.shouldIgnore(C)&&(W+=8),W}}class OnEnterSupport{constructor(C){C=C||{},C.brackets=C.brackets||[["(",")"],["{","}"],["[","]"]],this._brackets=[],C.brackets.forEach(W=>{const V=OnEnterSupport._createOpenBracketRegExp(W[0]),U=OnEnterSupport._createCloseBracketRegExp(W[1]);V&&U&&this._brackets.push({open:W[0],openRegExp:V,close:W[1],closeRegExp:U})}),this._regExpRules=C.onEnterRules||[]}onEnter(C,W,V,U){if(C>=3)for(let G=0,Z=this._regExpRules.length;G<Z;G++){const X=this._regExpRules[G];if([{reg:X.beforeText,text:V},{reg:X.afterText,text:U},{reg:X.previousLineText,text:W}].every(J=>J.reg?(J.reg.lastIndex=0,J.reg.test(J.text)):!0))return X.action}if(C>=2&&V.length>0&&U.length>0)for(let G=0,Z=this._brackets.length;G<Z;G++){const X=this._brackets[G];if(X.openRegExp.test(V)&&X.closeRegExp.test(U))return{indentAction:IndentAction.IndentOutdent}}if(C>=2&&V.length>0){for(let G=0,Z=this._brackets.length;G<Z;G++)if(this._brackets[G].openRegExp.test(V))return{indentAction:IndentAction.Indent}}return null}static _createOpenBracketRegExp(C){let W=escapeRegExpCharacters(C);return/\B/.test(W.charAt(0))||(W="\\b"+W),W+="\\s*$",OnEnterSupport._safeRegExp(W)}static _createCloseBracketRegExp(C){let W=escapeRegExpCharacters(C);return/\B/.test(W.charAt(W.length-1))||(W=W+"\\b"),W="^\\s*"+W,OnEnterSupport._safeRegExp(W)}static _safeRegExp(C){try{return new RegExp(C)}catch(W){return onUnexpectedError(W),null}}}const IConfigurationService=createDecorator("configurationService");function toValuesTree(K,C){const W=Object.create(null);for(const V in K)addToValueTree(W,V,K[V],C);return W}function addToValueTree(K,C,W,V){const U=C.split("."),G=U.pop();let Z=K;for(let X=0;X<U.length;X++){const Q=U[X];let J=Z[Q];switch(typeof J){case"undefined":J=Z[Q]=Object.create(null);break;case"object":break;default:V(`Ignoring ${C} as ${U.slice(0,X+1).join(".")} is ${JSON.stringify(J)}`);return}Z=J}if(typeof Z=="object"&&Z!==null)try{Z[G]=W}catch{V(`Ignoring ${C} as ${U.join(".")} is ${JSON.stringify(Z)}`)}else V(`Ignoring ${C} as ${U.join(".")} is ${JSON.stringify(Z)}`)}function removeFromValueTree(K,C){const W=C.split(".");doRemoveFromValueTree(K,W)}function doRemoveFromValueTree(K,C){const W=C.shift();if(C.length===0){delete K[W];return}if(Object.keys(K).indexOf(W)!==-1){const V=K[W];typeof V=="object"&&!Array.isArray(V)&&(doRemoveFromValueTree(V,C),Object.keys(V).length===0&&delete K[W])}}function getConfigurationValue(K,C,W){function V(Z,X){let Q=Z;for(const J of X){if(typeof Q!="object"||Q===null)return;Q=Q[J]}return Q}const U=C.split("."),G=V(K,U);return typeof G>"u"?W:G}function getLanguageTagSettingPlainKey(K){return K.replace(/[\[\]]/g,"")}const ILanguageService=createDecorator("languageService");class SyncDescriptor{constructor(C,W=[],V=!1){this.ctor=C,this.staticArguments=W,this.supportsDelayedInstantiation=V}}const _registry=[];function registerSingleton(K,C,W){C instanceof SyncDescriptor||(C=new SyncDescriptor(C,[],!!W)),_registry.push([K,C])}function getSingletonServiceDescriptors(){return _registry}const Mimes=Object.freeze({text:"text/plain",binary:"application/octet-stream",unknown:"application/unknown",markdown:"text/markdown",latex:"text/latex",uriList:"text/uri-list"}),Extensions$7={JSONContribution:"base.contributions.json"};function normalizeId(K){return K.length>0&&K.charAt(K.length-1)==="#"?K.substring(0,K.length-1):K}class JSONContributionRegistry{constructor(){this._onDidChangeSchema=new Emitter$1,this.schemasById={}}registerSchema(C,W){this.schemasById[normalizeId(C)]=W,this._onDidChangeSchema.fire(C)}notifySchemaChanged(C){this._onDidChangeSchema.fire(C)}}const jsonContributionRegistry=new JSONContributionRegistry;Registry.add(Extensions$7.JSONContribution,jsonContributionRegistry);const Extensions$6={Configuration:"base.contributions.configuration"},resourceLanguageSettingsSchemaId="vscode://schemas/settings/resourceLanguage",contributionRegistry=Registry.as(Extensions$7.JSONContribution);class ConfigurationRegistry{constructor(){this.overrideIdentifiers=new Set,this._onDidSchemaChange=new Emitter$1,this._onDidUpdateConfiguration=new Emitter$1,this.configurationDefaultsOverrides=new Map,this.defaultLanguageConfigurationOverridesNode={id:"defaultOverrides",title:localize("defaultLanguageConfigurationOverrides.title","Default Language Configuration Overrides"),properties:{}},this.configurationContributors=[this.defaultLanguageConfigurationOverridesNode],this.resourceLanguageSettingsSchema={properties:{},patternProperties:{},additionalProperties:!0,allowTrailingCommas:!0,allowComments:!0},this.configurationProperties={},this.policyConfigurations=new Map,this.excludedConfigurationProperties={},contributionRegistry.registerSchema(resourceLanguageSettingsSchemaId,this.resourceLanguageSettingsSchema),this.registerOverridePropertyPatternKey()}registerConfiguration(C,W=!0){this.registerConfigurations([C],W)}registerConfigurations(C,W=!0){const V=new Set;this.doRegisterConfigurations(C,W,V),contributionRegistry.registerSchema(resourceLanguageSettingsSchemaId,this.resourceLanguageSettingsSchema),this._onDidSchemaChange.fire(),this._onDidUpdateConfiguration.fire({properties:V})}registerDefaultConfigurations(C){const W=new Set;this.doRegisterDefaultConfigurations(C,W),this._onDidSchemaChange.fire(),this._onDidUpdateConfiguration.fire({properties:W,defaultsOverrides:!0})}doRegisterDefaultConfigurations(C,W){var V;const U=[];for(const{overrides:G,source:Z}of C)for(const X in G)if(W.add(X),OVERRIDE_PROPERTY_REGEX.test(X)){const Q=this.configurationDefaultsOverrides.get(X),J=(V=Q==null?void 0:Q.valuesSources)!==null&&V!==void 0?V:new Map;if(Z)for(const ne of Object.keys(G[X]))J.set(ne,Z);const ee=Object.assign(Object.assign({},(Q==null?void 0:Q.value)||{}),G[X]);this.configurationDefaultsOverrides.set(X,{source:Z,value:ee,valuesSources:J});const te=getLanguageTagSettingPlainKey(X),ie={type:"object",default:ee,description:localize("defaultLanguageConfiguration.description","Configure settings to be overridden for the {0} language.",te),$ref:resourceLanguageSettingsSchemaId,defaultDefaultValue:ee,source:isString$3(Z)?void 0:Z,defaultValueSource:Z};U.push(...overrideIdentifiersFromKey(X)),this.configurationProperties[X]=ie,this.defaultLanguageConfigurationOverridesNode.properties[X]=ie}else{this.configurationDefaultsOverrides.set(X,{value:G[X],source:Z});const Q=this.configurationProperties[X];Q&&(this.updatePropertyDefaultValue(X,Q),this.updateSchema(X,Q))}this.doRegisterOverrideIdentifiers(U)}registerOverrideIdentifiers(C){this.doRegisterOverrideIdentifiers(C),this._onDidSchemaChange.fire()}doRegisterOverrideIdentifiers(C){for(const W of C)this.overrideIdentifiers.add(W);this.updateOverridePropertyPatternKey()}doRegisterConfigurations(C,W,V){C.forEach(U=>{this.validateAndRegisterProperties(U,W,U.extensionInfo,U.restrictedProperties,void 0,V),this.configurationContributors.push(U),this.registerJSONConfiguration(U)})}validateAndRegisterProperties(C,W=!0,V,U,G=3,Z){var X;G=isUndefinedOrNull(C.scope)?G:C.scope;const Q=C.properties;if(Q)for(const ee in Q){const te=Q[ee];if(W&&validateProperty(ee,te)){delete Q[ee];continue}if(te.source=V,te.defaultDefaultValue=Q[ee].default,this.updatePropertyDefaultValue(ee,te),OVERRIDE_PROPERTY_REGEX.test(ee)?te.scope=void 0:(te.scope=isUndefinedOrNull(te.scope)?G:te.scope,te.restricted=isUndefinedOrNull(te.restricted)?!!(U!=null&&U.includes(ee)):te.restricted),Q[ee].hasOwnProperty("included")&&!Q[ee].included){this.excludedConfigurationProperties[ee]=Q[ee],delete Q[ee];continue}else this.configurationProperties[ee]=Q[ee],!((X=Q[ee].policy)===null||X===void 0)&&X.name&&this.policyConfigurations.set(Q[ee].policy.name,ee);!Q[ee].deprecationMessage&&Q[ee].markdownDeprecationMessage&&(Q[ee].deprecationMessage=Q[ee].markdownDeprecationMessage),Z.add(ee)}const J=C.allOf;if(J)for(const ee of J)this.validateAndRegisterProperties(ee,W,V,U,G,Z)}getConfigurationProperties(){return this.configurationProperties}getPolicyConfigurations(){return this.policyConfigurations}registerJSONConfiguration(C){const W=V=>{const U=V.properties;if(U)for(const Z in U)this.updateSchema(Z,U[Z]);const G=V.allOf;G==null||G.forEach(W)};W(C)}updateSchema(C,W){switch(W.scope){case 1:break;case 2:break;case 6:break;case 3:break;case 4:break;case 5:this.resourceLanguageSettingsSchema.properties[C]=W;break}}updateOverridePropertyPatternKey(){for(const C of this.overrideIdentifiers.values()){const W=`[${C}]`,V={type:"object",description:localize("overrideSettings.defaultDescription","Configure editor settings to be overridden for a language."),errorMessage:localize("overrideSettings.errorMessage","This setting does not support per-language configuration."),$ref:resourceLanguageSettingsSchemaId};this.updatePropertyDefaultValue(W,V)}}registerOverridePropertyPatternKey(){localize("overrideSettings.defaultDescription","Configure editor settings to be overridden for a language."),localize("overrideSettings.errorMessage","This setting does not support per-language configuration."),this._onDidSchemaChange.fire()}updatePropertyDefaultValue(C,W){const V=this.configurationDefaultsOverrides.get(C);let U=V==null?void 0:V.value,G=V==null?void 0:V.source;isUndefined$2(U)&&(U=W.defaultDefaultValue,G=void 0),isUndefined$2(U)&&(U=getDefaultValue(W.type)),W.default=U,W.defaultValueSource=G}}const OVERRIDE_IDENTIFIER_PATTERN="\\[([^\\]]+)\\]",OVERRIDE_IDENTIFIER_REGEX=new RegExp(OVERRIDE_IDENTIFIER_PATTERN,"g"),OVERRIDE_PROPERTY_PATTERN=`^(${OVERRIDE_IDENTIFIER_PATTERN})+$`,OVERRIDE_PROPERTY_REGEX=new RegExp(OVERRIDE_PROPERTY_PATTERN);function overrideIdentifiersFromKey(K){const C=[];if(OVERRIDE_PROPERTY_REGEX.test(K)){let W=OVERRIDE_IDENTIFIER_REGEX.exec(K);for(;W!=null&&W.length;){const V=W[1].trim();V&&C.push(V),W=OVERRIDE_IDENTIFIER_REGEX.exec(K)}}return distinct(C)}function getDefaultValue(K){switch(Array.isArray(K)?K[0]:K){case"boolean":return!1;case"integer":case"number":return 0;case"string":return"";case"array":return[];case"object":return{};default:return null}}const configurationRegistry$2=new ConfigurationRegistry;Registry.add(Extensions$6.Configuration,configurationRegistry$2);function validateProperty(K,C){var W,V,U,G;return K.trim()?OVERRIDE_PROPERTY_REGEX.test(K)?localize("config.property.languageDefault","Cannot register '{0}'. This matches property pattern '\\\\[.*\\\\]$' for describing language specific editor settings. Use 'configurationDefaults' contribution.",K):configurationRegistry$2.getConfigurationProperties()[K]!==void 0?localize("config.property.duplicate","Cannot register '{0}'. This property is already registered.",K):!((W=C.policy)===null||W===void 0)&&W.name&&configurationRegistry$2.getPolicyConfigurations().get((V=C.policy)===null||V===void 0?void 0:V.name)!==void 0?localize("config.policy.duplicate","Cannot register '{0}'. The associated policy {1} is already registered with {2}.",K,(U=C.policy)===null||U===void 0?void 0:U.name,configurationRegistry$2.getPolicyConfigurations().get((G=C.policy)===null||G===void 0?void 0:G.name)):null:localize("config.property.empty","Cannot register an empty property")}const Extensions$5={ModesRegistry:"editor.modesRegistry"};class EditorModesRegistry{constructor(){this._onDidChangeLanguages=new Emitter$1,this.onDidChangeLanguages=this._onDidChangeLanguages.event,this._languages=[]}registerLanguage(C){return this._languages.push(C),this._onDidChangeLanguages.fire(void 0),{dispose:()=>{for(let W=0,V=this._languages.length;W<V;W++)if(this._languages[W]===C){this._languages.splice(W,1);return}}}}getLanguages(){return this._languages}}const ModesRegistry=new EditorModesRegistry;Registry.add(Extensions$5.ModesRegistry,ModesRegistry);const PLAINTEXT_LANGUAGE_ID="plaintext",PLAINTEXT_EXTENSION=".txt";ModesRegistry.registerLanguage({id:PLAINTEXT_LANGUAGE_ID,extensions:[PLAINTEXT_EXTENSION],aliases:[localize("plainText.alias","Plain Text"),"text"],mimetypes:[Mimes.text]});Registry.as(Extensions$6.Configuration).registerDefaultConfigurations([{overrides:{"[plaintext]":{"editor.unicodeHighlight.ambiguousCharacters":!1,"editor.unicodeHighlight.invisibleCharacters":!1}}}]);class LanguageBracketsConfiguration{constructor(C,W){this.languageId=C;const V=W.brackets?filterValidBrackets(W.brackets):[],U=new CachedFunction(X=>{const Q=new Set;return{info:new OpeningBracketKind(this,X,Q),closing:Q}}),G=new CachedFunction(X=>{const Q=new Set,J=new Set;return{info:new ClosingBracketKind(this,X,Q,J),opening:Q,openingColorized:J}});for(const[X,Q]of V){const J=U.get(X),ee=G.get(Q);J.closing.add(ee.info),ee.opening.add(J.info)}const Z=W.colorizedBracketPairs?filterValidBrackets(W.colorizedBracketPairs):V.filter(X=>!(X[0]==="<"&&X[1]===">"));for(const[X,Q]of Z){const J=U.get(X),ee=G.get(Q);J.closing.add(ee.info),ee.openingColorized.add(J.info),ee.opening.add(J.info)}this._openingBrackets=new Map([...U.cachedValues].map(([X,Q])=>[X,Q.info])),this._closingBrackets=new Map([...G.cachedValues].map(([X,Q])=>[X,Q.info]))}get openingBrackets(){return[...this._openingBrackets.values()]}get closingBrackets(){return[...this._closingBrackets.values()]}getOpeningBracketInfo(C){return this._openingBrackets.get(C)}getClosingBracketInfo(C){return this._closingBrackets.get(C)}getBracketInfo(C){return this.getOpeningBracketInfo(C)||this.getClosingBracketInfo(C)}}function filterValidBrackets(K){return K.filter(([C,W])=>C!==""&&W!=="")}class BracketKindBase{constructor(C,W){this.config=C,this.bracketText=W}get languageId(){return this.config.languageId}}class OpeningBracketKind extends BracketKindBase{constructor(C,W,V){super(C,W),this.openedBrackets=V,this.isOpeningBracket=!0}}class ClosingBracketKind extends BracketKindBase{constructor(C,W,V,U){super(C,W),this.openingBrackets=V,this.openingColorizedBrackets=U,this.isOpeningBracket=!1}closes(C){return C.config!==this.config?!1:this.openingBrackets.has(C)}closesColorized(C){return C.config!==this.config?!1:this.openingColorizedBrackets.has(C)}getOpeningBrackets(){return[...this.openingBrackets]}}var __decorate$2a=globalThis&&globalThis.__decorate||function(K,C,W,V){var U=arguments.length,G=U<3?C:V===null?V=Object.getOwnPropertyDescriptor(C,W):V,Z;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")G=Reflect.decorate(K,C,W,V);else for(var X=K.length-1;X>=0;X--)(Z=K[X])&&(G=(U<3?Z(G):U>3?Z(C,W,G):Z(C,W))||G);return U>3&&G&&Object.defineProperty(C,W,G),G},__param$23=globalThis&&globalThis.__param||function(K,C){return function(W,V){C(W,V,K)}};class LanguageConfigurationServiceChangeEvent{constructor(C){this.languageId=C}affects(C){return this.languageId?this.languageId===C:!0}}const ILanguageConfigurationService=createDecorator("languageConfigurationService");let LanguageConfigurationService=class extends Disposable{constructor(C,W){super(),this.configurationService=C,this.languageService=W,this._registry=this._register(new LanguageConfigurationRegistry),this.onDidChangeEmitter=this._register(new Emitter$1),this.onDidChange=this.onDidChangeEmitter.event,this.configurations=new Map;const V=new Set(Object.values(customizedLanguageConfigKeys));this._register(this.configurationService.onDidChangeConfiguration(U=>{const G=U.change.keys.some(X=>V.has(X)),Z=U.change.overrides.filter(([X,Q])=>Q.some(J=>V.has(J))).map(([X])=>X);if(G)this.configurations.clear(),this.onDidChangeEmitter.fire(new LanguageConfigurationServiceChangeEvent(void 0));else for(const X of Z)this.languageService.isRegisteredLanguageId(X)&&(this.configurations.delete(X),this.onDidChangeEmitter.fire(new LanguageConfigurationServiceChangeEvent(X)))})),this._register(this._registry.onDidChange(U=>{this.configurations.delete(U.languageId),this.onDidChangeEmitter.fire(new LanguageConfigurationServiceChangeEvent(U.languageId))}))}register(C,W,V){return this._registry.register(C,W,V)}getLanguageConfiguration(C){let W=this.configurations.get(C);return W||(W=computeConfig(C,this._registry,this.configurationService,this.languageService),this.configurations.set(C,W)),W}};LanguageConfigurationService=__decorate$2a([__param$23(0,IConfigurationService),__param$23(1,ILanguageService)],LanguageConfigurationService);function computeConfig(K,C,W,V){let U=C.getLanguageConfiguration(K);if(!U){if(!V.isRegisteredLanguageId(K))return new ResolvedLanguageConfiguration(K,{});U=new ResolvedLanguageConfiguration(K,{})}const G=getCustomizedLanguageConfig(U.languageId,W),Z=combineLanguageConfigurations([U.underlyingConfig,G]);return new ResolvedLanguageConfiguration(U.languageId,Z)}const customizedLanguageConfigKeys={brackets:"editor.language.brackets",colorizedBracketPairs:"editor.language.colorizedBracketPairs"};function getCustomizedLanguageConfig(K,C){const W=C.getValue(customizedLanguageConfigKeys.brackets,{overrideIdentifier:K}),V=C.getValue(customizedLanguageConfigKeys.colorizedBracketPairs,{overrideIdentifier:K});return{brackets:validateBracketPairs(W),colorizedBracketPairs:validateBracketPairs(V)}}function validateBracketPairs(K){if(Array.isArray(K))return K.map(C=>{if(!(!Array.isArray(C)||C.length!==2))return[C[0],C[1]]}).filter(C=>!!C)}function getIndentationAtPosition(K,C,W){const V=K.getLineContent(C);let U=getLeadingWhitespace(V);return U.length>W-1&&(U=U.substring(0,W-1)),U}function getScopedLineTokens(K,C,W){K.tokenization.forceTokenization(C);const V=K.tokenization.getLineTokens(C),U=typeof W>"u"?K.getLineMaxColumn(C)-1:W-1;return createScopedLineTokens(V,U)}class ComposedLanguageConfiguration{constructor(C){this.languageId=C,this._resolved=null,this._entries=[],this._order=0,this._resolved=null}register(C,W){const V=new LanguageConfigurationContribution(C,W,++this._order);return this._entries.push(V),this._resolved=null,toDisposable(()=>{for(let U=0;U<this._entries.length;U++)if(this._entries[U]===V){this._entries.splice(U,1),this._resolved=null;break}})}getResolvedConfiguration(){if(!this._resolved){const C=this._resolve();C&&(this._resolved=new ResolvedLanguageConfiguration(this.languageId,C))}return this._resolved}_resolve(){return this._entries.length===0?null:(this._entries.sort(LanguageConfigurationContribution.cmp),combineLanguageConfigurations(this._entries.map(C=>C.configuration)))}}function combineLanguageConfigurations(K){let C={comments:void 0,brackets:void 0,wordPattern:void 0,indentationRules:void 0,onEnterRules:void 0,autoClosingPairs:void 0,surroundingPairs:void 0,autoCloseBefore:void 0,folding:void 0,colorizedBracketPairs:void 0,__electricCharacterSupport:void 0};for(const W of K)C={comments:W.comments||C.comments,brackets:W.brackets||C.brackets,wordPattern:W.wordPattern||C.wordPattern,indentationRules:W.indentationRules||C.indentationRules,onEnterRules:W.onEnterRules||C.onEnterRules,autoClosingPairs:W.autoClosingPairs||C.autoClosingPairs,surroundingPairs:W.surroundingPairs||C.surroundingPairs,autoCloseBefore:W.autoCloseBefore||C.autoCloseBefore,folding:W.folding||C.folding,colorizedBracketPairs:W.colorizedBracketPairs||C.colorizedBracketPairs,__electricCharacterSupport:W.__electricCharacterSupport||C.__electricCharacterSupport};return C}class LanguageConfigurationContribution{constructor(C,W,V){this.configuration=C,this.priority=W,this.order=V}static cmp(C,W){return C.priority===W.priority?C.order-W.order:C.priority-W.priority}}class LanguageConfigurationChangeEvent{constructor(C){this.languageId=C}}class LanguageConfigurationRegistry extends Disposable{constructor(){super(),this._entries=new Map,this._onDidChange=this._register(new Emitter$1),this.onDidChange=this._onDidChange.event,this._register(this.register(PLAINTEXT_LANGUAGE_ID,{brackets:[["(",")"],["[","]"],["{","}"]],surroundingPairs:[{open:"{",close:"}"},{open:"[",close:"]"},{open:"(",close:")"},{open:"<",close:">"},{open:'"',close:'"'},{open:"'",close:"'"},{open:"`",close:"`"}],colorizedBracketPairs:[],folding:{offSide:!0}},0))}register(C,W,V=0){let U=this._entries.get(C);U||(U=new ComposedLanguageConfiguration(C),this._entries.set(C,U));const G=U.register(W,V);return this._onDidChange.fire(new LanguageConfigurationChangeEvent(C)),toDisposable(()=>{G.dispose(),this._onDidChange.fire(new LanguageConfigurationChangeEvent(C))})}getLanguageConfiguration(C){const W=this._entries.get(C);return(W==null?void 0:W.getResolvedConfiguration())||null}}class ResolvedLanguageConfiguration{constructor(C,W){this.languageId=C,this.underlyingConfig=W,this._brackets=null,this._electricCharacter=null,this._onEnterSupport=this.underlyingConfig.brackets||this.underlyingConfig.indentationRules||this.underlyingConfig.onEnterRules?new OnEnterSupport(this.underlyingConfig):null,this.comments=ResolvedLanguageConfiguration._handleComments(this.underlyingConfig),this.characterPair=new CharacterPairSupport(this.underlyingConfig),this.wordDefinition=this.underlyingConfig.wordPattern||DEFAULT_WORD_REGEXP,this.indentationRules=this.underlyingConfig.indentationRules,this.underlyingConfig.indentationRules?this.indentRulesSupport=new IndentRulesSupport(this.underlyingConfig.indentationRules):this.indentRulesSupport=null,this.foldingRules=this.underlyingConfig.folding||{},this.bracketsNew=new LanguageBracketsConfiguration(C,this.underlyingConfig)}getWordDefinition(){return ensureValidWordDefinition(this.wordDefinition)}get brackets(){return!this._brackets&&this.underlyingConfig.brackets&&(this._brackets=new RichEditBrackets(this.languageId,this.underlyingConfig.brackets)),this._brackets}get electricCharacter(){return this._electricCharacter||(this._electricCharacter=new BracketElectricCharacterSupport(this.brackets)),this._electricCharacter}onEnter(C,W,V,U){return this._onEnterSupport?this._onEnterSupport.onEnter(C,W,V,U):null}getAutoClosingPairs(){return new AutoClosingPairs(this.characterPair.getAutoClosingPairs())}getAutoCloseBeforeSet(C){return this.characterPair.getAutoCloseBeforeSet(C)}getSurroundingPairs(){return this.characterPair.getSurroundingPairs()}static _handleComments(C){const W=C.comments;if(!W)return null;const V={};if(W.lineComment&&(V.lineCommentToken=W.lineComment),W.blockComment){const[U,G]=W.blockComment;V.blockCommentStartToken=U,V.blockCommentEndToken=G}return V}}registerSingleton(ILanguageConfigurationService,LanguageConfigurationService,1);class DiffChange{constructor(C,W,V,U){this.originalStart=C,this.originalLength=W,this.modifiedStart=V,this.modifiedLength=U}getOriginalEnd(){return this.originalStart+this.originalLength}getModifiedEnd(){return this.modifiedStart+this.modifiedLength}}function hash(K){return doHash(K,0)}function doHash(K,C){switch(typeof K){case"object":return K===null?numberHash(349,C):Array.isArray(K)?arrayHash(K,C):objectHash(K,C);case"string":return stringHash(K,C);case"boolean":return booleanHash(K,C);case"number":return numberHash(K,C);case"undefined":return numberHash(937,C);default:return numberHash(617,C)}}function numberHash(K,C){return(C<<5)-C+K|0}function booleanHash(K,C){return numberHash(K?433:863,C)}function stringHash(K,C){C=numberHash(149417,C);for(let W=0,V=K.length;W<V;W++)C=numberHash(K.charCodeAt(W),C);return C}function arrayHash(K,C){return C=numberHash(104579,C),K.reduce((W,V)=>doHash(V,W),C)}function objectHash(K,C){return C=numberHash(181387,C),Object.keys(K).sort().reduce((W,V)=>(W=stringHash(V,W),doHash(K[V],W)),C)}function leftRotate$2(K,C,W=32){const V=W-C,U=~((1<<V)-1);return(K<<C|(U&K)>>>V)>>>0}function fill(K,C=0,W=K.byteLength,V=0){for(let U=0;U<W;U++)K[C+U]=V}function leftPad(K,C,W="0"){for(;K.length<C;)K=W+K;return K}function toHexString(K,C=32){return K instanceof ArrayBuffer?Array.from(new Uint8Array(K)).map(W=>W.toString(16).padStart(2,"0")).join(""):leftPad((K>>>0).toString(16),C/4)}class StringSHA1{constructor(){this._h0=1732584193,this._h1=4023233417,this._h2=2562383102,this._h3=271733878,this._h4=3285377520,this._buff=new Uint8Array(64+3),this._buffDV=new DataView(this._buff.buffer),this._buffLen=0,this._totalLen=0,this._leftoverHighSurrogate=0,this._finished=!1}update(C){const W=C.length;if(W===0)return;const V=this._buff;let U=this._buffLen,G=this._leftoverHighSurrogate,Z,X;for(G!==0?(Z=G,X=-1,G=0):(Z=C.charCodeAt(0),X=0);;){let Q=Z;if(isHighSurrogate(Z))if(X+1<W){const J=C.charCodeAt(X+1);isLowSurrogate(J)?(X++,Q=computeCodePoint(Z,J)):Q=65533}else{G=Z;break}else isLowSurrogate(Z)&&(Q=65533);if(U=this._push(V,U,Q),X++,X<W)Z=C.charCodeAt(X);else break}this._buffLen=U,this._leftoverHighSurrogate=G}_push(C,W,V){return V<128?C[W++]=V:V<2048?(C[W++]=192|(V&1984)>>>6,C[W++]=128|(V&63)>>>0):V<65536?(C[W++]=224|(V&61440)>>>12,C[W++]=128|(V&4032)>>>6,C[W++]=128|(V&63)>>>0):(C[W++]=240|(V&1835008)>>>18,C[W++]=128|(V&258048)>>>12,C[W++]=128|(V&4032)>>>6,C[W++]=128|(V&63)>>>0),W>=64&&(this._step(),W-=64,this._totalLen+=64,C[0]=C[64+0],C[1]=C[64+1],C[2]=C[64+2]),W}digest(){return this._finished||(this._finished=!0,this._leftoverHighSurrogate&&(this._leftoverHighSurrogate=0,this._buffLen=this._push(this._buff,this._buffLen,65533)),this._totalLen+=this._buffLen,this._wrapUp()),toHexString(this._h0)+toHexString(this._h1)+toHexString(this._h2)+toHexString(this._h3)+toHexString(this._h4)}_wrapUp(){this._buff[this._buffLen++]=128,fill(this._buff,this._buffLen),this._buffLen>56&&(this._step(),fill(this._buff));const C=8*this._totalLen;this._buffDV.setUint32(56,Math.floor(C/4294967296),!1),this._buffDV.setUint32(60,C%4294967296,!1),this._step()}_step(){const C=StringSHA1._bigBlock32,W=this._buffDV;for(let te=0;te<64;te+=4)C.setUint32(te,W.getUint32(te,!1),!1);for(let te=64;te<320;te+=4)C.setUint32(te,leftRotate$2(C.getUint32(te-12,!1)^C.getUint32(te-32,!1)^C.getUint32(te-56,!1)^C.getUint32(te-64,!1),1),!1);let V=this._h0,U=this._h1,G=this._h2,Z=this._h3,X=this._h4,Q,J,ee;for(let te=0;te<80;te++)te<20?(Q=U&G|~U&Z,J=1518500249):te<40?(Q=U^G^Z,J=1859775393):te<60?(Q=U&G|U&Z|G&Z,J=2400959708):(Q=U^G^Z,J=3395469782),ee=leftRotate$2(V,5)+Q+X+J+C.getUint32(te*4,!1)&4294967295,X=Z,Z=G,G=leftRotate$2(U,30),U=V,V=ee;this._h0=this._h0+V&4294967295,this._h1=this._h1+U&4294967295,this._h2=this._h2+G&4294967295,this._h3=this._h3+Z&4294967295,this._h4=this._h4+X&4294967295}}StringSHA1._bigBlock32=new DataView(new ArrayBuffer(320));class StringDiffSequence{constructor(C){this.source=C}getElements(){const C=this.source,W=new Int32Array(C.length);for(let V=0,U=C.length;V<U;V++)W[V]=C.charCodeAt(V);return W}}function stringDiff(K,C,W){return new LcsDiff(new StringDiffSequence(K),new StringDiffSequence(C)).ComputeDiff(W).changes}class Debug{static Assert(C,W){if(!C)throw new Error(W)}}class MyArray{static Copy(C,W,V,U,G){for(let Z=0;Z<G;Z++)V[U+Z]=C[W+Z]}static Copy2(C,W,V,U,G){for(let Z=0;Z<G;Z++)V[U+Z]=C[W+Z]}}class DiffChangeHelper{constructor(){this.m_changes=[],this.m_originalStart=1073741824,this.m_modifiedStart=1073741824,this.m_originalCount=0,this.m_modifiedCount=0}MarkNextChange(){(this.m_originalCount>0||this.m_modifiedCount>0)&&this.m_changes.push(new DiffChange(this.m_originalStart,this.m_originalCount,this.m_modifiedStart,this.m_modifiedCount)),this.m_originalCount=0,this.m_modifiedCount=0,this.m_originalStart=1073741824,this.m_modifiedStart=1073741824}AddOriginalElement(C,W){this.m_originalStart=Math.min(this.m_originalStart,C),this.m_modifiedStart=Math.min(this.m_modifiedStart,W),this.m_originalCount++}AddModifiedElement(C,W){this.m_originalStart=Math.min(this.m_originalStart,C),this.m_modifiedStart=Math.min(this.m_modifiedStart,W),this.m_modifiedCount++}getChanges(){return(this.m_originalCount>0||this.m_modifiedCount>0)&&this.MarkNextChange(),this.m_changes}getReverseChanges(){return(this.m_originalCount>0||this.m_modifiedCount>0)&&this.MarkNextChange(),this.m_changes.reverse(),this.m_changes}}class LcsDiff{constructor(C,W,V=null){this.ContinueProcessingPredicate=V,this._originalSequence=C,this._modifiedSequence=W;const[U,G,Z]=LcsDiff._getElements(C),[X,Q,J]=LcsDiff._getElements(W);this._hasStrings=Z&&J,this._originalStringElements=U,this._originalElementsOrHash=G,this._modifiedStringElements=X,this._modifiedElementsOrHash=Q,this.m_forwardHistory=[],this.m_reverseHistory=[]}static _isStringArray(C){return C.length>0&&typeof C[0]=="string"}static _getElements(C){const W=C.getElements();if(LcsDiff._isStringArray(W)){const V=new Int32Array(W.length);for(let U=0,G=W.length;U<G;U++)V[U]=stringHash(W[U],0);return[W,V,!0]}return W instanceof Int32Array?[[],W,!1]:[[],new Int32Array(W),!1]}ElementsAreEqual(C,W){return this._originalElementsOrHash[C]!==this._modifiedElementsOrHash[W]?!1:this._hasStrings?this._originalStringElements[C]===this._modifiedStringElements[W]:!0}ElementsAreStrictEqual(C,W){if(!this.ElementsAreEqual(C,W))return!1;const V=LcsDiff._getStrictElement(this._originalSequence,C),U=LcsDiff._getStrictElement(this._modifiedSequence,W);return V===U}static _getStrictElement(C,W){return typeof C.getStrictElement=="function"?C.getStrictElement(W):null}OriginalElementsAreEqual(C,W){return this._originalElementsOrHash[C]!==this._originalElementsOrHash[W]?!1:this._hasStrings?this._originalStringElements[C]===this._originalStringElements[W]:!0}ModifiedElementsAreEqual(C,W){return this._modifiedElementsOrHash[C]!==this._modifiedElementsOrHash[W]?!1:this._hasStrings?this._modifiedStringElements[C]===this._modifiedStringElements[W]:!0}ComputeDiff(C){return this._ComputeDiff(0,this._originalElementsOrHash.length-1,0,this._modifiedElementsOrHash.length-1,C)}_ComputeDiff(C,W,V,U,G){const Z=[!1];let X=this.ComputeDiffRecursive(C,W,V,U,Z);return G&&(X=this.PrettifyChanges(X)),{quitEarly:Z[0],changes:X}}ComputeDiffRecursive(C,W,V,U,G){for(G[0]=!1;C<=W&&V<=U&&this.ElementsAreEqual(C,V);)C++,V++;for(;W>=C&&U>=V&&this.ElementsAreEqual(W,U);)W--,U--;if(C>W||V>U){let te;return V<=U?(Debug.Assert(C===W+1,"originalStart should only be one more than originalEnd"),te=[new DiffChange(C,0,V,U-V+1)]):C<=W?(Debug.Assert(V===U+1,"modifiedStart should only be one more than modifiedEnd"),te=[new DiffChange(C,W-C+1,V,0)]):(Debug.Assert(C===W+1,"originalStart should only be one more than originalEnd"),Debug.Assert(V===U+1,"modifiedStart should only be one more than modifiedEnd"),te=[]),te}const Z=[0],X=[0],Q=this.ComputeRecursionPoint(C,W,V,U,Z,X,G),J=Z[0],ee=X[0];if(Q!==null)return Q;if(!G[0]){const te=this.ComputeDiffRecursive(C,J,V,ee,G);let ie=[];return G[0]?ie=[new DiffChange(J+1,W-(J+1)+1,ee+1,U-(ee+1)+1)]:ie=this.ComputeDiffRecursive(J+1,W,ee+1,U,G),this.ConcatenateChanges(te,ie)}return[new DiffChange(C,W-C+1,V,U-V+1)]}WALKTRACE(C,W,V,U,G,Z,X,Q,J,ee,te,ie,ne,oe,re,ae,se,le){let ce=null,de=null,ue=new DiffChangeHelper,ge=W,he=V,fe=ne[0]-ae[0]-U,pe=-1073741824,Se=this.m_forwardHistory.length-1;do{const Le=fe+C;Le===ge||Le<he&&J[Le-1]<J[Le+1]?(te=J[Le+1],oe=te-fe-U,te<pe&&ue.MarkNextChange(),pe=te,ue.AddModifiedElement(te+1,oe),fe=Le+1-C):(te=J[Le-1]+1,oe=te-fe-U,te<pe&&ue.MarkNextChange(),pe=te-1,ue.AddOriginalElement(te,oe+1),fe=Le-1-C),Se>=0&&(J=this.m_forwardHistory[Se],C=J[0],ge=1,he=J.length-1)}while(--Se>=-1);if(ce=ue.getReverseChanges(),le[0]){let Le=ne[0]+1,be=ae[0]+1;if(ce!==null&&ce.length>0){const Ce=ce[ce.length-1];Le=Math.max(Le,Ce.getOriginalEnd()),be=Math.max(be,Ce.getModifiedEnd())}de=[new DiffChange(Le,ie-Le+1,be,re-be+1)]}else{ue=new DiffChangeHelper,ge=Z,he=X,fe=ne[0]-ae[0]-Q,pe=1073741824,Se=se?this.m_reverseHistory.length-1:this.m_reverseHistory.length-2;do{const Le=fe+G;Le===ge||Le<he&&ee[Le-1]>=ee[Le+1]?(te=ee[Le+1]-1,oe=te-fe-Q,te>pe&&ue.MarkNextChange(),pe=te+1,ue.AddOriginalElement(te+1,oe+1),fe=Le+1-G):(te=ee[Le-1],oe=te-fe-Q,te>pe&&ue.MarkNextChange(),pe=te,ue.AddModifiedElement(te+1,oe+1),fe=Le-1-G),Se>=0&&(ee=this.m_reverseHistory[Se],G=ee[0],ge=1,he=ee.length-1)}while(--Se>=-1);de=ue.getChanges()}return this.ConcatenateChanges(ce,de)}ComputeRecursionPoint(C,W,V,U,G,Z,X){let Q=0,J=0,ee=0,te=0,ie=0,ne=0;C--,V--,G[0]=0,Z[0]=0,this.m_forwardHistory=[],this.m_reverseHistory=[];const oe=W-C+(U-V),re=oe+1,ae=new Int32Array(re),se=new Int32Array(re),le=U-V,ce=W-C,de=C-V,ue=W-U,he=(ce-le)%2===0;ae[le]=C,se[ce]=W,X[0]=!1;for(let fe=1;fe<=oe/2+1;fe++){let pe=0,Se=0;ee=this.ClipDiagonalBound(le-fe,fe,le,re),te=this.ClipDiagonalBound(le+fe,fe,le,re);for(let be=ee;be<=te;be+=2){be===ee||be<te&&ae[be-1]<ae[be+1]?Q=ae[be+1]:Q=ae[be-1]+1,J=Q-(be-le)-de;const Ce=Q;for(;Q<W&&J<U&&this.ElementsAreEqual(Q+1,J+1);)Q++,J++;if(ae[be]=Q,Q+J>pe+Se&&(pe=Q,Se=J),!he&&Math.abs(be-ce)<=fe-1&&Q>=se[be])return G[0]=Q,Z[0]=J,Ce<=se[be]&&1447>0&&fe<=1447+1?this.WALKTRACE(le,ee,te,de,ce,ie,ne,ue,ae,se,Q,W,G,J,U,Z,he,X):null}const Le=(pe-C+(Se-V)-fe)/2;if(this.ContinueProcessingPredicate!==null&&!this.ContinueProcessingPredicate(pe,Le))return X[0]=!0,G[0]=pe,Z[0]=Se,Le>0&&1447>0&&fe<=1447+1?this.WALKTRACE(le,ee,te,de,ce,ie,ne,ue,ae,se,Q,W,G,J,U,Z,he,X):(C++,V++,[new DiffChange(C,W-C+1,V,U-V+1)]);ie=this.ClipDiagonalBound(ce-fe,fe,ce,re),ne=this.ClipDiagonalBound(ce+fe,fe,ce,re);for(let be=ie;be<=ne;be+=2){be===ie||be<ne&&se[be-1]>=se[be+1]?Q=se[be+1]-1:Q=se[be-1],J=Q-(be-ce)-ue;const Ce=Q;for(;Q>C&&J>V&&this.ElementsAreEqual(Q,J);)Q--,J--;if(se[be]=Q,he&&Math.abs(be-le)<=fe&&Q<=ae[be])return G[0]=Q,Z[0]=J,Ce>=ae[be]&&1447>0&&fe<=1447+1?this.WALKTRACE(le,ee,te,de,ce,ie,ne,ue,ae,se,Q,W,G,J,U,Z,he,X):null}if(fe<=1447){let be=new Int32Array(te-ee+2);be[0]=le-ee+1,MyArray.Copy2(ae,ee,be,1,te-ee+1),this.m_forwardHistory.push(be),be=new Int32Array(ne-ie+2),be[0]=ce-ie+1,MyArray.Copy2(se,ie,be,1,ne-ie+1),this.m_reverseHistory.push(be)}}return this.WALKTRACE(le,ee,te,de,ce,ie,ne,ue,ae,se,Q,W,G,J,U,Z,he,X)}PrettifyChanges(C){for(let W=0;W<C.length;W++){const V=C[W],U=W<C.length-1?C[W+1].originalStart:this._originalElementsOrHash.length,G=W<C.length-1?C[W+1].modifiedStart:this._modifiedElementsOrHash.length,Z=V.originalLength>0,X=V.modifiedLength>0;for(;V.originalStart+V.originalLength<U&&V.modifiedStart+V.modifiedLength<G&&(!Z||this.OriginalElementsAreEqual(V.originalStart,V.originalStart+V.originalLength))&&(!X||this.ModifiedElementsAreEqual(V.modifiedStart,V.modifiedStart+V.modifiedLength));){const J=this.ElementsAreStrictEqual(V.originalStart,V.modifiedStart);if(this.ElementsAreStrictEqual(V.originalStart+V.originalLength,V.modifiedStart+V.modifiedLength)&&!J)break;V.originalStart++,V.modifiedStart++}const Q=[null];if(W<C.length-1&&this.ChangesOverlap(C[W],C[W+1],Q)){C[W]=Q[0],C.splice(W+1,1),W--;continue}}for(let W=C.length-1;W>=0;W--){const V=C[W];let U=0,G=0;if(W>0){const te=C[W-1];U=te.originalStart+te.originalLength,G=te.modifiedStart+te.modifiedLength}const Z=V.originalLength>0,X=V.modifiedLength>0;let Q=0,J=this._boundaryScore(V.originalStart,V.originalLength,V.modifiedStart,V.modifiedLength);for(let te=1;;te++){const ie=V.originalStart-te,ne=V.modifiedStart-te;if(ie<U||ne<G||Z&&!this.OriginalElementsAreEqual(ie,ie+V.originalLength)||X&&!this.ModifiedElementsAreEqual(ne,ne+V.modifiedLength))break;const re=(ie===U&&ne===G?5:0)+this._boundaryScore(ie,V.originalLength,ne,V.modifiedLength);re>J&&(J=re,Q=te)}V.originalStart-=Q,V.modifiedStart-=Q;const ee=[null];if(W>0&&this.ChangesOverlap(C[W-1],C[W],ee)){C[W-1]=ee[0],C.splice(W,1),W++;continue}}if(this._hasStrings)for(let W=1,V=C.length;W<V;W++){const U=C[W-1],G=C[W],Z=G.originalStart-U.originalStart-U.originalLength,X=U.originalStart,Q=G.originalStart+G.originalLength,J=Q-X,ee=U.modifiedStart,te=G.modifiedStart+G.modifiedLength,ie=te-ee;if(Z<5&&J<20&&ie<20){const ne=this._findBetterContiguousSequence(X,J,ee,ie,Z);if(ne){const[oe,re]=ne;(oe!==U.originalStart+U.originalLength||re!==U.modifiedStart+U.modifiedLength)&&(U.originalLength=oe-U.originalStart,U.modifiedLength=re-U.modifiedStart,G.originalStart=oe+Z,G.modifiedStart=re+Z,G.originalLength=Q-G.originalStart,G.modifiedLength=te-G.modifiedStart)}}}return C}_findBetterContiguousSequence(C,W,V,U,G){if(W<G||U<G)return null;const Z=C+W-G+1,X=V+U-G+1;let Q=0,J=0,ee=0;for(let te=C;te<Z;te++)for(let ie=V;ie<X;ie++){const ne=this._contiguousSequenceScore(te,ie,G);ne>0&&ne>Q&&(Q=ne,J=te,ee=ie)}return Q>0?[J,ee]:null}_contiguousSequenceScore(C,W,V){let U=0;for(let G=0;G<V;G++){if(!this.ElementsAreEqual(C+G,W+G))return 0;U+=this._originalStringElements[C+G].length}return U}_OriginalIsBoundary(C){return C<=0||C>=this._originalElementsOrHash.length-1?!0:this._hasStrings&&/^\s*$/.test(this._originalStringElements[C])}_OriginalRegionIsBoundary(C,W){if(this._OriginalIsBoundary(C)||this._OriginalIsBoundary(C-1))return!0;if(W>0){const V=C+W;if(this._OriginalIsBoundary(V-1)||this._OriginalIsBoundary(V))return!0}return!1}_ModifiedIsBoundary(C){return C<=0||C>=this._modifiedElementsOrHash.length-1?!0:this._hasStrings&&/^\s*$/.test(this._modifiedStringElements[C])}_ModifiedRegionIsBoundary(C,W){if(this._ModifiedIsBoundary(C)||this._ModifiedIsBoundary(C-1))return!0;if(W>0){const V=C+W;if(this._ModifiedIsBoundary(V-1)||this._ModifiedIsBoundary(V))return!0}return!1}_boundaryScore(C,W,V,U){const G=this._OriginalRegionIsBoundary(C,W)?1:0,Z=this._ModifiedRegionIsBoundary(V,U)?1:0;return G+Z}ConcatenateChanges(C,W){const V=[];if(C.length===0||W.length===0)return W.length>0?W:C;if(this.ChangesOverlap(C[C.length-1],W[0],V)){const U=new Array(C.length+W.length-1);return MyArray.Copy(C,0,U,0,C.length-1),U[C.length-1]=V[0],MyArray.Copy(W,1,U,C.length,W.length-1),U}else{const U=new Array(C.length+W.length);return MyArray.Copy(C,0,U,0,C.length),MyArray.Copy(W,0,U,C.length,W.length),U}}ChangesOverlap(C,W,V){if(Debug.Assert(C.originalStart<=W.originalStart,"Left change is not less than or equal to right change"),Debug.Assert(C.modifiedStart<=W.modifiedStart,"Left change is not less than or equal to right change"),C.originalStart+C.originalLength>=W.originalStart||C.modifiedStart+C.modifiedLength>=W.modifiedStart){const U=C.originalStart;let G=C.originalLength;const Z=C.modifiedStart;let X=C.modifiedLength;return C.originalStart+C.originalLength>=W.originalStart&&(G=W.originalStart+W.originalLength-C.originalStart),C.modifiedStart+C.modifiedLength>=W.modifiedStart&&(X=W.modifiedStart+W.modifiedLength-C.modifiedStart),V[0]=new DiffChange(U,G,Z,X),!0}else return V[0]=null,!1}ClipDiagonalBound(C,W,V,U){if(C>=0&&C<U)return C;const G=V,Z=U-V-1,X=W%2===0;if(C<0){const Q=G%2===0;return X===Q?0:1}else{const Q=Z%2===0;return X===Q?U-1:U-2}}}function toUint8(K){return K<0?0:K>255?255:K|0}function toUint32(K){return K<0?0:K>4294967295?4294967295:K|0}class PrefixSumComputer{constructor(C){this.values=C,this.prefixSum=new Uint32Array(C.length),this.prefixSumValidIndex=new Int32Array(1),this.prefixSumValidIndex[0]=-1}insertValues(C,W){C=toUint32(C);const V=this.values,U=this.prefixSum,G=W.length;return G===0?!1:(this.values=new Uint32Array(V.length+G),this.values.set(V.subarray(0,C),0),this.values.set(V.subarray(C),C+G),this.values.set(W,C),C-1<this.prefixSumValidIndex[0]&&(this.prefixSumValidIndex[0]=C-1),this.prefixSum=new Uint32Array(this.values.length),this.prefixSumValidIndex[0]>=0&&this.prefixSum.set(U.subarray(0,this.prefixSumValidIndex[0]+1)),!0)}setValue(C,W){return C=toUint32(C),W=toUint32(W),this.values[C]===W?!1:(this.values[C]=W,C-1<this.prefixSumValidIndex[0]&&(this.prefixSumValidIndex[0]=C-1),!0)}removeValues(C,W){C=toUint32(C),W=toUint32(W);const V=this.values,U=this.prefixSum;if(C>=V.length)return!1;const G=V.length-C;return W>=G&&(W=G),W===0?!1:(this.values=new Uint32Array(V.length-W),this.values.set(V.subarray(0,C),0),this.values.set(V.subarray(C+W),C),this.prefixSum=new Uint32Array(this.values.length),C-1<this.prefixSumValidIndex[0]&&(this.prefixSumValidIndex[0]=C-1),this.prefixSumValidIndex[0]>=0&&this.prefixSum.set(U.subarray(0,this.prefixSumValidIndex[0]+1)),!0)}getTotalSum(){return this.values.length===0?0:this._getPrefixSum(this.values.length-1)}getPrefixSum(C){return C<0?0:(C=toUint32(C),this._getPrefixSum(C))}_getPrefixSum(C){if(C<=this.prefixSumValidIndex[0])return this.prefixSum[C];let W=this.prefixSumValidIndex[0]+1;W===0&&(this.prefixSum[0]=this.values[0],W++),C>=this.values.length&&(C=this.values.length-1);for(let V=W;V<=C;V++)this.prefixSum[V]=this.prefixSum[V-1]+this.values[V];return this.prefixSumValidIndex[0]=Math.max(this.prefixSumValidIndex[0],C),this.prefixSum[C]}getIndexOf(C){C=Math.floor(C),this.getTotalSum();let W=0,V=this.values.length-1,U=0,G=0,Z=0;for(;W<=V;)if(U=W+(V-W)/2|0,G=this.prefixSum[U],Z=G-this.values[U],C<Z)V=U-1;else if(C>=G)W=U+1;else break;return new PrefixSumIndexOfResult(U,C-Z)}}class ConstantTimePrefixSumComputer{constructor(C){this._values=C,this._isValid=!1,this._validEndIndex=-1,this._prefixSum=[],this._indexBySum=[]}getTotalSum(){return this._ensureValid(),this._indexBySum.length}getPrefixSum(C){return this._ensureValid(),C===0?0:this._prefixSum[C-1]}getIndexOf(C){this._ensureValid();const W=this._indexBySum[C],V=W>0?this._prefixSum[W-1]:0;return new PrefixSumIndexOfResult(W,C-V)}removeValues(C,W){this._values.splice(C,W),this._invalidate(C)}insertValues(C,W){this._values=arrayInsert(this._values,C,W),this._invalidate(C)}_invalidate(C){this._isValid=!1,this._validEndIndex=Math.min(this._validEndIndex,C-1)}_ensureValid(){if(!this._isValid){for(let C=this._validEndIndex+1,W=this._values.length;C<W;C++){const V=this._values[C],U=C>0?this._prefixSum[C-1]:0;this._prefixSum[C]=U+V;for(let G=0;G<V;G++)this._indexBySum[U+G]=C}this._prefixSum.length=this._values.length,this._indexBySum.length=this._prefixSum[this._prefixSum.length-1],this._isValid=!0,this._validEndIndex=this._values.length-1}}setValue(C,W){this._values[C]!==W&&(this._values[C]=W,this._invalidate(C))}}class PrefixSumIndexOfResult{constructor(C,W){this.index=C,this.remainder=W,this._prefixSumIndexOfResultBrand=void 0,this.index=C,this.remainder=W}}class MirrorTextModel{constructor(C,W,V,U){this._uri=C,this._lines=W,this._eol=V,this._versionId=U,this._lineStarts=null,this._cachedTextValue=null}dispose(){this._lines.length=0}get version(){return this._versionId}getText(){return this._cachedTextValue===null&&(this._cachedTextValue=this._lines.join(this._eol)),this._cachedTextValue}onEvents(C){C.eol&&C.eol!==this._eol&&(this._eol=C.eol,this._lineStarts=null);const W=C.changes;for(const V of W)this._acceptDeleteRange(V.range),this._acceptInsertText(new Position$1(V.range.startLineNumber,V.range.startColumn),V.text);this._versionId=C.versionId,this._cachedTextValue=null}_ensureLineStarts(){if(!this._lineStarts){const C=this._eol.length,W=this._lines.length,V=new Uint32Array(W);for(let U=0;U<W;U++)V[U]=this._lines[U].length+C;this._lineStarts=new PrefixSumComputer(V)}}_setLineText(C,W){this._lines[C]=W,this._lineStarts&&this._lineStarts.setValue(C,this._lines[C].length+this._eol.length)}_acceptDeleteRange(C){if(C.startLineNumber===C.endLineNumber){if(C.startColumn===C.endColumn)return;this._setLineText(C.startLineNumber-1,this._lines[C.startLineNumber-1].substring(0,C.startColumn-1)+this._lines[C.startLineNumber-1].substring(C.endColumn-1));return}this._setLineText(C.startLineNumber-1,this._lines[C.startLineNumber-1].substring(0,C.startColumn-1)+this._lines[C.endLineNumber-1].substring(C.endColumn-1)),this._lines.splice(C.startLineNumber,C.endLineNumber-C.startLineNumber),this._lineStarts&&this._lineStarts.removeValues(C.startLineNumber,C.endLineNumber-C.startLineNumber)}_acceptInsertText(C,W){if(W.length===0)return;const V=splitLines(W);if(V.length===1){this._setLineText(C.lineNumber-1,this._lines[C.lineNumber-1].substring(0,C.column-1)+V[0]+this._lines[C.lineNumber-1].substring(C.column-1));return}V[V.length-1]+=this._lines[C.lineNumber-1].substring(C.column-1),this._setLineText(C.lineNumber-1,this._lines[C.lineNumber-1].substring(0,C.column-1)+V[0]);const U=new Uint32Array(V.length-1);for(let G=1;G<V.length;G++)this._lines.splice(C.lineNumber+G-1,0,V[G]),U[G-1]=V[G].length+this._eol.length;this._lineStarts&&this._lineStarts.insertValues(C.lineNumber,U)}}class CharacterClassifier{constructor(C){const W=toUint8(C);this._defaultValue=W,this._asciiMap=CharacterClassifier._createAsciiMap(W),this._map=new Map}static _createAsciiMap(C){const W=new Uint8Array(256);return W.fill(C),W}set(C,W){const V=toUint8(W);C>=0&&C<256?this._asciiMap[C]=V:this._map.set(C,V)}get(C){return C>=0&&C<256?this._asciiMap[C]:this._map.get(C)||this._defaultValue}clear(){this._asciiMap.fill(this._defaultValue),this._map.clear()}}class CharacterSet{constructor(){this._actual=new CharacterClassifier(0)}add(C){this._actual.set(C,1)}has(C){return this._actual.get(C)===1}clear(){return this._actual.clear()}}class Uint8Matrix{constructor(C,W,V){const U=new Uint8Array(C*W);for(let G=0,Z=C*W;G<Z;G++)U[G]=V;this._data=U,this.rows=C,this.cols=W}get(C,W){return this._data[C*this.cols+W]}set(C,W,V){this._data[C*this.cols+W]=V}}class StateMachine{constructor(C){let W=0,V=0;for(let G=0,Z=C.length;G<Z;G++){const[X,Q,J]=C[G];Q>W&&(W=Q),X>V&&(V=X),J>V&&(V=J)}W++,V++;const U=new Uint8Matrix(V,W,0);for(let G=0,Z=C.length;G<Z;G++){const[X,Q,J]=C[G];U.set(X,Q,J)}this._states=U,this._maxCharCode=W}nextState(C,W){return W<0||W>=this._maxCharCode?0:this._states.get(C,W)}}let _stateMachine=null;function getStateMachine(){return _stateMachine===null&&(_stateMachine=new StateMachine([[1,104,2],[1,72,2],[1,102,6],[1,70,6],[2,116,3],[2,84,3],[3,116,4],[3,84,4],[4,112,5],[4,80,5],[5,115,9],[5,83,9],[5,58,10],[6,105,7],[6,73,7],[7,108,8],[7,76,8],[8,101,9],[8,69,9],[9,58,10],[10,47,11],[11,47,12]])),_stateMachine}let _classifier=null;function getClassifier(){if(_classifier===null){_classifier=new CharacterClassifier(0);const K=` 	<>'"、。｡､，．：；‘〈「『〔（［｛｢｣｝］）〕』」〉’｀～…`;for(let W=0;W<K.length;W++)_classifier.set(K.charCodeAt(W),1);const C=".,;:";for(let W=0;W<C.length;W++)_classifier.set(C.charCodeAt(W),2)}return _classifier}class LinkComputer{static _createLink(C,W,V,U,G){let Z=G-1;do{const X=W.charCodeAt(Z);if(C.get(X)!==2)break;Z--}while(Z>U);if(U>0){const X=W.charCodeAt(U-1),Q=W.charCodeAt(Z);(X===40&&Q===41||X===91&&Q===93||X===123&&Q===125)&&Z--}return{range:{startLineNumber:V,startColumn:U+1,endLineNumber:V,endColumn:Z+2},url:W.substring(U,Z+1)}}static computeLinks(C,W=getStateMachine()){const V=getClassifier(),U=[];for(let G=1,Z=C.getLineCount();G<=Z;G++){const X=C.getLineContent(G),Q=X.length;let J=0,ee=0,te=0,ie=1,ne=!1,oe=!1,re=!1,ae=!1;for(;J<Q;){let se=!1;const le=X.charCodeAt(J);if(ie===13){let ce;switch(le){case 40:ne=!0,ce=0;break;case 41:ce=ne?0:1;break;case 91:re=!0,oe=!0,ce=0;break;case 93:re=!1,ce=oe?0:1;break;case 123:ae=!0,ce=0;break;case 125:ce=ae?0:1;break;case 39:case 34:case 96:te===le?ce=1:te===39||te===34||te===96?ce=0:ce=1;break;case 42:ce=te===42?1:0;break;case 124:ce=te===124?1:0;break;case 32:ce=re?0:1;break;default:ce=V.get(le)}ce===1&&(U.push(LinkComputer._createLink(V,X,G,ee,J)),se=!0)}else if(ie===12){let ce;le===91?(oe=!0,ce=0):ce=V.get(le),ce===1?se=!0:ie=13}else ie=W.nextState(ie,le),ie===0&&(se=!0);se&&(ie=1,ne=!1,oe=!1,ae=!1,ee=J+1,te=le),J++}ie===13&&U.push(LinkComputer._createLink(V,X,G,ee,Q))}return U}}function computeLinks(K){return!K||typeof K.getLineCount!="function"||typeof K.getLineContent!="function"?[]:LinkComputer.computeLinks(K)}class BasicInplaceReplace{constructor(){this._defaultValueSet=[["true","false"],["True","False"],["Private","Public","Friend","ReadOnly","Partial","Protected","WriteOnly"],["public","protected","private"]]}navigateValueSet(C,W,V,U,G){if(C&&W){const Z=this.doNavigateValueSet(W,G);if(Z)return{range:C,value:Z}}if(V&&U){const Z=this.doNavigateValueSet(U,G);if(Z)return{range:V,value:Z}}return null}doNavigateValueSet(C,W){const V=this.numberReplace(C,W);return V!==null?V:this.textReplace(C,W)}numberReplace(C,W){const V=Math.pow(10,C.length-(C.lastIndexOf(".")+1));let U=Number(C);const G=parseFloat(C);return!isNaN(U)&&!isNaN(G)&&U===G?U===0&&!W?null:(U=Math.floor(U*V),U+=W?V:-V,String(U/V)):null}textReplace(C,W){return this.valueSetsReplace(this._defaultValueSet,C,W)}valueSetsReplace(C,W,V){let U=null;for(let G=0,Z=C.length;U===null&&G<Z;G++)U=this.valueSetReplace(C[G],W,V);return U}valueSetReplace(C,W,V){let U=C.indexOf(W);return U>=0?(U+=V?1:-1,U<0?U=C.length-1:U%=C.length,C[U]):null}}BasicInplaceReplace.INSTANCE=new BasicInplaceReplace;class WordCharacterClassifier extends CharacterClassifier{constructor(C){super(0);for(let W=0,V=C.length;W<V;W++)this.set(C.charCodeAt(W),2);this.set(32,1),this.set(9,1)}}function once$2(K){const C={};return W=>(C.hasOwnProperty(W)||(C[W]=K(W)),C[W])}const getMapForWordSeparators=once$2(K=>new WordCharacterClassifier(K));var OverviewRulerLane;(function(K){K[K.Left=1]="Left",K[K.Center=2]="Center",K[K.Right=4]="Right",K[K.Full=7]="Full"})(OverviewRulerLane||(OverviewRulerLane={}));var GlyphMarginLane;(function(K){K[K.Left=1]="Left",K[K.Right=2]="Right"})(GlyphMarginLane||(GlyphMarginLane={}));var MinimapPosition;(function(K){K[K.Inline=1]="Inline",K[K.Gutter=2]="Gutter"})(MinimapPosition||(MinimapPosition={}));var InjectedTextCursorStops;(function(K){K[K.Both=0]="Both",K[K.Right=1]="Right",K[K.Left=2]="Left",K[K.None=3]="None"})(InjectedTextCursorStops||(InjectedTextCursorStops={}));class TextModelResolvedOptions{get originalIndentSize(){return this._indentSizeIsTabSize?"tabSize":this.indentSize}constructor(C){this._textModelResolvedOptionsBrand=void 0,this.tabSize=Math.max(1,C.tabSize|0),C.indentSize==="tabSize"?(this.indentSize=this.tabSize,this._indentSizeIsTabSize=!0):(this.indentSize=Math.max(1,C.indentSize|0),this._indentSizeIsTabSize=!1),this.insertSpaces=!!C.insertSpaces,this.defaultEOL=C.defaultEOL|0,this.trimAutoWhitespace=!!C.trimAutoWhitespace,this.bracketPairColorizationOptions=C.bracketPairColorizationOptions}equals(C){return this.tabSize===C.tabSize&&this._indentSizeIsTabSize===C._indentSizeIsTabSize&&this.indentSize===C.indentSize&&this.insertSpaces===C.insertSpaces&&this.defaultEOL===C.defaultEOL&&this.trimAutoWhitespace===C.trimAutoWhitespace&&equals$4(this.bracketPairColorizationOptions,C.bracketPairColorizationOptions)}createChangeEvent(C){return{tabSize:this.tabSize!==C.tabSize,indentSize:this.indentSize!==C.indentSize,insertSpaces:this.insertSpaces!==C.insertSpaces,trimAutoWhitespace:this.trimAutoWhitespace!==C.trimAutoWhitespace}}}class FindMatch{constructor(C,W){this._findMatchBrand=void 0,this.range=C,this.matches=W}}function isITextSnapshot(K){return K&&typeof K.read=="function"}class ValidAnnotatedEditOperation{constructor(C,W,V,U,G,Z){this.identifier=C,this.range=W,this.text=V,this.forceMoveMarkers=U,this.isAutoWhitespaceEdit=G,this._isTracked=Z}}class SearchData{constructor(C,W,V){this.regex=C,this.wordSeparators=W,this.simpleSearch=V}}class ApplyEditsResult{constructor(C,W,V){this.reverseEdits=C,this.changes=W,this.trimAutoWhitespaceLineNumbers=V}}function shouldSynchronizeModel(K){return!K.isTooLargeForSyncing()&&!K.isForSimpleWidget}const LIMIT_FIND_COUNT$1=999;class SearchParams{constructor(C,W,V,U){this.searchString=C,this.isRegex=W,this.matchCase=V,this.wordSeparators=U}parseSearchRequest(){if(this.searchString==="")return null;let C;this.isRegex?C=isMultilineRegexSource(this.searchString):C=this.searchString.indexOf(`
`)>=0;let W=null;try{W=createRegExp(this.searchString,this.isRegex,{matchCase:this.matchCase,wholeWord:!1,multiline:C,global:!0,unicode:!0})}catch{return null}if(!W)return null;let V=!this.isRegex&&!C;return V&&this.searchString.toLowerCase()!==this.searchString.toUpperCase()&&(V=this.matchCase),new SearchData(W,this.wordSeparators?getMapForWordSeparators(this.wordSeparators):null,V?this.searchString:null)}}function isMultilineRegexSource(K){if(!K||K.length===0)return!1;for(let C=0,W=K.length;C<W;C++){const V=K.charCodeAt(C);if(V===10)return!0;if(V===92){if(C++,C>=W)break;const U=K.charCodeAt(C);if(U===110||U===114||U===87)return!0}}return!1}function createFindMatch(K,C,W){if(!W)return new FindMatch(K,null);const V=[];for(let U=0,G=C.length;U<G;U++)V[U]=C[U];return new FindMatch(K,V)}class LineFeedCounter{constructor(C){const W=[];let V=0;for(let U=0,G=C.length;U<G;U++)C.charCodeAt(U)===10&&(W[V++]=U);this._lineFeedsOffsets=W}findLineFeedCountBeforeOffset(C){const W=this._lineFeedsOffsets;let V=0,U=W.length-1;if(U===-1||C<=W[0])return 0;for(;V<U;){const G=V+((U-V)/2>>0);W[G]>=C?U=G-1:W[G+1]>=C?(V=G,U=G):V=G+1}return V+1}}class TextModelSearch{static findMatches(C,W,V,U,G){const Z=W.parseSearchRequest();return Z?Z.regex.multiline?this._doFindMatchesMultiline(C,V,new Searcher(Z.wordSeparators,Z.regex),U,G):this._doFindMatchesLineByLine(C,V,Z,U,G):[]}static _getMultilineMatchRange(C,W,V,U,G,Z){let X,Q=0;U?(Q=U.findLineFeedCountBeforeOffset(G),X=W+G+Q):X=W+G;let J;if(U){const ne=U.findLineFeedCountBeforeOffset(G+Z.length)-Q;J=X+Z.length+ne}else J=X+Z.length;const ee=C.getPositionAt(X),te=C.getPositionAt(J);return new Range$2(ee.lineNumber,ee.column,te.lineNumber,te.column)}static _doFindMatchesMultiline(C,W,V,U,G){const Z=C.getOffsetAt(W.getStartPosition()),X=C.getValueInRange(W,1),Q=C.getEOL()===`\r
`?new LineFeedCounter(X):null,J=[];let ee=0,te;for(V.reset(0);te=V.next(X);)if(J[ee++]=createFindMatch(this._getMultilineMatchRange(C,Z,X,Q,te.index,te[0]),te,U),ee>=G)return J;return J}static _doFindMatchesLineByLine(C,W,V,U,G){const Z=[];let X=0;if(W.startLineNumber===W.endLineNumber){const J=C.getLineContent(W.startLineNumber).substring(W.startColumn-1,W.endColumn-1);return X=this._findMatchesInLine(V,J,W.startLineNumber,W.startColumn-1,X,Z,U,G),Z}const Q=C.getLineContent(W.startLineNumber).substring(W.startColumn-1);X=this._findMatchesInLine(V,Q,W.startLineNumber,W.startColumn-1,X,Z,U,G);for(let J=W.startLineNumber+1;J<W.endLineNumber&&X<G;J++)X=this._findMatchesInLine(V,C.getLineContent(J),J,0,X,Z,U,G);if(X<G){const J=C.getLineContent(W.endLineNumber).substring(0,W.endColumn-1);X=this._findMatchesInLine(V,J,W.endLineNumber,0,X,Z,U,G)}return Z}static _findMatchesInLine(C,W,V,U,G,Z,X,Q){const J=C.wordSeparators;if(!X&&C.simpleSearch){const ie=C.simpleSearch,ne=ie.length,oe=W.length;let re=-ne;for(;(re=W.indexOf(ie,re+ne))!==-1;)if((!J||isValidMatch(J,W,oe,re,ne))&&(Z[G++]=new FindMatch(new Range$2(V,re+1+U,V,re+1+ne+U),null),G>=Q))return G;return G}const ee=new Searcher(C.wordSeparators,C.regex);let te;ee.reset(0);do if(te=ee.next(W),te&&(Z[G++]=createFindMatch(new Range$2(V,te.index+1+U,V,te.index+1+te[0].length+U),te,X),G>=Q))return G;while(te);return G}static findNextMatch(C,W,V,U){const G=W.parseSearchRequest();if(!G)return null;const Z=new Searcher(G.wordSeparators,G.regex);return G.regex.multiline?this._doFindNextMatchMultiline(C,V,Z,U):this._doFindNextMatchLineByLine(C,V,Z,U)}static _doFindNextMatchMultiline(C,W,V,U){const G=new Position$1(W.lineNumber,1),Z=C.getOffsetAt(G),X=C.getLineCount(),Q=C.getValueInRange(new Range$2(G.lineNumber,G.column,X,C.getLineMaxColumn(X)),1),J=C.getEOL()===`\r
`?new LineFeedCounter(Q):null;V.reset(W.column-1);const ee=V.next(Q);return ee?createFindMatch(this._getMultilineMatchRange(C,Z,Q,J,ee.index,ee[0]),ee,U):W.lineNumber!==1||W.column!==1?this._doFindNextMatchMultiline(C,new Position$1(1,1),V,U):null}static _doFindNextMatchLineByLine(C,W,V,U){const G=C.getLineCount(),Z=W.lineNumber,X=C.getLineContent(Z),Q=this._findFirstMatchInLine(V,X,Z,W.column,U);if(Q)return Q;for(let J=1;J<=G;J++){const ee=(Z+J-1)%G,te=C.getLineContent(ee+1),ie=this._findFirstMatchInLine(V,te,ee+1,1,U);if(ie)return ie}return null}static _findFirstMatchInLine(C,W,V,U,G){C.reset(U-1);const Z=C.next(W);return Z?createFindMatch(new Range$2(V,Z.index+1,V,Z.index+1+Z[0].length),Z,G):null}static findPreviousMatch(C,W,V,U){const G=W.parseSearchRequest();if(!G)return null;const Z=new Searcher(G.wordSeparators,G.regex);return G.regex.multiline?this._doFindPreviousMatchMultiline(C,V,Z,U):this._doFindPreviousMatchLineByLine(C,V,Z,U)}static _doFindPreviousMatchMultiline(C,W,V,U){const G=this._doFindMatchesMultiline(C,new Range$2(1,1,W.lineNumber,W.column),V,U,10*LIMIT_FIND_COUNT$1);if(G.length>0)return G[G.length-1];const Z=C.getLineCount();return W.lineNumber!==Z||W.column!==C.getLineMaxColumn(Z)?this._doFindPreviousMatchMultiline(C,new Position$1(Z,C.getLineMaxColumn(Z)),V,U):null}static _doFindPreviousMatchLineByLine(C,W,V,U){const G=C.getLineCount(),Z=W.lineNumber,X=C.getLineContent(Z).substring(0,W.column-1),Q=this._findLastMatchInLine(V,X,Z,U);if(Q)return Q;for(let J=1;J<=G;J++){const ee=(G+Z-J-1)%G,te=C.getLineContent(ee+1),ie=this._findLastMatchInLine(V,te,ee+1,U);if(ie)return ie}return null}static _findLastMatchInLine(C,W,V,U){let G=null,Z;for(C.reset(0);Z=C.next(W);)G=createFindMatch(new Range$2(V,Z.index+1,V,Z.index+1+Z[0].length),Z,U);return G}}function leftIsWordBounday(K,C,W,V,U){if(V===0)return!0;const G=C.charCodeAt(V-1);if(K.get(G)!==0||G===13||G===10)return!0;if(U>0){const Z=C.charCodeAt(V);if(K.get(Z)!==0)return!0}return!1}function rightIsWordBounday(K,C,W,V,U){if(V+U===W)return!0;const G=C.charCodeAt(V+U);if(K.get(G)!==0||G===13||G===10)return!0;if(U>0){const Z=C.charCodeAt(V+U-1);if(K.get(Z)!==0)return!0}return!1}function isValidMatch(K,C,W,V,U){return leftIsWordBounday(K,C,W,V,U)&&rightIsWordBounday(K,C,W,V,U)}class Searcher{constructor(C,W){this._wordSeparators=C,this._searchRegex=W,this._prevMatchStartIndex=-1,this._prevMatchLength=0}reset(C){this._searchRegex.lastIndex=C,this._prevMatchStartIndex=-1,this._prevMatchLength=0}next(C){const W=C.length;let V;do{if(this._prevMatchStartIndex+this._prevMatchLength===W||(V=this._searchRegex.exec(C),!V))return null;const U=V.index,G=V[0].length;if(U===this._prevMatchStartIndex&&G===this._prevMatchLength){if(G===0){getNextCodePoint(C,W,this._searchRegex.lastIndex)>65535?this._searchRegex.lastIndex+=2:this._searchRegex.lastIndex+=1;continue}return null}if(this._prevMatchStartIndex=U,this._prevMatchLength=G,!this._wordSeparators||isValidMatch(this._wordSeparators,C,W,U,G))return V}while(V);return null}}class UnicodeTextModelHighlighter{static computeUnicodeHighlights(C,W,V){const U=V?V.startLineNumber:1,G=V?V.endLineNumber:C.getLineCount(),Z=new CodePointHighlighter(W),X=Z.getCandidateCodePoints();let Q;X==="allNonBasicAscii"?Q=new RegExp("[^\\t\\n\\r\\x20-\\x7E]","g"):Q=new RegExp(`${buildRegExpCharClassExpr(Array.from(X))}`,"g");const J=new Searcher(null,Q),ee=[];let te=!1,ie,ne=0,oe=0,re=0;e:for(let ae=U,se=G;ae<=se;ae++){const le=C.getLineContent(ae),ce=le.length;J.reset(0);do if(ie=J.next(le),ie){let de=ie.index,ue=ie.index+ie[0].length;if(de>0){const pe=le.charCodeAt(de-1);isHighSurrogate(pe)&&de--}if(ue+1<ce){const pe=le.charCodeAt(ue-1);isHighSurrogate(pe)&&ue++}const ge=le.substring(de,ue);let he=getWordAtText(de+1,DEFAULT_WORD_REGEXP,le,0);he&&he.endColumn<=de+1&&(he=null);const fe=Z.shouldHighlightNonBasicASCII(ge,he?he.word:null);if(fe!==0){fe===3?ne++:fe===2?oe++:fe===1?re++:assertNever();const pe=1e3;if(ee.length>=pe){te=!0;break e}ee.push(new Range$2(ae,de+1,ae,ue+1))}}while(ie)}return{ranges:ee,hasMore:te,ambiguousCharacterCount:ne,invisibleCharacterCount:oe,nonBasicAsciiCharacterCount:re}}static computeUnicodeHighlightReason(C,W){const V=new CodePointHighlighter(W);switch(V.shouldHighlightNonBasicASCII(C,null)){case 0:return null;case 2:return{kind:1};case 3:{const G=C.codePointAt(0),Z=V.ambiguousCharacters.getPrimaryConfusable(G),X=AmbiguousCharacters.getLocales().filter(Q=>!AmbiguousCharacters.getInstance(new Set([...W.allowedLocales,Q])).isAmbiguous(G));return{kind:0,confusableWith:String.fromCodePoint(Z),notAmbiguousInLocales:X}}case 1:return{kind:2}}}}function buildRegExpCharClassExpr(K,C){return`[${escapeRegExpCharacters(K.map(V=>String.fromCodePoint(V)).join(""))}]`}class CodePointHighlighter{constructor(C){this.options=C,this.allowedCodePoints=new Set(C.allowedCodePoints),this.ambiguousCharacters=AmbiguousCharacters.getInstance(new Set(C.allowedLocales))}getCandidateCodePoints(){if(this.options.nonBasicASCII)return"allNonBasicAscii";const C=new Set;if(this.options.invisibleCharacters)for(const W of InvisibleCharacters.codePoints)isAllowedInvisibleCharacter(String.fromCodePoint(W))||C.add(W);if(this.options.ambiguousCharacters)for(const W of this.ambiguousCharacters.getConfusableCodePoints())C.add(W);for(const W of this.allowedCodePoints)C.delete(W);return C}shouldHighlightNonBasicASCII(C,W){const V=C.codePointAt(0);if(this.allowedCodePoints.has(V))return 0;if(this.options.nonBasicASCII)return 1;let U=!1,G=!1;if(W)for(const Z of W){const X=Z.codePointAt(0),Q=isBasicASCII(Z);U=U||Q,!Q&&!this.ambiguousCharacters.isAmbiguous(X)&&!InvisibleCharacters.isInvisibleCharacter(X)&&(G=!0)}return!U&&G?0:this.options.invisibleCharacters&&!isAllowedInvisibleCharacter(C)&&InvisibleCharacters.isInvisibleCharacter(V)?2:this.options.ambiguousCharacters&&this.ambiguousCharacters.isAmbiguous(V)?3:0}}function isAllowedInvisibleCharacter(K){return K===" "||K===`
`||K==="	"}class LinesDiff{constructor(C,W,V){this.changes=C,this.moves=W,this.hitTimeout=V}}class MovedText{constructor(C,W){this.lineRangeMapping=C,this.changes=W}}class OffsetRange{static addRange(C,W){let V=0;for(;V<W.length&&W[V].endExclusive<C.start;)V++;let U=V;for(;U<W.length&&W[U].start<=C.endExclusive;)U++;if(V===U)W.splice(V,0,C);else{const G=Math.min(C.start,W[V].start),Z=Math.max(C.endExclusive,W[U-1].endExclusive);W.splice(V,U-V,new OffsetRange(G,Z))}}static tryCreate(C,W){if(!(C>W))return new OffsetRange(C,W)}static ofLength(C){return new OffsetRange(0,C)}constructor(C,W){if(this.start=C,this.endExclusive=W,C>W)throw new BugIndicatingError(`Invalid range: ${this.toString()}`)}get isEmpty(){return this.start===this.endExclusive}delta(C){return new OffsetRange(this.start+C,this.endExclusive+C)}deltaStart(C){return new OffsetRange(this.start+C,this.endExclusive)}deltaEnd(C){return new OffsetRange(this.start,this.endExclusive+C)}get length(){return this.endExclusive-this.start}toString(){return`[${this.start}, ${this.endExclusive})`}equals(C){return this.start===C.start&&this.endExclusive===C.endExclusive}containsRange(C){return this.start<=C.start&&C.endExclusive<=this.endExclusive}contains(C){return this.start<=C&&C<this.endExclusive}join(C){return new OffsetRange(Math.min(this.start,C.start),Math.max(this.endExclusive,C.endExclusive))}intersect(C){const W=Math.max(this.start,C.start),V=Math.min(this.endExclusive,C.endExclusive);if(W<=V)return new OffsetRange(W,V)}slice(C){return C.slice(this.start,this.endExclusive)}clip(C){if(this.isEmpty)throw new BugIndicatingError(`Invalid clipping range: ${this.toString()}`);return Math.max(this.start,Math.min(this.endExclusive-1,C))}clipCyclic(C){if(this.isEmpty)throw new BugIndicatingError(`Invalid clipping range: ${this.toString()}`);return C<this.start?this.endExclusive-(this.start-C)%this.length:C>=this.endExclusive?this.start+(C-this.start)%this.length:C}forEach(C){for(let W=this.start;W<this.endExclusive;W++)C(W)}}class OffsetRangeSet{constructor(){this._sortedRanges=[]}addRange(C){let W=0;for(;W<this._sortedRanges.length&&this._sortedRanges[W].endExclusive<C.start;)W++;let V=W;for(;V<this._sortedRanges.length&&this._sortedRanges[V].start<=C.endExclusive;)V++;if(W===V)this._sortedRanges.splice(W,0,C);else{const U=Math.min(C.start,this._sortedRanges[W].start),G=Math.max(C.endExclusive,this._sortedRanges[V-1].endExclusive);this._sortedRanges.splice(W,V-W,new OffsetRange(U,G))}}toString(){return this._sortedRanges.map(C=>C.toString()).join(", ")}intersectsStrict(C){let W=0;for(;W<this._sortedRanges.length&&this._sortedRanges[W].endExclusive<=C.start;)W++;return W<this._sortedRanges.length&&this._sortedRanges[W].start<C.endExclusive}intersectWithRange(C){const W=new OffsetRangeSet;for(const V of this._sortedRanges){const U=V.intersect(C);U&&W.addRange(U)}return W}intersectWithRangeLength(C){return this.intersectWithRange(C).length}get length(){return this._sortedRanges.reduce((C,W)=>C+W.length,0)}}function findLast$2(K,C,W){const V=findLastIdx(K,C);if(V!==-1)return K[V]}function findLastIdx(K,C,W=K.length-1){for(let V=W;V>=0;V--){const U=K[V];if(C(U))return V}return-1}function findLastMonotonous(K,C){const W=findLastIdxMonotonous(K,C);return W===-1?void 0:K[W]}function findLastIdxMonotonous(K,C,W=0,V=K.length){let U=W,G=V;for(;U<G;){const Z=Math.floor((U+G)/2);C(K[Z])?U=Z+1:G=Z}return U-1}function findFirstMonotonous(K,C){const W=findFirstIdxMonotonousOrArrLen(K,C);return W===K.length?void 0:K[W]}function findFirstIdxMonotonousOrArrLen(K,C,W=0,V=K.length){let U=W,G=V;for(;U<G;){const Z=Math.floor((U+G)/2);C(K[Z])?G=Z:U=Z+1}return U}class MonotonousArray{constructor(C){this._array=C,this._findLastMonotonousLastIdx=0}findLastMonotonous(C){if(MonotonousArray.assertInvariants){if(this._prevFindLastPredicate){for(const V of this._array)if(this._prevFindLastPredicate(V)&&!C(V))throw new Error("MonotonousArray: current predicate must be weaker than (or equal to) the previous predicate.")}this._prevFindLastPredicate=C}const W=findLastIdxMonotonous(this._array,C,this._findLastMonotonousLastIdx);return this._findLastMonotonousLastIdx=W+1,W===-1?void 0:this._array[W]}}MonotonousArray.assertInvariants=!1;function findFirstMaxBy(K,C){if(K.length===0)return;let W=K[0];for(let V=1;V<K.length;V++){const U=K[V];C(U,W)>0&&(W=U)}return W}function findLastMaxBy(K,C){if(K.length===0)return;let W=K[0];for(let V=1;V<K.length;V++){const U=K[V];C(U,W)>=0&&(W=U)}return W}function findFirstMinBy(K,C){return findFirstMaxBy(K,(W,V)=>-C(W,V))}function findMaxIdxBy(K,C){if(K.length===0)return-1;let W=0;for(let V=1;V<K.length;V++){const U=K[V];C(U,K[W])>0&&(W=V)}return W}function mapFindFirst(K,C){for(const W of K){const V=C(W);if(V!==void 0)return V}}let LineRange$1=class Tt{static fromRange(C){return new Tt(C.startLineNumber,C.endLineNumber)}static joinMany(C){if(C.length===0)return[];let W=new LineRangeSet(C[0].slice());for(let V=1;V<C.length;V++)W=W.getUnion(new LineRangeSet(C[V].slice()));return W.ranges}static ofLength(C,W){return new Tt(C,C+W)}static deserialize(C){return new Tt(C[0],C[1])}constructor(C,W){if(C>W)throw new BugIndicatingError(`startLineNumber ${C} cannot be after endLineNumberExclusive ${W}`);this.startLineNumber=C,this.endLineNumberExclusive=W}contains(C){return this.startLineNumber<=C&&C<this.endLineNumberExclusive}get isEmpty(){return this.startLineNumber===this.endLineNumberExclusive}delta(C){return new Tt(this.startLineNumber+C,this.endLineNumberExclusive+C)}deltaLength(C){return new Tt(this.startLineNumber,this.endLineNumberExclusive+C)}get length(){return this.endLineNumberExclusive-this.startLineNumber}join(C){return new Tt(Math.min(this.startLineNumber,C.startLineNumber),Math.max(this.endLineNumberExclusive,C.endLineNumberExclusive))}toString(){return`[${this.startLineNumber},${this.endLineNumberExclusive})`}intersect(C){const W=Math.max(this.startLineNumber,C.startLineNumber),V=Math.min(this.endLineNumberExclusive,C.endLineNumberExclusive);if(W<=V)return new Tt(W,V)}intersectsStrict(C){return this.startLineNumber<C.endLineNumberExclusive&&C.startLineNumber<this.endLineNumberExclusive}overlapOrTouch(C){return this.startLineNumber<=C.endLineNumberExclusive&&C.startLineNumber<=this.endLineNumberExclusive}equals(C){return this.startLineNumber===C.startLineNumber&&this.endLineNumberExclusive===C.endLineNumberExclusive}toInclusiveRange(){return this.isEmpty?null:new Range$2(this.startLineNumber,1,this.endLineNumberExclusive-1,Number.MAX_SAFE_INTEGER)}toExclusiveRange(){return new Range$2(this.startLineNumber,1,this.endLineNumberExclusive,1)}mapToLineArray(C){const W=[];for(let V=this.startLineNumber;V<this.endLineNumberExclusive;V++)W.push(C(V));return W}forEach(C){for(let W=this.startLineNumber;W<this.endLineNumberExclusive;W++)C(W)}serialize(){return[this.startLineNumber,this.endLineNumberExclusive]}includes(C){return this.startLineNumber<=C&&C<this.endLineNumberExclusive}toOffsetRange(){return new OffsetRange(this.startLineNumber-1,this.endLineNumberExclusive-1)}};class LineRangeSet{constructor(C=[]){this._normalizedRanges=C}get ranges(){return this._normalizedRanges}addRange(C){if(C.length===0)return;const W=findFirstIdxMonotonousOrArrLen(this._normalizedRanges,U=>U.endLineNumberExclusive>=C.startLineNumber),V=findLastIdxMonotonous(this._normalizedRanges,U=>U.startLineNumber<=C.endLineNumberExclusive)+1;if(W===V)this._normalizedRanges.splice(W,0,C);else if(W===V-1){const U=this._normalizedRanges[W];this._normalizedRanges[W]=U.join(C)}else{const U=this._normalizedRanges[W].join(this._normalizedRanges[V-1]).join(C);this._normalizedRanges.splice(W,V-W,U)}}contains(C){const W=findLastMonotonous(this._normalizedRanges,V=>V.startLineNumber<=C);return!!W&&W.endLineNumberExclusive>C}getUnion(C){if(this._normalizedRanges.length===0)return C;if(C._normalizedRanges.length===0)return this;const W=[];let V=0,U=0,G=null;for(;V<this._normalizedRanges.length||U<C._normalizedRanges.length;){let Z=null;if(V<this._normalizedRanges.length&&U<C._normalizedRanges.length){const X=this._normalizedRanges[V],Q=C._normalizedRanges[U];X.startLineNumber<Q.startLineNumber?(Z=X,V++):(Z=Q,U++)}else V<this._normalizedRanges.length?(Z=this._normalizedRanges[V],V++):(Z=C._normalizedRanges[U],U++);G===null?G=Z:G.endLineNumberExclusive>=Z.startLineNumber?G=new LineRange$1(G.startLineNumber,Math.max(G.endLineNumberExclusive,Z.endLineNumberExclusive)):(W.push(G),G=Z)}return G!==null&&W.push(G),new LineRangeSet(W)}subtractFrom(C){const W=findFirstIdxMonotonousOrArrLen(this._normalizedRanges,Z=>Z.endLineNumberExclusive>=C.startLineNumber),V=findLastIdxMonotonous(this._normalizedRanges,Z=>Z.startLineNumber<=C.endLineNumberExclusive)+1;if(W===V)return new LineRangeSet([C]);const U=[];let G=C.startLineNumber;for(let Z=W;Z<V;Z++){const X=this._normalizedRanges[Z];X.startLineNumber>G&&U.push(new LineRange$1(G,X.startLineNumber)),G=X.endLineNumberExclusive}return G<C.endLineNumberExclusive&&U.push(new LineRange$1(G,C.endLineNumberExclusive)),new LineRangeSet(U)}toString(){return this._normalizedRanges.map(C=>C.toString()).join(", ")}getIntersection(C){const W=[];let V=0,U=0;for(;V<this._normalizedRanges.length&&U<C._normalizedRanges.length;){const G=this._normalizedRanges[V],Z=C._normalizedRanges[U],X=G.intersect(Z);X&&!X.isEmpty&&W.push(X),G.endLineNumberExclusive<Z.endLineNumberExclusive?V++:U++}return new LineRangeSet(W)}getWithDelta(C){return new LineRangeSet(this._normalizedRanges.map(W=>W.delta(C)))}}class LineRangeMapping{static inverse(C,W,V){const U=[];let G=1,Z=1;for(const Q of C){const J=new DetailedLineRangeMapping(new LineRange$1(G,Q.original.startLineNumber),new LineRange$1(Z,Q.modified.startLineNumber),void 0);J.modified.isEmpty||U.push(J),G=Q.original.endLineNumberExclusive,Z=Q.modified.endLineNumberExclusive}const X=new DetailedLineRangeMapping(new LineRange$1(G,W+1),new LineRange$1(Z,V+1),void 0);return X.modified.isEmpty||U.push(X),U}constructor(C,W){this.original=C,this.modified=W}toString(){return`{${this.original.toString()}->${this.modified.toString()}}`}flip(){return new LineRangeMapping(this.modified,this.original)}join(C){return new LineRangeMapping(this.original.join(C.original),this.modified.join(C.modified))}}class DetailedLineRangeMapping extends LineRangeMapping{constructor(C,W,V){super(C,W),this.innerChanges=V}flip(){var C;return new DetailedLineRangeMapping(this.modified,this.original,(C=this.innerChanges)===null||C===void 0?void 0:C.map(W=>W.flip()))}}class RangeMapping{constructor(C,W){this.originalRange=C,this.modifiedRange=W}toString(){return`{${this.originalRange.toString()}->${this.modifiedRange.toString()}}`}flip(){return new RangeMapping(this.modifiedRange,this.originalRange)}}const MINIMUM_MATCHING_CHARACTER_LENGTH=3;class LegacyLinesDiffComputer{computeDiff(C,W,V){var U;const Z=new DiffComputer(C,W,{maxComputationTime:V.maxComputationTimeMs,shouldIgnoreTrimWhitespace:V.ignoreTrimWhitespace,shouldComputeCharChanges:!0,shouldMakePrettyDiff:!0,shouldPostProcessCharChanges:!0}).computeDiff(),X=[];let Q=null;for(const J of Z.changes){let ee;J.originalEndLineNumber===0?ee=new LineRange$1(J.originalStartLineNumber+1,J.originalStartLineNumber+1):ee=new LineRange$1(J.originalStartLineNumber,J.originalEndLineNumber+1);let te;J.modifiedEndLineNumber===0?te=new LineRange$1(J.modifiedStartLineNumber+1,J.modifiedStartLineNumber+1):te=new LineRange$1(J.modifiedStartLineNumber,J.modifiedEndLineNumber+1);let ie=new DetailedLineRangeMapping(ee,te,(U=J.charChanges)===null||U===void 0?void 0:U.map(ne=>new RangeMapping(new Range$2(ne.originalStartLineNumber,ne.originalStartColumn,ne.originalEndLineNumber,ne.originalEndColumn),new Range$2(ne.modifiedStartLineNumber,ne.modifiedStartColumn,ne.modifiedEndLineNumber,ne.modifiedEndColumn))));Q&&(Q.modified.endLineNumberExclusive===ie.modified.startLineNumber||Q.original.endLineNumberExclusive===ie.original.startLineNumber)&&(ie=new DetailedLineRangeMapping(Q.original.join(ie.original),Q.modified.join(ie.modified),Q.innerChanges&&ie.innerChanges?Q.innerChanges.concat(ie.innerChanges):void 0),X.pop()),X.push(ie),Q=ie}return assertFn(()=>checkAdjacentItems(X,(J,ee)=>ee.original.startLineNumber-J.original.endLineNumberExclusive===ee.modified.startLineNumber-J.modified.endLineNumberExclusive&&J.original.endLineNumberExclusive<ee.original.startLineNumber&&J.modified.endLineNumberExclusive<ee.modified.startLineNumber)),new LinesDiff(X,[],Z.quitEarly)}}function computeDiff(K,C,W,V){return new LcsDiff(K,C,W).ComputeDiff(V)}let LineSequence$1=class{constructor(C){const W=[],V=[];for(let U=0,G=C.length;U<G;U++)W[U]=getFirstNonBlankColumn(C[U],1),V[U]=getLastNonBlankColumn(C[U],1);this.lines=C,this._startColumns=W,this._endColumns=V}getElements(){const C=[];for(let W=0,V=this.lines.length;W<V;W++)C[W]=this.lines[W].substring(this._startColumns[W]-1,this._endColumns[W]-1);return C}getStrictElement(C){return this.lines[C]}getStartLineNumber(C){return C+1}getEndLineNumber(C){return C+1}createCharSequence(C,W,V){const U=[],G=[],Z=[];let X=0;for(let Q=W;Q<=V;Q++){const J=this.lines[Q],ee=C?this._startColumns[Q]:1,te=C?this._endColumns[Q]:J.length+1;for(let ie=ee;ie<te;ie++)U[X]=J.charCodeAt(ie-1),G[X]=Q+1,Z[X]=ie,X++;!C&&Q<V&&(U[X]=10,G[X]=Q+1,Z[X]=J.length+1,X++)}return new CharSequence(U,G,Z)}};class CharSequence{constructor(C,W,V){this._charCodes=C,this._lineNumbers=W,this._columns=V}toString(){return"["+this._charCodes.map((C,W)=>(C===10?"\\n":String.fromCharCode(C))+`-(${this._lineNumbers[W]},${this._columns[W]})`).join(", ")+"]"}_assertIndex(C,W){if(C<0||C>=W.length)throw new Error("Illegal index")}getElements(){return this._charCodes}getStartLineNumber(C){return C>0&&C===this._lineNumbers.length?this.getEndLineNumber(C-1):(this._assertIndex(C,this._lineNumbers),this._lineNumbers[C])}getEndLineNumber(C){return C===-1?this.getStartLineNumber(C+1):(this._assertIndex(C,this._lineNumbers),this._charCodes[C]===10?this._lineNumbers[C]+1:this._lineNumbers[C])}getStartColumn(C){return C>0&&C===this._columns.length?this.getEndColumn(C-1):(this._assertIndex(C,this._columns),this._columns[C])}getEndColumn(C){return C===-1?this.getStartColumn(C+1):(this._assertIndex(C,this._columns),this._charCodes[C]===10?1:this._columns[C]+1)}}class CharChange{constructor(C,W,V,U,G,Z,X,Q){this.originalStartLineNumber=C,this.originalStartColumn=W,this.originalEndLineNumber=V,this.originalEndColumn=U,this.modifiedStartLineNumber=G,this.modifiedStartColumn=Z,this.modifiedEndLineNumber=X,this.modifiedEndColumn=Q}static createFromDiffChange(C,W,V){const U=W.getStartLineNumber(C.originalStart),G=W.getStartColumn(C.originalStart),Z=W.getEndLineNumber(C.originalStart+C.originalLength-1),X=W.getEndColumn(C.originalStart+C.originalLength-1),Q=V.getStartLineNumber(C.modifiedStart),J=V.getStartColumn(C.modifiedStart),ee=V.getEndLineNumber(C.modifiedStart+C.modifiedLength-1),te=V.getEndColumn(C.modifiedStart+C.modifiedLength-1);return new CharChange(U,G,Z,X,Q,J,ee,te)}}function postProcessCharChanges(K){if(K.length<=1)return K;const C=[K[0]];let W=C[0];for(let V=1,U=K.length;V<U;V++){const G=K[V],Z=G.originalStart-(W.originalStart+W.originalLength),X=G.modifiedStart-(W.modifiedStart+W.modifiedLength);Math.min(Z,X)<MINIMUM_MATCHING_CHARACTER_LENGTH?(W.originalLength=G.originalStart+G.originalLength-W.originalStart,W.modifiedLength=G.modifiedStart+G.modifiedLength-W.modifiedStart):(C.push(G),W=G)}return C}class LineChange{constructor(C,W,V,U,G){this.originalStartLineNumber=C,this.originalEndLineNumber=W,this.modifiedStartLineNumber=V,this.modifiedEndLineNumber=U,this.charChanges=G}static createFromDiffResult(C,W,V,U,G,Z,X){let Q,J,ee,te,ie;if(W.originalLength===0?(Q=V.getStartLineNumber(W.originalStart)-1,J=0):(Q=V.getStartLineNumber(W.originalStart),J=V.getEndLineNumber(W.originalStart+W.originalLength-1)),W.modifiedLength===0?(ee=U.getStartLineNumber(W.modifiedStart)-1,te=0):(ee=U.getStartLineNumber(W.modifiedStart),te=U.getEndLineNumber(W.modifiedStart+W.modifiedLength-1)),Z&&W.originalLength>0&&W.originalLength<20&&W.modifiedLength>0&&W.modifiedLength<20&&G()){const ne=V.createCharSequence(C,W.originalStart,W.originalStart+W.originalLength-1),oe=U.createCharSequence(C,W.modifiedStart,W.modifiedStart+W.modifiedLength-1);if(ne.getElements().length>0&&oe.getElements().length>0){let re=computeDiff(ne,oe,G,!0).changes;X&&(re=postProcessCharChanges(re)),ie=[];for(let ae=0,se=re.length;ae<se;ae++)ie.push(CharChange.createFromDiffChange(re[ae],ne,oe))}}return new LineChange(Q,J,ee,te,ie)}}class DiffComputer{constructor(C,W,V){this.shouldComputeCharChanges=V.shouldComputeCharChanges,this.shouldPostProcessCharChanges=V.shouldPostProcessCharChanges,this.shouldIgnoreTrimWhitespace=V.shouldIgnoreTrimWhitespace,this.shouldMakePrettyDiff=V.shouldMakePrettyDiff,this.originalLines=C,this.modifiedLines=W,this.original=new LineSequence$1(C),this.modified=new LineSequence$1(W),this.continueLineDiff=createContinueProcessingPredicate(V.maxComputationTime),this.continueCharDiff=createContinueProcessingPredicate(V.maxComputationTime===0?0:Math.min(V.maxComputationTime,5e3))}computeDiff(){if(this.original.lines.length===1&&this.original.lines[0].length===0)return this.modified.lines.length===1&&this.modified.lines[0].length===0?{quitEarly:!1,changes:[]}:{quitEarly:!1,changes:[{originalStartLineNumber:1,originalEndLineNumber:1,modifiedStartLineNumber:1,modifiedEndLineNumber:this.modified.lines.length,charChanges:void 0}]};if(this.modified.lines.length===1&&this.modified.lines[0].length===0)return{quitEarly:!1,changes:[{originalStartLineNumber:1,originalEndLineNumber:this.original.lines.length,modifiedStartLineNumber:1,modifiedEndLineNumber:1,charChanges:void 0}]};const C=computeDiff(this.original,this.modified,this.continueLineDiff,this.shouldMakePrettyDiff),W=C.changes,V=C.quitEarly;if(this.shouldIgnoreTrimWhitespace){const X=[];for(let Q=0,J=W.length;Q<J;Q++)X.push(LineChange.createFromDiffResult(this.shouldIgnoreTrimWhitespace,W[Q],this.original,this.modified,this.continueCharDiff,this.shouldComputeCharChanges,this.shouldPostProcessCharChanges));return{quitEarly:V,changes:X}}const U=[];let G=0,Z=0;for(let X=-1,Q=W.length;X<Q;X++){const J=X+1<Q?W[X+1]:null,ee=J?J.originalStart:this.originalLines.length,te=J?J.modifiedStart:this.modifiedLines.length;for(;G<ee&&Z<te;){const ie=this.originalLines[G],ne=this.modifiedLines[Z];if(ie!==ne){{let oe=getFirstNonBlankColumn(ie,1),re=getFirstNonBlankColumn(ne,1);for(;oe>1&&re>1;){const ae=ie.charCodeAt(oe-2),se=ne.charCodeAt(re-2);if(ae!==se)break;oe--,re--}(oe>1||re>1)&&this._pushTrimWhitespaceCharChange(U,G+1,1,oe,Z+1,1,re)}{let oe=getLastNonBlankColumn(ie,1),re=getLastNonBlankColumn(ne,1);const ae=ie.length+1,se=ne.length+1;for(;oe<ae&&re<se;){const le=ie.charCodeAt(oe-1),ce=ie.charCodeAt(re-1);if(le!==ce)break;oe++,re++}(oe<ae||re<se)&&this._pushTrimWhitespaceCharChange(U,G+1,oe,ae,Z+1,re,se)}}G++,Z++}J&&(U.push(LineChange.createFromDiffResult(this.shouldIgnoreTrimWhitespace,J,this.original,this.modified,this.continueCharDiff,this.shouldComputeCharChanges,this.shouldPostProcessCharChanges)),G+=J.originalLength,Z+=J.modifiedLength)}return{quitEarly:V,changes:U}}_pushTrimWhitespaceCharChange(C,W,V,U,G,Z,X){if(this._mergeTrimWhitespaceCharChange(C,W,V,U,G,Z,X))return;let Q;this.shouldComputeCharChanges&&(Q=[new CharChange(W,V,W,U,G,Z,G,X)]),C.push(new LineChange(W,W,G,G,Q))}_mergeTrimWhitespaceCharChange(C,W,V,U,G,Z,X){const Q=C.length;if(Q===0)return!1;const J=C[Q-1];return J.originalEndLineNumber===0||J.modifiedEndLineNumber===0?!1:J.originalEndLineNumber===W&&J.modifiedEndLineNumber===G?(this.shouldComputeCharChanges&&J.charChanges&&J.charChanges.push(new CharChange(W,V,W,U,G,Z,G,X)),!0):J.originalEndLineNumber+1===W&&J.modifiedEndLineNumber+1===G?(J.originalEndLineNumber=W,J.modifiedEndLineNumber=G,this.shouldComputeCharChanges&&J.charChanges&&J.charChanges.push(new CharChange(W,V,W,U,G,Z,G,X)),!0):!1}}function getFirstNonBlankColumn(K,C){const W=firstNonWhitespaceIndex(K);return W===-1?C:W+1}function getLastNonBlankColumn(K,C){const W=lastNonWhitespaceIndex(K);return W===-1?C:W+2}function createContinueProcessingPredicate(K){if(K===0)return()=>!0;const C=Date.now();return()=>Date.now()-C<K}class DiffAlgorithmResult{static trivial(C,W){return new DiffAlgorithmResult([new SequenceDiff(OffsetRange.ofLength(C.length),OffsetRange.ofLength(W.length))],!1)}static trivialTimedOut(C,W){return new DiffAlgorithmResult([new SequenceDiff(OffsetRange.ofLength(C.length),OffsetRange.ofLength(W.length))],!0)}constructor(C,W){this.diffs=C,this.hitTimeout=W}}class SequenceDiff{static invert(C,W){const V=[];return forEachAdjacent(C,(U,G)=>{V.push(SequenceDiff.fromOffsetPairs(U?U.getEndExclusives():OffsetPair.zero,G?G.getStarts():new OffsetPair(W,(U?U.seq2Range.endExclusive-U.seq1Range.endExclusive:0)+W)))}),V}static fromOffsetPairs(C,W){return new SequenceDiff(new OffsetRange(C.offset1,W.offset1),new OffsetRange(C.offset2,W.offset2))}constructor(C,W){this.seq1Range=C,this.seq2Range=W}swap(){return new SequenceDiff(this.seq2Range,this.seq1Range)}toString(){return`${this.seq1Range} <-> ${this.seq2Range}`}join(C){return new SequenceDiff(this.seq1Range.join(C.seq1Range),this.seq2Range.join(C.seq2Range))}delta(C){return C===0?this:new SequenceDiff(this.seq1Range.delta(C),this.seq2Range.delta(C))}deltaStart(C){return C===0?this:new SequenceDiff(this.seq1Range.deltaStart(C),this.seq2Range.deltaStart(C))}deltaEnd(C){return C===0?this:new SequenceDiff(this.seq1Range.deltaEnd(C),this.seq2Range.deltaEnd(C))}intersect(C){const W=this.seq1Range.intersect(C.seq1Range),V=this.seq2Range.intersect(C.seq2Range);if(!(!W||!V))return new SequenceDiff(W,V)}getStarts(){return new OffsetPair(this.seq1Range.start,this.seq2Range.start)}getEndExclusives(){return new OffsetPair(this.seq1Range.endExclusive,this.seq2Range.endExclusive)}}class OffsetPair{constructor(C,W){this.offset1=C,this.offset2=W}toString(){return`${this.offset1} <-> ${this.offset2}`}}OffsetPair.zero=new OffsetPair(0,0);OffsetPair.max=new OffsetPair(Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER);class InfiniteTimeout{isValid(){return!0}}InfiniteTimeout.instance=new InfiniteTimeout;class DateTimeout{constructor(C){if(this.timeout=C,this.startTime=Date.now(),this.valid=!0,C<=0)throw new BugIndicatingError("timeout must be positive")}isValid(){if(!(Date.now()-this.startTime<this.timeout)&&this.valid){this.valid=!1;debugger}return this.valid}}class Array2D{constructor(C,W){this.width=C,this.height=W,this.array=[],this.array=new Array(C*W)}get(C,W){return this.array[C+W*this.width]}set(C,W,V){this.array[C+W*this.width]=V}}function isSpace(K){return K===32||K===9}class LineRangeFragment{static getKey(C){let W=this.chrKeys.get(C);return W===void 0&&(W=this.chrKeys.size,this.chrKeys.set(C,W)),W}constructor(C,W,V){this.range=C,this.lines=W,this.source=V,this.histogram=[];let U=0;for(let G=C.startLineNumber-1;G<C.endLineNumberExclusive-1;G++){const Z=W[G];for(let Q=0;Q<Z.length;Q++){U++;const J=Z[Q],ee=LineRangeFragment.getKey(J);this.histogram[ee]=(this.histogram[ee]||0)+1}U++;const X=LineRangeFragment.getKey(`
`);this.histogram[X]=(this.histogram[X]||0)+1}this.totalCount=U}computeSimilarity(C){var W,V;let U=0;const G=Math.max(this.histogram.length,C.histogram.length);for(let Z=0;Z<G;Z++)U+=Math.abs(((W=this.histogram[Z])!==null&&W!==void 0?W:0)-((V=C.histogram[Z])!==null&&V!==void 0?V:0));return 1-U/(this.totalCount+C.totalCount)}}LineRangeFragment.chrKeys=new Map;class DynamicProgrammingDiffing{compute(C,W,V=InfiniteTimeout.instance,U){if(C.length===0||W.length===0)return DiffAlgorithmResult.trivial(C,W);const G=new Array2D(C.length,W.length),Z=new Array2D(C.length,W.length),X=new Array2D(C.length,W.length);for(let oe=0;oe<C.length;oe++)for(let re=0;re<W.length;re++){if(!V.isValid())return DiffAlgorithmResult.trivialTimedOut(C,W);const ae=oe===0?0:G.get(oe-1,re),se=re===0?0:G.get(oe,re-1);let le;C.getElement(oe)===W.getElement(re)?(oe===0||re===0?le=0:le=G.get(oe-1,re-1),oe>0&&re>0&&Z.get(oe-1,re-1)===3&&(le+=X.get(oe-1,re-1)),le+=U?U(oe,re):1):le=-1;const ce=Math.max(ae,se,le);if(ce===le){const de=oe>0&&re>0?X.get(oe-1,re-1):0;X.set(oe,re,de+1),Z.set(oe,re,3)}else ce===ae?(X.set(oe,re,0),Z.set(oe,re,1)):ce===se&&(X.set(oe,re,0),Z.set(oe,re,2));G.set(oe,re,ce)}const Q=[];let J=C.length,ee=W.length;function te(oe,re){(oe+1!==J||re+1!==ee)&&Q.push(new SequenceDiff(new OffsetRange(oe+1,J),new OffsetRange(re+1,ee))),J=oe,ee=re}let ie=C.length-1,ne=W.length-1;for(;ie>=0&&ne>=0;)Z.get(ie,ne)===3?(te(ie,ne),ie--,ne--):Z.get(ie,ne)===1?ie--:ne--;return te(-1,-1),Q.reverse(),new DiffAlgorithmResult(Q,!1)}}class MyersDiffAlgorithm{compute(C,W,V=InfiniteTimeout.instance){if(C.length===0||W.length===0)return DiffAlgorithmResult.trivial(C,W);const U=C,G=W;function Z(re,ae){for(;re<U.length&&ae<G.length&&U.getElement(re)===G.getElement(ae);)re++,ae++;return re}let X=0;const Q=new FastInt32Array;Q.set(0,Z(0,0));const J=new FastArrayNegativeIndices;J.set(0,Q.get(0)===0?null:new SnakePath(null,0,0,Q.get(0)));let ee=0;e:for(;;){if(X++,!V.isValid())return DiffAlgorithmResult.trivialTimedOut(U,G);const re=-Math.min(X,G.length+X%2),ae=Math.min(X,U.length+X%2);for(ee=re;ee<=ae;ee+=2){const se=ee===ae?-1:Q.get(ee+1),le=ee===re?-1:Q.get(ee-1)+1,ce=Math.min(Math.max(se,le),U.length),de=ce-ee;if(ce>U.length||de>G.length)continue;const ue=Z(ce,de);Q.set(ee,ue);const ge=ce===se?J.get(ee+1):J.get(ee-1);if(J.set(ee,ue!==ce?new SnakePath(ge,ce,de,ue-ce):ge),Q.get(ee)===U.length&&Q.get(ee)-ee===G.length)break e}}let te=J.get(ee);const ie=[];let ne=U.length,oe=G.length;for(;;){const re=te?te.x+te.length:0,ae=te?te.y+te.length:0;if((re!==ne||ae!==oe)&&ie.push(new SequenceDiff(new OffsetRange(re,ne),new OffsetRange(ae,oe))),!te)break;ne=te.x,oe=te.y,te=te.prev}return ie.reverse(),new DiffAlgorithmResult(ie,!1)}}class SnakePath{constructor(C,W,V,U){this.prev=C,this.x=W,this.y=V,this.length=U}}class FastInt32Array{constructor(){this.positiveArr=new Int32Array(10),this.negativeArr=new Int32Array(10)}get(C){return C<0?(C=-C-1,this.negativeArr[C]):this.positiveArr[C]}set(C,W){if(C<0){if(C=-C-1,C>=this.negativeArr.length){const V=this.negativeArr;this.negativeArr=new Int32Array(V.length*2),this.negativeArr.set(V)}this.negativeArr[C]=W}else{if(C>=this.positiveArr.length){const V=this.positiveArr;this.positiveArr=new Int32Array(V.length*2),this.positiveArr.set(V)}this.positiveArr[C]=W}}}class FastArrayNegativeIndices{constructor(){this.positiveArr=[],this.negativeArr=[]}get(C){return C<0?(C=-C-1,this.negativeArr[C]):this.positiveArr[C]}set(C,W){C<0?(C=-C-1,this.negativeArr[C]=W):this.positiveArr[C]=W}}var _a$2,_b$1;class ResourceMapEntry{constructor(C,W){this.uri=C,this.value=W}}function isEntries(K){return Array.isArray(K)}class ResourceMap{constructor(C,W){if(this[_a$2]="ResourceMap",C instanceof ResourceMap)this.map=new Map(C.map),this.toKey=W??ResourceMap.defaultToKey;else if(isEntries(C)){this.map=new Map,this.toKey=W??ResourceMap.defaultToKey;for(const[V,U]of C)this.set(V,U)}else this.map=new Map,this.toKey=C??ResourceMap.defaultToKey}set(C,W){return this.map.set(this.toKey(C),new ResourceMapEntry(C,W)),this}get(C){var W;return(W=this.map.get(this.toKey(C)))===null||W===void 0?void 0:W.value}has(C){return this.map.has(this.toKey(C))}get size(){return this.map.size}clear(){this.map.clear()}delete(C){return this.map.delete(this.toKey(C))}forEach(C,W){typeof W<"u"&&(C=C.bind(W));for(const[V,U]of this.map)C(U.value,U.uri,this)}*values(){for(const C of this.map.values())yield C.value}*keys(){for(const C of this.map.values())yield C.uri}*entries(){for(const C of this.map.values())yield[C.uri,C.value]}*[(_a$2=Symbol.toStringTag,Symbol.iterator)](){for(const[,C]of this.map)yield[C.uri,C.value]}}ResourceMap.defaultToKey=K=>K.toString();class LinkedMap{constructor(){this[_b$1]="LinkedMap",this._map=new Map,this._head=void 0,this._tail=void 0,this._size=0,this._state=0}clear(){this._map.clear(),this._head=void 0,this._tail=void 0,this._size=0,this._state++}isEmpty(){return!this._head&&!this._tail}get size(){return this._size}get first(){var C;return(C=this._head)===null||C===void 0?void 0:C.value}get last(){var C;return(C=this._tail)===null||C===void 0?void 0:C.value}has(C){return this._map.has(C)}get(C,W=0){const V=this._map.get(C);if(V)return W!==0&&this.touch(V,W),V.value}set(C,W,V=0){let U=this._map.get(C);if(U)U.value=W,V!==0&&this.touch(U,V);else{switch(U={key:C,value:W,next:void 0,previous:void 0},V){case 0:this.addItemLast(U);break;case 1:this.addItemFirst(U);break;case 2:this.addItemLast(U);break;default:this.addItemLast(U);break}this._map.set(C,U),this._size++}return this}delete(C){return!!this.remove(C)}remove(C){const W=this._map.get(C);if(W)return this._map.delete(C),this.removeItem(W),this._size--,W.value}shift(){if(!this._head&&!this._tail)return;if(!this._head||!this._tail)throw new Error("Invalid list");const C=this._head;return this._map.delete(C.key),this.removeItem(C),this._size--,C.value}forEach(C,W){const V=this._state;let U=this._head;for(;U;){if(W?C.bind(W)(U.value,U.key,this):C(U.value,U.key,this),this._state!==V)throw new Error("LinkedMap got modified during iteration.");U=U.next}}keys(){const C=this,W=this._state;let V=this._head;const U={[Symbol.iterator](){return U},next(){if(C._state!==W)throw new Error("LinkedMap got modified during iteration.");if(V){const G={value:V.key,done:!1};return V=V.next,G}else return{value:void 0,done:!0}}};return U}values(){const C=this,W=this._state;let V=this._head;const U={[Symbol.iterator](){return U},next(){if(C._state!==W)throw new Error("LinkedMap got modified during iteration.");if(V){const G={value:V.value,done:!1};return V=V.next,G}else return{value:void 0,done:!0}}};return U}entries(){const C=this,W=this._state;let V=this._head;const U={[Symbol.iterator](){return U},next(){if(C._state!==W)throw new Error("LinkedMap got modified during iteration.");if(V){const G={value:[V.key,V.value],done:!1};return V=V.next,G}else return{value:void 0,done:!0}}};return U}[(_b$1=Symbol.toStringTag,Symbol.iterator)](){return this.entries()}trimOld(C){if(C>=this.size)return;if(C===0){this.clear();return}let W=this._head,V=this.size;for(;W&&V>C;)this._map.delete(W.key),W=W.next,V--;this._head=W,this._size=V,W&&(W.previous=void 0),this._state++}addItemFirst(C){if(!this._head&&!this._tail)this._tail=C;else if(this._head)C.next=this._head,this._head.previous=C;else throw new Error("Invalid list");this._head=C,this._state++}addItemLast(C){if(!this._head&&!this._tail)this._head=C;else if(this._tail)C.previous=this._tail,this._tail.next=C;else throw new Error("Invalid list");this._tail=C,this._state++}removeItem(C){if(C===this._head&&C===this._tail)this._head=void 0,this._tail=void 0;else if(C===this._head){if(!C.next)throw new Error("Invalid list");C.next.previous=void 0,this._head=C.next}else if(C===this._tail){if(!C.previous)throw new Error("Invalid list");C.previous.next=void 0,this._tail=C.previous}else{const W=C.next,V=C.previous;if(!W||!V)throw new Error("Invalid list");W.previous=V,V.next=W}C.next=void 0,C.previous=void 0,this._state++}touch(C,W){if(!this._head||!this._tail)throw new Error("Invalid list");if(!(W!==1&&W!==2)){if(W===1){if(C===this._head)return;const V=C.next,U=C.previous;C===this._tail?(U.next=void 0,this._tail=U):(V.previous=U,U.next=V),C.previous=void 0,C.next=this._head,this._head.previous=C,this._head=C,this._state++}else if(W===2){if(C===this._tail)return;const V=C.next,U=C.previous;C===this._head?(V.previous=void 0,this._head=V):(V.previous=U,U.next=V),C.next=void 0,C.previous=this._tail,this._tail.next=C,this._tail=C,this._state++}}}toJSON(){const C=[];return this.forEach((W,V)=>{C.push([V,W])}),C}fromJSON(C){this.clear();for(const[W,V]of C)this.set(W,V)}}class LRUCache extends LinkedMap{constructor(C,W=1){super(),this._limit=C,this._ratio=Math.min(Math.max(0,W),1)}get limit(){return this._limit}set limit(C){this._limit=C,this.checkTrim()}get(C,W=2){return super.get(C,W)}peek(C){return super.get(C,0)}set(C,W){return super.set(C,W,2),this.checkTrim(),this}checkTrim(){this.size>this._limit&&this.trimOld(Math.round(this._limit*this._ratio))}}class BidirectionalMap{constructor(C){if(this._m1=new Map,this._m2=new Map,C)for(const[W,V]of C)this.set(W,V)}clear(){this._m1.clear(),this._m2.clear()}set(C,W){this._m1.set(C,W),this._m2.set(W,C)}get(C){return this._m1.get(C)}getKey(C){return this._m2.get(C)}delete(C){const W=this._m1.get(C);return W===void 0?!1:(this._m1.delete(C),this._m2.delete(W),!0)}keys(){return this._m1.keys()}values(){return this._m1.values()}}class SetMap{constructor(){this.map=new Map}add(C,W){let V=this.map.get(C);V||(V=new Set,this.map.set(C,V)),V.add(W)}delete(C,W){const V=this.map.get(C);V&&(V.delete(W),V.size===0&&this.map.delete(C))}forEach(C,W){const V=this.map.get(C);V&&V.forEach(W)}get(C){const W=this.map.get(C);return W||new Set}}class LinesSliceCharSequence{constructor(C,W,V){this.lines=C,this.considerWhitespaceChanges=V,this.elements=[],this.firstCharOffsetByLine=[],this.additionalOffsetByLine=[];let U=!1;W.start>0&&W.endExclusive>=C.length&&(W=new OffsetRange(W.start-1,W.endExclusive),U=!0),this.lineRange=W,this.firstCharOffsetByLine[0]=0;for(let G=this.lineRange.start;G<this.lineRange.endExclusive;G++){let Z=C[G],X=0;if(U)X=Z.length,Z="",U=!1;else if(!V){const Q=Z.trimStart();X=Z.length-Q.length,Z=Q.trimEnd()}this.additionalOffsetByLine.push(X);for(let Q=0;Q<Z.length;Q++)this.elements.push(Z.charCodeAt(Q));G<C.length-1&&(this.elements.push(`
`.charCodeAt(0)),this.firstCharOffsetByLine[G-this.lineRange.start+1]=this.elements.length)}this.additionalOffsetByLine.push(0)}toString(){return`Slice: "${this.text}"`}get text(){return this.getText(new OffsetRange(0,this.length))}getText(C){return this.elements.slice(C.start,C.endExclusive).map(W=>String.fromCharCode(W)).join("")}getElement(C){return this.elements[C]}get length(){return this.elements.length}getBoundaryScore(C){const W=getCategory(C>0?this.elements[C-1]:-1),V=getCategory(C<this.elements.length?this.elements[C]:-1);if(W===6&&V===7)return 0;let U=0;return W!==V&&(U+=10,W===0&&V===1&&(U+=1)),U+=getCategoryBoundaryScore(W),U+=getCategoryBoundaryScore(V),U}translateOffset(C){if(this.lineRange.isEmpty)return new Position$1(this.lineRange.start+1,1);const W=findLastIdxMonotonous(this.firstCharOffsetByLine,V=>V<=C);return new Position$1(this.lineRange.start+W+1,C-this.firstCharOffsetByLine[W]+this.additionalOffsetByLine[W]+1)}translateRange(C){return Range$2.fromPositions(this.translateOffset(C.start),this.translateOffset(C.endExclusive))}findWordContaining(C){if(C<0||C>=this.elements.length||!isWordChar(this.elements[C]))return;let W=C;for(;W>0&&isWordChar(this.elements[W-1]);)W--;let V=C;for(;V<this.elements.length&&isWordChar(this.elements[V]);)V++;return new OffsetRange(W,V)}countLinesIn(C){return this.translateOffset(C.endExclusive).lineNumber-this.translateOffset(C.start).lineNumber}isStronglyEqual(C,W){return this.elements[C]===this.elements[W]}extendToFullLines(C){var W,V;const U=(W=findLastMonotonous(this.firstCharOffsetByLine,Z=>Z<=C.start))!==null&&W!==void 0?W:0,G=(V=findFirstMonotonous(this.firstCharOffsetByLine,Z=>C.endExclusive<=Z))!==null&&V!==void 0?V:this.elements.length;return new OffsetRange(U,G)}}function isWordChar(K){return K>=97&&K<=122||K>=65&&K<=90||K>=48&&K<=57}const score$1={0:0,1:0,2:0,3:10,4:2,5:3,6:10,7:10};function getCategoryBoundaryScore(K){return score$1[K]}function getCategory(K){return K===10?7:K===13?6:isSpace(K)?5:K>=97&&K<=122?0:K>=65&&K<=90?1:K>=48&&K<=57?2:K===-1?3:4}function computeMovedLines(K,C,W,V,U,G){let{moves:Z,excludedChanges:X}=computeMovesFromSimpleDeletionsToSimpleInsertions(K,C,W,G);if(!G.isValid())return[];const Q=K.filter(ee=>!X.has(ee)),J=computeUnchangedMoves(Q,V,U,C,W,G);return pushMany(Z,J),Z=joinCloseConsecutiveMoves(Z),Z=Z.filter(ee=>ee.original.toOffsetRange().slice(C).map(ie=>ie.trim()).join(`
`).length>=10),Z=removeMovesInSameDiff(K,Z),Z}function computeMovesFromSimpleDeletionsToSimpleInsertions(K,C,W,V){const U=[],G=K.filter(Q=>Q.modified.isEmpty&&Q.original.length>=3).map(Q=>new LineRangeFragment(Q.original,C,Q)),Z=new Set(K.filter(Q=>Q.original.isEmpty&&Q.modified.length>=3).map(Q=>new LineRangeFragment(Q.modified,W,Q))),X=new Set;for(const Q of G){let J=-1,ee;for(const te of Z){const ie=Q.computeSimilarity(te);ie>J&&(J=ie,ee=te)}if(J>.9&&ee&&(Z.delete(ee),U.push(new LineRangeMapping(Q.range,ee.range)),X.add(Q.source),X.add(ee.source)),!V.isValid())return{moves:U,excludedChanges:X}}return{moves:U,excludedChanges:X}}function computeUnchangedMoves(K,C,W,V,U,G){const Z=[],X=new SetMap;for(const ie of K)for(let ne=ie.original.startLineNumber;ne<ie.original.endLineNumberExclusive-2;ne++){const oe=`${C[ne-1]}:${C[ne+1-1]}:${C[ne+2-1]}`;X.add(oe,{range:new LineRange$1(ne,ne+3)})}const Q=[];K.sort(compareBy(ie=>ie.modified.startLineNumber,numberComparator));for(const ie of K){let ne=[];for(let oe=ie.modified.startLineNumber;oe<ie.modified.endLineNumberExclusive-2;oe++){const re=`${W[oe-1]}:${W[oe+1-1]}:${W[oe+2-1]}`,ae=new LineRange$1(oe,oe+3),se=[];X.forEach(re,({range:le})=>{for(const de of ne)if(de.originalLineRange.endLineNumberExclusive+1===le.endLineNumberExclusive&&de.modifiedLineRange.endLineNumberExclusive+1===ae.endLineNumberExclusive){de.originalLineRange=new LineRange$1(de.originalLineRange.startLineNumber,le.endLineNumberExclusive),de.modifiedLineRange=new LineRange$1(de.modifiedLineRange.startLineNumber,ae.endLineNumberExclusive),se.push(de);return}const ce={modifiedLineRange:ae,originalLineRange:le};Q.push(ce),se.push(ce)}),ne=se}if(!G.isValid())return[]}Q.sort(reverseOrder(compareBy(ie=>ie.modifiedLineRange.length,numberComparator)));const J=new LineRangeSet,ee=new LineRangeSet;for(const ie of Q){const ne=ie.modifiedLineRange.startLineNumber-ie.originalLineRange.startLineNumber,oe=J.subtractFrom(ie.modifiedLineRange),re=ee.subtractFrom(ie.originalLineRange).getWithDelta(ne),ae=oe.getIntersection(re);for(const se of ae.ranges){if(se.length<3)continue;const le=se,ce=se.delta(-ne);Z.push(new LineRangeMapping(ce,le)),J.addRange(le),ee.addRange(ce)}}Z.sort(compareBy(ie=>ie.original.startLineNumber,numberComparator));const te=new MonotonousArray(K);for(let ie=0;ie<Z.length;ie++){const ne=Z[ie],oe=te.findLastMonotonous(ge=>ge.original.startLineNumber<=ne.original.startLineNumber),re=findLastMonotonous(K,ge=>ge.modified.startLineNumber<=ne.modified.startLineNumber),ae=Math.max(ne.original.startLineNumber-oe.original.startLineNumber,ne.modified.startLineNumber-re.modified.startLineNumber),se=te.findLastMonotonous(ge=>ge.original.startLineNumber<ne.original.endLineNumberExclusive),le=findLastMonotonous(K,ge=>ge.modified.startLineNumber<ne.modified.endLineNumberExclusive),ce=Math.max(se.original.endLineNumberExclusive-ne.original.endLineNumberExclusive,le.modified.endLineNumberExclusive-ne.modified.endLineNumberExclusive);let de;for(de=0;de<ae;de++){const ge=ne.original.startLineNumber-de-1,he=ne.modified.startLineNumber-de-1;if(ge>V.length||he>U.length||J.contains(he)||ee.contains(ge)||!areLinesSimilar(V[ge-1],U[he-1],G))break}de>0&&(ee.addRange(new LineRange$1(ne.original.startLineNumber-de,ne.original.startLineNumber)),J.addRange(new LineRange$1(ne.modified.startLineNumber-de,ne.modified.startLineNumber)));let ue;for(ue=0;ue<ce;ue++){const ge=ne.original.endLineNumberExclusive+ue,he=ne.modified.endLineNumberExclusive+ue;if(ge>V.length||he>U.length||J.contains(he)||ee.contains(ge)||!areLinesSimilar(V[ge-1],U[he-1],G))break}ue>0&&(ee.addRange(new LineRange$1(ne.original.endLineNumberExclusive,ne.original.endLineNumberExclusive+ue)),J.addRange(new LineRange$1(ne.modified.endLineNumberExclusive,ne.modified.endLineNumberExclusive+ue))),(de>0||ue>0)&&(Z[ie]=new LineRangeMapping(new LineRange$1(ne.original.startLineNumber-de,ne.original.endLineNumberExclusive+ue),new LineRange$1(ne.modified.startLineNumber-de,ne.modified.endLineNumberExclusive+ue)))}return Z}function areLinesSimilar(K,C,W){if(K.trim()===C.trim())return!0;if(K.length>300&&C.length>300)return!1;const U=new MyersDiffAlgorithm().compute(new LinesSliceCharSequence([K],new OffsetRange(0,1),!1),new LinesSliceCharSequence([C],new OffsetRange(0,1),!1),W);let G=0;const Z=SequenceDiff.invert(U.diffs,K.length);for(const ee of Z)ee.seq1Range.forEach(te=>{isSpace(K.charCodeAt(te))||G++});function X(ee){let te=0;for(let ie=0;ie<K.length;ie++)isSpace(ee.charCodeAt(ie))||te++;return te}const Q=X(K.length>C.length?K:C);return G/Q>.6&&Q>10}function joinCloseConsecutiveMoves(K){if(K.length===0)return K;K.sort(compareBy(W=>W.original.startLineNumber,numberComparator));const C=[K[0]];for(let W=1;W<K.length;W++){const V=C[C.length-1],U=K[W],G=U.original.startLineNumber-V.original.endLineNumberExclusive,Z=U.modified.startLineNumber-V.modified.endLineNumberExclusive;if(G>=0&&Z>=0&&G+Z<=2){C[C.length-1]=V.join(U);continue}C.push(U)}return C}function removeMovesInSameDiff(K,C){const W=new MonotonousArray(K);return C=C.filter(V=>{const U=W.findLastMonotonous(X=>X.original.endLineNumberExclusive<V.original.endLineNumberExclusive)||new LineRangeMapping(new LineRange$1(1,1),new LineRange$1(1,1)),G=findLastMonotonous(K,X=>X.modified.endLineNumberExclusive<V.modified.endLineNumberExclusive);return U!==G}),C}function optimizeSequenceDiffs(K,C,W){let V=W;return V=joinSequenceDiffsByShifting(K,C,V),V=shiftSequenceDiffs(K,C,V),V}function joinSequenceDiffsByShifting(K,C,W){if(W.length===0)return W;const V=[];V.push(W[0]);for(let G=1;G<W.length;G++){const Z=V[V.length-1];let X=W[G];if(X.seq1Range.isEmpty||X.seq2Range.isEmpty){const Q=X.seq1Range.start-Z.seq1Range.endExclusive;let J;for(J=1;J<=Q&&!(K.getElement(X.seq1Range.start-J)!==K.getElement(X.seq1Range.endExclusive-J)||C.getElement(X.seq2Range.start-J)!==C.getElement(X.seq2Range.endExclusive-J));J++);if(J--,J===Q){V[V.length-1]=new SequenceDiff(new OffsetRange(Z.seq1Range.start,X.seq1Range.endExclusive-Q),new OffsetRange(Z.seq2Range.start,X.seq2Range.endExclusive-Q));continue}X=X.delta(-J)}V.push(X)}const U=[];for(let G=0;G<V.length-1;G++){const Z=V[G+1];let X=V[G];if(X.seq1Range.isEmpty||X.seq2Range.isEmpty){const Q=Z.seq1Range.start-X.seq1Range.endExclusive;let J;for(J=0;J<Q&&!(!K.isStronglyEqual(X.seq1Range.start+J,X.seq1Range.endExclusive+J)||!C.isStronglyEqual(X.seq2Range.start+J,X.seq2Range.endExclusive+J));J++);if(J===Q){V[G+1]=new SequenceDiff(new OffsetRange(X.seq1Range.start+Q,Z.seq1Range.endExclusive),new OffsetRange(X.seq2Range.start+Q,Z.seq2Range.endExclusive));continue}J>0&&(X=X.delta(J))}U.push(X)}return V.length>0&&U.push(V[V.length-1]),U}function shiftSequenceDiffs(K,C,W){if(!K.getBoundaryScore||!C.getBoundaryScore)return W;for(let V=0;V<W.length;V++){const U=V>0?W[V-1]:void 0,G=W[V],Z=V+1<W.length?W[V+1]:void 0,X=new OffsetRange(U?U.seq1Range.start+1:0,Z?Z.seq1Range.endExclusive-1:K.length),Q=new OffsetRange(U?U.seq2Range.start+1:0,Z?Z.seq2Range.endExclusive-1:C.length);G.seq1Range.isEmpty?W[V]=shiftDiffToBetterPosition(G,K,C,X,Q):G.seq2Range.isEmpty&&(W[V]=shiftDiffToBetterPosition(G.swap(),C,K,Q,X).swap())}return W}function shiftDiffToBetterPosition(K,C,W,V,U){let Z=1;for(;K.seq1Range.start-Z>=V.start&&K.seq2Range.start-Z>=U.start&&W.isStronglyEqual(K.seq2Range.start-Z,K.seq2Range.endExclusive-Z)&&Z<100;)Z++;Z--;let X=0;for(;K.seq1Range.start+X<V.endExclusive&&K.seq2Range.endExclusive+X<U.endExclusive&&W.isStronglyEqual(K.seq2Range.start+X,K.seq2Range.endExclusive+X)&&X<100;)X++;if(Z===0&&X===0)return K;let Q=0,J=-1;for(let ee=-Z;ee<=X;ee++){const te=K.seq2Range.start+ee,ie=K.seq2Range.endExclusive+ee,ne=K.seq1Range.start+ee,oe=C.getBoundaryScore(ne)+W.getBoundaryScore(te)+W.getBoundaryScore(ie);oe>J&&(J=oe,Q=ee)}return K.delta(Q)}function removeShortMatches(K,C,W){const V=[];for(const U of W){const G=V[V.length-1];if(!G){V.push(U);continue}U.seq1Range.start-G.seq1Range.endExclusive<=2||U.seq2Range.start-G.seq2Range.endExclusive<=2?V[V.length-1]=new SequenceDiff(G.seq1Range.join(U.seq1Range),G.seq2Range.join(U.seq2Range)):V.push(U)}return V}function extendDiffsToEntireWordIfAppropriate(K,C,W){const V=[];let U;function G(){if(!U)return;const X=U.s1Range.length-U.deleted;U.s2Range.length-U.added,Math.max(U.deleted,U.added)+(U.count-1)>X&&V.push(new SequenceDiff(U.s1Range,U.s2Range)),U=void 0}for(const X of W){let Q=function(ne,oe){var re,ae,se,le;if(!U||!U.s1Range.containsRange(ne)||!U.s2Range.containsRange(oe))if(U&&!(U.s1Range.endExclusive<ne.start&&U.s2Range.endExclusive<oe.start)){const ue=OffsetRange.tryCreate(U.s1Range.endExclusive,ne.start),ge=OffsetRange.tryCreate(U.s2Range.endExclusive,oe.start);U.deleted+=(re=ue==null?void 0:ue.length)!==null&&re!==void 0?re:0,U.added+=(ae=ge==null?void 0:ge.length)!==null&&ae!==void 0?ae:0,U.s1Range=U.s1Range.join(ne),U.s2Range=U.s2Range.join(oe)}else G(),U={added:0,deleted:0,count:0,s1Range:ne,s2Range:oe};const ce=ne.intersect(X.seq1Range),de=oe.intersect(X.seq2Range);U.count++,U.deleted+=(se=ce==null?void 0:ce.length)!==null&&se!==void 0?se:0,U.added+=(le=de==null?void 0:de.length)!==null&&le!==void 0?le:0};const J=K.findWordContaining(X.seq1Range.start-1),ee=C.findWordContaining(X.seq2Range.start-1),te=K.findWordContaining(X.seq1Range.endExclusive),ie=C.findWordContaining(X.seq2Range.endExclusive);J&&te&&ee&&ie&&J.equals(te)&&ee.equals(ie)?Q(J,ee):(J&&ee&&Q(J,ee),te&&ie&&Q(te,ie))}return G(),mergeSequenceDiffs(W,V)}function mergeSequenceDiffs(K,C){const W=[];for(;K.length>0||C.length>0;){const V=K[0],U=C[0];let G;V&&(!U||V.seq1Range.start<U.seq1Range.start)?G=K.shift():G=C.shift(),W.length>0&&W[W.length-1].seq1Range.endExclusive>=G.seq1Range.start?W[W.length-1]=W[W.length-1].join(G):W.push(G)}return W}function removeVeryShortMatchingLinesBetweenDiffs(K,C,W){let V=W;if(V.length===0)return V;let U=0,G;do{G=!1;const Z=[V[0]];for(let X=1;X<V.length;X++){let ee=function(ie,ne){const oe=new OffsetRange(J.seq1Range.endExclusive,Q.seq1Range.start);return K.getText(oe).replace(/\s/g,"").length<=4&&(ie.seq1Range.length+ie.seq2Range.length>5||ne.seq1Range.length+ne.seq2Range.length>5)};const Q=V[X],J=Z[Z.length-1];ee(J,Q)?(G=!0,Z[Z.length-1]=Z[Z.length-1].join(Q)):Z.push(Q)}V=Z}while(U++<10&&G);return V}function removeVeryShortMatchingTextBetweenLongDiffs(K,C,W){let V=W;if(V.length===0)return V;let U=0,G;do{G=!1;const X=[V[0]];for(let Q=1;Q<V.length;Q++){let te=function(ne,oe){const re=new OffsetRange(ee.seq1Range.endExclusive,J.seq1Range.start);if(K.countLinesIn(re)>5||re.length>500)return!1;const se=K.getText(re).trim();if(se.length>20||se.split(/\r\n|\r|\n/).length>1)return!1;const le=K.countLinesIn(ne.seq1Range),ce=ne.seq1Range.length,de=C.countLinesIn(ne.seq2Range),ue=ne.seq2Range.length,ge=K.countLinesIn(oe.seq1Range),he=oe.seq1Range.length,fe=C.countLinesIn(oe.seq2Range),pe=oe.seq2Range.length,Se=2*40+50;function Le(be){return Math.min(be,Se)}return Math.pow(Math.pow(Le(le*40+ce),1.5)+Math.pow(Le(de*40+ue),1.5),1.5)+Math.pow(Math.pow(Le(ge*40+he),1.5)+Math.pow(Le(fe*40+pe),1.5),1.5)>Math.pow(Math.pow(Se,1.5),1.5)*1.3};const J=V[Q],ee=X[X.length-1];te(ee,J)?(G=!0,X[X.length-1]=X[X.length-1].join(J)):X.push(J)}V=X}while(U++<10&&G);const Z=[];return forEachWithNeighbors(V,(X,Q,J)=>{let ee=Q;function te(se){return se.length>0&&se.trim().length<=3&&Q.seq1Range.length+Q.seq2Range.length>100}const ie=K.extendToFullLines(Q.seq1Range),ne=K.getText(new OffsetRange(ie.start,Q.seq1Range.start));te(ne)&&(ee=ee.deltaStart(-ne.length));const oe=K.getText(new OffsetRange(Q.seq1Range.endExclusive,ie.endExclusive));te(oe)&&(ee=ee.deltaEnd(oe.length));const re=SequenceDiff.fromOffsetPairs(X?X.getEndExclusives():OffsetPair.zero,J?J.getStarts():OffsetPair.max),ae=ee.intersect(re);Z.push(ae)}),Z}class LineSequence{constructor(C,W){this.trimmedHash=C,this.lines=W}getElement(C){return this.trimmedHash[C]}get length(){return this.trimmedHash.length}getBoundaryScore(C){const W=C===0?0:getIndentation(this.lines[C-1]),V=C===this.lines.length?0:getIndentation(this.lines[C]);return 1e3-(W+V)}getText(C){return this.lines.slice(C.start,C.endExclusive).join(`
`)}isStronglyEqual(C,W){return this.lines[C]===this.lines[W]}}function getIndentation(K){let C=0;for(;C<K.length&&(K.charCodeAt(C)===32||K.charCodeAt(C)===9);)C++;return C}class DefaultLinesDiffComputer{constructor(){this.dynamicProgrammingDiffing=new DynamicProgrammingDiffing,this.myersDiffingAlgorithm=new MyersDiffAlgorithm}computeDiff(C,W,V){if(C.length<=1&&equals$5(C,W,(ue,ge)=>ue===ge))return new LinesDiff([],[],!1);if(C.length===1&&C[0].length===0||W.length===1&&W[0].length===0)return new LinesDiff([new DetailedLineRangeMapping(new LineRange$1(1,C.length+1),new LineRange$1(1,W.length+1),[new RangeMapping(new Range$2(1,1,C.length,C[0].length+1),new Range$2(1,1,W.length,W[0].length+1))])],[],!1);const U=V.maxComputationTimeMs===0?InfiniteTimeout.instance:new DateTimeout(V.maxComputationTimeMs),G=!V.ignoreTrimWhitespace,Z=new Map;function X(ue){let ge=Z.get(ue);return ge===void 0&&(ge=Z.size,Z.set(ue,ge)),ge}const Q=C.map(ue=>X(ue.trim())),J=W.map(ue=>X(ue.trim())),ee=new LineSequence(Q,C),te=new LineSequence(J,W),ie=(()=>ee.length+te.length<1700?this.dynamicProgrammingDiffing.compute(ee,te,U,(ue,ge)=>C[ue]===W[ge]?W[ge].length===0?.1:1+Math.log(1+W[ge].length):.99):this.myersDiffingAlgorithm.compute(ee,te))();let ne=ie.diffs,oe=ie.hitTimeout;ne=optimizeSequenceDiffs(ee,te,ne),ne=removeVeryShortMatchingLinesBetweenDiffs(ee,te,ne);const re=[],ae=ue=>{if(G)for(let ge=0;ge<ue;ge++){const he=se+ge,fe=le+ge;if(C[he]!==W[fe]){const pe=this.refineDiff(C,W,new SequenceDiff(new OffsetRange(he,he+1),new OffsetRange(fe,fe+1)),U,G);for(const Se of pe.mappings)re.push(Se);pe.hitTimeout&&(oe=!0)}}};let se=0,le=0;for(const ue of ne){assertFn(()=>ue.seq1Range.start-se===ue.seq2Range.start-le);const ge=ue.seq1Range.start-se;ae(ge),se=ue.seq1Range.endExclusive,le=ue.seq2Range.endExclusive;const he=this.refineDiff(C,W,ue,U,G);he.hitTimeout&&(oe=!0);for(const fe of he.mappings)re.push(fe)}ae(C.length-se);const ce=lineRangeMappingFromRangeMappings(re,C,W);let de=[];return V.computeMoves&&(de=this.computeMoves(ce,C,W,Q,J,U,G)),assertFn(()=>{function ue(he,fe){if(he.lineNumber<1||he.lineNumber>fe.length)return!1;const pe=fe[he.lineNumber-1];return!(he.column<1||he.column>pe.length+1)}function ge(he,fe){return!(he.startLineNumber<1||he.startLineNumber>fe.length+1||he.endLineNumberExclusive<1||he.endLineNumberExclusive>fe.length+1)}for(const he of ce){if(!he.innerChanges)return!1;for(const fe of he.innerChanges)if(!(ue(fe.modifiedRange.getStartPosition(),W)&&ue(fe.modifiedRange.getEndPosition(),W)&&ue(fe.originalRange.getStartPosition(),C)&&ue(fe.originalRange.getEndPosition(),C)))return!1;if(!ge(he.modified,W)||!ge(he.original,C))return!1}return!0}),new LinesDiff(ce,de,oe)}computeMoves(C,W,V,U,G,Z,X){return computeMovedLines(C,W,V,U,G,Z).map(ee=>{const te=this.refineDiff(W,V,new SequenceDiff(ee.original.toOffsetRange(),ee.modified.toOffsetRange()),Z,X),ie=lineRangeMappingFromRangeMappings(te.mappings,W,V,!0);return new MovedText(ee,ie)})}refineDiff(C,W,V,U,G){const Z=new LinesSliceCharSequence(C,V.seq1Range,G),X=new LinesSliceCharSequence(W,V.seq2Range,G),Q=Z.length+X.length<500?this.dynamicProgrammingDiffing.compute(Z,X,U):this.myersDiffingAlgorithm.compute(Z,X,U);let J=Q.diffs;return J=optimizeSequenceDiffs(Z,X,J),J=extendDiffsToEntireWordIfAppropriate(Z,X,J),J=removeShortMatches(Z,X,J),J=removeVeryShortMatchingTextBetweenLongDiffs(Z,X,J),{mappings:J.map(te=>new RangeMapping(Z.translateRange(te.seq1Range),X.translateRange(te.seq2Range))),hitTimeout:Q.hitTimeout}}}function lineRangeMappingFromRangeMappings(K,C,W,V=!1){const U=[];for(const G of groupAdjacentBy(K.map(Z=>getLineRangeMapping(Z,C,W)),(Z,X)=>Z.original.overlapOrTouch(X.original)||Z.modified.overlapOrTouch(X.modified))){const Z=G[0],X=G[G.length-1];U.push(new DetailedLineRangeMapping(Z.original.join(X.original),Z.modified.join(X.modified),G.map(Q=>Q.innerChanges[0])))}return assertFn(()=>!V&&U.length>0&&U[0].original.startLineNumber!==U[0].modified.startLineNumber?!1:checkAdjacentItems(U,(G,Z)=>Z.original.startLineNumber-G.original.endLineNumberExclusive===Z.modified.startLineNumber-G.modified.endLineNumberExclusive&&G.original.endLineNumberExclusive<Z.original.startLineNumber&&G.modified.endLineNumberExclusive<Z.modified.startLineNumber)),U}function getLineRangeMapping(K,C,W){let V=0,U=0;K.modifiedRange.endColumn===1&&K.originalRange.endColumn===1&&K.originalRange.startLineNumber+V<=K.originalRange.endLineNumber&&K.modifiedRange.startLineNumber+V<=K.modifiedRange.endLineNumber&&(U=-1),K.modifiedRange.startColumn-1>=W[K.modifiedRange.startLineNumber-1].length&&K.originalRange.startColumn-1>=C[K.originalRange.startLineNumber-1].length&&K.originalRange.startLineNumber<=K.originalRange.endLineNumber+U&&K.modifiedRange.startLineNumber<=K.modifiedRange.endLineNumber+U&&(V=1);const G=new LineRange$1(K.originalRange.startLineNumber+V,K.originalRange.endLineNumber+1+U),Z=new LineRange$1(K.modifiedRange.startLineNumber+V,K.modifiedRange.endLineNumber+1+U);return new DetailedLineRangeMapping(G,Z,[K])}const linesDiffComputers={getLegacy:()=>new LegacyLinesDiffComputer,getDefault:()=>new DefaultLinesDiffComputer};function roundFloat(K,C){const W=Math.pow(10,C);return Math.round(K*W)/W}class RGBA{constructor(C,W,V,U=1){this._rgbaBrand=void 0,this.r=Math.min(255,Math.max(0,C))|0,this.g=Math.min(255,Math.max(0,W))|0,this.b=Math.min(255,Math.max(0,V))|0,this.a=roundFloat(Math.max(Math.min(1,U),0),3)}static equals(C,W){return C.r===W.r&&C.g===W.g&&C.b===W.b&&C.a===W.a}}class HSLA{constructor(C,W,V,U){this._hslaBrand=void 0,this.h=Math.max(Math.min(360,C),0)|0,this.s=roundFloat(Math.max(Math.min(1,W),0),3),this.l=roundFloat(Math.max(Math.min(1,V),0),3),this.a=roundFloat(Math.max(Math.min(1,U),0),3)}static equals(C,W){return C.h===W.h&&C.s===W.s&&C.l===W.l&&C.a===W.a}static fromRGBA(C){const W=C.r/255,V=C.g/255,U=C.b/255,G=C.a,Z=Math.max(W,V,U),X=Math.min(W,V,U);let Q=0,J=0;const ee=(X+Z)/2,te=Z-X;if(te>0){switch(J=Math.min(ee<=.5?te/(2*ee):te/(2-2*ee),1),Z){case W:Q=(V-U)/te+(V<U?6:0);break;case V:Q=(U-W)/te+2;break;case U:Q=(W-V)/te+4;break}Q*=60,Q=Math.round(Q)}return new HSLA(Q,J,ee,G)}static _hue2rgb(C,W,V){return V<0&&(V+=1),V>1&&(V-=1),V<1/6?C+(W-C)*6*V:V<1/2?W:V<2/3?C+(W-C)*(2/3-V)*6:C}static toRGBA(C){const W=C.h/360,{s:V,l:U,a:G}=C;let Z,X,Q;if(V===0)Z=X=Q=U;else{const J=U<.5?U*(1+V):U+V-U*V,ee=2*U-J;Z=HSLA._hue2rgb(ee,J,W+1/3),X=HSLA._hue2rgb(ee,J,W),Q=HSLA._hue2rgb(ee,J,W-1/3)}return new RGBA(Math.round(Z*255),Math.round(X*255),Math.round(Q*255),G)}}class HSVA{constructor(C,W,V,U){this._hsvaBrand=void 0,this.h=Math.max(Math.min(360,C),0)|0,this.s=roundFloat(Math.max(Math.min(1,W),0),3),this.v=roundFloat(Math.max(Math.min(1,V),0),3),this.a=roundFloat(Math.max(Math.min(1,U),0),3)}static equals(C,W){return C.h===W.h&&C.s===W.s&&C.v===W.v&&C.a===W.a}static fromRGBA(C){const W=C.r/255,V=C.g/255,U=C.b/255,G=Math.max(W,V,U),Z=Math.min(W,V,U),X=G-Z,Q=G===0?0:X/G;let J;return X===0?J=0:G===W?J=((V-U)/X%6+6)%6:G===V?J=(U-W)/X+2:J=(W-V)/X+4,new HSVA(Math.round(J*60),Q,G,C.a)}static toRGBA(C){const{h:W,s:V,v:U,a:G}=C,Z=U*V,X=Z*(1-Math.abs(W/60%2-1)),Q=U-Z;let[J,ee,te]=[0,0,0];return W<60?(J=Z,ee=X):W<120?(J=X,ee=Z):W<180?(ee=Z,te=X):W<240?(ee=X,te=Z):W<300?(J=X,te=Z):W<=360&&(J=Z,te=X),J=Math.round((J+Q)*255),ee=Math.round((ee+Q)*255),te=Math.round((te+Q)*255),new RGBA(J,ee,te,G)}}class Color{static fromHex(C){return Color.Format.CSS.parseHex(C)||Color.red}static equals(C,W){return!C&&!W?!0:!C||!W?!1:C.equals(W)}get hsla(){return this._hsla?this._hsla:HSLA.fromRGBA(this.rgba)}get hsva(){return this._hsva?this._hsva:HSVA.fromRGBA(this.rgba)}constructor(C){if(C)if(C instanceof RGBA)this.rgba=C;else if(C instanceof HSLA)this._hsla=C,this.rgba=HSLA.toRGBA(C);else if(C instanceof HSVA)this._hsva=C,this.rgba=HSVA.toRGBA(C);else throw new Error("Invalid color ctor argument");else throw new Error("Color needs a value")}equals(C){return!!C&&RGBA.equals(this.rgba,C.rgba)&&HSLA.equals(this.hsla,C.hsla)&&HSVA.equals(this.hsva,C.hsva)}getRelativeLuminance(){const C=Color._relativeLuminanceForComponent(this.rgba.r),W=Color._relativeLuminanceForComponent(this.rgba.g),V=Color._relativeLuminanceForComponent(this.rgba.b),U=.2126*C+.7152*W+.0722*V;return roundFloat(U,4)}static _relativeLuminanceForComponent(C){const W=C/255;return W<=.03928?W/12.92:Math.pow((W+.055)/1.055,2.4)}isLighter(){return(this.rgba.r*299+this.rgba.g*587+this.rgba.b*114)/1e3>=128}isLighterThan(C){const W=this.getRelativeLuminance(),V=C.getRelativeLuminance();return W>V}isDarkerThan(C){const W=this.getRelativeLuminance(),V=C.getRelativeLuminance();return W<V}lighten(C){return new Color(new HSLA(this.hsla.h,this.hsla.s,this.hsla.l+this.hsla.l*C,this.hsla.a))}darken(C){return new Color(new HSLA(this.hsla.h,this.hsla.s,this.hsla.l-this.hsla.l*C,this.hsla.a))}transparent(C){const{r:W,g:V,b:U,a:G}=this.rgba;return new Color(new RGBA(W,V,U,G*C))}isTransparent(){return this.rgba.a===0}isOpaque(){return this.rgba.a===1}opposite(){return new Color(new RGBA(255-this.rgba.r,255-this.rgba.g,255-this.rgba.b,this.rgba.a))}makeOpaque(C){if(this.isOpaque()||C.rgba.a!==1)return this;const{r:W,g:V,b:U,a:G}=this.rgba;return new Color(new RGBA(C.rgba.r-G*(C.rgba.r-W),C.rgba.g-G*(C.rgba.g-V),C.rgba.b-G*(C.rgba.b-U),1))}toString(){return this._toString||(this._toString=Color.Format.CSS.format(this)),this._toString}static getLighterColor(C,W,V){if(C.isLighterThan(W))return C;V=V||.5;const U=C.getRelativeLuminance(),G=W.getRelativeLuminance();return V=V*(G-U)/G,C.lighten(V)}static getDarkerColor(C,W,V){if(C.isDarkerThan(W))return C;V=V||.5;const U=C.getRelativeLuminance(),G=W.getRelativeLuminance();return V=V*(U-G)/U,C.darken(V)}}Color.white=new Color(new RGBA(255,255,255,1));Color.black=new Color(new RGBA(0,0,0,1));Color.red=new Color(new RGBA(255,0,0,1));Color.blue=new Color(new RGBA(0,0,255,1));Color.green=new Color(new RGBA(0,255,0,1));Color.cyan=new Color(new RGBA(0,255,255,1));Color.lightgrey=new Color(new RGBA(211,211,211,1));Color.transparent=new Color(new RGBA(0,0,0,0));(function(K){(function(C){(function(W){function V(ne){return ne.rgba.a===1?`rgb(${ne.rgba.r}, ${ne.rgba.g}, ${ne.rgba.b})`:K.Format.CSS.formatRGBA(ne)}W.formatRGB=V;function U(ne){return`rgba(${ne.rgba.r}, ${ne.rgba.g}, ${ne.rgba.b}, ${+ne.rgba.a.toFixed(2)})`}W.formatRGBA=U;function G(ne){return ne.hsla.a===1?`hsl(${ne.hsla.h}, ${(ne.hsla.s*100).toFixed(2)}%, ${(ne.hsla.l*100).toFixed(2)}%)`:K.Format.CSS.formatHSLA(ne)}W.formatHSL=G;function Z(ne){return`hsla(${ne.hsla.h}, ${(ne.hsla.s*100).toFixed(2)}%, ${(ne.hsla.l*100).toFixed(2)}%, ${ne.hsla.a.toFixed(2)})`}W.formatHSLA=Z;function X(ne){const oe=ne.toString(16);return oe.length!==2?"0"+oe:oe}function Q(ne){return`#${X(ne.rgba.r)}${X(ne.rgba.g)}${X(ne.rgba.b)}`}W.formatHex=Q;function J(ne,oe=!1){return oe&&ne.rgba.a===1?K.Format.CSS.formatHex(ne):`#${X(ne.rgba.r)}${X(ne.rgba.g)}${X(ne.rgba.b)}${X(Math.round(ne.rgba.a*255))}`}W.formatHexA=J;function ee(ne){return ne.isOpaque()?K.Format.CSS.formatHex(ne):K.Format.CSS.formatRGBA(ne)}W.format=ee;function te(ne){const oe=ne.length;if(oe===0||ne.charCodeAt(0)!==35)return null;if(oe===7){const re=16*ie(ne.charCodeAt(1))+ie(ne.charCodeAt(2)),ae=16*ie(ne.charCodeAt(3))+ie(ne.charCodeAt(4)),se=16*ie(ne.charCodeAt(5))+ie(ne.charCodeAt(6));return new K(new RGBA(re,ae,se,1))}if(oe===9){const re=16*ie(ne.charCodeAt(1))+ie(ne.charCodeAt(2)),ae=16*ie(ne.charCodeAt(3))+ie(ne.charCodeAt(4)),se=16*ie(ne.charCodeAt(5))+ie(ne.charCodeAt(6)),le=16*ie(ne.charCodeAt(7))+ie(ne.charCodeAt(8));return new K(new RGBA(re,ae,se,le/255))}if(oe===4){const re=ie(ne.charCodeAt(1)),ae=ie(ne.charCodeAt(2)),se=ie(ne.charCodeAt(3));return new K(new RGBA(16*re+re,16*ae+ae,16*se+se))}if(oe===5){const re=ie(ne.charCodeAt(1)),ae=ie(ne.charCodeAt(2)),se=ie(ne.charCodeAt(3)),le=ie(ne.charCodeAt(4));return new K(new RGBA(16*re+re,16*ae+ae,16*se+se,(16*le+le)/255))}return null}W.parseHex=te;function ie(ne){switch(ne){case 48:return 0;case 49:return 1;case 50:return 2;case 51:return 3;case 52:return 4;case 53:return 5;case 54:return 6;case 55:return 7;case 56:return 8;case 57:return 9;case 97:return 10;case 65:return 10;case 98:return 11;case 66:return 11;case 99:return 12;case 67:return 12;case 100:return 13;case 68:return 13;case 101:return 14;case 69:return 14;case 102:return 15;case 70:return 15}return 0}})(C.CSS||(C.CSS={}))})(K.Format||(K.Format={}))})(Color||(Color={}));function _parseCaptureGroups(K){const C=[];for(const W of K){const V=Number(W);(V||V===0&&W.replace(/\s/g,"")!=="")&&C.push(V)}return C}function _toIColor(K,C,W,V){return{red:K/255,blue:W/255,green:C/255,alpha:V}}function _findRange(K,C){const W=C.index,V=C[0].length;if(!W)return;const U=K.positionAt(W);return{startLineNumber:U.lineNumber,startColumn:U.column,endLineNumber:U.lineNumber,endColumn:U.column+V}}function _findHexColorInformation(K,C){if(!K)return;const W=Color.Format.CSS.parseHex(C);if(W)return{range:K,color:_toIColor(W.rgba.r,W.rgba.g,W.rgba.b,W.rgba.a)}}function _findRGBColorInformation(K,C,W){if(!K||C.length!==1)return;const U=C[0].values(),G=_parseCaptureGroups(U);return{range:K,color:_toIColor(G[0],G[1],G[2],W?G[3]:1)}}function _findHSLColorInformation(K,C,W){if(!K||C.length!==1)return;const U=C[0].values(),G=_parseCaptureGroups(U),Z=new Color(new HSLA(G[0],G[1]/100,G[2]/100,W?G[3]:1));return{range:K,color:_toIColor(Z.rgba.r,Z.rgba.g,Z.rgba.b,Z.rgba.a)}}function _findMatches(K,C){return typeof K=="string"?[...K.matchAll(C)]:K.findMatches(C)}function computeColors(K){const C=[],V=_findMatches(K,/\b(rgb|rgba|hsl|hsla)(\([0-9\s,.\%]*\))|(#)([A-Fa-f0-9]{3})\b|(#)([A-Fa-f0-9]{4})\b|(#)([A-Fa-f0-9]{6})\b|(#)([A-Fa-f0-9]{8})\b/gm);if(V.length>0)for(const U of V){const G=U.filter(J=>J!==void 0),Z=G[1],X=G[2];if(!X)continue;let Q;if(Z==="rgb"){const J=/^\(\s*(25[0-5]|2[0-4][0-9]|1[0-9]{2}|[1-9][0-9]|[0-9])\s*,\s*(25[0-5]|2[0-4][0-9]|1[0-9]{2}|[1-9][0-9]|[0-9])\s*,\s*(25[0-5]|2[0-4][0-9]|1[0-9]{2}|[1-9][0-9]|[0-9])\s*\)$/gm;Q=_findRGBColorInformation(_findRange(K,U),_findMatches(X,J),!1)}else if(Z==="rgba"){const J=/^\(\s*(25[0-5]|2[0-4][0-9]|1[0-9]{2}|[1-9][0-9]|[0-9])\s*,\s*(25[0-5]|2[0-4][0-9]|1[0-9]{2}|[1-9][0-9]|[0-9])\s*,\s*(25[0-5]|2[0-4][0-9]|1[0-9]{2}|[1-9][0-9]|[0-9])\s*,\s*(0[.][0-9]+|[.][0-9]+|[01][.]|[01])\s*\)$/gm;Q=_findRGBColorInformation(_findRange(K,U),_findMatches(X,J),!0)}else if(Z==="hsl"){const J=/^\(\s*(36[0]|3[0-5][0-9]|[12][0-9][0-9]|[1-9]?[0-9])\s*,\s*(100|\d{1,2}[.]\d*|\d{1,2})%\s*,\s*(100|\d{1,2}[.]\d*|\d{1,2})%\s*\)$/gm;Q=_findHSLColorInformation(_findRange(K,U),_findMatches(X,J),!1)}else if(Z==="hsla"){const J=/^\(\s*(36[0]|3[0-5][0-9]|[12][0-9][0-9]|[1-9]?[0-9])\s*,\s*(100|\d{1,2}[.]\d*|\d{1,2})%\s*,\s*(100|\d{1,2}[.]\d*|\d{1,2})%\s*,\s*(0[.][0-9]+|[.][0-9]+|[01][.]|[01])\s*\)$/gm;Q=_findHSLColorInformation(_findRange(K,U),_findMatches(X,J),!0)}else Z==="#"&&(Q=_findHexColorInformation(_findRange(K,U),Z+X));Q&&C.push(Q)}return C}function computeDefaultDocumentColors(K){return!K||typeof K.getValue!="function"||typeof K.positionAt!="function"?[]:computeColors(K)}var __awaiter$1y=globalThis&&globalThis.__awaiter||function(K,C,W,V){function U(G){return G instanceof W?G:new W(function(Z){Z(G)})}return new(W||(W=Promise))(function(G,Z){function X(ee){try{J(V.next(ee))}catch(te){Z(te)}}function Q(ee){try{J(V.throw(ee))}catch(te){Z(te)}}function J(ee){ee.done?G(ee.value):U(ee.value).then(X,Q)}J((V=V.apply(K,C||[])).next())})};class MirrorModel extends MirrorTextModel{get uri(){return this._uri}get eol(){return this._eol}getValue(){return this.getText()}findMatches(C){const W=[];for(let V=0;V<this._lines.length;V++){const U=this._lines[V],G=this.offsetAt(new Position$1(V+1,1)),Z=U.matchAll(C);for(const X of Z)(X.index||X.index===0)&&(X.index=X.index+G),W.push(X)}return W}getLinesContent(){return this._lines.slice(0)}getLineCount(){return this._lines.length}getLineContent(C){return this._lines[C-1]}getWordAtPosition(C,W){const V=getWordAtText(C.column,ensureValidWordDefinition(W),this._lines[C.lineNumber-1],0);return V?new Range$2(C.lineNumber,V.startColumn,C.lineNumber,V.endColumn):null}words(C){const W=this._lines,V=this._wordenize.bind(this);let U=0,G="",Z=0,X=[];return{*[Symbol.iterator](){for(;;)if(Z<X.length){const Q=G.substring(X[Z].start,X[Z].end);Z+=1,yield Q}else if(U<W.length)G=W[U],X=V(G,C),Z=0,U+=1;else break}}}getLineWords(C,W){const V=this._lines[C-1],U=this._wordenize(V,W),G=[];for(const Z of U)G.push({word:V.substring(Z.start,Z.end),startColumn:Z.start+1,endColumn:Z.end+1});return G}_wordenize(C,W){const V=[];let U;for(W.lastIndex=0;(U=W.exec(C))&&U[0].length!==0;)V.push({start:U.index,end:U.index+U[0].length});return V}getValueInRange(C){if(C=this._validateRange(C),C.startLineNumber===C.endLineNumber)return this._lines[C.startLineNumber-1].substring(C.startColumn-1,C.endColumn-1);const W=this._eol,V=C.startLineNumber-1,U=C.endLineNumber-1,G=[];G.push(this._lines[V].substring(C.startColumn-1));for(let Z=V+1;Z<U;Z++)G.push(this._lines[Z]);return G.push(this._lines[U].substring(0,C.endColumn-1)),G.join(W)}offsetAt(C){return C=this._validatePosition(C),this._ensureLineStarts(),this._lineStarts.getPrefixSum(C.lineNumber-2)+(C.column-1)}positionAt(C){C=Math.floor(C),C=Math.max(0,C),this._ensureLineStarts();const W=this._lineStarts.getIndexOf(C),V=this._lines[W.index].length;return{lineNumber:1+W.index,column:1+Math.min(W.remainder,V)}}_validateRange(C){const W=this._validatePosition({lineNumber:C.startLineNumber,column:C.startColumn}),V=this._validatePosition({lineNumber:C.endLineNumber,column:C.endColumn});return W.lineNumber!==C.startLineNumber||W.column!==C.startColumn||V.lineNumber!==C.endLineNumber||V.column!==C.endColumn?{startLineNumber:W.lineNumber,startColumn:W.column,endLineNumber:V.lineNumber,endColumn:V.column}:C}_validatePosition(C){if(!Position$1.isIPosition(C))throw new Error("bad position");let{lineNumber:W,column:V}=C,U=!1;if(W<1)W=1,V=1,U=!0;else if(W>this._lines.length)W=this._lines.length,V=this._lines[W-1].length+1,U=!0;else{const G=this._lines[W-1].length+1;V<1?(V=1,U=!0):V>G&&(V=G,U=!0)}return U?{lineNumber:W,column:V}:C}}class EditorSimpleWorker{constructor(C,W){this._host=C,this._models=Object.create(null),this._foreignModuleFactory=W,this._foreignModule=null}dispose(){this._models=Object.create(null)}_getModel(C){return this._models[C]}_getModels(){const C=[];return Object.keys(this._models).forEach(W=>C.push(this._models[W])),C}acceptNewModel(C){this._models[C.url]=new MirrorModel(URI.parse(C.url),C.lines,C.EOL,C.versionId)}acceptModelChanged(C,W){if(!this._models[C])return;this._models[C].onEvents(W)}acceptRemovedModel(C){this._models[C]&&delete this._models[C]}computeUnicodeHighlights(C,W,V){return __awaiter$1y(this,void 0,void 0,function*(){const U=this._getModel(C);return U?UnicodeTextModelHighlighter.computeUnicodeHighlights(U,W,V):{ranges:[],hasMore:!1,ambiguousCharacterCount:0,invisibleCharacterCount:0,nonBasicAsciiCharacterCount:0}})}computeDiff(C,W,V,U){return __awaiter$1y(this,void 0,void 0,function*(){const G=this._getModel(C),Z=this._getModel(W);return!G||!Z?null:EditorSimpleWorker.computeDiff(G,Z,V,U)})}static computeDiff(C,W,V,U){const G=U==="advanced"?linesDiffComputers.getDefault():linesDiffComputers.getLegacy(),Z=C.getLinesContent(),X=W.getLinesContent(),Q=G.computeDiff(Z,X,V),J=Q.changes.length>0?!1:this._modelsAreIdentical(C,W);function ee(te){return te.map(ie=>{var ne;return[ie.original.startLineNumber,ie.original.endLineNumberExclusive,ie.modified.startLineNumber,ie.modified.endLineNumberExclusive,(ne=ie.innerChanges)===null||ne===void 0?void 0:ne.map(oe=>[oe.originalRange.startLineNumber,oe.originalRange.startColumn,oe.originalRange.endLineNumber,oe.originalRange.endColumn,oe.modifiedRange.startLineNumber,oe.modifiedRange.startColumn,oe.modifiedRange.endLineNumber,oe.modifiedRange.endColumn])]})}return{identical:J,quitEarly:Q.hitTimeout,changes:ee(Q.changes),moves:Q.moves.map(te=>[te.lineRangeMapping.original.startLineNumber,te.lineRangeMapping.original.endLineNumberExclusive,te.lineRangeMapping.modified.startLineNumber,te.lineRangeMapping.modified.endLineNumberExclusive,ee(te.changes)])}}static _modelsAreIdentical(C,W){const V=C.getLineCount(),U=W.getLineCount();if(V!==U)return!1;for(let G=1;G<=V;G++){const Z=C.getLineContent(G),X=W.getLineContent(G);if(Z!==X)return!1}return!0}computeMoreMinimalEdits(C,W,V){return __awaiter$1y(this,void 0,void 0,function*(){const U=this._getModel(C);if(!U)return W;const G=[];let Z;W=W.slice(0).sort((Q,J)=>{if(Q.range&&J.range)return Range$2.compareRangesUsingStarts(Q.range,J.range);const ee=Q.range?0:1,te=J.range?0:1;return ee-te});let X=0;for(let Q=1;Q<W.length;Q++)Range$2.getEndPosition(W[X].range).equals(Range$2.getStartPosition(W[Q].range))?(W[X].range=Range$2.fromPositions(Range$2.getStartPosition(W[X].range),Range$2.getEndPosition(W[Q].range)),W[X].text+=W[Q].text):(X++,W[X]=W[Q]);W.length=X+1;for(let{range:Q,text:J,eol:ee}of W){if(typeof ee=="number"&&(Z=ee),Range$2.isEmpty(Q)&&!J)continue;const te=U.getValueInRange(Q);if(J=J.replace(/\r\n|\n|\r/g,U.eol),te===J)continue;if(Math.max(J.length,te.length)>EditorSimpleWorker._diffLimit){G.push({range:Q,text:J});continue}const ie=stringDiff(te,J,V),ne=U.offsetAt(Range$2.lift(Q).getStartPosition());for(const oe of ie){const re=U.positionAt(ne+oe.originalStart),ae=U.positionAt(ne+oe.originalStart+oe.originalLength),se={text:J.substr(oe.modifiedStart,oe.modifiedLength),range:{startLineNumber:re.lineNumber,startColumn:re.column,endLineNumber:ae.lineNumber,endColumn:ae.column}};U.getValueInRange(se.range)!==se.text&&G.push(se)}}return typeof Z=="number"&&G.push({eol:Z,text:"",range:{startLineNumber:0,startColumn:0,endLineNumber:0,endColumn:0}}),G})}computeLinks(C){return __awaiter$1y(this,void 0,void 0,function*(){const W=this._getModel(C);return W?computeLinks(W):null})}computeDefaultDocumentColors(C){return __awaiter$1y(this,void 0,void 0,function*(){const W=this._getModel(C);return W?computeDefaultDocumentColors(W):null})}textualSuggest(C,W,V,U){return __awaiter$1y(this,void 0,void 0,function*(){const G=new StopWatch,Z=new RegExp(V,U),X=new Set;e:for(const Q of C){const J=this._getModel(Q);if(J){for(const ee of J.words(Z))if(!(ee===W||!isNaN(Number(ee)))&&(X.add(ee),X.size>EditorSimpleWorker._suggestionsLimit))break e}}return{words:Array.from(X),duration:G.elapsed()}})}computeWordRanges(C,W,V,U){return __awaiter$1y(this,void 0,void 0,function*(){const G=this._getModel(C);if(!G)return Object.create(null);const Z=new RegExp(V,U),X=Object.create(null);for(let Q=W.startLineNumber;Q<W.endLineNumber;Q++){const J=G.getLineWords(Q,Z);for(const ee of J){if(!isNaN(Number(ee.word)))continue;let te=X[ee.word];te||(te=[],X[ee.word]=te),te.push({startLineNumber:Q,startColumn:ee.startColumn,endLineNumber:Q,endColumn:ee.endColumn})}}return X})}navigateValueSet(C,W,V,U,G){return __awaiter$1y(this,void 0,void 0,function*(){const Z=this._getModel(C);if(!Z)return null;const X=new RegExp(U,G);W.startColumn===W.endColumn&&(W={startLineNumber:W.startLineNumber,startColumn:W.startColumn,endLineNumber:W.endLineNumber,endColumn:W.endColumn+1});const Q=Z.getValueInRange(W),J=Z.getWordAtPosition({lineNumber:W.startLineNumber,column:W.startColumn},X);if(!J)return null;const ee=Z.getValueInRange(J);return BasicInplaceReplace.INSTANCE.navigateValueSet(W,Q,J,ee,V)})}loadForeignModule(C,W,V){const Z={host:createProxyObject$1(V,(X,Q)=>this._host.fhr(X,Q)),getMirrorModels:()=>this._getModels()};return this._foreignModuleFactory?(this._foreignModule=this._foreignModuleFactory(Z,W),Promise.resolve(getAllMethodNames(this._foreignModule))):Promise.reject(new Error("Unexpected usage"))}fmr(C,W){if(!this._foreignModule||typeof this._foreignModule[C]!="function")return Promise.reject(new Error("Missing requestHandler or method: "+C));try{return Promise.resolve(this._foreignModule[C].apply(this._foreignModule,W))}catch(V){return Promise.reject(V)}}}EditorSimpleWorker._diffLimit=1e5;EditorSimpleWorker._suggestionsLimit=1e4;typeof importScripts=="function"&&(globalThis.monaco=createMonacoBaseAPI());const ITextResourceConfigurationService=createDecorator("textResourceConfigurationService"),ITextResourcePropertiesService=createDecorator("textResourcePropertiesService"),ILanguageFeaturesService=createDecorator("ILanguageFeaturesService");var __decorate$29=globalThis&&globalThis.__decorate||function(K,C,W,V){var U=arguments.length,G=U<3?C:V===null?V=Object.getOwnPropertyDescriptor(C,W):V,Z;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")G=Reflect.decorate(K,C,W,V);else for(var X=K.length-1;X>=0;X--)(Z=K[X])&&(G=(U<3?Z(G):U>3?Z(C,W,G):Z(C,W))||G);return U>3&&G&&Object.defineProperty(C,W,G),G},__param$22=globalThis&&globalThis.__param||function(K,C){return function(W,V){C(W,V,K)}},__awaiter$1x=globalThis&&globalThis.__awaiter||function(K,C,W,V){function U(G){return G instanceof W?G:new W(function(Z){Z(G)})}return new(W||(W=Promise))(function(G,Z){function X(ee){try{J(V.next(ee))}catch(te){Z(te)}}function Q(ee){try{J(V.throw(ee))}catch(te){Z(te)}}function J(ee){ee.done?G(ee.value):U(ee.value).then(X,Q)}J((V=V.apply(K,C||[])).next())})};const STOP_SYNC_MODEL_DELTA_TIME_MS=60*1e3,STOP_WORKER_DELTA_TIME_MS=5*60*1e3;function canSyncModel(K,C){const W=K.getModel(C);return!(!W||W.isTooLargeForSyncing())}let EditorWorkerService=class extends Disposable{constructor(C,W,V,U,G){super(),this._modelService=C,this._workerManager=this._register(new WorkerManager(this._modelService,U)),this._logService=V,this._register(G.linkProvider.register({language:"*",hasAccessToAllModels:!0},{provideLinks:(Z,X)=>canSyncModel(this._modelService,Z.uri)?this._workerManager.withWorker().then(Q=>Q.computeLinks(Z.uri)).then(Q=>Q&&{links:Q}):Promise.resolve({links:[]})})),this._register(G.completionProvider.register("*",new WordBasedCompletionItemProvider(this._workerManager,W,this._modelService,U)))}dispose(){super.dispose()}canComputeUnicodeHighlights(C){return canSyncModel(this._modelService,C)}computedUnicodeHighlights(C,W,V){return this._workerManager.withWorker().then(U=>U.computedUnicodeHighlights(C,W,V))}computeDiff(C,W,V,U){return __awaiter$1x(this,void 0,void 0,function*(){const G=yield this._workerManager.withWorker().then(Q=>Q.computeDiff(C,W,V,U));if(!G)return null;return{identical:G.identical,quitEarly:G.quitEarly,changes:X(G.changes),moves:G.moves.map(Q=>new MovedText(new LineRangeMapping(new LineRange$1(Q[0],Q[1]),new LineRange$1(Q[2],Q[3])),X(Q[4])))};function X(Q){return Q.map(J=>{var ee;return new DetailedLineRangeMapping(new LineRange$1(J[0],J[1]),new LineRange$1(J[2],J[3]),(ee=J[4])===null||ee===void 0?void 0:ee.map(te=>new RangeMapping(new Range$2(te[0],te[1],te[2],te[3]),new Range$2(te[4],te[5],te[6],te[7]))))})}})}computeMoreMinimalEdits(C,W,V=!1){if(isNonEmptyArray$2(W)){if(!canSyncModel(this._modelService,C))return Promise.resolve(W);const U=StopWatch.create(),G=this._workerManager.withWorker().then(Z=>Z.computeMoreMinimalEdits(C,W,V));return G.finally(()=>this._logService.trace("FORMAT#computeMoreMinimalEdits",C.toString(!0),U.elapsed())),Promise.race([G,timeout(1e3).then(()=>W)])}else return Promise.resolve(void 0)}canNavigateValueSet(C){return canSyncModel(this._modelService,C)}navigateValueSet(C,W,V){return this._workerManager.withWorker().then(U=>U.navigateValueSet(C,W,V))}canComputeWordRanges(C){return canSyncModel(this._modelService,C)}computeWordRanges(C,W){return this._workerManager.withWorker().then(V=>V.computeWordRanges(C,W))}};EditorWorkerService=__decorate$29([__param$22(0,IModelService),__param$22(1,ITextResourceConfigurationService),__param$22(2,ILogService),__param$22(3,ILanguageConfigurationService),__param$22(4,ILanguageFeaturesService)],EditorWorkerService);class WordBasedCompletionItemProvider{constructor(C,W,V,U){this.languageConfigurationService=U,this._debugDisplayName="wordbasedCompletions",this._workerManager=C,this._configurationService=W,this._modelService=V}provideCompletionItems(C,W){return __awaiter$1x(this,void 0,void 0,function*(){const V=this._configurationService.getValue(C.uri,W,"editor");if(!V.wordBasedSuggestions)return;const U=[];if(V.wordBasedSuggestionsMode==="currentDocument")canSyncModel(this._modelService,C.uri)&&U.push(C.uri);else for(const te of this._modelService.getModels())canSyncModel(this._modelService,te.uri)&&(te===C?U.unshift(te.uri):(V.wordBasedSuggestionsMode==="allDocuments"||te.getLanguageId()===C.getLanguageId())&&U.push(te.uri));if(U.length===0)return;const G=this.languageConfigurationService.getLanguageConfiguration(C.getLanguageId()).getWordDefinition(),Z=C.getWordAtPosition(W),X=Z?new Range$2(W.lineNumber,Z.startColumn,W.lineNumber,Z.endColumn):Range$2.fromPositions(W),Q=X.setEndPosition(W.lineNumber,W.column),ee=yield(yield this._workerManager.withWorker()).textualSuggest(U,Z==null?void 0:Z.word,G);if(ee)return{duration:ee.duration,suggestions:ee.words.map(te=>({kind:18,label:te,insertText:te,range:{insert:Q,replace:X}}))}})}}class WorkerManager extends Disposable{constructor(C,W){super(),this.languageConfigurationService=W,this._modelService=C,this._editorWorkerClient=null,this._lastWorkerUsedTime=new Date().getTime(),this._register(new IntervalTimer).cancelAndSet(()=>this._checkStopIdleWorker(),Math.round(STOP_WORKER_DELTA_TIME_MS/2)),this._register(this._modelService.onModelRemoved(U=>this._checkStopEmptyWorker()))}dispose(){this._editorWorkerClient&&(this._editorWorkerClient.dispose(),this._editorWorkerClient=null),super.dispose()}_checkStopEmptyWorker(){if(!this._editorWorkerClient)return;this._modelService.getModels().length===0&&(this._editorWorkerClient.dispose(),this._editorWorkerClient=null)}_checkStopIdleWorker(){if(!this._editorWorkerClient)return;new Date().getTime()-this._lastWorkerUsedTime>STOP_WORKER_DELTA_TIME_MS&&(this._editorWorkerClient.dispose(),this._editorWorkerClient=null)}withWorker(){return this._lastWorkerUsedTime=new Date().getTime(),this._editorWorkerClient||(this._editorWorkerClient=new EditorWorkerClient(this._modelService,!1,"editorWorkerService",this.languageConfigurationService)),Promise.resolve(this._editorWorkerClient)}}class EditorModelManager extends Disposable{constructor(C,W,V){if(super(),this._syncedModels=Object.create(null),this._syncedModelsLastUsedTime=Object.create(null),this._proxy=C,this._modelService=W,!V){const U=new IntervalTimer;U.cancelAndSet(()=>this._checkStopModelSync(),Math.round(STOP_SYNC_MODEL_DELTA_TIME_MS/2)),this._register(U)}}dispose(){for(const C in this._syncedModels)dispose(this._syncedModels[C]);this._syncedModels=Object.create(null),this._syncedModelsLastUsedTime=Object.create(null),super.dispose()}ensureSyncedResources(C,W){for(const V of C){const U=V.toString();this._syncedModels[U]||this._beginModelSync(V,W),this._syncedModels[U]&&(this._syncedModelsLastUsedTime[U]=new Date().getTime())}}_checkStopModelSync(){const C=new Date().getTime(),W=[];for(const V in this._syncedModelsLastUsedTime)C-this._syncedModelsLastUsedTime[V]>STOP_SYNC_MODEL_DELTA_TIME_MS&&W.push(V);for(const V of W)this._stopModelSync(V)}_beginModelSync(C,W){const V=this._modelService.getModel(C);if(!V||!W&&V.isTooLargeForSyncing())return;const U=C.toString();this._proxy.acceptNewModel({url:V.uri.toString(),lines:V.getLinesContent(),EOL:V.getEOL(),versionId:V.getVersionId()});const G=new DisposableStore;G.add(V.onDidChangeContent(Z=>{this._proxy.acceptModelChanged(U.toString(),Z)})),G.add(V.onWillDispose(()=>{this._stopModelSync(U)})),G.add(toDisposable(()=>{this._proxy.acceptRemovedModel(U)})),this._syncedModels[U]=G}_stopModelSync(C){const W=this._syncedModels[C];delete this._syncedModels[C],delete this._syncedModelsLastUsedTime[C],dispose(W)}}class SynchronousWorkerClient{constructor(C){this._instance=C,this._proxyObj=Promise.resolve(this._instance)}dispose(){this._instance.dispose()}getProxyObject(){return this._proxyObj}}class EditorWorkerHost{constructor(C){this._workerClient=C}fhr(C,W){return this._workerClient.fhr(C,W)}}class EditorWorkerClient extends Disposable{constructor(C,W,V,U){super(),this.languageConfigurationService=U,this._disposed=!1,this._modelService=C,this._keepIdleModels=W,this._workerFactory=new DefaultWorkerFactory(V),this._worker=null,this._modelManager=null}fhr(C,W){throw new Error("Not implemented!")}_getOrCreateWorker(){if(!this._worker)try{this._worker=this._register(new SimpleWorkerClient(this._workerFactory,"vs/editor/common/services/editorSimpleWorker",new EditorWorkerHost(this)))}catch(C){logOnceWebWorkerWarning(C),this._worker=new SynchronousWorkerClient(new EditorSimpleWorker(new EditorWorkerHost(this),null))}return this._worker}_getProxy(){return this._getOrCreateWorker().getProxyObject().then(void 0,C=>(logOnceWebWorkerWarning(C),this._worker=new SynchronousWorkerClient(new EditorSimpleWorker(new EditorWorkerHost(this),null)),this._getOrCreateWorker().getProxyObject()))}_getOrCreateModelManager(C){return this._modelManager||(this._modelManager=this._register(new EditorModelManager(C,this._modelService,this._keepIdleModels))),this._modelManager}_withSyncedResources(C,W=!1){return __awaiter$1x(this,void 0,void 0,function*(){return this._disposed?Promise.reject(canceled()):this._getProxy().then(V=>(this._getOrCreateModelManager(V).ensureSyncedResources(C,W),V))})}computedUnicodeHighlights(C,W,V){return this._withSyncedResources([C]).then(U=>U.computeUnicodeHighlights(C.toString(),W,V))}computeDiff(C,W,V,U){return this._withSyncedResources([C,W],!0).then(G=>G.computeDiff(C.toString(),W.toString(),V,U))}computeMoreMinimalEdits(C,W,V){return this._withSyncedResources([C]).then(U=>U.computeMoreMinimalEdits(C.toString(),W,V))}computeLinks(C){return this._withSyncedResources([C]).then(W=>W.computeLinks(C.toString()))}computeDefaultDocumentColors(C){return this._withSyncedResources([C]).then(W=>W.computeDefaultDocumentColors(C.toString()))}textualSuggest(C,W,V){return __awaiter$1x(this,void 0,void 0,function*(){const U=yield this._withSyncedResources(C),G=V.source,Z=V.flags;return U.textualSuggest(C.map(X=>X.toString()),W,G,Z)})}computeWordRanges(C,W){return this._withSyncedResources([C]).then(V=>{const U=this._modelService.getModel(C);if(!U)return Promise.resolve(null);const G=this.languageConfigurationService.getLanguageConfiguration(U.getLanguageId()).getWordDefinition(),Z=G.source,X=G.flags;return V.computeWordRanges(C.toString(),W,Z,X)})}navigateValueSet(C,W,V){return this._withSyncedResources([C]).then(U=>{const G=this._modelService.getModel(C);if(!G)return null;const Z=this.languageConfigurationService.getLanguageConfiguration(G.getLanguageId()).getWordDefinition(),X=Z.source,Q=Z.flags;return U.navigateValueSet(C.toString(),W,V,X,Q)})}dispose(){super.dispose(),this._disposed=!0}}function createWebWorker$1(K,C,W){return new MonacoWebWorkerImpl(K,C,W)}class MonacoWebWorkerImpl extends EditorWorkerClient{constructor(C,W,V){super(C,V.keepIdleModels||!1,V.label,W),this._foreignModuleId=V.moduleId,this._foreignModuleCreateData=V.createData||null,this._foreignModuleHost=V.host||null,this._foreignProxy=null}fhr(C,W){if(!this._foreignModuleHost||typeof this._foreignModuleHost[C]!="function")return Promise.reject(new Error("Missing method "+C+" or missing main thread foreign host."));try{return Promise.resolve(this._foreignModuleHost[C].apply(this._foreignModuleHost,W))}catch(V){return Promise.reject(V)}}_getForeignProxy(){return this._foreignProxy||(this._foreignProxy=this._getProxy().then(C=>{const W=this._foreignModuleHost?getAllMethodNames(this._foreignModuleHost):[];return C.loadForeignModule(this._foreignModuleId,this._foreignModuleCreateData,W).then(V=>{this._foreignModuleCreateData=null;const U=(X,Q)=>C.fmr(X,Q),G=(X,Q)=>function(){const J=Array.prototype.slice.call(arguments,0);return Q(X,J)},Z={};for(const X of V)Z[X]=G(X,U);return Z})})),this._foreignProxy}getProxy(){return this._getForeignProxy()}withSyncedResources(C){return this._withSyncedResources(C).then(W=>this.getProxy())}}const EditorType={ICodeEditor:"vs.editor.ICodeEditor",IDiffEditor:"vs.editor.IDiffEditor"},NullState=new class{clone(){return this}equals(K){return this===K}};function nullTokenize(K,C){return new TokenizationResult([new Token$2(0,"",K)],C)}function nullTokenizeEncoded(K,C){const W=new Uint32Array(2);return W[0]=0,W[1]=(K<<0|0|0|32768|2<<24)>>>0,new EncodedTokenizationResult(W,C===null?NullState:C)}class TokenMetadata{static getLanguageId(C){return(C&255)>>>0}static getTokenType(C){return(C&768)>>>8}static containsBalancedBrackets(C){return(C&1024)!==0}static getFontStyle(C){return(C&30720)>>>11}static getForeground(C){return(C&16744448)>>>15}static getBackground(C){return(C&4278190080)>>>24}static getClassNameFromMetadata(C){let V="mtk"+this.getForeground(C);const U=this.getFontStyle(C);return U&1&&(V+=" mtki"),U&2&&(V+=" mtkb"),U&4&&(V+=" mtku"),U&8&&(V+=" mtks"),V}static getInlineStyleFromMetadata(C,W){const V=this.getForeground(C),U=this.getFontStyle(C);let G=`color: ${W[V]};`;U&1&&(G+="font-style: italic;"),U&2&&(G+="font-weight: bold;");let Z="";return U&4&&(Z+=" underline"),U&8&&(Z+=" line-through"),Z&&(G+=`text-decoration:${Z};`),G}static getPresentationFromMetadata(C){const W=this.getForeground(C),V=this.getFontStyle(C);return{foreground:W,italic:!!(V&1),bold:!!(V&2),underline:!!(V&4),strikethrough:!!(V&8)}}}class LineTokens{static createEmpty(C,W){const V=LineTokens.defaultTokenMetadata,U=new Uint32Array(2);return U[0]=C.length,U[1]=V,new LineTokens(U,C,W)}constructor(C,W,V){this._lineTokensBrand=void 0,this._tokens=C,this._tokensCount=this._tokens.length>>>1,this._text=W,this._languageIdCodec=V}equals(C){return C instanceof LineTokens?this.slicedEquals(C,0,this._tokensCount):!1}slicedEquals(C,W,V){if(this._text!==C._text||this._tokensCount!==C._tokensCount)return!1;const U=W<<1,G=U+(V<<1);for(let Z=U;Z<G;Z++)if(this._tokens[Z]!==C._tokens[Z])return!1;return!0}getLineContent(){return this._text}getCount(){return this._tokensCount}getStartOffset(C){return C>0?this._tokens[C-1<<1]:0}getMetadata(C){return this._tokens[(C<<1)+1]}getLanguageId(C){const W=this._tokens[(C<<1)+1],V=TokenMetadata.getLanguageId(W);return this._languageIdCodec.decodeLanguageId(V)}getStandardTokenType(C){const W=this._tokens[(C<<1)+1];return TokenMetadata.getTokenType(W)}getForeground(C){const W=this._tokens[(C<<1)+1];return TokenMetadata.getForeground(W)}getClassName(C){const W=this._tokens[(C<<1)+1];return TokenMetadata.getClassNameFromMetadata(W)}getInlineStyle(C,W){const V=this._tokens[(C<<1)+1];return TokenMetadata.getInlineStyleFromMetadata(V,W)}getPresentation(C){const W=this._tokens[(C<<1)+1];return TokenMetadata.getPresentationFromMetadata(W)}getEndOffset(C){return this._tokens[C<<1]}findTokenIndexAtOffset(C){return LineTokens.findIndexInTokensArray(this._tokens,C)}inflate(){return this}sliceAndInflate(C,W,V){return new SliceLineTokens(this,C,W,V)}static convertToEndOffset(C,W){const U=(C.length>>>1)-1;for(let G=0;G<U;G++)C[G<<1]=C[G+1<<1];C[U<<1]=W}static findIndexInTokensArray(C,W){if(C.length<=2)return 0;let V=0,U=(C.length>>>1)-1;for(;V<U;){const G=V+Math.floor((U-V)/2),Z=C[G<<1];if(Z===W)return G+1;Z<W?V=G+1:Z>W&&(U=G)}return V}withInserted(C){if(C.length===0)return this;let W=0,V=0,U="";const G=new Array;let Z=0;for(;;){const X=W<this._tokensCount?this._tokens[W<<1]:-1,Q=V<C.length?C[V]:null;if(X!==-1&&(Q===null||X<=Q.offset)){U+=this._text.substring(Z,X);const J=this._tokens[(W<<1)+1];G.push(U.length,J),W++,Z=X}else if(Q){if(Q.offset>Z){U+=this._text.substring(Z,Q.offset);const J=this._tokens[(W<<1)+1];G.push(U.length,J),Z=Q.offset}U+=Q.text,G.push(U.length,Q.tokenMetadata),V++}else break}return new LineTokens(new Uint32Array(G),U,this._languageIdCodec)}}LineTokens.defaultTokenMetadata=(32768|2<<24)>>>0;class SliceLineTokens{constructor(C,W,V,U){this._source=C,this._startOffset=W,this._endOffset=V,this._deltaOffset=U,this._firstTokenIndex=C.findTokenIndexAtOffset(W),this._tokensCount=0;for(let G=this._firstTokenIndex,Z=C.getCount();G<Z&&!(C.getStartOffset(G)>=V);G++)this._tokensCount++}getMetadata(C){return this._source.getMetadata(this._firstTokenIndex+C)}getLanguageId(C){return this._source.getLanguageId(this._firstTokenIndex+C)}getLineContent(){return this._source.getLineContent().substring(this._startOffset,this._endOffset)}equals(C){return C instanceof SliceLineTokens?this._startOffset===C._startOffset&&this._endOffset===C._endOffset&&this._deltaOffset===C._deltaOffset&&this._source.slicedEquals(C._source,this._firstTokenIndex,this._tokensCount):!1}getCount(){return this._tokensCount}getForeground(C){return this._source.getForeground(this._firstTokenIndex+C)}getEndOffset(C){const W=this._source.getEndOffset(this._firstTokenIndex+C);return Math.min(this._endOffset,W)-this._startOffset+this._deltaOffset}getClassName(C){return this._source.getClassName(this._firstTokenIndex+C)}getInlineStyle(C,W){return this._source.getInlineStyle(this._firstTokenIndex+C,W)}getPresentation(C){return this._source.getPresentation(this._firstTokenIndex+C)}findTokenIndexAtOffset(C){return this._source.findTokenIndexAtOffset(C+this._startOffset-this._deltaOffset)-this._firstTokenIndex}}class LineDecoration{constructor(C,W,V,U){this.startColumn=C,this.endColumn=W,this.className=V,this.type=U,this._lineDecorationBrand=void 0}static _equals(C,W){return C.startColumn===W.startColumn&&C.endColumn===W.endColumn&&C.className===W.className&&C.type===W.type}static equalsArr(C,W){const V=C.length,U=W.length;if(V!==U)return!1;for(let G=0;G<V;G++)if(!LineDecoration._equals(C[G],W[G]))return!1;return!0}static extractWrapped(C,W,V){if(C.length===0)return C;const U=W+1,G=V+1,Z=V-W,X=[];let Q=0;for(const J of C)J.endColumn<=U||J.startColumn>=G||(X[Q++]=new LineDecoration(Math.max(1,J.startColumn-U+1),Math.min(Z+1,J.endColumn-U+1),J.className,J.type));return X}static filter(C,W,V,U){if(C.length===0)return[];const G=[];let Z=0;for(let X=0,Q=C.length;X<Q;X++){const J=C[X],ee=J.range;if(ee.endLineNumber<W||ee.startLineNumber>W||ee.isEmpty()&&(J.type===0||J.type===3))continue;const te=ee.startLineNumber===W?ee.startColumn:V,ie=ee.endLineNumber===W?ee.endColumn:U;G[Z++]=new LineDecoration(te,ie,J.inlineClassName,J.type)}return G}static _typeCompare(C,W){const V=[2,0,1,3];return V[C]-V[W]}static compare(C,W){if(C.startColumn!==W.startColumn)return C.startColumn-W.startColumn;if(C.endColumn!==W.endColumn)return C.endColumn-W.endColumn;const V=LineDecoration._typeCompare(C.type,W.type);return V!==0?V:C.className!==W.className?C.className<W.className?-1:1:0}}class DecorationSegment{constructor(C,W,V,U){this.startOffset=C,this.endOffset=W,this.className=V,this.metadata=U}}class Stack{constructor(){this.stopOffsets=[],this.classNames=[],this.metadata=[],this.count=0}static _metadata(C){let W=0;for(let V=0,U=C.length;V<U;V++)W|=C[V];return W}consumeLowerThan(C,W,V){for(;this.count>0&&this.stopOffsets[0]<C;){let U=0;for(;U+1<this.count&&this.stopOffsets[U]===this.stopOffsets[U+1];)U++;V.push(new DecorationSegment(W,this.stopOffsets[U],this.classNames.join(" "),Stack._metadata(this.metadata))),W=this.stopOffsets[U]+1,this.stopOffsets.splice(0,U+1),this.classNames.splice(0,U+1),this.metadata.splice(0,U+1),this.count-=U+1}return this.count>0&&W<C&&(V.push(new DecorationSegment(W,C-1,this.classNames.join(" "),Stack._metadata(this.metadata))),W=C),W}insert(C,W,V){if(this.count===0||this.stopOffsets[this.count-1]<=C)this.stopOffsets.push(C),this.classNames.push(W),this.metadata.push(V);else for(let U=0;U<this.count;U++)if(this.stopOffsets[U]>=C){this.stopOffsets.splice(U,0,C),this.classNames.splice(U,0,W),this.metadata.splice(U,0,V);break}this.count++}}class LineDecorationsNormalizer{static normalize(C,W){if(W.length===0)return[];const V=[],U=new Stack;let G=0;for(let Z=0,X=W.length;Z<X;Z++){const Q=W[Z];let J=Q.startColumn,ee=Q.endColumn;const te=Q.className,ie=Q.type===1?2:Q.type===2?4:0;if(J>1){const re=C.charCodeAt(J-2);isHighSurrogate(re)&&J--}if(ee>1){const re=C.charCodeAt(ee-2);isHighSurrogate(re)&&ee--}const ne=J-1,oe=ee-2;G=U.consumeLowerThan(ne,G,V),U.count===0&&(G=ne),U.insert(oe,te,ie)}return U.consumeLowerThan(1073741824,G,V),V}}class LinePart{constructor(C,W,V,U){this.endIndex=C,this.type=W,this.metadata=V,this.containsRTL=U,this._linePartBrand=void 0}isWhitespace(){return!!(this.metadata&1)}isPseudoAfter(){return!!(this.metadata&4)}}class LineRange{constructor(C,W){this.startOffset=C,this.endOffset=W}equals(C){return this.startOffset===C.startOffset&&this.endOffset===C.endOffset}}class RenderLineInput{constructor(C,W,V,U,G,Z,X,Q,J,ee,te,ie,ne,oe,re,ae,se,le,ce){this.useMonospaceOptimizations=C,this.canUseHalfwidthRightwardsArrow=W,this.lineContent=V,this.continuesWithWrappedLine=U,this.isBasicASCII=G,this.containsRTL=Z,this.fauxIndentLength=X,this.lineTokens=Q,this.lineDecorations=J.sort(LineDecoration.compare),this.tabSize=ee,this.startVisibleColumn=te,this.spaceWidth=ie,this.stopRenderingLineAfter=re,this.renderWhitespace=ae==="all"?4:ae==="boundary"?1:ae==="selection"?2:ae==="trailing"?3:0,this.renderControlCharacters=se,this.fontLigatures=le,this.selectionsOnLine=ce&&ce.sort((ge,he)=>ge.startOffset<he.startOffset?-1:1);const de=Math.abs(oe-ie),ue=Math.abs(ne-ie);de<ue?(this.renderSpaceWidth=oe,this.renderSpaceCharCode=11825):(this.renderSpaceWidth=ne,this.renderSpaceCharCode=183)}sameSelection(C){if(this.selectionsOnLine===null)return C===null;if(C===null||C.length!==this.selectionsOnLine.length)return!1;for(let W=0;W<this.selectionsOnLine.length;W++)if(!this.selectionsOnLine[W].equals(C[W]))return!1;return!0}equals(C){return this.useMonospaceOptimizations===C.useMonospaceOptimizations&&this.canUseHalfwidthRightwardsArrow===C.canUseHalfwidthRightwardsArrow&&this.lineContent===C.lineContent&&this.continuesWithWrappedLine===C.continuesWithWrappedLine&&this.isBasicASCII===C.isBasicASCII&&this.containsRTL===C.containsRTL&&this.fauxIndentLength===C.fauxIndentLength&&this.tabSize===C.tabSize&&this.startVisibleColumn===C.startVisibleColumn&&this.spaceWidth===C.spaceWidth&&this.renderSpaceWidth===C.renderSpaceWidth&&this.renderSpaceCharCode===C.renderSpaceCharCode&&this.stopRenderingLineAfter===C.stopRenderingLineAfter&&this.renderWhitespace===C.renderWhitespace&&this.renderControlCharacters===C.renderControlCharacters&&this.fontLigatures===C.fontLigatures&&LineDecoration.equalsArr(this.lineDecorations,C.lineDecorations)&&this.lineTokens.equals(C.lineTokens)&&this.sameSelection(C.selectionsOnLine)}}class DomPosition{constructor(C,W){this.partIndex=C,this.charIndex=W}}class CharacterMapping{static getPartIndex(C){return(C&4294901760)>>>16}static getCharIndex(C){return(C&65535)>>>0}constructor(C,W){this.length=C,this._data=new Uint32Array(this.length),this._horizontalOffset=new Uint32Array(this.length)}setColumnInfo(C,W,V,U){const G=(W<<16|V<<0)>>>0;this._data[C-1]=G,this._horizontalOffset[C-1]=U}getHorizontalOffset(C){return this._horizontalOffset.length===0?0:this._horizontalOffset[C-1]}charOffsetToPartData(C){return this.length===0?0:C<0?this._data[0]:C>=this.length?this._data[this.length-1]:this._data[C]}getDomPosition(C){const W=this.charOffsetToPartData(C-1),V=CharacterMapping.getPartIndex(W),U=CharacterMapping.getCharIndex(W);return new DomPosition(V,U)}getColumn(C,W){return this.partDataToCharOffset(C.partIndex,W,C.charIndex)+1}partDataToCharOffset(C,W,V){if(this.length===0)return 0;const U=(C<<16|V<<0)>>>0;let G=0,Z=this.length-1;for(;G+1<Z;){const re=G+Z>>>1,ae=this._data[re];if(ae===U)return re;ae>U?Z=re:G=re}if(G===Z)return G;const X=this._data[G],Q=this._data[Z];if(X===U)return G;if(Q===U)return Z;const J=CharacterMapping.getPartIndex(X),ee=CharacterMapping.getCharIndex(X),te=CharacterMapping.getPartIndex(Q);let ie;J!==te?ie=W:ie=CharacterMapping.getCharIndex(Q);const ne=V-ee,oe=ie-V;return ne<=oe?G:Z}}class RenderLineOutput{constructor(C,W,V){this._renderLineOutputBrand=void 0,this.characterMapping=C,this.containsRTL=W,this.containsForeignElements=V}}function renderViewLine(K,C){if(K.lineContent.length===0){if(K.lineDecorations.length>0){C.appendString("<span>");let W=0,V=0,U=0;for(const Z of K.lineDecorations)(Z.type===1||Z.type===2)&&(C.appendString('<span class="'),C.appendString(Z.className),C.appendString('"></span>'),Z.type===1&&(U|=1,W++),Z.type===2&&(U|=2,V++));C.appendString("</span>");const G=new CharacterMapping(1,W+V);return G.setColumnInfo(1,W,0,0),new RenderLineOutput(G,!1,U)}return C.appendString("<span><span></span></span>"),new RenderLineOutput(new CharacterMapping(0,0),!1,0)}return _renderLine(resolveRenderLineInput(K),C)}class RenderLineOutput2{constructor(C,W,V,U){this.characterMapping=C,this.html=W,this.containsRTL=V,this.containsForeignElements=U}}function renderViewLine2(K){const C=new StringBuilder(1e4),W=renderViewLine(K,C);return new RenderLineOutput2(W.characterMapping,C.build(),W.containsRTL,W.containsForeignElements)}class ResolvedRenderLineInput{constructor(C,W,V,U,G,Z,X,Q,J,ee,te,ie,ne,oe,re,ae){this.fontIsMonospace=C,this.canUseHalfwidthRightwardsArrow=W,this.lineContent=V,this.len=U,this.isOverflowing=G,this.overflowingCharCount=Z,this.parts=X,this.containsForeignElements=Q,this.fauxIndentLength=J,this.tabSize=ee,this.startVisibleColumn=te,this.containsRTL=ie,this.spaceWidth=ne,this.renderSpaceCharCode=oe,this.renderWhitespace=re,this.renderControlCharacters=ae}}function resolveRenderLineInput(K){const C=K.lineContent;let W,V,U;K.stopRenderingLineAfter!==-1&&K.stopRenderingLineAfter<C.length?(W=!0,V=C.length-K.stopRenderingLineAfter,U=K.stopRenderingLineAfter):(W=!1,V=0,U=C.length);let G=transformAndRemoveOverflowing(C,K.containsRTL,K.lineTokens,K.fauxIndentLength,U);K.renderControlCharacters&&!K.isBasicASCII&&(G=extractControlCharacters(C,G)),(K.renderWhitespace===4||K.renderWhitespace===1||K.renderWhitespace===2&&K.selectionsOnLine||K.renderWhitespace===3&&!K.continuesWithWrappedLine)&&(G=_applyRenderWhitespace(K,C,U,G));let Z=0;if(K.lineDecorations.length>0){for(let X=0,Q=K.lineDecorations.length;X<Q;X++){const J=K.lineDecorations[X];J.type===3||J.type===1?Z|=1:J.type===2&&(Z|=2)}G=_applyInlineDecorations(C,U,G,K.lineDecorations)}return K.containsRTL||(G=splitLargeTokens(C,G,!K.isBasicASCII||K.fontLigatures)),new ResolvedRenderLineInput(K.useMonospaceOptimizations,K.canUseHalfwidthRightwardsArrow,C,U,W,V,G,Z,K.fauxIndentLength,K.tabSize,K.startVisibleColumn,K.containsRTL,K.spaceWidth,K.renderSpaceCharCode,K.renderWhitespace,K.renderControlCharacters)}function transformAndRemoveOverflowing(K,C,W,V,U){const G=[];let Z=0;V>0&&(G[Z++]=new LinePart(V,"",0,!1));let X=V;for(let Q=0,J=W.getCount();Q<J;Q++){const ee=W.getEndOffset(Q);if(ee<=V)continue;const te=W.getClassName(Q);if(ee>=U){const ne=C?containsRTL(K.substring(X,U)):!1;G[Z++]=new LinePart(U,te,0,ne);break}const ie=C?containsRTL(K.substring(X,ee)):!1;G[Z++]=new LinePart(ee,te,0,ie),X=ee}return G}function splitLargeTokens(K,C,W){let V=0;const U=[];let G=0;if(W)for(let Z=0,X=C.length;Z<X;Z++){const Q=C[Z],J=Q.endIndex;if(V+50<J){const ee=Q.type,te=Q.metadata,ie=Q.containsRTL;let ne=-1,oe=V;for(let re=V;re<J;re++)K.charCodeAt(re)===32&&(ne=re),ne!==-1&&re-oe>=50&&(U[G++]=new LinePart(ne+1,ee,te,ie),oe=ne+1,ne=-1);oe!==J&&(U[G++]=new LinePart(J,ee,te,ie))}else U[G++]=Q;V=J}else for(let Z=0,X=C.length;Z<X;Z++){const Q=C[Z],J=Q.endIndex,ee=J-V;if(ee>50){const te=Q.type,ie=Q.metadata,ne=Q.containsRTL,oe=Math.ceil(ee/50);for(let re=1;re<oe;re++){const ae=V+re*50;U[G++]=new LinePart(ae,te,ie,ne)}U[G++]=new LinePart(J,te,ie,ne)}else U[G++]=Q;V=J}return U}function isControlCharacter(K){return K<32?K!==9:K===127||K>=8234&&K<=8238||K>=8294&&K<=8297||K>=8206&&K<=8207||K===1564}function extractControlCharacters(K,C){const W=[];let V=new LinePart(0,"",0,!1),U=0;for(const G of C){const Z=G.endIndex;for(;U<Z;U++){const X=K.charCodeAt(U);isControlCharacter(X)&&(U>V.endIndex&&(V=new LinePart(U,G.type,G.metadata,G.containsRTL),W.push(V)),V=new LinePart(U+1,"mtkcontrol",G.metadata,!1),W.push(V))}U>V.endIndex&&(V=new LinePart(Z,G.type,G.metadata,G.containsRTL),W.push(V))}return W}function _applyRenderWhitespace(K,C,W,V){const U=K.continuesWithWrappedLine,G=K.fauxIndentLength,Z=K.tabSize,X=K.startVisibleColumn,Q=K.useMonospaceOptimizations,J=K.selectionsOnLine,ee=K.renderWhitespace===1,te=K.renderWhitespace===3,ie=K.renderSpaceWidth!==K.spaceWidth,ne=[];let oe=0,re=0,ae=V[re].type,se=V[re].containsRTL,le=V[re].endIndex;const ce=V.length;let de=!1,ue=firstNonWhitespaceIndex(C),ge;ue===-1?(de=!0,ue=W,ge=W):ge=lastNonWhitespaceIndex(C);let he=!1,fe=0,pe=J&&J[fe],Se=X%Z;for(let be=G;be<W;be++){const Ce=C.charCodeAt(be);pe&&be>=pe.endOffset&&(fe++,pe=J&&J[fe]);let De;if(be<ue||be>ge)De=!0;else if(Ce===9)De=!0;else if(Ce===32)if(ee)if(he)De=!0;else{const ke=be+1<W?C.charCodeAt(be+1):0;De=ke===32||ke===9}else De=!0;else De=!1;if(De&&J&&(De=!!pe&&pe.startOffset<=be&&pe.endOffset>be),De&&te&&(De=de||be>ge),De&&se&&be>=ue&&be<=ge&&(De=!1),he){if(!De||!Q&&Se>=Z){if(ie){const ke=oe>0?ne[oe-1].endIndex:G;for(let Me=ke+1;Me<=be;Me++)ne[oe++]=new LinePart(Me,"mtkw",1,!1)}else ne[oe++]=new LinePart(be,"mtkw",1,!1);Se=Se%Z}}else(be===le||De&&be>G)&&(ne[oe++]=new LinePart(be,ae,0,se),Se=Se%Z);for(Ce===9?Se=Z:isFullWidthCharacter(Ce)?Se+=2:Se++,he=De;be===le&&(re++,re<ce);)ae=V[re].type,se=V[re].containsRTL,le=V[re].endIndex}let Le=!1;if(he)if(U&&ee){const be=W>0?C.charCodeAt(W-1):0,Ce=W>1?C.charCodeAt(W-2):0;be===32&&Ce!==32&&Ce!==9||(Le=!0)}else Le=!0;if(Le)if(ie){const be=oe>0?ne[oe-1].endIndex:G;for(let Ce=be+1;Ce<=W;Ce++)ne[oe++]=new LinePart(Ce,"mtkw",1,!1)}else ne[oe++]=new LinePart(W,"mtkw",1,!1);else ne[oe++]=new LinePart(W,ae,0,se);return ne}function _applyInlineDecorations(K,C,W,V){V.sort(LineDecoration.compare);const U=LineDecorationsNormalizer.normalize(K,V),G=U.length;let Z=0;const X=[];let Q=0,J=0;for(let te=0,ie=W.length;te<ie;te++){const ne=W[te],oe=ne.endIndex,re=ne.type,ae=ne.metadata,se=ne.containsRTL;for(;Z<G&&U[Z].startOffset<oe;){const le=U[Z];if(le.startOffset>J&&(J=le.startOffset,X[Q++]=new LinePart(J,re,ae,se)),le.endOffset+1<=oe)J=le.endOffset+1,X[Q++]=new LinePart(J,re+" "+le.className,ae|le.metadata,se),Z++;else{J=oe,X[Q++]=new LinePart(J,re+" "+le.className,ae|le.metadata,se);break}}oe>J&&(J=oe,X[Q++]=new LinePart(J,re,ae,se))}const ee=W[W.length-1].endIndex;if(Z<G&&U[Z].startOffset===ee)for(;Z<G&&U[Z].startOffset===ee;){const te=U[Z];X[Q++]=new LinePart(J,te.className,te.metadata,!1),Z++}return X}function _renderLine(K,C){const W=K.fontIsMonospace,V=K.canUseHalfwidthRightwardsArrow,U=K.containsForeignElements,G=K.lineContent,Z=K.len,X=K.isOverflowing,Q=K.overflowingCharCount,J=K.parts,ee=K.fauxIndentLength,te=K.tabSize,ie=K.startVisibleColumn,ne=K.containsRTL,oe=K.spaceWidth,re=K.renderSpaceCharCode,ae=K.renderWhitespace,se=K.renderControlCharacters,le=new CharacterMapping(Z+1,J.length);let ce=!1,de=0,ue=ie,ge=0,he=0,fe=0;ne?C.appendString('<span dir="ltr">'):C.appendString("<span>");for(let pe=0,Se=J.length;pe<Se;pe++){const Le=J[pe],be=Le.endIndex,Ce=Le.type,De=Le.containsRTL,ke=ae!==0&&Le.isWhitespace(),Me=ke&&!W&&(Ce==="mtkw"||!U),Oe=de===be&&Le.isPseudoAfter();if(ge=0,C.appendString("<span "),De&&C.appendString('style="unicode-bidi:isolate" '),C.appendString('class="'),C.appendString(Me?"mtkz":Ce),C.appendASCIICharCode(34),ke){let Be=0;{let Pe=de,Ue=ue;for(;Pe<be;Pe++){const Fe=(G.charCodeAt(Pe)===9?te-Ue%te:1)|0;Be+=Fe,Pe>=ee&&(Ue+=Fe)}}for(Me&&(C.appendString(' style="width:'),C.appendString(String(oe*Be)),C.appendString('px"')),C.appendASCIICharCode(62);de<be;de++){le.setColumnInfo(de+1,pe-fe,ge,he),fe=0;const Pe=G.charCodeAt(de);let Ue,ze;if(Pe===9){Ue=te-ue%te|0,ze=Ue,!V||ze>1?C.appendCharCode(8594):C.appendCharCode(65515);for(let Fe=2;Fe<=ze;Fe++)C.appendCharCode(160)}else Ue=2,ze=1,C.appendCharCode(re),C.appendCharCode(8204);ge+=Ue,he+=ze,de>=ee&&(ue+=ze)}}else for(C.appendASCIICharCode(62);de<be;de++){le.setColumnInfo(de+1,pe-fe,ge,he),fe=0;const Be=G.charCodeAt(de);let Pe=1,Ue=1;switch(Be){case 9:Pe=te-ue%te,Ue=Pe;for(let ze=1;ze<=Pe;ze++)C.appendCharCode(160);break;case 32:C.appendCharCode(160);break;case 60:C.appendString("&lt;");break;case 62:C.appendString("&gt;");break;case 38:C.appendString("&amp;");break;case 0:se?C.appendCharCode(9216):C.appendString("&#00;");break;case 65279:case 8232:case 8233:case 133:C.appendCharCode(65533);break;default:isFullWidthCharacter(Be)&&Ue++,se&&Be<32?C.appendCharCode(9216+Be):se&&Be===127?C.appendCharCode(9249):se&&isControlCharacter(Be)?(C.appendString("[U+"),C.appendString(to4CharHex(Be)),C.appendString("]"),Pe=8,Ue=Pe):C.appendCharCode(Be)}ge+=Pe,he+=Ue,de>=ee&&(ue+=Ue)}Oe?fe++:fe=0,de>=Z&&!ce&&Le.isPseudoAfter()&&(ce=!0,le.setColumnInfo(de+1,pe,ge,he)),C.appendString("</span>")}return ce||le.setColumnInfo(Z+1,J.length-1,ge,he),X&&(C.appendString('<span class="mtkoverflow">'),C.appendString(localize("showMore","Show more ({0})",renderOverflowingCharCount(Q))),C.appendString("</span>")),C.appendString("</span>"),new RenderLineOutput(le,ne,U)}function to4CharHex(K){return K.toString(16).toUpperCase().padStart(4,"0")}function renderOverflowingCharCount(K){return K<1024?localize("overflow.chars","{0} chars",K):K<1024*1024?`${(K/1024).toFixed(1)} KB`:`${(K/1024/1024).toFixed(1)} MB`}class Viewport{constructor(C,W,V,U){this._viewportBrand=void 0,this.top=C|0,this.left=W|0,this.width=V|0,this.height=U|0}}class MinimapLinesRenderingData{constructor(C,W){this.tabSize=C,this.data=W}}class ViewLineData{constructor(C,W,V,U,G,Z,X){this._viewLineDataBrand=void 0,this.content=C,this.continuesWithWrappedLine=W,this.minColumn=V,this.maxColumn=U,this.startVisibleColumn=G,this.tokens=Z,this.inlineDecorations=X}}class ViewLineRenderingData{constructor(C,W,V,U,G,Z,X,Q,J,ee){this.minColumn=C,this.maxColumn=W,this.content=V,this.continuesWithWrappedLine=U,this.isBasicASCII=ViewLineRenderingData.isBasicASCII(V,Z),this.containsRTL=ViewLineRenderingData.containsRTL(V,this.isBasicASCII,G),this.tokens=X,this.inlineDecorations=Q,this.tabSize=J,this.startVisibleColumn=ee}static isBasicASCII(C,W){return W?isBasicASCII(C):!0}static containsRTL(C,W,V){return!W&&V?containsRTL(C):!1}}class InlineDecoration{constructor(C,W,V){this.range=C,this.inlineClassName=W,this.type=V}}class SingleLineInlineDecoration{constructor(C,W,V,U){this.startOffset=C,this.endOffset=W,this.inlineClassName=V,this.inlineClassNameAffectsLetterSpacing=U}toInlineDecoration(C){return new InlineDecoration(new Range$2(C,this.startOffset+1,C,this.endOffset+1),this.inlineClassName,this.inlineClassNameAffectsLetterSpacing?3:0)}}class ViewModelDecoration{constructor(C,W){this._viewModelDecorationBrand=void 0,this.range=C,this.options=W}}class OverviewRulerDecorationsGroup{constructor(C,W,V){this.color=C,this.zIndex=W,this.data=V}static compareByRenderingProps(C,W){return C.zIndex===W.zIndex?C.color<W.color?-1:C.color>W.color?1:0:C.zIndex-W.zIndex}static equals(C,W){return C.color===W.color&&C.zIndex===W.zIndex&&equals$5(C.data,W.data)}static equalsArr(C,W){return equals$5(C,W,OverviewRulerDecorationsGroup.equals)}}function isFuzzyActionArr(K){return Array.isArray(K)}function isFuzzyAction(K){return!isFuzzyActionArr(K)}function isString$2(K){return typeof K=="string"}function isIAction(K){return!isString$2(K)}function empty$2(K){return!K}function fixCase(K,C){return K.ignoreCase&&C?C.toLowerCase():C}function sanitize(K){return K.replace(/[&<>'"_]/g,"-")}function log(K,C){console.log(`${K.languageId}: ${C}`)}function createError(K,C){return new Error(`${K.languageId}: ${C}`)}function substituteMatches(K,C,W,V,U){const G=/\$((\$)|(#)|(\d\d?)|[sS](\d\d?)|@(\w+))/g;let Z=null;return C.replace(G,function(X,Q,J,ee,te,ie,ne,oe,re){return empty$2(J)?empty$2(ee)?!empty$2(te)&&te<V.length?fixCase(K,V[te]):!empty$2(ne)&&K&&typeof K[ne]=="string"?K[ne]:(Z===null&&(Z=U.split("."),Z.unshift(U)),!empty$2(ie)&&ie<Z.length?fixCase(K,Z[ie]):""):fixCase(K,W):"$"})}function findRules(K,C){let W=C;for(;W&&W.length>0;){const V=K.tokenizer[W];if(V)return V;const U=W.lastIndexOf(".");U<0?W=null:W=W.substr(0,U)}return null}function stateExists(K,C){let W=C;for(;W&&W.length>0;){if(K.stateNames[W])return!0;const U=W.lastIndexOf(".");U<0?W=null:W=W.substr(0,U)}return!1}var __decorate$28=globalThis&&globalThis.__decorate||function(K,C,W,V){var U=arguments.length,G=U<3?C:V===null?V=Object.getOwnPropertyDescriptor(C,W):V,Z;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")G=Reflect.decorate(K,C,W,V);else for(var X=K.length-1;X>=0;X--)(Z=K[X])&&(G=(U<3?Z(G):U>3?Z(C,W,G):Z(C,W))||G);return U>3&&G&&Object.defineProperty(C,W,G),G},__param$21=globalThis&&globalThis.__param||function(K,C){return function(W,V){C(W,V,K)}},MonarchTokenizer_1;const CACHE_STACK_DEPTH=5;class MonarchStackElementFactory{static create(C,W){return this._INSTANCE.create(C,W)}constructor(C){this._maxCacheDepth=C,this._entries=Object.create(null)}create(C,W){if(C!==null&&C.depth>=this._maxCacheDepth)return new MonarchStackElement(C,W);let V=MonarchStackElement.getStackElementId(C);V.length>0&&(V+="|"),V+=W;let U=this._entries[V];return U||(U=new MonarchStackElement(C,W),this._entries[V]=U,U)}}MonarchStackElementFactory._INSTANCE=new MonarchStackElementFactory(CACHE_STACK_DEPTH);class MonarchStackElement{constructor(C,W){this.parent=C,this.state=W,this.depth=(this.parent?this.parent.depth:0)+1}static getStackElementId(C){let W="";for(;C!==null;)W.length>0&&(W+="|"),W+=C.state,C=C.parent;return W}static _equals(C,W){for(;C!==null&&W!==null;){if(C===W)return!0;if(C.state!==W.state)return!1;C=C.parent,W=W.parent}return C===null&&W===null}equals(C){return MonarchStackElement._equals(this,C)}push(C){return MonarchStackElementFactory.create(this,C)}pop(){return this.parent}popall(){let C=this;for(;C.parent;)C=C.parent;return C}switchTo(C){return MonarchStackElementFactory.create(this.parent,C)}}class EmbeddedLanguageData{constructor(C,W){this.languageId=C,this.state=W}equals(C){return this.languageId===C.languageId&&this.state.equals(C.state)}clone(){return this.state.clone()===this.state?this:new EmbeddedLanguageData(this.languageId,this.state)}}class MonarchLineStateFactory{static create(C,W){return this._INSTANCE.create(C,W)}constructor(C){this._maxCacheDepth=C,this._entries=Object.create(null)}create(C,W){if(W!==null)return new MonarchLineState(C,W);if(C!==null&&C.depth>=this._maxCacheDepth)return new MonarchLineState(C,W);const V=MonarchStackElement.getStackElementId(C);let U=this._entries[V];return U||(U=new MonarchLineState(C,null),this._entries[V]=U,U)}}MonarchLineStateFactory._INSTANCE=new MonarchLineStateFactory(CACHE_STACK_DEPTH);class MonarchLineState{constructor(C,W){this.stack=C,this.embeddedLanguageData=W}clone(){return(this.embeddedLanguageData?this.embeddedLanguageData.clone():null)===this.embeddedLanguageData?this:MonarchLineStateFactory.create(this.stack,this.embeddedLanguageData)}equals(C){return!(C instanceof MonarchLineState)||!this.stack.equals(C.stack)?!1:this.embeddedLanguageData===null&&C.embeddedLanguageData===null?!0:this.embeddedLanguageData===null||C.embeddedLanguageData===null?!1:this.embeddedLanguageData.equals(C.embeddedLanguageData)}}class MonarchClassicTokensCollector{constructor(){this._tokens=[],this._languageId=null,this._lastTokenType=null,this._lastTokenLanguage=null}enterLanguage(C){this._languageId=C}emit(C,W){this._lastTokenType===W&&this._lastTokenLanguage===this._languageId||(this._lastTokenType=W,this._lastTokenLanguage=this._languageId,this._tokens.push(new Token$2(C,W,this._languageId)))}nestedLanguageTokenize(C,W,V,U){const G=V.languageId,Z=V.state,X=TokenizationRegistry.get(G);if(!X)return this.enterLanguage(G),this.emit(U,""),Z;const Q=X.tokenize(C,W,Z);if(U!==0)for(const J of Q.tokens)this._tokens.push(new Token$2(J.offset+U,J.type,J.language));else this._tokens=this._tokens.concat(Q.tokens);return this._lastTokenType=null,this._lastTokenLanguage=null,this._languageId=null,Q.endState}finalize(C){return new TokenizationResult(this._tokens,C)}}class MonarchModernTokensCollector{constructor(C,W){this._languageService=C,this._theme=W,this._prependTokens=null,this._tokens=[],this._currentLanguageId=0,this._lastTokenMetadata=0}enterLanguage(C){this._currentLanguageId=this._languageService.languageIdCodec.encodeLanguageId(C)}emit(C,W){const V=this._theme.match(this._currentLanguageId,W)|1024;this._lastTokenMetadata!==V&&(this._lastTokenMetadata=V,this._tokens.push(C),this._tokens.push(V))}static _merge(C,W,V){const U=C!==null?C.length:0,G=W.length,Z=V!==null?V.length:0;if(U===0&&G===0&&Z===0)return new Uint32Array(0);if(U===0&&G===0)return V;if(G===0&&Z===0)return C;const X=new Uint32Array(U+G+Z);C!==null&&X.set(C);for(let Q=0;Q<G;Q++)X[U+Q]=W[Q];return V!==null&&X.set(V,U+G),X}nestedLanguageTokenize(C,W,V,U){const G=V.languageId,Z=V.state,X=TokenizationRegistry.get(G);if(!X)return this.enterLanguage(G),this.emit(U,""),Z;const Q=X.tokenizeEncoded(C,W,Z);if(U!==0)for(let J=0,ee=Q.tokens.length;J<ee;J+=2)Q.tokens[J]+=U;return this._prependTokens=MonarchModernTokensCollector._merge(this._prependTokens,this._tokens,Q.tokens),this._tokens=[],this._currentLanguageId=0,this._lastTokenMetadata=0,Q.endState}finalize(C){return new EncodedTokenizationResult(MonarchModernTokensCollector._merge(this._prependTokens,this._tokens,null),C)}}let MonarchTokenizer=MonarchTokenizer_1=class extends Disposable{constructor(C,W,V,U,G){super(),this._configurationService=G,this._languageService=C,this._standaloneThemeService=W,this._languageId=V,this._lexer=U,this._embeddedLanguages=Object.create(null),this.embeddedLoaded=Promise.resolve(void 0);let Z=!1;this._register(TokenizationRegistry.onDidChange(X=>{if(Z)return;let Q=!1;for(let J=0,ee=X.changedLanguages.length;J<ee;J++){const te=X.changedLanguages[J];if(this._embeddedLanguages[te]){Q=!0;break}}Q&&(Z=!0,TokenizationRegistry.handleChange([this._languageId]),Z=!1)})),this._maxTokenizationLineLength=this._configurationService.getValue("editor.maxTokenizationLineLength",{overrideIdentifier:this._languageId}),this._register(this._configurationService.onDidChangeConfiguration(X=>{X.affectsConfiguration("editor.maxTokenizationLineLength")&&(this._maxTokenizationLineLength=this._configurationService.getValue("editor.maxTokenizationLineLength",{overrideIdentifier:this._languageId}))}))}getLoadStatus(){const C=[];for(const W in this._embeddedLanguages){const V=TokenizationRegistry.get(W);if(V){if(V instanceof MonarchTokenizer_1){const U=V.getLoadStatus();U.loaded===!1&&C.push(U.promise)}continue}TokenizationRegistry.isResolved(W)||C.push(TokenizationRegistry.getOrCreate(W))}return C.length===0?{loaded:!0}:{loaded:!1,promise:Promise.all(C).then(W=>{})}}getInitialState(){const C=MonarchStackElementFactory.create(null,this._lexer.start);return MonarchLineStateFactory.create(C,null)}tokenize(C,W,V){if(C.length>=this._maxTokenizationLineLength)return nullTokenize(this._languageId,V);const U=new MonarchClassicTokensCollector,G=this._tokenize(C,W,V,U);return U.finalize(G)}tokenizeEncoded(C,W,V){if(C.length>=this._maxTokenizationLineLength)return nullTokenizeEncoded(this._languageService.languageIdCodec.encodeLanguageId(this._languageId),V);const U=new MonarchModernTokensCollector(this._languageService,this._standaloneThemeService.getColorTheme().tokenTheme),G=this._tokenize(C,W,V,U);return U.finalize(G)}_tokenize(C,W,V,U){return V.embeddedLanguageData?this._nestedTokenize(C,W,V,0,U):this._myTokenize(C,W,V,0,U)}_findLeavingNestedLanguageOffset(C,W){let V=this._lexer.tokenizer[W.stack.state];if(!V&&(V=findRules(this._lexer,W.stack.state),!V))throw createError(this._lexer,"tokenizer state is not defined: "+W.stack.state);let U=-1,G=!1;for(const Z of V){if(!isIAction(Z.action)||Z.action.nextEmbedded!=="@pop")continue;G=!0;let X=Z.regex;const Q=Z.regex.source;if(Q.substr(0,4)==="^(?:"&&Q.substr(Q.length-1,1)===")"){const ee=(X.ignoreCase?"i":"")+(X.unicode?"u":"");X=new RegExp(Q.substr(4,Q.length-5),ee)}const J=C.search(X);J===-1||J!==0&&Z.matchOnlyAtLineStart||(U===-1||J<U)&&(U=J)}if(!G)throw createError(this._lexer,'no rule containing nextEmbedded: "@pop" in tokenizer embedded state: '+W.stack.state);return U}_nestedTokenize(C,W,V,U,G){const Z=this._findLeavingNestedLanguageOffset(C,V);if(Z===-1){const J=G.nestedLanguageTokenize(C,W,V.embeddedLanguageData,U);return MonarchLineStateFactory.create(V.stack,new EmbeddedLanguageData(V.embeddedLanguageData.languageId,J))}const X=C.substring(0,Z);X.length>0&&G.nestedLanguageTokenize(X,!1,V.embeddedLanguageData,U);const Q=C.substring(Z);return this._myTokenize(Q,W,V,U+Z,G)}_safeRuleName(C){return C?C.name:"(unknown)"}_myTokenize(C,W,V,U,G){G.enterLanguage(this._languageId);const Z=C.length,X=W&&this._lexer.includeLF?C+`
`:C,Q=X.length;let J=V.embeddedLanguageData,ee=V.stack,te=0,ie=null,ne=!0;for(;ne||te<Q;){const oe=te,re=ee.depth,ae=ie?ie.groups.length:0,se=ee.state;let le=null,ce=null,de=null,ue=null,ge=null;if(ie){le=ie.matches;const pe=ie.groups.shift();ce=pe.matched,de=pe.action,ue=ie.rule,ie.groups.length===0&&(ie=null)}else{if(!ne&&te>=Q)break;ne=!1;let pe=this._lexer.tokenizer[se];if(!pe&&(pe=findRules(this._lexer,se),!pe))throw createError(this._lexer,"tokenizer state is not defined: "+se);const Se=X.substr(te);for(const Le of pe)if((te===0||!Le.matchOnlyAtLineStart)&&(le=Se.match(Le.regex),le)){ce=le[0],de=Le.action;break}}if(le||(le=[""],ce=""),de||(te<Q&&(le=[X.charAt(te)],ce=le[0]),de=this._lexer.defaultToken),ce===null)break;for(te+=ce.length;isFuzzyAction(de)&&isIAction(de)&&de.test;)de=de.test(ce,le,se,te===Q);let he=null;if(typeof de=="string"||Array.isArray(de))he=de;else if(de.group)he=de.group;else if(de.token!==null&&de.token!==void 0){if(de.tokenSubst?he=substituteMatches(this._lexer,de.token,ce,le,se):he=de.token,de.nextEmbedded)if(de.nextEmbedded==="@pop"){if(!J)throw createError(this._lexer,"cannot pop embedded language if not inside one");J=null}else{if(J)throw createError(this._lexer,"cannot enter embedded language from within an embedded language");ge=substituteMatches(this._lexer,de.nextEmbedded,ce,le,se)}if(de.goBack&&(te=Math.max(0,te-de.goBack)),de.switchTo&&typeof de.switchTo=="string"){let pe=substituteMatches(this._lexer,de.switchTo,ce,le,se);if(pe[0]==="@"&&(pe=pe.substr(1)),findRules(this._lexer,pe))ee=ee.switchTo(pe);else throw createError(this._lexer,"trying to switch to a state '"+pe+"' that is undefined in rule: "+this._safeRuleName(ue))}else{if(de.transform&&typeof de.transform=="function")throw createError(this._lexer,"action.transform not supported");if(de.next)if(de.next==="@push"){if(ee.depth>=this._lexer.maxStack)throw createError(this._lexer,"maximum tokenizer stack size reached: ["+ee.state+","+ee.parent.state+",...]");ee=ee.push(se)}else if(de.next==="@pop"){if(ee.depth<=1)throw createError(this._lexer,"trying to pop an empty stack in rule: "+this._safeRuleName(ue));ee=ee.pop()}else if(de.next==="@popall")ee=ee.popall();else{let pe=substituteMatches(this._lexer,de.next,ce,le,se);if(pe[0]==="@"&&(pe=pe.substr(1)),findRules(this._lexer,pe))ee=ee.push(pe);else throw createError(this._lexer,"trying to set a next state '"+pe+"' that is undefined in rule: "+this._safeRuleName(ue))}}de.log&&typeof de.log=="string"&&log(this._lexer,this._lexer.languageId+": "+substituteMatches(this._lexer,de.log,ce,le,se))}if(he===null)throw createError(this._lexer,"lexer rule has no well-defined action in rule: "+this._safeRuleName(ue));const fe=pe=>{const Se=this._languageService.getLanguageIdByLanguageName(pe)||this._languageService.getLanguageIdByMimeType(pe)||pe,Le=this._getNestedEmbeddedLanguageData(Se);if(te<Q){const be=C.substr(te);return this._nestedTokenize(be,W,MonarchLineStateFactory.create(ee,Le),U+te,G)}else return MonarchLineStateFactory.create(ee,Le)};if(Array.isArray(he)){if(ie&&ie.groups.length>0)throw createError(this._lexer,"groups cannot be nested: "+this._safeRuleName(ue));if(le.length!==he.length+1)throw createError(this._lexer,"matched number of groups does not match the number of actions in rule: "+this._safeRuleName(ue));let pe=0;for(let Se=1;Se<le.length;Se++)pe+=le[Se].length;if(pe!==ce.length)throw createError(this._lexer,"with groups, all characters should be matched in consecutive groups in rule: "+this._safeRuleName(ue));ie={rule:ue,matches:le,groups:[]};for(let Se=0;Se<he.length;Se++)ie.groups[Se]={action:he[Se],matched:le[Se+1]};te-=ce.length;continue}else{if(he==="@rematch"&&(te-=ce.length,ce="",le=null,he="",ge!==null))return fe(ge);if(ce.length===0){if(Q===0||re!==ee.depth||se!==ee.state||(ie?ie.groups.length:0)!==ae)continue;throw createError(this._lexer,"no progress in tokenizer in rule: "+this._safeRuleName(ue))}let pe=null;if(isString$2(he)&&he.indexOf("@brackets")===0){const Se=he.substr(9),Le=findBracket(this._lexer,ce);if(!Le)throw createError(this._lexer,"@brackets token returned but no bracket defined as: "+ce);pe=sanitize(Le.token+Se)}else{const Se=he===""?"":he+this._lexer.tokenPostfix;pe=sanitize(Se)}oe<Z&&G.emit(oe+U,pe)}if(ge!==null)return fe(ge)}return MonarchLineStateFactory.create(ee,J)}_getNestedEmbeddedLanguageData(C){if(!this._languageService.isRegisteredLanguageId(C))return new EmbeddedLanguageData(C,NullState);C!==this._languageId&&(this._languageService.requestBasicLanguageFeatures(C),TokenizationRegistry.getOrCreate(C),this._embeddedLanguages[C]=!0);const W=TokenizationRegistry.get(C);return W?new EmbeddedLanguageData(C,W.getInitialState()):new EmbeddedLanguageData(C,NullState)}};MonarchTokenizer=MonarchTokenizer_1=__decorate$28([__param$21(4,IConfigurationService)],MonarchTokenizer);function findBracket(K,C){if(!C)return null;C=fixCase(K,C);const W=K.brackets;for(const V of W){if(V.open===C)return{token:V.token,bracketType:1};if(V.close===C)return{token:V.token,bracketType:-1}}return null}var __awaiter$1w=globalThis&&globalThis.__awaiter||function(K,C,W,V){function U(G){return G instanceof W?G:new W(function(Z){Z(G)})}return new(W||(W=Promise))(function(G,Z){function X(ee){try{J(V.next(ee))}catch(te){Z(te)}}function Q(ee){try{J(V.throw(ee))}catch(te){Z(te)}}function J(ee){ee.done?G(ee.value):U(ee.value).then(X,Q)}J((V=V.apply(K,C||[])).next())})};const ttPolicy$3=createTrustedTypesPolicy("standaloneColorizer",{createHTML:K=>K});class Colorizer{static colorizeElement(C,W,V,U){U=U||{};const G=U.theme||"vs",Z=U.mimeType||V.getAttribute("lang")||V.getAttribute("data-lang");if(!Z)return console.error("Mode not detected"),Promise.resolve();const X=W.getLanguageIdByMimeType(Z)||Z;C.setTheme(G);const Q=V.firstChild?V.firstChild.nodeValue:"";V.className+=" "+G;const J=ee=>{var te;const ie=(te=ttPolicy$3==null?void 0:ttPolicy$3.createHTML(ee))!==null&&te!==void 0?te:ee;V.innerHTML=ie};return this.colorize(W,Q||"",X,U).then(J,ee=>console.error(ee))}static colorize(C,W,V,U){return __awaiter$1w(this,void 0,void 0,function*(){const G=C.languageIdCodec;let Z=4;U&&typeof U.tabSize=="number"&&(Z=U.tabSize),startsWithUTF8BOM(W)&&(W=W.substr(1));const X=splitLines(W);if(!C.isRegisteredLanguageId(V))return _fakeColorize(X,Z,G);const Q=yield TokenizationRegistry.getOrCreate(V);return Q?_colorize(X,Z,Q,G):_fakeColorize(X,Z,G)})}static colorizeLine(C,W,V,U,G=4){const Z=ViewLineRenderingData.isBasicASCII(C,W),X=ViewLineRenderingData.containsRTL(C,Z,V);return renderViewLine2(new RenderLineInput(!1,!0,C,!1,Z,X,0,U,[],G,0,0,0,0,-1,"none",!1,!1,null)).html}static colorizeModelLine(C,W,V=4){const U=C.getLineContent(W);C.tokenization.forceTokenization(W);const Z=C.tokenization.getLineTokens(W).inflate();return this.colorizeLine(U,C.mightContainNonBasicASCII(),C.mightContainRTL(),Z,V)}}function _colorize(K,C,W,V){return new Promise((U,G)=>{const Z=()=>{const X=_actualColorize(K,C,W,V);if(W instanceof MonarchTokenizer){const Q=W.getLoadStatus();if(Q.loaded===!1){Q.promise.then(Z,G);return}}U(X)};Z()})}function _fakeColorize(K,C,W){let V=[];const G=new Uint32Array(2);G[0]=0,G[1]=33587200;for(let Z=0,X=K.length;Z<X;Z++){const Q=K[Z];G[0]=Q.length;const J=new LineTokens(G,Q,W),ee=ViewLineRenderingData.isBasicASCII(Q,!0),te=ViewLineRenderingData.containsRTL(Q,ee,!0),ie=renderViewLine2(new RenderLineInput(!1,!0,Q,!1,ee,te,0,J,[],C,0,0,0,0,-1,"none",!1,!1,null));V=V.concat(ie.html),V.push("<br/>")}return V.join("")}function _actualColorize(K,C,W,V){let U=[],G=W.getInitialState();for(let Z=0,X=K.length;Z<X;Z++){const Q=K[Z],J=W.tokenizeEncoded(Q,!0,G);LineTokens.convertToEndOffset(J.tokens,Q.length);const ee=new LineTokens(J.tokens,Q,V),te=ViewLineRenderingData.isBasicASCII(Q,!0),ie=ViewLineRenderingData.containsRTL(Q,te,!0),ne=renderViewLine2(new RenderLineInput(!1,!0,Q,!1,te,ie,0,ee.inflate(),[],C,0,0,0,0,-1,"none",!1,!1,null));U=U.concat(ne.html),U.push("<br/>"),G=J.endState}return U.join("")}const aria="",MAX_MESSAGE_LENGTH=2e4;let ariaContainer,alertContainer,alertContainer2,statusContainer,statusContainer2;function setARIAContainer(K){ariaContainer=document.createElement("div"),ariaContainer.className="monaco-aria-container";const C=()=>{const V=document.createElement("div");return V.className="monaco-alert",V.setAttribute("role","alert"),V.setAttribute("aria-atomic","true"),ariaContainer.appendChild(V),V};alertContainer=C(),alertContainer2=C();const W=()=>{const V=document.createElement("div");return V.className="monaco-status",V.setAttribute("aria-live","polite"),V.setAttribute("aria-atomic","true"),ariaContainer.appendChild(V),V};statusContainer=W(),statusContainer2=W(),K.appendChild(ariaContainer)}function alert(K){ariaContainer&&(alertContainer.textContent!==K?(clearNode(alertContainer2),insertMessage(alertContainer,K)):(clearNode(alertContainer),insertMessage(alertContainer2,K)))}function status(K){ariaContainer&&(statusContainer.textContent!==K?(clearNode(statusContainer2),insertMessage(statusContainer,K)):(clearNode(statusContainer),insertMessage(statusContainer2,K)))}function insertMessage(K,C){clearNode(K),C.length>MAX_MESSAGE_LENGTH&&(C=C.substr(0,MAX_MESSAGE_LENGTH)),K.textContent=C,K.style.visibility="hidden",K.style.visibility="visible"}const IMarkerDecorationsService=createDecorator("markerDecorationsService");var __decorate$27=globalThis&&globalThis.__decorate||function(K,C,W,V){var U=arguments.length,G=U<3?C:V===null?V=Object.getOwnPropertyDescriptor(C,W):V,Z;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")G=Reflect.decorate(K,C,W,V);else for(var X=K.length-1;X>=0;X--)(Z=K[X])&&(G=(U<3?Z(G):U>3?Z(C,W,G):Z(C,W))||G);return U>3&&G&&Object.defineProperty(C,W,G),G},__param$20=globalThis&&globalThis.__param||function(K,C){return function(W,V){C(W,V,K)}};let MarkerDecorationsContribution=class{constructor(C,W){}dispose(){}};MarkerDecorationsContribution.ID="editor.contrib.markerDecorations";MarkerDecorationsContribution=__decorate$27([__param$20(1,IMarkerDecorationsService)],MarkerDecorationsContribution);registerEditorContribution(MarkerDecorationsContribution.ID,MarkerDecorationsContribution,0);const editor$2="";class ElementSizeObserver extends Disposable{constructor(C,W){super(),this._onDidChange=this._register(new Emitter$1),this.onDidChange=this._onDidChange.event,this._referenceDomElement=C,this._width=-1,this._height=-1,this._resizeObserver=null,this.measureReferenceDomElement(!1,W)}dispose(){this.stopObserving(),super.dispose()}getWidth(){return this._width}getHeight(){return this._height}startObserving(){if(!this._resizeObserver&&this._referenceDomElement){let C=null;const W=()=>{C?this.observe({width:C.width,height:C.height}):this.observe()};let V=!1,U=!1;const G=()=>{if(V&&!U)try{V=!1,U=!0,W()}finally{requestAnimationFrame(()=>{U=!1,G()})}};this._resizeObserver=new ResizeObserver(Z=>{C=Z&&Z[0]&&Z[0].contentRect?Z[0].contentRect:null,V=!0,G()}),this._resizeObserver.observe(this._referenceDomElement)}}stopObserving(){this._resizeObserver&&(this._resizeObserver.disconnect(),this._resizeObserver=null)}observe(C){this.measureReferenceDomElement(!0,C)}measureReferenceDomElement(C,W){let V=0,U=0;W?(V=W.width,U=W.height):this._referenceDomElement&&(V=this._referenceDomElement.clientWidth,U=this._referenceDomElement.clientHeight),V=Math.max(5,V),U=Math.max(5,U),(this._width!==V||this._height!==U)&&(this._width=V,this._height=U,C&&this._onDidChange.fire())}}class EditorSettingMigration{constructor(C,W){this.key=C,this.migrate=W}apply(C){const W=EditorSettingMigration._read(C,this.key),V=G=>EditorSettingMigration._read(C,G),U=(G,Z)=>EditorSettingMigration._write(C,G,Z);this.migrate(W,V,U)}static _read(C,W){if(typeof C>"u")return;const V=W.indexOf(".");if(V>=0){const U=W.substring(0,V);return this._read(C[U],W.substring(V+1))}return C[W]}static _write(C,W,V){const U=W.indexOf(".");if(U>=0){const G=W.substring(0,U);C[G]=C[G]||{},this._write(C[G],W.substring(U+1),V);return}C[W]=V}}EditorSettingMigration.items=[];function registerEditorSettingMigration(K,C){EditorSettingMigration.items.push(new EditorSettingMigration(K,C))}function registerSimpleEditorSettingMigration(K,C){registerEditorSettingMigration(K,(W,V,U)=>{if(typeof W<"u"){for(const[G,Z]of C)if(W===G){U(K,Z);return}}})}function migrateOptions(K){EditorSettingMigration.items.forEach(C=>C.apply(K))}registerSimpleEditorSettingMigration("wordWrap",[[!0,"on"],[!1,"off"]]);registerSimpleEditorSettingMigration("lineNumbers",[[!0,"on"],[!1,"off"]]);registerSimpleEditorSettingMigration("cursorBlinking",[["visible","solid"]]);registerSimpleEditorSettingMigration("renderWhitespace",[[!0,"boundary"],[!1,"none"]]);registerSimpleEditorSettingMigration("renderLineHighlight",[[!0,"line"],[!1,"none"]]);registerSimpleEditorSettingMigration("acceptSuggestionOnEnter",[[!0,"on"],[!1,"off"]]);registerSimpleEditorSettingMigration("tabCompletion",[[!1,"off"],[!0,"onlySnippets"]]);registerSimpleEditorSettingMigration("hover",[[!0,{enabled:!0}],[!1,{enabled:!1}]]);registerSimpleEditorSettingMigration("parameterHints",[[!0,{enabled:!0}],[!1,{enabled:!1}]]);registerSimpleEditorSettingMigration("autoIndent",[[!1,"advanced"],[!0,"full"]]);registerSimpleEditorSettingMigration("matchBrackets",[[!0,"always"],[!1,"never"]]);registerSimpleEditorSettingMigration("renderFinalNewline",[[!0,"on"],[!1,"off"]]);registerSimpleEditorSettingMigration("cursorSmoothCaretAnimation",[[!0,"on"],[!1,"off"]]);registerEditorSettingMigration("autoClosingBrackets",(K,C,W)=>{K===!1&&(W("autoClosingBrackets","never"),typeof C("autoClosingQuotes")>"u"&&W("autoClosingQuotes","never"),typeof C("autoSurround")>"u"&&W("autoSurround","never"))});registerEditorSettingMigration("renderIndentGuides",(K,C,W)=>{typeof K<"u"&&(W("renderIndentGuides",void 0),typeof C("guides.indentation")>"u"&&W("guides.indentation",!!K))});registerEditorSettingMigration("highlightActiveIndentGuide",(K,C,W)=>{typeof K<"u"&&(W("highlightActiveIndentGuide",void 0),typeof C("guides.highlightActiveIndentation")>"u"&&W("guides.highlightActiveIndentation",!!K))});const suggestFilteredTypesMapping={method:"showMethods",function:"showFunctions",constructor:"showConstructors",deprecated:"showDeprecated",field:"showFields",variable:"showVariables",class:"showClasses",struct:"showStructs",interface:"showInterfaces",module:"showModules",property:"showProperties",event:"showEvents",operator:"showOperators",unit:"showUnits",value:"showValues",constant:"showConstants",enum:"showEnums",enumMember:"showEnumMembers",keyword:"showKeywords",text:"showWords",color:"showColors",file:"showFiles",reference:"showReferences",folder:"showFolders",typeParameter:"showTypeParameters",snippet:"showSnippets"};registerEditorSettingMigration("suggest.filteredTypes",(K,C,W)=>{if(K&&typeof K=="object"){for(const V of Object.entries(suggestFilteredTypesMapping))K[V[0]]===!1&&typeof C(`suggest.${V[1]}`)>"u"&&W(`suggest.${V[1]}`,!1);W("suggest.filteredTypes",void 0)}});registerEditorSettingMigration("quickSuggestions",(K,C,W)=>{if(typeof K=="boolean"){const V=K?"on":"off";W("quickSuggestions",{comments:V,strings:V,other:V})}});registerEditorSettingMigration("experimental.stickyScroll.enabled",(K,C,W)=>{typeof K=="boolean"&&(W("experimental.stickyScroll.enabled",void 0),typeof C("stickyScroll.enabled")>"u"&&W("stickyScroll.enabled",K))});registerEditorSettingMigration("experimental.stickyScroll.maxLineCount",(K,C,W)=>{typeof K=="number"&&(W("experimental.stickyScroll.maxLineCount",void 0),typeof C("stickyScroll.maxLineCount")>"u"&&W("stickyScroll.maxLineCount",K))});class TabFocusImpl{constructor(){this._tabFocus=!1,this._onDidChangeTabFocus=new Emitter$1,this.onDidChangeTabFocus=this._onDidChangeTabFocus.event}getTabFocusMode(){return this._tabFocus}setTabFocusMode(C){this._tabFocus=C,this._onDidChangeTabFocus.fire(this._tabFocus)}}const TabFocus=new TabFocusImpl,IAccessibilityService=createDecorator("accessibilityService"),CONTEXT_ACCESSIBILITY_MODE_ENABLED=new RawContextKey("accessibilityModeEnabled",!1);var __decorate$26=globalThis&&globalThis.__decorate||function(K,C,W,V){var U=arguments.length,G=U<3?C:V===null?V=Object.getOwnPropertyDescriptor(C,W):V,Z;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")G=Reflect.decorate(K,C,W,V);else for(var X=K.length-1;X>=0;X--)(Z=K[X])&&(G=(U<3?Z(G):U>3?Z(C,W,G):Z(C,W))||G);return U>3&&G&&Object.defineProperty(C,W,G),G},__param$1$=globalThis&&globalThis.__param||function(K,C){return function(W,V){C(W,V,K)}};let EditorConfiguration=class extends Disposable{constructor(C,W,V,U){super(),this._accessibilityService=U,this._onDidChange=this._register(new Emitter$1),this.onDidChange=this._onDidChange.event,this._onDidChangeFast=this._register(new Emitter$1),this.onDidChangeFast=this._onDidChangeFast.event,this._isDominatedByLongLines=!1,this._viewLineCount=1,this._lineNumbersDigitCount=1,this._reservedHeight=0,this._glyphMarginDecorationLaneCount=1,this._computeOptionsMemory=new ComputeOptionsMemory,this.isSimpleWidget=C,this._containerObserver=this._register(new ElementSizeObserver(V,W.dimension)),this._rawOptions=deepCloneAndMigrateOptions(W),this._validatedOptions=EditorOptionsUtil.validateOptions(this._rawOptions),this.options=this._computeOptions(),this.options.get(13)&&this._containerObserver.startObserving(),this._register(EditorZoom.onDidChangeZoomLevel(()=>this._recomputeOptions())),this._register(TabFocus.onDidChangeTabFocus(()=>this._recomputeOptions())),this._register(this._containerObserver.onDidChange(()=>this._recomputeOptions())),this._register(FontMeasurements.onDidChange(()=>this._recomputeOptions())),this._register(PixelRatio.onDidChange(()=>this._recomputeOptions())),this._register(this._accessibilityService.onDidChangeScreenReaderOptimized(()=>this._recomputeOptions()))}_recomputeOptions(){const C=this._computeOptions(),W=EditorOptionsUtil.checkEquals(this.options,C);W!==null&&(this.options=C,this._onDidChangeFast.fire(W),this._onDidChange.fire(W))}_computeOptions(){const C=this._readEnvConfiguration(),W=BareFontInfo.createFromValidatedSettings(this._validatedOptions,C.pixelRatio,this.isSimpleWidget),V=this._readFontInfo(W),U={memory:this._computeOptionsMemory,outerWidth:C.outerWidth,outerHeight:C.outerHeight-this._reservedHeight,fontInfo:V,extraEditorClassName:C.extraEditorClassName,isDominatedByLongLines:this._isDominatedByLongLines,viewLineCount:this._viewLineCount,lineNumbersDigitCount:this._lineNumbersDigitCount,emptySelectionClipboard:C.emptySelectionClipboard,pixelRatio:C.pixelRatio,tabFocusMode:TabFocus.getTabFocusMode(),accessibilitySupport:C.accessibilitySupport,glyphMarginDecorationLaneCount:this._glyphMarginDecorationLaneCount};return EditorOptionsUtil.computeOptions(this._validatedOptions,U)}_readEnvConfiguration(){return{extraEditorClassName:getExtraEditorClassName(),outerWidth:this._containerObserver.getWidth(),outerHeight:this._containerObserver.getHeight(),emptySelectionClipboard:isWebKit||isFirefox,pixelRatio:PixelRatio.value,accessibilitySupport:this._accessibilityService.isScreenReaderOptimized()?2:this._accessibilityService.getAccessibilitySupport()}}_readFontInfo(C){return FontMeasurements.readFontInfo(C)}getRawOptions(){return this._rawOptions}updateOptions(C){const W=deepCloneAndMigrateOptions(C);EditorOptionsUtil.applyUpdate(this._rawOptions,W)&&(this._validatedOptions=EditorOptionsUtil.validateOptions(this._rawOptions),this._recomputeOptions())}observeContainer(C){this._containerObserver.observe(C)}setIsDominatedByLongLines(C){this._isDominatedByLongLines!==C&&(this._isDominatedByLongLines=C,this._recomputeOptions())}setModelLineCount(C){const W=digitCount(C);this._lineNumbersDigitCount!==W&&(this._lineNumbersDigitCount=W,this._recomputeOptions())}setViewLineCount(C){this._viewLineCount!==C&&(this._viewLineCount=C,this._recomputeOptions())}setReservedHeight(C){this._reservedHeight!==C&&(this._reservedHeight=C,this._recomputeOptions())}setGlyphMarginDecorationLaneCount(C){this._glyphMarginDecorationLaneCount!==C&&(this._glyphMarginDecorationLaneCount=C,this._recomputeOptions())}};EditorConfiguration=__decorate$26([__param$1$(3,IAccessibilityService)],EditorConfiguration);function digitCount(K){let C=0;for(;K;)K=Math.floor(K/10),C++;return C||1}function getExtraEditorClassName(){let K="";return!isSafari&&!isWebkitWebView&&(K+="no-user-select "),isSafari&&(K+="no-minimap-shadow ",K+="enable-user-select "),isMacintosh&&(K+="mac "),K}class ValidatedEditorOptions{constructor(){this._values=[]}_read(C){return this._values[C]}get(C){return this._values[C]}_write(C,W){this._values[C]=W}}class ComputedEditorOptions{constructor(){this._values=[]}_read(C){if(C>=this._values.length)throw new Error("Cannot read uninitialized value");return this._values[C]}get(C){return this._read(C)}_write(C,W){this._values[C]=W}}class EditorOptionsUtil{static validateOptions(C){const W=new ValidatedEditorOptions;for(const V of editorOptionsRegistry){const U=V.name==="_never_"?void 0:C[V.name];W._write(V.id,V.validate(U))}return W}static computeOptions(C,W){const V=new ComputedEditorOptions;for(const U of editorOptionsRegistry)V._write(U.id,U.compute(W,V,C._read(U.id)));return V}static _deepEquals(C,W){if(typeof C!="object"||typeof W!="object"||!C||!W)return C===W;if(Array.isArray(C)||Array.isArray(W))return Array.isArray(C)&&Array.isArray(W)?equals$5(C,W):!1;if(Object.keys(C).length!==Object.keys(W).length)return!1;for(const V in C)if(!EditorOptionsUtil._deepEquals(C[V],W[V]))return!1;return!0}static checkEquals(C,W){const V=[];let U=!1;for(const G of editorOptionsRegistry){const Z=!EditorOptionsUtil._deepEquals(C._read(G.id),W._read(G.id));V[G.id]=Z,Z&&(U=!0)}return U?new ConfigurationChangedEvent(V):null}static applyUpdate(C,W){let V=!1;for(const U of editorOptionsRegistry)if(W.hasOwnProperty(U.name)){const G=U.applyUpdate(C[U.name],W[U.name]);C[U.name]=G.newValue,V=V||G.didChange}return V}}function deepCloneAndMigrateOptions(K){const C=deepClone(K);return migrateOptions(C),C}function memoize(K,C,W){let V=null,U=null;if(typeof W.value=="function"?(V="value",U=W.value,U.length!==0&&console.warn("Memoize should only be used in functions with zero parameters")):typeof W.get=="function"&&(V="get",U=W.get),!U)throw new Error("not supported");const G=`$memoize$${C}`;W[V]=function(...Z){return this.hasOwnProperty(G)||Object.defineProperty(this,G,{configurable:!1,enumerable:!1,writable:!1,value:U.apply(this,Z)}),this[G]}}var __decorate$25=globalThis&&globalThis.__decorate||function(K,C,W,V){var U=arguments.length,G=U<3?C:V===null?V=Object.getOwnPropertyDescriptor(C,W):V,Z;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")G=Reflect.decorate(K,C,W,V);else for(var X=K.length-1;X>=0;X--)(Z=K[X])&&(G=(U<3?Z(G):U>3?Z(C,W,G):Z(C,W))||G);return U>3&&G&&Object.defineProperty(C,W,G),G},EventType;(function(K){K.Tap="-monaco-gesturetap",K.Change="-monaco-gesturechange",K.Start="-monaco-gesturestart",K.End="-monaco-gesturesend",K.Contextmenu="-monaco-gesturecontextmenu"})(EventType||(EventType={}));class Gesture extends Disposable{constructor(){super(),this.dispatched=!1,this.targets=new LinkedList,this.ignoreTargets=new LinkedList,this.activeTouches={},this.handle=null,this._lastSetTapCountTime=0,this._register(addDisposableListener(document,"touchstart",C=>this.onTouchStart(C),{passive:!1})),this._register(addDisposableListener(document,"touchend",C=>this.onTouchEnd(C))),this._register(addDisposableListener(document,"touchmove",C=>this.onTouchMove(C),{passive:!1}))}static addTarget(C){if(!Gesture.isTouchDevice())return Disposable.None;Gesture.INSTANCE||(Gesture.INSTANCE=new Gesture);const W=Gesture.INSTANCE.targets.push(C);return toDisposable(W)}static ignoreTarget(C){if(!Gesture.isTouchDevice())return Disposable.None;Gesture.INSTANCE||(Gesture.INSTANCE=new Gesture);const W=Gesture.INSTANCE.ignoreTargets.push(C);return toDisposable(W)}static isTouchDevice(){return"ontouchstart"in window||navigator.maxTouchPoints>0}dispose(){this.handle&&(this.handle.dispose(),this.handle=null),super.dispose()}onTouchStart(C){const W=Date.now();this.handle&&(this.handle.dispose(),this.handle=null);for(let V=0,U=C.targetTouches.length;V<U;V++){const G=C.targetTouches.item(V);this.activeTouches[G.identifier]={id:G.identifier,initialTarget:G.target,initialTimeStamp:W,initialPageX:G.pageX,initialPageY:G.pageY,rollingTimestamps:[W],rollingPageX:[G.pageX],rollingPageY:[G.pageY]};const Z=this.newGestureEvent(EventType.Start,G.target);Z.pageX=G.pageX,Z.pageY=G.pageY,this.dispatchEvent(Z)}this.dispatched&&(C.preventDefault(),C.stopPropagation(),this.dispatched=!1)}onTouchEnd(C){const W=Date.now(),V=Object.keys(this.activeTouches).length;for(let U=0,G=C.changedTouches.length;U<G;U++){const Z=C.changedTouches.item(U);if(!this.activeTouches.hasOwnProperty(String(Z.identifier))){console.warn("move of an UNKNOWN touch",Z);continue}const X=this.activeTouches[Z.identifier],Q=Date.now()-X.initialTimeStamp;if(Q<Gesture.HOLD_DELAY&&Math.abs(X.initialPageX-tail$3(X.rollingPageX))<30&&Math.abs(X.initialPageY-tail$3(X.rollingPageY))<30){const J=this.newGestureEvent(EventType.Tap,X.initialTarget);J.pageX=tail$3(X.rollingPageX),J.pageY=tail$3(X.rollingPageY),this.dispatchEvent(J)}else if(Q>=Gesture.HOLD_DELAY&&Math.abs(X.initialPageX-tail$3(X.rollingPageX))<30&&Math.abs(X.initialPageY-tail$3(X.rollingPageY))<30){const J=this.newGestureEvent(EventType.Contextmenu,X.initialTarget);J.pageX=tail$3(X.rollingPageX),J.pageY=tail$3(X.rollingPageY),this.dispatchEvent(J)}else if(V===1){const J=tail$3(X.rollingPageX),ee=tail$3(X.rollingPageY),te=tail$3(X.rollingTimestamps)-X.rollingTimestamps[0],ie=J-X.rollingPageX[0],ne=ee-X.rollingPageY[0],oe=[...this.targets].filter(re=>X.initialTarget instanceof Node&&re.contains(X.initialTarget));this.inertia(oe,W,Math.abs(ie)/te,ie>0?1:-1,J,Math.abs(ne)/te,ne>0?1:-1,ee)}this.dispatchEvent(this.newGestureEvent(EventType.End,X.initialTarget)),delete this.activeTouches[Z.identifier]}this.dispatched&&(C.preventDefault(),C.stopPropagation(),this.dispatched=!1)}newGestureEvent(C,W){const V=document.createEvent("CustomEvent");return V.initEvent(C,!1,!0),V.initialTarget=W,V.tapCount=0,V}dispatchEvent(C){if(C.type===EventType.Tap){const W=new Date().getTime();let V=0;W-this._lastSetTapCountTime>Gesture.CLEAR_TAP_COUNT_TIME?V=1:V=2,this._lastSetTapCountTime=W,C.tapCount=V}else(C.type===EventType.Change||C.type===EventType.Contextmenu)&&(this._lastSetTapCountTime=0);if(C.initialTarget instanceof Node){for(const W of this.ignoreTargets)if(W.contains(C.initialTarget))return;for(const W of this.targets)W.contains(C.initialTarget)&&(W.dispatchEvent(C),this.dispatched=!0)}}inertia(C,W,V,U,G,Z,X,Q){this.handle=scheduleAtNextAnimationFrame(()=>{const J=Date.now(),ee=J-W;let te=0,ie=0,ne=!0;V+=Gesture.SCROLL_FRICTION*ee,Z+=Gesture.SCROLL_FRICTION*ee,V>0&&(ne=!1,te=U*V*ee),Z>0&&(ne=!1,ie=X*Z*ee);const oe=this.newGestureEvent(EventType.Change);oe.translationX=te,oe.translationY=ie,C.forEach(re=>re.dispatchEvent(oe)),ne||this.inertia(C,J,V,U,G+te,Z,X,Q+ie)})}onTouchMove(C){const W=Date.now();for(let V=0,U=C.changedTouches.length;V<U;V++){const G=C.changedTouches.item(V);if(!this.activeTouches.hasOwnProperty(String(G.identifier))){console.warn("end of an UNKNOWN touch",G);continue}const Z=this.activeTouches[G.identifier],X=this.newGestureEvent(EventType.Change,Z.initialTarget);X.translationX=G.pageX-tail$3(Z.rollingPageX),X.translationY=G.pageY-tail$3(Z.rollingPageY),X.pageX=G.pageX,X.pageY=G.pageY,this.dispatchEvent(X),Z.rollingPageX.length>3&&(Z.rollingPageX.shift(),Z.rollingPageY.shift(),Z.rollingTimestamps.shift()),Z.rollingPageX.push(G.pageX),Z.rollingPageY.push(G.pageY),Z.rollingTimestamps.push(W)}this.dispatched&&(C.preventDefault(),C.stopPropagation(),this.dispatched=!1)}}Gesture.SCROLL_FRICTION=-.005;Gesture.HOLD_DELAY=700;Gesture.CLEAR_TAP_COUNT_TIME=400;__decorate$25([memoize],Gesture,"isTouchDevice",null);class GlobalPointerMoveMonitor{constructor(){this._hooks=new DisposableStore,this._pointerMoveCallback=null,this._onStopCallback=null}dispose(){this.stopMonitoring(!1),this._hooks.dispose()}stopMonitoring(C,W){if(!this.isMonitoring())return;this._hooks.clear(),this._pointerMoveCallback=null;const V=this._onStopCallback;this._onStopCallback=null,C&&V&&V(W)}isMonitoring(){return!!this._pointerMoveCallback}startMonitoring(C,W,V,U,G){this.isMonitoring()&&this.stopMonitoring(!1),this._pointerMoveCallback=U,this._onStopCallback=G;let Z=C;try{C.setPointerCapture(W),this._hooks.add(toDisposable(()=>{try{C.releasePointerCapture(W)}catch{}}))}catch{Z=window}this._hooks.add(addDisposableListener(Z,EventType$1.POINTER_MOVE,X=>{if(X.buttons!==V){this.stopMonitoring(!0);return}X.preventDefault(),this._pointerMoveCallback(X)})),this._hooks.add(addDisposableListener(Z,EventType$1.POINTER_UP,X=>this.stopMonitoring(!0)))}}function asCssVariableName(K){return`--vscode-${K.replace(/\./g,"-")}`}function asCssVariable(K){return`var(${asCssVariableName(K)})`}function asCssVariableWithDefault(K,C){return`var(${asCssVariableName(K)}, ${C})`}const Extensions$4={ColorContribution:"base.contributions.colors"};class ColorRegistry{constructor(){this._onDidChangeSchema=new Emitter$1,this.onDidChangeSchema=this._onDidChangeSchema.event,this.colorSchema={type:"object",properties:{}},this.colorReferenceSchema={type:"string",enum:[],enumDescriptions:[]},this.colorsById={}}registerColor(C,W,V,U=!1,G){const Z={id:C,description:V,defaults:W,needsTransparency:U,deprecationMessage:G};this.colorsById[C]=Z;const X={type:"string",description:V,format:"color-hex",defaultSnippets:[{body:"${1:#ff0000}"}]};return G&&(X.deprecationMessage=G),this.colorSchema.properties[C]=X,this.colorReferenceSchema.enum.push(C),this.colorReferenceSchema.enumDescriptions.push(V),this._onDidChangeSchema.fire(),C}getColors(){return Object.keys(this.colorsById).map(C=>this.colorsById[C])}resolveDefaultColor(C,W){const V=this.colorsById[C];if(V&&V.defaults){const U=V.defaults[W.type];return resolveColorValue(U,W)}}getColorSchema(){return this.colorSchema}toString(){const C=(W,V)=>{const U=W.indexOf(".")===-1?0:1,G=V.indexOf(".")===-1?0:1;return U!==G?U-G:W.localeCompare(V)};return Object.keys(this.colorsById).sort(C).map(W=>`- \`${W}\`: ${this.colorsById[W].description}`).join(`
`)}}const colorRegistry$1=new ColorRegistry;Registry.add(Extensions$4.ColorContribution,colorRegistry$1);function registerColor(K,C,W,V,U){return colorRegistry$1.registerColor(K,C,W,V,U)}const foreground=registerColor("foreground",{dark:"#CCCCCC",light:"#616161",hcDark:"#FFFFFF",hcLight:"#292929"},localize("foreground","Overall foreground color. This color is only used if not overridden by a component."));registerColor("disabledForeground",{dark:"#CCCCCC80",light:"#61616180",hcDark:"#A5A5A5",hcLight:"#7F7F7F"},localize("disabledForeground","Overall foreground for disabled elements. This color is only used if not overridden by a component."));const errorForeground=registerColor("errorForeground",{dark:"#F48771",light:"#A1260D",hcDark:"#F48771",hcLight:"#B5200D"},localize("errorForeground","Overall foreground color for error messages. This color is only used if not overridden by a component."));registerColor("descriptionForeground",{light:"#717171",dark:transparent(foreground,.7),hcDark:transparent(foreground,.7),hcLight:transparent(foreground,.7)},localize("descriptionForeground","Foreground color for description text providing additional information, for example for a label."));const iconForeground=registerColor("icon.foreground",{dark:"#C5C5C5",light:"#424242",hcDark:"#FFFFFF",hcLight:"#292929"},localize("iconForeground","The default color for icons in the workbench.")),focusBorder=registerColor("focusBorder",{dark:"#007FD4",light:"#0090F1",hcDark:"#F38518",hcLight:"#006BBD"},localize("focusBorder","Overall border color for focused elements. This color is only used if not overridden by a component.")),contrastBorder=registerColor("contrastBorder",{light:null,dark:null,hcDark:"#6FC3DF",hcLight:"#0F4A85"},localize("contrastBorder","An extra border around elements to separate them from others for greater contrast.")),activeContrastBorder=registerColor("contrastActiveBorder",{light:null,dark:null,hcDark:focusBorder,hcLight:focusBorder},localize("activeContrastBorder","An extra border around active elements to separate them from others for greater contrast."));registerColor("selection.background",{light:null,dark:null,hcDark:null,hcLight:null},localize("selectionBackground","The background color of text selections in the workbench (e.g. for input fields or text areas). Note that this does not apply to selections within the editor."));registerColor("textSeparator.foreground",{light:"#0000002e",dark:"#ffffff2e",hcDark:Color.black,hcLight:"#292929"},localize("textSeparatorForeground","Color for text separators."));const textLinkForeground=registerColor("textLink.foreground",{light:"#006AB1",dark:"#3794FF",hcDark:"#3794FF",hcLight:"#0F4A85"},localize("textLinkForeground","Foreground color for links in text."));registerColor("textLink.activeForeground",{light:"#006AB1",dark:"#3794FF",hcDark:"#3794FF",hcLight:"#0F4A85"},localize("textLinkActiveForeground","Foreground color for links in text when clicked on and on mouse hover."));registerColor("textPreformat.foreground",{light:"#A31515",dark:"#D7BA7D",hcDark:"#D7BA7D",hcLight:"#292929"},localize("textPreformatForeground","Foreground color for preformatted text segments."));registerColor("textBlockQuote.background",{light:"#7f7f7f1a",dark:"#7f7f7f1a",hcDark:null,hcLight:"#F2F2F2"},localize("textBlockQuoteBackground","Background color for block quotes in text."));registerColor("textBlockQuote.border",{light:"#007acc80",dark:"#007acc80",hcDark:Color.white,hcLight:"#292929"},localize("textBlockQuoteBorder","Border color for block quotes in text."));registerColor("textCodeBlock.background",{light:"#dcdcdc66",dark:"#0a0a0a66",hcDark:Color.black,hcLight:"#F2F2F2"},localize("textCodeBlockBackground","Background color for code blocks in text."));const widgetShadow=registerColor("widget.shadow",{dark:transparent(Color.black,.36),light:transparent(Color.black,.16),hcDark:null,hcLight:null},localize("widgetShadow","Shadow color of widgets such as find/replace inside the editor.")),widgetBorder=registerColor("widget.border",{dark:null,light:null,hcDark:contrastBorder,hcLight:contrastBorder},localize("widgetBorder","Border color of widgets such as find/replace inside the editor.")),inputBackground=registerColor("input.background",{dark:"#3C3C3C",light:Color.white,hcDark:Color.black,hcLight:Color.white},localize("inputBoxBackground","Input box background.")),inputForeground=registerColor("input.foreground",{dark:foreground,light:foreground,hcDark:foreground,hcLight:foreground},localize("inputBoxForeground","Input box foreground.")),inputBorder=registerColor("input.border",{dark:null,light:null,hcDark:contrastBorder,hcLight:contrastBorder},localize("inputBoxBorder","Input box border.")),inputActiveOptionBorder=registerColor("inputOption.activeBorder",{dark:"#007ACC",light:"#007ACC",hcDark:contrastBorder,hcLight:contrastBorder},localize("inputBoxActiveOptionBorder","Border color of activated options in input fields."));registerColor("inputOption.hoverBackground",{dark:"#5a5d5e80",light:"#b8b8b850",hcDark:null,hcLight:null},localize("inputOption.hoverBackground","Background color of activated options in input fields."));const inputActiveOptionBackground=registerColor("inputOption.activeBackground",{dark:transparent(focusBorder,.4),light:transparent(focusBorder,.2),hcDark:Color.transparent,hcLight:Color.transparent},localize("inputOption.activeBackground","Background hover color of options in input fields.")),inputActiveOptionForeground=registerColor("inputOption.activeForeground",{dark:Color.white,light:Color.black,hcDark:foreground,hcLight:foreground},localize("inputOption.activeForeground","Foreground color of activated options in input fields."));registerColor("input.placeholderForeground",{light:transparent(foreground,.5),dark:transparent(foreground,.5),hcDark:transparent(foreground,.7),hcLight:transparent(foreground,.7)},localize("inputPlaceholderForeground","Input box foreground color for placeholder text."));const inputValidationInfoBackground=registerColor("inputValidation.infoBackground",{dark:"#063B49",light:"#D6ECF2",hcDark:Color.black,hcLight:Color.white},localize("inputValidationInfoBackground","Input validation background color for information severity.")),inputValidationInfoForeground=registerColor("inputValidation.infoForeground",{dark:null,light:null,hcDark:null,hcLight:foreground},localize("inputValidationInfoForeground","Input validation foreground color for information severity.")),inputValidationInfoBorder=registerColor("inputValidation.infoBorder",{dark:"#007acc",light:"#007acc",hcDark:contrastBorder,hcLight:contrastBorder},localize("inputValidationInfoBorder","Input validation border color for information severity.")),inputValidationWarningBackground=registerColor("inputValidation.warningBackground",{dark:"#352A05",light:"#F6F5D2",hcDark:Color.black,hcLight:Color.white},localize("inputValidationWarningBackground","Input validation background color for warning severity.")),inputValidationWarningForeground=registerColor("inputValidation.warningForeground",{dark:null,light:null,hcDark:null,hcLight:foreground},localize("inputValidationWarningForeground","Input validation foreground color for warning severity.")),inputValidationWarningBorder=registerColor("inputValidation.warningBorder",{dark:"#B89500",light:"#B89500",hcDark:contrastBorder,hcLight:contrastBorder},localize("inputValidationWarningBorder","Input validation border color for warning severity.")),inputValidationErrorBackground=registerColor("inputValidation.errorBackground",{dark:"#5A1D1D",light:"#F2DEDE",hcDark:Color.black,hcLight:Color.white},localize("inputValidationErrorBackground","Input validation background color for error severity.")),inputValidationErrorForeground=registerColor("inputValidation.errorForeground",{dark:null,light:null,hcDark:null,hcLight:foreground},localize("inputValidationErrorForeground","Input validation foreground color for error severity.")),inputValidationErrorBorder=registerColor("inputValidation.errorBorder",{dark:"#BE1100",light:"#BE1100",hcDark:contrastBorder,hcLight:contrastBorder},localize("inputValidationErrorBorder","Input validation border color for error severity.")),selectBackground=registerColor("dropdown.background",{dark:"#3C3C3C",light:Color.white,hcDark:Color.black,hcLight:Color.white},localize("dropdownBackground","Dropdown background.")),selectListBackground=registerColor("dropdown.listBackground",{dark:null,light:null,hcDark:Color.black,hcLight:Color.white},localize("dropdownListBackground","Dropdown list background.")),selectForeground=registerColor("dropdown.foreground",{dark:"#F0F0F0",light:foreground,hcDark:Color.white,hcLight:foreground},localize("dropdownForeground","Dropdown foreground.")),selectBorder=registerColor("dropdown.border",{dark:selectBackground,light:"#CECECE",hcDark:contrastBorder,hcLight:contrastBorder},localize("dropdownBorder","Dropdown border.")),buttonForeground=registerColor("button.foreground",{dark:Color.white,light:Color.white,hcDark:Color.white,hcLight:Color.white},localize("buttonForeground","Button foreground color.")),buttonSeparator=registerColor("button.separator",{dark:transparent(buttonForeground,.4),light:transparent(buttonForeground,.4),hcDark:transparent(buttonForeground,.4),hcLight:transparent(buttonForeground,.4)},localize("buttonSeparator","Button separator color.")),buttonBackground=registerColor("button.background",{dark:"#0E639C",light:"#007ACC",hcDark:null,hcLight:"#0F4A85"},localize("buttonBackground","Button background color.")),buttonHoverBackground=registerColor("button.hoverBackground",{dark:lighten(buttonBackground,.2),light:darken(buttonBackground,.2),hcDark:buttonBackground,hcLight:buttonBackground},localize("buttonHoverBackground","Button background color when hovering.")),buttonBorder=registerColor("button.border",{dark:contrastBorder,light:contrastBorder,hcDark:contrastBorder,hcLight:contrastBorder},localize("buttonBorder","Button border color.")),buttonSecondaryForeground=registerColor("button.secondaryForeground",{dark:Color.white,light:Color.white,hcDark:Color.white,hcLight:foreground},localize("buttonSecondaryForeground","Secondary button foreground color.")),buttonSecondaryBackground=registerColor("button.secondaryBackground",{dark:"#3A3D41",light:"#5F6A79",hcDark:null,hcLight:Color.white},localize("buttonSecondaryBackground","Secondary button background color.")),buttonSecondaryHoverBackground=registerColor("button.secondaryHoverBackground",{dark:lighten(buttonSecondaryBackground,.2),light:darken(buttonSecondaryBackground,.2),hcDark:null,hcLight:null},localize("buttonSecondaryHoverBackground","Secondary button background color when hovering.")),badgeBackground=registerColor("badge.background",{dark:"#4D4D4D",light:"#C4C4C4",hcDark:Color.black,hcLight:"#0F4A85"},localize("badgeBackground","Badge background color. Badges are small information labels, e.g. for search results count.")),badgeForeground=registerColor("badge.foreground",{dark:Color.white,light:"#333",hcDark:Color.white,hcLight:Color.white},localize("badgeForeground","Badge foreground color. Badges are small information labels, e.g. for search results count.")),scrollbarShadow=registerColor("scrollbar.shadow",{dark:"#000000",light:"#DDDDDD",hcDark:null,hcLight:null},localize("scrollbarShadow","Scrollbar shadow to indicate that the view is scrolled.")),scrollbarSliderBackground=registerColor("scrollbarSlider.background",{dark:Color.fromHex("#797979").transparent(.4),light:Color.fromHex("#646464").transparent(.4),hcDark:transparent(contrastBorder,.6),hcLight:transparent(contrastBorder,.4)},localize("scrollbarSliderBackground","Scrollbar slider background color.")),scrollbarSliderHoverBackground=registerColor("scrollbarSlider.hoverBackground",{dark:Color.fromHex("#646464").transparent(.7),light:Color.fromHex("#646464").transparent(.7),hcDark:transparent(contrastBorder,.8),hcLight:transparent(contrastBorder,.8)},localize("scrollbarSliderHoverBackground","Scrollbar slider background color when hovering.")),scrollbarSliderActiveBackground=registerColor("scrollbarSlider.activeBackground",{dark:Color.fromHex("#BFBFBF").transparent(.4),light:Color.fromHex("#000000").transparent(.6),hcDark:contrastBorder,hcLight:contrastBorder},localize("scrollbarSliderActiveBackground","Scrollbar slider background color when clicked on.")),progressBarBackground=registerColor("progressBar.background",{dark:Color.fromHex("#0E70C0"),light:Color.fromHex("#0E70C0"),hcDark:contrastBorder,hcLight:contrastBorder},localize("progressBarBackground","Background color of the progress bar that can show for long running operations."));registerColor("editorError.background",{dark:null,light:null,hcDark:null,hcLight:null},localize("editorError.background","Background color of error text in the editor. The color must not be opaque so as not to hide underlying decorations."),!0);const editorErrorForeground=registerColor("editorError.foreground",{dark:"#F14C4C",light:"#E51400",hcDark:"#F48771",hcLight:"#B5200D"},localize("editorError.foreground","Foreground color of error squigglies in the editor.")),editorErrorBorder=registerColor("editorError.border",{dark:null,light:null,hcDark:Color.fromHex("#E47777").transparent(.8),hcLight:"#B5200D"},localize("errorBorder","If set, color of double underlines for errors in the editor."));registerColor("editorWarning.background",{dark:null,light:null,hcDark:null,hcLight:null},localize("editorWarning.background","Background color of warning text in the editor. The color must not be opaque so as not to hide underlying decorations."),!0);const editorWarningForeground=registerColor("editorWarning.foreground",{dark:"#CCA700",light:"#BF8803",hcDark:"#FFD370",hcLight:"#895503"},localize("editorWarning.foreground","Foreground color of warning squigglies in the editor.")),editorWarningBorder=registerColor("editorWarning.border",{dark:null,light:null,hcDark:Color.fromHex("#FFCC00").transparent(.8),hcLight:Color.fromHex("#FFCC00").transparent(.8)},localize("warningBorder","If set, color of double underlines for warnings in the editor."));registerColor("editorInfo.background",{dark:null,light:null,hcDark:null,hcLight:null},localize("editorInfo.background","Background color of info text in the editor. The color must not be opaque so as not to hide underlying decorations."),!0);const editorInfoForeground=registerColor("editorInfo.foreground",{dark:"#3794FF",light:"#1a85ff",hcDark:"#3794FF",hcLight:"#1a85ff"},localize("editorInfo.foreground","Foreground color of info squigglies in the editor.")),editorInfoBorder=registerColor("editorInfo.border",{dark:null,light:null,hcDark:Color.fromHex("#3794FF").transparent(.8),hcLight:"#292929"},localize("infoBorder","If set, color of double underlines for infos in the editor.")),editorHintForeground=registerColor("editorHint.foreground",{dark:Color.fromHex("#eeeeee").transparent(.7),light:"#6c6c6c",hcDark:null,hcLight:null},localize("editorHint.foreground","Foreground color of hint squigglies in the editor."));registerColor("editorHint.border",{dark:null,light:null,hcDark:Color.fromHex("#eeeeee").transparent(.8),hcLight:"#292929"},localize("hintBorder","If set, color of double underlines for hints in the editor."));registerColor("sash.hoverBorder",{dark:focusBorder,light:focusBorder,hcDark:focusBorder,hcLight:focusBorder},localize("sashActiveBorder","Border color of active sashes."));const editorBackground=registerColor("editor.background",{light:"#ffffff",dark:"#1E1E1E",hcDark:Color.black,hcLight:Color.white},localize("editorBackground","Editor background color.")),editorForeground=registerColor("editor.foreground",{light:"#333333",dark:"#BBBBBB",hcDark:Color.white,hcLight:foreground},localize("editorForeground","Editor default foreground color."));registerColor("editorStickyScroll.background",{light:editorBackground,dark:editorBackground,hcDark:editorBackground,hcLight:editorBackground},localize("editorStickyScrollBackground","Sticky scroll background color for the editor"));registerColor("editorStickyScrollHover.background",{dark:"#2A2D2E",light:"#F0F0F0",hcDark:null,hcLight:Color.fromHex("#0F4A85").transparent(.1)},localize("editorStickyScrollHoverBackground","Sticky scroll on hover background color for the editor"));const editorWidgetBackground=registerColor("editorWidget.background",{dark:"#252526",light:"#F3F3F3",hcDark:"#0C141F",hcLight:Color.white},localize("editorWidgetBackground","Background color of editor widgets, such as find/replace.")),editorWidgetForeground=registerColor("editorWidget.foreground",{dark:foreground,light:foreground,hcDark:foreground,hcLight:foreground},localize("editorWidgetForeground","Foreground color of editor widgets, such as find/replace.")),editorWidgetBorder=registerColor("editorWidget.border",{dark:"#454545",light:"#C8C8C8",hcDark:contrastBorder,hcLight:contrastBorder},localize("editorWidgetBorder","Border color of editor widgets. The color is only used if the widget chooses to have a border and if the color is not overridden by a widget.")),editorWidgetResizeBorder=registerColor("editorWidget.resizeBorder",{light:null,dark:null,hcDark:null,hcLight:null},localize("editorWidgetResizeBorder","Border color of the resize bar of editor widgets. The color is only used if the widget chooses to have a resize border and if the color is not overridden by a widget.")),quickInputBackground=registerColor("quickInput.background",{dark:editorWidgetBackground,light:editorWidgetBackground,hcDark:editorWidgetBackground,hcLight:editorWidgetBackground},localize("pickerBackground","Quick picker background color. The quick picker widget is the container for pickers like the command palette.")),quickInputForeground=registerColor("quickInput.foreground",{dark:editorWidgetForeground,light:editorWidgetForeground,hcDark:editorWidgetForeground,hcLight:editorWidgetForeground},localize("pickerForeground","Quick picker foreground color. The quick picker widget is the container for pickers like the command palette.")),quickInputTitleBackground=registerColor("quickInputTitle.background",{dark:new Color(new RGBA(255,255,255,.105)),light:new Color(new RGBA(0,0,0,.06)),hcDark:"#000000",hcLight:Color.white},localize("pickerTitleBackground","Quick picker title background color. The quick picker widget is the container for pickers like the command palette.")),pickerGroupForeground=registerColor("pickerGroup.foreground",{dark:"#3794FF",light:"#0066BF",hcDark:Color.white,hcLight:"#0F4A85"},localize("pickerGroupForeground","Quick picker color for grouping labels.")),pickerGroupBorder=registerColor("pickerGroup.border",{dark:"#3F3F46",light:"#CCCEDB",hcDark:Color.white,hcLight:"#0F4A85"},localize("pickerGroupBorder","Quick picker color for grouping borders.")),keybindingLabelBackground=registerColor("keybindingLabel.background",{dark:new Color(new RGBA(128,128,128,.17)),light:new Color(new RGBA(221,221,221,.4)),hcDark:Color.transparent,hcLight:Color.transparent},localize("keybindingLabelBackground","Keybinding label background color. The keybinding label is used to represent a keyboard shortcut.")),keybindingLabelForeground=registerColor("keybindingLabel.foreground",{dark:Color.fromHex("#CCCCCC"),light:Color.fromHex("#555555"),hcDark:Color.white,hcLight:foreground},localize("keybindingLabelForeground","Keybinding label foreground color. The keybinding label is used to represent a keyboard shortcut.")),keybindingLabelBorder=registerColor("keybindingLabel.border",{dark:new Color(new RGBA(51,51,51,.6)),light:new Color(new RGBA(204,204,204,.4)),hcDark:new Color(new RGBA(111,195,223)),hcLight:contrastBorder},localize("keybindingLabelBorder","Keybinding label border color. The keybinding label is used to represent a keyboard shortcut.")),keybindingLabelBottomBorder=registerColor("keybindingLabel.bottomBorder",{dark:new Color(new RGBA(68,68,68,.6)),light:new Color(new RGBA(187,187,187,.4)),hcDark:new Color(new RGBA(111,195,223)),hcLight:foreground},localize("keybindingLabelBottomBorder","Keybinding label border bottom color. The keybinding label is used to represent a keyboard shortcut.")),editorSelectionBackground=registerColor("editor.selectionBackground",{light:"#ADD6FF",dark:"#264F78",hcDark:"#f3f518",hcLight:"#0F4A85"},localize("editorSelectionBackground","Color of the editor selection.")),editorSelectionForeground=registerColor("editor.selectionForeground",{light:null,dark:null,hcDark:"#000000",hcLight:Color.white},localize("editorSelectionForeground","Color of the selected text for high contrast.")),editorInactiveSelection=registerColor("editor.inactiveSelectionBackground",{light:transparent(editorSelectionBackground,.5),dark:transparent(editorSelectionBackground,.5),hcDark:transparent(editorSelectionBackground,.7),hcLight:transparent(editorSelectionBackground,.5)},localize("editorInactiveSelection","Color of the selection in an inactive editor. The color must not be opaque so as not to hide underlying decorations."),!0),editorSelectionHighlight=registerColor("editor.selectionHighlightBackground",{light:lessProminent(editorSelectionBackground,editorBackground,.3,.6),dark:lessProminent(editorSelectionBackground,editorBackground,.3,.6),hcDark:null,hcLight:null},localize("editorSelectionHighlight","Color for regions with the same content as the selection. The color must not be opaque so as not to hide underlying decorations."),!0);registerColor("editor.selectionHighlightBorder",{light:null,dark:null,hcDark:activeContrastBorder,hcLight:activeContrastBorder},localize("editorSelectionHighlightBorder","Border color for regions with the same content as the selection."));const editorFindMatch=registerColor("editor.findMatchBackground",{light:"#A8AC94",dark:"#515C6A",hcDark:null,hcLight:null},localize("editorFindMatch","Color of the current search match.")),editorFindMatchHighlight=registerColor("editor.findMatchHighlightBackground",{light:"#EA5C0055",dark:"#EA5C0055",hcDark:null,hcLight:null},localize("findMatchHighlight","Color of the other search matches. The color must not be opaque so as not to hide underlying decorations."),!0),editorFindRangeHighlight=registerColor("editor.findRangeHighlightBackground",{dark:"#3a3d4166",light:"#b4b4b44d",hcDark:null,hcLight:null},localize("findRangeHighlight","Color of the range limiting the search. The color must not be opaque so as not to hide underlying decorations."),!0),editorFindMatchBorder=registerColor("editor.findMatchBorder",{light:null,dark:null,hcDark:activeContrastBorder,hcLight:activeContrastBorder},localize("editorFindMatchBorder","Border color of the current search match.")),editorFindMatchHighlightBorder=registerColor("editor.findMatchHighlightBorder",{light:null,dark:null,hcDark:activeContrastBorder,hcLight:activeContrastBorder},localize("findMatchHighlightBorder","Border color of the other search matches.")),editorFindRangeHighlightBorder=registerColor("editor.findRangeHighlightBorder",{dark:null,light:null,hcDark:transparent(activeContrastBorder,.4),hcLight:transparent(activeContrastBorder,.4)},localize("findRangeHighlightBorder","Border color of the range limiting the search. The color must not be opaque so as not to hide underlying decorations."),!0);registerColor("searchEditor.findMatchBackground",{light:transparent(editorFindMatchHighlight,.66),dark:transparent(editorFindMatchHighlight,.66),hcDark:editorFindMatchHighlight,hcLight:editorFindMatchHighlight},localize("searchEditor.queryMatch","Color of the Search Editor query matches."));registerColor("searchEditor.findMatchBorder",{light:transparent(editorFindMatchHighlightBorder,.66),dark:transparent(editorFindMatchHighlightBorder,.66),hcDark:editorFindMatchHighlightBorder,hcLight:editorFindMatchHighlightBorder},localize("searchEditor.editorFindMatchBorder","Border color of the Search Editor query matches."));registerColor("search.resultsInfoForeground",{light:foreground,dark:transparent(foreground,.65),hcDark:foreground,hcLight:foreground},localize("search.resultsInfoForeground","Color of the text in the search viewlet's completion message."));registerColor("editor.hoverHighlightBackground",{light:"#ADD6FF26",dark:"#264f7840",hcDark:"#ADD6FF26",hcLight:null},localize("hoverHighlight","Highlight below the word for which a hover is shown. The color must not be opaque so as not to hide underlying decorations."),!0);const editorHoverBackground=registerColor("editorHoverWidget.background",{light:editorWidgetBackground,dark:editorWidgetBackground,hcDark:editorWidgetBackground,hcLight:editorWidgetBackground},localize("hoverBackground","Background color of the editor hover."));registerColor("editorHoverWidget.foreground",{light:editorWidgetForeground,dark:editorWidgetForeground,hcDark:editorWidgetForeground,hcLight:editorWidgetForeground},localize("hoverForeground","Foreground color of the editor hover."));const editorHoverBorder=registerColor("editorHoverWidget.border",{light:editorWidgetBorder,dark:editorWidgetBorder,hcDark:editorWidgetBorder,hcLight:editorWidgetBorder},localize("hoverBorder","Border color of the editor hover."));registerColor("editorHoverWidget.statusBarBackground",{dark:lighten(editorHoverBackground,.2),light:darken(editorHoverBackground,.05),hcDark:editorWidgetBackground,hcLight:editorWidgetBackground},localize("statusBarBackground","Background color of the editor hover status bar."));const editorActiveLinkForeground=registerColor("editorLink.activeForeground",{dark:"#4E94CE",light:Color.blue,hcDark:Color.cyan,hcLight:"#292929"},localize("activeLinkForeground","Color of active links.")),editorInlayHintForeground=registerColor("editorInlayHint.foreground",{dark:"#969696",light:"#969696",hcDark:Color.white,hcLight:Color.black},localize("editorInlayHintForeground","Foreground color of inline hints")),editorInlayHintBackground=registerColor("editorInlayHint.background",{dark:transparent(badgeBackground,.1),light:transparent(badgeBackground,.1),hcDark:transparent(Color.white,.1),hcLight:transparent(badgeBackground,.1)},localize("editorInlayHintBackground","Background color of inline hints")),editorInlayHintTypeForeground=registerColor("editorInlayHint.typeForeground",{dark:editorInlayHintForeground,light:editorInlayHintForeground,hcDark:editorInlayHintForeground,hcLight:editorInlayHintForeground},localize("editorInlayHintForegroundTypes","Foreground color of inline hints for types")),editorInlayHintTypeBackground=registerColor("editorInlayHint.typeBackground",{dark:editorInlayHintBackground,light:editorInlayHintBackground,hcDark:editorInlayHintBackground,hcLight:editorInlayHintBackground},localize("editorInlayHintBackgroundTypes","Background color of inline hints for types")),editorInlayHintParameterForeground=registerColor("editorInlayHint.parameterForeground",{dark:editorInlayHintForeground,light:editorInlayHintForeground,hcDark:editorInlayHintForeground,hcLight:editorInlayHintForeground},localize("editorInlayHintForegroundParameter","Foreground color of inline hints for parameters")),editorInlayHintParameterBackground=registerColor("editorInlayHint.parameterBackground",{dark:editorInlayHintBackground,light:editorInlayHintBackground,hcDark:editorInlayHintBackground,hcLight:editorInlayHintBackground},localize("editorInlayHintBackgroundParameter","Background color of inline hints for parameters"));registerColor("editorLightBulb.foreground",{dark:"#FFCC00",light:"#DDB100",hcDark:"#FFCC00",hcLight:"#007ACC"},localize("editorLightBulbForeground","The color used for the lightbulb actions icon."));registerColor("editorLightBulbAutoFix.foreground",{dark:"#75BEFF",light:"#007ACC",hcDark:"#75BEFF",hcLight:"#007ACC"},localize("editorLightBulbAutoFixForeground","The color used for the lightbulb auto fix actions icon."));const defaultInsertColor=new Color(new RGBA(155,185,85,.2)),defaultRemoveColor=new Color(new RGBA(255,0,0,.2)),diffInserted=registerColor("diffEditor.insertedTextBackground",{dark:"#9ccc2c33",light:"#9ccc2c40",hcDark:null,hcLight:null},localize("diffEditorInserted","Background color for text that got inserted. The color must not be opaque so as not to hide underlying decorations."),!0),diffRemoved=registerColor("diffEditor.removedTextBackground",{dark:"#ff000033",light:"#ff000033",hcDark:null,hcLight:null},localize("diffEditorRemoved","Background color for text that got removed. The color must not be opaque so as not to hide underlying decorations."),!0);registerColor("diffEditor.insertedLineBackground",{dark:defaultInsertColor,light:defaultInsertColor,hcDark:null,hcLight:null},localize("diffEditorInsertedLines","Background color for lines that got inserted. The color must not be opaque so as not to hide underlying decorations."),!0);registerColor("diffEditor.removedLineBackground",{dark:defaultRemoveColor,light:defaultRemoveColor,hcDark:null,hcLight:null},localize("diffEditorRemovedLines","Background color for lines that got removed. The color must not be opaque so as not to hide underlying decorations."),!0);registerColor("diffEditorGutter.insertedLineBackground",{dark:null,light:null,hcDark:null,hcLight:null},localize("diffEditorInsertedLineGutter","Background color for the margin where lines got inserted."));registerColor("diffEditorGutter.removedLineBackground",{dark:null,light:null,hcDark:null,hcLight:null},localize("diffEditorRemovedLineGutter","Background color for the margin where lines got removed."));const diffOverviewRulerInserted=registerColor("diffEditorOverview.insertedForeground",{dark:null,light:null,hcDark:null,hcLight:null},localize("diffEditorOverviewInserted","Diff overview ruler foreground for inserted content.")),diffOverviewRulerRemoved=registerColor("diffEditorOverview.removedForeground",{dark:null,light:null,hcDark:null,hcLight:null},localize("diffEditorOverviewRemoved","Diff overview ruler foreground for removed content."));registerColor("diffEditor.insertedTextBorder",{dark:null,light:null,hcDark:"#33ff2eff",hcLight:"#374E06"},localize("diffEditorInsertedOutline","Outline color for the text that got inserted."));registerColor("diffEditor.removedTextBorder",{dark:null,light:null,hcDark:"#FF008F",hcLight:"#AD0707"},localize("diffEditorRemovedOutline","Outline color for text that got removed."));registerColor("diffEditor.border",{dark:null,light:null,hcDark:contrastBorder,hcLight:contrastBorder},localize("diffEditorBorder","Border color between the two text editors."));registerColor("diffEditor.diagonalFill",{dark:"#cccccc33",light:"#22222233",hcDark:null,hcLight:null},localize("diffDiagonalFill","Color of the diff editor's diagonal fill. The diagonal fill is used in side-by-side diff views."));registerColor("diffEditor.unchangedRegionBackground",{dark:"#3e3e3e",light:"#e4e4e4",hcDark:null,hcLight:null},localize("diffEditor.unchangedRegionBackground","The background color of unchanged blocks in the diff editor."));registerColor("diffEditor.unchangedRegionForeground",{dark:"#a3a2a2",light:"#4d4c4c",hcDark:null,hcLight:null},localize("diffEditor.unchangedRegionForeground","The foreground color of unchanged blocks in the diff editor."));registerColor("diffEditor.unchangedCodeBackground",{dark:"#74747429",light:"#b8b8b829",hcDark:null,hcLight:null},localize("diffEditor.unchangedCodeBackground","The background color of unchanged code in the diff editor."));const listFocusBackground=registerColor("list.focusBackground",{dark:null,light:null,hcDark:null,hcLight:null},localize("listFocusBackground","List/Tree background color for the focused item when the list/tree is active. An active list/tree has keyboard focus, an inactive does not.")),listFocusForeground=registerColor("list.focusForeground",{dark:null,light:null,hcDark:null,hcLight:null},localize("listFocusForeground","List/Tree foreground color for the focused item when the list/tree is active. An active list/tree has keyboard focus, an inactive does not.")),listFocusOutline=registerColor("list.focusOutline",{dark:focusBorder,light:focusBorder,hcDark:activeContrastBorder,hcLight:activeContrastBorder},localize("listFocusOutline","List/Tree outline color for the focused item when the list/tree is active. An active list/tree has keyboard focus, an inactive does not.")),listFocusAndSelectionOutline=registerColor("list.focusAndSelectionOutline",{dark:null,light:null,hcDark:null,hcLight:null},localize("listFocusAndSelectionOutline","List/Tree outline color for the focused item when the list/tree is active and selected. An active list/tree has keyboard focus, an inactive does not.")),listActiveSelectionBackground=registerColor("list.activeSelectionBackground",{dark:"#04395E",light:"#0060C0",hcDark:null,hcLight:Color.fromHex("#0F4A85").transparent(.1)},localize("listActiveSelectionBackground","List/Tree background color for the selected item when the list/tree is active. An active list/tree has keyboard focus, an inactive does not.")),listActiveSelectionForeground=registerColor("list.activeSelectionForeground",{dark:Color.white,light:Color.white,hcDark:null,hcLight:null},localize("listActiveSelectionForeground","List/Tree foreground color for the selected item when the list/tree is active. An active list/tree has keyboard focus, an inactive does not.")),listActiveSelectionIconForeground=registerColor("list.activeSelectionIconForeground",{dark:null,light:null,hcDark:null,hcLight:null},localize("listActiveSelectionIconForeground","List/Tree icon foreground color for the selected item when the list/tree is active. An active list/tree has keyboard focus, an inactive does not.")),listInactiveSelectionBackground=registerColor("list.inactiveSelectionBackground",{dark:"#37373D",light:"#E4E6F1",hcDark:null,hcLight:Color.fromHex("#0F4A85").transparent(.1)},localize("listInactiveSelectionBackground","List/Tree background color for the selected item when the list/tree is inactive. An active list/tree has keyboard focus, an inactive does not.")),listInactiveSelectionForeground=registerColor("list.inactiveSelectionForeground",{dark:null,light:null,hcDark:null,hcLight:null},localize("listInactiveSelectionForeground","List/Tree foreground color for the selected item when the list/tree is inactive. An active list/tree has keyboard focus, an inactive does not.")),listInactiveSelectionIconForeground=registerColor("list.inactiveSelectionIconForeground",{dark:null,light:null,hcDark:null,hcLight:null},localize("listInactiveSelectionIconForeground","List/Tree icon foreground color for the selected item when the list/tree is inactive. An active list/tree has keyboard focus, an inactive does not.")),listInactiveFocusBackground=registerColor("list.inactiveFocusBackground",{dark:null,light:null,hcDark:null,hcLight:null},localize("listInactiveFocusBackground","List/Tree background color for the focused item when the list/tree is inactive. An active list/tree has keyboard focus, an inactive does not.")),listInactiveFocusOutline=registerColor("list.inactiveFocusOutline",{dark:null,light:null,hcDark:null,hcLight:null},localize("listInactiveFocusOutline","List/Tree outline color for the focused item when the list/tree is inactive. An active list/tree has keyboard focus, an inactive does not.")),listHoverBackground=registerColor("list.hoverBackground",{dark:"#2A2D2E",light:"#F0F0F0",hcDark:Color.white.transparent(.1),hcLight:Color.fromHex("#0F4A85").transparent(.1)},localize("listHoverBackground","List/Tree background when hovering over items using the mouse.")),listHoverForeground=registerColor("list.hoverForeground",{dark:null,light:null,hcDark:null,hcLight:null},localize("listHoverForeground","List/Tree foreground when hovering over items using the mouse.")),listDropBackground=registerColor("list.dropBackground",{dark:"#062F4A",light:"#D6EBFF",hcDark:null,hcLight:null},localize("listDropBackground","List/Tree drag and drop background when moving items around using the mouse.")),listHighlightForeground=registerColor("list.highlightForeground",{dark:"#2AAAFF",light:"#0066BF",hcDark:focusBorder,hcLight:focusBorder},localize("highlight","List/Tree foreground color of the match highlights when searching inside the list/tree.")),listFocusHighlightForeground=registerColor("list.focusHighlightForeground",{dark:listHighlightForeground,light:ifDefinedThenElse(listActiveSelectionBackground,listHighlightForeground,"#BBE7FF"),hcDark:listHighlightForeground,hcLight:listHighlightForeground},localize("listFocusHighlightForeground","List/Tree foreground color of the match highlights on actively focused items when searching inside the list/tree."));registerColor("list.invalidItemForeground",{dark:"#B89500",light:"#B89500",hcDark:"#B89500",hcLight:"#B5200D"},localize("invalidItemForeground","List/Tree foreground color for invalid items, for example an unresolved root in explorer."));registerColor("list.errorForeground",{dark:"#F88070",light:"#B01011",hcDark:null,hcLight:null},localize("listErrorForeground","Foreground color of list items containing errors."));registerColor("list.warningForeground",{dark:"#CCA700",light:"#855F00",hcDark:null,hcLight:null},localize("listWarningForeground","Foreground color of list items containing warnings."));const listFilterWidgetBackground=registerColor("listFilterWidget.background",{light:darken(editorWidgetBackground,0),dark:lighten(editorWidgetBackground,0),hcDark:editorWidgetBackground,hcLight:editorWidgetBackground},localize("listFilterWidgetBackground","Background color of the type filter widget in lists and trees.")),listFilterWidgetOutline=registerColor("listFilterWidget.outline",{dark:Color.transparent,light:Color.transparent,hcDark:"#f38518",hcLight:"#007ACC"},localize("listFilterWidgetOutline","Outline color of the type filter widget in lists and trees.")),listFilterWidgetNoMatchesOutline=registerColor("listFilterWidget.noMatchesOutline",{dark:"#BE1100",light:"#BE1100",hcDark:contrastBorder,hcLight:contrastBorder},localize("listFilterWidgetNoMatchesOutline","Outline color of the type filter widget in lists and trees, when there are no matches.")),listFilterWidgetShadow=registerColor("listFilterWidget.shadow",{dark:widgetShadow,light:widgetShadow,hcDark:widgetShadow,hcLight:widgetShadow},localize("listFilterWidgetShadow","Shadow color of the type filter widget in lists and trees."));registerColor("list.filterMatchBackground",{dark:editorFindMatchHighlight,light:editorFindMatchHighlight,hcDark:null,hcLight:null},localize("listFilterMatchHighlight","Background color of the filtered match."));registerColor("list.filterMatchBorder",{dark:editorFindMatchHighlightBorder,light:editorFindMatchHighlightBorder,hcDark:contrastBorder,hcLight:activeContrastBorder},localize("listFilterMatchHighlightBorder","Border color of the filtered match."));const treeIndentGuidesStroke=registerColor("tree.indentGuidesStroke",{dark:"#585858",light:"#a9a9a9",hcDark:"#a9a9a9",hcLight:"#a5a5a5"},localize("treeIndentGuidesStroke","Tree stroke color for the indentation guides.")),treeInactiveIndentGuidesStroke=registerColor("tree.inactiveIndentGuidesStroke",{dark:transparent(treeIndentGuidesStroke,.4),light:transparent(treeIndentGuidesStroke,.4),hcDark:transparent(treeIndentGuidesStroke,.4),hcLight:transparent(treeIndentGuidesStroke,.4)},localize("treeInactiveIndentGuidesStroke","Tree stroke color for the indentation guides that are not active.")),tableColumnsBorder=registerColor("tree.tableColumnsBorder",{dark:"#CCCCCC20",light:"#61616120",hcDark:null,hcLight:null},localize("tableColumnsBorder","Table border color between columns.")),tableOddRowsBackgroundColor=registerColor("tree.tableOddRowsBackground",{dark:transparent(foreground,.04),light:transparent(foreground,.04),hcDark:null,hcLight:null},localize("tableOddRowsBackgroundColor","Background color for odd table rows."));registerColor("list.deemphasizedForeground",{dark:"#8C8C8C",light:"#8E8E90",hcDark:"#A7A8A9",hcLight:"#666666"},localize("listDeemphasizedForeground","List/Tree foreground color for items that are deemphasized. "));const checkboxBackground=registerColor("checkbox.background",{dark:selectBackground,light:selectBackground,hcDark:selectBackground,hcLight:selectBackground},localize("checkbox.background","Background color of checkbox widget."));registerColor("checkbox.selectBackground",{dark:editorWidgetBackground,light:editorWidgetBackground,hcDark:editorWidgetBackground,hcLight:editorWidgetBackground},localize("checkbox.select.background","Background color of checkbox widget when the element it's in is selected."));const checkboxForeground=registerColor("checkbox.foreground",{dark:selectForeground,light:selectForeground,hcDark:selectForeground,hcLight:selectForeground},localize("checkbox.foreground","Foreground color of checkbox widget.")),checkboxBorder=registerColor("checkbox.border",{dark:selectBorder,light:selectBorder,hcDark:selectBorder,hcLight:selectBorder},localize("checkbox.border","Border color of checkbox widget."));registerColor("checkbox.selectBorder",{dark:iconForeground,light:iconForeground,hcDark:iconForeground,hcLight:iconForeground},localize("checkbox.select.border","Border color of checkbox widget when the element it's in is selected."));const _deprecatedQuickInputListFocusBackground=registerColor("quickInput.list.focusBackground",{dark:null,light:null,hcDark:null,hcLight:null},"",void 0,localize("quickInput.list.focusBackground deprecation","Please use quickInputList.focusBackground instead")),quickInputListFocusForeground=registerColor("quickInputList.focusForeground",{dark:listActiveSelectionForeground,light:listActiveSelectionForeground,hcDark:listActiveSelectionForeground,hcLight:listActiveSelectionForeground},localize("quickInput.listFocusForeground","Quick picker foreground color for the focused item.")),quickInputListFocusIconForeground=registerColor("quickInputList.focusIconForeground",{dark:listActiveSelectionIconForeground,light:listActiveSelectionIconForeground,hcDark:listActiveSelectionIconForeground,hcLight:listActiveSelectionIconForeground},localize("quickInput.listFocusIconForeground","Quick picker icon foreground color for the focused item.")),quickInputListFocusBackground=registerColor("quickInputList.focusBackground",{dark:oneOf$1(_deprecatedQuickInputListFocusBackground,listActiveSelectionBackground),light:oneOf$1(_deprecatedQuickInputListFocusBackground,listActiveSelectionBackground),hcDark:null,hcLight:null},localize("quickInput.listFocusBackground","Quick picker background color for the focused item.")),menuBorder=registerColor("menu.border",{dark:null,light:null,hcDark:contrastBorder,hcLight:contrastBorder},localize("menuBorder","Border color of menus.")),menuForeground=registerColor("menu.foreground",{dark:selectForeground,light:selectForeground,hcDark:selectForeground,hcLight:selectForeground},localize("menuForeground","Foreground color of menu items.")),menuBackground=registerColor("menu.background",{dark:selectBackground,light:selectBackground,hcDark:selectBackground,hcLight:selectBackground},localize("menuBackground","Background color of menu items.")),menuSelectionForeground=registerColor("menu.selectionForeground",{dark:listActiveSelectionForeground,light:listActiveSelectionForeground,hcDark:listActiveSelectionForeground,hcLight:listActiveSelectionForeground},localize("menuSelectionForeground","Foreground color of the selected menu item in menus.")),menuSelectionBackground=registerColor("menu.selectionBackground",{dark:listActiveSelectionBackground,light:listActiveSelectionBackground,hcDark:listActiveSelectionBackground,hcLight:listActiveSelectionBackground},localize("menuSelectionBackground","Background color of the selected menu item in menus.")),menuSelectionBorder=registerColor("menu.selectionBorder",{dark:null,light:null,hcDark:activeContrastBorder,hcLight:activeContrastBorder},localize("menuSelectionBorder","Border color of the selected menu item in menus.")),menuSeparatorBackground=registerColor("menu.separatorBackground",{dark:"#606060",light:"#D4D4D4",hcDark:contrastBorder,hcLight:contrastBorder},localize("menuSeparatorBackground","Color of a separator menu item in menus.")),toolbarHoverBackground=registerColor("toolbar.hoverBackground",{dark:"#5a5d5e50",light:"#b8b8b850",hcDark:null,hcLight:null},localize("toolbarHoverBackground","Toolbar background when hovering over actions using the mouse"));registerColor("toolbar.hoverOutline",{dark:null,light:null,hcDark:activeContrastBorder,hcLight:activeContrastBorder},localize("toolbarHoverOutline","Toolbar outline when hovering over actions using the mouse"));registerColor("toolbar.activeBackground",{dark:lighten(toolbarHoverBackground,.1),light:darken(toolbarHoverBackground,.1),hcDark:null,hcLight:null},localize("toolbarActiveBackground","Toolbar background when holding the mouse over actions"));registerColor("editor.snippetTabstopHighlightBackground",{dark:new Color(new RGBA(124,124,124,.3)),light:new Color(new RGBA(10,50,100,.2)),hcDark:new Color(new RGBA(124,124,124,.3)),hcLight:new Color(new RGBA(10,50,100,.2))},localize("snippetTabstopHighlightBackground","Highlight background color of a snippet tabstop."));registerColor("editor.snippetTabstopHighlightBorder",{dark:null,light:null,hcDark:null,hcLight:null},localize("snippetTabstopHighlightBorder","Highlight border color of a snippet tabstop."));registerColor("editor.snippetFinalTabstopHighlightBackground",{dark:null,light:null,hcDark:null,hcLight:null},localize("snippetFinalTabstopHighlightBackground","Highlight background color of the final tabstop of a snippet."));registerColor("editor.snippetFinalTabstopHighlightBorder",{dark:"#525252",light:new Color(new RGBA(10,50,100,.5)),hcDark:"#525252",hcLight:"#292929"},localize("snippetFinalTabstopHighlightBorder","Highlight border color of the final tabstop of a snippet."));const breadcrumbsForeground=registerColor("breadcrumb.foreground",{light:transparent(foreground,.8),dark:transparent(foreground,.8),hcDark:transparent(foreground,.8),hcLight:transparent(foreground,.8)},localize("breadcrumbsFocusForeground","Color of focused breadcrumb items.")),breadcrumbsBackground=registerColor("breadcrumb.background",{light:editorBackground,dark:editorBackground,hcDark:editorBackground,hcLight:editorBackground},localize("breadcrumbsBackground","Background color of breadcrumb items.")),breadcrumbsFocusForeground=registerColor("breadcrumb.focusForeground",{light:darken(foreground,.2),dark:lighten(foreground,.1),hcDark:lighten(foreground,.1),hcLight:lighten(foreground,.1)},localize("breadcrumbsFocusForeground","Color of focused breadcrumb items.")),breadcrumbsActiveSelectionForeground=registerColor("breadcrumb.activeSelectionForeground",{light:darken(foreground,.2),dark:lighten(foreground,.1),hcDark:lighten(foreground,.1),hcLight:lighten(foreground,.1)},localize("breadcrumbsSelectedForeground","Color of selected breadcrumb items."));registerColor("breadcrumbPicker.background",{light:editorWidgetBackground,dark:editorWidgetBackground,hcDark:editorWidgetBackground,hcLight:editorWidgetBackground},localize("breadcrumbsSelectedBackground","Background color of breadcrumb item picker."));const headerTransparency=.5,currentBaseColor=Color.fromHex("#40C8AE").transparent(headerTransparency),incomingBaseColor=Color.fromHex("#40A6FF").transparent(headerTransparency),commonBaseColor=Color.fromHex("#606060").transparent(.4),contentTransparency=.4,rulerTransparency=1,mergeCurrentHeaderBackground=registerColor("merge.currentHeaderBackground",{dark:currentBaseColor,light:currentBaseColor,hcDark:null,hcLight:null},localize("mergeCurrentHeaderBackground","Current header background in inline merge-conflicts. The color must not be opaque so as not to hide underlying decorations."),!0);registerColor("merge.currentContentBackground",{dark:transparent(mergeCurrentHeaderBackground,contentTransparency),light:transparent(mergeCurrentHeaderBackground,contentTransparency),hcDark:transparent(mergeCurrentHeaderBackground,contentTransparency),hcLight:transparent(mergeCurrentHeaderBackground,contentTransparency)},localize("mergeCurrentContentBackground","Current content background in inline merge-conflicts. The color must not be opaque so as not to hide underlying decorations."),!0);const mergeIncomingHeaderBackground=registerColor("merge.incomingHeaderBackground",{dark:incomingBaseColor,light:incomingBaseColor,hcDark:null,hcLight:null},localize("mergeIncomingHeaderBackground","Incoming header background in inline merge-conflicts. The color must not be opaque so as not to hide underlying decorations."),!0);registerColor("merge.incomingContentBackground",{dark:transparent(mergeIncomingHeaderBackground,contentTransparency),light:transparent(mergeIncomingHeaderBackground,contentTransparency),hcDark:transparent(mergeIncomingHeaderBackground,contentTransparency),hcLight:transparent(mergeIncomingHeaderBackground,contentTransparency)},localize("mergeIncomingContentBackground","Incoming content background in inline merge-conflicts. The color must not be opaque so as not to hide underlying decorations."),!0);const mergeCommonHeaderBackground=registerColor("merge.commonHeaderBackground",{dark:commonBaseColor,light:commonBaseColor,hcDark:null,hcLight:null},localize("mergeCommonHeaderBackground","Common ancestor header background in inline merge-conflicts. The color must not be opaque so as not to hide underlying decorations."),!0);registerColor("merge.commonContentBackground",{dark:transparent(mergeCommonHeaderBackground,contentTransparency),light:transparent(mergeCommonHeaderBackground,contentTransparency),hcDark:transparent(mergeCommonHeaderBackground,contentTransparency),hcLight:transparent(mergeCommonHeaderBackground,contentTransparency)},localize("mergeCommonContentBackground","Common ancestor content background in inline merge-conflicts. The color must not be opaque so as not to hide underlying decorations."),!0);const mergeBorder=registerColor("merge.border",{dark:null,light:null,hcDark:"#C3DF6F",hcLight:"#007ACC"},localize("mergeBorder","Border color on headers and the splitter in inline merge-conflicts."));registerColor("editorOverviewRuler.currentContentForeground",{dark:transparent(mergeCurrentHeaderBackground,rulerTransparency),light:transparent(mergeCurrentHeaderBackground,rulerTransparency),hcDark:mergeBorder,hcLight:mergeBorder},localize("overviewRulerCurrentContentForeground","Current overview ruler foreground for inline merge-conflicts."));registerColor("editorOverviewRuler.incomingContentForeground",{dark:transparent(mergeIncomingHeaderBackground,rulerTransparency),light:transparent(mergeIncomingHeaderBackground,rulerTransparency),hcDark:mergeBorder,hcLight:mergeBorder},localize("overviewRulerIncomingContentForeground","Incoming overview ruler foreground for inline merge-conflicts."));registerColor("editorOverviewRuler.commonContentForeground",{dark:transparent(mergeCommonHeaderBackground,rulerTransparency),light:transparent(mergeCommonHeaderBackground,rulerTransparency),hcDark:mergeBorder,hcLight:mergeBorder},localize("overviewRulerCommonContentForeground","Common ancestor overview ruler foreground for inline merge-conflicts."));const overviewRulerFindMatchForeground=registerColor("editorOverviewRuler.findMatchForeground",{dark:"#d186167e",light:"#d186167e",hcDark:"#AB5A00",hcLight:""},localize("overviewRulerFindMatchForeground","Overview ruler marker color for find matches. The color must not be opaque so as not to hide underlying decorations."),!0),overviewRulerSelectionHighlightForeground=registerColor("editorOverviewRuler.selectionHighlightForeground",{dark:"#A0A0A0CC",light:"#A0A0A0CC",hcDark:"#A0A0A0CC",hcLight:"#A0A0A0CC"},localize("overviewRulerSelectionHighlightForeground","Overview ruler marker color for selection highlights. The color must not be opaque so as not to hide underlying decorations."),!0),minimapFindMatch=registerColor("minimap.findMatchHighlight",{light:"#d18616",dark:"#d18616",hcDark:"#AB5A00",hcLight:"#0F4A85"},localize("minimapFindMatchHighlight","Minimap marker color for find matches."),!0),minimapSelectionOccurrenceHighlight=registerColor("minimap.selectionOccurrenceHighlight",{light:"#c9c9c9",dark:"#676767",hcDark:"#ffffff",hcLight:"#0F4A85"},localize("minimapSelectionOccurrenceHighlight","Minimap marker color for repeating editor selections."),!0),minimapSelection=registerColor("minimap.selectionHighlight",{light:"#ADD6FF",dark:"#264F78",hcDark:"#ffffff",hcLight:"#0F4A85"},localize("minimapSelectionHighlight","Minimap marker color for the editor selection."),!0),minimapInfo=registerColor("minimap.infoHighlight",{dark:editorInfoForeground,light:editorInfoForeground,hcDark:editorInfoBorder,hcLight:editorInfoBorder},localize("minimapInfo","Minimap marker color for infos.")),minimapWarning=registerColor("minimap.warningHighlight",{dark:editorWarningForeground,light:editorWarningForeground,hcDark:editorWarningBorder,hcLight:editorWarningBorder},localize("overviewRuleWarning","Minimap marker color for warnings.")),minimapError=registerColor("minimap.errorHighlight",{dark:new Color(new RGBA(255,18,18,.7)),light:new Color(new RGBA(255,18,18,.7)),hcDark:new Color(new RGBA(255,50,50,1)),hcLight:"#B5200D"},localize("minimapError","Minimap marker color for errors.")),minimapBackground=registerColor("minimap.background",{dark:null,light:null,hcDark:null,hcLight:null},localize("minimapBackground","Minimap background color.")),minimapForegroundOpacity=registerColor("minimap.foregroundOpacity",{dark:Color.fromHex("#000f"),light:Color.fromHex("#000f"),hcDark:Color.fromHex("#000f"),hcLight:Color.fromHex("#000f")},localize("minimapForegroundOpacity",'Opacity of foreground elements rendered in the minimap. For example, "#000000c0" will render the elements with 75% opacity.'));registerColor("minimapSlider.background",{light:transparent(scrollbarSliderBackground,.5),dark:transparent(scrollbarSliderBackground,.5),hcDark:transparent(scrollbarSliderBackground,.5),hcLight:transparent(scrollbarSliderBackground,.5)},localize("minimapSliderBackground","Minimap slider background color."));registerColor("minimapSlider.hoverBackground",{light:transparent(scrollbarSliderHoverBackground,.5),dark:transparent(scrollbarSliderHoverBackground,.5),hcDark:transparent(scrollbarSliderHoverBackground,.5),hcLight:transparent(scrollbarSliderHoverBackground,.5)},localize("minimapSliderHoverBackground","Minimap slider background color when hovering."));registerColor("minimapSlider.activeBackground",{light:transparent(scrollbarSliderActiveBackground,.5),dark:transparent(scrollbarSliderActiveBackground,.5),hcDark:transparent(scrollbarSliderActiveBackground,.5),hcLight:transparent(scrollbarSliderActiveBackground,.5)},localize("minimapSliderActiveBackground","Minimap slider background color when clicked on."));const problemsErrorIconForeground=registerColor("problemsErrorIcon.foreground",{dark:editorErrorForeground,light:editorErrorForeground,hcDark:editorErrorForeground,hcLight:editorErrorForeground},localize("problemsErrorIconForeground","The color used for the problems error icon.")),problemsWarningIconForeground=registerColor("problemsWarningIcon.foreground",{dark:editorWarningForeground,light:editorWarningForeground,hcDark:editorWarningForeground,hcLight:editorWarningForeground},localize("problemsWarningIconForeground","The color used for the problems warning icon.")),problemsInfoIconForeground=registerColor("problemsInfoIcon.foreground",{dark:editorInfoForeground,light:editorInfoForeground,hcDark:editorInfoForeground,hcLight:editorInfoForeground},localize("problemsInfoIconForeground","The color used for the problems info icon."));registerColor("charts.foreground",{dark:foreground,light:foreground,hcDark:foreground,hcLight:foreground},localize("chartsForeground","The foreground color used in charts."));registerColor("charts.lines",{dark:transparent(foreground,.5),light:transparent(foreground,.5),hcDark:transparent(foreground,.5),hcLight:transparent(foreground,.5)},localize("chartsLines","The color used for horizontal lines in charts."));registerColor("charts.red",{dark:editorErrorForeground,light:editorErrorForeground,hcDark:editorErrorForeground,hcLight:editorErrorForeground},localize("chartsRed","The red color used in chart visualizations."));registerColor("charts.blue",{dark:editorInfoForeground,light:editorInfoForeground,hcDark:editorInfoForeground,hcLight:editorInfoForeground},localize("chartsBlue","The blue color used in chart visualizations."));registerColor("charts.yellow",{dark:editorWarningForeground,light:editorWarningForeground,hcDark:editorWarningForeground,hcLight:editorWarningForeground},localize("chartsYellow","The yellow color used in chart visualizations."));registerColor("charts.orange",{dark:minimapFindMatch,light:minimapFindMatch,hcDark:minimapFindMatch,hcLight:minimapFindMatch},localize("chartsOrange","The orange color used in chart visualizations."));registerColor("charts.green",{dark:"#89D185",light:"#388A34",hcDark:"#89D185",hcLight:"#374e06"},localize("chartsGreen","The green color used in chart visualizations."));registerColor("charts.purple",{dark:"#B180D7",light:"#652D90",hcDark:"#B180D7",hcLight:"#652D90"},localize("chartsPurple","The purple color used in chart visualizations."));function executeTransform(K,C){var W,V,U,G;switch(K.op){case 0:return(W=resolveColorValue(K.value,C))===null||W===void 0?void 0:W.darken(K.factor);case 1:return(V=resolveColorValue(K.value,C))===null||V===void 0?void 0:V.lighten(K.factor);case 2:return(U=resolveColorValue(K.value,C))===null||U===void 0?void 0:U.transparent(K.factor);case 3:{const Z=resolveColorValue(K.background,C);return Z?(G=resolveColorValue(K.value,C))===null||G===void 0?void 0:G.makeOpaque(Z):resolveColorValue(K.value,C)}case 4:for(const Z of K.values){const X=resolveColorValue(Z,C);if(X)return X}return;case 6:return resolveColorValue(C.defines(K.if)?K.then:K.else,C);case 5:{const Z=resolveColorValue(K.value,C);if(!Z)return;const X=resolveColorValue(K.background,C);return X?Z.isDarkerThan(X)?Color.getLighterColor(Z,X,K.factor).transparent(K.transparency):Color.getDarkerColor(Z,X,K.factor).transparent(K.transparency):Z.transparent(K.factor*K.transparency)}default:throw assertNever()}}function darken(K,C){return{op:0,value:K,factor:C}}function lighten(K,C){return{op:1,value:K,factor:C}}function transparent(K,C){return{op:2,value:K,factor:C}}function oneOf$1(...K){return{op:4,values:K}}function ifDefinedThenElse(K,C,W){return{op:6,if:K,then:C,else:W}}function lessProminent(K,C,W,V){return{op:5,value:K,background:C,factor:W,transparency:V}}function resolveColorValue(K,C){if(K!==null){if(typeof K=="string")return K[0]==="#"?Color.fromHex(K):C.getColor(K);if(K instanceof Color)return K;if(typeof K=="object")return executeTransform(K,C)}}const workbenchColorsSchemaId="vscode://schemas/workbench-colors",schemaRegistry$1=Registry.as(Extensions$7.JSONContribution);schemaRegistry$1.registerSchema(workbenchColorsSchemaId,colorRegistry$1.getColorSchema());const delayer$1=new RunOnceScheduler(()=>schemaRegistry$1.notifySchemaChanged(workbenchColorsSchemaId),200);colorRegistry$1.onDidChangeSchema(()=>{delayer$1.isScheduled()||delayer$1.schedule()});class PageCoordinates{constructor(C,W){this.x=C,this.y=W,this._pageCoordinatesBrand=void 0}toClientCoordinates(){return new ClientCoordinates(this.x-window.scrollX,this.y-window.scrollY)}}class ClientCoordinates{constructor(C,W){this.clientX=C,this.clientY=W,this._clientCoordinatesBrand=void 0}toPageCoordinates(){return new PageCoordinates(this.clientX+window.scrollX,this.clientY+window.scrollY)}}class EditorPagePosition{constructor(C,W,V,U){this.x=C,this.y=W,this.width=V,this.height=U,this._editorPagePositionBrand=void 0}}class CoordinatesRelativeToEditor{constructor(C,W){this.x=C,this.y=W,this._positionRelativeToEditorBrand=void 0}}function createEditorPagePosition(K){const C=getDomNodePagePosition(K);return new EditorPagePosition(C.left,C.top,C.width,C.height)}function createCoordinatesRelativeToEditor(K,C,W){const V=C.width/K.offsetWidth,U=C.height/K.offsetHeight,G=(W.x-C.x)/V,Z=(W.y-C.y)/U;return new CoordinatesRelativeToEditor(G,Z)}class EditorMouseEvent extends StandardMouseEvent{constructor(C,W,V){super(C),this._editorMouseEventBrand=void 0,this.isFromPointerCapture=W,this.pos=new PageCoordinates(this.posx,this.posy),this.editorPos=createEditorPagePosition(V),this.relativePos=createCoordinatesRelativeToEditor(V,this.editorPos,this.pos)}}class EditorMouseEventFactory{constructor(C){this._editorViewDomNode=C}_create(C){return new EditorMouseEvent(C,!1,this._editorViewDomNode)}onContextMenu(C,W){return addDisposableListener(C,"contextmenu",V=>{W(this._create(V))})}onMouseUp(C,W){return addDisposableListener(C,"mouseup",V=>{W(this._create(V))})}onMouseDown(C,W){return addDisposableListener(C,EventType$1.MOUSE_DOWN,V=>{W(this._create(V))})}onPointerDown(C,W){return addDisposableListener(C,EventType$1.POINTER_DOWN,V=>{W(this._create(V),V.pointerId)})}onMouseLeave(C,W){return addDisposableListener(C,EventType$1.MOUSE_LEAVE,V=>{W(this._create(V))})}onMouseMove(C,W){return addDisposableListener(C,"mousemove",V=>W(this._create(V)))}}class EditorPointerEventFactory{constructor(C){this._editorViewDomNode=C}_create(C){return new EditorMouseEvent(C,!1,this._editorViewDomNode)}onPointerUp(C,W){return addDisposableListener(C,"pointerup",V=>{W(this._create(V))})}onPointerDown(C,W){return addDisposableListener(C,EventType$1.POINTER_DOWN,V=>{W(this._create(V),V.pointerId)})}onPointerLeave(C,W){return addDisposableListener(C,EventType$1.POINTER_LEAVE,V=>{W(this._create(V))})}onPointerMove(C,W){return addDisposableListener(C,"pointermove",V=>W(this._create(V)))}}class GlobalEditorPointerMoveMonitor extends Disposable{constructor(C){super(),this._editorViewDomNode=C,this._globalPointerMoveMonitor=this._register(new GlobalPointerMoveMonitor),this._keydownListener=null}startMonitoring(C,W,V,U,G){this._keydownListener=addStandardDisposableListener(C.ownerDocument,"keydown",Z=>{Z.toKeyCodeChord().isModifierKey()||this._globalPointerMoveMonitor.stopMonitoring(!0,Z.browserEvent)},!0),this._globalPointerMoveMonitor.startMonitoring(C,W,V,Z=>{U(new EditorMouseEvent(Z,!0,this._editorViewDomNode))},Z=>{this._keydownListener.dispose(),G(Z)})}stopMonitoring(){this._globalPointerMoveMonitor.stopMonitoring(!0)}}class DynamicCssRules{constructor(C){this._editor=C,this._instanceId=++DynamicCssRules._idPool,this._counter=0,this._rules=new Map,this._garbageCollectionScheduler=new RunOnceScheduler(()=>this.garbageCollect(),1e3)}createClassNameRef(C){const W=this.getOrCreateRule(C);return W.increaseRefCount(),{className:W.className,dispose:()=>{W.decreaseRefCount(),this._garbageCollectionScheduler.schedule()}}}getOrCreateRule(C){const W=this.computeUniqueKey(C);let V=this._rules.get(W);if(!V){const U=this._counter++;V=new RefCountedCssRule(W,`dyn-rule-${this._instanceId}-${U}`,isInShadowDOM(this._editor.getContainerDomNode())?this._editor.getContainerDomNode():void 0,C),this._rules.set(W,V)}return V}computeUniqueKey(C){return JSON.stringify(C)}garbageCollect(){for(const C of this._rules.values())C.hasReferences()||(this._rules.delete(C.key),C.dispose())}}DynamicCssRules._idPool=0;class RefCountedCssRule{constructor(C,W,V,U){this.key=C,this.className=W,this.properties=U,this._referenceCount=0,this._styleElement=createStyleSheet(V),this._styleElement.textContent=this.getCssText(this.className,this.properties)}getCssText(C,W){let V=`.${C} {`;for(const U in W){const G=W[U];let Z;typeof G=="object"?Z=asCssVariable(G.id):Z=G;const X=camelToDashes(U);V+=`
	${X}: ${Z};`}return V+=`
}`,V}dispose(){this._styleElement.remove()}increaseRefCount(){this._referenceCount++}decreaseRefCount(){this._referenceCount--}hasReferences(){return this._referenceCount>0}}function camelToDashes(K){return K.replace(/(^[A-Z])/,([C])=>C.toLowerCase()).replace(/([A-Z])/g,([C])=>`-${C.toLowerCase()}`)}class ViewEventHandler extends Disposable{constructor(){super(),this._shouldRender=!0}shouldRender(){return this._shouldRender}forceShouldRender(){this._shouldRender=!0}setShouldRender(){this._shouldRender=!0}onDidRender(){this._shouldRender=!1}onCompositionStart(C){return!1}onCompositionEnd(C){return!1}onConfigurationChanged(C){return!1}onCursorStateChanged(C){return!1}onDecorationsChanged(C){return!1}onFlushed(C){return!1}onFocusChanged(C){return!1}onLanguageConfigurationChanged(C){return!1}onLineMappingChanged(C){return!1}onLinesChanged(C){return!1}onLinesDeleted(C){return!1}onLinesInserted(C){return!1}onRevealRangeRequest(C){return!1}onScrollChanged(C){return!1}onThemeChanged(C){return!1}onTokensChanged(C){return!1}onTokensColorsChanged(C){return!1}onZonesChanged(C){return!1}handleEvents(C){let W=!1;for(let V=0,U=C.length;V<U;V++){const G=C[V];switch(G.type){case 0:this.onCompositionStart(G)&&(W=!0);break;case 1:this.onCompositionEnd(G)&&(W=!0);break;case 2:this.onConfigurationChanged(G)&&(W=!0);break;case 3:this.onCursorStateChanged(G)&&(W=!0);break;case 4:this.onDecorationsChanged(G)&&(W=!0);break;case 5:this.onFlushed(G)&&(W=!0);break;case 6:this.onFocusChanged(G)&&(W=!0);break;case 7:this.onLanguageConfigurationChanged(G)&&(W=!0);break;case 8:this.onLineMappingChanged(G)&&(W=!0);break;case 9:this.onLinesChanged(G)&&(W=!0);break;case 10:this.onLinesDeleted(G)&&(W=!0);break;case 11:this.onLinesInserted(G)&&(W=!0);break;case 12:this.onRevealRangeRequest(G)&&(W=!0);break;case 13:this.onScrollChanged(G)&&(W=!0);break;case 15:this.onTokensChanged(G)&&(W=!0);break;case 14:this.onThemeChanged(G)&&(W=!0);break;case 16:this.onTokensColorsChanged(G)&&(W=!0);break;case 17:this.onZonesChanged(G)&&(W=!0);break;default:console.info("View received unknown event: "),console.info(G)}}W&&(this._shouldRender=!0)}}class ViewPart extends ViewEventHandler{constructor(C){super(),this._context=C,this._context.addEventHandler(this)}dispose(){this._context.removeEventHandler(this),super.dispose()}}class PartFingerprints{static write(C,W){C.setAttribute("data-mprt",String(W))}static read(C){const W=C.getAttribute("data-mprt");return W===null?0:parseInt(W,10)}static collect(C,W){const V=[];let U=0;for(;C&&C!==C.ownerDocument.body&&C!==W;)C.nodeType===C.ELEMENT_NODE&&(V[U++]=this.read(C)),C=C.parentElement;const G=new Uint8Array(U);for(let Z=0;Z<U;Z++)G[Z]=V[U-Z-1];return G}}class RestrictedRenderingContext{constructor(C,W){this._restrictedRenderingContextBrand=void 0,this._viewLayout=C,this.viewportData=W,this.scrollWidth=this._viewLayout.getScrollWidth(),this.scrollHeight=this._viewLayout.getScrollHeight(),this.visibleRange=this.viewportData.visibleRange,this.bigNumbersDelta=this.viewportData.bigNumbersDelta;const V=this._viewLayout.getCurrentViewport();this.scrollTop=V.top,this.scrollLeft=V.left,this.viewportWidth=V.width,this.viewportHeight=V.height}getScrolledTopFromAbsoluteTop(C){return C-this.scrollTop}getVerticalOffsetForLineNumber(C,W){return this._viewLayout.getVerticalOffsetForLineNumber(C,W)}getVerticalOffsetAfterLineNumber(C,W){return this._viewLayout.getVerticalOffsetAfterLineNumber(C,W)}getDecorationsInViewport(){return this.viewportData.getDecorationsInViewport()}}class RenderingContext extends RestrictedRenderingContext{constructor(C,W,V){super(C,W),this._renderingContextBrand=void 0,this._viewLines=V}linesVisibleRangesForRange(C,W){return this._viewLines.linesVisibleRangesForRange(C,W)}visibleRangeForPosition(C){return this._viewLines.visibleRangeForPosition(C)}}class LineVisibleRanges{constructor(C,W,V,U){this.outsideRenderedLine=C,this.lineNumber=W,this.ranges=V,this.continuesOnNextLine=U}}class HorizontalRange{static from(C){const W=new Array(C.length);for(let V=0,U=C.length;V<U;V++){const G=C[V];W[V]=new HorizontalRange(G.left,G.width)}return W}constructor(C,W){this._horizontalRangeBrand=void 0,this.left=Math.round(C),this.width=Math.round(W)}toString(){return`[${this.left},${this.width}]`}}class FloatHorizontalRange{constructor(C,W){this._floatHorizontalRangeBrand=void 0,this.left=C,this.width=W}toString(){return`[${this.left},${this.width}]`}static compare(C,W){return C.left-W.left}}class HorizontalPosition{constructor(C,W){this.outsideRenderedLine=C,this.originalLeft=W,this.left=Math.round(this.originalLeft)}}class VisibleRanges{constructor(C,W){this.outsideRenderedLine=C,this.ranges=W}}class RangeUtil{static _createRange(){return this._handyReadyRange||(this._handyReadyRange=document.createRange()),this._handyReadyRange}static _detachRange(C,W){C.selectNodeContents(W)}static _readClientRects(C,W,V,U,G){const Z=this._createRange();try{return Z.setStart(C,W),Z.setEnd(V,U),Z.getClientRects()}catch{return null}finally{this._detachRange(Z,G)}}static _mergeAdjacentRanges(C){if(C.length===1)return C;C.sort(FloatHorizontalRange.compare);const W=[];let V=0,U=C[0];for(let G=1,Z=C.length;G<Z;G++){const X=C[G];U.left+U.width+.9>=X.left?U.width=Math.max(U.width,X.left+X.width-U.left):(W[V++]=U,U=X)}return W[V++]=U,W}static _createHorizontalRangesFromClientRects(C,W,V){if(!C||C.length===0)return null;const U=[];for(let G=0,Z=C.length;G<Z;G++){const X=C[G];U[G]=new FloatHorizontalRange(Math.max(0,(X.left-W)/V),X.width/V)}return this._mergeAdjacentRanges(U)}static readHorizontalRanges(C,W,V,U,G,Z){const Q=C.children.length-1;if(0>Q)return null;if(W=Math.min(Q,Math.max(0,W)),U=Math.min(Q,Math.max(0,U)),W===U&&V===G&&V===0&&!C.children[W].firstChild){const ie=C.children[W].getClientRects();return Z.markDidDomLayout(),this._createHorizontalRangesFromClientRects(ie,Z.clientRectDeltaLeft,Z.clientRectScale)}W!==U&&U>0&&G===0&&(U--,G=1073741824);let J=C.children[W].firstChild,ee=C.children[U].firstChild;if((!J||!ee)&&(!J&&V===0&&W>0&&(J=C.children[W-1].firstChild,V=1073741824),!ee&&G===0&&U>0&&(ee=C.children[U-1].firstChild,G=1073741824)),!J||!ee)return null;V=Math.min(J.textContent.length,Math.max(0,V)),G=Math.min(ee.textContent.length,Math.max(0,G));const te=this._readClientRects(J,V,ee,G,Z.endNode);return Z.markDidDomLayout(),this._createHorizontalRangesFromClientRects(te,Z.clientRectDeltaLeft,Z.clientRectScale)}}var ColorScheme;(function(K){K.DARK="dark",K.LIGHT="light",K.HIGH_CONTRAST_DARK="hcDark",K.HIGH_CONTRAST_LIGHT="hcLight"})(ColorScheme||(ColorScheme={}));function isHighContrast(K){return K===ColorScheme.HIGH_CONTRAST_DARK||K===ColorScheme.HIGH_CONTRAST_LIGHT}function isDark(K){return K===ColorScheme.DARK||K===ColorScheme.HIGH_CONTRAST_DARK}const canUseFastRenderedViewLine=function(){return isNative?!0:!(isLinux||isFirefox||isSafari)}();let monospaceAssumptionsAreValid=!0;class ViewLineOptions{constructor(C,W){this.themeType=W;const V=C.options,U=V.get(50);V.get(38)==="off"?this.renderWhitespace=V.get(98):this.renderWhitespace="none",this.renderControlCharacters=V.get(93),this.spaceWidth=U.spaceWidth,this.middotWidth=U.middotWidth,this.wsmiddotWidth=U.wsmiddotWidth,this.useMonospaceOptimizations=U.isMonospace&&!V.get(33),this.canUseHalfwidthRightwardsArrow=U.canUseHalfwidthRightwardsArrow,this.lineHeight=V.get(66),this.stopRenderingLineAfter=V.get(116),this.fontLigatures=V.get(51)}equals(C){return this.themeType===C.themeType&&this.renderWhitespace===C.renderWhitespace&&this.renderControlCharacters===C.renderControlCharacters&&this.spaceWidth===C.spaceWidth&&this.middotWidth===C.middotWidth&&this.wsmiddotWidth===C.wsmiddotWidth&&this.useMonospaceOptimizations===C.useMonospaceOptimizations&&this.canUseHalfwidthRightwardsArrow===C.canUseHalfwidthRightwardsArrow&&this.lineHeight===C.lineHeight&&this.stopRenderingLineAfter===C.stopRenderingLineAfter&&this.fontLigatures===C.fontLigatures}}class ViewLine{constructor(C){this._options=C,this._isMaybeInvalid=!0,this._renderedViewLine=null}getDomNode(){return this._renderedViewLine&&this._renderedViewLine.domNode?this._renderedViewLine.domNode.domNode:null}setDomNode(C){if(this._renderedViewLine)this._renderedViewLine.domNode=createFastDomNode(C);else throw new Error("I have no rendered view line to set the dom node to...")}onContentChanged(){this._isMaybeInvalid=!0}onTokensChanged(){this._isMaybeInvalid=!0}onDecorationsChanged(){this._isMaybeInvalid=!0}onOptionsChanged(C){this._isMaybeInvalid=!0,this._options=C}onSelectionChanged(){return isHighContrast(this._options.themeType)||this._options.renderWhitespace==="selection"?(this._isMaybeInvalid=!0,!0):!1}renderLine(C,W,V,U){if(this._isMaybeInvalid===!1)return!1;this._isMaybeInvalid=!1;const G=V.getViewLineRenderingData(C),Z=this._options,X=LineDecoration.filter(G.inlineDecorations,C,G.minColumn,G.maxColumn);let Q=null;if(isHighContrast(Z.themeType)||this._options.renderWhitespace==="selection"){const ie=V.selections;for(const ne of ie){if(ne.endLineNumber<C||ne.startLineNumber>C)continue;const oe=ne.startLineNumber===C?ne.startColumn:G.minColumn,re=ne.endLineNumber===C?ne.endColumn:G.maxColumn;oe<re&&(isHighContrast(Z.themeType)&&X.push(new LineDecoration(oe,re,"inline-selected-text",0)),this._options.renderWhitespace==="selection"&&(Q||(Q=[]),Q.push(new LineRange(oe-1,re-1))))}}const J=new RenderLineInput(Z.useMonospaceOptimizations,Z.canUseHalfwidthRightwardsArrow,G.content,G.continuesWithWrappedLine,G.isBasicASCII,G.containsRTL,G.minColumn-1,G.tokens,X,G.tabSize,G.startVisibleColumn,Z.spaceWidth,Z.middotWidth,Z.wsmiddotWidth,Z.stopRenderingLineAfter,Z.renderWhitespace,Z.renderControlCharacters,Z.fontLigatures!==EditorFontLigatures.OFF,Q);if(this._renderedViewLine&&this._renderedViewLine.input.equals(J))return!1;U.appendString('<div style="top:'),U.appendString(String(W)),U.appendString("px;height:"),U.appendString(String(this._options.lineHeight)),U.appendString('px;" class="'),U.appendString(ViewLine.CLASS_NAME),U.appendString('">');const ee=renderViewLine(J,U);U.appendString("</div>");let te=null;return monospaceAssumptionsAreValid&&canUseFastRenderedViewLine&&G.isBasicASCII&&Z.useMonospaceOptimizations&&ee.containsForeignElements===0&&(te=new FastRenderedViewLine(this._renderedViewLine?this._renderedViewLine.domNode:null,J,ee.characterMapping)),te||(te=createRenderedLine(this._renderedViewLine?this._renderedViewLine.domNode:null,J,ee.characterMapping,ee.containsRTL,ee.containsForeignElements)),this._renderedViewLine=te,!0}layoutLine(C,W){this._renderedViewLine&&this._renderedViewLine.domNode&&(this._renderedViewLine.domNode.setTop(W),this._renderedViewLine.domNode.setHeight(this._options.lineHeight))}getWidth(C){return this._renderedViewLine?this._renderedViewLine.getWidth(C):0}getWidthIsFast(){return this._renderedViewLine?this._renderedViewLine.getWidthIsFast():!0}needsMonospaceFontCheck(){return this._renderedViewLine?this._renderedViewLine instanceof FastRenderedViewLine:!1}monospaceAssumptionsAreValid(){return this._renderedViewLine&&this._renderedViewLine instanceof FastRenderedViewLine?this._renderedViewLine.monospaceAssumptionsAreValid():monospaceAssumptionsAreValid}onMonospaceAssumptionsInvalidated(){this._renderedViewLine&&this._renderedViewLine instanceof FastRenderedViewLine&&(this._renderedViewLine=this._renderedViewLine.toSlowRenderedLine())}getVisibleRangesForRange(C,W,V,U){if(!this._renderedViewLine)return null;W=Math.min(this._renderedViewLine.input.lineContent.length+1,Math.max(1,W)),V=Math.min(this._renderedViewLine.input.lineContent.length+1,Math.max(1,V));const G=this._renderedViewLine.input.stopRenderingLineAfter;if(G!==-1&&W>G+1&&V>G+1)return new VisibleRanges(!0,[new FloatHorizontalRange(this.getWidth(U),0)]);G!==-1&&W>G+1&&(W=G+1),G!==-1&&V>G+1&&(V=G+1);const Z=this._renderedViewLine.getVisibleRangesForRange(C,W,V,U);return Z&&Z.length>0?new VisibleRanges(!1,Z):null}getColumnOfNodeOffset(C,W){return this._renderedViewLine?this._renderedViewLine.getColumnOfNodeOffset(C,W):1}}ViewLine.CLASS_NAME="view-line";class FastRenderedViewLine{constructor(C,W,V){this._cachedWidth=-1,this.domNode=C,this.input=W;const U=Math.floor(W.lineContent.length/300);if(U>0){this._keyColumnPixelOffsetCache=new Float32Array(U);for(let G=0;G<U;G++)this._keyColumnPixelOffsetCache[G]=-1}else this._keyColumnPixelOffsetCache=null;this._characterMapping=V,this._charWidth=W.spaceWidth}getWidth(C){if(!this.domNode||this.input.lineContent.length<300){const W=this._characterMapping.getHorizontalOffset(this._characterMapping.length);return Math.round(this._charWidth*W)}return this._cachedWidth===-1&&(this._cachedWidth=this._getReadingTarget(this.domNode).offsetWidth,C==null||C.markDidDomLayout()),this._cachedWidth}getWidthIsFast(){return this.input.lineContent.length<300||this._cachedWidth!==-1}monospaceAssumptionsAreValid(){if(!this.domNode)return monospaceAssumptionsAreValid;if(this.input.lineContent.length<300){const C=this.getWidth(null),W=this.domNode.domNode.firstChild.offsetWidth;Math.abs(C-W)>=2&&(console.warn("monospace assumptions have been violated, therefore disabling monospace optimizations!"),monospaceAssumptionsAreValid=!1)}return monospaceAssumptionsAreValid}toSlowRenderedLine(){return createRenderedLine(this.domNode,this.input,this._characterMapping,!1,0)}getVisibleRangesForRange(C,W,V,U){const G=this._getColumnPixelOffset(C,W,U),Z=this._getColumnPixelOffset(C,V,U);return[new FloatHorizontalRange(G,Z-G)]}_getColumnPixelOffset(C,W,V){if(W<=300){const J=this._characterMapping.getHorizontalOffset(W);return this._charWidth*J}const U=Math.floor((W-1)/300)-1,G=(U+1)*300+1;let Z=-1;if(this._keyColumnPixelOffsetCache&&(Z=this._keyColumnPixelOffsetCache[U],Z===-1&&(Z=this._actualReadPixelOffset(C,G,V),this._keyColumnPixelOffsetCache[U]=Z)),Z===-1){const J=this._characterMapping.getHorizontalOffset(W);return this._charWidth*J}const X=this._characterMapping.getHorizontalOffset(G),Q=this._characterMapping.getHorizontalOffset(W);return Z+this._charWidth*(Q-X)}_getReadingTarget(C){return C.domNode.firstChild}_actualReadPixelOffset(C,W,V){if(!this.domNode)return-1;const U=this._characterMapping.getDomPosition(W),G=RangeUtil.readHorizontalRanges(this._getReadingTarget(this.domNode),U.partIndex,U.charIndex,U.partIndex,U.charIndex,V);return!G||G.length===0?-1:G[0].left}getColumnOfNodeOffset(C,W){return getColumnOfNodeOffset(this._characterMapping,C,W)}}class RenderedViewLine{constructor(C,W,V,U,G){if(this.domNode=C,this.input=W,this._characterMapping=V,this._isWhitespaceOnly=/^\s*$/.test(W.lineContent),this._containsForeignElements=G,this._cachedWidth=-1,this._pixelOffsetCache=null,!U||this._characterMapping.length===0){this._pixelOffsetCache=new Float32Array(Math.max(2,this._characterMapping.length+1));for(let Z=0,X=this._characterMapping.length;Z<=X;Z++)this._pixelOffsetCache[Z]=-1}}_getReadingTarget(C){return C.domNode.firstChild}getWidth(C){return this.domNode?(this._cachedWidth===-1&&(this._cachedWidth=this._getReadingTarget(this.domNode).offsetWidth,C==null||C.markDidDomLayout()),this._cachedWidth):0}getWidthIsFast(){return this._cachedWidth!==-1}getVisibleRangesForRange(C,W,V,U){if(!this.domNode)return null;if(this._pixelOffsetCache!==null){const G=this._readPixelOffset(this.domNode,C,W,U);if(G===-1)return null;const Z=this._readPixelOffset(this.domNode,C,V,U);return Z===-1?null:[new FloatHorizontalRange(G,Z-G)]}return this._readVisibleRangesForRange(this.domNode,C,W,V,U)}_readVisibleRangesForRange(C,W,V,U,G){if(V===U){const Z=this._readPixelOffset(C,W,V,G);return Z===-1?null:[new FloatHorizontalRange(Z,0)]}else return this._readRawVisibleRangesForRange(C,V,U,G)}_readPixelOffset(C,W,V,U){if(this._characterMapping.length===0){if(this._containsForeignElements===0||this._containsForeignElements===2)return 0;if(this._containsForeignElements===1)return this.getWidth(U);const G=this._getReadingTarget(C);return G.firstChild?(U.markDidDomLayout(),G.firstChild.offsetWidth):0}if(this._pixelOffsetCache!==null){const G=this._pixelOffsetCache[V];if(G!==-1)return G;const Z=this._actualReadPixelOffset(C,W,V,U);return this._pixelOffsetCache[V]=Z,Z}return this._actualReadPixelOffset(C,W,V,U)}_actualReadPixelOffset(C,W,V,U){if(this._characterMapping.length===0){const Q=RangeUtil.readHorizontalRanges(this._getReadingTarget(C),0,0,0,0,U);return!Q||Q.length===0?-1:Q[0].left}if(V===this._characterMapping.length&&this._isWhitespaceOnly&&this._containsForeignElements===0)return this.getWidth(U);const G=this._characterMapping.getDomPosition(V),Z=RangeUtil.readHorizontalRanges(this._getReadingTarget(C),G.partIndex,G.charIndex,G.partIndex,G.charIndex,U);if(!Z||Z.length===0)return-1;const X=Z[0].left;if(this.input.isBasicASCII){const Q=this._characterMapping.getHorizontalOffset(V),J=Math.round(this.input.spaceWidth*Q);if(Math.abs(J-X)<=1)return J}return X}_readRawVisibleRangesForRange(C,W,V,U){if(W===1&&V===this._characterMapping.length)return[new FloatHorizontalRange(0,this.getWidth(U))];const G=this._characterMapping.getDomPosition(W),Z=this._characterMapping.getDomPosition(V);return RangeUtil.readHorizontalRanges(this._getReadingTarget(C),G.partIndex,G.charIndex,Z.partIndex,Z.charIndex,U)}getColumnOfNodeOffset(C,W){return getColumnOfNodeOffset(this._characterMapping,C,W)}}class WebKitRenderedViewLine extends RenderedViewLine{_readVisibleRangesForRange(C,W,V,U,G){const Z=super._readVisibleRangesForRange(C,W,V,U,G);if(!Z||Z.length===0||V===U||V===1&&U===this._characterMapping.length)return Z;if(!this.input.containsRTL){const X=this._readPixelOffset(C,W,U,G);if(X!==-1){const Q=Z[Z.length-1];Q.left<X&&(Q.width=X-Q.left)}}return Z}}const createRenderedLine=function(){return isWebKit?createWebKitRenderedLine:createNormalRenderedLine}();function createWebKitRenderedLine(K,C,W,V,U){return new WebKitRenderedViewLine(K,C,W,V,U)}function createNormalRenderedLine(K,C,W,V,U){return new RenderedViewLine(K,C,W,V,U)}function getColumnOfNodeOffset(K,C,W){const V=C.textContent.length;let U=-1;for(;C;)C=C.previousSibling,U++;return K.getColumn(new DomPosition(U,W),V)}class CursorColumns{static _nextVisibleColumn(C,W,V){return C===9?CursorColumns.nextRenderTabStop(W,V):isFullWidthCharacter(C)||isEmojiImprecise(C)?W+2:W+1}static visibleColumnFromColumn(C,W,V){const U=Math.min(W-1,C.length),G=C.substring(0,U),Z=new GraphemeIterator(G);let X=0;for(;!Z.eol();){const Q=getNextCodePoint(G,U,Z.offset);Z.nextGraphemeLength(),X=this._nextVisibleColumn(Q,X,V)}return X}static columnFromVisibleColumn(C,W,V){if(W<=0)return 1;const U=C.length,G=new GraphemeIterator(C);let Z=0,X=1;for(;!G.eol();){const Q=getNextCodePoint(C,U,G.offset);G.nextGraphemeLength();const J=this._nextVisibleColumn(Q,Z,V),ee=G.offset+1;if(J>=W){const te=W-Z;return J-W<te?ee:X}Z=J,X=ee}return U+1}static nextRenderTabStop(C,W){return C+W-C%W}static nextIndentTabStop(C,W){return C+W-C%W}static prevRenderTabStop(C,W){return Math.max(0,C-1-(C-1)%W)}static prevIndentTabStop(C,W){return Math.max(0,C-1-(C-1)%W)}}class AtomicTabMoveOperations{static whitespaceVisibleColumn(C,W,V){const U=C.length;let G=0,Z=-1,X=-1;for(let Q=0;Q<U;Q++){if(Q===W)return[Z,X,G];switch(G%V===0&&(Z=Q,X=G),C.charCodeAt(Q)){case 32:G+=1;break;case 9:G=CursorColumns.nextRenderTabStop(G,V);break;default:return[-1,-1,-1]}}return W===U?[Z,X,G]:[-1,-1,-1]}static atomicPosition(C,W,V,U){const G=C.length,[Z,X,Q]=AtomicTabMoveOperations.whitespaceVisibleColumn(C,W,V);if(Q===-1)return-1;let J;switch(U){case 0:J=!0;break;case 1:J=!1;break;case 2:if(Q%V===0)return W;J=Q%V<=V/2;break}if(J){if(Z===-1)return-1;let ie=X;for(let ne=Z;ne<G;++ne){if(ie===X+V)return Z;switch(C.charCodeAt(ne)){case 32:ie+=1;break;case 9:ie=CursorColumns.nextRenderTabStop(ie,V);break;default:return-1}}return ie===X+V?Z:-1}const ee=CursorColumns.nextRenderTabStop(Q,V);let te=Q;for(let ie=W;ie<G;ie++){if(te===ee)return ie;switch(C.charCodeAt(ie)){case 32:te+=1;break;case 9:te=CursorColumns.nextRenderTabStop(te,V);break;default:return-1}}return te===ee?G:-1}}class UnknownHitTestResult{constructor(C=null){this.hitTarget=C,this.type=0}}class ContentHitTestResult{constructor(C,W,V){this.position=C,this.spanNode=W,this.injectedText=V,this.type=1}}var HitTestResult;(function(K){function C(W,V,U){const G=W.getPositionFromDOMInfo(V,U);return G?new ContentHitTestResult(G,V,null):new UnknownHitTestResult(V)}K.createFromDOMInfo=C})(HitTestResult||(HitTestResult={}));class PointerHandlerLastRenderData{constructor(C,W){this.lastViewCursorsRenderData=C,this.lastTextareaPosition=W}}class MouseTarget{static _deduceRage(C,W=null){return!W&&C?new Range$2(C.lineNumber,C.column,C.lineNumber,C.column):W??null}static createUnknown(C,W,V){return{type:0,element:C,mouseColumn:W,position:V,range:this._deduceRage(V)}}static createTextarea(C,W){return{type:1,element:C,mouseColumn:W,position:null,range:null}}static createMargin(C,W,V,U,G,Z){return{type:C,element:W,mouseColumn:V,position:U,range:G,detail:Z}}static createViewZone(C,W,V,U,G){return{type:C,element:W,mouseColumn:V,position:U,range:this._deduceRage(U),detail:G}}static createContentText(C,W,V,U,G){return{type:6,element:C,mouseColumn:W,position:V,range:this._deduceRage(V,U),detail:G}}static createContentEmpty(C,W,V,U){return{type:7,element:C,mouseColumn:W,position:V,range:this._deduceRage(V),detail:U}}static createContentWidget(C,W,V){return{type:9,element:C,mouseColumn:W,position:null,range:null,detail:V}}static createScrollbar(C,W,V){return{type:11,element:C,mouseColumn:W,position:V,range:this._deduceRage(V)}}static createOverlayWidget(C,W,V){return{type:12,element:C,mouseColumn:W,position:null,range:null,detail:V}}static createOutsideEditor(C,W,V,U){return{type:13,element:null,mouseColumn:C,position:W,range:this._deduceRage(W),outsidePosition:V,outsideDistance:U}}static _typeToString(C){return C===1?"TEXTAREA":C===2?"GUTTER_GLYPH_MARGIN":C===3?"GUTTER_LINE_NUMBERS":C===4?"GUTTER_LINE_DECORATIONS":C===5?"GUTTER_VIEW_ZONE":C===6?"CONTENT_TEXT":C===7?"CONTENT_EMPTY":C===8?"CONTENT_VIEW_ZONE":C===9?"CONTENT_WIDGET":C===10?"OVERVIEW_RULER":C===11?"SCROLLBAR":C===12?"OVERLAY_WIDGET":"UNKNOWN"}static toString(C){return this._typeToString(C.type)+": "+C.position+" - "+C.range+" - "+JSON.stringify(C.detail)}}class ElementPath{static isTextArea(C){return C.length===2&&C[0]===3&&C[1]===6}static isChildOfViewLines(C){return C.length>=4&&C[0]===3&&C[3]===7}static isStrictChildOfViewLines(C){return C.length>4&&C[0]===3&&C[3]===7}static isChildOfScrollableElement(C){return C.length>=2&&C[0]===3&&C[1]===5}static isChildOfMinimap(C){return C.length>=2&&C[0]===3&&C[1]===8}static isChildOfContentWidgets(C){return C.length>=4&&C[0]===3&&C[3]===1}static isChildOfOverflowGuard(C){return C.length>=1&&C[0]===3}static isChildOfOverflowingContentWidgets(C){return C.length>=1&&C[0]===2}static isChildOfOverlayWidgets(C){return C.length>=2&&C[0]===3&&C[1]===4}}class HitTestContext{constructor(C,W,V){this.viewModel=C.viewModel;const U=C.configuration.options;this.layoutInfo=U.get(143),this.viewDomNode=W.viewDomNode,this.lineHeight=U.get(66),this.stickyTabStops=U.get(115),this.typicalHalfwidthCharacterWidth=U.get(50).typicalHalfwidthCharacterWidth,this.lastRenderData=V,this._context=C,this._viewHelper=W}getZoneAtCoord(C){return HitTestContext.getZoneAtCoord(this._context,C)}static getZoneAtCoord(C,W){const V=C.viewLayout.getWhitespaceAtVerticalOffset(W);if(V){const U=V.verticalOffset+V.height/2,G=C.viewModel.getLineCount();let Z=null,X,Q=null;return V.afterLineNumber!==G&&(Q=new Position$1(V.afterLineNumber+1,1)),V.afterLineNumber>0&&(Z=new Position$1(V.afterLineNumber,C.viewModel.getLineMaxColumn(V.afterLineNumber))),Q===null?X=Z:Z===null?X=Q:W<U?X=Z:X=Q,{viewZoneId:V.id,afterLineNumber:V.afterLineNumber,positionBefore:Z,positionAfter:Q,position:X}}return null}getFullLineRangeAtCoord(C){if(this._context.viewLayout.isAfterLines(C)){const U=this._context.viewModel.getLineCount(),G=this._context.viewModel.getLineMaxColumn(U);return{range:new Range$2(U,G,U,G),isAfterLines:!0}}const W=this._context.viewLayout.getLineNumberAtVerticalOffset(C),V=this._context.viewModel.getLineMaxColumn(W);return{range:new Range$2(W,1,W,V),isAfterLines:!1}}getLineNumberAtVerticalOffset(C){return this._context.viewLayout.getLineNumberAtVerticalOffset(C)}isAfterLines(C){return this._context.viewLayout.isAfterLines(C)}isInTopPadding(C){return this._context.viewLayout.isInTopPadding(C)}isInBottomPadding(C){return this._context.viewLayout.isInBottomPadding(C)}getVerticalOffsetForLineNumber(C){return this._context.viewLayout.getVerticalOffsetForLineNumber(C)}findAttribute(C,W){return HitTestContext._findAttribute(C,W,this._viewHelper.viewDomNode)}static _findAttribute(C,W,V){for(;C&&C!==C.ownerDocument.body;){if(C.hasAttribute&&C.hasAttribute(W))return C.getAttribute(W);if(C===V)return null;C=C.parentNode}return null}getLineWidth(C){return this._viewHelper.getLineWidth(C)}visibleRangeForPosition(C,W){return this._viewHelper.visibleRangeForPosition(C,W)}getPositionFromDOMInfo(C,W){return this._viewHelper.getPositionFromDOMInfo(C,W)}getCurrentScrollTop(){return this._context.viewLayout.getCurrentScrollTop()}getCurrentScrollLeft(){return this._context.viewLayout.getCurrentScrollLeft()}}class BareHitTestRequest{constructor(C,W,V,U){this.editorPos=W,this.pos=V,this.relativePos=U,this.mouseVerticalOffset=Math.max(0,C.getCurrentScrollTop()+this.relativePos.y),this.mouseContentHorizontalOffset=C.getCurrentScrollLeft()+this.relativePos.x-C.layoutInfo.contentLeft,this.isInMarginArea=this.relativePos.x<C.layoutInfo.contentLeft&&this.relativePos.x>=C.layoutInfo.glyphMarginLeft,this.isInContentArea=!this.isInMarginArea,this.mouseColumn=Math.max(0,MouseTargetFactory._getMouseColumn(this.mouseContentHorizontalOffset,C.typicalHalfwidthCharacterWidth))}}class HitTestRequest extends BareHitTestRequest{constructor(C,W,V,U,G){super(C,W,V,U),this._ctx=C,G?(this.target=G,this.targetPath=PartFingerprints.collect(G,C.viewDomNode)):(this.target=null,this.targetPath=new Uint8Array(0))}toString(){return`pos(${this.pos.x},${this.pos.y}), editorPos(${this.editorPos.x},${this.editorPos.y}), relativePos(${this.relativePos.x},${this.relativePos.y}), mouseVerticalOffset: ${this.mouseVerticalOffset}, mouseContentHorizontalOffset: ${this.mouseContentHorizontalOffset}
	target: ${this.target?this.target.outerHTML:null}`}_getMouseColumn(C=null){return C&&C.column<this._ctx.viewModel.getLineMaxColumn(C.lineNumber)?CursorColumns.visibleColumnFromColumn(this._ctx.viewModel.getLineContent(C.lineNumber),C.column,this._ctx.viewModel.model.getOptions().tabSize)+1:this.mouseColumn}fulfillUnknown(C=null){return MouseTarget.createUnknown(this.target,this._getMouseColumn(C),C)}fulfillTextarea(){return MouseTarget.createTextarea(this.target,this._getMouseColumn())}fulfillMargin(C,W,V,U){return MouseTarget.createMargin(C,this.target,this._getMouseColumn(W),W,V,U)}fulfillViewZone(C,W,V){return MouseTarget.createViewZone(C,this.target,this._getMouseColumn(W),W,V)}fulfillContentText(C,W,V){return MouseTarget.createContentText(this.target,this._getMouseColumn(C),C,W,V)}fulfillContentEmpty(C,W){return MouseTarget.createContentEmpty(this.target,this._getMouseColumn(C),C,W)}fulfillContentWidget(C){return MouseTarget.createContentWidget(this.target,this._getMouseColumn(),C)}fulfillScrollbar(C){return MouseTarget.createScrollbar(this.target,this._getMouseColumn(C),C)}fulfillOverlayWidget(C){return MouseTarget.createOverlayWidget(this.target,this._getMouseColumn(),C)}withTarget(C){return new HitTestRequest(this._ctx,this.editorPos,this.pos,this.relativePos,C)}}const EMPTY_CONTENT_AFTER_LINES={isAfterLines:!0};function createEmptyContentDataInLines(K){return{isAfterLines:!1,horizontalDistanceToText:K}}class MouseTargetFactory{constructor(C,W){this._context=C,this._viewHelper=W}mouseTargetIsWidget(C){const W=C.target,V=PartFingerprints.collect(W,this._viewHelper.viewDomNode);return!!(ElementPath.isChildOfContentWidgets(V)||ElementPath.isChildOfOverflowingContentWidgets(V)||ElementPath.isChildOfOverlayWidgets(V))}createMouseTarget(C,W,V,U,G){const Z=new HitTestContext(this._context,this._viewHelper,C),X=new HitTestRequest(Z,W,V,U,G);try{const Q=MouseTargetFactory._createMouseTarget(Z,X,!1);if(Q.type===6&&Z.stickyTabStops&&Q.position!==null){const J=MouseTargetFactory._snapToSoftTabBoundary(Q.position,Z.viewModel),ee=Range$2.fromPositions(J,J).plusRange(Q.range);return X.fulfillContentText(J,ee,Q.detail)}return Q}catch{return X.fulfillUnknown()}}static _createMouseTarget(C,W,V){if(W.target===null){if(V)return W.fulfillUnknown();const Z=MouseTargetFactory._doHitTest(C,W);return Z.type===1?MouseTargetFactory.createMouseTargetFromHitTestPosition(C,W,Z.spanNode,Z.position,Z.injectedText):this._createMouseTarget(C,W.withTarget(Z.hitTarget),!0)}const U=W;let G=null;return!ElementPath.isChildOfOverflowGuard(W.targetPath)&&!ElementPath.isChildOfOverflowingContentWidgets(W.targetPath)&&(G=G||W.fulfillUnknown()),G=G||MouseTargetFactory._hitTestContentWidget(C,U),G=G||MouseTargetFactory._hitTestOverlayWidget(C,U),G=G||MouseTargetFactory._hitTestMinimap(C,U),G=G||MouseTargetFactory._hitTestScrollbarSlider(C,U),G=G||MouseTargetFactory._hitTestViewZone(C,U),G=G||MouseTargetFactory._hitTestMargin(C,U),G=G||MouseTargetFactory._hitTestViewCursor(C,U),G=G||MouseTargetFactory._hitTestTextArea(C,U),G=G||MouseTargetFactory._hitTestViewLines(C,U,V),G=G||MouseTargetFactory._hitTestScrollbar(C,U),G||W.fulfillUnknown()}static _hitTestContentWidget(C,W){if(ElementPath.isChildOfContentWidgets(W.targetPath)||ElementPath.isChildOfOverflowingContentWidgets(W.targetPath)){const V=C.findAttribute(W.target,"widgetId");return V?W.fulfillContentWidget(V):W.fulfillUnknown()}return null}static _hitTestOverlayWidget(C,W){if(ElementPath.isChildOfOverlayWidgets(W.targetPath)){const V=C.findAttribute(W.target,"widgetId");return V?W.fulfillOverlayWidget(V):W.fulfillUnknown()}return null}static _hitTestViewCursor(C,W){if(W.target){const V=C.lastRenderData.lastViewCursorsRenderData;for(const U of V)if(W.target===U.domNode)return W.fulfillContentText(U.position,null,{mightBeForeignElement:!1,injectedText:null})}if(W.isInContentArea){const V=C.lastRenderData.lastViewCursorsRenderData,U=W.mouseContentHorizontalOffset,G=W.mouseVerticalOffset;for(const Z of V){if(U<Z.contentLeft||U>Z.contentLeft+Z.width)continue;const X=C.getVerticalOffsetForLineNumber(Z.position.lineNumber);if(X<=G&&G<=X+Z.height)return W.fulfillContentText(Z.position,null,{mightBeForeignElement:!1,injectedText:null})}}return null}static _hitTestViewZone(C,W){const V=C.getZoneAtCoord(W.mouseVerticalOffset);if(V){const U=W.isInContentArea?8:5;return W.fulfillViewZone(U,V.position,V)}return null}static _hitTestTextArea(C,W){return ElementPath.isTextArea(W.targetPath)?C.lastRenderData.lastTextareaPosition?W.fulfillContentText(C.lastRenderData.lastTextareaPosition,null,{mightBeForeignElement:!1,injectedText:null}):W.fulfillTextarea():null}static _hitTestMargin(C,W){if(W.isInMarginArea){const V=C.getFullLineRangeAtCoord(W.mouseVerticalOffset),U=V.range.getStartPosition();let G=Math.abs(W.relativePos.x);const Z={isAfterLines:V.isAfterLines,glyphMarginLeft:C.layoutInfo.glyphMarginLeft,glyphMarginWidth:C.layoutInfo.glyphMarginWidth,lineNumbersWidth:C.layoutInfo.lineNumbersWidth,offsetX:G};return G-=C.layoutInfo.glyphMarginLeft,G<=C.layoutInfo.glyphMarginWidth?W.fulfillMargin(2,U,V.range,Z):(G-=C.layoutInfo.glyphMarginWidth,G<=C.layoutInfo.lineNumbersWidth?W.fulfillMargin(3,U,V.range,Z):(G-=C.layoutInfo.lineNumbersWidth,W.fulfillMargin(4,U,V.range,Z)))}return null}static _hitTestViewLines(C,W,V){if(!ElementPath.isChildOfViewLines(W.targetPath))return null;if(C.isInTopPadding(W.mouseVerticalOffset))return W.fulfillContentEmpty(new Position$1(1,1),EMPTY_CONTENT_AFTER_LINES);if(C.isAfterLines(W.mouseVerticalOffset)||C.isInBottomPadding(W.mouseVerticalOffset)){const G=C.viewModel.getLineCount(),Z=C.viewModel.getLineMaxColumn(G);return W.fulfillContentEmpty(new Position$1(G,Z),EMPTY_CONTENT_AFTER_LINES)}if(V){if(ElementPath.isStrictChildOfViewLines(W.targetPath)){const G=C.getLineNumberAtVerticalOffset(W.mouseVerticalOffset);if(C.viewModel.getLineLength(G)===0){const X=C.getLineWidth(G),Q=createEmptyContentDataInLines(W.mouseContentHorizontalOffset-X);return W.fulfillContentEmpty(new Position$1(G,1),Q)}const Z=C.getLineWidth(G);if(W.mouseContentHorizontalOffset>=Z){const X=createEmptyContentDataInLines(W.mouseContentHorizontalOffset-Z),Q=new Position$1(G,C.viewModel.getLineMaxColumn(G));return W.fulfillContentEmpty(Q,X)}}return W.fulfillUnknown()}const U=MouseTargetFactory._doHitTest(C,W);return U.type===1?MouseTargetFactory.createMouseTargetFromHitTestPosition(C,W,U.spanNode,U.position,U.injectedText):this._createMouseTarget(C,W.withTarget(U.hitTarget),!0)}static _hitTestMinimap(C,W){if(ElementPath.isChildOfMinimap(W.targetPath)){const V=C.getLineNumberAtVerticalOffset(W.mouseVerticalOffset),U=C.viewModel.getLineMaxColumn(V);return W.fulfillScrollbar(new Position$1(V,U))}return null}static _hitTestScrollbarSlider(C,W){if(ElementPath.isChildOfScrollableElement(W.targetPath)&&W.target&&W.target.nodeType===1){const V=W.target.className;if(V&&/\b(slider|scrollbar)\b/.test(V)){const U=C.getLineNumberAtVerticalOffset(W.mouseVerticalOffset),G=C.viewModel.getLineMaxColumn(U);return W.fulfillScrollbar(new Position$1(U,G))}}return null}static _hitTestScrollbar(C,W){if(ElementPath.isChildOfScrollableElement(W.targetPath)){const V=C.getLineNumberAtVerticalOffset(W.mouseVerticalOffset),U=C.viewModel.getLineMaxColumn(V);return W.fulfillScrollbar(new Position$1(V,U))}return null}getMouseColumn(C){const W=this._context.configuration.options,V=W.get(143),U=this._context.viewLayout.getCurrentScrollLeft()+C.x-V.contentLeft;return MouseTargetFactory._getMouseColumn(U,W.get(50).typicalHalfwidthCharacterWidth)}static _getMouseColumn(C,W){return C<0?1:Math.round(C/W)+1}static createMouseTargetFromHitTestPosition(C,W,V,U,G){const Z=U.lineNumber,X=U.column,Q=C.getLineWidth(Z);if(W.mouseContentHorizontalOffset>Q){const se=createEmptyContentDataInLines(W.mouseContentHorizontalOffset-Q);return W.fulfillContentEmpty(U,se)}const J=C.visibleRangeForPosition(Z,X);if(!J)return W.fulfillUnknown(U);const ee=J.left;if(Math.abs(W.mouseContentHorizontalOffset-ee)<1)return W.fulfillContentText(U,null,{mightBeForeignElement:!!G,injectedText:G});const te=[];if(te.push({offset:J.left,column:X}),X>1){const se=C.visibleRangeForPosition(Z,X-1);se&&te.push({offset:se.left,column:X-1})}const ie=C.viewModel.getLineMaxColumn(Z);if(X<ie){const se=C.visibleRangeForPosition(Z,X+1);se&&te.push({offset:se.left,column:X+1})}te.sort((se,le)=>se.offset-le.offset);const ne=W.pos.toClientCoordinates(),oe=V.getBoundingClientRect(),re=oe.left<=ne.clientX&&ne.clientX<=oe.right;let ae=null;for(let se=1;se<te.length;se++){const le=te[se-1],ce=te[se];if(le.offset<=W.mouseContentHorizontalOffset&&W.mouseContentHorizontalOffset<=ce.offset){ae=new Range$2(Z,le.column,Z,ce.column);const de=Math.abs(le.offset-W.mouseContentHorizontalOffset),ue=Math.abs(ce.offset-W.mouseContentHorizontalOffset);U=de<ue?new Position$1(Z,le.column):new Position$1(Z,ce.column);break}}return W.fulfillContentText(U,ae,{mightBeForeignElement:!re||!!G,injectedText:G})}static _doHitTestWithCaretRangeFromPoint(C,W){const V=C.getLineNumberAtVerticalOffset(W.mouseVerticalOffset),U=C.getVerticalOffsetForLineNumber(V),G=U+C.lineHeight;if(!(V===C.viewModel.getLineCount()&&W.mouseVerticalOffset>G)){const X=Math.floor((U+G)/2);let Q=W.pos.y+(X-W.mouseVerticalOffset);Q<=W.editorPos.y&&(Q=W.editorPos.y+1),Q>=W.editorPos.y+W.editorPos.height&&(Q=W.editorPos.y+W.editorPos.height-1);const J=new PageCoordinates(W.pos.x,Q),ee=this._actualDoHitTestWithCaretRangeFromPoint(C,J.toClientCoordinates());if(ee.type===1)return ee}return this._actualDoHitTestWithCaretRangeFromPoint(C,W.pos.toClientCoordinates())}static _actualDoHitTestWithCaretRangeFromPoint(C,W){const V=getShadowRoot(C.viewDomNode);let U;if(V?typeof V.caretRangeFromPoint>"u"?U=shadowCaretRangeFromPoint(V,W.clientX,W.clientY):U=V.caretRangeFromPoint(W.clientX,W.clientY):U=C.viewDomNode.ownerDocument.caretRangeFromPoint(W.clientX,W.clientY),!U||!U.startContainer)return new UnknownHitTestResult;const G=U.startContainer;if(G.nodeType===G.TEXT_NODE){const Z=G.parentNode,X=Z?Z.parentNode:null,Q=X?X.parentNode:null;return(Q&&Q.nodeType===Q.ELEMENT_NODE?Q.className:null)===ViewLine.CLASS_NAME?HitTestResult.createFromDOMInfo(C,Z,U.startOffset):new UnknownHitTestResult(G.parentNode)}else if(G.nodeType===G.ELEMENT_NODE){const Z=G.parentNode,X=Z?Z.parentNode:null;return(X&&X.nodeType===X.ELEMENT_NODE?X.className:null)===ViewLine.CLASS_NAME?HitTestResult.createFromDOMInfo(C,G,G.textContent.length):new UnknownHitTestResult(G)}return new UnknownHitTestResult}static _doHitTestWithCaretPositionFromPoint(C,W){const V=C.viewDomNode.ownerDocument.caretPositionFromPoint(W.clientX,W.clientY);if(V.offsetNode.nodeType===V.offsetNode.TEXT_NODE){const U=V.offsetNode.parentNode,G=U?U.parentNode:null,Z=G?G.parentNode:null;return(Z&&Z.nodeType===Z.ELEMENT_NODE?Z.className:null)===ViewLine.CLASS_NAME?HitTestResult.createFromDOMInfo(C,V.offsetNode.parentNode,V.offset):new UnknownHitTestResult(V.offsetNode.parentNode)}if(V.offsetNode.nodeType===V.offsetNode.ELEMENT_NODE){const U=V.offsetNode.parentNode,G=U&&U.nodeType===U.ELEMENT_NODE?U.className:null,Z=U?U.parentNode:null,X=Z&&Z.nodeType===Z.ELEMENT_NODE?Z.className:null;if(G===ViewLine.CLASS_NAME){const Q=V.offsetNode.childNodes[Math.min(V.offset,V.offsetNode.childNodes.length-1)];if(Q)return HitTestResult.createFromDOMInfo(C,Q,0)}else if(X===ViewLine.CLASS_NAME)return HitTestResult.createFromDOMInfo(C,V.offsetNode,0)}return new UnknownHitTestResult(V.offsetNode)}static _snapToSoftTabBoundary(C,W){const V=W.getLineContent(C.lineNumber),{tabSize:U}=W.model.getOptions(),G=AtomicTabMoveOperations.atomicPosition(V,C.column-1,U,2);return G!==-1?new Position$1(C.lineNumber,G+1):C}static _doHitTest(C,W){let V=new UnknownHitTestResult;if(typeof C.viewDomNode.ownerDocument.caretRangeFromPoint=="function"?V=this._doHitTestWithCaretRangeFromPoint(C,W):C.viewDomNode.ownerDocument.caretPositionFromPoint&&(V=this._doHitTestWithCaretPositionFromPoint(C,W.pos.toClientCoordinates())),V.type===1){const U=C.viewModel.getInjectedTextAt(V.position),G=C.viewModel.normalizePosition(V.position,2);(U||!G.equals(V.position))&&(V=new ContentHitTestResult(G,V.spanNode,U))}return V}}function shadowCaretRangeFromPoint(K,C,W){const V=document.createRange();let U=K.elementFromPoint(C,W);if(U!==null){for(;U&&U.firstChild&&U.firstChild.nodeType!==U.firstChild.TEXT_NODE&&U.lastChild&&U.lastChild.firstChild;)U=U.lastChild;const G=U.getBoundingClientRect(),Z=window.getComputedStyle(U,null).getPropertyValue("font-style"),X=window.getComputedStyle(U,null).getPropertyValue("font-variant"),Q=window.getComputedStyle(U,null).getPropertyValue("font-weight"),J=window.getComputedStyle(U,null).getPropertyValue("font-size"),ee=window.getComputedStyle(U,null).getPropertyValue("line-height"),te=window.getComputedStyle(U,null).getPropertyValue("font-family"),ie=`${Z} ${X} ${Q} ${J}/${ee} ${te}`,ne=U.innerText;let oe=G.left,re=0,ae;if(C>G.left+G.width)re=ne.length;else{const se=CharWidthReader.getInstance();for(let le=0;le<ne.length+1;le++){if(ae=se.getCharWidth(ne.charAt(le),ie)/2,oe+=ae,C<oe){re=le;break}oe+=ae}}V.setStart(U.firstChild,re),V.setEnd(U.firstChild,re)}return V}class CharWidthReader{static getInstance(){return CharWidthReader._INSTANCE||(CharWidthReader._INSTANCE=new CharWidthReader),CharWidthReader._INSTANCE}constructor(){this._cache={},this._canvas=document.createElement("canvas")}getCharWidth(C,W){const V=C+W;if(this._cache[V])return this._cache[V];const U=this._canvas.getContext("2d");U.font=W;const Z=U.measureText(C).width;return this._cache[V]=Z,Z}}CharWidthReader._INSTANCE=null;let Widget$1=class extends Disposable{onclick(C,W){this._register(addDisposableListener(C,EventType$1.CLICK,V=>W(new StandardMouseEvent(V))))}onmousedown(C,W){this._register(addDisposableListener(C,EventType$1.MOUSE_DOWN,V=>W(new StandardMouseEvent(V))))}onmouseover(C,W){this._register(addDisposableListener(C,EventType$1.MOUSE_OVER,V=>W(new StandardMouseEvent(V))))}onmouseleave(C,W){this._register(addDisposableListener(C,EventType$1.MOUSE_LEAVE,V=>W(new StandardMouseEvent(V))))}onkeydown(C,W){this._register(addDisposableListener(C,EventType$1.KEY_DOWN,V=>W(new StandardKeyboardEvent(V))))}onkeyup(C,W){this._register(addDisposableListener(C,EventType$1.KEY_UP,V=>W(new StandardKeyboardEvent(V))))}oninput(C,W){this._register(addDisposableListener(C,EventType$1.INPUT,W))}onblur(C,W){this._register(addDisposableListener(C,EventType$1.BLUR,W))}onfocus(C,W){this._register(addDisposableListener(C,EventType$1.FOCUS,W))}ignoreGesture(C){return Gesture.ignoreTarget(C)}};const ARROW_IMG_SIZE=11;class ScrollbarArrow extends Widget$1{constructor(C){super(),this._onActivate=C.onActivate,this.bgDomNode=document.createElement("div"),this.bgDomNode.className="arrow-background",this.bgDomNode.style.position="absolute",this.bgDomNode.style.width=C.bgWidth+"px",this.bgDomNode.style.height=C.bgHeight+"px",typeof C.top<"u"&&(this.bgDomNode.style.top="0px"),typeof C.left<"u"&&(this.bgDomNode.style.left="0px"),typeof C.bottom<"u"&&(this.bgDomNode.style.bottom="0px"),typeof C.right<"u"&&(this.bgDomNode.style.right="0px"),this.domNode=document.createElement("div"),this.domNode.className=C.className,this.domNode.classList.add(...ThemeIcon.asClassNameArray(C.icon)),this.domNode.style.position="absolute",this.domNode.style.width=ARROW_IMG_SIZE+"px",this.domNode.style.height=ARROW_IMG_SIZE+"px",typeof C.top<"u"&&(this.domNode.style.top=C.top+"px"),typeof C.left<"u"&&(this.domNode.style.left=C.left+"px"),typeof C.bottom<"u"&&(this.domNode.style.bottom=C.bottom+"px"),typeof C.right<"u"&&(this.domNode.style.right=C.right+"px"),this._pointerMoveMonitor=this._register(new GlobalPointerMoveMonitor),this._register(addStandardDisposableListener(this.bgDomNode,EventType$1.POINTER_DOWN,W=>this._arrowPointerDown(W))),this._register(addStandardDisposableListener(this.domNode,EventType$1.POINTER_DOWN,W=>this._arrowPointerDown(W))),this._pointerdownRepeatTimer=this._register(new IntervalTimer),this._pointerdownScheduleRepeatTimer=this._register(new TimeoutTimer)}_arrowPointerDown(C){if(!C.target||!(C.target instanceof Element))return;const W=()=>{this._pointerdownRepeatTimer.cancelAndSet(()=>this._onActivate(),1e3/24)};this._onActivate(),this._pointerdownRepeatTimer.cancel(),this._pointerdownScheduleRepeatTimer.cancelAndSet(W,200),this._pointerMoveMonitor.startMonitoring(C.target,C.pointerId,C.buttons,V=>{},()=>{this._pointerdownRepeatTimer.cancel(),this._pointerdownScheduleRepeatTimer.cancel()}),C.preventDefault()}}class ScrollbarVisibilityController extends Disposable{constructor(C,W,V){super(),this._visibility=C,this._visibleClassName=W,this._invisibleClassName=V,this._domNode=null,this._isVisible=!1,this._isNeeded=!1,this._rawShouldBeVisible=!1,this._shouldBeVisible=!1,this._revealTimer=this._register(new TimeoutTimer)}setVisibility(C){this._visibility!==C&&(this._visibility=C,this._updateShouldBeVisible())}setShouldBeVisible(C){this._rawShouldBeVisible=C,this._updateShouldBeVisible()}_applyVisibilitySetting(){return this._visibility===2?!1:this._visibility===3?!0:this._rawShouldBeVisible}_updateShouldBeVisible(){const C=this._applyVisibilitySetting();this._shouldBeVisible!==C&&(this._shouldBeVisible=C,this.ensureVisibility())}setIsNeeded(C){this._isNeeded!==C&&(this._isNeeded=C,this.ensureVisibility())}setDomNode(C){this._domNode=C,this._domNode.setClassName(this._invisibleClassName),this.setShouldBeVisible(!1)}ensureVisibility(){if(!this._isNeeded){this._hide(!1);return}this._shouldBeVisible?this._reveal():this._hide(!0)}_reveal(){this._isVisible||(this._isVisible=!0,this._revealTimer.setIfNotSet(()=>{var C;(C=this._domNode)===null||C===void 0||C.setClassName(this._visibleClassName)},0))}_hide(C){var W;this._revealTimer.cancel(),this._isVisible&&(this._isVisible=!1,(W=this._domNode)===null||W===void 0||W.setClassName(this._invisibleClassName+(C?" fade":"")))}}const POINTER_DRAG_RESET_DISTANCE$1=140;class AbstractScrollbar extends Widget$1{constructor(C){super(),this._lazyRender=C.lazyRender,this._host=C.host,this._scrollable=C.scrollable,this._scrollByPage=C.scrollByPage,this._scrollbarState=C.scrollbarState,this._visibilityController=this._register(new ScrollbarVisibilityController(C.visibility,"visible scrollbar "+C.extraScrollbarClassName,"invisible scrollbar "+C.extraScrollbarClassName)),this._visibilityController.setIsNeeded(this._scrollbarState.isNeeded()),this._pointerMoveMonitor=this._register(new GlobalPointerMoveMonitor),this._shouldRender=!0,this.domNode=createFastDomNode(document.createElement("div")),this.domNode.setAttribute("role","presentation"),this.domNode.setAttribute("aria-hidden","true"),this._visibilityController.setDomNode(this.domNode),this.domNode.setPosition("absolute"),this._register(addDisposableListener(this.domNode.domNode,EventType$1.POINTER_DOWN,W=>this._domNodePointerDown(W)))}_createArrow(C){const W=this._register(new ScrollbarArrow(C));this.domNode.domNode.appendChild(W.bgDomNode),this.domNode.domNode.appendChild(W.domNode)}_createSlider(C,W,V,U){this.slider=createFastDomNode(document.createElement("div")),this.slider.setClassName("slider"),this.slider.setPosition("absolute"),this.slider.setTop(C),this.slider.setLeft(W),typeof V=="number"&&this.slider.setWidth(V),typeof U=="number"&&this.slider.setHeight(U),this.slider.setLayerHinting(!0),this.slider.setContain("strict"),this.domNode.domNode.appendChild(this.slider.domNode),this._register(addDisposableListener(this.slider.domNode,EventType$1.POINTER_DOWN,G=>{G.button===0&&(G.preventDefault(),this._sliderPointerDown(G))})),this.onclick(this.slider.domNode,G=>{G.leftButton&&G.stopPropagation()})}_onElementSize(C){return this._scrollbarState.setVisibleSize(C)&&(this._visibilityController.setIsNeeded(this._scrollbarState.isNeeded()),this._shouldRender=!0,this._lazyRender||this.render()),this._shouldRender}_onElementScrollSize(C){return this._scrollbarState.setScrollSize(C)&&(this._visibilityController.setIsNeeded(this._scrollbarState.isNeeded()),this._shouldRender=!0,this._lazyRender||this.render()),this._shouldRender}_onElementScrollPosition(C){return this._scrollbarState.setScrollPosition(C)&&(this._visibilityController.setIsNeeded(this._scrollbarState.isNeeded()),this._shouldRender=!0,this._lazyRender||this.render()),this._shouldRender}beginReveal(){this._visibilityController.setShouldBeVisible(!0)}beginHide(){this._visibilityController.setShouldBeVisible(!1)}render(){this._shouldRender&&(this._shouldRender=!1,this._renderDomNode(this._scrollbarState.getRectangleLargeSize(),this._scrollbarState.getRectangleSmallSize()),this._updateSlider(this._scrollbarState.getSliderSize(),this._scrollbarState.getArrowSize()+this._scrollbarState.getSliderPosition()))}_domNodePointerDown(C){C.target===this.domNode.domNode&&this._onPointerDown(C)}delegatePointerDown(C){const W=this.domNode.domNode.getClientRects()[0].top,V=W+this._scrollbarState.getSliderPosition(),U=W+this._scrollbarState.getSliderPosition()+this._scrollbarState.getSliderSize(),G=this._sliderPointerPosition(C);V<=G&&G<=U?C.button===0&&(C.preventDefault(),this._sliderPointerDown(C)):this._onPointerDown(C)}_onPointerDown(C){let W,V;if(C.target===this.domNode.domNode&&typeof C.offsetX=="number"&&typeof C.offsetY=="number")W=C.offsetX,V=C.offsetY;else{const G=getDomNodePagePosition(this.domNode.domNode);W=C.pageX-G.left,V=C.pageY-G.top}const U=this._pointerDownRelativePosition(W,V);this._setDesiredScrollPositionNow(this._scrollByPage?this._scrollbarState.getDesiredScrollPositionFromOffsetPaged(U):this._scrollbarState.getDesiredScrollPositionFromOffset(U)),C.button===0&&(C.preventDefault(),this._sliderPointerDown(C))}_sliderPointerDown(C){if(!C.target||!(C.target instanceof Element))return;const W=this._sliderPointerPosition(C),V=this._sliderOrthogonalPointerPosition(C),U=this._scrollbarState.clone();this.slider.toggleClassName("active",!0),this._pointerMoveMonitor.startMonitoring(C.target,C.pointerId,C.buttons,G=>{const Z=this._sliderOrthogonalPointerPosition(G),X=Math.abs(Z-V);if(isWindows&&X>POINTER_DRAG_RESET_DISTANCE$1){this._setDesiredScrollPositionNow(U.getScrollPosition());return}const J=this._sliderPointerPosition(G)-W;this._setDesiredScrollPositionNow(U.getDesiredScrollPositionFromDelta(J))},()=>{this.slider.toggleClassName("active",!1),this._host.onDragEnd()}),this._host.onDragStart()}_setDesiredScrollPositionNow(C){const W={};this.writeScrollPosition(W,C),this._scrollable.setScrollPositionNow(W)}updateScrollbarSize(C){this._updateScrollbarSize(C),this._scrollbarState.setScrollbarSize(C),this._shouldRender=!0,this._lazyRender||this.render()}isNeeded(){return this._scrollbarState.isNeeded()}}const MINIMUM_SLIDER_SIZE=20;class ScrollbarState{constructor(C,W,V,U,G,Z){this._scrollbarSize=Math.round(W),this._oppositeScrollbarSize=Math.round(V),this._arrowSize=Math.round(C),this._visibleSize=U,this._scrollSize=G,this._scrollPosition=Z,this._computedAvailableSize=0,this._computedIsNeeded=!1,this._computedSliderSize=0,this._computedSliderRatio=0,this._computedSliderPosition=0,this._refreshComputedValues()}clone(){return new ScrollbarState(this._arrowSize,this._scrollbarSize,this._oppositeScrollbarSize,this._visibleSize,this._scrollSize,this._scrollPosition)}setVisibleSize(C){const W=Math.round(C);return this._visibleSize!==W?(this._visibleSize=W,this._refreshComputedValues(),!0):!1}setScrollSize(C){const W=Math.round(C);return this._scrollSize!==W?(this._scrollSize=W,this._refreshComputedValues(),!0):!1}setScrollPosition(C){const W=Math.round(C);return this._scrollPosition!==W?(this._scrollPosition=W,this._refreshComputedValues(),!0):!1}setScrollbarSize(C){this._scrollbarSize=Math.round(C)}setOppositeScrollbarSize(C){this._oppositeScrollbarSize=Math.round(C)}static _computeValues(C,W,V,U,G){const Z=Math.max(0,V-C),X=Math.max(0,Z-2*W),Q=U>0&&U>V;if(!Q)return{computedAvailableSize:Math.round(Z),computedIsNeeded:Q,computedSliderSize:Math.round(X),computedSliderRatio:0,computedSliderPosition:0};const J=Math.round(Math.max(MINIMUM_SLIDER_SIZE,Math.floor(V*X/U))),ee=(X-J)/(U-V),te=G*ee;return{computedAvailableSize:Math.round(Z),computedIsNeeded:Q,computedSliderSize:Math.round(J),computedSliderRatio:ee,computedSliderPosition:Math.round(te)}}_refreshComputedValues(){const C=ScrollbarState._computeValues(this._oppositeScrollbarSize,this._arrowSize,this._visibleSize,this._scrollSize,this._scrollPosition);this._computedAvailableSize=C.computedAvailableSize,this._computedIsNeeded=C.computedIsNeeded,this._computedSliderSize=C.computedSliderSize,this._computedSliderRatio=C.computedSliderRatio,this._computedSliderPosition=C.computedSliderPosition}getArrowSize(){return this._arrowSize}getScrollPosition(){return this._scrollPosition}getRectangleLargeSize(){return this._computedAvailableSize}getRectangleSmallSize(){return this._scrollbarSize}isNeeded(){return this._computedIsNeeded}getSliderSize(){return this._computedSliderSize}getSliderPosition(){return this._computedSliderPosition}getDesiredScrollPositionFromOffset(C){if(!this._computedIsNeeded)return 0;const W=C-this._arrowSize-this._computedSliderSize/2;return Math.round(W/this._computedSliderRatio)}getDesiredScrollPositionFromOffsetPaged(C){if(!this._computedIsNeeded)return 0;const W=C-this._arrowSize;let V=this._scrollPosition;return W<this._computedSliderPosition?V-=this._visibleSize:V+=this._visibleSize,V}getDesiredScrollPositionFromDelta(C){if(!this._computedIsNeeded)return 0;const W=this._computedSliderPosition+C;return Math.round(W/this._computedSliderRatio)}}class HorizontalScrollbar extends AbstractScrollbar{constructor(C,W,V){const U=C.getScrollDimensions(),G=C.getCurrentScrollPosition();if(super({lazyRender:W.lazyRender,host:V,scrollbarState:new ScrollbarState(W.horizontalHasArrows?W.arrowSize:0,W.horizontal===2?0:W.horizontalScrollbarSize,W.vertical===2?0:W.verticalScrollbarSize,U.width,U.scrollWidth,G.scrollLeft),visibility:W.horizontal,extraScrollbarClassName:"horizontal",scrollable:C,scrollByPage:W.scrollByPage}),W.horizontalHasArrows){const Z=(W.arrowSize-ARROW_IMG_SIZE)/2,X=(W.horizontalScrollbarSize-ARROW_IMG_SIZE)/2;this._createArrow({className:"scra",icon:Codicon.scrollbarButtonLeft,top:X,left:Z,bottom:void 0,right:void 0,bgWidth:W.arrowSize,bgHeight:W.horizontalScrollbarSize,onActivate:()=>this._host.onMouseWheel(new StandardWheelEvent(null,1,0))}),this._createArrow({className:"scra",icon:Codicon.scrollbarButtonRight,top:X,left:void 0,bottom:void 0,right:Z,bgWidth:W.arrowSize,bgHeight:W.horizontalScrollbarSize,onActivate:()=>this._host.onMouseWheel(new StandardWheelEvent(null,-1,0))})}this._createSlider(Math.floor((W.horizontalScrollbarSize-W.horizontalSliderSize)/2),0,void 0,W.horizontalSliderSize)}_updateSlider(C,W){this.slider.setWidth(C),this.slider.setLeft(W)}_renderDomNode(C,W){this.domNode.setWidth(C),this.domNode.setHeight(W),this.domNode.setLeft(0),this.domNode.setBottom(0)}onDidScroll(C){return this._shouldRender=this._onElementScrollSize(C.scrollWidth)||this._shouldRender,this._shouldRender=this._onElementScrollPosition(C.scrollLeft)||this._shouldRender,this._shouldRender=this._onElementSize(C.width)||this._shouldRender,this._shouldRender}_pointerDownRelativePosition(C,W){return C}_sliderPointerPosition(C){return C.pageX}_sliderOrthogonalPointerPosition(C){return C.pageY}_updateScrollbarSize(C){this.slider.setHeight(C)}writeScrollPosition(C,W){C.scrollLeft=W}updateOptions(C){this.updateScrollbarSize(C.horizontal===2?0:C.horizontalScrollbarSize),this._scrollbarState.setOppositeScrollbarSize(C.vertical===2?0:C.verticalScrollbarSize),this._visibilityController.setVisibility(C.horizontal),this._scrollByPage=C.scrollByPage}}class VerticalScrollbar extends AbstractScrollbar{constructor(C,W,V){const U=C.getScrollDimensions(),G=C.getCurrentScrollPosition();if(super({lazyRender:W.lazyRender,host:V,scrollbarState:new ScrollbarState(W.verticalHasArrows?W.arrowSize:0,W.vertical===2?0:W.verticalScrollbarSize,0,U.height,U.scrollHeight,G.scrollTop),visibility:W.vertical,extraScrollbarClassName:"vertical",scrollable:C,scrollByPage:W.scrollByPage}),W.verticalHasArrows){const Z=(W.arrowSize-ARROW_IMG_SIZE)/2,X=(W.verticalScrollbarSize-ARROW_IMG_SIZE)/2;this._createArrow({className:"scra",icon:Codicon.scrollbarButtonUp,top:Z,left:X,bottom:void 0,right:void 0,bgWidth:W.verticalScrollbarSize,bgHeight:W.arrowSize,onActivate:()=>this._host.onMouseWheel(new StandardWheelEvent(null,0,1))}),this._createArrow({className:"scra",icon:Codicon.scrollbarButtonDown,top:void 0,left:X,bottom:Z,right:void 0,bgWidth:W.verticalScrollbarSize,bgHeight:W.arrowSize,onActivate:()=>this._host.onMouseWheel(new StandardWheelEvent(null,0,-1))})}this._createSlider(0,Math.floor((W.verticalScrollbarSize-W.verticalSliderSize)/2),W.verticalSliderSize,void 0)}_updateSlider(C,W){this.slider.setHeight(C),this.slider.setTop(W)}_renderDomNode(C,W){this.domNode.setWidth(W),this.domNode.setHeight(C),this.domNode.setRight(0),this.domNode.setTop(0)}onDidScroll(C){return this._shouldRender=this._onElementScrollSize(C.scrollHeight)||this._shouldRender,this._shouldRender=this._onElementScrollPosition(C.scrollTop)||this._shouldRender,this._shouldRender=this._onElementSize(C.height)||this._shouldRender,this._shouldRender}_pointerDownRelativePosition(C,W){return W}_sliderPointerPosition(C){return C.pageY}_sliderOrthogonalPointerPosition(C){return C.pageX}_updateScrollbarSize(C){this.slider.setWidth(C)}writeScrollPosition(C,W){C.scrollTop=W}updateOptions(C){this.updateScrollbarSize(C.vertical===2?0:C.verticalScrollbarSize),this._scrollbarState.setOppositeScrollbarSize(0),this._visibilityController.setVisibility(C.vertical),this._scrollByPage=C.scrollByPage}}class ScrollState{constructor(C,W,V,U,G,Z,X){this._forceIntegerValues=C,this._scrollStateBrand=void 0,this._forceIntegerValues&&(W=W|0,V=V|0,U=U|0,G=G|0,Z=Z|0,X=X|0),this.rawScrollLeft=U,this.rawScrollTop=X,W<0&&(W=0),U+W>V&&(U=V-W),U<0&&(U=0),G<0&&(G=0),X+G>Z&&(X=Z-G),X<0&&(X=0),this.width=W,this.scrollWidth=V,this.scrollLeft=U,this.height=G,this.scrollHeight=Z,this.scrollTop=X}equals(C){return this.rawScrollLeft===C.rawScrollLeft&&this.rawScrollTop===C.rawScrollTop&&this.width===C.width&&this.scrollWidth===C.scrollWidth&&this.scrollLeft===C.scrollLeft&&this.height===C.height&&this.scrollHeight===C.scrollHeight&&this.scrollTop===C.scrollTop}withScrollDimensions(C,W){return new ScrollState(this._forceIntegerValues,typeof C.width<"u"?C.width:this.width,typeof C.scrollWidth<"u"?C.scrollWidth:this.scrollWidth,W?this.rawScrollLeft:this.scrollLeft,typeof C.height<"u"?C.height:this.height,typeof C.scrollHeight<"u"?C.scrollHeight:this.scrollHeight,W?this.rawScrollTop:this.scrollTop)}withScrollPosition(C){return new ScrollState(this._forceIntegerValues,this.width,this.scrollWidth,typeof C.scrollLeft<"u"?C.scrollLeft:this.rawScrollLeft,this.height,this.scrollHeight,typeof C.scrollTop<"u"?C.scrollTop:this.rawScrollTop)}createScrollEvent(C,W){const V=this.width!==C.width,U=this.scrollWidth!==C.scrollWidth,G=this.scrollLeft!==C.scrollLeft,Z=this.height!==C.height,X=this.scrollHeight!==C.scrollHeight,Q=this.scrollTop!==C.scrollTop;return{inSmoothScrolling:W,oldWidth:C.width,oldScrollWidth:C.scrollWidth,oldScrollLeft:C.scrollLeft,width:this.width,scrollWidth:this.scrollWidth,scrollLeft:this.scrollLeft,oldHeight:C.height,oldScrollHeight:C.scrollHeight,oldScrollTop:C.scrollTop,height:this.height,scrollHeight:this.scrollHeight,scrollTop:this.scrollTop,widthChanged:V,scrollWidthChanged:U,scrollLeftChanged:G,heightChanged:Z,scrollHeightChanged:X,scrollTopChanged:Q}}}class Scrollable extends Disposable{constructor(C){super(),this._scrollableBrand=void 0,this._onScroll=this._register(new Emitter$1),this.onScroll=this._onScroll.event,this._smoothScrollDuration=C.smoothScrollDuration,this._scheduleAtNextAnimationFrame=C.scheduleAtNextAnimationFrame,this._state=new ScrollState(C.forceIntegerValues,0,0,0,0,0,0),this._smoothScrolling=null}dispose(){this._smoothScrolling&&(this._smoothScrolling.dispose(),this._smoothScrolling=null),super.dispose()}setSmoothScrollDuration(C){this._smoothScrollDuration=C}validateScrollPosition(C){return this._state.withScrollPosition(C)}getScrollDimensions(){return this._state}setScrollDimensions(C,W){var V;const U=this._state.withScrollDimensions(C,W);this._setState(U,!!this._smoothScrolling),(V=this._smoothScrolling)===null||V===void 0||V.acceptScrollDimensions(this._state)}getFutureScrollPosition(){return this._smoothScrolling?this._smoothScrolling.to:this._state}getCurrentScrollPosition(){return this._state}setScrollPositionNow(C){const W=this._state.withScrollPosition(C);this._smoothScrolling&&(this._smoothScrolling.dispose(),this._smoothScrolling=null),this._setState(W,!1)}setScrollPositionSmooth(C,W){if(this._smoothScrollDuration===0)return this.setScrollPositionNow(C);if(this._smoothScrolling){C={scrollLeft:typeof C.scrollLeft>"u"?this._smoothScrolling.to.scrollLeft:C.scrollLeft,scrollTop:typeof C.scrollTop>"u"?this._smoothScrolling.to.scrollTop:C.scrollTop};const V=this._state.withScrollPosition(C);if(this._smoothScrolling.to.scrollLeft===V.scrollLeft&&this._smoothScrolling.to.scrollTop===V.scrollTop)return;let U;W?U=new SmoothScrollingOperation(this._smoothScrolling.from,V,this._smoothScrolling.startTime,this._smoothScrolling.duration):U=this._smoothScrolling.combine(this._state,V,this._smoothScrollDuration),this._smoothScrolling.dispose(),this._smoothScrolling=U}else{const V=this._state.withScrollPosition(C);this._smoothScrolling=SmoothScrollingOperation.start(this._state,V,this._smoothScrollDuration)}this._smoothScrolling.animationFrameDisposable=this._scheduleAtNextAnimationFrame(()=>{this._smoothScrolling&&(this._smoothScrolling.animationFrameDisposable=null,this._performSmoothScrolling())})}hasPendingScrollAnimation(){return!!this._smoothScrolling}_performSmoothScrolling(){if(!this._smoothScrolling)return;const C=this._smoothScrolling.tick(),W=this._state.withScrollPosition(C);if(this._setState(W,!0),!!this._smoothScrolling){if(C.isDone){this._smoothScrolling.dispose(),this._smoothScrolling=null;return}this._smoothScrolling.animationFrameDisposable=this._scheduleAtNextAnimationFrame(()=>{this._smoothScrolling&&(this._smoothScrolling.animationFrameDisposable=null,this._performSmoothScrolling())})}}_setState(C,W){const V=this._state;V.equals(C)||(this._state=C,this._onScroll.fire(this._state.createScrollEvent(V,W)))}}class SmoothScrollingUpdate{constructor(C,W,V){this.scrollLeft=C,this.scrollTop=W,this.isDone=V}}function createEaseOutCubic(K,C){const W=C-K;return function(V){return K+W*easeOutCubic(V)}}function createComposed(K,C,W){return function(V){return V<W?K(V/W):C((V-W)/(1-W))}}class SmoothScrollingOperation{constructor(C,W,V,U){this.from=C,this.to=W,this.duration=U,this.startTime=V,this.animationFrameDisposable=null,this._initAnimations()}_initAnimations(){this.scrollLeft=this._initAnimation(this.from.scrollLeft,this.to.scrollLeft,this.to.width),this.scrollTop=this._initAnimation(this.from.scrollTop,this.to.scrollTop,this.to.height)}_initAnimation(C,W,V){if(Math.abs(C-W)>2.5*V){let G,Z;return C<W?(G=C+.75*V,Z=W-.75*V):(G=C-.75*V,Z=W+.75*V),createComposed(createEaseOutCubic(C,G),createEaseOutCubic(Z,W),.33)}return createEaseOutCubic(C,W)}dispose(){this.animationFrameDisposable!==null&&(this.animationFrameDisposable.dispose(),this.animationFrameDisposable=null)}acceptScrollDimensions(C){this.to=C.withScrollPosition(this.to),this._initAnimations()}tick(){return this._tick(Date.now())}_tick(C){const W=(C-this.startTime)/this.duration;if(W<1){const V=this.scrollLeft(W),U=this.scrollTop(W);return new SmoothScrollingUpdate(V,U,!1)}return new SmoothScrollingUpdate(this.to.scrollLeft,this.to.scrollTop,!0)}combine(C,W,V){return SmoothScrollingOperation.start(C,W,V)}static start(C,W,V){V=V+10;const U=Date.now()-10;return new SmoothScrollingOperation(C,W,U,V)}}function easeInCubic(K){return Math.pow(K,3)}function easeOutCubic(K){return 1-easeInCubic(1-K)}const scrollbars="",HIDE_TIMEOUT=500,SCROLL_WHEEL_SENSITIVITY=50;class MouseWheelClassifierItem{constructor(C,W,V){this.timestamp=C,this.deltaX=W,this.deltaY=V,this.score=0}}class MouseWheelClassifier{constructor(){this._capacity=5,this._memory=[],this._front=-1,this._rear=-1}isPhysicalMouseWheel(){if(this._front===-1&&this._rear===-1)return!1;let C=1,W=0,V=1,U=this._rear;do{const G=U===this._front?C:Math.pow(2,-V);if(C-=G,W+=this._memory[U].score*G,U===this._front)break;U=(this._capacity+U-1)%this._capacity,V++}while(!0);return W<=.5}acceptStandardWheelEvent(C){const W=window.devicePixelRatio/getZoomFactor();isWindows||isLinux?this.accept(Date.now(),C.deltaX/W,C.deltaY/W):this.accept(Date.now(),C.deltaX,C.deltaY)}accept(C,W,V){const U=new MouseWheelClassifierItem(C,W,V);U.score=this._computeScore(U),this._front===-1&&this._rear===-1?(this._memory[0]=U,this._front=0,this._rear=0):(this._rear=(this._rear+1)%this._capacity,this._rear===this._front&&(this._front=(this._front+1)%this._capacity),this._memory[this._rear]=U)}_computeScore(C){if(Math.abs(C.deltaX)>0&&Math.abs(C.deltaY)>0)return 1;let W=.5;return this._front===-1&&this._rear===-1||this._memory[this._rear],(!this._isAlmostInt(C.deltaX)||!this._isAlmostInt(C.deltaY))&&(W+=.25),Math.min(Math.max(W,0),1)}_isAlmostInt(C){return Math.abs(Math.round(C)-C)<.01}}MouseWheelClassifier.INSTANCE=new MouseWheelClassifier;class AbstractScrollableElement extends Widget$1{get options(){return this._options}constructor(C,W,V){super(),this._onScroll=this._register(new Emitter$1),this.onScroll=this._onScroll.event,this._onWillScroll=this._register(new Emitter$1),C.style.overflow="hidden",this._options=resolveOptions$1(W),this._scrollable=V,this._register(this._scrollable.onScroll(G=>{this._onWillScroll.fire(G),this._onDidScroll(G),this._onScroll.fire(G)}));const U={onMouseWheel:G=>this._onMouseWheel(G),onDragStart:()=>this._onDragStart(),onDragEnd:()=>this._onDragEnd()};this._verticalScrollbar=this._register(new VerticalScrollbar(this._scrollable,this._options,U)),this._horizontalScrollbar=this._register(new HorizontalScrollbar(this._scrollable,this._options,U)),this._domNode=document.createElement("div"),this._domNode.className="monaco-scrollable-element "+this._options.className,this._domNode.setAttribute("role","presentation"),this._domNode.style.position="relative",this._domNode.style.overflow="hidden",this._domNode.appendChild(C),this._domNode.appendChild(this._horizontalScrollbar.domNode.domNode),this._domNode.appendChild(this._verticalScrollbar.domNode.domNode),this._options.useShadows?(this._leftShadowDomNode=createFastDomNode(document.createElement("div")),this._leftShadowDomNode.setClassName("shadow"),this._domNode.appendChild(this._leftShadowDomNode.domNode),this._topShadowDomNode=createFastDomNode(document.createElement("div")),this._topShadowDomNode.setClassName("shadow"),this._domNode.appendChild(this._topShadowDomNode.domNode),this._topLeftShadowDomNode=createFastDomNode(document.createElement("div")),this._topLeftShadowDomNode.setClassName("shadow"),this._domNode.appendChild(this._topLeftShadowDomNode.domNode)):(this._leftShadowDomNode=null,this._topShadowDomNode=null,this._topLeftShadowDomNode=null),this._listenOnDomNode=this._options.listenOnDomNode||this._domNode,this._mouseWheelToDispose=[],this._setListeningToMouseWheel(this._options.handleMouseWheel),this.onmouseover(this._listenOnDomNode,G=>this._onMouseOver(G)),this.onmouseleave(this._listenOnDomNode,G=>this._onMouseLeave(G)),this._hideTimeout=this._register(new TimeoutTimer),this._isDragging=!1,this._mouseIsOver=!1,this._shouldRender=!0,this._revealOnScroll=!0}dispose(){this._mouseWheelToDispose=dispose(this._mouseWheelToDispose),super.dispose()}getDomNode(){return this._domNode}getOverviewRulerLayoutInfo(){return{parent:this._domNode,insertBefore:this._verticalScrollbar.domNode.domNode}}delegateVerticalScrollbarPointerDown(C){this._verticalScrollbar.delegatePointerDown(C)}getScrollDimensions(){return this._scrollable.getScrollDimensions()}setScrollDimensions(C){this._scrollable.setScrollDimensions(C,!1)}updateClassName(C){this._options.className=C,isMacintosh&&(this._options.className+=" mac"),this._domNode.className="monaco-scrollable-element "+this._options.className}updateOptions(C){typeof C.handleMouseWheel<"u"&&(this._options.handleMouseWheel=C.handleMouseWheel,this._setListeningToMouseWheel(this._options.handleMouseWheel)),typeof C.mouseWheelScrollSensitivity<"u"&&(this._options.mouseWheelScrollSensitivity=C.mouseWheelScrollSensitivity),typeof C.fastScrollSensitivity<"u"&&(this._options.fastScrollSensitivity=C.fastScrollSensitivity),typeof C.scrollPredominantAxis<"u"&&(this._options.scrollPredominantAxis=C.scrollPredominantAxis),typeof C.horizontal<"u"&&(this._options.horizontal=C.horizontal),typeof C.vertical<"u"&&(this._options.vertical=C.vertical),typeof C.horizontalScrollbarSize<"u"&&(this._options.horizontalScrollbarSize=C.horizontalScrollbarSize),typeof C.verticalScrollbarSize<"u"&&(this._options.verticalScrollbarSize=C.verticalScrollbarSize),typeof C.scrollByPage<"u"&&(this._options.scrollByPage=C.scrollByPage),this._horizontalScrollbar.updateOptions(this._options),this._verticalScrollbar.updateOptions(this._options),this._options.lazyRender||this._render()}delegateScrollFromMouseWheelEvent(C){this._onMouseWheel(new StandardWheelEvent(C))}_setListeningToMouseWheel(C){if(this._mouseWheelToDispose.length>0!==C&&(this._mouseWheelToDispose=dispose(this._mouseWheelToDispose),C)){const V=U=>{this._onMouseWheel(new StandardWheelEvent(U))};this._mouseWheelToDispose.push(addDisposableListener(this._listenOnDomNode,EventType$1.MOUSE_WHEEL,V,{passive:!1}))}}_onMouseWheel(C){var W;if(!((W=C.browserEvent)===null||W===void 0)&&W.defaultPrevented)return;const V=MouseWheelClassifier.INSTANCE;V.acceptStandardWheelEvent(C);let U=!1;if(C.deltaY||C.deltaX){let Z=C.deltaY*this._options.mouseWheelScrollSensitivity,X=C.deltaX*this._options.mouseWheelScrollSensitivity;this._options.scrollPredominantAxis&&(this._options.scrollYToX&&X+Z===0?X=Z=0:Math.abs(Z)>=Math.abs(X)?X=0:Z=0),this._options.flipAxes&&([Z,X]=[X,Z]);const Q=!isMacintosh&&C.browserEvent&&C.browserEvent.shiftKey;(this._options.scrollYToX||Q)&&!X&&(X=Z,Z=0),C.browserEvent&&C.browserEvent.altKey&&(X=X*this._options.fastScrollSensitivity,Z=Z*this._options.fastScrollSensitivity);const J=this._scrollable.getFutureScrollPosition();let ee={};if(Z){const te=SCROLL_WHEEL_SENSITIVITY*Z,ie=J.scrollTop-(te<0?Math.floor(te):Math.ceil(te));this._verticalScrollbar.writeScrollPosition(ee,ie)}if(X){const te=SCROLL_WHEEL_SENSITIVITY*X,ie=J.scrollLeft-(te<0?Math.floor(te):Math.ceil(te));this._horizontalScrollbar.writeScrollPosition(ee,ie)}ee=this._scrollable.validateScrollPosition(ee),(J.scrollLeft!==ee.scrollLeft||J.scrollTop!==ee.scrollTop)&&(this._options.mouseWheelSmoothScroll&&V.isPhysicalMouseWheel()?this._scrollable.setScrollPositionSmooth(ee):this._scrollable.setScrollPositionNow(ee),U=!0)}let G=U;!G&&this._options.alwaysConsumeMouseWheel&&(G=!0),!G&&this._options.consumeMouseWheelIfScrollbarIsNeeded&&(this._verticalScrollbar.isNeeded()||this._horizontalScrollbar.isNeeded())&&(G=!0),G&&(C.preventDefault(),C.stopPropagation())}_onDidScroll(C){this._shouldRender=this._horizontalScrollbar.onDidScroll(C)||this._shouldRender,this._shouldRender=this._verticalScrollbar.onDidScroll(C)||this._shouldRender,this._options.useShadows&&(this._shouldRender=!0),this._revealOnScroll&&this._reveal(),this._options.lazyRender||this._render()}renderNow(){if(!this._options.lazyRender)throw new Error("Please use `lazyRender` together with `renderNow`!");this._render()}_render(){if(this._shouldRender&&(this._shouldRender=!1,this._horizontalScrollbar.render(),this._verticalScrollbar.render(),this._options.useShadows)){const C=this._scrollable.getCurrentScrollPosition(),W=C.scrollTop>0,V=C.scrollLeft>0,U=V?" left":"",G=W?" top":"",Z=V||W?" top-left-corner":"";this._leftShadowDomNode.setClassName(`shadow${U}`),this._topShadowDomNode.setClassName(`shadow${G}`),this._topLeftShadowDomNode.setClassName(`shadow${Z}${G}${U}`)}}_onDragStart(){this._isDragging=!0,this._reveal()}_onDragEnd(){this._isDragging=!1,this._hide()}_onMouseLeave(C){this._mouseIsOver=!1,this._hide()}_onMouseOver(C){this._mouseIsOver=!0,this._reveal()}_reveal(){this._verticalScrollbar.beginReveal(),this._horizontalScrollbar.beginReveal(),this._scheduleHide()}_hide(){!this._mouseIsOver&&!this._isDragging&&(this._verticalScrollbar.beginHide(),this._horizontalScrollbar.beginHide())}_scheduleHide(){!this._mouseIsOver&&!this._isDragging&&this._hideTimeout.cancelAndSet(()=>this._hide(),HIDE_TIMEOUT)}}class ScrollableElement extends AbstractScrollableElement{constructor(C,W){W=W||{},W.mouseWheelSmoothScroll=!1;const V=new Scrollable({forceIntegerValues:!0,smoothScrollDuration:0,scheduleAtNextAnimationFrame:U=>scheduleAtNextAnimationFrame(U)});super(C,W,V),this._register(V)}setScrollPosition(C){this._scrollable.setScrollPositionNow(C)}}class SmoothScrollableElement extends AbstractScrollableElement{constructor(C,W,V){super(C,W,V)}setScrollPosition(C){C.reuseAnimation?this._scrollable.setScrollPositionSmooth(C,C.reuseAnimation):this._scrollable.setScrollPositionNow(C)}getScrollPosition(){return this._scrollable.getCurrentScrollPosition()}}class DomScrollableElement extends AbstractScrollableElement{constructor(C,W){W=W||{},W.mouseWheelSmoothScroll=!1;const V=new Scrollable({forceIntegerValues:!1,smoothScrollDuration:0,scheduleAtNextAnimationFrame:U=>scheduleAtNextAnimationFrame(U)});super(C,W,V),this._register(V),this._element=C,this._register(this.onScroll(U=>{U.scrollTopChanged&&(this._element.scrollTop=U.scrollTop),U.scrollLeftChanged&&(this._element.scrollLeft=U.scrollLeft)})),this.scanDomNode()}setScrollPosition(C){this._scrollable.setScrollPositionNow(C)}getScrollPosition(){return this._scrollable.getCurrentScrollPosition()}scanDomNode(){this.setScrollDimensions({width:this._element.clientWidth,scrollWidth:this._element.scrollWidth,height:this._element.clientHeight,scrollHeight:this._element.scrollHeight}),this.setScrollPosition({scrollLeft:this._element.scrollLeft,scrollTop:this._element.scrollTop})}}function resolveOptions$1(K){const C={lazyRender:typeof K.lazyRender<"u"?K.lazyRender:!1,className:typeof K.className<"u"?K.className:"",useShadows:typeof K.useShadows<"u"?K.useShadows:!0,handleMouseWheel:typeof K.handleMouseWheel<"u"?K.handleMouseWheel:!0,flipAxes:typeof K.flipAxes<"u"?K.flipAxes:!1,consumeMouseWheelIfScrollbarIsNeeded:typeof K.consumeMouseWheelIfScrollbarIsNeeded<"u"?K.consumeMouseWheelIfScrollbarIsNeeded:!1,alwaysConsumeMouseWheel:typeof K.alwaysConsumeMouseWheel<"u"?K.alwaysConsumeMouseWheel:!1,scrollYToX:typeof K.scrollYToX<"u"?K.scrollYToX:!1,mouseWheelScrollSensitivity:typeof K.mouseWheelScrollSensitivity<"u"?K.mouseWheelScrollSensitivity:1,fastScrollSensitivity:typeof K.fastScrollSensitivity<"u"?K.fastScrollSensitivity:5,scrollPredominantAxis:typeof K.scrollPredominantAxis<"u"?K.scrollPredominantAxis:!0,mouseWheelSmoothScroll:typeof K.mouseWheelSmoothScroll<"u"?K.mouseWheelSmoothScroll:!0,arrowSize:typeof K.arrowSize<"u"?K.arrowSize:11,listenOnDomNode:typeof K.listenOnDomNode<"u"?K.listenOnDomNode:null,horizontal:typeof K.horizontal<"u"?K.horizontal:1,horizontalScrollbarSize:typeof K.horizontalScrollbarSize<"u"?K.horizontalScrollbarSize:10,horizontalSliderSize:typeof K.horizontalSliderSize<"u"?K.horizontalSliderSize:0,horizontalHasArrows:typeof K.horizontalHasArrows<"u"?K.horizontalHasArrows:!1,vertical:typeof K.vertical<"u"?K.vertical:1,verticalScrollbarSize:typeof K.verticalScrollbarSize<"u"?K.verticalScrollbarSize:10,verticalHasArrows:typeof K.verticalHasArrows<"u"?K.verticalHasArrows:!1,verticalSliderSize:typeof K.verticalSliderSize<"u"?K.verticalSliderSize:0,scrollByPage:typeof K.scrollByPage<"u"?K.scrollByPage:!1};return C.horizontalSliderSize=typeof K.horizontalSliderSize<"u"?K.horizontalSliderSize:C.horizontalScrollbarSize,C.verticalSliderSize=typeof K.verticalSliderSize<"u"?K.verticalSliderSize:C.verticalScrollbarSize,isMacintosh&&(C.className+=" mac"),C}class MouseHandler extends ViewEventHandler{constructor(C,W,V){super(),this._mouseLeaveMonitor=null,this._context=C,this.viewController=W,this.viewHelper=V,this.mouseTargetFactory=new MouseTargetFactory(this._context,V),this._mouseDownOperation=this._register(new MouseDownOperation(this._context,this.viewController,this.viewHelper,this.mouseTargetFactory,(Z,X)=>this._createMouseTarget(Z,X),Z=>this._getMouseColumn(Z))),this.lastMouseLeaveTime=-1,this._height=this._context.configuration.options.get(143).height;const U=new EditorMouseEventFactory(this.viewHelper.viewDomNode);this._register(U.onContextMenu(this.viewHelper.viewDomNode,Z=>this._onContextMenu(Z,!0))),this._register(U.onMouseMove(this.viewHelper.viewDomNode,Z=>{this._onMouseMove(Z),this._mouseLeaveMonitor||(this._mouseLeaveMonitor=addDisposableListener(this.viewHelper.viewDomNode.ownerDocument,"mousemove",X=>{this.viewHelper.viewDomNode.contains(X.target)||this._onMouseLeave(new EditorMouseEvent(X,!1,this.viewHelper.viewDomNode))}))})),this._register(U.onMouseUp(this.viewHelper.viewDomNode,Z=>this._onMouseUp(Z))),this._register(U.onMouseLeave(this.viewHelper.viewDomNode,Z=>this._onMouseLeave(Z)));let G=0;this._register(U.onPointerDown(this.viewHelper.viewDomNode,(Z,X)=>{G=X})),this._register(addDisposableListener(this.viewHelper.viewDomNode,EventType$1.POINTER_UP,Z=>{this._mouseDownOperation.onPointerUp()})),this._register(U.onMouseDown(this.viewHelper.viewDomNode,Z=>this._onMouseDown(Z,G))),this._setupMouseWheelZoomListener(),this._context.addEventHandler(this)}_setupMouseWheelZoomListener(){const C=MouseWheelClassifier.INSTANCE;let W=0,V=EditorZoom.getZoomLevel(),U=!1,G=0;const Z=Q=>{if(this.viewController.emitMouseWheel(Q),!this._context.configuration.options.get(75))return;const J=new StandardWheelEvent(Q);if(C.acceptStandardWheelEvent(J),C.isPhysicalMouseWheel()){if(X(Q)){const ee=EditorZoom.getZoomLevel(),te=J.deltaY>0?1:-1;EditorZoom.setZoomLevel(ee+te),J.preventDefault(),J.stopPropagation()}}else Date.now()-W>50&&(V=EditorZoom.getZoomLevel(),U=X(Q),G=0),W=Date.now(),G+=J.deltaY,U&&(EditorZoom.setZoomLevel(V+G/5),J.preventDefault(),J.stopPropagation())};this._register(addDisposableListener(this.viewHelper.viewDomNode,EventType$1.MOUSE_WHEEL,Z,{capture:!0,passive:!1}));function X(Q){return isMacintosh?(Q.metaKey||Q.ctrlKey)&&!Q.shiftKey&&!Q.altKey:Q.ctrlKey&&!Q.metaKey&&!Q.shiftKey&&!Q.altKey}}dispose(){this._context.removeEventHandler(this),this._mouseLeaveMonitor&&(this._mouseLeaveMonitor.dispose(),this._mouseLeaveMonitor=null),super.dispose()}onConfigurationChanged(C){if(C.hasChanged(143)){const W=this._context.configuration.options.get(143).height;this._height!==W&&(this._height=W,this._mouseDownOperation.onHeightChanged())}return!1}onCursorStateChanged(C){return this._mouseDownOperation.onCursorStateChanged(C),!1}onFocusChanged(C){return!1}getTargetAtClientPoint(C,W){const U=new ClientCoordinates(C,W).toPageCoordinates(),G=createEditorPagePosition(this.viewHelper.viewDomNode);if(U.y<G.y||U.y>G.y+G.height||U.x<G.x||U.x>G.x+G.width)return null;const Z=createCoordinatesRelativeToEditor(this.viewHelper.viewDomNode,G,U);return this.mouseTargetFactory.createMouseTarget(this.viewHelper.getLastRenderData(),G,U,Z,null)}_createMouseTarget(C,W){let V=C.target;if(!this.viewHelper.viewDomNode.contains(V)){const U=getShadowRoot(this.viewHelper.viewDomNode);U&&(V=U.elementsFromPoint(C.posx,C.posy).find(G=>this.viewHelper.viewDomNode.contains(G)))}return this.mouseTargetFactory.createMouseTarget(this.viewHelper.getLastRenderData(),C.editorPos,C.pos,C.relativePos,W?V:null)}_getMouseColumn(C){return this.mouseTargetFactory.getMouseColumn(C.relativePos)}_onContextMenu(C,W){this.viewController.emitContextMenu({event:C,target:this._createMouseTarget(C,W)})}_onMouseMove(C){this.mouseTargetFactory.mouseTargetIsWidget(C)||C.preventDefault(),!(this._mouseDownOperation.isActive()||C.timestamp<this.lastMouseLeaveTime)&&this.viewController.emitMouseMove({event:C,target:this._createMouseTarget(C,!0)})}_onMouseLeave(C){this._mouseLeaveMonitor&&(this._mouseLeaveMonitor.dispose(),this._mouseLeaveMonitor=null),this.lastMouseLeaveTime=new Date().getTime(),this.viewController.emitMouseLeave({event:C,target:null})}_onMouseUp(C){this.viewController.emitMouseUp({event:C,target:this._createMouseTarget(C,!0)})}_onMouseDown(C,W){const V=this._createMouseTarget(C,!0),U=V.type===6||V.type===7,G=V.type===2||V.type===3||V.type===4,Z=V.type===3,X=this._context.configuration.options.get(108),Q=V.type===8||V.type===5,J=V.type===9;let ee=C.leftButton||C.middleButton;isMacintosh&&C.leftButton&&C.ctrlKey&&(ee=!1);const te=()=>{C.preventDefault(),this.viewHelper.focusTextArea()};if(ee&&(U||Z&&X))te(),this._mouseDownOperation.start(V.type,C,W);else if(G)C.preventDefault();else if(Q){const ie=V.detail;ee&&this.viewHelper.shouldSuppressMouseDownOnViewZone(ie.viewZoneId)&&(te(),this._mouseDownOperation.start(V.type,C,W),C.preventDefault())}else J&&this.viewHelper.shouldSuppressMouseDownOnWidget(V.detail)&&(te(),C.preventDefault());this.viewController.emitMouseDown({event:C,target:V})}}class MouseDownOperation extends Disposable{constructor(C,W,V,U,G,Z){super(),this._context=C,this._viewController=W,this._viewHelper=V,this._mouseTargetFactory=U,this._createMouseTarget=G,this._getMouseColumn=Z,this._mouseMoveMonitor=this._register(new GlobalEditorPointerMoveMonitor(this._viewHelper.viewDomNode)),this._topBottomDragScrolling=this._register(new TopBottomDragScrolling(this._context,this._viewHelper,this._mouseTargetFactory,(X,Q,J)=>this._dispatchMouse(X,Q,J))),this._mouseState=new MouseDownState,this._currentSelection=new Selection$1(1,1,1,1),this._isActive=!1,this._lastMouseEvent=null}dispose(){super.dispose()}isActive(){return this._isActive}_onMouseDownThenMove(C){this._lastMouseEvent=C,this._mouseState.setModifiers(C);const W=this._findMousePosition(C,!1);W&&(this._mouseState.isDragAndDrop?this._viewController.emitMouseDrag({event:C,target:W}):W.type===13&&(W.outsidePosition==="above"||W.outsidePosition==="below")?this._topBottomDragScrolling.start(W,C):(this._topBottomDragScrolling.stop(),this._dispatchMouse(W,!0,1)))}start(C,W,V){this._lastMouseEvent=W,this._mouseState.setStartedOnLineNumbers(C===3),this._mouseState.setStartButtons(W),this._mouseState.setModifiers(W);const U=this._findMousePosition(W,!0);if(!U||!U.position)return;this._mouseState.trySetCount(W.detail,U.position),W.detail=this._mouseState.count;const G=this._context.configuration.options;if(!G.get(90)&&G.get(35)&&!G.get(22)&&!this._mouseState.altKey&&W.detail<2&&!this._isActive&&!this._currentSelection.isEmpty()&&U.type===6&&U.position&&this._currentSelection.containsPosition(U.position)){this._mouseState.isDragAndDrop=!0,this._isActive=!0,this._mouseMoveMonitor.startMonitoring(this._viewHelper.viewLinesDomNode,V,W.buttons,Z=>this._onMouseDownThenMove(Z),Z=>{const X=this._findMousePosition(this._lastMouseEvent,!1);Z&&Z instanceof KeyboardEvent?this._viewController.emitMouseDropCanceled():this._viewController.emitMouseDrop({event:this._lastMouseEvent,target:X?this._createMouseTarget(this._lastMouseEvent,!0):null}),this._stop()});return}this._mouseState.isDragAndDrop=!1,this._dispatchMouse(U,W.shiftKey,1),this._isActive||(this._isActive=!0,this._mouseMoveMonitor.startMonitoring(this._viewHelper.viewLinesDomNode,V,W.buttons,Z=>this._onMouseDownThenMove(Z),()=>this._stop()))}_stop(){this._isActive=!1,this._topBottomDragScrolling.stop()}onHeightChanged(){this._mouseMoveMonitor.stopMonitoring()}onPointerUp(){this._mouseMoveMonitor.stopMonitoring()}onCursorStateChanged(C){this._currentSelection=C.selections[0]}_getPositionOutsideEditor(C){const W=C.editorPos,V=this._context.viewModel,U=this._context.viewLayout,G=this._getMouseColumn(C);if(C.posy<W.y){const X=W.y-C.posy,Q=Math.max(U.getCurrentScrollTop()-X,0),J=HitTestContext.getZoneAtCoord(this._context,Q);if(J){const te=this._helpPositionJumpOverViewZone(J);if(te)return MouseTarget.createOutsideEditor(G,te,"above",X)}const ee=U.getLineNumberAtVerticalOffset(Q);return MouseTarget.createOutsideEditor(G,new Position$1(ee,1),"above",X)}if(C.posy>W.y+W.height){const X=C.posy-W.y-W.height,Q=U.getCurrentScrollTop()+C.relativePos.y,J=HitTestContext.getZoneAtCoord(this._context,Q);if(J){const te=this._helpPositionJumpOverViewZone(J);if(te)return MouseTarget.createOutsideEditor(G,te,"below",X)}const ee=U.getLineNumberAtVerticalOffset(Q);return MouseTarget.createOutsideEditor(G,new Position$1(ee,V.getLineMaxColumn(ee)),"below",X)}const Z=U.getLineNumberAtVerticalOffset(U.getCurrentScrollTop()+C.relativePos.y);if(C.posx<W.x){const X=W.x-C.posx;return MouseTarget.createOutsideEditor(G,new Position$1(Z,1),"left",X)}if(C.posx>W.x+W.width){const X=C.posx-W.x-W.width;return MouseTarget.createOutsideEditor(G,new Position$1(Z,V.getLineMaxColumn(Z)),"right",X)}return null}_findMousePosition(C,W){const V=this._getPositionOutsideEditor(C);if(V)return V;const U=this._createMouseTarget(C,W);if(!U.position)return null;if(U.type===8||U.type===5){const Z=this._helpPositionJumpOverViewZone(U.detail);if(Z)return MouseTarget.createViewZone(U.type,U.element,U.mouseColumn,Z,U.detail)}return U}_helpPositionJumpOverViewZone(C){const W=new Position$1(this._currentSelection.selectionStartLineNumber,this._currentSelection.selectionStartColumn),V=C.positionBefore,U=C.positionAfter;return V&&U?V.isBefore(W)?V:U:null}_dispatchMouse(C,W,V){C.position&&this._viewController.dispatchMouse({position:C.position,mouseColumn:C.mouseColumn,startedOnLineNumbers:this._mouseState.startedOnLineNumbers,revealType:V,inSelectionMode:W,mouseDownCount:this._mouseState.count,altKey:this._mouseState.altKey,ctrlKey:this._mouseState.ctrlKey,metaKey:this._mouseState.metaKey,shiftKey:this._mouseState.shiftKey,leftButton:this._mouseState.leftButton,middleButton:this._mouseState.middleButton,onInjectedText:C.type===6&&C.detail.injectedText!==null})}}class TopBottomDragScrolling extends Disposable{constructor(C,W,V,U){super(),this._context=C,this._viewHelper=W,this._mouseTargetFactory=V,this._dispatchMouse=U,this._operation=null}dispose(){super.dispose(),this.stop()}start(C,W){this._operation?this._operation.setPosition(C,W):this._operation=new TopBottomDragScrollingOperation(this._context,this._viewHelper,this._mouseTargetFactory,this._dispatchMouse,C,W)}stop(){this._operation&&(this._operation.dispose(),this._operation=null)}}class TopBottomDragScrollingOperation extends Disposable{constructor(C,W,V,U,G,Z){super(),this._context=C,this._viewHelper=W,this._mouseTargetFactory=V,this._dispatchMouse=U,this._position=G,this._mouseEvent=Z,this._lastTime=Date.now(),this._animationFrameDisposable=scheduleAtNextAnimationFrame(()=>this._execute())}dispose(){this._animationFrameDisposable.dispose()}setPosition(C,W){this._position=C,this._mouseEvent=W}_tick(){const C=Date.now(),W=C-this._lastTime;return this._lastTime=C,W}_getScrollSpeed(){const C=this._context.configuration.options.get(66),W=this._context.configuration.options.get(143).height/C,V=this._position.outsideDistance/C;return V<=1.5?Math.max(30,W*(1+V)):V<=3?Math.max(60,W*(2+V)):Math.max(200,W*(7+V))}_execute(){const C=this._context.configuration.options.get(66),W=this._getScrollSpeed(),V=this._tick(),U=W*(V/1e3)*C,G=this._position.outsidePosition==="above"?-U:U;this._context.viewModel.viewLayout.deltaScrollNow(0,G),this._viewHelper.renderNow();const Z=this._context.viewLayout.getLinesViewportData(),X=this._position.outsidePosition==="above"?Z.startLineNumber:Z.endLineNumber;let Q;{const J=createEditorPagePosition(this._viewHelper.viewDomNode),ee=this._context.configuration.options.get(143).horizontalScrollbarHeight,te=new PageCoordinates(this._mouseEvent.pos.x,J.y+J.height-ee-.1),ie=createCoordinatesRelativeToEditor(this._viewHelper.viewDomNode,J,te);Q=this._mouseTargetFactory.createMouseTarget(this._viewHelper.getLastRenderData(),J,te,ie,null)}(!Q.position||Q.position.lineNumber!==X)&&(this._position.outsidePosition==="above"?Q=MouseTarget.createOutsideEditor(this._position.mouseColumn,new Position$1(X,1),"above",this._position.outsideDistance):Q=MouseTarget.createOutsideEditor(this._position.mouseColumn,new Position$1(X,this._context.viewModel.getLineMaxColumn(X)),"below",this._position.outsideDistance)),this._dispatchMouse(Q,!0,2),this._animationFrameDisposable=scheduleAtNextAnimationFrame(()=>this._execute())}}class MouseDownState{get altKey(){return this._altKey}get ctrlKey(){return this._ctrlKey}get metaKey(){return this._metaKey}get shiftKey(){return this._shiftKey}get leftButton(){return this._leftButton}get middleButton(){return this._middleButton}get startedOnLineNumbers(){return this._startedOnLineNumbers}constructor(){this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._leftButton=!1,this._middleButton=!1,this._startedOnLineNumbers=!1,this._lastMouseDownPosition=null,this._lastMouseDownPositionEqualCount=0,this._lastMouseDownCount=0,this._lastSetMouseDownCountTime=0,this.isDragAndDrop=!1}get count(){return this._lastMouseDownCount}setModifiers(C){this._altKey=C.altKey,this._ctrlKey=C.ctrlKey,this._metaKey=C.metaKey,this._shiftKey=C.shiftKey}setStartButtons(C){this._leftButton=C.leftButton,this._middleButton=C.middleButton}setStartedOnLineNumbers(C){this._startedOnLineNumbers=C}trySetCount(C,W){const V=new Date().getTime();V-this._lastSetMouseDownCountTime>MouseDownState.CLEAR_MOUSE_DOWN_COUNT_TIME&&(C=1),this._lastSetMouseDownCountTime=V,C>this._lastMouseDownCount+1&&(C=this._lastMouseDownCount+1),this._lastMouseDownPosition&&this._lastMouseDownPosition.equals(W)?this._lastMouseDownPositionEqualCount++:this._lastMouseDownPositionEqualCount=1,this._lastMouseDownPosition=W,this._lastMouseDownCount=Math.min(C,this._lastMouseDownPositionEqualCount)}}MouseDownState.CLEAR_MOUSE_DOWN_COUNT_TIME=400;class DomEmitter{get event(){return this.emitter.event}constructor(C,W,V){const U=G=>this.emitter.fire(G);this.emitter=new Emitter$1({onWillAddFirstListener:()=>C.addEventListener(W,U,V),onDidRemoveLastListener:()=>C.removeEventListener(W,U,V)})}dispose(){this.emitter.dispose()}}var inputLatency;(function(K){const C={total:0,min:Number.MAX_VALUE,max:0},W=Object.assign({},C),V=Object.assign({},C),U=Object.assign({},C);let G=0;const Z={keydown:0,input:0,render:0};function X(){se(),performance.mark("inputlatency/start"),performance.mark("keydown/start"),Z.keydown=1,queueMicrotask(Q)}K.onKeyDown=X;function Q(){Z.keydown===1&&(performance.mark("keydown/end"),Z.keydown=2)}function J(){performance.mark("input/start"),Z.input=1,ae()}K.onBeforeInput=J;function ee(){Z.input===0&&J(),queueMicrotask(te)}K.onInput=ee;function te(){Z.input===1&&(performance.mark("input/end"),Z.input=2)}function ie(){se()}K.onKeyUp=ie;function ne(){se()}K.onSelectionChange=ne;function oe(){Z.keydown===2&&Z.input===2&&Z.render===0&&(performance.mark("render/start"),Z.render=1,queueMicrotask(re),ae())}K.onRenderStart=oe;function re(){Z.render===1&&(performance.mark("render/end"),Z.render=2)}function ae(){setTimeout(se)}function se(){Z.keydown===2&&Z.input===2&&Z.render===2&&(performance.mark("inputlatency/end"),performance.measure("keydown","keydown/start","keydown/end"),performance.measure("input","input/start","input/end"),performance.measure("render","render/start","render/end"),performance.measure("inputlatency","inputlatency/start","inputlatency/end"),le("keydown",C),le("input",W),le("render",V),le("inputlatency",U),G++,ce())}function le(he,fe){const pe=performance.getEntriesByName(he)[0].duration;fe.total+=pe,fe.min=Math.min(fe.min,pe),fe.max=Math.max(fe.max,pe)}function ce(){performance.clearMarks("keydown/start"),performance.clearMarks("keydown/end"),performance.clearMarks("input/start"),performance.clearMarks("input/end"),performance.clearMarks("render/start"),performance.clearMarks("render/end"),performance.clearMarks("inputlatency/start"),performance.clearMarks("inputlatency/end"),performance.clearMeasures("keydown"),performance.clearMeasures("input"),performance.clearMeasures("render"),performance.clearMeasures("inputlatency"),Z.keydown=0,Z.input=0,Z.render=0}function de(){if(G===0)return;const he={keydown:ue(C),input:ue(W),render:ue(V),total:ue(U),sampleCount:G};return ge(C),ge(W),ge(V),ge(U),G=0,he}K.getAndClearMeasurements=de;function ue(he){return{average:he.total/G,max:he.max,min:he.min}}function ge(he){he.total=0,he.min=Number.MAX_VALUE,he.max=0}})(inputLatency||(inputLatency={}));class TextAreaState{constructor(C,W,V,U,G){this.value=C,this.selectionStart=W,this.selectionEnd=V,this.selection=U,this.newlineCountBeforeSelection=G}toString(){return`[ <${this.value}>, selectionStart: ${this.selectionStart}, selectionEnd: ${this.selectionEnd}]`}static readFromTextArea(C,W){const V=C.getValue(),U=C.getSelectionStart(),G=C.getSelectionEnd();let Z;if(W){const X=V.substring(0,U),Q=W.value.substring(0,W.selectionStart);X===Q&&(Z=W.newlineCountBeforeSelection)}return new TextAreaState(V,U,G,null,Z)}collapseSelection(){return this.selectionStart===this.value.length?this:new TextAreaState(this.value,this.value.length,this.value.length,null,void 0)}writeToTextArea(C,W,V){W.setValue(C,this.value),V&&W.setSelectionRange(C,this.selectionStart,this.selectionEnd)}deduceEditorPosition(C){var W,V,U,G,Z,X,Q,J;if(C<=this.selectionStart){const ie=this.value.substring(C,this.selectionStart);return this._finishDeduceEditorPosition((V=(W=this.selection)===null||W===void 0?void 0:W.getStartPosition())!==null&&V!==void 0?V:null,ie,-1)}if(C>=this.selectionEnd){const ie=this.value.substring(this.selectionEnd,C);return this._finishDeduceEditorPosition((G=(U=this.selection)===null||U===void 0?void 0:U.getEndPosition())!==null&&G!==void 0?G:null,ie,1)}const ee=this.value.substring(this.selectionStart,C);if(ee.indexOf(String.fromCharCode(8230))===-1)return this._finishDeduceEditorPosition((X=(Z=this.selection)===null||Z===void 0?void 0:Z.getStartPosition())!==null&&X!==void 0?X:null,ee,1);const te=this.value.substring(C,this.selectionEnd);return this._finishDeduceEditorPosition((J=(Q=this.selection)===null||Q===void 0?void 0:Q.getEndPosition())!==null&&J!==void 0?J:null,te,-1)}_finishDeduceEditorPosition(C,W,V){let U=0,G=-1;for(;(G=W.indexOf(`
`,G+1))!==-1;)U++;return[C,V*W.length,U]}static deduceInput(C,W,V){if(!C)return{text:"",replacePrevCharCnt:0,replaceNextCharCnt:0,positionDelta:0};const U=Math.min(commonPrefixLength(C.value,W.value),C.selectionStart,W.selectionStart),G=Math.min(commonSuffixLength(C.value,W.value),C.value.length-C.selectionEnd,W.value.length-W.selectionEnd);C.value.substring(U,C.value.length-G);const Z=W.value.substring(U,W.value.length-G),X=C.selectionStart-U,Q=C.selectionEnd-U,J=W.selectionStart-U,ee=W.selectionEnd-U;if(J===ee){const ie=C.selectionStart-U;return{text:Z,replacePrevCharCnt:ie,replaceNextCharCnt:0,positionDelta:0}}const te=Q-X;return{text:Z,replacePrevCharCnt:te,replaceNextCharCnt:0,positionDelta:0}}static deduceAndroidCompositionInput(C,W){if(!C)return{text:"",replacePrevCharCnt:0,replaceNextCharCnt:0,positionDelta:0};if(C.value===W.value)return{text:"",replacePrevCharCnt:0,replaceNextCharCnt:0,positionDelta:W.selectionEnd-C.selectionEnd};const V=Math.min(commonPrefixLength(C.value,W.value),C.selectionEnd),U=Math.min(commonSuffixLength(C.value,W.value),C.value.length-C.selectionEnd),G=C.value.substring(V,C.value.length-U),Z=W.value.substring(V,W.value.length-U);C.selectionStart-V;const X=C.selectionEnd-V;W.selectionStart-V;const Q=W.selectionEnd-V;return{text:Z,replacePrevCharCnt:X,replaceNextCharCnt:G.length-X,positionDelta:Q-Z.length}}}TextAreaState.EMPTY=new TextAreaState("",0,0,null,void 0);class PagedScreenReaderStrategy{static _getPageOfLine(C,W){return Math.floor((C-1)/W)}static _getRangeForPage(C,W){const V=C*W,U=V+1,G=V+W;return new Range$2(U,1,G+1,1)}static fromEditorSelection(C,W,V,U){const Z=PagedScreenReaderStrategy._getPageOfLine(W.startLineNumber,V),X=PagedScreenReaderStrategy._getRangeForPage(Z,V),Q=PagedScreenReaderStrategy._getPageOfLine(W.endLineNumber,V),J=PagedScreenReaderStrategy._getRangeForPage(Q,V);let ee=X.intersectRanges(new Range$2(1,1,W.startLineNumber,W.startColumn));if(U&&C.getValueLengthInRange(ee,1)>500){const se=C.modifyPosition(ee.getEndPosition(),-500);ee=Range$2.fromPositions(se,ee.getEndPosition())}const te=C.getValueInRange(ee,1),ie=C.getLineCount(),ne=C.getLineMaxColumn(ie);let oe=J.intersectRanges(new Range$2(W.endLineNumber,W.endColumn,ie,ne));if(U&&C.getValueLengthInRange(oe,1)>500){const se=C.modifyPosition(oe.getStartPosition(),500);oe=Range$2.fromPositions(oe.getStartPosition(),se)}const re=C.getValueInRange(oe,1);let ae;if(Z===Q||Z+1===Q)ae=C.getValueInRange(W,1);else{const se=X.intersectRanges(W),le=J.intersectRanges(W);ae=C.getValueInRange(se,1)+String.fromCharCode(8230)+C.getValueInRange(le,1)}return U&&ae.length>2*500&&(ae=ae.substring(0,500)+String.fromCharCode(8230)+ae.substring(ae.length-500,ae.length)),new TextAreaState(te+ae+re,te.length,te.length+ae.length,W,ee.endLineNumber-ee.startLineNumber)}}var TextAreaSyntethicEvents;(function(K){K.Tap="-monaco-textarea-synthetic-tap"})(TextAreaSyntethicEvents||(TextAreaSyntethicEvents={}));const CopyOptions={forceCopyWithSyntaxHighlighting:!1};class InMemoryClipboardMetadataManager{constructor(){this._lastState=null}set(C,W){this._lastState={lastCopiedValue:C,data:W}}get(C){return this._lastState&&this._lastState.lastCopiedValue===C?this._lastState.data:(this._lastState=null,null)}}InMemoryClipboardMetadataManager.INSTANCE=new InMemoryClipboardMetadataManager;class CompositionContext{constructor(){this._lastTypeTextLength=0}handleCompositionUpdate(C){C=C||"";const W={text:C,replacePrevCharCnt:this._lastTypeTextLength,replaceNextCharCnt:0,positionDelta:0};return this._lastTypeTextLength=C.length,W}}class TextAreaInput extends Disposable{get textAreaState(){return this._textAreaState}constructor(C,W,V,U){super(),this._host=C,this._textArea=W,this._OS=V,this._browser=U,this._onFocus=this._register(new Emitter$1),this.onFocus=this._onFocus.event,this._onBlur=this._register(new Emitter$1),this.onBlur=this._onBlur.event,this._onKeyDown=this._register(new Emitter$1),this.onKeyDown=this._onKeyDown.event,this._onKeyUp=this._register(new Emitter$1),this.onKeyUp=this._onKeyUp.event,this._onCut=this._register(new Emitter$1),this.onCut=this._onCut.event,this._onPaste=this._register(new Emitter$1),this.onPaste=this._onPaste.event,this._onType=this._register(new Emitter$1),this.onType=this._onType.event,this._onCompositionStart=this._register(new Emitter$1),this.onCompositionStart=this._onCompositionStart.event,this._onCompositionUpdate=this._register(new Emitter$1),this.onCompositionUpdate=this._onCompositionUpdate.event,this._onCompositionEnd=this._register(new Emitter$1),this.onCompositionEnd=this._onCompositionEnd.event,this._onSelectionChangeRequest=this._register(new Emitter$1),this.onSelectionChangeRequest=this._onSelectionChangeRequest.event,this._asyncTriggerCut=this._register(new RunOnceScheduler(()=>this._onCut.fire(),0)),this._asyncFocusGainWriteScreenReaderContent=this._register(new RunOnceScheduler(()=>this.writeScreenReaderContent("asyncFocusGain"),0)),this._textAreaState=TextAreaState.EMPTY,this._selectionChangeListener=null,this.writeScreenReaderContent("ctor"),this._hasFocus=!1,this._currentComposition=null;let G=null;this._register(this._textArea.onKeyDown(Z=>{const X=new StandardKeyboardEvent(Z);(X.keyCode===114||this._currentComposition&&X.keyCode===1)&&X.stopPropagation(),X.equals(9)&&X.preventDefault(),G=X,this._onKeyDown.fire(X)})),this._register(this._textArea.onKeyUp(Z=>{const X=new StandardKeyboardEvent(Z);this._onKeyUp.fire(X)})),this._register(this._textArea.onCompositionStart(Z=>{const X=new CompositionContext;if(this._currentComposition){this._currentComposition=X;return}if(this._currentComposition=X,this._OS===2&&G&&G.equals(114)&&this._textAreaState.selectionStart===this._textAreaState.selectionEnd&&this._textAreaState.selectionStart>0&&this._textAreaState.value.substr(this._textAreaState.selectionStart-1,1)===Z.data&&(G.code==="ArrowRight"||G.code==="ArrowLeft")){X.handleCompositionUpdate("x"),this._onCompositionStart.fire({data:Z.data});return}if(this._browser.isAndroid){this._onCompositionStart.fire({data:Z.data});return}this._onCompositionStart.fire({data:Z.data})})),this._register(this._textArea.onCompositionUpdate(Z=>{const X=this._currentComposition;if(!X)return;if(this._browser.isAndroid){const J=TextAreaState.readFromTextArea(this._textArea,this._textAreaState),ee=TextAreaState.deduceAndroidCompositionInput(this._textAreaState,J);this._textAreaState=J,this._onType.fire(ee),this._onCompositionUpdate.fire(Z);return}const Q=X.handleCompositionUpdate(Z.data);this._textAreaState=TextAreaState.readFromTextArea(this._textArea,this._textAreaState),this._onType.fire(Q),this._onCompositionUpdate.fire(Z)})),this._register(this._textArea.onCompositionEnd(Z=>{const X=this._currentComposition;if(!X)return;if(this._currentComposition=null,this._browser.isAndroid){const J=TextAreaState.readFromTextArea(this._textArea,this._textAreaState),ee=TextAreaState.deduceAndroidCompositionInput(this._textAreaState,J);this._textAreaState=J,this._onType.fire(ee),this._onCompositionEnd.fire();return}const Q=X.handleCompositionUpdate(Z.data);this._textAreaState=TextAreaState.readFromTextArea(this._textArea,this._textAreaState),this._onType.fire(Q),this._onCompositionEnd.fire()})),this._register(this._textArea.onInput(Z=>{if(this._textArea.setIgnoreSelectionChangeTime("received input event"),this._currentComposition)return;const X=TextAreaState.readFromTextArea(this._textArea,this._textAreaState),Q=TextAreaState.deduceInput(this._textAreaState,X,this._OS===2);Q.replacePrevCharCnt===0&&Q.text.length===1&&(isHighSurrogate(Q.text.charCodeAt(0))||Q.text.charCodeAt(0)===127)||(this._textAreaState=X,(Q.text!==""||Q.replacePrevCharCnt!==0||Q.replaceNextCharCnt!==0||Q.positionDelta!==0)&&this._onType.fire(Q))})),this._register(this._textArea.onCut(Z=>{this._textArea.setIgnoreSelectionChangeTime("received cut event"),this._ensureClipboardGetsEditorSelection(Z),this._asyncTriggerCut.schedule()})),this._register(this._textArea.onCopy(Z=>{this._ensureClipboardGetsEditorSelection(Z)})),this._register(this._textArea.onPaste(Z=>{if(this._textArea.setIgnoreSelectionChangeTime("received paste event"),Z.preventDefault(),!Z.clipboardData)return;let[X,Q]=ClipboardEventUtils.getTextData(Z.clipboardData);X&&(Q=Q||InMemoryClipboardMetadataManager.INSTANCE.get(X),this._onPaste.fire({text:X,metadata:Q}))})),this._register(this._textArea.onFocus(()=>{const Z=this._hasFocus;this._setHasFocus(!0),this._browser.isSafari&&!Z&&this._hasFocus&&this._asyncFocusGainWriteScreenReaderContent.schedule()})),this._register(this._textArea.onBlur(()=>{this._currentComposition&&(this._currentComposition=null,this.writeScreenReaderContent("blurWithoutCompositionEnd"),this._onCompositionEnd.fire()),this._setHasFocus(!1)})),this._register(this._textArea.onSyntheticTap(()=>{this._browser.isAndroid&&this._currentComposition&&(this._currentComposition=null,this.writeScreenReaderContent("tapWithoutCompositionEnd"),this._onCompositionEnd.fire())}))}_installSelectionChangeListener(){let C=0;return addDisposableListener(this._textArea.ownerDocument,"selectionchange",W=>{if(inputLatency.onSelectionChange(),!this._hasFocus||this._currentComposition||!this._browser.isChrome)return;const V=Date.now(),U=V-C;if(C=V,U<5)return;const G=V-this._textArea.getIgnoreSelectionChangeTime();if(this._textArea.resetSelectionChangeTime(),G<100||!this._textAreaState.selection)return;const Z=this._textArea.getValue();if(this._textAreaState.value!==Z)return;const X=this._textArea.getSelectionStart(),Q=this._textArea.getSelectionEnd();if(this._textAreaState.selectionStart===X&&this._textAreaState.selectionEnd===Q)return;const J=this._textAreaState.deduceEditorPosition(X),ee=this._host.deduceModelPosition(J[0],J[1],J[2]),te=this._textAreaState.deduceEditorPosition(Q),ie=this._host.deduceModelPosition(te[0],te[1],te[2]),ne=new Selection$1(ee.lineNumber,ee.column,ie.lineNumber,ie.column);this._onSelectionChangeRequest.fire(ne)})}dispose(){super.dispose(),this._selectionChangeListener&&(this._selectionChangeListener.dispose(),this._selectionChangeListener=null)}focusTextArea(){this._setHasFocus(!0),this.refreshFocusState()}isFocused(){return this._hasFocus}refreshFocusState(){this._setHasFocus(this._textArea.hasFocus())}_setHasFocus(C){this._hasFocus!==C&&(this._hasFocus=C,this._selectionChangeListener&&(this._selectionChangeListener.dispose(),this._selectionChangeListener=null),this._hasFocus&&(this._selectionChangeListener=this._installSelectionChangeListener()),this._hasFocus&&this.writeScreenReaderContent("focusgain"),this._hasFocus?this._onFocus.fire():this._onBlur.fire())}_setAndWriteTextAreaState(C,W){this._hasFocus||(W=W.collapseSelection()),W.writeToTextArea(C,this._textArea,this._hasFocus),this._textAreaState=W}writeScreenReaderContent(C){this._currentComposition||this._setAndWriteTextAreaState(C,this._host.getScreenReaderContent())}_ensureClipboardGetsEditorSelection(C){const W=this._host.getDataToCopy(),V={version:1,isFromEmptySelection:W.isFromEmptySelection,multicursorText:W.multicursorText,mode:W.mode};InMemoryClipboardMetadataManager.INSTANCE.set(this._browser.isFirefox?W.text.replace(/\r\n/g,`
`):W.text,V),C.preventDefault(),C.clipboardData&&ClipboardEventUtils.setTextData(C.clipboardData,W.text,W.html,V)}}const ClipboardEventUtils={getTextData(K){const C=K.getData(Mimes.text);let W=null;const V=K.getData("vscode-editor-data");if(typeof V=="string")try{W=JSON.parse(V),W.version!==1&&(W=null)}catch{}return C.length===0&&W===null&&K.files.length>0?[Array.prototype.slice.call(K.files,0).map(G=>G.name).join(`
`),null]:[C,W]},setTextData(K,C,W,V){K.setData(Mimes.text,C),typeof W=="string"&&K.setData("text/html",W),K.setData("vscode-editor-data",JSON.stringify(V))}};class TextAreaWrapper extends Disposable{get ownerDocument(){return this._actual.ownerDocument}constructor(C){super(),this._actual=C,this.onKeyDown=this._register(new DomEmitter(this._actual,"keydown")).event,this.onKeyUp=this._register(new DomEmitter(this._actual,"keyup")).event,this.onCompositionStart=this._register(new DomEmitter(this._actual,"compositionstart")).event,this.onCompositionUpdate=this._register(new DomEmitter(this._actual,"compositionupdate")).event,this.onCompositionEnd=this._register(new DomEmitter(this._actual,"compositionend")).event,this.onBeforeInput=this._register(new DomEmitter(this._actual,"beforeinput")).event,this.onInput=this._register(new DomEmitter(this._actual,"input")).event,this.onCut=this._register(new DomEmitter(this._actual,"cut")).event,this.onCopy=this._register(new DomEmitter(this._actual,"copy")).event,this.onPaste=this._register(new DomEmitter(this._actual,"paste")).event,this.onFocus=this._register(new DomEmitter(this._actual,"focus")).event,this.onBlur=this._register(new DomEmitter(this._actual,"blur")).event,this._onSyntheticTap=this._register(new Emitter$1),this.onSyntheticTap=this._onSyntheticTap.event,this._ignoreSelectionChangeTime=0,this._register(this.onKeyDown(()=>inputLatency.onKeyDown())),this._register(this.onBeforeInput(()=>inputLatency.onBeforeInput())),this._register(this.onInput(()=>inputLatency.onInput())),this._register(this.onKeyUp(()=>inputLatency.onKeyUp())),this._register(addDisposableListener(this._actual,TextAreaSyntethicEvents.Tap,()=>this._onSyntheticTap.fire()))}hasFocus(){const C=getShadowRoot(this._actual);return C?C.activeElement===this._actual:isInDOM(this._actual)?this._actual.ownerDocument.activeElement===this._actual:!1}setIgnoreSelectionChangeTime(C){this._ignoreSelectionChangeTime=Date.now()}getIgnoreSelectionChangeTime(){return this._ignoreSelectionChangeTime}resetSelectionChangeTime(){this._ignoreSelectionChangeTime=0}getValue(){return this._actual.value}setValue(C,W){const V=this._actual;V.value!==W&&(this.setIgnoreSelectionChangeTime("setValue"),V.value=W)}getSelectionStart(){return this._actual.selectionDirection==="backward"?this._actual.selectionEnd:this._actual.selectionStart}getSelectionEnd(){return this._actual.selectionDirection==="backward"?this._actual.selectionStart:this._actual.selectionEnd}setSelectionRange(C,W,V){const U=this._actual;let G=null;const Z=getShadowRoot(U);Z?G=Z.activeElement:G=U.ownerDocument.activeElement;const X=G===U,Q=U.selectionStart,J=U.selectionEnd;if(X&&Q===W&&J===V){isFirefox&&window.parent!==window&&U.focus();return}if(X){this.setIgnoreSelectionChangeTime("setSelectionRange"),U.setSelectionRange(W,V),isFirefox&&window.parent!==window&&U.focus();return}try{const ee=saveParentsScrollTop(U);this.setIgnoreSelectionChangeTime("setSelectionRange"),U.focus(),U.setSelectionRange(W,V),restoreParentsScrollTop(U,ee)}catch{}}}class PointerEventHandler extends MouseHandler{constructor(C,W,V){super(C,W,V),this._register(Gesture.addTarget(this.viewHelper.linesContentDomNode)),this._register(addDisposableListener(this.viewHelper.linesContentDomNode,EventType.Tap,G=>this.onTap(G))),this._register(addDisposableListener(this.viewHelper.linesContentDomNode,EventType.Change,G=>this.onChange(G))),this._register(addDisposableListener(this.viewHelper.linesContentDomNode,EventType.Contextmenu,G=>this._onContextMenu(new EditorMouseEvent(G,!1,this.viewHelper.viewDomNode),!1))),this._lastPointerType="mouse",this._register(addDisposableListener(this.viewHelper.linesContentDomNode,"pointerdown",G=>{const Z=G.pointerType;if(Z==="mouse"){this._lastPointerType="mouse";return}else Z==="touch"?this._lastPointerType="touch":this._lastPointerType="pen"}));const U=new EditorPointerEventFactory(this.viewHelper.viewDomNode);this._register(U.onPointerMove(this.viewHelper.viewDomNode,G=>this._onMouseMove(G))),this._register(U.onPointerUp(this.viewHelper.viewDomNode,G=>this._onMouseUp(G))),this._register(U.onPointerLeave(this.viewHelper.viewDomNode,G=>this._onMouseLeave(G))),this._register(U.onPointerDown(this.viewHelper.viewDomNode,(G,Z)=>this._onMouseDown(G,Z)))}onTap(C){if(!C.initialTarget||!this.viewHelper.linesContentDomNode.contains(C.initialTarget))return;C.preventDefault(),this.viewHelper.focusTextArea();const W=this._createMouseTarget(new EditorMouseEvent(C,!1,this.viewHelper.viewDomNode),!1);W.position&&this.viewController.dispatchMouse({position:W.position,mouseColumn:W.position.column,startedOnLineNumbers:!1,revealType:1,mouseDownCount:C.tapCount,inSelectionMode:!1,altKey:!1,ctrlKey:!1,metaKey:!1,shiftKey:!1,leftButton:!1,middleButton:!1,onInjectedText:W.type===6&&W.detail.injectedText!==null})}onChange(C){this._lastPointerType==="touch"&&this._context.viewModel.viewLayout.deltaScrollNow(-C.translationX,-C.translationY)}_onMouseDown(C,W){C.browserEvent.pointerType!=="touch"&&super._onMouseDown(C,W)}}class TouchHandler extends MouseHandler{constructor(C,W,V){super(C,W,V),this._register(Gesture.addTarget(this.viewHelper.linesContentDomNode)),this._register(addDisposableListener(this.viewHelper.linesContentDomNode,EventType.Tap,U=>this.onTap(U))),this._register(addDisposableListener(this.viewHelper.linesContentDomNode,EventType.Change,U=>this.onChange(U))),this._register(addDisposableListener(this.viewHelper.linesContentDomNode,EventType.Contextmenu,U=>this._onContextMenu(new EditorMouseEvent(U,!1,this.viewHelper.viewDomNode),!1)))}onTap(C){C.preventDefault(),this.viewHelper.focusTextArea();const W=this._createMouseTarget(new EditorMouseEvent(C,!1,this.viewHelper.viewDomNode),!1);if(W.position){const V=document.createEvent("CustomEvent");V.initEvent(TextAreaSyntethicEvents.Tap,!1,!0),this.viewHelper.dispatchTextAreaEvent(V),this.viewController.moveTo(W.position,1)}}onChange(C){this._context.viewModel.viewLayout.deltaScrollNow(-C.translationX,-C.translationY)}}class PointerHandler extends Disposable{constructor(C,W,V){super(),isIOS&&BrowserFeatures.pointerEvents?this.handler=this._register(new PointerEventHandler(C,W,V)):window.TouchEvent?this.handler=this._register(new TouchHandler(C,W,V)):this.handler=this._register(new MouseHandler(C,W,V))}getTargetAtClientPoint(C,W){return this.handler.getTargetAtClientPoint(C,W)}}const textAreaHandler="",lineNumbers="";class DynamicViewOverlay extends ViewEventHandler{}const IThemeService=createDecorator("themeService");function themeColorFromId(K){return{id:K}}function getThemeTypeSelector(K){switch(K){case ColorScheme.DARK:return"vs-dark";case ColorScheme.HIGH_CONTRAST_DARK:return"hc-black";case ColorScheme.HIGH_CONTRAST_LIGHT:return"hc-light";default:return"vs"}}const Extensions$3={ThemingContribution:"base.contributions.theming"};class ThemingRegistry{constructor(){this.themingParticipants=[],this.themingParticipants=[],this.onThemingParticipantAddedEmitter=new Emitter$1}onColorThemeChange(C){return this.themingParticipants.push(C),this.onThemingParticipantAddedEmitter.fire(C),toDisposable(()=>{const W=this.themingParticipants.indexOf(C);this.themingParticipants.splice(W,1)})}getThemingParticipants(){return this.themingParticipants}}const themingRegistry$1=new ThemingRegistry;Registry.add(Extensions$3.ThemingContribution,themingRegistry$1);function registerThemingParticipant(K){return themingRegistry$1.onColorThemeChange(K)}class Themable extends Disposable{constructor(C){super(),this.themeService=C,this.theme=C.getColorTheme(),this._register(this.themeService.onDidColorThemeChange(W=>this.onThemeChange(W)))}onThemeChange(C){this.theme=C,this.updateStyles()}updateStyles(){}}const editorLineHighlight=registerColor("editor.lineHighlightBackground",{dark:null,light:null,hcDark:null,hcLight:null},localize("lineHighlight","Background color for the highlight of line at the cursor position.")),editorLineHighlightBorder=registerColor("editor.lineHighlightBorder",{dark:"#282828",light:"#eeeeee",hcDark:"#f38518",hcLight:contrastBorder},localize("lineHighlightBorderBox","Background color for the border around the line at the cursor position."));registerColor("editor.rangeHighlightBackground",{dark:"#ffffff0b",light:"#fdff0033",hcDark:null,hcLight:null},localize("rangeHighlight","Background color of highlighted ranges, like by quick open and find features. The color must not be opaque so as not to hide underlying decorations."),!0);registerColor("editor.rangeHighlightBorder",{dark:null,light:null,hcDark:activeContrastBorder,hcLight:activeContrastBorder},localize("rangeHighlightBorder","Background color of the border around highlighted ranges."),!0);registerColor("editor.symbolHighlightBackground",{dark:editorFindMatchHighlight,light:editorFindMatchHighlight,hcDark:null,hcLight:null},localize("symbolHighlight","Background color of highlighted symbol, like for go to definition or go next/previous symbol. The color must not be opaque so as not to hide underlying decorations."),!0);registerColor("editor.symbolHighlightBorder",{dark:null,light:null,hcDark:activeContrastBorder,hcLight:activeContrastBorder},localize("symbolHighlightBorder","Background color of the border around highlighted symbols."),!0);const editorCursorForeground=registerColor("editorCursor.foreground",{dark:"#AEAFAD",light:Color.black,hcDark:Color.white,hcLight:"#0F4A85"},localize("caret","Color of the editor cursor.")),editorCursorBackground=registerColor("editorCursor.background",null,localize("editorCursorBackground","The background color of the editor cursor. Allows customizing the color of a character overlapped by a block cursor.")),editorWhitespaces=registerColor("editorWhitespace.foreground",{dark:"#e3e4e229",light:"#33333333",hcDark:"#e3e4e229",hcLight:"#CCCCCC"},localize("editorWhitespaces","Color of whitespace characters in the editor.")),editorLineNumbers=registerColor("editorLineNumber.foreground",{dark:"#858585",light:"#237893",hcDark:Color.white,hcLight:"#292929"},localize("editorLineNumbers","Color of editor line numbers.")),deprecatedEditorIndentGuides=registerColor("editorIndentGuide.background",{dark:editorWhitespaces,light:editorWhitespaces,hcDark:editorWhitespaces,hcLight:editorWhitespaces},localize("editorIndentGuides","Color of the editor indentation guides."),!1,localize("deprecatedEditorIndentGuides","'editorIndentGuide.background' is deprecated. Use 'editorIndentGuide.background1' instead.")),deprecatedEditorActiveIndentGuides=registerColor("editorIndentGuide.activeBackground",{dark:editorWhitespaces,light:editorWhitespaces,hcDark:editorWhitespaces,hcLight:editorWhitespaces},localize("editorActiveIndentGuide","Color of the active editor indentation guides."),!1,localize("deprecatedEditorActiveIndentGuide","'editorIndentGuide.activeBackground' is deprecated. Use 'editorIndentGuide.activeBackground1' instead.")),editorIndentGuide1=registerColor("editorIndentGuide.background1",{dark:deprecatedEditorIndentGuides,light:deprecatedEditorIndentGuides,hcDark:deprecatedEditorIndentGuides,hcLight:deprecatedEditorIndentGuides},localize("editorIndentGuides1","Color of the editor indentation guides (1).")),editorIndentGuide2=registerColor("editorIndentGuide.background2",{dark:"#00000000",light:"#00000000",hcDark:"#00000000",hcLight:"#00000000"},localize("editorIndentGuides2","Color of the editor indentation guides (2).")),editorIndentGuide3=registerColor("editorIndentGuide.background3",{dark:"#00000000",light:"#00000000",hcDark:"#00000000",hcLight:"#00000000"},localize("editorIndentGuides3","Color of the editor indentation guides (3).")),editorIndentGuide4=registerColor("editorIndentGuide.background4",{dark:"#00000000",light:"#00000000",hcDark:"#00000000",hcLight:"#00000000"},localize("editorIndentGuides4","Color of the editor indentation guides (4).")),editorIndentGuide5=registerColor("editorIndentGuide.background5",{dark:"#00000000",light:"#00000000",hcDark:"#00000000",hcLight:"#00000000"},localize("editorIndentGuides5","Color of the editor indentation guides (5).")),editorIndentGuide6=registerColor("editorIndentGuide.background6",{dark:"#00000000",light:"#00000000",hcDark:"#00000000",hcLight:"#00000000"},localize("editorIndentGuides6","Color of the editor indentation guides (6).")),editorActiveIndentGuide1=registerColor("editorIndentGuide.activeBackground1",{dark:deprecatedEditorActiveIndentGuides,light:deprecatedEditorActiveIndentGuides,hcDark:deprecatedEditorActiveIndentGuides,hcLight:deprecatedEditorActiveIndentGuides},localize("editorActiveIndentGuide1","Color of the active editor indentation guides (1).")),editorActiveIndentGuide2=registerColor("editorIndentGuide.activeBackground2",{dark:"#00000000",light:"#00000000",hcDark:"#00000000",hcLight:"#00000000"},localize("editorActiveIndentGuide2","Color of the active editor indentation guides (2).")),editorActiveIndentGuide3=registerColor("editorIndentGuide.activeBackground3",{dark:"#00000000",light:"#00000000",hcDark:"#00000000",hcLight:"#00000000"},localize("editorActiveIndentGuide3","Color of the active editor indentation guides (3).")),editorActiveIndentGuide4=registerColor("editorIndentGuide.activeBackground4",{dark:"#00000000",light:"#00000000",hcDark:"#00000000",hcLight:"#00000000"},localize("editorActiveIndentGuide4","Color of the active editor indentation guides (4).")),editorActiveIndentGuide5=registerColor("editorIndentGuide.activeBackground5",{dark:"#00000000",light:"#00000000",hcDark:"#00000000",hcLight:"#00000000"},localize("editorActiveIndentGuide5","Color of the active editor indentation guides (5).")),editorActiveIndentGuide6=registerColor("editorIndentGuide.activeBackground6",{dark:"#00000000",light:"#00000000",hcDark:"#00000000",hcLight:"#00000000"},localize("editorActiveIndentGuide6","Color of the active editor indentation guides (6).")),deprecatedEditorActiveLineNumber=registerColor("editorActiveLineNumber.foreground",{dark:"#c6c6c6",light:"#0B216F",hcDark:activeContrastBorder,hcLight:activeContrastBorder},localize("editorActiveLineNumber","Color of editor active line number"),!1,localize("deprecatedEditorActiveLineNumber","Id is deprecated. Use 'editorLineNumber.activeForeground' instead."));registerColor("editorLineNumber.activeForeground",{dark:deprecatedEditorActiveLineNumber,light:deprecatedEditorActiveLineNumber,hcDark:deprecatedEditorActiveLineNumber,hcLight:deprecatedEditorActiveLineNumber},localize("editorActiveLineNumber","Color of editor active line number"));const editorDimmedLineNumber=registerColor("editorLineNumber.dimmedForeground",{dark:null,light:null,hcDark:null,hcLight:null},localize("editorDimmedLineNumber","Color of the final editor line when editor.renderFinalNewline is set to dimmed."));registerColor("editorRuler.foreground",{dark:"#5A5A5A",light:Color.lightgrey,hcDark:Color.white,hcLight:"#292929"},localize("editorRuler","Color of the editor rulers."));registerColor("editorCodeLens.foreground",{dark:"#999999",light:"#919191",hcDark:"#999999",hcLight:"#292929"},localize("editorCodeLensForeground","Foreground color of editor CodeLens"));registerColor("editorBracketMatch.background",{dark:"#0064001a",light:"#0064001a",hcDark:"#0064001a",hcLight:"#0000"},localize("editorBracketMatchBackground","Background color behind matching brackets"));registerColor("editorBracketMatch.border",{dark:"#888",light:"#B9B9B9",hcDark:contrastBorder,hcLight:contrastBorder},localize("editorBracketMatchBorder","Color for matching brackets boxes"));const editorOverviewRulerBorder=registerColor("editorOverviewRuler.border",{dark:"#7f7f7f4d",light:"#7f7f7f4d",hcDark:"#7f7f7f4d",hcLight:"#666666"},localize("editorOverviewRulerBorder","Color of the overview ruler border.")),editorOverviewRulerBackground=registerColor("editorOverviewRuler.background",null,localize("editorOverviewRulerBackground","Background color of the editor overview ruler."));registerColor("editorGutter.background",{dark:editorBackground,light:editorBackground,hcDark:editorBackground,hcLight:editorBackground},localize("editorGutter","Background color of the editor gutter. The gutter contains the glyph margins and the line numbers."));registerColor("editorUnnecessaryCode.border",{dark:null,light:null,hcDark:Color.fromHex("#fff").transparent(.8),hcLight:contrastBorder},localize("unnecessaryCodeBorder","Border color of unnecessary (unused) source code in the editor."));const editorUnnecessaryCodeOpacity=registerColor("editorUnnecessaryCode.opacity",{dark:Color.fromHex("#000a"),light:Color.fromHex("#0007"),hcDark:null,hcLight:null},localize("unnecessaryCodeOpacity",`Opacity of unnecessary (unused) source code in the editor. For example, "#000000c0" will render the code with 75% opacity. For high contrast themes, use the  'editorUnnecessaryCode.border' theme color to underline unnecessary code instead of fading it out.`));registerColor("editorGhostText.border",{dark:null,light:null,hcDark:Color.fromHex("#fff").transparent(.8),hcLight:Color.fromHex("#292929").transparent(.8)},localize("editorGhostTextBorder","Border color of ghost text in the editor."));registerColor("editorGhostText.foreground",{dark:Color.fromHex("#ffffff56"),light:Color.fromHex("#0007"),hcDark:null,hcLight:null},localize("editorGhostTextForeground","Foreground color of the ghost text in the editor."));registerColor("editorGhostText.background",{dark:null,light:null,hcDark:null,hcLight:null},localize("editorGhostTextBackground","Background color of the ghost text in the editor."));const rulerRangeDefault=new Color(new RGBA(0,122,204,.6)),overviewRulerRangeHighlight=registerColor("editorOverviewRuler.rangeHighlightForeground",{dark:rulerRangeDefault,light:rulerRangeDefault,hcDark:rulerRangeDefault,hcLight:rulerRangeDefault},localize("overviewRulerRangeHighlight","Overview ruler marker color for range highlights. The color must not be opaque so as not to hide underlying decorations."),!0),overviewRulerError=registerColor("editorOverviewRuler.errorForeground",{dark:new Color(new RGBA(255,18,18,.7)),light:new Color(new RGBA(255,18,18,.7)),hcDark:new Color(new RGBA(255,50,50,1)),hcLight:"#B5200D"},localize("overviewRuleError","Overview ruler marker color for errors.")),overviewRulerWarning=registerColor("editorOverviewRuler.warningForeground",{dark:editorWarningForeground,light:editorWarningForeground,hcDark:editorWarningBorder,hcLight:editorWarningBorder},localize("overviewRuleWarning","Overview ruler marker color for warnings.")),overviewRulerInfo=registerColor("editorOverviewRuler.infoForeground",{dark:editorInfoForeground,light:editorInfoForeground,hcDark:editorInfoBorder,hcLight:editorInfoBorder},localize("overviewRuleInfo","Overview ruler marker color for infos.")),editorBracketHighlightingForeground1=registerColor("editorBracketHighlight.foreground1",{dark:"#FFD700",light:"#0431FAFF",hcDark:"#FFD700",hcLight:"#0431FAFF"},localize("editorBracketHighlightForeground1","Foreground color of brackets (1). Requires enabling bracket pair colorization.")),editorBracketHighlightingForeground2=registerColor("editorBracketHighlight.foreground2",{dark:"#DA70D6",light:"#319331FF",hcDark:"#DA70D6",hcLight:"#319331FF"},localize("editorBracketHighlightForeground2","Foreground color of brackets (2). Requires enabling bracket pair colorization.")),editorBracketHighlightingForeground3=registerColor("editorBracketHighlight.foreground3",{dark:"#179FFF",light:"#7B3814FF",hcDark:"#87CEFA",hcLight:"#7B3814FF"},localize("editorBracketHighlightForeground3","Foreground color of brackets (3). Requires enabling bracket pair colorization.")),editorBracketHighlightingForeground4=registerColor("editorBracketHighlight.foreground4",{dark:"#00000000",light:"#00000000",hcDark:"#00000000",hcLight:"#00000000"},localize("editorBracketHighlightForeground4","Foreground color of brackets (4). Requires enabling bracket pair colorization.")),editorBracketHighlightingForeground5=registerColor("editorBracketHighlight.foreground5",{dark:"#00000000",light:"#00000000",hcDark:"#00000000",hcLight:"#00000000"},localize("editorBracketHighlightForeground5","Foreground color of brackets (5). Requires enabling bracket pair colorization.")),editorBracketHighlightingForeground6=registerColor("editorBracketHighlight.foreground6",{dark:"#00000000",light:"#00000000",hcDark:"#00000000",hcLight:"#00000000"},localize("editorBracketHighlightForeground6","Foreground color of brackets (6). Requires enabling bracket pair colorization.")),editorBracketHighlightingUnexpectedBracketForeground=registerColor("editorBracketHighlight.unexpectedBracket.foreground",{dark:new Color(new RGBA(255,18,18,.8)),light:new Color(new RGBA(255,18,18,.8)),hcDark:new Color(new RGBA(255,50,50,1)),hcLight:""},localize("editorBracketHighlightUnexpectedBracketForeground","Foreground color of unexpected brackets.")),editorBracketPairGuideBackground1=registerColor("editorBracketPairGuide.background1",{dark:"#00000000",light:"#00000000",hcDark:"#00000000",hcLight:"#00000000"},localize("editorBracketPairGuide.background1","Background color of inactive bracket pair guides (1). Requires enabling bracket pair guides.")),editorBracketPairGuideBackground2=registerColor("editorBracketPairGuide.background2",{dark:"#00000000",light:"#00000000",hcDark:"#00000000",hcLight:"#00000000"},localize("editorBracketPairGuide.background2","Background color of inactive bracket pair guides (2). Requires enabling bracket pair guides.")),editorBracketPairGuideBackground3=registerColor("editorBracketPairGuide.background3",{dark:"#00000000",light:"#00000000",hcDark:"#00000000",hcLight:"#00000000"},localize("editorBracketPairGuide.background3","Background color of inactive bracket pair guides (3). Requires enabling bracket pair guides.")),editorBracketPairGuideBackground4=registerColor("editorBracketPairGuide.background4",{dark:"#00000000",light:"#00000000",hcDark:"#00000000",hcLight:"#00000000"},localize("editorBracketPairGuide.background4","Background color of inactive bracket pair guides (4). Requires enabling bracket pair guides.")),editorBracketPairGuideBackground5=registerColor("editorBracketPairGuide.background5",{dark:"#00000000",light:"#00000000",hcDark:"#00000000",hcLight:"#00000000"},localize("editorBracketPairGuide.background5","Background color of inactive bracket pair guides (5). Requires enabling bracket pair guides.")),editorBracketPairGuideBackground6=registerColor("editorBracketPairGuide.background6",{dark:"#00000000",light:"#00000000",hcDark:"#00000000",hcLight:"#00000000"},localize("editorBracketPairGuide.background6","Background color of inactive bracket pair guides (6). Requires enabling bracket pair guides.")),editorBracketPairGuideActiveBackground1=registerColor("editorBracketPairGuide.activeBackground1",{dark:"#00000000",light:"#00000000",hcDark:"#00000000",hcLight:"#00000000"},localize("editorBracketPairGuide.activeBackground1","Background color of active bracket pair guides (1). Requires enabling bracket pair guides.")),editorBracketPairGuideActiveBackground2=registerColor("editorBracketPairGuide.activeBackground2",{dark:"#00000000",light:"#00000000",hcDark:"#00000000",hcLight:"#00000000"},localize("editorBracketPairGuide.activeBackground2","Background color of active bracket pair guides (2). Requires enabling bracket pair guides.")),editorBracketPairGuideActiveBackground3=registerColor("editorBracketPairGuide.activeBackground3",{dark:"#00000000",light:"#00000000",hcDark:"#00000000",hcLight:"#00000000"},localize("editorBracketPairGuide.activeBackground3","Background color of active bracket pair guides (3). Requires enabling bracket pair guides.")),editorBracketPairGuideActiveBackground4=registerColor("editorBracketPairGuide.activeBackground4",{dark:"#00000000",light:"#00000000",hcDark:"#00000000",hcLight:"#00000000"},localize("editorBracketPairGuide.activeBackground4","Background color of active bracket pair guides (4). Requires enabling bracket pair guides.")),editorBracketPairGuideActiveBackground5=registerColor("editorBracketPairGuide.activeBackground5",{dark:"#00000000",light:"#00000000",hcDark:"#00000000",hcLight:"#00000000"},localize("editorBracketPairGuide.activeBackground5","Background color of active bracket pair guides (5). Requires enabling bracket pair guides.")),editorBracketPairGuideActiveBackground6=registerColor("editorBracketPairGuide.activeBackground6",{dark:"#00000000",light:"#00000000",hcDark:"#00000000",hcLight:"#00000000"},localize("editorBracketPairGuide.activeBackground6","Background color of active bracket pair guides (6). Requires enabling bracket pair guides."));registerColor("editorUnicodeHighlight.border",{dark:"#BD9B03",light:"#CEA33D",hcDark:"#ff0000",hcLight:"#CEA33D"},localize("editorUnicodeHighlight.border","Border color used to highlight unicode characters."));registerColor("editorUnicodeHighlight.background",{dark:"#bd9b0326",light:"#cea33d14",hcDark:"#00000000",hcLight:"#cea33d14"},localize("editorUnicodeHighlight.background","Background color used to highlight unicode characters."));registerThemingParticipant((K,C)=>{const W=K.getColor(editorBackground),V=K.getColor(editorLineHighlight),U=V&&!V.isTransparent()?V:W;U&&C.addRule(`.monaco-editor .inputarea.ime-input { background-color: ${U}; }`)});class LineNumbersOverlay extends DynamicViewOverlay{constructor(C){super(),this._context=C,this._readConfig(),this._lastCursorModelPosition=new Position$1(1,1),this._renderResult=null,this._activeLineNumber=1,this._context.addEventHandler(this)}_readConfig(){const C=this._context.configuration.options;this._lineHeight=C.get(66);const W=C.get(67);this._renderLineNumbers=W.renderType,this._renderCustomLineNumbers=W.renderFn,this._renderFinalNewline=C.get(94);const V=C.get(143);this._lineNumbersLeft=V.lineNumbersLeft,this._lineNumbersWidth=V.lineNumbersWidth}dispose(){this._context.removeEventHandler(this),this._renderResult=null,super.dispose()}onConfigurationChanged(C){return this._readConfig(),!0}onCursorStateChanged(C){const W=C.selections[0].getPosition();this._lastCursorModelPosition=this._context.viewModel.coordinatesConverter.convertViewPositionToModelPosition(W);let V=!1;return this._activeLineNumber!==W.lineNumber&&(this._activeLineNumber=W.lineNumber,V=!0),(this._renderLineNumbers===2||this._renderLineNumbers===3)&&(V=!0),V}onFlushed(C){return!0}onLinesChanged(C){return!0}onLinesDeleted(C){return!0}onLinesInserted(C){return!0}onScrollChanged(C){return C.scrollTopChanged}onZonesChanged(C){return!0}_getLineRenderLineNumber(C){const W=this._context.viewModel.coordinatesConverter.convertViewPositionToModelPosition(new Position$1(C,1));if(W.column!==1)return"";const V=W.lineNumber;if(this._renderCustomLineNumbers)return this._renderCustomLineNumbers(V);if(this._renderLineNumbers===2){const U=Math.abs(this._lastCursorModelPosition.lineNumber-V);return U===0?'<span class="relative-current-line-number">'+V+"</span>":String(U)}return this._renderLineNumbers===3?this._lastCursorModelPosition.lineNumber===V||V%10===0?String(V):"":String(V)}prepareRender(C){if(this._renderLineNumbers===0){this._renderResult=null;return}const W=isLinux?this._lineHeight%2===0?" lh-even":" lh-odd":"",V=C.visibleRange.startLineNumber,U=C.visibleRange.endLineNumber,G=this._context.viewModel.getLineCount(),Z=[];for(let X=V;X<=U;X++){const Q=X-V,J=this._getLineRenderLineNumber(X);if(!J){Z[Q]="";continue}let ee="";if(X===G&&this._context.viewModel.getLineLength(X)===0){if(this._renderFinalNewline==="off"){Z[Q]="";continue}this._renderFinalNewline==="dimmed"&&(ee=" dimmed-line-number")}X===this._activeLineNumber&&(ee=" active-line-number"),Z[Q]=`<div class="${LineNumbersOverlay.CLASS_NAME}${W}${ee}" style="left:${this._lineNumbersLeft}px;width:${this._lineNumbersWidth}px;">${J}</div>`}this._renderResult=Z}render(C,W){if(!this._renderResult)return"";const V=W-C;return V<0||V>=this._renderResult.length?"":this._renderResult[V]}}LineNumbersOverlay.CLASS_NAME="line-numbers";registerThemingParticipant((K,C)=>{const W=K.getColor(editorLineNumbers),V=K.getColor(editorDimmedLineNumber);V?C.addRule(`.monaco-editor .line-numbers.dimmed-line-number { color: ${V}; }`):W&&C.addRule(`.monaco-editor .line-numbers.dimmed-line-number { color: ${W.transparent(.4)}; }`)});const margin="";class Margin extends ViewPart{constructor(C){super(C);const W=this._context.configuration.options,V=W.get(143);this._canUseLayerHinting=!W.get(32),this._contentLeft=V.contentLeft,this._glyphMarginLeft=V.glyphMarginLeft,this._glyphMarginWidth=V.glyphMarginWidth,this._domNode=createFastDomNode(document.createElement("div")),this._domNode.setClassName(Margin.OUTER_CLASS_NAME),this._domNode.setPosition("absolute"),this._domNode.setAttribute("role","presentation"),this._domNode.setAttribute("aria-hidden","true"),this._glyphMarginBackgroundDomNode=createFastDomNode(document.createElement("div")),this._glyphMarginBackgroundDomNode.setClassName(Margin.CLASS_NAME),this._domNode.appendChild(this._glyphMarginBackgroundDomNode)}dispose(){super.dispose()}getDomNode(){return this._domNode}onConfigurationChanged(C){const W=this._context.configuration.options,V=W.get(143);return this._canUseLayerHinting=!W.get(32),this._contentLeft=V.contentLeft,this._glyphMarginLeft=V.glyphMarginLeft,this._glyphMarginWidth=V.glyphMarginWidth,!0}onScrollChanged(C){return super.onScrollChanged(C)||C.scrollTopChanged}prepareRender(C){}render(C){this._domNode.setLayerHinting(this._canUseLayerHinting),this._domNode.setContain("strict");const W=C.scrollTop-C.bigNumbersDelta;this._domNode.setTop(-W);const V=Math.min(C.scrollHeight,1e6);this._domNode.setHeight(V),this._domNode.setWidth(this._contentLeft),this._glyphMarginBackgroundDomNode.setLeft(this._glyphMarginLeft),this._glyphMarginBackgroundDomNode.setWidth(this._glyphMarginWidth),this._glyphMarginBackgroundDomNode.setHeight(V)}}Margin.CLASS_NAME="glyph-margin";Margin.OUTER_CLASS_NAME="margin";const mouseCursor="",MOUSE_CURSOR_TEXT_CSS_CLASS_NAME="monaco-mouse-cursor-text";class IMEImpl{constructor(){this._onDidChange=new Emitter$1,this.onDidChange=this._onDidChange.event,this._enabled=!0}get enabled(){return this._enabled}enable(){this._enabled=!0,this._onDidChange.fire()}disable(){this._enabled=!1,this._onDidChange.fire()}}const IME=new IMEImpl,IKeybindingService=createDecorator("keybindingService");var __decorate$24=globalThis&&globalThis.__decorate||function(K,C,W,V){var U=arguments.length,G=U<3?C:V===null?V=Object.getOwnPropertyDescriptor(C,W):V,Z;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")G=Reflect.decorate(K,C,W,V);else for(var X=K.length-1;X>=0;X--)(Z=K[X])&&(G=(U<3?Z(G):U>3?Z(C,W,G):Z(C,W))||G);return U>3&&G&&Object.defineProperty(C,W,G),G},__param$1_=globalThis&&globalThis.__param||function(K,C){return function(W,V){C(W,V,K)}};class VisibleTextAreaData{constructor(C,W,V,U,G){this._context=C,this.modelLineNumber=W,this.distanceToModelLineStart=V,this.widthOfHiddenLineTextBefore=U,this.distanceToModelLineEnd=G,this._visibleTextAreaBrand=void 0,this.startPosition=null,this.endPosition=null,this.visibleTextareaStart=null,this.visibleTextareaEnd=null,this._previousPresentation=null}prepareRender(C){const W=new Position$1(this.modelLineNumber,this.distanceToModelLineStart+1),V=new Position$1(this.modelLineNumber,this._context.viewModel.model.getLineMaxColumn(this.modelLineNumber)-this.distanceToModelLineEnd);this.startPosition=this._context.viewModel.coordinatesConverter.convertModelPositionToViewPosition(W),this.endPosition=this._context.viewModel.coordinatesConverter.convertModelPositionToViewPosition(V),this.startPosition.lineNumber===this.endPosition.lineNumber?(this.visibleTextareaStart=C.visibleRangeForPosition(this.startPosition),this.visibleTextareaEnd=C.visibleRangeForPosition(this.endPosition)):(this.visibleTextareaStart=null,this.visibleTextareaEnd=null)}definePresentation(C){return this._previousPresentation||(C?this._previousPresentation=C:this._previousPresentation={foreground:1,italic:!1,bold:!1,underline:!1,strikethrough:!1}),this._previousPresentation}}const canUseZeroSizeTextarea=isFirefox;let TextAreaHandler=class extends ViewPart{constructor(C,W,V,U){super(C),this._keybindingService=U,this._primaryCursorPosition=new Position$1(1,1),this._primaryCursorVisibleRange=null,this._viewController=W,this._visibleRangeProvider=V,this._scrollLeft=0,this._scrollTop=0;const G=this._context.configuration.options,Z=G.get(143);this._setAccessibilityOptions(G),this._contentLeft=Z.contentLeft,this._contentWidth=Z.contentWidth,this._contentHeight=Z.height,this._fontInfo=G.get(50),this._lineHeight=G.get(66),this._emptySelectionClipboard=G.get(37),this._copyWithSyntaxHighlighting=G.get(25),this._visibleTextArea=null,this._selections=[new Selection$1(1,1,1,1)],this._modelSelections=[new Selection$1(1,1,1,1)],this._lastRenderPosition=null,this.textArea=createFastDomNode(document.createElement("textarea")),PartFingerprints.write(this.textArea,6),this.textArea.setClassName(`inputarea ${MOUSE_CURSOR_TEXT_CSS_CLASS_NAME}`),this.textArea.setAttribute("wrap",this._textAreaWrapping&&!this._visibleTextArea?"on":"off");const{tabSize:X}=this._context.viewModel.model.getOptions();this.textArea.domNode.style.tabSize=`${X*this._fontInfo.spaceWidth}px`,this.textArea.setAttribute("autocorrect","off"),this.textArea.setAttribute("autocapitalize","off"),this.textArea.setAttribute("autocomplete","off"),this.textArea.setAttribute("spellcheck","false"),this.textArea.setAttribute("aria-label",this._getAriaLabel(G)),this.textArea.setAttribute("aria-required",G.get(5)?"true":"false"),this.textArea.setAttribute("tabindex",String(G.get(123))),this.textArea.setAttribute("role","textbox"),this.textArea.setAttribute("aria-roledescription",localize("editor","editor")),this.textArea.setAttribute("aria-multiline","true"),this.textArea.setAttribute("aria-autocomplete",G.get(90)?"none":"both"),this._ensureReadOnlyAttribute(),this.textAreaCover=createFastDomNode(document.createElement("div")),this.textAreaCover.setPosition("absolute");const Q={getLineCount:()=>this._context.viewModel.getLineCount(),getLineMaxColumn:te=>this._context.viewModel.getLineMaxColumn(te),getValueInRange:(te,ie)=>this._context.viewModel.getValueInRange(te,ie),getValueLengthInRange:(te,ie)=>this._context.viewModel.getValueLengthInRange(te,ie),modifyPosition:(te,ie)=>this._context.viewModel.modifyPosition(te,ie)},J={getDataToCopy:()=>{const te=this._context.viewModel.getPlainTextToCopy(this._modelSelections,this._emptySelectionClipboard,isWindows),ie=this._context.viewModel.model.getEOL(),ne=this._emptySelectionClipboard&&this._modelSelections.length===1&&this._modelSelections[0].isEmpty(),oe=Array.isArray(te)?te:null,re=Array.isArray(te)?te.join(ie):te;let ae,se=null;if(CopyOptions.forceCopyWithSyntaxHighlighting||this._copyWithSyntaxHighlighting&&re.length<65536){const le=this._context.viewModel.getRichTextToCopy(this._modelSelections,this._emptySelectionClipboard);le&&(ae=le.html,se=le.mode)}return{isFromEmptySelection:ne,multicursorText:oe,text:re,html:ae,mode:se}},getScreenReaderContent:()=>{if(this._accessibilitySupport===1){const te=this._selections[0];if(isMacintosh&&te.isEmpty()){const ne=te.getStartPosition();let oe=this._getWordBeforePosition(ne);if(oe.length===0&&(oe=this._getCharacterBeforePosition(ne)),oe.length>0)return new TextAreaState(oe,oe.length,oe.length,Range$2.fromPositions(ne),0)}const ie=500;if(isMacintosh&&!te.isEmpty()&&Q.getValueLengthInRange(te,0)<ie){const ne=Q.getValueInRange(te,0);return new TextAreaState(ne,0,ne.length,te,0)}if(isSafari&&!te.isEmpty()){const ne="vscode-placeholder";return new TextAreaState(ne,0,ne.length,null,void 0)}return TextAreaState.EMPTY}if(isAndroid){const te=this._selections[0];if(te.isEmpty()){const ie=te.getStartPosition(),[ne,oe]=this._getAndroidWordAtPosition(ie);if(ne.length>0)return new TextAreaState(ne,oe,oe,Range$2.fromPositions(ie),0)}return TextAreaState.EMPTY}return PagedScreenReaderStrategy.fromEditorSelection(Q,this._selections[0],this._accessibilityPageSize,this._accessibilitySupport===0)},deduceModelPosition:(te,ie,ne)=>this._context.viewModel.deduceModelPositionRelativeToViewPosition(te,ie,ne)},ee=this._register(new TextAreaWrapper(this.textArea.domNode));this._textAreaInput=this._register(new TextAreaInput(J,ee,OS,{isAndroid,isChrome,isFirefox,isSafari})),this._register(this._textAreaInput.onKeyDown(te=>{this._viewController.emitKeyDown(te)})),this._register(this._textAreaInput.onKeyUp(te=>{this._viewController.emitKeyUp(te)})),this._register(this._textAreaInput.onPaste(te=>{let ie=!1,ne=null,oe=null;te.metadata&&(ie=this._emptySelectionClipboard&&!!te.metadata.isFromEmptySelection,ne=typeof te.metadata.multicursorText<"u"?te.metadata.multicursorText:null,oe=te.metadata.mode),this._viewController.paste(te.text,ie,ne,oe)})),this._register(this._textAreaInput.onCut(()=>{this._viewController.cut()})),this._register(this._textAreaInput.onType(te=>{te.replacePrevCharCnt||te.replaceNextCharCnt||te.positionDelta?this._viewController.compositionType(te.text,te.replacePrevCharCnt,te.replaceNextCharCnt,te.positionDelta):this._viewController.type(te.text)})),this._register(this._textAreaInput.onSelectionChangeRequest(te=>{this._viewController.setSelection(te)})),this._register(this._textAreaInput.onCompositionStart(te=>{const ie=this.textArea.domNode,ne=this._modelSelections[0],{distanceToModelLineStart:oe,widthOfHiddenTextBefore:re}=(()=>{const se=ie.value.substring(0,Math.min(ie.selectionStart,ie.selectionEnd)),le=se.lastIndexOf(`
`),ce=se.substring(le+1),de=ce.lastIndexOf("	"),ue=ce.length-de-1,ge=ne.getStartPosition(),he=Math.min(ge.column-1,ue),fe=ge.column-1-he,pe=ce.substring(0,ce.length-he),{tabSize:Se}=this._context.viewModel.model.getOptions(),Le=measureText(this.textArea.domNode.ownerDocument,pe,this._fontInfo,Se);return{distanceToModelLineStart:fe,widthOfHiddenTextBefore:Le}})(),{distanceToModelLineEnd:ae}=(()=>{const se=ie.value.substring(Math.max(ie.selectionStart,ie.selectionEnd)),le=se.indexOf(`
`),ce=le===-1?se:se.substring(0,le),de=ce.indexOf("	"),ue=de===-1?ce.length:ce.length-de-1,ge=ne.getEndPosition(),he=Math.min(this._context.viewModel.model.getLineMaxColumn(ge.lineNumber)-ge.column,ue);return{distanceToModelLineEnd:this._context.viewModel.model.getLineMaxColumn(ge.lineNumber)-ge.column-he}})();this._context.viewModel.revealRange("keyboard",!0,Range$2.fromPositions(this._selections[0].getStartPosition()),0,1),this._visibleTextArea=new VisibleTextAreaData(this._context,ne.startLineNumber,oe,re,ae),this.textArea.setAttribute("wrap",this._textAreaWrapping&&!this._visibleTextArea?"on":"off"),this._visibleTextArea.prepareRender(this._visibleRangeProvider),this._render(),this.textArea.setClassName(`inputarea ${MOUSE_CURSOR_TEXT_CSS_CLASS_NAME} ime-input`),this._viewController.compositionStart(),this._context.viewModel.onCompositionStart()})),this._register(this._textAreaInput.onCompositionUpdate(te=>{this._visibleTextArea&&(this._visibleTextArea.prepareRender(this._visibleRangeProvider),this._render())})),this._register(this._textAreaInput.onCompositionEnd(()=>{this._visibleTextArea=null,this.textArea.setAttribute("wrap",this._textAreaWrapping&&!this._visibleTextArea?"on":"off"),this._render(),this.textArea.setClassName(`inputarea ${MOUSE_CURSOR_TEXT_CSS_CLASS_NAME}`),this._viewController.compositionEnd(),this._context.viewModel.onCompositionEnd()})),this._register(this._textAreaInput.onFocus(()=>{this._context.viewModel.setHasFocus(!0)})),this._register(this._textAreaInput.onBlur(()=>{this._context.viewModel.setHasFocus(!1)})),this._register(IME.onDidChange(()=>{this._ensureReadOnlyAttribute()}))}writeScreenReaderContent(C){this._textAreaInput.writeScreenReaderContent(C)}dispose(){super.dispose()}_getAndroidWordAtPosition(C){const W='`~!@#$%^&*()-=+[{]}\\|;:",.<>/?',V=this._context.viewModel.getLineContent(C.lineNumber),U=getMapForWordSeparators(W);let G=!0,Z=C.column,X=!0,Q=C.column,J=0;for(;J<50&&(G||X);){if(G&&Z<=1&&(G=!1),G){const ee=V.charCodeAt(Z-2);U.get(ee)!==0?G=!1:Z--}if(X&&Q>V.length&&(X=!1),X){const ee=V.charCodeAt(Q-1);U.get(ee)!==0?X=!1:Q++}J++}return[V.substring(Z-1,Q-1),C.column-Z]}_getWordBeforePosition(C){const W=this._context.viewModel.getLineContent(C.lineNumber),V=getMapForWordSeparators(this._context.configuration.options.get(129));let U=C.column,G=0;for(;U>1;){const Z=W.charCodeAt(U-2);if(V.get(Z)!==0||G>50)return W.substring(U-1,C.column-1);G++,U--}return W.substring(0,C.column-1)}_getCharacterBeforePosition(C){if(C.column>1){const V=this._context.viewModel.getLineContent(C.lineNumber).charAt(C.column-2);if(!isHighSurrogate(V.charCodeAt(0)))return V}return""}_getAriaLabel(C){var W,V,U;if(C.get(2)===1){const Z=(W=this._keybindingService.lookupKeybinding("editor.action.toggleScreenReaderAccessibilityMode"))===null||W===void 0?void 0:W.getAriaLabel(),X=(V=this._keybindingService.lookupKeybinding("workbench.action.showCommands"))===null||V===void 0?void 0:V.getAriaLabel(),Q=(U=this._keybindingService.lookupKeybinding("workbench.action.openGlobalKeybindings"))===null||U===void 0?void 0:U.getAriaLabel(),J=localize("accessibilityModeOff","The editor is not accessible at this time.");return Z?localize("accessibilityOffAriaLabel","{0} To enable screen reader optimized mode, use {1}",J,Z):X?localize("accessibilityOffAriaLabelNoKb","{0} To enable screen reader optimized mode, open the quick pick with {1} and run the command Toggle Screen Reader Accessibility Mode, which is currently not triggerable via keyboard.",J,X):Q?localize("accessibilityOffAriaLabelNoKbs","{0} Please assign a keybinding for the command Toggle Screen Reader Accessibility Mode by accessing the keybindings editor with {1} and run it.",J,Q):J}return C.get(4)}_setAccessibilityOptions(C){this._accessibilitySupport=C.get(2);const W=C.get(3);this._accessibilitySupport===2&&W===EditorOptions.accessibilityPageSize.defaultValue?this._accessibilityPageSize=500:this._accessibilityPageSize=W;const U=C.get(143).wrappingColumn;if(U!==-1&&this._accessibilitySupport!==1){const G=C.get(50);this._textAreaWrapping=!0,this._textAreaWidth=Math.round(U*G.typicalHalfwidthCharacterWidth)}else this._textAreaWrapping=!1,this._textAreaWidth=canUseZeroSizeTextarea?0:1}onConfigurationChanged(C){const W=this._context.configuration.options,V=W.get(143);this._setAccessibilityOptions(W),this._contentLeft=V.contentLeft,this._contentWidth=V.contentWidth,this._contentHeight=V.height,this._fontInfo=W.get(50),this._lineHeight=W.get(66),this._emptySelectionClipboard=W.get(37),this._copyWithSyntaxHighlighting=W.get(25),this.textArea.setAttribute("wrap",this._textAreaWrapping&&!this._visibleTextArea?"on":"off");const{tabSize:U}=this._context.viewModel.model.getOptions();return this.textArea.domNode.style.tabSize=`${U*this._fontInfo.spaceWidth}px`,this.textArea.setAttribute("aria-label",this._getAriaLabel(W)),this.textArea.setAttribute("aria-required",W.get(5)?"true":"false"),this.textArea.setAttribute("tabindex",String(W.get(123))),(C.hasChanged(34)||C.hasChanged(90))&&this._ensureReadOnlyAttribute(),C.hasChanged(2)&&this._textAreaInput.writeScreenReaderContent("strategy changed"),!0}onCursorStateChanged(C){return this._selections=C.selections.slice(0),this._modelSelections=C.modelSelections.slice(0),this._textAreaInput.writeScreenReaderContent("selection changed"),!0}onDecorationsChanged(C){return!0}onFlushed(C){return!0}onLinesChanged(C){return!0}onLinesDeleted(C){return!0}onLinesInserted(C){return!0}onScrollChanged(C){return this._scrollLeft=C.scrollLeft,this._scrollTop=C.scrollTop,!0}onZonesChanged(C){return!0}isFocused(){return this._textAreaInput.isFocused()}focusTextArea(){this._textAreaInput.focusTextArea()}getLastRenderData(){return this._lastRenderPosition}setAriaOptions(C){C.activeDescendant?(this.textArea.setAttribute("aria-haspopup","true"),this.textArea.setAttribute("aria-autocomplete","list"),this.textArea.setAttribute("aria-activedescendant",C.activeDescendant)):(this.textArea.setAttribute("aria-haspopup","false"),this.textArea.setAttribute("aria-autocomplete","both"),this.textArea.removeAttribute("aria-activedescendant")),C.role&&this.textArea.setAttribute("role",C.role)}_ensureReadOnlyAttribute(){const C=this._context.configuration.options;!IME.enabled||C.get(34)&&C.get(90)?this.textArea.setAttribute("readonly","true"):this.textArea.removeAttribute("readonly")}prepareRender(C){var W;this._primaryCursorPosition=new Position$1(this._selections[0].positionLineNumber,this._selections[0].positionColumn),this._primaryCursorVisibleRange=C.visibleRangeForPosition(this._primaryCursorPosition),(W=this._visibleTextArea)===null||W===void 0||W.prepareRender(C)}render(C){this._textAreaInput.writeScreenReaderContent("render"),this._render()}_render(){var C;if(this._visibleTextArea){const U=this._visibleTextArea.visibleTextareaStart,G=this._visibleTextArea.visibleTextareaEnd,Z=this._visibleTextArea.startPosition,X=this._visibleTextArea.endPosition;if(Z&&X&&U&&G&&G.left>=this._scrollLeft&&U.left<=this._scrollLeft+this._contentWidth){const Q=this._context.viewLayout.getVerticalOffsetForLineNumber(this._primaryCursorPosition.lineNumber)-this._scrollTop,J=this._newlinecount(this.textArea.domNode.value.substr(0,this.textArea.domNode.selectionStart));let ee=this._visibleTextArea.widthOfHiddenLineTextBefore,te=this._contentLeft+U.left-this._scrollLeft,ie=G.left-U.left+1;if(te<this._contentLeft){const le=this._contentLeft-te;te+=le,ee+=le,ie-=le}ie>this._contentWidth&&(ie=this._contentWidth);const ne=this._context.viewModel.getViewLineData(Z.lineNumber),oe=ne.tokens.findTokenIndexAtOffset(Z.column-1),re=ne.tokens.findTokenIndexAtOffset(X.column-1),ae=oe===re,se=this._visibleTextArea.definePresentation(ae?ne.tokens.getPresentation(oe):null);this.textArea.domNode.scrollTop=J*this._lineHeight,this.textArea.domNode.scrollLeft=ee,this._doRender({lastRenderPosition:null,top:Q,left:te,width:ie,height:this._lineHeight,useCover:!1,color:(TokenizationRegistry.getColorMap()||[])[se.foreground],italic:se.italic,bold:se.bold,underline:se.underline,strikethrough:se.strikethrough})}return}if(!this._primaryCursorVisibleRange){this._renderAtTopLeft();return}const W=this._contentLeft+this._primaryCursorVisibleRange.left-this._scrollLeft;if(W<this._contentLeft||W>this._contentLeft+this._contentWidth){this._renderAtTopLeft();return}const V=this._context.viewLayout.getVerticalOffsetForLineNumber(this._selections[0].positionLineNumber)-this._scrollTop;if(V<0||V>this._contentHeight){this._renderAtTopLeft();return}if(isMacintosh){this._doRender({lastRenderPosition:this._primaryCursorPosition,top:V,left:this._textAreaWrapping?this._contentLeft:W,width:this._textAreaWidth,height:this._lineHeight,useCover:!1}),this.textArea.domNode.scrollLeft=this._primaryCursorVisibleRange.left;const U=(C=this._textAreaInput.textAreaState.newlineCountBeforeSelection)!==null&&C!==void 0?C:this._newlinecount(this.textArea.domNode.value.substr(0,this.textArea.domNode.selectionStart));this.textArea.domNode.scrollTop=U*this._lineHeight;return}this._doRender({lastRenderPosition:this._primaryCursorPosition,top:V,left:this._textAreaWrapping?this._contentLeft:W,width:this._textAreaWidth,height:canUseZeroSizeTextarea?0:1,useCover:!1})}_newlinecount(C){let W=0,V=-1;do{if(V=C.indexOf(`
`,V+1),V===-1)break;W++}while(!0);return W}_renderAtTopLeft(){this._doRender({lastRenderPosition:null,top:0,left:0,width:this._textAreaWidth,height:canUseZeroSizeTextarea?0:1,useCover:!0})}_doRender(C){this._lastRenderPosition=C.lastRenderPosition;const W=this.textArea,V=this.textAreaCover;applyFontInfo(W,this._fontInfo),W.setTop(C.top),W.setLeft(C.left),W.setWidth(C.width),W.setHeight(C.height),W.setColor(C.color?Color.Format.CSS.formatHex(C.color):""),W.setFontStyle(C.italic?"italic":""),C.bold&&W.setFontWeight("bold"),W.setTextDecoration(`${C.underline?" underline":""}${C.strikethrough?" line-through":""}`),V.setTop(C.useCover?C.top:0),V.setLeft(C.useCover?C.left:0),V.setWidth(C.useCover?C.width:0),V.setHeight(C.useCover?C.height:0);const U=this._context.configuration.options;U.get(57)?V.setClassName("monaco-editor-background textAreaCover "+Margin.OUTER_CLASS_NAME):U.get(67).renderType!==0?V.setClassName("monaco-editor-background textAreaCover "+LineNumbersOverlay.CLASS_NAME):V.setClassName("monaco-editor-background textAreaCover")}};TextAreaHandler=__decorate$24([__param$1_(3,IKeybindingService)],TextAreaHandler);function measureText(K,C,W,V){if(C.length===0)return 0;const U=K.createElement("div");U.style.position="absolute",U.style.top="-50000px",U.style.width="50000px";const G=K.createElement("span");applyFontInfo(G,W),G.style.whiteSpace="pre",G.style.tabSize=`${V*W.spaceWidth}px`,G.append(C),U.appendChild(G),K.body.appendChild(U);const Z=G.offsetWidth;return K.body.removeChild(U),Z}function _normalizeIndentationFromWhitespace(K,C,W){let V=0;for(let G=0;G<K.length;G++)K.charAt(G)==="	"?V=CursorColumns.nextIndentTabStop(V,C):V++;let U="";if(!W){const G=Math.floor(V/C);V=V%C;for(let Z=0;Z<G;Z++)U+="	"}for(let G=0;G<V;G++)U+=" ";return U}function normalizeIndentation(K,C,W){let V=firstNonWhitespaceIndex(K);return V===-1&&(V=K.length),_normalizeIndentationFromWhitespace(K.substring(0,V),C,W)+K.substring(V)}const autoCloseAlways=()=>!0,autoCloseNever=()=>!1,autoCloseBeforeWhitespace=K=>K===" "||K==="	";class CursorConfiguration{static shouldRecreate(C){return C.hasChanged(143)||C.hasChanged(129)||C.hasChanged(37)||C.hasChanged(76)||C.hasChanged(78)||C.hasChanged(79)||C.hasChanged(6)||C.hasChanged(7)||C.hasChanged(11)||C.hasChanged(9)||C.hasChanged(10)||C.hasChanged(14)||C.hasChanged(127)||C.hasChanged(50)||C.hasChanged(90)}constructor(C,W,V,U){var G;this.languageConfigurationService=U,this._cursorMoveConfigurationBrand=void 0,this._languageId=C;const Z=V.options,X=Z.get(143),Q=Z.get(50);this.readOnly=Z.get(90),this.tabSize=W.tabSize,this.indentSize=W.indentSize,this.insertSpaces=W.insertSpaces,this.stickyTabStops=Z.get(115),this.lineHeight=Q.lineHeight,this.typicalHalfwidthCharacterWidth=Q.typicalHalfwidthCharacterWidth,this.pageSize=Math.max(1,Math.floor(X.height/this.lineHeight)-2),this.useTabStops=Z.get(127),this.wordSeparators=Z.get(129),this.emptySelectionClipboard=Z.get(37),this.copyWithSyntaxHighlighting=Z.get(25),this.multiCursorMergeOverlapping=Z.get(76),this.multiCursorPaste=Z.get(78),this.multiCursorLimit=Z.get(79),this.autoClosingBrackets=Z.get(6),this.autoClosingComments=Z.get(7),this.autoClosingQuotes=Z.get(11),this.autoClosingDelete=Z.get(9),this.autoClosingOvertype=Z.get(10),this.autoSurround=Z.get(14),this.autoIndent=Z.get(12),this.surroundingPairs={},this._electricChars=null,this.shouldAutoCloseBefore={quote:this._getShouldAutoClose(C,this.autoClosingQuotes,!0),comment:this._getShouldAutoClose(C,this.autoClosingComments,!1),bracket:this._getShouldAutoClose(C,this.autoClosingBrackets,!1)},this.autoClosingPairs=this.languageConfigurationService.getLanguageConfiguration(C).getAutoClosingPairs();const J=this.languageConfigurationService.getLanguageConfiguration(C).getSurroundingPairs();if(J)for(const te of J)this.surroundingPairs[te.open]=te.close;const ee=this.languageConfigurationService.getLanguageConfiguration(C).comments;this.blockCommentStartToken=(G=ee==null?void 0:ee.blockCommentStartToken)!==null&&G!==void 0?G:null}get electricChars(){var C;if(!this._electricChars){this._electricChars={};const W=(C=this.languageConfigurationService.getLanguageConfiguration(this._languageId).electricCharacter)===null||C===void 0?void 0:C.getElectricCharacters();if(W)for(const V of W)this._electricChars[V]=!0}return this._electricChars}onElectricCharacter(C,W,V){const U=createScopedLineTokens(W,V-1),G=this.languageConfigurationService.getLanguageConfiguration(U.languageId).electricCharacter;return G?G.onElectricCharacter(C,U,V-U.firstCharOffset):null}normalizeIndentation(C){return normalizeIndentation(C,this.indentSize,this.insertSpaces)}_getShouldAutoClose(C,W,V){switch(W){case"beforeWhitespace":return autoCloseBeforeWhitespace;case"languageDefined":return this._getLanguageDefinedShouldAutoClose(C,V);case"always":return autoCloseAlways;case"never":return autoCloseNever}}_getLanguageDefinedShouldAutoClose(C,W){const V=this.languageConfigurationService.getLanguageConfiguration(C).getAutoCloseBeforeSet(W);return U=>V.indexOf(U)!==-1}visibleColumnFromColumn(C,W){return CursorColumns.visibleColumnFromColumn(C.getLineContent(W.lineNumber),W.column,this.tabSize)}columnFromVisibleColumn(C,W,V){const U=CursorColumns.columnFromVisibleColumn(C.getLineContent(W),V,this.tabSize),G=C.getLineMinColumn(W);if(U<G)return G;const Z=C.getLineMaxColumn(W);return U>Z?Z:U}}let CursorState$1=class oi{static fromModelState(C){return new PartialModelCursorState(C)}static fromViewState(C){return new PartialViewCursorState(C)}static fromModelSelection(C){const W=Selection$1.liftSelection(C),V=new SingleCursorState(Range$2.fromPositions(W.getSelectionStart()),0,0,W.getPosition(),0);return oi.fromModelState(V)}static fromModelSelections(C){const W=[];for(let V=0,U=C.length;V<U;V++)W[V]=this.fromModelSelection(C[V]);return W}constructor(C,W){this._cursorStateBrand=void 0,this.modelState=C,this.viewState=W}equals(C){return this.viewState.equals(C.viewState)&&this.modelState.equals(C.modelState)}};class PartialModelCursorState{constructor(C){this.modelState=C,this.viewState=null}}class PartialViewCursorState{constructor(C){this.modelState=null,this.viewState=C}}class SingleCursorState{constructor(C,W,V,U,G){this.selectionStart=C,this.selectionStartKind=W,this.selectionStartLeftoverVisibleColumns=V,this.position=U,this.leftoverVisibleColumns=G,this._singleCursorStateBrand=void 0,this.selection=SingleCursorState._computeSelection(this.selectionStart,this.position)}equals(C){return this.selectionStartLeftoverVisibleColumns===C.selectionStartLeftoverVisibleColumns&&this.leftoverVisibleColumns===C.leftoverVisibleColumns&&this.selectionStartKind===C.selectionStartKind&&this.position.equals(C.position)&&this.selectionStart.equalsRange(C.selectionStart)}hasSelection(){return!this.selection.isEmpty()||!this.selectionStart.isEmpty()}move(C,W,V,U){return C?new SingleCursorState(this.selectionStart,this.selectionStartKind,this.selectionStartLeftoverVisibleColumns,new Position$1(W,V),U):new SingleCursorState(new Range$2(W,V,W,V),0,U,new Position$1(W,V),U)}static _computeSelection(C,W){return C.isEmpty()||!W.isBeforeOrEqual(C.getStartPosition())?Selection$1.fromPositions(C.getStartPosition(),W):Selection$1.fromPositions(C.getEndPosition(),W)}}class EditOperationResult{constructor(C,W,V){this._editOperationResultBrand=void 0,this.type=C,this.commands=W,this.shouldPushStackElementBefore=V.shouldPushStackElementBefore,this.shouldPushStackElementAfter=V.shouldPushStackElementAfter}}function isQuote(K){return K==="'"||K==='"'||K==="`"}class ColumnSelection{static columnSelect(C,W,V,U,G,Z){const X=Math.abs(G-V)+1,Q=V>G,J=U>Z,ee=U<Z,te=[];for(let ie=0;ie<X;ie++){const ne=V+(Q?-ie:ie),oe=C.columnFromVisibleColumn(W,ne,U),re=C.columnFromVisibleColumn(W,ne,Z),ae=C.visibleColumnFromColumn(W,new Position$1(ne,oe)),se=C.visibleColumnFromColumn(W,new Position$1(ne,re));ee&&(ae>Z||se<U)||J&&(se>U||ae<Z)||te.push(new SingleCursorState(new Range$2(ne,oe,ne,oe),0,0,new Position$1(ne,re),0))}if(te.length===0)for(let ie=0;ie<X;ie++){const ne=V+(Q?-ie:ie),oe=W.getLineMaxColumn(ne);te.push(new SingleCursorState(new Range$2(ne,oe,ne,oe),0,0,new Position$1(ne,oe),0))}return{viewStates:te,reversed:Q,fromLineNumber:V,fromVisualColumn:U,toLineNumber:G,toVisualColumn:Z}}static columnSelectLeft(C,W,V){let U=V.toViewVisualColumn;return U>0&&U--,ColumnSelection.columnSelect(C,W,V.fromViewLineNumber,V.fromViewVisualColumn,V.toViewLineNumber,U)}static columnSelectRight(C,W,V){let U=0;const G=Math.min(V.fromViewLineNumber,V.toViewLineNumber),Z=Math.max(V.fromViewLineNumber,V.toViewLineNumber);for(let Q=G;Q<=Z;Q++){const J=W.getLineMaxColumn(Q),ee=C.visibleColumnFromColumn(W,new Position$1(Q,J));U=Math.max(U,ee)}let X=V.toViewVisualColumn;return X<U&&X++,this.columnSelect(C,W,V.fromViewLineNumber,V.fromViewVisualColumn,V.toViewLineNumber,X)}static columnSelectUp(C,W,V,U){const G=U?C.pageSize:1,Z=Math.max(1,V.toViewLineNumber-G);return this.columnSelect(C,W,V.fromViewLineNumber,V.fromViewVisualColumn,Z,V.toViewVisualColumn)}static columnSelectDown(C,W,V,U){const G=U?C.pageSize:1,Z=Math.min(W.getLineCount(),V.toViewLineNumber+G);return this.columnSelect(C,W,V.fromViewLineNumber,V.fromViewVisualColumn,Z,V.toViewVisualColumn)}}class ReplaceCommand{constructor(C,W,V=!1){this._range=C,this._text=W,this.insertsAutoWhitespace=V}getEditOperations(C,W){W.addTrackedEditOperation(this._range,this._text)}computeCursorState(C,W){const U=W.getInverseEditOperations()[0].range;return Selection$1.fromPositions(U.getEndPosition())}}class ReplaceCommandThatSelectsText{constructor(C,W){this._range=C,this._text=W}getEditOperations(C,W){W.addTrackedEditOperation(this._range,this._text)}computeCursorState(C,W){const U=W.getInverseEditOperations()[0].range;return Selection$1.fromRange(U,0)}}class ReplaceCommandWithoutChangingPosition{constructor(C,W,V=!1){this._range=C,this._text=W,this.insertsAutoWhitespace=V}getEditOperations(C,W){W.addTrackedEditOperation(this._range,this._text)}computeCursorState(C,W){const U=W.getInverseEditOperations()[0].range;return Selection$1.fromPositions(U.getStartPosition())}}class ReplaceCommandWithOffsetCursorState{constructor(C,W,V,U,G=!1){this._range=C,this._text=W,this._columnDeltaOffset=U,this._lineNumberDeltaOffset=V,this.insertsAutoWhitespace=G}getEditOperations(C,W){W.addTrackedEditOperation(this._range,this._text)}computeCursorState(C,W){const U=W.getInverseEditOperations()[0].range;return Selection$1.fromPositions(U.getEndPosition().delta(this._lineNumberDeltaOffset,this._columnDeltaOffset))}}class ReplaceCommandThatPreservesSelection{constructor(C,W,V,U=!1){this._range=C,this._text=W,this._initialSelection=V,this._forceMoveMarkers=U,this._selectionId=null}getEditOperations(C,W){W.addTrackedEditOperation(this._range,this._text,this._forceMoveMarkers),this._selectionId=W.trackSelection(this._initialSelection)}computeCursorState(C,W){return W.getTrackedSelection(this._selectionId)}}class CursorPosition{constructor(C,W,V){this._cursorPositionBrand=void 0,this.lineNumber=C,this.column=W,this.leftoverVisibleColumns=V}}class MoveOperations{static leftPosition(C,W){if(W.column>C.getLineMinColumn(W.lineNumber))return W.delta(void 0,-prevCharLength(C.getLineContent(W.lineNumber),W.column-1));if(W.lineNumber>1){const V=W.lineNumber-1;return new Position$1(V,C.getLineMaxColumn(V))}else return W}static leftPositionAtomicSoftTabs(C,W,V){if(W.column<=C.getLineIndentColumn(W.lineNumber)){const U=C.getLineMinColumn(W.lineNumber),G=C.getLineContent(W.lineNumber),Z=AtomicTabMoveOperations.atomicPosition(G,W.column-1,V,0);if(Z!==-1&&Z+1>=U)return new Position$1(W.lineNumber,Z+1)}return this.leftPosition(C,W)}static left(C,W,V){const U=C.stickyTabStops?MoveOperations.leftPositionAtomicSoftTabs(W,V,C.tabSize):MoveOperations.leftPosition(W,V);return new CursorPosition(U.lineNumber,U.column,0)}static moveLeft(C,W,V,U,G){let Z,X;if(V.hasSelection()&&!U)Z=V.selection.startLineNumber,X=V.selection.startColumn;else{const Q=V.position.delta(void 0,-(G-1)),J=W.normalizePosition(MoveOperations.clipPositionColumn(Q,W),0),ee=MoveOperations.left(C,W,J);Z=ee.lineNumber,X=ee.column}return V.move(U,Z,X,0)}static clipPositionColumn(C,W){return new Position$1(C.lineNumber,MoveOperations.clipRange(C.column,W.getLineMinColumn(C.lineNumber),W.getLineMaxColumn(C.lineNumber)))}static clipRange(C,W,V){return C<W?W:C>V?V:C}static rightPosition(C,W,V){return V<C.getLineMaxColumn(W)?V=V+nextCharLength(C.getLineContent(W),V-1):W<C.getLineCount()&&(W=W+1,V=C.getLineMinColumn(W)),new Position$1(W,V)}static rightPositionAtomicSoftTabs(C,W,V,U,G){if(V<C.getLineIndentColumn(W)){const Z=C.getLineContent(W),X=AtomicTabMoveOperations.atomicPosition(Z,V-1,U,1);if(X!==-1)return new Position$1(W,X+1)}return this.rightPosition(C,W,V)}static right(C,W,V){const U=C.stickyTabStops?MoveOperations.rightPositionAtomicSoftTabs(W,V.lineNumber,V.column,C.tabSize,C.indentSize):MoveOperations.rightPosition(W,V.lineNumber,V.column);return new CursorPosition(U.lineNumber,U.column,0)}static moveRight(C,W,V,U,G){let Z,X;if(V.hasSelection()&&!U)Z=V.selection.endLineNumber,X=V.selection.endColumn;else{const Q=V.position.delta(void 0,G-1),J=W.normalizePosition(MoveOperations.clipPositionColumn(Q,W),1),ee=MoveOperations.right(C,W,J);Z=ee.lineNumber,X=ee.column}return V.move(U,Z,X,0)}static vertical(C,W,V,U,G,Z,X,Q){const J=CursorColumns.visibleColumnFromColumn(W.getLineContent(V),U,C.tabSize)+G,ee=W.getLineCount(),te=V===1&&U===1,ie=V===ee&&U===W.getLineMaxColumn(V),ne=Z<V?te:ie;if(V=Z,V<1?(V=1,X?U=W.getLineMinColumn(V):U=Math.min(W.getLineMaxColumn(V),U)):V>ee?(V=ee,X?U=W.getLineMaxColumn(V):U=Math.min(W.getLineMaxColumn(V),U)):U=C.columnFromVisibleColumn(W,V,J),ne?G=0:G=J-CursorColumns.visibleColumnFromColumn(W.getLineContent(V),U,C.tabSize),Q!==void 0){const oe=new Position$1(V,U),re=W.normalizePosition(oe,Q);G=G+(U-re.column),V=re.lineNumber,U=re.column}return new CursorPosition(V,U,G)}static down(C,W,V,U,G,Z,X){return this.vertical(C,W,V,U,G,V+Z,X,4)}static moveDown(C,W,V,U,G){let Z,X;V.hasSelection()&&!U?(Z=V.selection.endLineNumber,X=V.selection.endColumn):(Z=V.position.lineNumber,X=V.position.column);let Q=0,J;do if(J=MoveOperations.down(C,W,Z+Q,X,V.leftoverVisibleColumns,G,!0),W.normalizePosition(new Position$1(J.lineNumber,J.column),2).lineNumber>Z)break;while(Q++<10&&Z+Q<W.getLineCount());return V.move(U,J.lineNumber,J.column,J.leftoverVisibleColumns)}static translateDown(C,W,V){const U=V.selection,G=MoveOperations.down(C,W,U.selectionStartLineNumber,U.selectionStartColumn,V.selectionStartLeftoverVisibleColumns,1,!1),Z=MoveOperations.down(C,W,U.positionLineNumber,U.positionColumn,V.leftoverVisibleColumns,1,!1);return new SingleCursorState(new Range$2(G.lineNumber,G.column,G.lineNumber,G.column),0,G.leftoverVisibleColumns,new Position$1(Z.lineNumber,Z.column),Z.leftoverVisibleColumns)}static up(C,W,V,U,G,Z,X){return this.vertical(C,W,V,U,G,V-Z,X,3)}static moveUp(C,W,V,U,G){let Z,X;V.hasSelection()&&!U?(Z=V.selection.startLineNumber,X=V.selection.startColumn):(Z=V.position.lineNumber,X=V.position.column);const Q=MoveOperations.up(C,W,Z,X,V.leftoverVisibleColumns,G,!0);return V.move(U,Q.lineNumber,Q.column,Q.leftoverVisibleColumns)}static translateUp(C,W,V){const U=V.selection,G=MoveOperations.up(C,W,U.selectionStartLineNumber,U.selectionStartColumn,V.selectionStartLeftoverVisibleColumns,1,!1),Z=MoveOperations.up(C,W,U.positionLineNumber,U.positionColumn,V.leftoverVisibleColumns,1,!1);return new SingleCursorState(new Range$2(G.lineNumber,G.column,G.lineNumber,G.column),0,G.leftoverVisibleColumns,new Position$1(Z.lineNumber,Z.column),Z.leftoverVisibleColumns)}static _isBlankLine(C,W){return C.getLineFirstNonWhitespaceColumn(W)===0}static moveToPrevBlankLine(C,W,V,U){let G=V.position.lineNumber;for(;G>1&&this._isBlankLine(W,G);)G--;for(;G>1&&!this._isBlankLine(W,G);)G--;return V.move(U,G,W.getLineMinColumn(G),0)}static moveToNextBlankLine(C,W,V,U){const G=W.getLineCount();let Z=V.position.lineNumber;for(;Z<G&&this._isBlankLine(W,Z);)Z++;for(;Z<G&&!this._isBlankLine(W,Z);)Z++;return V.move(U,Z,W.getLineMinColumn(Z),0)}static moveToBeginningOfLine(C,W,V,U){const G=V.position.lineNumber,Z=W.getLineMinColumn(G),X=W.getLineFirstNonWhitespaceColumn(G)||Z;let Q;return V.position.column===X?Q=Z:Q=X,V.move(U,G,Q,0)}static moveToEndOfLine(C,W,V,U,G){const Z=V.position.lineNumber,X=W.getLineMaxColumn(Z);return V.move(U,Z,X,G?1073741824-X:0)}static moveToBeginningOfBuffer(C,W,V,U){return V.move(U,1,1,0)}static moveToEndOfBuffer(C,W,V,U){const G=W.getLineCount(),Z=W.getLineMaxColumn(G);return V.move(U,G,Z,0)}}class DeleteOperations{static deleteRight(C,W,V,U){const G=[];let Z=C!==3;for(let X=0,Q=U.length;X<Q;X++){const J=U[X];let ee=J;if(ee.isEmpty()){const te=J.getPosition(),ie=MoveOperations.right(W,V,te);ee=new Range$2(ie.lineNumber,ie.column,te.lineNumber,te.column)}if(ee.isEmpty()){G[X]=null;continue}ee.startLineNumber!==ee.endLineNumber&&(Z=!0),G[X]=new ReplaceCommand(ee,"")}return[Z,G]}static isAutoClosingPairDelete(C,W,V,U,G,Z,X){if(W==="never"&&V==="never"||C==="never")return!1;for(let Q=0,J=Z.length;Q<J;Q++){const ee=Z[Q],te=ee.getPosition();if(!ee.isEmpty())return!1;const ie=G.getLineContent(te.lineNumber);if(te.column<2||te.column>=ie.length+1)return!1;const ne=ie.charAt(te.column-2),oe=U.get(ne);if(!oe)return!1;if(isQuote(ne)){if(V==="never")return!1}else if(W==="never")return!1;const re=ie.charAt(te.column-1);let ae=!1;for(const se of oe)se.open===ne&&se.close===re&&(ae=!0);if(!ae)return!1;if(C==="auto"){let se=!1;for(let le=0,ce=X.length;le<ce;le++){const de=X[le];if(te.lineNumber===de.startLineNumber&&te.column===de.startColumn){se=!0;break}}if(!se)return!1}}return!0}static _runAutoClosingPairDelete(C,W,V){const U=[];for(let G=0,Z=V.length;G<Z;G++){const X=V[G].getPosition(),Q=new Range$2(X.lineNumber,X.column-1,X.lineNumber,X.column+1);U[G]=new ReplaceCommand(Q,"")}return[!0,U]}static deleteLeft(C,W,V,U,G){if(this.isAutoClosingPairDelete(W.autoClosingDelete,W.autoClosingBrackets,W.autoClosingQuotes,W.autoClosingPairs.autoClosingPairsOpenByEnd,V,U,G))return this._runAutoClosingPairDelete(W,V,U);const Z=[];let X=C!==2;for(let Q=0,J=U.length;Q<J;Q++){const ee=DeleteOperations.getDeleteRange(U[Q],V,W);if(ee.isEmpty()){Z[Q]=null;continue}ee.startLineNumber!==ee.endLineNumber&&(X=!0),Z[Q]=new ReplaceCommand(ee,"")}return[X,Z]}static getDeleteRange(C,W,V){if(!C.isEmpty())return C;const U=C.getPosition();if(V.useTabStops&&U.column>1){const G=W.getLineContent(U.lineNumber),Z=firstNonWhitespaceIndex(G),X=Z===-1?G.length+1:Z+1;if(U.column<=X){const Q=V.visibleColumnFromColumn(W,U),J=CursorColumns.prevIndentTabStop(Q,V.indentSize),ee=V.columnFromVisibleColumn(W,U.lineNumber,J);return new Range$2(U.lineNumber,ee,U.lineNumber,U.column)}}return Range$2.fromPositions(DeleteOperations.getPositionAfterDeleteLeft(U,W),U)}static getPositionAfterDeleteLeft(C,W){if(C.column>1){const V=getLeftDeleteOffset(C.column-1,W.getLineContent(C.lineNumber));return C.with(void 0,V+1)}else if(C.lineNumber>1){const V=C.lineNumber-1;return new Position$1(V,W.getLineMaxColumn(V))}else return C}static cut(C,W,V){const U=[];let G=null;V.sort((Z,X)=>Position$1.compare(Z.getStartPosition(),X.getEndPosition()));for(let Z=0,X=V.length;Z<X;Z++){const Q=V[Z];if(Q.isEmpty())if(C.emptySelectionClipboard){const J=Q.getPosition();let ee,te,ie,ne;J.lineNumber<W.getLineCount()?(ee=J.lineNumber,te=1,ie=J.lineNumber+1,ne=1):J.lineNumber>1&&(G==null?void 0:G.endLineNumber)!==J.lineNumber?(ee=J.lineNumber-1,te=W.getLineMaxColumn(J.lineNumber-1),ie=J.lineNumber,ne=W.getLineMaxColumn(J.lineNumber)):(ee=J.lineNumber,te=1,ie=J.lineNumber,ne=W.getLineMaxColumn(J.lineNumber));const oe=new Range$2(ee,te,ie,ne);G=oe,oe.isEmpty()?U[Z]=null:U[Z]=new ReplaceCommand(oe,"")}else U[Z]=null;else U[Z]=new ReplaceCommand(Q,"")}return new EditOperationResult(0,U,{shouldPushStackElementBefore:!0,shouldPushStackElementAfter:!0})}}class WordOperations{static _createWord(C,W,V,U,G){return{start:U,end:G,wordType:W,nextCharClass:V}}static _findPreviousWordOnLine(C,W,V){const U=W.getLineContent(V.lineNumber);return this._doFindPreviousWordOnLine(U,C,V)}static _doFindPreviousWordOnLine(C,W,V){let U=0;for(let G=V.column-2;G>=0;G--){const Z=C.charCodeAt(G),X=W.get(Z);if(X===0){if(U===2)return this._createWord(C,U,X,G+1,this._findEndOfWord(C,W,U,G+1));U=1}else if(X===2){if(U===1)return this._createWord(C,U,X,G+1,this._findEndOfWord(C,W,U,G+1));U=2}else if(X===1&&U!==0)return this._createWord(C,U,X,G+1,this._findEndOfWord(C,W,U,G+1))}return U!==0?this._createWord(C,U,1,0,this._findEndOfWord(C,W,U,0)):null}static _findEndOfWord(C,W,V,U){const G=C.length;for(let Z=U;Z<G;Z++){const X=C.charCodeAt(Z),Q=W.get(X);if(Q===1||V===1&&Q===2||V===2&&Q===0)return Z}return G}static _findNextWordOnLine(C,W,V){const U=W.getLineContent(V.lineNumber);return this._doFindNextWordOnLine(U,C,V)}static _doFindNextWordOnLine(C,W,V){let U=0;const G=C.length;for(let Z=V.column-1;Z<G;Z++){const X=C.charCodeAt(Z),Q=W.get(X);if(Q===0){if(U===2)return this._createWord(C,U,Q,this._findStartOfWord(C,W,U,Z-1),Z);U=1}else if(Q===2){if(U===1)return this._createWord(C,U,Q,this._findStartOfWord(C,W,U,Z-1),Z);U=2}else if(Q===1&&U!==0)return this._createWord(C,U,Q,this._findStartOfWord(C,W,U,Z-1),Z)}return U!==0?this._createWord(C,U,1,this._findStartOfWord(C,W,U,G-1),G):null}static _findStartOfWord(C,W,V,U){for(let G=U;G>=0;G--){const Z=C.charCodeAt(G),X=W.get(Z);if(X===1||V===1&&X===2||V===2&&X===0)return G+1}return 0}static moveWordLeft(C,W,V,U){let G=V.lineNumber,Z=V.column;Z===1&&G>1&&(G=G-1,Z=W.getLineMaxColumn(G));let X=WordOperations._findPreviousWordOnLine(C,W,new Position$1(G,Z));if(U===0)return new Position$1(G,X?X.start+1:1);if(U===1)return X&&X.wordType===2&&X.end-X.start===1&&X.nextCharClass===0&&(X=WordOperations._findPreviousWordOnLine(C,W,new Position$1(G,X.start+1))),new Position$1(G,X?X.start+1:1);if(U===3){for(;X&&X.wordType===2;)X=WordOperations._findPreviousWordOnLine(C,W,new Position$1(G,X.start+1));return new Position$1(G,X?X.start+1:1)}return X&&Z<=X.end+1&&(X=WordOperations._findPreviousWordOnLine(C,W,new Position$1(G,X.start+1))),new Position$1(G,X?X.end+1:1)}static _moveWordPartLeft(C,W){const V=W.lineNumber,U=C.getLineMaxColumn(V);if(W.column===1)return V>1?new Position$1(V-1,C.getLineMaxColumn(V-1)):W;const G=C.getLineContent(V);for(let Z=W.column-1;Z>1;Z--){const X=G.charCodeAt(Z-2),Q=G.charCodeAt(Z-1);if(X===95&&Q!==95)return new Position$1(V,Z);if(X===45&&Q!==45)return new Position$1(V,Z);if((isLowerAsciiLetter(X)||isAsciiDigit(X))&&isUpperAsciiLetter(Q))return new Position$1(V,Z);if(isUpperAsciiLetter(X)&&isUpperAsciiLetter(Q)&&Z+1<U){const J=G.charCodeAt(Z);if(isLowerAsciiLetter(J)||isAsciiDigit(J))return new Position$1(V,Z)}}return new Position$1(V,1)}static moveWordRight(C,W,V,U){let G=V.lineNumber,Z=V.column,X=!1;Z===W.getLineMaxColumn(G)&&G<W.getLineCount()&&(X=!0,G=G+1,Z=1);let Q=WordOperations._findNextWordOnLine(C,W,new Position$1(G,Z));if(U===2)Q&&Q.wordType===2&&Q.end-Q.start===1&&Q.nextCharClass===0&&(Q=WordOperations._findNextWordOnLine(C,W,new Position$1(G,Q.end+1))),Q?Z=Q.end+1:Z=W.getLineMaxColumn(G);else if(U===3){for(X&&(Z=0);Q&&(Q.wordType===2||Q.start+1<=Z);)Q=WordOperations._findNextWordOnLine(C,W,new Position$1(G,Q.end+1));Q?Z=Q.start+1:Z=W.getLineMaxColumn(G)}else Q&&!X&&Z>=Q.start+1&&(Q=WordOperations._findNextWordOnLine(C,W,new Position$1(G,Q.end+1))),Q?Z=Q.start+1:Z=W.getLineMaxColumn(G);return new Position$1(G,Z)}static _moveWordPartRight(C,W){const V=W.lineNumber,U=C.getLineMaxColumn(V);if(W.column===U)return V<C.getLineCount()?new Position$1(V+1,1):W;const G=C.getLineContent(V);for(let Z=W.column+1;Z<U;Z++){const X=G.charCodeAt(Z-2),Q=G.charCodeAt(Z-1);if(X!==95&&Q===95)return new Position$1(V,Z);if(X!==45&&Q===45)return new Position$1(V,Z);if((isLowerAsciiLetter(X)||isAsciiDigit(X))&&isUpperAsciiLetter(Q))return new Position$1(V,Z);if(isUpperAsciiLetter(X)&&isUpperAsciiLetter(Q)&&Z+1<U){const J=G.charCodeAt(Z);if(isLowerAsciiLetter(J)||isAsciiDigit(J))return new Position$1(V,Z)}}return new Position$1(V,U)}static _deleteWordLeftWhitespace(C,W){const V=C.getLineContent(W.lineNumber),U=W.column-2,G=lastNonWhitespaceIndex(V,U);return G+1<U?new Range$2(W.lineNumber,G+2,W.lineNumber,W.column):null}static deleteWordLeft(C,W){const V=C.wordSeparators,U=C.model,G=C.selection,Z=C.whitespaceHeuristics;if(!G.isEmpty())return G;if(DeleteOperations.isAutoClosingPairDelete(C.autoClosingDelete,C.autoClosingBrackets,C.autoClosingQuotes,C.autoClosingPairs.autoClosingPairsOpenByEnd,C.model,[C.selection],C.autoClosedCharacters)){const te=C.selection.getPosition();return new Range$2(te.lineNumber,te.column-1,te.lineNumber,te.column+1)}const X=new Position$1(G.positionLineNumber,G.positionColumn);let Q=X.lineNumber,J=X.column;if(Q===1&&J===1)return null;if(Z){const te=this._deleteWordLeftWhitespace(U,X);if(te)return te}let ee=WordOperations._findPreviousWordOnLine(V,U,X);return W===0?ee?J=ee.start+1:J>1?J=1:(Q--,J=U.getLineMaxColumn(Q)):(ee&&J<=ee.end+1&&(ee=WordOperations._findPreviousWordOnLine(V,U,new Position$1(Q,ee.start+1))),ee?J=ee.end+1:J>1?J=1:(Q--,J=U.getLineMaxColumn(Q))),new Range$2(Q,J,X.lineNumber,X.column)}static deleteInsideWord(C,W,V){if(!V.isEmpty())return V;const U=new Position$1(V.positionLineNumber,V.positionColumn),G=this._deleteInsideWordWhitespace(W,U);return G||this._deleteInsideWordDetermineDeleteRange(C,W,U)}static _charAtIsWhitespace(C,W){const V=C.charCodeAt(W);return V===32||V===9}static _deleteInsideWordWhitespace(C,W){const V=C.getLineContent(W.lineNumber),U=V.length;if(U===0)return null;let G=Math.max(W.column-2,0);if(!this._charAtIsWhitespace(V,G))return null;let Z=Math.min(W.column-1,U-1);if(!this._charAtIsWhitespace(V,Z))return null;for(;G>0&&this._charAtIsWhitespace(V,G-1);)G--;for(;Z+1<U&&this._charAtIsWhitespace(V,Z+1);)Z++;return new Range$2(W.lineNumber,G+1,W.lineNumber,Z+2)}static _deleteInsideWordDetermineDeleteRange(C,W,V){const U=W.getLineContent(V.lineNumber),G=U.length;if(G===0)return V.lineNumber>1?new Range$2(V.lineNumber-1,W.getLineMaxColumn(V.lineNumber-1),V.lineNumber,1):V.lineNumber<W.getLineCount()?new Range$2(V.lineNumber,1,V.lineNumber+1,1):new Range$2(V.lineNumber,1,V.lineNumber,1);const Z=te=>te.start+1<=V.column&&V.column<=te.end+1,X=(te,ie)=>(te=Math.min(te,V.column),ie=Math.max(ie,V.column),new Range$2(V.lineNumber,te,V.lineNumber,ie)),Q=te=>{let ie=te.start+1,ne=te.end+1,oe=!1;for(;ne-1<G&&this._charAtIsWhitespace(U,ne-1);)oe=!0,ne++;if(!oe)for(;ie>1&&this._charAtIsWhitespace(U,ie-2);)ie--;return X(ie,ne)},J=WordOperations._findPreviousWordOnLine(C,W,V);if(J&&Z(J))return Q(J);const ee=WordOperations._findNextWordOnLine(C,W,V);return ee&&Z(ee)?Q(ee):J&&ee?X(J.end+1,ee.start+1):J?X(J.start+1,J.end+1):ee?X(ee.start+1,ee.end+1):X(1,G+1)}static _deleteWordPartLeft(C,W){if(!W.isEmpty())return W;const V=W.getPosition(),U=WordOperations._moveWordPartLeft(C,V);return new Range$2(V.lineNumber,V.column,U.lineNumber,U.column)}static _findFirstNonWhitespaceChar(C,W){const V=C.length;for(let U=W;U<V;U++){const G=C.charAt(U);if(G!==" "&&G!=="	")return U}return V}static _deleteWordRightWhitespace(C,W){const V=C.getLineContent(W.lineNumber),U=W.column-1,G=this._findFirstNonWhitespaceChar(V,U);return U+1<G?new Range$2(W.lineNumber,W.column,W.lineNumber,G+1):null}static deleteWordRight(C,W){const V=C.wordSeparators,U=C.model,G=C.selection,Z=C.whitespaceHeuristics;if(!G.isEmpty())return G;const X=new Position$1(G.positionLineNumber,G.positionColumn);let Q=X.lineNumber,J=X.column;const ee=U.getLineCount(),te=U.getLineMaxColumn(Q);if(Q===ee&&J===te)return null;if(Z){const ne=this._deleteWordRightWhitespace(U,X);if(ne)return ne}let ie=WordOperations._findNextWordOnLine(V,U,X);return W===2?ie?J=ie.end+1:J<te||Q===ee?J=te:(Q++,ie=WordOperations._findNextWordOnLine(V,U,new Position$1(Q,1)),ie?J=ie.start+1:J=U.getLineMaxColumn(Q)):(ie&&J>=ie.start+1&&(ie=WordOperations._findNextWordOnLine(V,U,new Position$1(Q,ie.end+1))),ie?J=ie.start+1:J<te||Q===ee?J=te:(Q++,ie=WordOperations._findNextWordOnLine(V,U,new Position$1(Q,1)),ie?J=ie.start+1:J=U.getLineMaxColumn(Q))),new Range$2(Q,J,X.lineNumber,X.column)}static _deleteWordPartRight(C,W){if(!W.isEmpty())return W;const V=W.getPosition(),U=WordOperations._moveWordPartRight(C,V);return new Range$2(V.lineNumber,V.column,U.lineNumber,U.column)}static _createWordAtPosition(C,W,V){const U=new Range$2(W,V.start+1,W,V.end+1);return{word:C.getValueInRange(U),startColumn:U.startColumn,endColumn:U.endColumn}}static getWordAtPosition(C,W,V){const U=getMapForWordSeparators(W),G=WordOperations._findPreviousWordOnLine(U,C,V);if(G&&G.wordType===1&&G.start<=V.column-1&&V.column-1<=G.end)return WordOperations._createWordAtPosition(C,V.lineNumber,G);const Z=WordOperations._findNextWordOnLine(U,C,V);return Z&&Z.wordType===1&&Z.start<=V.column-1&&V.column-1<=Z.end?WordOperations._createWordAtPosition(C,V.lineNumber,Z):null}static word(C,W,V,U,G){const Z=getMapForWordSeparators(C.wordSeparators),X=WordOperations._findPreviousWordOnLine(Z,W,G),Q=WordOperations._findNextWordOnLine(Z,W,G);if(!U){let ne,oe;return X&&X.wordType===1&&X.start<=G.column-1&&G.column-1<=X.end?(ne=X.start+1,oe=X.end+1):Q&&Q.wordType===1&&Q.start<=G.column-1&&G.column-1<=Q.end?(ne=Q.start+1,oe=Q.end+1):(X?ne=X.end+1:ne=1,Q?oe=Q.start+1:oe=W.getLineMaxColumn(G.lineNumber)),new SingleCursorState(new Range$2(G.lineNumber,ne,G.lineNumber,oe),1,0,new Position$1(G.lineNumber,oe),0)}let J,ee;X&&X.wordType===1&&X.start<G.column-1&&G.column-1<X.end?(J=X.start+1,ee=X.end+1):Q&&Q.wordType===1&&Q.start<G.column-1&&G.column-1<Q.end?(J=Q.start+1,ee=Q.end+1):(J=G.column,ee=G.column);const te=G.lineNumber;let ie;if(V.selectionStart.containsPosition(G))ie=V.selectionStart.endColumn;else if(G.isBeforeOrEqual(V.selectionStart.getStartPosition())){ie=J;const ne=new Position$1(te,ie);V.selectionStart.containsPosition(ne)&&(ie=V.selectionStart.endColumn)}else{ie=ee;const ne=new Position$1(te,ie);V.selectionStart.containsPosition(ne)&&(ie=V.selectionStart.startColumn)}return V.move(!0,te,ie,0)}}class WordPartOperations extends WordOperations{static deleteWordPartLeft(C){const W=enforceDefined([WordOperations.deleteWordLeft(C,0),WordOperations.deleteWordLeft(C,2),WordOperations._deleteWordPartLeft(C.model,C.selection)]);return W.sort(Range$2.compareRangesUsingEnds),W[2]}static deleteWordPartRight(C){const W=enforceDefined([WordOperations.deleteWordRight(C,0),WordOperations.deleteWordRight(C,2),WordOperations._deleteWordPartRight(C.model,C.selection)]);return W.sort(Range$2.compareRangesUsingStarts),W[0]}static moveWordPartLeft(C,W,V){const U=enforceDefined([WordOperations.moveWordLeft(C,W,V,0),WordOperations.moveWordLeft(C,W,V,2),WordOperations._moveWordPartLeft(W,V)]);return U.sort(Position$1.compare),U[2]}static moveWordPartRight(C,W,V){const U=enforceDefined([WordOperations.moveWordRight(C,W,V,0),WordOperations.moveWordRight(C,W,V,2),WordOperations._moveWordPartRight(W,V)]);return U.sort(Position$1.compare),U[0]}}function enforceDefined(K){return K.filter(C=>!!C)}class CursorMoveCommands{static addCursorDown(C,W,V){const U=[];let G=0;for(let Z=0,X=W.length;Z<X;Z++){const Q=W[Z];U[G++]=new CursorState$1(Q.modelState,Q.viewState),V?U[G++]=CursorState$1.fromModelState(MoveOperations.translateDown(C.cursorConfig,C.model,Q.modelState)):U[G++]=CursorState$1.fromViewState(MoveOperations.translateDown(C.cursorConfig,C,Q.viewState))}return U}static addCursorUp(C,W,V){const U=[];let G=0;for(let Z=0,X=W.length;Z<X;Z++){const Q=W[Z];U[G++]=new CursorState$1(Q.modelState,Q.viewState),V?U[G++]=CursorState$1.fromModelState(MoveOperations.translateUp(C.cursorConfig,C.model,Q.modelState)):U[G++]=CursorState$1.fromViewState(MoveOperations.translateUp(C.cursorConfig,C,Q.viewState))}return U}static moveToBeginningOfLine(C,W,V){const U=[];for(let G=0,Z=W.length;G<Z;G++){const X=W[G];U[G]=this._moveToLineStart(C,X,V)}return U}static _moveToLineStart(C,W,V){const U=W.viewState.position.column,G=W.modelState.position.column,Z=U===G,X=W.viewState.position.lineNumber,Q=C.getLineFirstNonWhitespaceColumn(X);return!Z&&!(U===Q)?this._moveToLineStartByView(C,W,V):this._moveToLineStartByModel(C,W,V)}static _moveToLineStartByView(C,W,V){return CursorState$1.fromViewState(MoveOperations.moveToBeginningOfLine(C.cursorConfig,C,W.viewState,V))}static _moveToLineStartByModel(C,W,V){return CursorState$1.fromModelState(MoveOperations.moveToBeginningOfLine(C.cursorConfig,C.model,W.modelState,V))}static moveToEndOfLine(C,W,V,U){const G=[];for(let Z=0,X=W.length;Z<X;Z++){const Q=W[Z];G[Z]=this._moveToLineEnd(C,Q,V,U)}return G}static _moveToLineEnd(C,W,V,U){const G=W.viewState.position,Z=C.getLineMaxColumn(G.lineNumber),X=G.column===Z,Q=W.modelState.position,J=C.model.getLineMaxColumn(Q.lineNumber),ee=Z-G.column===J-Q.column;return X||ee?this._moveToLineEndByModel(C,W,V,U):this._moveToLineEndByView(C,W,V,U)}static _moveToLineEndByView(C,W,V,U){return CursorState$1.fromViewState(MoveOperations.moveToEndOfLine(C.cursorConfig,C,W.viewState,V,U))}static _moveToLineEndByModel(C,W,V,U){return CursorState$1.fromModelState(MoveOperations.moveToEndOfLine(C.cursorConfig,C.model,W.modelState,V,U))}static expandLineSelection(C,W){const V=[];for(let U=0,G=W.length;U<G;U++){const Z=W[U],X=Z.modelState.selection.startLineNumber,Q=C.model.getLineCount();let J=Z.modelState.selection.endLineNumber,ee;J===Q?ee=C.model.getLineMaxColumn(Q):(J++,ee=1),V[U]=CursorState$1.fromModelState(new SingleCursorState(new Range$2(X,1,X,1),0,0,new Position$1(J,ee),0))}return V}static moveToBeginningOfBuffer(C,W,V){const U=[];for(let G=0,Z=W.length;G<Z;G++){const X=W[G];U[G]=CursorState$1.fromModelState(MoveOperations.moveToBeginningOfBuffer(C.cursorConfig,C.model,X.modelState,V))}return U}static moveToEndOfBuffer(C,W,V){const U=[];for(let G=0,Z=W.length;G<Z;G++){const X=W[G];U[G]=CursorState$1.fromModelState(MoveOperations.moveToEndOfBuffer(C.cursorConfig,C.model,X.modelState,V))}return U}static selectAll(C,W){const V=C.model.getLineCount(),U=C.model.getLineMaxColumn(V);return CursorState$1.fromModelState(new SingleCursorState(new Range$2(1,1,1,1),0,0,new Position$1(V,U),0))}static line(C,W,V,U,G){const Z=C.model.validatePosition(U),X=G?C.coordinatesConverter.validateViewPosition(new Position$1(G.lineNumber,G.column),Z):C.coordinatesConverter.convertModelPositionToViewPosition(Z);if(!V){const J=C.model.getLineCount();let ee=Z.lineNumber+1,te=1;return ee>J&&(ee=J,te=C.model.getLineMaxColumn(ee)),CursorState$1.fromModelState(new SingleCursorState(new Range$2(Z.lineNumber,1,ee,te),2,0,new Position$1(ee,te),0))}const Q=W.modelState.selectionStart.getStartPosition().lineNumber;if(Z.lineNumber<Q)return CursorState$1.fromViewState(W.viewState.move(!0,X.lineNumber,1,0));if(Z.lineNumber>Q){const J=C.getLineCount();let ee=X.lineNumber+1,te=1;return ee>J&&(ee=J,te=C.getLineMaxColumn(ee)),CursorState$1.fromViewState(W.viewState.move(!0,ee,te,0))}else{const J=W.modelState.selectionStart.getEndPosition();return CursorState$1.fromModelState(W.modelState.move(!0,J.lineNumber,J.column,0))}}static word(C,W,V,U){const G=C.model.validatePosition(U);return CursorState$1.fromModelState(WordOperations.word(C.cursorConfig,C.model,W.modelState,V,G))}static cancelSelection(C,W){if(!W.modelState.hasSelection())return new CursorState$1(W.modelState,W.viewState);const V=W.viewState.position.lineNumber,U=W.viewState.position.column;return CursorState$1.fromViewState(new SingleCursorState(new Range$2(V,U,V,U),0,0,new Position$1(V,U),0))}static moveTo(C,W,V,U,G){if(V){if(W.modelState.selectionStartKind===1)return this.word(C,W,V,U);if(W.modelState.selectionStartKind===2)return this.line(C,W,V,U,G)}const Z=C.model.validatePosition(U),X=G?C.coordinatesConverter.validateViewPosition(new Position$1(G.lineNumber,G.column),Z):C.coordinatesConverter.convertModelPositionToViewPosition(Z);return CursorState$1.fromViewState(W.viewState.move(V,X.lineNumber,X.column,0))}static simpleMove(C,W,V,U,G,Z){switch(V){case 0:return Z===4?this._moveHalfLineLeft(C,W,U):this._moveLeft(C,W,U,G);case 1:return Z===4?this._moveHalfLineRight(C,W,U):this._moveRight(C,W,U,G);case 2:return Z===2?this._moveUpByViewLines(C,W,U,G):this._moveUpByModelLines(C,W,U,G);case 3:return Z===2?this._moveDownByViewLines(C,W,U,G):this._moveDownByModelLines(C,W,U,G);case 4:return Z===2?W.map(X=>CursorState$1.fromViewState(MoveOperations.moveToPrevBlankLine(C.cursorConfig,C,X.viewState,U))):W.map(X=>CursorState$1.fromModelState(MoveOperations.moveToPrevBlankLine(C.cursorConfig,C.model,X.modelState,U)));case 5:return Z===2?W.map(X=>CursorState$1.fromViewState(MoveOperations.moveToNextBlankLine(C.cursorConfig,C,X.viewState,U))):W.map(X=>CursorState$1.fromModelState(MoveOperations.moveToNextBlankLine(C.cursorConfig,C.model,X.modelState,U)));case 6:return this._moveToViewMinColumn(C,W,U);case 7:return this._moveToViewFirstNonWhitespaceColumn(C,W,U);case 8:return this._moveToViewCenterColumn(C,W,U);case 9:return this._moveToViewMaxColumn(C,W,U);case 10:return this._moveToViewLastNonWhitespaceColumn(C,W,U);default:return null}}static viewportMove(C,W,V,U,G){const Z=C.getCompletelyVisibleViewRange(),X=C.coordinatesConverter.convertViewRangeToModelRange(Z);switch(V){case 11:{const Q=this._firstLineNumberInRange(C.model,X,G),J=C.model.getLineFirstNonWhitespaceColumn(Q);return[this._moveToModelPosition(C,W[0],U,Q,J)]}case 13:{const Q=this._lastLineNumberInRange(C.model,X,G),J=C.model.getLineFirstNonWhitespaceColumn(Q);return[this._moveToModelPosition(C,W[0],U,Q,J)]}case 12:{const Q=Math.round((X.startLineNumber+X.endLineNumber)/2),J=C.model.getLineFirstNonWhitespaceColumn(Q);return[this._moveToModelPosition(C,W[0],U,Q,J)]}case 14:{const Q=[];for(let J=0,ee=W.length;J<ee;J++){const te=W[J];Q[J]=this.findPositionInViewportIfOutside(C,te,Z,U)}return Q}default:return null}}static findPositionInViewportIfOutside(C,W,V,U){const G=W.viewState.position.lineNumber;if(V.startLineNumber<=G&&G<=V.endLineNumber-1)return new CursorState$1(W.modelState,W.viewState);{let Z;G>V.endLineNumber-1?Z=V.endLineNumber-1:G<V.startLineNumber?Z=V.startLineNumber:Z=G;const X=MoveOperations.vertical(C.cursorConfig,C,G,W.viewState.position.column,W.viewState.leftoverVisibleColumns,Z,!1);return CursorState$1.fromViewState(W.viewState.move(U,X.lineNumber,X.column,X.leftoverVisibleColumns))}}static _firstLineNumberInRange(C,W,V){let U=W.startLineNumber;return W.startColumn!==C.getLineMinColumn(U)&&U++,Math.min(W.endLineNumber,U+V-1)}static _lastLineNumberInRange(C,W,V){let U=W.startLineNumber;return W.startColumn!==C.getLineMinColumn(U)&&U++,Math.max(U,W.endLineNumber-V+1)}static _moveLeft(C,W,V,U){return W.map(G=>CursorState$1.fromViewState(MoveOperations.moveLeft(C.cursorConfig,C,G.viewState,V,U)))}static _moveHalfLineLeft(C,W,V){const U=[];for(let G=0,Z=W.length;G<Z;G++){const X=W[G],Q=X.viewState.position.lineNumber,J=Math.round(C.getLineContent(Q).length/2);U[G]=CursorState$1.fromViewState(MoveOperations.moveLeft(C.cursorConfig,C,X.viewState,V,J))}return U}static _moveRight(C,W,V,U){return W.map(G=>CursorState$1.fromViewState(MoveOperations.moveRight(C.cursorConfig,C,G.viewState,V,U)))}static _moveHalfLineRight(C,W,V){const U=[];for(let G=0,Z=W.length;G<Z;G++){const X=W[G],Q=X.viewState.position.lineNumber,J=Math.round(C.getLineContent(Q).length/2);U[G]=CursorState$1.fromViewState(MoveOperations.moveRight(C.cursorConfig,C,X.viewState,V,J))}return U}static _moveDownByViewLines(C,W,V,U){const G=[];for(let Z=0,X=W.length;Z<X;Z++){const Q=W[Z];G[Z]=CursorState$1.fromViewState(MoveOperations.moveDown(C.cursorConfig,C,Q.viewState,V,U))}return G}static _moveDownByModelLines(C,W,V,U){const G=[];for(let Z=0,X=W.length;Z<X;Z++){const Q=W[Z];G[Z]=CursorState$1.fromModelState(MoveOperations.moveDown(C.cursorConfig,C.model,Q.modelState,V,U))}return G}static _moveUpByViewLines(C,W,V,U){const G=[];for(let Z=0,X=W.length;Z<X;Z++){const Q=W[Z];G[Z]=CursorState$1.fromViewState(MoveOperations.moveUp(C.cursorConfig,C,Q.viewState,V,U))}return G}static _moveUpByModelLines(C,W,V,U){const G=[];for(let Z=0,X=W.length;Z<X;Z++){const Q=W[Z];G[Z]=CursorState$1.fromModelState(MoveOperations.moveUp(C.cursorConfig,C.model,Q.modelState,V,U))}return G}static _moveToViewPosition(C,W,V,U,G){return CursorState$1.fromViewState(W.viewState.move(V,U,G,0))}static _moveToModelPosition(C,W,V,U,G){return CursorState$1.fromModelState(W.modelState.move(V,U,G,0))}static _moveToViewMinColumn(C,W,V){const U=[];for(let G=0,Z=W.length;G<Z;G++){const X=W[G],Q=X.viewState.position.lineNumber,J=C.getLineMinColumn(Q);U[G]=this._moveToViewPosition(C,X,V,Q,J)}return U}static _moveToViewFirstNonWhitespaceColumn(C,W,V){const U=[];for(let G=0,Z=W.length;G<Z;G++){const X=W[G],Q=X.viewState.position.lineNumber,J=C.getLineFirstNonWhitespaceColumn(Q);U[G]=this._moveToViewPosition(C,X,V,Q,J)}return U}static _moveToViewCenterColumn(C,W,V){const U=[];for(let G=0,Z=W.length;G<Z;G++){const X=W[G],Q=X.viewState.position.lineNumber,J=Math.round((C.getLineMaxColumn(Q)+C.getLineMinColumn(Q))/2);U[G]=this._moveToViewPosition(C,X,V,Q,J)}return U}static _moveToViewMaxColumn(C,W,V){const U=[];for(let G=0,Z=W.length;G<Z;G++){const X=W[G],Q=X.viewState.position.lineNumber,J=C.getLineMaxColumn(Q);U[G]=this._moveToViewPosition(C,X,V,Q,J)}return U}static _moveToViewLastNonWhitespaceColumn(C,W,V){const U=[];for(let G=0,Z=W.length;G<Z;G++){const X=W[G],Q=X.viewState.position.lineNumber,J=C.getLineLastNonWhitespaceColumn(Q);U[G]=this._moveToViewPosition(C,X,V,Q,J)}return U}}var CursorMove;(function(K){const C=function(V){if(!isObject$2(V))return!1;const U=V;return!(!isString$3(U.to)||!isUndefined$2(U.select)&&!isBoolean$2(U.select)||!isUndefined$2(U.by)&&!isString$3(U.by)||!isUndefined$2(U.value)&&!isNumber$3(U.value))};K.description={description:"Move cursor to a logical position in the view",args:[{name:"Cursor move argument object",description:`Property-value pairs that can be passed through this argument:
					* 'to': A mandatory logical position value providing where to move the cursor.
						\`\`\`
						'left', 'right', 'up', 'down', 'prevBlankLine', 'nextBlankLine',
						'wrappedLineStart', 'wrappedLineEnd', 'wrappedLineColumnCenter'
						'wrappedLineFirstNonWhitespaceCharacter', 'wrappedLineLastNonWhitespaceCharacter'
						'viewPortTop', 'viewPortCenter', 'viewPortBottom', 'viewPortIfOutside'
						\`\`\`
					* 'by': Unit to move. Default is computed based on 'to' value.
						\`\`\`
						'line', 'wrappedLine', 'character', 'halfLine'
						\`\`\`
					* 'value': Number of units to move. Default is '1'.
					* 'select': If 'true' makes the selection. Default is 'false'.
				`,constraint:C,schema:{type:"object",required:["to"],properties:{to:{type:"string",enum:["left","right","up","down","prevBlankLine","nextBlankLine","wrappedLineStart","wrappedLineEnd","wrappedLineColumnCenter","wrappedLineFirstNonWhitespaceCharacter","wrappedLineLastNonWhitespaceCharacter","viewPortTop","viewPortCenter","viewPortBottom","viewPortIfOutside"]},by:{type:"string",enum:["line","wrappedLine","character","halfLine"]},value:{type:"number",default:1},select:{type:"boolean",default:!1}}}}]},K.RawDirection={Left:"left",Right:"right",Up:"up",Down:"down",PrevBlankLine:"prevBlankLine",NextBlankLine:"nextBlankLine",WrappedLineStart:"wrappedLineStart",WrappedLineFirstNonWhitespaceCharacter:"wrappedLineFirstNonWhitespaceCharacter",WrappedLineColumnCenter:"wrappedLineColumnCenter",WrappedLineEnd:"wrappedLineEnd",WrappedLineLastNonWhitespaceCharacter:"wrappedLineLastNonWhitespaceCharacter",ViewPortTop:"viewPortTop",ViewPortCenter:"viewPortCenter",ViewPortBottom:"viewPortBottom",ViewPortIfOutside:"viewPortIfOutside"},K.RawUnit={Line:"line",WrappedLine:"wrappedLine",Character:"character",HalfLine:"halfLine"};function W(V){if(!V.to)return null;let U;switch(V.to){case K.RawDirection.Left:U=0;break;case K.RawDirection.Right:U=1;break;case K.RawDirection.Up:U=2;break;case K.RawDirection.Down:U=3;break;case K.RawDirection.PrevBlankLine:U=4;break;case K.RawDirection.NextBlankLine:U=5;break;case K.RawDirection.WrappedLineStart:U=6;break;case K.RawDirection.WrappedLineFirstNonWhitespaceCharacter:U=7;break;case K.RawDirection.WrappedLineColumnCenter:U=8;break;case K.RawDirection.WrappedLineEnd:U=9;break;case K.RawDirection.WrappedLineLastNonWhitespaceCharacter:U=10;break;case K.RawDirection.ViewPortTop:U=11;break;case K.RawDirection.ViewPortBottom:U=13;break;case K.RawDirection.ViewPortCenter:U=12;break;case K.RawDirection.ViewPortIfOutside:U=14;break;default:return null}let G=0;switch(V.by){case K.RawUnit.Line:G=1;break;case K.RawUnit.WrappedLine:G=2;break;case K.RawUnit.Character:G=3;break;case K.RawUnit.HalfLine:G=4;break}return{direction:U,unit:G,select:!!V.select,value:V.value||1}}K.parse=W})(CursorMove||(CursorMove={}));function getEnterAction(K,C,W,V){const U=getScopedLineTokens(C,W.startLineNumber,W.startColumn),G=V.getLanguageConfiguration(U.languageId);if(!G)return null;const Z=U.getLineContent(),X=Z.substr(0,W.startColumn-1-U.firstCharOffset);let Q;W.isEmpty()?Q=Z.substr(W.startColumn-1-U.firstCharOffset):Q=getScopedLineTokens(C,W.endLineNumber,W.endColumn).getLineContent().substr(W.endColumn-1-U.firstCharOffset);let J="";if(W.startLineNumber>1&&U.firstCharOffset===0){const re=getScopedLineTokens(C,W.startLineNumber-1);re.languageId===U.languageId&&(J=re.getLineContent())}const ee=G.onEnter(K,J,X,Q);if(!ee)return null;const te=ee.indentAction;let ie=ee.appendText;const ne=ee.removeText||0;ie?te===IndentAction.Indent&&(ie="	"+ie):te===IndentAction.Indent||te===IndentAction.IndentOutdent?ie="	":ie="";let oe=getIndentationAtPosition(C,W.startLineNumber,W.startColumn);return ne&&(oe=oe.substring(0,oe.length-ne)),{indentAction:te,appendText:ie,removeText:ne,indentation:oe}}var __decorate$23=globalThis&&globalThis.__decorate||function(K,C,W,V){var U=arguments.length,G=U<3?C:V===null?V=Object.getOwnPropertyDescriptor(C,W):V,Z;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")G=Reflect.decorate(K,C,W,V);else for(var X=K.length-1;X>=0;X--)(Z=K[X])&&(G=(U<3?Z(G):U>3?Z(C,W,G):Z(C,W))||G);return U>3&&G&&Object.defineProperty(C,W,G),G},__param$1Z=globalThis&&globalThis.__param||function(K,C){return function(W,V){C(W,V,K)}},ShiftCommand_1;const repeatCache=Object.create(null);function cachedStringRepeat(K,C){if(C<=0)return"";repeatCache[K]||(repeatCache[K]=["",K]);const W=repeatCache[K];for(let V=W.length;V<=C;V++)W[V]=W[V-1]+K;return W[C]}let ShiftCommand=ShiftCommand_1=class{static unshiftIndent(C,W,V,U,G){const Z=CursorColumns.visibleColumnFromColumn(C,W,V);if(G){const X=cachedStringRepeat(" ",U),J=CursorColumns.prevIndentTabStop(Z,U)/U;return cachedStringRepeat(X,J)}else{const X="	",J=CursorColumns.prevRenderTabStop(Z,V)/V;return cachedStringRepeat(X,J)}}static shiftIndent(C,W,V,U,G){const Z=CursorColumns.visibleColumnFromColumn(C,W,V);if(G){const X=cachedStringRepeat(" ",U),J=CursorColumns.nextIndentTabStop(Z,U)/U;return cachedStringRepeat(X,J)}else{const X="	",J=CursorColumns.nextRenderTabStop(Z,V)/V;return cachedStringRepeat(X,J)}}constructor(C,W,V){this._languageConfigurationService=V,this._opts=W,this._selection=C,this._selectionId=null,this._useLastEditRangeForCursorEndPosition=!1,this._selectionStartColumnStaysPut=!1}_addEditOperation(C,W,V){this._useLastEditRangeForCursorEndPosition?C.addTrackedEditOperation(W,V):C.addEditOperation(W,V)}getEditOperations(C,W){const V=this._selection.startLineNumber;let U=this._selection.endLineNumber;this._selection.endColumn===1&&V!==U&&(U=U-1);const{tabSize:G,indentSize:Z,insertSpaces:X}=this._opts,Q=V===U;if(this._opts.useTabStops){this._selection.isEmpty()&&/^\s*$/.test(C.getLineContent(V))&&(this._useLastEditRangeForCursorEndPosition=!0);let J=0,ee=0;for(let te=V;te<=U;te++,J=ee){ee=0;const ie=C.getLineContent(te);let ne=firstNonWhitespaceIndex(ie);if(this._opts.isUnshift&&(ie.length===0||ne===0)||!Q&&!this._opts.isUnshift&&ie.length===0)continue;if(ne===-1&&(ne=ie.length),te>1&&CursorColumns.visibleColumnFromColumn(ie,ne+1,G)%Z!==0&&C.tokenization.isCheapToTokenize(te-1)){const ae=getEnterAction(this._opts.autoIndent,C,new Range$2(te-1,C.getLineMaxColumn(te-1),te-1,C.getLineMaxColumn(te-1)),this._languageConfigurationService);if(ae){if(ee=J,ae.appendText)for(let se=0,le=ae.appendText.length;se<le&&ee<Z&&ae.appendText.charCodeAt(se)===32;se++)ee++;ae.removeText&&(ee=Math.max(0,ee-ae.removeText));for(let se=0;se<ee&&!(ne===0||ie.charCodeAt(ne-1)!==32);se++)ne--}}if(this._opts.isUnshift&&ne===0)continue;let oe;this._opts.isUnshift?oe=ShiftCommand_1.unshiftIndent(ie,ne+1,G,Z,X):oe=ShiftCommand_1.shiftIndent(ie,ne+1,G,Z,X),this._addEditOperation(W,new Range$2(te,1,te,ne+1),oe),te===V&&!this._selection.isEmpty()&&(this._selectionStartColumnStaysPut=this._selection.startColumn<=ne+1)}}else{!this._opts.isUnshift&&this._selection.isEmpty()&&C.getLineLength(V)===0&&(this._useLastEditRangeForCursorEndPosition=!0);const J=X?cachedStringRepeat(" ",Z):"	";for(let ee=V;ee<=U;ee++){const te=C.getLineContent(ee);let ie=firstNonWhitespaceIndex(te);if(!(this._opts.isUnshift&&(te.length===0||ie===0))&&!(!Q&&!this._opts.isUnshift&&te.length===0)&&(ie===-1&&(ie=te.length),!(this._opts.isUnshift&&ie===0)))if(this._opts.isUnshift){ie=Math.min(ie,Z);for(let ne=0;ne<ie;ne++)if(te.charCodeAt(ne)===9){ie=ne+1;break}this._addEditOperation(W,new Range$2(ee,1,ee,ie+1),"")}else this._addEditOperation(W,new Range$2(ee,1,ee,1),J),ee===V&&!this._selection.isEmpty()&&(this._selectionStartColumnStaysPut=this._selection.startColumn===1)}}this._selectionId=W.trackSelection(this._selection)}computeCursorState(C,W){if(this._useLastEditRangeForCursorEndPosition){const U=W.getInverseEditOperations()[0];return new Selection$1(U.range.endLineNumber,U.range.endColumn,U.range.endLineNumber,U.range.endColumn)}const V=W.getTrackedSelection(this._selectionId);if(this._selectionStartColumnStaysPut){const U=this._selection.startColumn;return V.startColumn<=U?V:V.getDirection()===0?new Selection$1(V.startLineNumber,U,V.endLineNumber,V.endColumn):new Selection$1(V.endLineNumber,V.endColumn,V.startLineNumber,U)}return V}};ShiftCommand=ShiftCommand_1=__decorate$23([__param$1Z(2,ILanguageConfigurationService)],ShiftCommand);class SurroundSelectionCommand{constructor(C,W,V){this._range=C,this._charBeforeSelection=W,this._charAfterSelection=V}getEditOperations(C,W){W.addTrackedEditOperation(new Range$2(this._range.startLineNumber,this._range.startColumn,this._range.startLineNumber,this._range.startColumn),this._charBeforeSelection),W.addTrackedEditOperation(new Range$2(this._range.endLineNumber,this._range.endColumn,this._range.endLineNumber,this._range.endColumn),this._charAfterSelection)}computeCursorState(C,W){const V=W.getInverseEditOperations(),U=V[0].range,G=V[1].range;return new Selection$1(U.endLineNumber,U.endColumn,G.endLineNumber,G.endColumn-this._charAfterSelection.length)}}class CompositionSurroundSelectionCommand{constructor(C,W,V){this._position=C,this._text=W,this._charAfter=V}getEditOperations(C,W){W.addTrackedEditOperation(new Range$2(this._position.lineNumber,this._position.column,this._position.lineNumber,this._position.column),this._text+this._charAfter)}computeCursorState(C,W){const U=W.getInverseEditOperations()[0].range;return new Selection$1(U.endLineNumber,U.startColumn,U.endLineNumber,U.endColumn-this._charAfter.length)}}function getPrecedingValidLine(K,C,W){const V=K.tokenization.getLanguageIdAtPosition(C,0);if(C>1){let U,G=-1;for(U=C-1;U>=1;U--){if(K.tokenization.getLanguageIdAtPosition(U,0)!==V)return G;const Z=K.getLineContent(U);if(W.shouldIgnore(Z)||/^\s+$/.test(Z)||Z===""){G=U;continue}return U}}return-1}function getInheritIndentForLine(K,C,W,V=!0,U){if(K<4)return null;const G=U.getLanguageConfiguration(C.tokenization.getLanguageId()).indentRulesSupport;if(!G)return null;if(W<=1)return{indentation:"",action:null};for(let Q=W-1;Q>0&&C.getLineContent(Q)==="";Q--)if(Q===1)return{indentation:"",action:null};const Z=getPrecedingValidLine(C,W,G);if(Z<0)return null;if(Z<1)return{indentation:"",action:null};const X=C.getLineContent(Z);if(G.shouldIncrease(X)||G.shouldIndentNextLine(X))return{indentation:getLeadingWhitespace(X),action:IndentAction.Indent,line:Z};if(G.shouldDecrease(X))return{indentation:getLeadingWhitespace(X),action:null,line:Z};{if(Z===1)return{indentation:getLeadingWhitespace(C.getLineContent(Z)),action:null,line:Z};const Q=Z-1,J=G.getIndentMetadata(C.getLineContent(Q));if(!(J&3)&&J&4){let ee=0;for(let te=Q-1;te>0;te--)if(!G.shouldIndentNextLine(C.getLineContent(te))){ee=te;break}return{indentation:getLeadingWhitespace(C.getLineContent(ee+1)),action:null,line:ee+1}}if(V)return{indentation:getLeadingWhitespace(C.getLineContent(Z)),action:null,line:Z};for(let ee=Z;ee>0;ee--){const te=C.getLineContent(ee);if(G.shouldIncrease(te))return{indentation:getLeadingWhitespace(te),action:IndentAction.Indent,line:ee};if(G.shouldIndentNextLine(te)){let ie=0;for(let ne=ee-1;ne>0;ne--)if(!G.shouldIndentNextLine(C.getLineContent(ee))){ie=ne;break}return{indentation:getLeadingWhitespace(C.getLineContent(ie+1)),action:null,line:ie+1}}else if(G.shouldDecrease(te))return{indentation:getLeadingWhitespace(te),action:null,line:ee}}return{indentation:getLeadingWhitespace(C.getLineContent(1)),action:null,line:1}}}function getGoodIndentForLine(K,C,W,V,U,G){if(K<4)return null;const Z=G.getLanguageConfiguration(W);if(!Z)return null;const X=G.getLanguageConfiguration(W).indentRulesSupport;if(!X)return null;const Q=getInheritIndentForLine(K,C,V,void 0,G),J=C.getLineContent(V);if(Q){const ee=Q.line;if(ee!==void 0){let te=!0;for(let ie=ee;ie<V-1;ie++)if(!/^\s*$/.test(C.getLineContent(ie))){te=!1;break}if(te){const ie=Z.onEnter(K,"",C.getLineContent(ee),"");if(ie){let ne=getLeadingWhitespace(C.getLineContent(ee));return ie.removeText&&(ne=ne.substring(0,ne.length-ie.removeText)),ie.indentAction===IndentAction.Indent||ie.indentAction===IndentAction.IndentOutdent?ne=U.shiftIndent(ne):ie.indentAction===IndentAction.Outdent&&(ne=U.unshiftIndent(ne)),X.shouldDecrease(J)&&(ne=U.unshiftIndent(ne)),ie.appendText&&(ne+=ie.appendText),getLeadingWhitespace(ne)}}}return X.shouldDecrease(J)?Q.action===IndentAction.Indent?Q.indentation:U.unshiftIndent(Q.indentation):Q.action===IndentAction.Indent?U.shiftIndent(Q.indentation):Q.indentation}return null}function getIndentForEnter(K,C,W,V,U){if(K<4)return null;C.tokenization.forceTokenization(W.startLineNumber);const G=C.tokenization.getLineTokens(W.startLineNumber),Z=createScopedLineTokens(G,W.startColumn-1),X=Z.getLineContent();let Q=!1,J;Z.firstCharOffset>0&&G.getLanguageId(0)!==Z.languageId?(Q=!0,J=X.substr(0,W.startColumn-1-Z.firstCharOffset)):J=G.getLineContent().substring(0,W.startColumn-1);let ee;W.isEmpty()?ee=X.substr(W.startColumn-1-Z.firstCharOffset):ee=getScopedLineTokens(C,W.endLineNumber,W.endColumn).getLineContent().substr(W.endColumn-1-Z.firstCharOffset);const te=U.getLanguageConfiguration(Z.languageId).indentRulesSupport;if(!te)return null;const ie=J,ne=getLeadingWhitespace(J),oe={tokenization:{getLineTokens:le=>C.tokenization.getLineTokens(le),getLanguageId:()=>C.getLanguageId(),getLanguageIdAtPosition:(le,ce)=>C.getLanguageIdAtPosition(le,ce)},getLineContent:le=>le===W.startLineNumber?ie:C.getLineContent(le)},re=getLeadingWhitespace(G.getLineContent()),ae=getInheritIndentForLine(K,oe,W.startLineNumber+1,void 0,U);if(!ae){const le=Q?re:ne;return{beforeEnter:le,afterEnter:le}}let se=Q?re:ae.indentation;return ae.action===IndentAction.Indent&&(se=V.shiftIndent(se)),te.shouldDecrease(ee)&&(se=V.unshiftIndent(se)),{beforeEnter:Q?re:ne,afterEnter:se}}function getIndentActionForType(K,C,W,V,U,G){if(K<4)return null;const Z=getScopedLineTokens(C,W.startLineNumber,W.startColumn);if(Z.firstCharOffset)return null;const X=G.getLanguageConfiguration(Z.languageId).indentRulesSupport;if(!X)return null;const Q=Z.getLineContent(),J=Q.substr(0,W.startColumn-1-Z.firstCharOffset);let ee;if(W.isEmpty()?ee=Q.substr(W.startColumn-1-Z.firstCharOffset):ee=getScopedLineTokens(C,W.endLineNumber,W.endColumn).getLineContent().substr(W.endColumn-1-Z.firstCharOffset),!X.shouldDecrease(J+ee)&&X.shouldDecrease(J+V+ee)){const te=getInheritIndentForLine(K,C,W.startLineNumber,!1,G);if(!te)return null;let ie=te.indentation;return te.action!==IndentAction.Indent&&(ie=U.unshiftIndent(ie)),ie}return null}function getIndentMetadata(K,C,W){const V=W.getLanguageConfiguration(K.getLanguageId()).indentRulesSupport;return!V||C<1||C>K.getLineCount()?null:V.getIndentMetadata(K.getLineContent(C))}class TypeOperations{static indent(C,W,V){if(W===null||V===null)return[];const U=[];for(let G=0,Z=V.length;G<Z;G++)U[G]=new ShiftCommand(V[G],{isUnshift:!1,tabSize:C.tabSize,indentSize:C.indentSize,insertSpaces:C.insertSpaces,useTabStops:C.useTabStops,autoIndent:C.autoIndent},C.languageConfigurationService);return U}static outdent(C,W,V){const U=[];for(let G=0,Z=V.length;G<Z;G++)U[G]=new ShiftCommand(V[G],{isUnshift:!0,tabSize:C.tabSize,indentSize:C.indentSize,insertSpaces:C.insertSpaces,useTabStops:C.useTabStops,autoIndent:C.autoIndent},C.languageConfigurationService);return U}static shiftIndent(C,W,V){return V=V||1,ShiftCommand.shiftIndent(W,W.length+V,C.tabSize,C.indentSize,C.insertSpaces)}static unshiftIndent(C,W,V){return V=V||1,ShiftCommand.unshiftIndent(W,W.length+V,C.tabSize,C.indentSize,C.insertSpaces)}static _distributedPaste(C,W,V,U){const G=[];for(let Z=0,X=V.length;Z<X;Z++)G[Z]=new ReplaceCommand(V[Z],U[Z]);return new EditOperationResult(0,G,{shouldPushStackElementBefore:!0,shouldPushStackElementAfter:!0})}static _simplePaste(C,W,V,U,G){const Z=[];for(let X=0,Q=V.length;X<Q;X++){const J=V[X],ee=J.getPosition();if(G&&!J.isEmpty()&&(G=!1),G&&U.indexOf(`
`)!==U.length-1&&(G=!1),G){const te=new Range$2(ee.lineNumber,1,ee.lineNumber,1);Z[X]=new ReplaceCommandThatPreservesSelection(te,U,J,!0)}else Z[X]=new ReplaceCommand(J,U)}return new EditOperationResult(0,Z,{shouldPushStackElementBefore:!0,shouldPushStackElementAfter:!0})}static _distributePasteToCursors(C,W,V,U,G){if(U||W.length===1)return null;if(G&&G.length===W.length)return G;if(C.multiCursorPaste==="spread"){V.charCodeAt(V.length-1)===10&&(V=V.substr(0,V.length-1)),V.charCodeAt(V.length-1)===13&&(V=V.substr(0,V.length-1));const Z=splitLines(V);if(Z.length===W.length)return Z}return null}static paste(C,W,V,U,G,Z){const X=this._distributePasteToCursors(C,V,U,G,Z);return X?(V=V.sort(Range$2.compareRangesUsingStarts),this._distributedPaste(C,W,V,X)):this._simplePaste(C,W,V,U,G)}static _goodIndentForLine(C,W,V){let U=null,G="";const Z=getInheritIndentForLine(C.autoIndent,W,V,!1,C.languageConfigurationService);if(Z)U=Z.action,G=Z.indentation;else if(V>1){let X;for(X=V-1;X>=1;X--){const ee=W.getLineContent(X);if(lastNonWhitespaceIndex(ee)>=0)break}if(X<1)return null;const Q=W.getLineMaxColumn(X),J=getEnterAction(C.autoIndent,W,new Range$2(X,Q,X,Q),C.languageConfigurationService);J&&(G=J.indentation+J.appendText)}return U&&(U===IndentAction.Indent&&(G=TypeOperations.shiftIndent(C,G)),U===IndentAction.Outdent&&(G=TypeOperations.unshiftIndent(C,G)),G=C.normalizeIndentation(G)),G||null}static _replaceJumpToNextIndent(C,W,V,U){let G="";const Z=V.getStartPosition();if(C.insertSpaces){const X=C.visibleColumnFromColumn(W,Z),Q=C.indentSize,J=Q-X%Q;for(let ee=0;ee<J;ee++)G+=" "}else G="	";return new ReplaceCommand(V,G,U)}static tab(C,W,V){const U=[];for(let G=0,Z=V.length;G<Z;G++){const X=V[G];if(X.isEmpty()){const Q=W.getLineContent(X.startLineNumber);if(/^\s*$/.test(Q)&&W.tokenization.isCheapToTokenize(X.startLineNumber)){let J=this._goodIndentForLine(C,W,X.startLineNumber);J=J||"	";const ee=C.normalizeIndentation(J);if(!Q.startsWith(ee)){U[G]=new ReplaceCommand(new Range$2(X.startLineNumber,1,X.startLineNumber,Q.length+1),ee,!0);continue}}U[G]=this._replaceJumpToNextIndent(C,W,X,!0)}else{if(X.startLineNumber===X.endLineNumber){const Q=W.getLineMaxColumn(X.startLineNumber);if(X.startColumn!==1||X.endColumn!==Q){U[G]=this._replaceJumpToNextIndent(C,W,X,!1);continue}}U[G]=new ShiftCommand(X,{isUnshift:!1,tabSize:C.tabSize,indentSize:C.indentSize,insertSpaces:C.insertSpaces,useTabStops:C.useTabStops,autoIndent:C.autoIndent},C.languageConfigurationService)}}return U}static compositionType(C,W,V,U,G,Z,X,Q){const J=U.map(ee=>this._compositionType(V,ee,G,Z,X,Q));return new EditOperationResult(4,J,{shouldPushStackElementBefore:shouldPushStackElementBetween(C,4),shouldPushStackElementAfter:!1})}static _compositionType(C,W,V,U,G,Z){if(!W.isEmpty())return null;const X=W.getPosition(),Q=Math.max(1,X.column-U),J=Math.min(C.getLineMaxColumn(X.lineNumber),X.column+G),ee=new Range$2(X.lineNumber,Q,X.lineNumber,J);return C.getValueInRange(ee)===V&&Z===0?null:new ReplaceCommandWithOffsetCursorState(ee,V,0,Z)}static _typeCommand(C,W,V){return V?new ReplaceCommandWithoutChangingPosition(C,W,!0):new ReplaceCommand(C,W,!0)}static _enter(C,W,V,U){if(C.autoIndent===0)return TypeOperations._typeCommand(U,`
`,V);if(!W.tokenization.isCheapToTokenize(U.getStartPosition().lineNumber)||C.autoIndent===1){const Q=W.getLineContent(U.startLineNumber),J=getLeadingWhitespace(Q).substring(0,U.startColumn-1);return TypeOperations._typeCommand(U,`
`+C.normalizeIndentation(J),V)}const G=getEnterAction(C.autoIndent,W,U,C.languageConfigurationService);if(G){if(G.indentAction===IndentAction.None)return TypeOperations._typeCommand(U,`
`+C.normalizeIndentation(G.indentation+G.appendText),V);if(G.indentAction===IndentAction.Indent)return TypeOperations._typeCommand(U,`
`+C.normalizeIndentation(G.indentation+G.appendText),V);if(G.indentAction===IndentAction.IndentOutdent){const Q=C.normalizeIndentation(G.indentation),J=C.normalizeIndentation(G.indentation+G.appendText),ee=`
`+J+`
`+Q;return V?new ReplaceCommandWithoutChangingPosition(U,ee,!0):new ReplaceCommandWithOffsetCursorState(U,ee,-1,J.length-Q.length,!0)}else if(G.indentAction===IndentAction.Outdent){const Q=TypeOperations.unshiftIndent(C,G.indentation);return TypeOperations._typeCommand(U,`
`+C.normalizeIndentation(Q+G.appendText),V)}}const Z=W.getLineContent(U.startLineNumber),X=getLeadingWhitespace(Z).substring(0,U.startColumn-1);if(C.autoIndent>=4){const Q=getIndentForEnter(C.autoIndent,W,U,{unshiftIndent:J=>TypeOperations.unshiftIndent(C,J),shiftIndent:J=>TypeOperations.shiftIndent(C,J),normalizeIndentation:J=>C.normalizeIndentation(J)},C.languageConfigurationService);if(Q){let J=C.visibleColumnFromColumn(W,U.getEndPosition());const ee=U.endColumn,te=W.getLineContent(U.endLineNumber),ie=firstNonWhitespaceIndex(te);if(ie>=0?U=U.setEndPosition(U.endLineNumber,Math.max(U.endColumn,ie+1)):U=U.setEndPosition(U.endLineNumber,W.getLineMaxColumn(U.endLineNumber)),V)return new ReplaceCommandWithoutChangingPosition(U,`
`+C.normalizeIndentation(Q.afterEnter),!0);{let ne=0;return ee<=ie+1&&(C.insertSpaces||(J=Math.ceil(J/C.indentSize)),ne=Math.min(J+1-C.normalizeIndentation(Q.afterEnter).length-1,0)),new ReplaceCommandWithOffsetCursorState(U,`
`+C.normalizeIndentation(Q.afterEnter),0,ne,!0)}}}return TypeOperations._typeCommand(U,`
`+C.normalizeIndentation(X),V)}static _isAutoIndentType(C,W,V){if(C.autoIndent<4)return!1;for(let U=0,G=V.length;U<G;U++)if(!W.tokenization.isCheapToTokenize(V[U].getEndPosition().lineNumber))return!1;return!0}static _runAutoIndentType(C,W,V,U){const G=getIndentationAtPosition(W,V.startLineNumber,V.startColumn),Z=getIndentActionForType(C.autoIndent,W,V,U,{shiftIndent:X=>TypeOperations.shiftIndent(C,X),unshiftIndent:X=>TypeOperations.unshiftIndent(C,X)},C.languageConfigurationService);if(Z===null)return null;if(Z!==C.normalizeIndentation(G)){const X=W.getLineFirstNonWhitespaceColumn(V.startLineNumber);return X===0?TypeOperations._typeCommand(new Range$2(V.startLineNumber,1,V.endLineNumber,V.endColumn),C.normalizeIndentation(Z)+U,!1):TypeOperations._typeCommand(new Range$2(V.startLineNumber,1,V.endLineNumber,V.endColumn),C.normalizeIndentation(Z)+W.getLineContent(V.startLineNumber).substring(X-1,V.startColumn-1)+U,!1)}return null}static _isAutoClosingOvertype(C,W,V,U,G){if(C.autoClosingOvertype==="never"||!C.autoClosingPairs.autoClosingPairsCloseSingleChar.has(G))return!1;for(let Z=0,X=V.length;Z<X;Z++){const Q=V[Z];if(!Q.isEmpty())return!1;const J=Q.getPosition(),ee=W.getLineContent(J.lineNumber);if(ee.charAt(J.column-1)!==G)return!1;const ie=isQuote(G);if((J.column>2?ee.charCodeAt(J.column-2):0)===92&&ie)return!1;if(C.autoClosingOvertype==="auto"){let oe=!1;for(let re=0,ae=U.length;re<ae;re++){const se=U[re];if(J.lineNumber===se.startLineNumber&&J.column===se.startColumn){oe=!0;break}}if(!oe)return!1}}return!0}static _runAutoClosingOvertype(C,W,V,U,G){const Z=[];for(let X=0,Q=U.length;X<Q;X++){const ee=U[X].getPosition(),te=new Range$2(ee.lineNumber,ee.column,ee.lineNumber,ee.column+1);Z[X]=new ReplaceCommand(te,G)}return new EditOperationResult(4,Z,{shouldPushStackElementBefore:shouldPushStackElementBetween(C,4),shouldPushStackElementAfter:!1})}static _isBeforeClosingBrace(C,W){const V=W.charAt(0),U=C.autoClosingPairs.autoClosingPairsOpenByStart.get(V)||[],G=C.autoClosingPairs.autoClosingPairsCloseByStart.get(V)||[],Z=U.some(Q=>W.startsWith(Q.open)),X=G.some(Q=>W.startsWith(Q.close));return!Z&&X}static _findAutoClosingPairOpen(C,W,V,U){const G=C.autoClosingPairs.autoClosingPairsOpenByEnd.get(U);if(!G)return null;let Z=null;for(const X of G)if(Z===null||X.open.length>Z.open.length){let Q=!0;for(const J of V)if(W.getValueInRange(new Range$2(J.lineNumber,J.column-X.open.length+1,J.lineNumber,J.column))+U!==X.open){Q=!1;break}Q&&(Z=X)}return Z}static _findContainedAutoClosingPair(C,W){if(W.open.length<=1)return null;const V=W.close.charAt(W.close.length-1),U=C.autoClosingPairs.autoClosingPairsCloseByEnd.get(V)||[];let G=null;for(const Z of U)Z.open!==W.open&&W.open.includes(Z.open)&&W.close.endsWith(Z.close)&&(!G||Z.open.length>G.open.length)&&(G=Z);return G}static _getAutoClosingPairClose(C,W,V,U,G){for(const oe of V)if(!oe.isEmpty())return null;const Z=V.map(oe=>{const re=oe.getPosition();return G?{lineNumber:re.lineNumber,beforeColumn:re.column-U.length,afterColumn:re.column}:{lineNumber:re.lineNumber,beforeColumn:re.column,afterColumn:re.column}}),X=this._findAutoClosingPairOpen(C,W,Z.map(oe=>new Position$1(oe.lineNumber,oe.beforeColumn)),U);if(!X)return null;let Q,J;if(isQuote(U)?(Q=C.autoClosingQuotes,J=C.shouldAutoCloseBefore.quote):(C.blockCommentStartToken?X.open.includes(C.blockCommentStartToken):!1)?(Q=C.autoClosingComments,J=C.shouldAutoCloseBefore.comment):(Q=C.autoClosingBrackets,J=C.shouldAutoCloseBefore.bracket),Q==="never")return null;const te=this._findContainedAutoClosingPair(C,X),ie=te?te.close:"";let ne=!0;for(const oe of Z){const{lineNumber:re,beforeColumn:ae,afterColumn:se}=oe,le=W.getLineContent(re),ce=le.substring(0,ae-1),de=le.substring(se-1);if(de.startsWith(ie)||(ne=!1),de.length>0){const fe=de.charAt(0);if(!TypeOperations._isBeforeClosingBrace(C,de)&&!J(fe))return null}if(X.open.length===1&&(U==="'"||U==='"')&&Q!=="always"){const fe=getMapForWordSeparators(C.wordSeparators);if(ce.length>0){const pe=ce.charCodeAt(ce.length-1);if(fe.get(pe)===0)return null}}if(!W.tokenization.isCheapToTokenize(re))return null;W.tokenization.forceTokenization(re);const ue=W.tokenization.getLineTokens(re),ge=createScopedLineTokens(ue,ae-1);if(!X.shouldAutoClose(ge,ae-ge.firstCharOffset))return null;const he=X.findNeutralCharacter();if(he){const fe=W.tokenization.getTokenTypeIfInsertingCharacter(re,ae,he);if(!X.isOK(fe))return null}}return ne?X.close.substring(0,X.close.length-ie.length):X.close}static _runAutoClosingOpenCharType(C,W,V,U,G,Z,X){const Q=[];for(let J=0,ee=U.length;J<ee;J++){const te=U[J];Q[J]=new TypeWithAutoClosingCommand(te,G,!Z,X)}return new EditOperationResult(4,Q,{shouldPushStackElementBefore:!0,shouldPushStackElementAfter:!1})}static _shouldSurroundChar(C,W){return isQuote(W)?C.autoSurround==="quotes"||C.autoSurround==="languageDefined":C.autoSurround==="brackets"||C.autoSurround==="languageDefined"}static _isSurroundSelectionType(C,W,V,U){if(!TypeOperations._shouldSurroundChar(C,U)||!C.surroundingPairs.hasOwnProperty(U))return!1;const G=isQuote(U);for(const Z of V){if(Z.isEmpty())return!1;let X=!0;for(let Q=Z.startLineNumber;Q<=Z.endLineNumber;Q++){const J=W.getLineContent(Q),ee=Q===Z.startLineNumber?Z.startColumn-1:0,te=Q===Z.endLineNumber?Z.endColumn-1:J.length,ie=J.substring(ee,te);if(/[^ \t]/.test(ie)){X=!1;break}}if(X)return!1;if(G&&Z.startLineNumber===Z.endLineNumber&&Z.startColumn+1===Z.endColumn){const Q=W.getValueInRange(Z);if(isQuote(Q))return!1}}return!0}static _runSurroundSelectionType(C,W,V,U,G){const Z=[];for(let X=0,Q=U.length;X<Q;X++){const J=U[X],ee=W.surroundingPairs[G];Z[X]=new SurroundSelectionCommand(J,G,ee)}return new EditOperationResult(0,Z,{shouldPushStackElementBefore:!0,shouldPushStackElementAfter:!0})}static _isTypeInterceptorElectricChar(C,W,V){return!!(V.length===1&&W.tokenization.isCheapToTokenize(V[0].getEndPosition().lineNumber))}static _typeInterceptorElectricChar(C,W,V,U,G){if(!W.electricChars.hasOwnProperty(G)||!U.isEmpty())return null;const Z=U.getPosition();V.tokenization.forceTokenization(Z.lineNumber);const X=V.tokenization.getLineTokens(Z.lineNumber);let Q;try{Q=W.onElectricCharacter(G,X,Z.column)}catch(J){return onUnexpectedError(J),null}if(!Q)return null;if(Q.matchOpenBracket){const J=(X.getLineContent()+G).lastIndexOf(Q.matchOpenBracket)+1,ee=V.bracketPairs.findMatchingBracketUp(Q.matchOpenBracket,{lineNumber:Z.lineNumber,column:J},500);if(ee){if(ee.startLineNumber===Z.lineNumber)return null;const te=V.getLineContent(ee.startLineNumber),ie=getLeadingWhitespace(te),ne=W.normalizeIndentation(ie),oe=V.getLineContent(Z.lineNumber),re=V.getLineFirstNonWhitespaceColumn(Z.lineNumber)||Z.column,ae=oe.substring(re-1,Z.column-1),se=ne+ae+G,le=new Range$2(Z.lineNumber,1,Z.lineNumber,Z.column),ce=new ReplaceCommand(le,se);return new EditOperationResult(getTypingOperation(se,C),[ce],{shouldPushStackElementBefore:!1,shouldPushStackElementAfter:!0})}}return null}static compositionEndWithInterceptors(C,W,V,U,G,Z){if(!U)return null;let X=null;for(const te of U)if(X===null)X=te.insertedText;else if(X!==te.insertedText)return null;if(!X||X.length!==1)return null;const Q=X;let J=!1;for(const te of U)if(te.deletedText.length!==0){J=!0;break}if(J){if(!TypeOperations._shouldSurroundChar(W,Q)||!W.surroundingPairs.hasOwnProperty(Q))return null;const te=isQuote(Q);for(const oe of U)if(oe.deletedSelectionStart!==0||oe.deletedSelectionEnd!==oe.deletedText.length||/^[ \t]+$/.test(oe.deletedText)||te&&isQuote(oe.deletedText))return null;const ie=[];for(const oe of G){if(!oe.isEmpty())return null;ie.push(oe.getPosition())}if(ie.length!==U.length)return null;const ne=[];for(let oe=0,re=ie.length;oe<re;oe++)ne.push(new CompositionSurroundSelectionCommand(ie[oe],U[oe].deletedText,W.surroundingPairs[Q]));return new EditOperationResult(4,ne,{shouldPushStackElementBefore:!0,shouldPushStackElementAfter:!1})}if(this._isAutoClosingOvertype(W,V,G,Z,Q)){const te=G.map(ie=>new ReplaceCommand(new Range$2(ie.positionLineNumber,ie.positionColumn,ie.positionLineNumber,ie.positionColumn+1),"",!1));return new EditOperationResult(4,te,{shouldPushStackElementBefore:!0,shouldPushStackElementAfter:!1})}const ee=this._getAutoClosingPairClose(W,V,G,Q,!0);return ee!==null?this._runAutoClosingOpenCharType(C,W,V,G,Q,!0,ee):null}static typeWithInterceptors(C,W,V,U,G,Z,X){if(!C&&X===`
`){const ee=[];for(let te=0,ie=G.length;te<ie;te++)ee[te]=TypeOperations._enter(V,U,!1,G[te]);return new EditOperationResult(4,ee,{shouldPushStackElementBefore:!0,shouldPushStackElementAfter:!1})}if(!C&&this._isAutoIndentType(V,U,G)){const ee=[];let te=!1;for(let ie=0,ne=G.length;ie<ne;ie++)if(ee[ie]=this._runAutoIndentType(V,U,G[ie],X),!ee[ie]){te=!0;break}if(!te)return new EditOperationResult(4,ee,{shouldPushStackElementBefore:!0,shouldPushStackElementAfter:!1})}if(this._isAutoClosingOvertype(V,U,G,Z,X))return this._runAutoClosingOvertype(W,V,U,G,X);if(!C){const ee=this._getAutoClosingPairClose(V,U,G,X,!1);if(ee)return this._runAutoClosingOpenCharType(W,V,U,G,X,!1,ee)}if(!C&&this._isSurroundSelectionType(V,U,G,X))return this._runSurroundSelectionType(W,V,U,G,X);if(!C&&this._isTypeInterceptorElectricChar(V,U,G)){const ee=this._typeInterceptorElectricChar(W,V,U,G[0],X);if(ee)return ee}const Q=[];for(let ee=0,te=G.length;ee<te;ee++)Q[ee]=new ReplaceCommand(G[ee],X);const J=getTypingOperation(X,W);return new EditOperationResult(J,Q,{shouldPushStackElementBefore:shouldPushStackElementBetween(W,J),shouldPushStackElementAfter:!1})}static typeWithoutInterceptors(C,W,V,U,G){const Z=[];for(let Q=0,J=U.length;Q<J;Q++)Z[Q]=new ReplaceCommand(U[Q],G);const X=getTypingOperation(G,C);return new EditOperationResult(X,Z,{shouldPushStackElementBefore:shouldPushStackElementBetween(C,X),shouldPushStackElementAfter:!1})}static lineInsertBefore(C,W,V){if(W===null||V===null)return[];const U=[];for(let G=0,Z=V.length;G<Z;G++){let X=V[G].positionLineNumber;if(X===1)U[G]=new ReplaceCommandWithoutChangingPosition(new Range$2(1,1,1,1),`
`);else{X--;const Q=W.getLineMaxColumn(X);U[G]=this._enter(C,W,!1,new Range$2(X,Q,X,Q))}}return U}static lineInsertAfter(C,W,V){if(W===null||V===null)return[];const U=[];for(let G=0,Z=V.length;G<Z;G++){const X=V[G].positionLineNumber,Q=W.getLineMaxColumn(X);U[G]=this._enter(C,W,!1,new Range$2(X,Q,X,Q))}return U}static lineBreakInsert(C,W,V){const U=[];for(let G=0,Z=V.length;G<Z;G++)U[G]=this._enter(C,W,!0,V[G]);return U}}class TypeWithAutoClosingCommand extends ReplaceCommandWithOffsetCursorState{constructor(C,W,V,U){super(C,(V?W:"")+U,0,-U.length),this._openCharacter=W,this._closeCharacter=U,this.closeCharacterRange=null,this.enclosingRange=null}computeCursorState(C,W){const U=W.getInverseEditOperations()[0].range;return this.closeCharacterRange=new Range$2(U.startLineNumber,U.endColumn-this._closeCharacter.length,U.endLineNumber,U.endColumn),this.enclosingRange=new Range$2(U.startLineNumber,U.endColumn-this._openCharacter.length-this._closeCharacter.length,U.endLineNumber,U.endColumn),super.computeCursorState(C,W)}}class CompositionOutcome{constructor(C,W,V,U,G,Z){this.deletedText=C,this.deletedSelectionStart=W,this.deletedSelectionEnd=V,this.insertedText=U,this.insertedSelectionStart=G,this.insertedSelectionEnd=Z}}function getTypingOperation(K,C){return K===" "?C===5||C===6?6:5:4}function shouldPushStackElementBetween(K,C){return isTypingOperation(K)&&!isTypingOperation(C)?!0:K===5?!1:normalizeOperationType(K)!==normalizeOperationType(C)}function normalizeOperationType(K){return K===6||K===5?"space":K}function isTypingOperation(K){return K===4||K===5||K===6}var EditorContextKeys;(function(K){K.editorSimpleInput=new RawContextKey("editorSimpleInput",!1,!0),K.editorTextFocus=new RawContextKey("editorTextFocus",!1,localize("editorTextFocus","Whether the editor text has focus (cursor is blinking)")),K.focus=new RawContextKey("editorFocus",!1,localize("editorFocus","Whether the editor or an editor widget has focus (e.g. focus is in the find widget)")),K.textInputFocus=new RawContextKey("textInputFocus",!1,localize("textInputFocus","Whether an editor or a rich text input has focus (cursor is blinking)")),K.readOnly=new RawContextKey("editorReadonly",!1,localize("editorReadonly","Whether the editor is read-only")),K.inDiffEditor=new RawContextKey("inDiffEditor",!1,localize("inDiffEditor","Whether the context is a diff editor")),K.isEmbeddedDiffEditor=new RawContextKey("isEmbeddedDiffEditor",!1,localize("isEmbeddedDiffEditor","Whether the context is an embedded diff editor")),K.comparingMovedCode=new RawContextKey("comparingMovedCode",!1,localize("comparingMovedCode","Whether a moved code block is selected for comparison")),K.accessibleDiffViewerVisible=new RawContextKey("accessibleDiffViewerVisible",!1,localize("accessibleDiffViewerVisible","Whether the accessible diff viewer is visible")),K.diffEditorRenderSideBySideInlineBreakpointReached=new RawContextKey("diffEditorRenderSideBySideInlineBreakpointReached",!1,localize("diffEditorRenderSideBySideInlineBreakpointReached","Whether the diff editor render side by side inline breakpoint is reached")),K.columnSelection=new RawContextKey("editorColumnSelection",!1,localize("editorColumnSelection","Whether `editor.columnSelection` is enabled")),K.writable=K.readOnly.toNegated(),K.hasNonEmptySelection=new RawContextKey("editorHasSelection",!1,localize("editorHasSelection","Whether the editor has text selected")),K.hasOnlyEmptySelection=K.hasNonEmptySelection.toNegated(),K.hasMultipleSelections=new RawContextKey("editorHasMultipleSelections",!1,localize("editorHasMultipleSelections","Whether the editor has multiple selections")),K.hasSingleSelection=K.hasMultipleSelections.toNegated(),K.tabMovesFocus=new RawContextKey("editorTabMovesFocus",!1,localize("editorTabMovesFocus","Whether `Tab` will move focus out of the editor")),K.tabDoesNotMoveFocus=K.tabMovesFocus.toNegated(),K.isInWalkThroughSnippet=new RawContextKey("isInEmbeddedEditor",!1,!0),K.canUndo=new RawContextKey("canUndo",!1,!0),K.canRedo=new RawContextKey("canRedo",!1,!0),K.hoverVisible=new RawContextKey("editorHoverVisible",!1,localize("editorHoverVisible","Whether the editor hover is visible")),K.hoverFocused=new RawContextKey("editorHoverFocused",!1,localize("editorHoverFocused","Whether the editor hover is focused")),K.stickyScrollFocused=new RawContextKey("stickyScrollFocused",!1,localize("stickyScrollFocused","Whether the sticky scroll is focused")),K.stickyScrollVisible=new RawContextKey("stickyScrollVisible",!1,localize("stickyScrollVisible","Whether the sticky scroll is visible")),K.standaloneColorPickerVisible=new RawContextKey("standaloneColorPickerVisible",!1,localize("standaloneColorPickerVisible","Whether the standalone color picker is visible")),K.standaloneColorPickerFocused=new RawContextKey("standaloneColorPickerFocused",!1,localize("standaloneColorPickerFocused","Whether the standalone color picker is focused")),K.inCompositeEditor=new RawContextKey("inCompositeEditor",void 0,localize("inCompositeEditor","Whether the editor is part of a larger editor (e.g. notebooks)")),K.notInCompositeEditor=K.inCompositeEditor.toNegated(),K.languageId=new RawContextKey("editorLangId","",localize("editorLangId","The language identifier of the editor")),K.hasCompletionItemProvider=new RawContextKey("editorHasCompletionItemProvider",!1,localize("editorHasCompletionItemProvider","Whether the editor has a completion item provider")),K.hasCodeActionsProvider=new RawContextKey("editorHasCodeActionsProvider",!1,localize("editorHasCodeActionsProvider","Whether the editor has a code actions provider")),K.hasCodeLensProvider=new RawContextKey("editorHasCodeLensProvider",!1,localize("editorHasCodeLensProvider","Whether the editor has a code lens provider")),K.hasDefinitionProvider=new RawContextKey("editorHasDefinitionProvider",!1,localize("editorHasDefinitionProvider","Whether the editor has a definition provider")),K.hasDeclarationProvider=new RawContextKey("editorHasDeclarationProvider",!1,localize("editorHasDeclarationProvider","Whether the editor has a declaration provider")),K.hasImplementationProvider=new RawContextKey("editorHasImplementationProvider",!1,localize("editorHasImplementationProvider","Whether the editor has an implementation provider")),K.hasTypeDefinitionProvider=new RawContextKey("editorHasTypeDefinitionProvider",!1,localize("editorHasTypeDefinitionProvider","Whether the editor has a type definition provider")),K.hasHoverProvider=new RawContextKey("editorHasHoverProvider",!1,localize("editorHasHoverProvider","Whether the editor has a hover provider")),K.hasDocumentHighlightProvider=new RawContextKey("editorHasDocumentHighlightProvider",!1,localize("editorHasDocumentHighlightProvider","Whether the editor has a document highlight provider")),K.hasDocumentSymbolProvider=new RawContextKey("editorHasDocumentSymbolProvider",!1,localize("editorHasDocumentSymbolProvider","Whether the editor has a document symbol provider")),K.hasReferenceProvider=new RawContextKey("editorHasReferenceProvider",!1,localize("editorHasReferenceProvider","Whether the editor has a reference provider")),K.hasRenameProvider=new RawContextKey("editorHasRenameProvider",!1,localize("editorHasRenameProvider","Whether the editor has a rename provider")),K.hasSignatureHelpProvider=new RawContextKey("editorHasSignatureHelpProvider",!1,localize("editorHasSignatureHelpProvider","Whether the editor has a signature help provider")),K.hasInlayHintsProvider=new RawContextKey("editorHasInlayHintsProvider",!1,localize("editorHasInlayHintsProvider","Whether the editor has an inline hints provider")),K.hasDocumentFormattingProvider=new RawContextKey("editorHasDocumentFormattingProvider",!1,localize("editorHasDocumentFormattingProvider","Whether the editor has a document formatting provider")),K.hasDocumentSelectionFormattingProvider=new RawContextKey("editorHasDocumentSelectionFormattingProvider",!1,localize("editorHasDocumentSelectionFormattingProvider","Whether the editor has a document selection formatting provider")),K.hasMultipleDocumentFormattingProvider=new RawContextKey("editorHasMultipleDocumentFormattingProvider",!1,localize("editorHasMultipleDocumentFormattingProvider","Whether the editor has multiple document formatting providers")),K.hasMultipleDocumentSelectionFormattingProvider=new RawContextKey("editorHasMultipleDocumentSelectionFormattingProvider",!1,localize("editorHasMultipleDocumentSelectionFormattingProvider","Whether the editor has multiple document selection formatting providers"))})(EditorContextKeys||(EditorContextKeys={}));const CORE_WEIGHT=0;class CoreEditorCommand extends EditorCommand{runEditorCommand(C,W,V){const U=W._getViewModel();U&&this.runCoreEditorCommand(U,V||{})}}var EditorScroll_;(function(K){const C=function(V){if(!isObject$2(V))return!1;const U=V;return!(!isString$3(U.to)||!isUndefined$2(U.by)&&!isString$3(U.by)||!isUndefined$2(U.value)&&!isNumber$3(U.value)||!isUndefined$2(U.revealCursor)&&!isBoolean$2(U.revealCursor))};K.description={description:"Scroll editor in the given direction",args:[{name:"Editor scroll argument object",description:"Property-value pairs that can be passed through this argument:\n					* 'to': A mandatory direction value.\n						```\n						'up', 'down'\n						```\n					* 'by': Unit to move. Default is computed based on 'to' value.\n						```\n						'line', 'wrappedLine', 'page', 'halfPage', 'editor'\n						```\n					* 'value': Number of units to move. Default is '1'.\n					* 'revealCursor': If 'true' reveals the cursor if it is outside view port.\n				",constraint:C,schema:{type:"object",required:["to"],properties:{to:{type:"string",enum:["up","down"]},by:{type:"string",enum:["line","wrappedLine","page","halfPage","editor"]},value:{type:"number",default:1},revealCursor:{type:"boolean"}}}}]},K.RawDirection={Up:"up",Right:"right",Down:"down",Left:"left"},K.RawUnit={Line:"line",WrappedLine:"wrappedLine",Page:"page",HalfPage:"halfPage",Editor:"editor",Column:"column"};function W(V){let U;switch(V.to){case K.RawDirection.Up:U=1;break;case K.RawDirection.Right:U=2;break;case K.RawDirection.Down:U=3;break;case K.RawDirection.Left:U=4;break;default:return null}let G;switch(V.by){case K.RawUnit.Line:G=1;break;case K.RawUnit.WrappedLine:G=2;break;case K.RawUnit.Page:G=3;break;case K.RawUnit.HalfPage:G=4;break;case K.RawUnit.Editor:G=5;break;case K.RawUnit.Column:G=6;break;default:G=2}const Z=Math.floor(V.value||1),X=!!V.revealCursor;return{direction:U,unit:G,value:Z,revealCursor:X,select:!!V.select}}K.parse=W})(EditorScroll_||(EditorScroll_={}));var RevealLine_;(function(K){const C=function(W){if(!isObject$2(W))return!1;const V=W;return!(!isNumber$3(V.lineNumber)&&!isString$3(V.lineNumber)||!isUndefined$2(V.at)&&!isString$3(V.at))};K.description={description:"Reveal the given line at the given logical position",args:[{name:"Reveal line argument object",description:"Property-value pairs that can be passed through this argument:\n					* 'lineNumber': A mandatory line number value.\n					* 'at': Logical position at which line has to be revealed.\n						```\n						'top', 'center', 'bottom'\n						```\n				",constraint:C,schema:{type:"object",required:["lineNumber"],properties:{lineNumber:{type:["number","string"]},at:{type:"string",enum:["top","center","bottom"]}}}}]},K.RawAtArgument={Top:"top",Center:"center",Bottom:"bottom"}})(RevealLine_||(RevealLine_={}));class EditorOrNativeTextInputCommand{constructor(C){C.addImplementation(1e4,"code-editor",(W,V)=>{const U=W.get(ICodeEditorService).getFocusedCodeEditor();return U&&U.hasTextFocus()?this._runEditorCommand(W,U,V):!1}),C.addImplementation(1e3,"generic-dom-input-textarea",(W,V)=>{const U=getActiveElement();return U&&["input","textarea"].indexOf(U.tagName.toLowerCase())>=0?(this.runDOMCommand(U),!0):!1}),C.addImplementation(0,"generic-dom",(W,V)=>{const U=W.get(ICodeEditorService).getActiveCodeEditor();return U?(U.focus(),this._runEditorCommand(W,U,V)):!1})}_runEditorCommand(C,W,V){const U=this.runEditorCommand(C,W,V);return U||!0}}var CoreNavigationCommands;(function(K){class C extends CoreEditorCommand{constructor(le){super(le),this._inSelectionMode=le.inSelectionMode}runCoreEditorCommand(le,ce){if(!ce.position)return;le.model.pushStackElement(),le.setCursorStates(ce.source,3,[CursorMoveCommands.moveTo(le,le.getPrimaryCursorState(),this._inSelectionMode,ce.position,ce.viewPosition)])&&ce.revealType!==2&&le.revealPrimaryCursor(ce.source,!0,!0)}}K.MoveTo=registerEditorCommand(new C({id:"_moveTo",inSelectionMode:!1,precondition:void 0})),K.MoveToSelect=registerEditorCommand(new C({id:"_moveToSelect",inSelectionMode:!0,precondition:void 0}));class W extends CoreEditorCommand{runCoreEditorCommand(le,ce){le.model.pushStackElement();const de=this._getColumnSelectResult(le,le.getPrimaryCursorState(),le.getCursorColumnSelectData(),ce);de!==null&&(le.setCursorStates(ce.source,3,de.viewStates.map(ue=>CursorState$1.fromViewState(ue))),le.setCursorColumnSelectData({isReal:!0,fromViewLineNumber:de.fromLineNumber,fromViewVisualColumn:de.fromVisualColumn,toViewLineNumber:de.toLineNumber,toViewVisualColumn:de.toVisualColumn}),de.reversed?le.revealTopMostCursor(ce.source):le.revealBottomMostCursor(ce.source))}}K.ColumnSelect=registerEditorCommand(new class extends W{constructor(){super({id:"columnSelect",precondition:void 0})}_getColumnSelectResult(se,le,ce,de){if(typeof de.position>"u"||typeof de.viewPosition>"u"||typeof de.mouseColumn>"u")return null;const ue=se.model.validatePosition(de.position),ge=se.coordinatesConverter.validateViewPosition(new Position$1(de.viewPosition.lineNumber,de.viewPosition.column),ue),he=de.doColumnSelect?ce.fromViewLineNumber:ge.lineNumber,fe=de.doColumnSelect?ce.fromViewVisualColumn:de.mouseColumn-1;return ColumnSelection.columnSelect(se.cursorConfig,se,he,fe,ge.lineNumber,de.mouseColumn-1)}}),K.CursorColumnSelectLeft=registerEditorCommand(new class extends W{constructor(){super({id:"cursorColumnSelectLeft",precondition:void 0,kbOpts:{weight:CORE_WEIGHT,kbExpr:EditorContextKeys.textInputFocus,primary:3599,linux:{primary:0}}})}_getColumnSelectResult(se,le,ce,de){return ColumnSelection.columnSelectLeft(se.cursorConfig,se,ce)}}),K.CursorColumnSelectRight=registerEditorCommand(new class extends W{constructor(){super({id:"cursorColumnSelectRight",precondition:void 0,kbOpts:{weight:CORE_WEIGHT,kbExpr:EditorContextKeys.textInputFocus,primary:3601,linux:{primary:0}}})}_getColumnSelectResult(se,le,ce,de){return ColumnSelection.columnSelectRight(se.cursorConfig,se,ce)}});class V extends W{constructor(le){super(le),this._isPaged=le.isPaged}_getColumnSelectResult(le,ce,de,ue){return ColumnSelection.columnSelectUp(le.cursorConfig,le,de,this._isPaged)}}K.CursorColumnSelectUp=registerEditorCommand(new V({isPaged:!1,id:"cursorColumnSelectUp",precondition:void 0,kbOpts:{weight:CORE_WEIGHT,kbExpr:EditorContextKeys.textInputFocus,primary:3600,linux:{primary:0}}})),K.CursorColumnSelectPageUp=registerEditorCommand(new V({isPaged:!0,id:"cursorColumnSelectPageUp",precondition:void 0,kbOpts:{weight:CORE_WEIGHT,kbExpr:EditorContextKeys.textInputFocus,primary:3595,linux:{primary:0}}}));class U extends W{constructor(le){super(le),this._isPaged=le.isPaged}_getColumnSelectResult(le,ce,de,ue){return ColumnSelection.columnSelectDown(le.cursorConfig,le,de,this._isPaged)}}K.CursorColumnSelectDown=registerEditorCommand(new U({isPaged:!1,id:"cursorColumnSelectDown",precondition:void 0,kbOpts:{weight:CORE_WEIGHT,kbExpr:EditorContextKeys.textInputFocus,primary:3602,linux:{primary:0}}})),K.CursorColumnSelectPageDown=registerEditorCommand(new U({isPaged:!0,id:"cursorColumnSelectPageDown",precondition:void 0,kbOpts:{weight:CORE_WEIGHT,kbExpr:EditorContextKeys.textInputFocus,primary:3596,linux:{primary:0}}}));class G extends CoreEditorCommand{constructor(){super({id:"cursorMove",precondition:void 0,description:CursorMove.description})}runCoreEditorCommand(le,ce){const de=CursorMove.parse(ce);de&&this._runCursorMove(le,ce.source,de)}_runCursorMove(le,ce,de){le.model.pushStackElement(),le.setCursorStates(ce,3,G._move(le,le.getCursorStates(),de)),le.revealPrimaryCursor(ce,!0)}static _move(le,ce,de){const ue=de.select,ge=de.value;switch(de.direction){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:case 10:return CursorMoveCommands.simpleMove(le,ce,de.direction,ue,ge,de.unit);case 11:case 13:case 12:case 14:return CursorMoveCommands.viewportMove(le,ce,de.direction,ue,ge);default:return null}}}K.CursorMoveImpl=G,K.CursorMove=registerEditorCommand(new G);class Z extends CoreEditorCommand{constructor(le){super(le),this._staticArgs=le.args}runCoreEditorCommand(le,ce){let de=this._staticArgs;this._staticArgs.value===-1&&(de={direction:this._staticArgs.direction,unit:this._staticArgs.unit,select:this._staticArgs.select,value:ce.pageSize||le.cursorConfig.pageSize}),le.model.pushStackElement(),le.setCursorStates(ce.source,3,CursorMoveCommands.simpleMove(le,le.getCursorStates(),de.direction,de.select,de.value,de.unit)),le.revealPrimaryCursor(ce.source,!0)}}K.CursorLeft=registerEditorCommand(new Z({args:{direction:0,unit:0,select:!1,value:1},id:"cursorLeft",precondition:void 0,kbOpts:{weight:CORE_WEIGHT,kbExpr:EditorContextKeys.textInputFocus,primary:15,mac:{primary:15,secondary:[288]}}})),K.CursorLeftSelect=registerEditorCommand(new Z({args:{direction:0,unit:0,select:!0,value:1},id:"cursorLeftSelect",precondition:void 0,kbOpts:{weight:CORE_WEIGHT,kbExpr:EditorContextKeys.textInputFocus,primary:1039}})),K.CursorRight=registerEditorCommand(new Z({args:{direction:1,unit:0,select:!1,value:1},id:"cursorRight",precondition:void 0,kbOpts:{weight:CORE_WEIGHT,kbExpr:EditorContextKeys.textInputFocus,primary:17,mac:{primary:17,secondary:[292]}}})),K.CursorRightSelect=registerEditorCommand(new Z({args:{direction:1,unit:0,select:!0,value:1},id:"cursorRightSelect",precondition:void 0,kbOpts:{weight:CORE_WEIGHT,kbExpr:EditorContextKeys.textInputFocus,primary:1041}})),K.CursorUp=registerEditorCommand(new Z({args:{direction:2,unit:2,select:!1,value:1},id:"cursorUp",precondition:void 0,kbOpts:{weight:CORE_WEIGHT,kbExpr:EditorContextKeys.textInputFocus,primary:16,mac:{primary:16,secondary:[302]}}})),K.CursorUpSelect=registerEditorCommand(new Z({args:{direction:2,unit:2,select:!0,value:1},id:"cursorUpSelect",precondition:void 0,kbOpts:{weight:CORE_WEIGHT,kbExpr:EditorContextKeys.textInputFocus,primary:1040,secondary:[3088],mac:{primary:1040},linux:{primary:1040}}})),K.CursorPageUp=registerEditorCommand(new Z({args:{direction:2,unit:2,select:!1,value:-1},id:"cursorPageUp",precondition:void 0,kbOpts:{weight:CORE_WEIGHT,kbExpr:EditorContextKeys.textInputFocus,primary:11}})),K.CursorPageUpSelect=registerEditorCommand(new Z({args:{direction:2,unit:2,select:!0,value:-1},id:"cursorPageUpSelect",precondition:void 0,kbOpts:{weight:CORE_WEIGHT,kbExpr:EditorContextKeys.textInputFocus,primary:1035}})),K.CursorDown=registerEditorCommand(new Z({args:{direction:3,unit:2,select:!1,value:1},id:"cursorDown",precondition:void 0,kbOpts:{weight:CORE_WEIGHT,kbExpr:EditorContextKeys.textInputFocus,primary:18,mac:{primary:18,secondary:[300]}}})),K.CursorDownSelect=registerEditorCommand(new Z({args:{direction:3,unit:2,select:!0,value:1},id:"cursorDownSelect",precondition:void 0,kbOpts:{weight:CORE_WEIGHT,kbExpr:EditorContextKeys.textInputFocus,primary:1042,secondary:[3090],mac:{primary:1042},linux:{primary:1042}}})),K.CursorPageDown=registerEditorCommand(new Z({args:{direction:3,unit:2,select:!1,value:-1},id:"cursorPageDown",precondition:void 0,kbOpts:{weight:CORE_WEIGHT,kbExpr:EditorContextKeys.textInputFocus,primary:12}})),K.CursorPageDownSelect=registerEditorCommand(new Z({args:{direction:3,unit:2,select:!0,value:-1},id:"cursorPageDownSelect",precondition:void 0,kbOpts:{weight:CORE_WEIGHT,kbExpr:EditorContextKeys.textInputFocus,primary:1036}})),K.CreateCursor=registerEditorCommand(new class extends CoreEditorCommand{constructor(){super({id:"createCursor",precondition:void 0})}runCoreEditorCommand(se,le){if(!le.position)return;let ce;le.wholeLine?ce=CursorMoveCommands.line(se,se.getPrimaryCursorState(),!1,le.position,le.viewPosition):ce=CursorMoveCommands.moveTo(se,se.getPrimaryCursorState(),!1,le.position,le.viewPosition);const de=se.getCursorStates();if(de.length>1){const ue=ce.modelState?ce.modelState.position:null,ge=ce.viewState?ce.viewState.position:null;for(let he=0,fe=de.length;he<fe;he++){const pe=de[he];if(!(ue&&!pe.modelState.selection.containsPosition(ue))&&!(ge&&!pe.viewState.selection.containsPosition(ge))){de.splice(he,1),se.model.pushStackElement(),se.setCursorStates(le.source,3,de);return}}}de.push(ce),se.model.pushStackElement(),se.setCursorStates(le.source,3,de)}}),K.LastCursorMoveToSelect=registerEditorCommand(new class extends CoreEditorCommand{constructor(){super({id:"_lastCursorMoveToSelect",precondition:void 0})}runCoreEditorCommand(se,le){if(!le.position)return;const ce=se.getLastAddedCursorIndex(),de=se.getCursorStates(),ue=de.slice(0);ue[ce]=CursorMoveCommands.moveTo(se,de[ce],!0,le.position,le.viewPosition),se.model.pushStackElement(),se.setCursorStates(le.source,3,ue)}});class X extends CoreEditorCommand{constructor(le){super(le),this._inSelectionMode=le.inSelectionMode}runCoreEditorCommand(le,ce){le.model.pushStackElement(),le.setCursorStates(ce.source,3,CursorMoveCommands.moveToBeginningOfLine(le,le.getCursorStates(),this._inSelectionMode)),le.revealPrimaryCursor(ce.source,!0)}}K.CursorHome=registerEditorCommand(new X({inSelectionMode:!1,id:"cursorHome",precondition:void 0,kbOpts:{weight:CORE_WEIGHT,kbExpr:EditorContextKeys.textInputFocus,primary:14,mac:{primary:14,secondary:[2063]}}})),K.CursorHomeSelect=registerEditorCommand(new X({inSelectionMode:!0,id:"cursorHomeSelect",precondition:void 0,kbOpts:{weight:CORE_WEIGHT,kbExpr:EditorContextKeys.textInputFocus,primary:1038,mac:{primary:1038,secondary:[3087]}}}));class Q extends CoreEditorCommand{constructor(le){super(le),this._inSelectionMode=le.inSelectionMode}runCoreEditorCommand(le,ce){le.model.pushStackElement(),le.setCursorStates(ce.source,3,this._exec(le.getCursorStates())),le.revealPrimaryCursor(ce.source,!0)}_exec(le){const ce=[];for(let de=0,ue=le.length;de<ue;de++){const ge=le[de],he=ge.modelState.position.lineNumber;ce[de]=CursorState$1.fromModelState(ge.modelState.move(this._inSelectionMode,he,1,0))}return ce}}K.CursorLineStart=registerEditorCommand(new Q({inSelectionMode:!1,id:"cursorLineStart",precondition:void 0,kbOpts:{weight:CORE_WEIGHT,kbExpr:EditorContextKeys.textInputFocus,primary:0,mac:{primary:287}}})),K.CursorLineStartSelect=registerEditorCommand(new Q({inSelectionMode:!0,id:"cursorLineStartSelect",precondition:void 0,kbOpts:{weight:CORE_WEIGHT,kbExpr:EditorContextKeys.textInputFocus,primary:0,mac:{primary:1311}}}));class J extends CoreEditorCommand{constructor(le){super(le),this._inSelectionMode=le.inSelectionMode}runCoreEditorCommand(le,ce){le.model.pushStackElement(),le.setCursorStates(ce.source,3,CursorMoveCommands.moveToEndOfLine(le,le.getCursorStates(),this._inSelectionMode,ce.sticky||!1)),le.revealPrimaryCursor(ce.source,!0)}}K.CursorEnd=registerEditorCommand(new J({inSelectionMode:!1,id:"cursorEnd",precondition:void 0,kbOpts:{args:{sticky:!1},weight:CORE_WEIGHT,kbExpr:EditorContextKeys.textInputFocus,primary:13,mac:{primary:13,secondary:[2065]}},description:{description:"Go to End",args:[{name:"args",schema:{type:"object",properties:{sticky:{description:localize("stickydesc","Stick to the end even when going to longer lines"),type:"boolean",default:!1}}}}]}})),K.CursorEndSelect=registerEditorCommand(new J({inSelectionMode:!0,id:"cursorEndSelect",precondition:void 0,kbOpts:{args:{sticky:!1},weight:CORE_WEIGHT,kbExpr:EditorContextKeys.textInputFocus,primary:1037,mac:{primary:1037,secondary:[3089]}},description:{description:"Select to End",args:[{name:"args",schema:{type:"object",properties:{sticky:{description:localize("stickydesc","Stick to the end even when going to longer lines"),type:"boolean",default:!1}}}}]}}));class ee extends CoreEditorCommand{constructor(le){super(le),this._inSelectionMode=le.inSelectionMode}runCoreEditorCommand(le,ce){le.model.pushStackElement(),le.setCursorStates(ce.source,3,this._exec(le,le.getCursorStates())),le.revealPrimaryCursor(ce.source,!0)}_exec(le,ce){const de=[];for(let ue=0,ge=ce.length;ue<ge;ue++){const he=ce[ue],fe=he.modelState.position.lineNumber,pe=le.model.getLineMaxColumn(fe);de[ue]=CursorState$1.fromModelState(he.modelState.move(this._inSelectionMode,fe,pe,0))}return de}}K.CursorLineEnd=registerEditorCommand(new ee({inSelectionMode:!1,id:"cursorLineEnd",precondition:void 0,kbOpts:{weight:CORE_WEIGHT,kbExpr:EditorContextKeys.textInputFocus,primary:0,mac:{primary:291}}})),K.CursorLineEndSelect=registerEditorCommand(new ee({inSelectionMode:!0,id:"cursorLineEndSelect",precondition:void 0,kbOpts:{weight:CORE_WEIGHT,kbExpr:EditorContextKeys.textInputFocus,primary:0,mac:{primary:1315}}}));class te extends CoreEditorCommand{constructor(le){super(le),this._inSelectionMode=le.inSelectionMode}runCoreEditorCommand(le,ce){le.model.pushStackElement(),le.setCursorStates(ce.source,3,CursorMoveCommands.moveToBeginningOfBuffer(le,le.getCursorStates(),this._inSelectionMode)),le.revealPrimaryCursor(ce.source,!0)}}K.CursorTop=registerEditorCommand(new te({inSelectionMode:!1,id:"cursorTop",precondition:void 0,kbOpts:{weight:CORE_WEIGHT,kbExpr:EditorContextKeys.textInputFocus,primary:2062,mac:{primary:2064}}})),K.CursorTopSelect=registerEditorCommand(new te({inSelectionMode:!0,id:"cursorTopSelect",precondition:void 0,kbOpts:{weight:CORE_WEIGHT,kbExpr:EditorContextKeys.textInputFocus,primary:3086,mac:{primary:3088}}}));class ie extends CoreEditorCommand{constructor(le){super(le),this._inSelectionMode=le.inSelectionMode}runCoreEditorCommand(le,ce){le.model.pushStackElement(),le.setCursorStates(ce.source,3,CursorMoveCommands.moveToEndOfBuffer(le,le.getCursorStates(),this._inSelectionMode)),le.revealPrimaryCursor(ce.source,!0)}}K.CursorBottom=registerEditorCommand(new ie({inSelectionMode:!1,id:"cursorBottom",precondition:void 0,kbOpts:{weight:CORE_WEIGHT,kbExpr:EditorContextKeys.textInputFocus,primary:2061,mac:{primary:2066}}})),K.CursorBottomSelect=registerEditorCommand(new ie({inSelectionMode:!0,id:"cursorBottomSelect",precondition:void 0,kbOpts:{weight:CORE_WEIGHT,kbExpr:EditorContextKeys.textInputFocus,primary:3085,mac:{primary:3090}}}));class ne extends CoreEditorCommand{constructor(){super({id:"editorScroll",precondition:void 0,description:EditorScroll_.description})}determineScrollMethod(le){const ce=[6],de=[1,2,3,4,5,6],ue=[4,2],ge=[1,3];return ce.includes(le.unit)&&ue.includes(le.direction)?this._runHorizontalEditorScroll.bind(this):de.includes(le.unit)&&ge.includes(le.direction)?this._runVerticalEditorScroll.bind(this):null}runCoreEditorCommand(le,ce){const de=EditorScroll_.parse(ce);if(!de)return;const ue=this.determineScrollMethod(de);ue&&ue(le,ce.source,de)}_runVerticalEditorScroll(le,ce,de){const ue=this._computeDesiredScrollTop(le,de);if(de.revealCursor){const ge=le.getCompletelyVisibleViewRangeAtScrollTop(ue);le.setCursorStates(ce,3,[CursorMoveCommands.findPositionInViewportIfOutside(le,le.getPrimaryCursorState(),ge,de.select)])}le.viewLayout.setScrollPosition({scrollTop:ue},0)}_computeDesiredScrollTop(le,ce){if(ce.unit===1){const ge=le.viewLayout.getFutureViewport(),he=le.getCompletelyVisibleViewRangeAtScrollTop(ge.top),fe=le.coordinatesConverter.convertViewRangeToModelRange(he);let pe;ce.direction===1?pe=Math.max(1,fe.startLineNumber-ce.value):pe=Math.min(le.model.getLineCount(),fe.startLineNumber+ce.value);const Se=le.coordinatesConverter.convertModelPositionToViewPosition(new Position$1(pe,1));return le.viewLayout.getVerticalOffsetForLineNumber(Se.lineNumber)}if(ce.unit===5){let ge=0;return ce.direction===3&&(ge=le.model.getLineCount()-le.cursorConfig.pageSize),le.viewLayout.getVerticalOffsetForLineNumber(ge)}let de;ce.unit===3?de=le.cursorConfig.pageSize*ce.value:ce.unit===4?de=Math.round(le.cursorConfig.pageSize/2)*ce.value:de=ce.value;const ue=(ce.direction===1?-1:1)*de;return le.viewLayout.getCurrentScrollTop()+ue*le.cursorConfig.lineHeight}_runHorizontalEditorScroll(le,ce,de){const ue=this._computeDesiredScrollLeft(le,de);le.viewLayout.setScrollPosition({scrollLeft:ue},0)}_computeDesiredScrollLeft(le,ce){const de=(ce.direction===4?-1:1)*ce.value;return le.viewLayout.getCurrentScrollLeft()+de*le.cursorConfig.typicalHalfwidthCharacterWidth}}K.EditorScrollImpl=ne,K.EditorScroll=registerEditorCommand(new ne),K.ScrollLineUp=registerEditorCommand(new class extends CoreEditorCommand{constructor(){super({id:"scrollLineUp",precondition:void 0,kbOpts:{weight:CORE_WEIGHT,kbExpr:EditorContextKeys.textInputFocus,primary:2064,mac:{primary:267}}})}runCoreEditorCommand(se,le){K.EditorScroll.runCoreEditorCommand(se,{to:EditorScroll_.RawDirection.Up,by:EditorScroll_.RawUnit.WrappedLine,value:1,revealCursor:!1,select:!1,source:le.source})}}),K.ScrollPageUp=registerEditorCommand(new class extends CoreEditorCommand{constructor(){super({id:"scrollPageUp",precondition:void 0,kbOpts:{weight:CORE_WEIGHT,kbExpr:EditorContextKeys.textInputFocus,primary:2059,win:{primary:523},linux:{primary:523}}})}runCoreEditorCommand(se,le){K.EditorScroll.runCoreEditorCommand(se,{to:EditorScroll_.RawDirection.Up,by:EditorScroll_.RawUnit.Page,value:1,revealCursor:!1,select:!1,source:le.source})}}),K.ScrollEditorTop=registerEditorCommand(new class extends CoreEditorCommand{constructor(){super({id:"scrollEditorTop",precondition:void 0,kbOpts:{weight:CORE_WEIGHT,kbExpr:EditorContextKeys.textInputFocus}})}runCoreEditorCommand(se,le){K.EditorScroll.runCoreEditorCommand(se,{to:EditorScroll_.RawDirection.Up,by:EditorScroll_.RawUnit.Editor,value:1,revealCursor:!1,select:!1,source:le.source})}}),K.ScrollLineDown=registerEditorCommand(new class extends CoreEditorCommand{constructor(){super({id:"scrollLineDown",precondition:void 0,kbOpts:{weight:CORE_WEIGHT,kbExpr:EditorContextKeys.textInputFocus,primary:2066,mac:{primary:268}}})}runCoreEditorCommand(se,le){K.EditorScroll.runCoreEditorCommand(se,{to:EditorScroll_.RawDirection.Down,by:EditorScroll_.RawUnit.WrappedLine,value:1,revealCursor:!1,select:!1,source:le.source})}}),K.ScrollPageDown=registerEditorCommand(new class extends CoreEditorCommand{constructor(){super({id:"scrollPageDown",precondition:void 0,kbOpts:{weight:CORE_WEIGHT,kbExpr:EditorContextKeys.textInputFocus,primary:2060,win:{primary:524},linux:{primary:524}}})}runCoreEditorCommand(se,le){K.EditorScroll.runCoreEditorCommand(se,{to:EditorScroll_.RawDirection.Down,by:EditorScroll_.RawUnit.Page,value:1,revealCursor:!1,select:!1,source:le.source})}}),K.ScrollEditorBottom=registerEditorCommand(new class extends CoreEditorCommand{constructor(){super({id:"scrollEditorBottom",precondition:void 0,kbOpts:{weight:CORE_WEIGHT,kbExpr:EditorContextKeys.textInputFocus}})}runCoreEditorCommand(se,le){K.EditorScroll.runCoreEditorCommand(se,{to:EditorScroll_.RawDirection.Down,by:EditorScroll_.RawUnit.Editor,value:1,revealCursor:!1,select:!1,source:le.source})}}),K.ScrollLeft=registerEditorCommand(new class extends CoreEditorCommand{constructor(){super({id:"scrollLeft",precondition:void 0,kbOpts:{weight:CORE_WEIGHT,kbExpr:EditorContextKeys.textInputFocus}})}runCoreEditorCommand(se,le){K.EditorScroll.runCoreEditorCommand(se,{to:EditorScroll_.RawDirection.Left,by:EditorScroll_.RawUnit.Column,value:2,revealCursor:!1,select:!1,source:le.source})}}),K.ScrollRight=registerEditorCommand(new class extends CoreEditorCommand{constructor(){super({id:"scrollRight",precondition:void 0,kbOpts:{weight:CORE_WEIGHT,kbExpr:EditorContextKeys.textInputFocus}})}runCoreEditorCommand(se,le){K.EditorScroll.runCoreEditorCommand(se,{to:EditorScroll_.RawDirection.Right,by:EditorScroll_.RawUnit.Column,value:2,revealCursor:!1,select:!1,source:le.source})}});class oe extends CoreEditorCommand{constructor(le){super(le),this._inSelectionMode=le.inSelectionMode}runCoreEditorCommand(le,ce){ce.position&&(le.model.pushStackElement(),le.setCursorStates(ce.source,3,[CursorMoveCommands.word(le,le.getPrimaryCursorState(),this._inSelectionMode,ce.position)]),ce.revealType!==2&&le.revealPrimaryCursor(ce.source,!0,!0))}}K.WordSelect=registerEditorCommand(new oe({inSelectionMode:!1,id:"_wordSelect",precondition:void 0})),K.WordSelectDrag=registerEditorCommand(new oe({inSelectionMode:!0,id:"_wordSelectDrag",precondition:void 0})),K.LastCursorWordSelect=registerEditorCommand(new class extends CoreEditorCommand{constructor(){super({id:"lastCursorWordSelect",precondition:void 0})}runCoreEditorCommand(se,le){if(!le.position)return;const ce=se.getLastAddedCursorIndex(),de=se.getCursorStates(),ue=de.slice(0),ge=de[ce];ue[ce]=CursorMoveCommands.word(se,ge,ge.modelState.hasSelection(),le.position),se.model.pushStackElement(),se.setCursorStates(le.source,3,ue)}});class re extends CoreEditorCommand{constructor(le){super(le),this._inSelectionMode=le.inSelectionMode}runCoreEditorCommand(le,ce){ce.position&&(le.model.pushStackElement(),le.setCursorStates(ce.source,3,[CursorMoveCommands.line(le,le.getPrimaryCursorState(),this._inSelectionMode,ce.position,ce.viewPosition)]),ce.revealType!==2&&le.revealPrimaryCursor(ce.source,!1,!0))}}K.LineSelect=registerEditorCommand(new re({inSelectionMode:!1,id:"_lineSelect",precondition:void 0})),K.LineSelectDrag=registerEditorCommand(new re({inSelectionMode:!0,id:"_lineSelectDrag",precondition:void 0}));class ae extends CoreEditorCommand{constructor(le){super(le),this._inSelectionMode=le.inSelectionMode}runCoreEditorCommand(le,ce){if(!ce.position)return;const de=le.getLastAddedCursorIndex(),ue=le.getCursorStates(),ge=ue.slice(0);ge[de]=CursorMoveCommands.line(le,ue[de],this._inSelectionMode,ce.position,ce.viewPosition),le.model.pushStackElement(),le.setCursorStates(ce.source,3,ge)}}K.LastCursorLineSelect=registerEditorCommand(new ae({inSelectionMode:!1,id:"lastCursorLineSelect",precondition:void 0})),K.LastCursorLineSelectDrag=registerEditorCommand(new ae({inSelectionMode:!0,id:"lastCursorLineSelectDrag",precondition:void 0})),K.CancelSelection=registerEditorCommand(new class extends CoreEditorCommand{constructor(){super({id:"cancelSelection",precondition:EditorContextKeys.hasNonEmptySelection,kbOpts:{weight:CORE_WEIGHT,kbExpr:EditorContextKeys.textInputFocus,primary:9,secondary:[1033]}})}runCoreEditorCommand(se,le){se.model.pushStackElement(),se.setCursorStates(le.source,3,[CursorMoveCommands.cancelSelection(se,se.getPrimaryCursorState())]),se.revealPrimaryCursor(le.source,!0)}}),K.RemoveSecondaryCursors=registerEditorCommand(new class extends CoreEditorCommand{constructor(){super({id:"removeSecondaryCursors",precondition:EditorContextKeys.hasMultipleSelections,kbOpts:{weight:CORE_WEIGHT+1,kbExpr:EditorContextKeys.textInputFocus,primary:9,secondary:[1033]}})}runCoreEditorCommand(se,le){se.model.pushStackElement(),se.setCursorStates(le.source,3,[se.getPrimaryCursorState()]),se.revealPrimaryCursor(le.source,!0),status(localize("removedCursor","Removed secondary cursors"))}}),K.RevealLine=registerEditorCommand(new class extends CoreEditorCommand{constructor(){super({id:"revealLine",precondition:void 0,description:RevealLine_.description})}runCoreEditorCommand(se,le){const ce=le,de=ce.lineNumber||0;let ue=typeof de=="number"?de+1:parseInt(de)+1;ue<1&&(ue=1);const ge=se.model.getLineCount();ue>ge&&(ue=ge);const he=new Range$2(ue,1,ue,se.model.getLineMaxColumn(ue));let fe=0;if(ce.at)switch(ce.at){case RevealLine_.RawAtArgument.Top:fe=3;break;case RevealLine_.RawAtArgument.Center:fe=1;break;case RevealLine_.RawAtArgument.Bottom:fe=4;break}const pe=se.coordinatesConverter.convertModelRangeToViewRange(he);se.revealRange(le.source,!1,pe,fe,0)}}),K.SelectAll=new class extends EditorOrNativeTextInputCommand{constructor(){super(SelectAllCommand)}runDOMCommand(se){isFirefox&&(se.focus(),se.select()),se.ownerDocument.execCommand("selectAll")}runEditorCommand(se,le,ce){const de=le._getViewModel();de&&this.runCoreEditorCommand(de,ce)}runCoreEditorCommand(se,le){se.model.pushStackElement(),se.setCursorStates("keyboard",3,[CursorMoveCommands.selectAll(se,se.getPrimaryCursorState())])}},K.SetSelection=registerEditorCommand(new class extends CoreEditorCommand{constructor(){super({id:"setSelection",precondition:void 0})}runCoreEditorCommand(se,le){le.selection&&(se.model.pushStackElement(),se.setCursorStates(le.source,3,[CursorState$1.fromModelSelection(le.selection)]))}})})(CoreNavigationCommands||(CoreNavigationCommands={}));const columnSelectionCondition=ContextKeyExpr.and(EditorContextKeys.textInputFocus,EditorContextKeys.columnSelection);function registerColumnSelection(K,C){KeybindingsRegistry.registerKeybindingRule({id:K,primary:C,when:columnSelectionCondition,weight:CORE_WEIGHT+1})}registerColumnSelection(CoreNavigationCommands.CursorColumnSelectLeft.id,1039);registerColumnSelection(CoreNavigationCommands.CursorColumnSelectRight.id,1041);registerColumnSelection(CoreNavigationCommands.CursorColumnSelectUp.id,1040);registerColumnSelection(CoreNavigationCommands.CursorColumnSelectPageUp.id,1035);registerColumnSelection(CoreNavigationCommands.CursorColumnSelectDown.id,1042);registerColumnSelection(CoreNavigationCommands.CursorColumnSelectPageDown.id,1036);function registerCommand$2(K){return K.register(),K}var CoreEditingCommands;(function(K){class C extends EditorCommand{runEditorCommand(V,U,G){const Z=U._getViewModel();Z&&this.runCoreEditingCommand(U,Z,G||{})}}K.CoreEditingCommand=C,K.LineBreakInsert=registerEditorCommand(new class extends C{constructor(){super({id:"lineBreakInsert",precondition:EditorContextKeys.writable,kbOpts:{weight:CORE_WEIGHT,kbExpr:EditorContextKeys.textInputFocus,primary:0,mac:{primary:301}}})}runCoreEditingCommand(W,V,U){W.pushUndoStop(),W.executeCommands(this.id,TypeOperations.lineBreakInsert(V.cursorConfig,V.model,V.getCursorStates().map(G=>G.modelState.selection)))}}),K.Outdent=registerEditorCommand(new class extends C{constructor(){super({id:"outdent",precondition:EditorContextKeys.writable,kbOpts:{weight:CORE_WEIGHT,kbExpr:ContextKeyExpr.and(EditorContextKeys.editorTextFocus,EditorContextKeys.tabDoesNotMoveFocus),primary:1026}})}runCoreEditingCommand(W,V,U){W.pushUndoStop(),W.executeCommands(this.id,TypeOperations.outdent(V.cursorConfig,V.model,V.getCursorStates().map(G=>G.modelState.selection))),W.pushUndoStop()}}),K.Tab=registerEditorCommand(new class extends C{constructor(){super({id:"tab",precondition:EditorContextKeys.writable,kbOpts:{weight:CORE_WEIGHT,kbExpr:ContextKeyExpr.and(EditorContextKeys.editorTextFocus,EditorContextKeys.tabDoesNotMoveFocus),primary:2}})}runCoreEditingCommand(W,V,U){W.pushUndoStop(),W.executeCommands(this.id,TypeOperations.tab(V.cursorConfig,V.model,V.getCursorStates().map(G=>G.modelState.selection))),W.pushUndoStop()}}),K.DeleteLeft=registerEditorCommand(new class extends C{constructor(){super({id:"deleteLeft",precondition:void 0,kbOpts:{weight:CORE_WEIGHT,kbExpr:EditorContextKeys.textInputFocus,primary:1,secondary:[1025],mac:{primary:1,secondary:[1025,294,257]}}})}runCoreEditingCommand(W,V,U){const[G,Z]=DeleteOperations.deleteLeft(V.getPrevEditOperationType(),V.cursorConfig,V.model,V.getCursorStates().map(X=>X.modelState.selection),V.getCursorAutoClosedCharacters());G&&W.pushUndoStop(),W.executeCommands(this.id,Z),V.setPrevEditOperationType(2)}}),K.DeleteRight=registerEditorCommand(new class extends C{constructor(){super({id:"deleteRight",precondition:void 0,kbOpts:{weight:CORE_WEIGHT,kbExpr:EditorContextKeys.textInputFocus,primary:20,mac:{primary:20,secondary:[290,276]}}})}runCoreEditingCommand(W,V,U){const[G,Z]=DeleteOperations.deleteRight(V.getPrevEditOperationType(),V.cursorConfig,V.model,V.getCursorStates().map(X=>X.modelState.selection));G&&W.pushUndoStop(),W.executeCommands(this.id,Z),V.setPrevEditOperationType(3)}}),K.Undo=new class extends EditorOrNativeTextInputCommand{constructor(){super(UndoCommand)}runDOMCommand(W){W.ownerDocument.execCommand("undo")}runEditorCommand(W,V,U){if(!(!V.hasModel()||V.getOption(90)===!0))return V.getModel().undo()}},K.Redo=new class extends EditorOrNativeTextInputCommand{constructor(){super(RedoCommand)}runDOMCommand(W){W.ownerDocument.execCommand("redo")}runEditorCommand(W,V,U){if(!(!V.hasModel()||V.getOption(90)===!0))return V.getModel().redo()}}})(CoreEditingCommands||(CoreEditingCommands={}));class EditorHandlerCommand extends Command{constructor(C,W,V){super({id:C,precondition:void 0,description:V}),this._handlerId=W}runCommand(C,W){const V=C.get(ICodeEditorService).getFocusedCodeEditor();V&&V.trigger("keyboard",this._handlerId,W)}}function registerOverwritableCommand(K,C){registerCommand$2(new EditorHandlerCommand("default:"+K,K)),registerCommand$2(new EditorHandlerCommand(K,K,C))}registerOverwritableCommand("type",{description:"Type",args:[{name:"args",schema:{type:"object",required:["text"],properties:{text:{type:"string"}}}}]});registerOverwritableCommand("replacePreviousChar");registerOverwritableCommand("compositionType");registerOverwritableCommand("compositionStart");registerOverwritableCommand("compositionEnd");registerOverwritableCommand("paste");registerOverwritableCommand("cut");class ViewController{constructor(C,W,V,U){this.configuration=C,this.viewModel=W,this.userInputEvents=V,this.commandDelegate=U}paste(C,W,V,U){this.commandDelegate.paste(C,W,V,U)}type(C){this.commandDelegate.type(C)}compositionType(C,W,V,U){this.commandDelegate.compositionType(C,W,V,U)}compositionStart(){this.commandDelegate.startComposition()}compositionEnd(){this.commandDelegate.endComposition()}cut(){this.commandDelegate.cut()}setSelection(C){CoreNavigationCommands.SetSelection.runCoreEditorCommand(this.viewModel,{source:"keyboard",selection:C})}_validateViewColumn(C){const W=this.viewModel.getLineMinColumn(C.lineNumber);return C.column<W?new Position$1(C.lineNumber,W):C}_hasMulticursorModifier(C){switch(this.configuration.options.get(77)){case"altKey":return C.altKey;case"ctrlKey":return C.ctrlKey;case"metaKey":return C.metaKey;default:return!1}}_hasNonMulticursorModifier(C){switch(this.configuration.options.get(77)){case"altKey":return C.ctrlKey||C.metaKey;case"ctrlKey":return C.altKey||C.metaKey;case"metaKey":return C.ctrlKey||C.altKey;default:return!1}}dispatchMouse(C){const W=this.configuration.options,V=isLinux&&W.get(106),U=W.get(22);C.middleButton&&!V?this._columnSelect(C.position,C.mouseColumn,C.inSelectionMode):C.startedOnLineNumbers?this._hasMulticursorModifier(C)?C.inSelectionMode?this._lastCursorLineSelect(C.position,C.revealType):this._createCursor(C.position,!0):C.inSelectionMode?this._lineSelectDrag(C.position,C.revealType):this._lineSelect(C.position,C.revealType):C.mouseDownCount>=4?this._selectAll():C.mouseDownCount===3?this._hasMulticursorModifier(C)?C.inSelectionMode?this._lastCursorLineSelectDrag(C.position,C.revealType):this._lastCursorLineSelect(C.position,C.revealType):C.inSelectionMode?this._lineSelectDrag(C.position,C.revealType):this._lineSelect(C.position,C.revealType):C.mouseDownCount===2?C.onInjectedText||(this._hasMulticursorModifier(C)?this._lastCursorWordSelect(C.position,C.revealType):C.inSelectionMode?this._wordSelectDrag(C.position,C.revealType):this._wordSelect(C.position,C.revealType)):this._hasMulticursorModifier(C)?this._hasNonMulticursorModifier(C)||(C.shiftKey?this._columnSelect(C.position,C.mouseColumn,!0):C.inSelectionMode?this._lastCursorMoveToSelect(C.position,C.revealType):this._createCursor(C.position,!1)):C.inSelectionMode?C.altKey?this._columnSelect(C.position,C.mouseColumn,!0):U?this._columnSelect(C.position,C.mouseColumn,!0):this._moveToSelect(C.position,C.revealType):this.moveTo(C.position,C.revealType)}_usualArgs(C,W){return C=this._validateViewColumn(C),{source:"mouse",position:this._convertViewToModelPosition(C),viewPosition:C,revealType:W}}moveTo(C,W){CoreNavigationCommands.MoveTo.runCoreEditorCommand(this.viewModel,this._usualArgs(C,W))}_moveToSelect(C,W){CoreNavigationCommands.MoveToSelect.runCoreEditorCommand(this.viewModel,this._usualArgs(C,W))}_columnSelect(C,W,V){C=this._validateViewColumn(C),CoreNavigationCommands.ColumnSelect.runCoreEditorCommand(this.viewModel,{source:"mouse",position:this._convertViewToModelPosition(C),viewPosition:C,mouseColumn:W,doColumnSelect:V})}_createCursor(C,W){C=this._validateViewColumn(C),CoreNavigationCommands.CreateCursor.runCoreEditorCommand(this.viewModel,{source:"mouse",position:this._convertViewToModelPosition(C),viewPosition:C,wholeLine:W})}_lastCursorMoveToSelect(C,W){CoreNavigationCommands.LastCursorMoveToSelect.runCoreEditorCommand(this.viewModel,this._usualArgs(C,W))}_wordSelect(C,W){CoreNavigationCommands.WordSelect.runCoreEditorCommand(this.viewModel,this._usualArgs(C,W))}_wordSelectDrag(C,W){CoreNavigationCommands.WordSelectDrag.runCoreEditorCommand(this.viewModel,this._usualArgs(C,W))}_lastCursorWordSelect(C,W){CoreNavigationCommands.LastCursorWordSelect.runCoreEditorCommand(this.viewModel,this._usualArgs(C,W))}_lineSelect(C,W){CoreNavigationCommands.LineSelect.runCoreEditorCommand(this.viewModel,this._usualArgs(C,W))}_lineSelectDrag(C,W){CoreNavigationCommands.LineSelectDrag.runCoreEditorCommand(this.viewModel,this._usualArgs(C,W))}_lastCursorLineSelect(C,W){CoreNavigationCommands.LastCursorLineSelect.runCoreEditorCommand(this.viewModel,this._usualArgs(C,W))}_lastCursorLineSelectDrag(C,W){CoreNavigationCommands.LastCursorLineSelectDrag.runCoreEditorCommand(this.viewModel,this._usualArgs(C,W))}_selectAll(){CoreNavigationCommands.SelectAll.runCoreEditorCommand(this.viewModel,{source:"mouse"})}_convertViewToModelPosition(C){return this.viewModel.coordinatesConverter.convertViewPositionToModelPosition(C)}emitKeyDown(C){this.userInputEvents.emitKeyDown(C)}emitKeyUp(C){this.userInputEvents.emitKeyUp(C)}emitContextMenu(C){this.userInputEvents.emitContextMenu(C)}emitMouseMove(C){this.userInputEvents.emitMouseMove(C)}emitMouseLeave(C){this.userInputEvents.emitMouseLeave(C)}emitMouseUp(C){this.userInputEvents.emitMouseUp(C)}emitMouseDown(C){this.userInputEvents.emitMouseDown(C)}emitMouseDrag(C){this.userInputEvents.emitMouseDrag(C)}emitMouseDrop(C){this.userInputEvents.emitMouseDrop(C)}emitMouseDropCanceled(){this.userInputEvents.emitMouseDropCanceled()}emitMouseWheel(C){this.userInputEvents.emitMouseWheel(C)}}class ViewUserInputEvents{constructor(C){this.onKeyDown=null,this.onKeyUp=null,this.onContextMenu=null,this.onMouseMove=null,this.onMouseLeave=null,this.onMouseDown=null,this.onMouseUp=null,this.onMouseDrag=null,this.onMouseDrop=null,this.onMouseDropCanceled=null,this.onMouseWheel=null,this._coordinatesConverter=C}emitKeyDown(C){var W;(W=this.onKeyDown)===null||W===void 0||W.call(this,C)}emitKeyUp(C){var W;(W=this.onKeyUp)===null||W===void 0||W.call(this,C)}emitContextMenu(C){var W;(W=this.onContextMenu)===null||W===void 0||W.call(this,this._convertViewToModelMouseEvent(C))}emitMouseMove(C){var W;(W=this.onMouseMove)===null||W===void 0||W.call(this,this._convertViewToModelMouseEvent(C))}emitMouseLeave(C){var W;(W=this.onMouseLeave)===null||W===void 0||W.call(this,this._convertViewToModelMouseEvent(C))}emitMouseDown(C){var W;(W=this.onMouseDown)===null||W===void 0||W.call(this,this._convertViewToModelMouseEvent(C))}emitMouseUp(C){var W;(W=this.onMouseUp)===null||W===void 0||W.call(this,this._convertViewToModelMouseEvent(C))}emitMouseDrag(C){var W;(W=this.onMouseDrag)===null||W===void 0||W.call(this,this._convertViewToModelMouseEvent(C))}emitMouseDrop(C){var W;(W=this.onMouseDrop)===null||W===void 0||W.call(this,this._convertViewToModelMouseEvent(C))}emitMouseDropCanceled(){var C;(C=this.onMouseDropCanceled)===null||C===void 0||C.call(this)}emitMouseWheel(C){var W;(W=this.onMouseWheel)===null||W===void 0||W.call(this,C)}_convertViewToModelMouseEvent(C){return C.target?{event:C.event,target:this._convertViewToModelMouseTarget(C.target)}:C}_convertViewToModelMouseTarget(C){return ViewUserInputEvents.convertViewToModelMouseTarget(C,this._coordinatesConverter)}static convertViewToModelMouseTarget(C,W){const V=Object.assign({},C);return V.position&&(V.position=W.convertViewPositionToModelPosition(V.position)),V.range&&(V.range=W.convertViewRangeToModelRange(V.range)),(V.type===5||V.type===8)&&(V.detail=this.convertViewToModelViewZoneData(V.detail,W)),V}static convertViewToModelViewZoneData(C,W){return{viewZoneId:C.viewZoneId,positionBefore:C.positionBefore?W.convertViewPositionToModelPosition(C.positionBefore):C.positionBefore,positionAfter:C.positionAfter?W.convertViewPositionToModelPosition(C.positionAfter):C.positionAfter,position:W.convertViewPositionToModelPosition(C.position),afterLineNumber:W.convertViewPositionToModelPosition(new Position$1(C.afterLineNumber,1)).lineNumber}}}class RenderedLinesCollection{constructor(C){this._createLine=C,this._set(1,[])}flush(){this._set(1,[])}_set(C,W){this._lines=W,this._rendLineNumberStart=C}_get(){return{rendLineNumberStart:this._rendLineNumberStart,lines:this._lines}}getStartLineNumber(){return this._rendLineNumberStart}getEndLineNumber(){return this._rendLineNumberStart+this._lines.length-1}getCount(){return this._lines.length}getLine(C){const W=C-this._rendLineNumberStart;if(W<0||W>=this._lines.length)throw new BugIndicatingError("Illegal value for lineNumber");return this._lines[W]}onLinesDeleted(C,W){if(this.getCount()===0)return null;const V=this.getStartLineNumber(),U=this.getEndLineNumber();if(W<V){const Q=W-C+1;return this._rendLineNumberStart-=Q,null}if(C>U)return null;let G=0,Z=0;for(let Q=V;Q<=U;Q++){const J=Q-this._rendLineNumberStart;C<=Q&&Q<=W&&(Z===0?(G=J,Z=1):Z++)}if(C<V){let Q=0;W<V?Q=W-C+1:Q=V-C,this._rendLineNumberStart-=Q}return this._lines.splice(G,Z)}onLinesChanged(C,W){const V=C+W-1;if(this.getCount()===0)return!1;const U=this.getStartLineNumber(),G=this.getEndLineNumber();let Z=!1;for(let X=C;X<=V;X++)X>=U&&X<=G&&(this._lines[X-this._rendLineNumberStart].onContentChanged(),Z=!0);return Z}onLinesInserted(C,W){if(this.getCount()===0)return null;const V=W-C+1,U=this.getStartLineNumber(),G=this.getEndLineNumber();if(C<=U)return this._rendLineNumberStart+=V,null;if(C>G)return null;if(V+C>G)return this._lines.splice(C-this._rendLineNumberStart,G-C+1);const Z=[];for(let te=0;te<V;te++)Z[te]=this._createLine();const X=C-this._rendLineNumberStart,Q=this._lines.slice(0,X),J=this._lines.slice(X,this._lines.length-V),ee=this._lines.slice(this._lines.length-V,this._lines.length);return this._lines=Q.concat(Z).concat(J),ee}onTokensChanged(C){if(this.getCount()===0)return!1;const W=this.getStartLineNumber(),V=this.getEndLineNumber();let U=!1;for(let G=0,Z=C.length;G<Z;G++){const X=C[G];if(X.toLineNumber<W||X.fromLineNumber>V)continue;const Q=Math.max(W,X.fromLineNumber),J=Math.min(V,X.toLineNumber);for(let ee=Q;ee<=J;ee++){const te=ee-this._rendLineNumberStart;this._lines[te].onTokensChanged(),U=!0}}return U}}class VisibleLinesCollection{constructor(C){this._host=C,this.domNode=this._createDomNode(),this._linesCollection=new RenderedLinesCollection(()=>this._host.createVisibleLine())}_createDomNode(){const C=createFastDomNode(document.createElement("div"));return C.setClassName("view-layer"),C.setPosition("absolute"),C.domNode.setAttribute("role","presentation"),C.domNode.setAttribute("aria-hidden","true"),C}onConfigurationChanged(C){return!!C.hasChanged(143)}onFlushed(C){return this._linesCollection.flush(),!0}onLinesChanged(C){return this._linesCollection.onLinesChanged(C.fromLineNumber,C.count)}onLinesDeleted(C){const W=this._linesCollection.onLinesDeleted(C.fromLineNumber,C.toLineNumber);if(W)for(let V=0,U=W.length;V<U;V++){const G=W[V].getDomNode();G&&this.domNode.domNode.removeChild(G)}return!0}onLinesInserted(C){const W=this._linesCollection.onLinesInserted(C.fromLineNumber,C.toLineNumber);if(W)for(let V=0,U=W.length;V<U;V++){const G=W[V].getDomNode();G&&this.domNode.domNode.removeChild(G)}return!0}onScrollChanged(C){return C.scrollTopChanged}onTokensChanged(C){return this._linesCollection.onTokensChanged(C.ranges)}onZonesChanged(C){return!0}getStartLineNumber(){return this._linesCollection.getStartLineNumber()}getEndLineNumber(){return this._linesCollection.getEndLineNumber()}getVisibleLine(C){return this._linesCollection.getLine(C)}renderLines(C){const W=this._linesCollection._get(),V=new ViewLayerRenderer(this.domNode.domNode,this._host,C),U={rendLineNumberStart:W.rendLineNumberStart,lines:W.lines,linesLength:W.lines.length},G=V.render(U,C.startLineNumber,C.endLineNumber,C.relativeVerticalOffset);this._linesCollection._set(G.rendLineNumberStart,G.lines)}}class ViewLayerRenderer{constructor(C,W,V){this.domNode=C,this.host=W,this.viewportData=V}render(C,W,V,U){const G={rendLineNumberStart:C.rendLineNumberStart,lines:C.lines.slice(0),linesLength:C.linesLength};if(G.rendLineNumberStart+G.linesLength-1<W||V<G.rendLineNumberStart){G.rendLineNumberStart=W,G.linesLength=V-W+1,G.lines=[];for(let Z=W;Z<=V;Z++)G.lines[Z-W]=this.host.createVisibleLine();return this._finishRendering(G,!0,U),G}if(this._renderUntouchedLines(G,Math.max(W-G.rendLineNumberStart,0),Math.min(V-G.rendLineNumberStart,G.linesLength-1),U,W),G.rendLineNumberStart>W){const Z=W,X=Math.min(V,G.rendLineNumberStart-1);Z<=X&&(this._insertLinesBefore(G,Z,X,U,W),G.linesLength+=X-Z+1)}else if(G.rendLineNumberStart<W){const Z=Math.min(G.linesLength,W-G.rendLineNumberStart);Z>0&&(this._removeLinesBefore(G,Z),G.linesLength-=Z)}if(G.rendLineNumberStart=W,G.rendLineNumberStart+G.linesLength-1<V){const Z=G.rendLineNumberStart+G.linesLength,X=V;Z<=X&&(this._insertLinesAfter(G,Z,X,U,W),G.linesLength+=X-Z+1)}else if(G.rendLineNumberStart+G.linesLength-1>V){const Z=Math.max(0,V-G.rendLineNumberStart+1),Q=G.linesLength-1-Z+1;Q>0&&(this._removeLinesAfter(G,Q),G.linesLength-=Q)}return this._finishRendering(G,!1,U),G}_renderUntouchedLines(C,W,V,U,G){const Z=C.rendLineNumberStart,X=C.lines;for(let Q=W;Q<=V;Q++){const J=Z+Q;X[Q].layoutLine(J,U[J-G])}}_insertLinesBefore(C,W,V,U,G){const Z=[];let X=0;for(let Q=W;Q<=V;Q++)Z[X++]=this.host.createVisibleLine();C.lines=Z.concat(C.lines)}_removeLinesBefore(C,W){for(let V=0;V<W;V++){const U=C.lines[V].getDomNode();U&&this.domNode.removeChild(U)}C.lines.splice(0,W)}_insertLinesAfter(C,W,V,U,G){const Z=[];let X=0;for(let Q=W;Q<=V;Q++)Z[X++]=this.host.createVisibleLine();C.lines=C.lines.concat(Z)}_removeLinesAfter(C,W){const V=C.linesLength-W;for(let U=0;U<W;U++){const G=C.lines[V+U].getDomNode();G&&this.domNode.removeChild(G)}C.lines.splice(V,W)}_finishRenderingNewLines(C,W,V,U){ViewLayerRenderer._ttPolicy&&(V=ViewLayerRenderer._ttPolicy.createHTML(V));const G=this.domNode.lastChild;W||!G?this.domNode.innerHTML=V:G.insertAdjacentHTML("afterend",V);let Z=this.domNode.lastChild;for(let X=C.linesLength-1;X>=0;X--){const Q=C.lines[X];U[X]&&(Q.setDomNode(Z),Z=Z.previousSibling)}}_finishRenderingInvalidLines(C,W,V){const U=document.createElement("div");ViewLayerRenderer._ttPolicy&&(W=ViewLayerRenderer._ttPolicy.createHTML(W)),U.innerHTML=W;for(let G=0;G<C.linesLength;G++){const Z=C.lines[G];if(V[G]){const X=U.firstChild,Q=Z.getDomNode();Q.parentNode.replaceChild(X,Q),Z.setDomNode(X)}}}_finishRendering(C,W,V){const U=ViewLayerRenderer._sb,G=C.linesLength,Z=C.lines,X=C.rendLineNumberStart,Q=[];{U.reset();let J=!1;for(let ee=0;ee<G;ee++){const te=Z[ee];Q[ee]=!1,!(te.getDomNode()||!te.renderLine(ee+X,V[ee],this.viewportData,U))&&(Q[ee]=!0,J=!0)}J&&this._finishRenderingNewLines(C,W,U.build(),Q)}{U.reset();let J=!1;const ee=[];for(let te=0;te<G;te++){const ie=Z[te];ee[te]=!1,!(Q[te]||!ie.renderLine(te+X,V[te],this.viewportData,U))&&(ee[te]=!0,J=!0)}J&&this._finishRenderingInvalidLines(C,U.build(),ee)}}}ViewLayerRenderer._ttPolicy=createTrustedTypesPolicy("editorViewLayer",{createHTML:K=>K});ViewLayerRenderer._sb=new StringBuilder(1e5);class ViewOverlays extends ViewPart{constructor(C){super(C),this._visibleLines=new VisibleLinesCollection(this),this.domNode=this._visibleLines.domNode;const V=this._context.configuration.options.get(50);applyFontInfo(this.domNode,V),this._dynamicOverlays=[],this._isFocused=!1,this.domNode.setClassName("view-overlays")}shouldRender(){if(super.shouldRender())return!0;for(let C=0,W=this._dynamicOverlays.length;C<W;C++)if(this._dynamicOverlays[C].shouldRender())return!0;return!1}dispose(){super.dispose();for(let C=0,W=this._dynamicOverlays.length;C<W;C++)this._dynamicOverlays[C].dispose();this._dynamicOverlays=[]}getDomNode(){return this.domNode}createVisibleLine(){return new ViewOverlayLine(this._context.configuration,this._dynamicOverlays)}addDynamicOverlay(C){this._dynamicOverlays.push(C)}onConfigurationChanged(C){this._visibleLines.onConfigurationChanged(C);const W=this._visibleLines.getStartLineNumber(),V=this._visibleLines.getEndLineNumber();for(let Z=W;Z<=V;Z++)this._visibleLines.getVisibleLine(Z).onConfigurationChanged(C);const G=this._context.configuration.options.get(50);return applyFontInfo(this.domNode,G),!0}onFlushed(C){return this._visibleLines.onFlushed(C)}onFocusChanged(C){return this._isFocused=C.isFocused,!0}onLinesChanged(C){return this._visibleLines.onLinesChanged(C)}onLinesDeleted(C){return this._visibleLines.onLinesDeleted(C)}onLinesInserted(C){return this._visibleLines.onLinesInserted(C)}onScrollChanged(C){return this._visibleLines.onScrollChanged(C)||!0}onTokensChanged(C){return this._visibleLines.onTokensChanged(C)}onZonesChanged(C){return this._visibleLines.onZonesChanged(C)}prepareRender(C){const W=this._dynamicOverlays.filter(V=>V.shouldRender());for(let V=0,U=W.length;V<U;V++){const G=W[V];G.prepareRender(C),G.onDidRender()}}render(C){this._viewOverlaysRender(C),this.domNode.toggleClassName("focused",this._isFocused)}_viewOverlaysRender(C){this._visibleLines.renderLines(C.viewportData)}}class ViewOverlayLine{constructor(C,W){this._configuration=C,this._lineHeight=this._configuration.options.get(66),this._dynamicOverlays=W,this._domNode=null,this._renderedContent=null}getDomNode(){return this._domNode?this._domNode.domNode:null}setDomNode(C){this._domNode=createFastDomNode(C)}onContentChanged(){}onTokensChanged(){}onConfigurationChanged(C){this._lineHeight=this._configuration.options.get(66)}renderLine(C,W,V,U){let G="";for(let Z=0,X=this._dynamicOverlays.length;Z<X;Z++){const Q=this._dynamicOverlays[Z];G+=Q.render(V.startLineNumber,C)}return this._renderedContent===G?!1:(this._renderedContent=G,U.appendString('<div style="position:absolute;top:'),U.appendString(String(W)),U.appendString("px;width:100%;height:"),U.appendString(String(this._lineHeight)),U.appendString('px;">'),U.appendString(G),U.appendString("</div>"),!0)}layoutLine(C,W){this._domNode&&(this._domNode.setTop(W),this._domNode.setHeight(this._lineHeight))}}class ContentViewOverlays extends ViewOverlays{constructor(C){super(C);const V=this._context.configuration.options.get(143);this._contentWidth=V.contentWidth,this.domNode.setHeight(0)}onConfigurationChanged(C){const V=this._context.configuration.options.get(143);return this._contentWidth=V.contentWidth,super.onConfigurationChanged(C)||!0}onScrollChanged(C){return super.onScrollChanged(C)||C.scrollWidthChanged}_viewOverlaysRender(C){super._viewOverlaysRender(C),this.domNode.setWidth(Math.max(C.scrollWidth,this._contentWidth))}}class MarginViewOverlays extends ViewOverlays{constructor(C){super(C);const W=this._context.configuration.options,V=W.get(143);this._contentLeft=V.contentLeft,this.domNode.setClassName("margin-view-overlays"),this.domNode.setWidth(1),applyFontInfo(this.domNode,W.get(50))}onConfigurationChanged(C){const W=this._context.configuration.options;applyFontInfo(this.domNode,W.get(50));const V=W.get(143);return this._contentLeft=V.contentLeft,super.onConfigurationChanged(C)||!0}onScrollChanged(C){return super.onScrollChanged(C)||C.scrollHeightChanged}_viewOverlaysRender(C){super._viewOverlaysRender(C);const W=Math.min(C.scrollHeight,1e6);this.domNode.setHeight(W),this.domNode.setWidth(this._contentLeft)}}class ViewContentWidgets extends ViewPart{constructor(C,W){super(C),this._viewDomNode=W,this._widgets={},this.domNode=createFastDomNode(document.createElement("div")),PartFingerprints.write(this.domNode,1),this.domNode.setClassName("contentWidgets"),this.domNode.setPosition("absolute"),this.domNode.setTop(0),this.overflowingContentWidgetsDomNode=createFastDomNode(document.createElement("div")),PartFingerprints.write(this.overflowingContentWidgetsDomNode,2),this.overflowingContentWidgetsDomNode.setClassName("overflowingContentWidgets")}dispose(){super.dispose(),this._widgets={}}onConfigurationChanged(C){const W=Object.keys(this._widgets);for(const V of W)this._widgets[V].onConfigurationChanged(C);return!0}onDecorationsChanged(C){return!0}onFlushed(C){return!0}onLineMappingChanged(C){return this._updateAnchorsViewPositions(),!0}onLinesChanged(C){return this._updateAnchorsViewPositions(),!0}onLinesDeleted(C){return this._updateAnchorsViewPositions(),!0}onLinesInserted(C){return this._updateAnchorsViewPositions(),!0}onScrollChanged(C){return!0}onZonesChanged(C){return!0}_updateAnchorsViewPositions(){const C=Object.keys(this._widgets);for(const W of C)this._widgets[W].updateAnchorViewPosition()}addWidget(C){const W=new Widget(this._context,this._viewDomNode,C);this._widgets[W.id]=W,W.allowEditorOverflow?this.overflowingContentWidgetsDomNode.appendChild(W.domNode):this.domNode.appendChild(W.domNode),this.setShouldRender()}setWidgetPosition(C,W,V,U,G){this._widgets[C.getId()].setPosition(W,V,U,G),this.setShouldRender()}removeWidget(C){const W=C.getId();if(this._widgets.hasOwnProperty(W)){const V=this._widgets[W];delete this._widgets[W];const U=V.domNode.domNode;U.parentNode.removeChild(U),U.removeAttribute("monaco-visible-content-widget"),this.setShouldRender()}}shouldSuppressMouseDownOnWidget(C){return this._widgets.hasOwnProperty(C)?this._widgets[C].suppressMouseDown:!1}onBeforeRender(C){const W=Object.keys(this._widgets);for(const V of W)this._widgets[V].onBeforeRender(C)}prepareRender(C){const W=Object.keys(this._widgets);for(const V of W)this._widgets[V].prepareRender(C)}render(C){const W=Object.keys(this._widgets);for(const V of W)this._widgets[V].render(C)}}class Widget{constructor(C,W,V){this._primaryAnchor=new PositionPair(null,null),this._secondaryAnchor=new PositionPair(null,null),this._context=C,this._viewDomNode=W,this._actual=V,this.domNode=createFastDomNode(this._actual.getDomNode()),this.id=this._actual.getId(),this.allowEditorOverflow=this._actual.allowEditorOverflow||!1,this.suppressMouseDown=this._actual.suppressMouseDown||!1;const U=this._context.configuration.options,G=U.get(143);this._fixedOverflowWidgets=U.get(42),this._contentWidth=G.contentWidth,this._contentLeft=G.contentLeft,this._lineHeight=U.get(66),this._affinity=null,this._preference=[],this._cachedDomNodeOffsetWidth=-1,this._cachedDomNodeOffsetHeight=-1,this._maxWidth=this._getMaxWidth(),this._isVisible=!1,this._renderData=null,this.domNode.setPosition(this._fixedOverflowWidgets&&this.allowEditorOverflow?"fixed":"absolute"),this.domNode.setDisplay("none"),this.domNode.setVisibility("hidden"),this.domNode.setAttribute("widgetId",this.id),this.domNode.setMaxWidth(this._maxWidth)}onConfigurationChanged(C){const W=this._context.configuration.options;if(this._lineHeight=W.get(66),C.hasChanged(143)){const V=W.get(143);this._contentLeft=V.contentLeft,this._contentWidth=V.contentWidth,this._maxWidth=this._getMaxWidth()}}updateAnchorViewPosition(){this._setPosition(this._affinity,this._primaryAnchor.modelPosition,this._secondaryAnchor.modelPosition)}_setPosition(C,W,V){this._affinity=C,this._primaryAnchor=U(W,this._context.viewModel,this._affinity),this._secondaryAnchor=U(V,this._context.viewModel,this._affinity);function U(G,Z,X){if(!G)return new PositionPair(null,null);const Q=Z.model.validatePosition(G);if(Z.coordinatesConverter.modelPositionIsVisible(Q)){const J=Z.coordinatesConverter.convertModelPositionToViewPosition(Q,X??void 0);return new PositionPair(G,J)}return new PositionPair(G,null)}}_getMaxWidth(){const C=this.domNode.domNode.ownerDocument,W=C.defaultView;return this.allowEditorOverflow?(W==null?void 0:W.innerWidth)||C.documentElement.offsetWidth||C.body.offsetWidth:this._contentWidth}setPosition(C,W,V,U){this._setPosition(U,C,W),this._preference=V,this._primaryAnchor.viewPosition&&this._preference&&this._preference.length>0?this.domNode.setDisplay("block"):this.domNode.setDisplay("none"),this._cachedDomNodeOffsetWidth=-1,this._cachedDomNodeOffsetHeight=-1}_layoutBoxInViewport(C,W,V,U){const G=C.top,Z=G,X=C.top+C.height,Q=U.viewportHeight-X,J=G-V,ee=Z>=V,te=X,ie=Q>=V;let ne=C.left;return ne+W>U.scrollLeft+U.viewportWidth&&(ne=U.scrollLeft+U.viewportWidth-W),ne<U.scrollLeft&&(ne=U.scrollLeft),{fitsAbove:ee,aboveTop:J,fitsBelow:ie,belowTop:te,left:ne}}_layoutHorizontalSegmentInPage(C,W,V,U){var G;const Q=Math.max(15,W.left-U),J=Math.min(W.left+W.width+U,C.width-15),te=this._viewDomNode.domNode.ownerDocument.defaultView;let ie=W.left+V-((G=te==null?void 0:te.scrollX)!==null&&G!==void 0?G:0);if(ie+U>J){const ne=ie-(J-U);ie-=ne,V-=ne}if(ie<Q){const ne=ie-Q;ie-=ne,V-=ne}return[V,ie]}_layoutBoxInPage(C,W,V,U){var G,Z;const X=C.top-V,Q=C.top+C.height,J=getDomNodePagePosition(this._viewDomNode.domNode),ee=this._viewDomNode.domNode.ownerDocument,te=ee.defaultView,ie=J.top+X-((G=te==null?void 0:te.scrollY)!==null&&G!==void 0?G:0),ne=J.top+Q-((Z=te==null?void 0:te.scrollY)!==null&&Z!==void 0?Z:0),oe=getClientArea(ee.body),[re,ae]=this._layoutHorizontalSegmentInPage(oe,J,C.left-U.scrollLeft+this._contentLeft,W),se=22,le=22,ce=ie>=se,de=ne+V<=oe.height-le;return this._fixedOverflowWidgets?{fitsAbove:ce,aboveTop:Math.max(ie,se),fitsBelow:de,belowTop:ne,left:ae}:{fitsAbove:ce,aboveTop:X,fitsBelow:de,belowTop:Q,left:re}}_prepareRenderWidgetAtExactPositionOverflowing(C){return new Coordinate(C.top,C.left+this._contentLeft)}_getAnchorsCoordinates(C){var W,V;const U=X(this._primaryAnchor.viewPosition,this._affinity,this._lineHeight),G=((W=this._secondaryAnchor.viewPosition)===null||W===void 0?void 0:W.lineNumber)===((V=this._primaryAnchor.viewPosition)===null||V===void 0?void 0:V.lineNumber)?this._secondaryAnchor.viewPosition:null,Z=X(G,this._affinity,this._lineHeight);return{primary:U,secondary:Z};function X(Q,J,ee){if(!Q)return null;const te=C.visibleRangeForPosition(Q);if(!te)return null;const ie=Q.column===1&&J===3?0:te.left,ne=C.getVerticalOffsetForLineNumber(Q.lineNumber)-C.scrollTop;return new AnchorCoordinate(ne,ie,ee)}}_reduceAnchorCoordinates(C,W,V){if(!W)return C;const U=this._context.configuration.options.get(50);let G=W.left;return G<C.left?G=Math.max(G,C.left-V+U.typicalFullwidthCharacterWidth):G=Math.min(G,C.left+V-U.typicalFullwidthCharacterWidth),new AnchorCoordinate(C.top,G,C.height)}_prepareRenderWidget(C){if(!this._preference||this._preference.length===0)return null;const{primary:W,secondary:V}=this._getAnchorsCoordinates(C);if(!W)return null;if(this._cachedDomNodeOffsetWidth===-1||this._cachedDomNodeOffsetHeight===-1){let Z=null;if(typeof this._actual.beforeRender=="function"&&(Z=safeInvoke(this._actual.beforeRender,this._actual)),Z)this._cachedDomNodeOffsetWidth=Z.width,this._cachedDomNodeOffsetHeight=Z.height;else{const Q=this.domNode.domNode.getBoundingClientRect();this._cachedDomNodeOffsetWidth=Math.round(Q.width),this._cachedDomNodeOffsetHeight=Math.round(Q.height)}}const U=this._reduceAnchorCoordinates(W,V,this._cachedDomNodeOffsetWidth);let G;this.allowEditorOverflow?G=this._layoutBoxInPage(U,this._cachedDomNodeOffsetWidth,this._cachedDomNodeOffsetHeight,C):G=this._layoutBoxInViewport(U,this._cachedDomNodeOffsetWidth,this._cachedDomNodeOffsetHeight,C);for(let Z=1;Z<=2;Z++)for(const X of this._preference)if(X===1){if(!G)return null;if(Z===2||G.fitsAbove)return{coordinate:new Coordinate(G.aboveTop,G.left),position:1}}else if(X===2){if(!G)return null;if(Z===2||G.fitsBelow)return{coordinate:new Coordinate(G.belowTop,G.left),position:2}}else return this.allowEditorOverflow?{coordinate:this._prepareRenderWidgetAtExactPositionOverflowing(new Coordinate(U.top,U.left)),position:0}:{coordinate:new Coordinate(U.top,U.left),position:0};return null}onBeforeRender(C){!this._primaryAnchor.viewPosition||!this._preference||this._primaryAnchor.viewPosition.lineNumber<C.startLineNumber||this._primaryAnchor.viewPosition.lineNumber>C.endLineNumber||this.domNode.setMaxWidth(this._maxWidth)}prepareRender(C){this._renderData=this._prepareRenderWidget(C)}render(C){if(!this._renderData){this._isVisible&&(this.domNode.removeAttribute("monaco-visible-content-widget"),this._isVisible=!1,this.domNode.setVisibility("hidden")),typeof this._actual.afterRender=="function"&&safeInvoke(this._actual.afterRender,this._actual,null);return}this.allowEditorOverflow?(this.domNode.setTop(this._renderData.coordinate.top),this.domNode.setLeft(this._renderData.coordinate.left)):(this.domNode.setTop(this._renderData.coordinate.top+C.scrollTop-C.bigNumbersDelta),this.domNode.setLeft(this._renderData.coordinate.left)),this._isVisible||(this.domNode.setVisibility("inherit"),this.domNode.setAttribute("monaco-visible-content-widget","true"),this._isVisible=!0),typeof this._actual.afterRender=="function"&&safeInvoke(this._actual.afterRender,this._actual,this._renderData.position)}}class PositionPair{constructor(C,W){this.modelPosition=C,this.viewPosition=W}}class Coordinate{constructor(C,W){this.top=C,this.left=W,this._coordinateBrand=void 0}}class AnchorCoordinate{constructor(C,W,V){this.top=C,this.left=W,this.height=V,this._anchorCoordinateBrand=void 0}}function safeInvoke(K,C,...W){try{return K.call(C,...W)}catch{return null}}const currentLineHighlight="";class AbstractLineHighlightOverlay extends DynamicViewOverlay{constructor(C){super(),this._context=C;const W=this._context.configuration.options,V=W.get(143);this._lineHeight=W.get(66),this._renderLineHighlight=W.get(95),this._renderLineHighlightOnlyWhenFocus=W.get(96),this._contentLeft=V.contentLeft,this._contentWidth=V.contentWidth,this._selectionIsEmpty=!0,this._focused=!1,this._cursorLineNumbers=[1],this._selections=[new Selection$1(1,1,1,1)],this._renderData=null,this._context.addEventHandler(this)}dispose(){this._context.removeEventHandler(this),super.dispose()}_readFromSelections(){let C=!1;const W=this._selections.map(U=>U.positionLineNumber);W.sort((U,G)=>U-G),equals$5(this._cursorLineNumbers,W)||(this._cursorLineNumbers=W,C=!0);const V=this._selections.every(U=>U.isEmpty());return this._selectionIsEmpty!==V&&(this._selectionIsEmpty=V,C=!0),C}onThemeChanged(C){return this._readFromSelections()}onConfigurationChanged(C){const W=this._context.configuration.options,V=W.get(143);return this._lineHeight=W.get(66),this._renderLineHighlight=W.get(95),this._renderLineHighlightOnlyWhenFocus=W.get(96),this._contentLeft=V.contentLeft,this._contentWidth=V.contentWidth,!0}onCursorStateChanged(C){return this._selections=C.selections,this._readFromSelections()}onFlushed(C){return!0}onLinesDeleted(C){return!0}onLinesInserted(C){return!0}onScrollChanged(C){return C.scrollWidthChanged||C.scrollTopChanged}onZonesChanged(C){return!0}onFocusChanged(C){return this._renderLineHighlightOnlyWhenFocus?(this._focused=C.isFocused,!0):!1}prepareRender(C){if(!this._shouldRenderThis()){this._renderData=null;return}const W=this._renderOne(C),V=C.visibleRange.startLineNumber,U=C.visibleRange.endLineNumber,G=this._cursorLineNumbers.length;let Z=0;const X=[];for(let Q=V;Q<=U;Q++){const J=Q-V;for(;Z<G&&this._cursorLineNumbers[Z]<Q;)Z++;Z<G&&this._cursorLineNumbers[Z]===Q?X[J]=W:X[J]=""}this._renderData=X}render(C,W){if(!this._renderData)return"";const V=W-C;return V>=this._renderData.length?"":this._renderData[V]}_shouldRenderInMargin(){return(this._renderLineHighlight==="gutter"||this._renderLineHighlight==="all")&&(!this._renderLineHighlightOnlyWhenFocus||this._focused)}_shouldRenderInContent(){return(this._renderLineHighlight==="line"||this._renderLineHighlight==="all")&&this._selectionIsEmpty&&(!this._renderLineHighlightOnlyWhenFocus||this._focused)}}class CurrentLineHighlightOverlay extends AbstractLineHighlightOverlay{_renderOne(C){return`<div class="${"current-line"+(this._shouldRenderOther()?" current-line-both":"")}" style="width:${Math.max(C.scrollWidth,this._contentWidth)}px; height:${this._lineHeight}px;"></div>`}_shouldRenderThis(){return this._shouldRenderInContent()}_shouldRenderOther(){return this._shouldRenderInMargin()}}class CurrentLineMarginHighlightOverlay extends AbstractLineHighlightOverlay{_renderOne(C){return`<div class="${"current-line"+(this._shouldRenderInMargin()?" current-line-margin":"")+(this._shouldRenderOther()?" current-line-margin-both":"")}" style="width:${this._contentLeft}px; height:${this._lineHeight}px;"></div>`}_shouldRenderThis(){return!0}_shouldRenderOther(){return this._shouldRenderInContent()}}registerThemingParticipant((K,C)=>{const W=K.getColor(editorLineHighlight);if(W&&(C.addRule(`.monaco-editor .view-overlays .current-line { background-color: ${W}; }`),C.addRule(`.monaco-editor .margin-view-overlays .current-line-margin { background-color: ${W}; border: none; }`)),!W||W.isTransparent()||K.defines(editorLineHighlightBorder)){const V=K.getColor(editorLineHighlightBorder);V&&(C.addRule(`.monaco-editor .view-overlays .current-line { border: 2px solid ${V}; }`),C.addRule(`.monaco-editor .margin-view-overlays .current-line-margin { border: 2px solid ${V}; }`),isHighContrast(K.type)&&(C.addRule(".monaco-editor .view-overlays .current-line { border-width: 1px; }"),C.addRule(".monaco-editor .margin-view-overlays .current-line-margin { border-width: 1px; }")))}});const decorations="";class DecorationsOverlay extends DynamicViewOverlay{constructor(C){super(),this._context=C;const W=this._context.configuration.options;this._lineHeight=W.get(66),this._typicalHalfwidthCharacterWidth=W.get(50).typicalHalfwidthCharacterWidth,this._renderResult=null,this._context.addEventHandler(this)}dispose(){this._context.removeEventHandler(this),this._renderResult=null,super.dispose()}onConfigurationChanged(C){const W=this._context.configuration.options;return this._lineHeight=W.get(66),this._typicalHalfwidthCharacterWidth=W.get(50).typicalHalfwidthCharacterWidth,!0}onDecorationsChanged(C){return!0}onFlushed(C){return!0}onLinesChanged(C){return!0}onLinesDeleted(C){return!0}onLinesInserted(C){return!0}onScrollChanged(C){return C.scrollTopChanged||C.scrollWidthChanged}onZonesChanged(C){return!0}prepareRender(C){const W=C.getDecorationsInViewport();let V=[],U=0;for(let Q=0,J=W.length;Q<J;Q++){const ee=W[Q];ee.options.className&&(V[U++]=ee)}V=V.sort((Q,J)=>{if(Q.options.zIndex<J.options.zIndex)return-1;if(Q.options.zIndex>J.options.zIndex)return 1;const ee=Q.options.className,te=J.options.className;return ee<te?-1:ee>te?1:Range$2.compareRangesUsingStarts(Q.range,J.range)});const G=C.visibleRange.startLineNumber,Z=C.visibleRange.endLineNumber,X=[];for(let Q=G;Q<=Z;Q++){const J=Q-G;X[J]=""}this._renderWholeLineDecorations(C,V,X),this._renderNormalDecorations(C,V,X),this._renderResult=X}_renderWholeLineDecorations(C,W,V){const U=String(this._lineHeight),G=C.visibleRange.startLineNumber,Z=C.visibleRange.endLineNumber;for(let X=0,Q=W.length;X<Q;X++){const J=W[X];if(!J.options.isWholeLine)continue;const ee='<div class="cdr '+J.options.className+'" style="left:0;width:100%;height:'+U+'px;"></div>',te=Math.max(J.range.startLineNumber,G),ie=Math.min(J.range.endLineNumber,Z);for(let ne=te;ne<=ie;ne++){const oe=ne-G;V[oe]+=ee}}}_renderNormalDecorations(C,W,V){var U;const G=String(this._lineHeight),Z=C.visibleRange.startLineNumber;let X=null,Q=!1,J=null,ee=!1;for(let te=0,ie=W.length;te<ie;te++){const ne=W[te];if(ne.options.isWholeLine)continue;const oe=ne.options.className,re=!!ne.options.showIfCollapsed;let ae=ne.range;if(re&&ae.endColumn===1&&ae.endLineNumber!==ae.startLineNumber&&(ae=new Range$2(ae.startLineNumber,ae.startColumn,ae.endLineNumber-1,this._context.viewModel.getLineMaxColumn(ae.endLineNumber-1))),X===oe&&Q===re&&Range$2.areIntersectingOrTouching(J,ae)){J=Range$2.plusRange(J,ae);continue}X!==null&&this._renderNormalDecoration(C,J,X,ee,Q,G,Z,V),X=oe,Q=re,J=ae,ee=(U=ne.options.shouldFillLineOnLineBreak)!==null&&U!==void 0?U:!1}X!==null&&this._renderNormalDecoration(C,J,X,ee,Q,G,Z,V)}_renderNormalDecoration(C,W,V,U,G,Z,X,Q){const J=C.linesVisibleRangesForRange(W,V==="findMatch");if(J)for(let ee=0,te=J.length;ee<te;ee++){const ie=J[ee];if(ie.outsideRenderedLine)continue;const ne=ie.lineNumber-X;if(G&&ie.ranges.length===1){const oe=ie.ranges[0];if(oe.width<this._typicalHalfwidthCharacterWidth){const re=Math.round(oe.left+oe.width/2),ae=Math.max(0,Math.round(re-this._typicalHalfwidthCharacterWidth/2));ie.ranges[0]=new HorizontalRange(ae,this._typicalHalfwidthCharacterWidth)}}for(let oe=0,re=ie.ranges.length;oe<re;oe++){const ae=U&&ie.continuesOnNextLine&&re===1,se=ie.ranges[oe],le='<div class="cdr '+V+'" style="left:'+String(se.left)+(ae?"px;width:100%;height:":"px;width:"+String(se.width)+"px;height:")+Z+'px;"></div>';Q[ne]+=le}}}render(C,W){if(!this._renderResult)return"";const V=W-C;return V<0||V>=this._renderResult.length?"":this._renderResult[V]}}class EditorScrollbar extends ViewPart{constructor(C,W,V,U){super(C);const G=this._context.configuration.options,Z=G.get(102),X=G.get(74),Q=G.get(40),J=G.get(105),ee={listenOnDomNode:V.domNode,className:"editor-scrollable "+getThemeTypeSelector(C.theme.type),useShadows:!1,lazyRender:!0,vertical:Z.vertical,horizontal:Z.horizontal,verticalHasArrows:Z.verticalHasArrows,horizontalHasArrows:Z.horizontalHasArrows,verticalScrollbarSize:Z.verticalScrollbarSize,verticalSliderSize:Z.verticalSliderSize,horizontalScrollbarSize:Z.horizontalScrollbarSize,horizontalSliderSize:Z.horizontalSliderSize,handleMouseWheel:Z.handleMouseWheel,alwaysConsumeMouseWheel:Z.alwaysConsumeMouseWheel,arrowSize:Z.arrowSize,mouseWheelScrollSensitivity:X,fastScrollSensitivity:Q,scrollPredominantAxis:J,scrollByPage:Z.scrollByPage};this.scrollbar=this._register(new SmoothScrollableElement(W.domNode,ee,this._context.viewLayout.getScrollable())),PartFingerprints.write(this.scrollbar.getDomNode(),5),this.scrollbarDomNode=createFastDomNode(this.scrollbar.getDomNode()),this.scrollbarDomNode.setPosition("absolute"),this._setLayout();const te=(ie,ne,oe)=>{const re={};if(ne){const ae=ie.scrollTop;ae&&(re.scrollTop=this._context.viewLayout.getCurrentScrollTop()+ae,ie.scrollTop=0)}if(oe){const ae=ie.scrollLeft;ae&&(re.scrollLeft=this._context.viewLayout.getCurrentScrollLeft()+ae,ie.scrollLeft=0)}this._context.viewModel.viewLayout.setScrollPosition(re,1)};this._register(addDisposableListener(V.domNode,"scroll",ie=>te(V.domNode,!0,!0))),this._register(addDisposableListener(W.domNode,"scroll",ie=>te(W.domNode,!0,!1))),this._register(addDisposableListener(U.domNode,"scroll",ie=>te(U.domNode,!0,!1))),this._register(addDisposableListener(this.scrollbarDomNode.domNode,"scroll",ie=>te(this.scrollbarDomNode.domNode,!0,!1)))}dispose(){super.dispose()}_setLayout(){const C=this._context.configuration.options,W=C.get(143);this.scrollbarDomNode.setLeft(W.contentLeft),C.get(72).side==="right"?this.scrollbarDomNode.setWidth(W.contentWidth+W.minimap.minimapWidth):this.scrollbarDomNode.setWidth(W.contentWidth),this.scrollbarDomNode.setHeight(W.height)}getOverviewRulerLayoutInfo(){return this.scrollbar.getOverviewRulerLayoutInfo()}getDomNode(){return this.scrollbarDomNode}delegateVerticalScrollbarPointerDown(C){this.scrollbar.delegateVerticalScrollbarPointerDown(C)}delegateScrollFromMouseWheelEvent(C){this.scrollbar.delegateScrollFromMouseWheelEvent(C)}onConfigurationChanged(C){if(C.hasChanged(102)||C.hasChanged(74)||C.hasChanged(40)){const W=this._context.configuration.options,V=W.get(102),U=W.get(74),G=W.get(40),Z=W.get(105),X={vertical:V.vertical,horizontal:V.horizontal,verticalScrollbarSize:V.verticalScrollbarSize,horizontalScrollbarSize:V.horizontalScrollbarSize,scrollByPage:V.scrollByPage,handleMouseWheel:V.handleMouseWheel,mouseWheelScrollSensitivity:U,fastScrollSensitivity:G,scrollPredominantAxis:Z};this.scrollbar.updateOptions(X)}return C.hasChanged(143)&&this._setLayout(),!0}onScrollChanged(C){return!0}onThemeChanged(C){return this.scrollbar.updateClassName("editor-scrollable "+getThemeTypeSelector(this._context.theme.type)),!0}prepareRender(C){}render(C){this.scrollbar.renderNow()}}const indentGuides="";class TextModelPart extends Disposable{constructor(){super(...arguments),this._isDisposed=!1}dispose(){super.dispose(),this._isDisposed=!0}assertNotDisposed(){if(this._isDisposed)throw new Error("TextModelPart is disposed!")}}function computeIndentLevel(K,C){let W=0,V=0;const U=K.length;for(;V<U;){const G=K.charCodeAt(V);if(G===32)W++;else if(G===9)W=W-W%C+C;else break;V++}return V===U?-1:W}var HorizontalGuidesState;(function(K){K[K.Disabled=0]="Disabled",K[K.EnabledForActive=1]="EnabledForActive",K[K.Enabled=2]="Enabled"})(HorizontalGuidesState||(HorizontalGuidesState={}));class IndentGuide{constructor(C,W,V,U,G,Z){if(this.visibleColumn=C,this.column=W,this.className=V,this.horizontalLine=U,this.forWrappedLinesAfterColumn=G,this.forWrappedLinesBeforeOrAtColumn=Z,C!==-1==(W!==-1))throw new Error}}class IndentGuideHorizontalLine{constructor(C,W){this.top=C,this.endColumn=W}}class GuidesTextModelPart extends TextModelPart{constructor(C,W){super(),this.textModel=C,this.languageConfigurationService=W}getLanguageConfiguration(C){return this.languageConfigurationService.getLanguageConfiguration(C)}_computeIndentLevel(C){return computeIndentLevel(this.textModel.getLineContent(C+1),this.textModel.getOptions().tabSize)}getActiveIndentGuide(C,W,V){this.assertNotDisposed();const U=this.textModel.getLineCount();if(C<1||C>U)throw new BugIndicatingError("Illegal value for lineNumber");const G=this.getLanguageConfiguration(this.textModel.getLanguageId()).foldingRules,Z=!!(G&&G.offSide);let X=-2,Q=-1,J=-2,ee=-1;const te=he=>{if(X!==-1&&(X===-2||X>he-1)){X=-1,Q=-1;for(let fe=he-2;fe>=0;fe--){const pe=this._computeIndentLevel(fe);if(pe>=0){X=fe,Q=pe;break}}}if(J===-2){J=-1,ee=-1;for(let fe=he;fe<U;fe++){const pe=this._computeIndentLevel(fe);if(pe>=0){J=fe,ee=pe;break}}}};let ie=-2,ne=-1,oe=-2,re=-1;const ae=he=>{if(ie===-2){ie=-1,ne=-1;for(let fe=he-2;fe>=0;fe--){const pe=this._computeIndentLevel(fe);if(pe>=0){ie=fe,ne=pe;break}}}if(oe!==-1&&(oe===-2||oe<he-1)){oe=-1,re=-1;for(let fe=he;fe<U;fe++){const pe=this._computeIndentLevel(fe);if(pe>=0){oe=fe,re=pe;break}}}};let se=0,le=!0,ce=0,de=!0,ue=0,ge=0;for(let he=0;le||de;he++){const fe=C-he,pe=C+he;he>1&&(fe<1||fe<W)&&(le=!1),he>1&&(pe>U||pe>V)&&(de=!1),he>5e4&&(le=!1,de=!1);let Se=-1;if(le&&fe>=1){const be=this._computeIndentLevel(fe-1);be>=0?(J=fe-1,ee=be,Se=Math.ceil(be/this.textModel.getOptions().indentSize)):(te(fe),Se=this._getIndentLevelForWhitespaceLine(Z,Q,ee))}let Le=-1;if(de&&pe<=U){const be=this._computeIndentLevel(pe-1);be>=0?(ie=pe-1,ne=be,Le=Math.ceil(be/this.textModel.getOptions().indentSize)):(ae(pe),Le=this._getIndentLevelForWhitespaceLine(Z,ne,re))}if(he===0){ge=Se;continue}if(he===1){if(pe<=U&&Le>=0&&ge+1===Le){le=!1,se=pe,ce=pe,ue=Le;continue}if(fe>=1&&Se>=0&&Se-1===ge){de=!1,se=fe,ce=fe,ue=Se;continue}if(se=C,ce=C,ue=ge,ue===0)return{startLineNumber:se,endLineNumber:ce,indent:ue}}le&&(Se>=ue?se=fe:le=!1),de&&(Le>=ue?ce=pe:de=!1)}return{startLineNumber:se,endLineNumber:ce,indent:ue}}getLinesBracketGuides(C,W,V,U){var G;const Z=[];for(let ie=C;ie<=W;ie++)Z.push([]);const X=!0,Q=this.textModel.bracketPairs.getBracketPairsInRangeWithMinIndentation(new Range$2(C,1,W,this.textModel.getLineMaxColumn(W))).toArray();let J;if(V&&Q.length>0){const ie=(C<=V.lineNumber&&V.lineNumber<=W?Q:this.textModel.bracketPairs.getBracketPairsInRange(Range$2.fromPositions(V)).toArray()).filter(ne=>Range$2.strictContainsPosition(ne.range,V));J=(G=findLast$2(ie,ne=>X))===null||G===void 0?void 0:G.range}const ee=this.textModel.getOptions().bracketPairColorizationOptions.independentColorPoolPerBracketType,te=new BracketPairGuidesClassNames;for(const ie of Q){if(!ie.closingBracketRange)continue;const ne=J&&ie.range.equalsRange(J);if(!ne&&!U.includeInactive)continue;const oe=te.getInlineClassName(ie.nestingLevel,ie.nestingLevelOfEqualBracketType,ee)+(U.highlightActive&&ne?" "+te.activeClassName:""),re=ie.openingBracketRange.getStartPosition(),ae=ie.closingBracketRange.getStartPosition(),se=U.horizontalGuides===HorizontalGuidesState.Enabled||U.horizontalGuides===HorizontalGuidesState.EnabledForActive&&ne;if(ie.range.startLineNumber===ie.range.endLineNumber){se&&Z[ie.range.startLineNumber-C].push(new IndentGuide(-1,ie.openingBracketRange.getEndPosition().column,oe,new IndentGuideHorizontalLine(!1,ae.column),-1,-1));continue}const le=this.getVisibleColumnFromPosition(ae),ce=this.getVisibleColumnFromPosition(ie.openingBracketRange.getStartPosition()),de=Math.min(ce,le,ie.minVisibleColumnIndentation+1);let ue=!1;firstNonWhitespaceIndex(this.textModel.getLineContent(ie.closingBracketRange.startLineNumber))<ie.closingBracketRange.startColumn-1&&(ue=!0);const fe=Math.max(re.lineNumber,C),pe=Math.min(ae.lineNumber,W),Se=ue?1:0;for(let Le=fe;Le<pe+Se;Le++)Z[Le-C].push(new IndentGuide(de,-1,oe,null,Le===re.lineNumber?re.column:-1,Le===ae.lineNumber?ae.column:-1));se&&(re.lineNumber>=C&&ce>de&&Z[re.lineNumber-C].push(new IndentGuide(de,-1,oe,new IndentGuideHorizontalLine(!1,re.column),-1,-1)),ae.lineNumber<=W&&le>de&&Z[ae.lineNumber-C].push(new IndentGuide(de,-1,oe,new IndentGuideHorizontalLine(!ue,ae.column),-1,-1)))}for(const ie of Z)ie.sort((ne,oe)=>ne.visibleColumn-oe.visibleColumn);return Z}getVisibleColumnFromPosition(C){return CursorColumns.visibleColumnFromColumn(this.textModel.getLineContent(C.lineNumber),C.column,this.textModel.getOptions().tabSize)+1}getLinesIndentGuides(C,W){this.assertNotDisposed();const V=this.textModel.getLineCount();if(C<1||C>V)throw new Error("Illegal value for startLineNumber");if(W<1||W>V)throw new Error("Illegal value for endLineNumber");const U=this.textModel.getOptions(),G=this.getLanguageConfiguration(this.textModel.getLanguageId()).foldingRules,Z=!!(G&&G.offSide),X=new Array(W-C+1);let Q=-2,J=-1,ee=-2,te=-1;for(let ie=C;ie<=W;ie++){const ne=ie-C,oe=this._computeIndentLevel(ie-1);if(oe>=0){Q=ie-1,J=oe,X[ne]=Math.ceil(oe/U.indentSize);continue}if(Q===-2){Q=-1,J=-1;for(let re=ie-2;re>=0;re--){const ae=this._computeIndentLevel(re);if(ae>=0){Q=re,J=ae;break}}}if(ee!==-1&&(ee===-2||ee<ie-1)){ee=-1,te=-1;for(let re=ie;re<V;re++){const ae=this._computeIndentLevel(re);if(ae>=0){ee=re,te=ae;break}}}X[ne]=this._getIndentLevelForWhitespaceLine(Z,J,te)}return X}_getIndentLevelForWhitespaceLine(C,W,V){const U=this.textModel.getOptions();return W===-1||V===-1?0:W<V?1+Math.floor(W/U.indentSize):W===V||C?Math.ceil(V/U.indentSize):1+Math.floor(V/U.indentSize)}}class BracketPairGuidesClassNames{constructor(){this.activeClassName="indent-active"}getInlineClassName(C,W,V){return this.getInlineClassNameOfLevel(V?W:C)}getInlineClassNameOfLevel(C){return`bracket-indent-guide lvl-${C%30}`}}class IndentGuidesOverlay extends DynamicViewOverlay{constructor(C){super(),this._context=C,this._primaryPosition=null;const W=this._context.configuration.options,V=W.get(144),U=W.get(50);this._lineHeight=W.get(66),this._spaceWidth=U.spaceWidth,this._maxIndentLeft=V.wrappingColumn===-1?-1:V.wrappingColumn*U.typicalHalfwidthCharacterWidth,this._bracketPairGuideOptions=W.get(16),this._renderResult=null,this._context.addEventHandler(this)}dispose(){this._context.removeEventHandler(this),this._renderResult=null,super.dispose()}onConfigurationChanged(C){const W=this._context.configuration.options,V=W.get(144),U=W.get(50);return this._lineHeight=W.get(66),this._spaceWidth=U.spaceWidth,this._maxIndentLeft=V.wrappingColumn===-1?-1:V.wrappingColumn*U.typicalHalfwidthCharacterWidth,this._bracketPairGuideOptions=W.get(16),!0}onCursorStateChanged(C){var W;const U=C.selections[0].getPosition();return!((W=this._primaryPosition)===null||W===void 0)&&W.equals(U)?!1:(this._primaryPosition=U,!0)}onDecorationsChanged(C){return!0}onFlushed(C){return!0}onLinesChanged(C){return!0}onLinesDeleted(C){return!0}onLinesInserted(C){return!0}onScrollChanged(C){return C.scrollTopChanged}onZonesChanged(C){return!0}onLanguageConfigurationChanged(C){return!0}prepareRender(C){var W,V,U,G;if(!this._bracketPairGuideOptions.indentation&&this._bracketPairGuideOptions.bracketPairs===!1){this._renderResult=null;return}const Z=C.visibleRange.startLineNumber,X=C.visibleRange.endLineNumber,Q=C.scrollWidth,J=this._lineHeight,ee=this._primaryPosition,te=this.getGuidesByLine(Z,Math.min(X+1,this._context.viewModel.getLineCount()),ee),ie=[];for(let ne=Z;ne<=X;ne++){const oe=ne-Z,re=te[oe];let ae="";const se=(V=(W=C.visibleRangeForPosition(new Position$1(ne,1)))===null||W===void 0?void 0:W.left)!==null&&V!==void 0?V:0;for(const le of re){const ce=le.column===-1?se+(le.visibleColumn-1)*this._spaceWidth:C.visibleRangeForPosition(new Position$1(ne,le.column)).left;if(ce>Q||this._maxIndentLeft>0&&ce>this._maxIndentLeft)break;const de=le.horizontalLine?le.horizontalLine.top?"horizontal-top":"horizontal-bottom":"vertical",ue=le.horizontalLine?((G=(U=C.visibleRangeForPosition(new Position$1(ne,le.horizontalLine.endColumn)))===null||U===void 0?void 0:U.left)!==null&&G!==void 0?G:ce+this._spaceWidth)-ce:this._spaceWidth;ae+=`<div class="core-guide ${le.className} ${de}" style="left:${ce}px;height:${J}px;width:${ue}px"></div>`}ie[oe]=ae}this._renderResult=ie}getGuidesByLine(C,W,V){const U=this._bracketPairGuideOptions.bracketPairs!==!1?this._context.viewModel.getBracketGuidesInRangeByLine(C,W,V,{highlightActive:this._bracketPairGuideOptions.highlightActiveBracketPair,horizontalGuides:this._bracketPairGuideOptions.bracketPairsHorizontal===!0?HorizontalGuidesState.Enabled:this._bracketPairGuideOptions.bracketPairsHorizontal==="active"?HorizontalGuidesState.EnabledForActive:HorizontalGuidesState.Disabled,includeInactive:this._bracketPairGuideOptions.bracketPairs===!0}):null,G=this._bracketPairGuideOptions.indentation?this._context.viewModel.getLinesIndentGuides(C,W):null;let Z=0,X=0,Q=0;if(this._bracketPairGuideOptions.highlightActiveIndentation!==!1&&V){const te=this._context.viewModel.getActiveIndentGuide(V.lineNumber,C,W);Z=te.startLineNumber,X=te.endLineNumber,Q=te.indent}const{indentSize:J}=this._context.viewModel.model.getOptions(),ee=[];for(let te=C;te<=W;te++){const ie=new Array;ee.push(ie);const ne=U?U[te-C]:[],oe=new ArrayQueue(ne),re=G?G[te-C]:0;for(let ae=1;ae<=re;ae++){const se=(ae-1)*J+1,le=(this._bracketPairGuideOptions.highlightActiveIndentation==="always"||ne.length===0)&&Z<=te&&te<=X&&ae===Q;ie.push(...oe.takeWhile(de=>de.visibleColumn<se)||[]);const ce=oe.peek();(!ce||ce.visibleColumn!==se||ce.horizontalLine)&&ie.push(new IndentGuide(se,-1,`core-guide-indent lvl-${(ae-1)%30}`+(le?" indent-active":""),null,-1,-1))}ie.push(...oe.takeWhile(ae=>!0)||[])}return ee}render(C,W){if(!this._renderResult)return"";const V=W-C;return V<0||V>=this._renderResult.length?"":this._renderResult[V]}}function transparentToUndefined(K){if(!(K&&K.isTransparent()))return K}registerThemingParticipant((K,C)=>{const W=[{bracketColor:editorBracketHighlightingForeground1,guideColor:editorBracketPairGuideBackground1,guideColorActive:editorBracketPairGuideActiveBackground1},{bracketColor:editorBracketHighlightingForeground2,guideColor:editorBracketPairGuideBackground2,guideColorActive:editorBracketPairGuideActiveBackground2},{bracketColor:editorBracketHighlightingForeground3,guideColor:editorBracketPairGuideBackground3,guideColorActive:editorBracketPairGuideActiveBackground3},{bracketColor:editorBracketHighlightingForeground4,guideColor:editorBracketPairGuideBackground4,guideColorActive:editorBracketPairGuideActiveBackground4},{bracketColor:editorBracketHighlightingForeground5,guideColor:editorBracketPairGuideBackground5,guideColorActive:editorBracketPairGuideActiveBackground5},{bracketColor:editorBracketHighlightingForeground6,guideColor:editorBracketPairGuideBackground6,guideColorActive:editorBracketPairGuideActiveBackground6}],V=new BracketPairGuidesClassNames,U=[{indentColor:editorIndentGuide1,indentColorActive:editorActiveIndentGuide1},{indentColor:editorIndentGuide2,indentColorActive:editorActiveIndentGuide2},{indentColor:editorIndentGuide3,indentColorActive:editorActiveIndentGuide3},{indentColor:editorIndentGuide4,indentColorActive:editorActiveIndentGuide4},{indentColor:editorIndentGuide5,indentColorActive:editorActiveIndentGuide5},{indentColor:editorIndentGuide6,indentColorActive:editorActiveIndentGuide6}],G=W.map(X=>{var Q,J;const ee=K.getColor(X.bracketColor),te=K.getColor(X.guideColor),ie=K.getColor(X.guideColorActive),ne=transparentToUndefined((Q=transparentToUndefined(te))!==null&&Q!==void 0?Q:ee==null?void 0:ee.transparent(.3)),oe=transparentToUndefined((J=transparentToUndefined(ie))!==null&&J!==void 0?J:ee);if(!(!ne||!oe))return{guideColor:ne,guideColorActive:oe}}).filter(isDefined),Z=U.map(X=>{const Q=K.getColor(X.indentColor),J=K.getColor(X.indentColorActive),ee=transparentToUndefined(Q),te=transparentToUndefined(J);if(!(!ee||!te))return{indentColor:ee,indentColorActive:te}}).filter(isDefined);if(G.length>0){for(let X=0;X<30;X++){const Q=G[X%G.length];C.addRule(`.monaco-editor .${V.getInlineClassNameOfLevel(X).replace(/ /g,".")} { --guide-color: ${Q.guideColor}; --guide-color-active: ${Q.guideColorActive}; }`)}C.addRule(".monaco-editor .vertical { box-shadow: 1px 0 0 0 var(--guide-color) inset; }"),C.addRule(".monaco-editor .horizontal-top { border-top: 1px solid var(--guide-color); }"),C.addRule(".monaco-editor .horizontal-bottom { border-bottom: 1px solid var(--guide-color); }"),C.addRule(`.monaco-editor .vertical.${V.activeClassName} { box-shadow: 1px 0 0 0 var(--guide-color-active) inset; }`),C.addRule(`.monaco-editor .horizontal-top.${V.activeClassName} { border-top: 1px solid var(--guide-color-active); }`),C.addRule(`.monaco-editor .horizontal-bottom.${V.activeClassName} { border-bottom: 1px solid var(--guide-color-active); }`)}if(Z.length>0){for(let X=0;X<30;X++){const Q=Z[X%Z.length];C.addRule(`.monaco-editor .lines-content .core-guide-indent.lvl-${X} { --indent-color: ${Q.indentColor}; --indent-color-active: ${Q.indentColorActive}; }`)}C.addRule(".monaco-editor .lines-content .core-guide-indent { box-shadow: 1px 0 0 0 var(--indent-color) inset; }"),C.addRule(".monaco-editor .lines-content .core-guide-indent.indent-active { box-shadow: 1px 0 0 0 var(--indent-color-active) inset; }")}});const viewLines="";class DomReadingContext{get didDomLayout(){return this._didDomLayout}readClientRect(){if(!this._clientRectRead){this._clientRectRead=!0;const C=this._domNode.getBoundingClientRect();this.markDidDomLayout(),this._clientRectDeltaLeft=C.left,this._clientRectScale=C.width/this._domNode.offsetWidth}}get clientRectDeltaLeft(){return this._clientRectRead||this.readClientRect(),this._clientRectDeltaLeft}get clientRectScale(){return this._clientRectRead||this.readClientRect(),this._clientRectScale}constructor(C,W){this._domNode=C,this.endNode=W,this._didDomLayout=!1,this._clientRectDeltaLeft=0,this._clientRectScale=1,this._clientRectRead=!1}markDidDomLayout(){this._didDomLayout=!0}}class LastRenderedData{constructor(){this._currentVisibleRange=new Range$2(1,1,1,1)}getCurrentVisibleRange(){return this._currentVisibleRange}setCurrentVisibleRange(C){this._currentVisibleRange=C}}class HorizontalRevealRangeRequest{constructor(C,W,V,U,G,Z,X){this.minimalReveal=C,this.lineNumber=W,this.startColumn=V,this.endColumn=U,this.startScrollTop=G,this.stopScrollTop=Z,this.scrollType=X,this.type="range",this.minLineNumber=W,this.maxLineNumber=W}}class HorizontalRevealSelectionsRequest{constructor(C,W,V,U,G){this.minimalReveal=C,this.selections=W,this.startScrollTop=V,this.stopScrollTop=U,this.scrollType=G,this.type="selections";let Z=W[0].startLineNumber,X=W[0].endLineNumber;for(let Q=1,J=W.length;Q<J;Q++){const ee=W[Q];Z=Math.min(Z,ee.startLineNumber),X=Math.max(X,ee.endLineNumber)}this.minLineNumber=Z,this.maxLineNumber=X}}class ViewLines extends ViewPart{constructor(C,W){super(C),this._linesContent=W,this._textRangeRestingSpot=document.createElement("div"),this._visibleLines=new VisibleLinesCollection(this),this.domNode=this._visibleLines.domNode;const V=this._context.configuration,U=this._context.configuration.options,G=U.get(50),Z=U.get(144);this._lineHeight=U.get(66),this._typicalHalfwidthCharacterWidth=G.typicalHalfwidthCharacterWidth,this._isViewportWrapping=Z.isViewportWrapping,this._revealHorizontalRightPadding=U.get(99),this._cursorSurroundingLines=U.get(29),this._cursorSurroundingLinesStyle=U.get(30),this._canUseLayerHinting=!U.get(32),this._viewLineOptions=new ViewLineOptions(V,this._context.theme.type),PartFingerprints.write(this.domNode,7),this.domNode.setClassName(`view-lines ${MOUSE_CURSOR_TEXT_CSS_CLASS_NAME}`),applyFontInfo(this.domNode,G),this._maxLineWidth=0,this._asyncUpdateLineWidths=new RunOnceScheduler(()=>{this._updateLineWidthsSlow()},200),this._asyncCheckMonospaceFontAssumptions=new RunOnceScheduler(()=>{this._checkMonospaceFontAssumptions()},2e3),this._lastRenderedData=new LastRenderedData,this._horizontalRevealRequest=null,this._stickyScrollEnabled=U.get(114).enabled,this._maxNumberStickyLines=U.get(114).maxLineCount}dispose(){this._asyncUpdateLineWidths.dispose(),this._asyncCheckMonospaceFontAssumptions.dispose(),super.dispose()}getDomNode(){return this.domNode}createVisibleLine(){return new ViewLine(this._viewLineOptions)}onConfigurationChanged(C){this._visibleLines.onConfigurationChanged(C),C.hasChanged(144)&&(this._maxLineWidth=0);const W=this._context.configuration.options,V=W.get(50),U=W.get(144);return this._lineHeight=W.get(66),this._typicalHalfwidthCharacterWidth=V.typicalHalfwidthCharacterWidth,this._isViewportWrapping=U.isViewportWrapping,this._revealHorizontalRightPadding=W.get(99),this._cursorSurroundingLines=W.get(29),this._cursorSurroundingLinesStyle=W.get(30),this._canUseLayerHinting=!W.get(32),this._stickyScrollEnabled=W.get(114).enabled,this._maxNumberStickyLines=W.get(114).maxLineCount,applyFontInfo(this.domNode,V),this._onOptionsMaybeChanged(),C.hasChanged(143)&&(this._maxLineWidth=0),!0}_onOptionsMaybeChanged(){const C=this._context.configuration,W=new ViewLineOptions(C,this._context.theme.type);if(!this._viewLineOptions.equals(W)){this._viewLineOptions=W;const V=this._visibleLines.getStartLineNumber(),U=this._visibleLines.getEndLineNumber();for(let G=V;G<=U;G++)this._visibleLines.getVisibleLine(G).onOptionsChanged(this._viewLineOptions);return!0}return!1}onCursorStateChanged(C){const W=this._visibleLines.getStartLineNumber(),V=this._visibleLines.getEndLineNumber();let U=!1;for(let G=W;G<=V;G++)U=this._visibleLines.getVisibleLine(G).onSelectionChanged()||U;return U}onDecorationsChanged(C){{const W=this._visibleLines.getStartLineNumber(),V=this._visibleLines.getEndLineNumber();for(let U=W;U<=V;U++)this._visibleLines.getVisibleLine(U).onDecorationsChanged()}return!0}onFlushed(C){const W=this._visibleLines.onFlushed(C);return this._maxLineWidth=0,W}onLinesChanged(C){return this._visibleLines.onLinesChanged(C)}onLinesDeleted(C){return this._visibleLines.onLinesDeleted(C)}onLinesInserted(C){return this._visibleLines.onLinesInserted(C)}onRevealRangeRequest(C){const W=this._computeScrollTopToRevealRange(this._context.viewLayout.getFutureViewport(),C.source,C.minimalReveal,C.range,C.selections,C.verticalType);if(W===-1)return!1;let V=this._context.viewLayout.validateScrollPosition({scrollTop:W});C.revealHorizontal?C.range&&C.range.startLineNumber!==C.range.endLineNumber?V={scrollTop:V.scrollTop,scrollLeft:0}:C.range?this._horizontalRevealRequest=new HorizontalRevealRangeRequest(C.minimalReveal,C.range.startLineNumber,C.range.startColumn,C.range.endColumn,this._context.viewLayout.getCurrentScrollTop(),V.scrollTop,C.scrollType):C.selections&&C.selections.length>0&&(this._horizontalRevealRequest=new HorizontalRevealSelectionsRequest(C.minimalReveal,C.selections,this._context.viewLayout.getCurrentScrollTop(),V.scrollTop,C.scrollType)):this._horizontalRevealRequest=null;const G=Math.abs(this._context.viewLayout.getCurrentScrollTop()-V.scrollTop)<=this._lineHeight?1:C.scrollType;return this._context.viewModel.viewLayout.setScrollPosition(V,G),!0}onScrollChanged(C){if(this._horizontalRevealRequest&&C.scrollLeftChanged&&(this._horizontalRevealRequest=null),this._horizontalRevealRequest&&C.scrollTopChanged){const W=Math.min(this._horizontalRevealRequest.startScrollTop,this._horizontalRevealRequest.stopScrollTop),V=Math.max(this._horizontalRevealRequest.startScrollTop,this._horizontalRevealRequest.stopScrollTop);(C.scrollTop<W||C.scrollTop>V)&&(this._horizontalRevealRequest=null)}return this.domNode.setWidth(C.scrollWidth),this._visibleLines.onScrollChanged(C)||!0}onTokensChanged(C){return this._visibleLines.onTokensChanged(C)}onZonesChanged(C){return this._context.viewModel.viewLayout.setMaxLineWidth(this._maxLineWidth),this._visibleLines.onZonesChanged(C)}onThemeChanged(C){return this._onOptionsMaybeChanged()}getPositionFromDOMInfo(C,W){const V=this._getViewLineDomNode(C);if(V===null)return null;const U=this._getLineNumberFor(V);if(U===-1||U<1||U>this._context.viewModel.getLineCount())return null;if(this._context.viewModel.getLineMaxColumn(U)===1)return new Position$1(U,1);const G=this._visibleLines.getStartLineNumber(),Z=this._visibleLines.getEndLineNumber();if(U<G||U>Z)return null;let X=this._visibleLines.getVisibleLine(U).getColumnOfNodeOffset(C,W);const Q=this._context.viewModel.getLineMinColumn(U);return X<Q&&(X=Q),new Position$1(U,X)}_getViewLineDomNode(C){for(;C&&C.nodeType===1;){if(C.className===ViewLine.CLASS_NAME)return C;C=C.parentElement}return null}_getLineNumberFor(C){const W=this._visibleLines.getStartLineNumber(),V=this._visibleLines.getEndLineNumber();for(let U=W;U<=V;U++){const G=this._visibleLines.getVisibleLine(U);if(C===G.getDomNode())return U}return-1}getLineWidth(C){const W=this._visibleLines.getStartLineNumber(),V=this._visibleLines.getEndLineNumber();if(C<W||C>V)return-1;const U=new DomReadingContext(this.domNode.domNode,this._textRangeRestingSpot),G=this._visibleLines.getVisibleLine(C).getWidth(U);return this._updateLineWidthsSlowIfDomDidLayout(U),G}linesVisibleRangesForRange(C,W){if(this.shouldRender())return null;const V=C.endLineNumber,U=Range$2.intersectRanges(C,this._lastRenderedData.getCurrentVisibleRange());if(!U)return null;const G=[];let Z=0;const X=new DomReadingContext(this.domNode.domNode,this._textRangeRestingSpot);let Q=0;W&&(Q=this._context.viewModel.coordinatesConverter.convertViewPositionToModelPosition(new Position$1(U.startLineNumber,1)).lineNumber);const J=this._visibleLines.getStartLineNumber(),ee=this._visibleLines.getEndLineNumber();for(let te=U.startLineNumber;te<=U.endLineNumber;te++){if(te<J||te>ee)continue;const ie=te===U.startLineNumber?U.startColumn:1,ne=te!==U.endLineNumber,oe=ne?this._context.viewModel.getLineMaxColumn(te):U.endColumn,re=this._visibleLines.getVisibleLine(te).getVisibleRangesForRange(te,ie,oe,X);if(re){if(W&&te<V){const ae=Q;Q=this._context.viewModel.coordinatesConverter.convertViewPositionToModelPosition(new Position$1(te+1,1)).lineNumber,ae!==Q&&(re.ranges[re.ranges.length-1].width+=this._typicalHalfwidthCharacterWidth)}G[Z++]=new LineVisibleRanges(re.outsideRenderedLine,te,HorizontalRange.from(re.ranges),ne)}}return this._updateLineWidthsSlowIfDomDidLayout(X),Z===0?null:G}_visibleRangesForLineRange(C,W,V){if(this.shouldRender()||C<this._visibleLines.getStartLineNumber()||C>this._visibleLines.getEndLineNumber())return null;const U=new DomReadingContext(this.domNode.domNode,this._textRangeRestingSpot),G=this._visibleLines.getVisibleLine(C).getVisibleRangesForRange(C,W,V,U);return this._updateLineWidthsSlowIfDomDidLayout(U),G}visibleRangeForPosition(C){const W=this._visibleRangesForLineRange(C.lineNumber,C.column,C.column);return W?new HorizontalPosition(W.outsideRenderedLine,W.ranges[0].left):null}_updateLineWidthsFast(){return this._updateLineWidths(!0)}_updateLineWidthsSlow(){this._updateLineWidths(!1)}_updateLineWidthsSlowIfDomDidLayout(C){C.didDomLayout&&(this._asyncUpdateLineWidths.isScheduled()||(this._asyncUpdateLineWidths.cancel(),this._updateLineWidthsSlow()))}_updateLineWidths(C){const W=this._visibleLines.getStartLineNumber(),V=this._visibleLines.getEndLineNumber();let U=1,G=!0;for(let Z=W;Z<=V;Z++){const X=this._visibleLines.getVisibleLine(Z);if(C&&!X.getWidthIsFast()){G=!1;continue}U=Math.max(U,X.getWidth(null))}return G&&W===1&&V===this._context.viewModel.getLineCount()&&(this._maxLineWidth=0),this._ensureMaxLineWidth(U),G}_checkMonospaceFontAssumptions(){let C=-1,W=-1;const V=this._visibleLines.getStartLineNumber(),U=this._visibleLines.getEndLineNumber();for(let G=V;G<=U;G++){const Z=this._visibleLines.getVisibleLine(G);if(Z.needsMonospaceFontCheck()){const X=Z.getWidth(null);X>W&&(W=X,C=G)}}if(C!==-1&&!this._visibleLines.getVisibleLine(C).monospaceAssumptionsAreValid())for(let G=V;G<=U;G++)this._visibleLines.getVisibleLine(G).onMonospaceAssumptionsInvalidated()}prepareRender(){throw new Error("Not supported")}render(){throw new Error("Not supported")}renderText(C){if(this._visibleLines.renderLines(C),this._lastRenderedData.setCurrentVisibleRange(C.visibleRange),this.domNode.setWidth(this._context.viewLayout.getScrollWidth()),this.domNode.setHeight(Math.min(this._context.viewLayout.getScrollHeight(),1e6)),this._horizontalRevealRequest){const V=this._horizontalRevealRequest;if(C.startLineNumber<=V.minLineNumber&&V.maxLineNumber<=C.endLineNumber){this._horizontalRevealRequest=null,this.onDidRender();const U=this._computeScrollLeftToReveal(V);U&&(this._isViewportWrapping||this._ensureMaxLineWidth(U.maxHorizontalOffset),this._context.viewModel.viewLayout.setScrollPosition({scrollLeft:U.scrollLeft},V.scrollType))}}if(this._updateLineWidthsFast()?this._asyncUpdateLineWidths.cancel():this._asyncUpdateLineWidths.schedule(),isLinux&&!this._asyncCheckMonospaceFontAssumptions.isScheduled()){const V=this._visibleLines.getStartLineNumber(),U=this._visibleLines.getEndLineNumber();for(let G=V;G<=U;G++)if(this._visibleLines.getVisibleLine(G).needsMonospaceFontCheck()){this._asyncCheckMonospaceFontAssumptions.schedule();break}}this._linesContent.setLayerHinting(this._canUseLayerHinting),this._linesContent.setContain("strict");const W=this._context.viewLayout.getCurrentScrollTop()-C.bigNumbersDelta;this._linesContent.setTop(-W),this._linesContent.setLeft(-this._context.viewLayout.getCurrentScrollLeft())}_ensureMaxLineWidth(C){const W=Math.ceil(C);this._maxLineWidth<W&&(this._maxLineWidth=W,this._context.viewModel.viewLayout.setMaxLineWidth(this._maxLineWidth))}_computeScrollTopToRevealRange(C,W,V,U,G,Z){const X=C.top,Q=C.height,J=X+Q;let ee,te,ie;if(G&&G.length>0){let se=G[0].startLineNumber,le=G[0].endLineNumber;for(let ce=1,de=G.length;ce<de;ce++){const ue=G[ce];se=Math.min(se,ue.startLineNumber),le=Math.max(le,ue.endLineNumber)}ee=!1,te=this._context.viewLayout.getVerticalOffsetForLineNumber(se),ie=this._context.viewLayout.getVerticalOffsetForLineNumber(le)+this._lineHeight}else if(U)ee=!0,te=this._context.viewLayout.getVerticalOffsetForLineNumber(U.startLineNumber),ie=this._context.viewLayout.getVerticalOffsetForLineNumber(U.endLineNumber)+this._lineHeight;else return-1;const ne=(W==="mouse"||V)&&this._cursorSurroundingLinesStyle==="default";let oe=0,re=0;if(ne)V||(oe=this._lineHeight);else{const se=Math.min(Q/this._lineHeight/2,this._cursorSurroundingLines);this._stickyScrollEnabled?oe=Math.max(se,this._maxNumberStickyLines)*this._lineHeight:oe=se*this._lineHeight,re=Math.max(0,se-1)*this._lineHeight}V||(Z===0||Z===4)&&(re+=this._lineHeight),te-=oe,ie+=re;let ae;if(ie-te>Q){if(!ee)return-1;ae=te}else if(Z===5||Z===6)if(Z===6&&X<=te&&ie<=J)ae=X;else{const se=Math.max(5*this._lineHeight,Q*.2),le=te-se,ce=ie-Q;ae=Math.max(ce,le)}else if(Z===1||Z===2)if(Z===2&&X<=te&&ie<=J)ae=X;else{const se=(te+ie)/2;ae=Math.max(0,se-Q/2)}else ae=this._computeMinimumScrolling(X,J,te,ie,Z===3,Z===4);return ae}_computeScrollLeftToReveal(C){const W=this._context.viewLayout.getCurrentViewport(),V=this._context.configuration.options.get(143),U=W.left,G=U+W.width-V.verticalScrollbarWidth;let Z=1073741824,X=0;if(C.type==="range"){const J=this._visibleRangesForLineRange(C.lineNumber,C.startColumn,C.endColumn);if(!J)return null;for(const ee of J.ranges)Z=Math.min(Z,Math.round(ee.left)),X=Math.max(X,Math.round(ee.left+ee.width))}else for(const J of C.selections){if(J.startLineNumber!==J.endLineNumber)return null;const ee=this._visibleRangesForLineRange(J.startLineNumber,J.startColumn,J.endColumn);if(!ee)return null;for(const te of ee.ranges)Z=Math.min(Z,Math.round(te.left)),X=Math.max(X,Math.round(te.left+te.width))}return C.minimalReveal||(Z=Math.max(0,Z-ViewLines.HORIZONTAL_EXTRA_PX),X+=this._revealHorizontalRightPadding),C.type==="selections"&&X-Z>W.width?null:{scrollLeft:this._computeMinimumScrolling(U,G,Z,X),maxHorizontalOffset:X}}_computeMinimumScrolling(C,W,V,U,G,Z){C=C|0,W=W|0,V=V|0,U=U|0,G=!!G,Z=!!Z;const X=W-C;if(U-V<X){if(G)return V;if(Z)return Math.max(0,U-X);if(V<C)return V;if(U>W)return Math.max(0,U-X)}else return V;return C}}ViewLines.HORIZONTAL_EXTRA_PX=30;const linesDecorations="",glyphMargin="";class DecorationToRender{constructor(C,W,V,U){this._decorationToRenderBrand=void 0,this.startLineNumber=+C,this.endLineNumber=+W,this.className=String(V),this.zIndex=U??0}}class LineDecorationToRender{constructor(C,W){this.className=C,this.zIndex=W}}class VisibleLineDecorationsToRender{constructor(){this.decorations=[]}add(C){this.decorations.push(C)}getDecorations(){return this.decorations}}class DedupOverlay extends DynamicViewOverlay{_render(C,W,V){const U=[];for(let X=C;X<=W;X++){const Q=X-C;U[Q]=new VisibleLineDecorationsToRender}if(V.length===0)return U;V.sort((X,Q)=>X.className===Q.className?X.startLineNumber===Q.startLineNumber?X.endLineNumber-Q.endLineNumber:X.startLineNumber-Q.startLineNumber:X.className<Q.className?-1:1);let G=null,Z=0;for(let X=0,Q=V.length;X<Q;X++){const J=V[X],ee=J.className,te=J.zIndex;let ie=Math.max(J.startLineNumber,C)-C;const ne=Math.min(J.endLineNumber,W)-C;G===ee?(ie=Math.max(Z+1,ie),Z=Math.max(Z,ne)):(G=ee,Z=ne);for(let oe=ie;oe<=Z;oe++)U[oe].add(new LineDecorationToRender(ee,te))}return U}}class GlyphMarginWidgets extends ViewPart{constructor(C){super(C),this._widgets={},this._context=C;const W=this._context.configuration.options,V=W.get(143);this.domNode=createFastDomNode(document.createElement("div")),this.domNode.setClassName("glyph-margin-widgets"),this.domNode.setPosition("absolute"),this.domNode.setTop(0),this._lineHeight=W.get(66),this._glyphMargin=W.get(57),this._glyphMarginLeft=V.glyphMarginLeft,this._glyphMarginWidth=V.glyphMarginWidth,this._glyphMarginDecorationLaneCount=V.glyphMarginDecorationLaneCount,this._managedDomNodes=[],this._decorationGlyphsToRender=[]}dispose(){this._managedDomNodes=[],this._decorationGlyphsToRender=[],this._widgets={},super.dispose()}getWidgets(){return Object.values(this._widgets)}onConfigurationChanged(C){const W=this._context.configuration.options,V=W.get(143);return this._lineHeight=W.get(66),this._glyphMargin=W.get(57),this._glyphMarginLeft=V.glyphMarginLeft,this._glyphMarginWidth=V.glyphMarginWidth,this._glyphMarginDecorationLaneCount=V.glyphMarginDecorationLaneCount,!0}onDecorationsChanged(C){return!0}onFlushed(C){return!0}onLinesChanged(C){return!0}onLinesDeleted(C){return!0}onLinesInserted(C){return!0}onScrollChanged(C){return C.scrollTopChanged}onZonesChanged(C){return!0}addWidget(C){const W=createFastDomNode(C.getDomNode());this._widgets[C.getId()]={widget:C,preference:C.getPosition(),domNode:W,renderInfo:null},W.setPosition("absolute"),W.setDisplay("none"),W.setAttribute("widgetId",C.getId()),this.domNode.appendChild(W),this.setShouldRender()}setWidgetPosition(C,W){const V=this._widgets[C.getId()];return V.preference.lane===W.lane&&V.preference.zIndex===W.zIndex&&Range$2.equalsRange(V.preference.range,W.range)?!1:(V.preference=W,this.setShouldRender(),!0)}removeWidget(C){var W;const V=C.getId();if(this._widgets[V]){const G=this._widgets[V].domNode.domNode;delete this._widgets[V],(W=G.parentNode)===null||W===void 0||W.removeChild(G),this.setShouldRender()}}_collectDecorationBasedGlyphRenderRequest(C,W){var V,U,G;const Z=C.visibleRange.startLineNumber,X=C.visibleRange.endLineNumber,Q=C.getDecorationsInViewport();for(const J of Q){const ee=J.options.glyphMarginClassName;if(!ee)continue;const te=Math.max(J.range.startLineNumber,Z),ie=Math.min(J.range.endLineNumber,X),ne=Math.min((U=(V=J.options.glyphMargin)===null||V===void 0?void 0:V.position)!==null&&U!==void 0?U:1,this._glyphMarginDecorationLaneCount),oe=(G=J.options.zIndex)!==null&&G!==void 0?G:0;for(let re=te;re<=ie;re++)W.push(new DecorationBasedGlyphRenderRequest(re,ne,oe,ee))}}_collectWidgetBasedGlyphRenderRequest(C,W){const V=C.visibleRange.startLineNumber,U=C.visibleRange.endLineNumber;for(const G of Object.values(this._widgets)){const Z=G.preference.range;if(Z.endLineNumber<V||Z.startLineNumber>U)continue;const X=Math.max(Z.startLineNumber,V),Q=Math.min(G.preference.lane,this._glyphMarginDecorationLaneCount);W.push(new WidgetBasedGlyphRenderRequest(X,Q,G.preference.zIndex,G))}}_collectSortedGlyphRenderRequests(C){const W=[];return this._collectDecorationBasedGlyphRenderRequest(C,W),this._collectWidgetBasedGlyphRenderRequest(C,W),W.sort((V,U)=>V.lineNumber===U.lineNumber?V.lane===U.lane?V.zIndex===U.zIndex?U.type===V.type?V.type===0&&U.type===0?V.className<U.className?-1:1:0:U.type-V.type:U.zIndex-V.zIndex:V.lane-U.lane:V.lineNumber-U.lineNumber),W}prepareRender(C){if(!this._glyphMargin){this._decorationGlyphsToRender=[];return}for(const U of Object.values(this._widgets))U.renderInfo=null;const W=new ArrayQueue(this._collectSortedGlyphRenderRequests(C)),V=[];for(;W.length>0;){const U=W.peek();if(!U)break;const G=W.takeWhile(X=>X.lineNumber===U.lineNumber&&X.lane===U.lane);if(!G||G.length===0)break;const Z=G[0];if(Z.type===0){const X=[];for(const Q of G){if(Q.zIndex!==Z.zIndex||Q.type!==Z.type)break;(X.length===0||X[X.length-1]!==Q.className)&&X.push(Q.className)}V.push(Z.accept(X.join(" ")))}else Z.widget.renderInfo={lineNumber:Z.lineNumber,lane:Z.lane}}this._decorationGlyphsToRender=V}render(C){if(!this._glyphMargin){for(const V of Object.values(this._widgets))V.domNode.setDisplay("none");for(;this._managedDomNodes.length>0;){const V=this._managedDomNodes.pop();V==null||V.domNode.remove()}return}const W=Math.round(this._glyphMarginWidth/this._glyphMarginDecorationLaneCount);for(const V of Object.values(this._widgets))if(!V.renderInfo)V.domNode.setDisplay("none");else{const U=C.viewportData.relativeVerticalOffset[V.renderInfo.lineNumber-C.viewportData.startLineNumber],G=this._glyphMarginLeft+(V.renderInfo.lane-1)*this._lineHeight;V.domNode.setDisplay("block"),V.domNode.setTop(U),V.domNode.setLeft(G),V.domNode.setWidth(W),V.domNode.setHeight(this._lineHeight)}for(let V=0;V<this._decorationGlyphsToRender.length;V++){const U=this._decorationGlyphsToRender[V],G=C.viewportData.relativeVerticalOffset[U.lineNumber-C.viewportData.startLineNumber],Z=this._glyphMarginLeft+(U.lane-1)*this._lineHeight;let X;V<this._managedDomNodes.length?X=this._managedDomNodes[V]:(X=createFastDomNode(document.createElement("div")),this._managedDomNodes.push(X),this.domNode.appendChild(X)),X.setClassName("cgmr codicon "+U.combinedClassName),X.setPosition("absolute"),X.setTop(G),X.setLeft(Z),X.setWidth(W),X.setHeight(this._lineHeight)}for(;this._managedDomNodes.length>this._decorationGlyphsToRender.length;){const V=this._managedDomNodes.pop();V==null||V.domNode.remove()}}}class DecorationBasedGlyphRenderRequest{constructor(C,W,V,U){this.lineNumber=C,this.lane=W,this.zIndex=V,this.className=U,this.type=0}accept(C){return new DecorationBasedGlyph(this.lineNumber,this.lane,C)}}class WidgetBasedGlyphRenderRequest{constructor(C,W,V,U){this.lineNumber=C,this.lane=W,this.zIndex=V,this.widget=U,this.type=1}}class DecorationBasedGlyph{constructor(C,W,V){this.lineNumber=C,this.lane=W,this.combinedClassName=V}}class LinesDecorationsOverlay extends DedupOverlay{constructor(C){super(),this._context=C;const V=this._context.configuration.options.get(143);this._decorationsLeft=V.decorationsLeft,this._decorationsWidth=V.decorationsWidth,this._renderResult=null,this._context.addEventHandler(this)}dispose(){this._context.removeEventHandler(this),this._renderResult=null,super.dispose()}onConfigurationChanged(C){const V=this._context.configuration.options.get(143);return this._decorationsLeft=V.decorationsLeft,this._decorationsWidth=V.decorationsWidth,!0}onDecorationsChanged(C){return!0}onFlushed(C){return!0}onLinesChanged(C){return!0}onLinesDeleted(C){return!0}onLinesInserted(C){return!0}onScrollChanged(C){return C.scrollTopChanged}onZonesChanged(C){return!0}_getDecorations(C){const W=C.getDecorationsInViewport(),V=[];let U=0;for(let G=0,Z=W.length;G<Z;G++){const X=W[G],Q=X.options.linesDecorationsClassName,J=X.options.zIndex;Q&&(V[U++]=new DecorationToRender(X.range.startLineNumber,X.range.endLineNumber,Q,J));const ee=X.options.firstLineDecorationClassName;ee&&(V[U++]=new DecorationToRender(X.range.startLineNumber,X.range.startLineNumber,ee,J))}return V}prepareRender(C){const W=C.visibleRange.startLineNumber,V=C.visibleRange.endLineNumber,U=this._render(W,V,this._getDecorations(C)),G=this._decorationsLeft.toString(),Z=this._decorationsWidth.toString(),X='" style="left:'+G+"px;width:"+Z+'px;"></div>',Q=[];for(let J=W;J<=V;J++){const ee=J-W,te=U[ee].getDecorations();let ie="";for(const ne of te)ie+='<div class="cldr '+ne.className+X;Q[ee]=ie}this._renderResult=Q}render(C,W){return this._renderResult?this._renderResult[W-C]:""}}const marginDecorations="";class MarginViewLineDecorationsOverlay extends DedupOverlay{constructor(C){super(),this._context=C,this._renderResult=null,this._context.addEventHandler(this)}dispose(){this._context.removeEventHandler(this),this._renderResult=null,super.dispose()}onConfigurationChanged(C){return!0}onDecorationsChanged(C){return!0}onFlushed(C){return!0}onLinesChanged(C){return!0}onLinesDeleted(C){return!0}onLinesInserted(C){return!0}onScrollChanged(C){return C.scrollTopChanged}onZonesChanged(C){return!0}_getDecorations(C){const W=C.getDecorationsInViewport(),V=[];let U=0;for(let G=0,Z=W.length;G<Z;G++){const X=W[G],Q=X.options.marginClassName,J=X.options.zIndex;Q&&(V[U++]=new DecorationToRender(X.range.startLineNumber,X.range.endLineNumber,Q,J))}return V}prepareRender(C){const W=C.visibleRange.startLineNumber,V=C.visibleRange.endLineNumber,U=this._render(W,V,this._getDecorations(C)),G=[];for(let Z=W;Z<=V;Z++){const X=Z-W,Q=U[X].getDecorations();let J="";for(const ee of Q)J+='<div class="cmdr '+ee.className+'" style=""></div>';G[X]=J}this._renderResult=G}render(C,W){return this._renderResult?this._renderResult[W-C]:""}}const minimap="";class RGBA8{constructor(C,W,V,U){this._rgba8Brand=void 0,this.r=RGBA8._clamp(C),this.g=RGBA8._clamp(W),this.b=RGBA8._clamp(V),this.a=RGBA8._clamp(U)}equals(C){return this.r===C.r&&this.g===C.g&&this.b===C.b&&this.a===C.a}static _clamp(C){return C<0?0:C>255?255:C|0}}RGBA8.Empty=new RGBA8(0,0,0,0);class MinimapTokensColorTracker extends Disposable{static getInstance(){return this._INSTANCE||(this._INSTANCE=new MinimapTokensColorTracker),this._INSTANCE}constructor(){super(),this._onDidChange=new Emitter$1,this.onDidChange=this._onDidChange.event,this._updateColorMap(),this._register(TokenizationRegistry.onDidChange(C=>{C.changedColorMap&&this._updateColorMap()}))}_updateColorMap(){const C=TokenizationRegistry.getColorMap();if(!C){this._colors=[RGBA8.Empty],this._backgroundIsLight=!0;return}this._colors=[RGBA8.Empty];for(let V=1;V<C.length;V++){const U=C[V].rgba;this._colors[V]=new RGBA8(U.r,U.g,U.b,Math.round(U.a*255))}const W=C[2].getRelativeLuminance();this._backgroundIsLight=W>=.5,this._onDidChange.fire(void 0)}getColor(C){return(C<1||C>=this._colors.length)&&(C=2),this._colors[C]}backgroundIsLight(){return this._backgroundIsLight}}MinimapTokensColorTracker._INSTANCE=null;const allCharCodes=(()=>{const K=[];for(let C=32;C<=126;C++)K.push(C);return K.push(65533),K})(),getCharIndex=(K,C)=>(K-=32,K<0||K>96?C<=2?(K+96)%96:96-1:K);class MinimapCharRenderer{constructor(C,W){this.scale=W,this._minimapCharRendererBrand=void 0,this.charDataNormal=MinimapCharRenderer.soften(C,12/15),this.charDataLight=MinimapCharRenderer.soften(C,50/60)}static soften(C,W){const V=new Uint8ClampedArray(C.length);for(let U=0,G=C.length;U<G;U++)V[U]=toUint8(C[U]*W);return V}renderChar(C,W,V,U,G,Z,X,Q,J,ee,te){const ie=1*this.scale,ne=2*this.scale,oe=te?1:ne;if(W+ie>C.width||V+oe>C.height){console.warn("bad render request outside image data");return}const re=ee?this.charDataLight:this.charDataNormal,ae=getCharIndex(U,J),se=C.width*4,le=X.r,ce=X.g,de=X.b,ue=G.r-le,ge=G.g-ce,he=G.b-de,fe=Math.max(Z,Q),pe=C.data;let Se=ae*ie*ne,Le=V*se+W*4;for(let be=0;be<oe;be++){let Ce=Le;for(let De=0;De<ie;De++){const ke=re[Se++]/255*(Z/255);pe[Ce++]=le+ue*ke,pe[Ce++]=ce+ge*ke,pe[Ce++]=de+he*ke,pe[Ce++]=fe}Le+=se}}blockRenderChar(C,W,V,U,G,Z,X,Q){const J=1*this.scale,ee=2*this.scale,te=Q?1:ee;if(W+J>C.width||V+te>C.height){console.warn("bad render request outside image data");return}const ie=C.width*4,ne=.5*(G/255),oe=Z.r,re=Z.g,ae=Z.b,se=U.r-oe,le=U.g-re,ce=U.b-ae,de=oe+se*ne,ue=re+le*ne,ge=ae+ce*ne,he=Math.max(G,X),fe=C.data;let pe=V*ie+W*4;for(let Se=0;Se<te;Se++){let Le=pe;for(let be=0;be<J;be++)fe[Le++]=de,fe[Le++]=ue,fe[Le++]=ge,fe[Le++]=he;pe+=ie}}}const charTable={0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,A:10,B:11,C:12,D:13,E:14,F:15},decodeData=K=>{const C=new Uint8ClampedArray(K.length/2);for(let W=0;W<K.length;W+=2)C[W>>1]=charTable[K[W]]<<4|charTable[K[W+1]]&15;return C},prebakedMiniMaps={1:createSingleCallFunction(()=>decodeData("0000511D6300CF609C709645A78432005642574171487021003C451900274D35D762755E8B629C5BA856AF57BA649530C167D1512A272A3F6038604460398526BCA2A968DB6F8957C768BE5FBE2FB467CF5D8D5B795DC7625B5DFF50DE64C466DB2FC47CD860A65E9A2EB96CB54CE06DA763AB2EA26860524D3763536601005116008177A8705E53AB738E6A982F88BAA35B5F5B626D9C636B449B737E5B7B678598869A662F6B5B8542706C704C80736A607578685B70594A49715A4522E792")),2:createSingleCallFunction(()=>decodeData("000000000000000055394F383D2800008B8B1F210002000081B1CBCBCC820000847AAF6B9AAF2119BE08B8881AD60000A44FD07DCCF107015338130C00000000385972265F390B406E2437634B4B48031B12B8A0847000001E15B29A402F0000000000004B33460B00007A752C2A0000000000004D3900000084394B82013400ABA5CFC7AD9C0302A45A3E5A98AB000089A43382D97900008BA54AA087A70A0248A6A7AE6DBE0000BF6F94987EA40A01A06DCFA7A7A9030496C32F77891D0000A99FB1A0AFA80603B29AB9CA75930D010C0948354D3900000C0948354F37460D0028BE673D8400000000AF9D7B6E00002B007AA8933400007AA642675C2700007984CFB9C3985B768772A8A6B7B20000CAAECAAFC4B700009F94A6009F840009D09F9BA4CA9C0000CC8FC76DC87F0000C991C472A2000000A894A48CA7B501079BA2C9C69BA20000B19A5D3FA89000005CA6009DA2960901B0A7F0669FB200009D009E00B7890000DAD0F5D092820000D294D4C48BD10000B5A7A4A3B1A50402CAB6CBA6A2000000B5A7A4A3B1A8044FCDADD19D9CB00000B7778F7B8AAE0803C9AB5D3F5D3F00009EA09EA0BAB006039EA0989A8C7900009B9EF4D6B7C00000A9A7816CACA80000ABAC84705D3F000096DA635CDC8C00006F486F266F263D4784006124097B00374F6D2D6D2D6D4A3A95872322000000030000000000008D8939130000000000002E22A5C9CBC70600AB25C0B5C9B400061A2DB04CA67001082AA6BEBEBFC606002321DACBC19E03087AA08B6768380000282FBAC0B8CA7A88AD25BBA5A29900004C396C5894A6000040485A6E356E9442A32CD17EADA70000B4237923628600003E2DE9C1D7B500002F25BBA5A2990000231DB6AFB4A804023025C0B5CAB588062B2CBDBEC0C706882435A75CA20000002326BD6A82A908048B4B9A5A668000002423A09CB4BB060025259C9D8A7900001C1FCAB2C7C700002A2A9387ABA200002626A4A47D6E9D14333163A0C87500004B6F9C2D643A257049364936493647358A34438355497F1A0000A24C1D590000D38DFFBDD4CD3126"))};class MinimapCharRendererFactory{static create(C,W){if(this.lastCreated&&C===this.lastCreated.scale&&W===this.lastFontFamily)return this.lastCreated;let V;return prebakedMiniMaps[C]?V=new MinimapCharRenderer(prebakedMiniMaps[C](),C):V=MinimapCharRendererFactory.createFromSampleData(MinimapCharRendererFactory.createSampleData(W).data,C),this.lastFontFamily=W,this.lastCreated=V,V}static createSampleData(C){const W=document.createElement("canvas"),V=W.getContext("2d");W.style.height="16px",W.height=16,W.width=96*10,W.style.width=96*10+"px",V.fillStyle="#ffffff",V.font=`bold 16px ${C}`,V.textBaseline="middle";let U=0;for(const G of allCharCodes)V.fillText(String.fromCharCode(G),U,16/2),U+=10;return V.getImageData(0,0,96*10,16)}static createFromSampleData(C,W){if(C.length!==61440)throw new Error("Unexpected source in MinimapCharRenderer");const U=MinimapCharRendererFactory._downsample(C,W);return new MinimapCharRenderer(U,W)}static _downsampleChar(C,W,V,U,G){const Z=1*G,X=2*G;let Q=U,J=0;for(let ee=0;ee<X;ee++){const te=ee/X*16,ie=(ee+1)/X*16;for(let ne=0;ne<Z;ne++){const oe=ne/Z*10,re=(ne+1)/Z*10;let ae=0,se=0;for(let ce=te;ce<ie;ce++){const de=W+Math.floor(ce)*3840,ue=1-(ce-Math.floor(ce));for(let ge=oe;ge<re;ge++){const he=1-(ge-Math.floor(ge)),fe=de+Math.floor(ge)*4,pe=he*ue;se+=pe,ae+=C[fe]*C[fe+3]/255*pe}}const le=ae/se;J=Math.max(J,le),V[Q++]=toUint8(le)}}return J}static _downsample(C,W){const V=2*W*1*W,U=V*96,G=new Uint8ClampedArray(U);let Z=0,X=0,Q=0;for(let J=0;J<96;J++)Q=Math.max(Q,this._downsampleChar(C,X,G,Z,W)),Z+=V,X+=10*4;if(Q>0){const J=255/Q;for(let ee=0;ee<U;ee++)G[ee]*=J}return G}}const POINTER_DRAG_RESET_DISTANCE=140,GUTTER_DECORATION_WIDTH=2;class MinimapOptions{constructor(C,W,V){const U=C.options,G=U.get(141),Z=U.get(143),X=Z.minimap,Q=U.get(50),J=U.get(72);this.renderMinimap=X.renderMinimap,this.size=J.size,this.minimapHeightIsEditorHeight=X.minimapHeightIsEditorHeight,this.scrollBeyondLastLine=U.get(104),this.paddingTop=U.get(83).top,this.paddingBottom=U.get(83).bottom,this.showSlider=J.showSlider,this.autohide=J.autohide,this.pixelRatio=G,this.typicalHalfwidthCharacterWidth=Q.typicalHalfwidthCharacterWidth,this.lineHeight=U.get(66),this.minimapLeft=X.minimapLeft,this.minimapWidth=X.minimapWidth,this.minimapHeight=Z.height,this.canvasInnerWidth=X.minimapCanvasInnerWidth,this.canvasInnerHeight=X.minimapCanvasInnerHeight,this.canvasOuterWidth=X.minimapCanvasOuterWidth,this.canvasOuterHeight=X.minimapCanvasOuterHeight,this.isSampling=X.minimapIsSampling,this.editorHeight=Z.height,this.fontScale=X.minimapScale,this.minimapLineHeight=X.minimapLineHeight,this.minimapCharWidth=1*this.fontScale,this.charRenderer=createSingleCallFunction(()=>MinimapCharRendererFactory.create(this.fontScale,Q.fontFamily)),this.defaultBackgroundColor=V.getColor(2),this.backgroundColor=MinimapOptions._getMinimapBackground(W,this.defaultBackgroundColor),this.foregroundAlpha=MinimapOptions._getMinimapForegroundOpacity(W)}static _getMinimapBackground(C,W){const V=C.getColor(minimapBackground);return V?new RGBA8(V.rgba.r,V.rgba.g,V.rgba.b,Math.round(255*V.rgba.a)):W}static _getMinimapForegroundOpacity(C){const W=C.getColor(minimapForegroundOpacity);return W?RGBA8._clamp(Math.round(255*W.rgba.a)):255}equals(C){return this.renderMinimap===C.renderMinimap&&this.size===C.size&&this.minimapHeightIsEditorHeight===C.minimapHeightIsEditorHeight&&this.scrollBeyondLastLine===C.scrollBeyondLastLine&&this.paddingTop===C.paddingTop&&this.paddingBottom===C.paddingBottom&&this.showSlider===C.showSlider&&this.autohide===C.autohide&&this.pixelRatio===C.pixelRatio&&this.typicalHalfwidthCharacterWidth===C.typicalHalfwidthCharacterWidth&&this.lineHeight===C.lineHeight&&this.minimapLeft===C.minimapLeft&&this.minimapWidth===C.minimapWidth&&this.minimapHeight===C.minimapHeight&&this.canvasInnerWidth===C.canvasInnerWidth&&this.canvasInnerHeight===C.canvasInnerHeight&&this.canvasOuterWidth===C.canvasOuterWidth&&this.canvasOuterHeight===C.canvasOuterHeight&&this.isSampling===C.isSampling&&this.editorHeight===C.editorHeight&&this.fontScale===C.fontScale&&this.minimapLineHeight===C.minimapLineHeight&&this.minimapCharWidth===C.minimapCharWidth&&this.defaultBackgroundColor&&this.defaultBackgroundColor.equals(C.defaultBackgroundColor)&&this.backgroundColor&&this.backgroundColor.equals(C.backgroundColor)&&this.foregroundAlpha===C.foregroundAlpha}}class MinimapLayout{constructor(C,W,V,U,G,Z,X,Q,J){this.scrollTop=C,this.scrollHeight=W,this.sliderNeeded=V,this._computedSliderRatio=U,this.sliderTop=G,this.sliderHeight=Z,this.topPaddingLineCount=X,this.startLineNumber=Q,this.endLineNumber=J}getDesiredScrollTopFromDelta(C){return Math.round(this.scrollTop+C/this._computedSliderRatio)}getDesiredScrollTopFromTouchLocation(C){return Math.round((C-this.sliderHeight/2)/this._computedSliderRatio)}intersectWithViewport(C){const W=Math.max(this.startLineNumber,C.startLineNumber),V=Math.min(this.endLineNumber,C.endLineNumber);return W>V?null:[W,V]}getYForLineNumber(C,W){return+(C-this.startLineNumber+this.topPaddingLineCount)*W}static create(C,W,V,U,G,Z,X,Q,J,ee,te){const ie=C.pixelRatio,ne=C.minimapLineHeight,oe=Math.floor(C.canvasInnerHeight/ne),re=C.lineHeight;if(C.minimapHeightIsEditorHeight){let ge=Q*C.lineHeight+C.paddingTop+C.paddingBottom;C.scrollBeyondLastLine&&(ge+=Math.max(0,G-C.lineHeight-C.paddingBottom));const he=Math.max(1,Math.floor(G*G/ge)),fe=Math.max(0,C.minimapHeight-he),pe=fe/(ee-G),Se=J*pe,Le=fe>0,be=Math.floor(C.canvasInnerHeight/C.minimapLineHeight),Ce=Math.floor(C.paddingTop/C.lineHeight);return new MinimapLayout(J,ee,Le,pe,Se,he,Ce,1,Math.min(X,be))}let ae;if(Z&&V!==X){const ge=V-W+1;ae=Math.floor(ge*ne/ie)}else{const ge=G/re;ae=Math.floor(ge*ne/ie)}const se=Math.floor(C.paddingTop/re);let le=Math.floor(C.paddingBottom/re);if(C.scrollBeyondLastLine){const ge=G/re;le=Math.max(le,ge-1)}let ce;if(le>0){const ge=G/re;ce=(se+X+le-ge-1)*ne/ie}else ce=Math.max(0,(se+X)*ne/ie-ae);ce=Math.min(C.minimapHeight-ae,ce);const de=ce/(ee-G),ue=J*de;if(oe>=se+X+le){const ge=ce>0;return new MinimapLayout(J,ee,ge,de,ue,ae,se,1,X)}else{let ge;W>1?ge=W+se:ge=Math.max(1,J/re);let he,fe=Math.max(1,Math.floor(ge-ue*ie/ne));fe<se?(he=se-fe+1,fe=1):(he=0,fe=Math.max(1,fe-se)),te&&te.scrollHeight===ee&&(te.scrollTop>J&&(fe=Math.min(fe,te.startLineNumber),he=Math.max(he,te.topPaddingLineCount)),te.scrollTop<J&&(fe=Math.max(fe,te.startLineNumber),he=Math.min(he,te.topPaddingLineCount)));const pe=Math.min(X,fe-he+oe-1),Se=(J-U)/re;let Le;return J>=C.paddingTop?Le=(W-fe+he+Se)*ne/ie:Le=J/C.paddingTop*(he+Se)*ne/ie,new MinimapLayout(J,ee,!0,de,Le,ae,he,fe,pe)}}}class MinimapLine{constructor(C){this.dy=C}onContentChanged(){this.dy=-1}onTokensChanged(){this.dy=-1}}MinimapLine.INVALID=new MinimapLine(-1);class RenderData{constructor(C,W,V){this.renderedLayout=C,this._imageData=W,this._renderedLines=new RenderedLinesCollection(()=>MinimapLine.INVALID),this._renderedLines._set(C.startLineNumber,V)}linesEquals(C){if(!this.scrollEquals(C))return!1;const V=this._renderedLines._get().lines;for(let U=0,G=V.length;U<G;U++)if(V[U].dy===-1)return!1;return!0}scrollEquals(C){return this.renderedLayout.startLineNumber===C.startLineNumber&&this.renderedLayout.endLineNumber===C.endLineNumber}_get(){const C=this._renderedLines._get();return{imageData:this._imageData,rendLineNumberStart:C.rendLineNumberStart,lines:C.lines}}onLinesChanged(C,W){return this._renderedLines.onLinesChanged(C,W)}onLinesDeleted(C,W){this._renderedLines.onLinesDeleted(C,W)}onLinesInserted(C,W){this._renderedLines.onLinesInserted(C,W)}onTokensChanged(C){return this._renderedLines.onTokensChanged(C)}}class MinimapBuffers{constructor(C,W,V,U){this._backgroundFillData=MinimapBuffers._createBackgroundFillData(W,V,U),this._buffers=[C.createImageData(W,V),C.createImageData(W,V)],this._lastUsedBuffer=0}getBuffer(){this._lastUsedBuffer=1-this._lastUsedBuffer;const C=this._buffers[this._lastUsedBuffer];return C.data.set(this._backgroundFillData),C}static _createBackgroundFillData(C,W,V){const U=V.r,G=V.g,Z=V.b,X=V.a,Q=new Uint8ClampedArray(C*W*4);let J=0;for(let ee=0;ee<W;ee++)for(let te=0;te<C;te++)Q[J]=U,Q[J+1]=G,Q[J+2]=Z,Q[J+3]=X,J+=4;return Q}}class MinimapSamplingState{static compute(C,W,V){if(C.renderMinimap===0||!C.isSampling)return[null,[]];const{minimapLineCount:U}=EditorLayoutInfoComputer.computeContainedMinimapLineCount({viewLineCount:W,scrollBeyondLastLine:C.scrollBeyondLastLine,paddingTop:C.paddingTop,paddingBottom:C.paddingBottom,height:C.editorHeight,lineHeight:C.lineHeight,pixelRatio:C.pixelRatio}),G=W/U,Z=G/2;if(!V||V.minimapLines.length===0){const ae=[];if(ae[0]=1,U>1){for(let se=0,le=U-1;se<le;se++)ae[se]=Math.round(se*G+Z);ae[U-1]=W}return[new MinimapSamplingState(G,ae),[]]}const X=V.minimapLines,Q=X.length,J=[];let ee=0,te=0,ie=1;const ne=10;let oe=[],re=null;for(let ae=0;ae<U;ae++){const se=Math.max(ie,Math.round(ae*G)),le=Math.max(se,Math.round((ae+1)*G));for(;ee<Q&&X[ee]<se;){if(oe.length<ne){const de=ee+1+te;re&&re.type==="deleted"&&re._oldIndex===ee-1?re.deleteToLineNumber++:(re={type:"deleted",_oldIndex:ee,deleteFromLineNumber:de,deleteToLineNumber:de},oe.push(re)),te--}ee++}let ce;if(ee<Q&&X[ee]<=le)ce=X[ee],ee++;else if(ae===0?ce=1:ae+1===U?ce=W:ce=Math.round(ae*G+Z),oe.length<ne){const de=ee+1+te;re&&re.type==="inserted"&&re._i===ae-1?re.insertToLineNumber++:(re={type:"inserted",_i:ae,insertFromLineNumber:de,insertToLineNumber:de},oe.push(re)),te++}J[ae]=ce,ie=ce}if(oe.length<ne)for(;ee<Q;){const ae=ee+1+te;re&&re.type==="deleted"&&re._oldIndex===ee-1?re.deleteToLineNumber++:(re={type:"deleted",_oldIndex:ee,deleteFromLineNumber:ae,deleteToLineNumber:ae},oe.push(re)),te--,ee++}else oe=[{type:"flush"}];return[new MinimapSamplingState(G,J),oe]}constructor(C,W){this.samplingRatio=C,this.minimapLines=W}modelLineToMinimapLine(C){return Math.min(this.minimapLines.length,Math.max(1,Math.round(C/this.samplingRatio)))}modelLineRangeToMinimapLineRange(C,W){let V=this.modelLineToMinimapLine(C)-1;for(;V>0&&this.minimapLines[V-1]>=C;)V--;let U=this.modelLineToMinimapLine(W)-1;for(;U+1<this.minimapLines.length&&this.minimapLines[U+1]<=W;)U++;if(V===U){const G=this.minimapLines[V];if(G<C||G>W)return null}return[V+1,U+1]}decorationLineRangeToMinimapLineRange(C,W){let V=this.modelLineToMinimapLine(C),U=this.modelLineToMinimapLine(W);return C!==W&&U===V&&(U===this.minimapLines.length?V>1&&V--:U++),[V,U]}onLinesDeleted(C){const W=C.toLineNumber-C.fromLineNumber+1;let V=this.minimapLines.length,U=0;for(let G=this.minimapLines.length-1;G>=0&&!(this.minimapLines[G]<C.fromLineNumber);G--)this.minimapLines[G]<=C.toLineNumber?(this.minimapLines[G]=Math.max(1,C.fromLineNumber-1),V=Math.min(V,G),U=Math.max(U,G)):this.minimapLines[G]-=W;return[V,U]}onLinesInserted(C){const W=C.toLineNumber-C.fromLineNumber+1;for(let V=this.minimapLines.length-1;V>=0&&!(this.minimapLines[V]<C.fromLineNumber);V--)this.minimapLines[V]+=W}}class Minimap extends ViewPart{constructor(C){super(C),this.tokensColorTracker=MinimapTokensColorTracker.getInstance(),this._selections=[],this._minimapSelections=null,this.options=new MinimapOptions(this._context.configuration,this._context.theme,this.tokensColorTracker);const[W]=MinimapSamplingState.compute(this.options,this._context.viewModel.getLineCount(),null);this._samplingState=W,this._shouldCheckSampling=!1,this._actual=new InnerMinimap(C.theme,this)}dispose(){this._actual.dispose(),super.dispose()}getDomNode(){return this._actual.getDomNode()}_onOptionsMaybeChanged(){const C=new MinimapOptions(this._context.configuration,this._context.theme,this.tokensColorTracker);return this.options.equals(C)?!1:(this.options=C,this._recreateLineSampling(),this._actual.onDidChangeOptions(),!0)}onConfigurationChanged(C){return this._onOptionsMaybeChanged()}onCursorStateChanged(C){return this._selections=C.selections,this._minimapSelections=null,this._actual.onSelectionChanged()}onDecorationsChanged(C){return C.affectsMinimap?this._actual.onDecorationsChanged():!1}onFlushed(C){return this._samplingState&&(this._shouldCheckSampling=!0),this._actual.onFlushed()}onLinesChanged(C){if(this._samplingState){const W=this._samplingState.modelLineRangeToMinimapLineRange(C.fromLineNumber,C.fromLineNumber+C.count-1);return W?this._actual.onLinesChanged(W[0],W[1]-W[0]+1):!1}else return this._actual.onLinesChanged(C.fromLineNumber,C.count)}onLinesDeleted(C){if(this._samplingState){const[W,V]=this._samplingState.onLinesDeleted(C);return W<=V&&this._actual.onLinesChanged(W+1,V-W+1),this._shouldCheckSampling=!0,!0}else return this._actual.onLinesDeleted(C.fromLineNumber,C.toLineNumber)}onLinesInserted(C){return this._samplingState?(this._samplingState.onLinesInserted(C),this._shouldCheckSampling=!0,!0):this._actual.onLinesInserted(C.fromLineNumber,C.toLineNumber)}onScrollChanged(C){return this._actual.onScrollChanged()}onThemeChanged(C){return this._actual.onThemeChanged(),this._onOptionsMaybeChanged(),!0}onTokensChanged(C){if(this._samplingState){const W=[];for(const V of C.ranges){const U=this._samplingState.modelLineRangeToMinimapLineRange(V.fromLineNumber,V.toLineNumber);U&&W.push({fromLineNumber:U[0],toLineNumber:U[1]})}return W.length?this._actual.onTokensChanged(W):!1}else return this._actual.onTokensChanged(C.ranges)}onTokensColorsChanged(C){return this._onOptionsMaybeChanged(),this._actual.onTokensColorsChanged()}onZonesChanged(C){return this._actual.onZonesChanged()}prepareRender(C){this._shouldCheckSampling&&(this._shouldCheckSampling=!1,this._recreateLineSampling())}render(C){let W=C.visibleRange.startLineNumber,V=C.visibleRange.endLineNumber;this._samplingState&&(W=this._samplingState.modelLineToMinimapLine(W),V=this._samplingState.modelLineToMinimapLine(V));const U={viewportContainsWhitespaceGaps:C.viewportData.whitespaceViewportData.length>0,scrollWidth:C.scrollWidth,scrollHeight:C.scrollHeight,viewportStartLineNumber:W,viewportEndLineNumber:V,viewportStartLineNumberVerticalOffset:C.getVerticalOffsetForLineNumber(W),scrollTop:C.scrollTop,scrollLeft:C.scrollLeft,viewportWidth:C.viewportWidth,viewportHeight:C.viewportHeight};this._actual.render(U)}_recreateLineSampling(){this._minimapSelections=null;const C=!!this._samplingState,[W,V]=MinimapSamplingState.compute(this.options,this._context.viewModel.getLineCount(),this._samplingState);if(this._samplingState=W,C&&this._samplingState)for(const U of V)switch(U.type){case"deleted":this._actual.onLinesDeleted(U.deleteFromLineNumber,U.deleteToLineNumber);break;case"inserted":this._actual.onLinesInserted(U.insertFromLineNumber,U.insertToLineNumber);break;case"flush":this._actual.onFlushed();break}}getLineCount(){return this._samplingState?this._samplingState.minimapLines.length:this._context.viewModel.getLineCount()}getRealLineCount(){return this._context.viewModel.getLineCount()}getLineContent(C){return this._samplingState?this._context.viewModel.getLineContent(this._samplingState.minimapLines[C-1]):this._context.viewModel.getLineContent(C)}getLineMaxColumn(C){return this._samplingState?this._context.viewModel.getLineMaxColumn(this._samplingState.minimapLines[C-1]):this._context.viewModel.getLineMaxColumn(C)}getMinimapLinesRenderingData(C,W,V){if(this._samplingState){const U=[];for(let G=0,Z=W-C+1;G<Z;G++)V[G]?U[G]=this._context.viewModel.getViewLineData(this._samplingState.minimapLines[C+G-1]):U[G]=null;return U}return this._context.viewModel.getMinimapLinesRenderingData(C,W,V).data}getSelections(){if(this._minimapSelections===null)if(this._samplingState){this._minimapSelections=[];for(const C of this._selections){const[W,V]=this._samplingState.decorationLineRangeToMinimapLineRange(C.startLineNumber,C.endLineNumber);this._minimapSelections.push(new Selection$1(W,C.startColumn,V,C.endColumn))}}else this._minimapSelections=this._selections;return this._minimapSelections}getMinimapDecorationsInViewport(C,W){let V;if(this._samplingState){const G=this._samplingState.minimapLines[C-1],Z=this._samplingState.minimapLines[W-1];V=new Range$2(G,1,Z,this._context.viewModel.getLineMaxColumn(Z))}else V=new Range$2(C,1,W,this._context.viewModel.getLineMaxColumn(W));const U=this._context.viewModel.getMinimapDecorationsInRange(V);if(this._samplingState){const G=[];for(const Z of U){if(!Z.options.minimap)continue;const X=Z.range,Q=this._samplingState.modelLineToMinimapLine(X.startLineNumber),J=this._samplingState.modelLineToMinimapLine(X.endLineNumber);G.push(new ViewModelDecoration(new Range$2(Q,X.startColumn,J,X.endColumn),Z.options))}return G}return U}getOptions(){return this._context.viewModel.model.getOptions()}revealLineNumber(C){this._samplingState&&(C=this._samplingState.minimapLines[C-1]),this._context.viewModel.revealRange("mouse",!1,new Range$2(C,1,C,1),1,0)}setScrollTop(C){this._context.viewModel.viewLayout.setScrollPosition({scrollTop:C},1)}}class InnerMinimap extends Disposable{constructor(C,W){super(),this._renderDecorations=!1,this._gestureInProgress=!1,this._theme=C,this._model=W,this._lastRenderData=null,this._buffers=null,this._selectionColor=this._theme.getColor(minimapSelection),this._domNode=createFastDomNode(document.createElement("div")),PartFingerprints.write(this._domNode,8),this._domNode.setClassName(this._getMinimapDomNodeClassName()),this._domNode.setPosition("absolute"),this._domNode.setAttribute("role","presentation"),this._domNode.setAttribute("aria-hidden","true"),this._shadow=createFastDomNode(document.createElement("div")),this._shadow.setClassName("minimap-shadow-hidden"),this._domNode.appendChild(this._shadow),this._canvas=createFastDomNode(document.createElement("canvas")),this._canvas.setPosition("absolute"),this._canvas.setLeft(0),this._domNode.appendChild(this._canvas),this._decorationsCanvas=createFastDomNode(document.createElement("canvas")),this._decorationsCanvas.setPosition("absolute"),this._decorationsCanvas.setClassName("minimap-decorations-layer"),this._decorationsCanvas.setLeft(0),this._domNode.appendChild(this._decorationsCanvas),this._slider=createFastDomNode(document.createElement("div")),this._slider.setPosition("absolute"),this._slider.setClassName("minimap-slider"),this._slider.setLayerHinting(!0),this._slider.setContain("strict"),this._domNode.appendChild(this._slider),this._sliderHorizontal=createFastDomNode(document.createElement("div")),this._sliderHorizontal.setPosition("absolute"),this._sliderHorizontal.setClassName("minimap-slider-horizontal"),this._slider.appendChild(this._sliderHorizontal),this._applyLayout(),this._pointerDownListener=addStandardDisposableListener(this._domNode.domNode,EventType$1.POINTER_DOWN,V=>{if(V.preventDefault(),this._model.options.renderMinimap===0||!this._lastRenderData)return;if(this._model.options.size!=="proportional"){if(V.button===0&&this._lastRenderData){const J=getDomNodePagePosition(this._slider.domNode),ee=J.top+J.height/2;this._startSliderDragging(V,ee,this._lastRenderData.renderedLayout)}return}const G=this._model.options.minimapLineHeight,Z=this._model.options.canvasInnerHeight/this._model.options.canvasOuterHeight*V.offsetY;let Q=Math.floor(Z/G)+this._lastRenderData.renderedLayout.startLineNumber-this._lastRenderData.renderedLayout.topPaddingLineCount;Q=Math.min(Q,this._model.getLineCount()),this._model.revealLineNumber(Q)}),this._sliderPointerMoveMonitor=new GlobalPointerMoveMonitor,this._sliderPointerDownListener=addStandardDisposableListener(this._slider.domNode,EventType$1.POINTER_DOWN,V=>{V.preventDefault(),V.stopPropagation(),V.button===0&&this._lastRenderData&&this._startSliderDragging(V,V.pageY,this._lastRenderData.renderedLayout)}),this._gestureDisposable=Gesture.addTarget(this._domNode.domNode),this._sliderTouchStartListener=addDisposableListener(this._domNode.domNode,EventType.Start,V=>{V.preventDefault(),V.stopPropagation(),this._lastRenderData&&(this._slider.toggleClassName("active",!0),this._gestureInProgress=!0,this.scrollDueToTouchEvent(V))},{passive:!1}),this._sliderTouchMoveListener=addDisposableListener(this._domNode.domNode,EventType.Change,V=>{V.preventDefault(),V.stopPropagation(),this._lastRenderData&&this._gestureInProgress&&this.scrollDueToTouchEvent(V)},{passive:!1}),this._sliderTouchEndListener=addStandardDisposableListener(this._domNode.domNode,EventType.End,V=>{V.preventDefault(),V.stopPropagation(),this._gestureInProgress=!1,this._slider.toggleClassName("active",!1)})}_startSliderDragging(C,W,V){if(!C.target||!(C.target instanceof Element))return;const U=C.pageX;this._slider.toggleClassName("active",!0);const G=(Z,X)=>{const Q=getDomNodePagePosition(this._domNode.domNode),J=Math.min(Math.abs(X-U),Math.abs(X-Q.left),Math.abs(X-Q.left-Q.width));if(isWindows&&J>POINTER_DRAG_RESET_DISTANCE){this._model.setScrollTop(V.scrollTop);return}const ee=Z-W;this._model.setScrollTop(V.getDesiredScrollTopFromDelta(ee))};C.pageY!==W&&G(C.pageY,U),this._sliderPointerMoveMonitor.startMonitoring(C.target,C.pointerId,C.buttons,Z=>G(Z.pageY,Z.pageX),()=>{this._slider.toggleClassName("active",!1)})}scrollDueToTouchEvent(C){const W=this._domNode.domNode.getBoundingClientRect().top,V=this._lastRenderData.renderedLayout.getDesiredScrollTopFromTouchLocation(C.pageY-W);this._model.setScrollTop(V)}dispose(){this._pointerDownListener.dispose(),this._sliderPointerMoveMonitor.dispose(),this._sliderPointerDownListener.dispose(),this._gestureDisposable.dispose(),this._sliderTouchStartListener.dispose(),this._sliderTouchMoveListener.dispose(),this._sliderTouchEndListener.dispose(),super.dispose()}_getMinimapDomNodeClassName(){const C=["minimap"];return this._model.options.showSlider==="always"?C.push("slider-always"):C.push("slider-mouseover"),this._model.options.autohide&&C.push("autohide"),C.join(" ")}getDomNode(){return this._domNode}_applyLayout(){this._domNode.setLeft(this._model.options.minimapLeft),this._domNode.setWidth(this._model.options.minimapWidth),this._domNode.setHeight(this._model.options.minimapHeight),this._shadow.setHeight(this._model.options.minimapHeight),this._canvas.setWidth(this._model.options.canvasOuterWidth),this._canvas.setHeight(this._model.options.canvasOuterHeight),this._canvas.domNode.width=this._model.options.canvasInnerWidth,this._canvas.domNode.height=this._model.options.canvasInnerHeight,this._decorationsCanvas.setWidth(this._model.options.canvasOuterWidth),this._decorationsCanvas.setHeight(this._model.options.canvasOuterHeight),this._decorationsCanvas.domNode.width=this._model.options.canvasInnerWidth,this._decorationsCanvas.domNode.height=this._model.options.canvasInnerHeight,this._slider.setWidth(this._model.options.minimapWidth)}_getBuffer(){return this._buffers||this._model.options.canvasInnerWidth>0&&this._model.options.canvasInnerHeight>0&&(this._buffers=new MinimapBuffers(this._canvas.domNode.getContext("2d"),this._model.options.canvasInnerWidth,this._model.options.canvasInnerHeight,this._model.options.backgroundColor)),this._buffers?this._buffers.getBuffer():null}onDidChangeOptions(){this._lastRenderData=null,this._buffers=null,this._applyLayout(),this._domNode.setClassName(this._getMinimapDomNodeClassName())}onSelectionChanged(){return this._renderDecorations=!0,!0}onDecorationsChanged(){return this._renderDecorations=!0,!0}onFlushed(){return this._lastRenderData=null,!0}onLinesChanged(C,W){return this._lastRenderData?this._lastRenderData.onLinesChanged(C,W):!1}onLinesDeleted(C,W){var V;return(V=this._lastRenderData)===null||V===void 0||V.onLinesDeleted(C,W),!0}onLinesInserted(C,W){var V;return(V=this._lastRenderData)===null||V===void 0||V.onLinesInserted(C,W),!0}onScrollChanged(){return this._renderDecorations=!0,!0}onThemeChanged(){return this._selectionColor=this._theme.getColor(minimapSelection),this._renderDecorations=!0,!0}onTokensChanged(C){return this._lastRenderData?this._lastRenderData.onTokensChanged(C):!1}onTokensColorsChanged(){return this._lastRenderData=null,this._buffers=null,!0}onZonesChanged(){return this._lastRenderData=null,!0}render(C){if(this._model.options.renderMinimap===0){this._shadow.setClassName("minimap-shadow-hidden"),this._sliderHorizontal.setWidth(0),this._sliderHorizontal.setHeight(0);return}C.scrollLeft+C.viewportWidth>=C.scrollWidth?this._shadow.setClassName("minimap-shadow-hidden"):this._shadow.setClassName("minimap-shadow-visible");const V=MinimapLayout.create(this._model.options,C.viewportStartLineNumber,C.viewportEndLineNumber,C.viewportStartLineNumberVerticalOffset,C.viewportHeight,C.viewportContainsWhitespaceGaps,this._model.getLineCount(),this._model.getRealLineCount(),C.scrollTop,C.scrollHeight,this._lastRenderData?this._lastRenderData.renderedLayout:null);this._slider.setDisplay(V.sliderNeeded?"block":"none"),this._slider.setTop(V.sliderTop),this._slider.setHeight(V.sliderHeight),this._sliderHorizontal.setLeft(0),this._sliderHorizontal.setWidth(this._model.options.minimapWidth),this._sliderHorizontal.setTop(0),this._sliderHorizontal.setHeight(V.sliderHeight),this.renderDecorations(V),this._lastRenderData=this.renderLines(V)}renderDecorations(C){if(this._renderDecorations){this._renderDecorations=!1;const W=this._model.getSelections();W.sort(Range$2.compareRangesUsingStarts);const V=this._model.getMinimapDecorationsInViewport(C.startLineNumber,C.endLineNumber);V.sort((ie,ne)=>(ie.options.zIndex||0)-(ne.options.zIndex||0));const{canvasInnerWidth:U,canvasInnerHeight:G}=this._model.options,Z=this._model.options.minimapLineHeight,X=this._model.options.minimapCharWidth,Q=this._model.getOptions().tabSize,J=this._decorationsCanvas.domNode.getContext("2d");J.clearRect(0,0,U,G);const ee=new ContiguousLineMap(C.startLineNumber,C.endLineNumber,!1);this._renderSelectionLineHighlights(J,W,ee,C,Z),this._renderDecorationsLineHighlights(J,V,ee,C,Z);const te=new ContiguousLineMap(C.startLineNumber,C.endLineNumber,null);this._renderSelectionsHighlights(J,W,te,C,Z,Q,X,U),this._renderDecorationsHighlights(J,V,te,C,Z,Q,X,U)}}_renderSelectionLineHighlights(C,W,V,U,G){if(!this._selectionColor||this._selectionColor.isTransparent())return;C.fillStyle=this._selectionColor.transparent(.5).toString();let Z=0,X=0;for(const Q of W){const J=U.intersectWithViewport(Q);if(!J)continue;const[ee,te]=J;for(let oe=ee;oe<=te;oe++)V.set(oe,!0);const ie=U.getYForLineNumber(ee,G),ne=U.getYForLineNumber(te,G);X>=ie||(X>Z&&C.fillRect(MINIMAP_GUTTER_WIDTH,Z,C.canvas.width,X-Z),Z=ie),X=ne}X>Z&&C.fillRect(MINIMAP_GUTTER_WIDTH,Z,C.canvas.width,X-Z)}_renderDecorationsLineHighlights(C,W,V,U,G){const Z=new Map;for(let X=W.length-1;X>=0;X--){const Q=W[X],J=Q.options.minimap;if(!J||J.position!==MinimapPosition.Inline)continue;const ee=U.intersectWithViewport(Q.range);if(!ee)continue;const[te,ie]=ee,ne=J.getColor(this._theme.value);if(!ne||ne.isTransparent())continue;let oe=Z.get(ne.toString());oe||(oe=ne.transparent(.5).toString(),Z.set(ne.toString(),oe)),C.fillStyle=oe;for(let re=te;re<=ie;re++){if(V.has(re))continue;V.set(re,!0);const ae=U.getYForLineNumber(te,G);C.fillRect(MINIMAP_GUTTER_WIDTH,ae,C.canvas.width,G)}}}_renderSelectionsHighlights(C,W,V,U,G,Z,X,Q){if(!(!this._selectionColor||this._selectionColor.isTransparent()))for(const J of W){const ee=U.intersectWithViewport(J);if(!ee)continue;const[te,ie]=ee;for(let ne=te;ne<=ie;ne++)this.renderDecorationOnLine(C,V,J,this._selectionColor,U,ne,G,G,Z,X,Q)}}_renderDecorationsHighlights(C,W,V,U,G,Z,X,Q){for(const J of W){const ee=J.options.minimap;if(!ee)continue;const te=U.intersectWithViewport(J.range);if(!te)continue;const[ie,ne]=te,oe=ee.getColor(this._theme.value);if(!(!oe||oe.isTransparent()))for(let re=ie;re<=ne;re++)switch(ee.position){case MinimapPosition.Inline:this.renderDecorationOnLine(C,V,J.range,oe,U,re,G,G,Z,X,Q);continue;case MinimapPosition.Gutter:{const ae=U.getYForLineNumber(re,G),se=2;this.renderDecoration(C,oe,se,ae,GUTTER_DECORATION_WIDTH,G);continue}}}}renderDecorationOnLine(C,W,V,U,G,Z,X,Q,J,ee,te){const ie=G.getYForLineNumber(Z,Q);if(ie+X<0||ie>this._model.options.canvasInnerHeight)return;const{startLineNumber:ne,endLineNumber:oe}=V,re=ne===Z?V.startColumn:1,ae=oe===Z?V.endColumn:this._model.getLineMaxColumn(Z),se=this.getXOffsetForPosition(W,Z,re,J,ee,te),le=this.getXOffsetForPosition(W,Z,ae,J,ee,te);this.renderDecoration(C,U,se,ie,le-se,X)}getXOffsetForPosition(C,W,V,U,G,Z){if(V===1)return MINIMAP_GUTTER_WIDTH;if((V-1)*G>=Z)return Z;let Q=C.get(W);if(!Q){const J=this._model.getLineContent(W);Q=[MINIMAP_GUTTER_WIDTH];let ee=MINIMAP_GUTTER_WIDTH;for(let te=1;te<J.length+1;te++){const ie=J.charCodeAt(te-1),ne=ie===9?U*G:isFullWidthCharacter(ie)?2*G:G,oe=ee+ne;if(oe>=Z){Q[te]=Z;break}Q[te]=oe,ee=oe}C.set(W,Q)}return V-1<Q.length?Q[V-1]:Z}renderDecoration(C,W,V,U,G,Z){C.fillStyle=W&&W.toString()||"",C.fillRect(V,U,G,Z)}renderLines(C){const W=C.startLineNumber,V=C.endLineNumber,U=this._model.options.minimapLineHeight;if(this._lastRenderData&&this._lastRenderData.linesEquals(C)){const ke=this._lastRenderData._get();return new RenderData(C,ke.imageData,ke.lines)}const G=this._getBuffer();if(!G)return null;const[Z,X,Q]=InnerMinimap._renderUntouchedLines(G,C.topPaddingLineCount,W,V,U,this._lastRenderData),J=this._model.getMinimapLinesRenderingData(W,V,Q),ee=this._model.getOptions().tabSize,te=this._model.options.defaultBackgroundColor,ie=this._model.options.backgroundColor,ne=this._model.options.foregroundAlpha,oe=this._model.tokensColorTracker,re=oe.backgroundIsLight(),ae=this._model.options.renderMinimap,se=this._model.options.charRenderer(),le=this._model.options.fontScale,ce=this._model.options.minimapCharWidth,ue=(ae===1?2:2+1)*le,ge=U>ue?Math.floor((U-ue)/2):0,he=ie.a/255,fe=new RGBA8(Math.round((ie.r-te.r)*he+te.r),Math.round((ie.g-te.g)*he+te.g),Math.round((ie.b-te.b)*he+te.b),255);let pe=C.topPaddingLineCount*U;const Se=[];for(let ke=0,Me=V-W+1;ke<Me;ke++)Q[ke]&&InnerMinimap._renderLine(G,fe,ie.a,re,ae,ce,oe,ne,se,pe,ge,ee,J[ke],le,U),Se[ke]=new MinimapLine(pe),pe+=U;const Le=Z===-1?0:Z,Ce=(X===-1?G.height:X)-Le;return this._canvas.domNode.getContext("2d").putImageData(G,0,0,0,Le,G.width,Ce),new RenderData(C,G,Se)}static _renderUntouchedLines(C,W,V,U,G,Z){const X=[];if(!Z){for(let pe=0,Se=U-V+1;pe<Se;pe++)X[pe]=!0;return[-1,-1,X]}const Q=Z._get(),J=Q.imageData.data,ee=Q.rendLineNumberStart,te=Q.lines,ie=te.length,ne=C.width,oe=C.data,re=(U-V+1)*G*ne*4;let ae=-1,se=-1,le=-1,ce=-1,de=-1,ue=-1,ge=W*G;for(let pe=V;pe<=U;pe++){const Se=pe-V,Le=pe-ee,be=Le>=0&&Le<ie?te[Le].dy:-1;if(be===-1){X[Se]=!0,ge+=G;continue}const Ce=be*ne*4,De=(be+G)*ne*4,ke=ge*ne*4,Me=(ge+G)*ne*4;ce===Ce&&ue===ke?(ce=De,ue=Me):(le!==-1&&(oe.set(J.subarray(le,ce),de),ae===-1&&le===0&&le===de&&(ae=ce),se===-1&&ce===re&&le===de&&(se=le)),le=Ce,ce=De,de=ke,ue=Me),X[Se]=!1,ge+=G}le!==-1&&(oe.set(J.subarray(le,ce),de),ae===-1&&le===0&&le===de&&(ae=ce),se===-1&&ce===re&&le===de&&(se=le));const he=ae===-1?-1:ae/(ne*4),fe=se===-1?-1:se/(ne*4);return[he,fe,X]}static _renderLine(C,W,V,U,G,Z,X,Q,J,ee,te,ie,ne,oe,re){const ae=ne.content,se=ne.tokens,le=C.width-Z,ce=re===1;let de=MINIMAP_GUTTER_WIDTH,ue=0,ge=0;for(let he=0,fe=se.getCount();he<fe;he++){const pe=se.getEndOffset(he),Se=se.getForeground(he),Le=X.getColor(Se);for(;ue<pe;ue++){if(de>le)return;const be=ae.charCodeAt(ue);if(be===9){const Ce=ie-(ue+ge)%ie;ge+=Ce-1,de+=Ce*Z}else if(be===32)de+=Z;else{const Ce=isFullWidthCharacter(be)?2:1;for(let De=0;De<Ce;De++)if(G===2?J.blockRenderChar(C,de,ee+te,Le,Q,W,V,ce):J.renderChar(C,de,ee+te,be,Le,Q,W,V,oe,U,ce),de+=Z,de>le)return}}}}}class ContiguousLineMap{constructor(C,W,V){this._startLineNumber=C,this._endLineNumber=W,this._defaultValue=V,this._values=[];for(let U=0,G=this._endLineNumber-this._startLineNumber+1;U<G;U++)this._values[U]=V}has(C){return this.get(C)!==this._defaultValue}set(C,W){C<this._startLineNumber||C>this._endLineNumber||(this._values[C-this._startLineNumber]=W)}get(C){return C<this._startLineNumber||C>this._endLineNumber?this._defaultValue:this._values[C-this._startLineNumber]}}const overlayWidgets="";class ViewOverlayWidgets extends ViewPart{constructor(C){super(C);const V=this._context.configuration.options.get(143);this._widgets={},this._verticalScrollbarWidth=V.verticalScrollbarWidth,this._minimapWidth=V.minimap.minimapWidth,this._horizontalScrollbarHeight=V.horizontalScrollbarHeight,this._editorHeight=V.height,this._editorWidth=V.width,this._domNode=createFastDomNode(document.createElement("div")),PartFingerprints.write(this._domNode,4),this._domNode.setClassName("overlayWidgets")}dispose(){super.dispose(),this._widgets={}}getDomNode(){return this._domNode}onConfigurationChanged(C){const V=this._context.configuration.options.get(143);return this._verticalScrollbarWidth=V.verticalScrollbarWidth,this._minimapWidth=V.minimap.minimapWidth,this._horizontalScrollbarHeight=V.horizontalScrollbarHeight,this._editorHeight=V.height,this._editorWidth=V.width,!0}addWidget(C){const W=createFastDomNode(C.getDomNode());this._widgets[C.getId()]={widget:C,preference:null,domNode:W},W.setPosition("absolute"),W.setAttribute("widgetId",C.getId()),this._domNode.appendChild(W),this.setShouldRender(),this._updateMaxMinWidth()}setWidgetPosition(C,W){const V=this._widgets[C.getId()];return V.preference===W?(this._updateMaxMinWidth(),!1):(V.preference=W,this.setShouldRender(),this._updateMaxMinWidth(),!0)}removeWidget(C){const W=C.getId();if(this._widgets.hasOwnProperty(W)){const U=this._widgets[W].domNode.domNode;delete this._widgets[W],U.parentNode.removeChild(U),this.setShouldRender(),this._updateMaxMinWidth()}}_updateMaxMinWidth(){var C,W;let V=0;const U=Object.keys(this._widgets);for(let G=0,Z=U.length;G<Z;G++){const X=U[G],J=(W=(C=this._widgets[X].widget).getMinContentWidthInPx)===null||W===void 0?void 0:W.call(C);typeof J<"u"&&(V=Math.max(V,J))}this._context.viewLayout.setOverlayWidgetsMinWidth(V)}_renderWidget(C){const W=C.domNode;if(C.preference===null){W.setTop("");return}if(C.preference===0)W.setTop(0),W.setRight(2*this._verticalScrollbarWidth+this._minimapWidth);else if(C.preference===1){const V=W.domNode.clientHeight;W.setTop(this._editorHeight-V-2*this._horizontalScrollbarHeight),W.setRight(2*this._verticalScrollbarWidth+this._minimapWidth)}else C.preference===2&&(W.setTop(0),W.domNode.style.right="50%")}prepareRender(C){}render(C){this._domNode.setWidth(this._editorWidth);const W=Object.keys(this._widgets);for(let V=0,U=W.length;V<U;V++){const G=W[V];this._renderWidget(this._widgets[G])}}}class Settings{constructor(C,W){const V=C.options;this.lineHeight=V.get(66),this.pixelRatio=V.get(141),this.overviewRulerLanes=V.get(82),this.renderBorder=V.get(81);const U=W.getColor(editorOverviewRulerBorder);this.borderColor=U?U.toString():null,this.hideCursor=V.get(59);const G=W.getColor(editorCursorForeground);this.cursorColor=G?G.transparent(.7).toString():null,this.themeType=W.type;const Z=V.get(72),X=Z.enabled,Q=Z.side,J=W.getColor(editorOverviewRulerBackground),ee=TokenizationRegistry.getDefaultBackground();J?this.backgroundColor=J:X&&Q==="right"?this.backgroundColor=ee:this.backgroundColor=null;const ie=V.get(143).overviewRuler;this.top=ie.top,this.right=ie.right,this.domWidth=ie.width,this.domHeight=ie.height,this.overviewRulerLanes===0?(this.canvasWidth=0,this.canvasHeight=0):(this.canvasWidth=this.domWidth*this.pixelRatio|0,this.canvasHeight=this.domHeight*this.pixelRatio|0);const[ne,oe]=this._initLanes(1,this.canvasWidth,this.overviewRulerLanes);this.x=ne,this.w=oe}_initLanes(C,W,V){const U=W-C;if(V>=3){const G=Math.floor(U/3),Z=Math.floor(U/3),X=U-G-Z,Q=C,J=Q+G,ee=Q+G+X;return[[0,Q,J,Q,ee,Q,J,Q],[0,G,X,G+X,Z,G+X+Z,X+Z,G+X+Z]]}else if(V===2){const G=Math.floor(U/2),Z=U-G,X=C,Q=X+G;return[[0,X,X,X,Q,X,X,X],[0,G,G,G,Z,G+Z,G+Z,G+Z]]}else{const G=C,Z=U;return[[0,G,G,G,G,G,G,G],[0,Z,Z,Z,Z,Z,Z,Z]]}}equals(C){return this.lineHeight===C.lineHeight&&this.pixelRatio===C.pixelRatio&&this.overviewRulerLanes===C.overviewRulerLanes&&this.renderBorder===C.renderBorder&&this.borderColor===C.borderColor&&this.hideCursor===C.hideCursor&&this.cursorColor===C.cursorColor&&this.themeType===C.themeType&&Color.equals(this.backgroundColor,C.backgroundColor)&&this.top===C.top&&this.right===C.right&&this.domWidth===C.domWidth&&this.domHeight===C.domHeight&&this.canvasWidth===C.canvasWidth&&this.canvasHeight===C.canvasHeight}}class DecorationsOverviewRuler extends ViewPart{constructor(C){super(C),this._actualShouldRender=0,this._renderedDecorations=[],this._renderedCursorPositions=[],this._domNode=createFastDomNode(document.createElement("canvas")),this._domNode.setClassName("decorationsOverviewRuler"),this._domNode.setPosition("absolute"),this._domNode.setLayerHinting(!0),this._domNode.setContain("strict"),this._domNode.setAttribute("aria-hidden","true"),this._updateSettings(!1),this._tokensColorTrackerListener=TokenizationRegistry.onDidChange(W=>{W.changedColorMap&&this._updateSettings(!0)}),this._cursorPositions=[]}dispose(){super.dispose(),this._tokensColorTrackerListener.dispose()}_updateSettings(C){const W=new Settings(this._context.configuration,this._context.theme);return this._settings&&this._settings.equals(W)?!1:(this._settings=W,this._domNode.setTop(this._settings.top),this._domNode.setRight(this._settings.right),this._domNode.setWidth(this._settings.domWidth),this._domNode.setHeight(this._settings.domHeight),this._domNode.domNode.width=this._settings.canvasWidth,this._domNode.domNode.height=this._settings.canvasHeight,C&&this._render(),!0)}_markRenderingIsNeeded(){return this._actualShouldRender=2,!0}_markRenderingIsMaybeNeeded(){return this._actualShouldRender=1,!0}onConfigurationChanged(C){return this._updateSettings(!1)?this._markRenderingIsNeeded():!1}onCursorStateChanged(C){this._cursorPositions=[];for(let W=0,V=C.selections.length;W<V;W++)this._cursorPositions[W]=C.selections[W].getPosition();return this._cursorPositions.sort(Position$1.compare),this._markRenderingIsMaybeNeeded()}onDecorationsChanged(C){return C.affectsOverviewRuler?this._markRenderingIsMaybeNeeded():!1}onFlushed(C){return this._markRenderingIsNeeded()}onScrollChanged(C){return C.scrollHeightChanged?this._markRenderingIsNeeded():!1}onZonesChanged(C){return this._markRenderingIsNeeded()}onThemeChanged(C){return this._updateSettings(!1)?this._markRenderingIsNeeded():!1}getDomNode(){return this._domNode.domNode}prepareRender(C){}render(C){this._render(),this._actualShouldRender=0}_render(){const C=this._settings.backgroundColor;if(this._settings.overviewRulerLanes===0){this._domNode.setBackgroundColor(C?Color.Format.CSS.formatHexA(C):""),this._domNode.setDisplay("none");return}const W=this._context.viewModel.getAllOverviewRulerDecorations(this._context.theme);if(W.sort(OverviewRulerDecorationsGroup.compareByRenderingProps),this._actualShouldRender===1&&!OverviewRulerDecorationsGroup.equalsArr(this._renderedDecorations,W)&&(this._actualShouldRender=2),this._actualShouldRender===1&&!equals$5(this._renderedCursorPositions,this._cursorPositions,(oe,re)=>oe.lineNumber===re.lineNumber)&&(this._actualShouldRender=2),this._actualShouldRender===1)return;this._renderedDecorations=W,this._renderedCursorPositions=this._cursorPositions,this._domNode.setDisplay("block");const V=this._settings.canvasWidth,U=this._settings.canvasHeight,G=this._settings.lineHeight,Z=this._context.viewLayout,X=this._context.viewLayout.getScrollHeight(),Q=U/X,J=6*this._settings.pixelRatio|0,ee=J/2|0,te=this._domNode.domNode.getContext("2d");C?C.isOpaque()?(te.fillStyle=Color.Format.CSS.formatHexA(C),te.fillRect(0,0,V,U)):(te.clearRect(0,0,V,U),te.fillStyle=Color.Format.CSS.formatHexA(C),te.fillRect(0,0,V,U)):te.clearRect(0,0,V,U);const ie=this._settings.x,ne=this._settings.w;for(const oe of W){const re=oe.color,ae=oe.data;te.fillStyle=re;let se=0,le=0,ce=0;for(let de=0,ue=ae.length/3;de<ue;de++){const ge=ae[3*de],he=ae[3*de+1],fe=ae[3*de+2];let pe=Z.getVerticalOffsetForLineNumber(he)*Q|0,Se=(Z.getVerticalOffsetForLineNumber(fe)+G)*Q|0;if(Se-pe<J){let be=(pe+Se)/2|0;be<ee?be=ee:be+ee>U&&(be=U-ee),pe=be-ee,Se=be+ee}pe>ce+1||ge!==se?(de!==0&&te.fillRect(ie[se],le,ne[se],ce-le),se=ge,le=pe,ce=Se):Se>ce&&(ce=Se)}te.fillRect(ie[se],le,ne[se],ce-le)}if(!this._settings.hideCursor&&this._settings.cursorColor){const oe=2*this._settings.pixelRatio|0,re=oe/2|0,ae=this._settings.x[7],se=this._settings.w[7];te.fillStyle=this._settings.cursorColor;let le=-100,ce=-100;for(let de=0,ue=this._cursorPositions.length;de<ue;de++){const ge=this._cursorPositions[de];let he=Z.getVerticalOffsetForLineNumber(ge.lineNumber)*Q|0;he<re?he=re:he+re>U&&(he=U-re);const fe=he-re,pe=fe+oe;fe>ce+1?(de!==0&&te.fillRect(ae,le,se,ce-le),le=fe,ce=pe):pe>ce&&(ce=pe)}te.fillRect(ae,le,se,ce-le)}this._settings.renderBorder&&this._settings.borderColor&&this._settings.overviewRulerLanes>0&&(te.beginPath(),te.lineWidth=1,te.strokeStyle=this._settings.borderColor,te.moveTo(0,0),te.lineTo(0,U),te.stroke(),te.moveTo(0,0),te.lineTo(V,0),te.stroke())}}class ColorZone{constructor(C,W,V){this._colorZoneBrand=void 0,this.from=C|0,this.to=W|0,this.colorId=V|0}static compare(C,W){return C.colorId===W.colorId?C.from===W.from?C.to-W.to:C.from-W.from:C.colorId-W.colorId}}class OverviewRulerZone{constructor(C,W,V,U){this._overviewRulerZoneBrand=void 0,this.startLineNumber=C,this.endLineNumber=W,this.heightInLines=V,this.color=U,this._colorZone=null}static compare(C,W){return C.color===W.color?C.startLineNumber===W.startLineNumber?C.heightInLines===W.heightInLines?C.endLineNumber-W.endLineNumber:C.heightInLines-W.heightInLines:C.startLineNumber-W.startLineNumber:C.color<W.color?-1:1}setColorZone(C){this._colorZone=C}getColorZones(){return this._colorZone}}class OverviewZoneManager{constructor(C){this._getVerticalOffsetForLine=C,this._zones=[],this._colorZonesInvalid=!1,this._lineHeight=0,this._domWidth=0,this._domHeight=0,this._outerHeight=0,this._pixelRatio=1,this._lastAssignedId=0,this._color2Id=Object.create(null),this._id2Color=[]}getId2Color(){return this._id2Color}setZones(C){this._zones=C,this._zones.sort(OverviewRulerZone.compare)}setLineHeight(C){return this._lineHeight===C?!1:(this._lineHeight=C,this._colorZonesInvalid=!0,!0)}setPixelRatio(C){this._pixelRatio=C,this._colorZonesInvalid=!0}getDOMWidth(){return this._domWidth}getCanvasWidth(){return this._domWidth*this._pixelRatio}setDOMWidth(C){return this._domWidth===C?!1:(this._domWidth=C,this._colorZonesInvalid=!0,!0)}getDOMHeight(){return this._domHeight}getCanvasHeight(){return this._domHeight*this._pixelRatio}setDOMHeight(C){return this._domHeight===C?!1:(this._domHeight=C,this._colorZonesInvalid=!0,!0)}getOuterHeight(){return this._outerHeight}setOuterHeight(C){return this._outerHeight===C?!1:(this._outerHeight=C,this._colorZonesInvalid=!0,!0)}resolveColorZones(){const C=this._colorZonesInvalid,W=Math.floor(this._lineHeight),V=Math.floor(this.getCanvasHeight()),U=Math.floor(this._outerHeight),G=V/U,Z=Math.floor(4*this._pixelRatio/2),X=[];for(let Q=0,J=this._zones.length;Q<J;Q++){const ee=this._zones[Q];if(!C){const de=ee.getColorZones();if(de){X.push(de);continue}}const te=this._getVerticalOffsetForLine(ee.startLineNumber),ie=ee.heightInLines===0?this._getVerticalOffsetForLine(ee.endLineNumber)+W:te+ee.heightInLines*W,ne=Math.floor(G*te),oe=Math.floor(G*ie);let re=Math.floor((ne+oe)/2),ae=oe-re;ae<Z&&(ae=Z),re-ae<0&&(re=ae),re+ae>V&&(re=V-ae);const se=ee.color;let le=this._color2Id[se];le||(le=++this._lastAssignedId,this._color2Id[se]=le,this._id2Color[le]=se);const ce=new ColorZone(re-ae,re+ae,le);ee.setColorZone(ce),X.push(ce)}return this._colorZonesInvalid=!1,X.sort(ColorZone.compare),X}}class OverviewRuler extends ViewEventHandler{constructor(C,W){super(),this._context=C;const V=this._context.configuration.options;this._domNode=createFastDomNode(document.createElement("canvas")),this._domNode.setClassName(W),this._domNode.setPosition("absolute"),this._domNode.setLayerHinting(!0),this._domNode.setContain("strict"),this._zoneManager=new OverviewZoneManager(U=>this._context.viewLayout.getVerticalOffsetForLineNumber(U)),this._zoneManager.setDOMWidth(0),this._zoneManager.setDOMHeight(0),this._zoneManager.setOuterHeight(this._context.viewLayout.getScrollHeight()),this._zoneManager.setLineHeight(V.get(66)),this._zoneManager.setPixelRatio(V.get(141)),this._context.addEventHandler(this)}dispose(){this._context.removeEventHandler(this),super.dispose()}onConfigurationChanged(C){const W=this._context.configuration.options;return C.hasChanged(66)&&(this._zoneManager.setLineHeight(W.get(66)),this._render()),C.hasChanged(141)&&(this._zoneManager.setPixelRatio(W.get(141)),this._domNode.setWidth(this._zoneManager.getDOMWidth()),this._domNode.setHeight(this._zoneManager.getDOMHeight()),this._domNode.domNode.width=this._zoneManager.getCanvasWidth(),this._domNode.domNode.height=this._zoneManager.getCanvasHeight(),this._render()),!0}onFlushed(C){return this._render(),!0}onScrollChanged(C){return C.scrollHeightChanged&&(this._zoneManager.setOuterHeight(C.scrollHeight),this._render()),!0}onZonesChanged(C){return this._render(),!0}getDomNode(){return this._domNode.domNode}setLayout(C){this._domNode.setTop(C.top),this._domNode.setRight(C.right);let W=!1;W=this._zoneManager.setDOMWidth(C.width)||W,W=this._zoneManager.setDOMHeight(C.height)||W,W&&(this._domNode.setWidth(this._zoneManager.getDOMWidth()),this._domNode.setHeight(this._zoneManager.getDOMHeight()),this._domNode.domNode.width=this._zoneManager.getCanvasWidth(),this._domNode.domNode.height=this._zoneManager.getCanvasHeight(),this._render())}setZones(C){this._zoneManager.setZones(C),this._render()}_render(){if(this._zoneManager.getOuterHeight()===0)return!1;const C=this._zoneManager.getCanvasWidth(),W=this._zoneManager.getCanvasHeight(),V=this._zoneManager.resolveColorZones(),U=this._zoneManager.getId2Color(),G=this._domNode.domNode.getContext("2d");return G.clearRect(0,0,C,W),V.length>0&&this._renderOneLane(G,V,U,C),!0}_renderOneLane(C,W,V,U){let G=0,Z=0,X=0;for(const Q of W){const J=Q.colorId,ee=Q.from,te=Q.to;J!==G?(C.fillRect(0,Z,U,X-Z),G=J,C.fillStyle=V[G],Z=ee,X=te):X>=ee?X=Math.max(X,te):(C.fillRect(0,Z,U,X-Z),Z=ee,X=te)}C.fillRect(0,Z,U,X-Z)}}const rulers="";class Rulers extends ViewPart{constructor(C){super(C),this.domNode=createFastDomNode(document.createElement("div")),this.domNode.setAttribute("role","presentation"),this.domNode.setAttribute("aria-hidden","true"),this.domNode.setClassName("view-rulers"),this._renderedRulers=[];const W=this._context.configuration.options;this._rulers=W.get(101),this._typicalHalfwidthCharacterWidth=W.get(50).typicalHalfwidthCharacterWidth}dispose(){super.dispose()}onConfigurationChanged(C){const W=this._context.configuration.options;return this._rulers=W.get(101),this._typicalHalfwidthCharacterWidth=W.get(50).typicalHalfwidthCharacterWidth,!0}onScrollChanged(C){return C.scrollHeightChanged}prepareRender(C){}_ensureRulersCount(){const C=this._renderedRulers.length,W=this._rulers.length;if(C===W)return;if(C<W){const{tabSize:U}=this._context.viewModel.model.getOptions(),G=U;let Z=W-C;for(;Z>0;){const X=createFastDomNode(document.createElement("div"));X.setClassName("view-ruler"),X.setWidth(G),this.domNode.appendChild(X),this._renderedRulers.push(X),Z--}return}let V=C-W;for(;V>0;){const U=this._renderedRulers.pop();this.domNode.removeChild(U),V--}}render(C){this._ensureRulersCount();for(let W=0,V=this._rulers.length;W<V;W++){const U=this._renderedRulers[W],G=this._rulers[W];U.setBoxShadow(G.color?`1px 0 0 0 ${G.color} inset`:""),U.setHeight(Math.min(C.scrollHeight,1e6)),U.setLeft(G.column*this._typicalHalfwidthCharacterWidth)}}}const scrollDecoration="";class ScrollDecorationViewPart extends ViewPart{constructor(C){super(C),this._scrollTop=0,this._width=0,this._updateWidth(),this._shouldShow=!1;const V=this._context.configuration.options.get(102);this._useShadows=V.useShadows,this._domNode=createFastDomNode(document.createElement("div")),this._domNode.setAttribute("role","presentation"),this._domNode.setAttribute("aria-hidden","true")}dispose(){super.dispose()}_updateShouldShow(){const C=this._useShadows&&this._scrollTop>0;return this._shouldShow!==C?(this._shouldShow=C,!0):!1}getDomNode(){return this._domNode}_updateWidth(){const W=this._context.configuration.options.get(143);W.minimap.renderMinimap===0||W.minimap.minimapWidth>0&&W.minimap.minimapLeft===0?this._width=W.width:this._width=W.width-W.verticalScrollbarWidth}onConfigurationChanged(C){const V=this._context.configuration.options.get(102);return this._useShadows=V.useShadows,this._updateWidth(),this._updateShouldShow(),!0}onScrollChanged(C){return this._scrollTop=C.scrollTop,this._updateShouldShow()}prepareRender(C){}render(C){this._domNode.setWidth(this._width),this._domNode.setClassName(this._shouldShow?"scroll-decoration":"")}}const selections="";class HorizontalRangeWithStyle{constructor(C){this.left=C.left,this.width=C.width,this.startStyle=null,this.endStyle=null}}class LineVisibleRangesWithStyle{constructor(C,W){this.lineNumber=C,this.ranges=W}}function toStyledRange(K){return new HorizontalRangeWithStyle(K)}function toStyled(K){return new LineVisibleRangesWithStyle(K.lineNumber,K.ranges.map(toStyledRange))}class SelectionsOverlay extends DynamicViewOverlay{constructor(C){super(),this._previousFrameVisibleRangesWithStyle=[],this._context=C;const W=this._context.configuration.options;this._lineHeight=W.get(66),this._roundedSelection=W.get(100),this._typicalHalfwidthCharacterWidth=W.get(50).typicalHalfwidthCharacterWidth,this._selections=[],this._renderResult=null,this._context.addEventHandler(this)}dispose(){this._context.removeEventHandler(this),this._renderResult=null,super.dispose()}onConfigurationChanged(C){const W=this._context.configuration.options;return this._lineHeight=W.get(66),this._roundedSelection=W.get(100),this._typicalHalfwidthCharacterWidth=W.get(50).typicalHalfwidthCharacterWidth,!0}onCursorStateChanged(C){return this._selections=C.selections.slice(0),!0}onDecorationsChanged(C){return!0}onFlushed(C){return!0}onLinesChanged(C){return!0}onLinesDeleted(C){return!0}onLinesInserted(C){return!0}onScrollChanged(C){return C.scrollTopChanged}onZonesChanged(C){return!0}_visibleRangesHaveGaps(C){for(let W=0,V=C.length;W<V;W++)if(C[W].ranges.length>1)return!0;return!1}_enrichVisibleRangesWithStyle(C,W,V){const U=this._typicalHalfwidthCharacterWidth/4;let G=null,Z=null;if(V&&V.length>0&&W.length>0){const X=W[0].lineNumber;if(X===C.startLineNumber)for(let J=0;!G&&J<V.length;J++)V[J].lineNumber===X&&(G=V[J].ranges[0]);const Q=W[W.length-1].lineNumber;if(Q===C.endLineNumber)for(let J=V.length-1;!Z&&J>=0;J--)V[J].lineNumber===Q&&(Z=V[J].ranges[0]);G&&!G.startStyle&&(G=null),Z&&!Z.startStyle&&(Z=null)}for(let X=0,Q=W.length;X<Q;X++){const J=W[X].ranges[0],ee=J.left,te=J.left+J.width,ie={top:0,bottom:0},ne={top:0,bottom:0};if(X>0){const oe=W[X-1].ranges[0].left,re=W[X-1].ranges[0].left+W[X-1].ranges[0].width;abs(ee-oe)<U?ie.top=2:ee>oe&&(ie.top=1),abs(te-re)<U?ne.top=2:oe<te&&te<re&&(ne.top=1)}else G&&(ie.top=G.startStyle.top,ne.top=G.endStyle.top);if(X+1<Q){const oe=W[X+1].ranges[0].left,re=W[X+1].ranges[0].left+W[X+1].ranges[0].width;abs(ee-oe)<U?ie.bottom=2:oe<ee&&ee<re&&(ie.bottom=1),abs(te-re)<U?ne.bottom=2:te<re&&(ne.bottom=1)}else Z&&(ie.bottom=Z.startStyle.bottom,ne.bottom=Z.endStyle.bottom);J.startStyle=ie,J.endStyle=ne}}_getVisibleRangesWithStyle(C,W,V){const G=(W.linesVisibleRangesForRange(C,!0)||[]).map(toStyled);return!this._visibleRangesHaveGaps(G)&&this._roundedSelection&&this._enrichVisibleRangesWithStyle(W.visibleRange,G,V),G}_createSelectionPiece(C,W,V,U,G){return'<div class="cslr '+V+'" style="top:'+C.toString()+"px;left:"+U.toString()+"px;width:"+G.toString()+"px;height:"+W+'px;"></div>'}_actualRenderOneSelection(C,W,V,U){if(U.length===0)return;const G=!!U[0].ranges[0].startStyle,Z=this._lineHeight.toString(),X=(this._lineHeight-1).toString(),Q=U[0].lineNumber,J=U[U.length-1].lineNumber;for(let ee=0,te=U.length;ee<te;ee++){const ie=U[ee],ne=ie.lineNumber,oe=ne-W,re=V&&(ne===J||ne===Q)?X:Z,ae=V&&ne===Q?1:0;let se="",le="";for(let ce=0,de=ie.ranges.length;ce<de;ce++){const ue=ie.ranges[ce];if(G){const he=ue.startStyle,fe=ue.endStyle;if(he.top===1||he.bottom===1){se+=this._createSelectionPiece(ae,re,SelectionsOverlay.SELECTION_CLASS_NAME,ue.left-SelectionsOverlay.ROUNDED_PIECE_WIDTH,SelectionsOverlay.ROUNDED_PIECE_WIDTH);let pe=SelectionsOverlay.EDITOR_BACKGROUND_CLASS_NAME;he.top===1&&(pe+=" "+SelectionsOverlay.SELECTION_TOP_RIGHT),he.bottom===1&&(pe+=" "+SelectionsOverlay.SELECTION_BOTTOM_RIGHT),se+=this._createSelectionPiece(ae,re,pe,ue.left-SelectionsOverlay.ROUNDED_PIECE_WIDTH,SelectionsOverlay.ROUNDED_PIECE_WIDTH)}if(fe.top===1||fe.bottom===1){se+=this._createSelectionPiece(ae,re,SelectionsOverlay.SELECTION_CLASS_NAME,ue.left+ue.width,SelectionsOverlay.ROUNDED_PIECE_WIDTH);let pe=SelectionsOverlay.EDITOR_BACKGROUND_CLASS_NAME;fe.top===1&&(pe+=" "+SelectionsOverlay.SELECTION_TOP_LEFT),fe.bottom===1&&(pe+=" "+SelectionsOverlay.SELECTION_BOTTOM_LEFT),se+=this._createSelectionPiece(ae,re,pe,ue.left+ue.width,SelectionsOverlay.ROUNDED_PIECE_WIDTH)}}let ge=SelectionsOverlay.SELECTION_CLASS_NAME;if(G){const he=ue.startStyle,fe=ue.endStyle;he.top===0&&(ge+=" "+SelectionsOverlay.SELECTION_TOP_LEFT),he.bottom===0&&(ge+=" "+SelectionsOverlay.SELECTION_BOTTOM_LEFT),fe.top===0&&(ge+=" "+SelectionsOverlay.SELECTION_TOP_RIGHT),fe.bottom===0&&(ge+=" "+SelectionsOverlay.SELECTION_BOTTOM_RIGHT)}le+=this._createSelectionPiece(ae,re,ge,ue.left,ue.width)}C[oe][0]+=se,C[oe][1]+=le}}prepareRender(C){const W=[],V=C.visibleRange.startLineNumber,U=C.visibleRange.endLineNumber;for(let Z=V;Z<=U;Z++){const X=Z-V;W[X]=["",""]}const G=[];for(let Z=0,X=this._selections.length;Z<X;Z++){const Q=this._selections[Z];if(Q.isEmpty()){G[Z]=null;continue}const J=this._getVisibleRangesWithStyle(Q,C,this._previousFrameVisibleRangesWithStyle[Z]);G[Z]=J,this._actualRenderOneSelection(W,V,this._selections.length>1,J)}this._previousFrameVisibleRangesWithStyle=G,this._renderResult=W.map(([Z,X])=>Z+X)}render(C,W){if(!this._renderResult)return"";const V=W-C;return V<0||V>=this._renderResult.length?"":this._renderResult[V]}}SelectionsOverlay.SELECTION_CLASS_NAME="selected-text";SelectionsOverlay.SELECTION_TOP_LEFT="top-left-radius";SelectionsOverlay.SELECTION_BOTTOM_LEFT="bottom-left-radius";SelectionsOverlay.SELECTION_TOP_RIGHT="top-right-radius";SelectionsOverlay.SELECTION_BOTTOM_RIGHT="bottom-right-radius";SelectionsOverlay.EDITOR_BACKGROUND_CLASS_NAME="monaco-editor-background";SelectionsOverlay.ROUNDED_PIECE_WIDTH=10;registerThemingParticipant((K,C)=>{const W=K.getColor(editorSelectionForeground);W&&!W.isTransparent()&&C.addRule(`.monaco-editor .view-line span.inline-selected-text { color: ${W}; }`)});function abs(K){return K<0?-K:K}const viewCursors="";class ViewCursorRenderData{constructor(C,W,V,U,G,Z,X){this.top=C,this.left=W,this.paddingLeft=V,this.width=U,this.height=G,this.textContent=Z,this.textContentClassName=X}}class ViewCursor{constructor(C){this._context=C;const W=this._context.configuration.options,V=W.get(50);this._cursorStyle=W.get(28),this._lineHeight=W.get(66),this._typicalHalfwidthCharacterWidth=V.typicalHalfwidthCharacterWidth,this._lineCursorWidth=Math.min(W.get(31),this._typicalHalfwidthCharacterWidth),this._isVisible=!0,this._domNode=createFastDomNode(document.createElement("div")),this._domNode.setClassName(`cursor ${MOUSE_CURSOR_TEXT_CSS_CLASS_NAME}`),this._domNode.setHeight(this._lineHeight),this._domNode.setTop(0),this._domNode.setLeft(0),applyFontInfo(this._domNode,V),this._domNode.setDisplay("none"),this._position=new Position$1(1,1),this._lastRenderedContent="",this._renderData=null}getDomNode(){return this._domNode}getPosition(){return this._position}show(){this._isVisible||(this._domNode.setVisibility("inherit"),this._isVisible=!0)}hide(){this._isVisible&&(this._domNode.setVisibility("hidden"),this._isVisible=!1)}onConfigurationChanged(C){const W=this._context.configuration.options,V=W.get(50);return this._cursorStyle=W.get(28),this._lineHeight=W.get(66),this._typicalHalfwidthCharacterWidth=V.typicalHalfwidthCharacterWidth,this._lineCursorWidth=Math.min(W.get(31),this._typicalHalfwidthCharacterWidth),applyFontInfo(this._domNode,V),!0}onCursorPositionChanged(C,W){return W?this._domNode.domNode.style.transitionProperty="none":this._domNode.domNode.style.transitionProperty="",this._position=C,!0}_getGraphemeAwarePosition(){const{lineNumber:C,column:W}=this._position,V=this._context.viewModel.getLineContent(C),[U,G]=getCharContainingOffset(V,W-1);return[new Position$1(C,U+1),V.substring(U,G)]}_prepareRender(C){let W="",V="";const[U,G]=this._getGraphemeAwarePosition();if(this._cursorStyle===TextEditorCursorStyle$1.Line||this._cursorStyle===TextEditorCursorStyle$1.LineThin){const ie=C.visibleRangeForPosition(U);if(!ie||ie.outsideRenderedLine)return null;let ne;this._cursorStyle===TextEditorCursorStyle$1.Line?(ne=computeScreenAwareSize(this._lineCursorWidth>0?this._lineCursorWidth:2),ne>2&&(W=G,V=this._getTokenClassName(U))):ne=computeScreenAwareSize(1);let oe=ie.left,re=0;ne>=2&&oe>=1&&(re=1,oe-=re);const ae=C.getVerticalOffsetForLineNumber(U.lineNumber)-C.bigNumbersDelta;return new ViewCursorRenderData(ae,oe,re,ne,this._lineHeight,W,V)}const Z=C.linesVisibleRangesForRange(new Range$2(U.lineNumber,U.column,U.lineNumber,U.column+G.length),!1);if(!Z||Z.length===0)return null;const X=Z[0];if(X.outsideRenderedLine||X.ranges.length===0)return null;const Q=X.ranges[0],J=G==="	"?this._typicalHalfwidthCharacterWidth:Q.width<1?this._typicalHalfwidthCharacterWidth:Q.width;this._cursorStyle===TextEditorCursorStyle$1.Block&&(W=G,V=this._getTokenClassName(U));let ee=C.getVerticalOffsetForLineNumber(U.lineNumber)-C.bigNumbersDelta,te=this._lineHeight;return(this._cursorStyle===TextEditorCursorStyle$1.Underline||this._cursorStyle===TextEditorCursorStyle$1.UnderlineThin)&&(ee+=this._lineHeight-2,te=2),new ViewCursorRenderData(ee,Q.left,0,J,te,W,V)}_getTokenClassName(C){const W=this._context.viewModel.getViewLineData(C.lineNumber),V=W.tokens.findTokenIndexAtOffset(C.column-1);return W.tokens.getClassName(V)}prepareRender(C){this._renderData=this._prepareRender(C)}render(C){return this._renderData?(this._lastRenderedContent!==this._renderData.textContent&&(this._lastRenderedContent=this._renderData.textContent,this._domNode.domNode.textContent=this._lastRenderedContent),this._domNode.setClassName(`cursor ${MOUSE_CURSOR_TEXT_CSS_CLASS_NAME} ${this._renderData.textContentClassName}`),this._domNode.setDisplay("block"),this._domNode.setTop(this._renderData.top),this._domNode.setLeft(this._renderData.left),this._domNode.setPaddingLeft(this._renderData.paddingLeft),this._domNode.setWidth(this._renderData.width),this._domNode.setLineHeight(this._renderData.height),this._domNode.setHeight(this._renderData.height),{domNode:this._domNode.domNode,position:this._position,contentLeft:this._renderData.left,height:this._renderData.height,width:2}):(this._domNode.setDisplay("none"),null)}}class ViewCursors extends ViewPart{constructor(C){super(C);const W=this._context.configuration.options;this._readOnly=W.get(90),this._cursorBlinking=W.get(26),this._cursorStyle=W.get(28),this._cursorSmoothCaretAnimation=W.get(27),this._selectionIsEmpty=!0,this._isComposingInput=!1,this._isVisible=!1,this._primaryCursor=new ViewCursor(this._context),this._secondaryCursors=[],this._renderData=[],this._domNode=createFastDomNode(document.createElement("div")),this._domNode.setAttribute("role","presentation"),this._domNode.setAttribute("aria-hidden","true"),this._updateDomClassName(),this._domNode.appendChild(this._primaryCursor.getDomNode()),this._startCursorBlinkAnimation=new TimeoutTimer,this._cursorFlatBlinkInterval=new IntervalTimer,this._blinkingEnabled=!1,this._editorHasFocus=!1,this._updateBlinking()}dispose(){super.dispose(),this._startCursorBlinkAnimation.dispose(),this._cursorFlatBlinkInterval.dispose()}getDomNode(){return this._domNode}onCompositionStart(C){return this._isComposingInput=!0,this._updateBlinking(),!0}onCompositionEnd(C){return this._isComposingInput=!1,this._updateBlinking(),!0}onConfigurationChanged(C){const W=this._context.configuration.options;this._readOnly=W.get(90),this._cursorBlinking=W.get(26),this._cursorStyle=W.get(28),this._cursorSmoothCaretAnimation=W.get(27),this._updateBlinking(),this._updateDomClassName(),this._primaryCursor.onConfigurationChanged(C);for(let V=0,U=this._secondaryCursors.length;V<U;V++)this._secondaryCursors[V].onConfigurationChanged(C);return!0}_onCursorPositionChanged(C,W,V){const U=this._secondaryCursors.length!==W.length||this._cursorSmoothCaretAnimation==="explicit"&&V!==3;if(this._primaryCursor.onCursorPositionChanged(C,U),this._updateBlinking(),this._secondaryCursors.length<W.length){const G=W.length-this._secondaryCursors.length;for(let Z=0;Z<G;Z++){const X=new ViewCursor(this._context);this._domNode.domNode.insertBefore(X.getDomNode().domNode,this._primaryCursor.getDomNode().domNode.nextSibling),this._secondaryCursors.push(X)}}else if(this._secondaryCursors.length>W.length){const G=this._secondaryCursors.length-W.length;for(let Z=0;Z<G;Z++)this._domNode.removeChild(this._secondaryCursors[0].getDomNode()),this._secondaryCursors.splice(0,1)}for(let G=0;G<W.length;G++)this._secondaryCursors[G].onCursorPositionChanged(W[G],U)}onCursorStateChanged(C){const W=[];for(let U=0,G=C.selections.length;U<G;U++)W[U]=C.selections[U].getPosition();this._onCursorPositionChanged(W[0],W.slice(1),C.reason);const V=C.selections[0].isEmpty();return this._selectionIsEmpty!==V&&(this._selectionIsEmpty=V,this._updateDomClassName()),!0}onDecorationsChanged(C){return!0}onFlushed(C){return!0}onFocusChanged(C){return this._editorHasFocus=C.isFocused,this._updateBlinking(),!1}onLinesChanged(C){return!0}onLinesDeleted(C){return!0}onLinesInserted(C){return!0}onScrollChanged(C){return!0}onTokensChanged(C){const W=V=>{for(let U=0,G=C.ranges.length;U<G;U++)if(C.ranges[U].fromLineNumber<=V.lineNumber&&V.lineNumber<=C.ranges[U].toLineNumber)return!0;return!1};if(W(this._primaryCursor.getPosition()))return!0;for(const V of this._secondaryCursors)if(W(V.getPosition()))return!0;return!1}onZonesChanged(C){return!0}_getCursorBlinking(){return this._isComposingInput||!this._editorHasFocus?0:this._readOnly?5:this._cursorBlinking}_updateBlinking(){this._startCursorBlinkAnimation.cancel(),this._cursorFlatBlinkInterval.cancel();const C=this._getCursorBlinking(),W=C===0,V=C===5;W?this._hide():this._show(),this._blinkingEnabled=!1,this._updateDomClassName(),!W&&!V&&(C===1?this._cursorFlatBlinkInterval.cancelAndSet(()=>{this._isVisible?this._hide():this._show()},ViewCursors.BLINK_INTERVAL):this._startCursorBlinkAnimation.setIfNotSet(()=>{this._blinkingEnabled=!0,this._updateDomClassName()},ViewCursors.BLINK_INTERVAL))}_updateDomClassName(){this._domNode.setClassName(this._getClassName())}_getClassName(){let C="cursors-layer";switch(this._selectionIsEmpty||(C+=" has-selection"),this._cursorStyle){case TextEditorCursorStyle$1.Line:C+=" cursor-line-style";break;case TextEditorCursorStyle$1.Block:C+=" cursor-block-style";break;case TextEditorCursorStyle$1.Underline:C+=" cursor-underline-style";break;case TextEditorCursorStyle$1.LineThin:C+=" cursor-line-thin-style";break;case TextEditorCursorStyle$1.BlockOutline:C+=" cursor-block-outline-style";break;case TextEditorCursorStyle$1.UnderlineThin:C+=" cursor-underline-thin-style";break;default:C+=" cursor-line-style"}if(this._blinkingEnabled)switch(this._getCursorBlinking()){case 1:C+=" cursor-blink";break;case 2:C+=" cursor-smooth";break;case 3:C+=" cursor-phase";break;case 4:C+=" cursor-expand";break;case 5:C+=" cursor-solid";break;default:C+=" cursor-solid"}else C+=" cursor-solid";return(this._cursorSmoothCaretAnimation==="on"||this._cursorSmoothCaretAnimation==="explicit")&&(C+=" cursor-smooth-caret-animation"),C}_show(){this._primaryCursor.show();for(let C=0,W=this._secondaryCursors.length;C<W;C++)this._secondaryCursors[C].show();this._isVisible=!0}_hide(){this._primaryCursor.hide();for(let C=0,W=this._secondaryCursors.length;C<W;C++)this._secondaryCursors[C].hide();this._isVisible=!1}prepareRender(C){this._primaryCursor.prepareRender(C);for(let W=0,V=this._secondaryCursors.length;W<V;W++)this._secondaryCursors[W].prepareRender(C)}render(C){const W=[];let V=0;const U=this._primaryCursor.render(C);U&&(W[V++]=U);for(let G=0,Z=this._secondaryCursors.length;G<Z;G++){const X=this._secondaryCursors[G].render(C);X&&(W[V++]=X)}this._renderData=W}getLastRenderData(){return this._renderData}}ViewCursors.BLINK_INTERVAL=500;registerThemingParticipant((K,C)=>{const W=K.getColor(editorCursorForeground);if(W){let V=K.getColor(editorCursorBackground);V||(V=W.opposite()),C.addRule(`.monaco-editor .cursors-layer .cursor { background-color: ${W}; border-color: ${W}; color: ${V}; }`),isHighContrast(K.type)&&C.addRule(`.monaco-editor .cursors-layer.has-selection .cursor { border-left: 1px solid ${V}; border-right: 1px solid ${V}; }`)}});const invalidFunc$1=()=>{throw new Error("Invalid change accessor")};class ViewZones extends ViewPart{constructor(C){super(C);const W=this._context.configuration.options,V=W.get(143);this._lineHeight=W.get(66),this._contentWidth=V.contentWidth,this._contentLeft=V.contentLeft,this.domNode=createFastDomNode(document.createElement("div")),this.domNode.setClassName("view-zones"),this.domNode.setPosition("absolute"),this.domNode.setAttribute("role","presentation"),this.domNode.setAttribute("aria-hidden","true"),this.marginDomNode=createFastDomNode(document.createElement("div")),this.marginDomNode.setClassName("margin-view-zones"),this.marginDomNode.setPosition("absolute"),this.marginDomNode.setAttribute("role","presentation"),this.marginDomNode.setAttribute("aria-hidden","true"),this._zones={}}dispose(){super.dispose(),this._zones={}}_recomputeWhitespacesProps(){const C=this._context.viewLayout.getWhitespaces(),W=new Map;for(const U of C)W.set(U.id,U);let V=!1;return this._context.viewModel.changeWhitespace(U=>{const G=Object.keys(this._zones);for(let Z=0,X=G.length;Z<X;Z++){const Q=G[Z],J=this._zones[Q],ee=this._computeWhitespaceProps(J.delegate);J.isInHiddenArea=ee.isInHiddenArea;const te=W.get(Q);te&&(te.afterLineNumber!==ee.afterViewLineNumber||te.height!==ee.heightInPx)&&(U.changeOneWhitespace(Q,ee.afterViewLineNumber,ee.heightInPx),this._safeCallOnComputedHeight(J.delegate,ee.heightInPx),V=!0)}}),V}onConfigurationChanged(C){const W=this._context.configuration.options,V=W.get(143);return this._lineHeight=W.get(66),this._contentWidth=V.contentWidth,this._contentLeft=V.contentLeft,C.hasChanged(66)&&this._recomputeWhitespacesProps(),!0}onLineMappingChanged(C){return this._recomputeWhitespacesProps()}onLinesDeleted(C){return!0}onScrollChanged(C){return C.scrollTopChanged||C.scrollWidthChanged}onZonesChanged(C){return!0}onLinesInserted(C){return!0}_getZoneOrdinal(C){var W,V;return(V=(W=C.ordinal)!==null&&W!==void 0?W:C.afterColumn)!==null&&V!==void 0?V:1e4}_computeWhitespaceProps(C){if(C.afterLineNumber===0)return{isInHiddenArea:!1,afterViewLineNumber:0,heightInPx:this._heightInPixels(C),minWidthInPx:this._minWidthInPixels(C)};let W;if(typeof C.afterColumn<"u")W=this._context.viewModel.model.validatePosition({lineNumber:C.afterLineNumber,column:C.afterColumn});else{const Z=this._context.viewModel.model.validatePosition({lineNumber:C.afterLineNumber,column:1}).lineNumber;W=new Position$1(Z,this._context.viewModel.model.getLineMaxColumn(Z))}let V;W.column===this._context.viewModel.model.getLineMaxColumn(W.lineNumber)?V=this._context.viewModel.model.validatePosition({lineNumber:W.lineNumber+1,column:1}):V=this._context.viewModel.model.validatePosition({lineNumber:W.lineNumber,column:W.column+1});const U=this._context.viewModel.coordinatesConverter.convertModelPositionToViewPosition(W,C.afterColumnAffinity,!0),G=C.showInHiddenAreas||this._context.viewModel.coordinatesConverter.modelPositionIsVisible(V);return{isInHiddenArea:!G,afterViewLineNumber:U.lineNumber,heightInPx:G?this._heightInPixels(C):0,minWidthInPx:this._minWidthInPixels(C)}}changeViewZones(C){let W=!1;return this._context.viewModel.changeWhitespace(V=>{const U={addZone:G=>(W=!0,this._addZone(V,G)),removeZone:G=>{G&&(W=this._removeZone(V,G)||W)},layoutZone:G=>{G&&(W=this._layoutZone(V,G)||W)}};safeInvoke1Arg(C,U),U.addZone=invalidFunc$1,U.removeZone=invalidFunc$1,U.layoutZone=invalidFunc$1}),W}_addZone(C,W){const V=this._computeWhitespaceProps(W),G={whitespaceId:C.insertWhitespace(V.afterViewLineNumber,this._getZoneOrdinal(W),V.heightInPx,V.minWidthInPx),delegate:W,isInHiddenArea:V.isInHiddenArea,isVisible:!1,domNode:createFastDomNode(W.domNode),marginDomNode:W.marginDomNode?createFastDomNode(W.marginDomNode):null};return this._safeCallOnComputedHeight(G.delegate,V.heightInPx),G.domNode.setPosition("absolute"),G.domNode.domNode.style.width="100%",G.domNode.setDisplay("none"),G.domNode.setAttribute("monaco-view-zone",G.whitespaceId),this.domNode.appendChild(G.domNode),G.marginDomNode&&(G.marginDomNode.setPosition("absolute"),G.marginDomNode.domNode.style.width="100%",G.marginDomNode.setDisplay("none"),G.marginDomNode.setAttribute("monaco-view-zone",G.whitespaceId),this.marginDomNode.appendChild(G.marginDomNode)),this._zones[G.whitespaceId]=G,this.setShouldRender(),G.whitespaceId}_removeZone(C,W){if(this._zones.hasOwnProperty(W)){const V=this._zones[W];return delete this._zones[W],C.removeWhitespace(V.whitespaceId),V.domNode.removeAttribute("monaco-visible-view-zone"),V.domNode.removeAttribute("monaco-view-zone"),V.domNode.domNode.parentNode.removeChild(V.domNode.domNode),V.marginDomNode&&(V.marginDomNode.removeAttribute("monaco-visible-view-zone"),V.marginDomNode.removeAttribute("monaco-view-zone"),V.marginDomNode.domNode.parentNode.removeChild(V.marginDomNode.domNode)),this.setShouldRender(),!0}return!1}_layoutZone(C,W){if(this._zones.hasOwnProperty(W)){const V=this._zones[W],U=this._computeWhitespaceProps(V.delegate);return V.isInHiddenArea=U.isInHiddenArea,C.changeOneWhitespace(V.whitespaceId,U.afterViewLineNumber,U.heightInPx),this._safeCallOnComputedHeight(V.delegate,U.heightInPx),this.setShouldRender(),!0}return!1}shouldSuppressMouseDownOnViewZone(C){return this._zones.hasOwnProperty(C)?!!this._zones[C].delegate.suppressMouseDown:!1}_heightInPixels(C){return typeof C.heightInPx=="number"?C.heightInPx:typeof C.heightInLines=="number"?this._lineHeight*C.heightInLines:this._lineHeight}_minWidthInPixels(C){return typeof C.minWidthInPx=="number"?C.minWidthInPx:0}_safeCallOnComputedHeight(C,W){if(typeof C.onComputedHeight=="function")try{C.onComputedHeight(W)}catch(V){onUnexpectedError(V)}}_safeCallOnDomNodeTop(C,W){if(typeof C.onDomNodeTop=="function")try{C.onDomNodeTop(W)}catch(V){onUnexpectedError(V)}}prepareRender(C){}render(C){const W=C.viewportData.whitespaceViewportData,V={};let U=!1;for(const Z of W)this._zones[Z.id].isInHiddenArea||(V[Z.id]=Z,U=!0);const G=Object.keys(this._zones);for(let Z=0,X=G.length;Z<X;Z++){const Q=G[Z],J=this._zones[Q];let ee=0,te=0,ie="none";V.hasOwnProperty(Q)?(ee=V[Q].verticalOffset-C.bigNumbersDelta,te=V[Q].height,ie="block",J.isVisible||(J.domNode.setAttribute("monaco-visible-view-zone","true"),J.isVisible=!0),this._safeCallOnDomNodeTop(J.delegate,C.getScrolledTopFromAbsoluteTop(V[Q].verticalOffset))):(J.isVisible&&(J.domNode.removeAttribute("monaco-visible-view-zone"),J.isVisible=!1),this._safeCallOnDomNodeTop(J.delegate,C.getScrolledTopFromAbsoluteTop(-1e6))),J.domNode.setTop(ee),J.domNode.setHeight(te),J.domNode.setDisplay(ie),J.marginDomNode&&(J.marginDomNode.setTop(ee),J.marginDomNode.setHeight(te),J.marginDomNode.setDisplay(ie))}U&&(this.domNode.setWidth(Math.max(C.scrollWidth,this._contentWidth)),this.marginDomNode.setWidth(this._contentLeft))}}function safeInvoke1Arg(K,C){try{return K(C)}catch(W){onUnexpectedError(W)}}class EditorTheme{get type(){return this._theme.type}get value(){return this._theme}constructor(C){this._theme=C}update(C){this._theme=C}getColor(C){return this._theme.getColor(C)}}class ViewContext{constructor(C,W,V){this.configuration=C,this.theme=new EditorTheme(W),this.viewModel=V,this.viewLayout=V.viewLayout}addEventHandler(C){this.viewModel.addViewEventHandler(C)}removeEventHandler(C){this.viewModel.removeViewEventHandler(C)}}class ViewportData{constructor(C,W,V,U){this.selections=C,this.startLineNumber=W.startLineNumber|0,this.endLineNumber=W.endLineNumber|0,this.relativeVerticalOffset=W.relativeVerticalOffset,this.bigNumbersDelta=W.bigNumbersDelta|0,this.whitespaceViewportData=V,this._model=U,this.visibleRange=new Range$2(W.startLineNumber,this._model.getLineMinColumn(W.startLineNumber),W.endLineNumber,this._model.getLineMaxColumn(W.endLineNumber))}getViewLineRenderingData(C){return this._model.getViewportViewLineRenderingData(this.visibleRange,C)}getDecorationsInViewport(){return this._model.getDecorationsInViewport(this.visibleRange)}}const blockDecorations="";class BlockDecorations extends ViewPart{constructor(C){super(C),this.blocks=[],this.contentWidth=-1,this.contentLeft=0,this.domNode=createFastDomNode(document.createElement("div")),this.domNode.setAttribute("role","presentation"),this.domNode.setAttribute("aria-hidden","true"),this.domNode.setClassName("blockDecorations-container"),this.update()}update(){let C=!1;const V=this._context.configuration.options.get(143),U=V.contentWidth-V.verticalScrollbarWidth;this.contentWidth!==U&&(this.contentWidth=U,C=!0);const G=V.contentLeft;return this.contentLeft!==G&&(this.contentLeft=G,C=!0),C}dispose(){super.dispose()}onConfigurationChanged(C){return this.update()}onScrollChanged(C){return C.scrollTopChanged||C.scrollLeftChanged}onDecorationsChanged(C){return!0}onZonesChanged(C){return!0}prepareRender(C){}render(C){var W;let V=0;const U=C.getDecorationsInViewport();for(const G of U){if(!G.options.blockClassName)continue;let Z=this.blocks[V];Z||(Z=this.blocks[V]=createFastDomNode(document.createElement("div")),this.domNode.appendChild(Z));let X,Q;G.options.blockIsAfterEnd?(X=C.getVerticalOffsetAfterLineNumber(G.range.endLineNumber,!1),Q=C.getVerticalOffsetAfterLineNumber(G.range.endLineNumber,!0)):(X=C.getVerticalOffsetForLineNumber(G.range.startLineNumber,!0),Q=G.range.isEmpty()&&!G.options.blockDoesNotCollapse?C.getVerticalOffsetForLineNumber(G.range.startLineNumber,!1):C.getVerticalOffsetAfterLineNumber(G.range.endLineNumber,!0));const[J,ee,te,ie]=(W=G.options.blockPadding)!==null&&W!==void 0?W:[0,0,0,0];Z.setClassName("blockDecorations-block "+G.options.blockClassName),Z.setLeft(this.contentLeft-ie),Z.setWidth(this.contentWidth+ie+ee),Z.setTop(X-C.scrollTop-J),Z.setHeight(Q-X+J+te),V++}for(let G=V;G<this.blocks.length;G++)this.blocks[G].domNode.remove();this.blocks.length=V}}const whitespace="";class WhitespaceOverlay extends DynamicViewOverlay{constructor(C){super(),this._context=C,this._options=new WhitespaceOptions(this._context.configuration),this._selection=[],this._renderResult=null,this._context.addEventHandler(this)}dispose(){this._context.removeEventHandler(this),this._renderResult=null,super.dispose()}onConfigurationChanged(C){const W=new WhitespaceOptions(this._context.configuration);return this._options.equals(W)?C.hasChanged(143):(this._options=W,!0)}onCursorStateChanged(C){return this._selection=C.selections,this._options.renderWhitespace==="selection"}onDecorationsChanged(C){return!0}onFlushed(C){return!0}onLinesChanged(C){return!0}onLinesDeleted(C){return!0}onLinesInserted(C){return!0}onScrollChanged(C){return C.scrollTopChanged}onZonesChanged(C){return!0}prepareRender(C){if(this._options.renderWhitespace==="none"){this._renderResult=null;return}const W=C.visibleRange.startLineNumber,U=C.visibleRange.endLineNumber-W+1,G=new Array(U);for(let X=0;X<U;X++)G[X]=!0;const Z=this._context.viewModel.getMinimapLinesRenderingData(C.viewportData.startLineNumber,C.viewportData.endLineNumber,G);this._renderResult=[];for(let X=C.viewportData.startLineNumber;X<=C.viewportData.endLineNumber;X++){const Q=X-C.viewportData.startLineNumber,J=Z.data[Q];let ee=null;if(this._options.renderWhitespace==="selection"){const te=this._selection;for(const ie of te){if(ie.endLineNumber<X||ie.startLineNumber>X)continue;const ne=ie.startLineNumber===X?ie.startColumn:J.minColumn,oe=ie.endLineNumber===X?ie.endColumn:J.maxColumn;ne<oe&&(ee||(ee=[]),ee.push(new LineRange(ne-1,oe-1)))}}this._renderResult[Q]=this._applyRenderWhitespace(C,X,ee,J)}}_applyRenderWhitespace(C,W,V,U){if(this._options.renderWhitespace==="selection"&&!V||this._options.renderWhitespace==="trailing"&&U.continuesWithWrappedLine)return"";const G=this._context.theme.getColor(editorWhitespaces),Z=this._options.renderWithSVG,X=U.content,Q=this._options.stopRenderingLineAfter===-1?X.length:Math.min(this._options.stopRenderingLineAfter,X.length),J=U.continuesWithWrappedLine,ee=U.minColumn-1,te=this._options.renderWhitespace==="boundary",ie=this._options.renderWhitespace==="trailing",ne=this._options.lineHeight,oe=this._options.middotWidth,re=this._options.wsmiddotWidth,ae=this._options.spaceWidth,se=Math.abs(re-ae),le=Math.abs(oe-ae),ce=se<le?11825:183,de=this._options.canUseHalfwidthRightwardsArrow;let ue="",ge=!1,he=firstNonWhitespaceIndex(X),fe;he===-1?(ge=!0,he=Q,fe=Q):fe=lastNonWhitespaceIndex(X);let pe=0,Se=V&&V[pe],Le=0;for(let be=ee;be<Q;be++){const Ce=X.charCodeAt(be);if(Se&&be>=Se.endOffset&&(pe++,Se=V&&V[pe]),Ce!==9&&Ce!==32||ie&&!ge&&be<=fe)continue;if(te&&be>=he&&be<=fe&&Ce===32){const ke=be-1>=0?X.charCodeAt(be-1):0,Me=be+1<Q?X.charCodeAt(be+1):0;if(ke!==32&&Me!==32)continue}if(te&&J&&be===Q-1){const ke=be-1>=0?X.charCodeAt(be-1):0;if(Ce===32&&ke!==32&&ke!==9)continue}if(V&&(!Se||Se.startOffset>be||Se.endOffset<=be))continue;const De=C.visibleRangeForPosition(new Position$1(W,be+1));De&&(Z?(Le=Math.max(Le,De.left),Ce===9?ue+=this._renderArrow(ne,ae,De.left):ue+=`<circle cx="${(De.left+ae/2).toFixed(2)}" cy="${(ne/2).toFixed(2)}" r="${(ae/7).toFixed(2)}" />`):Ce===9?ue+=`<div class="mwh" style="left:${De.left}px;height:${ne}px;">${de?String.fromCharCode(65515):String.fromCharCode(8594)}</div>`:ue+=`<div class="mwh" style="left:${De.left}px;height:${ne}px;">${String.fromCharCode(ce)}</div>`)}return Z?(Le=Math.round(Le+ae),`<svg style="position:absolute;width:${Le}px;height:${ne}px" viewBox="0 0 ${Le} ${ne}" xmlns="http://www.w3.org/2000/svg" fill="${G}">`+ue+"</svg>"):ue}_renderArrow(C,W,V){const U=W/7,G=W,Z=C/2,X=V,Q={x:0,y:U/2},J={x:100/125*G,y:Q.y},ee={x:J.x-.2*J.x,y:J.y+.2*J.x},te={x:ee.x+.1*J.x,y:ee.y+.1*J.x},ie={x:te.x+.35*J.x,y:te.y-.35*J.x},ne={x:ie.x,y:-ie.y},oe={x:te.x,y:-te.y},re={x:ee.x,y:-ee.y},ae={x:J.x,y:-J.y},se={x:Q.x,y:-Q.y};return`<path d="M ${[Q,J,ee,te,ie,ne,oe,re,ae,se].map(de=>`${(X+de.x).toFixed(2)} ${(Z+de.y).toFixed(2)}`).join(" L ")}" />`}render(C,W){if(!this._renderResult)return"";const V=W-C;return V<0||V>=this._renderResult.length?"":this._renderResult[V]}}class WhitespaceOptions{constructor(C){const W=C.options,V=W.get(50),U=W.get(38);U==="off"?(this.renderWhitespace="none",this.renderWithSVG=!1):U==="svg"?(this.renderWhitespace=W.get(98),this.renderWithSVG=!0):(this.renderWhitespace=W.get(98),this.renderWithSVG=!1),this.spaceWidth=V.spaceWidth,this.middotWidth=V.middotWidth,this.wsmiddotWidth=V.wsmiddotWidth,this.canUseHalfwidthRightwardsArrow=V.canUseHalfwidthRightwardsArrow,this.lineHeight=W.get(66),this.stopRenderingLineAfter=W.get(116)}equals(C){return this.renderWhitespace===C.renderWhitespace&&this.renderWithSVG===C.renderWithSVG&&this.spaceWidth===C.spaceWidth&&this.middotWidth===C.middotWidth&&this.wsmiddotWidth===C.wsmiddotWidth&&this.canUseHalfwidthRightwardsArrow===C.canUseHalfwidthRightwardsArrow&&this.lineHeight===C.lineHeight&&this.stopRenderingLineAfter===C.stopRenderingLineAfter}}var __decorate$22=globalThis&&globalThis.__decorate||function(K,C,W,V){var U=arguments.length,G=U<3?C:V===null?V=Object.getOwnPropertyDescriptor(C,W):V,Z;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")G=Reflect.decorate(K,C,W,V);else for(var X=K.length-1;X>=0;X--)(Z=K[X])&&(G=(U<3?Z(G):U>3?Z(C,W,G):Z(C,W))||G);return U>3&&G&&Object.defineProperty(C,W,G),G},__param$1Y=globalThis&&globalThis.__param||function(K,C){return function(W,V){C(W,V,K)}};let View$1=class extends ViewEventHandler{constructor(C,W,V,U,G,Z,X){super(),this._instantiationService=X,this._shouldRecomputeGlyphMarginLanes=!1,this._selections=[new Selection$1(1,1,1,1)],this._renderAnimationFrame=null;const Q=new ViewController(W,U,G,C);this._context=new ViewContext(W,V,U),this._context.addEventHandler(this),this._viewParts=[],this._textAreaHandler=this._instantiationService.createInstance(TextAreaHandler,this._context,Q,this._createTextAreaHandlerHelper()),this._viewParts.push(this._textAreaHandler),this._linesContent=createFastDomNode(document.createElement("div")),this._linesContent.setClassName("lines-content monaco-editor-background"),this._linesContent.setPosition("absolute"),this.domNode=createFastDomNode(document.createElement("div")),this.domNode.setClassName(this._getEditorClassName()),this.domNode.setAttribute("role","code"),this._overflowGuardContainer=createFastDomNode(document.createElement("div")),PartFingerprints.write(this._overflowGuardContainer,3),this._overflowGuardContainer.setClassName("overflow-guard"),this._scrollbar=new EditorScrollbar(this._context,this._linesContent,this.domNode,this._overflowGuardContainer),this._viewParts.push(this._scrollbar),this._viewLines=new ViewLines(this._context,this._linesContent),this._viewZones=new ViewZones(this._context),this._viewParts.push(this._viewZones);const J=new DecorationsOverviewRuler(this._context);this._viewParts.push(J);const ee=new ScrollDecorationViewPart(this._context);this._viewParts.push(ee);const te=new ContentViewOverlays(this._context);this._viewParts.push(te),te.addDynamicOverlay(new CurrentLineHighlightOverlay(this._context)),te.addDynamicOverlay(new SelectionsOverlay(this._context)),te.addDynamicOverlay(new IndentGuidesOverlay(this._context)),te.addDynamicOverlay(new DecorationsOverlay(this._context)),te.addDynamicOverlay(new WhitespaceOverlay(this._context));const ie=new MarginViewOverlays(this._context);this._viewParts.push(ie),ie.addDynamicOverlay(new CurrentLineMarginHighlightOverlay(this._context)),ie.addDynamicOverlay(new MarginViewLineDecorationsOverlay(this._context)),ie.addDynamicOverlay(new LinesDecorationsOverlay(this._context)),ie.addDynamicOverlay(new LineNumbersOverlay(this._context)),this._glyphMarginWidgets=new GlyphMarginWidgets(this._context),this._viewParts.push(this._glyphMarginWidgets);const ne=new Margin(this._context);ne.getDomNode().appendChild(this._viewZones.marginDomNode),ne.getDomNode().appendChild(ie.getDomNode()),ne.getDomNode().appendChild(this._glyphMarginWidgets.domNode),this._viewParts.push(ne),this._contentWidgets=new ViewContentWidgets(this._context,this.domNode),this._viewParts.push(this._contentWidgets),this._viewCursors=new ViewCursors(this._context),this._viewParts.push(this._viewCursors),this._overlayWidgets=new ViewOverlayWidgets(this._context),this._viewParts.push(this._overlayWidgets);const oe=new Rulers(this._context);this._viewParts.push(oe);const re=new BlockDecorations(this._context);this._viewParts.push(re);const ae=new Minimap(this._context);if(this._viewParts.push(ae),J){const se=this._scrollbar.getOverviewRulerLayoutInfo();se.parent.insertBefore(J.getDomNode(),se.insertBefore)}this._linesContent.appendChild(te.getDomNode()),this._linesContent.appendChild(oe.domNode),this._linesContent.appendChild(this._viewZones.domNode),this._linesContent.appendChild(this._viewLines.getDomNode()),this._linesContent.appendChild(this._contentWidgets.domNode),this._linesContent.appendChild(this._viewCursors.getDomNode()),this._overflowGuardContainer.appendChild(ne.getDomNode()),this._overflowGuardContainer.appendChild(this._scrollbar.getDomNode()),this._overflowGuardContainer.appendChild(ee.getDomNode()),this._overflowGuardContainer.appendChild(this._textAreaHandler.textArea),this._overflowGuardContainer.appendChild(this._textAreaHandler.textAreaCover),this._overflowGuardContainer.appendChild(this._overlayWidgets.getDomNode()),this._overflowGuardContainer.appendChild(ae.getDomNode()),this._overflowGuardContainer.appendChild(re.domNode),this.domNode.appendChild(this._overflowGuardContainer),Z?Z.appendChild(this._contentWidgets.overflowingContentWidgetsDomNode.domNode):this.domNode.appendChild(this._contentWidgets.overflowingContentWidgetsDomNode),this._applyLayout(),this._pointerHandler=this._register(new PointerHandler(this._context,Q,this._createPointerHandlerHelper()))}_flushAccumulatedAndRenderNow(){this._shouldRecomputeGlyphMarginLanes&&(this._shouldRecomputeGlyphMarginLanes=!1,this._context.configuration.setGlyphMarginDecorationLaneCount(this._computeGlyphMarginLaneCount())),inputLatency.onRenderStart(),this._renderNow()}_computeGlyphMarginLaneCount(){const C=this._context.viewModel.model;let W=[];W=W.concat(C.getAllMarginDecorations().map(G=>{var Z,X;const Q=(X=(Z=G.options.glyphMargin)===null||Z===void 0?void 0:Z.position)!==null&&X!==void 0?X:GlyphMarginLane.Left;return{range:G.range,lane:Q}})),W=W.concat(this._glyphMarginWidgets.getWidgets().map(G=>({range:C.validateRange(G.preference.range),lane:G.preference.lane}))),W.sort((G,Z)=>Range$2.compareRangesUsingStarts(G.range,Z.range));let V=null,U=null;for(const G of W)if(G.lane===GlyphMarginLane.Left&&(!V||Range$2.compareRangesUsingEnds(V,G.range)<0)&&(V=G.range),G.lane===GlyphMarginLane.Right&&(!U||Range$2.compareRangesUsingEnds(U,G.range)<0)&&(U=G.range),V&&U){if(V.endLineNumber<U.startLineNumber){V=null;continue}if(U.endLineNumber<V.startLineNumber){U=null;continue}return 2}return 1}_createPointerHandlerHelper(){return{viewDomNode:this.domNode.domNode,linesContentDomNode:this._linesContent.domNode,viewLinesDomNode:this._viewLines.getDomNode().domNode,focusTextArea:()=>{this.focus()},dispatchTextAreaEvent:C=>{this._textAreaHandler.textArea.domNode.dispatchEvent(C)},getLastRenderData:()=>{const C=this._viewCursors.getLastRenderData()||[],W=this._textAreaHandler.getLastRenderData();return new PointerHandlerLastRenderData(C,W)},renderNow:()=>{this.render(!0,!1)},shouldSuppressMouseDownOnViewZone:C=>this._viewZones.shouldSuppressMouseDownOnViewZone(C),shouldSuppressMouseDownOnWidget:C=>this._contentWidgets.shouldSuppressMouseDownOnWidget(C),getPositionFromDOMInfo:(C,W)=>(this._flushAccumulatedAndRenderNow(),this._viewLines.getPositionFromDOMInfo(C,W)),visibleRangeForPosition:(C,W)=>(this._flushAccumulatedAndRenderNow(),this._viewLines.visibleRangeForPosition(new Position$1(C,W))),getLineWidth:C=>(this._flushAccumulatedAndRenderNow(),this._viewLines.getLineWidth(C))}}_createTextAreaHandlerHelper(){return{visibleRangeForPosition:C=>(this._flushAccumulatedAndRenderNow(),this._viewLines.visibleRangeForPosition(C))}}_applyLayout(){const W=this._context.configuration.options.get(143);this.domNode.setWidth(W.width),this.domNode.setHeight(W.height),this._overflowGuardContainer.setWidth(W.width),this._overflowGuardContainer.setHeight(W.height),this._linesContent.setWidth(1e6),this._linesContent.setHeight(1e6)}_getEditorClassName(){const C=this._textAreaHandler.isFocused()?" focused":"";return this._context.configuration.options.get(140)+" "+getThemeTypeSelector(this._context.theme.type)+C}handleEvents(C){super.handleEvents(C),this._scheduleRender()}onConfigurationChanged(C){return this.domNode.setClassName(this._getEditorClassName()),this._applyLayout(),!1}onCursorStateChanged(C){return this._selections=C.selections,!1}onDecorationsChanged(C){return C.affectsGlyphMargin&&(this._shouldRecomputeGlyphMarginLanes=!0),!1}onFocusChanged(C){return this.domNode.setClassName(this._getEditorClassName()),!1}onThemeChanged(C){return this._context.theme.update(C.theme),this.domNode.setClassName(this._getEditorClassName()),!1}dispose(){this._renderAnimationFrame!==null&&(this._renderAnimationFrame.dispose(),this._renderAnimationFrame=null),this._contentWidgets.overflowingContentWidgetsDomNode.domNode.remove(),this._context.removeEventHandler(this),this._viewLines.dispose();for(const C of this._viewParts)C.dispose();super.dispose()}_scheduleRender(){this._renderAnimationFrame===null&&(this._renderAnimationFrame=runAtThisOrScheduleAtNextAnimationFrame(this._onRenderScheduled.bind(this),100))}_onRenderScheduled(){this._renderAnimationFrame=null,this._flushAccumulatedAndRenderNow()}_renderNow(){safeInvokeNoArg(()=>this._actualRender())}_getViewPartsToRender(){const C=[];let W=0;for(const V of this._viewParts)V.shouldRender()&&(C[W++]=V);return C}_actualRender(){if(!isInDOM(this.domNode.domNode))return;let C=this._getViewPartsToRender();if(!this._viewLines.shouldRender()&&C.length===0)return;const W=this._context.viewLayout.getLinesViewportData();this._context.viewModel.setViewport(W.startLineNumber,W.endLineNumber,W.centeredLineNumber);const V=new ViewportData(this._selections,W,this._context.viewLayout.getWhitespaceViewportData(),this._context.viewModel);this._contentWidgets.shouldRender()&&this._contentWidgets.onBeforeRender(V),this._viewLines.shouldRender()&&(this._viewLines.renderText(V),this._viewLines.onDidRender(),C=this._getViewPartsToRender());const U=new RenderingContext(this._context.viewLayout,V,this._viewLines);for(const G of C)G.prepareRender(U);for(const G of C)G.render(U),G.onDidRender()}delegateVerticalScrollbarPointerDown(C){this._scrollbar.delegateVerticalScrollbarPointerDown(C)}delegateScrollFromMouseWheelEvent(C){this._scrollbar.delegateScrollFromMouseWheelEvent(C)}restoreState(C){this._context.viewModel.viewLayout.setScrollPosition({scrollTop:C.scrollTop,scrollLeft:C.scrollLeft},1),this._context.viewModel.visibleLinesStabilized()}getOffsetForColumn(C,W){const V=this._context.viewModel.model.validatePosition({lineNumber:C,column:W}),U=this._context.viewModel.coordinatesConverter.convertModelPositionToViewPosition(V);this._flushAccumulatedAndRenderNow();const G=this._viewLines.visibleRangeForPosition(new Position$1(U.lineNumber,U.column));return G?G.left:-1}getTargetAtClientPoint(C,W){const V=this._pointerHandler.getTargetAtClientPoint(C,W);return V?ViewUserInputEvents.convertViewToModelMouseTarget(V,this._context.viewModel.coordinatesConverter):null}createOverviewRuler(C){return new OverviewRuler(this._context,C)}change(C){this._viewZones.changeViewZones(C),this._scheduleRender()}render(C,W){if(W){this._viewLines.forceShouldRender();for(const V of this._viewParts)V.forceShouldRender()}C?this._flushAccumulatedAndRenderNow():this._scheduleRender()}writeScreenReaderContent(C){this._textAreaHandler.writeScreenReaderContent(C)}focus(){this._textAreaHandler.focusTextArea()}isFocused(){return this._textAreaHandler.isFocused()}setAriaOptions(C){this._textAreaHandler.setAriaOptions(C)}addContentWidget(C){this._contentWidgets.addWidget(C.widget),this.layoutContentWidget(C),this._scheduleRender()}layoutContentWidget(C){var W,V,U,G,Z,X,Q,J;this._contentWidgets.setWidgetPosition(C.widget,(V=(W=C.position)===null||W===void 0?void 0:W.position)!==null&&V!==void 0?V:null,(G=(U=C.position)===null||U===void 0?void 0:U.secondaryPosition)!==null&&G!==void 0?G:null,(X=(Z=C.position)===null||Z===void 0?void 0:Z.preference)!==null&&X!==void 0?X:null,(J=(Q=C.position)===null||Q===void 0?void 0:Q.positionAffinity)!==null&&J!==void 0?J:null),this._scheduleRender()}removeContentWidget(C){this._contentWidgets.removeWidget(C.widget),this._scheduleRender()}addOverlayWidget(C){this._overlayWidgets.addWidget(C.widget),this.layoutOverlayWidget(C),this._scheduleRender()}layoutOverlayWidget(C){const W=C.position?C.position.preference:null;this._overlayWidgets.setWidgetPosition(C.widget,W)&&this._scheduleRender()}removeOverlayWidget(C){this._overlayWidgets.removeWidget(C.widget),this._scheduleRender()}addGlyphMarginWidget(C){this._glyphMarginWidgets.addWidget(C.widget),this._shouldRecomputeGlyphMarginLanes=!0,this._scheduleRender()}layoutGlyphMarginWidget(C){const W=C.position;this._glyphMarginWidgets.setWidgetPosition(C.widget,W)&&(this._shouldRecomputeGlyphMarginLanes=!0,this._scheduleRender())}removeGlyphMarginWidget(C){this._glyphMarginWidgets.removeWidget(C.widget),this._shouldRecomputeGlyphMarginLanes=!0,this._scheduleRender()}};View$1=__decorate$22([__param$1Y(6,IInstantiationService)],View$1);function safeInvokeNoArg(K){try{return K()}catch(C){onUnexpectedError(C)}}class InternalEditorAction{constructor(C,W,V,U,G,Z){this.id=C,this.label=W,this.alias=V,this._precondition=U,this._run=G,this._contextKeyService=Z}isSupported(){return this._contextKeyService.contextMatchesRules(this._precondition)}run(C){return this.isSupported()?this._run(C):Promise.resolve(void 0)}}function countEOL(K){let C=0,W=0,V=0,U=0;for(let G=0,Z=K.length;G<Z;G++){const X=K.charCodeAt(G);X===13?(C===0&&(W=G),C++,G+1<Z&&K.charCodeAt(G+1)===10?(U|=2,G++):U|=3,V=G+1):X===10&&(U|=1,C===0&&(W=G),C++,V=G+1)}return C===0&&(W=K.length),[C,W,K.length-V,U]}class BracketInfo{constructor(C,W,V,U){this.range=C,this.nestingLevel=W,this.nestingLevelOfEqualBracketType=V,this.isInvalid=U}}class BracketPairInfo{constructor(C,W,V,U,G,Z){this.range=C,this.openingBracketRange=W,this.closingBracketRange=V,this.nestingLevel=U,this.nestingLevelOfEqualBracketType=G,this.bracketPairNode=Z}get openingBracketInfo(){return this.bracketPairNode.openingBracket.bracketInfo}}class BracketPairWithMinIndentationInfo extends BracketPairInfo{constructor(C,W,V,U,G,Z,X){super(C,W,V,U,G,Z),this.minVisibleColumnIndentation=X}}class LengthObj{constructor(C,W){this.lineCount=C,this.columnCount=W}toString(){return`${this.lineCount},${this.columnCount}`}}LengthObj.zero=new LengthObj(0,0);function lengthDiff(K,C,W,V){return K!==W?toLength(W-K,V):toLength(0,V-C)}const lengthZero=0;function lengthIsZero(K){return K===0}const factor=Math.pow(2,26);function toLength(K,C){return K*factor+C}function lengthToObj(K){const C=K,W=Math.floor(C/factor),V=C-W*factor;return new LengthObj(W,V)}function lengthGetLineCount(K){return Math.floor(K/factor)}function lengthGetColumnCountIfZeroLineCount(K){return K}function lengthAdd(K,C){let W=K+C;return C>=factor&&(W=W-K%factor),W}function sumLengths(K,C){return K.reduce((W,V)=>lengthAdd(W,C(V)),lengthZero)}function lengthEquals(K,C){return K===C}function lengthDiffNonNegative(K,C){const W=K,V=C;if(V-W<=0)return lengthZero;const G=Math.floor(W/factor),Z=Math.floor(V/factor),X=V-Z*factor;if(G===Z){const Q=W-G*factor;return toLength(0,X-Q)}else return toLength(Z-G,X)}function lengthLessThan(K,C){return K<C}function lengthLessThanEqual(K,C){return K<=C}function lengthGreaterThanEqual(K,C){return K>=C}function positionToLength(K){return toLength(K.lineNumber-1,K.column-1)}function lengthsToRange(K,C){const W=K,V=Math.floor(W/factor),U=W-V*factor,G=C,Z=Math.floor(G/factor),X=G-Z*factor;return new Range$2(V+1,U+1,Z+1,X+1)}function lengthOfString(K){const C=splitLines(K);return toLength(C.length-1,C[C.length-1].length)}class TextEditInfo{static fromModelContentChanges(C){return C.map(V=>{const U=Range$2.lift(V.range);return new TextEditInfo(positionToLength(U.getStartPosition()),positionToLength(U.getEndPosition()),lengthOfString(V.text))}).reverse()}constructor(C,W,V){this.startOffset=C,this.endOffset=W,this.newLength=V}toString(){return`[${lengthToObj(this.startOffset)}...${lengthToObj(this.endOffset)}) -> ${lengthToObj(this.newLength)}`}}class BeforeEditPositionMapper{constructor(C){this.nextEditIdx=0,this.deltaOldToNewLineCount=0,this.deltaOldToNewColumnCount=0,this.deltaLineIdxInOld=-1,this.edits=C.map(W=>TextEditInfoCache.from(W))}getOffsetBeforeChange(C){return this.adjustNextEdit(C),this.translateCurToOld(C)}getDistanceToNextChange(C){this.adjustNextEdit(C);const W=this.edits[this.nextEditIdx],V=W?this.translateOldToCur(W.offsetObj):null;return V===null?null:lengthDiffNonNegative(C,V)}translateOldToCur(C){return C.lineCount===this.deltaLineIdxInOld?toLength(C.lineCount+this.deltaOldToNewLineCount,C.columnCount+this.deltaOldToNewColumnCount):toLength(C.lineCount+this.deltaOldToNewLineCount,C.columnCount)}translateCurToOld(C){const W=lengthToObj(C);return W.lineCount-this.deltaOldToNewLineCount===this.deltaLineIdxInOld?toLength(W.lineCount-this.deltaOldToNewLineCount,W.columnCount-this.deltaOldToNewColumnCount):toLength(W.lineCount-this.deltaOldToNewLineCount,W.columnCount)}adjustNextEdit(C){for(;this.nextEditIdx<this.edits.length;){const W=this.edits[this.nextEditIdx],V=this.translateOldToCur(W.endOffsetAfterObj);if(lengthLessThanEqual(V,C)){this.nextEditIdx++;const U=lengthToObj(V),G=lengthToObj(this.translateOldToCur(W.endOffsetBeforeObj)),Z=U.lineCount-G.lineCount;this.deltaOldToNewLineCount+=Z;const X=this.deltaLineIdxInOld===W.endOffsetBeforeObj.lineCount?this.deltaOldToNewColumnCount:0,Q=U.columnCount-G.columnCount;this.deltaOldToNewColumnCount=X+Q,this.deltaLineIdxInOld=W.endOffsetBeforeObj.lineCount}else break}}}class TextEditInfoCache{static from(C){return new TextEditInfoCache(C.startOffset,C.endOffset,C.newLength)}constructor(C,W,V){this.endOffsetBeforeObj=lengthToObj(W),this.endOffsetAfterObj=lengthToObj(lengthAdd(C,V)),this.offsetObj=lengthToObj(C)}}const emptyArr=[];class SmallImmutableSet{static create(C,W){if(C<=128&&W.length===0){let V=SmallImmutableSet.cache[C];return V||(V=new SmallImmutableSet(C,W),SmallImmutableSet.cache[C]=V),V}return new SmallImmutableSet(C,W)}static getEmpty(){return this.empty}constructor(C,W){this.items=C,this.additionalItems=W}add(C,W){const V=W.getKey(C);let U=V>>5;if(U===0){const Z=1<<V|this.items;return Z===this.items?this:SmallImmutableSet.create(Z,this.additionalItems)}U--;const G=this.additionalItems.slice(0);for(;G.length<U;)G.push(0);return G[U]|=1<<(V&31),SmallImmutableSet.create(this.items,G)}merge(C){const W=this.items|C.items;if(this.additionalItems===emptyArr&&C.additionalItems===emptyArr)return W===this.items?this:W===C.items?C:SmallImmutableSet.create(W,emptyArr);const V=[];for(let U=0;U<Math.max(this.additionalItems.length,C.additionalItems.length);U++){const G=this.additionalItems[U]||0,Z=C.additionalItems[U]||0;V.push(G|Z)}return SmallImmutableSet.create(W,V)}intersects(C){if(this.items&C.items)return!0;for(let W=0;W<Math.min(this.additionalItems.length,C.additionalItems.length);W++)if(this.additionalItems[W]&C.additionalItems[W])return!0;return!1}}SmallImmutableSet.cache=new Array(129);SmallImmutableSet.empty=SmallImmutableSet.create(0,emptyArr);const identityKeyProvider={getKey(K){return K}};class DenseKeyProvider{constructor(){this.items=new Map}getKey(C){let W=this.items.get(C);return W===void 0&&(W=this.items.size,this.items.set(C,W)),W}}class BaseAstNode{get length(){return this._length}constructor(C){this._length=C}}class PairAstNode extends BaseAstNode{static create(C,W,V){let U=C.length;return W&&(U=lengthAdd(U,W.length)),V&&(U=lengthAdd(U,V.length)),new PairAstNode(U,C,W,V,W?W.missingOpeningBracketIds:SmallImmutableSet.getEmpty())}get kind(){return 2}get listHeight(){return 0}get childrenLength(){return 3}getChild(C){switch(C){case 0:return this.openingBracket;case 1:return this.child;case 2:return this.closingBracket}throw new Error("Invalid child index")}get children(){const C=[];return C.push(this.openingBracket),this.child&&C.push(this.child),this.closingBracket&&C.push(this.closingBracket),C}constructor(C,W,V,U,G){super(C),this.openingBracket=W,this.child=V,this.closingBracket=U,this.missingOpeningBracketIds=G}canBeReused(C){return!(this.closingBracket===null||C.intersects(this.missingOpeningBracketIds))}deepClone(){return new PairAstNode(this.length,this.openingBracket.deepClone(),this.child&&this.child.deepClone(),this.closingBracket&&this.closingBracket.deepClone(),this.missingOpeningBracketIds)}computeMinIndentation(C,W){return this.child?this.child.computeMinIndentation(lengthAdd(C,this.openingBracket.length),W):Number.MAX_SAFE_INTEGER}}class ListAstNode extends BaseAstNode{static create23(C,W,V,U=!1){let G=C.length,Z=C.missingOpeningBracketIds;if(C.listHeight!==W.listHeight)throw new Error("Invalid list heights");if(G=lengthAdd(G,W.length),Z=Z.merge(W.missingOpeningBracketIds),V){if(C.listHeight!==V.listHeight)throw new Error("Invalid list heights");G=lengthAdd(G,V.length),Z=Z.merge(V.missingOpeningBracketIds)}return U?new Immutable23ListAstNode(G,C.listHeight+1,C,W,V,Z):new TwoThreeListAstNode(G,C.listHeight+1,C,W,V,Z)}static getEmpty(){return new ImmutableArrayListAstNode(lengthZero,0,[],SmallImmutableSet.getEmpty())}get kind(){return 4}get missingOpeningBracketIds(){return this._missingOpeningBracketIds}constructor(C,W,V){super(C),this.listHeight=W,this._missingOpeningBracketIds=V,this.cachedMinIndentation=-1}throwIfImmutable(){}makeLastElementMutable(){this.throwIfImmutable();const C=this.childrenLength;if(C===0)return;const W=this.getChild(C-1),V=W.kind===4?W.toMutable():W;return W!==V&&this.setChild(C-1,V),V}makeFirstElementMutable(){if(this.throwIfImmutable(),this.childrenLength===0)return;const W=this.getChild(0),V=W.kind===4?W.toMutable():W;return W!==V&&this.setChild(0,V),V}canBeReused(C){if(C.intersects(this.missingOpeningBracketIds)||this.childrenLength===0)return!1;let W=this;for(;W.kind===4;){const V=W.childrenLength;if(V===0)throw new BugIndicatingError;W=W.getChild(V-1)}return W.canBeReused(C)}handleChildrenChanged(){this.throwIfImmutable();const C=this.childrenLength;let W=this.getChild(0).length,V=this.getChild(0).missingOpeningBracketIds;for(let U=1;U<C;U++){const G=this.getChild(U);W=lengthAdd(W,G.length),V=V.merge(G.missingOpeningBracketIds)}this._length=W,this._missingOpeningBracketIds=V,this.cachedMinIndentation=-1}computeMinIndentation(C,W){if(this.cachedMinIndentation!==-1)return this.cachedMinIndentation;let V=Number.MAX_SAFE_INTEGER,U=C;for(let G=0;G<this.childrenLength;G++){const Z=this.getChild(G);Z&&(V=Math.min(V,Z.computeMinIndentation(U,W)),U=lengthAdd(U,Z.length))}return this.cachedMinIndentation=V,V}}class TwoThreeListAstNode extends ListAstNode{get childrenLength(){return this._item3!==null?3:2}getChild(C){switch(C){case 0:return this._item1;case 1:return this._item2;case 2:return this._item3}throw new Error("Invalid child index")}setChild(C,W){switch(C){case 0:this._item1=W;return;case 1:this._item2=W;return;case 2:this._item3=W;return}throw new Error("Invalid child index")}get children(){return this._item3?[this._item1,this._item2,this._item3]:[this._item1,this._item2]}get item1(){return this._item1}get item2(){return this._item2}get item3(){return this._item3}constructor(C,W,V,U,G,Z){super(C,W,Z),this._item1=V,this._item2=U,this._item3=G}deepClone(){return new TwoThreeListAstNode(this.length,this.listHeight,this._item1.deepClone(),this._item2.deepClone(),this._item3?this._item3.deepClone():null,this.missingOpeningBracketIds)}appendChildOfSameHeight(C){if(this._item3)throw new Error("Cannot append to a full (2,3) tree node");this.throwIfImmutable(),this._item3=C,this.handleChildrenChanged()}unappendChild(){if(!this._item3)throw new Error("Cannot remove from a non-full (2,3) tree node");this.throwIfImmutable();const C=this._item3;return this._item3=null,this.handleChildrenChanged(),C}prependChildOfSameHeight(C){if(this._item3)throw new Error("Cannot prepend to a full (2,3) tree node");this.throwIfImmutable(),this._item3=this._item2,this._item2=this._item1,this._item1=C,this.handleChildrenChanged()}unprependChild(){if(!this._item3)throw new Error("Cannot remove from a non-full (2,3) tree node");this.throwIfImmutable();const C=this._item1;return this._item1=this._item2,this._item2=this._item3,this._item3=null,this.handleChildrenChanged(),C}toMutable(){return this}}class Immutable23ListAstNode extends TwoThreeListAstNode{toMutable(){return new TwoThreeListAstNode(this.length,this.listHeight,this.item1,this.item2,this.item3,this.missingOpeningBracketIds)}throwIfImmutable(){throw new Error("this instance is immutable")}}class ArrayListAstNode extends ListAstNode{get childrenLength(){return this._children.length}getChild(C){return this._children[C]}setChild(C,W){this._children[C]=W}get children(){return this._children}constructor(C,W,V,U){super(C,W,U),this._children=V}deepClone(){const C=new Array(this._children.length);for(let W=0;W<this._children.length;W++)C[W]=this._children[W].deepClone();return new ArrayListAstNode(this.length,this.listHeight,C,this.missingOpeningBracketIds)}appendChildOfSameHeight(C){this.throwIfImmutable(),this._children.push(C),this.handleChildrenChanged()}unappendChild(){this.throwIfImmutable();const C=this._children.pop();return this.handleChildrenChanged(),C}prependChildOfSameHeight(C){this.throwIfImmutable(),this._children.unshift(C),this.handleChildrenChanged()}unprependChild(){this.throwIfImmutable();const C=this._children.shift();return this.handleChildrenChanged(),C}toMutable(){return this}}class ImmutableArrayListAstNode extends ArrayListAstNode{toMutable(){return new ArrayListAstNode(this.length,this.listHeight,[...this.children],this.missingOpeningBracketIds)}throwIfImmutable(){throw new Error("this instance is immutable")}}const emptyArray=[];class ImmutableLeafAstNode extends BaseAstNode{get listHeight(){return 0}get childrenLength(){return 0}getChild(C){return null}get children(){return emptyArray}deepClone(){return this}}class TextAstNode extends ImmutableLeafAstNode{get kind(){return 0}get missingOpeningBracketIds(){return SmallImmutableSet.getEmpty()}canBeReused(C){return!0}computeMinIndentation(C,W){const V=lengthToObj(C),U=(V.columnCount===0?V.lineCount:V.lineCount+1)+1,G=lengthGetLineCount(lengthAdd(C,this.length))+1;let Z=Number.MAX_SAFE_INTEGER;for(let X=U;X<=G;X++){const Q=W.getLineFirstNonWhitespaceColumn(X),J=W.getLineContent(X);if(Q===0)continue;const ee=CursorColumns.visibleColumnFromColumn(J,Q,W.getOptions().tabSize);Z=Math.min(Z,ee)}return Z}}class BracketAstNode extends ImmutableLeafAstNode{static create(C,W,V){return new BracketAstNode(C,W,V)}get kind(){return 1}get missingOpeningBracketIds(){return SmallImmutableSet.getEmpty()}constructor(C,W,V){super(C),this.bracketInfo=W,this.bracketIds=V}get text(){return this.bracketInfo.bracketText}get languageId(){return this.bracketInfo.languageId}canBeReused(C){return!1}computeMinIndentation(C,W){return Number.MAX_SAFE_INTEGER}}class InvalidBracketAstNode extends ImmutableLeafAstNode{get kind(){return 3}constructor(C,W){super(W),this.missingOpeningBracketIds=C}canBeReused(C){return!C.intersects(this.missingOpeningBracketIds)}computeMinIndentation(C,W){return Number.MAX_SAFE_INTEGER}}let Token$1=class{constructor(C,W,V,U,G){this.length=C,this.kind=W,this.bracketId=V,this.bracketIds=U,this.astNode=G}};class TextBufferTokenizer{constructor(C,W){this.textModel=C,this.bracketTokens=W,this.reader=new NonPeekableTextBufferTokenizer(this.textModel,this.bracketTokens),this._offset=lengthZero,this.didPeek=!1,this.peeked=null,this.textBufferLineCount=C.getLineCount(),this.textBufferLastLineLength=C.getLineLength(this.textBufferLineCount)}get offset(){return this._offset}get length(){return toLength(this.textBufferLineCount-1,this.textBufferLastLineLength)}skip(C){this.didPeek=!1,this._offset=lengthAdd(this._offset,C);const W=lengthToObj(this._offset);this.reader.setPosition(W.lineCount,W.columnCount)}read(){let C;return this.peeked?(this.didPeek=!1,C=this.peeked):C=this.reader.read(),C&&(this._offset=lengthAdd(this._offset,C.length)),C}peek(){return this.didPeek||(this.peeked=this.reader.read(),this.didPeek=!0),this.peeked}}class NonPeekableTextBufferTokenizer{constructor(C,W){this.textModel=C,this.bracketTokens=W,this.lineIdx=0,this.line=null,this.lineCharOffset=0,this.lineTokens=null,this.lineTokenOffset=0,this.peekedToken=null,this.textBufferLineCount=C.getLineCount(),this.textBufferLastLineLength=C.getLineLength(this.textBufferLineCount)}setPosition(C,W){C===this.lineIdx?(this.lineCharOffset=W,this.line!==null&&(this.lineTokenOffset=this.lineCharOffset===0?0:this.lineTokens.findTokenIndexAtOffset(this.lineCharOffset))):(this.lineIdx=C,this.lineCharOffset=W,this.line=null),this.peekedToken=null}read(){if(this.peekedToken){const G=this.peekedToken;return this.peekedToken=null,this.lineCharOffset+=G.length,G}if(this.lineIdx>this.textBufferLineCount-1||this.lineIdx===this.textBufferLineCount-1&&this.lineCharOffset>=this.textBufferLastLineLength)return null;this.line===null&&(this.lineTokens=this.textModel.tokenization.getLineTokens(this.lineIdx+1),this.line=this.lineTokens.getLineContent(),this.lineTokenOffset=this.lineCharOffset===0?0:this.lineTokens.findTokenIndexAtOffset(this.lineCharOffset));const C=this.lineIdx,W=this.lineCharOffset;let V=0;for(;;){const G=this.lineTokens,Z=G.getCount();let X=null;if(this.lineTokenOffset<Z){const Q=G.getMetadata(this.lineTokenOffset);for(;this.lineTokenOffset+1<Z&&Q===G.getMetadata(this.lineTokenOffset+1);)this.lineTokenOffset++;const J=TokenMetadata.getTokenType(Q)===0,ee=TokenMetadata.containsBalancedBrackets(Q),te=G.getEndOffset(this.lineTokenOffset);if(ee&&J&&this.lineCharOffset<te){const ie=G.getLanguageId(this.lineTokenOffset),ne=this.line.substring(this.lineCharOffset,te),oe=this.bracketTokens.getSingleLanguageBracketTokens(ie),re=oe.regExpGlobal;if(re){re.lastIndex=0;const ae=re.exec(ne);ae&&(X=oe.getToken(ae[0]),X&&(this.lineCharOffset+=ae.index))}}if(V+=te-this.lineCharOffset,X)if(C!==this.lineIdx||W!==this.lineCharOffset){this.peekedToken=X;break}else return this.lineCharOffset+=X.length,X;else this.lineTokenOffset++,this.lineCharOffset=te}else if(this.lineIdx===this.textBufferLineCount-1||(this.lineIdx++,this.lineTokens=this.textModel.tokenization.getLineTokens(this.lineIdx+1),this.lineTokenOffset=0,this.line=this.lineTokens.getLineContent(),this.lineCharOffset=0,V+=33,V>1e3))break;if(V>1500)break}const U=lengthDiff(C,W,this.lineIdx,this.lineCharOffset);return new Token$1(U,0,-1,SmallImmutableSet.getEmpty(),new TextAstNode(U))}}class FastTokenizer{constructor(C,W){this.text=C,this._offset=lengthZero,this.idx=0;const V=W.getRegExpStr(),U=V?new RegExp(V+`|
`,"gi"):null,G=[];let Z,X=0,Q=0,J=0,ee=0;const te=[];for(let oe=0;oe<60;oe++)te.push(new Token$1(toLength(0,oe),0,-1,SmallImmutableSet.getEmpty(),new TextAstNode(toLength(0,oe))));const ie=[];for(let oe=0;oe<60;oe++)ie.push(new Token$1(toLength(1,oe),0,-1,SmallImmutableSet.getEmpty(),new TextAstNode(toLength(1,oe))));if(U)for(U.lastIndex=0;(Z=U.exec(C))!==null;){const oe=Z.index,re=Z[0];if(re===`
`)X++,Q=oe+1;else{if(J!==oe){let ae;if(ee===X){const se=oe-J;if(se<te.length)ae=te[se];else{const le=toLength(0,se);ae=new Token$1(le,0,-1,SmallImmutableSet.getEmpty(),new TextAstNode(le))}}else{const se=X-ee,le=oe-Q;if(se===1&&le<ie.length)ae=ie[le];else{const ce=toLength(se,le);ae=new Token$1(ce,0,-1,SmallImmutableSet.getEmpty(),new TextAstNode(ce))}}G.push(ae)}G.push(W.getToken(re)),J=oe+re.length,ee=X}}const ne=C.length;if(J!==ne){const oe=ee===X?toLength(0,ne-J):toLength(X-ee,ne-Q);G.push(new Token$1(oe,0,-1,SmallImmutableSet.getEmpty(),new TextAstNode(oe)))}this.length=toLength(X,ne-Q),this.tokens=G}get offset(){return this._offset}read(){return this.tokens[this.idx++]||null}peek(){return this.tokens[this.idx]||null}skip(C){throw new NotSupportedError}}class BracketTokens{static createFromLanguage(C,W){function V(G){return W.getKey(`${G.languageId}:::${G.bracketText}`)}const U=new Map;for(const G of C.bracketsNew.openingBrackets){const Z=toLength(0,G.bracketText.length),X=V(G),Q=SmallImmutableSet.getEmpty().add(X,identityKeyProvider);U.set(G.bracketText,new Token$1(Z,1,X,Q,BracketAstNode.create(Z,G,Q)))}for(const G of C.bracketsNew.closingBrackets){const Z=toLength(0,G.bracketText.length);let X=SmallImmutableSet.getEmpty();const Q=G.getOpeningBrackets();for(const J of Q)X=X.add(V(J),identityKeyProvider);U.set(G.bracketText,new Token$1(Z,2,V(Q[0]),X,BracketAstNode.create(Z,G,X)))}return new BracketTokens(U)}constructor(C){this.map=C,this.hasRegExp=!1,this._regExpGlobal=null}getRegExpStr(){if(this.isEmpty)return null;{const C=[...this.map.keys()];return C.sort(),C.reverse(),C.map(W=>prepareBracketForRegExp(W)).join("|")}}get regExpGlobal(){if(!this.hasRegExp){const C=this.getRegExpStr();this._regExpGlobal=C?new RegExp(C,"gi"):null,this.hasRegExp=!0}return this._regExpGlobal}getToken(C){return this.map.get(C.toLowerCase())}findClosingTokenText(C){for(const[W,V]of this.map)if(V.kind===2&&V.bracketIds.intersects(C))return W}get isEmpty(){return this.map.size===0}}function prepareBracketForRegExp(K){let C=escapeRegExpCharacters(K);return/^[\w ]+/.test(K)&&(C=`\\b${C}`),/[\w ]+$/.test(K)&&(C=`${C}\\b`),C}class LanguageAgnosticBracketTokens{constructor(C,W){this.denseKeyProvider=C,this.getLanguageConfiguration=W,this.languageIdToBracketTokens=new Map}didLanguageChange(C){return this.languageIdToBracketTokens.has(C)}getSingleLanguageBracketTokens(C){let W=this.languageIdToBracketTokens.get(C);return W||(W=BracketTokens.createFromLanguage(this.getLanguageConfiguration(C),this.denseKeyProvider),this.languageIdToBracketTokens.set(C,W)),W}}function concat23Trees(K){if(K.length===0)return null;if(K.length===1)return K[0];let C=0;function W(){if(C>=K.length)return null;const Z=C,X=K[Z].listHeight;for(C++;C<K.length&&K[C].listHeight===X;)C++;return C-Z>=2?concat23TreesOfSameHeight(Z===0&&C===K.length?K:K.slice(Z,C),!1):K[Z]}let V=W(),U=W();if(!U)return V;for(let Z=W();Z;Z=W())heightDiff(V,U)<=heightDiff(U,Z)?(V=concat$4(V,U),U=Z):U=concat$4(U,Z);return concat$4(V,U)}function concat23TreesOfSameHeight(K,C=!1){if(K.length===0)return null;if(K.length===1)return K[0];let W=K.length;for(;W>3;){const V=W>>1;for(let U=0;U<V;U++){const G=U<<1;K[U]=ListAstNode.create23(K[G],K[G+1],G+3===W?K[G+2]:null,C)}W=V}return ListAstNode.create23(K[0],K[1],W>=3?K[2]:null,C)}function heightDiff(K,C){return Math.abs(K.listHeight-C.listHeight)}function concat$4(K,C){return K.listHeight===C.listHeight?ListAstNode.create23(K,C,null,!1):K.listHeight>C.listHeight?append$2(K,C):prepend$2(C,K)}function append$2(K,C){K=K.toMutable();let W=K;const V=[];let U;for(;;){if(C.listHeight===W.listHeight){U=C;break}if(W.kind!==4)throw new Error("unexpected");V.push(W),W=W.makeLastElementMutable()}for(let G=V.length-1;G>=0;G--){const Z=V[G];U?Z.childrenLength>=3?U=ListAstNode.create23(Z.unappendChild(),U,null,!1):(Z.appendChildOfSameHeight(U),U=void 0):Z.handleChildrenChanged()}return U?ListAstNode.create23(K,U,null,!1):K}function prepend$2(K,C){K=K.toMutable();let W=K;const V=[];for(;C.listHeight!==W.listHeight;){if(W.kind!==4)throw new Error("unexpected");V.push(W),W=W.makeFirstElementMutable()}let U=C;for(let G=V.length-1;G>=0;G--){const Z=V[G];U?Z.childrenLength>=3?U=ListAstNode.create23(U,Z.unprependChild(),null,!1):(Z.prependChildOfSameHeight(U),U=void 0):Z.handleChildrenChanged()}return U?ListAstNode.create23(U,K,null,!1):K}class NodeReader{constructor(C){this.lastOffset=lengthZero,this.nextNodes=[C],this.offsets=[lengthZero],this.idxs=[]}readLongestNodeAt(C,W){if(lengthLessThan(C,this.lastOffset))throw new Error("Invalid offset");for(this.lastOffset=C;;){const V=lastOrUndefined(this.nextNodes);if(!V)return;const U=lastOrUndefined(this.offsets);if(lengthLessThan(C,U))return;if(lengthLessThan(U,C))if(lengthAdd(U,V.length)<=C)this.nextNodeAfterCurrent();else{const G=getNextChildIdx(V);G!==-1?(this.nextNodes.push(V.getChild(G)),this.offsets.push(U),this.idxs.push(G)):this.nextNodeAfterCurrent()}else{if(W(V))return this.nextNodeAfterCurrent(),V;{const G=getNextChildIdx(V);if(G===-1){this.nextNodeAfterCurrent();return}else this.nextNodes.push(V.getChild(G)),this.offsets.push(U),this.idxs.push(G)}}}}nextNodeAfterCurrent(){for(;;){const C=lastOrUndefined(this.offsets),W=lastOrUndefined(this.nextNodes);if(this.nextNodes.pop(),this.offsets.pop(),this.idxs.length===0)break;const V=lastOrUndefined(this.nextNodes),U=getNextChildIdx(V,this.idxs[this.idxs.length-1]);if(U!==-1){this.nextNodes.push(V.getChild(U)),this.offsets.push(lengthAdd(C,W.length)),this.idxs[this.idxs.length-1]=U;break}else this.idxs.pop()}}}function getNextChildIdx(K,C=-1){for(;;){if(C++,C>=K.childrenLength)return-1;if(K.getChild(C))return C}}function lastOrUndefined(K){return K.length>0?K[K.length-1]:void 0}function parseDocument(K,C,W,V){return new Parser(K,C,W,V).parseDocument()}class Parser{constructor(C,W,V,U){if(this.tokenizer=C,this.createImmutableLists=U,this._itemsConstructed=0,this._itemsFromCache=0,V&&U)throw new Error("Not supported");this.oldNodeReader=V?new NodeReader(V):void 0,this.positionMapper=new BeforeEditPositionMapper(W)}parseDocument(){this._itemsConstructed=0,this._itemsFromCache=0;let C=this.parseList(SmallImmutableSet.getEmpty(),0);return C||(C=ListAstNode.getEmpty()),C}parseList(C,W){const V=[];for(;;){let G=this.tryReadChildFromCache(C);if(!G){const Z=this.tokenizer.peek();if(!Z||Z.kind===2&&Z.bracketIds.intersects(C))break;G=this.parseChild(C,W+1)}G.kind===4&&G.childrenLength===0||V.push(G)}return this.oldNodeReader?concat23Trees(V):concat23TreesOfSameHeight(V,this.createImmutableLists)}tryReadChildFromCache(C){if(this.oldNodeReader){const W=this.positionMapper.getDistanceToNextChange(this.tokenizer.offset);if(W===null||!lengthIsZero(W)){const V=this.oldNodeReader.readLongestNodeAt(this.positionMapper.getOffsetBeforeChange(this.tokenizer.offset),U=>W!==null&&!lengthLessThan(U.length,W)?!1:U.canBeReused(C));if(V)return this._itemsFromCache++,this.tokenizer.skip(V.length),V}}}parseChild(C,W){this._itemsConstructed++;const V=this.tokenizer.read();switch(V.kind){case 2:return new InvalidBracketAstNode(V.bracketIds,V.length);case 0:return V.astNode;case 1:{if(W>300)return new TextAstNode(V.length);const U=C.merge(V.bracketIds),G=this.parseList(U,W+1),Z=this.tokenizer.peek();return Z&&Z.kind===2&&(Z.bracketId===V.bracketId||Z.bracketIds.intersects(V.bracketIds))?(this.tokenizer.read(),PairAstNode.create(V.astNode,G,Z.astNode)):PairAstNode.create(V.astNode,G,null)}default:throw new Error("unexpected")}}}function combineTextEditInfos(K,C){if(K.length===0)return C;if(C.length===0)return K;const W=new ArrayQueue(toLengthMapping(K)),V=toLengthMapping(C);V.push({modified:!1,lengthBefore:void 0,lengthAfter:void 0});let U=W.dequeue();function G(J){if(J===void 0){const te=W.takeWhile(ie=>!0)||[];return U&&te.unshift(U),te}const ee=[];for(;U&&!lengthIsZero(J);){const[te,ie]=U.splitAt(J);ee.push(te),J=lengthDiffNonNegative(te.lengthAfter,J),U=ie??W.dequeue()}return lengthIsZero(J)||ee.push(new LengthMapping(!1,J,J)),ee}const Z=[];function X(J,ee,te){if(Z.length>0&&lengthEquals(Z[Z.length-1].endOffset,J)){const ie=Z[Z.length-1];Z[Z.length-1]=new TextEditInfo(ie.startOffset,ee,lengthAdd(ie.newLength,te))}else Z.push({startOffset:J,endOffset:ee,newLength:te})}let Q=lengthZero;for(const J of V){const ee=G(J.lengthBefore);if(J.modified){const te=sumLengths(ee,ne=>ne.lengthBefore),ie=lengthAdd(Q,te);X(Q,ie,J.lengthAfter),Q=ie}else for(const te of ee){const ie=Q;Q=lengthAdd(Q,te.lengthBefore),te.modified&&X(ie,Q,te.lengthAfter)}}return Z}class LengthMapping{constructor(C,W,V){this.modified=C,this.lengthBefore=W,this.lengthAfter=V}splitAt(C){const W=lengthDiffNonNegative(C,this.lengthAfter);return lengthEquals(W,lengthZero)?[this,void 0]:this.modified?[new LengthMapping(this.modified,this.lengthBefore,C),new LengthMapping(this.modified,lengthZero,W)]:[new LengthMapping(this.modified,C,C),new LengthMapping(this.modified,W,W)]}toString(){return`${this.modified?"M":"U"}:${lengthToObj(this.lengthBefore)} -> ${lengthToObj(this.lengthAfter)}`}}function toLengthMapping(K){const C=[];let W=lengthZero;for(const V of K){const U=lengthDiffNonNegative(W,V.startOffset);lengthIsZero(U)||C.push(new LengthMapping(!1,U,U));const G=lengthDiffNonNegative(V.startOffset,V.endOffset);C.push(new LengthMapping(!0,G,V.newLength)),W=V.endOffset}return C}class BracketPairsTree extends Disposable{didLanguageChange(C){return this.brackets.didLanguageChange(C)}constructor(C,W){if(super(),this.textModel=C,this.getLanguageConfiguration=W,this.didChangeEmitter=new Emitter$1,this.denseKeyProvider=new DenseKeyProvider,this.brackets=new LanguageAgnosticBracketTokens(this.denseKeyProvider,this.getLanguageConfiguration),this.onDidChange=this.didChangeEmitter.event,this.queuedTextEditsForInitialAstWithoutTokens=[],this.queuedTextEdits=[],C.tokenization.hasTokens)C.tokenization.backgroundTokenizationState===2?(this.initialAstWithoutTokens=void 0,this.astWithTokens=this.parseDocumentFromTextBuffer([],void 0,!1)):(this.initialAstWithoutTokens=this.parseDocumentFromTextBuffer([],void 0,!0),this.astWithTokens=this.initialAstWithoutTokens);else{const V=this.brackets.getSingleLanguageBracketTokens(this.textModel.getLanguageId()),U=new FastTokenizer(this.textModel.getValue(),V);this.initialAstWithoutTokens=parseDocument(U,[],void 0,!0),this.astWithTokens=this.initialAstWithoutTokens}}handleDidChangeBackgroundTokenizationState(){if(this.textModel.tokenization.backgroundTokenizationState===2){const C=this.initialAstWithoutTokens===void 0;this.initialAstWithoutTokens=void 0,C||this.didChangeEmitter.fire()}}handleDidChangeTokens({ranges:C}){const W=C.map(V=>new TextEditInfo(toLength(V.fromLineNumber-1,0),toLength(V.toLineNumber,0),toLength(V.toLineNumber-V.fromLineNumber+1,0)));this.handleEdits(W,!0),this.initialAstWithoutTokens||this.didChangeEmitter.fire()}handleContentChanged(C){const W=TextEditInfo.fromModelContentChanges(C.changes);this.handleEdits(W,!1)}handleEdits(C,W){const V=combineTextEditInfos(this.queuedTextEdits,C);this.queuedTextEdits=V,this.initialAstWithoutTokens&&!W&&(this.queuedTextEditsForInitialAstWithoutTokens=combineTextEditInfos(this.queuedTextEditsForInitialAstWithoutTokens,C))}flushQueue(){this.queuedTextEdits.length>0&&(this.astWithTokens=this.parseDocumentFromTextBuffer(this.queuedTextEdits,this.astWithTokens,!1),this.queuedTextEdits=[]),this.queuedTextEditsForInitialAstWithoutTokens.length>0&&(this.initialAstWithoutTokens&&(this.initialAstWithoutTokens=this.parseDocumentFromTextBuffer(this.queuedTextEditsForInitialAstWithoutTokens,this.initialAstWithoutTokens,!1)),this.queuedTextEditsForInitialAstWithoutTokens=[])}parseDocumentFromTextBuffer(C,W,V){const U=W,G=new TextBufferTokenizer(this.textModel,this.brackets);return parseDocument(G,C,U,V)}getBracketsInRange(C,W){this.flushQueue();const V=toLength(C.startLineNumber-1,C.startColumn-1),U=toLength(C.endLineNumber-1,C.endColumn-1);return new CallbackIterable(G=>{const Z=this.initialAstWithoutTokens||this.astWithTokens;collectBrackets(Z,lengthZero,Z.length,V,U,G,0,0,new Map,W)})}getBracketPairsInRange(C,W){this.flushQueue();const V=positionToLength(C.getStartPosition()),U=positionToLength(C.getEndPosition());return new CallbackIterable(G=>{const Z=this.initialAstWithoutTokens||this.astWithTokens,X=new CollectBracketPairsContext(G,W,this.textModel);collectBracketPairs(Z,lengthZero,Z.length,V,U,X,0,new Map)})}getFirstBracketAfter(C){this.flushQueue();const W=this.initialAstWithoutTokens||this.astWithTokens;return getFirstBracketAfter(W,lengthZero,W.length,positionToLength(C))}getFirstBracketBefore(C){this.flushQueue();const W=this.initialAstWithoutTokens||this.astWithTokens;return getFirstBracketBefore(W,lengthZero,W.length,positionToLength(C))}}function getFirstBracketBefore(K,C,W,V){if(K.kind===4||K.kind===2){const U=[];for(const G of K.children)W=lengthAdd(C,G.length),U.push({nodeOffsetStart:C,nodeOffsetEnd:W}),C=W;for(let G=U.length-1;G>=0;G--){const{nodeOffsetStart:Z,nodeOffsetEnd:X}=U[G];if(lengthLessThan(Z,V)){const Q=getFirstBracketBefore(K.children[G],Z,X,V);if(Q)return Q}}return null}else{if(K.kind===3)return null;if(K.kind===1){const U=lengthsToRange(C,W);return{bracketInfo:K.bracketInfo,range:U}}}return null}function getFirstBracketAfter(K,C,W,V){if(K.kind===4||K.kind===2){for(const U of K.children){if(W=lengthAdd(C,U.length),lengthLessThan(V,W)){const G=getFirstBracketAfter(U,C,W,V);if(G)return G}C=W}return null}else{if(K.kind===3)return null;if(K.kind===1){const U=lengthsToRange(C,W);return{bracketInfo:K.bracketInfo,range:U}}}return null}function collectBrackets(K,C,W,V,U,G,Z,X,Q,J,ee=!1){if(Z>200)return!0;e:for(;;)switch(K.kind){case 4:{const te=K.childrenLength;for(let ie=0;ie<te;ie++){const ne=K.getChild(ie);if(ne){if(W=lengthAdd(C,ne.length),lengthLessThanEqual(C,U)&&lengthGreaterThanEqual(W,V)){if(lengthGreaterThanEqual(W,U)){K=ne;continue e}if(!collectBrackets(ne,C,W,V,U,G,Z,0,Q,J))return!1}C=W}}return!0}case 2:{const te=!J||!K.closingBracket||K.closingBracket.bracketInfo.closesColorized(K.openingBracket.bracketInfo);let ie=0;if(Q){let oe=Q.get(K.openingBracket.text);oe===void 0&&(oe=0),ie=oe,te&&(oe++,Q.set(K.openingBracket.text,oe))}const ne=K.childrenLength;for(let oe=0;oe<ne;oe++){const re=K.getChild(oe);if(re){if(W=lengthAdd(C,re.length),lengthLessThanEqual(C,U)&&lengthGreaterThanEqual(W,V)){if(lengthGreaterThanEqual(W,U)&&re.kind!==1){K=re,te?(Z++,X=ie+1):X=ie;continue e}if((te||re.kind!==1||!K.closingBracket)&&!collectBrackets(re,C,W,V,U,G,te?Z+1:Z,te?ie+1:ie,Q,J,!K.closingBracket))return!1}C=W}}return Q==null||Q.set(K.openingBracket.text,ie),!0}case 3:{const te=lengthsToRange(C,W);return G(new BracketInfo(te,Z-1,0,!0))}case 1:{const te=lengthsToRange(C,W);return G(new BracketInfo(te,Z-1,X-1,ee))}case 0:return!0}}class CollectBracketPairsContext{constructor(C,W,V){this.push=C,this.includeMinIndentation=W,this.textModel=V}}function collectBracketPairs(K,C,W,V,U,G,Z,X){var Q;if(Z>200)return!0;let J=!0;if(K.kind===2){let ee=0;if(X){let ne=X.get(K.openingBracket.text);ne===void 0&&(ne=0),ee=ne,ne++,X.set(K.openingBracket.text,ne)}const te=lengthAdd(C,K.openingBracket.length);let ie=-1;if(G.includeMinIndentation&&(ie=K.computeMinIndentation(C,G.textModel)),J=G.push(new BracketPairWithMinIndentationInfo(lengthsToRange(C,W),lengthsToRange(C,te),K.closingBracket?lengthsToRange(lengthAdd(te,((Q=K.child)===null||Q===void 0?void 0:Q.length)||lengthZero),W):void 0,Z,ee,K,ie)),C=te,J&&K.child){const ne=K.child;if(W=lengthAdd(C,ne.length),lengthLessThanEqual(C,U)&&lengthGreaterThanEqual(W,V)&&(J=collectBracketPairs(ne,C,W,V,U,G,Z+1,X),!J))return!1}X==null||X.set(K.openingBracket.text,ee)}else{let ee=C;for(const te of K.children){const ie=ee;if(ee=lengthAdd(ee,te.length),lengthLessThanEqual(ie,U)&&lengthLessThanEqual(V,ee)&&(J=collectBracketPairs(te,ie,ee,V,U,G,Z,X),!J))return!1}}return J}class BracketPairsTextModelPart extends Disposable{get canBuildAST(){return this.textModel.getValueLength()<=5e6}constructor(C,W){super(),this.textModel=C,this.languageConfigurationService=W,this.bracketPairsTree=this._register(new MutableDisposable),this.onDidChangeEmitter=new Emitter$1,this.onDidChange=this.onDidChangeEmitter.event,this.bracketsRequested=!1,this._register(this.languageConfigurationService.onDidChange(V=>{var U;(!V.languageId||!((U=this.bracketPairsTree.value)===null||U===void 0)&&U.object.didLanguageChange(V.languageId))&&(this.bracketPairsTree.clear(),this.updateBracketPairsTree())}))}handleDidChangeOptions(C){this.bracketPairsTree.clear(),this.updateBracketPairsTree()}handleDidChangeLanguage(C){this.bracketPairsTree.clear(),this.updateBracketPairsTree()}handleDidChangeContent(C){var W;(W=this.bracketPairsTree.value)===null||W===void 0||W.object.handleContentChanged(C)}handleDidChangeBackgroundTokenizationState(){var C;(C=this.bracketPairsTree.value)===null||C===void 0||C.object.handleDidChangeBackgroundTokenizationState()}handleDidChangeTokens(C){var W;(W=this.bracketPairsTree.value)===null||W===void 0||W.object.handleDidChangeTokens(C)}updateBracketPairsTree(){if(this.bracketsRequested&&this.canBuildAST){if(!this.bracketPairsTree.value){const C=new DisposableStore;this.bracketPairsTree.value=createDisposableRef(C.add(new BracketPairsTree(this.textModel,W=>this.languageConfigurationService.getLanguageConfiguration(W))),C),C.add(this.bracketPairsTree.value.object.onDidChange(W=>this.onDidChangeEmitter.fire(W))),this.onDidChangeEmitter.fire()}}else this.bracketPairsTree.value&&(this.bracketPairsTree.clear(),this.onDidChangeEmitter.fire())}getBracketPairsInRange(C){var W;return this.bracketsRequested=!0,this.updateBracketPairsTree(),((W=this.bracketPairsTree.value)===null||W===void 0?void 0:W.object.getBracketPairsInRange(C,!1))||CallbackIterable.empty}getBracketPairsInRangeWithMinIndentation(C){var W;return this.bracketsRequested=!0,this.updateBracketPairsTree(),((W=this.bracketPairsTree.value)===null||W===void 0?void 0:W.object.getBracketPairsInRange(C,!0))||CallbackIterable.empty}getBracketsInRange(C,W=!1){var V;return this.bracketsRequested=!0,this.updateBracketPairsTree(),((V=this.bracketPairsTree.value)===null||V===void 0?void 0:V.object.getBracketsInRange(C,W))||CallbackIterable.empty}findMatchingBracketUp(C,W,V){const U=this.textModel.validatePosition(W),G=this.textModel.getLanguageIdAtPosition(U.lineNumber,U.column);if(this.canBuildAST){const Z=this.languageConfigurationService.getLanguageConfiguration(G).bracketsNew.getClosingBracketInfo(C);if(!Z)return null;const X=this.getBracketPairsInRange(Range$2.fromPositions(W,W)).findLast(Q=>Z.closes(Q.openingBracketInfo));return X?X.openingBracketRange:null}else{const Z=C.toLowerCase(),X=this.languageConfigurationService.getLanguageConfiguration(G).brackets;if(!X)return null;const Q=X.textIsBracket[Z];return Q?stripBracketSearchCanceled(this._findMatchingBracketUp(Q,U,createTimeBasedContinueBracketSearchPredicate(V))):null}}matchBracket(C,W){if(this.canBuildAST){const V=this.getBracketPairsInRange(Range$2.fromPositions(C,C)).filter(U=>U.closingBracketRange!==void 0&&(U.openingBracketRange.containsPosition(C)||U.closingBracketRange.containsPosition(C))).findLastMaxBy(compareBy(U=>U.openingBracketRange.containsPosition(C)?U.openingBracketRange:U.closingBracketRange,Range$2.compareRangesUsingStarts));return V?[V.openingBracketRange,V.closingBracketRange]:null}else{const V=createTimeBasedContinueBracketSearchPredicate(W);return this._matchBracket(this.textModel.validatePosition(C),V)}}_establishBracketSearchOffsets(C,W,V,U){const G=W.getCount(),Z=W.getLanguageId(U);let X=Math.max(0,C.column-1-V.maxBracketLength);for(let J=U-1;J>=0;J--){const ee=W.getEndOffset(J);if(ee<=X)break;if(ignoreBracketsInToken(W.getStandardTokenType(J))||W.getLanguageId(J)!==Z){X=ee;break}}let Q=Math.min(W.getLineContent().length,C.column-1+V.maxBracketLength);for(let J=U+1;J<G;J++){const ee=W.getStartOffset(J);if(ee>=Q)break;if(ignoreBracketsInToken(W.getStandardTokenType(J))||W.getLanguageId(J)!==Z){Q=ee;break}}return{searchStartOffset:X,searchEndOffset:Q}}_matchBracket(C,W){const V=C.lineNumber,U=this.textModel.tokenization.getLineTokens(V),G=this.textModel.getLineContent(V),Z=U.findTokenIndexAtOffset(C.column-1);if(Z<0)return null;const X=this.languageConfigurationService.getLanguageConfiguration(U.getLanguageId(Z)).brackets;if(X&&!ignoreBracketsInToken(U.getStandardTokenType(Z))){let{searchStartOffset:Q,searchEndOffset:J}=this._establishBracketSearchOffsets(C,U,X,Z),ee=null;for(;;){const te=BracketsUtils.findNextBracketInRange(X.forwardRegex,V,G,Q,J);if(!te)break;if(te.startColumn<=C.column&&C.column<=te.endColumn){const ie=G.substring(te.startColumn-1,te.endColumn-1).toLowerCase(),ne=this._matchFoundBracket(te,X.textIsBracket[ie],X.textIsOpenBracket[ie],W);if(ne){if(ne instanceof BracketSearchCanceled)return null;ee=ne}}Q=te.endColumn-1}if(ee)return ee}if(Z>0&&U.getStartOffset(Z)===C.column-1){const Q=Z-1,J=this.languageConfigurationService.getLanguageConfiguration(U.getLanguageId(Q)).brackets;if(J&&!ignoreBracketsInToken(U.getStandardTokenType(Q))){const{searchStartOffset:ee,searchEndOffset:te}=this._establishBracketSearchOffsets(C,U,J,Q),ie=BracketsUtils.findPrevBracketInRange(J.reversedRegex,V,G,ee,te);if(ie&&ie.startColumn<=C.column&&C.column<=ie.endColumn){const ne=G.substring(ie.startColumn-1,ie.endColumn-1).toLowerCase(),oe=this._matchFoundBracket(ie,J.textIsBracket[ne],J.textIsOpenBracket[ne],W);if(oe)return oe instanceof BracketSearchCanceled?null:oe}}}return null}_matchFoundBracket(C,W,V,U){if(!W)return null;const G=V?this._findMatchingBracketDown(W,C.getEndPosition(),U):this._findMatchingBracketUp(W,C.getStartPosition(),U);return G?G instanceof BracketSearchCanceled?G:[C,G]:null}_findMatchingBracketUp(C,W,V){const U=C.languageId,G=C.reversedRegex;let Z=-1,X=0;const Q=(J,ee,te,ie)=>{for(;;){if(V&&++X%100===0&&!V())return BracketSearchCanceled.INSTANCE;const ne=BracketsUtils.findPrevBracketInRange(G,J,ee,te,ie);if(!ne)break;const oe=ee.substring(ne.startColumn-1,ne.endColumn-1).toLowerCase();if(C.isOpen(oe)?Z++:C.isClose(oe)&&Z--,Z===0)return ne;ie=ne.startColumn-1}return null};for(let J=W.lineNumber;J>=1;J--){const ee=this.textModel.tokenization.getLineTokens(J),te=ee.getCount(),ie=this.textModel.getLineContent(J);let ne=te-1,oe=ie.length,re=ie.length;J===W.lineNumber&&(ne=ee.findTokenIndexAtOffset(W.column-1),oe=W.column-1,re=W.column-1);let ae=!0;for(;ne>=0;ne--){const se=ee.getLanguageId(ne)===U&&!ignoreBracketsInToken(ee.getStandardTokenType(ne));if(se)ae?oe=ee.getStartOffset(ne):(oe=ee.getStartOffset(ne),re=ee.getEndOffset(ne));else if(ae&&oe!==re){const le=Q(J,ie,oe,re);if(le)return le}ae=se}if(ae&&oe!==re){const se=Q(J,ie,oe,re);if(se)return se}}return null}_findMatchingBracketDown(C,W,V){const U=C.languageId,G=C.forwardRegex;let Z=1,X=0;const Q=(ee,te,ie,ne)=>{for(;;){if(V&&++X%100===0&&!V())return BracketSearchCanceled.INSTANCE;const oe=BracketsUtils.findNextBracketInRange(G,ee,te,ie,ne);if(!oe)break;const re=te.substring(oe.startColumn-1,oe.endColumn-1).toLowerCase();if(C.isOpen(re)?Z++:C.isClose(re)&&Z--,Z===0)return oe;ie=oe.endColumn-1}return null},J=this.textModel.getLineCount();for(let ee=W.lineNumber;ee<=J;ee++){const te=this.textModel.tokenization.getLineTokens(ee),ie=te.getCount(),ne=this.textModel.getLineContent(ee);let oe=0,re=0,ae=0;ee===W.lineNumber&&(oe=te.findTokenIndexAtOffset(W.column-1),re=W.column-1,ae=W.column-1);let se=!0;for(;oe<ie;oe++){const le=te.getLanguageId(oe)===U&&!ignoreBracketsInToken(te.getStandardTokenType(oe));if(le)se||(re=te.getStartOffset(oe)),ae=te.getEndOffset(oe);else if(se&&re!==ae){const ce=Q(ee,ne,re,ae);if(ce)return ce}se=le}if(se&&re!==ae){const le=Q(ee,ne,re,ae);if(le)return le}}return null}findPrevBracket(C){var W;const V=this.textModel.validatePosition(C);if(this.canBuildAST)return this.bracketsRequested=!0,this.updateBracketPairsTree(),((W=this.bracketPairsTree.value)===null||W===void 0?void 0:W.object.getFirstBracketBefore(V))||null;let U=null,G=null,Z=null;for(let X=V.lineNumber;X>=1;X--){const Q=this.textModel.tokenization.getLineTokens(X),J=Q.getCount(),ee=this.textModel.getLineContent(X);let te=J-1,ie=ee.length,ne=ee.length;if(X===V.lineNumber){te=Q.findTokenIndexAtOffset(V.column-1),ie=V.column-1,ne=V.column-1;const re=Q.getLanguageId(te);U!==re&&(U=re,G=this.languageConfigurationService.getLanguageConfiguration(U).brackets,Z=this.languageConfigurationService.getLanguageConfiguration(U).bracketsNew)}let oe=!0;for(;te>=0;te--){const re=Q.getLanguageId(te);if(U!==re){if(G&&Z&&oe&&ie!==ne){const se=BracketsUtils.findPrevBracketInRange(G.reversedRegex,X,ee,ie,ne);if(se)return this._toFoundBracket(Z,se);oe=!1}U=re,G=this.languageConfigurationService.getLanguageConfiguration(U).brackets,Z=this.languageConfigurationService.getLanguageConfiguration(U).bracketsNew}const ae=!!G&&!ignoreBracketsInToken(Q.getStandardTokenType(te));if(ae)oe?ie=Q.getStartOffset(te):(ie=Q.getStartOffset(te),ne=Q.getEndOffset(te));else if(Z&&G&&oe&&ie!==ne){const se=BracketsUtils.findPrevBracketInRange(G.reversedRegex,X,ee,ie,ne);if(se)return this._toFoundBracket(Z,se)}oe=ae}if(Z&&G&&oe&&ie!==ne){const re=BracketsUtils.findPrevBracketInRange(G.reversedRegex,X,ee,ie,ne);if(re)return this._toFoundBracket(Z,re)}}return null}findNextBracket(C){var W;const V=this.textModel.validatePosition(C);if(this.canBuildAST)return this.bracketsRequested=!0,this.updateBracketPairsTree(),((W=this.bracketPairsTree.value)===null||W===void 0?void 0:W.object.getFirstBracketAfter(V))||null;const U=this.textModel.getLineCount();let G=null,Z=null,X=null;for(let Q=V.lineNumber;Q<=U;Q++){const J=this.textModel.tokenization.getLineTokens(Q),ee=J.getCount(),te=this.textModel.getLineContent(Q);let ie=0,ne=0,oe=0;if(Q===V.lineNumber){ie=J.findTokenIndexAtOffset(V.column-1),ne=V.column-1,oe=V.column-1;const ae=J.getLanguageId(ie);G!==ae&&(G=ae,Z=this.languageConfigurationService.getLanguageConfiguration(G).brackets,X=this.languageConfigurationService.getLanguageConfiguration(G).bracketsNew)}let re=!0;for(;ie<ee;ie++){const ae=J.getLanguageId(ie);if(G!==ae){if(X&&Z&&re&&ne!==oe){const le=BracketsUtils.findNextBracketInRange(Z.forwardRegex,Q,te,ne,oe);if(le)return this._toFoundBracket(X,le);re=!1}G=ae,Z=this.languageConfigurationService.getLanguageConfiguration(G).brackets,X=this.languageConfigurationService.getLanguageConfiguration(G).bracketsNew}const se=!!Z&&!ignoreBracketsInToken(J.getStandardTokenType(ie));if(se)re||(ne=J.getStartOffset(ie)),oe=J.getEndOffset(ie);else if(X&&Z&&re&&ne!==oe){const le=BracketsUtils.findNextBracketInRange(Z.forwardRegex,Q,te,ne,oe);if(le)return this._toFoundBracket(X,le)}re=se}if(X&&Z&&re&&ne!==oe){const ae=BracketsUtils.findNextBracketInRange(Z.forwardRegex,Q,te,ne,oe);if(ae)return this._toFoundBracket(X,ae)}}return null}findEnclosingBrackets(C,W){const V=this.textModel.validatePosition(C);if(this.canBuildAST){const ne=Range$2.fromPositions(V),oe=this.getBracketPairsInRange(Range$2.fromPositions(V,V)).findLast(re=>re.closingBracketRange!==void 0&&re.range.strictContainsRange(ne));return oe?[oe.openingBracketRange,oe.closingBracketRange]:null}const U=createTimeBasedContinueBracketSearchPredicate(W),G=this.textModel.getLineCount(),Z=new Map;let X=[];const Q=(ne,oe)=>{if(!Z.has(ne)){const re=[];for(let ae=0,se=oe?oe.brackets.length:0;ae<se;ae++)re[ae]=0;Z.set(ne,re)}X=Z.get(ne)};let J=0;const ee=(ne,oe,re,ae,se)=>{for(;;){if(U&&++J%100===0&&!U())return BracketSearchCanceled.INSTANCE;const le=BracketsUtils.findNextBracketInRange(ne.forwardRegex,oe,re,ae,se);if(!le)break;const ce=re.substring(le.startColumn-1,le.endColumn-1).toLowerCase(),de=ne.textIsBracket[ce];if(de&&(de.isOpen(ce)?X[de.index]++:de.isClose(ce)&&X[de.index]--,X[de.index]===-1))return this._matchFoundBracket(le,de,!1,U);ae=le.endColumn-1}return null};let te=null,ie=null;for(let ne=V.lineNumber;ne<=G;ne++){const oe=this.textModel.tokenization.getLineTokens(ne),re=oe.getCount(),ae=this.textModel.getLineContent(ne);let se=0,le=0,ce=0;if(ne===V.lineNumber){se=oe.findTokenIndexAtOffset(V.column-1),le=V.column-1,ce=V.column-1;const ue=oe.getLanguageId(se);te!==ue&&(te=ue,ie=this.languageConfigurationService.getLanguageConfiguration(te).brackets,Q(te,ie))}let de=!0;for(;se<re;se++){const ue=oe.getLanguageId(se);if(te!==ue){if(ie&&de&&le!==ce){const he=ee(ie,ne,ae,le,ce);if(he)return stripBracketSearchCanceled(he);de=!1}te=ue,ie=this.languageConfigurationService.getLanguageConfiguration(te).brackets,Q(te,ie)}const ge=!!ie&&!ignoreBracketsInToken(oe.getStandardTokenType(se));if(ge)de||(le=oe.getStartOffset(se)),ce=oe.getEndOffset(se);else if(ie&&de&&le!==ce){const he=ee(ie,ne,ae,le,ce);if(he)return stripBracketSearchCanceled(he)}de=ge}if(ie&&de&&le!==ce){const ue=ee(ie,ne,ae,le,ce);if(ue)return stripBracketSearchCanceled(ue)}}return null}_toFoundBracket(C,W){if(!W)return null;let V=this.textModel.getValueInRange(W);V=V.toLowerCase();const U=C.getBracketInfo(V);return U?{range:W,bracketInfo:U}:null}}function createDisposableRef(K,C){return{object:K,dispose:()=>C==null?void 0:C.dispose()}}function createTimeBasedContinueBracketSearchPredicate(K){if(typeof K>"u")return()=>!0;{const C=Date.now();return()=>Date.now()-C<=K}}class BracketSearchCanceled{constructor(){this._searchCanceledBrand=void 0}}BracketSearchCanceled.INSTANCE=new BracketSearchCanceled;function stripBracketSearchCanceled(K){return K instanceof BracketSearchCanceled?null:K}class ColorizedBracketPairsDecorationProvider extends Disposable{constructor(C){super(),this.textModel=C,this.colorProvider=new ColorProvider,this.onDidChangeEmitter=new Emitter$1,this.onDidChange=this.onDidChangeEmitter.event,this.colorizationOptions=C.getOptions().bracketPairColorizationOptions,this._register(C.bracketPairs.onDidChange(W=>{this.onDidChangeEmitter.fire()}))}handleDidChangeOptions(C){this.colorizationOptions=this.textModel.getOptions().bracketPairColorizationOptions}getDecorationsInRange(C,W,V,U){return U?[]:W===void 0?[]:this.colorizationOptions.enabled?this.textModel.bracketPairs.getBracketsInRange(C,!0).map(Z=>({id:`bracket${Z.range.toString()}-${Z.nestingLevel}`,options:{description:"BracketPairColorization",inlineClassName:this.colorProvider.getInlineClassName(Z,this.colorizationOptions.independentColorPoolPerBracketType)},ownerId:0,range:Z.range})).toArray():[]}getAllDecorations(C,W){return C===void 0?[]:this.colorizationOptions.enabled?this.getDecorationsInRange(new Range$2(1,1,this.textModel.getLineCount(),1),C,W):[]}}class ColorProvider{constructor(){this.unexpectedClosingBracketClassName="unexpected-closing-bracket"}getInlineClassName(C,W){return C.isInvalid?this.unexpectedClosingBracketClassName:this.getInlineClassNameOfLevel(W?C.nestingLevelOfEqualBracketType:C.nestingLevel)}getInlineClassNameOfLevel(C){return`bracket-highlighting-${C%30}`}}registerThemingParticipant((K,C)=>{const W=[editorBracketHighlightingForeground1,editorBracketHighlightingForeground2,editorBracketHighlightingForeground3,editorBracketHighlightingForeground4,editorBracketHighlightingForeground5,editorBracketHighlightingForeground6],V=new ColorProvider;C.addRule(`.monaco-editor .${V.unexpectedClosingBracketClassName} { color: ${K.getColor(editorBracketHighlightingUnexpectedBracketForeground)}; }`);const U=W.map(G=>K.getColor(G)).filter(G=>!!G).filter(G=>!G.isTransparent());for(let G=0;G<30;G++){const Z=U[G%U.length];C.addRule(`.monaco-editor .${V.getInlineClassNameOfLevel(G)} { color: ${Z}; }`)}});function escapeNewLine(K){return K.replace(/\n/g,"\\n").replace(/\r/g,"\\r")}class TextChange{get oldLength(){return this.oldText.length}get oldEnd(){return this.oldPosition+this.oldText.length}get newLength(){return this.newText.length}get newEnd(){return this.newPosition+this.newText.length}constructor(C,W,V,U){this.oldPosition=C,this.oldText=W,this.newPosition=V,this.newText=U}toString(){return this.oldText.length===0?`(insert@${this.oldPosition} "${escapeNewLine(this.newText)}")`:this.newText.length===0?`(delete@${this.oldPosition} "${escapeNewLine(this.oldText)}")`:`(replace@${this.oldPosition} "${escapeNewLine(this.oldText)}" with "${escapeNewLine(this.newText)}")`}static _writeStringSize(C){return 4+2*C.length}static _writeString(C,W,V){const U=W.length;writeUInt32BE(C,U,V),V+=4;for(let G=0;G<U;G++)writeUInt16LE(C,W.charCodeAt(G),V),V+=2;return V}static _readString(C,W){const V=readUInt32BE(C,W);return W+=4,decodeUTF16LE(C,W,V)}writeSize(){return 4+4+TextChange._writeStringSize(this.oldText)+TextChange._writeStringSize(this.newText)}write(C,W){return writeUInt32BE(C,this.oldPosition,W),W+=4,writeUInt32BE(C,this.newPosition,W),W+=4,W=TextChange._writeString(C,this.oldText,W),W=TextChange._writeString(C,this.newText,W),W}static read(C,W,V){const U=readUInt32BE(C,W);W+=4;const G=readUInt32BE(C,W);W+=4;const Z=TextChange._readString(C,W);W+=TextChange._writeStringSize(Z);const X=TextChange._readString(C,W);return W+=TextChange._writeStringSize(X),V.push(new TextChange(U,Z,G,X)),W}}function compressConsecutiveTextChanges(K,C){return K===null||K.length===0?C:new TextChangeCompressor(K,C).compress()}class TextChangeCompressor{constructor(C,W){this._prevEdits=C,this._currEdits=W,this._result=[],this._resultLen=0,this._prevLen=this._prevEdits.length,this._prevDeltaOffset=0,this._currLen=this._currEdits.length,this._currDeltaOffset=0}compress(){let C=0,W=0,V=this._getPrev(C),U=this._getCurr(W);for(;C<this._prevLen||W<this._currLen;){if(V===null){this._acceptCurr(U),U=this._getCurr(++W);continue}if(U===null){this._acceptPrev(V),V=this._getPrev(++C);continue}if(U.oldEnd<=V.newPosition){this._acceptCurr(U),U=this._getCurr(++W);continue}if(V.newEnd<=U.oldPosition){this._acceptPrev(V),V=this._getPrev(++C);continue}if(U.oldPosition<V.newPosition){const[J,ee]=TextChangeCompressor._splitCurr(U,V.newPosition-U.oldPosition);this._acceptCurr(J),U=ee;continue}if(V.newPosition<U.oldPosition){const[J,ee]=TextChangeCompressor._splitPrev(V,U.oldPosition-V.newPosition);this._acceptPrev(J),V=ee;continue}let X,Q;if(U.oldEnd===V.newEnd)X=V,Q=U,V=this._getPrev(++C),U=this._getCurr(++W);else if(U.oldEnd<V.newEnd){const[J,ee]=TextChangeCompressor._splitPrev(V,U.oldLength);X=J,Q=U,V=ee,U=this._getCurr(++W)}else{const[J,ee]=TextChangeCompressor._splitCurr(U,V.newLength);X=V,Q=J,V=this._getPrev(++C),U=ee}this._result[this._resultLen++]=new TextChange(X.oldPosition,X.oldText,Q.newPosition,Q.newText),this._prevDeltaOffset+=X.newLength-X.oldLength,this._currDeltaOffset+=Q.newLength-Q.oldLength}const G=TextChangeCompressor._merge(this._result);return TextChangeCompressor._removeNoOps(G)}_acceptCurr(C){this._result[this._resultLen++]=TextChangeCompressor._rebaseCurr(this._prevDeltaOffset,C),this._currDeltaOffset+=C.newLength-C.oldLength}_getCurr(C){return C<this._currLen?this._currEdits[C]:null}_acceptPrev(C){this._result[this._resultLen++]=TextChangeCompressor._rebasePrev(this._currDeltaOffset,C),this._prevDeltaOffset+=C.newLength-C.oldLength}_getPrev(C){return C<this._prevLen?this._prevEdits[C]:null}static _rebaseCurr(C,W){return new TextChange(W.oldPosition-C,W.oldText,W.newPosition,W.newText)}static _rebasePrev(C,W){return new TextChange(W.oldPosition,W.oldText,W.newPosition+C,W.newText)}static _splitPrev(C,W){const V=C.newText.substr(0,W),U=C.newText.substr(W);return[new TextChange(C.oldPosition,C.oldText,C.newPosition,V),new TextChange(C.oldEnd,"",C.newPosition+W,U)]}static _splitCurr(C,W){const V=C.oldText.substr(0,W),U=C.oldText.substr(W);return[new TextChange(C.oldPosition,V,C.newPosition,C.newText),new TextChange(C.oldPosition+W,U,C.newEnd,"")]}static _merge(C){if(C.length===0)return C;const W=[];let V=0,U=C[0];for(let G=1;G<C.length;G++){const Z=C[G];U.oldEnd===Z.oldPosition?U=new TextChange(U.oldPosition,U.oldText+Z.oldText,U.newPosition,U.newText+Z.newText):(W[V++]=U,U=Z)}return W[V++]=U,W}static _removeNoOps(C){if(C.length===0)return C;const W=[];let V=0;for(let U=0;U<C.length;U++){const G=C[U];G.oldText!==G.newText&&(W[V++]=G)}return W}}function isPathSeparator(K){return K===47||K===92}function toSlashes(K){return K.replace(/[\\/]/g,posix.sep)}function toPosixPath(K){return K.indexOf("/")===-1&&(K=toSlashes(K)),/^[a-zA-Z]:(\/|$)/.test(K)&&(K="/"+K),K}function getRoot(K,C=posix.sep){if(!K)return"";const W=K.length,V=K.charCodeAt(0);if(isPathSeparator(V)){if(isPathSeparator(K.charCodeAt(1))&&!isPathSeparator(K.charCodeAt(2))){let G=3;const Z=G;for(;G<W&&!isPathSeparator(K.charCodeAt(G));G++);if(Z!==G&&!isPathSeparator(K.charCodeAt(G+1))){for(G+=1;G<W;G++)if(isPathSeparator(K.charCodeAt(G)))return K.slice(0,G+1).replace(/[\\/]/g,C)}}return C}else if(isWindowsDriveLetter(V)&&K.charCodeAt(1)===58)return isPathSeparator(K.charCodeAt(2))?K.slice(0,2)+C:K.slice(0,2);let U=K.indexOf("://");if(U!==-1){for(U+=3;U<W;U++)if(isPathSeparator(K.charCodeAt(U)))return K.slice(0,U+1)}return""}function isEqualOrParent(K,C,W,V=sep){if(K===C)return!0;if(!K||!C||C.length>K.length)return!1;if(W){if(!startsWithIgnoreCase(K,C))return!1;if(C.length===K.length)return!0;let G=C.length;return C.charAt(C.length-1)===V&&G--,K.charAt(G)===V}return C.charAt(C.length-1)!==V&&(C+=V),K.indexOf(C)===0}function isWindowsDriveLetter(K){return K>=65&&K<=90||K>=97&&K<=122}function hasDriveLetter(K,C=isWindows){return C?isWindowsDriveLetter(K.charCodeAt(0))&&K.charCodeAt(1)===58:!1}function originalFSPath(K){return uriToFsPath(K,!0)}class ExtUri{constructor(C){this._ignorePathCasing=C}compare(C,W,V=!1){return C===W?0:compare$1(this.getComparisonKey(C,V),this.getComparisonKey(W,V))}isEqual(C,W,V=!1){return C===W?!0:!C||!W?!1:this.getComparisonKey(C,V)===this.getComparisonKey(W,V)}getComparisonKey(C,W=!1){return C.with({path:this._ignorePathCasing(C)?C.path.toLowerCase():void 0,fragment:W?null:void 0}).toString()}isEqualOrParent(C,W,V=!1){if(C.scheme===W.scheme){if(C.scheme===Schemas.file)return isEqualOrParent(originalFSPath(C),originalFSPath(W),this._ignorePathCasing(C))&&C.query===W.query&&(V||C.fragment===W.fragment);if(isEqualAuthority(C.authority,W.authority))return isEqualOrParent(C.path,W.path,this._ignorePathCasing(C),"/")&&C.query===W.query&&(V||C.fragment===W.fragment)}return!1}joinPath(C,...W){return URI.joinPath(C,...W)}basenameOrAuthority(C){return basename(C)||C.authority}basename(C){return posix.basename(C.path)}extname(C){return posix.extname(C.path)}dirname(C){if(C.path.length===0)return C;let W;return C.scheme===Schemas.file?W=URI.file(dirname$1(originalFSPath(C))).path:(W=posix.dirname(C.path),C.authority&&W.length&&W.charCodeAt(0)!==47&&(console.error(`dirname("${C.toString})) resulted in a relative path`),W="/")),C.with({path:W})}normalizePath(C){if(!C.path.length)return C;let W;return C.scheme===Schemas.file?W=URI.file(normalize(originalFSPath(C))).path:W=posix.normalize(C.path),C.with({path:W})}relativePath(C,W){if(C.scheme!==W.scheme||!isEqualAuthority(C.authority,W.authority))return;if(C.scheme===Schemas.file){const G=relative(originalFSPath(C),originalFSPath(W));return isWindows?toSlashes(G):G}let V=C.path||"/";const U=W.path||"/";if(this._ignorePathCasing(C)){let G=0;for(const Z=Math.min(V.length,U.length);G<Z&&!(V.charCodeAt(G)!==U.charCodeAt(G)&&V.charAt(G).toLowerCase()!==U.charAt(G).toLowerCase());G++);V=U.substr(0,G)+V.substr(G)}return posix.relative(V,U)}resolvePath(C,W){if(C.scheme===Schemas.file){const V=URI.file(resolve(originalFSPath(C),W));return C.with({authority:V.authority,path:V.path})}return W=toPosixPath(W),C.with({path:posix.resolve(C.path,W)})}isAbsolutePath(C){return!!C.path&&C.path[0]==="/"}isEqualAuthority(C,W){return C===W||C!==void 0&&W!==void 0&&equalsIgnoreCase(C,W)}hasTrailingPathSeparator(C,W=sep){if(C.scheme===Schemas.file){const V=originalFSPath(C);return V.length>getRoot(V).length&&V[V.length-1]===W}else{const V=C.path;return V.length>1&&V.charCodeAt(V.length-1)===47&&!/^[a-zA-Z]:(\/$|\\$)/.test(C.fsPath)}}removeTrailingPathSeparator(C,W=sep){return hasTrailingPathSeparator(C,W)?C.with({path:C.path.substr(0,C.path.length-1)}):C}addTrailingPathSeparator(C,W=sep){let V=!1;if(C.scheme===Schemas.file){const U=originalFSPath(C);V=U!==void 0&&U.length===getRoot(U).length&&U[U.length-1]===W}else{W="/";const U=C.path;V=U.length===1&&U.charCodeAt(U.length-1)===47}return!V&&!hasTrailingPathSeparator(C,W)?C.with({path:C.path+"/"}):C}}const extUri=new ExtUri(()=>!1),isEqual=extUri.isEqual.bind(extUri);extUri.isEqualOrParent.bind(extUri);extUri.getComparisonKey.bind(extUri);const basenameOrAuthority=extUri.basenameOrAuthority.bind(extUri),basename=extUri.basename.bind(extUri),extname=extUri.extname.bind(extUri),dirname=extUri.dirname.bind(extUri),joinPath=extUri.joinPath.bind(extUri),normalizePath=extUri.normalizePath.bind(extUri),relativePath=extUri.relativePath.bind(extUri),resolvePath=extUri.resolvePath.bind(extUri);extUri.isAbsolutePath.bind(extUri);const isEqualAuthority=extUri.isEqualAuthority.bind(extUri),hasTrailingPathSeparator=extUri.hasTrailingPathSeparator.bind(extUri);extUri.removeTrailingPathSeparator.bind(extUri);extUri.addTrailingPathSeparator.bind(extUri);var DataUri;(function(K){K.META_DATA_LABEL="label",K.META_DATA_DESCRIPTION="description",K.META_DATA_SIZE="size",K.META_DATA_MIME="mime";function C(W){const V=new Map;W.path.substring(W.path.indexOf(";")+1,W.path.lastIndexOf(";")).split(";").forEach(Z=>{const[X,Q]=Z.split(":");X&&Q&&V.set(X,Q)});const G=W.path.substring(0,W.path.indexOf(";"));return G&&V.set(K.META_DATA_MIME,G),V}K.parseMetaData=C})(DataUri||(DataUri={}));function uriGetComparisonKey(K){return K.toString()}class SingleModelEditStackData{static create(C,W){const V=C.getAlternativeVersionId(),U=getModelEOL(C);return new SingleModelEditStackData(V,V,U,U,W,W,[])}constructor(C,W,V,U,G,Z,X){this.beforeVersionId=C,this.afterVersionId=W,this.beforeEOL=V,this.afterEOL=U,this.beforeCursorState=G,this.afterCursorState=Z,this.changes=X}append(C,W,V,U,G){W.length>0&&(this.changes=compressConsecutiveTextChanges(this.changes,W)),this.afterEOL=V,this.afterVersionId=U,this.afterCursorState=G}static _writeSelectionsSize(C){return 4+4*4*(C?C.length:0)}static _writeSelections(C,W,V){if(writeUInt32BE(C,W?W.length:0,V),V+=4,W)for(const U of W)writeUInt32BE(C,U.selectionStartLineNumber,V),V+=4,writeUInt32BE(C,U.selectionStartColumn,V),V+=4,writeUInt32BE(C,U.positionLineNumber,V),V+=4,writeUInt32BE(C,U.positionColumn,V),V+=4;return V}static _readSelections(C,W,V){const U=readUInt32BE(C,W);W+=4;for(let G=0;G<U;G++){const Z=readUInt32BE(C,W);W+=4;const X=readUInt32BE(C,W);W+=4;const Q=readUInt32BE(C,W);W+=4;const J=readUInt32BE(C,W);W+=4,V.push(new Selection$1(Z,X,Q,J))}return W}serialize(){let C=10+SingleModelEditStackData._writeSelectionsSize(this.beforeCursorState)+SingleModelEditStackData._writeSelectionsSize(this.afterCursorState)+4;for(const U of this.changes)C+=U.writeSize();const W=new Uint8Array(C);let V=0;writeUInt32BE(W,this.beforeVersionId,V),V+=4,writeUInt32BE(W,this.afterVersionId,V),V+=4,writeUInt8(W,this.beforeEOL,V),V+=1,writeUInt8(W,this.afterEOL,V),V+=1,V=SingleModelEditStackData._writeSelections(W,this.beforeCursorState,V),V=SingleModelEditStackData._writeSelections(W,this.afterCursorState,V),writeUInt32BE(W,this.changes.length,V),V+=4;for(const U of this.changes)V=U.write(W,V);return W.buffer}static deserialize(C){const W=new Uint8Array(C);let V=0;const U=readUInt32BE(W,V);V+=4;const G=readUInt32BE(W,V);V+=4;const Z=readUInt8(W,V);V+=1;const X=readUInt8(W,V);V+=1;const Q=[];V=SingleModelEditStackData._readSelections(W,V,Q);const J=[];V=SingleModelEditStackData._readSelections(W,V,J);const ee=readUInt32BE(W,V);V+=4;const te=[];for(let ie=0;ie<ee;ie++)V=TextChange.read(W,V,te);return new SingleModelEditStackData(U,G,Z,X,Q,J,te)}}class SingleModelEditStackElement{get type(){return 0}get resource(){return URI.isUri(this.model)?this.model:this.model.uri}constructor(C,W,V,U){this.label=C,this.code=W,this.model=V,this._data=SingleModelEditStackData.create(V,U)}toString(){return(this._data instanceof SingleModelEditStackData?this._data:SingleModelEditStackData.deserialize(this._data)).changes.map(W=>W.toString()).join(", ")}matchesResource(C){return(URI.isUri(this.model)?this.model:this.model.uri).toString()===C.toString()}setModel(C){this.model=C}canAppend(C){return this.model===C&&this._data instanceof SingleModelEditStackData}append(C,W,V,U,G){this._data instanceof SingleModelEditStackData&&this._data.append(C,W,V,U,G)}close(){this._data instanceof SingleModelEditStackData&&(this._data=this._data.serialize())}open(){this._data instanceof SingleModelEditStackData||(this._data=SingleModelEditStackData.deserialize(this._data))}undo(){if(URI.isUri(this.model))throw new Error("Invalid SingleModelEditStackElement");this._data instanceof SingleModelEditStackData&&(this._data=this._data.serialize());const C=SingleModelEditStackData.deserialize(this._data);this.model._applyUndo(C.changes,C.beforeEOL,C.beforeVersionId,C.beforeCursorState)}redo(){if(URI.isUri(this.model))throw new Error("Invalid SingleModelEditStackElement");this._data instanceof SingleModelEditStackData&&(this._data=this._data.serialize());const C=SingleModelEditStackData.deserialize(this._data);this.model._applyRedo(C.changes,C.afterEOL,C.afterVersionId,C.afterCursorState)}heapSize(){return this._data instanceof SingleModelEditStackData&&(this._data=this._data.serialize()),this._data.byteLength+168}}class MultiModelEditStackElement{get resources(){return this._editStackElementsArr.map(C=>C.resource)}constructor(C,W,V){this.label=C,this.code=W,this.type=1,this._isOpen=!0,this._editStackElementsArr=V.slice(0),this._editStackElementsMap=new Map;for(const U of this._editStackElementsArr){const G=uriGetComparisonKey(U.resource);this._editStackElementsMap.set(G,U)}this._delegate=null}prepareUndoRedo(){if(this._delegate)return this._delegate.prepareUndoRedo(this)}matchesResource(C){const W=uriGetComparisonKey(C);return this._editStackElementsMap.has(W)}setModel(C){const W=uriGetComparisonKey(URI.isUri(C)?C:C.uri);this._editStackElementsMap.has(W)&&this._editStackElementsMap.get(W).setModel(C)}canAppend(C){if(!this._isOpen)return!1;const W=uriGetComparisonKey(C.uri);return this._editStackElementsMap.has(W)?this._editStackElementsMap.get(W).canAppend(C):!1}append(C,W,V,U,G){const Z=uriGetComparisonKey(C.uri);this._editStackElementsMap.get(Z).append(C,W,V,U,G)}close(){this._isOpen=!1}open(){}undo(){this._isOpen=!1;for(const C of this._editStackElementsArr)C.undo()}redo(){for(const C of this._editStackElementsArr)C.redo()}heapSize(C){const W=uriGetComparisonKey(C);return this._editStackElementsMap.has(W)?this._editStackElementsMap.get(W).heapSize():0}split(){return this._editStackElementsArr}toString(){const C=[];for(const W of this._editStackElementsArr)C.push(`${basename(W.resource)}: ${W}`);return`{${C.join(", ")}}`}}function getModelEOL(K){return K.getEOL()===`
`?0:1}function isEditStackElement(K){return K?K instanceof SingleModelEditStackElement||K instanceof MultiModelEditStackElement:!1}class EditStack{constructor(C,W){this._model=C,this._undoRedoService=W}pushStackElement(){const C=this._undoRedoService.getLastElement(this._model.uri);isEditStackElement(C)&&C.close()}popStackElement(){const C=this._undoRedoService.getLastElement(this._model.uri);isEditStackElement(C)&&C.open()}clear(){this._undoRedoService.removeElements(this._model.uri)}_getOrCreateEditStackElement(C,W){const V=this._undoRedoService.getLastElement(this._model.uri);if(isEditStackElement(V)&&V.canAppend(this._model))return V;const U=new SingleModelEditStackElement(localize("edit","Typing"),"undoredo.textBufferEdit",this._model,C);return this._undoRedoService.pushElement(U,W),U}pushEOL(C){const W=this._getOrCreateEditStackElement(null,void 0);this._model.setEOL(C),W.append(this._model,[],getModelEOL(this._model),this._model.getAlternativeVersionId(),null)}pushEditOperation(C,W,V,U){const G=this._getOrCreateEditStackElement(C,U),Z=this._model.applyEdits(W,!0),X=EditStack._computeCursorState(V,Z),Q=Z.map((J,ee)=>({index:ee,textChange:J.textChange}));return Q.sort((J,ee)=>J.textChange.oldPosition===ee.textChange.oldPosition?J.index-ee.index:J.textChange.oldPosition-ee.textChange.oldPosition),G.append(this._model,Q.map(J=>J.textChange),getModelEOL(this._model),this._model.getAlternativeVersionId(),X),X}static _computeCursorState(C,W){try{return C?C(W):null}catch(V){return onUnexpectedError(V),null}}}class SpacesDiffResult{constructor(){this.spacesDiff=0,this.looksLikeAlignment=!1}}function spacesDiff(K,C,W,V,U){U.spacesDiff=0,U.looksLikeAlignment=!1;let G;for(G=0;G<C&&G<V;G++){const ie=K.charCodeAt(G),ne=W.charCodeAt(G);if(ie!==ne)break}let Z=0,X=0;for(let ie=G;ie<C;ie++)K.charCodeAt(ie)===32?Z++:X++;let Q=0,J=0;for(let ie=G;ie<V;ie++)W.charCodeAt(ie)===32?Q++:J++;if(Z>0&&X>0||Q>0&&J>0)return;const ee=Math.abs(X-J),te=Math.abs(Z-Q);if(ee===0){U.spacesDiff=te,te>0&&0<=Q-1&&Q-1<K.length&&Q<W.length&&W.charCodeAt(Q)!==32&&K.charCodeAt(Q-1)===32&&K.charCodeAt(K.length-1)===44&&(U.looksLikeAlignment=!0);return}if(te%ee===0){U.spacesDiff=te/ee;return}}function guessIndentation(K,C,W){const V=Math.min(K.getLineCount(),1e4);let U=0,G=0,Z="",X=0;const Q=[2,4,6,8,3,5,7],J=8,ee=[0,0,0,0,0,0,0,0,0],te=new SpacesDiffResult;for(let oe=1;oe<=V;oe++){const re=K.getLineLength(oe),ae=K.getLineContent(oe),se=re<=65536;let le=!1,ce=0,de=0,ue=0;for(let he=0,fe=re;he<fe;he++){const pe=se?ae.charCodeAt(he):K.getLineCharCode(oe,he);if(pe===9)ue++;else if(pe===32)de++;else{le=!0,ce=he;break}}if(!le||(ue>0?U++:de>1&&G++,spacesDiff(Z,X,ae,ce,te),te.looksLikeAlignment&&!(W&&C===te.spacesDiff)))continue;const ge=te.spacesDiff;ge<=J&&ee[ge]++,Z=ae,X=ce}let ie=W;U!==G&&(ie=U<G);let ne=C;if(ie){let oe=ie?0:.1*V;Q.forEach(re=>{const ae=ee[re];ae>oe&&(oe=ae,ne=re)}),ne===4&&ee[4]>0&&ee[2]>0&&ee[2]>=ee[4]/2&&(ne=2)}return{insertSpaces:ie,tabSize:ne}}function getNodeColor(K){return(K.metadata&1)>>>0}function setNodeColor(K,C){K.metadata=K.metadata&254|C<<0}function getNodeIsVisited(K){return(K.metadata&2)>>>1===1}function setNodeIsVisited(K,C){K.metadata=K.metadata&253|(C?1:0)<<1}function getNodeIsForValidation(K){return(K.metadata&4)>>>2===1}function setNodeIsForValidation(K,C){K.metadata=K.metadata&251|(C?1:0)<<2}function getNodeIsInGlyphMargin(K){return(K.metadata&64)>>>6===1}function setNodeIsInGlyphMargin(K,C){K.metadata=K.metadata&191|(C?1:0)<<6}function getNodeStickiness(K){return(K.metadata&24)>>>3}function _setNodeStickiness(K,C){K.metadata=K.metadata&231|C<<3}function getCollapseOnReplaceEdit(K){return(K.metadata&32)>>>5===1}function setCollapseOnReplaceEdit(K,C){K.metadata=K.metadata&223|(C?1:0)<<5}class IntervalNode{constructor(C,W,V){this.metadata=0,this.parent=this,this.left=this,this.right=this,setNodeColor(this,1),this.start=W,this.end=V,this.delta=0,this.maxEnd=V,this.id=C,this.ownerId=0,this.options=null,setNodeIsForValidation(this,!1),setNodeIsInGlyphMargin(this,!1),_setNodeStickiness(this,1),setCollapseOnReplaceEdit(this,!1),this.cachedVersionId=0,this.cachedAbsoluteStart=W,this.cachedAbsoluteEnd=V,this.range=null,setNodeIsVisited(this,!1)}reset(C,W,V,U){this.start=W,this.end=V,this.maxEnd=V,this.cachedVersionId=C,this.cachedAbsoluteStart=W,this.cachedAbsoluteEnd=V,this.range=U}setOptions(C){this.options=C;const W=this.options.className;setNodeIsForValidation(this,W==="squiggly-error"||W==="squiggly-warning"||W==="squiggly-info"),setNodeIsInGlyphMargin(this,this.options.glyphMarginClassName!==null),_setNodeStickiness(this,this.options.stickiness),setCollapseOnReplaceEdit(this,this.options.collapseOnReplaceEdit)}setCachedOffsets(C,W,V){this.cachedVersionId!==V&&(this.range=null),this.cachedVersionId=V,this.cachedAbsoluteStart=C,this.cachedAbsoluteEnd=W}detach(){this.parent=null,this.left=null,this.right=null}}const SENTINEL$1=new IntervalNode(null,0,0);SENTINEL$1.parent=SENTINEL$1;SENTINEL$1.left=SENTINEL$1;SENTINEL$1.right=SENTINEL$1;setNodeColor(SENTINEL$1,0);class IntervalTree{constructor(){this.root=SENTINEL$1,this.requestNormalizeDelta=!1}intervalSearch(C,W,V,U,G,Z){return this.root===SENTINEL$1?[]:intervalSearch(this,C,W,V,U,G,Z)}search(C,W,V,U){return this.root===SENTINEL$1?[]:search(this,C,W,V,U)}collectNodesFromOwner(C){return collectNodesFromOwner(this,C)}collectNodesPostOrder(){return collectNodesPostOrder(this)}insert(C){rbTreeInsert(this,C),this._normalizeDeltaIfNecessary()}delete(C){rbTreeDelete(this,C),this._normalizeDeltaIfNecessary()}resolveNode(C,W){const V=C;let U=0;for(;C!==this.root;)C===C.parent.right&&(U+=C.parent.delta),C=C.parent;const G=V.start+U,Z=V.end+U;V.setCachedOffsets(G,Z,W)}acceptReplace(C,W,V,U){const G=searchForEditing(this,C,C+W);for(let Z=0,X=G.length;Z<X;Z++){const Q=G[Z];rbTreeDelete(this,Q)}this._normalizeDeltaIfNecessary(),noOverlapReplace(this,C,C+W,V),this._normalizeDeltaIfNecessary();for(let Z=0,X=G.length;Z<X;Z++){const Q=G[Z];Q.start=Q.cachedAbsoluteStart,Q.end=Q.cachedAbsoluteEnd,nodeAcceptEdit(Q,C,C+W,V,U),Q.maxEnd=Q.end,rbTreeInsert(this,Q)}this._normalizeDeltaIfNecessary()}_normalizeDeltaIfNecessary(){this.requestNormalizeDelta&&(this.requestNormalizeDelta=!1,normalizeDelta(this))}}function normalizeDelta(K){let C=K.root,W=0;for(;C!==SENTINEL$1;){if(C.left!==SENTINEL$1&&!getNodeIsVisited(C.left)){C=C.left;continue}if(C.right!==SENTINEL$1&&!getNodeIsVisited(C.right)){W+=C.delta,C=C.right;continue}C.start=W+C.start,C.end=W+C.end,C.delta=0,recomputeMaxEnd(C),setNodeIsVisited(C,!0),setNodeIsVisited(C.left,!1),setNodeIsVisited(C.right,!1),C===C.parent.right&&(W-=C.parent.delta),C=C.parent}setNodeIsVisited(K.root,!1)}function adjustMarkerBeforeColumn(K,C,W,V){return K<W?!0:K>W||V===1?!1:V===2?!0:C}function nodeAcceptEdit(K,C,W,V,U){const G=getNodeStickiness(K),Z=G===0||G===2,X=G===1||G===2,Q=W-C,J=V,ee=Math.min(Q,J),te=K.start;let ie=!1;const ne=K.end;let oe=!1;C<=te&&ne<=W&&getCollapseOnReplaceEdit(K)&&(K.start=C,ie=!0,K.end=C,oe=!0);{const ae=U?1:Q>0?2:0;!ie&&adjustMarkerBeforeColumn(te,Z,C,ae)&&(ie=!0),!oe&&adjustMarkerBeforeColumn(ne,X,C,ae)&&(oe=!0)}if(ee>0&&!U){const ae=Q>J?2:0;!ie&&adjustMarkerBeforeColumn(te,Z,C+ee,ae)&&(ie=!0),!oe&&adjustMarkerBeforeColumn(ne,X,C+ee,ae)&&(oe=!0)}{const ae=U?1:0;!ie&&adjustMarkerBeforeColumn(te,Z,W,ae)&&(K.start=C+J,ie=!0),!oe&&adjustMarkerBeforeColumn(ne,X,W,ae)&&(K.end=C+J,oe=!0)}const re=J-Q;ie||(K.start=Math.max(0,te+re)),oe||(K.end=Math.max(0,ne+re)),K.start>K.end&&(K.end=K.start)}function searchForEditing(K,C,W){let V=K.root,U=0,G=0,Z=0,X=0;const Q=[];let J=0;for(;V!==SENTINEL$1;){if(getNodeIsVisited(V)){setNodeIsVisited(V.left,!1),setNodeIsVisited(V.right,!1),V===V.parent.right&&(U-=V.parent.delta),V=V.parent;continue}if(!getNodeIsVisited(V.left)){if(G=U+V.maxEnd,G<C){setNodeIsVisited(V,!0);continue}if(V.left!==SENTINEL$1){V=V.left;continue}}if(Z=U+V.start,Z>W){setNodeIsVisited(V,!0);continue}if(X=U+V.end,X>=C&&(V.setCachedOffsets(Z,X,0),Q[J++]=V),setNodeIsVisited(V,!0),V.right!==SENTINEL$1&&!getNodeIsVisited(V.right)){U+=V.delta,V=V.right;continue}}return setNodeIsVisited(K.root,!1),Q}function noOverlapReplace(K,C,W,V){let U=K.root,G=0,Z=0,X=0;const Q=V-(W-C);for(;U!==SENTINEL$1;){if(getNodeIsVisited(U)){setNodeIsVisited(U.left,!1),setNodeIsVisited(U.right,!1),U===U.parent.right&&(G-=U.parent.delta),recomputeMaxEnd(U),U=U.parent;continue}if(!getNodeIsVisited(U.left)){if(Z=G+U.maxEnd,Z<C){setNodeIsVisited(U,!0);continue}if(U.left!==SENTINEL$1){U=U.left;continue}}if(X=G+U.start,X>W){U.start+=Q,U.end+=Q,U.delta+=Q,(U.delta<-1073741824||U.delta>1073741824)&&(K.requestNormalizeDelta=!0),setNodeIsVisited(U,!0);continue}if(setNodeIsVisited(U,!0),U.right!==SENTINEL$1&&!getNodeIsVisited(U.right)){G+=U.delta,U=U.right;continue}}setNodeIsVisited(K.root,!1)}function collectNodesFromOwner(K,C){let W=K.root;const V=[];let U=0;for(;W!==SENTINEL$1;){if(getNodeIsVisited(W)){setNodeIsVisited(W.left,!1),setNodeIsVisited(W.right,!1),W=W.parent;continue}if(W.left!==SENTINEL$1&&!getNodeIsVisited(W.left)){W=W.left;continue}if(W.ownerId===C&&(V[U++]=W),setNodeIsVisited(W,!0),W.right!==SENTINEL$1&&!getNodeIsVisited(W.right)){W=W.right;continue}}return setNodeIsVisited(K.root,!1),V}function collectNodesPostOrder(K){let C=K.root;const W=[];let V=0;for(;C!==SENTINEL$1;){if(getNodeIsVisited(C)){setNodeIsVisited(C.left,!1),setNodeIsVisited(C.right,!1),C=C.parent;continue}if(C.left!==SENTINEL$1&&!getNodeIsVisited(C.left)){C=C.left;continue}if(C.right!==SENTINEL$1&&!getNodeIsVisited(C.right)){C=C.right;continue}W[V++]=C,setNodeIsVisited(C,!0)}return setNodeIsVisited(K.root,!1),W}function search(K,C,W,V,U){let G=K.root,Z=0,X=0,Q=0;const J=[];let ee=0;for(;G!==SENTINEL$1;){if(getNodeIsVisited(G)){setNodeIsVisited(G.left,!1),setNodeIsVisited(G.right,!1),G===G.parent.right&&(Z-=G.parent.delta),G=G.parent;continue}if(G.left!==SENTINEL$1&&!getNodeIsVisited(G.left)){G=G.left;continue}X=Z+G.start,Q=Z+G.end,G.setCachedOffsets(X,Q,V);let te=!0;if(C&&G.ownerId&&G.ownerId!==C&&(te=!1),W&&getNodeIsForValidation(G)&&(te=!1),U&&!getNodeIsInGlyphMargin(G)&&(te=!1),te&&(J[ee++]=G),setNodeIsVisited(G,!0),G.right!==SENTINEL$1&&!getNodeIsVisited(G.right)){Z+=G.delta,G=G.right;continue}}return setNodeIsVisited(K.root,!1),J}function intervalSearch(K,C,W,V,U,G,Z){let X=K.root,Q=0,J=0,ee=0,te=0;const ie=[];let ne=0;for(;X!==SENTINEL$1;){if(getNodeIsVisited(X)){setNodeIsVisited(X.left,!1),setNodeIsVisited(X.right,!1),X===X.parent.right&&(Q-=X.parent.delta),X=X.parent;continue}if(!getNodeIsVisited(X.left)){if(J=Q+X.maxEnd,J<C){setNodeIsVisited(X,!0);continue}if(X.left!==SENTINEL$1){X=X.left;continue}}if(ee=Q+X.start,ee>W){setNodeIsVisited(X,!0);continue}if(te=Q+X.end,te>=C){X.setCachedOffsets(ee,te,G);let oe=!0;V&&X.ownerId&&X.ownerId!==V&&(oe=!1),U&&getNodeIsForValidation(X)&&(oe=!1),Z&&!getNodeIsInGlyphMargin(X)&&(oe=!1),oe&&(ie[ne++]=X)}if(setNodeIsVisited(X,!0),X.right!==SENTINEL$1&&!getNodeIsVisited(X.right)){Q+=X.delta,X=X.right;continue}}return setNodeIsVisited(K.root,!1),ie}function rbTreeInsert(K,C){if(K.root===SENTINEL$1)return C.parent=SENTINEL$1,C.left=SENTINEL$1,C.right=SENTINEL$1,setNodeColor(C,0),K.root=C,K.root;treeInsert(K,C),recomputeMaxEndWalkToRoot(C.parent);let W=C;for(;W!==K.root&&getNodeColor(W.parent)===1;)if(W.parent===W.parent.parent.left){const V=W.parent.parent.right;getNodeColor(V)===1?(setNodeColor(W.parent,0),setNodeColor(V,0),setNodeColor(W.parent.parent,1),W=W.parent.parent):(W===W.parent.right&&(W=W.parent,leftRotate$1(K,W)),setNodeColor(W.parent,0),setNodeColor(W.parent.parent,1),rightRotate$1(K,W.parent.parent))}else{const V=W.parent.parent.left;getNodeColor(V)===1?(setNodeColor(W.parent,0),setNodeColor(V,0),setNodeColor(W.parent.parent,1),W=W.parent.parent):(W===W.parent.left&&(W=W.parent,rightRotate$1(K,W)),setNodeColor(W.parent,0),setNodeColor(W.parent.parent,1),leftRotate$1(K,W.parent.parent))}return setNodeColor(K.root,0),C}function treeInsert(K,C){let W=0,V=K.root;const U=C.start,G=C.end;for(;;)if(intervalCompare(U,G,V.start+W,V.end+W)<0)if(V.left===SENTINEL$1){C.start-=W,C.end-=W,C.maxEnd-=W,V.left=C;break}else V=V.left;else if(V.right===SENTINEL$1){C.start-=W+V.delta,C.end-=W+V.delta,C.maxEnd-=W+V.delta,V.right=C;break}else W+=V.delta,V=V.right;C.parent=V,C.left=SENTINEL$1,C.right=SENTINEL$1,setNodeColor(C,1)}function rbTreeDelete(K,C){let W,V;if(C.left===SENTINEL$1?(W=C.right,V=C,W.delta+=C.delta,(W.delta<-1073741824||W.delta>1073741824)&&(K.requestNormalizeDelta=!0),W.start+=C.delta,W.end+=C.delta):C.right===SENTINEL$1?(W=C.left,V=C):(V=leftest$1(C.right),W=V.right,W.start+=V.delta,W.end+=V.delta,W.delta+=V.delta,(W.delta<-1073741824||W.delta>1073741824)&&(K.requestNormalizeDelta=!0),V.start+=C.delta,V.end+=C.delta,V.delta=C.delta,(V.delta<-1073741824||V.delta>1073741824)&&(K.requestNormalizeDelta=!0)),V===K.root){K.root=W,setNodeColor(W,0),C.detach(),resetSentinel$1(),recomputeMaxEnd(W),K.root.parent=SENTINEL$1;return}const U=getNodeColor(V)===1;if(V===V.parent.left?V.parent.left=W:V.parent.right=W,V===C?W.parent=V.parent:(V.parent===C?W.parent=V:W.parent=V.parent,V.left=C.left,V.right=C.right,V.parent=C.parent,setNodeColor(V,getNodeColor(C)),C===K.root?K.root=V:C===C.parent.left?C.parent.left=V:C.parent.right=V,V.left!==SENTINEL$1&&(V.left.parent=V),V.right!==SENTINEL$1&&(V.right.parent=V)),C.detach(),U){recomputeMaxEndWalkToRoot(W.parent),V!==C&&(recomputeMaxEndWalkToRoot(V),recomputeMaxEndWalkToRoot(V.parent)),resetSentinel$1();return}recomputeMaxEndWalkToRoot(W),recomputeMaxEndWalkToRoot(W.parent),V!==C&&(recomputeMaxEndWalkToRoot(V),recomputeMaxEndWalkToRoot(V.parent));let G;for(;W!==K.root&&getNodeColor(W)===0;)W===W.parent.left?(G=W.parent.right,getNodeColor(G)===1&&(setNodeColor(G,0),setNodeColor(W.parent,1),leftRotate$1(K,W.parent),G=W.parent.right),getNodeColor(G.left)===0&&getNodeColor(G.right)===0?(setNodeColor(G,1),W=W.parent):(getNodeColor(G.right)===0&&(setNodeColor(G.left,0),setNodeColor(G,1),rightRotate$1(K,G),G=W.parent.right),setNodeColor(G,getNodeColor(W.parent)),setNodeColor(W.parent,0),setNodeColor(G.right,0),leftRotate$1(K,W.parent),W=K.root)):(G=W.parent.left,getNodeColor(G)===1&&(setNodeColor(G,0),setNodeColor(W.parent,1),rightRotate$1(K,W.parent),G=W.parent.left),getNodeColor(G.left)===0&&getNodeColor(G.right)===0?(setNodeColor(G,1),W=W.parent):(getNodeColor(G.left)===0&&(setNodeColor(G.right,0),setNodeColor(G,1),leftRotate$1(K,G),G=W.parent.left),setNodeColor(G,getNodeColor(W.parent)),setNodeColor(W.parent,0),setNodeColor(G.left,0),rightRotate$1(K,W.parent),W=K.root));setNodeColor(W,0),resetSentinel$1()}function leftest$1(K){for(;K.left!==SENTINEL$1;)K=K.left;return K}function resetSentinel$1(){SENTINEL$1.parent=SENTINEL$1,SENTINEL$1.delta=0,SENTINEL$1.start=0,SENTINEL$1.end=0}function leftRotate$1(K,C){const W=C.right;W.delta+=C.delta,(W.delta<-1073741824||W.delta>1073741824)&&(K.requestNormalizeDelta=!0),W.start+=C.delta,W.end+=C.delta,C.right=W.left,W.left!==SENTINEL$1&&(W.left.parent=C),W.parent=C.parent,C.parent===SENTINEL$1?K.root=W:C===C.parent.left?C.parent.left=W:C.parent.right=W,W.left=C,C.parent=W,recomputeMaxEnd(C),recomputeMaxEnd(W)}function rightRotate$1(K,C){const W=C.left;C.delta-=W.delta,(C.delta<-1073741824||C.delta>1073741824)&&(K.requestNormalizeDelta=!0),C.start-=W.delta,C.end-=W.delta,C.left=W.right,W.right!==SENTINEL$1&&(W.right.parent=C),W.parent=C.parent,C.parent===SENTINEL$1?K.root=W:C===C.parent.right?C.parent.right=W:C.parent.left=W,W.right=C,C.parent=W,recomputeMaxEnd(C),recomputeMaxEnd(W)}function computeMaxEnd(K){let C=K.end;if(K.left!==SENTINEL$1){const W=K.left.maxEnd;W>C&&(C=W)}if(K.right!==SENTINEL$1){const W=K.right.maxEnd+K.delta;W>C&&(C=W)}return C}function recomputeMaxEnd(K){K.maxEnd=computeMaxEnd(K)}function recomputeMaxEndWalkToRoot(K){for(;K!==SENTINEL$1;){const C=computeMaxEnd(K);if(K.maxEnd===C)return;K.maxEnd=C,K=K.parent}}function intervalCompare(K,C,W,V){return K===W?C-V:K-W}class TreeNode{constructor(C,W){this.piece=C,this.color=W,this.size_left=0,this.lf_left=0,this.parent=this,this.left=this,this.right=this}next(){if(this.right!==SENTINEL)return leftest(this.right);let C=this;for(;C.parent!==SENTINEL&&C.parent.left!==C;)C=C.parent;return C.parent===SENTINEL?SENTINEL:C.parent}prev(){if(this.left!==SENTINEL)return righttest(this.left);let C=this;for(;C.parent!==SENTINEL&&C.parent.right!==C;)C=C.parent;return C.parent===SENTINEL?SENTINEL:C.parent}detach(){this.parent=null,this.left=null,this.right=null}}const SENTINEL=new TreeNode(null,0);SENTINEL.parent=SENTINEL;SENTINEL.left=SENTINEL;SENTINEL.right=SENTINEL;SENTINEL.color=0;function leftest(K){for(;K.left!==SENTINEL;)K=K.left;return K}function righttest(K){for(;K.right!==SENTINEL;)K=K.right;return K}function calculateSize(K){return K===SENTINEL?0:K.size_left+K.piece.length+calculateSize(K.right)}function calculateLF(K){return K===SENTINEL?0:K.lf_left+K.piece.lineFeedCnt+calculateLF(K.right)}function resetSentinel(){SENTINEL.parent=SENTINEL}function leftRotate(K,C){const W=C.right;W.size_left+=C.size_left+(C.piece?C.piece.length:0),W.lf_left+=C.lf_left+(C.piece?C.piece.lineFeedCnt:0),C.right=W.left,W.left!==SENTINEL&&(W.left.parent=C),W.parent=C.parent,C.parent===SENTINEL?K.root=W:C.parent.left===C?C.parent.left=W:C.parent.right=W,W.left=C,C.parent=W}function rightRotate(K,C){const W=C.left;C.left=W.right,W.right!==SENTINEL&&(W.right.parent=C),W.parent=C.parent,C.size_left-=W.size_left+(W.piece?W.piece.length:0),C.lf_left-=W.lf_left+(W.piece?W.piece.lineFeedCnt:0),C.parent===SENTINEL?K.root=W:C===C.parent.right?C.parent.right=W:C.parent.left=W,W.right=C,C.parent=W}function rbDelete(K,C){let W,V;if(C.left===SENTINEL?(V=C,W=V.right):C.right===SENTINEL?(V=C,W=V.left):(V=leftest(C.right),W=V.right),V===K.root){K.root=W,W.color=0,C.detach(),resetSentinel(),K.root.parent=SENTINEL;return}const U=V.color===1;if(V===V.parent.left?V.parent.left=W:V.parent.right=W,V===C?(W.parent=V.parent,recomputeTreeMetadata(K,W)):(V.parent===C?W.parent=V:W.parent=V.parent,recomputeTreeMetadata(K,W),V.left=C.left,V.right=C.right,V.parent=C.parent,V.color=C.color,C===K.root?K.root=V:C===C.parent.left?C.parent.left=V:C.parent.right=V,V.left!==SENTINEL&&(V.left.parent=V),V.right!==SENTINEL&&(V.right.parent=V),V.size_left=C.size_left,V.lf_left=C.lf_left,recomputeTreeMetadata(K,V)),C.detach(),W.parent.left===W){const Z=calculateSize(W),X=calculateLF(W);if(Z!==W.parent.size_left||X!==W.parent.lf_left){const Q=Z-W.parent.size_left,J=X-W.parent.lf_left;W.parent.size_left=Z,W.parent.lf_left=X,updateTreeMetadata(K,W.parent,Q,J)}}if(recomputeTreeMetadata(K,W.parent),U){resetSentinel();return}let G;for(;W!==K.root&&W.color===0;)W===W.parent.left?(G=W.parent.right,G.color===1&&(G.color=0,W.parent.color=1,leftRotate(K,W.parent),G=W.parent.right),G.left.color===0&&G.right.color===0?(G.color=1,W=W.parent):(G.right.color===0&&(G.left.color=0,G.color=1,rightRotate(K,G),G=W.parent.right),G.color=W.parent.color,W.parent.color=0,G.right.color=0,leftRotate(K,W.parent),W=K.root)):(G=W.parent.left,G.color===1&&(G.color=0,W.parent.color=1,rightRotate(K,W.parent),G=W.parent.left),G.left.color===0&&G.right.color===0?(G.color=1,W=W.parent):(G.left.color===0&&(G.right.color=0,G.color=1,leftRotate(K,G),G=W.parent.left),G.color=W.parent.color,W.parent.color=0,G.left.color=0,rightRotate(K,W.parent),W=K.root));W.color=0,resetSentinel()}function fixInsert(K,C){for(recomputeTreeMetadata(K,C);C!==K.root&&C.parent.color===1;)if(C.parent===C.parent.parent.left){const W=C.parent.parent.right;W.color===1?(C.parent.color=0,W.color=0,C.parent.parent.color=1,C=C.parent.parent):(C===C.parent.right&&(C=C.parent,leftRotate(K,C)),C.parent.color=0,C.parent.parent.color=1,rightRotate(K,C.parent.parent))}else{const W=C.parent.parent.left;W.color===1?(C.parent.color=0,W.color=0,C.parent.parent.color=1,C=C.parent.parent):(C===C.parent.left&&(C=C.parent,rightRotate(K,C)),C.parent.color=0,C.parent.parent.color=1,leftRotate(K,C.parent.parent))}K.root.color=0}function updateTreeMetadata(K,C,W,V){for(;C!==K.root&&C!==SENTINEL;)C.parent.left===C&&(C.parent.size_left+=W,C.parent.lf_left+=V),C=C.parent}function recomputeTreeMetadata(K,C){let W=0,V=0;if(C!==K.root){for(;C!==K.root&&C===C.parent.right;)C=C.parent;if(C!==K.root)for(C=C.parent,W=calculateSize(C.left)-C.size_left,V=calculateLF(C.left)-C.lf_left,C.size_left+=W,C.lf_left+=V;C!==K.root&&(W!==0||V!==0);)C.parent.left===C&&(C.parent.size_left+=W,C.parent.lf_left+=V),C=C.parent}}const AverageBufferSize=65535;function createUintArray(K){let C;return K[K.length-1]<65536?C=new Uint16Array(K.length):C=new Uint32Array(K.length),C.set(K,0),C}class LineStarts{constructor(C,W,V,U,G){this.lineStarts=C,this.cr=W,this.lf=V,this.crlf=U,this.isBasicASCII=G}}function createLineStartsFast(K,C=!0){const W=[0];let V=1;for(let U=0,G=K.length;U<G;U++){const Z=K.charCodeAt(U);Z===13?U+1<G&&K.charCodeAt(U+1)===10?(W[V++]=U+2,U++):W[V++]=U+1:Z===10&&(W[V++]=U+1)}return C?createUintArray(W):W}function createLineStarts(K,C){K.length=0,K[0]=0;let W=1,V=0,U=0,G=0,Z=!0;for(let Q=0,J=C.length;Q<J;Q++){const ee=C.charCodeAt(Q);ee===13?Q+1<J&&C.charCodeAt(Q+1)===10?(G++,K[W++]=Q+2,Q++):(V++,K[W++]=Q+1):ee===10?(U++,K[W++]=Q+1):Z&&ee!==9&&(ee<32||ee>126)&&(Z=!1)}const X=new LineStarts(createUintArray(K),V,U,G,Z);return K.length=0,X}class Piece{constructor(C,W,V,U,G){this.bufferIndex=C,this.start=W,this.end=V,this.lineFeedCnt=U,this.length=G}}class StringBuffer{constructor(C,W){this.buffer=C,this.lineStarts=W}}class PieceTreeSnapshot{constructor(C,W){this._pieces=[],this._tree=C,this._BOM=W,this._index=0,C.root!==SENTINEL&&C.iterate(C.root,V=>(V!==SENTINEL&&this._pieces.push(V.piece),!0))}read(){return this._pieces.length===0?this._index===0?(this._index++,this._BOM):null:this._index>this._pieces.length-1?null:this._index===0?this._BOM+this._tree.getPieceContent(this._pieces[this._index++]):this._tree.getPieceContent(this._pieces[this._index++])}}class PieceTreeSearchCache{constructor(C){this._limit=C,this._cache=[]}get(C){for(let W=this._cache.length-1;W>=0;W--){const V=this._cache[W];if(V.nodeStartOffset<=C&&V.nodeStartOffset+V.node.piece.length>=C)return V}return null}get2(C){for(let W=this._cache.length-1;W>=0;W--){const V=this._cache[W];if(V.nodeStartLineNumber&&V.nodeStartLineNumber<C&&V.nodeStartLineNumber+V.node.piece.lineFeedCnt>=C)return V}return null}set(C){this._cache.length>=this._limit&&this._cache.shift(),this._cache.push(C)}validate(C){let W=!1;const V=this._cache;for(let U=0;U<V.length;U++){const G=V[U];if(G.node.parent===null||G.nodeStartOffset>=C){V[U]=null,W=!0;continue}}if(W){const U=[];for(const G of V)G!==null&&U.push(G);this._cache=U}}}class PieceTreeBase{constructor(C,W,V){this.create(C,W,V)}create(C,W,V){this._buffers=[new StringBuffer("",[0])],this._lastChangeBufferPos={line:0,column:0},this.root=SENTINEL,this._lineCnt=1,this._length=0,this._EOL=W,this._EOLLength=W.length,this._EOLNormalized=V;let U=null;for(let G=0,Z=C.length;G<Z;G++)if(C[G].buffer.length>0){C[G].lineStarts||(C[G].lineStarts=createLineStartsFast(C[G].buffer));const X=new Piece(G+1,{line:0,column:0},{line:C[G].lineStarts.length-1,column:C[G].buffer.length-C[G].lineStarts[C[G].lineStarts.length-1]},C[G].lineStarts.length-1,C[G].buffer.length);this._buffers.push(C[G]),U=this.rbInsertRight(U,X)}this._searchCache=new PieceTreeSearchCache(1),this._lastVisitedLine={lineNumber:0,value:""},this.computeBufferMetadata()}normalizeEOL(C){const W=AverageBufferSize,V=W-Math.floor(W/3),U=V*2;let G="",Z=0;const X=[];if(this.iterate(this.root,Q=>{const J=this.getNodeContent(Q),ee=J.length;if(Z<=V||Z+ee<U)return G+=J,Z+=ee,!0;const te=G.replace(/\r\n|\r|\n/g,C);return X.push(new StringBuffer(te,createLineStartsFast(te))),G=J,Z=ee,!0}),Z>0){const Q=G.replace(/\r\n|\r|\n/g,C);X.push(new StringBuffer(Q,createLineStartsFast(Q)))}this.create(X,C,!0)}getEOL(){return this._EOL}setEOL(C){this._EOL=C,this._EOLLength=this._EOL.length,this.normalizeEOL(C)}createSnapshot(C){return new PieceTreeSnapshot(this,C)}getOffsetAt(C,W){let V=0,U=this.root;for(;U!==SENTINEL;)if(U.left!==SENTINEL&&U.lf_left+1>=C)U=U.left;else if(U.lf_left+U.piece.lineFeedCnt+1>=C){V+=U.size_left;const G=this.getAccumulatedValue(U,C-U.lf_left-2);return V+=G+W-1}else C-=U.lf_left+U.piece.lineFeedCnt,V+=U.size_left+U.piece.length,U=U.right;return V}getPositionAt(C){C=Math.floor(C),C=Math.max(0,C);let W=this.root,V=0;const U=C;for(;W!==SENTINEL;)if(W.size_left!==0&&W.size_left>=C)W=W.left;else if(W.size_left+W.piece.length>=C){const G=this.getIndexOf(W,C-W.size_left);if(V+=W.lf_left+G.index,G.index===0){const Z=this.getOffsetAt(V+1,1),X=U-Z;return new Position$1(V+1,X+1)}return new Position$1(V+1,G.remainder+1)}else if(C-=W.size_left+W.piece.length,V+=W.lf_left+W.piece.lineFeedCnt,W.right===SENTINEL){const G=this.getOffsetAt(V+1,1),Z=U-C-G;return new Position$1(V+1,Z+1)}else W=W.right;return new Position$1(1,1)}getValueInRange(C,W){if(C.startLineNumber===C.endLineNumber&&C.startColumn===C.endColumn)return"";const V=this.nodeAt2(C.startLineNumber,C.startColumn),U=this.nodeAt2(C.endLineNumber,C.endColumn),G=this.getValueInRange2(V,U);return W?W!==this._EOL||!this._EOLNormalized?G.replace(/\r\n|\r|\n/g,W):W===this.getEOL()&&this._EOLNormalized?G:G.replace(/\r\n|\r|\n/g,W):G}getValueInRange2(C,W){if(C.node===W.node){const X=C.node,Q=this._buffers[X.piece.bufferIndex].buffer,J=this.offsetInBuffer(X.piece.bufferIndex,X.piece.start);return Q.substring(J+C.remainder,J+W.remainder)}let V=C.node;const U=this._buffers[V.piece.bufferIndex].buffer,G=this.offsetInBuffer(V.piece.bufferIndex,V.piece.start);let Z=U.substring(G+C.remainder,G+V.piece.length);for(V=V.next();V!==SENTINEL;){const X=this._buffers[V.piece.bufferIndex].buffer,Q=this.offsetInBuffer(V.piece.bufferIndex,V.piece.start);if(V===W.node){Z+=X.substring(Q,Q+W.remainder);break}else Z+=X.substr(Q,V.piece.length);V=V.next()}return Z}getLinesContent(){const C=[];let W=0,V="",U=!1;return this.iterate(this.root,G=>{if(G===SENTINEL)return!0;const Z=G.piece;let X=Z.length;if(X===0)return!0;const Q=this._buffers[Z.bufferIndex].buffer,J=this._buffers[Z.bufferIndex].lineStarts,ee=Z.start.line,te=Z.end.line;let ie=J[ee]+Z.start.column;if(U&&(Q.charCodeAt(ie)===10&&(ie++,X--),C[W++]=V,V="",U=!1,X===0))return!0;if(ee===te)return!this._EOLNormalized&&Q.charCodeAt(ie+X-1)===13?(U=!0,V+=Q.substr(ie,X-1)):V+=Q.substr(ie,X),!0;V+=this._EOLNormalized?Q.substring(ie,Math.max(ie,J[ee+1]-this._EOLLength)):Q.substring(ie,J[ee+1]).replace(/(\r\n|\r|\n)$/,""),C[W++]=V;for(let ne=ee+1;ne<te;ne++)V=this._EOLNormalized?Q.substring(J[ne],J[ne+1]-this._EOLLength):Q.substring(J[ne],J[ne+1]).replace(/(\r\n|\r|\n)$/,""),C[W++]=V;return!this._EOLNormalized&&Q.charCodeAt(J[te]+Z.end.column-1)===13?(U=!0,Z.end.column===0?W--:V=Q.substr(J[te],Z.end.column-1)):V=Q.substr(J[te],Z.end.column),!0}),U&&(C[W++]=V,V=""),C[W++]=V,C}getLength(){return this._length}getLineCount(){return this._lineCnt}getLineContent(C){return this._lastVisitedLine.lineNumber===C?this._lastVisitedLine.value:(this._lastVisitedLine.lineNumber=C,C===this._lineCnt?this._lastVisitedLine.value=this.getLineRawContent(C):this._EOLNormalized?this._lastVisitedLine.value=this.getLineRawContent(C,this._EOLLength):this._lastVisitedLine.value=this.getLineRawContent(C).replace(/(\r\n|\r|\n)$/,""),this._lastVisitedLine.value)}_getCharCode(C){if(C.remainder===C.node.piece.length){const W=C.node.next();if(!W)return 0;const V=this._buffers[W.piece.bufferIndex],U=this.offsetInBuffer(W.piece.bufferIndex,W.piece.start);return V.buffer.charCodeAt(U)}else{const W=this._buffers[C.node.piece.bufferIndex],U=this.offsetInBuffer(C.node.piece.bufferIndex,C.node.piece.start)+C.remainder;return W.buffer.charCodeAt(U)}}getLineCharCode(C,W){const V=this.nodeAt2(C,W+1);return this._getCharCode(V)}getLineLength(C){if(C===this.getLineCount()){const W=this.getOffsetAt(C,1);return this.getLength()-W}return this.getOffsetAt(C+1,1)-this.getOffsetAt(C,1)-this._EOLLength}findMatchesInNode(C,W,V,U,G,Z,X,Q,J,ee,te){const ie=this._buffers[C.piece.bufferIndex],ne=this.offsetInBuffer(C.piece.bufferIndex,C.piece.start),oe=this.offsetInBuffer(C.piece.bufferIndex,G),re=this.offsetInBuffer(C.piece.bufferIndex,Z);let ae;const se={line:0,column:0};let le,ce;W._wordSeparators?(le=ie.buffer.substring(oe,re),ce=de=>de+oe,W.reset(0)):(le=ie.buffer,ce=de=>de,W.reset(oe));do if(ae=W.next(le),ae){if(ce(ae.index)>=re)return ee;this.positionInBuffer(C,ce(ae.index)-ne,se);const de=this.getLineFeedCnt(C.piece.bufferIndex,G,se),ue=se.line===G.line?se.column-G.column+U:se.column+1,ge=ue+ae[0].length;if(te[ee++]=createFindMatch(new Range$2(V+de,ue,V+de,ge),ae,Q),ce(ae.index)+ae[0].length>=re||ee>=J)return ee}while(ae);return ee}findMatchesLineByLine(C,W,V,U){const G=[];let Z=0;const X=new Searcher(W.wordSeparators,W.regex);let Q=this.nodeAt2(C.startLineNumber,C.startColumn);if(Q===null)return[];const J=this.nodeAt2(C.endLineNumber,C.endColumn);if(J===null)return[];let ee=this.positionInBuffer(Q.node,Q.remainder);const te=this.positionInBuffer(J.node,J.remainder);if(Q.node===J.node)return this.findMatchesInNode(Q.node,X,C.startLineNumber,C.startColumn,ee,te,W,V,U,Z,G),G;let ie=C.startLineNumber,ne=Q.node;for(;ne!==J.node;){const re=this.getLineFeedCnt(ne.piece.bufferIndex,ee,ne.piece.end);if(re>=1){const se=this._buffers[ne.piece.bufferIndex].lineStarts,le=this.offsetInBuffer(ne.piece.bufferIndex,ne.piece.start),ce=se[ee.line+re],de=ie===C.startLineNumber?C.startColumn:1;if(Z=this.findMatchesInNode(ne,X,ie,de,ee,this.positionInBuffer(ne,ce-le),W,V,U,Z,G),Z>=U)return G;ie+=re}const ae=ie===C.startLineNumber?C.startColumn-1:0;if(ie===C.endLineNumber){const se=this.getLineContent(ie).substring(ae,C.endColumn-1);return Z=this._findMatchesInLine(W,X,se,C.endLineNumber,ae,Z,G,V,U),G}if(Z=this._findMatchesInLine(W,X,this.getLineContent(ie).substr(ae),ie,ae,Z,G,V,U),Z>=U)return G;ie++,Q=this.nodeAt2(ie,1),ne=Q.node,ee=this.positionInBuffer(Q.node,Q.remainder)}if(ie===C.endLineNumber){const re=ie===C.startLineNumber?C.startColumn-1:0,ae=this.getLineContent(ie).substring(re,C.endColumn-1);return Z=this._findMatchesInLine(W,X,ae,C.endLineNumber,re,Z,G,V,U),G}const oe=ie===C.startLineNumber?C.startColumn:1;return Z=this.findMatchesInNode(J.node,X,ie,oe,ee,te,W,V,U,Z,G),G}_findMatchesInLine(C,W,V,U,G,Z,X,Q,J){const ee=C.wordSeparators;if(!Q&&C.simpleSearch){const ie=C.simpleSearch,ne=ie.length,oe=V.length;let re=-ne;for(;(re=V.indexOf(ie,re+ne))!==-1;)if((!ee||isValidMatch(ee,V,oe,re,ne))&&(X[Z++]=new FindMatch(new Range$2(U,re+1+G,U,re+1+ne+G),null),Z>=J))return Z;return Z}let te;W.reset(0);do if(te=W.next(V),te&&(X[Z++]=createFindMatch(new Range$2(U,te.index+1+G,U,te.index+1+te[0].length+G),te,Q),Z>=J))return Z;while(te);return Z}insert(C,W,V=!1){if(this._EOLNormalized=this._EOLNormalized&&V,this._lastVisitedLine.lineNumber=0,this._lastVisitedLine.value="",this.root!==SENTINEL){const{node:U,remainder:G,nodeStartOffset:Z}=this.nodeAt(C),X=U.piece,Q=X.bufferIndex,J=this.positionInBuffer(U,G);if(U.piece.bufferIndex===0&&X.end.line===this._lastChangeBufferPos.line&&X.end.column===this._lastChangeBufferPos.column&&Z+X.length===C&&W.length<AverageBufferSize){this.appendToNode(U,W),this.computeBufferMetadata();return}if(Z===C)this.insertContentToNodeLeft(W,U),this._searchCache.validate(C);else if(Z+U.piece.length>C){const ee=[];let te=new Piece(X.bufferIndex,J,X.end,this.getLineFeedCnt(X.bufferIndex,J,X.end),this.offsetInBuffer(Q,X.end)-this.offsetInBuffer(Q,J));if(this.shouldCheckCRLF()&&this.endWithCR(W)&&this.nodeCharCodeAt(U,G)===10){const re={line:te.start.line+1,column:0};te=new Piece(te.bufferIndex,re,te.end,this.getLineFeedCnt(te.bufferIndex,re,te.end),te.length-1),W+=`
`}if(this.shouldCheckCRLF()&&this.startWithLF(W))if(this.nodeCharCodeAt(U,G-1)===13){const re=this.positionInBuffer(U,G-1);this.deleteNodeTail(U,re),W="\r"+W,U.piece.length===0&&ee.push(U)}else this.deleteNodeTail(U,J);else this.deleteNodeTail(U,J);const ie=this.createNewPieces(W);te.length>0&&this.rbInsertRight(U,te);let ne=U;for(let oe=0;oe<ie.length;oe++)ne=this.rbInsertRight(ne,ie[oe]);this.deleteNodes(ee)}else this.insertContentToNodeRight(W,U)}else{const U=this.createNewPieces(W);let G=this.rbInsertLeft(null,U[0]);for(let Z=1;Z<U.length;Z++)G=this.rbInsertRight(G,U[Z])}this.computeBufferMetadata()}delete(C,W){if(this._lastVisitedLine.lineNumber=0,this._lastVisitedLine.value="",W<=0||this.root===SENTINEL)return;const V=this.nodeAt(C),U=this.nodeAt(C+W),G=V.node,Z=U.node;if(G===Z){const ie=this.positionInBuffer(G,V.remainder),ne=this.positionInBuffer(G,U.remainder);if(V.nodeStartOffset===C){if(W===G.piece.length){const oe=G.next();rbDelete(this,G),this.validateCRLFWithPrevNode(oe),this.computeBufferMetadata();return}this.deleteNodeHead(G,ne),this._searchCache.validate(C),this.validateCRLFWithPrevNode(G),this.computeBufferMetadata();return}if(V.nodeStartOffset+G.piece.length===C+W){this.deleteNodeTail(G,ie),this.validateCRLFWithNextNode(G),this.computeBufferMetadata();return}this.shrinkNode(G,ie,ne),this.computeBufferMetadata();return}const X=[],Q=this.positionInBuffer(G,V.remainder);this.deleteNodeTail(G,Q),this._searchCache.validate(C),G.piece.length===0&&X.push(G);const J=this.positionInBuffer(Z,U.remainder);this.deleteNodeHead(Z,J),Z.piece.length===0&&X.push(Z);const ee=G.next();for(let ie=ee;ie!==SENTINEL&&ie!==Z;ie=ie.next())X.push(ie);const te=G.piece.length===0?G.prev():G;this.deleteNodes(X),this.validateCRLFWithNextNode(te),this.computeBufferMetadata()}insertContentToNodeLeft(C,W){const V=[];if(this.shouldCheckCRLF()&&this.endWithCR(C)&&this.startWithLF(W)){const Z=W.piece,X={line:Z.start.line+1,column:0},Q=new Piece(Z.bufferIndex,X,Z.end,this.getLineFeedCnt(Z.bufferIndex,X,Z.end),Z.length-1);W.piece=Q,C+=`
`,updateTreeMetadata(this,W,-1,-1),W.piece.length===0&&V.push(W)}const U=this.createNewPieces(C);let G=this.rbInsertLeft(W,U[U.length-1]);for(let Z=U.length-2;Z>=0;Z--)G=this.rbInsertLeft(G,U[Z]);this.validateCRLFWithPrevNode(G),this.deleteNodes(V)}insertContentToNodeRight(C,W){this.adjustCarriageReturnFromNext(C,W)&&(C+=`
`);const V=this.createNewPieces(C),U=this.rbInsertRight(W,V[0]);let G=U;for(let Z=1;Z<V.length;Z++)G=this.rbInsertRight(G,V[Z]);this.validateCRLFWithPrevNode(U)}positionInBuffer(C,W,V){const U=C.piece,G=C.piece.bufferIndex,Z=this._buffers[G].lineStarts,Q=Z[U.start.line]+U.start.column+W;let J=U.start.line,ee=U.end.line,te=0,ie=0,ne=0;for(;J<=ee&&(te=J+(ee-J)/2|0,ne=Z[te],te!==ee);)if(ie=Z[te+1],Q<ne)ee=te-1;else if(Q>=ie)J=te+1;else break;return V?(V.line=te,V.column=Q-ne,null):{line:te,column:Q-ne}}getLineFeedCnt(C,W,V){if(V.column===0)return V.line-W.line;const U=this._buffers[C].lineStarts;if(V.line===U.length-1)return V.line-W.line;const G=U[V.line+1],Z=U[V.line]+V.column;if(G>Z+1)return V.line-W.line;const X=Z-1;return this._buffers[C].buffer.charCodeAt(X)===13?V.line-W.line+1:V.line-W.line}offsetInBuffer(C,W){return this._buffers[C].lineStarts[W.line]+W.column}deleteNodes(C){for(let W=0;W<C.length;W++)rbDelete(this,C[W])}createNewPieces(C){if(C.length>AverageBufferSize){const ee=[];for(;C.length>AverageBufferSize;){const ie=C.charCodeAt(AverageBufferSize-1);let ne;ie===13||ie>=55296&&ie<=56319?(ne=C.substring(0,AverageBufferSize-1),C=C.substring(AverageBufferSize-1)):(ne=C.substring(0,AverageBufferSize),C=C.substring(AverageBufferSize));const oe=createLineStartsFast(ne);ee.push(new Piece(this._buffers.length,{line:0,column:0},{line:oe.length-1,column:ne.length-oe[oe.length-1]},oe.length-1,ne.length)),this._buffers.push(new StringBuffer(ne,oe))}const te=createLineStartsFast(C);return ee.push(new Piece(this._buffers.length,{line:0,column:0},{line:te.length-1,column:C.length-te[te.length-1]},te.length-1,C.length)),this._buffers.push(new StringBuffer(C,te)),ee}let W=this._buffers[0].buffer.length;const V=createLineStartsFast(C,!1);let U=this._lastChangeBufferPos;if(this._buffers[0].lineStarts[this._buffers[0].lineStarts.length-1]===W&&W!==0&&this.startWithLF(C)&&this.endWithCR(this._buffers[0].buffer)){this._lastChangeBufferPos={line:this._lastChangeBufferPos.line,column:this._lastChangeBufferPos.column+1},U=this._lastChangeBufferPos;for(let ee=0;ee<V.length;ee++)V[ee]+=W+1;this._buffers[0].lineStarts=this._buffers[0].lineStarts.concat(V.slice(1)),this._buffers[0].buffer+="_"+C,W+=1}else{if(W!==0)for(let ee=0;ee<V.length;ee++)V[ee]+=W;this._buffers[0].lineStarts=this._buffers[0].lineStarts.concat(V.slice(1)),this._buffers[0].buffer+=C}const G=this._buffers[0].buffer.length,Z=this._buffers[0].lineStarts.length-1,X=G-this._buffers[0].lineStarts[Z],Q={line:Z,column:X},J=new Piece(0,U,Q,this.getLineFeedCnt(0,U,Q),G-W);return this._lastChangeBufferPos=Q,[J]}getLineRawContent(C,W=0){let V=this.root,U="";const G=this._searchCache.get2(C);if(G){V=G.node;const Z=this.getAccumulatedValue(V,C-G.nodeStartLineNumber-1),X=this._buffers[V.piece.bufferIndex].buffer,Q=this.offsetInBuffer(V.piece.bufferIndex,V.piece.start);if(G.nodeStartLineNumber+V.piece.lineFeedCnt===C)U=X.substring(Q+Z,Q+V.piece.length);else{const J=this.getAccumulatedValue(V,C-G.nodeStartLineNumber);return X.substring(Q+Z,Q+J-W)}}else{let Z=0;const X=C;for(;V!==SENTINEL;)if(V.left!==SENTINEL&&V.lf_left>=C-1)V=V.left;else if(V.lf_left+V.piece.lineFeedCnt>C-1){const Q=this.getAccumulatedValue(V,C-V.lf_left-2),J=this.getAccumulatedValue(V,C-V.lf_left-1),ee=this._buffers[V.piece.bufferIndex].buffer,te=this.offsetInBuffer(V.piece.bufferIndex,V.piece.start);return Z+=V.size_left,this._searchCache.set({node:V,nodeStartOffset:Z,nodeStartLineNumber:X-(C-1-V.lf_left)}),ee.substring(te+Q,te+J-W)}else if(V.lf_left+V.piece.lineFeedCnt===C-1){const Q=this.getAccumulatedValue(V,C-V.lf_left-2),J=this._buffers[V.piece.bufferIndex].buffer,ee=this.offsetInBuffer(V.piece.bufferIndex,V.piece.start);U=J.substring(ee+Q,ee+V.piece.length);break}else C-=V.lf_left+V.piece.lineFeedCnt,Z+=V.size_left+V.piece.length,V=V.right}for(V=V.next();V!==SENTINEL;){const Z=this._buffers[V.piece.bufferIndex].buffer;if(V.piece.lineFeedCnt>0){const X=this.getAccumulatedValue(V,0),Q=this.offsetInBuffer(V.piece.bufferIndex,V.piece.start);return U+=Z.substring(Q,Q+X-W),U}else{const X=this.offsetInBuffer(V.piece.bufferIndex,V.piece.start);U+=Z.substr(X,V.piece.length)}V=V.next()}return U}computeBufferMetadata(){let C=this.root,W=1,V=0;for(;C!==SENTINEL;)W+=C.lf_left+C.piece.lineFeedCnt,V+=C.size_left+C.piece.length,C=C.right;this._lineCnt=W,this._length=V,this._searchCache.validate(this._length)}getIndexOf(C,W){const V=C.piece,U=this.positionInBuffer(C,W),G=U.line-V.start.line;if(this.offsetInBuffer(V.bufferIndex,V.end)-this.offsetInBuffer(V.bufferIndex,V.start)===W){const Z=this.getLineFeedCnt(C.piece.bufferIndex,V.start,U);if(Z!==G)return{index:Z,remainder:0}}return{index:G,remainder:U.column}}getAccumulatedValue(C,W){if(W<0)return 0;const V=C.piece,U=this._buffers[V.bufferIndex].lineStarts,G=V.start.line+W+1;return G>V.end.line?U[V.end.line]+V.end.column-U[V.start.line]-V.start.column:U[G]-U[V.start.line]-V.start.column}deleteNodeTail(C,W){const V=C.piece,U=V.lineFeedCnt,G=this.offsetInBuffer(V.bufferIndex,V.end),Z=W,X=this.offsetInBuffer(V.bufferIndex,Z),Q=this.getLineFeedCnt(V.bufferIndex,V.start,Z),J=Q-U,ee=X-G,te=V.length+ee;C.piece=new Piece(V.bufferIndex,V.start,Z,Q,te),updateTreeMetadata(this,C,ee,J)}deleteNodeHead(C,W){const V=C.piece,U=V.lineFeedCnt,G=this.offsetInBuffer(V.bufferIndex,V.start),Z=W,X=this.getLineFeedCnt(V.bufferIndex,Z,V.end),Q=this.offsetInBuffer(V.bufferIndex,Z),J=X-U,ee=G-Q,te=V.length+ee;C.piece=new Piece(V.bufferIndex,Z,V.end,X,te),updateTreeMetadata(this,C,ee,J)}shrinkNode(C,W,V){const U=C.piece,G=U.start,Z=U.end,X=U.length,Q=U.lineFeedCnt,J=W,ee=this.getLineFeedCnt(U.bufferIndex,U.start,J),te=this.offsetInBuffer(U.bufferIndex,W)-this.offsetInBuffer(U.bufferIndex,G);C.piece=new Piece(U.bufferIndex,U.start,J,ee,te),updateTreeMetadata(this,C,te-X,ee-Q);const ie=new Piece(U.bufferIndex,V,Z,this.getLineFeedCnt(U.bufferIndex,V,Z),this.offsetInBuffer(U.bufferIndex,Z)-this.offsetInBuffer(U.bufferIndex,V)),ne=this.rbInsertRight(C,ie);this.validateCRLFWithPrevNode(ne)}appendToNode(C,W){this.adjustCarriageReturnFromNext(W,C)&&(W+=`
`);const V=this.shouldCheckCRLF()&&this.startWithLF(W)&&this.endWithCR(C),U=this._buffers[0].buffer.length;this._buffers[0].buffer+=W;const G=createLineStartsFast(W,!1);for(let ne=0;ne<G.length;ne++)G[ne]+=U;if(V){const ne=this._buffers[0].lineStarts[this._buffers[0].lineStarts.length-2];this._buffers[0].lineStarts.pop(),this._lastChangeBufferPos={line:this._lastChangeBufferPos.line-1,column:U-ne}}this._buffers[0].lineStarts=this._buffers[0].lineStarts.concat(G.slice(1));const Z=this._buffers[0].lineStarts.length-1,X=this._buffers[0].buffer.length-this._buffers[0].lineStarts[Z],Q={line:Z,column:X},J=C.piece.length+W.length,ee=C.piece.lineFeedCnt,te=this.getLineFeedCnt(0,C.piece.start,Q),ie=te-ee;C.piece=new Piece(C.piece.bufferIndex,C.piece.start,Q,te,J),this._lastChangeBufferPos=Q,updateTreeMetadata(this,C,W.length,ie)}nodeAt(C){let W=this.root;const V=this._searchCache.get(C);if(V)return{node:V.node,nodeStartOffset:V.nodeStartOffset,remainder:C-V.nodeStartOffset};let U=0;for(;W!==SENTINEL;)if(W.size_left>C)W=W.left;else if(W.size_left+W.piece.length>=C){U+=W.size_left;const G={node:W,remainder:C-W.size_left,nodeStartOffset:U};return this._searchCache.set(G),G}else C-=W.size_left+W.piece.length,U+=W.size_left+W.piece.length,W=W.right;return null}nodeAt2(C,W){let V=this.root,U=0;for(;V!==SENTINEL;)if(V.left!==SENTINEL&&V.lf_left>=C-1)V=V.left;else if(V.lf_left+V.piece.lineFeedCnt>C-1){const G=this.getAccumulatedValue(V,C-V.lf_left-2),Z=this.getAccumulatedValue(V,C-V.lf_left-1);return U+=V.size_left,{node:V,remainder:Math.min(G+W-1,Z),nodeStartOffset:U}}else if(V.lf_left+V.piece.lineFeedCnt===C-1){const G=this.getAccumulatedValue(V,C-V.lf_left-2);if(G+W-1<=V.piece.length)return{node:V,remainder:G+W-1,nodeStartOffset:U};W-=V.piece.length-G;break}else C-=V.lf_left+V.piece.lineFeedCnt,U+=V.size_left+V.piece.length,V=V.right;for(V=V.next();V!==SENTINEL;){if(V.piece.lineFeedCnt>0){const G=this.getAccumulatedValue(V,0),Z=this.offsetOfNode(V);return{node:V,remainder:Math.min(W-1,G),nodeStartOffset:Z}}else if(V.piece.length>=W-1){const G=this.offsetOfNode(V);return{node:V,remainder:W-1,nodeStartOffset:G}}else W-=V.piece.length;V=V.next()}return null}nodeCharCodeAt(C,W){if(C.piece.lineFeedCnt<1)return-1;const V=this._buffers[C.piece.bufferIndex],U=this.offsetInBuffer(C.piece.bufferIndex,C.piece.start)+W;return V.buffer.charCodeAt(U)}offsetOfNode(C){if(!C)return 0;let W=C.size_left;for(;C!==this.root;)C.parent.right===C&&(W+=C.parent.size_left+C.parent.piece.length),C=C.parent;return W}shouldCheckCRLF(){return!(this._EOLNormalized&&this._EOL===`
`)}startWithLF(C){if(typeof C=="string")return C.charCodeAt(0)===10;if(C===SENTINEL||C.piece.lineFeedCnt===0)return!1;const W=C.piece,V=this._buffers[W.bufferIndex].lineStarts,U=W.start.line,G=V[U]+W.start.column;return U===V.length-1||V[U+1]>G+1?!1:this._buffers[W.bufferIndex].buffer.charCodeAt(G)===10}endWithCR(C){return typeof C=="string"?C.charCodeAt(C.length-1)===13:C===SENTINEL||C.piece.lineFeedCnt===0?!1:this.nodeCharCodeAt(C,C.piece.length-1)===13}validateCRLFWithPrevNode(C){if(this.shouldCheckCRLF()&&this.startWithLF(C)){const W=C.prev();this.endWithCR(W)&&this.fixCRLF(W,C)}}validateCRLFWithNextNode(C){if(this.shouldCheckCRLF()&&this.endWithCR(C)){const W=C.next();this.startWithLF(W)&&this.fixCRLF(C,W)}}fixCRLF(C,W){const V=[],U=this._buffers[C.piece.bufferIndex].lineStarts;let G;C.piece.end.column===0?G={line:C.piece.end.line-1,column:U[C.piece.end.line]-U[C.piece.end.line-1]-1}:G={line:C.piece.end.line,column:C.piece.end.column-1};const Z=C.piece.length-1,X=C.piece.lineFeedCnt-1;C.piece=new Piece(C.piece.bufferIndex,C.piece.start,G,X,Z),updateTreeMetadata(this,C,-1,-1),C.piece.length===0&&V.push(C);const Q={line:W.piece.start.line+1,column:0},J=W.piece.length-1,ee=this.getLineFeedCnt(W.piece.bufferIndex,Q,W.piece.end);W.piece=new Piece(W.piece.bufferIndex,Q,W.piece.end,ee,J),updateTreeMetadata(this,W,-1,-1),W.piece.length===0&&V.push(W);const te=this.createNewPieces(`\r
`);this.rbInsertRight(C,te[0]);for(let ie=0;ie<V.length;ie++)rbDelete(this,V[ie])}adjustCarriageReturnFromNext(C,W){if(this.shouldCheckCRLF()&&this.endWithCR(C)){const V=W.next();if(this.startWithLF(V)){if(C+=`
`,V.piece.length===1)rbDelete(this,V);else{const U=V.piece,G={line:U.start.line+1,column:0},Z=U.length-1,X=this.getLineFeedCnt(U.bufferIndex,G,U.end);V.piece=new Piece(U.bufferIndex,G,U.end,X,Z),updateTreeMetadata(this,V,-1,-1)}return!0}}return!1}iterate(C,W){if(C===SENTINEL)return W(SENTINEL);const V=this.iterate(C.left,W);return V&&W(C)&&this.iterate(C.right,W)}getNodeContent(C){if(C===SENTINEL)return"";const W=this._buffers[C.piece.bufferIndex],V=C.piece,U=this.offsetInBuffer(V.bufferIndex,V.start),G=this.offsetInBuffer(V.bufferIndex,V.end);return W.buffer.substring(U,G)}getPieceContent(C){const W=this._buffers[C.bufferIndex],V=this.offsetInBuffer(C.bufferIndex,C.start),U=this.offsetInBuffer(C.bufferIndex,C.end);return W.buffer.substring(V,U)}rbInsertRight(C,W){const V=new TreeNode(W,1);if(V.left=SENTINEL,V.right=SENTINEL,V.parent=SENTINEL,V.size_left=0,V.lf_left=0,this.root===SENTINEL)this.root=V,V.color=0;else if(C.right===SENTINEL)C.right=V,V.parent=C;else{const G=leftest(C.right);G.left=V,V.parent=G}return fixInsert(this,V),V}rbInsertLeft(C,W){const V=new TreeNode(W,1);if(V.left=SENTINEL,V.right=SENTINEL,V.parent=SENTINEL,V.size_left=0,V.lf_left=0,this.root===SENTINEL)this.root=V,V.color=0;else if(C.left===SENTINEL)C.left=V,V.parent=C;else{const U=righttest(C.left);U.right=V,V.parent=U}return fixInsert(this,V),V}}class PieceTreeTextBuffer extends Disposable{constructor(C,W,V,U,G,Z,X){super(),this._onDidChangeContent=this._register(new Emitter$1),this._BOM=W,this._mightContainNonBasicASCII=!Z,this._mightContainRTL=U,this._mightContainUnusualLineTerminators=G,this._pieceTree=new PieceTreeBase(C,V,X)}mightContainRTL(){return this._mightContainRTL}mightContainUnusualLineTerminators(){return this._mightContainUnusualLineTerminators}resetMightContainUnusualLineTerminators(){this._mightContainUnusualLineTerminators=!1}mightContainNonBasicASCII(){return this._mightContainNonBasicASCII}getBOM(){return this._BOM}getEOL(){return this._pieceTree.getEOL()}createSnapshot(C){return this._pieceTree.createSnapshot(C?this._BOM:"")}getOffsetAt(C,W){return this._pieceTree.getOffsetAt(C,W)}getPositionAt(C){return this._pieceTree.getPositionAt(C)}getRangeAt(C,W){const V=C+W,U=this.getPositionAt(C),G=this.getPositionAt(V);return new Range$2(U.lineNumber,U.column,G.lineNumber,G.column)}getValueInRange(C,W=0){if(C.isEmpty())return"";const V=this._getEndOfLine(W);return this._pieceTree.getValueInRange(C,V)}getValueLengthInRange(C,W=0){if(C.isEmpty())return 0;if(C.startLineNumber===C.endLineNumber)return C.endColumn-C.startColumn;const V=this.getOffsetAt(C.startLineNumber,C.startColumn),U=this.getOffsetAt(C.endLineNumber,C.endColumn);let G=0;const Z=this._getEndOfLine(W),X=this.getEOL();if(Z.length!==X.length){const Q=Z.length-X.length,J=C.endLineNumber-C.startLineNumber;G=Q*J}return U-V+G}getCharacterCountInRange(C,W=0){if(this._mightContainNonBasicASCII){let V=0;const U=C.startLineNumber,G=C.endLineNumber;for(let Z=U;Z<=G;Z++){const X=this.getLineContent(Z),Q=Z===U?C.startColumn-1:0,J=Z===G?C.endColumn-1:X.length;for(let ee=Q;ee<J;ee++)isHighSurrogate(X.charCodeAt(ee))?(V=V+1,ee=ee+1):V=V+1}return V+=this._getEndOfLine(W).length*(G-U),V}return this.getValueLengthInRange(C,W)}getLength(){return this._pieceTree.getLength()}getLineCount(){return this._pieceTree.getLineCount()}getLinesContent(){return this._pieceTree.getLinesContent()}getLineContent(C){return this._pieceTree.getLineContent(C)}getLineCharCode(C,W){return this._pieceTree.getLineCharCode(C,W)}getLineLength(C){return this._pieceTree.getLineLength(C)}getLineFirstNonWhitespaceColumn(C){const W=firstNonWhitespaceIndex(this.getLineContent(C));return W===-1?0:W+1}getLineLastNonWhitespaceColumn(C){const W=lastNonWhitespaceIndex(this.getLineContent(C));return W===-1?0:W+2}_getEndOfLine(C){switch(C){case 1:return`
`;case 2:return`\r
`;case 0:return this.getEOL();default:throw new Error("Unknown EOL preference")}}setEOL(C){this._pieceTree.setEOL(C)}applyEdits(C,W,V){let U=this._mightContainRTL,G=this._mightContainUnusualLineTerminators,Z=this._mightContainNonBasicASCII,X=!0,Q=[];for(let re=0;re<C.length;re++){const ae=C[re];X&&ae._isTracked&&(X=!1);const se=ae.range;if(ae.text){let ge=!0;Z||(ge=!isBasicASCII(ae.text),Z=ge),!U&&ge&&(U=containsRTL(ae.text)),!G&&ge&&(G=containsUnusualLineTerminators(ae.text))}let le="",ce=0,de=0,ue=0;if(ae.text){let ge;[ce,de,ue,ge]=countEOL(ae.text);const he=this.getEOL();ge===0||ge===(he===`\r
`?2:1)?le=ae.text:le=ae.text.replace(/\r\n|\r|\n/g,he)}Q[re]={sortIndex:re,identifier:ae.identifier||null,range:se,rangeOffset:this.getOffsetAt(se.startLineNumber,se.startColumn),rangeLength:this.getValueLengthInRange(se),text:le,eolCount:ce,firstLineLength:de,lastLineLength:ue,forceMoveMarkers:!!ae.forceMoveMarkers,isAutoWhitespaceEdit:ae.isAutoWhitespaceEdit||!1}}Q.sort(PieceTreeTextBuffer._sortOpsAscending);let J=!1;for(let re=0,ae=Q.length-1;re<ae;re++){const se=Q[re].range.getEndPosition(),le=Q[re+1].range.getStartPosition();if(le.isBeforeOrEqual(se)){if(le.isBefore(se))throw new Error("Overlapping ranges are not allowed!");J=!0}}X&&(Q=this._reduceOperations(Q));const ee=V||W?PieceTreeTextBuffer._getInverseEditRanges(Q):[],te=[];if(W)for(let re=0;re<Q.length;re++){const ae=Q[re],se=ee[re];if(ae.isAutoWhitespaceEdit&&ae.range.isEmpty())for(let le=se.startLineNumber;le<=se.endLineNumber;le++){let ce="";le===se.startLineNumber&&(ce=this.getLineContent(ae.range.startLineNumber),firstNonWhitespaceIndex(ce)!==-1)||te.push({lineNumber:le,oldContent:ce})}}let ie=null;if(V){let re=0;ie=[];for(let ae=0;ae<Q.length;ae++){const se=Q[ae],le=ee[ae],ce=this.getValueInRange(se.range),de=se.rangeOffset+re;re+=se.text.length-ce.length,ie[ae]={sortIndex:se.sortIndex,identifier:se.identifier,range:le,text:ce,textChange:new TextChange(se.rangeOffset,ce,de,se.text)}}J||ie.sort((ae,se)=>ae.sortIndex-se.sortIndex)}this._mightContainRTL=U,this._mightContainUnusualLineTerminators=G,this._mightContainNonBasicASCII=Z;const ne=this._doApplyEdits(Q);let oe=null;if(W&&te.length>0){te.sort((re,ae)=>ae.lineNumber-re.lineNumber),oe=[];for(let re=0,ae=te.length;re<ae;re++){const se=te[re].lineNumber;if(re>0&&te[re-1].lineNumber===se)continue;const le=te[re].oldContent,ce=this.getLineContent(se);ce.length===0||ce===le||firstNonWhitespaceIndex(ce)!==-1||oe.push(se)}}return this._onDidChangeContent.fire(),new ApplyEditsResult(ie,ne,oe)}_reduceOperations(C){return C.length<1e3?C:[this._toSingleEditOperation(C)]}_toSingleEditOperation(C){let W=!1;const V=C[0].range,U=C[C.length-1].range,G=new Range$2(V.startLineNumber,V.startColumn,U.endLineNumber,U.endColumn);let Z=V.startLineNumber,X=V.startColumn;const Q=[];for(let ne=0,oe=C.length;ne<oe;ne++){const re=C[ne],ae=re.range;W=W||re.forceMoveMarkers,Q.push(this.getValueInRange(new Range$2(Z,X,ae.startLineNumber,ae.startColumn))),re.text.length>0&&Q.push(re.text),Z=ae.endLineNumber,X=ae.endColumn}const J=Q.join(""),[ee,te,ie]=countEOL(J);return{sortIndex:0,identifier:C[0].identifier,range:G,rangeOffset:this.getOffsetAt(G.startLineNumber,G.startColumn),rangeLength:this.getValueLengthInRange(G,0),text:J,eolCount:ee,firstLineLength:te,lastLineLength:ie,forceMoveMarkers:W,isAutoWhitespaceEdit:!1}}_doApplyEdits(C){C.sort(PieceTreeTextBuffer._sortOpsDescending);const W=[];for(let V=0;V<C.length;V++){const U=C[V],G=U.range.startLineNumber,Z=U.range.startColumn,X=U.range.endLineNumber,Q=U.range.endColumn;if(G===X&&Z===Q&&U.text.length===0)continue;U.text?(this._pieceTree.delete(U.rangeOffset,U.rangeLength),this._pieceTree.insert(U.rangeOffset,U.text,!0)):this._pieceTree.delete(U.rangeOffset,U.rangeLength);const J=new Range$2(G,Z,X,Q);W.push({range:J,rangeLength:U.rangeLength,text:U.text,rangeOffset:U.rangeOffset,forceMoveMarkers:U.forceMoveMarkers})}return W}findMatchesLineByLine(C,W,V,U){return this._pieceTree.findMatchesLineByLine(C,W,V,U)}static _getInverseEditRanges(C){const W=[];let V=0,U=0,G=null;for(let Z=0,X=C.length;Z<X;Z++){const Q=C[Z];let J,ee;G?G.range.endLineNumber===Q.range.startLineNumber?(J=V,ee=U+(Q.range.startColumn-G.range.endColumn)):(J=V+(Q.range.startLineNumber-G.range.endLineNumber),ee=Q.range.startColumn):(J=Q.range.startLineNumber,ee=Q.range.startColumn);let te;if(Q.text.length>0){const ie=Q.eolCount+1;ie===1?te=new Range$2(J,ee,J,ee+Q.firstLineLength):te=new Range$2(J,ee,J+ie-1,Q.lastLineLength+1)}else te=new Range$2(J,ee,J,ee);V=te.endLineNumber,U=te.endColumn,W.push(te),G=Q}return W}static _sortOpsAscending(C,W){const V=Range$2.compareRangesUsingEnds(C.range,W.range);return V===0?C.sortIndex-W.sortIndex:V}static _sortOpsDescending(C,W){const V=Range$2.compareRangesUsingEnds(C.range,W.range);return V===0?W.sortIndex-C.sortIndex:-V}}class PieceTreeTextBufferFactory{constructor(C,W,V,U,G,Z,X,Q,J){this._chunks=C,this._bom=W,this._cr=V,this._lf=U,this._crlf=G,this._containsRTL=Z,this._containsUnusualLineTerminators=X,this._isBasicASCII=Q,this._normalizeEOL=J}_getEOL(C){const W=this._cr+this._lf+this._crlf,V=this._cr+this._crlf;return W===0?C===1?`
`:`\r
`:V>W/2?`\r
`:`
`}create(C){const W=this._getEOL(C),V=this._chunks;if(this._normalizeEOL&&(W===`\r
`&&(this._cr>0||this._lf>0)||W===`
`&&(this._cr>0||this._crlf>0)))for(let G=0,Z=V.length;G<Z;G++){const X=V[G].buffer.replace(/\r\n|\r|\n/g,W),Q=createLineStartsFast(X);V[G]=new StringBuffer(X,Q)}const U=new PieceTreeTextBuffer(V,this._bom,W,this._containsRTL,this._containsUnusualLineTerminators,this._isBasicASCII,this._normalizeEOL);return{textBuffer:U,disposable:U}}}class PieceTreeTextBufferBuilder{constructor(){this.chunks=[],this.BOM="",this._hasPreviousChar=!1,this._previousChar=0,this._tmpLineStarts=[],this.cr=0,this.lf=0,this.crlf=0,this.containsRTL=!1,this.containsUnusualLineTerminators=!1,this.isBasicASCII=!0}acceptChunk(C){if(C.length===0)return;this.chunks.length===0&&startsWithUTF8BOM(C)&&(this.BOM=UTF8_BOM_CHARACTER,C=C.substr(1));const W=C.charCodeAt(C.length-1);W===13||W>=55296&&W<=56319?(this._acceptChunk1(C.substr(0,C.length-1),!1),this._hasPreviousChar=!0,this._previousChar=W):(this._acceptChunk1(C,!1),this._hasPreviousChar=!1,this._previousChar=W)}_acceptChunk1(C,W){!W&&C.length===0||(this._hasPreviousChar?this._acceptChunk2(String.fromCharCode(this._previousChar)+C):this._acceptChunk2(C))}_acceptChunk2(C){const W=createLineStarts(this._tmpLineStarts,C);this.chunks.push(new StringBuffer(C,W.lineStarts)),this.cr+=W.cr,this.lf+=W.lf,this.crlf+=W.crlf,W.isBasicASCII||(this.isBasicASCII=!1,this.containsRTL||(this.containsRTL=containsRTL(C)),this.containsUnusualLineTerminators||(this.containsUnusualLineTerminators=containsUnusualLineTerminators(C)))}finish(C=!0){return this._finish(),new PieceTreeTextBufferFactory(this.chunks,this.BOM,this.cr,this.lf,this.crlf,this.containsRTL,this.containsUnusualLineTerminators,this.isBasicASCII,C)}_finish(){if(this.chunks.length===0&&this._acceptChunk1("",!0),this._hasPreviousChar){this._hasPreviousChar=!1;const C=this.chunks[this.chunks.length-1];C.buffer+=String.fromCharCode(this._previousChar);const W=createLineStartsFast(C.buffer);C.lineStarts=W,this._previousChar===13&&this.cr++}}}class FixedArray{constructor(C){this._default=C,this._store=[]}get(C){return C<this._store.length?this._store[C]:this._default}set(C,W){for(;C>=this._store.length;)this._store[this._store.length]=this._default;this._store[C]=W}replace(C,W,V){if(C>=this._store.length)return;if(W===0){this.insert(C,V);return}else if(V===0){this.delete(C,W);return}const U=this._store.slice(0,C),G=this._store.slice(C+W),Z=arrayFill(V,this._default);this._store=U.concat(Z,G)}delete(C,W){W===0||C>=this._store.length||this._store.splice(C,W)}insert(C,W){if(W===0||C>=this._store.length)return;const V=[];for(let U=0;U<W;U++)V[U]=this._default;this._store=arrayInsert(this._store,C,V)}}function arrayFill(K,C){const W=[];for(let V=0;V<K;V++)W[V]=C;return W}class ContiguousMultilineTokens{get startLineNumber(){return this._startLineNumber}get endLineNumber(){return this._startLineNumber+this._tokens.length-1}constructor(C,W){this._startLineNumber=C,this._tokens=W}getLineTokens(C){return this._tokens[C-this._startLineNumber]}appendLineTokens(C){this._tokens.push(C)}}class ContiguousMultilineTokensBuilder{constructor(){this._tokens=[]}add(C,W){if(this._tokens.length>0){const V=this._tokens[this._tokens.length-1];if(V.endLineNumber+1===C){V.appendLineTokens(W);return}}this._tokens.push(new ContiguousMultilineTokens(C,[W]))}finalize(){return this._tokens}}class TokenizerWithStateStore{constructor(C,W){this.tokenizationSupport=W,this.initialState=this.tokenizationSupport.getInitialState(),this.store=new TrackingTokenizationStateStore(C)}getStartState(C){return this.store.getStartState(C,this.initialState)}getFirstInvalidLine(){return this.store.getFirstInvalidLine(this.initialState)}}class TokenizerWithStateStoreAndTextModel extends TokenizerWithStateStore{constructor(C,W,V,U){super(C,W),this._textModel=V,this._languageIdCodec=U}updateTokensUntilLine(C,W){const V=this._textModel.getLanguageId();for(;;){const U=this.getFirstInvalidLine();if(!U||U.lineNumber>W)break;const G=this._textModel.getLineContent(U.lineNumber),Z=safeTokenize(this._languageIdCodec,V,this.tokenizationSupport,G,!0,U.startState);C.add(U.lineNumber,Z.tokens),this.store.setEndState(U.lineNumber,Z.endState)}}getTokenTypeIfInsertingCharacter(C,W){const V=this.getStartState(C.lineNumber);if(!V)return 0;const U=this._textModel.getLanguageId(),G=this._textModel.getLineContent(C.lineNumber),Z=G.substring(0,C.column-1)+W+G.substring(C.column-1),X=safeTokenize(this._languageIdCodec,U,this.tokenizationSupport,Z,!0,V),Q=new LineTokens(X.tokens,Z,this._languageIdCodec);if(Q.getCount()===0)return 0;const J=Q.findTokenIndexAtOffset(C.column-1);return Q.getStandardTokenType(J)}tokenizeLineWithEdit(C,W,V){const U=C.lineNumber,G=C.column,Z=this.getStartState(U);if(!Z)return null;const X=this._textModel.getLineContent(U),Q=X.substring(0,G-1)+V+X.substring(G-1+W),J=this._textModel.getLanguageIdAtPosition(U,0),ee=safeTokenize(this._languageIdCodec,J,this.tokenizationSupport,Q,!0,Z);return new LineTokens(ee.tokens,Q,this._languageIdCodec)}isCheapToTokenize(C){const W=this.store.getFirstInvalidEndStateLineNumberOrMax();return C<W||C===W&&this._textModel.getLineLength(C)<2048}tokenizeHeuristically(C,W,V){if(V<=this.store.getFirstInvalidEndStateLineNumberOrMax())return{heuristicTokens:!1};if(W<=this.store.getFirstInvalidEndStateLineNumberOrMax())return this.updateTokensUntilLine(C,V),{heuristicTokens:!1};let U=this.guessStartState(W);const G=this._textModel.getLanguageId();for(let Z=W;Z<=V;Z++){const X=this._textModel.getLineContent(Z),Q=safeTokenize(this._languageIdCodec,G,this.tokenizationSupport,X,!0,U);C.add(Z,Q.tokens),U=Q.endState}return{heuristicTokens:!0}}guessStartState(C){let W=this._textModel.getLineFirstNonWhitespaceColumn(C);const V=[];let U=null;for(let X=C-1;W>1&&X>=1;X--){const Q=this._textModel.getLineFirstNonWhitespaceColumn(X);if(Q!==0&&Q<W&&(V.push(this._textModel.getLineContent(X)),W=Q,U=this.getStartState(X),U))break}U||(U=this.tokenizationSupport.getInitialState()),V.reverse();const G=this._textModel.getLanguageId();let Z=U;for(const X of V)Z=safeTokenize(this._languageIdCodec,G,this.tokenizationSupport,X,!1,Z).endState;return Z}}class TrackingTokenizationStateStore{constructor(C){this.lineCount=C,this._tokenizationStateStore=new TokenizationStateStore,this._invalidEndStatesLineNumbers=new RangePriorityQueueImpl,this._invalidEndStatesLineNumbers.addRange(new OffsetRange(1,C+1))}getEndState(C){return this._tokenizationStateStore.getEndState(C)}setEndState(C,W){if(!W)throw new BugIndicatingError("Cannot set null/undefined state");this._invalidEndStatesLineNumbers.delete(C);const V=this._tokenizationStateStore.setEndState(C,W);return V&&C<this.lineCount&&this._invalidEndStatesLineNumbers.addRange(new OffsetRange(C+1,C+2)),V}acceptChange(C,W){this.lineCount+=W-C.length,this._tokenizationStateStore.acceptChange(C,W),this._invalidEndStatesLineNumbers.addRangeAndResize(new OffsetRange(C.startLineNumber,C.endLineNumberExclusive),W)}acceptChanges(C){for(const W of C){const[V]=countEOL(W.text);this.acceptChange(new LineRange$1(W.range.startLineNumber,W.range.endLineNumber+1),V+1)}}invalidateEndStateRange(C){this._invalidEndStatesLineNumbers.addRange(new OffsetRange(C.startLineNumber,C.endLineNumberExclusive))}getFirstInvalidEndStateLineNumber(){return this._invalidEndStatesLineNumbers.min}getFirstInvalidEndStateLineNumberOrMax(){return this.getFirstInvalidEndStateLineNumber()||Number.MAX_SAFE_INTEGER}allStatesValid(){return this._invalidEndStatesLineNumbers.min===null}getStartState(C,W){return C===1?W:this.getEndState(C-1)}getFirstInvalidLine(C){const W=this.getFirstInvalidEndStateLineNumber();if(W===null)return null;const V=this.getStartState(W,C);if(!V)throw new BugIndicatingError("Start state must be defined");return{lineNumber:W,startState:V}}}class TokenizationStateStore{constructor(){this._lineEndStates=new FixedArray(null)}getEndState(C){return this._lineEndStates.get(C)}setEndState(C,W){const V=this._lineEndStates.get(C);return V&&V.equals(W)?!1:(this._lineEndStates.set(C,W),!0)}acceptChange(C,W){let V=C.length;W>0&&V>0&&(V--,W--),this._lineEndStates.replace(C.startLineNumber,V,W)}}class RangePriorityQueueImpl{constructor(){this._ranges=[]}get min(){return this._ranges.length===0?null:this._ranges[0].start}delete(C){const W=this._ranges.findIndex(V=>V.contains(C));if(W!==-1){const V=this._ranges[W];V.start===C?V.endExclusive===C+1?this._ranges.splice(W,1):this._ranges[W]=new OffsetRange(C+1,V.endExclusive):V.endExclusive===C+1?this._ranges[W]=new OffsetRange(V.start,C):this._ranges.splice(W,1,new OffsetRange(V.start,C),new OffsetRange(C+1,V.endExclusive))}}addRange(C){OffsetRange.addRange(C,this._ranges)}addRangeAndResize(C,W){let V=0;for(;!(V>=this._ranges.length||C.start<=this._ranges[V].endExclusive);)V++;let U=V;for(;!(U>=this._ranges.length||C.endExclusive<this._ranges[U].start);)U++;const G=W-C.length;for(let Z=U;Z<this._ranges.length;Z++)this._ranges[Z]=this._ranges[Z].delta(G);if(V===U){const Z=new OffsetRange(C.start,C.start+W);Z.isEmpty||this._ranges.splice(V,0,Z)}else{const Z=Math.min(C.start,this._ranges[V].start),X=Math.max(C.endExclusive,this._ranges[U-1].endExclusive),Q=new OffsetRange(Z,X+G);Q.isEmpty?this._ranges.splice(V,U-V):this._ranges.splice(V,U-V,Q)}}toString(){return this._ranges.map(C=>C.toString()).join(" + ")}}function safeTokenize(K,C,W,V,U,G){let Z=null;if(W)try{Z=W.tokenizeEncoded(V,U,G.clone())}catch(X){onUnexpectedError(X)}return Z||(Z=nullTokenizeEncoded(K.encodeLanguageId(C),G)),LineTokens.convertToEndOffset(Z.tokens,V.length),Z}class DefaultBackgroundTokenizer{constructor(C,W){this._tokenizerWithStateStore=C,this._backgroundTokenStore=W,this._isDisposed=!1,this._isScheduled=!1}dispose(){this._isDisposed=!0}handleChanges(){this._beginBackgroundTokenization()}_beginBackgroundTokenization(){this._isScheduled||!this._tokenizerWithStateStore._textModel.isAttachedToEditor()||!this._hasLinesToTokenize()||(this._isScheduled=!0,runWhenIdle(C=>{this._isScheduled=!1,this._backgroundTokenizeWithDeadline(C)}))}_backgroundTokenizeWithDeadline(C){const W=Date.now()+C.timeRemaining(),V=()=>{this._isDisposed||!this._tokenizerWithStateStore._textModel.isAttachedToEditor()||!this._hasLinesToTokenize()||(this._backgroundTokenizeForAtLeast1ms(),Date.now()<W?setTimeout0(V):this._beginBackgroundTokenization())};V()}_backgroundTokenizeForAtLeast1ms(){const C=this._tokenizerWithStateStore._textModel.getLineCount(),W=new ContiguousMultilineTokensBuilder,V=StopWatch.create(!1);do if(V.elapsed()>1||this._tokenizeOneInvalidLine(W)>=C)break;while(this._hasLinesToTokenize());this._backgroundTokenStore.setTokens(W.finalize()),this.checkFinished()}_hasLinesToTokenize(){return this._tokenizerWithStateStore?!this._tokenizerWithStateStore.store.allStatesValid():!1}_tokenizeOneInvalidLine(C){var W;const V=(W=this._tokenizerWithStateStore)===null||W===void 0?void 0:W.getFirstInvalidLine();return V?(this._tokenizerWithStateStore.updateTokensUntilLine(C,V.lineNumber),V.lineNumber):this._tokenizerWithStateStore._textModel.getLineCount()+1}checkFinished(){this._isDisposed||this._tokenizerWithStateStore.store.allStatesValid()&&this._backgroundTokenStore.backgroundTokenizationFinished()}requestTokens(C,W){this._tokenizerWithStateStore.store.invalidateEndStateRange(new LineRange$1(C,W))}}const EMPTY_LINE_TOKENS=new Uint32Array(0).buffer;class ContiguousTokensEditing{static deleteBeginning(C,W){return C===null||C===EMPTY_LINE_TOKENS?C:ContiguousTokensEditing.delete(C,0,W)}static deleteEnding(C,W){if(C===null||C===EMPTY_LINE_TOKENS)return C;const V=toUint32Array(C),U=V[V.length-2];return ContiguousTokensEditing.delete(C,W,U)}static delete(C,W,V){if(C===null||C===EMPTY_LINE_TOKENS||W===V)return C;const U=toUint32Array(C),G=U.length>>>1;if(W===0&&U[U.length-2]===V)return EMPTY_LINE_TOKENS;const Z=LineTokens.findIndexInTokensArray(U,W),X=Z>0?U[Z-1<<1]:0,Q=U[Z<<1];if(V<Q){const ne=V-W;for(let oe=Z;oe<G;oe++)U[oe<<1]-=ne;return C}let J,ee;X!==W?(U[Z<<1]=W,J=Z+1<<1,ee=W):(J=Z<<1,ee=X);const te=V-W;for(let ne=Z+1;ne<G;ne++){const oe=U[ne<<1]-te;oe>ee&&(U[J++]=oe,U[J++]=U[(ne<<1)+1],ee=oe)}if(J===U.length)return C;const ie=new Uint32Array(J);return ie.set(U.subarray(0,J),0),ie.buffer}static append(C,W){if(W===EMPTY_LINE_TOKENS)return C;if(C===EMPTY_LINE_TOKENS)return W;if(C===null)return C;if(W===null)return null;const V=toUint32Array(C),U=toUint32Array(W),G=U.length>>>1,Z=new Uint32Array(V.length+U.length);Z.set(V,0);let X=V.length;const Q=V[V.length-2];for(let J=0;J<G;J++)Z[X++]=U[J<<1]+Q,Z[X++]=U[(J<<1)+1];return Z.buffer}static insert(C,W,V){if(C===null||C===EMPTY_LINE_TOKENS)return C;const U=toUint32Array(C),G=U.length>>>1;let Z=LineTokens.findIndexInTokensArray(U,W);Z>0&&U[Z-1<<1]===W&&Z--;for(let X=Z;X<G;X++)U[X<<1]+=V;return C}}function toUint32Array(K){return K instanceof Uint32Array?K:new Uint32Array(K)}class ContiguousTokensStore{constructor(C){this._lineTokens=[],this._len=0,this._languageIdCodec=C}flush(){this._lineTokens=[],this._len=0}get hasTokens(){return this._lineTokens.length>0}getTokens(C,W,V){let U=null;if(W<this._len&&(U=this._lineTokens[W]),U!==null&&U!==EMPTY_LINE_TOKENS)return new LineTokens(toUint32Array(U),V,this._languageIdCodec);const G=new Uint32Array(2);return G[0]=V.length,G[1]=getDefaultMetadata(this._languageIdCodec.encodeLanguageId(C)),new LineTokens(G,V,this._languageIdCodec)}static _massageTokens(C,W,V){const U=V?toUint32Array(V):null;if(W===0){let G=!1;if(U&&U.length>1&&(G=TokenMetadata.getLanguageId(U[1])!==C),!G)return EMPTY_LINE_TOKENS}if(!U||U.length===0){const G=new Uint32Array(2);return G[0]=W,G[1]=getDefaultMetadata(C),G.buffer}return U[U.length-2]=W,U.byteOffset===0&&U.byteLength===U.buffer.byteLength?U.buffer:U}_ensureLine(C){for(;C>=this._len;)this._lineTokens[this._len]=null,this._len++}_deleteLines(C,W){W!==0&&(C+W>this._len&&(W=this._len-C),this._lineTokens.splice(C,W),this._len-=W)}_insertLines(C,W){if(W===0)return;const V=[];for(let U=0;U<W;U++)V[U]=null;this._lineTokens=arrayInsert(this._lineTokens,C,V),this._len+=W}setTokens(C,W,V,U,G){const Z=ContiguousTokensStore._massageTokens(this._languageIdCodec.encodeLanguageId(C),V,U);this._ensureLine(W);const X=this._lineTokens[W];return this._lineTokens[W]=Z,G?!ContiguousTokensStore._equals(X,Z):!1}static _equals(C,W){if(!C||!W)return!C&&!W;const V=toUint32Array(C),U=toUint32Array(W);if(V.length!==U.length)return!1;for(let G=0,Z=V.length;G<Z;G++)if(V[G]!==U[G])return!1;return!0}acceptEdit(C,W,V){this._acceptDeleteRange(C),this._acceptInsertText(new Position$1(C.startLineNumber,C.startColumn),W,V)}_acceptDeleteRange(C){const W=C.startLineNumber-1;if(W>=this._len)return;if(C.startLineNumber===C.endLineNumber){if(C.startColumn===C.endColumn)return;this._lineTokens[W]=ContiguousTokensEditing.delete(this._lineTokens[W],C.startColumn-1,C.endColumn-1);return}this._lineTokens[W]=ContiguousTokensEditing.deleteEnding(this._lineTokens[W],C.startColumn-1);const V=C.endLineNumber-1;let U=null;V<this._len&&(U=ContiguousTokensEditing.deleteBeginning(this._lineTokens[V],C.endColumn-1)),this._lineTokens[W]=ContiguousTokensEditing.append(this._lineTokens[W],U),this._deleteLines(C.startLineNumber,C.endLineNumber-C.startLineNumber)}_acceptInsertText(C,W,V){if(W===0&&V===0)return;const U=C.lineNumber-1;if(!(U>=this._len)){if(W===0){this._lineTokens[U]=ContiguousTokensEditing.insert(this._lineTokens[U],C.column-1,V);return}this._lineTokens[U]=ContiguousTokensEditing.deleteEnding(this._lineTokens[U],C.column-1),this._lineTokens[U]=ContiguousTokensEditing.insert(this._lineTokens[U],C.column-1,V),this._insertLines(C.lineNumber,W)}}setMultilineTokens(C,W){if(C.length===0)return{changes:[]};const V=[];for(let U=0,G=C.length;U<G;U++){const Z=C[U];let X=0,Q=0,J=!1;for(let ee=Z.startLineNumber;ee<=Z.endLineNumber;ee++)J?(this.setTokens(W.getLanguageId(),ee-1,W.getLineLength(ee),Z.getLineTokens(ee),!1),Q=ee):this.setTokens(W.getLanguageId(),ee-1,W.getLineLength(ee),Z.getLineTokens(ee),!0)&&(J=!0,X=ee,Q=ee);J&&V.push({fromLineNumber:X,toLineNumber:Q})}return{changes:V}}}function getDefaultMetadata(K){return(K<<0|0|0|32768|2<<24|1024)>>>0}class SparseTokensStore{constructor(C){this._pieces=[],this._isComplete=!1,this._languageIdCodec=C}flush(){this._pieces=[],this._isComplete=!1}isEmpty(){return this._pieces.length===0}set(C,W){this._pieces=C||[],this._isComplete=W}setPartial(C,W){let V=C;if(W.length>0){const G=W[0].getRange(),Z=W[W.length-1].getRange();if(!G||!Z)return C;V=C.plusRange(G).plusRange(Z)}let U=null;for(let G=0,Z=this._pieces.length;G<Z;G++){const X=this._pieces[G];if(X.endLineNumber<V.startLineNumber)continue;if(X.startLineNumber>V.endLineNumber){U=U||{index:G};break}if(X.removeTokens(V),X.isEmpty()){this._pieces.splice(G,1),G--,Z--;continue}if(X.endLineNumber<V.startLineNumber)continue;if(X.startLineNumber>V.endLineNumber){U=U||{index:G};continue}const[Q,J]=X.split(V);if(Q.isEmpty()){U=U||{index:G};continue}J.isEmpty()||(this._pieces.splice(G,1,Q,J),G++,Z++,U=U||{index:G})}return U=U||{index:this._pieces.length},W.length>0&&(this._pieces=arrayInsert(this._pieces,U.index,W)),V}isComplete(){return this._isComplete}addSparseTokens(C,W){if(W.getLineContent().length===0)return W;const V=this._pieces;if(V.length===0)return W;const U=SparseTokensStore._findFirstPieceWithLine(V,C),G=V[U].getLineTokens(C);if(!G)return W;const Z=W.getCount(),X=G.getCount();let Q=0;const J=[];let ee=0,te=0;const ie=(ne,oe)=>{ne!==te&&(te=ne,J[ee++]=ne,J[ee++]=oe)};for(let ne=0;ne<X;ne++){const oe=G.getStartCharacter(ne),re=G.getEndCharacter(ne),ae=G.getMetadata(ne),se=((ae&1?2048:0)|(ae&2?4096:0)|(ae&4?8192:0)|(ae&8?16384:0)|(ae&16?16744448:0)|(ae&32?4278190080:0))>>>0,le=~se>>>0;for(;Q<Z&&W.getEndOffset(Q)<=oe;)ie(W.getEndOffset(Q),W.getMetadata(Q)),Q++;for(Q<Z&&W.getStartOffset(Q)<oe&&ie(oe,W.getMetadata(Q));Q<Z&&W.getEndOffset(Q)<re;)ie(W.getEndOffset(Q),W.getMetadata(Q)&le|ae&se),Q++;if(Q<Z)ie(re,W.getMetadata(Q)&le|ae&se),W.getEndOffset(Q)===re&&Q++;else{const ce=Math.min(Math.max(0,Q-1),Z-1);ie(re,W.getMetadata(ce)&le|ae&se)}}for(;Q<Z;)ie(W.getEndOffset(Q),W.getMetadata(Q)),Q++;return new LineTokens(new Uint32Array(J),W.getLineContent(),this._languageIdCodec)}static _findFirstPieceWithLine(C,W){let V=0,U=C.length-1;for(;V<U;){let G=V+Math.floor((U-V)/2);if(C[G].endLineNumber<W)V=G+1;else if(C[G].startLineNumber>W)U=G-1;else{for(;G>V&&C[G-1].startLineNumber<=W&&W<=C[G-1].endLineNumber;)G--;return G}}return V}acceptEdit(C,W,V,U,G){for(const Z of this._pieces)Z.acceptEdit(C,W,V,U,G)}}class TokenizationTextModelPart extends TextModelPart{constructor(C,W,V,U,G,Z){super(),this._languageService=C,this._languageConfigurationService=W,this._textModel=V,this._bracketPairsTextModelPart=U,this._languageId=G,this._attachedViews=Z,this._semanticTokens=new SparseTokensStore(this._languageService.languageIdCodec),this._onDidChangeLanguage=this._register(new Emitter$1),this.onDidChangeLanguage=this._onDidChangeLanguage.event,this._onDidChangeLanguageConfiguration=this._register(new Emitter$1),this.onDidChangeLanguageConfiguration=this._onDidChangeLanguageConfiguration.event,this._onDidChangeTokens=this._register(new Emitter$1),this.onDidChangeTokens=this._onDidChangeTokens.event,this.grammarTokens=this._register(new GrammarTokens(this._languageService.languageIdCodec,this._textModel,()=>this._languageId,this._attachedViews)),this._register(this._languageConfigurationService.onDidChange(X=>{X.affects(this._languageId)&&this._onDidChangeLanguageConfiguration.fire({})})),this._register(this.grammarTokens.onDidChangeTokens(X=>{this._emitModelTokensChangedEvent(X)})),this._register(this.grammarTokens.onDidChangeBackgroundTokenizationState(X=>{this._bracketPairsTextModelPart.handleDidChangeBackgroundTokenizationState()}))}handleDidChangeContent(C){if(C.isFlush)this._semanticTokens.flush();else if(!C.isEolChange)for(const W of C.changes){const[V,U,G]=countEOL(W.text);this._semanticTokens.acceptEdit(W.range,V,U,G,W.text.length>0?W.text.charCodeAt(0):0)}this.grammarTokens.handleDidChangeContent(C)}handleDidChangeAttached(){this.grammarTokens.handleDidChangeAttached()}getLineTokens(C){this.validateLineNumber(C);const W=this.grammarTokens.getLineTokens(C);return this._semanticTokens.addSparseTokens(C,W)}_emitModelTokensChangedEvent(C){this._textModel._isDisposing()||(this._bracketPairsTextModelPart.handleDidChangeTokens(C),this._onDidChangeTokens.fire(C))}validateLineNumber(C){if(C<1||C>this._textModel.getLineCount())throw new BugIndicatingError("Illegal value for lineNumber")}get hasTokens(){return this.grammarTokens.hasTokens}resetTokenization(){this.grammarTokens.resetTokenization()}get backgroundTokenizationState(){return this.grammarTokens.backgroundTokenizationState}forceTokenization(C){this.validateLineNumber(C),this.grammarTokens.forceTokenization(C)}isCheapToTokenize(C){return this.validateLineNumber(C),this.grammarTokens.isCheapToTokenize(C)}tokenizeIfCheap(C){this.validateLineNumber(C),this.grammarTokens.tokenizeIfCheap(C)}getTokenTypeIfInsertingCharacter(C,W,V){return this.grammarTokens.getTokenTypeIfInsertingCharacter(C,W,V)}tokenizeLineWithEdit(C,W,V){return this.grammarTokens.tokenizeLineWithEdit(C,W,V)}setSemanticTokens(C,W){this._semanticTokens.set(C,W),this._emitModelTokensChangedEvent({semanticTokensApplied:C!==null,ranges:[{fromLineNumber:1,toLineNumber:this._textModel.getLineCount()}]})}hasCompleteSemanticTokens(){return this._semanticTokens.isComplete()}hasSomeSemanticTokens(){return!this._semanticTokens.isEmpty()}setPartialSemanticTokens(C,W){if(this.hasCompleteSemanticTokens())return;const V=this._textModel.validateRange(this._semanticTokens.setPartial(C,W));this._emitModelTokensChangedEvent({semanticTokensApplied:!0,ranges:[{fromLineNumber:V.startLineNumber,toLineNumber:V.endLineNumber}]})}getWordAtPosition(C){this.assertNotDisposed();const W=this._textModel.validatePosition(C),V=this._textModel.getLineContent(W.lineNumber),U=this.getLineTokens(W.lineNumber),G=U.findTokenIndexAtOffset(W.column-1),[Z,X]=TokenizationTextModelPart._findLanguageBoundaries(U,G),Q=getWordAtText(W.column,this.getLanguageConfiguration(U.getLanguageId(G)).getWordDefinition(),V.substring(Z,X),Z);if(Q&&Q.startColumn<=C.column&&C.column<=Q.endColumn)return Q;if(G>0&&Z===W.column-1){const[J,ee]=TokenizationTextModelPart._findLanguageBoundaries(U,G-1),te=getWordAtText(W.column,this.getLanguageConfiguration(U.getLanguageId(G-1)).getWordDefinition(),V.substring(J,ee),J);if(te&&te.startColumn<=C.column&&C.column<=te.endColumn)return te}return null}getLanguageConfiguration(C){return this._languageConfigurationService.getLanguageConfiguration(C)}static _findLanguageBoundaries(C,W){const V=C.getLanguageId(W);let U=0;for(let Z=W;Z>=0&&C.getLanguageId(Z)===V;Z--)U=C.getStartOffset(Z);let G=C.getLineContent().length;for(let Z=W,X=C.getCount();Z<X&&C.getLanguageId(Z)===V;Z++)G=C.getEndOffset(Z);return[U,G]}getWordUntilPosition(C){const W=this.getWordAtPosition(C);return W?{word:W.word.substr(0,C.column-W.startColumn),startColumn:W.startColumn,endColumn:C.column}:{word:"",startColumn:C.column,endColumn:C.column}}getLanguageId(){return this._languageId}getLanguageIdAtPosition(C,W){const V=this._textModel.validatePosition(new Position$1(C,W)),U=this.getLineTokens(V.lineNumber);return U.getLanguageId(U.findTokenIndexAtOffset(V.column-1))}setLanguageId(C,W="api"){if(this._languageId===C)return;const V={oldLanguage:this._languageId,newLanguage:C,source:W};this._languageId=C,this._bracketPairsTextModelPart.handleDidChangeLanguage(V),this.grammarTokens.resetTokenization(),this._onDidChangeLanguage.fire(V),this._onDidChangeLanguageConfiguration.fire({})}}class GrammarTokens extends Disposable{get backgroundTokenizationState(){return this._backgroundTokenizationState}constructor(C,W,V,U){super(),this._languageIdCodec=C,this._textModel=W,this.getLanguageId=V,this._tokenizer=null,this._defaultBackgroundTokenizer=null,this._backgroundTokenizer=this._register(new MutableDisposable),this._tokens=new ContiguousTokensStore(this._languageIdCodec),this._debugBackgroundTokenizer=this._register(new MutableDisposable),this._backgroundTokenizationState=1,this._onDidChangeBackgroundTokenizationState=this._register(new Emitter$1),this.onDidChangeBackgroundTokenizationState=this._onDidChangeBackgroundTokenizationState.event,this._onDidChangeTokens=this._register(new Emitter$1),this.onDidChangeTokens=this._onDidChangeTokens.event,this._attachedViewStates=this._register(new DisposableMap),this._register(TokenizationRegistry.onDidChange(G=>{const Z=this.getLanguageId();G.changedLanguages.indexOf(Z)!==-1&&this.resetTokenization()})),this.resetTokenization(),this._register(U.onDidChangeVisibleRanges(({view:G,state:Z})=>{if(Z){let X=this._attachedViewStates.get(G);X||(X=new AttachedViewHandler(()=>this.refreshRanges(X.lineRanges)),this._attachedViewStates.set(G,X)),X.handleStateChange(Z)}else this._attachedViewStates.deleteAndDispose(G)}))}resetTokenization(C=!0){var W;this._tokens.flush(),(W=this._debugBackgroundTokens)===null||W===void 0||W.flush(),this._debugBackgroundStates&&(this._debugBackgroundStates=new TrackingTokenizationStateStore(this._textModel.getLineCount())),C&&this._onDidChangeTokens.fire({semanticTokensApplied:!1,ranges:[{fromLineNumber:1,toLineNumber:this._textModel.getLineCount()}]});const V=()=>{if(this._textModel.isTooLargeForTokenization())return[null,null];const Z=TokenizationRegistry.get(this.getLanguageId());if(!Z)return[null,null];let X;try{X=Z.getInitialState()}catch(Q){return onUnexpectedError(Q),[null,null]}return[Z,X]},[U,G]=V();if(U&&G?this._tokenizer=new TokenizerWithStateStoreAndTextModel(this._textModel.getLineCount(),U,this._textModel,this._languageIdCodec):this._tokenizer=null,this._backgroundTokenizer.clear(),this._defaultBackgroundTokenizer=null,this._tokenizer){const Z={setTokens:X=>{this.setTokens(X)},backgroundTokenizationFinished:()=>{if(this._backgroundTokenizationState===2)return;const X=2;this._backgroundTokenizationState=X,this._onDidChangeBackgroundTokenizationState.fire()},setEndState:(X,Q)=>{var J;if(!this._tokenizer)return;const ee=this._tokenizer.store.getFirstInvalidEndStateLineNumber();ee!==null&&X>=ee&&((J=this._tokenizer)===null||J===void 0||J.store.setEndState(X,Q))}};U&&U.createBackgroundTokenizer&&!U.backgroundTokenizerShouldOnlyVerifyTokens&&(this._backgroundTokenizer.value=U.createBackgroundTokenizer(this._textModel,Z)),this._backgroundTokenizer.value||(this._backgroundTokenizer.value=this._defaultBackgroundTokenizer=new DefaultBackgroundTokenizer(this._tokenizer,Z),this._defaultBackgroundTokenizer.handleChanges()),U!=null&&U.backgroundTokenizerShouldOnlyVerifyTokens&&U.createBackgroundTokenizer?(this._debugBackgroundTokens=new ContiguousTokensStore(this._languageIdCodec),this._debugBackgroundStates=new TrackingTokenizationStateStore(this._textModel.getLineCount()),this._debugBackgroundTokenizer.clear(),this._debugBackgroundTokenizer.value=U.createBackgroundTokenizer(this._textModel,{setTokens:X=>{var Q;(Q=this._debugBackgroundTokens)===null||Q===void 0||Q.setMultilineTokens(X,this._textModel)},backgroundTokenizationFinished(){},setEndState:(X,Q)=>{var J;(J=this._debugBackgroundStates)===null||J===void 0||J.setEndState(X,Q)}})):(this._debugBackgroundTokens=void 0,this._debugBackgroundStates=void 0,this._debugBackgroundTokenizer.value=void 0)}this.refreshAllVisibleLineTokens()}handleDidChangeAttached(){var C;(C=this._defaultBackgroundTokenizer)===null||C===void 0||C.handleChanges()}handleDidChangeContent(C){var W,V,U;if(C.isFlush)this.resetTokenization(!1);else if(!C.isEolChange){for(const G of C.changes){const[Z,X]=countEOL(G.text);this._tokens.acceptEdit(G.range,Z,X),(W=this._debugBackgroundTokens)===null||W===void 0||W.acceptEdit(G.range,Z,X)}(V=this._debugBackgroundStates)===null||V===void 0||V.acceptChanges(C.changes),this._tokenizer&&this._tokenizer.store.acceptChanges(C.changes),(U=this._defaultBackgroundTokenizer)===null||U===void 0||U.handleChanges()}}setTokens(C){const{changes:W}=this._tokens.setMultilineTokens(C,this._textModel);return W.length>0&&this._onDidChangeTokens.fire({semanticTokensApplied:!1,ranges:W}),{changes:W}}refreshAllVisibleLineTokens(){const C=LineRange$1.joinMany([...this._attachedViewStates].map(([W,V])=>V.lineRanges));this.refreshRanges(C)}refreshRanges(C){for(const W of C)this.refreshRange(W.startLineNumber,W.endLineNumberExclusive-1)}refreshRange(C,W){var V,U;if(!this._tokenizer)return;C=Math.max(1,Math.min(this._textModel.getLineCount(),C)),W=Math.min(this._textModel.getLineCount(),W);const G=new ContiguousMultilineTokensBuilder,{heuristicTokens:Z}=this._tokenizer.tokenizeHeuristically(G,C,W),X=this.setTokens(G.finalize());if(Z)for(const Q of X.changes)(V=this._backgroundTokenizer.value)===null||V===void 0||V.requestTokens(Q.fromLineNumber,Q.toLineNumber+1);(U=this._defaultBackgroundTokenizer)===null||U===void 0||U.checkFinished()}forceTokenization(C){var W,V;const U=new ContiguousMultilineTokensBuilder;(W=this._tokenizer)===null||W===void 0||W.updateTokensUntilLine(U,C),this.setTokens(U.finalize()),(V=this._defaultBackgroundTokenizer)===null||V===void 0||V.checkFinished()}isCheapToTokenize(C){return this._tokenizer?this._tokenizer.isCheapToTokenize(C):!0}tokenizeIfCheap(C){this.isCheapToTokenize(C)&&this.forceTokenization(C)}getLineTokens(C){var W;const V=this._textModel.getLineContent(C),U=this._tokens.getTokens(this._textModel.getLanguageId(),C-1,V);if(this._debugBackgroundTokens&&this._debugBackgroundStates&&this._tokenizer&&this._debugBackgroundStates.getFirstInvalidEndStateLineNumberOrMax()>C&&this._tokenizer.store.getFirstInvalidEndStateLineNumberOrMax()>C){const G=this._debugBackgroundTokens.getTokens(this._textModel.getLanguageId(),C-1,V);!U.equals(G)&&(!((W=this._debugBackgroundTokenizer.value)===null||W===void 0)&&W.reportMismatchingTokens)&&this._debugBackgroundTokenizer.value.reportMismatchingTokens(C)}return U}getTokenTypeIfInsertingCharacter(C,W,V){if(!this._tokenizer)return 0;const U=this._textModel.validatePosition(new Position$1(C,W));return this.forceTokenization(U.lineNumber),this._tokenizer.getTokenTypeIfInsertingCharacter(U,V)}tokenizeLineWithEdit(C,W,V){if(!this._tokenizer)return null;const U=this._textModel.validatePosition(C);return this.forceTokenization(U.lineNumber),this._tokenizer.tokenizeLineWithEdit(U,W,V)}get hasTokens(){return this._tokens.hasTokens}}class AttachedViewHandler extends Disposable{get lineRanges(){return this._lineRanges}constructor(C){super(),this._refreshTokens=C,this.runner=this._register(new RunOnceScheduler(()=>this.update(),50)),this._computedLineRanges=[],this._lineRanges=[]}update(){equals$5(this._computedLineRanges,this._lineRanges,(C,W)=>C.equals(W))||(this._computedLineRanges=this._lineRanges,this._refreshTokens())}handleStateChange(C){this._lineRanges=C.visibleLineRanges,C.stabilized?(this.runner.cancel(),this.update()):this.runner.schedule()}}class ModelRawFlush{constructor(){this.changeType=1}}class LineInjectedText{static applyInjectedText(C,W){if(!W||W.length===0)return C;let V="",U=0;for(const G of W)V+=C.substring(U,G.column-1),U=G.column-1,V+=G.options.content;return V+=C.substring(U),V}static fromDecorations(C){const W=[];for(const V of C)V.options.before&&V.options.before.content.length>0&&W.push(new LineInjectedText(V.ownerId,V.range.startLineNumber,V.range.startColumn,V.options.before,0)),V.options.after&&V.options.after.content.length>0&&W.push(new LineInjectedText(V.ownerId,V.range.endLineNumber,V.range.endColumn,V.options.after,1));return W.sort((V,U)=>V.lineNumber===U.lineNumber?V.column===U.column?V.order-U.order:V.column-U.column:V.lineNumber-U.lineNumber),W}constructor(C,W,V,U,G){this.ownerId=C,this.lineNumber=W,this.column=V,this.options=U,this.order=G}}class ModelRawLineChanged{constructor(C,W,V){this.changeType=2,this.lineNumber=C,this.detail=W,this.injectedText=V}}class ModelRawLinesDeleted{constructor(C,W){this.changeType=3,this.fromLineNumber=C,this.toLineNumber=W}}class ModelRawLinesInserted{constructor(C,W,V,U){this.changeType=4,this.injectedTexts=U,this.fromLineNumber=C,this.toLineNumber=W,this.detail=V}}class ModelRawEOLChanged{constructor(){this.changeType=5}}class ModelRawContentChangedEvent{constructor(C,W,V,U){this.changes=C,this.versionId=W,this.isUndoing=V,this.isRedoing=U,this.resultingSelection=null}containsEvent(C){for(let W=0,V=this.changes.length;W<V;W++)if(this.changes[W].changeType===C)return!0;return!1}static merge(C,W){const V=[].concat(C.changes).concat(W.changes),U=W.versionId,G=C.isUndoing||W.isUndoing,Z=C.isRedoing||W.isRedoing;return new ModelRawContentChangedEvent(V,U,G,Z)}}class ModelInjectedTextChangedEvent{constructor(C){this.changes=C}}class InternalModelContentChangeEvent{constructor(C,W){this.rawContentChangedEvent=C,this.contentChangedEvent=W}merge(C){const W=ModelRawContentChangedEvent.merge(this.rawContentChangedEvent,C.rawContentChangedEvent),V=InternalModelContentChangeEvent._mergeChangeEvents(this.contentChangedEvent,C.contentChangedEvent);return new InternalModelContentChangeEvent(W,V)}static _mergeChangeEvents(C,W){const V=[].concat(C.changes).concat(W.changes),U=W.eol,G=W.versionId,Z=C.isUndoing||W.isUndoing,X=C.isRedoing||W.isRedoing,Q=C.isFlush||W.isFlush,J=C.isEolChange&&W.isEolChange;return{changes:V,eol:U,isEolChange:J,versionId:G,isUndoing:Z,isRedoing:X,isFlush:Q}}}const IUndoRedoService=createDecorator("undoRedoService");class ResourceEditStackSnapshot{constructor(C,W){this.resource=C,this.elements=W}}class UndoRedoGroup{constructor(){this.id=UndoRedoGroup._ID++,this.order=1}nextOrder(){return this.id===0?0:this.order++}}UndoRedoGroup._ID=0;UndoRedoGroup.None=new UndoRedoGroup;class UndoRedoSource{constructor(){this.id=UndoRedoSource._ID++,this.order=1}nextOrder(){return this.id===0?0:this.order++}}UndoRedoSource._ID=0;UndoRedoSource.None=new UndoRedoSource;var __decorate$21=globalThis&&globalThis.__decorate||function(K,C,W,V){var U=arguments.length,G=U<3?C:V===null?V=Object.getOwnPropertyDescriptor(C,W):V,Z;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")G=Reflect.decorate(K,C,W,V);else for(var X=K.length-1;X>=0;X--)(Z=K[X])&&(G=(U<3?Z(G):U>3?Z(C,W,G):Z(C,W))||G);return U>3&&G&&Object.defineProperty(C,W,G),G},__param$1X=globalThis&&globalThis.__param||function(K,C){return function(W,V){C(W,V,K)}},TextModel_1;function createTextBufferFactory(K){const C=new PieceTreeTextBufferBuilder;return C.acceptChunk(K),C.finish()}function createTextBufferFactoryFromSnapshot(K){const C=new PieceTreeTextBufferBuilder;let W;for(;typeof(W=K.read())=="string";)C.acceptChunk(W);return C.finish()}function createTextBuffer(K,C){let W;return typeof K=="string"?W=createTextBufferFactory(K):isITextSnapshot(K)?W=createTextBufferFactoryFromSnapshot(K):W=K,W.create(C)}let MODEL_ID$1=0;const LIMIT_FIND_COUNT=999,LONG_LINE_BOUNDARY=1e4;class TextModelSnapshot{constructor(C){this._source=C,this._eos=!1}read(){if(this._eos)return null;const C=[];let W=0,V=0;do{const U=this._source.read();if(U===null)return this._eos=!0,W===0?null:C.join("");if(U.length>0&&(C[W++]=U,V+=U.length),V>=64*1024)return C.join("")}while(!0)}}const invalidFunc=()=>{throw new Error("Invalid change accessor")};let TextModel=TextModel_1=class extends Disposable{static resolveOptions(C,W){if(W.detectIndentation){const V=guessIndentation(C,W.tabSize,W.insertSpaces);return new TextModelResolvedOptions({tabSize:V.tabSize,indentSize:"tabSize",insertSpaces:V.insertSpaces,trimAutoWhitespace:W.trimAutoWhitespace,defaultEOL:W.defaultEOL,bracketPairColorizationOptions:W.bracketPairColorizationOptions})}return new TextModelResolvedOptions(W)}get onDidChangeLanguage(){return this._tokenizationTextModelPart.onDidChangeLanguage}get onDidChangeLanguageConfiguration(){return this._tokenizationTextModelPart.onDidChangeLanguageConfiguration}get onDidChangeTokens(){return this._tokenizationTextModelPart.onDidChangeTokens}onDidChangeContent(C){return this._eventEmitter.slowEvent(W=>C(W.contentChangedEvent))}onDidChangeContentOrInjectedText(C){return combinedDisposable(this._eventEmitter.fastEvent(W=>C(W)),this._onDidChangeInjectedText.event(W=>C(W)))}_isDisposing(){return this.__isDisposing}get tokenization(){return this._tokenizationTextModelPart}get bracketPairs(){return this._bracketPairs}get guides(){return this._guidesTextModelPart}constructor(C,W,V,U=null,G,Z,X){super(),this._undoRedoService=G,this._languageService=Z,this._languageConfigurationService=X,this._onWillDispose=this._register(new Emitter$1),this.onWillDispose=this._onWillDispose.event,this._onDidChangeDecorations=this._register(new DidChangeDecorationsEmitter(ne=>this.handleBeforeFireDecorationsChangedEvent(ne))),this.onDidChangeDecorations=this._onDidChangeDecorations.event,this._onDidChangeOptions=this._register(new Emitter$1),this.onDidChangeOptions=this._onDidChangeOptions.event,this._onDidChangeAttached=this._register(new Emitter$1),this.onDidChangeAttached=this._onDidChangeAttached.event,this._onDidChangeInjectedText=this._register(new Emitter$1),this._eventEmitter=this._register(new DidChangeContentEmitter),this._languageSelectionListener=this._register(new MutableDisposable),this._deltaDecorationCallCnt=0,this._attachedViews=new AttachedViews,MODEL_ID$1++,this.id="$model"+MODEL_ID$1,this.isForSimpleWidget=V.isForSimpleWidget,typeof U>"u"||U===null?this._associatedResource=URI.parse("inmemory://model/"+MODEL_ID$1):this._associatedResource=U,this._attachedEditorCount=0;const{textBuffer:Q,disposable:J}=createTextBuffer(C,V.defaultEOL);this._buffer=Q,this._bufferDisposable=J,this._options=TextModel_1.resolveOptions(this._buffer,V);const ee=typeof W=="string"?W:W.languageId;typeof W!="string"&&(this._languageSelectionListener.value=W.onDidChange(()=>this._setLanguage(W.languageId))),this._bracketPairs=this._register(new BracketPairsTextModelPart(this,this._languageConfigurationService)),this._guidesTextModelPart=this._register(new GuidesTextModelPart(this,this._languageConfigurationService)),this._decorationProvider=this._register(new ColorizedBracketPairsDecorationProvider(this)),this._tokenizationTextModelPart=new TokenizationTextModelPart(this._languageService,this._languageConfigurationService,this,this._bracketPairs,ee,this._attachedViews);const te=this._buffer.getLineCount(),ie=this._buffer.getValueLengthInRange(new Range$2(1,1,te,this._buffer.getLineLength(te)+1),0);V.largeFileOptimizations?(this._isTooLargeForTokenization=ie>TextModel_1.LARGE_FILE_SIZE_THRESHOLD||te>TextModel_1.LARGE_FILE_LINE_COUNT_THRESHOLD,this._isTooLargeForHeapOperation=ie>TextModel_1.LARGE_FILE_HEAP_OPERATION_THRESHOLD):(this._isTooLargeForTokenization=!1,this._isTooLargeForHeapOperation=!1),this._isTooLargeForSyncing=ie>TextModel_1._MODEL_SYNC_LIMIT,this._versionId=1,this._alternativeVersionId=1,this._initialUndoRedoSnapshot=null,this._isDisposed=!1,this.__isDisposing=!1,this._instanceId=singleLetterHash(MODEL_ID$1),this._lastDecorationId=0,this._decorations=Object.create(null),this._decorationsTree=new DecorationsTrees,this._commandManager=new EditStack(this,this._undoRedoService),this._isUndoing=!1,this._isRedoing=!1,this._trimAutoWhitespaceLines=null,this._register(this._decorationProvider.onDidChange(()=>{this._onDidChangeDecorations.beginDeferredEmit(),this._onDidChangeDecorations.fire(),this._onDidChangeDecorations.endDeferredEmit()})),this._languageService.requestRichLanguageFeatures(ee)}dispose(){this.__isDisposing=!0,this._onWillDispose.fire(),this._tokenizationTextModelPart.dispose(),this._isDisposed=!0,super.dispose(),this._bufferDisposable.dispose(),this.__isDisposing=!1;const C=new PieceTreeTextBuffer([],"",`
`,!1,!1,!0,!0);C.dispose(),this._buffer=C,this._bufferDisposable=Disposable.None}_assertNotDisposed(){if(this._isDisposed)throw new Error("Model is disposed!")}_emitContentChangedEvent(C,W){this.__isDisposing||(this._tokenizationTextModelPart.handleDidChangeContent(W),this._bracketPairs.handleDidChangeContent(W),this._eventEmitter.fire(new InternalModelContentChangeEvent(C,W)))}setValue(C){if(this._assertNotDisposed(),C==null)throw illegalArgument();const{textBuffer:W,disposable:V}=createTextBuffer(C,this._options.defaultEOL);this._setValueFromTextBuffer(W,V)}_createContentChanged2(C,W,V,U,G,Z,X,Q){return{changes:[{range:C,rangeOffset:W,rangeLength:V,text:U}],eol:this._buffer.getEOL(),isEolChange:Q,versionId:this.getVersionId(),isUndoing:G,isRedoing:Z,isFlush:X}}_setValueFromTextBuffer(C,W){this._assertNotDisposed();const V=this.getFullModelRange(),U=this.getValueLengthInRange(V),G=this.getLineCount(),Z=this.getLineMaxColumn(G);this._buffer=C,this._bufferDisposable.dispose(),this._bufferDisposable=W,this._increaseVersionId(),this._decorations=Object.create(null),this._decorationsTree=new DecorationsTrees,this._commandManager.clear(),this._trimAutoWhitespaceLines=null,this._emitContentChangedEvent(new ModelRawContentChangedEvent([new ModelRawFlush],this._versionId,!1,!1),this._createContentChanged2(new Range$2(1,1,G,Z),0,U,this.getValue(),!1,!1,!0,!1))}setEOL(C){this._assertNotDisposed();const W=C===1?`\r
`:`
`;if(this._buffer.getEOL()===W)return;const V=this.getFullModelRange(),U=this.getValueLengthInRange(V),G=this.getLineCount(),Z=this.getLineMaxColumn(G);this._onBeforeEOLChange(),this._buffer.setEOL(W),this._increaseVersionId(),this._onAfterEOLChange(),this._emitContentChangedEvent(new ModelRawContentChangedEvent([new ModelRawEOLChanged],this._versionId,!1,!1),this._createContentChanged2(new Range$2(1,1,G,Z),0,U,this.getValue(),!1,!1,!1,!0))}_onBeforeEOLChange(){this._decorationsTree.ensureAllNodesHaveRanges(this)}_onAfterEOLChange(){const C=this.getVersionId(),W=this._decorationsTree.collectNodesPostOrder();for(let V=0,U=W.length;V<U;V++){const G=W[V],Z=G.range,X=G.cachedAbsoluteStart-G.start,Q=this._buffer.getOffsetAt(Z.startLineNumber,Z.startColumn),J=this._buffer.getOffsetAt(Z.endLineNumber,Z.endColumn);G.cachedAbsoluteStart=Q,G.cachedAbsoluteEnd=J,G.cachedVersionId=C,G.start=Q-X,G.end=J-X,recomputeMaxEnd(G)}}onBeforeAttached(){return this._attachedEditorCount++,this._attachedEditorCount===1&&(this._tokenizationTextModelPart.handleDidChangeAttached(),this._onDidChangeAttached.fire(void 0)),this._attachedViews.attachView()}onBeforeDetached(C){this._attachedEditorCount--,this._attachedEditorCount===0&&(this._tokenizationTextModelPart.handleDidChangeAttached(),this._onDidChangeAttached.fire(void 0)),this._attachedViews.detachView(C)}isAttachedToEditor(){return this._attachedEditorCount>0}getAttachedEditorCount(){return this._attachedEditorCount}isTooLargeForSyncing(){return this._isTooLargeForSyncing}isTooLargeForTokenization(){return this._isTooLargeForTokenization}isTooLargeForHeapOperation(){return this._isTooLargeForHeapOperation}isDisposed(){return this._isDisposed}isDominatedByLongLines(){if(this._assertNotDisposed(),this.isTooLargeForTokenization())return!1;let C=0,W=0;const V=this._buffer.getLineCount();for(let U=1;U<=V;U++){const G=this._buffer.getLineLength(U);G>=LONG_LINE_BOUNDARY?W+=G:C+=G}return W>C}get uri(){return this._associatedResource}getOptions(){return this._assertNotDisposed(),this._options}getFormattingOptions(){return{tabSize:this._options.indentSize,insertSpaces:this._options.insertSpaces}}updateOptions(C){this._assertNotDisposed();const W=typeof C.tabSize<"u"?C.tabSize:this._options.tabSize,V=typeof C.indentSize<"u"?C.indentSize:this._options.originalIndentSize,U=typeof C.insertSpaces<"u"?C.insertSpaces:this._options.insertSpaces,G=typeof C.trimAutoWhitespace<"u"?C.trimAutoWhitespace:this._options.trimAutoWhitespace,Z=typeof C.bracketColorizationOptions<"u"?C.bracketColorizationOptions:this._options.bracketPairColorizationOptions,X=new TextModelResolvedOptions({tabSize:W,indentSize:V,insertSpaces:U,defaultEOL:this._options.defaultEOL,trimAutoWhitespace:G,bracketPairColorizationOptions:Z});if(this._options.equals(X))return;const Q=this._options.createChangeEvent(X);this._options=X,this._bracketPairs.handleDidChangeOptions(Q),this._decorationProvider.handleDidChangeOptions(Q),this._onDidChangeOptions.fire(Q)}detectIndentation(C,W){this._assertNotDisposed();const V=guessIndentation(this._buffer,W,C);this.updateOptions({insertSpaces:V.insertSpaces,tabSize:V.tabSize,indentSize:V.tabSize})}normalizeIndentation(C){return this._assertNotDisposed(),normalizeIndentation(C,this._options.indentSize,this._options.insertSpaces)}getVersionId(){return this._assertNotDisposed(),this._versionId}mightContainRTL(){return this._buffer.mightContainRTL()}mightContainUnusualLineTerminators(){return this._buffer.mightContainUnusualLineTerminators()}removeUnusualLineTerminators(C=null){const W=this.findMatches(UNUSUAL_LINE_TERMINATORS.source,!1,!0,!1,null,!1,1073741824);this._buffer.resetMightContainUnusualLineTerminators(),this.pushEditOperations(C,W.map(V=>({range:V.range,text:null})),()=>null)}mightContainNonBasicASCII(){return this._buffer.mightContainNonBasicASCII()}getAlternativeVersionId(){return this._assertNotDisposed(),this._alternativeVersionId}getInitialUndoRedoSnapshot(){return this._assertNotDisposed(),this._initialUndoRedoSnapshot}getOffsetAt(C){this._assertNotDisposed();const W=this._validatePosition(C.lineNumber,C.column,0);return this._buffer.getOffsetAt(W.lineNumber,W.column)}getPositionAt(C){this._assertNotDisposed();const W=Math.min(this._buffer.getLength(),Math.max(0,C));return this._buffer.getPositionAt(W)}_increaseVersionId(){this._versionId=this._versionId+1,this._alternativeVersionId=this._versionId}_overwriteVersionId(C){this._versionId=C}_overwriteAlternativeVersionId(C){this._alternativeVersionId=C}_overwriteInitialUndoRedoSnapshot(C){this._initialUndoRedoSnapshot=C}getValue(C,W=!1){if(this._assertNotDisposed(),this.isTooLargeForHeapOperation())throw new BugIndicatingError("Operation would exceed heap memory limits");const V=this.getFullModelRange(),U=this.getValueInRange(V,C);return W?this._buffer.getBOM()+U:U}createSnapshot(C=!1){return new TextModelSnapshot(this._buffer.createSnapshot(C))}getValueLength(C,W=!1){this._assertNotDisposed();const V=this.getFullModelRange(),U=this.getValueLengthInRange(V,C);return W?this._buffer.getBOM().length+U:U}getValueInRange(C,W=0){return this._assertNotDisposed(),this._buffer.getValueInRange(this.validateRange(C),W)}getValueLengthInRange(C,W=0){return this._assertNotDisposed(),this._buffer.getValueLengthInRange(this.validateRange(C),W)}getCharacterCountInRange(C,W=0){return this._assertNotDisposed(),this._buffer.getCharacterCountInRange(this.validateRange(C),W)}getLineCount(){return this._assertNotDisposed(),this._buffer.getLineCount()}getLineContent(C){if(this._assertNotDisposed(),C<1||C>this.getLineCount())throw new BugIndicatingError("Illegal value for lineNumber");return this._buffer.getLineContent(C)}getLineLength(C){if(this._assertNotDisposed(),C<1||C>this.getLineCount())throw new BugIndicatingError("Illegal value for lineNumber");return this._buffer.getLineLength(C)}getLinesContent(){if(this._assertNotDisposed(),this.isTooLargeForHeapOperation())throw new BugIndicatingError("Operation would exceed heap memory limits");return this._buffer.getLinesContent()}getEOL(){return this._assertNotDisposed(),this._buffer.getEOL()}getEndOfLineSequence(){return this._assertNotDisposed(),this._buffer.getEOL()===`
`?0:1}getLineMinColumn(C){return this._assertNotDisposed(),1}getLineMaxColumn(C){if(this._assertNotDisposed(),C<1||C>this.getLineCount())throw new BugIndicatingError("Illegal value for lineNumber");return this._buffer.getLineLength(C)+1}getLineFirstNonWhitespaceColumn(C){if(this._assertNotDisposed(),C<1||C>this.getLineCount())throw new BugIndicatingError("Illegal value for lineNumber");return this._buffer.getLineFirstNonWhitespaceColumn(C)}getLineLastNonWhitespaceColumn(C){if(this._assertNotDisposed(),C<1||C>this.getLineCount())throw new BugIndicatingError("Illegal value for lineNumber");return this._buffer.getLineLastNonWhitespaceColumn(C)}_validateRangeRelaxedNoAllocations(C){const W=this._buffer.getLineCount(),V=C.startLineNumber,U=C.startColumn;let G=Math.floor(typeof V=="number"&&!isNaN(V)?V:1),Z=Math.floor(typeof U=="number"&&!isNaN(U)?U:1);if(G<1)G=1,Z=1;else if(G>W)G=W,Z=this.getLineMaxColumn(G);else if(Z<=1)Z=1;else{const te=this.getLineMaxColumn(G);Z>=te&&(Z=te)}const X=C.endLineNumber,Q=C.endColumn;let J=Math.floor(typeof X=="number"&&!isNaN(X)?X:1),ee=Math.floor(typeof Q=="number"&&!isNaN(Q)?Q:1);if(J<1)J=1,ee=1;else if(J>W)J=W,ee=this.getLineMaxColumn(J);else if(ee<=1)ee=1;else{const te=this.getLineMaxColumn(J);ee>=te&&(ee=te)}return V===G&&U===Z&&X===J&&Q===ee&&C instanceof Range$2&&!(C instanceof Selection$1)?C:new Range$2(G,Z,J,ee)}_isValidPosition(C,W,V){if(typeof C!="number"||typeof W!="number"||isNaN(C)||isNaN(W)||C<1||W<1||(C|0)!==C||(W|0)!==W)return!1;const U=this._buffer.getLineCount();if(C>U)return!1;if(W===1)return!0;const G=this.getLineMaxColumn(C);if(W>G)return!1;if(V===1){const Z=this._buffer.getLineCharCode(C,W-2);if(isHighSurrogate(Z))return!1}return!0}_validatePosition(C,W,V){const U=Math.floor(typeof C=="number"&&!isNaN(C)?C:1),G=Math.floor(typeof W=="number"&&!isNaN(W)?W:1),Z=this._buffer.getLineCount();if(U<1)return new Position$1(1,1);if(U>Z)return new Position$1(Z,this.getLineMaxColumn(Z));if(G<=1)return new Position$1(U,1);const X=this.getLineMaxColumn(U);if(G>=X)return new Position$1(U,X);if(V===1){const Q=this._buffer.getLineCharCode(U,G-2);if(isHighSurrogate(Q))return new Position$1(U,G-1)}return new Position$1(U,G)}validatePosition(C){return this._assertNotDisposed(),C instanceof Position$1&&this._isValidPosition(C.lineNumber,C.column,1)?C:this._validatePosition(C.lineNumber,C.column,1)}_isValidRange(C,W){const V=C.startLineNumber,U=C.startColumn,G=C.endLineNumber,Z=C.endColumn;if(!this._isValidPosition(V,U,0)||!this._isValidPosition(G,Z,0))return!1;if(W===1){const X=U>1?this._buffer.getLineCharCode(V,U-2):0,Q=Z>1&&Z<=this._buffer.getLineLength(G)?this._buffer.getLineCharCode(G,Z-2):0,J=isHighSurrogate(X),ee=isHighSurrogate(Q);return!J&&!ee}return!0}validateRange(C){if(this._assertNotDisposed(),C instanceof Range$2&&!(C instanceof Selection$1)&&this._isValidRange(C,1))return C;const V=this._validatePosition(C.startLineNumber,C.startColumn,0),U=this._validatePosition(C.endLineNumber,C.endColumn,0),G=V.lineNumber,Z=V.column,X=U.lineNumber,Q=U.column;{const J=Z>1?this._buffer.getLineCharCode(G,Z-2):0,ee=Q>1&&Q<=this._buffer.getLineLength(X)?this._buffer.getLineCharCode(X,Q-2):0,te=isHighSurrogate(J),ie=isHighSurrogate(ee);return!te&&!ie?new Range$2(G,Z,X,Q):G===X&&Z===Q?new Range$2(G,Z-1,X,Q-1):te&&ie?new Range$2(G,Z-1,X,Q+1):te?new Range$2(G,Z-1,X,Q):new Range$2(G,Z,X,Q+1)}}modifyPosition(C,W){this._assertNotDisposed();const V=this.getOffsetAt(C)+W;return this.getPositionAt(Math.min(this._buffer.getLength(),Math.max(0,V)))}getFullModelRange(){this._assertNotDisposed();const C=this.getLineCount();return new Range$2(1,1,C,this.getLineMaxColumn(C))}findMatchesLineByLine(C,W,V,U){return this._buffer.findMatchesLineByLine(C,W,V,U)}findMatches(C,W,V,U,G,Z,X=LIMIT_FIND_COUNT){this._assertNotDisposed();let Q=null;W!==null&&(Array.isArray(W)||(W=[W]),W.every(te=>Range$2.isIRange(te))&&(Q=W.map(te=>this.validateRange(te)))),Q===null&&(Q=[this.getFullModelRange()]),Q=Q.sort((te,ie)=>te.startLineNumber-ie.startLineNumber||te.startColumn-ie.startColumn);const J=[];J.push(Q.reduce((te,ie)=>Range$2.areIntersecting(te,ie)?te.plusRange(ie):(J.push(te),ie)));let ee;if(!V&&C.indexOf(`
`)<0){const ie=new SearchParams(C,V,U,G).parseSearchRequest();if(!ie)return[];ee=ne=>this.findMatchesLineByLine(ne,ie,Z,X)}else ee=te=>TextModelSearch.findMatches(this,new SearchParams(C,V,U,G),te,Z,X);return J.map(ee).reduce((te,ie)=>te.concat(ie),[])}findNextMatch(C,W,V,U,G,Z){this._assertNotDisposed();const X=this.validatePosition(W);if(!V&&C.indexOf(`
`)<0){const J=new SearchParams(C,V,U,G).parseSearchRequest();if(!J)return null;const ee=this.getLineCount();let te=new Range$2(X.lineNumber,X.column,ee,this.getLineMaxColumn(ee)),ie=this.findMatchesLineByLine(te,J,Z,1);return TextModelSearch.findNextMatch(this,new SearchParams(C,V,U,G),X,Z),ie.length>0||(te=new Range$2(1,1,X.lineNumber,this.getLineMaxColumn(X.lineNumber)),ie=this.findMatchesLineByLine(te,J,Z,1),ie.length>0)?ie[0]:null}return TextModelSearch.findNextMatch(this,new SearchParams(C,V,U,G),X,Z)}findPreviousMatch(C,W,V,U,G,Z){this._assertNotDisposed();const X=this.validatePosition(W);return TextModelSearch.findPreviousMatch(this,new SearchParams(C,V,U,G),X,Z)}pushStackElement(){this._commandManager.pushStackElement()}popStackElement(){this._commandManager.popStackElement()}pushEOL(C){if((this.getEOL()===`
`?0:1)!==C)try{this._onDidChangeDecorations.beginDeferredEmit(),this._eventEmitter.beginDeferredEmit(),this._initialUndoRedoSnapshot===null&&(this._initialUndoRedoSnapshot=this._undoRedoService.createSnapshot(this.uri)),this._commandManager.pushEOL(C)}finally{this._eventEmitter.endDeferredEmit(),this._onDidChangeDecorations.endDeferredEmit()}}_validateEditOperation(C){return C instanceof ValidAnnotatedEditOperation?C:new ValidAnnotatedEditOperation(C.identifier||null,this.validateRange(C.range),C.text,C.forceMoveMarkers||!1,C.isAutoWhitespaceEdit||!1,C._isTracked||!1)}_validateEditOperations(C){const W=[];for(let V=0,U=C.length;V<U;V++)W[V]=this._validateEditOperation(C[V]);return W}pushEditOperations(C,W,V,U){try{return this._onDidChangeDecorations.beginDeferredEmit(),this._eventEmitter.beginDeferredEmit(),this._pushEditOperations(C,this._validateEditOperations(W),V,U)}finally{this._eventEmitter.endDeferredEmit(),this._onDidChangeDecorations.endDeferredEmit()}}_pushEditOperations(C,W,V,U){if(this._options.trimAutoWhitespace&&this._trimAutoWhitespaceLines){const G=W.map(X=>({range:this.validateRange(X.range),text:X.text}));let Z=!0;if(C)for(let X=0,Q=C.length;X<Q;X++){const J=C[X];let ee=!1;for(let te=0,ie=G.length;te<ie;te++){const ne=G[te].range,oe=ne.startLineNumber>J.endLineNumber,re=J.startLineNumber>ne.endLineNumber;if(!oe&&!re){ee=!0;break}}if(!ee){Z=!1;break}}if(Z)for(let X=0,Q=this._trimAutoWhitespaceLines.length;X<Q;X++){const J=this._trimAutoWhitespaceLines[X],ee=this.getLineMaxColumn(J);let te=!0;for(let ie=0,ne=G.length;ie<ne;ie++){const oe=G[ie].range,re=G[ie].text;if(!(J<oe.startLineNumber||J>oe.endLineNumber)&&!(J===oe.startLineNumber&&oe.startColumn===ee&&oe.isEmpty()&&re&&re.length>0&&re.charAt(0)===`
`)&&!(J===oe.startLineNumber&&oe.startColumn===1&&oe.isEmpty()&&re&&re.length>0&&re.charAt(re.length-1)===`
`)){te=!1;break}}if(te){const ie=new Range$2(J,1,J,ee);W.push(new ValidAnnotatedEditOperation(null,ie,null,!1,!1,!1))}}this._trimAutoWhitespaceLines=null}return this._initialUndoRedoSnapshot===null&&(this._initialUndoRedoSnapshot=this._undoRedoService.createSnapshot(this.uri)),this._commandManager.pushEditOperation(C,W,V,U)}_applyUndo(C,W,V,U){const G=C.map(Z=>{const X=this.getPositionAt(Z.newPosition),Q=this.getPositionAt(Z.newEnd);return{range:new Range$2(X.lineNumber,X.column,Q.lineNumber,Q.column),text:Z.oldText}});this._applyUndoRedoEdits(G,W,!0,!1,V,U)}_applyRedo(C,W,V,U){const G=C.map(Z=>{const X=this.getPositionAt(Z.oldPosition),Q=this.getPositionAt(Z.oldEnd);return{range:new Range$2(X.lineNumber,X.column,Q.lineNumber,Q.column),text:Z.newText}});this._applyUndoRedoEdits(G,W,!1,!0,V,U)}_applyUndoRedoEdits(C,W,V,U,G,Z){try{this._onDidChangeDecorations.beginDeferredEmit(),this._eventEmitter.beginDeferredEmit(),this._isUndoing=V,this._isRedoing=U,this.applyEdits(C,!1),this.setEOL(W),this._overwriteAlternativeVersionId(G)}finally{this._isUndoing=!1,this._isRedoing=!1,this._eventEmitter.endDeferredEmit(Z),this._onDidChangeDecorations.endDeferredEmit()}}applyEdits(C,W=!1){try{this._onDidChangeDecorations.beginDeferredEmit(),this._eventEmitter.beginDeferredEmit();const V=this._validateEditOperations(C);return this._doApplyEdits(V,W)}finally{this._eventEmitter.endDeferredEmit(),this._onDidChangeDecorations.endDeferredEmit()}}_doApplyEdits(C,W){const V=this._buffer.getLineCount(),U=this._buffer.applyEdits(C,this._options.trimAutoWhitespace,W),G=this._buffer.getLineCount(),Z=U.changes;if(this._trimAutoWhitespaceLines=U.trimAutoWhitespaceLineNumbers,Z.length!==0){for(let J=0,ee=Z.length;J<ee;J++){const te=Z[J];this._decorationsTree.acceptReplace(te.rangeOffset,te.rangeLength,te.text.length,te.forceMoveMarkers)}const X=[];this._increaseVersionId();let Q=V;for(let J=0,ee=Z.length;J<ee;J++){const te=Z[J],[ie]=countEOL(te.text);this._onDidChangeDecorations.fire();const ne=te.range.startLineNumber,oe=te.range.endLineNumber,re=oe-ne,ae=ie,se=Math.min(re,ae),le=ae-re,ce=G-Q-le+ne,de=ce,ue=ce+ae,ge=this._decorationsTree.getInjectedTextInInterval(this,this.getOffsetAt(new Position$1(de,1)),this.getOffsetAt(new Position$1(ue,this.getLineMaxColumn(ue))),0),he=LineInjectedText.fromDecorations(ge),fe=new ArrayQueue(he);for(let pe=se;pe>=0;pe--){const Se=ne+pe,Le=ce+pe;fe.takeFromEndWhile(Ce=>Ce.lineNumber>Le);const be=fe.takeFromEndWhile(Ce=>Ce.lineNumber===Le);X.push(new ModelRawLineChanged(Se,this.getLineContent(Le),be))}if(se<re){const pe=ne+se;X.push(new ModelRawLinesDeleted(pe+1,oe))}if(se<ae){const pe=new ArrayQueue(he),Se=ne+se,Le=ae-se,be=G-Q-Le+Se+1,Ce=[],De=[];for(let ke=0;ke<Le;ke++){const Me=be+ke;De[ke]=this.getLineContent(Me),pe.takeWhile(Oe=>Oe.lineNumber<Me),Ce[ke]=pe.takeWhile(Oe=>Oe.lineNumber===Me)}X.push(new ModelRawLinesInserted(Se+1,ne+ae,De,Ce))}Q+=le}this._emitContentChangedEvent(new ModelRawContentChangedEvent(X,this.getVersionId(),this._isUndoing,this._isRedoing),{changes:Z,eol:this._buffer.getEOL(),isEolChange:!1,versionId:this.getVersionId(),isUndoing:this._isUndoing,isRedoing:this._isRedoing,isFlush:!1})}return U.reverseEdits===null?void 0:U.reverseEdits}undo(){return this._undoRedoService.undo(this.uri)}canUndo(){return this._undoRedoService.canUndo(this.uri)}redo(){return this._undoRedoService.redo(this.uri)}canRedo(){return this._undoRedoService.canRedo(this.uri)}handleBeforeFireDecorationsChangedEvent(C){if(C===null||C.size===0)return;const V=Array.from(C).map(U=>new ModelRawLineChanged(U,this.getLineContent(U),this._getInjectedTextInLine(U)));this._onDidChangeInjectedText.fire(new ModelInjectedTextChangedEvent(V))}changeDecorations(C,W=0){this._assertNotDisposed();try{return this._onDidChangeDecorations.beginDeferredEmit(),this._changeDecorations(W,C)}finally{this._onDidChangeDecorations.endDeferredEmit()}}_changeDecorations(C,W){const V={addDecoration:(G,Z)=>this._deltaDecorationsImpl(C,[],[{range:G,options:Z}])[0],changeDecoration:(G,Z)=>{this._changeDecorationImpl(G,Z)},changeDecorationOptions:(G,Z)=>{this._changeDecorationOptionsImpl(G,_normalizeOptions(Z))},removeDecoration:G=>{this._deltaDecorationsImpl(C,[G],[])},deltaDecorations:(G,Z)=>G.length===0&&Z.length===0?[]:this._deltaDecorationsImpl(C,G,Z)};let U=null;try{U=W(V)}catch(G){onUnexpectedError(G)}return V.addDecoration=invalidFunc,V.changeDecoration=invalidFunc,V.changeDecorationOptions=invalidFunc,V.removeDecoration=invalidFunc,V.deltaDecorations=invalidFunc,U}deltaDecorations(C,W,V=0){if(this._assertNotDisposed(),C||(C=[]),C.length===0&&W.length===0)return[];try{return this._deltaDecorationCallCnt++,this._deltaDecorationCallCnt>1&&(console.warn("Invoking deltaDecorations recursively could lead to leaking decorations."),onUnexpectedError(new Error("Invoking deltaDecorations recursively could lead to leaking decorations."))),this._onDidChangeDecorations.beginDeferredEmit(),this._deltaDecorationsImpl(V,C,W)}finally{this._onDidChangeDecorations.endDeferredEmit(),this._deltaDecorationCallCnt--}}_getTrackedRange(C){return this.getDecorationRange(C)}_setTrackedRange(C,W,V){const U=C?this._decorations[C]:null;if(!U)return W?this._deltaDecorationsImpl(0,[],[{range:W,options:TRACKED_RANGE_OPTIONS[V]}],!0)[0]:null;if(!W)return this._decorationsTree.delete(U),delete this._decorations[U.id],null;const G=this._validateRangeRelaxedNoAllocations(W),Z=this._buffer.getOffsetAt(G.startLineNumber,G.startColumn),X=this._buffer.getOffsetAt(G.endLineNumber,G.endColumn);return this._decorationsTree.delete(U),U.reset(this.getVersionId(),Z,X,G),U.setOptions(TRACKED_RANGE_OPTIONS[V]),this._decorationsTree.insert(U),U.id}removeAllDecorationsWithOwnerId(C){if(this._isDisposed)return;const W=this._decorationsTree.collectNodesFromOwner(C);for(let V=0,U=W.length;V<U;V++){const G=W[V];this._decorationsTree.delete(G),delete this._decorations[G.id]}}getDecorationOptions(C){const W=this._decorations[C];return W?W.options:null}getDecorationRange(C){const W=this._decorations[C];return W?this._decorationsTree.getNodeRange(this,W):null}getLineDecorations(C,W=0,V=!1){return C<1||C>this.getLineCount()?[]:this.getLinesDecorations(C,C,W,V)}getLinesDecorations(C,W,V=0,U=!1,G=!1){const Z=this.getLineCount(),X=Math.min(Z,Math.max(1,C)),Q=Math.min(Z,Math.max(1,W)),J=this.getLineMaxColumn(Q),ee=new Range$2(X,1,Q,J),te=this._getDecorationsInRange(ee,V,U,G);return pushMany(te,this._decorationProvider.getDecorationsInRange(ee,V,U)),te}getDecorationsInRange(C,W=0,V=!1,U=!1,G=!1){const Z=this.validateRange(C),X=this._getDecorationsInRange(Z,W,V,G);return pushMany(X,this._decorationProvider.getDecorationsInRange(Z,W,V,U)),X}getOverviewRulerDecorations(C=0,W=!1){return this._decorationsTree.getAll(this,C,W,!0,!1)}getInjectedTextDecorations(C=0){return this._decorationsTree.getAllInjectedText(this,C)}_getInjectedTextInLine(C){const W=this._buffer.getOffsetAt(C,1),V=W+this._buffer.getLineLength(C),U=this._decorationsTree.getInjectedTextInInterval(this,W,V,0);return LineInjectedText.fromDecorations(U).filter(G=>G.lineNumber===C)}getAllDecorations(C=0,W=!1){let V=this._decorationsTree.getAll(this,C,W,!1,!1);return V=V.concat(this._decorationProvider.getAllDecorations(C,W)),V}getAllMarginDecorations(C=0){return this._decorationsTree.getAll(this,C,!1,!1,!0)}_getDecorationsInRange(C,W,V,U){const G=this._buffer.getOffsetAt(C.startLineNumber,C.startColumn),Z=this._buffer.getOffsetAt(C.endLineNumber,C.endColumn);return this._decorationsTree.getAllInInterval(this,G,Z,W,V,U)}getRangeAt(C,W){return this._buffer.getRangeAt(C,W-C)}_changeDecorationImpl(C,W){const V=this._decorations[C];if(!V)return;if(V.options.after){const X=this.getDecorationRange(C);this._onDidChangeDecorations.recordLineAffectedByInjectedText(X.endLineNumber)}if(V.options.before){const X=this.getDecorationRange(C);this._onDidChangeDecorations.recordLineAffectedByInjectedText(X.startLineNumber)}const U=this._validateRangeRelaxedNoAllocations(W),G=this._buffer.getOffsetAt(U.startLineNumber,U.startColumn),Z=this._buffer.getOffsetAt(U.endLineNumber,U.endColumn);this._decorationsTree.delete(V),V.reset(this.getVersionId(),G,Z,U),this._decorationsTree.insert(V),this._onDidChangeDecorations.checkAffectedAndFire(V.options),V.options.after&&this._onDidChangeDecorations.recordLineAffectedByInjectedText(U.endLineNumber),V.options.before&&this._onDidChangeDecorations.recordLineAffectedByInjectedText(U.startLineNumber)}_changeDecorationOptionsImpl(C,W){const V=this._decorations[C];if(!V)return;const U=!!(V.options.overviewRuler&&V.options.overviewRuler.color),G=!!(W.overviewRuler&&W.overviewRuler.color);if(this._onDidChangeDecorations.checkAffectedAndFire(V.options),this._onDidChangeDecorations.checkAffectedAndFire(W),V.options.after||W.after){const Z=this._decorationsTree.getNodeRange(this,V);this._onDidChangeDecorations.recordLineAffectedByInjectedText(Z.endLineNumber)}if(V.options.before||W.before){const Z=this._decorationsTree.getNodeRange(this,V);this._onDidChangeDecorations.recordLineAffectedByInjectedText(Z.startLineNumber)}U!==G?(this._decorationsTree.delete(V),V.setOptions(W),this._decorationsTree.insert(V)):V.setOptions(W)}_deltaDecorationsImpl(C,W,V,U=!1){const G=this.getVersionId(),Z=W.length;let X=0;const Q=V.length;let J=0;this._onDidChangeDecorations.beginDeferredEmit();try{const ee=new Array(Q);for(;X<Z||J<Q;){let te=null;if(X<Z){do te=this._decorations[W[X++]];while(!te&&X<Z);if(te){if(te.options.after){const ie=this._decorationsTree.getNodeRange(this,te);this._onDidChangeDecorations.recordLineAffectedByInjectedText(ie.endLineNumber)}if(te.options.before){const ie=this._decorationsTree.getNodeRange(this,te);this._onDidChangeDecorations.recordLineAffectedByInjectedText(ie.startLineNumber)}this._decorationsTree.delete(te),U||this._onDidChangeDecorations.checkAffectedAndFire(te.options)}}if(J<Q){if(!te){const se=++this._lastDecorationId,le=`${this._instanceId};${se}`;te=new IntervalNode(le,0,0),this._decorations[le]=te}const ie=V[J],ne=this._validateRangeRelaxedNoAllocations(ie.range),oe=_normalizeOptions(ie.options),re=this._buffer.getOffsetAt(ne.startLineNumber,ne.startColumn),ae=this._buffer.getOffsetAt(ne.endLineNumber,ne.endColumn);te.ownerId=C,te.reset(G,re,ae,ne),te.setOptions(oe),te.options.after&&this._onDidChangeDecorations.recordLineAffectedByInjectedText(ne.endLineNumber),te.options.before&&this._onDidChangeDecorations.recordLineAffectedByInjectedText(ne.startLineNumber),U||this._onDidChangeDecorations.checkAffectedAndFire(oe),this._decorationsTree.insert(te),ee[J]=te.id,J++}else te&&delete this._decorations[te.id]}return ee}finally{this._onDidChangeDecorations.endDeferredEmit()}}getLanguageId(){return this.tokenization.getLanguageId()}setLanguage(C,W){typeof C=="string"?(this._languageSelectionListener.clear(),this._setLanguage(C,W)):(this._languageSelectionListener.value=C.onDidChange(()=>this._setLanguage(C.languageId,W)),this._setLanguage(C.languageId,W))}_setLanguage(C,W){this.tokenization.setLanguageId(C,W),this._languageService.requestRichLanguageFeatures(C)}getLanguageIdAtPosition(C,W){return this.tokenization.getLanguageIdAtPosition(C,W)}getWordAtPosition(C){return this._tokenizationTextModelPart.getWordAtPosition(C)}getWordUntilPosition(C){return this._tokenizationTextModelPart.getWordUntilPosition(C)}normalizePosition(C,W){return C}getLineIndentColumn(C){return indentOfLine(this.getLineContent(C))+1}};TextModel._MODEL_SYNC_LIMIT=50*1024*1024;TextModel.LARGE_FILE_SIZE_THRESHOLD=20*1024*1024;TextModel.LARGE_FILE_LINE_COUNT_THRESHOLD=300*1e3;TextModel.LARGE_FILE_HEAP_OPERATION_THRESHOLD=256*1024*1024;TextModel.DEFAULT_CREATION_OPTIONS={isForSimpleWidget:!1,tabSize:EDITOR_MODEL_DEFAULTS.tabSize,indentSize:EDITOR_MODEL_DEFAULTS.indentSize,insertSpaces:EDITOR_MODEL_DEFAULTS.insertSpaces,detectIndentation:!1,defaultEOL:1,trimAutoWhitespace:EDITOR_MODEL_DEFAULTS.trimAutoWhitespace,largeFileOptimizations:EDITOR_MODEL_DEFAULTS.largeFileOptimizations,bracketPairColorizationOptions:EDITOR_MODEL_DEFAULTS.bracketPairColorizationOptions};TextModel=TextModel_1=__decorate$21([__param$1X(4,IUndoRedoService),__param$1X(5,ILanguageService),__param$1X(6,ILanguageConfigurationService)],TextModel);function indentOfLine(K){let C=0;for(const W of K)if(W===" "||W==="	")C++;else break;return C}function isNodeInOverviewRuler(K){return!!(K.options.overviewRuler&&K.options.overviewRuler.color)}function isNodeInjectedText(K){return!!K.options.after||!!K.options.before}class DecorationsTrees{constructor(){this._decorationsTree0=new IntervalTree,this._decorationsTree1=new IntervalTree,this._injectedTextDecorationsTree=new IntervalTree}ensureAllNodesHaveRanges(C){this.getAll(C,0,!1,!1,!1)}_ensureNodesHaveRanges(C,W){for(const V of W)V.range===null&&(V.range=C.getRangeAt(V.cachedAbsoluteStart,V.cachedAbsoluteEnd));return W}getAllInInterval(C,W,V,U,G,Z){const X=C.getVersionId(),Q=this._intervalSearch(W,V,U,G,X,Z);return this._ensureNodesHaveRanges(C,Q)}_intervalSearch(C,W,V,U,G,Z){const X=this._decorationsTree0.intervalSearch(C,W,V,U,G,Z),Q=this._decorationsTree1.intervalSearch(C,W,V,U,G,Z),J=this._injectedTextDecorationsTree.intervalSearch(C,W,V,U,G,Z);return X.concat(Q).concat(J)}getInjectedTextInInterval(C,W,V,U){const G=C.getVersionId(),Z=this._injectedTextDecorationsTree.intervalSearch(W,V,U,!1,G,!1);return this._ensureNodesHaveRanges(C,Z).filter(X=>X.options.showIfCollapsed||!X.range.isEmpty())}getAllInjectedText(C,W){const V=C.getVersionId(),U=this._injectedTextDecorationsTree.search(W,!1,V,!1);return this._ensureNodesHaveRanges(C,U).filter(G=>G.options.showIfCollapsed||!G.range.isEmpty())}getAll(C,W,V,U,G){const Z=C.getVersionId(),X=this._search(W,V,U,Z,G);return this._ensureNodesHaveRanges(C,X)}_search(C,W,V,U,G){if(V)return this._decorationsTree1.search(C,W,U,G);{const Z=this._decorationsTree0.search(C,W,U,G),X=this._decorationsTree1.search(C,W,U,G),Q=this._injectedTextDecorationsTree.search(C,W,U,G);return Z.concat(X).concat(Q)}}collectNodesFromOwner(C){const W=this._decorationsTree0.collectNodesFromOwner(C),V=this._decorationsTree1.collectNodesFromOwner(C),U=this._injectedTextDecorationsTree.collectNodesFromOwner(C);return W.concat(V).concat(U)}collectNodesPostOrder(){const C=this._decorationsTree0.collectNodesPostOrder(),W=this._decorationsTree1.collectNodesPostOrder(),V=this._injectedTextDecorationsTree.collectNodesPostOrder();return C.concat(W).concat(V)}insert(C){isNodeInjectedText(C)?this._injectedTextDecorationsTree.insert(C):isNodeInOverviewRuler(C)?this._decorationsTree1.insert(C):this._decorationsTree0.insert(C)}delete(C){isNodeInjectedText(C)?this._injectedTextDecorationsTree.delete(C):isNodeInOverviewRuler(C)?this._decorationsTree1.delete(C):this._decorationsTree0.delete(C)}getNodeRange(C,W){const V=C.getVersionId();return W.cachedVersionId!==V&&this._resolveNode(W,V),W.range===null&&(W.range=C.getRangeAt(W.cachedAbsoluteStart,W.cachedAbsoluteEnd)),W.range}_resolveNode(C,W){isNodeInjectedText(C)?this._injectedTextDecorationsTree.resolveNode(C,W):isNodeInOverviewRuler(C)?this._decorationsTree1.resolveNode(C,W):this._decorationsTree0.resolveNode(C,W)}acceptReplace(C,W,V,U){this._decorationsTree0.acceptReplace(C,W,V,U),this._decorationsTree1.acceptReplace(C,W,V,U),this._injectedTextDecorationsTree.acceptReplace(C,W,V,U)}}function cleanClassName(K){return K.replace(/[^a-z0-9\-_]/gi," ")}class DecorationOptions{constructor(C){this.color=C.color||"",this.darkColor=C.darkColor||""}}class ModelDecorationOverviewRulerOptions extends DecorationOptions{constructor(C){super(C),this._resolvedColor=null,this.position=typeof C.position=="number"?C.position:OverviewRulerLane.Center}getColor(C){return this._resolvedColor||(C.type!=="light"&&this.darkColor?this._resolvedColor=this._resolveColor(this.darkColor,C):this._resolvedColor=this._resolveColor(this.color,C)),this._resolvedColor}invalidateCachedColor(){this._resolvedColor=null}_resolveColor(C,W){if(typeof C=="string")return C;const V=C?W.getColor(C.id):null;return V?V.toString():""}}class ModelDecorationGlyphMarginOptions{constructor(C){var W;this.position=(W=C==null?void 0:C.position)!==null&&W!==void 0?W:GlyphMarginLane.Left}}class ModelDecorationMinimapOptions extends DecorationOptions{constructor(C){super(C),this.position=C.position}getColor(C){return this._resolvedColor||(C.type!=="light"&&this.darkColor?this._resolvedColor=this._resolveColor(this.darkColor,C):this._resolvedColor=this._resolveColor(this.color,C)),this._resolvedColor}invalidateCachedColor(){this._resolvedColor=void 0}_resolveColor(C,W){return typeof C=="string"?Color.fromHex(C):W.getColor(C.id)}}class ModelDecorationInjectedTextOptions{static from(C){return C instanceof ModelDecorationInjectedTextOptions?C:new ModelDecorationInjectedTextOptions(C)}constructor(C){this.content=C.content||"",this.inlineClassName=C.inlineClassName||null,this.inlineClassNameAffectsLetterSpacing=C.inlineClassNameAffectsLetterSpacing||!1,this.attachedData=C.attachedData||null,this.cursorStops=C.cursorStops||null}}class ModelDecorationOptions{static register(C){return new ModelDecorationOptions(C)}static createDynamic(C){return new ModelDecorationOptions(C)}constructor(C){var W,V,U,G,Z,X;this.description=C.description,this.blockClassName=C.blockClassName?cleanClassName(C.blockClassName):null,this.blockDoesNotCollapse=(W=C.blockDoesNotCollapse)!==null&&W!==void 0?W:null,this.blockIsAfterEnd=(V=C.blockIsAfterEnd)!==null&&V!==void 0?V:null,this.blockPadding=(U=C.blockPadding)!==null&&U!==void 0?U:null,this.stickiness=C.stickiness||0,this.zIndex=C.zIndex||0,this.className=C.className?cleanClassName(C.className):null,this.shouldFillLineOnLineBreak=(G=C.shouldFillLineOnLineBreak)!==null&&G!==void 0?G:null,this.hoverMessage=C.hoverMessage||null,this.glyphMarginHoverMessage=C.glyphMarginHoverMessage||null,this.isWholeLine=C.isWholeLine||!1,this.showIfCollapsed=C.showIfCollapsed||!1,this.collapseOnReplaceEdit=C.collapseOnReplaceEdit||!1,this.overviewRuler=C.overviewRuler?new ModelDecorationOverviewRulerOptions(C.overviewRuler):null,this.minimap=C.minimap?new ModelDecorationMinimapOptions(C.minimap):null,this.glyphMargin=C.glyphMarginClassName?new ModelDecorationGlyphMarginOptions(C.glyphMargin):null,this.glyphMarginClassName=C.glyphMarginClassName?cleanClassName(C.glyphMarginClassName):null,this.linesDecorationsClassName=C.linesDecorationsClassName?cleanClassName(C.linesDecorationsClassName):null,this.firstLineDecorationClassName=C.firstLineDecorationClassName?cleanClassName(C.firstLineDecorationClassName):null,this.marginClassName=C.marginClassName?cleanClassName(C.marginClassName):null,this.inlineClassName=C.inlineClassName?cleanClassName(C.inlineClassName):null,this.inlineClassNameAffectsLetterSpacing=C.inlineClassNameAffectsLetterSpacing||!1,this.beforeContentClassName=C.beforeContentClassName?cleanClassName(C.beforeContentClassName):null,this.afterContentClassName=C.afterContentClassName?cleanClassName(C.afterContentClassName):null,this.after=C.after?ModelDecorationInjectedTextOptions.from(C.after):null,this.before=C.before?ModelDecorationInjectedTextOptions.from(C.before):null,this.hideInCommentTokens=(Z=C.hideInCommentTokens)!==null&&Z!==void 0?Z:!1,this.hideInStringTokens=(X=C.hideInStringTokens)!==null&&X!==void 0?X:!1}}ModelDecorationOptions.EMPTY=ModelDecorationOptions.register({description:"empty"});const TRACKED_RANGE_OPTIONS=[ModelDecorationOptions.register({description:"tracked-range-always-grows-when-typing-at-edges",stickiness:0}),ModelDecorationOptions.register({description:"tracked-range-never-grows-when-typing-at-edges",stickiness:1}),ModelDecorationOptions.register({description:"tracked-range-grows-only-when-typing-before",stickiness:2}),ModelDecorationOptions.register({description:"tracked-range-grows-only-when-typing-after",stickiness:3})];function _normalizeOptions(K){return K instanceof ModelDecorationOptions?K:ModelDecorationOptions.createDynamic(K)}class DidChangeDecorationsEmitter extends Disposable{constructor(C){super(),this.handleBeforeFire=C,this._actual=this._register(new Emitter$1),this.event=this._actual.event,this._affectedInjectedTextLines=null,this._deferredCnt=0,this._shouldFireDeferred=!1,this._affectsMinimap=!1,this._affectsOverviewRuler=!1,this._affectsGlyphMargin=!1}beginDeferredEmit(){this._deferredCnt++}endDeferredEmit(){var C;this._deferredCnt--,this._deferredCnt===0&&(this._shouldFireDeferred&&this.doFire(),(C=this._affectedInjectedTextLines)===null||C===void 0||C.clear(),this._affectedInjectedTextLines=null)}recordLineAffectedByInjectedText(C){this._affectedInjectedTextLines||(this._affectedInjectedTextLines=new Set),this._affectedInjectedTextLines.add(C)}checkAffectedAndFire(C){this._affectsMinimap||(this._affectsMinimap=!!(C.minimap&&C.minimap.position)),this._affectsOverviewRuler||(this._affectsOverviewRuler=!!(C.overviewRuler&&C.overviewRuler.color)),this._affectsGlyphMargin||(this._affectsGlyphMargin=!!C.glyphMarginClassName),this.tryFire()}fire(){this._affectsMinimap=!0,this._affectsOverviewRuler=!0,this._affectsGlyphMargin=!0,this.tryFire()}tryFire(){this._deferredCnt===0?this.doFire():this._shouldFireDeferred=!0}doFire(){this.handleBeforeFire(this._affectedInjectedTextLines);const C={affectsMinimap:this._affectsMinimap,affectsOverviewRuler:this._affectsOverviewRuler,affectsGlyphMargin:this._affectsGlyphMargin};this._shouldFireDeferred=!1,this._affectsMinimap=!1,this._affectsOverviewRuler=!1,this._affectsGlyphMargin=!1,this._actual.fire(C)}}class DidChangeContentEmitter extends Disposable{constructor(){super(),this._fastEmitter=this._register(new Emitter$1),this.fastEvent=this._fastEmitter.event,this._slowEmitter=this._register(new Emitter$1),this.slowEvent=this._slowEmitter.event,this._deferredCnt=0,this._deferredEvent=null}beginDeferredEmit(){this._deferredCnt++}endDeferredEmit(C=null){if(this._deferredCnt--,this._deferredCnt===0&&this._deferredEvent!==null){this._deferredEvent.rawContentChangedEvent.resultingSelection=C;const W=this._deferredEvent;this._deferredEvent=null,this._fastEmitter.fire(W),this._slowEmitter.fire(W)}}fire(C){if(this._deferredCnt>0){this._deferredEvent?this._deferredEvent=this._deferredEvent.merge(C):this._deferredEvent=C;return}this._fastEmitter.fire(C),this._slowEmitter.fire(C)}}class AttachedViews{constructor(){this._onDidChangeVisibleRanges=new Emitter$1,this.onDidChangeVisibleRanges=this._onDidChangeVisibleRanges.event,this._views=new Set}attachView(){const C=new AttachedViewImpl(W=>{this._onDidChangeVisibleRanges.fire({view:C,state:W})});return this._views.add(C),C}detachView(C){this._views.delete(C),this._onDidChangeVisibleRanges.fire({view:C,state:void 0})}}class AttachedViewImpl{constructor(C){this.handleStateChange=C}setVisibleLines(C,W){const V=C.map(U=>new LineRange$1(U.startLineNumber,U.endLineNumber+1));this.handleStateChange({visibleLineRanges:V,stabilized:W})}}class Cursor{constructor(C){this._selTrackedRange=null,this._trackSelection=!0,this._setState(C,new SingleCursorState(new Range$2(1,1,1,1),0,0,new Position$1(1,1),0),new SingleCursorState(new Range$2(1,1,1,1),0,0,new Position$1(1,1),0))}dispose(C){this._removeTrackedRange(C)}startTrackingSelection(C){this._trackSelection=!0,this._updateTrackedRange(C)}stopTrackingSelection(C){this._trackSelection=!1,this._removeTrackedRange(C)}_updateTrackedRange(C){this._trackSelection&&(this._selTrackedRange=C.model._setTrackedRange(this._selTrackedRange,this.modelState.selection,0))}_removeTrackedRange(C){this._selTrackedRange=C.model._setTrackedRange(this._selTrackedRange,null,0)}asCursorState(){return new CursorState$1(this.modelState,this.viewState)}readSelectionFromMarkers(C){const W=C.model._getTrackedRange(this._selTrackedRange);return this.modelState.selection.isEmpty()&&!W.isEmpty()?Selection$1.fromRange(W.collapseToEnd(),this.modelState.selection.getDirection()):Selection$1.fromRange(W,this.modelState.selection.getDirection())}ensureValidState(C){this._setState(C,this.modelState,this.viewState)}setState(C,W,V){this._setState(C,W,V)}static _validatePositionWithCache(C,W,V,U){return W.equals(V)?U:C.normalizePosition(W,2)}static _validateViewState(C,W){const V=W.position,U=W.selectionStart.getStartPosition(),G=W.selectionStart.getEndPosition(),Z=C.normalizePosition(V,2),X=this._validatePositionWithCache(C,U,V,Z),Q=this._validatePositionWithCache(C,G,U,X);return V.equals(Z)&&U.equals(X)&&G.equals(Q)?W:new SingleCursorState(Range$2.fromPositions(X,Q),W.selectionStartKind,W.selectionStartLeftoverVisibleColumns+U.column-X.column,Z,W.leftoverVisibleColumns+V.column-Z.column)}_setState(C,W,V){if(V&&(V=Cursor._validateViewState(C.viewModel,V)),W){const U=C.model.validateRange(W.selectionStart),G=W.selectionStart.equalsRange(U)?W.selectionStartLeftoverVisibleColumns:0,Z=C.model.validatePosition(W.position),X=W.position.equals(Z)?W.leftoverVisibleColumns:0;W=new SingleCursorState(U,W.selectionStartKind,G,Z,X)}else{if(!V)return;const U=C.model.validateRange(C.coordinatesConverter.convertViewRangeToModelRange(V.selectionStart)),G=C.model.validatePosition(C.coordinatesConverter.convertViewPositionToModelPosition(V.position));W=new SingleCursorState(U,V.selectionStartKind,V.selectionStartLeftoverVisibleColumns,G,V.leftoverVisibleColumns)}if(V){const U=C.coordinatesConverter.validateViewRange(V.selectionStart,W.selectionStart),G=C.coordinatesConverter.validateViewPosition(V.position,W.position);V=new SingleCursorState(U,W.selectionStartKind,W.selectionStartLeftoverVisibleColumns,G,W.leftoverVisibleColumns)}else{const U=C.coordinatesConverter.convertModelPositionToViewPosition(new Position$1(W.selectionStart.startLineNumber,W.selectionStart.startColumn)),G=C.coordinatesConverter.convertModelPositionToViewPosition(new Position$1(W.selectionStart.endLineNumber,W.selectionStart.endColumn)),Z=new Range$2(U.lineNumber,U.column,G.lineNumber,G.column),X=C.coordinatesConverter.convertModelPositionToViewPosition(W.position);V=new SingleCursorState(Z,W.selectionStartKind,W.selectionStartLeftoverVisibleColumns,X,W.leftoverVisibleColumns)}this.modelState=W,this.viewState=V,this._updateTrackedRange(C)}}class CursorCollection{constructor(C){this.context=C,this.cursors=[new Cursor(C)],this.lastAddedCursorIndex=0}dispose(){for(const C of this.cursors)C.dispose(this.context)}startTrackingSelections(){for(const C of this.cursors)C.startTrackingSelection(this.context)}stopTrackingSelections(){for(const C of this.cursors)C.stopTrackingSelection(this.context)}updateContext(C){this.context=C}ensureValidState(){for(const C of this.cursors)C.ensureValidState(this.context)}readSelectionFromMarkers(){return this.cursors.map(C=>C.readSelectionFromMarkers(this.context))}getAll(){return this.cursors.map(C=>C.asCursorState())}getViewPositions(){return this.cursors.map(C=>C.viewState.position)}getTopMostViewPosition(){return findFirstMinBy(this.cursors,compareBy(C=>C.viewState.position,Position$1.compare)).viewState.position}getBottomMostViewPosition(){return findLastMaxBy(this.cursors,compareBy(C=>C.viewState.position,Position$1.compare)).viewState.position}getSelections(){return this.cursors.map(C=>C.modelState.selection)}getViewSelections(){return this.cursors.map(C=>C.viewState.selection)}setSelections(C){this.setStates(CursorState$1.fromModelSelections(C))}getPrimaryCursor(){return this.cursors[0].asCursorState()}setStates(C){C!==null&&(this.cursors[0].setState(this.context,C[0].modelState,C[0].viewState),this._setSecondaryStates(C.slice(1)))}_setSecondaryStates(C){const W=this.cursors.length-1,V=C.length;if(W<V){const U=V-W;for(let G=0;G<U;G++)this._addSecondaryCursor()}else if(W>V){const U=W-V;for(let G=0;G<U;G++)this._removeSecondaryCursor(this.cursors.length-2)}for(let U=0;U<V;U++)this.cursors[U+1].setState(this.context,C[U].modelState,C[U].viewState)}killSecondaryCursors(){this._setSecondaryStates([])}_addSecondaryCursor(){this.cursors.push(new Cursor(this.context)),this.lastAddedCursorIndex=this.cursors.length-1}getLastAddedCursorIndex(){return this.cursors.length===1||this.lastAddedCursorIndex===0?0:this.lastAddedCursorIndex}_removeSecondaryCursor(C){this.lastAddedCursorIndex>=C+1&&this.lastAddedCursorIndex--,this.cursors[C+1].dispose(this.context),this.cursors.splice(C+1,1)}normalize(){if(this.cursors.length===1)return;const C=this.cursors.slice(0),W=[];for(let V=0,U=C.length;V<U;V++)W.push({index:V,selection:C[V].modelState.selection});W.sort(compareBy(V=>V.selection,Range$2.compareRangesUsingStarts));for(let V=0;V<W.length-1;V++){const U=W[V],G=W[V+1],Z=U.selection,X=G.selection;if(!this.context.cursorConfig.multiCursorMergeOverlapping)continue;let Q;if(X.isEmpty()||Z.isEmpty()?Q=X.getStartPosition().isBeforeOrEqual(Z.getEndPosition()):Q=X.getStartPosition().isBefore(Z.getEndPosition()),Q){const J=U.index<G.index?V:V+1,ee=U.index<G.index?V+1:V,te=W[ee].index,ie=W[J].index,ne=W[ee].selection,oe=W[J].selection;if(!ne.equalsSelection(oe)){const re=ne.plusRange(oe),ae=ne.selectionStartLineNumber===ne.startLineNumber&&ne.selectionStartColumn===ne.startColumn,se=oe.selectionStartLineNumber===oe.startLineNumber&&oe.selectionStartColumn===oe.startColumn;let le;te===this.lastAddedCursorIndex?(le=ae,this.lastAddedCursorIndex=ie):le=se;let ce;le?ce=new Selection$1(re.startLineNumber,re.startColumn,re.endLineNumber,re.endColumn):ce=new Selection$1(re.endLineNumber,re.endColumn,re.startLineNumber,re.startColumn),W[J].selection=ce;const de=CursorState$1.fromModelSelection(ce);C[ie].setState(this.context,de.modelState,de.viewState)}for(const re of W)re.index>te&&re.index--;C.splice(te,1),W.splice(ee,1),this._removeSecondaryCursor(te-1),V--}}}}class CursorContext{constructor(C,W,V,U){this._cursorContextBrand=void 0,this.model=C,this.viewModel=W,this.coordinatesConverter=V,this.cursorConfig=U}}class ViewCompositionStartEvent{constructor(){this.type=0}}class ViewCompositionEndEvent{constructor(){this.type=1}}class ViewConfigurationChangedEvent{constructor(C){this.type=2,this._source=C}hasChanged(C){return this._source.hasChanged(C)}}class ViewCursorStateChangedEvent{constructor(C,W,V){this.selections=C,this.modelSelections=W,this.reason=V,this.type=3}}class ViewDecorationsChangedEvent{constructor(C){this.type=4,C?(this.affectsMinimap=C.affectsMinimap,this.affectsOverviewRuler=C.affectsOverviewRuler,this.affectsGlyphMargin=C.affectsGlyphMargin):(this.affectsMinimap=!0,this.affectsOverviewRuler=!0,this.affectsGlyphMargin=!0)}}class ViewFlushedEvent{constructor(){this.type=5}}class ViewFocusChangedEvent{constructor(C){this.type=6,this.isFocused=C}}class ViewLanguageConfigurationEvent{constructor(){this.type=7}}class ViewLineMappingChangedEvent{constructor(){this.type=8}}class ViewLinesChangedEvent{constructor(C,W){this.fromLineNumber=C,this.count=W,this.type=9}}class ViewLinesDeletedEvent{constructor(C,W){this.type=10,this.fromLineNumber=C,this.toLineNumber=W}}class ViewLinesInsertedEvent{constructor(C,W){this.type=11,this.fromLineNumber=C,this.toLineNumber=W}}class ViewRevealRangeRequestEvent{constructor(C,W,V,U,G,Z,X){this.source=C,this.minimalReveal=W,this.range=V,this.selections=U,this.verticalType=G,this.revealHorizontal=Z,this.scrollType=X,this.type=12}}class ViewScrollChangedEvent{constructor(C){this.type=13,this.scrollWidth=C.scrollWidth,this.scrollLeft=C.scrollLeft,this.scrollHeight=C.scrollHeight,this.scrollTop=C.scrollTop,this.scrollWidthChanged=C.scrollWidthChanged,this.scrollLeftChanged=C.scrollLeftChanged,this.scrollHeightChanged=C.scrollHeightChanged,this.scrollTopChanged=C.scrollTopChanged}}class ViewThemeChangedEvent{constructor(C){this.theme=C,this.type=14}}class ViewTokensChangedEvent{constructor(C){this.type=15,this.ranges=C}}class ViewTokensColorsChangedEvent{constructor(){this.type=16}}let ViewZonesChangedEvent$1=class{constructor(){this.type=17}};class ViewModelEventDispatcher extends Disposable{constructor(){super(),this._onEvent=this._register(new Emitter$1),this.onEvent=this._onEvent.event,this._eventHandlers=[],this._viewEventQueue=null,this._isConsumingViewEventQueue=!1,this._collector=null,this._collectorCnt=0,this._outgoingEvents=[]}emitOutgoingEvent(C){this._addOutgoingEvent(C),this._emitOutgoingEvents()}_addOutgoingEvent(C){for(let W=0,V=this._outgoingEvents.length;W<V;W++){const U=this._outgoingEvents[W].kind===C.kind?this._outgoingEvents[W].attemptToMerge(C):null;if(U){this._outgoingEvents[W]=U;return}}this._outgoingEvents.push(C)}_emitOutgoingEvents(){for(;this._outgoingEvents.length>0;){if(this._collector||this._isConsumingViewEventQueue)return;const C=this._outgoingEvents.shift();C.isNoOp()||this._onEvent.fire(C)}}addViewEventHandler(C){for(let W=0,V=this._eventHandlers.length;W<V;W++)this._eventHandlers[W]===C&&console.warn("Detected duplicate listener in ViewEventDispatcher",C);this._eventHandlers.push(C)}removeViewEventHandler(C){for(let W=0;W<this._eventHandlers.length;W++)if(this._eventHandlers[W]===C){this._eventHandlers.splice(W,1);break}}beginEmitViewEvents(){return this._collectorCnt++,this._collectorCnt===1&&(this._collector=new ViewModelEventsCollector),this._collector}endEmitViewEvents(){if(this._collectorCnt--,this._collectorCnt===0){const C=this._collector.outgoingEvents,W=this._collector.viewEvents;this._collector=null;for(const V of C)this._addOutgoingEvent(V);W.length>0&&this._emitMany(W)}this._emitOutgoingEvents()}emitSingleViewEvent(C){try{this.beginEmitViewEvents().emitViewEvent(C)}finally{this.endEmitViewEvents()}}_emitMany(C){this._viewEventQueue?this._viewEventQueue=this._viewEventQueue.concat(C):this._viewEventQueue=C,this._isConsumingViewEventQueue||this._consumeViewEventQueue()}_consumeViewEventQueue(){try{this._isConsumingViewEventQueue=!0,this._doConsumeQueue()}finally{this._isConsumingViewEventQueue=!1}}_doConsumeQueue(){for(;this._viewEventQueue;){const C=this._viewEventQueue;this._viewEventQueue=null;const W=this._eventHandlers.slice(0);for(const V of W)V.handleEvents(C)}}}class ViewModelEventsCollector{constructor(){this.viewEvents=[],this.outgoingEvents=[]}emitViewEvent(C){this.viewEvents.push(C)}emitOutgoingEvent(C){this.outgoingEvents.push(C)}}class ContentSizeChangedEvent{constructor(C,W,V,U){this.kind=0,this._oldContentWidth=C,this._oldContentHeight=W,this.contentWidth=V,this.contentHeight=U,this.contentWidthChanged=this._oldContentWidth!==this.contentWidth,this.contentHeightChanged=this._oldContentHeight!==this.contentHeight}isNoOp(){return!this.contentWidthChanged&&!this.contentHeightChanged}attemptToMerge(C){return C.kind!==this.kind?null:new ContentSizeChangedEvent(this._oldContentWidth,this._oldContentHeight,C.contentWidth,C.contentHeight)}}class FocusChangedEvent{constructor(C,W){this.kind=1,this.oldHasFocus=C,this.hasFocus=W}isNoOp(){return this.oldHasFocus===this.hasFocus}attemptToMerge(C){return C.kind!==this.kind?null:new FocusChangedEvent(this.oldHasFocus,C.hasFocus)}}class ScrollChangedEvent{constructor(C,W,V,U,G,Z,X,Q){this.kind=2,this._oldScrollWidth=C,this._oldScrollLeft=W,this._oldScrollHeight=V,this._oldScrollTop=U,this.scrollWidth=G,this.scrollLeft=Z,this.scrollHeight=X,this.scrollTop=Q,this.scrollWidthChanged=this._oldScrollWidth!==this.scrollWidth,this.scrollLeftChanged=this._oldScrollLeft!==this.scrollLeft,this.scrollHeightChanged=this._oldScrollHeight!==this.scrollHeight,this.scrollTopChanged=this._oldScrollTop!==this.scrollTop}isNoOp(){return!this.scrollWidthChanged&&!this.scrollLeftChanged&&!this.scrollHeightChanged&&!this.scrollTopChanged}attemptToMerge(C){return C.kind!==this.kind?null:new ScrollChangedEvent(this._oldScrollWidth,this._oldScrollLeft,this._oldScrollHeight,this._oldScrollTop,C.scrollWidth,C.scrollLeft,C.scrollHeight,C.scrollTop)}}class ViewZonesChangedEvent{constructor(){this.kind=3}isNoOp(){return!1}attemptToMerge(C){return C.kind!==this.kind?null:this}}class HiddenAreasChangedEvent{constructor(){this.kind=4}isNoOp(){return!1}attemptToMerge(C){return C.kind!==this.kind?null:this}}class CursorStateChangedEvent{constructor(C,W,V,U,G,Z,X){this.kind=6,this.oldSelections=C,this.selections=W,this.oldModelVersionId=V,this.modelVersionId=U,this.source=G,this.reason=Z,this.reachedMaxCursorCount=X}static _selectionsAreEqual(C,W){if(!C&&!W)return!0;if(!C||!W)return!1;const V=C.length,U=W.length;if(V!==U)return!1;for(let G=0;G<V;G++)if(!C[G].equalsSelection(W[G]))return!1;return!0}isNoOp(){return CursorStateChangedEvent._selectionsAreEqual(this.oldSelections,this.selections)&&this.oldModelVersionId===this.modelVersionId}attemptToMerge(C){return C.kind!==this.kind?null:new CursorStateChangedEvent(this.oldSelections,C.selections,this.oldModelVersionId,C.modelVersionId,C.source,C.reason,this.reachedMaxCursorCount||C.reachedMaxCursorCount)}}class ReadOnlyEditAttemptEvent{constructor(){this.kind=5}isNoOp(){return!1}attemptToMerge(C){return C.kind!==this.kind?null:this}}class ModelDecorationsChangedEvent{constructor(C){this.event=C,this.kind=7}isNoOp(){return!1}attemptToMerge(C){return null}}class ModelLanguageChangedEvent{constructor(C){this.event=C,this.kind=8}isNoOp(){return!1}attemptToMerge(C){return null}}class ModelLanguageConfigurationChangedEvent{constructor(C){this.event=C,this.kind=9}isNoOp(){return!1}attemptToMerge(C){return null}}class ModelContentChangedEvent{constructor(C){this.event=C,this.kind=10}isNoOp(){return!1}attemptToMerge(C){return null}}class ModelOptionsChangedEvent{constructor(C){this.event=C,this.kind=11}isNoOp(){return!1}attemptToMerge(C){return null}}class ModelTokensChangedEvent{constructor(C){this.event=C,this.kind=12}isNoOp(){return!1}attemptToMerge(C){return null}}class CursorsController extends Disposable{constructor(C,W,V,U){super(),this._model=C,this._knownModelVersionId=this._model.getVersionId(),this._viewModel=W,this._coordinatesConverter=V,this.context=new CursorContext(this._model,this._viewModel,this._coordinatesConverter,U),this._cursors=new CursorCollection(this.context),this._hasFocus=!1,this._isHandling=!1,this._compositionState=null,this._columnSelectData=null,this._autoClosedActions=[],this._prevEditOperationType=0}dispose(){this._cursors.dispose(),this._autoClosedActions=dispose(this._autoClosedActions),super.dispose()}updateConfiguration(C){this.context=new CursorContext(this._model,this._viewModel,this._coordinatesConverter,C),this._cursors.updateContext(this.context)}onLineMappingChanged(C){this._knownModelVersionId===this._model.getVersionId()&&this.setStates(C,"viewModel",0,this.getCursorStates())}setHasFocus(C){this._hasFocus=C}_validateAutoClosedActions(){if(this._autoClosedActions.length>0){const C=this._cursors.getSelections();for(let W=0;W<this._autoClosedActions.length;W++){const V=this._autoClosedActions[W];V.isValid(C)||(V.dispose(),this._autoClosedActions.splice(W,1),W--)}}}getPrimaryCursorState(){return this._cursors.getPrimaryCursor()}getLastAddedCursorIndex(){return this._cursors.getLastAddedCursorIndex()}getCursorStates(){return this._cursors.getAll()}setStates(C,W,V,U){let G=!1;const Z=this.context.cursorConfig.multiCursorLimit;U!==null&&U.length>Z&&(U=U.slice(0,Z),G=!0);const X=CursorModelState.from(this._model,this);return this._cursors.setStates(U),this._cursors.normalize(),this._columnSelectData=null,this._validateAutoClosedActions(),this._emitStateChangedIfNecessary(C,W,V,X,G)}setCursorColumnSelectData(C){this._columnSelectData=C}revealPrimary(C,W,V,U,G,Z){const X=this._cursors.getViewPositions();let Q=null,J=null;X.length>1?J=this._cursors.getViewSelections():Q=Range$2.fromPositions(X[0],X[0]),C.emitViewEvent(new ViewRevealRangeRequestEvent(W,V,Q,J,U,G,Z))}saveState(){const C=[],W=this._cursors.getSelections();for(let V=0,U=W.length;V<U;V++){const G=W[V];C.push({inSelectionMode:!G.isEmpty(),selectionStart:{lineNumber:G.selectionStartLineNumber,column:G.selectionStartColumn},position:{lineNumber:G.positionLineNumber,column:G.positionColumn}})}return C}restoreState(C,W){const V=[];for(let U=0,G=W.length;U<G;U++){const Z=W[U];let X=1,Q=1;Z.position&&Z.position.lineNumber&&(X=Z.position.lineNumber),Z.position&&Z.position.column&&(Q=Z.position.column);let J=X,ee=Q;Z.selectionStart&&Z.selectionStart.lineNumber&&(J=Z.selectionStart.lineNumber),Z.selectionStart&&Z.selectionStart.column&&(ee=Z.selectionStart.column),V.push({selectionStartLineNumber:J,selectionStartColumn:ee,positionLineNumber:X,positionColumn:Q})}this.setStates(C,"restoreState",0,CursorState$1.fromModelSelections(V)),this.revealPrimary(C,"restoreState",!1,0,!0,1)}onModelContentChanged(C,W){if(W instanceof ModelInjectedTextChangedEvent){if(this._isHandling)return;this._isHandling=!0;try{this.setStates(C,"modelChange",0,this.getCursorStates())}finally{this._isHandling=!1}}else{const V=W.rawContentChangedEvent;if(this._knownModelVersionId=V.versionId,this._isHandling)return;const U=V.containsEvent(1);if(this._prevEditOperationType=0,U)this._cursors.dispose(),this._cursors=new CursorCollection(this.context),this._validateAutoClosedActions(),this._emitStateChangedIfNecessary(C,"model",1,null,!1);else if(this._hasFocus&&V.resultingSelection&&V.resultingSelection.length>0){const G=CursorState$1.fromModelSelections(V.resultingSelection);this.setStates(C,"modelChange",V.isUndoing?5:V.isRedoing?6:2,G)&&this.revealPrimary(C,"modelChange",!1,0,!0,0)}else{const G=this._cursors.readSelectionFromMarkers();this.setStates(C,"modelChange",2,CursorState$1.fromModelSelections(G))}}}getSelection(){return this._cursors.getPrimaryCursor().modelState.selection}getTopMostViewPosition(){return this._cursors.getTopMostViewPosition()}getBottomMostViewPosition(){return this._cursors.getBottomMostViewPosition()}getCursorColumnSelectData(){if(this._columnSelectData)return this._columnSelectData;const C=this._cursors.getPrimaryCursor(),W=C.viewState.selectionStart.getStartPosition(),V=C.viewState.position;return{isReal:!1,fromViewLineNumber:W.lineNumber,fromViewVisualColumn:this.context.cursorConfig.visibleColumnFromColumn(this._viewModel,W),toViewLineNumber:V.lineNumber,toViewVisualColumn:this.context.cursorConfig.visibleColumnFromColumn(this._viewModel,V)}}getSelections(){return this._cursors.getSelections()}setSelections(C,W,V,U){this.setStates(C,W,U,CursorState$1.fromModelSelections(V))}getPrevEditOperationType(){return this._prevEditOperationType}setPrevEditOperationType(C){this._prevEditOperationType=C}_pushAutoClosedAction(C,W){const V=[],U=[];for(let X=0,Q=C.length;X<Q;X++)V.push({range:C[X],options:{description:"auto-closed-character",inlineClassName:"auto-closed-character",stickiness:1}}),U.push({range:W[X],options:{description:"auto-closed-enclosing",stickiness:1}});const G=this._model.deltaDecorations([],V),Z=this._model.deltaDecorations([],U);this._autoClosedActions.push(new AutoClosedAction(this._model,G,Z))}_executeEditOperation(C){if(!C)return;C.shouldPushStackElementBefore&&this._model.pushStackElement();const W=CommandExecutor.executeCommands(this._model,this._cursors.getSelections(),C.commands);if(W){this._interpretCommandResult(W);const V=[],U=[];for(let G=0;G<C.commands.length;G++){const Z=C.commands[G];Z instanceof TypeWithAutoClosingCommand&&Z.enclosingRange&&Z.closeCharacterRange&&(V.push(Z.closeCharacterRange),U.push(Z.enclosingRange))}V.length>0&&this._pushAutoClosedAction(V,U),this._prevEditOperationType=C.type}C.shouldPushStackElementAfter&&this._model.pushStackElement()}_interpretCommandResult(C){(!C||C.length===0)&&(C=this._cursors.readSelectionFromMarkers()),this._columnSelectData=null,this._cursors.setSelections(C),this._cursors.normalize()}_emitStateChangedIfNecessary(C,W,V,U,G){const Z=CursorModelState.from(this._model,this);if(Z.equals(U))return!1;const X=this._cursors.getSelections(),Q=this._cursors.getViewSelections();if(C.emitViewEvent(new ViewCursorStateChangedEvent(Q,X,V)),!U||U.cursorState.length!==Z.cursorState.length||Z.cursorState.some((J,ee)=>!J.modelState.equals(U.cursorState[ee].modelState))){const J=U?U.cursorState.map(te=>te.modelState.selection):null,ee=U?U.modelVersionId:0;C.emitOutgoingEvent(new CursorStateChangedEvent(J,X,ee,Z.modelVersionId,W||"keyboard",V,G))}return!0}_findAutoClosingPairs(C){if(!C.length)return null;const W=[];for(let V=0,U=C.length;V<U;V++){const G=C[V];if(!G.text||G.text.indexOf(`
`)>=0)return null;const Z=G.text.match(/([)\]}>'"`])([^)\]}>'"`]*)$/);if(!Z)return null;const X=Z[1],Q=this.context.cursorConfig.autoClosingPairs.autoClosingPairsCloseSingleChar.get(X);if(!Q||Q.length!==1)return null;const J=Q[0].open,ee=G.text.length-Z[2].length-1,te=G.text.lastIndexOf(J,ee-1);if(te===-1)return null;W.push([te,ee])}return W}executeEdits(C,W,V,U){let G=null;W==="snippet"&&(G=this._findAutoClosingPairs(V)),G&&(V[0]._isTracked=!0);const Z=[],X=[],Q=this._model.pushEditOperations(this.getSelections(),V,J=>{if(G)for(let te=0,ie=G.length;te<ie;te++){const[ne,oe]=G[te],re=J[te],ae=re.range.startLineNumber,se=re.range.startColumn-1+ne,le=re.range.startColumn-1+oe;Z.push(new Range$2(ae,le+1,ae,le+2)),X.push(new Range$2(ae,se+1,ae,le+2))}const ee=U(J);return ee&&(this._isHandling=!0),ee});Q&&(this._isHandling=!1,this.setSelections(C,W,Q,0)),Z.length>0&&this._pushAutoClosedAction(Z,X)}_executeEdit(C,W,V,U=0){if(this.context.cursorConfig.readOnly)return;const G=CursorModelState.from(this._model,this);this._cursors.stopTrackingSelections(),this._isHandling=!0;try{this._cursors.ensureValidState(),C()}catch(Z){onUnexpectedError(Z)}this._isHandling=!1,this._cursors.startTrackingSelections(),this._validateAutoClosedActions(),this._emitStateChangedIfNecessary(W,V,U,G,!1)&&this.revealPrimary(W,V,!1,0,!0,0)}getAutoClosedCharacters(){return AutoClosedAction.getAllAutoClosedCharacters(this._autoClosedActions)}startComposition(C){this._compositionState=new CompositionState(this._model,this.getSelections())}endComposition(C,W){const V=this._compositionState?this._compositionState.deduceOutcome(this._model,this.getSelections()):null;this._compositionState=null,this._executeEdit(()=>{W==="keyboard"&&this._executeEditOperation(TypeOperations.compositionEndWithInterceptors(this._prevEditOperationType,this.context.cursorConfig,this._model,V,this.getSelections(),this.getAutoClosedCharacters()))},C,W)}type(C,W,V){this._executeEdit(()=>{if(V==="keyboard"){const U=W.length;let G=0;for(;G<U;){const Z=nextCharLength(W,G),X=W.substr(G,Z);this._executeEditOperation(TypeOperations.typeWithInterceptors(!!this._compositionState,this._prevEditOperationType,this.context.cursorConfig,this._model,this.getSelections(),this.getAutoClosedCharacters(),X)),G+=Z}}else this._executeEditOperation(TypeOperations.typeWithoutInterceptors(this._prevEditOperationType,this.context.cursorConfig,this._model,this.getSelections(),W))},C,V)}compositionType(C,W,V,U,G,Z){if(W.length===0&&V===0&&U===0){if(G!==0){const X=this.getSelections().map(Q=>{const J=Q.getPosition();return new Selection$1(J.lineNumber,J.column+G,J.lineNumber,J.column+G)});this.setSelections(C,Z,X,0)}return}this._executeEdit(()=>{this._executeEditOperation(TypeOperations.compositionType(this._prevEditOperationType,this.context.cursorConfig,this._model,this.getSelections(),W,V,U,G))},C,Z)}paste(C,W,V,U,G){this._executeEdit(()=>{this._executeEditOperation(TypeOperations.paste(this.context.cursorConfig,this._model,this.getSelections(),W,V,U||[]))},C,G,4)}cut(C,W){this._executeEdit(()=>{this._executeEditOperation(DeleteOperations.cut(this.context.cursorConfig,this._model,this.getSelections()))},C,W)}executeCommand(C,W,V){this._executeEdit(()=>{this._cursors.killSecondaryCursors(),this._executeEditOperation(new EditOperationResult(0,[W],{shouldPushStackElementBefore:!1,shouldPushStackElementAfter:!1}))},C,V)}executeCommands(C,W,V){this._executeEdit(()=>{this._executeEditOperation(new EditOperationResult(0,W,{shouldPushStackElementBefore:!1,shouldPushStackElementAfter:!1}))},C,V)}}class CursorModelState{static from(C,W){return new CursorModelState(C.getVersionId(),W.getCursorStates())}constructor(C,W){this.modelVersionId=C,this.cursorState=W}equals(C){if(!C||this.modelVersionId!==C.modelVersionId||this.cursorState.length!==C.cursorState.length)return!1;for(let W=0,V=this.cursorState.length;W<V;W++)if(!this.cursorState[W].equals(C.cursorState[W]))return!1;return!0}}class AutoClosedAction{static getAllAutoClosedCharacters(C){let W=[];for(const V of C)W=W.concat(V.getAutoClosedCharactersRanges());return W}constructor(C,W,V){this._model=C,this._autoClosedCharactersDecorations=W,this._autoClosedEnclosingDecorations=V}dispose(){this._autoClosedCharactersDecorations=this._model.deltaDecorations(this._autoClosedCharactersDecorations,[]),this._autoClosedEnclosingDecorations=this._model.deltaDecorations(this._autoClosedEnclosingDecorations,[])}getAutoClosedCharactersRanges(){const C=[];for(let W=0;W<this._autoClosedCharactersDecorations.length;W++){const V=this._model.getDecorationRange(this._autoClosedCharactersDecorations[W]);V&&C.push(V)}return C}isValid(C){const W=[];for(let V=0;V<this._autoClosedEnclosingDecorations.length;V++){const U=this._model.getDecorationRange(this._autoClosedEnclosingDecorations[V]);if(U&&(W.push(U),U.startLineNumber!==U.endLineNumber))return!1}W.sort(Range$2.compareRangesUsingStarts),C.sort(Range$2.compareRangesUsingStarts);for(let V=0;V<C.length;V++)if(V>=W.length||!W[V].strictContainsRange(C[V]))return!1;return!0}}class CommandExecutor{static executeCommands(C,W,V){const U={model:C,selectionsBefore:W,trackedRanges:[],trackedRangesDirection:[]},G=this._innerExecuteCommands(U,V);for(let Z=0,X=U.trackedRanges.length;Z<X;Z++)U.model._setTrackedRange(U.trackedRanges[Z],null,0);return G}static _innerExecuteCommands(C,W){if(this._arrayIsEmpty(W))return null;const V=this._getEditOperations(C,W);if(V.operations.length===0)return null;const U=V.operations,G=this._getLoserCursorMap(U);if(G.hasOwnProperty("0"))return console.warn("Ignoring commands"),null;const Z=[];for(let J=0,ee=U.length;J<ee;J++)G.hasOwnProperty(U[J].identifier.major.toString())||Z.push(U[J]);V.hadTrackedEditOperation&&Z.length>0&&(Z[0]._isTracked=!0);let X=C.model.pushEditOperations(C.selectionsBefore,Z,J=>{const ee=[];for(let ne=0;ne<C.selectionsBefore.length;ne++)ee[ne]=[];for(const ne of J)ne.identifier&&ee[ne.identifier.major].push(ne);const te=(ne,oe)=>ne.identifier.minor-oe.identifier.minor,ie=[];for(let ne=0;ne<C.selectionsBefore.length;ne++)ee[ne].length>0?(ee[ne].sort(te),ie[ne]=W[ne].computeCursorState(C.model,{getInverseEditOperations:()=>ee[ne],getTrackedSelection:oe=>{const re=parseInt(oe,10),ae=C.model._getTrackedRange(C.trackedRanges[re]);return C.trackedRangesDirection[re]===0?new Selection$1(ae.startLineNumber,ae.startColumn,ae.endLineNumber,ae.endColumn):new Selection$1(ae.endLineNumber,ae.endColumn,ae.startLineNumber,ae.startColumn)}})):ie[ne]=C.selectionsBefore[ne];return ie});X||(X=C.selectionsBefore);const Q=[];for(const J in G)G.hasOwnProperty(J)&&Q.push(parseInt(J,10));Q.sort((J,ee)=>ee-J);for(const J of Q)X.splice(J,1);return X}static _arrayIsEmpty(C){for(let W=0,V=C.length;W<V;W++)if(C[W])return!1;return!0}static _getEditOperations(C,W){let V=[],U=!1;for(let G=0,Z=W.length;G<Z;G++){const X=W[G];if(X){const Q=this._getEditOperationsFromCommand(C,G,X);V=V.concat(Q.operations),U=U||Q.hadTrackedEditOperation}}return{operations:V,hadTrackedEditOperation:U}}static _getEditOperationsFromCommand(C,W,V){const U=[];let G=0;const Z=(te,ie,ne=!1)=>{Range$2.isEmpty(te)&&ie===""||U.push({identifier:{major:W,minor:G++},range:te,text:ie,forceMoveMarkers:ne,isAutoWhitespaceEdit:V.insertsAutoWhitespace})};let X=!1;const ee={addEditOperation:Z,addTrackedEditOperation:(te,ie,ne)=>{X=!0,Z(te,ie,ne)},trackSelection:(te,ie)=>{const ne=Selection$1.liftSelection(te);let oe;if(ne.isEmpty())if(typeof ie=="boolean")ie?oe=2:oe=3;else{const se=C.model.getLineMaxColumn(ne.startLineNumber);ne.startColumn===se?oe=2:oe=3}else oe=1;const re=C.trackedRanges.length,ae=C.model._setTrackedRange(null,ne,oe);return C.trackedRanges[re]=ae,C.trackedRangesDirection[re]=ne.getDirection(),re.toString()}};try{V.getEditOperations(C.model,ee)}catch(te){return onUnexpectedError(te),{operations:[],hadTrackedEditOperation:!1}}return{operations:U,hadTrackedEditOperation:X}}static _getLoserCursorMap(C){C=C.slice(0),C.sort((V,U)=>-Range$2.compareRangesUsingEnds(V.range,U.range));const W={};for(let V=1;V<C.length;V++){const U=C[V-1],G=C[V];if(Range$2.getStartPosition(U.range).isBefore(Range$2.getEndPosition(G.range))){let Z;U.identifier.major>G.identifier.major?Z=U.identifier.major:Z=G.identifier.major,W[Z.toString()]=!0;for(let X=0;X<C.length;X++)C[X].identifier.major===Z&&(C.splice(X,1),X<V&&V--,X--);V>0&&V--}}return W}}class CompositionLineState{constructor(C,W,V){this.text=C,this.startSelection=W,this.endSelection=V}}class CompositionState{static _capture(C,W){const V=[];for(const U of W){if(U.startLineNumber!==U.endLineNumber)return null;V.push(new CompositionLineState(C.getLineContent(U.startLineNumber),U.startColumn-1,U.endColumn-1))}return V}constructor(C,W){this._original=CompositionState._capture(C,W)}deduceOutcome(C,W){if(!this._original)return null;const V=CompositionState._capture(C,W);if(!V||this._original.length!==V.length)return null;const U=[];for(let G=0,Z=this._original.length;G<Z;G++)U.push(CompositionState._deduceOutcome(this._original[G],V[G]));return U}static _deduceOutcome(C,W){const V=Math.min(C.startSelection,W.startSelection,commonPrefixLength(C.text,W.text)),U=Math.min(C.text.length-C.endSelection,W.text.length-W.endSelection,commonSuffixLength(C.text,W.text)),G=C.text.substring(V,C.text.length-U),Z=W.text.substring(V,W.text.length-U);return new CompositionOutcome(G,C.startSelection-V,C.endSelection-V,Z,W.startSelection-V,W.endSelection-V)}}var __awaiter$1v=globalThis&&globalThis.__awaiter||function(K,C,W,V){function U(G){return G instanceof W?G:new W(function(Z){Z(G)})}return new(W||(W=Promise))(function(G,Z){function X(ee){try{J(V.next(ee))}catch(te){Z(te)}}function Q(ee){try{J(V.throw(ee))}catch(te){Z(te)}}function J(ee){ee.done?G(ee.value):U(ee.value).then(X,Q)}J((V=V.apply(K,C||[])).next())})};const fallback={getInitialState:()=>NullState,tokenizeEncoded:(K,C,W)=>nullTokenizeEncoded(0,W)};function tokenizeToString(K,C,W){return __awaiter$1v(this,void 0,void 0,function*(){if(!W)return _tokenizeToString(C,K.languageIdCodec,fallback);const V=yield TokenizationRegistry.getOrCreate(W);return _tokenizeToString(C,K.languageIdCodec,V||fallback)})}function tokenizeLineToHTML(K,C,W,V,U,G,Z){let X="<div>",Q=V,J=0,ee=!0;for(let te=0,ie=C.getCount();te<ie;te++){const ne=C.getEndOffset(te);if(ne<=V)continue;let oe="";for(;Q<ne&&Q<U;Q++){const re=K.charCodeAt(Q);switch(re){case 9:{let ae=G-(Q+J)%G;for(J+=ae-1;ae>0;)Z&&ee?(oe+="&#160;",ee=!1):(oe+=" ",ee=!0),ae--;break}case 60:oe+="&lt;",ee=!1;break;case 62:oe+="&gt;",ee=!1;break;case 38:oe+="&amp;",ee=!1;break;case 0:oe+="&#00;",ee=!1;break;case 65279:case 8232:case 8233:case 133:oe+="�",ee=!1;break;case 13:oe+="&#8203",ee=!1;break;case 32:Z&&ee?(oe+="&#160;",ee=!1):(oe+=" ",ee=!0);break;default:oe+=String.fromCharCode(re),ee=!1}}if(X+=`<span style="${C.getInlineStyle(te,W)}">${oe}</span>`,ne>U||Q>=U)break}return X+="</div>",X}function _tokenizeToString(K,C,W){let V='<div class="monaco-tokenized-source">';const U=splitLines(K);let G=W.getInitialState();for(let Z=0,X=U.length;Z<X;Z++){const Q=U[Z];Z>0&&(V+="<br/>");const J=W.tokenizeEncoded(Q,!0,G);LineTokens.convertToEndOffset(J.tokens,Q.length);const te=new LineTokens(J.tokens,Q,C).inflate();let ie=0;for(let ne=0,oe=te.getCount();ne<oe;ne++){const re=te.getClassName(ne),ae=te.getEndOffset(ne);V+=`<span class="${re}">${escape(Q.substring(ie,ae))}</span>`,ie=ae}G=J.endState}return V+="</div>",V}class PendingChanges{constructor(){this._hasPending=!1,this._inserts=[],this._changes=[],this._removes=[]}insert(C){this._hasPending=!0,this._inserts.push(C)}change(C){this._hasPending=!0,this._changes.push(C)}remove(C){this._hasPending=!0,this._removes.push(C)}mustCommit(){return this._hasPending}commit(C){if(!this._hasPending)return;const W=this._inserts,V=this._changes,U=this._removes;this._hasPending=!1,this._inserts=[],this._changes=[],this._removes=[],C._commitPendingChanges(W,V,U)}}class EditorWhitespace{constructor(C,W,V,U,G){this.id=C,this.afterLineNumber=W,this.ordinal=V,this.height=U,this.minWidth=G,this.prefixSum=0}}let LinesLayout$1=class Qt{constructor(C,W,V,U){this._instanceId=singleLetterHash(++Qt.INSTANCE_COUNT),this._pendingChanges=new PendingChanges,this._lastWhitespaceId=0,this._arr=[],this._prefixSumValidIndex=-1,this._minWidth=-1,this._lineCount=C,this._lineHeight=W,this._paddingTop=V,this._paddingBottom=U}static findInsertionIndex(C,W,V){let U=0,G=C.length;for(;U<G;){const Z=U+G>>>1;W===C[Z].afterLineNumber?V<C[Z].ordinal?G=Z:U=Z+1:W<C[Z].afterLineNumber?G=Z:U=Z+1}return U}setLineHeight(C){this._checkPendingChanges(),this._lineHeight=C}setPadding(C,W){this._paddingTop=C,this._paddingBottom=W}onFlushed(C){this._checkPendingChanges(),this._lineCount=C}changeWhitespace(C){let W=!1;try{C({insertWhitespace:(U,G,Z,X)=>{W=!0,U=U|0,G=G|0,Z=Z|0,X=X|0;const Q=this._instanceId+ ++this._lastWhitespaceId;return this._pendingChanges.insert(new EditorWhitespace(Q,U,G,Z,X)),Q},changeOneWhitespace:(U,G,Z)=>{W=!0,G=G|0,Z=Z|0,this._pendingChanges.change({id:U,newAfterLineNumber:G,newHeight:Z})},removeWhitespace:U=>{W=!0,this._pendingChanges.remove({id:U})}})}finally{this._pendingChanges.commit(this)}return W}_commitPendingChanges(C,W,V){if((C.length>0||V.length>0)&&(this._minWidth=-1),C.length+W.length+V.length<=1){for(const Q of C)this._insertWhitespace(Q);for(const Q of W)this._changeOneWhitespace(Q.id,Q.newAfterLineNumber,Q.newHeight);for(const Q of V){const J=this._findWhitespaceIndex(Q.id);J!==-1&&this._removeWhitespace(J)}return}const U=new Set;for(const Q of V)U.add(Q.id);const G=new Map;for(const Q of W)G.set(Q.id,Q);const Z=Q=>{const J=[];for(const ee of Q)if(!U.has(ee.id)){if(G.has(ee.id)){const te=G.get(ee.id);ee.afterLineNumber=te.newAfterLineNumber,ee.height=te.newHeight}J.push(ee)}return J},X=Z(this._arr).concat(Z(C));X.sort((Q,J)=>Q.afterLineNumber===J.afterLineNumber?Q.ordinal-J.ordinal:Q.afterLineNumber-J.afterLineNumber),this._arr=X,this._prefixSumValidIndex=-1}_checkPendingChanges(){this._pendingChanges.mustCommit()&&this._pendingChanges.commit(this)}_insertWhitespace(C){const W=Qt.findInsertionIndex(this._arr,C.afterLineNumber,C.ordinal);this._arr.splice(W,0,C),this._prefixSumValidIndex=Math.min(this._prefixSumValidIndex,W-1)}_findWhitespaceIndex(C){const W=this._arr;for(let V=0,U=W.length;V<U;V++)if(W[V].id===C)return V;return-1}_changeOneWhitespace(C,W,V){const U=this._findWhitespaceIndex(C);if(U!==-1&&(this._arr[U].height!==V&&(this._arr[U].height=V,this._prefixSumValidIndex=Math.min(this._prefixSumValidIndex,U-1)),this._arr[U].afterLineNumber!==W)){const G=this._arr[U];this._removeWhitespace(U),G.afterLineNumber=W,this._insertWhitespace(G)}}_removeWhitespace(C){this._arr.splice(C,1),this._prefixSumValidIndex=Math.min(this._prefixSumValidIndex,C-1)}onLinesDeleted(C,W){this._checkPendingChanges(),C=C|0,W=W|0,this._lineCount-=W-C+1;for(let V=0,U=this._arr.length;V<U;V++){const G=this._arr[V].afterLineNumber;C<=G&&G<=W?this._arr[V].afterLineNumber=C-1:G>W&&(this._arr[V].afterLineNumber-=W-C+1)}}onLinesInserted(C,W){this._checkPendingChanges(),C=C|0,W=W|0,this._lineCount+=W-C+1;for(let V=0,U=this._arr.length;V<U;V++){const G=this._arr[V].afterLineNumber;C<=G&&(this._arr[V].afterLineNumber+=W-C+1)}}getWhitespacesTotalHeight(){return this._checkPendingChanges(),this._arr.length===0?0:this.getWhitespacesAccumulatedHeight(this._arr.length-1)}getWhitespacesAccumulatedHeight(C){this._checkPendingChanges(),C=C|0;let W=Math.max(0,this._prefixSumValidIndex+1);W===0&&(this._arr[0].prefixSum=this._arr[0].height,W++);for(let V=W;V<=C;V++)this._arr[V].prefixSum=this._arr[V-1].prefixSum+this._arr[V].height;return this._prefixSumValidIndex=Math.max(this._prefixSumValidIndex,C),this._arr[C].prefixSum}getLinesTotalHeight(){this._checkPendingChanges();const C=this._lineHeight*this._lineCount,W=this.getWhitespacesTotalHeight();return C+W+this._paddingTop+this._paddingBottom}getWhitespaceAccumulatedHeightBeforeLineNumber(C){this._checkPendingChanges(),C=C|0;const W=this._findLastWhitespaceBeforeLineNumber(C);return W===-1?0:this.getWhitespacesAccumulatedHeight(W)}_findLastWhitespaceBeforeLineNumber(C){C=C|0;const W=this._arr;let V=0,U=W.length-1;for(;V<=U;){const Z=(U-V|0)/2|0,X=V+Z|0;if(W[X].afterLineNumber<C){if(X+1>=W.length||W[X+1].afterLineNumber>=C)return X;V=X+1|0}else U=X-1|0}return-1}_findFirstWhitespaceAfterLineNumber(C){C=C|0;const V=this._findLastWhitespaceBeforeLineNumber(C)+1;return V<this._arr.length?V:-1}getFirstWhitespaceIndexAfterLineNumber(C){return this._checkPendingChanges(),C=C|0,this._findFirstWhitespaceAfterLineNumber(C)}getVerticalOffsetForLineNumber(C,W=!1){this._checkPendingChanges(),C=C|0;let V;C>1?V=this._lineHeight*(C-1):V=0;const U=this.getWhitespaceAccumulatedHeightBeforeLineNumber(C-(W?1:0));return V+U+this._paddingTop}getVerticalOffsetAfterLineNumber(C,W=!1){this._checkPendingChanges(),C=C|0;const V=this._lineHeight*C,U=this.getWhitespaceAccumulatedHeightBeforeLineNumber(C+(W?1:0));return V+U+this._paddingTop}getWhitespaceMinWidth(){if(this._checkPendingChanges(),this._minWidth===-1){let C=0;for(let W=0,V=this._arr.length;W<V;W++)C=Math.max(C,this._arr[W].minWidth);this._minWidth=C}return this._minWidth}isAfterLines(C){this._checkPendingChanges();const W=this.getLinesTotalHeight();return C>W}isInTopPadding(C){return this._paddingTop===0?!1:(this._checkPendingChanges(),C<this._paddingTop)}isInBottomPadding(C){if(this._paddingBottom===0)return!1;this._checkPendingChanges();const W=this.getLinesTotalHeight();return C>=W-this._paddingBottom}getLineNumberAtOrAfterVerticalOffset(C){if(this._checkPendingChanges(),C=C|0,C<0)return 1;const W=this._lineCount|0,V=this._lineHeight;let U=1,G=W;for(;U<G;){const Z=(U+G)/2|0,X=this.getVerticalOffsetForLineNumber(Z)|0;if(C>=X+V)U=Z+1;else{if(C>=X)return Z;G=Z}}return U>W?W:U}getLinesViewportData(C,W){this._checkPendingChanges(),C=C|0,W=W|0;const V=this._lineHeight,U=this.getLineNumberAtOrAfterVerticalOffset(C)|0,G=this.getVerticalOffsetForLineNumber(U)|0;let Z=this._lineCount|0,X=this.getFirstWhitespaceIndexAfterLineNumber(U)|0;const Q=this.getWhitespacesCount()|0;let J,ee;X===-1?(X=Q,ee=Z+1,J=0):(ee=this.getAfterLineNumberForWhitespaceIndex(X)|0,J=this.getHeightForWhitespaceIndex(X)|0);let te=G,ie=te;const ne=5e5;let oe=0;G>=ne&&(oe=Math.floor(G/ne)*ne,oe=Math.floor(oe/V)*V,ie-=oe);const re=[],ae=C+(W-C)/2;let se=-1;for(let ue=U;ue<=Z;ue++){if(se===-1){const ge=te,he=te+V;(ge<=ae&&ae<he||ge>ae)&&(se=ue)}for(te+=V,re[ue-U]=ie,ie+=V;ee===ue;)ie+=J,te+=J,X++,X>=Q?ee=Z+1:(ee=this.getAfterLineNumberForWhitespaceIndex(X)|0,J=this.getHeightForWhitespaceIndex(X)|0);if(te>=W){Z=ue;break}}se===-1&&(se=Z);const le=this.getVerticalOffsetForLineNumber(Z)|0;let ce=U,de=Z;return ce<de&&G<C&&ce++,ce<de&&le+V>W&&de--,{bigNumbersDelta:oe,startLineNumber:U,endLineNumber:Z,relativeVerticalOffset:re,centeredLineNumber:se,completelyVisibleStartLineNumber:ce,completelyVisibleEndLineNumber:de}}getVerticalOffsetForWhitespaceIndex(C){this._checkPendingChanges(),C=C|0;const W=this.getAfterLineNumberForWhitespaceIndex(C);let V;W>=1?V=this._lineHeight*W:V=0;let U;return C>0?U=this.getWhitespacesAccumulatedHeight(C-1):U=0,V+U+this._paddingTop}getWhitespaceIndexAtOrAfterVerticallOffset(C){this._checkPendingChanges(),C=C|0;let W=0,V=this.getWhitespacesCount()-1;if(V<0)return-1;const U=this.getVerticalOffsetForWhitespaceIndex(V),G=this.getHeightForWhitespaceIndex(V);if(C>=U+G)return-1;for(;W<V;){const Z=Math.floor((W+V)/2),X=this.getVerticalOffsetForWhitespaceIndex(Z),Q=this.getHeightForWhitespaceIndex(Z);if(C>=X+Q)W=Z+1;else{if(C>=X)return Z;V=Z}}return W}getWhitespaceAtVerticalOffset(C){this._checkPendingChanges(),C=C|0;const W=this.getWhitespaceIndexAtOrAfterVerticallOffset(C);if(W<0||W>=this.getWhitespacesCount())return null;const V=this.getVerticalOffsetForWhitespaceIndex(W);if(V>C)return null;const U=this.getHeightForWhitespaceIndex(W),G=this.getIdForWhitespaceIndex(W),Z=this.getAfterLineNumberForWhitespaceIndex(W);return{id:G,afterLineNumber:Z,verticalOffset:V,height:U}}getWhitespaceViewportData(C,W){this._checkPendingChanges(),C=C|0,W=W|0;const V=this.getWhitespaceIndexAtOrAfterVerticallOffset(C),U=this.getWhitespacesCount()-1;if(V<0)return[];const G=[];for(let Z=V;Z<=U;Z++){const X=this.getVerticalOffsetForWhitespaceIndex(Z),Q=this.getHeightForWhitespaceIndex(Z);if(X>=W)break;G.push({id:this.getIdForWhitespaceIndex(Z),afterLineNumber:this.getAfterLineNumberForWhitespaceIndex(Z),verticalOffset:X,height:Q})}return G}getWhitespaces(){return this._checkPendingChanges(),this._arr.slice(0)}getWhitespacesCount(){return this._checkPendingChanges(),this._arr.length}getIdForWhitespaceIndex(C){return this._checkPendingChanges(),C=C|0,this._arr[C].id}getAfterLineNumberForWhitespaceIndex(C){return this._checkPendingChanges(),C=C|0,this._arr[C].afterLineNumber}getHeightForWhitespaceIndex(C){return this._checkPendingChanges(),C=C|0,this._arr[C].height}};LinesLayout$1.INSTANCE_COUNT=0;const SMOOTH_SCROLLING_TIME=125;class EditorScrollDimensions{constructor(C,W,V,U){C=C|0,W=W|0,V=V|0,U=U|0,C<0&&(C=0),W<0&&(W=0),V<0&&(V=0),U<0&&(U=0),this.width=C,this.contentWidth=W,this.scrollWidth=Math.max(C,W),this.height=V,this.contentHeight=U,this.scrollHeight=Math.max(V,U)}equals(C){return this.width===C.width&&this.contentWidth===C.contentWidth&&this.height===C.height&&this.contentHeight===C.contentHeight}}class EditorScrollable extends Disposable{constructor(C,W){super(),this._onDidContentSizeChange=this._register(new Emitter$1),this.onDidContentSizeChange=this._onDidContentSizeChange.event,this._dimensions=new EditorScrollDimensions(0,0,0,0),this._scrollable=this._register(new Scrollable({forceIntegerValues:!0,smoothScrollDuration:C,scheduleAtNextAnimationFrame:W})),this.onDidScroll=this._scrollable.onScroll}getScrollable(){return this._scrollable}setSmoothScrollDuration(C){this._scrollable.setSmoothScrollDuration(C)}validateScrollPosition(C){return this._scrollable.validateScrollPosition(C)}getScrollDimensions(){return this._dimensions}setScrollDimensions(C){if(this._dimensions.equals(C))return;const W=this._dimensions;this._dimensions=C,this._scrollable.setScrollDimensions({width:C.width,scrollWidth:C.scrollWidth,height:C.height,scrollHeight:C.scrollHeight},!0);const V=W.contentWidth!==C.contentWidth,U=W.contentHeight!==C.contentHeight;(V||U)&&this._onDidContentSizeChange.fire(new ContentSizeChangedEvent(W.contentWidth,W.contentHeight,C.contentWidth,C.contentHeight))}getFutureScrollPosition(){return this._scrollable.getFutureScrollPosition()}getCurrentScrollPosition(){return this._scrollable.getCurrentScrollPosition()}setScrollPositionNow(C){this._scrollable.setScrollPositionNow(C)}setScrollPositionSmooth(C){this._scrollable.setScrollPositionSmooth(C)}hasPendingScrollAnimation(){return this._scrollable.hasPendingScrollAnimation()}}class ViewLayout extends Disposable{constructor(C,W,V){super(),this._configuration=C;const U=this._configuration.options,G=U.get(143),Z=U.get(83);this._linesLayout=new LinesLayout$1(W,U.get(66),Z.top,Z.bottom),this._maxLineWidth=0,this._overlayWidgetsMinWidth=0,this._scrollable=this._register(new EditorScrollable(0,V)),this._configureSmoothScrollDuration(),this._scrollable.setScrollDimensions(new EditorScrollDimensions(G.contentWidth,0,G.height,0)),this.onDidScroll=this._scrollable.onDidScroll,this.onDidContentSizeChange=this._scrollable.onDidContentSizeChange,this._updateHeight()}dispose(){super.dispose()}getScrollable(){return this._scrollable.getScrollable()}onHeightMaybeChanged(){this._updateHeight()}_configureSmoothScrollDuration(){this._scrollable.setSmoothScrollDuration(this._configuration.options.get(113)?SMOOTH_SCROLLING_TIME:0)}onConfigurationChanged(C){const W=this._configuration.options;if(C.hasChanged(66)&&this._linesLayout.setLineHeight(W.get(66)),C.hasChanged(83)){const V=W.get(83);this._linesLayout.setPadding(V.top,V.bottom)}if(C.hasChanged(143)){const V=W.get(143),U=V.contentWidth,G=V.height,Z=this._scrollable.getScrollDimensions(),X=Z.contentWidth;this._scrollable.setScrollDimensions(new EditorScrollDimensions(U,Z.contentWidth,G,this._getContentHeight(U,G,X)))}else this._updateHeight();C.hasChanged(113)&&this._configureSmoothScrollDuration()}onFlushed(C){this._linesLayout.onFlushed(C)}onLinesDeleted(C,W){this._linesLayout.onLinesDeleted(C,W)}onLinesInserted(C,W){this._linesLayout.onLinesInserted(C,W)}_getHorizontalScrollbarHeight(C,W){const U=this._configuration.options.get(102);return U.horizontal===2||C>=W?0:U.horizontalScrollbarSize}_getContentHeight(C,W,V){const U=this._configuration.options;let G=this._linesLayout.getLinesTotalHeight();return U.get(104)?G+=Math.max(0,W-U.get(66)-U.get(83).bottom):G+=this._getHorizontalScrollbarHeight(C,V),G}_updateHeight(){const C=this._scrollable.getScrollDimensions(),W=C.width,V=C.height,U=C.contentWidth;this._scrollable.setScrollDimensions(new EditorScrollDimensions(W,C.contentWidth,V,this._getContentHeight(W,V,U)))}getCurrentViewport(){const C=this._scrollable.getScrollDimensions(),W=this._scrollable.getCurrentScrollPosition();return new Viewport(W.scrollTop,W.scrollLeft,C.width,C.height)}getFutureViewport(){const C=this._scrollable.getScrollDimensions(),W=this._scrollable.getFutureScrollPosition();return new Viewport(W.scrollTop,W.scrollLeft,C.width,C.height)}_computeContentWidth(){const C=this._configuration.options,W=this._maxLineWidth,V=C.get(144),U=C.get(50),G=C.get(143);if(V.isViewportWrapping){const Z=C.get(72);return W>G.contentWidth+U.typicalHalfwidthCharacterWidth&&Z.enabled&&Z.side==="right"?W+G.verticalScrollbarWidth:W}else{const Z=C.get(103)*U.typicalHalfwidthCharacterWidth,X=this._linesLayout.getWhitespaceMinWidth();return Math.max(W+Z+G.verticalScrollbarWidth,X,this._overlayWidgetsMinWidth)}}setMaxLineWidth(C){this._maxLineWidth=C,this._updateContentWidth()}setOverlayWidgetsMinWidth(C){this._overlayWidgetsMinWidth=C,this._updateContentWidth()}_updateContentWidth(){const C=this._scrollable.getScrollDimensions();this._scrollable.setScrollDimensions(new EditorScrollDimensions(C.width,this._computeContentWidth(),C.height,C.contentHeight)),this._updateHeight()}saveState(){const C=this._scrollable.getFutureScrollPosition(),W=C.scrollTop,V=this._linesLayout.getLineNumberAtOrAfterVerticalOffset(W),U=this._linesLayout.getWhitespaceAccumulatedHeightBeforeLineNumber(V);return{scrollTop:W,scrollTopWithoutViewZones:W-U,scrollLeft:C.scrollLeft}}changeWhitespace(C){const W=this._linesLayout.changeWhitespace(C);return W&&this.onHeightMaybeChanged(),W}getVerticalOffsetForLineNumber(C,W=!1){return this._linesLayout.getVerticalOffsetForLineNumber(C,W)}getVerticalOffsetAfterLineNumber(C,W=!1){return this._linesLayout.getVerticalOffsetAfterLineNumber(C,W)}isAfterLines(C){return this._linesLayout.isAfterLines(C)}isInTopPadding(C){return this._linesLayout.isInTopPadding(C)}isInBottomPadding(C){return this._linesLayout.isInBottomPadding(C)}getLineNumberAtVerticalOffset(C){return this._linesLayout.getLineNumberAtOrAfterVerticalOffset(C)}getWhitespaceAtVerticalOffset(C){return this._linesLayout.getWhitespaceAtVerticalOffset(C)}getLinesViewportData(){const C=this.getCurrentViewport();return this._linesLayout.getLinesViewportData(C.top,C.top+C.height)}getLinesViewportDataAtScrollTop(C){const W=this._scrollable.getScrollDimensions();return C+W.height>W.scrollHeight&&(C=W.scrollHeight-W.height),C<0&&(C=0),this._linesLayout.getLinesViewportData(C,C+W.height)}getWhitespaceViewportData(){const C=this.getCurrentViewport();return this._linesLayout.getWhitespaceViewportData(C.top,C.top+C.height)}getWhitespaces(){return this._linesLayout.getWhitespaces()}getContentWidth(){return this._scrollable.getScrollDimensions().contentWidth}getScrollWidth(){return this._scrollable.getScrollDimensions().scrollWidth}getContentHeight(){return this._scrollable.getScrollDimensions().contentHeight}getScrollHeight(){return this._scrollable.getScrollDimensions().scrollHeight}getCurrentScrollLeft(){return this._scrollable.getCurrentScrollPosition().scrollLeft}getCurrentScrollTop(){return this._scrollable.getCurrentScrollPosition().scrollTop}validateScrollPosition(C){return this._scrollable.validateScrollPosition(C)}setScrollPosition(C,W){W===1?this._scrollable.setScrollPositionNow(C):this._scrollable.setScrollPositionSmooth(C)}hasPendingScrollAnimation(){return this._scrollable.hasPendingScrollAnimation()}deltaScrollNow(C,W){const V=this._scrollable.getCurrentScrollPosition();this._scrollable.setScrollPositionNow({scrollLeft:V.scrollLeft+C,scrollTop:V.scrollTop+W})}}class ViewModelDecorations{constructor(C,W,V,U,G){this.editorId=C,this.model=W,this.configuration=V,this._linesCollection=U,this._coordinatesConverter=G,this._decorationsCache=Object.create(null),this._cachedModelDecorationsResolver=null,this._cachedModelDecorationsResolverViewRange=null}_clearCachedModelDecorationsResolver(){this._cachedModelDecorationsResolver=null,this._cachedModelDecorationsResolverViewRange=null}dispose(){this._decorationsCache=Object.create(null),this._clearCachedModelDecorationsResolver()}reset(){this._decorationsCache=Object.create(null),this._clearCachedModelDecorationsResolver()}onModelDecorationsChanged(){this._decorationsCache=Object.create(null),this._clearCachedModelDecorationsResolver()}onLineMappingChanged(){this._decorationsCache=Object.create(null),this._clearCachedModelDecorationsResolver()}_getOrCreateViewModelDecoration(C){const W=C.id;let V=this._decorationsCache[W];if(!V){const U=C.range,G=C.options;let Z;if(G.isWholeLine){const X=this._coordinatesConverter.convertModelPositionToViewPosition(new Position$1(U.startLineNumber,1),0,!1,!0),Q=this._coordinatesConverter.convertModelPositionToViewPosition(new Position$1(U.endLineNumber,this.model.getLineMaxColumn(U.endLineNumber)),1);Z=new Range$2(X.lineNumber,X.column,Q.lineNumber,Q.column)}else Z=this._coordinatesConverter.convertModelRangeToViewRange(U,1);V=new ViewModelDecoration(Z,G),this._decorationsCache[W]=V}return V}getMinimapDecorationsInRange(C){return this._getDecorationsInRange(C,!0,!1).decorations}getDecorationsViewportData(C){let W=this._cachedModelDecorationsResolver!==null;return W=W&&C.equalsRange(this._cachedModelDecorationsResolverViewRange),W||(this._cachedModelDecorationsResolver=this._getDecorationsInRange(C,!1,!1),this._cachedModelDecorationsResolverViewRange=C),this._cachedModelDecorationsResolver}getInlineDecorationsOnLine(C,W=!1,V=!1){const U=new Range$2(C,this._linesCollection.getViewLineMinColumn(C),C,this._linesCollection.getViewLineMaxColumn(C));return this._getDecorationsInRange(U,W,V).inlineDecorations[0]}_getDecorationsInRange(C,W,V){const U=this._linesCollection.getDecorationsInRange(C,this.editorId,filterValidationDecorations(this.configuration.options),W,V),G=C.startLineNumber,Z=C.endLineNumber,X=[];let Q=0;const J=[];for(let ee=G;ee<=Z;ee++)J[ee-G]=[];for(let ee=0,te=U.length;ee<te;ee++){const ie=U[ee],ne=ie.options;if(!isModelDecorationVisible(this.model,ie))continue;const oe=this._getOrCreateViewModelDecoration(ie),re=oe.range;if(X[Q++]=oe,ne.inlineClassName){const ae=new InlineDecoration(re,ne.inlineClassName,ne.inlineClassNameAffectsLetterSpacing?3:0),se=Math.max(G,re.startLineNumber),le=Math.min(Z,re.endLineNumber);for(let ce=se;ce<=le;ce++)J[ce-G].push(ae)}if(ne.beforeContentClassName&&G<=re.startLineNumber&&re.startLineNumber<=Z){const ae=new InlineDecoration(new Range$2(re.startLineNumber,re.startColumn,re.startLineNumber,re.startColumn),ne.beforeContentClassName,1);J[re.startLineNumber-G].push(ae)}if(ne.afterContentClassName&&G<=re.endLineNumber&&re.endLineNumber<=Z){const ae=new InlineDecoration(new Range$2(re.endLineNumber,re.endColumn,re.endLineNumber,re.endColumn),ne.afterContentClassName,2);J[re.endLineNumber-G].push(ae)}}return{decorations:X,inlineDecorations:J}}}function isModelDecorationVisible(K,C){return!(C.options.hideInCommentTokens&&isModelDecorationInComment(K,C)||C.options.hideInStringTokens&&isModelDecorationInString(K,C))}function isModelDecorationInComment(K,C){return testTokensInRange(K,C.range,W=>W===1)}function isModelDecorationInString(K,C){return testTokensInRange(K,C.range,W=>W===2)}function testTokensInRange(K,C,W){for(let V=C.startLineNumber;V<=C.endLineNumber;V++){const U=K.tokenization.getLineTokens(V),G=V===C.startLineNumber,Z=V===C.endLineNumber;let X=G?U.findTokenIndexAtOffset(C.startColumn-1):0;for(;X<U.getCount()&&!(Z&&U.getStartOffset(X)>C.endColumn-1);){if(!W(U.getStandardTokenType(X)))return!1;X++}}return!0}function createModelLineProjection(K,C){return K===null?C?IdentityModelLineProjection.INSTANCE:HiddenModelLineProjection.INSTANCE:new ModelLineProjection(K,C)}class ModelLineProjection{constructor(C,W){this._projectionData=C,this._isVisible=W}isVisible(){return this._isVisible}setVisible(C){return this._isVisible=C,this}getProjectionData(){return this._projectionData}getViewLineCount(){return this._isVisible?this._projectionData.getOutputLineCount():0}getViewLineContent(C,W,V){this._assertVisible();const U=V>0?this._projectionData.breakOffsets[V-1]:0,G=this._projectionData.breakOffsets[V];let Z;if(this._projectionData.injectionOffsets!==null){const X=this._projectionData.injectionOffsets.map((J,ee)=>new LineInjectedText(0,0,J+1,this._projectionData.injectionOptions[ee],0));Z=LineInjectedText.applyInjectedText(C.getLineContent(W),X).substring(U,G)}else Z=C.getValueInRange({startLineNumber:W,startColumn:U+1,endLineNumber:W,endColumn:G+1});return V>0&&(Z=spaces(this._projectionData.wrappedTextIndentLength)+Z),Z}getViewLineLength(C,W,V){return this._assertVisible(),this._projectionData.getLineLength(V)}getViewLineMinColumn(C,W,V){return this._assertVisible(),this._projectionData.getMinOutputOffset(V)+1}getViewLineMaxColumn(C,W,V){return this._assertVisible(),this._projectionData.getMaxOutputOffset(V)+1}getViewLineData(C,W,V){const U=new Array;return this.getViewLinesData(C,W,V,1,0,[!0],U),U[0]}getViewLinesData(C,W,V,U,G,Z,X){this._assertVisible();const Q=this._projectionData,J=Q.injectionOffsets,ee=Q.injectionOptions;let te=null;if(J){te=[];let ne=0,oe=0;for(let re=0;re<Q.getOutputLineCount();re++){const ae=new Array;te[re]=ae;const se=re>0?Q.breakOffsets[re-1]:0,le=Q.breakOffsets[re];for(;oe<J.length;){const ce=ee[oe].content.length,de=J[oe]+ne,ue=de+ce;if(de>le)break;if(se<ue){const ge=ee[oe];if(ge.inlineClassName){const he=re>0?Q.wrappedTextIndentLength:0,fe=he+Math.max(de-se,0),pe=he+Math.min(ue-se,le-se);fe!==pe&&ae.push(new SingleLineInlineDecoration(fe,pe,ge.inlineClassName,ge.inlineClassNameAffectsLetterSpacing))}}if(ue<=le)ne+=ce,oe++;else break}}}let ie;J?ie=C.tokenization.getLineTokens(W).withInserted(J.map((ne,oe)=>({offset:ne,text:ee[oe].content,tokenMetadata:LineTokens.defaultTokenMetadata}))):ie=C.tokenization.getLineTokens(W);for(let ne=V;ne<V+U;ne++){const oe=G+ne-V;if(!Z[oe]){X[oe]=null;continue}X[oe]=this._getViewLineData(ie,te?te[ne]:null,ne)}}_getViewLineData(C,W,V){this._assertVisible();const U=this._projectionData,G=V>0?U.wrappedTextIndentLength:0,Z=V>0?U.breakOffsets[V-1]:0,X=U.breakOffsets[V],Q=C.sliceAndInflate(Z,X,G);let J=Q.getLineContent();V>0&&(J=spaces(U.wrappedTextIndentLength)+J);const ee=this._projectionData.getMinOutputOffset(V)+1,te=J.length+1,ie=V+1<this.getViewLineCount(),ne=V===0?0:U.breakOffsetsVisibleColumn[V-1];return new ViewLineData(J,ie,ee,te,ne,Q,W)}getModelColumnOfViewPosition(C,W){return this._assertVisible(),this._projectionData.translateToInputOffset(C,W-1)+1}getViewPositionOfModelPosition(C,W,V=2){return this._assertVisible(),this._projectionData.translateToOutputPosition(W-1,V).toPosition(C)}getViewLineNumberOfModelPosition(C,W){this._assertVisible();const V=this._projectionData.translateToOutputPosition(W-1);return C+V.outputLineIndex}normalizePosition(C,W,V){const U=W.lineNumber-C;return this._projectionData.normalizeOutputPosition(C,W.column-1,V).toPosition(U)}getInjectedTextAt(C,W){return this._projectionData.getInjectedText(C,W-1)}_assertVisible(){if(!this._isVisible)throw new Error("Not supported")}}class IdentityModelLineProjection{constructor(){}isVisible(){return!0}setVisible(C){return C?this:HiddenModelLineProjection.INSTANCE}getProjectionData(){return null}getViewLineCount(){return 1}getViewLineContent(C,W,V){return C.getLineContent(W)}getViewLineLength(C,W,V){return C.getLineLength(W)}getViewLineMinColumn(C,W,V){return C.getLineMinColumn(W)}getViewLineMaxColumn(C,W,V){return C.getLineMaxColumn(W)}getViewLineData(C,W,V){const U=C.tokenization.getLineTokens(W),G=U.getLineContent();return new ViewLineData(G,!1,1,G.length+1,0,U.inflate(),null)}getViewLinesData(C,W,V,U,G,Z,X){if(!Z[G]){X[G]=null;return}X[G]=this.getViewLineData(C,W,0)}getModelColumnOfViewPosition(C,W){return W}getViewPositionOfModelPosition(C,W){return new Position$1(C,W)}getViewLineNumberOfModelPosition(C,W){return C}normalizePosition(C,W,V){return W}getInjectedTextAt(C,W){return null}}IdentityModelLineProjection.INSTANCE=new IdentityModelLineProjection;class HiddenModelLineProjection{constructor(){}isVisible(){return!1}setVisible(C){return C?IdentityModelLineProjection.INSTANCE:this}getProjectionData(){return null}getViewLineCount(){return 0}getViewLineContent(C,W,V){throw new Error("Not supported")}getViewLineLength(C,W,V){throw new Error("Not supported")}getViewLineMinColumn(C,W,V){throw new Error("Not supported")}getViewLineMaxColumn(C,W,V){throw new Error("Not supported")}getViewLineData(C,W,V){throw new Error("Not supported")}getViewLinesData(C,W,V,U,G,Z,X){throw new Error("Not supported")}getModelColumnOfViewPosition(C,W){throw new Error("Not supported")}getViewPositionOfModelPosition(C,W){throw new Error("Not supported")}getViewLineNumberOfModelPosition(C,W){throw new Error("Not supported")}normalizePosition(C,W,V){throw new Error("Not supported")}getInjectedTextAt(C,W){throw new Error("Not supported")}}HiddenModelLineProjection.INSTANCE=new HiddenModelLineProjection;const _spaces=[""];function spaces(K){if(K>=_spaces.length)for(let C=1;C<=K;C++)_spaces[C]=_makeSpaces(C);return _spaces[K]}function _makeSpaces(K){return new Array(K+1).join(" ")}class ViewModelLinesFromProjectedModel{constructor(C,W,V,U,G,Z,X,Q,J,ee){this._editorId=C,this.model=W,this._validModelVersionId=-1,this._domLineBreaksComputerFactory=V,this._monospaceLineBreaksComputerFactory=U,this.fontInfo=G,this.tabSize=Z,this.wrappingStrategy=X,this.wrappingColumn=Q,this.wrappingIndent=J,this.wordBreak=ee,this._constructLines(!0,null)}dispose(){this.hiddenAreasDecorationIds=this.model.deltaDecorations(this.hiddenAreasDecorationIds,[])}createCoordinatesConverter(){return new CoordinatesConverter(this)}_constructLines(C,W){this.modelLineProjections=[],C&&(this.hiddenAreasDecorationIds=this.model.deltaDecorations(this.hiddenAreasDecorationIds,[]));const V=this.model.getLinesContent(),U=this.model.getInjectedTextDecorations(this._editorId),G=V.length,Z=this.createLineBreaksComputer(),X=new ArrayQueue(LineInjectedText.fromDecorations(U));for(let re=0;re<G;re++){const ae=X.takeWhile(se=>se.lineNumber===re+1);Z.addRequest(V[re],ae,W?W[re]:null)}const Q=Z.finalize(),J=[],ee=this.hiddenAreasDecorationIds.map(re=>this.model.getDecorationRange(re)).sort(Range$2.compareRangesUsingStarts);let te=1,ie=0,ne=-1,oe=ne+1<ee.length?ie+1:G+2;for(let re=0;re<G;re++){const ae=re+1;ae===oe&&(ne++,te=ee[ne].startLineNumber,ie=ee[ne].endLineNumber,oe=ne+1<ee.length?ie+1:G+2);const se=ae>=te&&ae<=ie,le=createModelLineProjection(Q[re],!se);J[re]=le.getViewLineCount(),this.modelLineProjections[re]=le}this._validModelVersionId=this.model.getVersionId(),this.projectedModelLineLineCounts=new ConstantTimePrefixSumComputer(J)}getHiddenAreas(){return this.hiddenAreasDecorationIds.map(C=>this.model.getDecorationRange(C))}setHiddenAreas(C){const W=C.map(ie=>this.model.validateRange(ie)),V=normalizeLineRanges(W),U=this.hiddenAreasDecorationIds.map(ie=>this.model.getDecorationRange(ie)).sort(Range$2.compareRangesUsingStarts);if(V.length===U.length){let ie=!1;for(let ne=0;ne<V.length;ne++)if(!V[ne].equalsRange(U[ne])){ie=!0;break}if(!ie)return!1}const G=V.map(ie=>({range:ie,options:ModelDecorationOptions.EMPTY}));this.hiddenAreasDecorationIds=this.model.deltaDecorations(this.hiddenAreasDecorationIds,G);const Z=V;let X=1,Q=0,J=-1,ee=J+1<Z.length?Q+1:this.modelLineProjections.length+2,te=!1;for(let ie=0;ie<this.modelLineProjections.length;ie++){const ne=ie+1;ne===ee&&(J++,X=Z[J].startLineNumber,Q=Z[J].endLineNumber,ee=J+1<Z.length?Q+1:this.modelLineProjections.length+2);let oe=!1;if(ne>=X&&ne<=Q?this.modelLineProjections[ie].isVisible()&&(this.modelLineProjections[ie]=this.modelLineProjections[ie].setVisible(!1),oe=!0):(te=!0,this.modelLineProjections[ie].isVisible()||(this.modelLineProjections[ie]=this.modelLineProjections[ie].setVisible(!0),oe=!0)),oe){const re=this.modelLineProjections[ie].getViewLineCount();this.projectedModelLineLineCounts.setValue(ie,re)}}return te||this.setHiddenAreas([]),!0}modelPositionIsVisible(C,W){return C<1||C>this.modelLineProjections.length?!1:this.modelLineProjections[C-1].isVisible()}getModelLineViewLineCount(C){return C<1||C>this.modelLineProjections.length?1:this.modelLineProjections[C-1].getViewLineCount()}setTabSize(C){return this.tabSize===C?!1:(this.tabSize=C,this._constructLines(!1,null),!0)}setWrappingSettings(C,W,V,U,G){const Z=this.fontInfo.equals(C),X=this.wrappingStrategy===W,Q=this.wrappingColumn===V,J=this.wrappingIndent===U,ee=this.wordBreak===G;if(Z&&X&&Q&&J&&ee)return!1;const te=Z&&X&&!Q&&J&&ee;this.fontInfo=C,this.wrappingStrategy=W,this.wrappingColumn=V,this.wrappingIndent=U,this.wordBreak=G;let ie=null;if(te){ie=[];for(let ne=0,oe=this.modelLineProjections.length;ne<oe;ne++)ie[ne]=this.modelLineProjections[ne].getProjectionData()}return this._constructLines(!1,ie),!0}createLineBreaksComputer(){return(this.wrappingStrategy==="advanced"?this._domLineBreaksComputerFactory:this._monospaceLineBreaksComputerFactory).createLineBreaksComputer(this.fontInfo,this.tabSize,this.wrappingColumn,this.wrappingIndent,this.wordBreak)}onModelFlushed(){this._constructLines(!0,null)}onModelLinesDeleted(C,W,V){if(!C||C<=this._validModelVersionId)return null;const U=W===1?1:this.projectedModelLineLineCounts.getPrefixSum(W-1)+1,G=this.projectedModelLineLineCounts.getPrefixSum(V);return this.modelLineProjections.splice(W-1,V-W+1),this.projectedModelLineLineCounts.removeValues(W-1,V-W+1),new ViewLinesDeletedEvent(U,G)}onModelLinesInserted(C,W,V,U){if(!C||C<=this._validModelVersionId)return null;const G=W>2&&!this.modelLineProjections[W-2].isVisible(),Z=W===1?1:this.projectedModelLineLineCounts.getPrefixSum(W-1)+1;let X=0;const Q=[],J=[];for(let ee=0,te=U.length;ee<te;ee++){const ie=createModelLineProjection(U[ee],!G);Q.push(ie);const ne=ie.getViewLineCount();X+=ne,J[ee]=ne}return this.modelLineProjections=this.modelLineProjections.slice(0,W-1).concat(Q).concat(this.modelLineProjections.slice(W-1)),this.projectedModelLineLineCounts.insertValues(W-1,J),new ViewLinesInsertedEvent(Z,Z+X-1)}onModelLineChanged(C,W,V){if(C!==null&&C<=this._validModelVersionId)return[!1,null,null,null];const U=W-1,G=this.modelLineProjections[U].getViewLineCount(),Z=this.modelLineProjections[U].isVisible(),X=createModelLineProjection(V,Z);this.modelLineProjections[U]=X;const Q=this.modelLineProjections[U].getViewLineCount();let J=!1,ee=0,te=-1,ie=0,ne=-1,oe=0,re=-1;G>Q?(ee=this.projectedModelLineLineCounts.getPrefixSum(W-1)+1,te=ee+Q-1,oe=te+1,re=oe+(G-Q)-1,J=!0):G<Q?(ee=this.projectedModelLineLineCounts.getPrefixSum(W-1)+1,te=ee+G-1,ie=te+1,ne=ie+(Q-G)-1,J=!0):(ee=this.projectedModelLineLineCounts.getPrefixSum(W-1)+1,te=ee+Q-1),this.projectedModelLineLineCounts.setValue(U,Q);const ae=ee<=te?new ViewLinesChangedEvent(ee,te-ee+1):null,se=ie<=ne?new ViewLinesInsertedEvent(ie,ne):null,le=oe<=re?new ViewLinesDeletedEvent(oe,re):null;return[J,ae,se,le]}acceptVersionId(C){this._validModelVersionId=C,this.modelLineProjections.length===1&&!this.modelLineProjections[0].isVisible()&&this.setHiddenAreas([])}getViewLineCount(){return this.projectedModelLineLineCounts.getTotalSum()}_toValidViewLineNumber(C){if(C<1)return 1;const W=this.getViewLineCount();return C>W?W:C|0}getActiveIndentGuide(C,W,V){C=this._toValidViewLineNumber(C),W=this._toValidViewLineNumber(W),V=this._toValidViewLineNumber(V);const U=this.convertViewPositionToModelPosition(C,this.getViewLineMinColumn(C)),G=this.convertViewPositionToModelPosition(W,this.getViewLineMinColumn(W)),Z=this.convertViewPositionToModelPosition(V,this.getViewLineMinColumn(V)),X=this.model.guides.getActiveIndentGuide(U.lineNumber,G.lineNumber,Z.lineNumber),Q=this.convertModelPositionToViewPosition(X.startLineNumber,1),J=this.convertModelPositionToViewPosition(X.endLineNumber,this.model.getLineMaxColumn(X.endLineNumber));return{startLineNumber:Q.lineNumber,endLineNumber:J.lineNumber,indent:X.indent}}getViewLineInfo(C){C=this._toValidViewLineNumber(C);const W=this.projectedModelLineLineCounts.getIndexOf(C-1),V=W.index,U=W.remainder;return new ViewLineInfo(V+1,U)}getMinColumnOfViewLine(C){return this.modelLineProjections[C.modelLineNumber-1].getViewLineMinColumn(this.model,C.modelLineNumber,C.modelLineWrappedLineIdx)}getMaxColumnOfViewLine(C){return this.modelLineProjections[C.modelLineNumber-1].getViewLineMaxColumn(this.model,C.modelLineNumber,C.modelLineWrappedLineIdx)}getModelStartPositionOfViewLine(C){const W=this.modelLineProjections[C.modelLineNumber-1],V=W.getViewLineMinColumn(this.model,C.modelLineNumber,C.modelLineWrappedLineIdx),U=W.getModelColumnOfViewPosition(C.modelLineWrappedLineIdx,V);return new Position$1(C.modelLineNumber,U)}getModelEndPositionOfViewLine(C){const W=this.modelLineProjections[C.modelLineNumber-1],V=W.getViewLineMaxColumn(this.model,C.modelLineNumber,C.modelLineWrappedLineIdx),U=W.getModelColumnOfViewPosition(C.modelLineWrappedLineIdx,V);return new Position$1(C.modelLineNumber,U)}getViewLineInfosGroupedByModelRanges(C,W){const V=this.getViewLineInfo(C),U=this.getViewLineInfo(W),G=new Array;let Z=this.getModelStartPositionOfViewLine(V),X=new Array;for(let Q=V.modelLineNumber;Q<=U.modelLineNumber;Q++){const J=this.modelLineProjections[Q-1];if(J.isVisible()){const ee=Q===V.modelLineNumber?V.modelLineWrappedLineIdx:0,te=Q===U.modelLineNumber?U.modelLineWrappedLineIdx+1:J.getViewLineCount();for(let ie=ee;ie<te;ie++)X.push(new ViewLineInfo(Q,ie))}if(!J.isVisible()&&Z){const ee=new Position$1(Q-1,this.model.getLineMaxColumn(Q-1)+1),te=Range$2.fromPositions(Z,ee);G.push(new ViewLineInfoGroupedByModelRange(te,X)),X=[],Z=null}else J.isVisible()&&!Z&&(Z=new Position$1(Q,1))}if(Z){const Q=Range$2.fromPositions(Z,this.getModelEndPositionOfViewLine(U));G.push(new ViewLineInfoGroupedByModelRange(Q,X))}return G}getViewLinesBracketGuides(C,W,V,U){const G=V?this.convertViewPositionToModelPosition(V.lineNumber,V.column):null,Z=[];for(const X of this.getViewLineInfosGroupedByModelRanges(C,W)){const Q=X.modelRange.startLineNumber,J=this.model.guides.getLinesBracketGuides(Q,X.modelRange.endLineNumber,G,U);for(const ee of X.viewLines){const ie=J[ee.modelLineNumber-Q].map(ne=>{if(ne.forWrappedLinesAfterColumn!==-1&&this.modelLineProjections[ee.modelLineNumber-1].getViewPositionOfModelPosition(0,ne.forWrappedLinesAfterColumn).lineNumber>=ee.modelLineWrappedLineIdx||ne.forWrappedLinesBeforeOrAtColumn!==-1&&this.modelLineProjections[ee.modelLineNumber-1].getViewPositionOfModelPosition(0,ne.forWrappedLinesBeforeOrAtColumn).lineNumber<ee.modelLineWrappedLineIdx)return;if(!ne.horizontalLine)return ne;let oe=-1;if(ne.column!==-1){const se=this.modelLineProjections[ee.modelLineNumber-1].getViewPositionOfModelPosition(0,ne.column);if(se.lineNumber===ee.modelLineWrappedLineIdx)oe=se.column;else if(se.lineNumber<ee.modelLineWrappedLineIdx)oe=this.getMinColumnOfViewLine(ee);else if(se.lineNumber>ee.modelLineWrappedLineIdx)return}const re=this.convertModelPositionToViewPosition(ee.modelLineNumber,ne.horizontalLine.endColumn),ae=this.modelLineProjections[ee.modelLineNumber-1].getViewPositionOfModelPosition(0,ne.horizontalLine.endColumn);return ae.lineNumber===ee.modelLineWrappedLineIdx?new IndentGuide(ne.visibleColumn,oe,ne.className,new IndentGuideHorizontalLine(ne.horizontalLine.top,re.column),-1,-1):ae.lineNumber<ee.modelLineWrappedLineIdx||ne.visibleColumn!==-1?void 0:new IndentGuide(ne.visibleColumn,oe,ne.className,new IndentGuideHorizontalLine(ne.horizontalLine.top,this.getMaxColumnOfViewLine(ee)),-1,-1)});Z.push(ie.filter(ne=>!!ne))}}return Z}getViewLinesIndentGuides(C,W){C=this._toValidViewLineNumber(C),W=this._toValidViewLineNumber(W);const V=this.convertViewPositionToModelPosition(C,this.getViewLineMinColumn(C)),U=this.convertViewPositionToModelPosition(W,this.getViewLineMaxColumn(W));let G=[];const Z=[],X=[],Q=V.lineNumber-1,J=U.lineNumber-1;let ee=null;for(let oe=Q;oe<=J;oe++){const re=this.modelLineProjections[oe];if(re.isVisible()){const ae=re.getViewLineNumberOfModelPosition(0,oe===Q?V.column:1),se=re.getViewLineNumberOfModelPosition(0,this.model.getLineMaxColumn(oe+1)),le=se-ae+1;let ce=0;le>1&&re.getViewLineMinColumn(this.model,oe+1,se)===1&&(ce=ae===0?1:2),Z.push(le),X.push(ce),ee===null&&(ee=new Position$1(oe+1,0))}else ee!==null&&(G=G.concat(this.model.guides.getLinesIndentGuides(ee.lineNumber,oe)),ee=null)}ee!==null&&(G=G.concat(this.model.guides.getLinesIndentGuides(ee.lineNumber,U.lineNumber)),ee=null);const te=W-C+1,ie=new Array(te);let ne=0;for(let oe=0,re=G.length;oe<re;oe++){let ae=G[oe];const se=Math.min(te-ne,Z[oe]),le=X[oe];let ce;le===2?ce=0:le===1?ce=1:ce=se;for(let de=0;de<se;de++)de===ce&&(ae=0),ie[ne++]=ae}return ie}getViewLineContent(C){const W=this.getViewLineInfo(C);return this.modelLineProjections[W.modelLineNumber-1].getViewLineContent(this.model,W.modelLineNumber,W.modelLineWrappedLineIdx)}getViewLineLength(C){const W=this.getViewLineInfo(C);return this.modelLineProjections[W.modelLineNumber-1].getViewLineLength(this.model,W.modelLineNumber,W.modelLineWrappedLineIdx)}getViewLineMinColumn(C){const W=this.getViewLineInfo(C);return this.modelLineProjections[W.modelLineNumber-1].getViewLineMinColumn(this.model,W.modelLineNumber,W.modelLineWrappedLineIdx)}getViewLineMaxColumn(C){const W=this.getViewLineInfo(C);return this.modelLineProjections[W.modelLineNumber-1].getViewLineMaxColumn(this.model,W.modelLineNumber,W.modelLineWrappedLineIdx)}getViewLineData(C){const W=this.getViewLineInfo(C);return this.modelLineProjections[W.modelLineNumber-1].getViewLineData(this.model,W.modelLineNumber,W.modelLineWrappedLineIdx)}getViewLinesData(C,W,V){C=this._toValidViewLineNumber(C),W=this._toValidViewLineNumber(W);const U=this.projectedModelLineLineCounts.getIndexOf(C-1);let G=C;const Z=U.index,X=U.remainder,Q=[];for(let J=Z,ee=this.model.getLineCount();J<ee;J++){const te=this.modelLineProjections[J];if(!te.isVisible())continue;const ie=J===Z?X:0;let ne=te.getViewLineCount()-ie,oe=!1;if(G+ne>W&&(oe=!0,ne=W-G+1),te.getViewLinesData(this.model,J+1,ie,ne,G-C,V,Q),G+=ne,oe)break}return Q}validateViewPosition(C,W,V){C=this._toValidViewLineNumber(C);const U=this.projectedModelLineLineCounts.getIndexOf(C-1),G=U.index,Z=U.remainder,X=this.modelLineProjections[G],Q=X.getViewLineMinColumn(this.model,G+1,Z),J=X.getViewLineMaxColumn(this.model,G+1,Z);W<Q&&(W=Q),W>J&&(W=J);const ee=X.getModelColumnOfViewPosition(Z,W);return this.model.validatePosition(new Position$1(G+1,ee)).equals(V)?new Position$1(C,W):this.convertModelPositionToViewPosition(V.lineNumber,V.column)}validateViewRange(C,W){const V=this.validateViewPosition(C.startLineNumber,C.startColumn,W.getStartPosition()),U=this.validateViewPosition(C.endLineNumber,C.endColumn,W.getEndPosition());return new Range$2(V.lineNumber,V.column,U.lineNumber,U.column)}convertViewPositionToModelPosition(C,W){const V=this.getViewLineInfo(C),U=this.modelLineProjections[V.modelLineNumber-1].getModelColumnOfViewPosition(V.modelLineWrappedLineIdx,W);return this.model.validatePosition(new Position$1(V.modelLineNumber,U))}convertViewRangeToModelRange(C){const W=this.convertViewPositionToModelPosition(C.startLineNumber,C.startColumn),V=this.convertViewPositionToModelPosition(C.endLineNumber,C.endColumn);return new Range$2(W.lineNumber,W.column,V.lineNumber,V.column)}convertModelPositionToViewPosition(C,W,V=2,U=!1,G=!1){const Z=this.model.validatePosition(new Position$1(C,W)),X=Z.lineNumber,Q=Z.column;let J=X-1,ee=!1;if(G)for(;J<this.modelLineProjections.length&&!this.modelLineProjections[J].isVisible();)J++,ee=!0;else for(;J>0&&!this.modelLineProjections[J].isVisible();)J--,ee=!0;if(J===0&&!this.modelLineProjections[J].isVisible())return new Position$1(U?0:1,1);const te=1+this.projectedModelLineLineCounts.getPrefixSum(J);let ie;return ee?G?ie=this.modelLineProjections[J].getViewPositionOfModelPosition(te,1,V):ie=this.modelLineProjections[J].getViewPositionOfModelPosition(te,this.model.getLineMaxColumn(J+1),V):ie=this.modelLineProjections[X-1].getViewPositionOfModelPosition(te,Q,V),ie}convertModelRangeToViewRange(C,W=0){if(C.isEmpty()){const V=this.convertModelPositionToViewPosition(C.startLineNumber,C.startColumn,W);return Range$2.fromPositions(V)}else{const V=this.convertModelPositionToViewPosition(C.startLineNumber,C.startColumn,1),U=this.convertModelPositionToViewPosition(C.endLineNumber,C.endColumn,0);return new Range$2(V.lineNumber,V.column,U.lineNumber,U.column)}}getViewLineNumberOfModelPosition(C,W){let V=C-1;if(this.modelLineProjections[V].isVisible()){const G=1+this.projectedModelLineLineCounts.getPrefixSum(V);return this.modelLineProjections[V].getViewLineNumberOfModelPosition(G,W)}for(;V>0&&!this.modelLineProjections[V].isVisible();)V--;if(V===0&&!this.modelLineProjections[V].isVisible())return 1;const U=1+this.projectedModelLineLineCounts.getPrefixSum(V);return this.modelLineProjections[V].getViewLineNumberOfModelPosition(U,this.model.getLineMaxColumn(V+1))}getDecorationsInRange(C,W,V,U,G){const Z=this.convertViewPositionToModelPosition(C.startLineNumber,C.startColumn),X=this.convertViewPositionToModelPosition(C.endLineNumber,C.endColumn);if(X.lineNumber-Z.lineNumber<=C.endLineNumber-C.startLineNumber)return this.model.getDecorationsInRange(new Range$2(Z.lineNumber,1,X.lineNumber,X.column),W,V,U,G);let Q=[];const J=Z.lineNumber-1,ee=X.lineNumber-1;let te=null;for(let re=J;re<=ee;re++)if(this.modelLineProjections[re].isVisible())te===null&&(te=new Position$1(re+1,re===J?Z.column:1));else if(te!==null){const se=this.model.getLineMaxColumn(re);Q=Q.concat(this.model.getDecorationsInRange(new Range$2(te.lineNumber,te.column,re,se),W,V,U)),te=null}te!==null&&(Q=Q.concat(this.model.getDecorationsInRange(new Range$2(te.lineNumber,te.column,X.lineNumber,X.column),W,V,U)),te=null),Q.sort((re,ae)=>{const se=Range$2.compareRangesUsingStarts(re.range,ae.range);return se===0?re.id<ae.id?-1:re.id>ae.id?1:0:se});const ie=[];let ne=0,oe=null;for(const re of Q){const ae=re.id;oe!==ae&&(oe=ae,ie[ne++]=re)}return ie}getInjectedTextAt(C){const W=this.getViewLineInfo(C.lineNumber);return this.modelLineProjections[W.modelLineNumber-1].getInjectedTextAt(W.modelLineWrappedLineIdx,C.column)}normalizePosition(C,W){const V=this.getViewLineInfo(C.lineNumber);return this.modelLineProjections[V.modelLineNumber-1].normalizePosition(V.modelLineWrappedLineIdx,C,W)}getLineIndentColumn(C){const W=this.getViewLineInfo(C);return W.modelLineWrappedLineIdx===0?this.model.getLineIndentColumn(W.modelLineNumber):0}}function normalizeLineRanges(K){if(K.length===0)return[];const C=K.slice();C.sort(Range$2.compareRangesUsingStarts);const W=[];let V=C[0].startLineNumber,U=C[0].endLineNumber;for(let G=1,Z=C.length;G<Z;G++){const X=C[G];X.startLineNumber>U+1?(W.push(new Range$2(V,1,U,1)),V=X.startLineNumber,U=X.endLineNumber):X.endLineNumber>U&&(U=X.endLineNumber)}return W.push(new Range$2(V,1,U,1)),W}class ViewLineInfo{constructor(C,W){this.modelLineNumber=C,this.modelLineWrappedLineIdx=W}}class ViewLineInfoGroupedByModelRange{constructor(C,W){this.modelRange=C,this.viewLines=W}}class CoordinatesConverter{constructor(C){this._lines=C}convertViewPositionToModelPosition(C){return this._lines.convertViewPositionToModelPosition(C.lineNumber,C.column)}convertViewRangeToModelRange(C){return this._lines.convertViewRangeToModelRange(C)}validateViewPosition(C,W){return this._lines.validateViewPosition(C.lineNumber,C.column,W)}validateViewRange(C,W){return this._lines.validateViewRange(C,W)}convertModelPositionToViewPosition(C,W,V,U){return this._lines.convertModelPositionToViewPosition(C.lineNumber,C.column,W,V,U)}convertModelRangeToViewRange(C,W){return this._lines.convertModelRangeToViewRange(C,W)}modelPositionIsVisible(C){return this._lines.modelPositionIsVisible(C.lineNumber,C.column)}getModelLineViewLineCount(C){return this._lines.getModelLineViewLineCount(C)}getViewLineNumberOfModelPosition(C,W){return this._lines.getViewLineNumberOfModelPosition(C,W)}}class ViewModelLinesFromModelAsIs{constructor(C){this.model=C}dispose(){}createCoordinatesConverter(){return new IdentityCoordinatesConverter(this)}getHiddenAreas(){return[]}setHiddenAreas(C){return!1}setTabSize(C){return!1}setWrappingSettings(C,W,V,U){return!1}createLineBreaksComputer(){const C=[];return{addRequest:(W,V,U)=>{C.push(null)},finalize:()=>C}}onModelFlushed(){}onModelLinesDeleted(C,W,V){return new ViewLinesDeletedEvent(W,V)}onModelLinesInserted(C,W,V,U){return new ViewLinesInsertedEvent(W,V)}onModelLineChanged(C,W,V){return[!1,new ViewLinesChangedEvent(W,1),null,null]}acceptVersionId(C){}getViewLineCount(){return this.model.getLineCount()}getActiveIndentGuide(C,W,V){return{startLineNumber:C,endLineNumber:C,indent:0}}getViewLinesBracketGuides(C,W,V){return new Array(W-C+1).fill([])}getViewLinesIndentGuides(C,W){const V=W-C+1,U=new Array(V);for(let G=0;G<V;G++)U[G]=0;return U}getViewLineContent(C){return this.model.getLineContent(C)}getViewLineLength(C){return this.model.getLineLength(C)}getViewLineMinColumn(C){return this.model.getLineMinColumn(C)}getViewLineMaxColumn(C){return this.model.getLineMaxColumn(C)}getViewLineData(C){const W=this.model.tokenization.getLineTokens(C),V=W.getLineContent();return new ViewLineData(V,!1,1,V.length+1,0,W.inflate(),null)}getViewLinesData(C,W,V){const U=this.model.getLineCount();C=Math.min(Math.max(1,C),U),W=Math.min(Math.max(1,W),U);const G=[];for(let Z=C;Z<=W;Z++){const X=Z-C;G[X]=V[X]?this.getViewLineData(Z):null}return G}getDecorationsInRange(C,W,V,U,G){return this.model.getDecorationsInRange(C,W,V,U,G)}normalizePosition(C,W){return this.model.normalizePosition(C,W)}getLineIndentColumn(C){return this.model.getLineIndentColumn(C)}getInjectedTextAt(C){return null}}class IdentityCoordinatesConverter{constructor(C){this._lines=C}_validPosition(C){return this._lines.model.validatePosition(C)}_validRange(C){return this._lines.model.validateRange(C)}convertViewPositionToModelPosition(C){return this._validPosition(C)}convertViewRangeToModelRange(C){return this._validRange(C)}validateViewPosition(C,W){return this._validPosition(W)}validateViewRange(C,W){return this._validRange(W)}convertModelPositionToViewPosition(C){return this._validPosition(C)}convertModelRangeToViewRange(C){return this._validRange(C)}modelPositionIsVisible(C){const W=this._lines.model.getLineCount();return!(C.lineNumber<1||C.lineNumber>W)}getModelLineViewLineCount(C){return 1}getViewLineNumberOfModelPosition(C,W){return C}}let ViewModel$1=class extends Disposable{constructor(C,W,V,U,G,Z,X,Q,J){if(super(),this.languageConfigurationService=X,this._themeService=Q,this._attachedView=J,this.hiddenAreasModel=new HiddenAreasModel,this.previousHiddenAreas=[],this._editorId=C,this._configuration=W,this.model=V,this._eventDispatcher=new ViewModelEventDispatcher,this.onEvent=this._eventDispatcher.onEvent,this.cursorConfig=new CursorConfiguration(this.model.getLanguageId(),this.model.getOptions(),this._configuration,this.languageConfigurationService),this._updateConfigurationViewLineCount=this._register(new RunOnceScheduler(()=>this._updateConfigurationViewLineCountNow(),0)),this._hasFocus=!1,this._viewportStart=ViewportStart.create(this.model),this.model.isTooLargeForTokenization())this._lines=new ViewModelLinesFromModelAsIs(this.model);else{const ee=this._configuration.options,te=ee.get(50),ie=ee.get(137),ne=ee.get(144),oe=ee.get(136),re=ee.get(128);this._lines=new ViewModelLinesFromProjectedModel(this._editorId,this.model,U,G,te,this.model.getOptions().tabSize,ie,ne.wrappingColumn,oe,re)}this.coordinatesConverter=this._lines.createCoordinatesConverter(),this._cursor=this._register(new CursorsController(V,this,this.coordinatesConverter,this.cursorConfig)),this.viewLayout=this._register(new ViewLayout(this._configuration,this.getLineCount(),Z)),this._register(this.viewLayout.onDidScroll(ee=>{ee.scrollTopChanged&&this._handleVisibleLinesChanged(),ee.scrollTopChanged&&this._viewportStart.invalidate(),this._eventDispatcher.emitSingleViewEvent(new ViewScrollChangedEvent(ee)),this._eventDispatcher.emitOutgoingEvent(new ScrollChangedEvent(ee.oldScrollWidth,ee.oldScrollLeft,ee.oldScrollHeight,ee.oldScrollTop,ee.scrollWidth,ee.scrollLeft,ee.scrollHeight,ee.scrollTop))})),this._register(this.viewLayout.onDidContentSizeChange(ee=>{this._eventDispatcher.emitOutgoingEvent(ee)})),this._decorations=new ViewModelDecorations(this._editorId,this.model,this._configuration,this._lines,this.coordinatesConverter),this._registerModelEvents(),this._register(this._configuration.onDidChangeFast(ee=>{try{const te=this._eventDispatcher.beginEmitViewEvents();this._onConfigurationChanged(te,ee)}finally{this._eventDispatcher.endEmitViewEvents()}})),this._register(MinimapTokensColorTracker.getInstance().onDidChange(()=>{this._eventDispatcher.emitSingleViewEvent(new ViewTokensColorsChangedEvent)})),this._register(this._themeService.onDidColorThemeChange(ee=>{this._invalidateDecorationsColorCache(),this._eventDispatcher.emitSingleViewEvent(new ViewThemeChangedEvent(ee))})),this._updateConfigurationViewLineCountNow()}dispose(){super.dispose(),this._decorations.dispose(),this._lines.dispose(),this._viewportStart.dispose(),this._eventDispatcher.dispose()}createLineBreaksComputer(){return this._lines.createLineBreaksComputer()}addViewEventHandler(C){this._eventDispatcher.addViewEventHandler(C)}removeViewEventHandler(C){this._eventDispatcher.removeViewEventHandler(C)}_updateConfigurationViewLineCountNow(){this._configuration.setViewLineCount(this._lines.getViewLineCount())}getModelVisibleRanges(){const C=this.viewLayout.getLinesViewportData(),W=new Range$2(C.startLineNumber,this.getLineMinColumn(C.startLineNumber),C.endLineNumber,this.getLineMaxColumn(C.endLineNumber));return this._toModelVisibleRanges(W)}visibleLinesStabilized(){const C=this.getModelVisibleRanges();this._attachedView.setVisibleLines(C,!0)}_handleVisibleLinesChanged(){const C=this.getModelVisibleRanges();this._attachedView.setVisibleLines(C,!1)}setHasFocus(C){this._hasFocus=C,this._cursor.setHasFocus(C),this._eventDispatcher.emitSingleViewEvent(new ViewFocusChangedEvent(C)),this._eventDispatcher.emitOutgoingEvent(new FocusChangedEvent(!C,C))}onCompositionStart(){this._eventDispatcher.emitSingleViewEvent(new ViewCompositionStartEvent)}onCompositionEnd(){this._eventDispatcher.emitSingleViewEvent(new ViewCompositionEndEvent)}_captureStableViewport(){if(this._viewportStart.isValid&&this.viewLayout.getCurrentScrollTop()>0){const C=new Position$1(this._viewportStart.viewLineNumber,this.getLineMinColumn(this._viewportStart.viewLineNumber)),W=this.coordinatesConverter.convertViewPositionToModelPosition(C);return new StableViewport(W,this._viewportStart.startLineDelta)}return new StableViewport(null,0)}_onConfigurationChanged(C,W){const V=this._captureStableViewport(),U=this._configuration.options,G=U.get(50),Z=U.get(137),X=U.get(144),Q=U.get(136),J=U.get(128);this._lines.setWrappingSettings(G,Z,X.wrappingColumn,Q,J)&&(C.emitViewEvent(new ViewFlushedEvent),C.emitViewEvent(new ViewLineMappingChangedEvent),C.emitViewEvent(new ViewDecorationsChangedEvent(null)),this._cursor.onLineMappingChanged(C),this._decorations.onLineMappingChanged(),this.viewLayout.onFlushed(this.getLineCount()),this._updateConfigurationViewLineCount.schedule()),W.hasChanged(90)&&(this._decorations.reset(),C.emitViewEvent(new ViewDecorationsChangedEvent(null))),C.emitViewEvent(new ViewConfigurationChangedEvent(W)),this.viewLayout.onConfigurationChanged(W),V.recoverViewportStart(this.coordinatesConverter,this.viewLayout),CursorConfiguration.shouldRecreate(W)&&(this.cursorConfig=new CursorConfiguration(this.model.getLanguageId(),this.model.getOptions(),this._configuration,this.languageConfigurationService),this._cursor.updateConfiguration(this.cursorConfig))}_registerModelEvents(){this._register(this.model.onDidChangeContentOrInjectedText(C=>{try{const V=this._eventDispatcher.beginEmitViewEvents();let U=!1,G=!1;const Z=C instanceof InternalModelContentChangeEvent?C.rawContentChangedEvent.changes:C.changes,X=C instanceof InternalModelContentChangeEvent?C.rawContentChangedEvent.versionId:null,Q=this._lines.createLineBreaksComputer();for(const te of Z)switch(te.changeType){case 4:{for(let ie=0;ie<te.detail.length;ie++){const ne=te.detail[ie];let oe=te.injectedTexts[ie];oe&&(oe=oe.filter(re=>!re.ownerId||re.ownerId===this._editorId)),Q.addRequest(ne,oe,null)}break}case 2:{let ie=null;te.injectedText&&(ie=te.injectedText.filter(ne=>!ne.ownerId||ne.ownerId===this._editorId)),Q.addRequest(te.detail,ie,null);break}}const J=Q.finalize(),ee=new ArrayQueue(J);for(const te of Z)switch(te.changeType){case 1:{this._lines.onModelFlushed(),V.emitViewEvent(new ViewFlushedEvent),this._decorations.reset(),this.viewLayout.onFlushed(this.getLineCount()),U=!0;break}case 3:{const ie=this._lines.onModelLinesDeleted(X,te.fromLineNumber,te.toLineNumber);ie!==null&&(V.emitViewEvent(ie),this.viewLayout.onLinesDeleted(ie.fromLineNumber,ie.toLineNumber)),U=!0;break}case 4:{const ie=ee.takeCount(te.detail.length),ne=this._lines.onModelLinesInserted(X,te.fromLineNumber,te.toLineNumber,ie);ne!==null&&(V.emitViewEvent(ne),this.viewLayout.onLinesInserted(ne.fromLineNumber,ne.toLineNumber)),U=!0;break}case 2:{const ie=ee.dequeue(),[ne,oe,re,ae]=this._lines.onModelLineChanged(X,te.lineNumber,ie);G=ne,oe&&V.emitViewEvent(oe),re&&(V.emitViewEvent(re),this.viewLayout.onLinesInserted(re.fromLineNumber,re.toLineNumber)),ae&&(V.emitViewEvent(ae),this.viewLayout.onLinesDeleted(ae.fromLineNumber,ae.toLineNumber));break}case 5:break}X!==null&&this._lines.acceptVersionId(X),this.viewLayout.onHeightMaybeChanged(),!U&&G&&(V.emitViewEvent(new ViewLineMappingChangedEvent),V.emitViewEvent(new ViewDecorationsChangedEvent(null)),this._cursor.onLineMappingChanged(V),this._decorations.onLineMappingChanged())}finally{this._eventDispatcher.endEmitViewEvents()}const W=this._viewportStart.isValid;if(this._viewportStart.invalidate(),this._configuration.setModelLineCount(this.model.getLineCount()),this._updateConfigurationViewLineCountNow(),!this._hasFocus&&this.model.getAttachedEditorCount()>=2&&W){const V=this.model._getTrackedRange(this._viewportStart.modelTrackedRange);if(V){const U=this.coordinatesConverter.convertModelPositionToViewPosition(V.getStartPosition()),G=this.viewLayout.getVerticalOffsetForLineNumber(U.lineNumber);this.viewLayout.setScrollPosition({scrollTop:G+this._viewportStart.startLineDelta},1)}}try{const V=this._eventDispatcher.beginEmitViewEvents();C instanceof InternalModelContentChangeEvent&&V.emitOutgoingEvent(new ModelContentChangedEvent(C.contentChangedEvent)),this._cursor.onModelContentChanged(V,C)}finally{this._eventDispatcher.endEmitViewEvents()}this._handleVisibleLinesChanged()})),this._register(this.model.onDidChangeTokens(C=>{const W=[];for(let V=0,U=C.ranges.length;V<U;V++){const G=C.ranges[V],Z=this.coordinatesConverter.convertModelPositionToViewPosition(new Position$1(G.fromLineNumber,1)).lineNumber,X=this.coordinatesConverter.convertModelPositionToViewPosition(new Position$1(G.toLineNumber,this.model.getLineMaxColumn(G.toLineNumber))).lineNumber;W[V]={fromLineNumber:Z,toLineNumber:X}}this._eventDispatcher.emitSingleViewEvent(new ViewTokensChangedEvent(W)),this._eventDispatcher.emitOutgoingEvent(new ModelTokensChangedEvent(C))})),this._register(this.model.onDidChangeLanguageConfiguration(C=>{this._eventDispatcher.emitSingleViewEvent(new ViewLanguageConfigurationEvent),this.cursorConfig=new CursorConfiguration(this.model.getLanguageId(),this.model.getOptions(),this._configuration,this.languageConfigurationService),this._cursor.updateConfiguration(this.cursorConfig),this._eventDispatcher.emitOutgoingEvent(new ModelLanguageConfigurationChangedEvent(C))})),this._register(this.model.onDidChangeLanguage(C=>{this.cursorConfig=new CursorConfiguration(this.model.getLanguageId(),this.model.getOptions(),this._configuration,this.languageConfigurationService),this._cursor.updateConfiguration(this.cursorConfig),this._eventDispatcher.emitOutgoingEvent(new ModelLanguageChangedEvent(C))})),this._register(this.model.onDidChangeOptions(C=>{if(this._lines.setTabSize(this.model.getOptions().tabSize)){try{const W=this._eventDispatcher.beginEmitViewEvents();W.emitViewEvent(new ViewFlushedEvent),W.emitViewEvent(new ViewLineMappingChangedEvent),W.emitViewEvent(new ViewDecorationsChangedEvent(null)),this._cursor.onLineMappingChanged(W),this._decorations.onLineMappingChanged(),this.viewLayout.onFlushed(this.getLineCount())}finally{this._eventDispatcher.endEmitViewEvents()}this._updateConfigurationViewLineCount.schedule()}this.cursorConfig=new CursorConfiguration(this.model.getLanguageId(),this.model.getOptions(),this._configuration,this.languageConfigurationService),this._cursor.updateConfiguration(this.cursorConfig),this._eventDispatcher.emitOutgoingEvent(new ModelOptionsChangedEvent(C))})),this._register(this.model.onDidChangeDecorations(C=>{this._decorations.onModelDecorationsChanged(),this._eventDispatcher.emitSingleViewEvent(new ViewDecorationsChangedEvent(C)),this._eventDispatcher.emitOutgoingEvent(new ModelDecorationsChangedEvent(C))}))}setHiddenAreas(C,W){this.hiddenAreasModel.setHiddenAreas(W,C);const V=this.hiddenAreasModel.getMergedRanges();if(V===this.previousHiddenAreas)return;this.previousHiddenAreas=V;const U=this._captureStableViewport();let G=!1;try{const Z=this._eventDispatcher.beginEmitViewEvents();G=this._lines.setHiddenAreas(V),G&&(Z.emitViewEvent(new ViewFlushedEvent),Z.emitViewEvent(new ViewLineMappingChangedEvent),Z.emitViewEvent(new ViewDecorationsChangedEvent(null)),this._cursor.onLineMappingChanged(Z),this._decorations.onLineMappingChanged(),this.viewLayout.onFlushed(this.getLineCount()),this.viewLayout.onHeightMaybeChanged()),U.recoverViewportStart(this.coordinatesConverter,this.viewLayout)}finally{this._eventDispatcher.endEmitViewEvents()}this._updateConfigurationViewLineCount.schedule(),G&&this._eventDispatcher.emitOutgoingEvent(new HiddenAreasChangedEvent)}getVisibleRangesPlusViewportAboveBelow(){const C=this._configuration.options.get(143),W=this._configuration.options.get(66),V=Math.max(20,Math.round(C.height/W)),U=this.viewLayout.getLinesViewportData(),G=Math.max(1,U.completelyVisibleStartLineNumber-V),Z=Math.min(this.getLineCount(),U.completelyVisibleEndLineNumber+V);return this._toModelVisibleRanges(new Range$2(G,this.getLineMinColumn(G),Z,this.getLineMaxColumn(Z)))}getVisibleRanges(){const C=this.getCompletelyVisibleViewRange();return this._toModelVisibleRanges(C)}getHiddenAreas(){return this._lines.getHiddenAreas()}_toModelVisibleRanges(C){const W=this.coordinatesConverter.convertViewRangeToModelRange(C),V=this._lines.getHiddenAreas();if(V.length===0)return[W];const U=[];let G=0,Z=W.startLineNumber,X=W.startColumn;const Q=W.endLineNumber,J=W.endColumn;for(let ee=0,te=V.length;ee<te;ee++){const ie=V[ee].startLineNumber,ne=V[ee].endLineNumber;ne<Z||ie>Q||(Z<ie&&(U[G++]=new Range$2(Z,X,ie-1,this.model.getLineMaxColumn(ie-1))),Z=ne+1,X=1)}return(Z<Q||Z===Q&&X<J)&&(U[G++]=new Range$2(Z,X,Q,J)),U}getCompletelyVisibleViewRange(){const C=this.viewLayout.getLinesViewportData(),W=C.completelyVisibleStartLineNumber,V=C.completelyVisibleEndLineNumber;return new Range$2(W,this.getLineMinColumn(W),V,this.getLineMaxColumn(V))}getCompletelyVisibleViewRangeAtScrollTop(C){const W=this.viewLayout.getLinesViewportDataAtScrollTop(C),V=W.completelyVisibleStartLineNumber,U=W.completelyVisibleEndLineNumber;return new Range$2(V,this.getLineMinColumn(V),U,this.getLineMaxColumn(U))}saveState(){const C=this.viewLayout.saveState(),W=C.scrollTop,V=this.viewLayout.getLineNumberAtVerticalOffset(W),U=this.coordinatesConverter.convertViewPositionToModelPosition(new Position$1(V,this.getLineMinColumn(V))),G=this.viewLayout.getVerticalOffsetForLineNumber(V)-W;return{scrollLeft:C.scrollLeft,firstPosition:U,firstPositionDeltaTop:G}}reduceRestoreState(C){if(typeof C.firstPosition>"u")return this._reduceRestoreStateCompatibility(C);const W=this.model.validatePosition(C.firstPosition),V=this.coordinatesConverter.convertModelPositionToViewPosition(W),U=this.viewLayout.getVerticalOffsetForLineNumber(V.lineNumber)-C.firstPositionDeltaTop;return{scrollLeft:C.scrollLeft,scrollTop:U}}_reduceRestoreStateCompatibility(C){return{scrollLeft:C.scrollLeft,scrollTop:C.scrollTopWithoutViewZones}}getTabSize(){return this.model.getOptions().tabSize}getLineCount(){return this._lines.getViewLineCount()}setViewport(C,W,V){this._viewportStart.update(this,C)}getActiveIndentGuide(C,W,V){return this._lines.getActiveIndentGuide(C,W,V)}getLinesIndentGuides(C,W){return this._lines.getViewLinesIndentGuides(C,W)}getBracketGuidesInRangeByLine(C,W,V,U){return this._lines.getViewLinesBracketGuides(C,W,V,U)}getLineContent(C){return this._lines.getViewLineContent(C)}getLineLength(C){return this._lines.getViewLineLength(C)}getLineMinColumn(C){return this._lines.getViewLineMinColumn(C)}getLineMaxColumn(C){return this._lines.getViewLineMaxColumn(C)}getLineFirstNonWhitespaceColumn(C){const W=firstNonWhitespaceIndex(this.getLineContent(C));return W===-1?0:W+1}getLineLastNonWhitespaceColumn(C){const W=lastNonWhitespaceIndex(this.getLineContent(C));return W===-1?0:W+2}getMinimapDecorationsInRange(C){return this._decorations.getMinimapDecorationsInRange(C)}getDecorationsInViewport(C){return this._decorations.getDecorationsViewportData(C).decorations}getInjectedTextAt(C){return this._lines.getInjectedTextAt(C)}getViewportViewLineRenderingData(C,W){const U=this._decorations.getDecorationsViewportData(C).inlineDecorations[W-C.startLineNumber];return this._getViewLineRenderingData(W,U)}getViewLineRenderingData(C){const W=this._decorations.getInlineDecorationsOnLine(C);return this._getViewLineRenderingData(C,W)}_getViewLineRenderingData(C,W){const V=this.model.mightContainRTL(),U=this.model.mightContainNonBasicASCII(),G=this.getTabSize(),Z=this._lines.getViewLineData(C);return Z.inlineDecorations&&(W=[...W,...Z.inlineDecorations.map(X=>X.toInlineDecoration(C))]),new ViewLineRenderingData(Z.minColumn,Z.maxColumn,Z.content,Z.continuesWithWrappedLine,V,U,Z.tokens,W,G,Z.startVisibleColumn)}getViewLineData(C){return this._lines.getViewLineData(C)}getMinimapLinesRenderingData(C,W,V){const U=this._lines.getViewLinesData(C,W,V);return new MinimapLinesRenderingData(this.getTabSize(),U)}getAllOverviewRulerDecorations(C){const W=this.model.getOverviewRulerDecorations(this._editorId,filterValidationDecorations(this._configuration.options)),V=new OverviewRulerDecorations;for(const U of W){const G=U.options,Z=G.overviewRuler;if(!Z)continue;const X=Z.position;if(X===0)continue;const Q=Z.getColor(C.value),J=this.coordinatesConverter.getViewLineNumberOfModelPosition(U.range.startLineNumber,U.range.startColumn),ee=this.coordinatesConverter.getViewLineNumberOfModelPosition(U.range.endLineNumber,U.range.endColumn);V.accept(Q,G.zIndex,J,ee,X)}return V.asArray}_invalidateDecorationsColorCache(){const C=this.model.getOverviewRulerDecorations();for(const W of C){const V=W.options.overviewRuler;V==null||V.invalidateCachedColor();const U=W.options.minimap;U==null||U.invalidateCachedColor()}}getValueInRange(C,W){const V=this.coordinatesConverter.convertViewRangeToModelRange(C);return this.model.getValueInRange(V,W)}getValueLengthInRange(C,W){const V=this.coordinatesConverter.convertViewRangeToModelRange(C);return this.model.getValueLengthInRange(V,W)}modifyPosition(C,W){const V=this.coordinatesConverter.convertViewPositionToModelPosition(C);return this.model.modifyPosition(V,W)}deduceModelPositionRelativeToViewPosition(C,W,V){const U=this.coordinatesConverter.convertViewPositionToModelPosition(C);this.model.getEOL().length===2&&(W<0?W-=V:W+=V);const Z=this.model.getOffsetAt(U)+W;return this.model.getPositionAt(Z)}getPlainTextToCopy(C,W,V){const U=V?`\r
`:this.model.getEOL();C=C.slice(0),C.sort(Range$2.compareRangesUsingStarts);let G=!1,Z=!1;for(const Q of C)Q.isEmpty()?G=!0:Z=!0;if(!Z){if(!W)return"";const Q=C.map(ee=>ee.startLineNumber);let J="";for(let ee=0;ee<Q.length;ee++)ee>0&&Q[ee-1]===Q[ee]||(J+=this.model.getLineContent(Q[ee])+U);return J}if(G&&W){const Q=[];let J=0;for(const ee of C){const te=ee.startLineNumber;ee.isEmpty()?te!==J&&Q.push(this.model.getLineContent(te)):Q.push(this.model.getValueInRange(ee,V?2:0)),J=te}return Q.length===1?Q[0]:Q}const X=[];for(const Q of C)Q.isEmpty()||X.push(this.model.getValueInRange(Q,V?2:0));return X.length===1?X[0]:X}getRichTextToCopy(C,W){const V=this.model.getLanguageId();if(V===PLAINTEXT_LANGUAGE_ID||C.length!==1)return null;let U=C[0];if(U.isEmpty()){if(!W)return null;const ee=U.startLineNumber;U=new Range$2(ee,this.model.getLineMinColumn(ee),ee,this.model.getLineMaxColumn(ee))}const G=this._configuration.options.get(50),Z=this._getColorMap(),Q=/[:;\\\/<>]/.test(G.fontFamily)||G.fontFamily===EDITOR_FONT_DEFAULTS.fontFamily;let J;return Q?J=EDITOR_FONT_DEFAULTS.fontFamily:(J=G.fontFamily,J=J.replace(/"/g,"'"),/[,']/.test(J)||/[+ ]/.test(J)&&(J=`'${J}'`),J=`${J}, ${EDITOR_FONT_DEFAULTS.fontFamily}`),{mode:V,html:`<div style="color: ${Z[1]};background-color: ${Z[2]};font-family: ${J};font-weight: ${G.fontWeight};font-size: ${G.fontSize}px;line-height: ${G.lineHeight}px;white-space: pre;">`+this._getHTMLToCopy(U,Z)+"</div>"}}_getHTMLToCopy(C,W){const V=C.startLineNumber,U=C.startColumn,G=C.endLineNumber,Z=C.endColumn,X=this.getTabSize();let Q="";for(let J=V;J<=G;J++){const ee=this.model.tokenization.getLineTokens(J),te=ee.getLineContent(),ie=J===V?U-1:0,ne=J===G?Z-1:te.length;te===""?Q+="<br>":Q+=tokenizeLineToHTML(te,ee.inflate(),W,ie,ne,X,isWindows)}return Q}_getColorMap(){const C=TokenizationRegistry.getColorMap(),W=["#000000"];if(C)for(let V=1,U=C.length;V<U;V++)W[V]=Color.Format.CSS.formatHex(C[V]);return W}getPrimaryCursorState(){return this._cursor.getPrimaryCursorState()}getLastAddedCursorIndex(){return this._cursor.getLastAddedCursorIndex()}getCursorStates(){return this._cursor.getCursorStates()}setCursorStates(C,W,V){return this._withViewEventsCollector(U=>this._cursor.setStates(U,C,W,V))}getCursorColumnSelectData(){return this._cursor.getCursorColumnSelectData()}getCursorAutoClosedCharacters(){return this._cursor.getAutoClosedCharacters()}setCursorColumnSelectData(C){this._cursor.setCursorColumnSelectData(C)}getPrevEditOperationType(){return this._cursor.getPrevEditOperationType()}setPrevEditOperationType(C){this._cursor.setPrevEditOperationType(C)}getSelection(){return this._cursor.getSelection()}getSelections(){return this._cursor.getSelections()}getPosition(){return this._cursor.getPrimaryCursorState().modelState.position}setSelections(C,W,V=0){this._withViewEventsCollector(U=>this._cursor.setSelections(U,C,W,V))}saveCursorState(){return this._cursor.saveState()}restoreCursorState(C){this._withViewEventsCollector(W=>this._cursor.restoreState(W,C))}_executeCursorEdit(C){if(this._cursor.context.cursorConfig.readOnly){this._eventDispatcher.emitOutgoingEvent(new ReadOnlyEditAttemptEvent);return}this._withViewEventsCollector(C)}executeEdits(C,W,V){this._executeCursorEdit(U=>this._cursor.executeEdits(U,C,W,V))}startComposition(){this._executeCursorEdit(C=>this._cursor.startComposition(C))}endComposition(C){this._executeCursorEdit(W=>this._cursor.endComposition(W,C))}type(C,W){this._executeCursorEdit(V=>this._cursor.type(V,C,W))}compositionType(C,W,V,U,G){this._executeCursorEdit(Z=>this._cursor.compositionType(Z,C,W,V,U,G))}paste(C,W,V,U){this._executeCursorEdit(G=>this._cursor.paste(G,C,W,V,U))}cut(C){this._executeCursorEdit(W=>this._cursor.cut(W,C))}executeCommand(C,W){this._executeCursorEdit(V=>this._cursor.executeCommand(V,C,W))}executeCommands(C,W){this._executeCursorEdit(V=>this._cursor.executeCommands(V,C,W))}revealPrimaryCursor(C,W,V=!1){this._withViewEventsCollector(U=>this._cursor.revealPrimary(U,C,V,0,W,0))}revealTopMostCursor(C){const W=this._cursor.getTopMostViewPosition(),V=new Range$2(W.lineNumber,W.column,W.lineNumber,W.column);this._withViewEventsCollector(U=>U.emitViewEvent(new ViewRevealRangeRequestEvent(C,!1,V,null,0,!0,0)))}revealBottomMostCursor(C){const W=this._cursor.getBottomMostViewPosition(),V=new Range$2(W.lineNumber,W.column,W.lineNumber,W.column);this._withViewEventsCollector(U=>U.emitViewEvent(new ViewRevealRangeRequestEvent(C,!1,V,null,0,!0,0)))}revealRange(C,W,V,U,G){this._withViewEventsCollector(Z=>Z.emitViewEvent(new ViewRevealRangeRequestEvent(C,!1,V,null,U,W,G)))}changeWhitespace(C){this.viewLayout.changeWhitespace(C)&&(this._eventDispatcher.emitSingleViewEvent(new ViewZonesChangedEvent$1),this._eventDispatcher.emitOutgoingEvent(new ViewZonesChangedEvent))}_withViewEventsCollector(C){try{const W=this._eventDispatcher.beginEmitViewEvents();return C(W)}finally{this._eventDispatcher.endEmitViewEvents()}}normalizePosition(C,W){return this._lines.normalizePosition(C,W)}getLineIndentColumn(C){return this._lines.getLineIndentColumn(C)}};class ViewportStart{static create(C){const W=C._setTrackedRange(null,new Range$2(1,1,1,1),1);return new ViewportStart(C,1,!1,W,0)}get viewLineNumber(){return this._viewLineNumber}get isValid(){return this._isValid}get modelTrackedRange(){return this._modelTrackedRange}get startLineDelta(){return this._startLineDelta}constructor(C,W,V,U,G){this._model=C,this._viewLineNumber=W,this._isValid=V,this._modelTrackedRange=U,this._startLineDelta=G}dispose(){this._model._setTrackedRange(this._modelTrackedRange,null,1)}update(C,W){const V=C.coordinatesConverter.convertViewPositionToModelPosition(new Position$1(W,C.getLineMinColumn(W))),U=C.model._setTrackedRange(this._modelTrackedRange,new Range$2(V.lineNumber,V.column,V.lineNumber,V.column),1),G=C.viewLayout.getVerticalOffsetForLineNumber(W),Z=C.viewLayout.getCurrentScrollTop();this._viewLineNumber=W,this._isValid=!0,this._modelTrackedRange=U,this._startLineDelta=Z-G}invalidate(){this._isValid=!1}}class OverviewRulerDecorations{constructor(){this._asMap=Object.create(null),this.asArray=[]}accept(C,W,V,U,G){const Z=this._asMap[C];if(Z){const X=Z.data,Q=X[X.length-3],J=X[X.length-1];if(Q===G&&J+1>=V){U>J&&(X[X.length-1]=U);return}X.push(G,V,U)}else{const X=new OverviewRulerDecorationsGroup(C,W,[G,V,U]);this._asMap[C]=X,this.asArray.push(X)}}}class HiddenAreasModel{constructor(){this.hiddenAreas=new Map,this.shouldRecompute=!1,this.ranges=[]}setHiddenAreas(C,W){const V=this.hiddenAreas.get(C);V&&rangeArraysEqual(V,W)||(this.hiddenAreas.set(C,W),this.shouldRecompute=!0)}getMergedRanges(){if(!this.shouldRecompute)return this.ranges;this.shouldRecompute=!1;const C=Array.from(this.hiddenAreas.values()).reduce((W,V)=>mergeLineRangeArray(W,V),[]);return rangeArraysEqual(this.ranges,C)?this.ranges:(this.ranges=C,this.ranges)}}function mergeLineRangeArray(K,C){const W=[];let V=0,U=0;for(;V<K.length&&U<C.length;){const G=K[V],Z=C[U];if(G.endLineNumber<Z.startLineNumber-1)W.push(K[V++]);else if(Z.endLineNumber<G.startLineNumber-1)W.push(C[U++]);else{const X=Math.min(G.startLineNumber,Z.startLineNumber),Q=Math.max(G.endLineNumber,Z.endLineNumber);W.push(new Range$2(X,1,Q,1)),V++,U++}}for(;V<K.length;)W.push(K[V++]);for(;U<C.length;)W.push(C[U++]);return W}function rangeArraysEqual(K,C){if(K.length!==C.length)return!1;for(let W=0;W<K.length;W++)if(!K[W].equalsRange(C[W]))return!1;return!0}class StableViewport{constructor(C,W){this.viewportStartModelPosition=C,this.startLineDelta=W}recoverViewportStart(C,W){if(!this.viewportStartModelPosition)return;const V=C.convertModelPositionToViewPosition(this.viewportStartModelPosition),U=W.getVerticalOffsetForLineNumber(V.lineNumber);W.setScrollPosition({scrollTop:U+this.startLineDelta},1)}}class ServiceCollection{constructor(...C){this._entries=new Map;for(const[W,V]of C)this.set(W,V)}set(C,W){const V=this._entries.get(C);return this._entries.set(C,W),V}get(C){return this._entries.get(C)}}var Severity$1;(function(K){K[K.Ignore=0]="Ignore",K[K.Info=1]="Info",K[K.Warning=2]="Warning",K[K.Error=3]="Error"})(Severity$1||(Severity$1={}));(function(K){const C="error",W="warning",V="warn",U="info",G="ignore";function Z(Q){return Q?equalsIgnoreCase(C,Q)?K.Error:equalsIgnoreCase(W,Q)||equalsIgnoreCase(V,Q)?K.Warning:equalsIgnoreCase(U,Q)?K.Info:K.Ignore:K.Ignore}K.fromValue=Z;function X(Q){switch(Q){case K.Error:return C;case K.Warning:return W;case K.Info:return U;default:return G}}K.toString=X})(Severity$1||(Severity$1={}));const Severity$2=Severity$1;var Severity=Severity$2;const INotificationService=createDecorator("notificationService");class NoOpNotification{}class ModelLineProjectionData{constructor(C,W,V,U,G){this.injectionOffsets=C,this.injectionOptions=W,this.breakOffsets=V,this.breakOffsetsVisibleColumn=U,this.wrappedTextIndentLength=G}getOutputLineCount(){return this.breakOffsets.length}getMinOutputOffset(C){return C>0?this.wrappedTextIndentLength:0}getLineLength(C){const W=C>0?this.breakOffsets[C-1]:0;let U=this.breakOffsets[C]-W;return C>0&&(U+=this.wrappedTextIndentLength),U}getMaxOutputOffset(C){return this.getLineLength(C)}translateToInputOffset(C,W){C>0&&(W=Math.max(0,W-this.wrappedTextIndentLength));let U=C===0?W:this.breakOffsets[C-1]+W;if(this.injectionOffsets!==null)for(let G=0;G<this.injectionOffsets.length&&U>this.injectionOffsets[G];G++)U<this.injectionOffsets[G]+this.injectionOptions[G].content.length?U=this.injectionOffsets[G]:U-=this.injectionOptions[G].content.length;return U}translateToOutputPosition(C,W=2){let V=C;if(this.injectionOffsets!==null)for(let U=0;U<this.injectionOffsets.length&&!(C<this.injectionOffsets[U]||W!==1&&C===this.injectionOffsets[U]);U++)V+=this.injectionOptions[U].content.length;return this.offsetInInputWithInjectionsToOutputPosition(V,W)}offsetInInputWithInjectionsToOutputPosition(C,W=2){let V=0,U=this.breakOffsets.length-1,G=0,Z=0;for(;V<=U;){G=V+(U-V)/2|0;const Q=this.breakOffsets[G];if(Z=G>0?this.breakOffsets[G-1]:0,W===0)if(C<=Z)U=G-1;else if(C>Q)V=G+1;else break;else if(C<Z)U=G-1;else if(C>=Q)V=G+1;else break}let X=C-Z;return G>0&&(X+=this.wrappedTextIndentLength),new OutputPosition(G,X)}normalizeOutputPosition(C,W,V){if(this.injectionOffsets!==null){const U=this.outputPositionToOffsetInInputWithInjections(C,W),G=this.normalizeOffsetInInputWithInjectionsAroundInjections(U,V);if(G!==U)return this.offsetInInputWithInjectionsToOutputPosition(G,V)}if(V===0){if(C>0&&W===this.getMinOutputOffset(C))return new OutputPosition(C-1,this.getMaxOutputOffset(C-1))}else if(V===1){const U=this.getOutputLineCount()-1;if(C<U&&W===this.getMaxOutputOffset(C))return new OutputPosition(C+1,this.getMinOutputOffset(C+1))}return new OutputPosition(C,W)}outputPositionToOffsetInInputWithInjections(C,W){return C>0&&(W=Math.max(0,W-this.wrappedTextIndentLength)),(C>0?this.breakOffsets[C-1]:0)+W}normalizeOffsetInInputWithInjectionsAroundInjections(C,W){const V=this.getInjectedTextAtOffset(C);if(!V)return C;if(W===2){if(C===V.offsetInInputWithInjections+V.length&&hasRightCursorStop(this.injectionOptions[V.injectedTextIndex].cursorStops))return V.offsetInInputWithInjections+V.length;{let U=V.offsetInInputWithInjections;if(hasLeftCursorStop(this.injectionOptions[V.injectedTextIndex].cursorStops))return U;let G=V.injectedTextIndex-1;for(;G>=0&&this.injectionOffsets[G]===this.injectionOffsets[V.injectedTextIndex]&&!(hasRightCursorStop(this.injectionOptions[G].cursorStops)||(U-=this.injectionOptions[G].content.length,hasLeftCursorStop(this.injectionOptions[G].cursorStops)));)G--;return U}}else if(W===1||W===4){let U=V.offsetInInputWithInjections+V.length,G=V.injectedTextIndex;for(;G+1<this.injectionOffsets.length&&this.injectionOffsets[G+1]===this.injectionOffsets[G];)U+=this.injectionOptions[G+1].content.length,G++;return U}else if(W===0||W===3){let U=V.offsetInInputWithInjections,G=V.injectedTextIndex;for(;G-1>=0&&this.injectionOffsets[G-1]===this.injectionOffsets[G];)U-=this.injectionOptions[G-1].content.length,G--;return U}assertNever()}getInjectedText(C,W){const V=this.outputPositionToOffsetInInputWithInjections(C,W),U=this.getInjectedTextAtOffset(V);return U?{options:this.injectionOptions[U.injectedTextIndex]}:null}getInjectedTextAtOffset(C){const W=this.injectionOffsets,V=this.injectionOptions;if(W!==null){let U=0;for(let G=0;G<W.length;G++){const Z=V[G].content.length,X=W[G]+U,Q=W[G]+U+Z;if(X>C)break;if(C<=Q)return{injectedTextIndex:G,offsetInInputWithInjections:X,length:Z};U+=Z}}}}function hasRightCursorStop(K){return K==null?!0:K===InjectedTextCursorStops.Right||K===InjectedTextCursorStops.Both}function hasLeftCursorStop(K){return K==null?!0:K===InjectedTextCursorStops.Left||K===InjectedTextCursorStops.Both}class OutputPosition{constructor(C,W){this.outputLineIndex=C,this.outputOffset=W}toString(){return`${this.outputLineIndex}:${this.outputOffset}`}toPosition(C){return new Position$1(C+this.outputLineIndex,this.outputOffset+1)}}class MonospaceLineBreaksComputerFactory{static create(C){return new MonospaceLineBreaksComputerFactory(C.get(132),C.get(131))}constructor(C,W){this.classifier=new WrappingCharacterClassifier(C,W)}createLineBreaksComputer(C,W,V,U,G){const Z=[],X=[],Q=[];return{addRequest:(J,ee,te)=>{Z.push(J),X.push(ee),Q.push(te)},finalize:()=>{const J=C.typicalFullwidthCharacterWidth/C.typicalHalfwidthCharacterWidth,ee=[];for(let te=0,ie=Z.length;te<ie;te++){const ne=X[te],oe=Q[te];oe&&!oe.injectionOptions&&!ne?ee[te]=createLineBreaksFromPreviousLineBreaks(this.classifier,oe,Z[te],W,V,J,U,G):ee[te]=createLineBreaks$1(this.classifier,Z[te],ne,W,V,J,U,G)}return arrPool1.length=0,arrPool2.length=0,ee}}}}class WrappingCharacterClassifier extends CharacterClassifier{constructor(C,W){super(0);for(let V=0;V<C.length;V++)this.set(C.charCodeAt(V),1);for(let V=0;V<W.length;V++)this.set(W.charCodeAt(V),2)}get(C){return C>=0&&C<256?this._asciiMap[C]:C>=12352&&C<=12543||C>=13312&&C<=19903||C>=19968&&C<=40959?3:this._map.get(C)||this._defaultValue}}let arrPool1=[],arrPool2=[];function createLineBreaksFromPreviousLineBreaks(K,C,W,V,U,G,Z,X){if(U===-1)return null;const Q=W.length;if(Q<=1)return null;const J=X==="keepAll",ee=C.breakOffsets,te=C.breakOffsetsVisibleColumn,ie=computeWrappedTextIndentLength(W,V,U,G,Z),ne=U-ie,oe=arrPool1,re=arrPool2;let ae=0,se=0,le=0,ce=U;const de=ee.length;let ue=0;if(ue>=0){let ge=Math.abs(te[ue]-ce);for(;ue+1<de;){const he=Math.abs(te[ue+1]-ce);if(he>=ge)break;ge=he,ue++}}for(;ue<de;){let ge=ue<0?0:ee[ue],he=ue<0?0:te[ue];se>ge&&(ge=se,he=le);let fe=0,pe=0,Se=0,Le=0;if(he<=ce){let Ce=he,De=ge===0?0:W.charCodeAt(ge-1),ke=ge===0?0:K.get(De),Me=!0;for(let Oe=ge;Oe<Q;Oe++){const Be=Oe,Pe=W.charCodeAt(Oe);let Ue,ze;if(isHighSurrogate(Pe)?(Oe++,Ue=0,ze=2):(Ue=K.get(Pe),ze=computeCharWidth(Pe,Ce,V,G)),Be>se&&canBreak(De,ke,Pe,Ue,J)&&(fe=Be,pe=Ce),Ce+=ze,Ce>ce){Be>se?(Se=Be,Le=Ce-ze):(Se=Oe+1,Le=Ce),Ce-pe>ne&&(fe=0),Me=!1;break}De=Pe,ke=Ue}if(Me){ae>0&&(oe[ae]=ee[ee.length-1],re[ae]=te[ee.length-1],ae++);break}}if(fe===0){let Ce=he,De=W.charCodeAt(ge),ke=K.get(De),Me=!1;for(let Oe=ge-1;Oe>=se;Oe--){const Be=Oe+1,Pe=W.charCodeAt(Oe);if(Pe===9){Me=!0;break}let Ue,ze;if(isLowSurrogate(Pe)?(Oe--,Ue=0,ze=2):(Ue=K.get(Pe),ze=isFullWidthCharacter(Pe)?G:1),Ce<=ce){if(Se===0&&(Se=Be,Le=Ce),Ce<=ce-ne)break;if(canBreak(Pe,Ue,De,ke,J)){fe=Be,pe=Ce;break}}Ce-=ze,De=Pe,ke=Ue}if(fe!==0){const Oe=ne-(Le-pe);if(Oe<=V){const Be=W.charCodeAt(Se);let Pe;isHighSurrogate(Be)?Pe=2:Pe=computeCharWidth(Be,Le,V,G),Oe-Pe<0&&(fe=0)}}if(Me){ue--;continue}}if(fe===0&&(fe=Se,pe=Le),fe<=se){const Ce=W.charCodeAt(se);isHighSurrogate(Ce)?(fe=se+2,pe=le+2):(fe=se+1,pe=le+computeCharWidth(Ce,le,V,G))}for(se=fe,oe[ae]=fe,le=pe,re[ae]=pe,ae++,ce=pe+ne;ue<0||ue<de&&te[ue]<pe;)ue++;let be=Math.abs(te[ue]-ce);for(;ue+1<de;){const Ce=Math.abs(te[ue+1]-ce);if(Ce>=be)break;be=Ce,ue++}}return ae===0?null:(oe.length=ae,re.length=ae,arrPool1=C.breakOffsets,arrPool2=C.breakOffsetsVisibleColumn,C.breakOffsets=oe,C.breakOffsetsVisibleColumn=re,C.wrappedTextIndentLength=ie,C)}function createLineBreaks$1(K,C,W,V,U,G,Z,X){const Q=LineInjectedText.applyInjectedText(C,W);let J,ee;if(W&&W.length>0?(J=W.map(pe=>pe.options),ee=W.map(pe=>pe.column-1)):(J=null,ee=null),U===-1)return J?new ModelLineProjectionData(ee,J,[Q.length],[],0):null;const te=Q.length;if(te<=1)return J?new ModelLineProjectionData(ee,J,[Q.length],[],0):null;const ie=X==="keepAll",ne=computeWrappedTextIndentLength(Q,V,U,G,Z),oe=U-ne,re=[],ae=[];let se=0,le=0,ce=0,de=U,ue=Q.charCodeAt(0),ge=K.get(ue),he=computeCharWidth(ue,0,V,G),fe=1;isHighSurrogate(ue)&&(he+=1,ue=Q.charCodeAt(1),ge=K.get(ue),fe++);for(let pe=fe;pe<te;pe++){const Se=pe,Le=Q.charCodeAt(pe);let be,Ce;isHighSurrogate(Le)?(pe++,be=0,Ce=2):(be=K.get(Le),Ce=computeCharWidth(Le,he,V,G)),canBreak(ue,ge,Le,be,ie)&&(le=Se,ce=he),he+=Ce,he>de&&((le===0||he-ce>oe)&&(le=Se,ce=he-Ce),re[se]=le,ae[se]=ce,se++,de=ce+oe,le=0),ue=Le,ge=be}return se===0&&(!W||W.length===0)?null:(re[se]=te,ae[se]=he,new ModelLineProjectionData(ee,J,re,ae,ne))}function computeCharWidth(K,C,W,V){return K===9?W-C%W:isFullWidthCharacter(K)||K<32?V:1}function tabCharacterWidth(K,C){return C-K%C}function canBreak(K,C,W,V,U){return W!==32&&(C===2&&V!==2||C!==1&&V===1||!U&&C===3&&V!==2||!U&&V===3&&C!==1)}function computeWrappedTextIndentLength(K,C,W,V,U){let G=0;if(U!==0){const Z=firstNonWhitespaceIndex(K);if(Z!==-1){for(let Q=0;Q<Z;Q++){const J=K.charCodeAt(Q)===9?tabCharacterWidth(G,C):1;G+=J}const X=U===3?2:U===2?1:0;for(let Q=0;Q<X;Q++){const J=tabCharacterWidth(G,C);G+=J}G+V>W&&(G=0)}}return G}const ttPolicy$2=createTrustedTypesPolicy("domLineBreaksComputer",{createHTML:K=>K});class DOMLineBreaksComputerFactory{static create(){return new DOMLineBreaksComputerFactory}constructor(){}createLineBreaksComputer(C,W,V,U,G){const Z=[],X=[];return{addRequest:(Q,J,ee)=>{Z.push(Q),X.push(J)},finalize:()=>createLineBreaks(Z,C,W,V,U,G,X)}}}function createLineBreaks(K,C,W,V,U,G,Z){var X;function Q(pe){const Se=Z[pe];if(Se){const Le=LineInjectedText.applyInjectedText(K[pe],Se),be=Se.map(De=>De.options),Ce=Se.map(De=>De.column-1);return new ModelLineProjectionData(Ce,be,[Le.length],[],0)}else return null}if(V===-1){const pe=[];for(let Se=0,Le=K.length;Se<Le;Se++)pe[Se]=Q(Se);return pe}const J=Math.round(V*C.typicalHalfwidthCharacterWidth),te=Math.round(W*(U===3?2:U===2?1:0)),ie=Math.ceil(C.spaceWidth*te),ne=document.createElement("div");applyFontInfo(ne,C);const oe=new StringBuilder(1e4),re=[],ae=[],se=[],le=[],ce=[];for(let pe=0;pe<K.length;pe++){const Se=LineInjectedText.applyInjectedText(K[pe],Z[pe]);let Le=0,be=0,Ce=J;if(U!==0)if(Le=firstNonWhitespaceIndex(Se),Le===-1)Le=0;else{for(let Oe=0;Oe<Le;Oe++){const Be=Se.charCodeAt(Oe)===9?W-be%W:1;be+=Be}const Me=Math.ceil(C.spaceWidth*be);Me+C.typicalFullwidthCharacterWidth>J?(Le=0,be=0):Ce=J-Me}const De=Se.substr(Le),ke=renderLine(De,be,W,Ce,oe,ie);re[pe]=Le,ae[pe]=be,se[pe]=De,le[pe]=ke[0],ce[pe]=ke[1]}const de=oe.build(),ue=(X=ttPolicy$2==null?void 0:ttPolicy$2.createHTML(de))!==null&&X!==void 0?X:de;ne.innerHTML=ue,ne.style.position="absolute",ne.style.top="10000",G==="keepAll"?(ne.style.wordBreak="keep-all",ne.style.overflowWrap="anywhere"):(ne.style.wordBreak="inherit",ne.style.overflowWrap="break-word"),document.body.appendChild(ne);const ge=document.createRange(),he=Array.prototype.slice.call(ne.children,0),fe=[];for(let pe=0;pe<K.length;pe++){const Se=he[pe],Le=readLineBreaks(ge,Se,se[pe],le[pe]);if(Le===null){fe[pe]=Q(pe);continue}const be=re[pe],Ce=ae[pe]+te,De=ce[pe],ke=[];for(let Pe=0,Ue=Le.length;Pe<Ue;Pe++)ke[Pe]=De[Le[Pe]];if(be!==0)for(let Pe=0,Ue=Le.length;Pe<Ue;Pe++)Le[Pe]+=be;let Me,Oe;const Be=Z[pe];Be?(Me=Be.map(Pe=>Pe.options),Oe=Be.map(Pe=>Pe.column-1)):(Me=null,Oe=null),fe[pe]=new ModelLineProjectionData(Oe,Me,Le,ke,Ce)}return document.body.removeChild(ne),fe}function renderLine(K,C,W,V,U,G){if(G!==0){const ie=String(G);U.appendString('<div style="text-indent: -'),U.appendString(ie),U.appendString("px; padding-left: "),U.appendString(ie),U.appendString("px; box-sizing: border-box; width:")}else U.appendString('<div style="width:');U.appendString(String(V)),U.appendString('px;">');const Z=K.length;let X=C,Q=0;const J=[],ee=[];let te=0<Z?K.charCodeAt(0):0;U.appendString("<span>");for(let ie=0;ie<Z;ie++){ie!==0&&ie%16384===0&&U.appendString("</span><span>"),J[ie]=Q,ee[ie]=X;const ne=te;te=ie+1<Z?K.charCodeAt(ie+1):0;let oe=1,re=1;switch(ne){case 9:oe=W-X%W,re=oe;for(let ae=1;ae<=oe;ae++)ae<oe?U.appendCharCode(160):U.appendASCIICharCode(32);break;case 32:te===32?U.appendCharCode(160):U.appendASCIICharCode(32);break;case 60:U.appendString("&lt;");break;case 62:U.appendString("&gt;");break;case 38:U.appendString("&amp;");break;case 0:U.appendString("&#00;");break;case 65279:case 8232:case 8233:case 133:U.appendCharCode(65533);break;default:isFullWidthCharacter(ne)&&re++,ne<32?U.appendCharCode(9216+ne):U.appendCharCode(ne)}Q+=oe,X+=re}return U.appendString("</span>"),J[K.length]=Q,ee[K.length]=X,U.appendString("</div>"),[J,ee]}function readLineBreaks(K,C,W,V){if(W.length<=1)return null;const U=Array.prototype.slice.call(C.children,0),G=[];try{discoverBreaks(K,U,V,0,null,W.length-1,null,G)}catch(Z){return console.log(Z),null}return G.length===0?null:(G.push(W.length),G)}function discoverBreaks(K,C,W,V,U,G,Z,X){if(V===G||(U=U||readClientRect(K,C,W[V],W[V+1]),Z=Z||readClientRect(K,C,W[G],W[G+1]),Math.abs(U[0].top-Z[0].top)<=.1))return;if(V+1===G){X.push(G);return}const Q=V+(G-V)/2|0,J=readClientRect(K,C,W[Q],W[Q+1]);discoverBreaks(K,C,W,V,U,Q,J,X),discoverBreaks(K,C,W,Q,J,G,Z,X)}function readClientRect(K,C,W,V){return K.setStart(C[W/16384|0].firstChild,W%16384),K.setEnd(C[V/16384|0].firstChild,V%16384),K.getClientRects()}class CodeEditorContributions extends Disposable{constructor(){super(),this._editor=null,this._instantiationService=null,this._instances=this._register(new DisposableMap),this._pending=new Map,this._finishedInstantiation=[],this._finishedInstantiation[0]=!1,this._finishedInstantiation[1]=!1,this._finishedInstantiation[2]=!1,this._finishedInstantiation[3]=!1}initialize(C,W,V){this._editor=C,this._instantiationService=V;for(const U of W){if(this._pending.has(U.id)){onUnexpectedError(new Error(`Cannot have two contributions with the same id ${U.id}`));continue}this._pending.set(U.id,U)}this._instantiateSome(0),this._register(runWhenIdle(()=>{this._instantiateSome(1)})),this._register(runWhenIdle(()=>{this._instantiateSome(2)})),this._register(runWhenIdle(()=>{this._instantiateSome(3)},5e3))}saveViewState(){const C={};for(const[W,V]of this._instances)typeof V.saveViewState=="function"&&(C[W]=V.saveViewState());return C}restoreViewState(C){for(const[W,V]of this._instances)typeof V.restoreViewState=="function"&&V.restoreViewState(C[W])}get(C){return this._instantiateById(C),this._instances.get(C)||null}onBeforeInteractionEvent(){this._instantiateSome(2)}onAfterModelAttached(){this._register(runWhenIdle(()=>{this._instantiateSome(1)},50))}_instantiateSome(C){if(this._finishedInstantiation[C])return;this._finishedInstantiation[C]=!0;const W=this._findPendingContributionsByInstantiation(C);for(const V of W)this._instantiateById(V.id)}_findPendingContributionsByInstantiation(C){const W=[];for(const[,V]of this._pending)V.instantiation===C&&W.push(V);return W}_instantiateById(C){const W=this._pending.get(C);if(W){if(this._pending.delete(C),!this._instantiationService||!this._editor)throw new Error("Cannot instantiate contributions before being initialized!");try{const V=this._instantiationService.createInstance(W.ctor,this._editor);this._instances.set(W.id,V),typeof V.restoreViewState=="function"&&W.instantiation!==0&&console.warn(`Editor contribution '${W.id}' should be eager instantiated because it uses saveViewState / restoreViewState.`)}catch(V){onUnexpectedError(V)}}}}var __decorate$20=globalThis&&globalThis.__decorate||function(K,C,W,V){var U=arguments.length,G=U<3?C:V===null?V=Object.getOwnPropertyDescriptor(C,W):V,Z;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")G=Reflect.decorate(K,C,W,V);else for(var X=K.length-1;X>=0;X--)(Z=K[X])&&(G=(U<3?Z(G):U>3?Z(C,W,G):Z(C,W))||G);return U>3&&G&&Object.defineProperty(C,W,G),G},__param$1W=globalThis&&globalThis.__param||function(K,C){return function(W,V){C(W,V,K)}},__awaiter$1u=globalThis&&globalThis.__awaiter||function(K,C,W,V){function U(G){return G instanceof W?G:new W(function(Z){Z(G)})}return new(W||(W=Promise))(function(G,Z){function X(ee){try{J(V.next(ee))}catch(te){Z(te)}}function Q(ee){try{J(V.throw(ee))}catch(te){Z(te)}}function J(ee){ee.done?G(ee.value):U(ee.value).then(X,Q)}J((V=V.apply(K,C||[])).next())})},CodeEditorWidget_1;let EDITOR_ID=0,ModelData$1=class{constructor(C,W,V,U,G,Z){this.model=C,this.viewModel=W,this.view=V,this.hasRealView=U,this.listenersToRemove=G,this.attachedView=Z}dispose(){dispose(this.listenersToRemove),this.model.onBeforeDetached(this.attachedView),this.hasRealView&&this.view.dispose(),this.viewModel.dispose()}},CodeEditorWidget=CodeEditorWidget_1=class extends Disposable{get isSimpleWidget(){return this._configuration.isSimpleWidget}constructor(C,W,V,U,G,Z,X,Q,J,ee,te,ie){var ne;super(),this.languageConfigurationService=te,this._deliveryQueue=createEventDeliveryQueue(),this._contributions=this._register(new CodeEditorContributions),this._onDidDispose=this._register(new Emitter$1),this.onDidDispose=this._onDidDispose.event,this._onDidChangeModelContent=this._register(new Emitter$1({deliveryQueue:this._deliveryQueue})),this.onDidChangeModelContent=this._onDidChangeModelContent.event,this._onDidChangeModelLanguage=this._register(new Emitter$1({deliveryQueue:this._deliveryQueue})),this.onDidChangeModelLanguage=this._onDidChangeModelLanguage.event,this._onDidChangeModelLanguageConfiguration=this._register(new Emitter$1({deliveryQueue:this._deliveryQueue})),this.onDidChangeModelLanguageConfiguration=this._onDidChangeModelLanguageConfiguration.event,this._onDidChangeModelOptions=this._register(new Emitter$1({deliveryQueue:this._deliveryQueue})),this.onDidChangeModelOptions=this._onDidChangeModelOptions.event,this._onDidChangeModelDecorations=this._register(new Emitter$1({deliveryQueue:this._deliveryQueue})),this.onDidChangeModelDecorations=this._onDidChangeModelDecorations.event,this._onDidChangeModelTokens=this._register(new Emitter$1({deliveryQueue:this._deliveryQueue})),this.onDidChangeModelTokens=this._onDidChangeModelTokens.event,this._onDidChangeConfiguration=this._register(new Emitter$1({deliveryQueue:this._deliveryQueue})),this.onDidChangeConfiguration=this._onDidChangeConfiguration.event,this._onDidChangeModel=this._register(new Emitter$1({deliveryQueue:this._deliveryQueue})),this.onDidChangeModel=this._onDidChangeModel.event,this._onDidChangeCursorPosition=this._register(new Emitter$1({deliveryQueue:this._deliveryQueue})),this.onDidChangeCursorPosition=this._onDidChangeCursorPosition.event,this._onDidChangeCursorSelection=this._register(new Emitter$1({deliveryQueue:this._deliveryQueue})),this.onDidChangeCursorSelection=this._onDidChangeCursorSelection.event,this._onDidAttemptReadOnlyEdit=this._register(new InteractionEmitter(this._contributions,this._deliveryQueue)),this.onDidAttemptReadOnlyEdit=this._onDidAttemptReadOnlyEdit.event,this._onDidLayoutChange=this._register(new Emitter$1({deliveryQueue:this._deliveryQueue})),this.onDidLayoutChange=this._onDidLayoutChange.event,this._editorTextFocus=this._register(new BooleanEventEmitter({deliveryQueue:this._deliveryQueue})),this.onDidFocusEditorText=this._editorTextFocus.onDidChangeToTrue,this.onDidBlurEditorText=this._editorTextFocus.onDidChangeToFalse,this._editorWidgetFocus=this._register(new BooleanEventEmitter({deliveryQueue:this._deliveryQueue})),this.onDidFocusEditorWidget=this._editorWidgetFocus.onDidChangeToTrue,this.onDidBlurEditorWidget=this._editorWidgetFocus.onDidChangeToFalse,this._onWillType=this._register(new InteractionEmitter(this._contributions,this._deliveryQueue)),this.onWillType=this._onWillType.event,this._onDidType=this._register(new InteractionEmitter(this._contributions,this._deliveryQueue)),this.onDidType=this._onDidType.event,this._onDidCompositionStart=this._register(new InteractionEmitter(this._contributions,this._deliveryQueue)),this.onDidCompositionStart=this._onDidCompositionStart.event,this._onDidCompositionEnd=this._register(new InteractionEmitter(this._contributions,this._deliveryQueue)),this.onDidCompositionEnd=this._onDidCompositionEnd.event,this._onDidPaste=this._register(new InteractionEmitter(this._contributions,this._deliveryQueue)),this.onDidPaste=this._onDidPaste.event,this._onMouseUp=this._register(new InteractionEmitter(this._contributions,this._deliveryQueue)),this.onMouseUp=this._onMouseUp.event,this._onMouseDown=this._register(new InteractionEmitter(this._contributions,this._deliveryQueue)),this.onMouseDown=this._onMouseDown.event,this._onMouseDrag=this._register(new InteractionEmitter(this._contributions,this._deliveryQueue)),this.onMouseDrag=this._onMouseDrag.event,this._onMouseDrop=this._register(new InteractionEmitter(this._contributions,this._deliveryQueue)),this.onMouseDrop=this._onMouseDrop.event,this._onMouseDropCanceled=this._register(new InteractionEmitter(this._contributions,this._deliveryQueue)),this.onMouseDropCanceled=this._onMouseDropCanceled.event,this._onDropIntoEditor=this._register(new InteractionEmitter(this._contributions,this._deliveryQueue)),this.onDropIntoEditor=this._onDropIntoEditor.event,this._onContextMenu=this._register(new InteractionEmitter(this._contributions,this._deliveryQueue)),this.onContextMenu=this._onContextMenu.event,this._onMouseMove=this._register(new InteractionEmitter(this._contributions,this._deliveryQueue)),this.onMouseMove=this._onMouseMove.event,this._onMouseLeave=this._register(new InteractionEmitter(this._contributions,this._deliveryQueue)),this.onMouseLeave=this._onMouseLeave.event,this._onMouseWheel=this._register(new InteractionEmitter(this._contributions,this._deliveryQueue)),this.onMouseWheel=this._onMouseWheel.event,this._onKeyUp=this._register(new InteractionEmitter(this._contributions,this._deliveryQueue)),this.onKeyUp=this._onKeyUp.event,this._onKeyDown=this._register(new InteractionEmitter(this._contributions,this._deliveryQueue)),this.onKeyDown=this._onKeyDown.event,this._onDidContentSizeChange=this._register(new Emitter$1({deliveryQueue:this._deliveryQueue})),this.onDidContentSizeChange=this._onDidContentSizeChange.event,this._onDidScrollChange=this._register(new Emitter$1({deliveryQueue:this._deliveryQueue})),this.onDidScrollChange=this._onDidScrollChange.event,this._onDidChangeViewZones=this._register(new Emitter$1({deliveryQueue:this._deliveryQueue})),this.onDidChangeViewZones=this._onDidChangeViewZones.event,this._onDidChangeHiddenAreas=this._register(new Emitter$1({deliveryQueue:this._deliveryQueue})),this.onDidChangeHiddenAreas=this._onDidChangeHiddenAreas.event,this._actions=new Map,this._bannerDomNode=null,this._dropIntoEditorDecorations=this.createDecorationsCollection(),G.willCreateCodeEditor();const oe=Object.assign({},W);this._domElement=C,this._overflowWidgetsDomNode=oe.overflowWidgetsDomNode,delete oe.overflowWidgetsDomNode,this._id=++EDITOR_ID,this._decorationTypeKeysToIds={},this._decorationTypeSubtypes={},this._telemetryData=V.telemetryData,this._configuration=this._register(this._createConfiguration(V.isSimpleWidget||!1,oe,ee)),this._register(this._configuration.onDidChange(se=>{this._onDidChangeConfiguration.fire(se);const le=this._configuration.options;if(se.hasChanged(143)){const ce=le.get(143);this._onDidLayoutChange.fire(ce)}})),this._contextKeyService=this._register(X.createScoped(this._domElement)),this._notificationService=J,this._codeEditorService=G,this._commandService=Z,this._themeService=Q,this._register(new EditorContextKeysManager(this,this._contextKeyService)),this._register(new EditorModeContext(this,this._contextKeyService,ie)),this._instantiationService=U.createChild(new ServiceCollection([IContextKeyService,this._contextKeyService])),this._modelData=null,this._focusTracker=new CodeEditorWidgetFocusTracker(C),this._register(this._focusTracker.onChange(()=>{this._editorWidgetFocus.setValue(this._focusTracker.hasFocus())})),this._contentWidgets={},this._overlayWidgets={},this._glyphMarginWidgets={};let re;Array.isArray(V.contributions)?re=V.contributions:re=EditorExtensionsRegistry.getEditorContributions(),this._contributions.initialize(this,re,this._instantiationService);for(const se of EditorExtensionsRegistry.getEditorActions()){if(this._actions.has(se.id)){onUnexpectedError(new Error(`Cannot have two actions with the same id ${se.id}`));continue}const le=new InternalEditorAction(se.id,se.label,se.alias,(ne=se.precondition)!==null&&ne!==void 0?ne:void 0,()=>this._instantiationService.invokeFunction(ce=>Promise.resolve(se.runEditorCommand(ce,this,null))),this._contextKeyService);this._actions.set(le.id,le)}const ae=()=>!this._configuration.options.get(90)&&this._configuration.options.get(36).enabled;this._register(new DragAndDropObserver(this._domElement,{onDragEnter:()=>{},onDragOver:se=>{if(!ae())return;const le=this.getTargetAtClientPoint(se.clientX,se.clientY);le!=null&&le.position&&this.showDropIndicatorAt(le.position)},onDrop:se=>__awaiter$1u(this,void 0,void 0,function*(){if(!ae()||(this.removeDropIndicator(),!se.dataTransfer))return;const le=this.getTargetAtClientPoint(se.clientX,se.clientY);le!=null&&le.position&&this._onDropIntoEditor.fire({position:le.position,event:se})}),onDragLeave:()=>{this.removeDropIndicator()},onDragEnd:()=>{this.removeDropIndicator()}})),this._codeEditorService.addCodeEditor(this)}writeScreenReaderContent(C){var W;(W=this._modelData)===null||W===void 0||W.view.writeScreenReaderContent(C)}_createConfiguration(C,W,V){return new EditorConfiguration(C,W,this._domElement,V)}getId(){return this.getEditorType()+":"+this._id}getEditorType(){return EditorType.ICodeEditor}dispose(){this._codeEditorService.removeCodeEditor(this),this._focusTracker.dispose(),this._actions.clear(),this._contentWidgets={},this._overlayWidgets={},this._removeDecorationTypes(),this._postDetachModelCleanup(this._detachModel()),this._onDidDispose.fire(),super.dispose()}invokeWithinContext(C){return this._instantiationService.invokeFunction(C)}updateOptions(C){this._configuration.updateOptions(C||{})}getOptions(){return this._configuration.options}getOption(C){return this._configuration.options.get(C)}getRawOptions(){return this._configuration.getRawOptions()}getOverflowWidgetsDomNode(){return this._overflowWidgetsDomNode}getConfiguredWordAtPosition(C){return this._modelData?WordOperations.getWordAtPosition(this._modelData.model,this._configuration.options.get(129),C):null}getValue(C=null){if(!this._modelData)return"";const W=!!(C&&C.preserveBOM);let V=0;return C&&C.lineEnding&&C.lineEnding===`
`?V=1:C&&C.lineEnding&&C.lineEnding===`\r
`&&(V=2),this._modelData.model.getValue(V,W)}setValue(C){this._modelData&&this._modelData.model.setValue(C)}getModel(){return this._modelData?this._modelData.model:null}setModel(C=null){const W=C;if(this._modelData===null&&W===null||this._modelData&&this._modelData.model===W)return;const V=this.hasTextFocus(),U=this._detachModel();this._attachModel(W),V&&this.hasModel()&&this.focus();const G={oldModelUrl:U?U.uri:null,newModelUrl:W?W.uri:null};this._removeDecorationTypes(),this._onDidChangeModel.fire(G),this._postDetachModelCleanup(U),this._contributions.onAfterModelAttached()}_removeDecorationTypes(){if(this._decorationTypeKeysToIds={},this._decorationTypeSubtypes){for(const C in this._decorationTypeSubtypes){const W=this._decorationTypeSubtypes[C];for(const V in W)this._removeDecorationType(C+"-"+V)}this._decorationTypeSubtypes={}}}getVisibleRanges(){return this._modelData?this._modelData.viewModel.getVisibleRanges():[]}getVisibleRangesPlusViewportAboveBelow(){return this._modelData?this._modelData.viewModel.getVisibleRangesPlusViewportAboveBelow():[]}getWhitespaces(){return this._modelData?this._modelData.viewModel.viewLayout.getWhitespaces():[]}static _getVerticalOffsetAfterPosition(C,W,V,U){const G=C.model.validatePosition({lineNumber:W,column:V}),Z=C.viewModel.coordinatesConverter.convertModelPositionToViewPosition(G);return C.viewModel.viewLayout.getVerticalOffsetAfterLineNumber(Z.lineNumber,U)}getTopForLineNumber(C,W=!1){return this._modelData?CodeEditorWidget_1._getVerticalOffsetForPosition(this._modelData,C,1,W):-1}getTopForPosition(C,W){return this._modelData?CodeEditorWidget_1._getVerticalOffsetForPosition(this._modelData,C,W,!1):-1}static _getVerticalOffsetForPosition(C,W,V,U=!1){const G=C.model.validatePosition({lineNumber:W,column:V}),Z=C.viewModel.coordinatesConverter.convertModelPositionToViewPosition(G);return C.viewModel.viewLayout.getVerticalOffsetForLineNumber(Z.lineNumber,U)}getBottomForLineNumber(C,W=!1){return this._modelData?CodeEditorWidget_1._getVerticalOffsetAfterPosition(this._modelData,C,1,W):-1}setHiddenAreas(C,W){var V;(V=this._modelData)===null||V===void 0||V.viewModel.setHiddenAreas(C.map(U=>Range$2.lift(U)),W)}getVisibleColumnFromPosition(C){if(!this._modelData)return C.column;const W=this._modelData.model.validatePosition(C),V=this._modelData.model.getOptions().tabSize;return CursorColumns.visibleColumnFromColumn(this._modelData.model.getLineContent(W.lineNumber),W.column,V)+1}getPosition(){return this._modelData?this._modelData.viewModel.getPosition():null}setPosition(C,W="api"){if(this._modelData){if(!Position$1.isIPosition(C))throw new Error("Invalid arguments");this._modelData.viewModel.setSelections(W,[{selectionStartLineNumber:C.lineNumber,selectionStartColumn:C.column,positionLineNumber:C.lineNumber,positionColumn:C.column}])}}_sendRevealRange(C,W,V,U){if(!this._modelData)return;if(!Range$2.isIRange(C))throw new Error("Invalid arguments");const G=this._modelData.model.validateRange(C),Z=this._modelData.viewModel.coordinatesConverter.convertModelRangeToViewRange(G);this._modelData.viewModel.revealRange("api",V,Z,W,U)}revealLine(C,W=0){this._revealLine(C,0,W)}revealLineInCenter(C,W=0){this._revealLine(C,1,W)}revealLineInCenterIfOutsideViewport(C,W=0){this._revealLine(C,2,W)}revealLineNearTop(C,W=0){this._revealLine(C,5,W)}_revealLine(C,W,V){if(typeof C!="number")throw new Error("Invalid arguments");this._sendRevealRange(new Range$2(C,1,C,1),W,!1,V)}revealPosition(C,W=0){this._revealPosition(C,0,!0,W)}revealPositionInCenter(C,W=0){this._revealPosition(C,1,!0,W)}revealPositionInCenterIfOutsideViewport(C,W=0){this._revealPosition(C,2,!0,W)}revealPositionNearTop(C,W=0){this._revealPosition(C,5,!0,W)}_revealPosition(C,W,V,U){if(!Position$1.isIPosition(C))throw new Error("Invalid arguments");this._sendRevealRange(new Range$2(C.lineNumber,C.column,C.lineNumber,C.column),W,V,U)}getSelection(){return this._modelData?this._modelData.viewModel.getSelection():null}getSelections(){return this._modelData?this._modelData.viewModel.getSelections():null}setSelection(C,W="api"){const V=Selection$1.isISelection(C),U=Range$2.isIRange(C);if(!V&&!U)throw new Error("Invalid arguments");if(V)this._setSelectionImpl(C,W);else if(U){const G={selectionStartLineNumber:C.startLineNumber,selectionStartColumn:C.startColumn,positionLineNumber:C.endLineNumber,positionColumn:C.endColumn};this._setSelectionImpl(G,W)}}_setSelectionImpl(C,W){if(!this._modelData)return;const V=new Selection$1(C.selectionStartLineNumber,C.selectionStartColumn,C.positionLineNumber,C.positionColumn);this._modelData.viewModel.setSelections(W,[V])}revealLines(C,W,V=0){this._revealLines(C,W,0,V)}revealLinesInCenter(C,W,V=0){this._revealLines(C,W,1,V)}revealLinesInCenterIfOutsideViewport(C,W,V=0){this._revealLines(C,W,2,V)}revealLinesNearTop(C,W,V=0){this._revealLines(C,W,5,V)}_revealLines(C,W,V,U){if(typeof C!="number"||typeof W!="number")throw new Error("Invalid arguments");this._sendRevealRange(new Range$2(C,1,W,1),V,!1,U)}revealRange(C,W=0,V=!1,U=!0){this._revealRange(C,V?1:0,U,W)}revealRangeInCenter(C,W=0){this._revealRange(C,1,!0,W)}revealRangeInCenterIfOutsideViewport(C,W=0){this._revealRange(C,2,!0,W)}revealRangeNearTop(C,W=0){this._revealRange(C,5,!0,W)}revealRangeNearTopIfOutsideViewport(C,W=0){this._revealRange(C,6,!0,W)}revealRangeAtTop(C,W=0){this._revealRange(C,3,!0,W)}_revealRange(C,W,V,U){if(!Range$2.isIRange(C))throw new Error("Invalid arguments");this._sendRevealRange(Range$2.lift(C),W,V,U)}setSelections(C,W="api",V=0){if(this._modelData){if(!C||C.length===0)throw new Error("Invalid arguments");for(let U=0,G=C.length;U<G;U++)if(!Selection$1.isISelection(C[U]))throw new Error("Invalid arguments");this._modelData.viewModel.setSelections(W,C,V)}}getContentWidth(){return this._modelData?this._modelData.viewModel.viewLayout.getContentWidth():-1}getScrollWidth(){return this._modelData?this._modelData.viewModel.viewLayout.getScrollWidth():-1}getScrollLeft(){return this._modelData?this._modelData.viewModel.viewLayout.getCurrentScrollLeft():-1}getContentHeight(){return this._modelData?this._modelData.viewModel.viewLayout.getContentHeight():-1}getScrollHeight(){return this._modelData?this._modelData.viewModel.viewLayout.getScrollHeight():-1}getScrollTop(){return this._modelData?this._modelData.viewModel.viewLayout.getCurrentScrollTop():-1}setScrollLeft(C,W=1){if(this._modelData){if(typeof C!="number")throw new Error("Invalid arguments");this._modelData.viewModel.viewLayout.setScrollPosition({scrollLeft:C},W)}}setScrollTop(C,W=1){if(this._modelData){if(typeof C!="number")throw new Error("Invalid arguments");this._modelData.viewModel.viewLayout.setScrollPosition({scrollTop:C},W)}}setScrollPosition(C,W=1){this._modelData&&this._modelData.viewModel.viewLayout.setScrollPosition(C,W)}hasPendingScrollAnimation(){return this._modelData?this._modelData.viewModel.viewLayout.hasPendingScrollAnimation():!1}saveViewState(){if(!this._modelData)return null;const C=this._contributions.saveViewState(),W=this._modelData.viewModel.saveCursorState(),V=this._modelData.viewModel.saveState();return{cursorState:W,viewState:V,contributionsState:C}}restoreViewState(C){if(!this._modelData||!this._modelData.hasRealView)return;const W=C;if(W&&W.cursorState&&W.viewState){const V=W.cursorState;Array.isArray(V)?V.length>0&&this._modelData.viewModel.restoreCursorState(V):this._modelData.viewModel.restoreCursorState([V]),this._contributions.restoreViewState(W.contributionsState||{});const U=this._modelData.viewModel.reduceRestoreState(W.viewState);this._modelData.view.restoreState(U)}}handleInitialized(){var C;(C=this._getViewModel())===null||C===void 0||C.visibleLinesStabilized()}getContribution(C){return this._contributions.get(C)}getActions(){return Array.from(this._actions.values())}getSupportedActions(){let C=this.getActions();return C=C.filter(W=>W.isSupported()),C}getAction(C){return this._actions.get(C)||null}trigger(C,W,V){switch(V=V||{},W){case"compositionStart":this._startComposition();return;case"compositionEnd":this._endComposition(C);return;case"type":{const G=V;this._type(C,G.text||"");return}case"replacePreviousChar":{const G=V;this._compositionType(C,G.text||"",G.replaceCharCnt||0,0,0);return}case"compositionType":{const G=V;this._compositionType(C,G.text||"",G.replacePrevCharCnt||0,G.replaceNextCharCnt||0,G.positionDelta||0);return}case"paste":{const G=V;this._paste(C,G.text||"",G.pasteOnNewLine||!1,G.multicursorText||null,G.mode||null);return}case"cut":this._cut(C);return}const U=this.getAction(W);if(U){Promise.resolve(U.run(V)).then(void 0,onUnexpectedError);return}this._modelData&&(this._triggerEditorCommand(C,W,V)||this._triggerCommand(W,V))}_triggerCommand(C,W){this._commandService.executeCommand(C,W)}_startComposition(){this._modelData&&(this._modelData.viewModel.startComposition(),this._onDidCompositionStart.fire())}_endComposition(C){this._modelData&&(this._modelData.viewModel.endComposition(C),this._onDidCompositionEnd.fire())}_type(C,W){!this._modelData||W.length===0||(C==="keyboard"&&this._onWillType.fire(W),this._modelData.viewModel.type(W,C),C==="keyboard"&&this._onDidType.fire(W))}_compositionType(C,W,V,U,G){this._modelData&&this._modelData.viewModel.compositionType(W,V,U,G,C)}_paste(C,W,V,U,G){if(!this._modelData||W.length===0)return;const Z=this._modelData.viewModel,X=Z.getSelection().getStartPosition();Z.paste(W,V,U,C);const Q=Z.getSelection().getStartPosition();C==="keyboard"&&this._onDidPaste.fire({range:new Range$2(X.lineNumber,X.column,Q.lineNumber,Q.column),languageId:G})}_cut(C){this._modelData&&this._modelData.viewModel.cut(C)}_triggerEditorCommand(C,W,V){const U=EditorExtensionsRegistry.getEditorCommand(W);return U?(V=V||{},V.source=C,this._instantiationService.invokeFunction(G=>{Promise.resolve(U.runEditorCommand(G,this,V)).then(void 0,onUnexpectedError)}),!0):!1}_getViewModel(){return this._modelData?this._modelData.viewModel:null}pushUndoStop(){return!this._modelData||this._configuration.options.get(90)?!1:(this._modelData.model.pushStackElement(),!0)}popUndoStop(){return!this._modelData||this._configuration.options.get(90)?!1:(this._modelData.model.popStackElement(),!0)}executeEdits(C,W,V){if(!this._modelData||this._configuration.options.get(90))return!1;let U;return V?Array.isArray(V)?U=()=>V:U=V:U=()=>null,this._modelData.viewModel.executeEdits(C,W,U),!0}executeCommand(C,W){this._modelData&&this._modelData.viewModel.executeCommand(W,C)}executeCommands(C,W){this._modelData&&this._modelData.viewModel.executeCommands(W,C)}createDecorationsCollection(C){return new EditorDecorationsCollection(this,C)}changeDecorations(C){return this._modelData?this._modelData.model.changeDecorations(C,this._id):null}getLineDecorations(C){return this._modelData?this._modelData.model.getLineDecorations(C,this._id,filterValidationDecorations(this._configuration.options)):null}getDecorationsInRange(C){return this._modelData?this._modelData.model.getDecorationsInRange(C,this._id,filterValidationDecorations(this._configuration.options)):null}deltaDecorations(C,W){return this._modelData?C.length===0&&W.length===0?C:this._modelData.model.deltaDecorations(C,W,this._id):[]}removeDecorations(C){!this._modelData||C.length===0||this._modelData.model.changeDecorations(W=>{W.deltaDecorations(C,[])})}removeDecorationsByType(C){const W=this._decorationTypeKeysToIds[C];W&&this.deltaDecorations(W,[]),this._decorationTypeKeysToIds.hasOwnProperty(C)&&delete this._decorationTypeKeysToIds[C],this._decorationTypeSubtypes.hasOwnProperty(C)&&delete this._decorationTypeSubtypes[C]}getLayoutInfo(){return this._configuration.options.get(143)}createOverviewRuler(C){return!this._modelData||!this._modelData.hasRealView?null:this._modelData.view.createOverviewRuler(C)}getContainerDomNode(){return this._domElement}getDomNode(){return!this._modelData||!this._modelData.hasRealView?null:this._modelData.view.domNode.domNode}delegateVerticalScrollbarPointerDown(C){!this._modelData||!this._modelData.hasRealView||this._modelData.view.delegateVerticalScrollbarPointerDown(C)}delegateScrollFromMouseWheelEvent(C){!this._modelData||!this._modelData.hasRealView||this._modelData.view.delegateScrollFromMouseWheelEvent(C)}layout(C){this._configuration.observeContainer(C),this.render()}focus(){!this._modelData||!this._modelData.hasRealView||this._modelData.view.focus()}hasTextFocus(){return!this._modelData||!this._modelData.hasRealView?!1:this._modelData.view.isFocused()}hasWidgetFocus(){return this._focusTracker&&this._focusTracker.hasFocus()}addContentWidget(C){const W={widget:C,position:C.getPosition()};this._contentWidgets.hasOwnProperty(C.getId())&&console.warn("Overwriting a content widget with the same id."),this._contentWidgets[C.getId()]=W,this._modelData&&this._modelData.hasRealView&&this._modelData.view.addContentWidget(W)}layoutContentWidget(C){const W=C.getId();if(this._contentWidgets.hasOwnProperty(W)){const V=this._contentWidgets[W];V.position=C.getPosition(),this._modelData&&this._modelData.hasRealView&&this._modelData.view.layoutContentWidget(V)}}removeContentWidget(C){const W=C.getId();if(this._contentWidgets.hasOwnProperty(W)){const V=this._contentWidgets[W];delete this._contentWidgets[W],this._modelData&&this._modelData.hasRealView&&this._modelData.view.removeContentWidget(V)}}addOverlayWidget(C){const W={widget:C,position:C.getPosition()};this._overlayWidgets.hasOwnProperty(C.getId())&&console.warn("Overwriting an overlay widget with the same id."),this._overlayWidgets[C.getId()]=W,this._modelData&&this._modelData.hasRealView&&this._modelData.view.addOverlayWidget(W)}layoutOverlayWidget(C){const W=C.getId();if(this._overlayWidgets.hasOwnProperty(W)){const V=this._overlayWidgets[W];V.position=C.getPosition(),this._modelData&&this._modelData.hasRealView&&this._modelData.view.layoutOverlayWidget(V)}}removeOverlayWidget(C){const W=C.getId();if(this._overlayWidgets.hasOwnProperty(W)){const V=this._overlayWidgets[W];delete this._overlayWidgets[W],this._modelData&&this._modelData.hasRealView&&this._modelData.view.removeOverlayWidget(V)}}addGlyphMarginWidget(C){const W={widget:C,position:C.getPosition()};this._glyphMarginWidgets.hasOwnProperty(C.getId())&&console.warn("Overwriting a glyph margin widget with the same id."),this._glyphMarginWidgets[C.getId()]=W,this._modelData&&this._modelData.hasRealView&&this._modelData.view.addGlyphMarginWidget(W)}layoutGlyphMarginWidget(C){const W=C.getId();if(this._glyphMarginWidgets.hasOwnProperty(W)){const V=this._glyphMarginWidgets[W];V.position=C.getPosition(),this._modelData&&this._modelData.hasRealView&&this._modelData.view.layoutGlyphMarginWidget(V)}}removeGlyphMarginWidget(C){const W=C.getId();if(this._glyphMarginWidgets.hasOwnProperty(W)){const V=this._glyphMarginWidgets[W];delete this._glyphMarginWidgets[W],this._modelData&&this._modelData.hasRealView&&this._modelData.view.removeGlyphMarginWidget(V)}}changeViewZones(C){!this._modelData||!this._modelData.hasRealView||this._modelData.view.change(C)}getTargetAtClientPoint(C,W){return!this._modelData||!this._modelData.hasRealView?null:this._modelData.view.getTargetAtClientPoint(C,W)}getScrolledVisiblePosition(C){if(!this._modelData||!this._modelData.hasRealView)return null;const W=this._modelData.model.validatePosition(C),V=this._configuration.options,U=V.get(143),G=CodeEditorWidget_1._getVerticalOffsetForPosition(this._modelData,W.lineNumber,W.column)-this.getScrollTop(),Z=this._modelData.view.getOffsetForColumn(W.lineNumber,W.column)+U.glyphMarginWidth+U.lineNumbersWidth+U.decorationsWidth-this.getScrollLeft();return{top:G,left:Z,height:V.get(66)}}getOffsetForColumn(C,W){return!this._modelData||!this._modelData.hasRealView?-1:this._modelData.view.getOffsetForColumn(C,W)}render(C=!1){!this._modelData||!this._modelData.hasRealView||this._modelData.view.render(!0,C)}setAriaOptions(C){!this._modelData||!this._modelData.hasRealView||this._modelData.view.setAriaOptions(C)}applyFontInfo(C){applyFontInfo(C,this._configuration.options.get(50))}setBanner(C,W){this._bannerDomNode&&this._domElement.contains(this._bannerDomNode)&&this._domElement.removeChild(this._bannerDomNode),this._bannerDomNode=C,this._configuration.setReservedHeight(C?W:0),this._bannerDomNode&&this._domElement.prepend(this._bannerDomNode)}_attachModel(C){if(!C){this._modelData=null;return}const W=[];this._domElement.setAttribute("data-mode-id",C.getLanguageId()),this._configuration.setIsDominatedByLongLines(C.isDominatedByLongLines()),this._configuration.setModelLineCount(C.getLineCount());const V=C.onBeforeAttached(),U=new ViewModel$1(this._id,this._configuration,C,DOMLineBreaksComputerFactory.create(),MonospaceLineBreaksComputerFactory.create(this._configuration.options),X=>scheduleAtNextAnimationFrame(X),this.languageConfigurationService,this._themeService,V);W.push(C.onWillDispose(()=>this.setModel(null))),W.push(U.onEvent(X=>{switch(X.kind){case 0:this._onDidContentSizeChange.fire(X);break;case 1:this._editorTextFocus.setValue(X.hasFocus);break;case 2:this._onDidScrollChange.fire(X);break;case 3:this._onDidChangeViewZones.fire();break;case 4:this._onDidChangeHiddenAreas.fire();break;case 5:this._onDidAttemptReadOnlyEdit.fire();break;case 6:{if(X.reachedMaxCursorCount){const te=this.getOption(79),ie=localize("cursors.maximum","The number of cursors has been limited to {0}. Consider using [find and replace](https://code.visualstudio.com/docs/editor/codebasics#_find-and-replace) for larger changes or increase the editor multi cursor limit setting.",te);this._notificationService.prompt(Severity.Warning,ie,[{label:"Find and Replace",run:()=>{this._commandService.executeCommand("editor.action.startFindReplaceAction")}},{label:localize("goToSetting","Increase Multi Cursor Limit"),run:()=>{this._commandService.executeCommand("workbench.action.openSettings2",{query:"editor.multiCursorLimit"})}}])}const Q=[];for(let te=0,ie=X.selections.length;te<ie;te++)Q[te]=X.selections[te].getPosition();const J={position:Q[0],secondaryPositions:Q.slice(1),reason:X.reason,source:X.source};this._onDidChangeCursorPosition.fire(J);const ee={selection:X.selections[0],secondarySelections:X.selections.slice(1),modelVersionId:X.modelVersionId,oldSelections:X.oldSelections,oldModelVersionId:X.oldModelVersionId,source:X.source,reason:X.reason};this._onDidChangeCursorSelection.fire(ee);break}case 7:this._onDidChangeModelDecorations.fire(X.event);break;case 8:this._domElement.setAttribute("data-mode-id",C.getLanguageId()),this._onDidChangeModelLanguage.fire(X.event);break;case 9:this._onDidChangeModelLanguageConfiguration.fire(X.event);break;case 10:this._onDidChangeModelContent.fire(X.event);break;case 11:this._onDidChangeModelOptions.fire(X.event);break;case 12:this._onDidChangeModelTokens.fire(X.event);break}}));const[G,Z]=this._createView(U);if(Z){this._domElement.appendChild(G.domNode.domNode);let X=Object.keys(this._contentWidgets);for(let Q=0,J=X.length;Q<J;Q++){const ee=X[Q];G.addContentWidget(this._contentWidgets[ee])}X=Object.keys(this._overlayWidgets);for(let Q=0,J=X.length;Q<J;Q++){const ee=X[Q];G.addOverlayWidget(this._overlayWidgets[ee])}X=Object.keys(this._glyphMarginWidgets);for(let Q=0,J=X.length;Q<J;Q++){const ee=X[Q];G.addGlyphMarginWidget(this._glyphMarginWidgets[ee])}G.render(!1,!0),G.domNode.domNode.setAttribute("data-uri",C.uri.toString())}this._modelData=new ModelData$1(C,U,G,Z,W,V)}_createView(C){let W;this.isSimpleWidget?W={paste:(G,Z,X,Q)=>{this._paste("keyboard",G,Z,X,Q)},type:G=>{this._type("keyboard",G)},compositionType:(G,Z,X,Q)=>{this._compositionType("keyboard",G,Z,X,Q)},startComposition:()=>{this._startComposition()},endComposition:()=>{this._endComposition("keyboard")},cut:()=>{this._cut("keyboard")}}:W={paste:(G,Z,X,Q)=>{const J={text:G,pasteOnNewLine:Z,multicursorText:X,mode:Q};this._commandService.executeCommand("paste",J)},type:G=>{const Z={text:G};this._commandService.executeCommand("type",Z)},compositionType:(G,Z,X,Q)=>{if(X||Q){const J={text:G,replacePrevCharCnt:Z,replaceNextCharCnt:X,positionDelta:Q};this._commandService.executeCommand("compositionType",J)}else{const J={text:G,replaceCharCnt:Z};this._commandService.executeCommand("replacePreviousChar",J)}},startComposition:()=>{this._commandService.executeCommand("compositionStart",{})},endComposition:()=>{this._commandService.executeCommand("compositionEnd",{})},cut:()=>{this._commandService.executeCommand("cut",{})}};const V=new ViewUserInputEvents(C.coordinatesConverter);return V.onKeyDown=G=>this._onKeyDown.fire(G),V.onKeyUp=G=>this._onKeyUp.fire(G),V.onContextMenu=G=>this._onContextMenu.fire(G),V.onMouseMove=G=>this._onMouseMove.fire(G),V.onMouseLeave=G=>this._onMouseLeave.fire(G),V.onMouseDown=G=>this._onMouseDown.fire(G),V.onMouseUp=G=>this._onMouseUp.fire(G),V.onMouseDrag=G=>this._onMouseDrag.fire(G),V.onMouseDrop=G=>this._onMouseDrop.fire(G),V.onMouseDropCanceled=G=>this._onMouseDropCanceled.fire(G),V.onMouseWheel=G=>this._onMouseWheel.fire(G),[new View$1(W,this._configuration,this._themeService.getColorTheme(),C,V,this._overflowWidgetsDomNode,this._instantiationService),!0]}_postDetachModelCleanup(C){C==null||C.removeAllDecorationsWithOwnerId(this._id)}_detachModel(){if(!this._modelData)return null;const C=this._modelData.model,W=this._modelData.hasRealView?this._modelData.view.domNode.domNode:null;return this._modelData.dispose(),this._modelData=null,this._domElement.removeAttribute("data-mode-id"),W&&this._domElement.contains(W)&&this._domElement.removeChild(W),this._bannerDomNode&&this._domElement.contains(this._bannerDomNode)&&this._domElement.removeChild(this._bannerDomNode),C}_removeDecorationType(C){this._codeEditorService.removeDecorationType(C)}hasModel(){return this._modelData!==null}showDropIndicatorAt(C){const W=[{range:new Range$2(C.lineNumber,C.column,C.lineNumber,C.column),options:CodeEditorWidget_1.dropIntoEditorDecorationOptions}];this._dropIntoEditorDecorations.set(W),this.revealPosition(C,1)}removeDropIndicator(){this._dropIntoEditorDecorations.clear()}setContextValue(C,W){this._contextKeyService.createKey(C,W)}};CodeEditorWidget.dropIntoEditorDecorationOptions=ModelDecorationOptions.register({description:"workbench-dnd-target",className:"dnd-target"});CodeEditorWidget=CodeEditorWidget_1=__decorate$20([__param$1W(3,IInstantiationService),__param$1W(4,ICodeEditorService),__param$1W(5,ICommandService),__param$1W(6,IContextKeyService),__param$1W(7,IThemeService),__param$1W(8,INotificationService),__param$1W(9,IAccessibilityService),__param$1W(10,ILanguageConfigurationService),__param$1W(11,ILanguageFeaturesService)],CodeEditorWidget);class BooleanEventEmitter extends Disposable{constructor(C){super(),this._emitterOptions=C,this._onDidChangeToTrue=this._register(new Emitter$1(this._emitterOptions)),this.onDidChangeToTrue=this._onDidChangeToTrue.event,this._onDidChangeToFalse=this._register(new Emitter$1(this._emitterOptions)),this.onDidChangeToFalse=this._onDidChangeToFalse.event,this._value=0}setValue(C){const W=C?2:1;this._value!==W&&(this._value=W,this._value===2?this._onDidChangeToTrue.fire():this._value===1&&this._onDidChangeToFalse.fire())}}class InteractionEmitter extends Emitter$1{constructor(C,W){super({deliveryQueue:W}),this._contributions=C}fire(C){this._contributions.onBeforeInteractionEvent(),super.fire(C)}}class EditorContextKeysManager extends Disposable{constructor(C,W){super(),this._editor=C,W.createKey("editorId",C.getId()),this._editorSimpleInput=EditorContextKeys.editorSimpleInput.bindTo(W),this._editorFocus=EditorContextKeys.focus.bindTo(W),this._textInputFocus=EditorContextKeys.textInputFocus.bindTo(W),this._editorTextFocus=EditorContextKeys.editorTextFocus.bindTo(W),this._tabMovesFocus=EditorContextKeys.tabMovesFocus.bindTo(W),this._editorReadonly=EditorContextKeys.readOnly.bindTo(W),this._inDiffEditor=EditorContextKeys.inDiffEditor.bindTo(W),this._editorColumnSelection=EditorContextKeys.columnSelection.bindTo(W),this._hasMultipleSelections=EditorContextKeys.hasMultipleSelections.bindTo(W),this._hasNonEmptySelection=EditorContextKeys.hasNonEmptySelection.bindTo(W),this._canUndo=EditorContextKeys.canUndo.bindTo(W),this._canRedo=EditorContextKeys.canRedo.bindTo(W),this._register(this._editor.onDidChangeConfiguration(()=>this._updateFromConfig())),this._register(this._editor.onDidChangeCursorSelection(()=>this._updateFromSelection())),this._register(this._editor.onDidFocusEditorWidget(()=>this._updateFromFocus())),this._register(this._editor.onDidBlurEditorWidget(()=>this._updateFromFocus())),this._register(this._editor.onDidFocusEditorText(()=>this._updateFromFocus())),this._register(this._editor.onDidBlurEditorText(()=>this._updateFromFocus())),this._register(this._editor.onDidChangeModel(()=>this._updateFromModel())),this._register(this._editor.onDidChangeConfiguration(()=>this._updateFromModel())),this._register(TabFocus.onDidChangeTabFocus(V=>this._tabMovesFocus.set(V))),this._updateFromConfig(),this._updateFromSelection(),this._updateFromFocus(),this._updateFromModel(),this._editorSimpleInput.set(this._editor.isSimpleWidget)}_updateFromConfig(){const C=this._editor.getOptions();this._tabMovesFocus.set(TabFocus.getTabFocusMode()),this._editorReadonly.set(C.get(90)),this._inDiffEditor.set(C.get(61)),this._editorColumnSelection.set(C.get(22))}_updateFromSelection(){const C=this._editor.getSelections();C?(this._hasMultipleSelections.set(C.length>1),this._hasNonEmptySelection.set(C.some(W=>!W.isEmpty()))):(this._hasMultipleSelections.reset(),this._hasNonEmptySelection.reset())}_updateFromFocus(){this._editorFocus.set(this._editor.hasWidgetFocus()&&!this._editor.isSimpleWidget),this._editorTextFocus.set(this._editor.hasTextFocus()&&!this._editor.isSimpleWidget),this._textInputFocus.set(this._editor.hasTextFocus())}_updateFromModel(){const C=this._editor.getModel();this._canUndo.set(!!(C&&C.canUndo())),this._canRedo.set(!!(C&&C.canRedo()))}}class EditorModeContext extends Disposable{constructor(C,W,V){super(),this._editor=C,this._contextKeyService=W,this._languageFeaturesService=V,this._langId=EditorContextKeys.languageId.bindTo(W),this._hasCompletionItemProvider=EditorContextKeys.hasCompletionItemProvider.bindTo(W),this._hasCodeActionsProvider=EditorContextKeys.hasCodeActionsProvider.bindTo(W),this._hasCodeLensProvider=EditorContextKeys.hasCodeLensProvider.bindTo(W),this._hasDefinitionProvider=EditorContextKeys.hasDefinitionProvider.bindTo(W),this._hasDeclarationProvider=EditorContextKeys.hasDeclarationProvider.bindTo(W),this._hasImplementationProvider=EditorContextKeys.hasImplementationProvider.bindTo(W),this._hasTypeDefinitionProvider=EditorContextKeys.hasTypeDefinitionProvider.bindTo(W),this._hasHoverProvider=EditorContextKeys.hasHoverProvider.bindTo(W),this._hasDocumentHighlightProvider=EditorContextKeys.hasDocumentHighlightProvider.bindTo(W),this._hasDocumentSymbolProvider=EditorContextKeys.hasDocumentSymbolProvider.bindTo(W),this._hasReferenceProvider=EditorContextKeys.hasReferenceProvider.bindTo(W),this._hasRenameProvider=EditorContextKeys.hasRenameProvider.bindTo(W),this._hasSignatureHelpProvider=EditorContextKeys.hasSignatureHelpProvider.bindTo(W),this._hasInlayHintsProvider=EditorContextKeys.hasInlayHintsProvider.bindTo(W),this._hasDocumentFormattingProvider=EditorContextKeys.hasDocumentFormattingProvider.bindTo(W),this._hasDocumentSelectionFormattingProvider=EditorContextKeys.hasDocumentSelectionFormattingProvider.bindTo(W),this._hasMultipleDocumentFormattingProvider=EditorContextKeys.hasMultipleDocumentFormattingProvider.bindTo(W),this._hasMultipleDocumentSelectionFormattingProvider=EditorContextKeys.hasMultipleDocumentSelectionFormattingProvider.bindTo(W),this._isInWalkThrough=EditorContextKeys.isInWalkThroughSnippet.bindTo(W);const U=()=>this._update();this._register(C.onDidChangeModel(U)),this._register(C.onDidChangeModelLanguage(U)),this._register(V.completionProvider.onDidChange(U)),this._register(V.codeActionProvider.onDidChange(U)),this._register(V.codeLensProvider.onDidChange(U)),this._register(V.definitionProvider.onDidChange(U)),this._register(V.declarationProvider.onDidChange(U)),this._register(V.implementationProvider.onDidChange(U)),this._register(V.typeDefinitionProvider.onDidChange(U)),this._register(V.hoverProvider.onDidChange(U)),this._register(V.documentHighlightProvider.onDidChange(U)),this._register(V.documentSymbolProvider.onDidChange(U)),this._register(V.referenceProvider.onDidChange(U)),this._register(V.renameProvider.onDidChange(U)),this._register(V.documentFormattingEditProvider.onDidChange(U)),this._register(V.documentRangeFormattingEditProvider.onDidChange(U)),this._register(V.signatureHelpProvider.onDidChange(U)),this._register(V.inlayHintsProvider.onDidChange(U)),U()}dispose(){super.dispose()}reset(){this._contextKeyService.bufferChangeEvents(()=>{this._langId.reset(),this._hasCompletionItemProvider.reset(),this._hasCodeActionsProvider.reset(),this._hasCodeLensProvider.reset(),this._hasDefinitionProvider.reset(),this._hasDeclarationProvider.reset(),this._hasImplementationProvider.reset(),this._hasTypeDefinitionProvider.reset(),this._hasHoverProvider.reset(),this._hasDocumentHighlightProvider.reset(),this._hasDocumentSymbolProvider.reset(),this._hasReferenceProvider.reset(),this._hasRenameProvider.reset(),this._hasDocumentFormattingProvider.reset(),this._hasDocumentSelectionFormattingProvider.reset(),this._hasSignatureHelpProvider.reset(),this._isInWalkThrough.reset()})}_update(){const C=this._editor.getModel();if(!C){this.reset();return}this._contextKeyService.bufferChangeEvents(()=>{this._langId.set(C.getLanguageId()),this._hasCompletionItemProvider.set(this._languageFeaturesService.completionProvider.has(C)),this._hasCodeActionsProvider.set(this._languageFeaturesService.codeActionProvider.has(C)),this._hasCodeLensProvider.set(this._languageFeaturesService.codeLensProvider.has(C)),this._hasDefinitionProvider.set(this._languageFeaturesService.definitionProvider.has(C)),this._hasDeclarationProvider.set(this._languageFeaturesService.declarationProvider.has(C)),this._hasImplementationProvider.set(this._languageFeaturesService.implementationProvider.has(C)),this._hasTypeDefinitionProvider.set(this._languageFeaturesService.typeDefinitionProvider.has(C)),this._hasHoverProvider.set(this._languageFeaturesService.hoverProvider.has(C)),this._hasDocumentHighlightProvider.set(this._languageFeaturesService.documentHighlightProvider.has(C)),this._hasDocumentSymbolProvider.set(this._languageFeaturesService.documentSymbolProvider.has(C)),this._hasReferenceProvider.set(this._languageFeaturesService.referenceProvider.has(C)),this._hasRenameProvider.set(this._languageFeaturesService.renameProvider.has(C)),this._hasSignatureHelpProvider.set(this._languageFeaturesService.signatureHelpProvider.has(C)),this._hasInlayHintsProvider.set(this._languageFeaturesService.inlayHintsProvider.has(C)),this._hasDocumentFormattingProvider.set(this._languageFeaturesService.documentFormattingEditProvider.has(C)||this._languageFeaturesService.documentRangeFormattingEditProvider.has(C)),this._hasDocumentSelectionFormattingProvider.set(this._languageFeaturesService.documentRangeFormattingEditProvider.has(C)),this._hasMultipleDocumentFormattingProvider.set(this._languageFeaturesService.documentFormattingEditProvider.all(C).length+this._languageFeaturesService.documentRangeFormattingEditProvider.all(C).length>1),this._hasMultipleDocumentSelectionFormattingProvider.set(this._languageFeaturesService.documentRangeFormattingEditProvider.all(C).length>1),this._isInWalkThrough.set(C.uri.scheme===Schemas.walkThroughSnippet)})}}class CodeEditorWidgetFocusTracker extends Disposable{constructor(C){super(),this._onChange=this._register(new Emitter$1),this.onChange=this._onChange.event,this._hasFocus=!1,this._domFocusTracker=this._register(trackFocus(C)),this._register(this._domFocusTracker.onDidFocus(()=>{this._hasFocus=!0,this._onChange.fire(void 0)})),this._register(this._domFocusTracker.onDidBlur(()=>{this._hasFocus=!1,this._onChange.fire(void 0)}))}hasFocus(){return this._hasFocus}}class EditorDecorationsCollection{get length(){return this._decorationIds.length}constructor(C,W){this._editor=C,this._decorationIds=[],this._isChangingDecorations=!1,Array.isArray(W)&&W.length>0&&this.set(W)}onDidChange(C,W,V){return this._editor.onDidChangeModelDecorations(U=>{this._isChangingDecorations||C.call(W,U)},V)}getRange(C){return!this._editor.hasModel()||C>=this._decorationIds.length?null:this._editor.getModel().getDecorationRange(this._decorationIds[C])}getRanges(){if(!this._editor.hasModel())return[];const C=this._editor.getModel(),W=[];for(const V of this._decorationIds){const U=C.getDecorationRange(V);U&&W.push(U)}return W}has(C){return this._decorationIds.includes(C.id)}clear(){this._decorationIds.length!==0&&this.set([])}set(C){try{this._isChangingDecorations=!0,this._editor.changeDecorations(W=>{this._decorationIds=W.deltaDecorations(this._decorationIds,C)})}finally{this._isChangingDecorations=!1}return this._decorationIds}}const squigglyStart=encodeURIComponent("<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 6 3' enable-background='new 0 0 6 3' height='3' width='6'><g fill='"),squigglyEnd=encodeURIComponent("'><polygon points='5.5,0 2.5,3 1.1,3 4.1,0'/><polygon points='4,0 6,2 6,0.6 5.4,0'/><polygon points='0,2 1,3 2.4,3 0,0.6'/></g></svg>");function getSquigglySVGData(K){return squigglyStart+encodeURIComponent(K.toString())+squigglyEnd}const dotdotdotStart=encodeURIComponent('<svg xmlns="http://www.w3.org/2000/svg" height="3" width="12"><g fill="'),dotdotdotEnd=encodeURIComponent('"><circle cx="1" cy="1" r="1"/><circle cx="5" cy="1" r="1"/><circle cx="9" cy="1" r="1"/></g></svg>');function getDotDotDotSVGData(K){return dotdotdotStart+encodeURIComponent(K.toString())+dotdotdotEnd}registerThemingParticipant((K,C)=>{const W=K.getColor(editorErrorForeground);W&&C.addRule(`.monaco-editor .squiggly-error { background: url("data:image/svg+xml,${getSquigglySVGData(W)}") repeat-x bottom left; }`);const V=K.getColor(editorWarningForeground);V&&C.addRule(`.monaco-editor .squiggly-warning { background: url("data:image/svg+xml,${getSquigglySVGData(V)}") repeat-x bottom left; }`);const U=K.getColor(editorInfoForeground);U&&C.addRule(`.monaco-editor .squiggly-info { background: url("data:image/svg+xml,${getSquigglySVGData(U)}") repeat-x bottom left; }`);const G=K.getColor(editorHintForeground);G&&C.addRule(`.monaco-editor .squiggly-hint { background: url("data:image/svg+xml,${getDotDotDotSVGData(G)}") no-repeat bottom left; }`);const Z=K.getColor(editorUnnecessaryCodeOpacity);Z&&C.addRule(`.monaco-editor.showUnused .squiggly-inline-unnecessary { opacity: ${Z.rgba.a}; }`)});var __decorate$1$=globalThis&&globalThis.__decorate||function(K,C,W,V){var U=arguments.length,G=U<3?C:V===null?V=Object.getOwnPropertyDescriptor(C,W):V,Z;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")G=Reflect.decorate(K,C,W,V);else for(var X=K.length-1;X>=0;X--)(Z=K[X])&&(G=(U<3?Z(G):U>3?Z(C,W,G):Z(C,W))||G);return U>3&&G&&Object.defineProperty(C,W,G),G},__param$1V=globalThis&&globalThis.__param||function(K,C){return function(W,V){C(W,V,K)}},__awaiter$1t=globalThis&&globalThis.__awaiter||function(K,C,W,V){function U(G){return G instanceof W?G:new W(function(Z){Z(G)})}return new(W||(W=Promise))(function(G,Z){function X(ee){try{J(V.next(ee))}catch(te){Z(te)}}function Q(ee){try{J(V.throw(ee))}catch(te){Z(te)}}function J(ee){ee.done?G(ee.value):U(ee.value).then(X,Q)}J((V=V.apply(K,C||[])).next())})};let AbstractCodeEditorService=class extends Disposable{constructor(C){super(),this._themeService=C,this._onWillCreateCodeEditor=this._register(new Emitter$1),this._onCodeEditorAdd=this._register(new Emitter$1),this.onCodeEditorAdd=this._onCodeEditorAdd.event,this._onCodeEditorRemove=this._register(new Emitter$1),this.onCodeEditorRemove=this._onCodeEditorRemove.event,this._onWillCreateDiffEditor=this._register(new Emitter$1),this._onDiffEditorAdd=this._register(new Emitter$1),this.onDiffEditorAdd=this._onDiffEditorAdd.event,this._onDiffEditorRemove=this._register(new Emitter$1),this.onDiffEditorRemove=this._onDiffEditorRemove.event,this._decorationOptionProviders=new Map,this._codeEditorOpenHandlers=new LinkedList,this._modelProperties=new Map,this._codeEditors=Object.create(null),this._diffEditors=Object.create(null),this._globalStyleSheet=null}willCreateCodeEditor(){this._onWillCreateCodeEditor.fire()}addCodeEditor(C){this._codeEditors[C.getId()]=C,this._onCodeEditorAdd.fire(C)}removeCodeEditor(C){delete this._codeEditors[C.getId()]&&this._onCodeEditorRemove.fire(C)}listCodeEditors(){return Object.keys(this._codeEditors).map(C=>this._codeEditors[C])}willCreateDiffEditor(){this._onWillCreateDiffEditor.fire()}addDiffEditor(C){this._diffEditors[C.getId()]=C,this._onDiffEditorAdd.fire(C)}listDiffEditors(){return Object.keys(this._diffEditors).map(C=>this._diffEditors[C])}getFocusedCodeEditor(){let C=null;const W=this.listCodeEditors();for(const V of W){if(V.hasTextFocus())return V;V.hasWidgetFocus()&&(C=V)}return C}removeDecorationType(C){const W=this._decorationOptionProviders.get(C);W&&(W.refCount--,W.refCount<=0&&(this._decorationOptionProviders.delete(C),W.dispose(),this.listCodeEditors().forEach(V=>V.removeDecorationsByType(C))))}setModelProperty(C,W,V){const U=C.toString();let G;this._modelProperties.has(U)?G=this._modelProperties.get(U):(G=new Map,this._modelProperties.set(U,G)),G.set(W,V)}getModelProperty(C,W){const V=C.toString();if(this._modelProperties.has(V))return this._modelProperties.get(V).get(W)}openCodeEditor(C,W,V){return __awaiter$1t(this,void 0,void 0,function*(){for(const U of this._codeEditorOpenHandlers){const G=yield U(C,W,V);if(G!==null)return G}return null})}registerCodeEditorOpenHandler(C){const W=this._codeEditorOpenHandlers.unshift(C);return toDisposable(W)}};AbstractCodeEditorService=__decorate$1$([__param$1V(0,IThemeService)],AbstractCodeEditorService);var __decorate$1_=globalThis&&globalThis.__decorate||function(K,C,W,V){var U=arguments.length,G=U<3?C:V===null?V=Object.getOwnPropertyDescriptor(C,W):V,Z;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")G=Reflect.decorate(K,C,W,V);else for(var X=K.length-1;X>=0;X--)(Z=K[X])&&(G=(U<3?Z(G):U>3?Z(C,W,G):Z(C,W))||G);return U>3&&G&&Object.defineProperty(C,W,G),G},__param$1U=globalThis&&globalThis.__param||function(K,C){return function(W,V){C(W,V,K)}},__awaiter$1s=globalThis&&globalThis.__awaiter||function(K,C,W,V){function U(G){return G instanceof W?G:new W(function(Z){Z(G)})}return new(W||(W=Promise))(function(G,Z){function X(ee){try{J(V.next(ee))}catch(te){Z(te)}}function Q(ee){try{J(V.throw(ee))}catch(te){Z(te)}}function J(ee){ee.done?G(ee.value):U(ee.value).then(X,Q)}J((V=V.apply(K,C||[])).next())})};let StandaloneCodeEditorService=class extends AbstractCodeEditorService{constructor(C,W){super(W),this._register(this.onCodeEditorAdd(()=>this._checkContextKey())),this._register(this.onCodeEditorRemove(()=>this._checkContextKey())),this._editorIsOpen=C.createKey("editorIsOpen",!1),this._activeCodeEditor=null,this._register(this.registerCodeEditorOpenHandler((V,U,G)=>__awaiter$1s(this,void 0,void 0,function*(){return U?this.doOpenEditor(U,V):null})))}_checkContextKey(){let C=!1;for(const W of this.listCodeEditors())if(!W.isSimpleWidget){C=!0;break}this._editorIsOpen.set(C)}setActiveCodeEditor(C){this._activeCodeEditor=C}getActiveCodeEditor(){return this._activeCodeEditor}doOpenEditor(C,W){if(!this.findModel(C,W.resource)){if(W.resource){const G=W.resource.scheme;if(G===Schemas.http||G===Schemas.https)return windowOpenNoOpener(W.resource.toString()),C}return null}const U=W.options?W.options.selection:null;if(U)if(typeof U.endLineNumber=="number"&&typeof U.endColumn=="number")C.setSelection(U),C.revealRangeInCenter(U,1);else{const G={lineNumber:U.startLineNumber,column:U.startColumn};C.setPosition(G),C.revealPositionInCenter(G,1)}return C}findModel(C,W){const V=C.getModel();return V&&V.uri.toString()!==W.toString()?null:V}};StandaloneCodeEditorService=__decorate$1_([__param$1U(0,IContextKeyService),__param$1U(1,IThemeService)],StandaloneCodeEditorService);registerSingleton(ICodeEditorService,StandaloneCodeEditorService,0);const ILayoutService=createDecorator("layoutService");var __decorate$1Z=globalThis&&globalThis.__decorate||function(K,C,W,V){var U=arguments.length,G=U<3?C:V===null?V=Object.getOwnPropertyDescriptor(C,W):V,Z;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")G=Reflect.decorate(K,C,W,V);else for(var X=K.length-1;X>=0;X--)(Z=K[X])&&(G=(U<3?Z(G):U>3?Z(C,W,G):Z(C,W))||G);return U>3&&G&&Object.defineProperty(C,W,G),G},__param$1T=globalThis&&globalThis.__param||function(K,C){return function(W,V){C(W,V,K)}};let StandaloneLayoutService=class{get dimension(){return this._dimension||(this._dimension=getClientArea(window.document.body)),this._dimension}get hasContainer(){return!1}get container(){throw new Error("ILayoutService.container is not available in the standalone editor!")}focus(){var C;(C=this._codeEditorService.getFocusedCodeEditor())===null||C===void 0||C.focus()}constructor(C){this._codeEditorService=C,this.onDidLayout=Event$1.None,this.offset={top:0,quickPickTop:0}}};StandaloneLayoutService=__decorate$1Z([__param$1T(0,ICodeEditorService)],StandaloneLayoutService);let EditorScopedLayoutService=class extends StandaloneLayoutService{get hasContainer(){return!1}get container(){return this._container}constructor(C,W){super(W),this._container=C}};EditorScopedLayoutService=__decorate$1Z([__param$1T(1,ICodeEditorService)],EditorScopedLayoutService);registerSingleton(ILayoutService,StandaloneLayoutService,1);const IDialogService=createDecorator("dialogService");var __decorate$1Y=globalThis&&globalThis.__decorate||function(K,C,W,V){var U=arguments.length,G=U<3?C:V===null?V=Object.getOwnPropertyDescriptor(C,W):V,Z;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")G=Reflect.decorate(K,C,W,V);else for(var X=K.length-1;X>=0;X--)(Z=K[X])&&(G=(U<3?Z(G):U>3?Z(C,W,G):Z(C,W))||G);return U>3&&G&&Object.defineProperty(C,W,G),G},__param$1S=globalThis&&globalThis.__param||function(K,C){return function(W,V){C(W,V,K)}},__awaiter$1r=globalThis&&globalThis.__awaiter||function(K,C,W,V){function U(G){return G instanceof W?G:new W(function(Z){Z(G)})}return new(W||(W=Promise))(function(G,Z){function X(ee){try{J(V.next(ee))}catch(te){Z(te)}}function Q(ee){try{J(V.throw(ee))}catch(te){Z(te)}}function J(ee){ee.done?G(ee.value):U(ee.value).then(X,Q)}J((V=V.apply(K,C||[])).next())})};function getResourceLabel(K){return K.scheme===Schemas.file?K.fsPath:K.path}let stackElementCounter=0;class ResourceStackElement{constructor(C,W,V,U,G,Z,X){this.id=++stackElementCounter,this.type=0,this.actual=C,this.label=C.label,this.confirmBeforeUndo=C.confirmBeforeUndo||!1,this.resourceLabel=W,this.strResource=V,this.resourceLabels=[this.resourceLabel],this.strResources=[this.strResource],this.groupId=U,this.groupOrder=G,this.sourceId=Z,this.sourceOrder=X,this.isValid=!0}setValid(C){this.isValid=C}toString(){return`[id:${this.id}] [group:${this.groupId}] [${this.isValid?"  VALID":"INVALID"}] ${this.actual.constructor.name} - ${this.actual}`}}class ResourceReasonPair{constructor(C,W){this.resourceLabel=C,this.reason=W}}class RemovedResources{constructor(){this.elements=new Map}createMessage(){const C=[],W=[];for(const[,U]of this.elements)(U.reason===0?C:W).push(U.resourceLabel);const V=[];return C.length>0&&V.push(localize({key:"externalRemoval",comment:["{0} is a list of filenames"]},"The following files have been closed and modified on disk: {0}.",C.join(", "))),W.length>0&&V.push(localize({key:"noParallelUniverses",comment:["{0} is a list of filenames"]},"The following files have been modified in an incompatible way: {0}.",W.join(", "))),V.join(`
`)}get size(){return this.elements.size}has(C){return this.elements.has(C)}set(C,W){this.elements.set(C,W)}delete(C){return this.elements.delete(C)}}class WorkspaceStackElement{constructor(C,W,V,U,G,Z,X){this.id=++stackElementCounter,this.type=1,this.actual=C,this.label=C.label,this.confirmBeforeUndo=C.confirmBeforeUndo||!1,this.resourceLabels=W,this.strResources=V,this.groupId=U,this.groupOrder=G,this.sourceId=Z,this.sourceOrder=X,this.removedResources=null,this.invalidatedResources=null}canSplit(){return typeof this.actual.split=="function"}removeResource(C,W,V){this.removedResources||(this.removedResources=new RemovedResources),this.removedResources.has(W)||this.removedResources.set(W,new ResourceReasonPair(C,V))}setValid(C,W,V){V?this.invalidatedResources&&(this.invalidatedResources.delete(W),this.invalidatedResources.size===0&&(this.invalidatedResources=null)):(this.invalidatedResources||(this.invalidatedResources=new RemovedResources),this.invalidatedResources.has(W)||this.invalidatedResources.set(W,new ResourceReasonPair(C,0)))}toString(){return`[id:${this.id}] [group:${this.groupId}] [${this.invalidatedResources?"INVALID":"  VALID"}] ${this.actual.constructor.name} - ${this.actual}`}}class ResourceEditStack{constructor(C,W){this.resourceLabel=C,this.strResource=W,this._past=[],this._future=[],this.locked=!1,this.versionId=1}dispose(){for(const C of this._past)C.type===1&&C.removeResource(this.resourceLabel,this.strResource,0);for(const C of this._future)C.type===1&&C.removeResource(this.resourceLabel,this.strResource,0);this.versionId++}toString(){const C=[];C.push(`* ${this.strResource}:`);for(let W=0;W<this._past.length;W++)C.push(`   * [UNDO] ${this._past[W]}`);for(let W=this._future.length-1;W>=0;W--)C.push(`   * [REDO] ${this._future[W]}`);return C.join(`
`)}flushAllElements(){this._past=[],this._future=[],this.versionId++}_setElementValidFlag(C,W){C.type===1?C.setValid(this.resourceLabel,this.strResource,W):C.setValid(W)}setElementsValidFlag(C,W){for(const V of this._past)W(V.actual)&&this._setElementValidFlag(V,C);for(const V of this._future)W(V.actual)&&this._setElementValidFlag(V,C)}pushElement(C){for(const W of this._future)W.type===1&&W.removeResource(this.resourceLabel,this.strResource,1);this._future=[],this._past.push(C),this.versionId++}createSnapshot(C){const W=[];for(let V=0,U=this._past.length;V<U;V++)W.push(this._past[V].id);for(let V=this._future.length-1;V>=0;V--)W.push(this._future[V].id);return new ResourceEditStackSnapshot(C,W)}restoreSnapshot(C){const W=C.elements.length;let V=!0,U=0,G=-1;for(let X=0,Q=this._past.length;X<Q;X++,U++){const J=this._past[X];V&&(U>=W||J.id!==C.elements[U])&&(V=!1,G=0),!V&&J.type===1&&J.removeResource(this.resourceLabel,this.strResource,0)}let Z=-1;for(let X=this._future.length-1;X>=0;X--,U++){const Q=this._future[X];V&&(U>=W||Q.id!==C.elements[U])&&(V=!1,Z=X),!V&&Q.type===1&&Q.removeResource(this.resourceLabel,this.strResource,0)}G!==-1&&(this._past=this._past.slice(0,G)),Z!==-1&&(this._future=this._future.slice(Z+1)),this.versionId++}getElements(){const C=[],W=[];for(const V of this._past)C.push(V.actual);for(const V of this._future)W.push(V.actual);return{past:C,future:W}}getClosestPastElement(){return this._past.length===0?null:this._past[this._past.length-1]}getSecondClosestPastElement(){return this._past.length<2?null:this._past[this._past.length-2]}getClosestFutureElement(){return this._future.length===0?null:this._future[this._future.length-1]}hasPastElements(){return this._past.length>0}hasFutureElements(){return this._future.length>0}splitPastWorkspaceElement(C,W){for(let V=this._past.length-1;V>=0;V--)if(this._past[V]===C){W.has(this.strResource)?this._past[V]=W.get(this.strResource):this._past.splice(V,1);break}this.versionId++}splitFutureWorkspaceElement(C,W){for(let V=this._future.length-1;V>=0;V--)if(this._future[V]===C){W.has(this.strResource)?this._future[V]=W.get(this.strResource):this._future.splice(V,1);break}this.versionId++}moveBackward(C){this._past.pop(),this._future.push(C),this.versionId++}moveForward(C){this._future.pop(),this._past.push(C),this.versionId++}}class EditStackSnapshot{constructor(C){this.editStacks=C,this._versionIds=[];for(let W=0,V=this.editStacks.length;W<V;W++)this._versionIds[W]=this.editStacks[W].versionId}isValid(){for(let C=0,W=this.editStacks.length;C<W;C++)if(this._versionIds[C]!==this.editStacks[C].versionId)return!1;return!0}}const missingEditStack=new ResourceEditStack("","");missingEditStack.locked=!0;let UndoRedoService=class{constructor(C,W){this._dialogService=C,this._notificationService=W,this._editStacks=new Map,this._uriComparisonKeyComputers=[]}getUriComparisonKey(C){for(const W of this._uriComparisonKeyComputers)if(W[0]===C.scheme)return W[1].getComparisonKey(C);return C.toString()}_print(C){console.log("------------------------------------"),console.log(`AFTER ${C}: `);const W=[];for(const V of this._editStacks)W.push(V[1].toString());console.log(W.join(`
`))}pushElement(C,W=UndoRedoGroup.None,V=UndoRedoSource.None){if(C.type===0){const U=getResourceLabel(C.resource),G=this.getUriComparisonKey(C.resource);this._pushElement(new ResourceStackElement(C,U,G,W.id,W.nextOrder(),V.id,V.nextOrder()))}else{const U=new Set,G=[],Z=[];for(const X of C.resources){const Q=getResourceLabel(X),J=this.getUriComparisonKey(X);U.has(J)||(U.add(J),G.push(Q),Z.push(J))}G.length===1?this._pushElement(new ResourceStackElement(C,G[0],Z[0],W.id,W.nextOrder(),V.id,V.nextOrder())):this._pushElement(new WorkspaceStackElement(C,G,Z,W.id,W.nextOrder(),V.id,V.nextOrder()))}}_pushElement(C){for(let W=0,V=C.strResources.length;W<V;W++){const U=C.resourceLabels[W],G=C.strResources[W];let Z;this._editStacks.has(G)?Z=this._editStacks.get(G):(Z=new ResourceEditStack(U,G),this._editStacks.set(G,Z)),Z.pushElement(C)}}getLastElement(C){const W=this.getUriComparisonKey(C);if(this._editStacks.has(W)){const V=this._editStacks.get(W);if(V.hasFutureElements())return null;const U=V.getClosestPastElement();return U?U.actual:null}return null}_splitPastWorkspaceElement(C,W){const V=C.actual.split(),U=new Map;for(const G of V){const Z=getResourceLabel(G.resource),X=this.getUriComparisonKey(G.resource),Q=new ResourceStackElement(G,Z,X,0,0,0,0);U.set(Q.strResource,Q)}for(const G of C.strResources){if(W&&W.has(G))continue;this._editStacks.get(G).splitPastWorkspaceElement(C,U)}}_splitFutureWorkspaceElement(C,W){const V=C.actual.split(),U=new Map;for(const G of V){const Z=getResourceLabel(G.resource),X=this.getUriComparisonKey(G.resource),Q=new ResourceStackElement(G,Z,X,0,0,0,0);U.set(Q.strResource,Q)}for(const G of C.strResources){if(W&&W.has(G))continue;this._editStacks.get(G).splitFutureWorkspaceElement(C,U)}}removeElements(C){const W=typeof C=="string"?C:this.getUriComparisonKey(C);this._editStacks.has(W)&&(this._editStacks.get(W).dispose(),this._editStacks.delete(W))}setElementsValidFlag(C,W,V){const U=this.getUriComparisonKey(C);this._editStacks.has(U)&&this._editStacks.get(U).setElementsValidFlag(W,V)}createSnapshot(C){const W=this.getUriComparisonKey(C);return this._editStacks.has(W)?this._editStacks.get(W).createSnapshot(C):new ResourceEditStackSnapshot(C,[])}restoreSnapshot(C){const W=this.getUriComparisonKey(C.resource);if(this._editStacks.has(W)){const V=this._editStacks.get(W);V.restoreSnapshot(C),!V.hasPastElements()&&!V.hasFutureElements()&&(V.dispose(),this._editStacks.delete(W))}}getElements(C){const W=this.getUriComparisonKey(C);return this._editStacks.has(W)?this._editStacks.get(W).getElements():{past:[],future:[]}}_findClosestUndoElementWithSource(C){if(!C)return[null,null];let W=null,V=null;for(const[U,G]of this._editStacks){const Z=G.getClosestPastElement();Z&&Z.sourceId===C&&(!W||Z.sourceOrder>W.sourceOrder)&&(W=Z,V=U)}return[W,V]}canUndo(C){if(C instanceof UndoRedoSource){const[,V]=this._findClosestUndoElementWithSource(C.id);return!!V}const W=this.getUriComparisonKey(C);return this._editStacks.has(W)?this._editStacks.get(W).hasPastElements():!1}_onError(C,W){onUnexpectedError(C);for(const V of W.strResources)this.removeElements(V);this._notificationService.error(C)}_acquireLocks(C){for(const W of C.editStacks)if(W.locked)throw new Error("Cannot acquire edit stack lock");for(const W of C.editStacks)W.locked=!0;return()=>{for(const W of C.editStacks)W.locked=!1}}_safeInvokeWithLocks(C,W,V,U,G){const Z=this._acquireLocks(V);let X;try{X=W()}catch(Q){return Z(),U.dispose(),this._onError(Q,C)}return X?X.then(()=>(Z(),U.dispose(),G()),Q=>(Z(),U.dispose(),this._onError(Q,C))):(Z(),U.dispose(),G())}_invokeWorkspacePrepare(C){return __awaiter$1r(this,void 0,void 0,function*(){if(typeof C.actual.prepareUndoRedo>"u")return Disposable.None;const W=C.actual.prepareUndoRedo();return typeof W>"u"?Disposable.None:W})}_invokeResourcePrepare(C,W){if(C.actual.type!==1||typeof C.actual.prepareUndoRedo>"u")return W(Disposable.None);const V=C.actual.prepareUndoRedo();return V?isDisposable(V)?W(V):V.then(U=>W(U)):W(Disposable.None)}_getAffectedEditStacks(C){const W=[];for(const V of C.strResources)W.push(this._editStacks.get(V)||missingEditStack);return new EditStackSnapshot(W)}_tryToSplitAndUndo(C,W,V,U){if(W.canSplit())return this._splitPastWorkspaceElement(W,V),this._notificationService.warn(U),new WorkspaceVerificationError(this._undo(C,0,!0));for(const G of W.strResources)this.removeElements(G);return this._notificationService.warn(U),new WorkspaceVerificationError}_checkWorkspaceUndo(C,W,V,U){if(W.removedResources)return this._tryToSplitAndUndo(C,W,W.removedResources,localize({key:"cannotWorkspaceUndo",comment:["{0} is a label for an operation. {1} is another message."]},"Could not undo '{0}' across all files. {1}",W.label,W.removedResources.createMessage()));if(U&&W.invalidatedResources)return this._tryToSplitAndUndo(C,W,W.invalidatedResources,localize({key:"cannotWorkspaceUndo",comment:["{0} is a label for an operation. {1} is another message."]},"Could not undo '{0}' across all files. {1}",W.label,W.invalidatedResources.createMessage()));const G=[];for(const X of V.editStacks)X.getClosestPastElement()!==W&&G.push(X.resourceLabel);if(G.length>0)return this._tryToSplitAndUndo(C,W,null,localize({key:"cannotWorkspaceUndoDueToChanges",comment:["{0} is a label for an operation. {1} is a list of filenames."]},"Could not undo '{0}' across all files because changes were made to {1}",W.label,G.join(", ")));const Z=[];for(const X of V.editStacks)X.locked&&Z.push(X.resourceLabel);return Z.length>0?this._tryToSplitAndUndo(C,W,null,localize({key:"cannotWorkspaceUndoDueToInProgressUndoRedo",comment:["{0} is a label for an operation. {1} is a list of filenames."]},"Could not undo '{0}' across all files because there is already an undo or redo operation running on {1}",W.label,Z.join(", "))):V.isValid()?null:this._tryToSplitAndUndo(C,W,null,localize({key:"cannotWorkspaceUndoDueToInMeantimeUndoRedo",comment:["{0} is a label for an operation. {1} is a list of filenames."]},"Could not undo '{0}' across all files because an undo or redo operation occurred in the meantime",W.label))}_workspaceUndo(C,W,V){const U=this._getAffectedEditStacks(W),G=this._checkWorkspaceUndo(C,W,U,!1);return G?G.returnValue:this._confirmAndExecuteWorkspaceUndo(C,W,U,V)}_isPartOfUndoGroup(C){if(!C.groupId)return!1;for(const[,W]of this._editStacks){const V=W.getClosestPastElement();if(V){if(V===C){const U=W.getSecondClosestPastElement();if(U&&U.groupId===C.groupId)return!0}if(V.groupId===C.groupId)return!0}}return!1}_confirmAndExecuteWorkspaceUndo(C,W,V,U){return __awaiter$1r(this,void 0,void 0,function*(){if(W.canSplit()&&!this._isPartOfUndoGroup(W)){let X;(function(ee){ee[ee.All=0]="All",ee[ee.This=1]="This",ee[ee.Cancel=2]="Cancel"})(X||(X={}));const{result:Q}=yield this._dialogService.prompt({type:Severity$2.Info,message:localize("confirmWorkspace","Would you like to undo '{0}' across all files?",W.label),buttons:[{label:localize({key:"ok",comment:["{0} denotes a number that is > 1, && denotes a mnemonic"]},"&&Undo in {0} Files",V.editStacks.length),run:()=>X.All},{label:localize({key:"nok",comment:["&& denotes a mnemonic"]},"Undo this &&File"),run:()=>X.This}],cancelButton:{run:()=>X.Cancel}});if(Q===X.Cancel)return;if(Q===X.This)return this._splitPastWorkspaceElement(W,null),this._undo(C,0,!0);const J=this._checkWorkspaceUndo(C,W,V,!1);if(J)return J.returnValue;U=!0}let G;try{G=yield this._invokeWorkspacePrepare(W)}catch(X){return this._onError(X,W)}const Z=this._checkWorkspaceUndo(C,W,V,!0);if(Z)return G.dispose(),Z.returnValue;for(const X of V.editStacks)X.moveBackward(W);return this._safeInvokeWithLocks(W,()=>W.actual.undo(),V,G,()=>this._continueUndoInGroup(W.groupId,U))})}_resourceUndo(C,W,V){if(!W.isValid){C.flushAllElements();return}if(C.locked){const U=localize({key:"cannotResourceUndoDueToInProgressUndoRedo",comment:["{0} is a label for an operation."]},"Could not undo '{0}' because there is already an undo or redo operation running.",W.label);this._notificationService.warn(U);return}return this._invokeResourcePrepare(W,U=>(C.moveBackward(W),this._safeInvokeWithLocks(W,()=>W.actual.undo(),new EditStackSnapshot([C]),U,()=>this._continueUndoInGroup(W.groupId,V))))}_findClosestUndoElementInGroup(C){if(!C)return[null,null];let W=null,V=null;for(const[U,G]of this._editStacks){const Z=G.getClosestPastElement();Z&&Z.groupId===C&&(!W||Z.groupOrder>W.groupOrder)&&(W=Z,V=U)}return[W,V]}_continueUndoInGroup(C,W){if(!C)return;const[,V]=this._findClosestUndoElementInGroup(C);if(V)return this._undo(V,0,W)}undo(C){if(C instanceof UndoRedoSource){const[,W]=this._findClosestUndoElementWithSource(C.id);return W?this._undo(W,C.id,!1):void 0}return typeof C=="string"?this._undo(C,0,!1):this._undo(this.getUriComparisonKey(C),0,!1)}_undo(C,W=0,V){if(!this._editStacks.has(C))return;const U=this._editStacks.get(C),G=U.getClosestPastElement();if(!G)return;if(G.groupId){const[X,Q]=this._findClosestUndoElementInGroup(G.groupId);if(G!==X&&Q)return this._undo(Q,W,V)}if((G.sourceId!==W||G.confirmBeforeUndo)&&!V)return this._confirmAndContinueUndo(C,W,G);try{return G.type===1?this._workspaceUndo(C,G,V):this._resourceUndo(U,G,V)}finally{}}_confirmAndContinueUndo(C,W,V){return __awaiter$1r(this,void 0,void 0,function*(){if((yield this._dialogService.confirm({message:localize("confirmDifferentSource","Would you like to undo '{0}'?",V.label),primaryButton:localize({key:"confirmDifferentSource.yes",comment:["&& denotes a mnemonic"]},"&&Yes"),cancelButton:localize("confirmDifferentSource.no","No")})).confirmed)return this._undo(C,W,!0)})}_findClosestRedoElementWithSource(C){if(!C)return[null,null];let W=null,V=null;for(const[U,G]of this._editStacks){const Z=G.getClosestFutureElement();Z&&Z.sourceId===C&&(!W||Z.sourceOrder<W.sourceOrder)&&(W=Z,V=U)}return[W,V]}canRedo(C){if(C instanceof UndoRedoSource){const[,V]=this._findClosestRedoElementWithSource(C.id);return!!V}const W=this.getUriComparisonKey(C);return this._editStacks.has(W)?this._editStacks.get(W).hasFutureElements():!1}_tryToSplitAndRedo(C,W,V,U){if(W.canSplit())return this._splitFutureWorkspaceElement(W,V),this._notificationService.warn(U),new WorkspaceVerificationError(this._redo(C));for(const G of W.strResources)this.removeElements(G);return this._notificationService.warn(U),new WorkspaceVerificationError}_checkWorkspaceRedo(C,W,V,U){if(W.removedResources)return this._tryToSplitAndRedo(C,W,W.removedResources,localize({key:"cannotWorkspaceRedo",comment:["{0} is a label for an operation. {1} is another message."]},"Could not redo '{0}' across all files. {1}",W.label,W.removedResources.createMessage()));if(U&&W.invalidatedResources)return this._tryToSplitAndRedo(C,W,W.invalidatedResources,localize({key:"cannotWorkspaceRedo",comment:["{0} is a label for an operation. {1} is another message."]},"Could not redo '{0}' across all files. {1}",W.label,W.invalidatedResources.createMessage()));const G=[];for(const X of V.editStacks)X.getClosestFutureElement()!==W&&G.push(X.resourceLabel);if(G.length>0)return this._tryToSplitAndRedo(C,W,null,localize({key:"cannotWorkspaceRedoDueToChanges",comment:["{0} is a label for an operation. {1} is a list of filenames."]},"Could not redo '{0}' across all files because changes were made to {1}",W.label,G.join(", ")));const Z=[];for(const X of V.editStacks)X.locked&&Z.push(X.resourceLabel);return Z.length>0?this._tryToSplitAndRedo(C,W,null,localize({key:"cannotWorkspaceRedoDueToInProgressUndoRedo",comment:["{0} is a label for an operation. {1} is a list of filenames."]},"Could not redo '{0}' across all files because there is already an undo or redo operation running on {1}",W.label,Z.join(", "))):V.isValid()?null:this._tryToSplitAndRedo(C,W,null,localize({key:"cannotWorkspaceRedoDueToInMeantimeUndoRedo",comment:["{0} is a label for an operation. {1} is a list of filenames."]},"Could not redo '{0}' across all files because an undo or redo operation occurred in the meantime",W.label))}_workspaceRedo(C,W){const V=this._getAffectedEditStacks(W),U=this._checkWorkspaceRedo(C,W,V,!1);return U?U.returnValue:this._executeWorkspaceRedo(C,W,V)}_executeWorkspaceRedo(C,W,V){return __awaiter$1r(this,void 0,void 0,function*(){let U;try{U=yield this._invokeWorkspacePrepare(W)}catch(Z){return this._onError(Z,W)}const G=this._checkWorkspaceRedo(C,W,V,!0);if(G)return U.dispose(),G.returnValue;for(const Z of V.editStacks)Z.moveForward(W);return this._safeInvokeWithLocks(W,()=>W.actual.redo(),V,U,()=>this._continueRedoInGroup(W.groupId))})}_resourceRedo(C,W){if(!W.isValid){C.flushAllElements();return}if(C.locked){const V=localize({key:"cannotResourceRedoDueToInProgressUndoRedo",comment:["{0} is a label for an operation."]},"Could not redo '{0}' because there is already an undo or redo operation running.",W.label);this._notificationService.warn(V);return}return this._invokeResourcePrepare(W,V=>(C.moveForward(W),this._safeInvokeWithLocks(W,()=>W.actual.redo(),new EditStackSnapshot([C]),V,()=>this._continueRedoInGroup(W.groupId))))}_findClosestRedoElementInGroup(C){if(!C)return[null,null];let W=null,V=null;for(const[U,G]of this._editStacks){const Z=G.getClosestFutureElement();Z&&Z.groupId===C&&(!W||Z.groupOrder<W.groupOrder)&&(W=Z,V=U)}return[W,V]}_continueRedoInGroup(C){if(!C)return;const[,W]=this._findClosestRedoElementInGroup(C);if(W)return this._redo(W)}redo(C){if(C instanceof UndoRedoSource){const[,W]=this._findClosestRedoElementWithSource(C.id);return W?this._redo(W):void 0}return typeof C=="string"?this._redo(C):this._redo(this.getUriComparisonKey(C))}_redo(C){if(!this._editStacks.has(C))return;const W=this._editStacks.get(C),V=W.getClosestFutureElement();if(V){if(V.groupId){const[U,G]=this._findClosestRedoElementInGroup(V.groupId);if(V!==U&&G)return this._redo(G)}try{return V.type===1?this._workspaceRedo(C,V):this._resourceRedo(W,V)}finally{}}}};UndoRedoService=__decorate$1Y([__param$1S(0,IDialogService),__param$1S(1,INotificationService)],UndoRedoService);class WorkspaceVerificationError{constructor(C){this.returnValue=C}}registerSingleton(IUndoRedoService,UndoRedoService,1);function clamp$2(K,C,W){return Math.min(Math.max(K,C),W)}class MovingAverage{constructor(){this._n=1,this._val=0}update(C){return this._val=this._val+(C-this._val)/this._n,this._n+=1,this._val}get value(){return this._val}}class SlidingWindowAverage{constructor(C){this._n=0,this._val=0,this._values=[],this._index=0,this._sum=0,this._values=new Array(C),this._values.fill(0,0,C)}update(C){const W=this._values[this._index];return this._values[this._index]=C,this._index=(this._index+1)%this._values.length,this._sum-=W,this._sum+=C,this._n<this._values.length&&(this._n+=1),this._val=this._sum/this._n,this._val}get value(){return this._val}}const IEnvironmentService=createDecorator("environmentService"),IOpenerService=createDecorator("openerService");function matchesScheme(K,C){return URI.isUri(K)?equalsIgnoreCase(K.scheme,C):startsWithIgnoreCase(K,C+":")}function matchesSomeScheme(K,...C){return C.some(W=>matchesScheme(K,W))}function extractSelection(K){let C;const W=/^L?(\d+)(?:,(\d+))?(-L?(\d+)(?:,(\d+))?)?/.exec(K.fragment);return W&&(C={startLineNumber:parseInt(W[1]),startColumn:W[2]?parseInt(W[2]):1,endLineNumber:W[4]?parseInt(W[4]):void 0,endColumn:W[4]?W[5]?parseInt(W[5]):1:void 0},K=K.with({fragment:""})),{selection:C,uri:K}}var __decorate$1X=globalThis&&globalThis.__decorate||function(K,C,W,V){var U=arguments.length,G=U<3?C:V===null?V=Object.getOwnPropertyDescriptor(C,W):V,Z;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")G=Reflect.decorate(K,C,W,V);else for(var X=K.length-1;X>=0;X--)(Z=K[X])&&(G=(U<3?Z(G):U>3?Z(C,W,G):Z(C,W))||G);return U>3&&G&&Object.defineProperty(C,W,G),G},__param$1R=globalThis&&globalThis.__param||function(K,C){return function(W,V){C(W,V,K)}};const ILanguageFeatureDebounceService=createDecorator("ILanguageFeatureDebounceService");var IdentityHash;(function(K){const C=new WeakMap;let W=0;function V(U){let G=C.get(U);return G===void 0&&(G=++W,C.set(U,G)),G}K.of=V})(IdentityHash||(IdentityHash={}));class NullDebounceInformation{constructor(C){this._default=C}get(C){return this._default}update(C,W){return this._default}default(){return this._default}}class FeatureDebounceInformation{constructor(C,W,V,U,G,Z){this._logService=C,this._name=W,this._registry=V,this._default=U,this._min=G,this._max=Z,this._cache=new LRUCache(50,.7)}_key(C){return C.id+this._registry.all(C).reduce((W,V)=>doHash(IdentityHash.of(V),W),0)}get(C){const W=this._key(C),V=this._cache.get(W);return V?clamp$2(V.value,this._min,this._max):this.default()}update(C,W){const V=this._key(C);let U=this._cache.get(V);U||(U=new SlidingWindowAverage(6),this._cache.set(V,U));const G=clamp$2(U.update(W),this._min,this._max);return matchesScheme(C.uri,"output")||this._logService.trace(`[DEBOUNCE: ${this._name}] for ${C.uri.toString()} is ${G}ms`),G}_overall(){const C=new MovingAverage;for(const[,W]of this._cache)C.update(W.value);return C.value}default(){const C=this._overall()|0||this._default;return clamp$2(C,this._min,this._max)}}let LanguageFeatureDebounceService=class{constructor(C,W){this._logService=C,this._data=new Map,this._isDev=W.isExtensionDevelopment||!W.isBuilt}for(C,W,V){var U,G,Z;const X=(U=V==null?void 0:V.min)!==null&&U!==void 0?U:50,Q=(G=V==null?void 0:V.max)!==null&&G!==void 0?G:Math.pow(X,2),J=(Z=V==null?void 0:V.key)!==null&&Z!==void 0?Z:void 0,ee=`${IdentityHash.of(C)},${X}${J?","+J:""}`;let te=this._data.get(ee);return te||(this._isDev?te=new FeatureDebounceInformation(this._logService,W,C,this._overallAverage()|0||X*1.5,X,Q):(this._logService.debug(`[DEBOUNCE: ${W}] is disabled in developed mode`),te=new NullDebounceInformation(X*1.5)),this._data.set(ee,te)),te}_overallAverage(){const C=new MovingAverage;for(const W of this._data.values())C.update(W.default());return C.value}};LanguageFeatureDebounceService=__decorate$1X([__param$1R(0,ILogService),__param$1R(1,IEnvironmentService)],LanguageFeatureDebounceService);registerSingleton(ILanguageFeatureDebounceService,LanguageFeatureDebounceService,1);class SparseMultilineTokens{static create(C,W){return new SparseMultilineTokens(C,new SparseMultilineTokensStorage(W))}get startLineNumber(){return this._startLineNumber}get endLineNumber(){return this._endLineNumber}constructor(C,W){this._startLineNumber=C,this._tokens=W,this._endLineNumber=this._startLineNumber+this._tokens.getMaxDeltaLine()}toString(){return this._tokens.toString(this._startLineNumber)}_updateEndLineNumber(){this._endLineNumber=this._startLineNumber+this._tokens.getMaxDeltaLine()}isEmpty(){return this._tokens.isEmpty()}getLineTokens(C){return this._startLineNumber<=C&&C<=this._endLineNumber?this._tokens.getLineTokens(C-this._startLineNumber):null}getRange(){const C=this._tokens.getRange();return C&&new Range$2(this._startLineNumber+C.startLineNumber,C.startColumn,this._startLineNumber+C.endLineNumber,C.endColumn)}removeTokens(C){const W=C.startLineNumber-this._startLineNumber,V=C.endLineNumber-this._startLineNumber;this._startLineNumber+=this._tokens.removeTokens(W,C.startColumn-1,V,C.endColumn-1),this._updateEndLineNumber()}split(C){const W=C.startLineNumber-this._startLineNumber,V=C.endLineNumber-this._startLineNumber,[U,G,Z]=this._tokens.split(W,C.startColumn-1,V,C.endColumn-1);return[new SparseMultilineTokens(this._startLineNumber,U),new SparseMultilineTokens(this._startLineNumber+Z,G)]}applyEdit(C,W){const[V,U,G]=countEOL(W);this.acceptEdit(C,V,U,G,W.length>0?W.charCodeAt(0):0)}acceptEdit(C,W,V,U,G){this._acceptDeleteRange(C),this._acceptInsertText(new Position$1(C.startLineNumber,C.startColumn),W,V,U,G),this._updateEndLineNumber()}_acceptDeleteRange(C){if(C.startLineNumber===C.endLineNumber&&C.startColumn===C.endColumn)return;const W=C.startLineNumber-this._startLineNumber,V=C.endLineNumber-this._startLineNumber;if(V<0){const G=V-W;this._startLineNumber-=G;return}const U=this._tokens.getMaxDeltaLine();if(!(W>=U+1)){if(W<0&&V>=U+1){this._startLineNumber=0,this._tokens.clear();return}if(W<0){const G=-W;this._startLineNumber-=G,this._tokens.acceptDeleteRange(C.startColumn-1,0,0,V,C.endColumn-1)}else this._tokens.acceptDeleteRange(0,W,C.startColumn-1,V,C.endColumn-1)}}_acceptInsertText(C,W,V,U,G){if(W===0&&V===0)return;const Z=C.lineNumber-this._startLineNumber;if(Z<0){this._startLineNumber+=W;return}const X=this._tokens.getMaxDeltaLine();Z>=X+1||this._tokens.acceptInsertText(Z,C.column-1,W,V,U,G)}}class SparseMultilineTokensStorage{constructor(C){this._tokens=C,this._tokenCount=C.length/4}toString(C){const W=[];for(let V=0;V<this._tokenCount;V++)W.push(`(${this._getDeltaLine(V)+C},${this._getStartCharacter(V)}-${this._getEndCharacter(V)})`);return`[${W.join(",")}]`}getMaxDeltaLine(){const C=this._getTokenCount();return C===0?-1:this._getDeltaLine(C-1)}getRange(){const C=this._getTokenCount();if(C===0)return null;const W=this._getStartCharacter(0),V=this._getDeltaLine(C-1),U=this._getEndCharacter(C-1);return new Range$2(0,W+1,V,U+1)}_getTokenCount(){return this._tokenCount}_getDeltaLine(C){return this._tokens[4*C]}_getStartCharacter(C){return this._tokens[4*C+1]}_getEndCharacter(C){return this._tokens[4*C+2]}isEmpty(){return this._getTokenCount()===0}getLineTokens(C){let W=0,V=this._getTokenCount()-1;for(;W<V;){const U=W+Math.floor((V-W)/2),G=this._getDeltaLine(U);if(G<C)W=U+1;else if(G>C)V=U-1;else{let Z=U;for(;Z>W&&this._getDeltaLine(Z-1)===C;)Z--;let X=U;for(;X<V&&this._getDeltaLine(X+1)===C;)X++;return new SparseLineTokens(this._tokens.subarray(4*Z,4*X+4))}}return this._getDeltaLine(W)===C?new SparseLineTokens(this._tokens.subarray(4*W,4*W+4)):null}clear(){this._tokenCount=0}removeTokens(C,W,V,U){const G=this._tokens,Z=this._tokenCount;let X=0,Q=!1,J=0;for(let ee=0;ee<Z;ee++){const te=4*ee,ie=G[te],ne=G[te+1],oe=G[te+2],re=G[te+3];if((ie>C||ie===C&&oe>=W)&&(ie<V||ie===V&&ne<=U))Q=!0;else{if(X===0&&(J=ie),Q){const ae=4*X;G[ae]=ie-J,G[ae+1]=ne,G[ae+2]=oe,G[ae+3]=re}X++}}return this._tokenCount=X,J}split(C,W,V,U){const G=this._tokens,Z=this._tokenCount,X=[],Q=[];let J=X,ee=0,te=0;for(let ie=0;ie<Z;ie++){const ne=4*ie,oe=G[ne],re=G[ne+1],ae=G[ne+2],se=G[ne+3];if(oe>C||oe===C&&ae>=W){if(oe<V||oe===V&&re<=U)continue;J!==Q&&(J=Q,ee=0,te=oe)}J[ee++]=oe-te,J[ee++]=re,J[ee++]=ae,J[ee++]=se}return[new SparseMultilineTokensStorage(new Uint32Array(X)),new SparseMultilineTokensStorage(new Uint32Array(Q)),te]}acceptDeleteRange(C,W,V,U,G){const Z=this._tokens,X=this._tokenCount,Q=U-W;let J=0,ee=!1;for(let te=0;te<X;te++){const ie=4*te;let ne=Z[ie],oe=Z[ie+1],re=Z[ie+2];const ae=Z[ie+3];if(ne<W||ne===W&&re<=V){J++;continue}else if(ne===W&&oe<V)ne===U&&re>G?re-=G-V:re=V;else if(ne===W&&oe===V)if(ne===U&&re>G)re-=G-V;else{ee=!0;continue}else if(ne<U||ne===U&&oe<G)if(ne===U&&re>G)ne=W,oe=V,re=oe+(re-G);else{ee=!0;continue}else if(ne>U){if(Q===0&&!ee){J=X;break}ne-=Q}else if(ne===U&&oe>=G)C&&ne===0&&(oe+=C,re+=C),ne-=Q,oe-=G-V,re-=G-V;else throw new Error("Not possible!");const se=4*J;Z[se]=ne,Z[se+1]=oe,Z[se+2]=re,Z[se+3]=ae,J++}this._tokenCount=J}acceptInsertText(C,W,V,U,G,Z){const X=V===0&&U===1&&(Z>=48&&Z<=57||Z>=65&&Z<=90||Z>=97&&Z<=122),Q=this._tokens,J=this._tokenCount;for(let ee=0;ee<J;ee++){const te=4*ee;let ie=Q[te],ne=Q[te+1],oe=Q[te+2];if(!(ie<C||ie===C&&oe<W)){if(ie===C&&oe===W)if(X)oe+=1;else continue;else if(ie===C&&ne<W&&W<oe)V===0?oe+=U:oe=W;else{if(ie===C&&ne===W&&X)continue;if(ie===C)if(ie+=V,V===0)ne+=U,oe+=U;else{const re=oe-ne;ne=G+(ne-W),oe=ne+re}else ie+=V}Q[te]=ie,Q[te+1]=ne,Q[te+2]=oe}}}}class SparseLineTokens{constructor(C){this._tokens=C}getCount(){return this._tokens.length/4}getStartCharacter(C){return this._tokens[4*C+1]}getEndCharacter(C){return this._tokens[4*C+2]}getMetadata(C){return this._tokens[4*C+3]}}var __decorate$1W=globalThis&&globalThis.__decorate||function(K,C,W,V){var U=arguments.length,G=U<3?C:V===null?V=Object.getOwnPropertyDescriptor(C,W):V,Z;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")G=Reflect.decorate(K,C,W,V);else for(var X=K.length-1;X>=0;X--)(Z=K[X])&&(G=(U<3?Z(G):U>3?Z(C,W,G):Z(C,W))||G);return U>3&&G&&Object.defineProperty(C,W,G),G},__param$1Q=globalThis&&globalThis.__param||function(K,C){return function(W,V){C(W,V,K)}};let SemanticTokensProviderStyling=class{constructor(C,W,V,U){this._legend=C,this._themeService=W,this._languageService=V,this._logService=U,this._hasWarnedOverlappingTokens=!1,this._hasWarnedInvalidLengthTokens=!1,this._hasWarnedInvalidEditStart=!1,this._hashTable=new HashTable}getMetadata(C,W,V){const U=this._languageService.languageIdCodec.encodeLanguageId(V),G=this._hashTable.get(C,W,U);let Z;if(G)Z=G.metadata,this._logService.getLevel()===LogLevel.Trace&&this._logService.trace(`SemanticTokensProviderStyling [CACHED] ${C} / ${W}: foreground ${TokenMetadata.getForeground(Z)}, fontStyle ${TokenMetadata.getFontStyle(Z).toString(2)}`);else{let X=this._legend.tokenTypes[C];const Q=[];if(X){let J=W;for(let te=0;J>0&&te<this._legend.tokenModifiers.length;te++)J&1&&Q.push(this._legend.tokenModifiers[te]),J=J>>1;J>0&&this._logService.getLevel()===LogLevel.Trace&&(this._logService.trace(`SemanticTokensProviderStyling: unknown token modifier index: ${W.toString(2)} for legend: ${JSON.stringify(this._legend.tokenModifiers)}`),Q.push("not-in-legend"));const ee=this._themeService.getColorTheme().getTokenStyleMetadata(X,Q,V);if(typeof ee>"u")Z=2147483647;else{if(Z=0,typeof ee.italic<"u"){const te=(ee.italic?1:0)<<11;Z|=te|1}if(typeof ee.bold<"u"){const te=(ee.bold?2:0)<<11;Z|=te|2}if(typeof ee.underline<"u"){const te=(ee.underline?4:0)<<11;Z|=te|4}if(typeof ee.strikethrough<"u"){const te=(ee.strikethrough?8:0)<<11;Z|=te|8}if(ee.foreground){const te=ee.foreground<<15;Z|=te|16}Z===0&&(Z=2147483647)}}else this._logService.getLevel()===LogLevel.Trace&&this._logService.trace(`SemanticTokensProviderStyling: unknown token type index: ${C} for legend: ${JSON.stringify(this._legend.tokenTypes)}`),Z=2147483647,X="not-in-legend";this._hashTable.add(C,W,U,Z),this._logService.getLevel()===LogLevel.Trace&&this._logService.trace(`SemanticTokensProviderStyling ${C} (${X}) / ${W} (${Q.join(" ")}): foreground ${TokenMetadata.getForeground(Z)}, fontStyle ${TokenMetadata.getFontStyle(Z).toString(2)}`)}return Z}warnOverlappingSemanticTokens(C,W){this._hasWarnedOverlappingTokens||(this._hasWarnedOverlappingTokens=!0,console.warn(`Overlapping semantic tokens detected at lineNumber ${C}, column ${W}`))}warnInvalidLengthSemanticTokens(C,W){this._hasWarnedInvalidLengthTokens||(this._hasWarnedInvalidLengthTokens=!0,console.warn(`Semantic token with invalid length detected at lineNumber ${C}, column ${W}`))}warnInvalidEditStart(C,W,V,U,G){this._hasWarnedInvalidEditStart||(this._hasWarnedInvalidEditStart=!0,console.warn(`Invalid semantic tokens edit detected (previousResultId: ${C}, resultId: ${W}) at edit #${V}: The provided start offset ${U} is outside the previous data (length ${G}).`))}};SemanticTokensProviderStyling=__decorate$1W([__param$1Q(1,IThemeService),__param$1Q(2,ILanguageService),__param$1Q(3,ILogService)],SemanticTokensProviderStyling);function toMultilineTokens2(K,C,W){const V=K.data,U=K.data.length/5|0,G=Math.max(Math.ceil(U/1024),400),Z=[];let X=0,Q=1,J=0;for(;X<U;){const ee=X;let te=Math.min(ee+G,U);if(te<U){let le=te;for(;le-1>ee&&V[5*le]===0;)le--;if(le-1===ee){let ce=te;for(;ce+1<U&&V[5*ce]===0;)ce++;te=ce}else te=le}let ie=new Uint32Array((te-ee)*4),ne=0,oe=0,re=0,ae=0;for(;X<te;){const le=5*X,ce=V[le],de=V[le+1],ue=Q+ce|0,ge=ce===0?J+de|0:de,he=V[le+2],fe=ge+he|0,pe=V[le+3],Se=V[le+4];if(fe<=ge)C.warnInvalidLengthSemanticTokens(ue,ge+1);else if(re===ue&&ae>ge)C.warnOverlappingSemanticTokens(ue,ge+1);else{const Le=C.getMetadata(pe,Se,W);Le!==2147483647&&(oe===0&&(oe=ue),ie[ne]=ue-oe,ie[ne+1]=ge,ie[ne+2]=fe,ie[ne+3]=Le,ne+=4,re=ue,ae=fe)}Q=ue,J=ge,X++}ne!==ie.length&&(ie=ie.subarray(0,ne));const se=SparseMultilineTokens.create(oe,ie);Z.push(se)}return Z}class HashTableEntry{constructor(C,W,V,U){this.tokenTypeIndex=C,this.tokenModifierSet=W,this.languageId=V,this.metadata=U,this.next=null}}class HashTable{constructor(){this._elementsCount=0,this._currentLengthIndex=0,this._currentLength=HashTable._SIZES[this._currentLengthIndex],this._growCount=Math.round(this._currentLengthIndex+1<HashTable._SIZES.length?2/3*this._currentLength:0),this._elements=[],HashTable._nullOutEntries(this._elements,this._currentLength)}static _nullOutEntries(C,W){for(let V=0;V<W;V++)C[V]=null}_hash2(C,W){return(C<<5)-C+W|0}_hashFunc(C,W,V){return this._hash2(this._hash2(C,W),V)%this._currentLength}get(C,W,V){const U=this._hashFunc(C,W,V);let G=this._elements[U];for(;G;){if(G.tokenTypeIndex===C&&G.tokenModifierSet===W&&G.languageId===V)return G;G=G.next}return null}add(C,W,V,U){if(this._elementsCount++,this._growCount!==0&&this._elementsCount>=this._growCount){const G=this._elements;this._currentLengthIndex++,this._currentLength=HashTable._SIZES[this._currentLengthIndex],this._growCount=Math.round(this._currentLengthIndex+1<HashTable._SIZES.length?2/3*this._currentLength:0),this._elements=[],HashTable._nullOutEntries(this._elements,this._currentLength);for(const Z of G){let X=Z;for(;X;){const Q=X.next;X.next=null,this._add(X),X=Q}}}this._add(new HashTableEntry(C,W,V,U))}_add(C){const W=this._hashFunc(C.tokenTypeIndex,C.tokenModifierSet,C.languageId);C.next=this._elements[W],this._elements[W]=C}}HashTable._SIZES=[3,7,13,31,61,127,251,509,1021,2039,4093,8191,16381,32749,65521,131071,262139,524287,1048573,2097143];const ISemanticTokensStylingService=createDecorator("semanticTokensStylingService");var __decorate$1V=globalThis&&globalThis.__decorate||function(K,C,W,V){var U=arguments.length,G=U<3?C:V===null?V=Object.getOwnPropertyDescriptor(C,W):V,Z;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")G=Reflect.decorate(K,C,W,V);else for(var X=K.length-1;X>=0;X--)(Z=K[X])&&(G=(U<3?Z(G):U>3?Z(C,W,G):Z(C,W))||G);return U>3&&G&&Object.defineProperty(C,W,G),G},__param$1P=globalThis&&globalThis.__param||function(K,C){return function(W,V){C(W,V,K)}};let SemanticTokensStylingService=class extends Disposable{constructor(C,W,V){super(),this._themeService=C,this._logService=W,this._languageService=V,this._caches=new WeakMap,this._register(this._themeService.onDidColorThemeChange(()=>{this._caches=new WeakMap}))}getStyling(C){return this._caches.has(C)||this._caches.set(C,new SemanticTokensProviderStyling(C.getLegend(),this._themeService,this._languageService,this._logService)),this._caches.get(C)}};SemanticTokensStylingService=__decorate$1V([__param$1P(0,IThemeService),__param$1P(1,ILogService),__param$1P(2,ILanguageService)],SemanticTokensStylingService);registerSingleton(ISemanticTokensStylingService,SemanticTokensStylingService,1);var __awaiter$1q=globalThis&&globalThis.__awaiter||function(K,C,W,V){function U(G){return G instanceof W?G:new W(function(Z){Z(G)})}return new(W||(W=Promise))(function(G,Z){function X(ee){try{J(V.next(ee))}catch(te){Z(te)}}function Q(ee){try{J(V.throw(ee))}catch(te){Z(te)}}function J(ee){ee.done?G(ee.value):U(ee.value).then(X,Q)}J((V=V.apply(K,C||[])).next())})};const GLOBSTAR="**",GLOB_SPLIT="/",PATH_REGEX="[/\\\\]",NO_PATH_REGEX="[^/\\\\]",ALL_FORWARD_SLASHES=/\//g;function starsToRegExp(K,C){switch(K){case 0:return"";case 1:return`${NO_PATH_REGEX}*?`;default:return`(?:${PATH_REGEX}|${NO_PATH_REGEX}+${PATH_REGEX}${C?`|${PATH_REGEX}${NO_PATH_REGEX}+`:""})*?`}}function splitGlobAware(K,C){if(!K)return[];const W=[];let V=!1,U=!1,G="";for(const Z of K){switch(Z){case C:if(!V&&!U){W.push(G),G="";continue}break;case"{":V=!0;break;case"}":V=!1;break;case"[":U=!0;break;case"]":U=!1;break}G+=Z}return G&&W.push(G),W}function parseRegExp(K){if(!K)return"";let C="";const W=splitGlobAware(K,GLOB_SPLIT);if(W.every(V=>V===GLOBSTAR))C=".*";else{let V=!1;W.forEach((U,G)=>{if(U===GLOBSTAR){if(V)return;C+=starsToRegExp(2,G===W.length-1)}else{let Z=!1,X="",Q=!1,J="";for(const ee of U){if(ee!=="}"&&Z){X+=ee;continue}if(Q&&(ee!=="]"||!J)){let te;ee==="-"?te=ee:(ee==="^"||ee==="!")&&!J?te="^":ee===GLOB_SPLIT?te="":te=escapeRegExpCharacters(ee),J+=te;continue}switch(ee){case"{":Z=!0;continue;case"[":Q=!0;continue;case"}":{const ie=`(?:${splitGlobAware(X,",").map(ne=>parseRegExp(ne)).join("|")})`;C+=ie,Z=!1,X="";break}case"]":{C+="["+J+"]",Q=!1,J="";break}case"?":C+=NO_PATH_REGEX;continue;case"*":C+=starsToRegExp(1);continue;default:C+=escapeRegExpCharacters(ee)}}G<W.length-1&&(W[G+1]!==GLOBSTAR||G+2<W.length)&&(C+=PATH_REGEX)}V=U===GLOBSTAR})}return C}const T1=/^\*\*\/\*\.[\w\.-]+$/,T2=/^\*\*\/([\w\.-]+)\/?$/,T3=/^{\*\*\/\*?[\w\.-]+\/?(,\*\*\/\*?[\w\.-]+\/?)*}$/,T3_2=/^{\*\*\/\*?[\w\.-]+(\/(\*\*)?)?(,\*\*\/\*?[\w\.-]+(\/(\*\*)?)?)*}$/,T4=/^\*\*((\/[\w\.-]+)+)\/?$/,T5=/^([\w\.-]+(\/[\w\.-]+)*)\/?$/,CACHE=new LRUCache(1e4),FALSE=function(){return!1},NULL=function(){return null};function parsePattern(K,C){if(!K)return NULL;let W;typeof K!="string"?W=K.pattern:W=K,W=W.trim();const V=`${W}_${!!C.trimForExclusions}`;let U=CACHE.get(V);if(U)return wrapRelativePattern(U,K);let G;return T1.test(W)?U=trivia1(W.substr(4),W):(G=T2.exec(trimForExclusions(W,C)))?U=trivia2(G[1],W):(C.trimForExclusions?T3_2:T3).test(W)?U=trivia3(W,C):(G=T4.exec(trimForExclusions(W,C)))?U=trivia4and5(G[1].substr(1),W,!0):(G=T5.exec(trimForExclusions(W,C)))?U=trivia4and5(G[1],W,!1):U=toRegExp(W),CACHE.set(V,U),wrapRelativePattern(U,K)}function wrapRelativePattern(K,C){if(typeof C=="string")return K;const W=function(V,U){return isEqualOrParent(V,C.base,!isLinux)?K(ltrim(V.substr(C.base.length),sep),U):null};return W.allBasenames=K.allBasenames,W.allPaths=K.allPaths,W.basenames=K.basenames,W.patterns=K.patterns,W}function trimForExclusions(K,C){return C.trimForExclusions&&K.endsWith("/**")?K.substr(0,K.length-2):K}function trivia1(K,C){return function(W,V){return typeof W=="string"&&W.endsWith(K)?C:null}}function trivia2(K,C){const W=`/${K}`,V=`\\${K}`,U=function(Z,X){return typeof Z!="string"?null:X?X===K?C:null:Z===K||Z.endsWith(W)||Z.endsWith(V)?C:null},G=[K];return U.basenames=G,U.patterns=[C],U.allBasenames=G,U}function trivia3(K,C){const W=aggregateBasenameMatches(K.slice(1,-1).split(",").map(X=>parsePattern(X,C)).filter(X=>X!==NULL),K),V=W.length;if(!V)return NULL;if(V===1)return W[0];const U=function(X,Q){for(let J=0,ee=W.length;J<ee;J++)if(W[J](X,Q))return K;return null},G=W.find(X=>!!X.allBasenames);G&&(U.allBasenames=G.allBasenames);const Z=W.reduce((X,Q)=>Q.allPaths?X.concat(Q.allPaths):X,[]);return Z.length&&(U.allPaths=Z),U}function trivia4and5(K,C,W){const V=sep===posix.sep,U=V?K:K.replace(ALL_FORWARD_SLASHES,sep),G=sep+U,Z=posix.sep+K;let X;return W?X=function(Q,J){return typeof Q=="string"&&(Q===U||Q.endsWith(G)||!V&&(Q===K||Q.endsWith(Z)))?C:null}:X=function(Q,J){return typeof Q=="string"&&(Q===U||!V&&Q===K)?C:null},X.allPaths=[(W?"*/":"./")+K],X}function toRegExp(K){try{const C=new RegExp(`^${parseRegExp(K)}$`);return function(W){return C.lastIndex=0,typeof W=="string"&&C.test(W)?K:null}}catch{return NULL}}function match$2(K,C,W){return!K||typeof C!="string"?!1:parse$1(K)(C,void 0,W)}function parse$1(K,C={}){if(!K)return FALSE;if(typeof K=="string"||isRelativePattern(K)){const W=parsePattern(K,C);if(W===NULL)return FALSE;const V=function(U,G){return!!W(U,G)};return W.allBasenames&&(V.allBasenames=W.allBasenames),W.allPaths&&(V.allPaths=W.allPaths),V}return parsedExpression(K,C)}function isRelativePattern(K){const C=K;return C?typeof C.base=="string"&&typeof C.pattern=="string":!1}function parsedExpression(K,C){const W=aggregateBasenameMatches(Object.getOwnPropertyNames(K).map(X=>parseExpressionPattern(X,K[X],C)).filter(X=>X!==NULL)),V=W.length;if(!V)return NULL;if(!W.some(X=>!!X.requiresSiblings)){if(V===1)return W[0];const X=function(ee,te){let ie;for(let ne=0,oe=W.length;ne<oe;ne++){const re=W[ne](ee,te);if(typeof re=="string")return re;isThenable$3(re)&&(ie||(ie=[]),ie.push(re))}return ie?(()=>__awaiter$1q(this,void 0,void 0,function*(){for(const ne of ie){const oe=yield ne;if(typeof oe=="string")return oe}return null}))():null},Q=W.find(ee=>!!ee.allBasenames);Q&&(X.allBasenames=Q.allBasenames);const J=W.reduce((ee,te)=>te.allPaths?ee.concat(te.allPaths):ee,[]);return J.length&&(X.allPaths=J),X}const U=function(X,Q,J){let ee,te;for(let ie=0,ne=W.length;ie<ne;ie++){const oe=W[ie];oe.requiresSiblings&&J&&(Q||(Q=basename$1(X)),ee||(ee=Q.substr(0,Q.length-extname$1(X).length)));const re=oe(X,Q,ee,J);if(typeof re=="string")return re;isThenable$3(re)&&(te||(te=[]),te.push(re))}return te?(()=>__awaiter$1q(this,void 0,void 0,function*(){for(const ie of te){const ne=yield ie;if(typeof ne=="string")return ne}return null}))():null},G=W.find(X=>!!X.allBasenames);G&&(U.allBasenames=G.allBasenames);const Z=W.reduce((X,Q)=>Q.allPaths?X.concat(Q.allPaths):X,[]);return Z.length&&(U.allPaths=Z),U}function parseExpressionPattern(K,C,W){if(C===!1)return NULL;const V=parsePattern(K,W);if(V===NULL)return NULL;if(typeof C=="boolean")return V;if(C){const U=C.when;if(typeof U=="string"){const G=(Z,X,Q,J)=>{if(!J||!V(Z,X))return null;const ee=U.replace("$(basename)",()=>Q),te=J(ee);return isThenable$3(te)?te.then(ie=>ie?K:null):te?K:null};return G.requiresSiblings=!0,G}}return V}function aggregateBasenameMatches(K,C){const W=K.filter(X=>!!X.basenames);if(W.length<2)return K;const V=W.reduce((X,Q)=>{const J=Q.basenames;return J?X.concat(J):X},[]);let U;if(C){U=[];for(let X=0,Q=V.length;X<Q;X++)U.push(C)}else U=W.reduce((X,Q)=>{const J=Q.patterns;return J?X.concat(J):X},[]);const G=function(X,Q){if(typeof X!="string")return null;if(!Q){let ee;for(ee=X.length;ee>0;ee--){const te=X.charCodeAt(ee-1);if(te===47||te===92)break}Q=X.substr(ee)}const J=V.indexOf(Q);return J!==-1?U[J]:null};G.basenames=V,G.patterns=U,G.allBasenames=V;const Z=K.filter(X=>!X.basenames);return Z.push(G),Z}function score(K,C,W,V,U,G){if(Array.isArray(K)){let Z=0;for(const X of K){const Q=score(X,C,W,V,U,G);if(Q===10)return Q;Q>Z&&(Z=Q)}return Z}else{if(typeof K=="string")return V?K==="*"?5:K===W?10:0:0;if(K){const{language:Z,pattern:X,scheme:Q,hasAccessToAllModels:J,notebookType:ee}=K;if(!V&&!J)return 0;ee&&U&&(C=U);let te=0;if(Q)if(Q===C.scheme)te=10;else if(Q==="*")te=5;else return 0;if(Z)if(Z===W)te=10;else if(Z==="*")te=Math.max(te,5);else return 0;if(ee)if(ee===G)te=10;else if(ee==="*"&&G!==void 0)te=Math.max(te,5);else return 0;if(X){let ie;if(typeof X=="string"?ie=X:ie=Object.assign(Object.assign({},X),{base:normalize(X.base)}),ie===C.fsPath||match$2(ie,C.fsPath))te=10;else return 0}return te}else return 0}}function isExclusive(K){return typeof K=="string"?!1:Array.isArray(K)?K.every(isExclusive):!!K.exclusive}class MatchCandidate{constructor(C,W,V,U){this.uri=C,this.languageId=W,this.notebookUri=V,this.notebookType=U}equals(C){var W,V;return this.notebookType===C.notebookType&&this.languageId===C.languageId&&this.uri.toString()===C.uri.toString()&&((W=this.notebookUri)===null||W===void 0?void 0:W.toString())===((V=C.notebookUri)===null||V===void 0?void 0:V.toString())}}class LanguageFeatureRegistry{constructor(C){this._notebookInfoResolver=C,this._clock=0,this._entries=[],this._onDidChange=new Emitter$1,this.onDidChange=this._onDidChange.event}register(C,W){let V={selector:C,provider:W,_score:-1,_time:this._clock++};return this._entries.push(V),this._lastCandidate=void 0,this._onDidChange.fire(this._entries.length),toDisposable(()=>{if(V){const U=this._entries.indexOf(V);U>=0&&(this._entries.splice(U,1),this._lastCandidate=void 0,this._onDidChange.fire(this._entries.length),V=void 0)}})}has(C){return this.all(C).length>0}all(C){if(!C)return[];this._updateScores(C);const W=[];for(const V of this._entries)V._score>0&&W.push(V.provider);return W}ordered(C){const W=[];return this._orderedForEach(C,V=>W.push(V.provider)),W}orderedGroups(C){const W=[];let V,U;return this._orderedForEach(C,G=>{V&&U===G._score?V.push(G.provider):(U=G._score,V=[G.provider],W.push(V))}),W}_orderedForEach(C,W){this._updateScores(C);for(const V of this._entries)V._score>0&&W(V)}_updateScores(C){var W,V;const U=(W=this._notebookInfoResolver)===null||W===void 0?void 0:W.call(this,C.uri),G=U?new MatchCandidate(C.uri,C.getLanguageId(),U.uri,U.type):new MatchCandidate(C.uri,C.getLanguageId(),void 0,void 0);if(!(!((V=this._lastCandidate)===null||V===void 0)&&V.equals(G))){this._lastCandidate=G;for(const Z of this._entries)if(Z._score=score(Z.selector,G.uri,G.languageId,shouldSynchronizeModel(C),G.notebookUri,G.notebookType),isExclusive(Z.selector)&&Z._score>0){for(const X of this._entries)X._score=0;Z._score=1e3;break}this._entries.sort(LanguageFeatureRegistry._compareByScoreAndTime)}}static _compareByScoreAndTime(C,W){return C._score<W._score?1:C._score>W._score?-1:isBuiltinSelector(C.selector)&&!isBuiltinSelector(W.selector)?1:!isBuiltinSelector(C.selector)&&isBuiltinSelector(W.selector)?-1:C._time<W._time?1:C._time>W._time?-1:0}}function isBuiltinSelector(K){return typeof K=="string"?!1:Array.isArray(K)?K.some(isBuiltinSelector):!!K.isBuiltin}class LanguageFeaturesService{constructor(){this.referenceProvider=new LanguageFeatureRegistry(this._score.bind(this)),this.renameProvider=new LanguageFeatureRegistry(this._score.bind(this)),this.codeActionProvider=new LanguageFeatureRegistry(this._score.bind(this)),this.definitionProvider=new LanguageFeatureRegistry(this._score.bind(this)),this.typeDefinitionProvider=new LanguageFeatureRegistry(this._score.bind(this)),this.declarationProvider=new LanguageFeatureRegistry(this._score.bind(this)),this.implementationProvider=new LanguageFeatureRegistry(this._score.bind(this)),this.documentSymbolProvider=new LanguageFeatureRegistry(this._score.bind(this)),this.inlayHintsProvider=new LanguageFeatureRegistry(this._score.bind(this)),this.colorProvider=new LanguageFeatureRegistry(this._score.bind(this)),this.codeLensProvider=new LanguageFeatureRegistry(this._score.bind(this)),this.documentFormattingEditProvider=new LanguageFeatureRegistry(this._score.bind(this)),this.documentRangeFormattingEditProvider=new LanguageFeatureRegistry(this._score.bind(this)),this.onTypeFormattingEditProvider=new LanguageFeatureRegistry(this._score.bind(this)),this.signatureHelpProvider=new LanguageFeatureRegistry(this._score.bind(this)),this.hoverProvider=new LanguageFeatureRegistry(this._score.bind(this)),this.documentHighlightProvider=new LanguageFeatureRegistry(this._score.bind(this)),this.selectionRangeProvider=new LanguageFeatureRegistry(this._score.bind(this)),this.foldingRangeProvider=new LanguageFeatureRegistry(this._score.bind(this)),this.linkProvider=new LanguageFeatureRegistry(this._score.bind(this)),this.inlineCompletionsProvider=new LanguageFeatureRegistry(this._score.bind(this)),this.completionProvider=new LanguageFeatureRegistry(this._score.bind(this)),this.linkedEditingRangeProvider=new LanguageFeatureRegistry(this._score.bind(this)),this.documentRangeSemanticTokensProvider=new LanguageFeatureRegistry(this._score.bind(this)),this.documentSemanticTokensProvider=new LanguageFeatureRegistry(this._score.bind(this)),this.documentOnDropEditProvider=new LanguageFeatureRegistry(this._score.bind(this)),this.documentPasteEditProvider=new LanguageFeatureRegistry(this._score.bind(this))}_score(C){var W;return(W=this._notebookTypeResolver)===null||W===void 0?void 0:W.call(this,C)}}registerSingleton(ILanguageFeaturesService,LanguageFeaturesService,1);const IBulkEditService=createDecorator("IWorkspaceEditService");class ResourceEdit{constructor(C){this.metadata=C}static convert(C){return C.edits.map(W=>{if(ResourceTextEdit.is(W))return ResourceTextEdit.lift(W);if(ResourceFileEdit.is(W))return ResourceFileEdit.lift(W);throw new Error("Unsupported edit")})}}class ResourceTextEdit extends ResourceEdit{static is(C){return C instanceof ResourceTextEdit?!0:isObject$2(C)&&URI.isUri(C.resource)&&isObject$2(C.textEdit)}static lift(C){return C instanceof ResourceTextEdit?C:new ResourceTextEdit(C.resource,C.textEdit,C.versionId,C.metadata)}constructor(C,W,V=void 0,U){super(U),this.resource=C,this.textEdit=W,this.versionId=V}}class ResourceFileEdit extends ResourceEdit{static is(C){return C instanceof ResourceFileEdit?!0:isObject$2(C)&&(!!C.newResource||!!C.oldResource)}static lift(C){return C instanceof ResourceFileEdit?C:new ResourceFileEdit(C.oldResource,C.newResource,C.options,C.metadata)}constructor(C,W,V={},U){super(U),this.oldResource=C,this.newResource=W,this.options=V}}const diffEditorDefaultOptions={enableSplitViewResizing:!0,splitViewDefaultRatio:.5,renderSideBySide:!0,renderMarginRevertIcon:!0,maxComputationTime:5e3,maxFileSize:50,ignoreTrimWhitespace:!0,renderIndicators:!0,originalEditable:!1,diffCodeLens:!1,renderOverviewRuler:!0,diffWordWrap:"inherit",diffAlgorithm:"advanced",accessibilityVerbose:!1,experimental:{showMoves:!1,showEmptyDecorations:!0},hideUnchangedRegions:{enabled:!1,contextLineCount:3,minimumLineCount:3,revealLineCount:20},isInEmbeddedEditor:!1,onlyShowAccessibleDiffViewer:!1,renderSideBySideInlineBreakpoint:900,useInlineViewWhenSpaceIsLimited:!0},editorConfigurationBaseNode=Object.freeze({id:"editor",order:5,type:"object",title:localize("editorConfigurationTitle","Editor"),scope:5}),editorConfiguration=Object.assign(Object.assign({},editorConfigurationBaseNode),{properties:{"editor.tabSize":{type:"number",default:EDITOR_MODEL_DEFAULTS.tabSize,minimum:1,markdownDescription:localize("tabSize","The number of spaces a tab is equal to. This setting is overridden based on the file contents when {0} is on.","`#editor.detectIndentation#`")},"editor.indentSize":{anyOf:[{type:"string",enum:["tabSize"]},{type:"number",minimum:1}],default:"tabSize",markdownDescription:localize("indentSize",'The number of spaces used for indentation or `"tabSize"` to use the value from `#editor.tabSize#`. This setting is overridden based on the file contents when `#editor.detectIndentation#` is on.')},"editor.insertSpaces":{type:"boolean",default:EDITOR_MODEL_DEFAULTS.insertSpaces,markdownDescription:localize("insertSpaces","Insert spaces when pressing `Tab`. This setting is overridden based on the file contents when {0} is on.","`#editor.detectIndentation#`")},"editor.detectIndentation":{type:"boolean",default:EDITOR_MODEL_DEFAULTS.detectIndentation,markdownDescription:localize("detectIndentation","Controls whether {0} and {1} will be automatically detected when a file is opened based on the file contents.","`#editor.tabSize#`","`#editor.insertSpaces#`")},"editor.trimAutoWhitespace":{type:"boolean",default:EDITOR_MODEL_DEFAULTS.trimAutoWhitespace,description:localize("trimAutoWhitespace","Remove trailing auto inserted whitespace.")},"editor.largeFileOptimizations":{type:"boolean",default:EDITOR_MODEL_DEFAULTS.largeFileOptimizations,description:localize("largeFileOptimizations","Special handling for large files to disable certain memory intensive features.")},"editor.wordBasedSuggestions":{type:"boolean",default:!0,description:localize("wordBasedSuggestions","Controls whether completions should be computed based on words in the document.")},"editor.wordBasedSuggestionsMode":{enum:["currentDocument","matchingDocuments","allDocuments"],default:"matchingDocuments",enumDescriptions:[localize("wordBasedSuggestionsMode.currentDocument","Only suggest words from the active document."),localize("wordBasedSuggestionsMode.matchingDocuments","Suggest words from all open documents of the same language."),localize("wordBasedSuggestionsMode.allDocuments","Suggest words from all open documents.")],description:localize("wordBasedSuggestionsMode","Controls from which documents word based completions are computed.")},"editor.semanticHighlighting.enabled":{enum:[!0,!1,"configuredByTheme"],enumDescriptions:[localize("semanticHighlighting.true","Semantic highlighting enabled for all color themes."),localize("semanticHighlighting.false","Semantic highlighting disabled for all color themes."),localize("semanticHighlighting.configuredByTheme","Semantic highlighting is configured by the current color theme's `semanticHighlighting` setting.")],default:"configuredByTheme",description:localize("semanticHighlighting.enabled","Controls whether the semanticHighlighting is shown for the languages that support it.")},"editor.stablePeek":{type:"boolean",default:!1,markdownDescription:localize("stablePeek","Keep peek editors open even when double-clicking their content or when hitting `Escape`.")},"editor.maxTokenizationLineLength":{type:"integer",default:2e4,description:localize("maxTokenizationLineLength","Lines above this length will not be tokenized for performance reasons")},"editor.experimental.asyncTokenization":{type:"boolean",default:!1,description:localize("editor.experimental.asyncTokenization","Controls whether the tokenization should happen asynchronously on a web worker."),tags:["experimental"]},"editor.experimental.asyncTokenizationLogging":{type:"boolean",default:!1,description:localize("editor.experimental.asyncTokenizationLogging","Controls whether async tokenization should be logged. For debugging only.")},"editor.experimental.asyncTokenizationVerification":{type:"boolean",default:!1,description:localize("editor.experimental.asyncTokenizationVerification","Controls whether async tokenization should be verified against legacy background tokenization. Might slow down tokenization. For debugging only."),tags:["experimental"]},"editor.language.brackets":{type:["array","null"],default:null,description:localize("schema.brackets","Defines the bracket symbols that increase or decrease the indentation."),items:{type:"array",items:[{type:"string",description:localize("schema.openBracket","The opening bracket character or string sequence.")},{type:"string",description:localize("schema.closeBracket","The closing bracket character or string sequence.")}]}},"editor.language.colorizedBracketPairs":{type:["array","null"],default:null,description:localize("schema.colorizedBracketPairs","Defines the bracket pairs that are colorized by their nesting level if bracket pair colorization is enabled."),items:{type:"array",items:[{type:"string",description:localize("schema.openBracket","The opening bracket character or string sequence.")},{type:"string",description:localize("schema.closeBracket","The closing bracket character or string sequence.")}]}},"diffEditor.maxComputationTime":{type:"number",default:diffEditorDefaultOptions.maxComputationTime,description:localize("maxComputationTime","Timeout in milliseconds after which diff computation is cancelled. Use 0 for no timeout.")},"diffEditor.maxFileSize":{type:"number",default:diffEditorDefaultOptions.maxFileSize,description:localize("maxFileSize","Maximum file size in MB for which to compute diffs. Use 0 for no limit.")},"diffEditor.renderSideBySide":{type:"boolean",default:diffEditorDefaultOptions.renderSideBySide,description:localize("sideBySide","Controls whether the diff editor shows the diff side by side or inline.")},"diffEditor.renderSideBySideInlineBreakpoint":{type:"number",default:diffEditorDefaultOptions.renderSideBySideInlineBreakpoint,description:localize("renderSideBySideInlineBreakpoint","If the diff editor width is smaller than this value, the inline view is used.")},"diffEditor.useInlineViewWhenSpaceIsLimited":{type:"boolean",default:diffEditorDefaultOptions.useInlineViewWhenSpaceIsLimited,description:localize("useInlineViewWhenSpaceIsLimited","If enabled and the editor width is too small, the inline view is used.")},"diffEditor.renderMarginRevertIcon":{type:"boolean",default:diffEditorDefaultOptions.renderMarginRevertIcon,description:localize("renderMarginRevertIcon","When enabled, the diff editor shows arrows in its glyph margin to revert changes.")},"diffEditor.ignoreTrimWhitespace":{type:"boolean",default:diffEditorDefaultOptions.ignoreTrimWhitespace,description:localize("ignoreTrimWhitespace","When enabled, the diff editor ignores changes in leading or trailing whitespace.")},"diffEditor.renderIndicators":{type:"boolean",default:diffEditorDefaultOptions.renderIndicators,description:localize("renderIndicators","Controls whether the diff editor shows +/- indicators for added/removed changes.")},"diffEditor.codeLens":{type:"boolean",default:diffEditorDefaultOptions.diffCodeLens,description:localize("codeLens","Controls whether the editor shows CodeLens.")},"diffEditor.wordWrap":{type:"string",enum:["off","on","inherit"],default:diffEditorDefaultOptions.diffWordWrap,markdownEnumDescriptions:[localize("wordWrap.off","Lines will never wrap."),localize("wordWrap.on","Lines will wrap at the viewport width."),localize("wordWrap.inherit","Lines will wrap according to the {0} setting.","`#editor.wordWrap#`")]},"diffEditor.diffAlgorithm":{type:"string",enum:["legacy","advanced"],default:diffEditorDefaultOptions.diffAlgorithm,markdownEnumDescriptions:[localize("diffAlgorithm.legacy","Uses the legacy diffing algorithm."),localize("diffAlgorithm.advanced","Uses the advanced diffing algorithm.")],tags:["experimental"]},"diffEditor.hideUnchangedRegions.enabled":{type:"boolean",default:diffEditorDefaultOptions.hideUnchangedRegions.enabled,markdownDescription:localize("hideUnchangedRegions.enabled","Controls whether the diff editor shows unchanged regions.")},"diffEditor.hideUnchangedRegions.revealLineCount":{type:"integer",default:diffEditorDefaultOptions.hideUnchangedRegions.revealLineCount,markdownDescription:localize("hideUnchangedRegions.revealLineCount","Controls how many lines are used for unchanged regions."),minimum:1},"diffEditor.hideUnchangedRegions.minimumLineCount":{type:"integer",default:diffEditorDefaultOptions.hideUnchangedRegions.minimumLineCount,markdownDescription:localize("hideUnchangedRegions.minimumLineCount","Controls how many lines are used as a minimum for unchanged regions."),minimum:1},"diffEditor.hideUnchangedRegions.contextLineCount":{type:"integer",default:diffEditorDefaultOptions.hideUnchangedRegions.contextLineCount,markdownDescription:localize("hideUnchangedRegions.contextLineCount","Controls how many lines are used as context when comparing unchanged regions."),minimum:1},"diffEditor.experimental.showMoves":{type:"boolean",default:diffEditorDefaultOptions.experimental.showMoves,markdownDescription:localize("showMoves","Controls whether the diff editor should show detected code moves.")},"diffEditor.experimental.showEmptyDecorations":{type:"boolean",default:diffEditorDefaultOptions.experimental.showEmptyDecorations,description:localize("showEmptyDecorations","Controls whether the diff editor shows empty decorations to see where characters got inserted or deleted.")}}});function isConfigurationPropertySchema(K){return typeof K.type<"u"||typeof K.anyOf<"u"}for(const K of editorOptionsRegistry){const C=K.schema;if(typeof C<"u")if(isConfigurationPropertySchema(C))editorConfiguration.properties[`editor.${K.name}`]=C;else for(const W in C)Object.hasOwnProperty.call(C,W)&&(editorConfiguration.properties[W]=C[W])}let cachedEditorConfigurationKeys=null;function getEditorConfigurationKeys(){return cachedEditorConfigurationKeys===null&&(cachedEditorConfigurationKeys=Object.create(null),Object.keys(editorConfiguration.properties).forEach(K=>{cachedEditorConfigurationKeys[K]=!0})),cachedEditorConfigurationKeys}function isEditorConfigurationKey(K){return getEditorConfigurationKeys()[`editor.${K}`]||!1}function isDiffEditorConfigurationKey(K){return getEditorConfigurationKeys()[`diffEditor.${K}`]||!1}const configurationRegistry$1=Registry.as(Extensions$6.Configuration);configurationRegistry$1.registerConfiguration(editorConfiguration);class EditOperation{static insert(C,W){return{range:new Range$2(C.lineNumber,C.column,C.lineNumber,C.column),text:W,forceMoveMarkers:!0}}static delete(C){return{range:C,text:null}}static replace(C,W){return{range:C,text:W}}static replaceMove(C,W){return{range:C,text:W,forceMoveMarkers:!0}}}function freeze(K){return Object.isFrozen(K)?K:deepFreeze(K)}class ConfigurationModel{constructor(C={},W=[],V=[],U){this._contents=C,this._keys=W,this._overrides=V,this.raw=U,this.overrideConfigurations=new Map}get rawConfiguration(){var C;if(!this._rawConfiguration)if(!((C=this.raw)===null||C===void 0)&&C.length){const W=this.raw.map(V=>{if(V instanceof ConfigurationModel)return V;const U=new ConfigurationModelParser("");return U.parseRaw(V),U.configurationModel});this._rawConfiguration=W.reduce((V,U)=>U===V?U:V.merge(U),W[0])}else this._rawConfiguration=this;return this._rawConfiguration}get contents(){return this._contents}get overrides(){return this._overrides}get keys(){return this._keys}isEmpty(){return this._keys.length===0&&Object.keys(this._contents).length===0&&this._overrides.length===0}getValue(C){return C?getConfigurationValue(this.contents,C):this.contents}inspect(C,W){const V=this.rawConfiguration.getValue(C),U=W?this.rawConfiguration.getOverrideValue(C,W):void 0,G=W?this.rawConfiguration.override(W).getValue(C):V;return{value:V,override:U,merged:G}}getOverrideValue(C,W){const V=this.getContentsForOverrideIdentifer(W);return V?C?getConfigurationValue(V,C):V:void 0}override(C){let W=this.overrideConfigurations.get(C);return W||(W=this.createOverrideConfigurationModel(C),this.overrideConfigurations.set(C,W)),W}merge(...C){var W,V;const U=deepClone(this.contents),G=deepClone(this.overrides),Z=[...this.keys],X=!((W=this.raw)===null||W===void 0)&&W.length?[...this.raw]:[this];for(const Q of C)if(X.push(...!((V=Q.raw)===null||V===void 0)&&V.length?Q.raw:[Q]),!Q.isEmpty()){this.mergeContents(U,Q.contents);for(const J of Q.overrides){const[ee]=G.filter(te=>equals$5(te.identifiers,J.identifiers));ee?(this.mergeContents(ee.contents,J.contents),ee.keys.push(...J.keys),ee.keys=distinct(ee.keys)):G.push(deepClone(J))}for(const J of Q.keys)Z.indexOf(J)===-1&&Z.push(J)}return new ConfigurationModel(U,Z,G,X.every(Q=>Q instanceof ConfigurationModel)?void 0:X)}createOverrideConfigurationModel(C){const W=this.getContentsForOverrideIdentifer(C);if(!W||typeof W!="object"||!Object.keys(W).length)return this;const V={};for(const U of distinct([...Object.keys(this.contents),...Object.keys(W)])){let G=this.contents[U];const Z=W[U];Z&&(typeof G=="object"&&typeof Z=="object"?(G=deepClone(G),this.mergeContents(G,Z)):G=Z),V[U]=G}return new ConfigurationModel(V,this.keys,this.overrides)}mergeContents(C,W){for(const V of Object.keys(W)){if(V in C&&isObject$2(C[V])&&isObject$2(W[V])){this.mergeContents(C[V],W[V]);continue}C[V]=deepClone(W[V])}}getContentsForOverrideIdentifer(C){let W=null,V=null;const U=G=>{G&&(V?this.mergeContents(V,G):V=deepClone(G))};for(const G of this.overrides)G.identifiers.length===1&&G.identifiers[0]===C?W=G.contents:G.identifiers.includes(C)&&U(G.contents);return U(W),V}toJSON(){return{contents:this.contents,overrides:this.overrides,keys:this.keys}}addValue(C,W){this.updateValue(C,W,!0)}setValue(C,W){this.updateValue(C,W,!1)}removeValue(C){const W=this.keys.indexOf(C);W!==-1&&(this.keys.splice(W,1),removeFromValueTree(this.contents,C),OVERRIDE_PROPERTY_REGEX.test(C)&&this.overrides.splice(this.overrides.findIndex(V=>equals$5(V.identifiers,overrideIdentifiersFromKey(C))),1))}updateValue(C,W,V){addToValueTree(this.contents,C,W,U=>console.error(U)),V=V||this.keys.indexOf(C)===-1,V&&this.keys.push(C),OVERRIDE_PROPERTY_REGEX.test(C)&&this.overrides.push({identifiers:overrideIdentifiersFromKey(C),keys:Object.keys(this.contents[C]),contents:toValuesTree(this.contents[C],U=>console.error(U))})}}class ConfigurationModelParser{constructor(C){this._name=C,this._raw=null,this._configurationModel=null,this._restrictedConfigurations=[]}get configurationModel(){return this._configurationModel||new ConfigurationModel}parseRaw(C,W){this._raw=C;const{contents:V,keys:U,overrides:G,restricted:Z,hasExcludedProperties:X}=this.doParseRaw(C,W);this._configurationModel=new ConfigurationModel(V,U,G,X?[C]:void 0),this._restrictedConfigurations=Z||[]}doParseRaw(C,W){const V=Registry.as(Extensions$6.Configuration).getConfigurationProperties(),U=this.filter(C,V,!0,W);C=U.raw;const G=toValuesTree(C,Q=>console.error(`Conflict in settings file ${this._name}: ${Q}`)),Z=Object.keys(C),X=this.toOverrides(C,Q=>console.error(`Conflict in settings file ${this._name}: ${Q}`));return{contents:G,keys:Z,overrides:X,restricted:U.restricted,hasExcludedProperties:U.hasExcludedProperties}}filter(C,W,V,U){var G,Z,X;let Q=!1;if(!(U!=null&&U.scopes)&&!(U!=null&&U.skipRestricted)&&!(!((G=U==null?void 0:U.exclude)===null||G===void 0)&&G.length))return{raw:C,restricted:[],hasExcludedProperties:Q};const J={},ee=[];for(const te in C)if(OVERRIDE_PROPERTY_REGEX.test(te)&&V){const ie=this.filter(C[te],W,!1,U);J[te]=ie.raw,Q=Q||ie.hasExcludedProperties,ee.push(...ie.restricted)}else{const ie=W[te],ne=ie?typeof ie.scope<"u"?ie.scope:3:void 0;ie!=null&&ie.restricted&&ee.push(te),!(!((Z=U.exclude)===null||Z===void 0)&&Z.includes(te))&&(!((X=U.include)===null||X===void 0)&&X.includes(te)||(ne===void 0||U.scopes===void 0||U.scopes.includes(ne))&&!(U.skipRestricted&&(ie!=null&&ie.restricted)))?J[te]=C[te]:Q=!0}return{raw:J,restricted:ee,hasExcludedProperties:Q}}toOverrides(C,W){const V=[];for(const U of Object.keys(C))if(OVERRIDE_PROPERTY_REGEX.test(U)){const G={};for(const Z in C[U])G[Z]=C[U][Z];V.push({identifiers:overrideIdentifiersFromKey(U),keys:Object.keys(G),contents:toValuesTree(G,W)})}return V}}class ConfigurationInspectValue{constructor(C,W,V,U,G,Z,X,Q,J,ee,te,ie,ne){this.key=C,this.overrides=W,this._value=V,this.overrideIdentifiers=U,this.defaultConfiguration=G,this.policyConfiguration=Z,this.applicationConfiguration=X,this.userConfiguration=Q,this.localUserConfiguration=J,this.remoteUserConfiguration=ee,this.workspaceConfiguration=te,this.folderConfigurationModel=ie,this.memoryConfigurationModel=ne}inspect(C,W,V){const U=C.inspect(W,V);return{get value(){return freeze(U.value)},get override(){return freeze(U.override)},get merged(){return freeze(U.merged)}}}get userInspectValue(){return this._userInspectValue||(this._userInspectValue=this.inspect(this.userConfiguration,this.key,this.overrides.overrideIdentifier)),this._userInspectValue}get user(){return this.userInspectValue.value!==void 0||this.userInspectValue.override!==void 0?{value:this.userInspectValue.value,override:this.userInspectValue.override}:void 0}}class Configuration{constructor(C,W,V,U,G=new ConfigurationModel,Z=new ConfigurationModel,X=new ResourceMap,Q=new ConfigurationModel,J=new ResourceMap){this._defaultConfiguration=C,this._policyConfiguration=W,this._applicationConfiguration=V,this._localUserConfiguration=U,this._remoteUserConfiguration=G,this._workspaceConfiguration=Z,this._folderConfigurations=X,this._memoryConfiguration=Q,this._memoryConfigurationByResource=J,this._workspaceConsolidatedConfiguration=null,this._foldersConsolidatedConfigurations=new ResourceMap,this._userConfiguration=null}getValue(C,W,V){return this.getConsolidatedConfigurationModel(C,W,V).getValue(C)}updateValue(C,W,V={}){let U;V.resource?(U=this._memoryConfigurationByResource.get(V.resource),U||(U=new ConfigurationModel,this._memoryConfigurationByResource.set(V.resource,U))):U=this._memoryConfiguration,W===void 0?U.removeValue(C):U.setValue(C,W),V.resource||(this._workspaceConsolidatedConfiguration=null)}inspect(C,W,V){const U=this.getConsolidatedConfigurationModel(C,W,V),G=this.getFolderConfigurationModelForResource(W.resource,V),Z=W.resource?this._memoryConfigurationByResource.get(W.resource)||this._memoryConfiguration:this._memoryConfiguration,X=new Set;for(const Q of U.overrides)for(const J of Q.identifiers)U.getOverrideValue(C,J)!==void 0&&X.add(J);return new ConfigurationInspectValue(C,W,U.getValue(C),X.size?[...X]:void 0,this._defaultConfiguration,this._policyConfiguration.isEmpty()?void 0:this._policyConfiguration,this.applicationConfiguration.isEmpty()?void 0:this.applicationConfiguration,this.userConfiguration,this.localUserConfiguration,this.remoteUserConfiguration,V?this._workspaceConfiguration:void 0,G||void 0,Z)}get applicationConfiguration(){return this._applicationConfiguration}get userConfiguration(){return this._userConfiguration||(this._userConfiguration=this._remoteUserConfiguration.isEmpty()?this._localUserConfiguration:this._localUserConfiguration.merge(this._remoteUserConfiguration)),this._userConfiguration}get localUserConfiguration(){return this._localUserConfiguration}get remoteUserConfiguration(){return this._remoteUserConfiguration}getConsolidatedConfigurationModel(C,W,V){let U=this.getConsolidatedConfigurationModelForResource(W,V);return W.overrideIdentifier&&(U=U.override(W.overrideIdentifier)),!this._policyConfiguration.isEmpty()&&this._policyConfiguration.getValue(C)!==void 0&&(U=U.merge(this._policyConfiguration)),U}getConsolidatedConfigurationModelForResource({resource:C},W){let V=this.getWorkspaceConsolidatedConfiguration();if(W&&C){const U=W.getFolder(C);U&&(V=this.getFolderConsolidatedConfiguration(U.uri)||V);const G=this._memoryConfigurationByResource.get(C);G&&(V=V.merge(G))}return V}getWorkspaceConsolidatedConfiguration(){return this._workspaceConsolidatedConfiguration||(this._workspaceConsolidatedConfiguration=this._defaultConfiguration.merge(this.applicationConfiguration,this.userConfiguration,this._workspaceConfiguration,this._memoryConfiguration)),this._workspaceConsolidatedConfiguration}getFolderConsolidatedConfiguration(C){let W=this._foldersConsolidatedConfigurations.get(C);if(!W){const V=this.getWorkspaceConsolidatedConfiguration(),U=this._folderConfigurations.get(C);U?(W=V.merge(U),this._foldersConsolidatedConfigurations.set(C,W)):W=V}return W}getFolderConfigurationModelForResource(C,W){if(W&&C){const V=W.getFolder(C);if(V)return this._folderConfigurations.get(V.uri)}}toData(){return{defaults:{contents:this._defaultConfiguration.contents,overrides:this._defaultConfiguration.overrides,keys:this._defaultConfiguration.keys},policy:{contents:this._policyConfiguration.contents,overrides:this._policyConfiguration.overrides,keys:this._policyConfiguration.keys},application:{contents:this.applicationConfiguration.contents,overrides:this.applicationConfiguration.overrides,keys:this.applicationConfiguration.keys},user:{contents:this.userConfiguration.contents,overrides:this.userConfiguration.overrides,keys:this.userConfiguration.keys},workspace:{contents:this._workspaceConfiguration.contents,overrides:this._workspaceConfiguration.overrides,keys:this._workspaceConfiguration.keys},folders:[...this._folderConfigurations.keys()].reduce((C,W)=>{const{contents:V,overrides:U,keys:G}=this._folderConfigurations.get(W);return C.push([W,{contents:V,overrides:U,keys:G}]),C},[])}}static parse(C){const W=this.parseConfigurationModel(C.defaults),V=this.parseConfigurationModel(C.policy),U=this.parseConfigurationModel(C.application),G=this.parseConfigurationModel(C.user),Z=this.parseConfigurationModel(C.workspace),X=C.folders.reduce((Q,J)=>(Q.set(URI.revive(J[0]),this.parseConfigurationModel(J[1])),Q),new ResourceMap);return new Configuration(W,V,U,G,new ConfigurationModel,Z,X,new ConfigurationModel,new ResourceMap)}static parseConfigurationModel(C){return new ConfigurationModel(C.contents,C.keys,C.overrides)}}class ConfigurationChangeEvent{constructor(C,W,V,U){this.change=C,this.previous=W,this.currentConfiguraiton=V,this.currentWorkspace=U,this._marker=`
`,this._markerCode1=this._marker.charCodeAt(0),this._markerCode2=".".charCodeAt(0),this.affectedKeys=new Set,this._previousConfiguration=void 0;for(const G of C.keys)this.affectedKeys.add(G);for(const[,G]of C.overrides)for(const Z of G)this.affectedKeys.add(Z);this._affectsConfigStr=this._marker;for(const G of this.affectedKeys)this._affectsConfigStr+=G+this._marker}get previousConfiguration(){return!this._previousConfiguration&&this.previous&&(this._previousConfiguration=Configuration.parse(this.previous.data)),this._previousConfiguration}affectsConfiguration(C,W){var V;const U=this._marker+C,G=this._affectsConfigStr.indexOf(U);if(G<0)return!1;const Z=G+U.length;if(Z>=this._affectsConfigStr.length)return!1;const X=this._affectsConfigStr.charCodeAt(Z);if(X!==this._markerCode1&&X!==this._markerCode2)return!1;if(W){const Q=this.previousConfiguration?this.previousConfiguration.getValue(C,W,(V=this.previous)===null||V===void 0?void 0:V.workspace):void 0,J=this.currentConfiguraiton.getValue(C,W,this.currentWorkspace);return!equals$4(Q,J)}return!0}}const NoMatchingKb={kind:0},MoreChordsNeeded={kind:1};function KbFound(K,C,W){return{kind:2,commandId:K,commandArgs:C,isBubble:W}}class KeybindingResolver{constructor(C,W,V){var U;this._log=V,this._defaultKeybindings=C,this._defaultBoundCommands=new Map;for(const G of C){const Z=G.command;Z&&Z.charAt(0)!=="-"&&this._defaultBoundCommands.set(Z,!0)}this._map=new Map,this._lookupMap=new Map,this._keybindings=KeybindingResolver.handleRemovals([].concat(C).concat(W));for(let G=0,Z=this._keybindings.length;G<Z;G++){const X=this._keybindings[G];if(X.chords.length===0)continue;const Q=(U=X.when)===null||U===void 0?void 0:U.substituteConstants();Q&&Q.type===0||this._addKeyPress(X.chords[0],X)}}static _isTargetedForRemoval(C,W,V){if(W){for(let U=0;U<W.length;U++)if(W[U]!==C.chords[U])return!1}return!(V&&V.type!==1&&(!C.when||!expressionsAreEqualWithConstantSubstitution(V,C.when)))}static handleRemovals(C){const W=new Map;for(let U=0,G=C.length;U<G;U++){const Z=C[U];if(Z.command&&Z.command.charAt(0)==="-"){const X=Z.command.substring(1);W.has(X)?W.get(X).push(Z):W.set(X,[Z])}}if(W.size===0)return C;const V=[];for(let U=0,G=C.length;U<G;U++){const Z=C[U];if(!Z.command||Z.command.length===0){V.push(Z);continue}if(Z.command.charAt(0)==="-")continue;const X=W.get(Z.command);if(!X||!Z.isDefault){V.push(Z);continue}let Q=!1;for(const J of X){const ee=J.when;if(this._isTargetedForRemoval(Z,J.chords,ee)){Q=!0;break}}if(!Q){V.push(Z);continue}}return V}_addKeyPress(C,W){const V=this._map.get(C);if(typeof V>"u"){this._map.set(C,[W]),this._addToLookupMap(W);return}for(let U=V.length-1;U>=0;U--){const G=V[U];if(G.command===W.command)continue;let Z=!0;for(let X=1;X<G.chords.length&&X<W.chords.length;X++)if(G.chords[X]!==W.chords[X]){Z=!1;break}Z&&KeybindingResolver.whenIsEntirelyIncluded(G.when,W.when)&&this._removeFromLookupMap(G)}V.push(W),this._addToLookupMap(W)}_addToLookupMap(C){if(!C.command)return;let W=this._lookupMap.get(C.command);typeof W>"u"?(W=[C],this._lookupMap.set(C.command,W)):W.push(C)}_removeFromLookupMap(C){if(!C.command)return;const W=this._lookupMap.get(C.command);if(!(typeof W>"u")){for(let V=0,U=W.length;V<U;V++)if(W[V]===C){W.splice(V,1);return}}}static whenIsEntirelyIncluded(C,W){return!W||W.type===1?!0:!C||C.type===1?!1:implies(C,W)}getKeybindings(){return this._keybindings}lookupPrimaryKeybinding(C,W){const V=this._lookupMap.get(C);if(typeof V>"u"||V.length===0)return null;if(V.length===1)return V[0];for(let U=V.length-1;U>=0;U--){const G=V[U];if(W.contextMatchesRules(G.when))return G}return V[V.length-1]}resolve(C,W,V){const U=[...W,V];this._log(`| Resolving ${U}`);const G=this._map.get(U[0]);if(G===void 0)return this._log("\\ No keybinding entries."),NoMatchingKb;let Z=null;if(U.length<2)Z=G;else{Z=[];for(let Q=0,J=G.length;Q<J;Q++){const ee=G[Q];if(U.length>ee.chords.length)continue;let te=!0;for(let ie=1;ie<U.length;ie++)if(ee.chords[ie]!==U[ie]){te=!1;break}te&&Z.push(ee)}}const X=this._findCommand(C,Z);return X?U.length<X.chords.length?(this._log(`\\ From ${Z.length} keybinding entries, awaiting ${X.chords.length-U.length} more chord(s), when: ${printWhenExplanation(X.when)}, source: ${printSourceExplanation(X)}.`),MoreChordsNeeded):(this._log(`\\ From ${Z.length} keybinding entries, matched ${X.command}, when: ${printWhenExplanation(X.when)}, source: ${printSourceExplanation(X)}.`),KbFound(X.command,X.commandArgs,X.bubble)):(this._log(`\\ From ${Z.length} keybinding entries, no when clauses matched the context.`),NoMatchingKb)}_findCommand(C,W){for(let V=W.length-1;V>=0;V--){const U=W[V];if(KeybindingResolver._contextMatchesRules(C,U.when))return U}return null}static _contextMatchesRules(C,W){return W?W.evaluate(C):!0}}function printWhenExplanation(K){return K?`${K.serialize()}`:"no when condition"}function printSourceExplanation(K){return K.extensionId?K.isBuiltinExtension?`built-in extension ${K.extensionId}`:`user extension ${K.extensionId}`:K.isDefault?"built-in":"user"}const HIGH_FREQ_COMMANDS=/^(cursor|delete|undo|redo|tab|editor\.action\.clipboard)/;class AbstractKeybindingService extends Disposable{get onDidUpdateKeybindings(){return this._onDidUpdateKeybindings?this._onDidUpdateKeybindings.event:Event$1.None}get inChordMode(){return this._currentChords.length>0}constructor(C,W,V,U,G){super(),this._contextKeyService=C,this._commandService=W,this._telemetryService=V,this._notificationService=U,this._logService=G,this._onDidUpdateKeybindings=this._register(new Emitter$1),this._currentChords=[],this._currentChordChecker=new IntervalTimer,this._currentChordStatusMessage=null,this._ignoreSingleModifiers=KeybindingModifierSet.EMPTY,this._currentSingleModifier=null,this._currentSingleModifierClearTimeout=new TimeoutTimer,this._logging=!1}dispose(){super.dispose()}_log(C){this._logging&&this._logService.info(`[KeybindingService]: ${C}`)}getKeybindings(){return this._getResolver().getKeybindings()}lookupKeybinding(C,W){const V=this._getResolver().lookupPrimaryKeybinding(C,W||this._contextKeyService);if(V)return V.resolvedKeybinding}dispatchEvent(C,W){return this._dispatch(C,W)}softDispatch(C,W){this._log("/ Soft dispatching keyboard event");const V=this.resolveKeyboardEvent(C);if(V.hasMultipleChords())return console.warn("keyboard event should not be mapped to multiple chords"),NoMatchingKb;const[U]=V.getDispatchChords();if(U===null)return this._log("\\ Keyboard event cannot be dispatched"),NoMatchingKb;const G=this._contextKeyService.getContext(W),Z=this._currentChords.map(({keypress:X})=>X);return this._getResolver().resolve(G,Z,U)}_scheduleLeaveChordMode(){const C=Date.now();this._currentChordChecker.cancelAndSet(()=>{if(!this._documentHasFocus()){this._leaveChordMode();return}Date.now()-C>5e3&&this._leaveChordMode()},500)}_expectAnotherChord(C,W){switch(this._currentChords.push({keypress:C,label:W}),this._currentChords.length){case 0:throw illegalState("impossible");case 1:this._currentChordStatusMessage=this._notificationService.status(localize("first.chord","({0}) was pressed. Waiting for second key of chord...",W));break;default:{const V=this._currentChords.map(({label:U})=>U).join(", ");this._currentChordStatusMessage=this._notificationService.status(localize("next.chord","({0}) was pressed. Waiting for next key of chord...",V))}}this._scheduleLeaveChordMode(),IME.enabled&&IME.disable()}_leaveChordMode(){this._currentChordStatusMessage&&(this._currentChordStatusMessage.dispose(),this._currentChordStatusMessage=null),this._currentChordChecker.cancel(),this._currentChords=[],IME.enable()}_dispatch(C,W){return this._doDispatch(this.resolveKeyboardEvent(C),W,!1)}_singleModifierDispatch(C,W){const V=this.resolveKeyboardEvent(C),[U]=V.getSingleModifierDispatchChords();if(U)return this._ignoreSingleModifiers.has(U)?(this._log(`+ Ignoring single modifier ${U} due to it being pressed together with other keys.`),this._ignoreSingleModifiers=KeybindingModifierSet.EMPTY,this._currentSingleModifierClearTimeout.cancel(),this._currentSingleModifier=null,!1):(this._ignoreSingleModifiers=KeybindingModifierSet.EMPTY,this._currentSingleModifier===null?(this._log(`+ Storing single modifier for possible chord ${U}.`),this._currentSingleModifier=U,this._currentSingleModifierClearTimeout.cancelAndSet(()=>{this._log("+ Clearing single modifier due to 300ms elapsed."),this._currentSingleModifier=null},300),!1):U===this._currentSingleModifier?(this._log(`/ Dispatching single modifier chord ${U} ${U}`),this._currentSingleModifierClearTimeout.cancel(),this._currentSingleModifier=null,this._doDispatch(V,W,!0)):(this._log(`+ Clearing single modifier due to modifier mismatch: ${this._currentSingleModifier} ${U}`),this._currentSingleModifierClearTimeout.cancel(),this._currentSingleModifier=null,!1));const[G]=V.getChords();return this._ignoreSingleModifiers=new KeybindingModifierSet(G),this._currentSingleModifier!==null&&this._log("+ Clearing single modifier due to other key up."),this._currentSingleModifierClearTimeout.cancel(),this._currentSingleModifier=null,!1}_doDispatch(C,W,V=!1){var U;let G=!1;if(C.hasMultipleChords())return console.warn("Unexpected keyboard event mapped to multiple chords"),!1;let Z=null,X=null;if(V){const[te]=C.getSingleModifierDispatchChords();Z=te,X=te?[te]:[]}else[Z]=C.getDispatchChords(),X=this._currentChords.map(({keypress:te})=>te);if(Z===null)return this._log("\\ Keyboard event cannot be dispatched in keydown phase."),G;const Q=this._contextKeyService.getContext(W),J=C.getLabel(),ee=this._getResolver().resolve(Q,X,Z);switch(ee.kind){case 0:{if(this._logService.trace("KeybindingService#dispatch",J,"[ No matching keybinding ]"),this.inChordMode){const te=this._currentChords.map(({label:ie})=>ie).join(", ");this._log(`+ Leaving multi-chord mode: Nothing bound to "${te}, ${J}".`),this._notificationService.status(localize("missing.chord","The key combination ({0}, {1}) is not a command.",te,J),{hideAfter:10*1e3}),this._leaveChordMode(),G=!0}return G}case 1:return this._logService.trace("KeybindingService#dispatch",J,"[ Several keybindings match - more chords needed ]"),G=!0,this._expectAnotherChord(Z,J),this._log(this._currentChords.length===1?"+ Entering multi-chord mode...":"+ Continuing multi-chord mode..."),G;case 2:{if(this._logService.trace("KeybindingService#dispatch",J,`[ Will dispatch command ${ee.commandId} ]`),ee.commandId===null||ee.commandId===""){if(this.inChordMode){const te=this._currentChords.map(({label:ie})=>ie).join(", ");this._log(`+ Leaving chord mode: Nothing bound to "${te}, ${J}".`),this._notificationService.status(localize("missing.chord","The key combination ({0}, {1}) is not a command.",te,J),{hideAfter:10*1e3}),this._leaveChordMode(),G=!0}}else this.inChordMode&&this._leaveChordMode(),ee.isBubble||(G=!0),this._log(`+ Invoking command ${ee.commandId}.`),typeof ee.commandArgs>"u"?this._commandService.executeCommand(ee.commandId).then(void 0,te=>this._notificationService.warn(te)):this._commandService.executeCommand(ee.commandId,ee.commandArgs).then(void 0,te=>this._notificationService.warn(te)),HIGH_FREQ_COMMANDS.test(ee.commandId)||this._telemetryService.publicLog2("workbenchActionExecuted",{id:ee.commandId,from:"keybinding",detail:(U=C.getUserSettingsLabel())!==null&&U!==void 0?U:void 0});return G}}}mightProducePrintableCharacter(C){return C.ctrlKey||C.metaKey?!1:C.keyCode>=31&&C.keyCode<=56||C.keyCode>=21&&C.keyCode<=30}}class KeybindingModifierSet{constructor(C){this._ctrlKey=C?C.ctrlKey:!1,this._shiftKey=C?C.shiftKey:!1,this._altKey=C?C.altKey:!1,this._metaKey=C?C.metaKey:!1}has(C){switch(C){case"ctrl":return this._ctrlKey;case"shift":return this._shiftKey;case"alt":return this._altKey;case"meta":return this._metaKey}}}KeybindingModifierSet.EMPTY=new KeybindingModifierSet(null);class ResolvedKeybindingItem{constructor(C,W,V,U,G,Z,X){this._resolvedKeybindingItemBrand=void 0,this.resolvedKeybinding=C,this.chords=C?toEmptyArrayIfContainsNull(C.getDispatchChords()):[],C&&this.chords.length===0&&(this.chords=toEmptyArrayIfContainsNull(C.getSingleModifierDispatchChords())),this.bubble=W?W.charCodeAt(0)===94:!1,this.command=this.bubble?W.substr(1):W,this.commandArgs=V,this.when=U,this.isDefault=G,this.extensionId=Z,this.isBuiltinExtension=X}}function toEmptyArrayIfContainsNull(K){const C=[];for(let W=0,V=K.length;W<V;W++){const U=K[W];if(!U)return[];C.push(U)}return C}class ModifierLabelProvider{constructor(C,W,V=W){this.modifierLabels=[null],this.modifierLabels[2]=C,this.modifierLabels[1]=W,this.modifierLabels[3]=V}toLabel(C,W,V){if(W.length===0)return null;const U=[];for(let G=0,Z=W.length;G<Z;G++){const X=W[G],Q=V(X);if(Q===null)return null;U[G]=_simpleAsString(X,Q,this.modifierLabels[C])}return U.join(" ")}}const UILabelProvider=new ModifierLabelProvider({ctrlKey:"⌃",shiftKey:"⇧",altKey:"⌥",metaKey:"⌘",separator:""},{ctrlKey:localize({key:"ctrlKey",comment:["This is the short form for the Control key on the keyboard"]},"Ctrl"),shiftKey:localize({key:"shiftKey",comment:["This is the short form for the Shift key on the keyboard"]},"Shift"),altKey:localize({key:"altKey",comment:["This is the short form for the Alt key on the keyboard"]},"Alt"),metaKey:localize({key:"windowsKey",comment:["This is the short form for the Windows key on the keyboard"]},"Windows"),separator:"+"},{ctrlKey:localize({key:"ctrlKey",comment:["This is the short form for the Control key on the keyboard"]},"Ctrl"),shiftKey:localize({key:"shiftKey",comment:["This is the short form for the Shift key on the keyboard"]},"Shift"),altKey:localize({key:"altKey",comment:["This is the short form for the Alt key on the keyboard"]},"Alt"),metaKey:localize({key:"superKey",comment:["This is the short form for the Super key on the keyboard"]},"Super"),separator:"+"}),AriaLabelProvider=new ModifierLabelProvider({ctrlKey:localize({key:"ctrlKey.long",comment:["This is the long form for the Control key on the keyboard"]},"Control"),shiftKey:localize({key:"shiftKey.long",comment:["This is the long form for the Shift key on the keyboard"]},"Shift"),altKey:localize({key:"optKey.long",comment:["This is the long form for the Alt/Option key on the keyboard"]},"Option"),metaKey:localize({key:"cmdKey.long",comment:["This is the long form for the Command key on the keyboard"]},"Command"),separator:"+"},{ctrlKey:localize({key:"ctrlKey.long",comment:["This is the long form for the Control key on the keyboard"]},"Control"),shiftKey:localize({key:"shiftKey.long",comment:["This is the long form for the Shift key on the keyboard"]},"Shift"),altKey:localize({key:"altKey.long",comment:["This is the long form for the Alt key on the keyboard"]},"Alt"),metaKey:localize({key:"windowsKey.long",comment:["This is the long form for the Windows key on the keyboard"]},"Windows"),separator:"+"},{ctrlKey:localize({key:"ctrlKey.long",comment:["This is the long form for the Control key on the keyboard"]},"Control"),shiftKey:localize({key:"shiftKey.long",comment:["This is the long form for the Shift key on the keyboard"]},"Shift"),altKey:localize({key:"altKey.long",comment:["This is the long form for the Alt key on the keyboard"]},"Alt"),metaKey:localize({key:"superKey.long",comment:["This is the long form for the Super key on the keyboard"]},"Super"),separator:"+"}),ElectronAcceleratorLabelProvider=new ModifierLabelProvider({ctrlKey:"Ctrl",shiftKey:"Shift",altKey:"Alt",metaKey:"Cmd",separator:"+"},{ctrlKey:"Ctrl",shiftKey:"Shift",altKey:"Alt",metaKey:"Super",separator:"+"}),UserSettingsLabelProvider=new ModifierLabelProvider({ctrlKey:"ctrl",shiftKey:"shift",altKey:"alt",metaKey:"cmd",separator:"+"},{ctrlKey:"ctrl",shiftKey:"shift",altKey:"alt",metaKey:"win",separator:"+"},{ctrlKey:"ctrl",shiftKey:"shift",altKey:"alt",metaKey:"meta",separator:"+"});function _simpleAsString(K,C,W){if(C===null)return"";const V=[];return K.ctrlKey&&V.push(W.ctrlKey),K.shiftKey&&V.push(W.shiftKey),K.altKey&&V.push(W.altKey),K.metaKey&&V.push(W.metaKey),C!==""&&V.push(C),V.join(W.separator)}class BaseResolvedKeybinding extends ResolvedKeybinding{constructor(C,W){if(super(),W.length===0)throw illegalArgument("chords");this._os=C,this._chords=W}getLabel(){return UILabelProvider.toLabel(this._os,this._chords,C=>this._getLabel(C))}getAriaLabel(){return AriaLabelProvider.toLabel(this._os,this._chords,C=>this._getAriaLabel(C))}getElectronAccelerator(){return this._chords.length>1||this._chords[0].isDuplicateModifierCase()?null:ElectronAcceleratorLabelProvider.toLabel(this._os,this._chords,C=>this._getElectronAccelerator(C))}getUserSettingsLabel(){return UserSettingsLabelProvider.toLabel(this._os,this._chords,C=>this._getUserSettingsLabel(C))}hasMultipleChords(){return this._chords.length>1}getChords(){return this._chords.map(C=>this._getChord(C))}_getChord(C){return new ResolvedChord(C.ctrlKey,C.shiftKey,C.altKey,C.metaKey,this._getLabel(C),this._getAriaLabel(C))}getDispatchChords(){return this._chords.map(C=>this._getChordDispatch(C))}getSingleModifierDispatchChords(){return this._chords.map(C=>this._getSingleModifierChordDispatch(C))}}class USLayoutResolvedKeybinding extends BaseResolvedKeybinding{constructor(C,W){super(W,C)}_keyCodeToUILabel(C){if(this._os===2)switch(C){case 15:return"←";case 16:return"↑";case 17:return"→";case 18:return"↓"}return KeyCodeUtils.toString(C)}_getLabel(C){return C.isDuplicateModifierCase()?"":this._keyCodeToUILabel(C.keyCode)}_getAriaLabel(C){return C.isDuplicateModifierCase()?"":KeyCodeUtils.toString(C.keyCode)}_getElectronAccelerator(C){return KeyCodeUtils.toElectronAccelerator(C.keyCode)}_getUserSettingsLabel(C){if(C.isDuplicateModifierCase())return"";const W=KeyCodeUtils.toUserSettingsUS(C.keyCode);return W&&W.toLowerCase()}_getChordDispatch(C){return USLayoutResolvedKeybinding.getDispatchStr(C)}static getDispatchStr(C){if(C.isModifierKey())return null;let W="";return C.ctrlKey&&(W+="ctrl+"),C.shiftKey&&(W+="shift+"),C.altKey&&(W+="alt+"),C.metaKey&&(W+="meta+"),W+=KeyCodeUtils.toString(C.keyCode),W}_getSingleModifierChordDispatch(C){return C.keyCode===5&&!C.shiftKey&&!C.altKey&&!C.metaKey?"ctrl":C.keyCode===4&&!C.ctrlKey&&!C.altKey&&!C.metaKey?"shift":C.keyCode===6&&!C.ctrlKey&&!C.shiftKey&&!C.metaKey?"alt":C.keyCode===57&&!C.ctrlKey&&!C.shiftKey&&!C.altKey?"meta":null}static _scanCodeToKeyCode(C){const W=IMMUTABLE_CODE_TO_KEY_CODE[C];if(W!==-1)return W;switch(C){case 10:return 31;case 11:return 32;case 12:return 33;case 13:return 34;case 14:return 35;case 15:return 36;case 16:return 37;case 17:return 38;case 18:return 39;case 19:return 40;case 20:return 41;case 21:return 42;case 22:return 43;case 23:return 44;case 24:return 45;case 25:return 46;case 26:return 47;case 27:return 48;case 28:return 49;case 29:return 50;case 30:return 51;case 31:return 52;case 32:return 53;case 33:return 54;case 34:return 55;case 35:return 56;case 36:return 22;case 37:return 23;case 38:return 24;case 39:return 25;case 40:return 26;case 41:return 27;case 42:return 28;case 43:return 29;case 44:return 30;case 45:return 21;case 51:return 88;case 52:return 86;case 53:return 92;case 54:return 94;case 55:return 93;case 56:return 0;case 57:return 85;case 58:return 95;case 59:return 91;case 60:return 87;case 61:return 89;case 62:return 90;case 106:return 97}return 0}static _toKeyCodeChord(C){if(!C)return null;if(C instanceof KeyCodeChord)return C;const W=this._scanCodeToKeyCode(C.scanCode);return W===0?null:new KeyCodeChord(C.ctrlKey,C.shiftKey,C.altKey,C.metaKey,W)}static resolveKeybinding(C,W){const V=toEmptyArrayIfContainsNull(C.chords.map(U=>this._toKeyCodeChord(U)));return V.length>0?[new USLayoutResolvedKeybinding(V,W)]:[]}}const ILabelService=createDecorator("labelService"),IProgressService=createDecorator("progressService");class Progress{constructor(C,W){this.callback=C,this.report=W!=null&&W.async?this._reportAsync.bind(this):this._reportSync.bind(this)}_reportSync(C){this._value=C,this.callback(this._value)}_reportAsync(C){Promise.resolve(this._lastTask).finally(()=>{this._value=C;const W=this.callback(this._value);this._lastTask=Promise.resolve(W).finally(()=>this._lastTask=void 0)})}}Progress.None=Object.freeze({report(){}});const IEditorProgressService=createDecorator("editorProgressService");class StringIterator{constructor(){this._value="",this._pos=0}reset(C){return this._value=C,this._pos=0,this}next(){return this._pos+=1,this}hasNext(){return this._pos<this._value.length-1}cmp(C){const W=C.charCodeAt(0),V=this._value.charCodeAt(this._pos);return W-V}value(){return this._value[this._pos]}}class ConfigKeysIterator{constructor(C=!0){this._caseSensitive=C}reset(C){return this._value=C,this._from=0,this._to=0,this.next()}hasNext(){return this._to<this._value.length}next(){this._from=this._to;let C=!0;for(;this._to<this._value.length;this._to++)if(this._value.charCodeAt(this._to)===46)if(C)this._from++;else break;else C=!1;return this}cmp(C){return this._caseSensitive?compareSubstring(C,this._value,0,C.length,this._from,this._to):compareSubstringIgnoreCase(C,this._value,0,C.length,this._from,this._to)}value(){return this._value.substring(this._from,this._to)}}class PathIterator{constructor(C=!0,W=!0){this._splitOnBackslash=C,this._caseSensitive=W}reset(C){this._from=0,this._to=0,this._value=C,this._valueLen=C.length;for(let W=C.length-1;W>=0;W--,this._valueLen--){const V=this._value.charCodeAt(W);if(!(V===47||this._splitOnBackslash&&V===92))break}return this.next()}hasNext(){return this._to<this._valueLen}next(){this._from=this._to;let C=!0;for(;this._to<this._valueLen;this._to++){const W=this._value.charCodeAt(this._to);if(W===47||this._splitOnBackslash&&W===92)if(C)this._from++;else break;else C=!1}return this}cmp(C){return this._caseSensitive?compareSubstring(C,this._value,0,C.length,this._from,this._to):compareSubstringIgnoreCase(C,this._value,0,C.length,this._from,this._to)}value(){return this._value.substring(this._from,this._to)}}class UriIterator{constructor(C,W){this._ignorePathCasing=C,this._ignoreQueryAndFragment=W,this._states=[],this._stateIdx=0}reset(C){return this._value=C,this._states=[],this._value.scheme&&this._states.push(1),this._value.authority&&this._states.push(2),this._value.path&&(this._pathIterator=new PathIterator(!1,!this._ignorePathCasing(C)),this._pathIterator.reset(C.path),this._pathIterator.value()&&this._states.push(3)),this._ignoreQueryAndFragment(C)||(this._value.query&&this._states.push(4),this._value.fragment&&this._states.push(5)),this._stateIdx=0,this}next(){return this._states[this._stateIdx]===3&&this._pathIterator.hasNext()?this._pathIterator.next():this._stateIdx+=1,this}hasNext(){return this._states[this._stateIdx]===3&&this._pathIterator.hasNext()||this._stateIdx<this._states.length-1}cmp(C){if(this._states[this._stateIdx]===1)return compareIgnoreCase(C,this._value.scheme);if(this._states[this._stateIdx]===2)return compareIgnoreCase(C,this._value.authority);if(this._states[this._stateIdx]===3)return this._pathIterator.cmp(C);if(this._states[this._stateIdx]===4)return compare$1(C,this._value.query);if(this._states[this._stateIdx]===5)return compare$1(C,this._value.fragment);throw new Error}value(){if(this._states[this._stateIdx]===1)return this._value.scheme;if(this._states[this._stateIdx]===2)return this._value.authority;if(this._states[this._stateIdx]===3)return this._pathIterator.value();if(this._states[this._stateIdx]===4)return this._value.query;if(this._states[this._stateIdx]===5)return this._value.fragment;throw new Error}}class TernarySearchTreeNode{constructor(){this.height=1}rotateLeft(){const C=this.right;return this.right=C.left,C.left=this,this.updateHeight(),C.updateHeight(),C}rotateRight(){const C=this.left;return this.left=C.right,C.right=this,this.updateHeight(),C.updateHeight(),C}updateHeight(){this.height=1+Math.max(this.heightLeft,this.heightRight)}balanceFactor(){return this.heightRight-this.heightLeft}get heightLeft(){var C,W;return(W=(C=this.left)===null||C===void 0?void 0:C.height)!==null&&W!==void 0?W:0}get heightRight(){var C,W;return(W=(C=this.right)===null||C===void 0?void 0:C.height)!==null&&W!==void 0?W:0}}class TernarySearchTree{static forUris(C=()=>!1,W=()=>!1){return new TernarySearchTree(new UriIterator(C,W))}static forStrings(){return new TernarySearchTree(new StringIterator)}static forConfigKeys(){return new TernarySearchTree(new ConfigKeysIterator)}constructor(C){this._iter=C}clear(){this._root=void 0}set(C,W){const V=this._iter.reset(C);let U;this._root||(this._root=new TernarySearchTreeNode,this._root.segment=V.value());const G=[];for(U=this._root;;){const X=V.cmp(U.segment);if(X>0)U.left||(U.left=new TernarySearchTreeNode,U.left.segment=V.value()),G.push([-1,U]),U=U.left;else if(X<0)U.right||(U.right=new TernarySearchTreeNode,U.right.segment=V.value()),G.push([1,U]),U=U.right;else if(V.hasNext())V.next(),U.mid||(U.mid=new TernarySearchTreeNode,U.mid.segment=V.value()),G.push([0,U]),U=U.mid;else break}const Z=U.value;U.value=W,U.key=C;for(let X=G.length-1;X>=0;X--){const Q=G[X][1];Q.updateHeight();const J=Q.balanceFactor();if(J<-1||J>1){const ee=G[X][0],te=G[X+1][0];if(ee===1&&te===1)G[X][1]=Q.rotateLeft();else if(ee===-1&&te===-1)G[X][1]=Q.rotateRight();else if(ee===1&&te===-1)Q.right=G[X+1][1]=G[X+1][1].rotateRight(),G[X][1]=Q.rotateLeft();else if(ee===-1&&te===1)Q.left=G[X+1][1]=G[X+1][1].rotateLeft(),G[X][1]=Q.rotateRight();else throw new Error;if(X>0)switch(G[X-1][0]){case-1:G[X-1][1].left=G[X][1];break;case 1:G[X-1][1].right=G[X][1];break;case 0:G[X-1][1].mid=G[X][1];break}else this._root=G[0][1]}}return Z}get(C){var W;return(W=this._getNode(C))===null||W===void 0?void 0:W.value}_getNode(C){const W=this._iter.reset(C);let V=this._root;for(;V;){const U=W.cmp(V.segment);if(U>0)V=V.left;else if(U<0)V=V.right;else if(W.hasNext())W.next(),V=V.mid;else break}return V}has(C){const W=this._getNode(C);return!((W==null?void 0:W.value)===void 0&&(W==null?void 0:W.mid)===void 0)}delete(C){return this._delete(C,!1)}deleteSuperstr(C){return this._delete(C,!0)}_delete(C,W){var V;const U=this._iter.reset(C),G=[];let Z=this._root;for(;Z;){const X=U.cmp(Z.segment);if(X>0)G.push([-1,Z]),Z=Z.left;else if(X<0)G.push([1,Z]),Z=Z.right;else if(U.hasNext())U.next(),G.push([0,Z]),Z=Z.mid;else break}if(Z){if(W?(Z.left=void 0,Z.mid=void 0,Z.right=void 0,Z.height=1):(Z.key=void 0,Z.value=void 0),!Z.mid&&!Z.value)if(Z.left&&Z.right){const X=this._min(Z.right);if(X.key){const{key:Q,value:J,segment:ee}=X;this._delete(X.key,!1),Z.key=Q,Z.value=J,Z.segment=ee}}else{const X=(V=Z.left)!==null&&V!==void 0?V:Z.right;if(G.length>0){const[Q,J]=G[G.length-1];switch(Q){case-1:J.left=X;break;case 0:J.mid=X;break;case 1:J.right=X;break}}else this._root=X}for(let X=G.length-1;X>=0;X--){const Q=G[X][1];Q.updateHeight();const J=Q.balanceFactor();if(J>1?(Q.right.balanceFactor()>=0||(Q.right=Q.right.rotateRight()),G[X][1]=Q.rotateLeft()):J<-1&&(Q.left.balanceFactor()<=0||(Q.left=Q.left.rotateLeft()),G[X][1]=Q.rotateRight()),X>0)switch(G[X-1][0]){case-1:G[X-1][1].left=G[X][1];break;case 1:G[X-1][1].right=G[X][1];break;case 0:G[X-1][1].mid=G[X][1];break}else this._root=G[0][1]}}}_min(C){for(;C.left;)C=C.left;return C}findSubstr(C){const W=this._iter.reset(C);let V=this._root,U;for(;V;){const G=W.cmp(V.segment);if(G>0)V=V.left;else if(G<0)V=V.right;else if(W.hasNext())W.next(),U=V.value||U,V=V.mid;else break}return V&&V.value||U}findSuperstr(C){return this._findSuperstrOrElement(C,!1)}_findSuperstrOrElement(C,W){const V=this._iter.reset(C);let U=this._root;for(;U;){const G=V.cmp(U.segment);if(G>0)U=U.left;else if(G<0)U=U.right;else if(V.hasNext())V.next(),U=U.mid;else return U.mid?this._entries(U.mid):W?U.value:void 0}}forEach(C){for(const[W,V]of this)C(V,W)}*[Symbol.iterator](){yield*this._entries(this._root)}_entries(C){const W=[];return this._dfsEntries(C,W),W[Symbol.iterator]()}_dfsEntries(C,W){C&&(C.left&&this._dfsEntries(C.left,W),C.value&&W.push([C.key,C.value]),C.mid&&this._dfsEntries(C.mid,W),C.right&&this._dfsEntries(C.right,W))}}const IWorkspaceContextService=createDecorator("contextService");function isSingleFolderWorkspaceIdentifier(K){const C=K;return typeof(C==null?void 0:C.id)=="string"&&URI.isUri(C.uri)}function isEmptyWorkspaceIdentifier(K){const C=K;return typeof(C==null?void 0:C.id)=="string"&&!isSingleFolderWorkspaceIdentifier(K)&&!isWorkspaceIdentifier(K)}const EXTENSION_DEVELOPMENT_EMPTY_WINDOW_WORKSPACE={id:"ext-dev"},UNKNOWN_EMPTY_WINDOW_WORKSPACE={id:"empty-window"};function toWorkspaceIdentifier(K,C){if(typeof K=="string"||typeof K>"u")return typeof K=="string"?{id:basename$1(K)}:C?EXTENSION_DEVELOPMENT_EMPTY_WINDOW_WORKSPACE:UNKNOWN_EMPTY_WINDOW_WORKSPACE;const W=K;return W.configuration?{id:W.id,configPath:W.configuration}:W.folders.length===1?{id:W.id,uri:W.folders[0].uri}:{id:W.id}}function isWorkspaceIdentifier(K){const C=K;return typeof(C==null?void 0:C.id)=="string"&&URI.isUri(C.configPath)}class WorkspaceFolder{constructor(C,W){this.raw=W,this.uri=C.uri,this.index=C.index,this.name=C.name}toJSON(){return{uri:this.uri,name:this.name,index:this.index}}}const WORKSPACE_EXTENSION="code-workspace";localize("codeWorkspace","Code Workspace");const STANDALONE_EDITOR_WORKSPACE_ID="4064f6ec-cb38-4ad0-af64-ee6467e63c82";function isStandaloneEditorWorkspace(K){return K.id===STANDALONE_EDITOR_WORKSPACE_ID}var InspectTokensNLS;(function(K){K.inspectTokensAction=localize("inspectTokens","Developer: Inspect Tokens")})(InspectTokensNLS||(InspectTokensNLS={}));var GoToLineNLS;(function(K){K.gotoLineActionLabel=localize("gotoLineActionLabel","Go to Line/Column...")})(GoToLineNLS||(GoToLineNLS={}));var QuickHelpNLS;(function(K){K.helpQuickAccessActionLabel=localize("helpQuickAccess","Show all Quick Access Providers")})(QuickHelpNLS||(QuickHelpNLS={}));var QuickCommandNLS;(function(K){K.quickCommandActionLabel=localize("quickCommandActionLabel","Command Palette"),K.quickCommandHelp=localize("quickCommandActionHelp","Show And Run Commands")})(QuickCommandNLS||(QuickCommandNLS={}));var QuickOutlineNLS;(function(K){K.quickOutlineActionLabel=localize("quickOutlineActionLabel","Go to Symbol..."),K.quickOutlineByCategoryActionLabel=localize("quickOutlineByCategoryActionLabel","Go to Symbol by Category...")})(QuickOutlineNLS||(QuickOutlineNLS={}));var StandaloneCodeEditorNLS;(function(K){K.editorViewAccessibleLabel=localize("editorViewAccessibleLabel","Editor content"),K.accessibilityHelpMessage=localize("accessibilityHelpMessage","Press Alt+F1 for Accessibility Options.")})(StandaloneCodeEditorNLS||(StandaloneCodeEditorNLS={}));var ToggleHighContrastNLS;(function(K){K.toggleHighContrast=localize("toggleHighContrast","Toggle High Contrast Theme")})(ToggleHighContrastNLS||(ToggleHighContrastNLS={}));var StandaloneServicesNLS;(function(K){K.bulkEditServiceSummary=localize("bulkEditServiceSummary","Made {0} edits in {1} files")})(StandaloneServicesNLS||(StandaloneServicesNLS={}));const IWorkspaceTrustManagementService=createDecorator("workspaceTrustManagementService"),IContextViewService=createDecorator("contextViewService"),IContextMenuService=createDecorator("contextMenuService");var Range$1;(function(K){function C(G,Z){if(G.start>=Z.end||Z.start>=G.end)return{start:0,end:0};const X=Math.max(G.start,Z.start),Q=Math.min(G.end,Z.end);return Q-X<=0?{start:0,end:0}:{start:X,end:Q}}K.intersect=C;function W(G){return G.end-G.start<=0}K.isEmpty=W;function V(G,Z){return!W(C(G,Z))}K.intersects=V;function U(G,Z){const X=[],Q={start:G.start,end:Math.min(Z.start,G.end)},J={start:Math.max(Z.end,G.start),end:G.end};return W(Q)||X.push(Q),W(J)||X.push(J),X}K.relativeComplement=U})(Range$1||(Range$1={}));const contextview="";function isAnchor(K){const C=K;return!!C&&typeof C.x=="number"&&typeof C.y=="number"}var LayoutAnchorMode;(function(K){K[K.AVOID=0]="AVOID",K[K.ALIGN=1]="ALIGN"})(LayoutAnchorMode||(LayoutAnchorMode={}));function layout(K,C,W){const V=W.mode===LayoutAnchorMode.ALIGN?W.offset:W.offset+W.size,U=W.mode===LayoutAnchorMode.ALIGN?W.offset+W.size:W.offset;return W.position===0?C<=K-V?V:C<=U?U-C:Math.max(K-C,0):C<=U?U-C:C<=K-V?V:0}class ContextView extends Disposable{constructor(C,W){super(),this.container=null,this.delegate=null,this.toDisposeOnClean=Disposable.None,this.toDisposeOnSetContainer=Disposable.None,this.shadowRoot=null,this.shadowRootHostElement=null,this.view=$$d(".context-view"),this.useFixedPosition=!1,this.useShadowDOM=!1,hide(this.view),this.setContainer(C,W),this._register(toDisposable(()=>this.setContainer(null,1)))}setContainer(C,W){var V;if(this.container&&(this.toDisposeOnSetContainer.dispose(),this.shadowRoot?(this.shadowRoot.removeChild(this.view),this.shadowRoot=null,(V=this.shadowRootHostElement)===null||V===void 0||V.remove(),this.shadowRootHostElement=null):this.container.removeChild(this.view),this.container=null),C){if(this.container=C,this.useFixedPosition=W!==1,this.useShadowDOM=W===3,this.useShadowDOM){this.shadowRootHostElement=$$d(".shadow-root-host"),this.container.appendChild(this.shadowRootHostElement),this.shadowRoot=this.shadowRootHostElement.attachShadow({mode:"open"});const G=document.createElement("style");G.textContent=SHADOW_ROOT_CSS,this.shadowRoot.appendChild(G),this.shadowRoot.appendChild(this.view),this.shadowRoot.appendChild($$d("slot"))}else this.container.appendChild(this.view);const U=new DisposableStore;ContextView.BUBBLE_UP_EVENTS.forEach(G=>{U.add(addStandardDisposableListener(this.container,G,Z=>{this.onDOMEvent(Z,!1)}))}),ContextView.BUBBLE_DOWN_EVENTS.forEach(G=>{U.add(addStandardDisposableListener(this.container,G,Z=>{this.onDOMEvent(Z,!0)},!0))}),this.toDisposeOnSetContainer=U}}show(C){var W,V;this.isVisible()&&this.hide(),clearNode(this.view),this.view.className="context-view",this.view.style.top="0px",this.view.style.left="0px",this.view.style.zIndex="2575",this.view.style.position=this.useFixedPosition?"fixed":"absolute",show(this.view),this.toDisposeOnClean=C.render(this.view)||Disposable.None,this.delegate=C,this.doLayout(),(V=(W=this.delegate).focus)===null||V===void 0||V.call(W)}getViewElement(){return this.view}layout(){if(this.isVisible()){if(this.delegate.canRelayout===!1&&!(isIOS&&BrowserFeatures.pointerEvents)){this.hide();return}this.delegate.layout&&this.delegate.layout(),this.doLayout()}}doLayout(){if(!this.isVisible())return;const C=this.delegate.getAnchor();let W;if(isHTMLElement(C)){const te=getDomNodePagePosition(C),ie=getDomNodeZoomLevel(C);W={top:te.top*ie,left:te.left*ie,width:te.width*ie,height:te.height*ie}}else isAnchor(C)?W={top:C.y,left:C.x,width:C.width||1,height:C.height||2}:W={top:C.posy,left:C.posx,width:2,height:2};const V=getTotalWidth(this.view),U=getTotalHeight(this.view),G=this.delegate.anchorPosition||0,Z=this.delegate.anchorAlignment||0,X=this.delegate.anchorAxisAlignment||0;let Q,J;if(X===0){const te={offset:W.top-window.pageYOffset,size:W.height,position:G===0?0:1},ie={offset:W.left,size:W.width,position:Z===0?0:1,mode:LayoutAnchorMode.ALIGN};Q=layout(window.innerHeight,U,te)+window.pageYOffset,Range$1.intersects({start:Q,end:Q+U},{start:te.offset,end:te.offset+te.size})&&(ie.mode=LayoutAnchorMode.AVOID),J=layout(window.innerWidth,V,ie)}else{const te={offset:W.left,size:W.width,position:Z===0?0:1},ie={offset:W.top,size:W.height,position:G===0?0:1,mode:LayoutAnchorMode.ALIGN};J=layout(window.innerWidth,V,te),Range$1.intersects({start:J,end:J+V},{start:te.offset,end:te.offset+te.size})&&(ie.mode=LayoutAnchorMode.AVOID),Q=layout(window.innerHeight,U,ie)+window.pageYOffset}this.view.classList.remove("top","bottom","left","right"),this.view.classList.add(G===0?"bottom":"top"),this.view.classList.add(Z===0?"left":"right"),this.view.classList.toggle("fixed",this.useFixedPosition);const ee=getDomNodePagePosition(this.container);this.view.style.top=`${Q-(this.useFixedPosition?getDomNodePagePosition(this.view).top:ee.top)}px`,this.view.style.left=`${J-(this.useFixedPosition?getDomNodePagePosition(this.view).left:ee.left)}px`,this.view.style.width="initial"}hide(C){const W=this.delegate;this.delegate=null,W!=null&&W.onHide&&W.onHide(C),this.toDisposeOnClean.dispose(),hide(this.view)}isVisible(){return!!this.delegate}onDOMEvent(C,W){this.delegate&&(this.delegate.onDOMEvent?this.delegate.onDOMEvent(C,document.activeElement):W&&!isAncestor$1(C.target,this.container)&&this.hide())}dispose(){this.hide(),super.dispose()}}ContextView.BUBBLE_UP_EVENTS=["click","keydown","focus","blur"];ContextView.BUBBLE_DOWN_EVENTS=["click"];const SHADOW_ROOT_CSS=`
	:host {
		all: initial; /* 1st rule so subsequent properties are reset. */
	}

	.codicon[class*='codicon-'] {
		font: normal normal normal 16px/1 codicon;
		display: inline-block;
		text-decoration: none;
		text-rendering: auto;
		text-align: center;
		-webkit-font-smoothing: antialiased;
		-moz-osx-font-smoothing: grayscale;
		user-select: none;
		-webkit-user-select: none;
		-ms-user-select: none;
	}

	:host {
		font-family: -apple-system, BlinkMacSystemFont, "Segoe WPC", "Segoe UI", "HelveticaNeue-Light", system-ui, "Ubuntu", "Droid Sans", sans-serif;
	}

	:host-context(.mac) { font-family: -apple-system, BlinkMacSystemFont, sans-serif; }
	:host-context(.mac:lang(zh-Hans)) { font-family: -apple-system, BlinkMacSystemFont, "PingFang SC", "Hiragino Sans GB", sans-serif; }
	:host-context(.mac:lang(zh-Hant)) { font-family: -apple-system, BlinkMacSystemFont, "PingFang TC", sans-serif; }
	:host-context(.mac:lang(ja)) { font-family: -apple-system, BlinkMacSystemFont, "Hiragino Kaku Gothic Pro", sans-serif; }
	:host-context(.mac:lang(ko)) { font-family: -apple-system, BlinkMacSystemFont, "Nanum Gothic", "Apple SD Gothic Neo", "AppleGothic", sans-serif; }

	:host-context(.windows) { font-family: "Segoe WPC", "Segoe UI", sans-serif; }
	:host-context(.windows:lang(zh-Hans)) { font-family: "Segoe WPC", "Segoe UI", "Microsoft YaHei", sans-serif; }
	:host-context(.windows:lang(zh-Hant)) { font-family: "Segoe WPC", "Segoe UI", "Microsoft Jhenghei", sans-serif; }
	:host-context(.windows:lang(ja)) { font-family: "Segoe WPC", "Segoe UI", "Yu Gothic UI", "Meiryo UI", sans-serif; }
	:host-context(.windows:lang(ko)) { font-family: "Segoe WPC", "Segoe UI", "Malgun Gothic", "Dotom", sans-serif; }

	:host-context(.linux) { font-family: system-ui, "Ubuntu", "Droid Sans", sans-serif; }
	:host-context(.linux:lang(zh-Hans)) { font-family: system-ui, "Ubuntu", "Droid Sans", "Source Han Sans SC", "Source Han Sans CN", "Source Han Sans", sans-serif; }
	:host-context(.linux:lang(zh-Hant)) { font-family: system-ui, "Ubuntu", "Droid Sans", "Source Han Sans TC", "Source Han Sans TW", "Source Han Sans", sans-serif; }
	:host-context(.linux:lang(ja)) { font-family: system-ui, "Ubuntu", "Droid Sans", "Source Han Sans J", "Source Han Sans JP", "Source Han Sans", sans-serif; }
	:host-context(.linux:lang(ko)) { font-family: system-ui, "Ubuntu", "Droid Sans", "Source Han Sans K", "Source Han Sans JR", "Source Han Sans", "UnDotum", "FBaekmuk Gulim", sans-serif; }
`;var __decorate$1U=globalThis&&globalThis.__decorate||function(K,C,W,V){var U=arguments.length,G=U<3?C:V===null?V=Object.getOwnPropertyDescriptor(C,W):V,Z;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")G=Reflect.decorate(K,C,W,V);else for(var X=K.length-1;X>=0;X--)(Z=K[X])&&(G=(U<3?Z(G):U>3?Z(C,W,G):Z(C,W))||G);return U>3&&G&&Object.defineProperty(C,W,G),G},__param$1O=globalThis&&globalThis.__param||function(K,C){return function(W,V){C(W,V,K)}};let ContextViewService=class extends Disposable{constructor(C){super(),this.layoutService=C,this.currentViewDisposable=Disposable.None,this.container=C.hasContainer?C.container:null,this.contextView=this._register(new ContextView(this.container,1)),this.layout(),this._register(C.onDidLayout(()=>this.layout()))}setContainer(C,W){this.contextView.setContainer(C,W||1)}showContextView(C,W,V){W?(W!==this.container||this.shadowRoot!==V)&&(this.container=W,this.setContainer(W,V?3:2)):this.layoutService.hasContainer&&this.container!==this.layoutService.container&&(this.container=this.layoutService.container,this.setContainer(this.container,1)),this.shadowRoot=V,this.contextView.show(C);const U=toDisposable(()=>{this.currentViewDisposable===U&&this.hideContextView()});return this.currentViewDisposable=U,U}getContextViewElement(){return this.contextView.getViewElement()}layout(){this.contextView.layout()}hideContextView(C){this.contextView.hide(C)}};ContextViewService=__decorate$1U([__param$1O(0,ILayoutService)],ContextViewService);let registeredAssociations=[],nonUserRegisteredAssociations=[],userRegisteredAssociations=[];function registerPlatformLanguageAssociation(K,C=!1){_registerLanguageAssociation(K,!1,C)}function _registerLanguageAssociation(K,C,W){const V=toLanguageAssociationItem(K,C);registeredAssociations.push(V),V.userConfigured?userRegisteredAssociations.push(V):nonUserRegisteredAssociations.push(V),W&&!V.userConfigured&&registeredAssociations.forEach(U=>{U.mime===V.mime||U.userConfigured||(V.extension&&U.extension===V.extension&&console.warn(`Overwriting extension <<${V.extension}>> to now point to mime <<${V.mime}>>`),V.filename&&U.filename===V.filename&&console.warn(`Overwriting filename <<${V.filename}>> to now point to mime <<${V.mime}>>`),V.filepattern&&U.filepattern===V.filepattern&&console.warn(`Overwriting filepattern <<${V.filepattern}>> to now point to mime <<${V.mime}>>`),V.firstline&&U.firstline===V.firstline&&console.warn(`Overwriting firstline <<${V.firstline}>> to now point to mime <<${V.mime}>>`))})}function toLanguageAssociationItem(K,C){return{id:K.id,mime:K.mime,filename:K.filename,extension:K.extension,filepattern:K.filepattern,firstline:K.firstline,userConfigured:C,filenameLowercase:K.filename?K.filename.toLowerCase():void 0,extensionLowercase:K.extension?K.extension.toLowerCase():void 0,filepatternLowercase:K.filepattern?parse$1(K.filepattern.toLowerCase()):void 0,filepatternOnPath:K.filepattern?K.filepattern.indexOf(posix.sep)>=0:!1}}function clearPlatformLanguageAssociations(){registeredAssociations=registeredAssociations.filter(K=>K.userConfigured),nonUserRegisteredAssociations=[]}function getLanguageIds(K,C){return getAssociations(K,C).map(W=>W.id)}function getAssociations(K,C){let W;if(K)switch(K.scheme){case Schemas.file:W=K.fsPath;break;case Schemas.data:{W=DataUri.parseMetaData(K).get(DataUri.META_DATA_LABEL);break}case Schemas.vscodeNotebookCell:W=void 0;break;default:W=K.path}if(!W)return[{id:"unknown",mime:Mimes.unknown}];W=W.toLowerCase();const V=basename$1(W),U=getAssociationByPath(W,V,userRegisteredAssociations);if(U)return[U,{id:PLAINTEXT_LANGUAGE_ID,mime:Mimes.text}];const G=getAssociationByPath(W,V,nonUserRegisteredAssociations);if(G)return[G,{id:PLAINTEXT_LANGUAGE_ID,mime:Mimes.text}];if(C){const Z=getAssociationByFirstline(C);if(Z)return[Z,{id:PLAINTEXT_LANGUAGE_ID,mime:Mimes.text}]}return[{id:"unknown",mime:Mimes.unknown}]}function getAssociationByPath(K,C,W){var V;let U,G,Z;for(let X=W.length-1;X>=0;X--){const Q=W[X];if(C===Q.filenameLowercase){U=Q;break}if(Q.filepattern&&(!G||Q.filepattern.length>G.filepattern.length)){const J=Q.filepatternOnPath?K:C;!((V=Q.filepatternLowercase)===null||V===void 0)&&V.call(Q,J)&&(G=Q)}Q.extension&&(!Z||Q.extension.length>Z.extension.length)&&C.endsWith(Q.extensionLowercase)&&(Z=Q)}if(U)return U;if(G)return G;if(Z)return Z}function getAssociationByFirstline(K){if(startsWithUTF8BOM(K)&&(K=K.substr(1)),K.length>0)for(let C=registeredAssociations.length-1;C>=0;C--){const W=registeredAssociations[C];if(!W.firstline)continue;const V=K.match(W.firstline);if(V&&V.length>0)return W}}const hasOwnProperty=Object.prototype.hasOwnProperty,NULL_LANGUAGE_ID="vs.editor.nullLanguage";class LanguageIdCodec{constructor(){this._languageIdToLanguage=[],this._languageToLanguageId=new Map,this._register(NULL_LANGUAGE_ID,0),this._register(PLAINTEXT_LANGUAGE_ID,1),this._nextLanguageId=2}_register(C,W){this._languageIdToLanguage[W]=C,this._languageToLanguageId.set(C,W)}register(C){if(this._languageToLanguageId.has(C))return;const W=this._nextLanguageId++;this._register(C,W)}encodeLanguageId(C){return this._languageToLanguageId.get(C)||0}decodeLanguageId(C){return this._languageIdToLanguage[C]||NULL_LANGUAGE_ID}}class LanguagesRegistry extends Disposable{constructor(C=!0,W=!1){super(),this._onDidChange=this._register(new Emitter$1),this.onDidChange=this._onDidChange.event,LanguagesRegistry.instanceCount++,this._warnOnOverwrite=W,this.languageIdCodec=new LanguageIdCodec,this._dynamicLanguages=[],this._languages={},this._mimeTypesMap={},this._nameMap={},this._lowercaseNameMap={},C&&(this._initializeFromRegistry(),this._register(ModesRegistry.onDidChangeLanguages(V=>{this._initializeFromRegistry()})))}dispose(){LanguagesRegistry.instanceCount--,super.dispose()}_initializeFromRegistry(){this._languages={},this._mimeTypesMap={},this._nameMap={},this._lowercaseNameMap={},clearPlatformLanguageAssociations();const C=[].concat(ModesRegistry.getLanguages()).concat(this._dynamicLanguages);this._registerLanguages(C)}_registerLanguages(C){for(const W of C)this._registerLanguage(W);this._mimeTypesMap={},this._nameMap={},this._lowercaseNameMap={},Object.keys(this._languages).forEach(W=>{const V=this._languages[W];V.name&&(this._nameMap[V.name]=V.identifier),V.aliases.forEach(U=>{this._lowercaseNameMap[U.toLowerCase()]=V.identifier}),V.mimetypes.forEach(U=>{this._mimeTypesMap[U]=V.identifier})}),Registry.as(Extensions$6.Configuration).registerOverrideIdentifiers(this.getRegisteredLanguageIds()),this._onDidChange.fire()}_registerLanguage(C){const W=C.id;let V;hasOwnProperty.call(this._languages,W)?V=this._languages[W]:(this.languageIdCodec.register(W),V={identifier:W,name:null,mimetypes:[],aliases:[],extensions:[],filenames:[],configurationFiles:[],icons:[]},this._languages[W]=V),this._mergeLanguage(V,C)}_mergeLanguage(C,W){const V=W.id;let U=null;if(Array.isArray(W.mimetypes)&&W.mimetypes.length>0&&(C.mimetypes.push(...W.mimetypes),U=W.mimetypes[0]),U||(U=`text/x-${V}`,C.mimetypes.push(U)),Array.isArray(W.extensions)){W.configuration?C.extensions=W.extensions.concat(C.extensions):C.extensions=C.extensions.concat(W.extensions);for(const X of W.extensions)registerPlatformLanguageAssociation({id:V,mime:U,extension:X},this._warnOnOverwrite)}if(Array.isArray(W.filenames))for(const X of W.filenames)registerPlatformLanguageAssociation({id:V,mime:U,filename:X},this._warnOnOverwrite),C.filenames.push(X);if(Array.isArray(W.filenamePatterns))for(const X of W.filenamePatterns)registerPlatformLanguageAssociation({id:V,mime:U,filepattern:X},this._warnOnOverwrite);if(typeof W.firstLine=="string"&&W.firstLine.length>0){let X=W.firstLine;X.charAt(0)!=="^"&&(X="^"+X);try{const Q=new RegExp(X);regExpLeadsToEndlessLoop(Q)||registerPlatformLanguageAssociation({id:V,mime:U,firstline:Q},this._warnOnOverwrite)}catch(Q){console.warn(`[${W.id}]: Invalid regular expression \`${X}\`: `,Q)}}C.aliases.push(V);let G=null;if(typeof W.aliases<"u"&&Array.isArray(W.aliases)&&(W.aliases.length===0?G=[null]:G=W.aliases),G!==null)for(const X of G)!X||X.length===0||C.aliases.push(X);const Z=G!==null&&G.length>0;if(!(Z&&G[0]===null)){const X=(Z?G[0]:null)||V;(Z||!C.name)&&(C.name=X)}W.configuration&&C.configurationFiles.push(W.configuration),W.icon&&C.icons.push(W.icon)}isRegisteredLanguageId(C){return C?hasOwnProperty.call(this._languages,C):!1}getRegisteredLanguageIds(){return Object.keys(this._languages)}getLanguageIdByLanguageName(C){const W=C.toLowerCase();return hasOwnProperty.call(this._lowercaseNameMap,W)?this._lowercaseNameMap[W]:null}getLanguageIdByMimeType(C){return C&&hasOwnProperty.call(this._mimeTypesMap,C)?this._mimeTypesMap[C]:null}guessLanguageIdByFilepathOrFirstLine(C,W){return!C&&!W?[]:getLanguageIds(C,W)}}LanguagesRegistry.instanceCount=0;class LanguageService extends Disposable{constructor(C=!1){super(),this._onDidRequestBasicLanguageFeatures=this._register(new Emitter$1),this.onDidRequestBasicLanguageFeatures=this._onDidRequestBasicLanguageFeatures.event,this._onDidRequestRichLanguageFeatures=this._register(new Emitter$1),this.onDidRequestRichLanguageFeatures=this._onDidRequestRichLanguageFeatures.event,this._onDidChange=this._register(new Emitter$1({leakWarningThreshold:200})),this.onDidChange=this._onDidChange.event,this._requestedBasicLanguages=new Set,this._requestedRichLanguages=new Set,LanguageService.instanceCount++,this._registry=this._register(new LanguagesRegistry(!0,C)),this.languageIdCodec=this._registry.languageIdCodec,this._register(this._registry.onDidChange(()=>this._onDidChange.fire()))}dispose(){LanguageService.instanceCount--,super.dispose()}isRegisteredLanguageId(C){return this._registry.isRegisteredLanguageId(C)}getLanguageIdByLanguageName(C){return this._registry.getLanguageIdByLanguageName(C)}getLanguageIdByMimeType(C){return this._registry.getLanguageIdByMimeType(C)}guessLanguageIdByFilepathOrFirstLine(C,W){const V=this._registry.guessLanguageIdByFilepathOrFirstLine(C,W);return firstOrDefault(V,null)}createById(C){return new LanguageSelection(this.onDidChange,()=>this._createAndGetLanguageIdentifier(C))}createByFilepathOrFirstLine(C,W){return new LanguageSelection(this.onDidChange,()=>{const V=this.guessLanguageIdByFilepathOrFirstLine(C,W);return this._createAndGetLanguageIdentifier(V)})}_createAndGetLanguageIdentifier(C){return(!C||!this.isRegisteredLanguageId(C))&&(C=PLAINTEXT_LANGUAGE_ID),C}requestBasicLanguageFeatures(C){this._requestedBasicLanguages.has(C)||(this._requestedBasicLanguages.add(C),this._onDidRequestBasicLanguageFeatures.fire(C))}requestRichLanguageFeatures(C){this._requestedRichLanguages.has(C)||(this._requestedRichLanguages.add(C),this.requestBasicLanguageFeatures(C),TokenizationRegistry.getOrCreate(C),this._onDidRequestRichLanguageFeatures.fire(C))}}LanguageService.instanceCount=0;class LanguageSelection{constructor(C,W){this._onDidChangeLanguages=C,this._selector=W,this._listener=null,this._emitter=null,this.languageId=this._selector()}_dispose(){this._listener&&(this._listener.dispose(),this._listener=null),this._emitter&&(this._emitter.dispose(),this._emitter=null)}get onDidChange(){return this._listener||(this._listener=this._onDidChangeLanguages(()=>this._evaluate())),this._emitter||(this._emitter=new Emitter$1({onDidRemoveLastListener:()=>{this._dispose()}})),this._emitter.event}_evaluate(){var C;const W=this._selector();W!==this.languageId&&(this.languageId=W,(C=this._emitter)===null||C===void 0||C.fire(this.languageId))}}const DataTransfers={RESOURCES:"ResourceURLs",DOWNLOAD_URL:"DownloadURL",FILES:"Files",TEXT:Mimes.text,INTERNAL_URI_LIST:"application/vnd.code.uri-list"};function or$2(...K){return function(C,W){for(let V=0,U=K.length;V<U;V++){const G=K[V](C,W);if(G)return G}return null}}_matchesPrefix.bind(void 0,!1);const matchesPrefix=_matchesPrefix.bind(void 0,!0);function _matchesPrefix(K,C,W){if(!W||W.length<C.length)return null;let V;return K?V=startsWithIgnoreCase(W,C):V=W.indexOf(C)===0,V?C.length>0?[{start:0,end:C.length}]:[]:null}function matchesContiguousSubString(K,C){const W=C.toLowerCase().indexOf(K.toLowerCase());return W===-1?null:[{start:W,end:W+K.length}]}function matchesSubString(K,C){return _matchesSubString(K.toLowerCase(),C.toLowerCase(),0,0)}function _matchesSubString(K,C,W,V){if(W===K.length)return[];if(V===C.length)return null;if(K[W]===C[V]){let U=null;return(U=_matchesSubString(K,C,W+1,V+1))?join$2({start:V,end:V+1},U):null}return _matchesSubString(K,C,W,V+1)}function isLower(K){return 97<=K&&K<=122}function isUpper(K){return 65<=K&&K<=90}function isNumber$2(K){return 48<=K&&K<=57}function isWhitespace(K){return K===32||K===9||K===10||K===13}const wordSeparators=new Set;"()[]{}<>`'\"-/;:,.?!".split("").forEach(K=>wordSeparators.add(K.charCodeAt(0)));function isWordSeparator(K){return isWhitespace(K)||wordSeparators.has(K)}function charactersMatch(K,C){return K===C||isWordSeparator(K)&&isWordSeparator(C)}function isAlphanumeric(K){return isLower(K)||isUpper(K)||isNumber$2(K)}function join$2(K,C){return C.length===0?C=[K]:K.end===C[0].start?C[0].start=K.start:C.unshift(K),C}function nextAnchor(K,C){for(let W=C;W<K.length;W++){const V=K.charCodeAt(W);if(isUpper(V)||isNumber$2(V)||W>0&&!isAlphanumeric(K.charCodeAt(W-1)))return W}return K.length}function _matchesCamelCase(K,C,W,V){if(W===K.length)return[];if(V===C.length)return null;if(K[W]!==C[V].toLowerCase())return null;{let U=null,G=V+1;for(U=_matchesCamelCase(K,C,W+1,V+1);!U&&(G=nextAnchor(C,G))<C.length;)U=_matchesCamelCase(K,C,W+1,G),G++;return U===null?null:join$2({start:V,end:V+1},U)}}function analyzeCamelCaseWord(K){let C=0,W=0,V=0,U=0,G=0;for(let ee=0;ee<K.length;ee++)G=K.charCodeAt(ee),isUpper(G)&&C++,isLower(G)&&W++,isAlphanumeric(G)&&V++,isNumber$2(G)&&U++;const Z=C/K.length,X=W/K.length,Q=V/K.length,J=U/K.length;return{upperPercent:Z,lowerPercent:X,alphaPercent:Q,numericPercent:J}}function isUpperCaseWord(K){const{upperPercent:C,lowerPercent:W}=K;return W===0&&C>.6}function isCamelCaseWord(K){const{upperPercent:C,lowerPercent:W,alphaPercent:V,numericPercent:U}=K;return W>.2&&C<.8&&V>.6&&U<.2}function isCamelCasePattern(K){let C=0,W=0,V=0,U=0;for(let G=0;G<K.length;G++)V=K.charCodeAt(G),isUpper(V)&&C++,isLower(V)&&W++,isWhitespace(V)&&U++;return(C===0||W===0)&&U===0?K.length<=30:C<=5}function matchesCamelCase(K,C){if(!C||(C=C.trim(),C.length===0)||!isCamelCasePattern(K)||C.length>60)return null;const W=analyzeCamelCaseWord(C);if(!isCamelCaseWord(W)){if(!isUpperCaseWord(W))return null;C=C.toLowerCase()}let V=null,U=0;for(K=K.toLowerCase();U<C.length&&(V=_matchesCamelCase(K,C,0,U))===null;)U=nextAnchor(C,U+1);return V}function matchesWords(K,C,W=!1){if(!C||C.length===0)return null;let V=null,U=0;for(K=K.toLowerCase(),C=C.toLowerCase();U<C.length&&(V=_matchesWords(K,C,0,U,W))===null;)U=nextWord(C,U+1);return V}function _matchesWords(K,C,W,V,U){if(W===K.length)return[];if(V===C.length)return null;if(charactersMatch(K.charCodeAt(W),C.charCodeAt(V))){let G=null,Z=V+1;if(G=_matchesWords(K,C,W+1,V+1,U),!U)for(;!G&&(Z=nextWord(C,Z))<C.length;)G=_matchesWords(K,C,W+1,Z,U),Z++;return G?K.charCodeAt(W)!==C.charCodeAt(V)?G:join$2({start:V,end:V+1},G):null}else return null}function nextWord(K,C){for(let W=C;W<K.length;W++)if(isWordSeparator(K.charCodeAt(W))||W>0&&isWordSeparator(K.charCodeAt(W-1)))return W;return K.length}const fuzzyContiguousFilter=or$2(matchesPrefix,matchesCamelCase,matchesContiguousSubString),fuzzySeparateFilter=or$2(matchesPrefix,matchesCamelCase,matchesSubString),fuzzyRegExpCache=new LRUCache(1e4);function matchesFuzzy(K,C,W=!1){if(typeof K!="string"||typeof C!="string")return null;let V=fuzzyRegExpCache.get(K);V||(V=new RegExp(convertSimple2RegExpPattern(K),"i"),fuzzyRegExpCache.set(K,V));const U=V.exec(C);return U?[{start:U.index,end:U.index+U[0].length}]:W?fuzzySeparateFilter(K,C):fuzzyContiguousFilter(K,C)}function matchesFuzzy2(K,C){const W=fuzzyScore(K,K.toLowerCase(),0,C,C.toLowerCase(),0,{firstMatchCanBeWeak:!0,boostFullMatch:!0});return W?createMatches(W):null}function anyScore(K,C,W,V,U,G){const Z=Math.min(13,K.length);for(;W<Z;W++){const X=fuzzyScore(K,C,W,V,U,G,{firstMatchCanBeWeak:!0,boostFullMatch:!0});if(X)return X}return[0,G]}function createMatches(K){if(typeof K>"u")return[];const C=[],W=K[1];for(let V=K.length-1;V>1;V--){const U=K[V]+W,G=C[C.length-1];G&&G.end===U?G.end=U+1:C.push({start:U,end:U+1})}return C}const _maxLen=128;function initTable(){const K=[],C=[];for(let W=0;W<=_maxLen;W++)C[W]=0;for(let W=0;W<=_maxLen;W++)K.push(C.slice(0));return K}function initArr(K){const C=[];for(let W=0;W<=K;W++)C[W]=0;return C}const _minWordMatchPos=initArr(2*_maxLen),_maxWordMatchPos=initArr(2*_maxLen),_diag=initTable(),_table=initTable(),_arrows=initTable();function isSeparatorAtPos(K,C){if(C<0||C>=K.length)return!1;const W=K.codePointAt(C);switch(W){case 95:case 45:case 46:case 32:case 47:case 92:case 39:case 34:case 58:case 36:case 60:case 62:case 40:case 41:case 91:case 93:case 123:case 125:return!0;case void 0:return!1;default:return!!isEmojiImprecise(W)}}function isWhitespaceAtPos(K,C){if(C<0||C>=K.length)return!1;switch(K.charCodeAt(C)){case 32:case 9:return!0;default:return!1}}function isUpperCaseAtPos(K,C,W){return C[K]!==W[K]}function isPatternInWord(K,C,W,V,U,G,Z=!1){for(;C<W&&U<G;)K[C]===V[U]&&(Z&&(_minWordMatchPos[C]=U),C+=1),U+=1;return C===W}var FuzzyScore;(function(K){K.Default=[-100,0];function C(W){return!W||W.length===2&&W[0]===-100&&W[1]===0}K.isDefault=C})(FuzzyScore||(FuzzyScore={}));class FuzzyScoreOptions{constructor(C,W){this.firstMatchCanBeWeak=C,this.boostFullMatch=W}}FuzzyScoreOptions.default={boostFullMatch:!0,firstMatchCanBeWeak:!1};function fuzzyScore(K,C,W,V,U,G,Z=FuzzyScoreOptions.default){const X=K.length>_maxLen?_maxLen:K.length,Q=V.length>_maxLen?_maxLen:V.length;if(W>=X||G>=Q||X-W>Q-G||!isPatternInWord(C,W,X,U,G,Q,!0))return;_fillInMaxWordMatchPos(X,Q,W,G,C,U);let J=1,ee=1,te=W,ie=G;const ne=[!1];for(J=1,te=W;te<X;J++,te++){const le=_minWordMatchPos[te],ce=_maxWordMatchPos[te],de=te+1<X?_maxWordMatchPos[te+1]:Q;for(ee=le-G+1,ie=le;ie<de;ee++,ie++){let ue=Number.MIN_SAFE_INTEGER,ge=!1;ie<=ce&&(ue=_doScore(K,C,te,W,V,U,ie,Q,G,_diag[J-1][ee-1]===0,ne));let he=0;ue!==Number.MAX_SAFE_INTEGER&&(ge=!0,he=ue+_table[J-1][ee-1]);const fe=ie>le,pe=fe?_table[J][ee-1]+(_diag[J][ee-1]>0?-5:0):0,Se=ie>le+1&&_diag[J][ee-1]>0,Le=Se?_table[J][ee-2]+(_diag[J][ee-2]>0?-5:0):0;if(Se&&(!fe||Le>=pe)&&(!ge||Le>=he))_table[J][ee]=Le,_arrows[J][ee]=3,_diag[J][ee]=0;else if(fe&&(!ge||pe>=he))_table[J][ee]=pe,_arrows[J][ee]=2,_diag[J][ee]=0;else if(ge)_table[J][ee]=he,_arrows[J][ee]=1,_diag[J][ee]=_diag[J-1][ee-1]+1;else throw new Error("not possible")}}if(!ne[0]&&!Z.firstMatchCanBeWeak)return;J--,ee--;const oe=[_table[J][ee],G];let re=0,ae=0;for(;J>=1;){let le=ee;do{const ce=_arrows[J][le];if(ce===3)le=le-2;else if(ce===2)le=le-1;else break}while(le>=1);re>1&&C[W+J-1]===U[G+ee-1]&&!isUpperCaseAtPos(le+G-1,V,U)&&re+1>_diag[J][le]&&(le=ee),le===ee?re++:re=1,ae||(ae=le),J--,ee=le-1,oe.push(ee)}Q===X&&Z.boostFullMatch&&(oe[0]+=2);const se=ae-X;return oe[0]-=se,oe}function _fillInMaxWordMatchPos(K,C,W,V,U,G){let Z=K-1,X=C-1;for(;Z>=W&&X>=V;)U[Z]===G[X]&&(_maxWordMatchPos[Z]=X,Z--),X--}function _doScore(K,C,W,V,U,G,Z,X,Q,J,ee){if(C[W]!==G[Z])return Number.MIN_SAFE_INTEGER;let te=1,ie=!1;return Z===W-V?te=K[W]===U[Z]?7:5:isUpperCaseAtPos(Z,U,G)&&(Z===0||!isUpperCaseAtPos(Z-1,U,G))?(te=K[W]===U[Z]?7:5,ie=!0):isSeparatorAtPos(G,Z)&&(Z===0||!isSeparatorAtPos(G,Z-1))?te=5:(isSeparatorAtPos(G,Z-1)||isWhitespaceAtPos(G,Z-1))&&(te=5,ie=!0),te>1&&W===V&&(ee[0]=!0),ie||(ie=isUpperCaseAtPos(Z,U,G)||isSeparatorAtPos(G,Z-1)||isWhitespaceAtPos(G,Z-1)),W===V?Z>Q&&(te-=ie?3:5):J?te+=ie?2:0:te+=ie?0:1,Z+1===X&&(te-=ie?3:5),te}function fuzzyScoreGracefulAggressive(K,C,W,V,U,G,Z){return fuzzyScoreWithPermutations(K,C,W,V,U,G,!0,Z)}function fuzzyScoreWithPermutations(K,C,W,V,U,G,Z,X){let Q=fuzzyScore(K,C,W,V,U,G,X);if(Q&&!Z)return Q;if(K.length>=3){const J=Math.min(7,K.length-1);for(let ee=W+1;ee<J;ee++){const te=nextTypoPermutation(K,ee);if(te){const ie=fuzzyScore(te,te.toLowerCase(),W,V,U,G,X);ie&&(ie[0]-=3,(!Q||ie[0]>Q[0])&&(Q=ie))}}}return Q}function nextTypoPermutation(K,C){if(C+1>=K.length)return;const W=K[C],V=K[C+1];if(W!==V)return K.slice(0,C)+V+W+K.slice(C+2)}const iconStartMarker="$(",iconsRegex=new RegExp(`\\$\\(${ThemeIcon.iconNameExpression}(?:${ThemeIcon.iconModifierExpression})?\\)`,"g"),escapeIconsRegex=new RegExp(`(\\\\)?${iconsRegex.source}`,"g");function escapeIcons(K){return K.replace(escapeIconsRegex,(C,W)=>W?C:`\\${C}`)}const markdownEscapedIconsRegex=new RegExp(`\\\\${iconsRegex.source}`,"g");function markdownEscapeEscapedIcons(K){return K.replace(markdownEscapedIconsRegex,C=>`\\${C}`)}const stripIconsRegex=new RegExp(`(\\s)?(\\\\)?${iconsRegex.source}(\\s)?`,"g");function stripIcons(K){return K.indexOf(iconStartMarker)===-1?K:K.replace(stripIconsRegex,(C,W,V,U)=>V?C:W||U||"")}function getCodiconAriaLabel(K){return K?K.replace(/\$\((.*?)\)/g,(C,W)=>` ${W} `).trim():""}const _parseIconsRegex=new RegExp(`\\$\\(${ThemeIcon.iconNameCharacter}+\\)`,"g");function parseLabelWithIcons(K){_parseIconsRegex.lastIndex=0;let C="";const W=[];let V=0;for(;;){const U=_parseIconsRegex.lastIndex,G=_parseIconsRegex.exec(K),Z=K.substring(U,G==null?void 0:G.index);if(Z.length>0){C+=Z;for(let X=0;X<Z.length;X++)W.push(V)}if(!G)break;V+=G[0].length}return{text:C,iconOffsets:W}}function matchesFuzzyIconAware(K,C,W=!1){const{text:V,iconOffsets:U}=C;if(!U||U.length===0)return matchesFuzzy(K,V,W);const G=ltrim(V," "),Z=V.length-G.length,X=matchesFuzzy(K,G,W);if(X)for(const Q of X){const J=U[Q.start+Z]+Z;Q.start+=J,Q.end+=J}return X}class MarkdownString{constructor(C="",W=!1){var V,U,G;if(this.value=C,typeof this.value!="string")throw illegalArgument("value");typeof W=="boolean"?(this.isTrusted=W,this.supportThemeIcons=!1,this.supportHtml=!1):(this.isTrusted=(V=W.isTrusted)!==null&&V!==void 0?V:void 0,this.supportThemeIcons=(U=W.supportThemeIcons)!==null&&U!==void 0?U:!1,this.supportHtml=(G=W.supportHtml)!==null&&G!==void 0?G:!1)}appendText(C,W=0){return this.value+=escapeMarkdownSyntaxTokens(this.supportThemeIcons?escapeIcons(C):C).replace(/([ \t]+)/g,(V,U)=>"&nbsp;".repeat(U.length)).replace(/\>/gm,"\\>").replace(/\n/g,W===1?`\\
`:`

`),this}appendMarkdown(C){return this.value+=C,this}appendCodeblock(C,W){return this.value+="\n```",this.value+=C,this.value+=`
`,this.value+=W,this.value+="\n```\n",this}appendLink(C,W,V){return this.value+="[",this.value+=this._escape(W,"]"),this.value+="](",this.value+=this._escape(String(C),")"),V&&(this.value+=` "${this._escape(this._escape(V,'"'),")")}"`),this.value+=")",this}_escape(C,W){const V=new RegExp(escapeRegExpCharacters(W),"g");return C.replace(V,(U,G)=>C.charAt(G-1)!=="\\"?`\\${U}`:U)}}function isEmptyMarkdownString(K){return isMarkdownString(K)?!K.value:Array.isArray(K)?K.every(isEmptyMarkdownString):!0}function isMarkdownString(K){return K instanceof MarkdownString?!0:K&&typeof K=="object"?typeof K.value=="string"&&(typeof K.isTrusted=="boolean"||typeof K.isTrusted=="object"||K.isTrusted===void 0)&&(typeof K.supportThemeIcons=="boolean"||K.supportThemeIcons===void 0):!1}function markdownStringEqual(K,C){return K===C?!0:!K||!C?!1:K.value===C.value&&K.isTrusted===C.isTrusted&&K.supportThemeIcons===C.supportThemeIcons&&K.supportHtml===C.supportHtml&&(K.baseUri===C.baseUri||!!K.baseUri&&!!C.baseUri&&isEqual(URI.from(K.baseUri),URI.from(C.baseUri)))}function escapeMarkdownSyntaxTokens(K){return K.replace(/[\\`*_{}[\]()#+\-!~]/g,"\\$&")}function escapeDoubleQuotes(K){return K.replace(/"/g,"&quot;")}function removeMarkdownEscapes(K){return K&&K.replace(/\\([\\`*_{}[\]()#+\-.!~])/g,"$1")}function parseHrefAndDimensions(K){const C=[],W=K.split("|").map(U=>U.trim());K=W[0];const V=W[1];if(V){const U=/height=(\d+)/.exec(V),G=/width=(\d+)/.exec(V),Z=U?U[1]:"",X=G?G[1]:"",Q=isFinite(parseInt(X)),J=isFinite(parseInt(Z));Q&&C.push(`width="${X}"`),J&&C.push(`height="${Z}"`)}return{href:K,dimensions:C}}var __awaiter$1p=globalThis&&globalThis.__awaiter||function(K,C,W,V){function U(G){return G instanceof W?G:new W(function(Z){Z(G)})}return new(W||(W=Promise))(function(G,Z){function X(ee){try{J(V.next(ee))}catch(te){Z(te)}}function Q(ee){try{J(V.throw(ee))}catch(te){Z(te)}}function J(ee){ee.done?G(ee.value):U(ee.value).then(X,Q)}J((V=V.apply(K,C||[])).next())})};function setupNativeHover(K,C){isString$3(C)?K.title=stripIcons(C):C!=null&&C.markdownNotSupportedFallback?K.title=C.markdownNotSupportedFallback:K.removeAttribute("title")}class UpdatableHoverWidget{constructor(C,W,V){this.hoverDelegate=C,this.target=W,this.fadeInAnimation=V}update(C,W,V){var U;return __awaiter$1p(this,void 0,void 0,function*(){if(this._cancellationTokenSource&&(this._cancellationTokenSource.dispose(!0),this._cancellationTokenSource=void 0),this.isDisposed)return;let G;if(C===void 0||isString$3(C)||C instanceof HTMLElement)G=C;else if(!isFunction$2(C.markdown))G=(U=C.markdown)!==null&&U!==void 0?U:C.markdownNotSupportedFallback;else{this._hoverWidget||this.show(localize("iconLabel.loading","Loading..."),W),this._cancellationTokenSource=new CancellationTokenSource$1;const Z=this._cancellationTokenSource.token;if(G=yield C.markdown(Z),G===void 0&&(G=C.markdownNotSupportedFallback),this.isDisposed||Z.isCancellationRequested)return}this.show(G,W,V)})}show(C,W,V){const U=this._hoverWidget;if(this.hasContent(C)){const G=Object.assign({content:C,target:this.target,showPointer:this.hoverDelegate.placement==="element",hoverPosition:2,skipFadeInAnimation:!this.fadeInAnimation||!!U},V);this._hoverWidget=this.hoverDelegate.showHover(G,W)}U==null||U.dispose()}hasContent(C){return C?isMarkdownString(C)?!!C.value:!0:!1}get isDisposed(){var C;return(C=this._hoverWidget)===null||C===void 0?void 0:C.isDisposed}dispose(){var C,W;(C=this._hoverWidget)===null||C===void 0||C.dispose(),(W=this._cancellationTokenSource)===null||W===void 0||W.dispose(!0),this._cancellationTokenSource=void 0}}function setupCustomHover(K,C,W,V){let U,G;const Z=(te,ie)=>{var ne;const oe=G!==void 0;te&&(G==null||G.dispose(),G=void 0),ie&&(U==null||U.dispose(),U=void 0),oe&&((ne=K.onDidHideHover)===null||ne===void 0||ne.call(K))},X=(te,ie,ne)=>new TimeoutTimer(()=>__awaiter$1p(this,void 0,void 0,function*(){(!G||G.isDisposed)&&(G=new UpdatableHoverWidget(K,ne||C,te>0),yield G.update(W,ie,V))}),te),Q=()=>{if(U)return;const te=new DisposableStore,ie=re=>Z(!1,re.fromElement===C);te.add(addDisposableListener(C,EventType$1.MOUSE_LEAVE,ie,!0));const ne=()=>Z(!0,!0);te.add(addDisposableListener(C,EventType$1.MOUSE_DOWN,ne,!0));const oe={targetElements:[C],dispose:()=>{}};if(K.placement===void 0||K.placement==="mouse"){const re=ae=>{oe.x=ae.x+10,ae.target instanceof HTMLElement&&ae.target.classList.contains("action-label")&&Z(!0,!0)};te.add(addDisposableListener(C,EventType$1.MOUSE_MOVE,re,!0))}te.add(X(K.delay,!1,oe)),U=te},J=addDisposableListener(C,EventType$1.MOUSE_OVER,Q,!0);return{show:te=>{Z(!1,!0),X(0,te)},hide:()=>{Z(!0,!0)},update:(te,ie)=>__awaiter$1p(this,void 0,void 0,function*(){W=te,yield G==null?void 0:G.update(W,void 0,ie)}),dispose:()=>{J.dispose(),Z(!0,!0)}}}function renderText(K,C={}){const W=createElement(C);return W.textContent=K,W}function renderFormattedText(K,C={}){const W=createElement(C);return _renderFormattedText(W,parseFormattedText(K,!!C.renderCodeSegments),C.actionHandler,C.renderCodeSegments),W}function createElement(K){const C=K.inline?"span":"div",W=document.createElement(C);return K.className&&(W.className=K.className),W}class StringStream{constructor(C){this.source=C,this.index=0}eos(){return this.index>=this.source.length}next(){const C=this.peek();return this.advance(),C}peek(){return this.source[this.index]}advance(){this.index++}}function _renderFormattedText(K,C,W,V){let U;if(C.type===2)U=document.createTextNode(C.content||"");else if(C.type===3)U=document.createElement("b");else if(C.type===4)U=document.createElement("i");else if(C.type===7&&V)U=document.createElement("code");else if(C.type===5&&W){const G=document.createElement("a");W.disposables.add(addStandardDisposableListener(G,"click",Z=>{W.callback(String(C.index),Z)})),U=G}else C.type===8?U=document.createElement("br"):C.type===1&&(U=K);U&&K!==U&&K.appendChild(U),U&&Array.isArray(C.children)&&C.children.forEach(G=>{_renderFormattedText(U,G,W,V)})}function parseFormattedText(K,C){const W={type:1,children:[]};let V=0,U=W;const G=[],Z=new StringStream(K);for(;!Z.eos();){let X=Z.next();const Q=X==="\\"&&formatTagType(Z.peek(),C)!==0;if(Q&&(X=Z.next()),!Q&&isFormatTag(X,C)&&X===Z.peek()){Z.advance(),U.type===2&&(U=G.pop());const J=formatTagType(X,C);if(U.type===J||U.type===5&&J===6)U=G.pop();else{const ee={type:J,children:[]};J===5&&(ee.index=V,V++),U.children.push(ee),G.push(U),U=ee}}else if(X===`
`)U.type===2&&(U=G.pop()),U.children.push({type:8});else if(U.type!==2){const J={type:2,content:X};U.children.push(J),G.push(U),U=J}else U.content+=X}return U.type===2&&(U=G.pop()),W}function isFormatTag(K,C){return formatTagType(K,C)!==0}function formatTagType(K,C){switch(K){case"*":return 3;case"_":return 4;case"[":return 5;case"]":return 6;case"`":return C?7:0;default:return 0}}const labelWithIconsRegex=new RegExp(`(\\\\)?\\$\\((${ThemeIcon.iconNameExpression}(?:${ThemeIcon.iconModifierExpression})?)\\)`,"g");function renderLabelWithIcons(K){const C=new Array;let W,V=0,U=0;for(;(W=labelWithIconsRegex.exec(K))!==null;){U=W.index||0,V<U&&C.push(K.substring(V,U)),V=(W.index||0)+W[0].length;const[,G,Z]=W;C.push(G?`$(${Z})`:renderIcon({id:Z}))}return V<K.length&&C.push(K.substring(V)),C}function renderIcon(K){const C=$$d("span");return C.classList.add(...ThemeIcon.asClassNameArray(K)),C}class IdGenerator{constructor(C){this._prefix=C,this._lastId=0}nextId(){return this._prefix+ ++this._lastId}}const defaultGenerator=new IdGenerator("id#");let __marked_exports={};(function(){function K(C,W){W(__marked_exports)}K.amd=!0,function(C,W){typeof K=="function"&&K.amd?K(["exports"],W):typeof exports=="object"&&typeof module<"u"?W(exports):(C=typeof globalThis<"u"?globalThis:C||self,W(C.marked={}))}(this,function(C){function W(Te,Ie){for(var Ee=0;Ee<Ie.length;Ee++){var me=Ie[Ee];me.enumerable=me.enumerable||!1,me.configurable=!0,"value"in me&&(me.writable=!0),Object.defineProperty(Te,me.key,me)}}function V(Te,Ie,Ee){return Ie&&W(Te.prototype,Ie),Ee&&W(Te,Ee),Object.defineProperty(Te,"prototype",{writable:!1}),Te}function U(Te,Ie){if(Te){if(typeof Te=="string")return G(Te,Ie);var Ee=Object.prototype.toString.call(Te).slice(8,-1);if(Ee==="Object"&&Te.constructor&&(Ee=Te.constructor.name),Ee==="Map"||Ee==="Set")return Array.from(Te);if(Ee==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(Ee))return G(Te,Ie)}}function G(Te,Ie){(Ie==null||Ie>Te.length)&&(Ie=Te.length);for(var Ee=0,me=new Array(Ie);Ee<Ie;Ee++)me[Ee]=Te[Ee];return me}function Z(Te,Ie){var Ee=typeof Symbol<"u"&&Te[Symbol.iterator]||Te["@@iterator"];if(Ee)return(Ee=Ee.call(Te)).next.bind(Ee);if(Array.isArray(Te)||(Ee=U(Te))||Ie&&Te&&typeof Te.length=="number"){Ee&&(Te=Ee);var me=0;return function(){return me>=Te.length?{done:!0}:{done:!1,value:Te[me++]}}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function X(){return{async:!1,baseUrl:null,breaks:!1,extensions:null,gfm:!0,headerIds:!0,headerPrefix:"",highlight:null,langPrefix:"language-",mangle:!0,pedantic:!1,renderer:null,sanitize:!1,sanitizer:null,silent:!1,smartLists:!1,smartypants:!1,tokenizer:null,walkTokens:null,xhtml:!1}}C.defaults=X();function Q(Te){C.defaults=Te}var J=/[&<>"']/,ee=/[&<>"']/g,te=/[<>"']|&(?!#?\w+;)/,ie=/[<>"']|&(?!#?\w+;)/g,ne={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},oe=function(Ie){return ne[Ie]};function re(Te,Ie){if(Ie){if(J.test(Te))return Te.replace(ee,oe)}else if(te.test(Te))return Te.replace(ie,oe);return Te}var ae=/&(#(?:\d+)|(?:#x[0-9A-Fa-f]+)|(?:\w+));?/ig;function se(Te){return Te.replace(ae,function(Ie,Ee){return Ee=Ee.toLowerCase(),Ee==="colon"?":":Ee.charAt(0)==="#"?Ee.charAt(1)==="x"?String.fromCharCode(parseInt(Ee.substring(2),16)):String.fromCharCode(+Ee.substring(1)):""})}var le=/(^|[^\[])\^/g;function ce(Te,Ie){Te=typeof Te=="string"?Te:Te.source,Ie=Ie||"";var Ee={replace:function(ve,we){return we=we.source||we,we=we.replace(le,"$1"),Te=Te.replace(ve,we),Ee},getRegex:function(){return new RegExp(Te,Ie)}};return Ee}var de=/[^\w:]/g,ue=/^$|^[a-z][a-z0-9+.-]*:|^[?#]/i;function ge(Te,Ie,Ee){if(Te){var me;try{me=decodeURIComponent(se(Ee)).replace(de,"").toLowerCase()}catch{return null}if(me.indexOf("javascript:")===0||me.indexOf("vbscript:")===0||me.indexOf("data:")===0)return null}Ie&&!ue.test(Ee)&&(Ee=Le(Ie,Ee));try{Ee=encodeURI(Ee).replace(/%25/g,"%")}catch{return null}return Ee}var he={},fe=/^[^:]+:\/*[^/]*$/,pe=/^([^:]+:)[\s\S]*$/,Se=/^([^:]+:\/*[^/]*)[\s\S]*$/;function Le(Te,Ie){he[" "+Te]||(fe.test(Te)?he[" "+Te]=Te+"/":he[" "+Te]=ke(Te,"/",!0)),Te=he[" "+Te];var Ee=Te.indexOf(":")===-1;return Ie.substring(0,2)==="//"?Ee?Ie:Te.replace(pe,"$1")+Ie:Ie.charAt(0)==="/"?Ee?Ie:Te.replace(Se,"$1")+Ie:Te+Ie}var be={exec:function(){}};function Ce(Te){for(var Ie=1,Ee,me;Ie<arguments.length;Ie++){Ee=arguments[Ie];for(me in Ee)Object.prototype.hasOwnProperty.call(Ee,me)&&(Te[me]=Ee[me])}return Te}function De(Te,Ie){var Ee=Te.replace(/\|/g,function(we,ye,Ne){for(var Re=!1,We=ye;--We>=0&&Ne[We]==="\\";)Re=!Re;return Re?"|":" |"}),me=Ee.split(/ \|/),ve=0;if(me[0].trim()||me.shift(),me.length>0&&!me[me.length-1].trim()&&me.pop(),me.length>Ie)me.splice(Ie);else for(;me.length<Ie;)me.push("");for(;ve<me.length;ve++)me[ve]=me[ve].trim().replace(/\\\|/g,"|");return me}function ke(Te,Ie,Ee){var me=Te.length;if(me===0)return"";for(var ve=0;ve<me;){var we=Te.charAt(me-ve-1);if(we===Ie&&!Ee)ve++;else if(we!==Ie&&Ee)ve++;else break}return Te.slice(0,me-ve)}function Me(Te,Ie){if(Te.indexOf(Ie[1])===-1)return-1;for(var Ee=Te.length,me=0,ve=0;ve<Ee;ve++)if(Te[ve]==="\\")ve++;else if(Te[ve]===Ie[0])me++;else if(Te[ve]===Ie[1]&&(me--,me<0))return ve;return-1}function Oe(Te){Te&&Te.sanitize&&!Te.silent&&console.warn("marked(): sanitize and sanitizer parameters are deprecated since version 0.7.0, should not be used and will be removed in the future. Read more here: https://marked.js.org/#/USING_ADVANCED.md#options")}function Be(Te,Ie){if(Ie<1)return"";for(var Ee="";Ie>1;)Ie&1&&(Ee+=Te),Ie>>=1,Te+=Te;return Ee+Te}function Pe(Te,Ie,Ee,me){var ve=Ie.href,we=Ie.title?re(Ie.title):null,ye=Te[1].replace(/\\([\[\]])/g,"$1");if(Te[0].charAt(0)!=="!"){me.state.inLink=!0;var Ne={type:"link",raw:Ee,href:ve,title:we,text:ye,tokens:me.inlineTokens(ye)};return me.state.inLink=!1,Ne}return{type:"image",raw:Ee,href:ve,title:we,text:re(ye)}}function Ue(Te,Ie){var Ee=Te.match(/^(\s+)(?:```)/);if(Ee===null)return Ie;var me=Ee[1];return Ie.split(`
`).map(function(ve){var we=ve.match(/^\s+/);if(we===null)return ve;var ye=we[0];return ye.length>=me.length?ve.slice(me.length):ve}).join(`
`)}var ze=function(){function Te(Ee){this.options=Ee||C.defaults}var Ie=Te.prototype;return Ie.space=function(me){var ve=this.rules.block.newline.exec(me);if(ve&&ve[0].length>0)return{type:"space",raw:ve[0]}},Ie.code=function(me){var ve=this.rules.block.code.exec(me);if(ve){var we=ve[0].replace(/^ {1,4}/gm,"");return{type:"code",raw:ve[0],codeBlockStyle:"indented",text:this.options.pedantic?we:ke(we,`
`)}}},Ie.fences=function(me){var ve=this.rules.block.fences.exec(me);if(ve){var we=ve[0],ye=Ue(we,ve[3]||"");return{type:"code",raw:we,lang:ve[2]?ve[2].trim():ve[2],text:ye}}},Ie.heading=function(me){var ve=this.rules.block.heading.exec(me);if(ve){var we=ve[2].trim();if(/#$/.test(we)){var ye=ke(we,"#");(this.options.pedantic||!ye||/ $/.test(ye))&&(we=ye.trim())}return{type:"heading",raw:ve[0],depth:ve[1].length,text:we,tokens:this.lexer.inline(we)}}},Ie.hr=function(me){var ve=this.rules.block.hr.exec(me);if(ve)return{type:"hr",raw:ve[0]}},Ie.blockquote=function(me){var ve=this.rules.block.blockquote.exec(me);if(ve){var we=ve[0].replace(/^ *>[ \t]?/gm,"");return{type:"blockquote",raw:ve[0],tokens:this.lexer.blockTokens(we,[]),text:we}}},Ie.list=function(me){var ve=this.rules.block.list.exec(me);if(ve){var we,ye,Ne,Re,We,He,qe,Ge,Je,Ye,Ke,tt,it=ve[1].trim(),bt=it.length>1,Qe={type:"list",raw:"",ordered:bt,start:bt?+it.slice(0,-1):"",loose:!1,items:[]};it=bt?"\\d{1,9}\\"+it.slice(-1):"\\"+it,this.options.pedantic&&(it=bt?it:"[*+-]");for(var st=new RegExp("^( {0,3}"+it+")((?:[	 ][^\\n]*)?(?:\\n|$))");me&&(tt=!1,!(!(ve=st.exec(me))||this.rules.block.hr.test(me)));){if(we=ve[0],me=me.substring(we.length),Ge=ve[2].split(`
`,1)[0],Je=me.split(`
`,1)[0],this.options.pedantic?(Re=2,Ke=Ge.trimLeft()):(Re=ve[2].search(/[^ ]/),Re=Re>4?1:Re,Ke=Ge.slice(Re),Re+=ve[1].length),He=!1,!Ge&&/^ *$/.test(Je)&&(we+=Je+`
`,me=me.substring(Je.length+1),tt=!0),!tt)for(var Nt=new RegExp("^ {0,"+Math.min(3,Re-1)+"}(?:[*+-]|\\d{1,9}[.)])((?: [^\\n]*)?(?:\\n|$))"),At=new RegExp("^ {0,"+Math.min(3,Re-1)+"}((?:- *){3,}|(?:_ *){3,}|(?:\\* *){3,})(?:\\n+|$)"),Et=new RegExp("^ {0,"+Math.min(3,Re-1)+"}(?:```|~~~)"),kt=new RegExp("^ {0,"+Math.min(3,Re-1)+"}#");me&&(Ye=me.split(`
`,1)[0],Ge=Ye,this.options.pedantic&&(Ge=Ge.replace(/^ {1,4}(?=( {4})*[^ ])/g,"  ")),!(Et.test(Ge)||kt.test(Ge)||Nt.test(Ge)||At.test(me)));){if(Ge.search(/[^ ]/)>=Re||!Ge.trim())Ke+=`
`+Ge.slice(Re);else if(!He)Ke+=`
`+Ge;else break;!He&&!Ge.trim()&&(He=!0),we+=Ye+`
`,me=me.substring(Ye.length+1)}Qe.loose||(qe?Qe.loose=!0:/\n *\n *$/.test(we)&&(qe=!0)),this.options.gfm&&(ye=/^\[[ xX]\] /.exec(Ke),ye&&(Ne=ye[0]!=="[ ] ",Ke=Ke.replace(/^\[[ xX]\] +/,""))),Qe.items.push({type:"list_item",raw:we,task:!!ye,checked:Ne,loose:!1,text:Ke}),Qe.raw+=we}Qe.items[Qe.items.length-1].raw=we.trimRight(),Qe.items[Qe.items.length-1].text=Ke.trimRight(),Qe.raw=Qe.raw.trimRight();var Rt=Qe.items.length;for(We=0;We<Rt;We++){this.lexer.state.top=!1,Qe.items[We].tokens=this.lexer.blockTokens(Qe.items[We].text,[]);var Mt=Qe.items[We].tokens.filter(function(Pt){return Pt.type==="space"}),Ft=Mt.every(function(Pt){for(var Gt=Pt.raw.split(""),It=0,Bt=Z(Gt),Wt;!(Wt=Bt()).done;){var Ut=Wt.value;if(Ut===`
`&&(It+=1),It>1)return!0}return!1});!Qe.loose&&Mt.length&&Ft&&(Qe.loose=!0,Qe.items[We].loose=!0)}return Qe}},Ie.html=function(me){var ve=this.rules.block.html.exec(me);if(ve){var we={type:"html",raw:ve[0],pre:!this.options.sanitizer&&(ve[1]==="pre"||ve[1]==="script"||ve[1]==="style"),text:ve[0]};if(this.options.sanitize){var ye=this.options.sanitizer?this.options.sanitizer(ve[0]):re(ve[0]);we.type="paragraph",we.text=ye,we.tokens=this.lexer.inline(ye)}return we}},Ie.def=function(me){var ve=this.rules.block.def.exec(me);if(ve){ve[3]&&(ve[3]=ve[3].substring(1,ve[3].length-1));var we=ve[1].toLowerCase().replace(/\s+/g," ");return{type:"def",tag:we,raw:ve[0],href:ve[2],title:ve[3]}}},Ie.table=function(me){var ve=this.rules.block.table.exec(me);if(ve){var we={type:"table",header:De(ve[1]).map(function(qe){return{text:qe}}),align:ve[2].replace(/^ *|\| *$/g,"").split(/ *\| */),rows:ve[3]&&ve[3].trim()?ve[3].replace(/\n[ \t]*$/,"").split(`
`):[]};if(we.header.length===we.align.length){we.raw=ve[0];var ye=we.align.length,Ne,Re,We,He;for(Ne=0;Ne<ye;Ne++)/^ *-+: *$/.test(we.align[Ne])?we.align[Ne]="right":/^ *:-+: *$/.test(we.align[Ne])?we.align[Ne]="center":/^ *:-+ *$/.test(we.align[Ne])?we.align[Ne]="left":we.align[Ne]=null;for(ye=we.rows.length,Ne=0;Ne<ye;Ne++)we.rows[Ne]=De(we.rows[Ne],we.header.length).map(function(qe){return{text:qe}});for(ye=we.header.length,Re=0;Re<ye;Re++)we.header[Re].tokens=this.lexer.inline(we.header[Re].text);for(ye=we.rows.length,Re=0;Re<ye;Re++)for(He=we.rows[Re],We=0;We<He.length;We++)He[We].tokens=this.lexer.inline(He[We].text);return we}}},Ie.lheading=function(me){var ve=this.rules.block.lheading.exec(me);if(ve)return{type:"heading",raw:ve[0],depth:ve[2].charAt(0)==="="?1:2,text:ve[1],tokens:this.lexer.inline(ve[1])}},Ie.paragraph=function(me){var ve=this.rules.block.paragraph.exec(me);if(ve){var we=ve[1].charAt(ve[1].length-1)===`
`?ve[1].slice(0,-1):ve[1];return{type:"paragraph",raw:ve[0],text:we,tokens:this.lexer.inline(we)}}},Ie.text=function(me){var ve=this.rules.block.text.exec(me);if(ve)return{type:"text",raw:ve[0],text:ve[0],tokens:this.lexer.inline(ve[0])}},Ie.escape=function(me){var ve=this.rules.inline.escape.exec(me);if(ve)return{type:"escape",raw:ve[0],text:re(ve[1])}},Ie.tag=function(me){var ve=this.rules.inline.tag.exec(me);if(ve)return!this.lexer.state.inLink&&/^<a /i.test(ve[0])?this.lexer.state.inLink=!0:this.lexer.state.inLink&&/^<\/a>/i.test(ve[0])&&(this.lexer.state.inLink=!1),!this.lexer.state.inRawBlock&&/^<(pre|code|kbd|script)(\s|>)/i.test(ve[0])?this.lexer.state.inRawBlock=!0:this.lexer.state.inRawBlock&&/^<\/(pre|code|kbd|script)(\s|>)/i.test(ve[0])&&(this.lexer.state.inRawBlock=!1),{type:this.options.sanitize?"text":"html",raw:ve[0],inLink:this.lexer.state.inLink,inRawBlock:this.lexer.state.inRawBlock,text:this.options.sanitize?this.options.sanitizer?this.options.sanitizer(ve[0]):re(ve[0]):ve[0]}},Ie.link=function(me){var ve=this.rules.inline.link.exec(me);if(ve){var we=ve[2].trim();if(!this.options.pedantic&&/^</.test(we)){if(!/>$/.test(we))return;var ye=ke(we.slice(0,-1),"\\");if((we.length-ye.length)%2===0)return}else{var Ne=Me(ve[2],"()");if(Ne>-1){var Re=ve[0].indexOf("!")===0?5:4,We=Re+ve[1].length+Ne;ve[2]=ve[2].substring(0,Ne),ve[0]=ve[0].substring(0,We).trim(),ve[3]=""}}var He=ve[2],qe="";if(this.options.pedantic){var Ge=/^([^'"]*[^\s])\s+(['"])(.*)\2/.exec(He);Ge&&(He=Ge[1],qe=Ge[3])}else qe=ve[3]?ve[3].slice(1,-1):"";return He=He.trim(),/^</.test(He)&&(this.options.pedantic&&!/>$/.test(we)?He=He.slice(1):He=He.slice(1,-1)),Pe(ve,{href:He&&He.replace(this.rules.inline._escapes,"$1"),title:qe&&qe.replace(this.rules.inline._escapes,"$1")},ve[0],this.lexer)}},Ie.reflink=function(me,ve){var we;if((we=this.rules.inline.reflink.exec(me))||(we=this.rules.inline.nolink.exec(me))){var ye=(we[2]||we[1]).replace(/\s+/g," ");if(ye=ve[ye.toLowerCase()],!ye||!ye.href){var Ne=we[0].charAt(0);return{type:"text",raw:Ne,text:Ne}}return Pe(we,ye,we[0],this.lexer)}},Ie.emStrong=function(me,ve,we){we===void 0&&(we="");var ye=this.rules.inline.emStrong.lDelim.exec(me);if(ye&&!(ye[3]&&we.match(/(?:[0-9A-Za-z\xAA\xB2\xB3\xB5\xB9\xBA\xBC-\xBE\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u052F\u0531-\u0556\u0559\u0560-\u0588\u05D0-\u05EA\u05EF-\u05F2\u0620-\u064A\u0660-\u0669\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07C0-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u0860-\u086A\u0870-\u0887\u0889-\u088E\u08A0-\u08C9\u0904-\u0939\u093D\u0950\u0958-\u0961\u0966-\u096F\u0971-\u0980\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09E6-\u09F1\u09F4-\u09F9\u09FC\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A66-\u0A6F\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0AE6-\u0AEF\u0AF9\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B66-\u0B6F\u0B71-\u0B77\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0BE6-\u0BF2\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C58-\u0C5A\u0C5D\u0C60\u0C61\u0C66-\u0C6F\u0C78-\u0C7E\u0C80\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDD\u0CDE\u0CE0\u0CE1\u0CE6-\u0CEF\u0CF1\u0CF2\u0D04-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D54-\u0D56\u0D58-\u0D61\u0D66-\u0D78\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0DE6-\u0DEF\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E50-\u0E59\u0E81\u0E82\u0E84\u0E86-\u0E8A\u0E8C-\u0EA3\u0EA5\u0EA7-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0ED0-\u0ED9\u0EDC-\u0EDF\u0F00\u0F20-\u0F33\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F-\u1049\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u1090-\u1099\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1369-\u137C\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u1711\u171F-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u17E0-\u17E9\u17F0-\u17F9\u1810-\u1819\u1820-\u1878\u1880-\u1884\u1887-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1946-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u19D0-\u19DA\u1A00-\u1A16\u1A20-\u1A54\u1A80-\u1A89\u1A90-\u1A99\u1AA7\u1B05-\u1B33\u1B45-\u1B4C\u1B50-\u1B59\u1B83-\u1BA0\u1BAE-\u1BE5\u1C00-\u1C23\u1C40-\u1C49\u1C4D-\u1C7D\u1C80-\u1C88\u1C90-\u1CBA\u1CBD-\u1CBF\u1CE9-\u1CEC\u1CEE-\u1CF3\u1CF5\u1CF6\u1CFA\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2070\u2071\u2074-\u2079\u207F-\u2089\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2150-\u2189\u2460-\u249B\u24EA-\u24FF\u2776-\u2793\u2C00-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2CFD\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2E2F\u3005-\u3007\u3021-\u3029\u3031-\u3035\u3038-\u303C\u3041-\u3096\u309D-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312F\u3131-\u318E\u3192-\u3195\u31A0-\u31BF\u31F0-\u31FF\u3220-\u3229\u3248-\u324F\u3251-\u325F\u3280-\u3289\u32B1-\u32BF\u3400-\u4DBF\u4E00-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA62B\uA640-\uA66E\uA67F-\uA69D\uA6A0-\uA6EF\uA717-\uA71F\uA722-\uA788\uA78B-\uA7CA\uA7D0\uA7D1\uA7D3\uA7D5-\uA7D9\uA7F2-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA830-\uA835\uA840-\uA873\uA882-\uA8B3\uA8D0-\uA8D9\uA8F2-\uA8F7\uA8FB\uA8FD\uA8FE\uA900-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF-\uA9D9\uA9E0-\uA9E4\uA9E6-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA50-\uAA59\uAA60-\uAA76\uAA7A\uAA7E-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB69\uAB70-\uABE2\uABF0-\uABF9\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF10-\uFF19\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDD07-\uDD33\uDD40-\uDD78\uDD8A\uDD8B\uDE80-\uDE9C\uDEA0-\uDED0\uDEE1-\uDEFB\uDF00-\uDF23\uDF2D-\uDF4A\uDF50-\uDF75\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF\uDFD1-\uDFD5]|\uD801[\uDC00-\uDC9D\uDCA0-\uDCA9\uDCB0-\uDCD3\uDCD8-\uDCFB\uDD00-\uDD27\uDD30-\uDD63\uDD70-\uDD7A\uDD7C-\uDD8A\uDD8C-\uDD92\uDD94\uDD95\uDD97-\uDDA1\uDDA3-\uDDB1\uDDB3-\uDDB9\uDDBB\uDDBC\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67\uDF80-\uDF85\uDF87-\uDFB0\uDFB2-\uDFBA]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC58-\uDC76\uDC79-\uDC9E\uDCA7-\uDCAF\uDCE0-\uDCF2\uDCF4\uDCF5\uDCFB-\uDD1B\uDD20-\uDD39\uDD80-\uDDB7\uDDBC-\uDDCF\uDDD2-\uDE00\uDE10-\uDE13\uDE15-\uDE17\uDE19-\uDE35\uDE40-\uDE48\uDE60-\uDE7E\uDE80-\uDE9F\uDEC0-\uDEC7\uDEC9-\uDEE4\uDEEB-\uDEEF\uDF00-\uDF35\uDF40-\uDF55\uDF58-\uDF72\uDF78-\uDF91\uDFA9-\uDFAF]|\uD803[\uDC00-\uDC48\uDC80-\uDCB2\uDCC0-\uDCF2\uDCFA-\uDD23\uDD30-\uDD39\uDE60-\uDE7E\uDE80-\uDEA9\uDEB0\uDEB1\uDF00-\uDF27\uDF30-\uDF45\uDF51-\uDF54\uDF70-\uDF81\uDFB0-\uDFCB\uDFE0-\uDFF6]|\uD804[\uDC03-\uDC37\uDC52-\uDC6F\uDC71\uDC72\uDC75\uDC83-\uDCAF\uDCD0-\uDCE8\uDCF0-\uDCF9\uDD03-\uDD26\uDD36-\uDD3F\uDD44\uDD47\uDD50-\uDD72\uDD76\uDD83-\uDDB2\uDDC1-\uDDC4\uDDD0-\uDDDA\uDDDC\uDDE1-\uDDF4\uDE00-\uDE11\uDE13-\uDE2B\uDE80-\uDE86\uDE88\uDE8A-\uDE8D\uDE8F-\uDE9D\uDE9F-\uDEA8\uDEB0-\uDEDE\uDEF0-\uDEF9\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3D\uDF50\uDF5D-\uDF61]|\uD805[\uDC00-\uDC34\uDC47-\uDC4A\uDC50-\uDC59\uDC5F-\uDC61\uDC80-\uDCAF\uDCC4\uDCC5\uDCC7\uDCD0-\uDCD9\uDD80-\uDDAE\uDDD8-\uDDDB\uDE00-\uDE2F\uDE44\uDE50-\uDE59\uDE80-\uDEAA\uDEB8\uDEC0-\uDEC9\uDF00-\uDF1A\uDF30-\uDF3B\uDF40-\uDF46]|\uD806[\uDC00-\uDC2B\uDCA0-\uDCF2\uDCFF-\uDD06\uDD09\uDD0C-\uDD13\uDD15\uDD16\uDD18-\uDD2F\uDD3F\uDD41\uDD50-\uDD59\uDDA0-\uDDA7\uDDAA-\uDDD0\uDDE1\uDDE3\uDE00\uDE0B-\uDE32\uDE3A\uDE50\uDE5C-\uDE89\uDE9D\uDEB0-\uDEF8]|\uD807[\uDC00-\uDC08\uDC0A-\uDC2E\uDC40\uDC50-\uDC6C\uDC72-\uDC8F\uDD00-\uDD06\uDD08\uDD09\uDD0B-\uDD30\uDD46\uDD50-\uDD59\uDD60-\uDD65\uDD67\uDD68\uDD6A-\uDD89\uDD98\uDDA0-\uDDA9\uDEE0-\uDEF2\uDFB0\uDFC0-\uDFD4]|\uD808[\uDC00-\uDF99]|\uD809[\uDC00-\uDC6E\uDC80-\uDD43]|\uD80B[\uDF90-\uDFF0]|[\uD80C\uD81C-\uD820\uD822\uD840-\uD868\uD86A-\uD86C\uD86F-\uD872\uD874-\uD879\uD880-\uD883][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2E]|\uD811[\uDC00-\uDE46]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDE60-\uDE69\uDE70-\uDEBE\uDEC0-\uDEC9\uDED0-\uDEED\uDF00-\uDF2F\uDF40-\uDF43\uDF50-\uDF59\uDF5B-\uDF61\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDE40-\uDE96\uDF00-\uDF4A\uDF50\uDF93-\uDF9F\uDFE0\uDFE1\uDFE3]|\uD821[\uDC00-\uDFF7]|\uD823[\uDC00-\uDCD5\uDD00-\uDD08]|\uD82B[\uDFF0-\uDFF3\uDFF5-\uDFFB\uDFFD\uDFFE]|\uD82C[\uDC00-\uDD22\uDD50-\uDD52\uDD64-\uDD67\uDD70-\uDEFB]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99]|\uD834[\uDEE0-\uDEF3\uDF60-\uDF78]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB\uDFCE-\uDFFF]|\uD837[\uDF00-\uDF1E]|\uD838[\uDD00-\uDD2C\uDD37-\uDD3D\uDD40-\uDD49\uDD4E\uDE90-\uDEAD\uDEC0-\uDEEB\uDEF0-\uDEF9]|\uD839[\uDFE0-\uDFE6\uDFE8-\uDFEB\uDFED\uDFEE\uDFF0-\uDFFE]|\uD83A[\uDC00-\uDCC4\uDCC7-\uDCCF\uDD00-\uDD43\uDD4B\uDD50-\uDD59]|\uD83B[\uDC71-\uDCAB\uDCAD-\uDCAF\uDCB1-\uDCB4\uDD01-\uDD2D\uDD2F-\uDD3D\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD83C[\uDD00-\uDD0C]|\uD83E[\uDFF0-\uDFF9]|\uD869[\uDC00-\uDEDF\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF38\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEA1\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A])/))){var Ne=ye[1]||ye[2]||"";if(!Ne||Ne&&(we===""||this.rules.inline.punctuation.exec(we))){var Re=ye[0].length-1,We,He,qe=Re,Ge=0,Je=ye[0][0]==="*"?this.rules.inline.emStrong.rDelimAst:this.rules.inline.emStrong.rDelimUnd;for(Je.lastIndex=0,ve=ve.slice(-1*me.length+Re);(ye=Je.exec(ve))!=null;)if(We=ye[1]||ye[2]||ye[3]||ye[4]||ye[5]||ye[6],!!We){if(He=We.length,ye[3]||ye[4]){qe+=He;continue}else if((ye[5]||ye[6])&&Re%3&&!((Re+He)%3)){Ge+=He;continue}if(qe-=He,!(qe>0)){if(He=Math.min(He,He+qe+Ge),Math.min(Re,He)%2){var Ye=me.slice(1,Re+ye.index+He);return{type:"em",raw:me.slice(0,Re+ye.index+He+1),text:Ye,tokens:this.lexer.inlineTokens(Ye)}}var Ke=me.slice(2,Re+ye.index+He-1);return{type:"strong",raw:me.slice(0,Re+ye.index+He+1),text:Ke,tokens:this.lexer.inlineTokens(Ke)}}}}}},Ie.codespan=function(me){var ve=this.rules.inline.code.exec(me);if(ve){var we=ve[2].replace(/\n/g," "),ye=/[^ ]/.test(we),Ne=/^ /.test(we)&&/ $/.test(we);return ye&&Ne&&(we=we.substring(1,we.length-1)),we=re(we,!0),{type:"codespan",raw:ve[0],text:we}}},Ie.br=function(me){var ve=this.rules.inline.br.exec(me);if(ve)return{type:"br",raw:ve[0]}},Ie.del=function(me){var ve=this.rules.inline.del.exec(me);if(ve)return{type:"del",raw:ve[0],text:ve[2],tokens:this.lexer.inlineTokens(ve[2])}},Ie.autolink=function(me,ve){var we=this.rules.inline.autolink.exec(me);if(we){var ye,Ne;return we[2]==="@"?(ye=re(this.options.mangle?ve(we[1]):we[1]),Ne="mailto:"+ye):(ye=re(we[1]),Ne=ye),{type:"link",raw:we[0],text:ye,href:Ne,tokens:[{type:"text",raw:ye,text:ye}]}}},Ie.url=function(me,ve){var we;if(we=this.rules.inline.url.exec(me)){var ye,Ne;if(we[2]==="@")ye=re(this.options.mangle?ve(we[0]):we[0]),Ne="mailto:"+ye;else{var Re;do Re=we[0],we[0]=this.rules.inline._backpedal.exec(we[0])[0];while(Re!==we[0]);ye=re(we[0]),we[1]==="www."?Ne="http://"+ye:Ne=ye}return{type:"link",raw:we[0],text:ye,href:Ne,tokens:[{type:"text",raw:ye,text:ye}]}}},Ie.inlineText=function(me,ve){var we=this.rules.inline.text.exec(me);if(we){var ye;return this.lexer.state.inRawBlock?ye=this.options.sanitize?this.options.sanitizer?this.options.sanitizer(we[0]):re(we[0]):we[0]:ye=re(this.options.smartypants?ve(we[0]):we[0]),{type:"text",raw:we[0],text:ye}}},Te}(),Fe={newline:/^(?: *(?:\n|$))+/,code:/^( {4}[^\n]+(?:\n(?: *(?:\n|$))*)?)+/,fences:/^ {0,3}(`{3,}(?=[^`\n]*\n)|~{3,})([^\n]*)\n(?:|([\s\S]*?)\n)(?: {0,3}\1[~`]* *(?=\n|$)|$)/,hr:/^ {0,3}((?:-[\t ]*){3,}|(?:_[ \t]*){3,}|(?:\*[ \t]*){3,})(?:\n+|$)/,heading:/^ {0,3}(#{1,6})(?=\s|$)(.*)(?:\n+|$)/,blockquote:/^( {0,3}> ?(paragraph|[^\n]*)(?:\n|$))+/,list:/^( {0,3}bull)([ \t][^\n]+?)?(?:\n|$)/,html:"^ {0,3}(?:<(script|pre|style|textarea)[\\s>][\\s\\S]*?(?:</\\1>[^\\n]*\\n+|$)|comment[^\\n]*(\\n+|$)|<\\?[\\s\\S]*?(?:\\?>\\n*|$)|<![A-Z][\\s\\S]*?(?:>\\n*|$)|<!\\[CDATA\\[[\\s\\S]*?(?:\\]\\]>\\n*|$)|</?(tag)(?: +|\\n|/?>)[\\s\\S]*?(?:(?:\\n *)+\\n|$)|<(?!script|pre|style|textarea)([a-z][\\w-]*)(?:attribute)*? */?>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n *)+\\n|$)|</(?!script|pre|style|textarea)[a-z][\\w-]*\\s*>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n *)+\\n|$))",def:/^ {0,3}\[(label)\]: *(?:\n *)?<?([^\s>]+)>?(?:(?: +(?:\n *)?| *\n *)(title))? *(?:\n+|$)/,table:be,lheading:/^([^\n]+)\n {0,3}(=+|-+) *(?:\n+|$)/,_paragraph:/^([^\n]+(?:\n(?!hr|heading|lheading|blockquote|fences|list|html|table| +\n)[^\n]+)*)/,text:/^[^\n]+/};Fe._label=/(?!\s*\])(?:\\.|[^\[\]\\])+/,Fe._title=/(?:"(?:\\"?|[^"\\])*"|'[^'\n]*(?:\n[^'\n]+)*\n?'|\([^()]*\))/,Fe.def=ce(Fe.def).replace("label",Fe._label).replace("title",Fe._title).getRegex(),Fe.bullet=/(?:[*+-]|\d{1,9}[.)])/,Fe.listItemStart=ce(/^( *)(bull) */).replace("bull",Fe.bullet).getRegex(),Fe.list=ce(Fe.list).replace(/bull/g,Fe.bullet).replace("hr","\\n+(?=\\1?(?:(?:- *){3,}|(?:_ *){3,}|(?:\\* *){3,})(?:\\n+|$))").replace("def","\\n+(?="+Fe.def.source+")").getRegex(),Fe._tag="address|article|aside|base|basefont|blockquote|body|caption|center|col|colgroup|dd|details|dialog|dir|div|dl|dt|fieldset|figcaption|figure|footer|form|frame|frameset|h[1-6]|head|header|hr|html|iframe|legend|li|link|main|menu|menuitem|meta|nav|noframes|ol|optgroup|option|p|param|section|source|summary|table|tbody|td|tfoot|th|thead|title|tr|track|ul",Fe._comment=/<!--(?!-?>)[\s\S]*?(?:-->|$)/,Fe.html=ce(Fe.html,"i").replace("comment",Fe._comment).replace("tag",Fe._tag).replace("attribute",/ +[a-zA-Z:_][\w.:-]*(?: *= *"[^"\n]*"| *= *'[^'\n]*'| *= *[^\s"'=<>`]+)?/).getRegex(),Fe.paragraph=ce(Fe._paragraph).replace("hr",Fe.hr).replace("heading"," {0,3}#{1,6} ").replace("|lheading","").replace("|table","").replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",Fe._tag).getRegex(),Fe.blockquote=ce(Fe.blockquote).replace("paragraph",Fe.paragraph).getRegex(),Fe.normal=Ce({},Fe),Fe.gfm=Ce({},Fe.normal,{table:"^ *([^\\n ].*\\|.*)\\n {0,3}(?:\\| *)?(:?-+:? *(?:\\| *:?-+:? *)*)(?:\\| *)?(?:\\n((?:(?! *\\n|hr|heading|blockquote|code|fences|list|html).*(?:\\n|$))*)\\n*|$)"}),Fe.gfm.table=ce(Fe.gfm.table).replace("hr",Fe.hr).replace("heading"," {0,3}#{1,6} ").replace("blockquote"," {0,3}>").replace("code"," {4}[^\\n]").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",Fe._tag).getRegex(),Fe.gfm.paragraph=ce(Fe._paragraph).replace("hr",Fe.hr).replace("heading"," {0,3}#{1,6} ").replace("|lheading","").replace("table",Fe.gfm.table).replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",Fe._tag).getRegex(),Fe.pedantic=Ce({},Fe.normal,{html:ce(`^ *(?:comment *(?:\\n|\\s*$)|<(tag)[\\s\\S]+?</\\1> *(?:\\n{2,}|\\s*$)|<tag(?:"[^"]*"|'[^']*'|\\s[^'"/>\\s]*)*?/?> *(?:\\n{2,}|\\s*$))`).replace("comment",Fe._comment).replace(/tag/g,"(?!(?:a|em|strong|small|s|cite|q|dfn|abbr|data|time|code|var|samp|kbd|sub|sup|i|b|u|mark|ruby|rt|rp|bdi|bdo|span|br|wbr|ins|del|img)\\b)\\w+(?!:|[^\\w\\s@]*@)\\b").getRegex(),def:/^ *\[([^\]]+)\]: *<?([^\s>]+)>?(?: +(["(][^\n]+[")]))? *(?:\n+|$)/,heading:/^(#{1,6})(.*)(?:\n+|$)/,fences:be,paragraph:ce(Fe.normal._paragraph).replace("hr",Fe.hr).replace("heading",` *#{1,6} *[^
]`).replace("lheading",Fe.lheading).replace("blockquote"," {0,3}>").replace("|fences","").replace("|list","").replace("|html","").getRegex()});var Ae={escape:/^\\([!"#$%&'()*+,\-./:;<=>?@\[\]\\^_`{|}~])/,autolink:/^<(scheme:[^\s\x00-\x1f<>]*|email)>/,url:be,tag:"^comment|^</[a-zA-Z][\\w:-]*\\s*>|^<[a-zA-Z][\\w-]*(?:attribute)*?\\s*/?>|^<\\?[\\s\\S]*?\\?>|^<![a-zA-Z]+\\s[\\s\\S]*?>|^<!\\[CDATA\\[[\\s\\S]*?\\]\\]>",link:/^!?\[(label)\]\(\s*(href)(?:\s+(title))?\s*\)/,reflink:/^!?\[(label)\]\[(ref)\]/,nolink:/^!?\[(ref)\](?:\[\])?/,reflinkSearch:"reflink|nolink(?!\\()",emStrong:{lDelim:/^(?:\*+(?:([punct_])|[^\s*]))|^_+(?:([punct*])|([^\s_]))/,rDelimAst:/^[^_*]*?\_\_[^_*]*?\*[^_*]*?(?=\_\_)|[^*]+(?=[^*])|[punct_](\*+)(?=[\s]|$)|[^punct*_\s](\*+)(?=[punct_\s]|$)|[punct_\s](\*+)(?=[^punct*_\s])|[\s](\*+)(?=[punct_])|[punct_](\*+)(?=[punct_])|[^punct*_\s](\*+)(?=[^punct*_\s])/,rDelimUnd:/^[^_*]*?\*\*[^_*]*?\_[^_*]*?(?=\*\*)|[^_]+(?=[^_])|[punct*](\_+)(?=[\s]|$)|[^punct*_\s](\_+)(?=[punct*\s]|$)|[punct*\s](\_+)(?=[^punct*_\s])|[\s](\_+)(?=[punct*])|[punct*](\_+)(?=[punct*])/},code:/^(`+)([^`]|[^`][\s\S]*?[^`])\1(?!`)/,br:/^( {2,}|\\)\n(?!\s*$)/,del:be,text:/^(`+|[^`])(?:(?= {2,}\n)|[\s\S]*?(?:(?=[\\<!\[`*_]|\b_|$)|[^ ](?= {2,}\n)))/,punctuation:/^([\spunctuation])/};Ae._punctuation="!\"#$%&'()+\\-.,/:;<=>?@\\[\\]`^{|}~",Ae.punctuation=ce(Ae.punctuation).replace(/punctuation/g,Ae._punctuation).getRegex(),Ae.blockSkip=/\[[^\]]*?\]\([^\)]*?\)|`[^`]*?`|<[^>]*?>/g,Ae.escapedEmSt=/\\\*|\\_/g,Ae._comment=ce(Fe._comment).replace("(?:-->|$)","-->").getRegex(),Ae.emStrong.lDelim=ce(Ae.emStrong.lDelim).replace(/punct/g,Ae._punctuation).getRegex(),Ae.emStrong.rDelimAst=ce(Ae.emStrong.rDelimAst,"g").replace(/punct/g,Ae._punctuation).getRegex(),Ae.emStrong.rDelimUnd=ce(Ae.emStrong.rDelimUnd,"g").replace(/punct/g,Ae._punctuation).getRegex(),Ae._escapes=/\\([!"#$%&'()*+,\-./:;<=>?@\[\]\\^_`{|}~])/g,Ae._scheme=/[a-zA-Z][a-zA-Z0-9+.-]{1,31}/,Ae._email=/[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+(@)[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)+(?![-_])/,Ae.autolink=ce(Ae.autolink).replace("scheme",Ae._scheme).replace("email",Ae._email).getRegex(),Ae._attribute=/\s+[a-zA-Z:_][\w.:-]*(?:\s*=\s*"[^"]*"|\s*=\s*'[^']*'|\s*=\s*[^\s"'=<>`]+)?/,Ae.tag=ce(Ae.tag).replace("comment",Ae._comment).replace("attribute",Ae._attribute).getRegex(),Ae._label=/(?:\[(?:\\.|[^\[\]\\])*\]|\\.|`[^`]*`|[^\[\]\\`])*?/,Ae._href=/<(?:\\.|[^\n<>\\])+>|[^\s\x00-\x1f]*/,Ae._title=/"(?:\\"?|[^"\\])*"|'(?:\\'?|[^'\\])*'|\((?:\\\)?|[^)\\])*\)/,Ae.link=ce(Ae.link).replace("label",Ae._label).replace("href",Ae._href).replace("title",Ae._title).getRegex(),Ae.reflink=ce(Ae.reflink).replace("label",Ae._label).replace("ref",Fe._label).getRegex(),Ae.nolink=ce(Ae.nolink).replace("ref",Fe._label).getRegex(),Ae.reflinkSearch=ce(Ae.reflinkSearch,"g").replace("reflink",Ae.reflink).replace("nolink",Ae.nolink).getRegex(),Ae.normal=Ce({},Ae),Ae.pedantic=Ce({},Ae.normal,{strong:{start:/^__|\*\*/,middle:/^__(?=\S)([\s\S]*?\S)__(?!_)|^\*\*(?=\S)([\s\S]*?\S)\*\*(?!\*)/,endAst:/\*\*(?!\*)/g,endUnd:/__(?!_)/g},em:{start:/^_|\*/,middle:/^()\*(?=\S)([\s\S]*?\S)\*(?!\*)|^_(?=\S)([\s\S]*?\S)_(?!_)/,endAst:/\*(?!\*)/g,endUnd:/_(?!_)/g},link:ce(/^!?\[(label)\]\((.*?)\)/).replace("label",Ae._label).getRegex(),reflink:ce(/^!?\[(label)\]\s*\[([^\]]*)\]/).replace("label",Ae._label).getRegex()}),Ae.gfm=Ce({},Ae.normal,{escape:ce(Ae.escape).replace("])","~|])").getRegex(),_extended_email:/[A-Za-z0-9._+-]+(@)[a-zA-Z0-9-_]+(?:\.[a-zA-Z0-9-_]*[a-zA-Z0-9])+(?![-_])/,url:/^((?:ftp|https?):\/\/|www\.)(?:[a-zA-Z0-9\-]+\.?)+[^\s<]*|^email/,_backpedal:/(?:[^?!.,:;*_~()&]+|\([^)]*\)|&(?![a-zA-Z0-9]+;$)|[?!.,:;*_~)]+(?!$))+/,del:/^(~~?)(?=[^\s~])([\s\S]*?[^\s~])\1(?=[^~]|$)/,text:/^([`~]+|[^`~])(?:(?= {2,}\n)|(?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)|[\s\S]*?(?:(?=[\\<!\[`*~_]|\b_|https?:\/\/|ftp:\/\/|www\.|$)|[^ ](?= {2,}\n)|[^a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-](?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)))/}),Ae.gfm.url=ce(Ae.gfm.url,"i").replace("email",Ae.gfm._extended_email).getRegex(),Ae.breaks=Ce({},Ae.gfm,{br:ce(Ae.br).replace("{2,}","*").getRegex(),text:ce(Ae.gfm.text).replace("\\b_","\\b_| {2,}\\n").replace(/\{2,\}/g,"*").getRegex()});function ot(Te){return Te.replace(/---/g,"—").replace(/--/g,"–").replace(/(^|[-\u2014/(\[{"\s])'/g,"$1‘").replace(/'/g,"’").replace(/(^|[-\u2014/(\[{\u2018\s])"/g,"$1“").replace(/"/g,"”").replace(/\.{3}/g,"…")}function ft(Te){var Ie="",Ee,me,ve=Te.length;for(Ee=0;Ee<ve;Ee++)me=Te.charCodeAt(Ee),Math.random()>.5&&(me="x"+me.toString(16)),Ie+="&#"+me+";";return Ie}var rt=function(){function Te(Ee){this.tokens=[],this.tokens.links=Object.create(null),this.options=Ee||C.defaults,this.options.tokenizer=this.options.tokenizer||new ze,this.tokenizer=this.options.tokenizer,this.tokenizer.options=this.options,this.tokenizer.lexer=this,this.inlineQueue=[],this.state={inLink:!1,inRawBlock:!1,top:!0};var me={block:Fe.normal,inline:Ae.normal};this.options.pedantic?(me.block=Fe.pedantic,me.inline=Ae.pedantic):this.options.gfm&&(me.block=Fe.gfm,this.options.breaks?me.inline=Ae.breaks:me.inline=Ae.gfm),this.tokenizer.rules=me}Te.lex=function(me,ve){var we=new Te(ve);return we.lex(me)},Te.lexInline=function(me,ve){var we=new Te(ve);return we.inlineTokens(me)};var Ie=Te.prototype;return Ie.lex=function(me){me=me.replace(/\r\n|\r/g,`
`),this.blockTokens(me,this.tokens);for(var ve;ve=this.inlineQueue.shift();)this.inlineTokens(ve.src,ve.tokens);return this.tokens},Ie.blockTokens=function(me,ve){var we=this;ve===void 0&&(ve=[]),this.options.pedantic?me=me.replace(/\t/g,"    ").replace(/^ +$/gm,""):me=me.replace(/^( *)(\t+)/gm,function(qe,Ge,Je){return Ge+"    ".repeat(Je.length)});for(var ye,Ne,Re,We;me;)if(!(this.options.extensions&&this.options.extensions.block&&this.options.extensions.block.some(function(qe){return(ye=qe.call({lexer:we},me,ve))?(me=me.substring(ye.raw.length),ve.push(ye),!0):!1}))){if(ye=this.tokenizer.space(me)){me=me.substring(ye.raw.length),ye.raw.length===1&&ve.length>0?ve[ve.length-1].raw+=`
`:ve.push(ye);continue}if(ye=this.tokenizer.code(me)){me=me.substring(ye.raw.length),Ne=ve[ve.length-1],Ne&&(Ne.type==="paragraph"||Ne.type==="text")?(Ne.raw+=`
`+ye.raw,Ne.text+=`
`+ye.text,this.inlineQueue[this.inlineQueue.length-1].src=Ne.text):ve.push(ye);continue}if(ye=this.tokenizer.fences(me)){me=me.substring(ye.raw.length),ve.push(ye);continue}if(ye=this.tokenizer.heading(me)){me=me.substring(ye.raw.length),ve.push(ye);continue}if(ye=this.tokenizer.hr(me)){me=me.substring(ye.raw.length),ve.push(ye);continue}if(ye=this.tokenizer.blockquote(me)){me=me.substring(ye.raw.length),ve.push(ye);continue}if(ye=this.tokenizer.list(me)){me=me.substring(ye.raw.length),ve.push(ye);continue}if(ye=this.tokenizer.html(me)){me=me.substring(ye.raw.length),ve.push(ye);continue}if(ye=this.tokenizer.def(me)){me=me.substring(ye.raw.length),Ne=ve[ve.length-1],Ne&&(Ne.type==="paragraph"||Ne.type==="text")?(Ne.raw+=`
`+ye.raw,Ne.text+=`
`+ye.raw,this.inlineQueue[this.inlineQueue.length-1].src=Ne.text):this.tokens.links[ye.tag]||(this.tokens.links[ye.tag]={href:ye.href,title:ye.title});continue}if(ye=this.tokenizer.table(me)){me=me.substring(ye.raw.length),ve.push(ye);continue}if(ye=this.tokenizer.lheading(me)){me=me.substring(ye.raw.length),ve.push(ye);continue}if(Re=me,this.options.extensions&&this.options.extensions.startBlock&&function(){var qe=1/0,Ge=me.slice(1),Je=void 0;we.options.extensions.startBlock.forEach(function(Ye){Je=Ye.call({lexer:this},Ge),typeof Je=="number"&&Je>=0&&(qe=Math.min(qe,Je))}),qe<1/0&&qe>=0&&(Re=me.substring(0,qe+1))}(),this.state.top&&(ye=this.tokenizer.paragraph(Re))){Ne=ve[ve.length-1],We&&Ne.type==="paragraph"?(Ne.raw+=`
`+ye.raw,Ne.text+=`
`+ye.text,this.inlineQueue.pop(),this.inlineQueue[this.inlineQueue.length-1].src=Ne.text):ve.push(ye),We=Re.length!==me.length,me=me.substring(ye.raw.length);continue}if(ye=this.tokenizer.text(me)){me=me.substring(ye.raw.length),Ne=ve[ve.length-1],Ne&&Ne.type==="text"?(Ne.raw+=`
`+ye.raw,Ne.text+=`
`+ye.text,this.inlineQueue.pop(),this.inlineQueue[this.inlineQueue.length-1].src=Ne.text):ve.push(ye);continue}if(me){var He="Infinite loop on byte: "+me.charCodeAt(0);if(this.options.silent){console.error(He);break}else throw new Error(He)}}return this.state.top=!0,ve},Ie.inline=function(me,ve){return ve===void 0&&(ve=[]),this.inlineQueue.push({src:me,tokens:ve}),ve},Ie.inlineTokens=function(me,ve){var we=this;ve===void 0&&(ve=[]);var ye,Ne,Re,We=me,He,qe,Ge;if(this.tokens.links){var Je=Object.keys(this.tokens.links);if(Je.length>0)for(;(He=this.tokenizer.rules.inline.reflinkSearch.exec(We))!=null;)Je.includes(He[0].slice(He[0].lastIndexOf("[")+1,-1))&&(We=We.slice(0,He.index)+"["+Be("a",He[0].length-2)+"]"+We.slice(this.tokenizer.rules.inline.reflinkSearch.lastIndex))}for(;(He=this.tokenizer.rules.inline.blockSkip.exec(We))!=null;)We=We.slice(0,He.index)+"["+Be("a",He[0].length-2)+"]"+We.slice(this.tokenizer.rules.inline.blockSkip.lastIndex);for(;(He=this.tokenizer.rules.inline.escapedEmSt.exec(We))!=null;)We=We.slice(0,He.index)+"++"+We.slice(this.tokenizer.rules.inline.escapedEmSt.lastIndex);for(;me;)if(qe||(Ge=""),qe=!1,!(this.options.extensions&&this.options.extensions.inline&&this.options.extensions.inline.some(function(Ke){return(ye=Ke.call({lexer:we},me,ve))?(me=me.substring(ye.raw.length),ve.push(ye),!0):!1}))){if(ye=this.tokenizer.escape(me)){me=me.substring(ye.raw.length),ve.push(ye);continue}if(ye=this.tokenizer.tag(me)){me=me.substring(ye.raw.length),Ne=ve[ve.length-1],Ne&&ye.type==="text"&&Ne.type==="text"?(Ne.raw+=ye.raw,Ne.text+=ye.text):ve.push(ye);continue}if(ye=this.tokenizer.link(me)){me=me.substring(ye.raw.length),ve.push(ye);continue}if(ye=this.tokenizer.reflink(me,this.tokens.links)){me=me.substring(ye.raw.length),Ne=ve[ve.length-1],Ne&&ye.type==="text"&&Ne.type==="text"?(Ne.raw+=ye.raw,Ne.text+=ye.text):ve.push(ye);continue}if(ye=this.tokenizer.emStrong(me,We,Ge)){me=me.substring(ye.raw.length),ve.push(ye);continue}if(ye=this.tokenizer.codespan(me)){me=me.substring(ye.raw.length),ve.push(ye);continue}if(ye=this.tokenizer.br(me)){me=me.substring(ye.raw.length),ve.push(ye);continue}if(ye=this.tokenizer.del(me)){me=me.substring(ye.raw.length),ve.push(ye);continue}if(ye=this.tokenizer.autolink(me,ft)){me=me.substring(ye.raw.length),ve.push(ye);continue}if(!this.state.inLink&&(ye=this.tokenizer.url(me,ft))){me=me.substring(ye.raw.length),ve.push(ye);continue}if(Re=me,this.options.extensions&&this.options.extensions.startInline&&function(){var Ke=1/0,tt=me.slice(1),it=void 0;we.options.extensions.startInline.forEach(function(bt){it=bt.call({lexer:this},tt),typeof it=="number"&&it>=0&&(Ke=Math.min(Ke,it))}),Ke<1/0&&Ke>=0&&(Re=me.substring(0,Ke+1))}(),ye=this.tokenizer.inlineText(Re,ot)){me=me.substring(ye.raw.length),ye.raw.slice(-1)!=="_"&&(Ge=ye.raw.slice(-1)),qe=!0,Ne=ve[ve.length-1],Ne&&Ne.type==="text"?(Ne.raw+=ye.raw,Ne.text+=ye.text):ve.push(ye);continue}if(me){var Ye="Infinite loop on byte: "+me.charCodeAt(0);if(this.options.silent){console.error(Ye);break}else throw new Error(Ye)}}return ve},V(Te,null,[{key:"rules",get:function(){return{block:Fe,inline:Ae}}}]),Te}(),Xe=function(){function Te(Ee){this.options=Ee||C.defaults}var Ie=Te.prototype;return Ie.code=function(me,ve,we){var ye=(ve||"").match(/\S*/)[0];if(this.options.highlight){var Ne=this.options.highlight(me,ye);Ne!=null&&Ne!==me&&(we=!0,me=Ne)}return me=me.replace(/\n$/,"")+`
`,ye?'<pre><code class="'+this.options.langPrefix+re(ye,!0)+'">'+(we?me:re(me,!0))+`</code></pre>
`:"<pre><code>"+(we?me:re(me,!0))+`</code></pre>
`},Ie.blockquote=function(me){return`<blockquote>
`+me+`</blockquote>
`},Ie.html=function(me){return me},Ie.heading=function(me,ve,we,ye){if(this.options.headerIds){var Ne=this.options.headerPrefix+ye.slug(we);return"<h"+ve+' id="'+Ne+'">'+me+"</h"+ve+`>
`}return"<h"+ve+">"+me+"</h"+ve+`>
`},Ie.hr=function(){return this.options.xhtml?`<hr/>
`:`<hr>
`},Ie.list=function(me,ve,we){var ye=ve?"ol":"ul",Ne=ve&&we!==1?' start="'+we+'"':"";return"<"+ye+Ne+`>
`+me+"</"+ye+`>
`},Ie.listitem=function(me){return"<li>"+me+`</li>
`},Ie.checkbox=function(me){return"<input "+(me?'checked="" ':"")+'disabled="" type="checkbox"'+(this.options.xhtml?" /":"")+"> "},Ie.paragraph=function(me){return"<p>"+me+`</p>
`},Ie.table=function(me,ve){return ve&&(ve="<tbody>"+ve+"</tbody>"),`<table>
<thead>
`+me+`</thead>
`+ve+`</table>
`},Ie.tablerow=function(me){return`<tr>
`+me+`</tr>
`},Ie.tablecell=function(me,ve){var we=ve.header?"th":"td",ye=ve.align?"<"+we+' align="'+ve.align+'">':"<"+we+">";return ye+me+("</"+we+`>
`)},Ie.strong=function(me){return"<strong>"+me+"</strong>"},Ie.em=function(me){return"<em>"+me+"</em>"},Ie.codespan=function(me){return"<code>"+me+"</code>"},Ie.br=function(){return this.options.xhtml?"<br/>":"<br>"},Ie.del=function(me){return"<del>"+me+"</del>"},Ie.link=function(me,ve,we){if(me=ge(this.options.sanitize,this.options.baseUrl,me),me===null)return we;var ye='<a href="'+re(me)+'"';return ve&&(ye+=' title="'+ve+'"'),ye+=">"+we+"</a>",ye},Ie.image=function(me,ve,we){if(me=ge(this.options.sanitize,this.options.baseUrl,me),me===null)return we;var ye='<img src="'+me+'" alt="'+we+'"';return ve&&(ye+=' title="'+ve+'"'),ye+=this.options.xhtml?"/>":">",ye},Ie.text=function(me){return me},Te}(),ct=function(){function Te(){}var Ie=Te.prototype;return Ie.strong=function(me){return me},Ie.em=function(me){return me},Ie.codespan=function(me){return me},Ie.del=function(me){return me},Ie.html=function(me){return me},Ie.text=function(me){return me},Ie.link=function(me,ve,we){return""+we},Ie.image=function(me,ve,we){return""+we},Ie.br=function(){return""},Te}(),vt=function(){function Te(){this.seen={}}var Ie=Te.prototype;return Ie.serialize=function(me){return me.toLowerCase().trim().replace(/<[!\/a-z].*?>/ig,"").replace(/[\u2000-\u206F\u2E00-\u2E7F\\'!"#$%&()*+,./:;<=>?@[\]^`{|}~]/g,"").replace(/\s/g,"-")},Ie.getNextSafeSlug=function(me,ve){var we=me,ye=0;if(this.seen.hasOwnProperty(we)){ye=this.seen[me];do ye++,we=me+"-"+ye;while(this.seen.hasOwnProperty(we))}return ve||(this.seen[me]=ye,this.seen[we]=0),we},Ie.slug=function(me,ve){ve===void 0&&(ve={});var we=this.serialize(me);return this.getNextSafeSlug(we,ve.dryrun)},Te}(),pt=function(){function Te(Ee){this.options=Ee||C.defaults,this.options.renderer=this.options.renderer||new Xe,this.renderer=this.options.renderer,this.renderer.options=this.options,this.textRenderer=new ct,this.slugger=new vt}Te.parse=function(me,ve){var we=new Te(ve);return we.parse(me)},Te.parseInline=function(me,ve){var we=new Te(ve);return we.parseInline(me)};var Ie=Te.prototype;return Ie.parse=function(me,ve){ve===void 0&&(ve=!0);var we="",ye,Ne,Re,We,He,qe,Ge,Je,Ye,Ke,tt,it,bt,Qe,st,Nt,At,Et,kt,Rt=me.length;for(ye=0;ye<Rt;ye++){if(Ke=me[ye],this.options.extensions&&this.options.extensions.renderers&&this.options.extensions.renderers[Ke.type]&&(kt=this.options.extensions.renderers[Ke.type].call({parser:this},Ke),kt!==!1||!["space","hr","heading","code","table","blockquote","list","html","paragraph","text"].includes(Ke.type))){we+=kt||"";continue}switch(Ke.type){case"space":continue;case"hr":{we+=this.renderer.hr();continue}case"heading":{we+=this.renderer.heading(this.parseInline(Ke.tokens),Ke.depth,se(this.parseInline(Ke.tokens,this.textRenderer)),this.slugger);continue}case"code":{we+=this.renderer.code(Ke.text,Ke.lang,Ke.escaped);continue}case"table":{for(Je="",Ge="",We=Ke.header.length,Ne=0;Ne<We;Ne++)Ge+=this.renderer.tablecell(this.parseInline(Ke.header[Ne].tokens),{header:!0,align:Ke.align[Ne]});for(Je+=this.renderer.tablerow(Ge),Ye="",We=Ke.rows.length,Ne=0;Ne<We;Ne++){for(qe=Ke.rows[Ne],Ge="",He=qe.length,Re=0;Re<He;Re++)Ge+=this.renderer.tablecell(this.parseInline(qe[Re].tokens),{header:!1,align:Ke.align[Re]});Ye+=this.renderer.tablerow(Ge)}we+=this.renderer.table(Je,Ye);continue}case"blockquote":{Ye=this.parse(Ke.tokens),we+=this.renderer.blockquote(Ye);continue}case"list":{for(tt=Ke.ordered,it=Ke.start,bt=Ke.loose,We=Ke.items.length,Ye="",Ne=0;Ne<We;Ne++)st=Ke.items[Ne],Nt=st.checked,At=st.task,Qe="",st.task&&(Et=this.renderer.checkbox(Nt),bt?st.tokens.length>0&&st.tokens[0].type==="paragraph"?(st.tokens[0].text=Et+" "+st.tokens[0].text,st.tokens[0].tokens&&st.tokens[0].tokens.length>0&&st.tokens[0].tokens[0].type==="text"&&(st.tokens[0].tokens[0].text=Et+" "+st.tokens[0].tokens[0].text)):st.tokens.unshift({type:"text",text:Et}):Qe+=Et),Qe+=this.parse(st.tokens,bt),Ye+=this.renderer.listitem(Qe,At,Nt);we+=this.renderer.list(Ye,tt,it);continue}case"html":{we+=this.renderer.html(Ke.text);continue}case"paragraph":{we+=this.renderer.paragraph(this.parseInline(Ke.tokens));continue}case"text":{for(Ye=Ke.tokens?this.parseInline(Ke.tokens):Ke.text;ye+1<Rt&&me[ye+1].type==="text";)Ke=me[++ye],Ye+=`
`+(Ke.tokens?this.parseInline(Ke.tokens):Ke.text);we+=ve?this.renderer.paragraph(Ye):Ye;continue}default:{var Mt='Token with "'+Ke.type+'" type was not found.';if(this.options.silent){console.error(Mt);return}else throw new Error(Mt)}}}return we},Ie.parseInline=function(me,ve){ve=ve||this.renderer;var we="",ye,Ne,Re,We=me.length;for(ye=0;ye<We;ye++){if(Ne=me[ye],this.options.extensions&&this.options.extensions.renderers&&this.options.extensions.renderers[Ne.type]&&(Re=this.options.extensions.renderers[Ne.type].call({parser:this},Ne),Re!==!1||!["escape","html","link","image","strong","em","codespan","br","del","text"].includes(Ne.type))){we+=Re||"";continue}switch(Ne.type){case"escape":{we+=ve.text(Ne.text);break}case"html":{we+=ve.html(Ne.text);break}case"link":{we+=ve.link(Ne.href,Ne.title,this.parseInline(Ne.tokens,ve));break}case"image":{we+=ve.image(Ne.href,Ne.title,Ne.text);break}case"strong":{we+=ve.strong(this.parseInline(Ne.tokens,ve));break}case"em":{we+=ve.em(this.parseInline(Ne.tokens,ve));break}case"codespan":{we+=ve.codespan(Ne.text);break}case"br":{we+=ve.br();break}case"del":{we+=ve.del(this.parseInline(Ne.tokens,ve));break}case"text":{we+=ve.text(Ne.text);break}default:{var He='Token with "'+Ne.type+'" type was not found.';if(this.options.silent){console.error(He);return}else throw new Error(He)}}}return we},Te}();function je(Te,Ie,Ee){if(typeof Te>"u"||Te===null)throw new Error("marked(): input parameter is undefined or null");if(typeof Te!="string")throw new Error("marked(): input parameter is of type "+Object.prototype.toString.call(Te)+", string expected");if(typeof Ie=="function"&&(Ee=Ie,Ie=null),Ie=Ce({},je.defaults,Ie||{}),Oe(Ie),Ee){var me=Ie.highlight,ve;try{ve=rt.lex(Te,Ie)}catch(We){return Ee(We)}var we=function(He){var qe;if(!He)try{Ie.walkTokens&&je.walkTokens(ve,Ie.walkTokens),qe=pt.parse(ve,Ie)}catch(Ge){He=Ge}return Ie.highlight=me,He?Ee(He):Ee(null,qe)};if(!me||me.length<3||(delete Ie.highlight,!ve.length))return we();var ye=0;je.walkTokens(ve,function(We){We.type==="code"&&(ye++,setTimeout(function(){me(We.text,We.lang,function(He,qe){if(He)return we(He);qe!=null&&qe!==We.text&&(We.text=qe,We.escaped=!0),ye--,ye===0&&we()})},0))}),ye===0&&we();return}function Ne(We){if(We.message+=`
Please report this to https://github.com/markedjs/marked.`,Ie.silent)return"<p>An error occurred:</p><pre>"+re(We.message+"",!0)+"</pre>";throw We}try{var Re=rt.lex(Te,Ie);if(Ie.walkTokens){if(Ie.async)return Promise.all(je.walkTokens(Re,Ie.walkTokens)).then(function(){return pt.parse(Re,Ie)}).catch(Ne);je.walkTokens(Re,Ie.walkTokens)}return pt.parse(Re,Ie)}catch(We){Ne(We)}}je.options=je.setOptions=function(Te){return Ce(je.defaults,Te),Q(je.defaults),je},je.getDefaults=X,je.defaults=C.defaults,je.use=function(){for(var Te=arguments.length,Ie=new Array(Te),Ee=0;Ee<Te;Ee++)Ie[Ee]=arguments[Ee];var me=Ce.apply(void 0,[{}].concat(Ie)),ve=je.defaults.extensions||{renderers:{},childTokens:{}},we;Ie.forEach(function(ye){if(ye.extensions&&(we=!0,ye.extensions.forEach(function(Re){if(!Re.name)throw new Error("extension name required");if(Re.renderer){var We=ve.renderers?ve.renderers[Re.name]:null;We?ve.renderers[Re.name]=function(){for(var He=arguments.length,qe=new Array(He),Ge=0;Ge<He;Ge++)qe[Ge]=arguments[Ge];var Je=Re.renderer.apply(this,qe);return Je===!1&&(Je=We.apply(this,qe)),Je}:ve.renderers[Re.name]=Re.renderer}if(Re.tokenizer){if(!Re.level||Re.level!=="block"&&Re.level!=="inline")throw new Error("extension level must be 'block' or 'inline'");ve[Re.level]?ve[Re.level].unshift(Re.tokenizer):ve[Re.level]=[Re.tokenizer],Re.start&&(Re.level==="block"?ve.startBlock?ve.startBlock.push(Re.start):ve.startBlock=[Re.start]:Re.level==="inline"&&(ve.startInline?ve.startInline.push(Re.start):ve.startInline=[Re.start]))}Re.childTokens&&(ve.childTokens[Re.name]=Re.childTokens)})),ye.renderer&&function(){var Re=je.defaults.renderer||new Xe,We=function(Ge){var Je=Re[Ge];Re[Ge]=function(){for(var Ye=arguments.length,Ke=new Array(Ye),tt=0;tt<Ye;tt++)Ke[tt]=arguments[tt];var it=ye.renderer[Ge].apply(Re,Ke);return it===!1&&(it=Je.apply(Re,Ke)),it}};for(var He in ye.renderer)We(He);me.renderer=Re}(),ye.tokenizer&&function(){var Re=je.defaults.tokenizer||new ze,We=function(Ge){var Je=Re[Ge];Re[Ge]=function(){for(var Ye=arguments.length,Ke=new Array(Ye),tt=0;tt<Ye;tt++)Ke[tt]=arguments[tt];var it=ye.tokenizer[Ge].apply(Re,Ke);return it===!1&&(it=Je.apply(Re,Ke)),it}};for(var He in ye.tokenizer)We(He);me.tokenizer=Re}(),ye.walkTokens){var Ne=je.defaults.walkTokens;me.walkTokens=function(Re){var We=[];return We.push(ye.walkTokens.call(this,Re)),Ne&&(We=We.concat(Ne.call(this,Re))),We}}we&&(me.extensions=ve),je.setOptions(me)})},je.walkTokens=function(Te,Ie){for(var Ee=[],me=function(){var Ne=we.value;switch(Ee=Ee.concat(Ie.call(je,Ne)),Ne.type){case"table":{for(var Re=Z(Ne.header),We;!(We=Re()).done;){var He=We.value;Ee=Ee.concat(je.walkTokens(He.tokens,Ie))}for(var qe=Z(Ne.rows),Ge;!(Ge=qe()).done;)for(var Je=Ge.value,Ye=Z(Je),Ke;!(Ke=Ye()).done;){var tt=Ke.value;Ee=Ee.concat(je.walkTokens(tt.tokens,Ie))}break}case"list":{Ee=Ee.concat(je.walkTokens(Ne.items,Ie));break}default:je.defaults.extensions&&je.defaults.extensions.childTokens&&je.defaults.extensions.childTokens[Ne.type]?je.defaults.extensions.childTokens[Ne.type].forEach(function(it){Ee=Ee.concat(je.walkTokens(Ne[it],Ie))}):Ne.tokens&&(Ee=Ee.concat(je.walkTokens(Ne.tokens,Ie)))}},ve=Z(Te),we;!(we=ve()).done;)me();return Ee},je.parseInline=function(Te,Ie){if(typeof Te>"u"||Te===null)throw new Error("marked.parseInline(): input parameter is undefined or null");if(typeof Te!="string")throw new Error("marked.parseInline(): input parameter is of type "+Object.prototype.toString.call(Te)+", string expected");Ie=Ce({},je.defaults,Ie||{}),Oe(Ie);try{var Ee=rt.lexInline(Te,Ie);return Ie.walkTokens&&je.walkTokens(Ee,Ie.walkTokens),pt.parseInline(Ee,Ie)}catch(me){if(me.message+=`
Please report this to https://github.com/markedjs/marked.`,Ie.silent)return"<p>An error occurred:</p><pre>"+re(me.message+"",!0)+"</pre>";throw me}},je.Parser=pt,je.parser=pt.parse,je.Renderer=Xe,je.TextRenderer=ct,je.Lexer=rt,je.lexer=rt.lex,je.Tokenizer=ze,je.Slugger=vt,je.parse=je;var Ct=je.options,wt=je.setOptions,Lt=je.use,ut=je.walkTokens,_t=je.parseInline,Vt=je,zt=pt.parse,jt=rt.lex;C.Lexer=rt,C.Parser=pt,C.Renderer=Xe,C.Slugger=vt,C.TextRenderer=ct,C.Tokenizer=ze,C.getDefaults=X,C.lexer=jt,C.marked=je,C.options=Ct,C.parse=Vt,C.parseInline=_t,C.parser=zt,C.setOptions=wt,C.use=Lt,C.walkTokens=ut,Object.defineProperty(C,"__esModule",{value:!0})})})();__marked_exports.Lexer||exports.Lexer;__marked_exports.Parser||exports.Parser;__marked_exports.Renderer||exports.Renderer;__marked_exports.Slugger||exports.Slugger;__marked_exports.TextRenderer||exports.TextRenderer;__marked_exports.Tokenizer||exports.Tokenizer;__marked_exports.getDefaults||exports.getDefaults;__marked_exports.lexer||exports.lexer;var marked=__marked_exports.marked||exports.marked;__marked_exports.options||exports.options;__marked_exports.parse||exports.parse;__marked_exports.parseInline||exports.parseInline;__marked_exports.parser||exports.parser;__marked_exports.setOptions||exports.setOptions;__marked_exports.use||exports.use;__marked_exports.walkTokens||exports.walkTokens;function stringify(K){return JSON.stringify(K,replacer)}function parse(K){let C=JSON.parse(K);return C=revive(C),C}function replacer(K,C){return C instanceof RegExp?{$mid:2,source:C.source,flags:C.flags}:C}function revive(K,C=0){if(!K||C>200)return K;if(typeof K=="object"){switch(K.$mid){case 1:return URI.revive(K);case 2:return new RegExp(K.source,K.flags);case 17:return new Date(K.source)}if(K instanceof VSBuffer||K instanceof Uint8Array)return K;if(Array.isArray(K))for(let W=0;W<K.length;++W)K[W]=revive(K[W],C+1);else for(const W in K)Object.hasOwnProperty.call(K,W)&&(K[W]=revive(K[W],C+1))}return K}const defaultMarkedRenderers=Object.freeze({image:(K,C,W)=>{let V=[],U=[];return K&&({href:K,dimensions:V}=parseHrefAndDimensions(K),U.push(`src="${escapeDoubleQuotes(K)}"`)),W&&U.push(`alt="${escapeDoubleQuotes(W)}"`),C&&U.push(`title="${escapeDoubleQuotes(C)}"`),V.length&&(U=U.concat(V)),"<img "+U.join(" ")+">"},paragraph:K=>`<p>${K}</p>`,link:(K,C,W)=>typeof K!="string"?"":(K===W&&(W=removeMarkdownEscapes(W)),C=typeof C=="string"?escapeDoubleQuotes(removeMarkdownEscapes(C)):"",K=removeMarkdownEscapes(K),K=K.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;"),`<a href="${K}" title="${C||K}">${W}</a>`)});function renderMarkdown(K,C={},W={}){var V,U;const G=new DisposableStore;let Z=!1;const X=createElement(C),Q=function(se){let le;try{le=parse(decodeURIComponent(se))}catch{}return le?(le=cloneAndChange(le,ce=>{if(K.uris&&K.uris[ce])return URI.revive(K.uris[ce])}),encodeURIComponent(JSON.stringify(le))):se},J=function(se,le){const ce=K.uris&&K.uris[se];let de=URI.revive(ce);return le?se.startsWith(Schemas.data+":")?se:(de||(de=URI.parse(se)),FileAccess.uriToBrowserUri(de).toString(!0)):!de||URI.parse(se).toString()===de.toString()?se:(de.query&&(de=de.with({query:Q(de.query)})),de.toString())},ee=new marked.Renderer;ee.image=defaultMarkedRenderers.image,ee.link=defaultMarkedRenderers.link,ee.paragraph=defaultMarkedRenderers.paragraph;const te=[],ie=[];if(C.codeBlockRendererSync?ee.code=(se,le)=>{const ce=defaultGenerator.nextId(),de=C.codeBlockRendererSync(postProcessCodeBlockLanguageId(le),se);return ie.push([ce,de]),`<div class="code" data-code="${ce}">${escape(se)}</div>`}:C.codeBlockRenderer&&(ee.code=(se,le)=>{const ce=defaultGenerator.nextId(),de=C.codeBlockRenderer(postProcessCodeBlockLanguageId(le),se);return te.push(de.then(ue=>[ce,ue])),`<div class="code" data-code="${ce}">${escape(se)}</div>`}),C.actionHandler){const se=function(de){let ue=de.target;if(!(ue.tagName!=="A"&&(ue=ue.parentElement,!ue||ue.tagName!=="A")))try{let ge=ue.dataset.href;ge&&(K.baseUri&&(ge=resolveWithBaseUri(URI.from(K.baseUri),ge)),C.actionHandler.callback(ge,de))}catch(ge){onUnexpectedError(ge)}finally{de.preventDefault()}},le=C.actionHandler.disposables.add(new DomEmitter(X,"click")),ce=C.actionHandler.disposables.add(new DomEmitter(X,"auxclick"));C.actionHandler.disposables.add(Event$1.any(le.event,ce.event)(de=>{const ue=new StandardMouseEvent(de);!ue.leftButton&&!ue.middleButton||se(ue)})),C.actionHandler.disposables.add(addDisposableListener(X,"keydown",de=>{const ue=new StandardKeyboardEvent(de);!ue.equals(10)&&!ue.equals(3)||se(ue)}))}K.supportHtml||(W.sanitizer=se=>(K.isTrusted?se.match(/^(<span[^>]+>)|(<\/\s*span>)$/):void 0)?se:"",W.sanitize=!0,W.silent=!0),W.renderer=ee;let ne=(V=K.value)!==null&&V!==void 0?V:"";ne.length>1e5&&(ne=`${ne.substr(0,1e5)}…`),K.supportThemeIcons&&(ne=markdownEscapeEscapedIcons(ne));let oe;if(C.fillInIncompleteTokens){const se=Object.assign(Object.assign({},marked.defaults),W),le=marked.lexer(ne,se),ce=fillInIncompleteTokens(le);oe=marked.parser(ce,se)}else oe=marked.parse(ne,W);K.supportThemeIcons&&(oe=renderLabelWithIcons(oe).map(le=>typeof le=="string"?le:le.outerHTML).join(""));const ae=new DOMParser().parseFromString(sanitizeRenderedMarkdown(K,oe),"text/html");if(ae.body.querySelectorAll("img").forEach(se=>{const le=se.getAttribute("src");if(le){let ce=le;try{K.baseUri&&(ce=resolveWithBaseUri(URI.from(K.baseUri),ce))}catch{}se.src=J(ce,!0)}}),ae.body.querySelectorAll("a").forEach(se=>{const le=se.getAttribute("href");if(se.setAttribute("href",""),!le||/^data:|javascript:/i.test(le)||/^command:/i.test(le)&&!K.isTrusted||/^command:(\/\/\/)?_workbench\.downloadResource/i.test(le))se.replaceWith(...se.childNodes);else{let ce=J(le,!1);K.baseUri&&(ce=resolveWithBaseUri(URI.from(K.baseUri),le)),se.dataset.href=ce}}),X.innerHTML=sanitizeRenderedMarkdown(K,ae.body.innerHTML),te.length>0)Promise.all(te).then(se=>{var le,ce;if(Z)return;const de=new Map(se),ue=X.querySelectorAll("div[data-code]");for(const ge of ue){const he=de.get((le=ge.dataset.code)!==null&&le!==void 0?le:"");he&&reset(ge,he)}(ce=C.asyncRenderCallback)===null||ce===void 0||ce.call(C)});else if(ie.length>0){const se=new Map(ie),le=X.querySelectorAll("div[data-code]");for(const ce of le){const de=se.get((U=ce.dataset.code)!==null&&U!==void 0?U:"");de&&reset(ce,de)}}if(C.asyncRenderCallback)for(const se of X.getElementsByTagName("img")){const le=G.add(addDisposableListener(se,"load",()=>{le.dispose(),C.asyncRenderCallback()}))}return{element:X,dispose:()=>{Z=!0,G.dispose()}}}function postProcessCodeBlockLanguageId(K){if(!K)return"";const C=K.split(/[\s+|:|,|\{|\?]/,1);return C.length?C[0]:K}function resolveWithBaseUri(K,C){return/^\w[\w\d+.-]*:/.test(C)?C:K.path.endsWith("/")?resolvePath(K,C).toString():resolvePath(dirname(K),C).toString()}function sanitizeRenderedMarkdown(K,C){const{config:W,allowedSchemes:V}=getSanitizerOptions(K);addHook("uponSanitizeAttribute",(G,Z)=>{if(Z.attrName==="style"||Z.attrName==="class"){if(G.tagName==="SPAN"){if(Z.attrName==="style"){Z.keepAttr=/^(color\:(#[0-9a-fA-F]+|var\(--vscode(-[a-zA-Z]+)+\));)?(background-color\:(#[0-9a-fA-F]+|var\(--vscode(-[a-zA-Z]+)+\));)?$/.test(Z.attrValue);return}else if(Z.attrName==="class"){Z.keepAttr=/^codicon codicon-[a-z\-]+( codicon-modifier-[a-z\-]+)?$/.test(Z.attrValue);return}}Z.keepAttr=!1;return}});const U=hookDomPurifyHrefAndSrcSanitizer(V);try{return sanitize$1(C,Object.assign(Object.assign({},W),{RETURN_TRUSTED_TYPE:!0}))}finally{removeHook("uponSanitizeAttribute"),U.dispose()}}const allowedMarkdownAttr=["align","autoplay","alt","class","controls","data-code","data-href","height","href","loop","muted","playsinline","poster","src","style","target","title","width","start"];function getSanitizerOptions(K){const C=[Schemas.http,Schemas.https,Schemas.mailto,Schemas.data,Schemas.file,Schemas.vscodeFileResource,Schemas.vscodeRemote,Schemas.vscodeRemoteResource];return K.isTrusted&&C.push(Schemas.command),{config:{ALLOWED_TAGS:[...basicMarkupHtmlTags],ALLOWED_ATTR:allowedMarkdownAttr,ALLOW_UNKNOWN_PROTOCOLS:!0},allowedSchemes:C}}function renderStringAsPlaintext(K){return typeof K=="string"?K:renderMarkdownAsPlaintext(K)}function renderMarkdownAsPlaintext(K){var C;let W=(C=K.value)!==null&&C!==void 0?C:"";W.length>1e5&&(W=`${W.substr(0,1e5)}…`);const V=marked.parse(W,{renderer:plainTextRenderer.value}).replace(/&(#\d+|[a-zA-Z]+);/g,U=>{var G;return(G=unescapeInfo.get(U))!==null&&G!==void 0?G:U});return sanitizeRenderedMarkdown({isTrusted:!1},V).toString()}const unescapeInfo=new Map([["&quot;",'"'],["&nbsp;"," "],["&amp;","&"],["&#39;","'"],["&lt;","<"],["&gt;",">"]]),plainTextRenderer=new Lazy(()=>{const K=new marked.Renderer;return K.code=C=>C,K.blockquote=C=>C,K.html=C=>"",K.heading=(C,W,V)=>C+`
`,K.hr=()=>"",K.list=(C,W)=>C,K.listitem=C=>C+`
`,K.paragraph=C=>C+`
`,K.table=(C,W)=>C+W+`
`,K.tablerow=C=>C,K.tablecell=(C,W)=>C+" ",K.strong=C=>C,K.em=C=>C,K.codespan=C=>C,K.br=()=>`
`,K.del=C=>C,K.image=(C,W,V)=>"",K.text=C=>C,K.link=(C,W,V)=>V,K});function mergeRawTokenText(K){let C="";return K.forEach(W=>{C+=W.raw}),C}function completeSingleLinePattern(K){for(const C of K.tokens)if(C.type==="text"){const W=C.raw.split(`
`),V=W[W.length-1];if(V.includes("`"))return completeCodespan(K);if(V.includes("**"))return completeDoublestar(K);if(V.match(/\*\w/))return completeStar(K);if(V.match(/(^|\s)__\w/))return completeDoubleUnderscore(K);if(V.match(/(^|\s)_\w/))return completeUnderscore(K);if(V.match(/(^|\s)\[.*\]\(\w*/))return completeLinkTarget(K);if(V.match(/(^|\s)\[\w/))return completeLinkText(K)}}function fillInIncompleteTokens(K){let C,W;for(C=0;C<K.length;C++){const V=K[C];if(V.type==="paragraph"&&V.raw.match(/(\n|^)```/)){W=completeCodeBlock(K.slice(C));break}if(V.type==="paragraph"&&V.raw.match(/(\n|^)\|/)){W=completeTable(K.slice(C));break}if(C===K.length-1&&V.type==="paragraph"){const U=completeSingleLinePattern(V);if(U){W=[U];break}}}if(W){const V=[...K.slice(0,C),...W];return V.links=K.links,V}return K}function completeCodeBlock(K){const C=mergeRawTokenText(K);return marked.lexer(C+"\n```")}function completeCodespan(K){return completeWithString(K,"`")}function completeStar(K){return completeWithString(K,"*")}function completeUnderscore(K){return completeWithString(K,"_")}function completeLinkTarget(K){return completeWithString(K,")")}function completeLinkText(K){return completeWithString(K,"](about:blank)")}function completeDoublestar(K){return completeWithString(K,"**")}function completeDoubleUnderscore(K){return completeWithString(K,"__")}function completeWithString(K,C){const W=mergeRawTokenText(Array.isArray(K)?K:[K]);return marked.lexer(W+C)[0]}function completeTable(K){const C=mergeRawTokenText(K),W=C.split(`
`);let V,U=!1;for(let G=0;G<W.length;G++){const Z=W[G].trim();if(typeof V>"u"&&Z.match(/^\s*\|/)){const X=Z.match(/(\|[^\|]+)(?=\||$)/g);X&&(V=X.length)}else if(typeof V=="number")if(Z.match(/^\s*\|/)){if(G!==W.length-1)return;U=!0}else return}if(typeof V=="number"&&V>0){const G=U?W.slice(0,-1).join(`
`):C,Z=!!G.match(/\|\s*$/),X=G+(Z?"":"|")+`
|${" --- |".repeat(V)}`;return marked.lexer(X)}}class CombinedSpliceable{constructor(C){this.spliceables=C}splice(C,W,V){this.spliceables.forEach(U=>U.splice(C,W,V))}}const list$2="";class ListError extends Error{constructor(C,W){super(`ListError [${C}] ${W}`)}}function groupIntersect(K,C){const W=[];for(const V of C){if(K.start>=V.range.end)continue;if(K.end<V.range.start)break;const U=Range$1.intersect(K,V.range);Range$1.isEmpty(U)||W.push({range:U,size:V.size})}return W}function shift({start:K,end:C},W){return{start:K+W,end:C+W}}function consolidate(K){const C=[];let W=null;for(const V of K){const U=V.range.start,G=V.range.end,Z=V.size;if(W&&Z===W.size){W.range.end=G;continue}W={range:{start:U,end:G},size:Z},C.push(W)}return C}function concat$3(...K){return consolidate(K.reduce((C,W)=>C.concat(W),[]))}class RangeMap{get paddingTop(){return this._paddingTop}set paddingTop(C){this._size=this._size+C-this._paddingTop,this._paddingTop=C}constructor(C){this.groups=[],this._size=0,this._paddingTop=0,this._paddingTop=C??0,this._size=this._paddingTop}splice(C,W,V=[]){const U=V.length-W,G=groupIntersect({start:0,end:C},this.groups),Z=groupIntersect({start:C+W,end:Number.POSITIVE_INFINITY},this.groups).map(Q=>({range:shift(Q.range,U),size:Q.size})),X=V.map((Q,J)=>({range:{start:C+J,end:C+J+1},size:Q.size}));this.groups=concat$3(G,X,Z),this._size=this._paddingTop+this.groups.reduce((Q,J)=>Q+J.size*(J.range.end-J.range.start),0)}get count(){const C=this.groups.length;return C?this.groups[C-1].range.end:0}get size(){return this._size}indexAt(C){if(C<0)return-1;if(C<this._paddingTop)return 0;let W=0,V=this._paddingTop;for(const U of this.groups){const G=U.range.end-U.range.start,Z=V+G*U.size;if(C<Z)return W+Math.floor((C-V)/U.size);W+=G,V=Z}return W}indexAfter(C){return Math.min(this.indexAt(C)+1,this.count)}positionAt(C){if(C<0)return-1;let W=0,V=0;for(const U of this.groups){const G=U.range.end-U.range.start,Z=V+G;if(C<Z)return this._paddingTop+W+(C-V)*U.size;W+=G*U.size,V=Z}return-1}}function removeFromParent(K){var C;try{(C=K.parentElement)===null||C===void 0||C.removeChild(K)}catch{}}class RowCache{constructor(C){this.renderers=C,this.cache=new Map,this.transactionNodesPendingRemoval=new Set,this.inTransaction=!1}alloc(C){let W=this.getTemplateCache(C).pop(),V=!1;if(W)V=this.transactionNodesPendingRemoval.has(W.domNode),V&&this.transactionNodesPendingRemoval.delete(W.domNode);else{const U=$$d(".monaco-list-row"),Z=this.getRenderer(C).renderTemplate(U);W={domNode:U,templateId:C,templateData:Z}}return{row:W,isReusingConnectedDomNode:V}}release(C){C&&this.releaseRow(C)}transact(C){if(this.inTransaction)throw new Error("Already in transaction");this.inTransaction=!0;try{C()}finally{for(const W of this.transactionNodesPendingRemoval)this.doRemoveNode(W);this.transactionNodesPendingRemoval.clear(),this.inTransaction=!1}}releaseRow(C){const{domNode:W,templateId:V}=C;W&&(this.inTransaction?this.transactionNodesPendingRemoval.add(W):this.doRemoveNode(W)),this.getTemplateCache(V).push(C)}doRemoveNode(C){C.classList.remove("scrolling"),removeFromParent(C)}getTemplateCache(C){let W=this.cache.get(C);return W||(W=[],this.cache.set(C,W)),W}dispose(){this.cache.forEach((C,W)=>{for(const V of C)this.getRenderer(W).disposeTemplate(V.templateData),V.templateData=null}),this.cache.clear(),this.transactionNodesPendingRemoval.clear()}getRenderer(C){const W=this.renderers.get(C);if(!W)throw new Error(`No renderer found for ${C}`);return W}}var __decorate$1T=globalThis&&globalThis.__decorate||function(K,C,W,V){var U=arguments.length,G=U<3?C:V===null?V=Object.getOwnPropertyDescriptor(C,W):V,Z;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")G=Reflect.decorate(K,C,W,V);else for(var X=K.length-1;X>=0;X--)(Z=K[X])&&(G=(U<3?Z(G):U>3?Z(C,W,G):Z(C,W))||G);return U>3&&G&&Object.defineProperty(C,W,G),G};const StaticDND={CurrentDragAndDropData:void 0},DefaultOptions$1={useShadows:!0,verticalScrollMode:1,setRowLineHeight:!0,setRowHeight:!0,supportDynamicHeights:!1,dnd:{getDragElements(K){return[K]},getDragURI(){return null},onDragStart(){},onDragOver(){return!1},drop(){},dispose(){}},horizontalScrolling:!1,transformOptimization:!0,alwaysConsumeMouseWheel:!0};class ElementsDragAndDropData{constructor(C){this.elements=C}update(){}getData(){return this.elements}}class ExternalElementsDragAndDropData{constructor(C){this.elements=C}update(){}getData(){return this.elements}}class NativeDragAndDropData{constructor(){this.types=[],this.files=[]}update(C){if(C.types&&this.types.splice(0,this.types.length,...C.types),C.files){this.files.splice(0,this.files.length);for(let W=0;W<C.files.length;W++){const V=C.files.item(W);V&&(V.size||V.type)&&this.files.push(V)}}}getData(){return{types:this.types,files:this.files}}}function equalsDragFeedback(K,C){return Array.isArray(K)&&Array.isArray(C)?equals$5(K,C):K===C}class ListViewAccessibilityProvider{constructor(C){C!=null&&C.getSetSize?this.getSetSize=C.getSetSize.bind(C):this.getSetSize=(W,V,U)=>U,C!=null&&C.getPosInSet?this.getPosInSet=C.getPosInSet.bind(C):this.getPosInSet=(W,V)=>V+1,C!=null&&C.getRole?this.getRole=C.getRole.bind(C):this.getRole=W=>"listitem",C!=null&&C.isChecked?this.isChecked=C.isChecked.bind(C):this.isChecked=W=>{}}}class ListView{get contentHeight(){return this.rangeMap.size}get onDidScroll(){return this.scrollableElement.onScroll}get horizontalScrolling(){return this._horizontalScrolling}set horizontalScrolling(C){if(C!==this._horizontalScrolling){if(C&&this.supportDynamicHeights)throw new Error("Horizontal scrolling and dynamic heights not supported simultaneously");if(this._horizontalScrolling=C,this.domNode.classList.toggle("horizontal-scrolling",this._horizontalScrolling),this._horizontalScrolling){for(const W of this.items)this.measureItemWidth(W);this.updateScrollWidth(),this.scrollableElement.setScrollDimensions({width:getContentWidth(this.domNode)}),this.rowsContainer.style.width=`${Math.max(this.scrollWidth||0,this.renderWidth)}px`}else this.scrollableElementWidthDelayer.cancel(),this.scrollableElement.setScrollDimensions({width:this.renderWidth,scrollWidth:this.renderWidth}),this.rowsContainer.style.width=""}}constructor(C,W,V,U=DefaultOptions$1){var G,Z,X,Q,J,ee,te,ie,ne,oe,re,ae,se;if(this.virtualDelegate=W,this.domId=`list_id_${++ListView.InstanceCount}`,this.renderers=new Map,this.renderWidth=0,this._scrollHeight=0,this.scrollableElementUpdateDisposable=null,this.scrollableElementWidthDelayer=new Delayer(50),this.splicing=!1,this.dragOverAnimationStopDisposable=Disposable.None,this.dragOverMouseY=0,this.canDrop=!1,this.currentDragFeedbackDisposable=Disposable.None,this.onDragLeaveTimeout=Disposable.None,this.disposables=new DisposableStore,this._onDidChangeContentHeight=new Emitter$1,this._onDidChangeContentWidth=new Emitter$1,this._horizontalScrolling=!1,U.horizontalScrolling&&U.supportDynamicHeights)throw new Error("Horizontal scrolling and dynamic heights not supported simultaneously");this.items=[],this.itemId=0,this.rangeMap=new RangeMap((G=U.paddingTop)!==null&&G!==void 0?G:0);for(const ce of V)this.renderers.set(ce.templateId,ce);this.cache=this.disposables.add(new RowCache(this.renderers)),this.lastRenderTop=0,this.lastRenderHeight=0,this.domNode=document.createElement("div"),this.domNode.className="monaco-list",this.domNode.classList.add(this.domId),this.domNode.tabIndex=0,this.domNode.classList.toggle("mouse-support",typeof U.mouseSupport=="boolean"?U.mouseSupport:!0),this._horizontalScrolling=(Z=U.horizontalScrolling)!==null&&Z!==void 0?Z:DefaultOptions$1.horizontalScrolling,this.domNode.classList.toggle("horizontal-scrolling",this._horizontalScrolling),this.paddingBottom=typeof U.paddingBottom>"u"?0:U.paddingBottom,this.accessibilityProvider=new ListViewAccessibilityProvider(U.accessibilityProvider),this.rowsContainer=document.createElement("div"),this.rowsContainer.className="monaco-list-rows",((X=U.transformOptimization)!==null&&X!==void 0?X:DefaultOptions$1.transformOptimization)&&(this.rowsContainer.style.transform="translate3d(0px, 0px, 0px)",this.rowsContainer.style.overflow="hidden",this.rowsContainer.style.contain="strict"),this.disposables.add(Gesture.addTarget(this.rowsContainer)),this.scrollable=this.disposables.add(new Scrollable({forceIntegerValues:!0,smoothScrollDuration:(Q=U.smoothScrolling)!==null&&Q!==void 0&&Q?125:0,scheduleAtNextAnimationFrame:ce=>scheduleAtNextAnimationFrame(ce)})),this.scrollableElement=this.disposables.add(new SmoothScrollableElement(this.rowsContainer,{alwaysConsumeMouseWheel:(J=U.alwaysConsumeMouseWheel)!==null&&J!==void 0?J:DefaultOptions$1.alwaysConsumeMouseWheel,horizontal:1,vertical:(ee=U.verticalScrollMode)!==null&&ee!==void 0?ee:DefaultOptions$1.verticalScrollMode,useShadows:(te=U.useShadows)!==null&&te!==void 0?te:DefaultOptions$1.useShadows,mouseWheelScrollSensitivity:U.mouseWheelScrollSensitivity,fastScrollSensitivity:U.fastScrollSensitivity,scrollByPage:U.scrollByPage},this.scrollable)),this.domNode.appendChild(this.scrollableElement.getDomNode()),C.appendChild(this.domNode),this.scrollableElement.onScroll(this.onScroll,this,this.disposables),this.disposables.add(addDisposableListener(this.rowsContainer,EventType.Change,ce=>this.onTouchChange(ce))),this.disposables.add(addDisposableListener(this.scrollableElement.getDomNode(),"scroll",ce=>ce.target.scrollTop=0)),this.disposables.add(addDisposableListener(this.domNode,"dragover",ce=>this.onDragOver(this.toDragEvent(ce)))),this.disposables.add(addDisposableListener(this.domNode,"drop",ce=>this.onDrop(this.toDragEvent(ce)))),this.disposables.add(addDisposableListener(this.domNode,"dragleave",ce=>this.onDragLeave(this.toDragEvent(ce)))),this.disposables.add(addDisposableListener(this.domNode,"dragend",ce=>this.onDragEnd(ce))),this.setRowLineHeight=(ie=U.setRowLineHeight)!==null&&ie!==void 0?ie:DefaultOptions$1.setRowLineHeight,this.setRowHeight=(ne=U.setRowHeight)!==null&&ne!==void 0?ne:DefaultOptions$1.setRowHeight,this.supportDynamicHeights=(oe=U.supportDynamicHeights)!==null&&oe!==void 0?oe:DefaultOptions$1.supportDynamicHeights,this.dnd=(re=U.dnd)!==null&&re!==void 0?re:this.disposables.add(DefaultOptions$1.dnd),this.layout((ae=U.initialSize)===null||ae===void 0?void 0:ae.height,(se=U.initialSize)===null||se===void 0?void 0:se.width)}updateOptions(C){C.paddingBottom!==void 0&&(this.paddingBottom=C.paddingBottom,this.scrollableElement.setScrollDimensions({scrollHeight:this.scrollHeight})),C.smoothScrolling!==void 0&&this.scrollable.setSmoothScrollDuration(C.smoothScrolling?125:0),C.horizontalScrolling!==void 0&&(this.horizontalScrolling=C.horizontalScrolling);let W;if(C.scrollByPage!==void 0&&(W=Object.assign(Object.assign({},W??{}),{scrollByPage:C.scrollByPage})),C.mouseWheelScrollSensitivity!==void 0&&(W=Object.assign(Object.assign({},W??{}),{mouseWheelScrollSensitivity:C.mouseWheelScrollSensitivity})),C.fastScrollSensitivity!==void 0&&(W=Object.assign(Object.assign({},W??{}),{fastScrollSensitivity:C.fastScrollSensitivity})),W&&this.scrollableElement.updateOptions(W),C.paddingTop!==void 0&&C.paddingTop!==this.rangeMap.paddingTop){const V=this.getRenderRange(this.lastRenderTop,this.lastRenderHeight),U=C.paddingTop-this.rangeMap.paddingTop;this.rangeMap.paddingTop=C.paddingTop,this.render(V,Math.max(0,this.lastRenderTop+U),this.lastRenderHeight,void 0,void 0,!0),this.setScrollTop(this.lastRenderTop),this.eventuallyUpdateScrollDimensions(),this.supportDynamicHeights&&this._rerender(this.lastRenderTop,this.lastRenderHeight)}}splice(C,W,V=[]){if(this.splicing)throw new Error("Can't run recursive splices.");this.splicing=!0;try{return this._splice(C,W,V)}finally{this.splicing=!1,this._onDidChangeContentHeight.fire(this.contentHeight)}}_splice(C,W,V=[]){const U=this.getRenderRange(this.lastRenderTop,this.lastRenderHeight),G={start:C,end:C+W},Z=Range$1.intersect(U,G),X=new Map;for(let ge=Z.end-1;ge>=Z.start;ge--){const he=this.items[ge];if(he.dragStartDisposable.dispose(),he.checkedDisposable.dispose(),he.row){let fe=X.get(he.templateId);fe||(fe=[],X.set(he.templateId,fe));const pe=this.renderers.get(he.templateId);pe&&pe.disposeElement&&pe.disposeElement(he.element,ge,he.row.templateData,he.size),fe.push(he.row)}he.row=null}const Q={start:C+W,end:this.items.length},J=Range$1.intersect(Q,U),ee=Range$1.relativeComplement(Q,U),te=V.map(ge=>({id:String(this.itemId++),element:ge,templateId:this.virtualDelegate.getTemplateId(ge),size:this.virtualDelegate.getHeight(ge),width:void 0,hasDynamicHeight:!!this.virtualDelegate.hasDynamicHeight&&this.virtualDelegate.hasDynamicHeight(ge),lastDynamicHeightWidth:void 0,row:null,uri:void 0,dropTarget:!1,dragStartDisposable:Disposable.None,checkedDisposable:Disposable.None}));let ie;C===0&&W>=this.items.length?(this.rangeMap=new RangeMap(this.rangeMap.paddingTop),this.rangeMap.splice(0,0,te),ie=this.items,this.items=te):(this.rangeMap.splice(C,W,te),ie=this.items.splice(C,W,...te));const ne=V.length-W,oe=this.getRenderRange(this.lastRenderTop,this.lastRenderHeight),re=shift(J,ne),ae=Range$1.intersect(oe,re);for(let ge=ae.start;ge<ae.end;ge++)this.updateItemInDOM(this.items[ge],ge);const se=Range$1.relativeComplement(re,oe);for(const ge of se)for(let he=ge.start;he<ge.end;he++)this.removeItemFromDOM(he);const le=ee.map(ge=>shift(ge,ne)),de=[{start:C,end:C+V.length},...le].map(ge=>Range$1.intersect(oe,ge)),ue=this.getNextToLastElement(de);for(const ge of de)for(let he=ge.start;he<ge.end;he++){const fe=this.items[he],pe=X.get(fe.templateId),Se=pe==null?void 0:pe.pop();this.insertItemInDOM(he,ue,Se)}for(const ge of X.values())for(const he of ge)this.cache.release(he);return this.eventuallyUpdateScrollDimensions(),this.supportDynamicHeights&&this._rerender(this.scrollTop,this.renderHeight),ie.map(ge=>ge.element)}eventuallyUpdateScrollDimensions(){this._scrollHeight=this.contentHeight,this.rowsContainer.style.height=`${this._scrollHeight}px`,this.scrollableElementUpdateDisposable||(this.scrollableElementUpdateDisposable=scheduleAtNextAnimationFrame(()=>{this.scrollableElement.setScrollDimensions({scrollHeight:this.scrollHeight}),this.updateScrollWidth(),this.scrollableElementUpdateDisposable=null}))}eventuallyUpdateScrollWidth(){if(!this.horizontalScrolling){this.scrollableElementWidthDelayer.cancel();return}this.scrollableElementWidthDelayer.trigger(()=>this.updateScrollWidth())}updateScrollWidth(){if(!this.horizontalScrolling)return;let C=0;for(const W of this.items)typeof W.width<"u"&&(C=Math.max(C,W.width));this.scrollWidth=C,this.scrollableElement.setScrollDimensions({scrollWidth:C===0?0:C+10}),this._onDidChangeContentWidth.fire(this.scrollWidth)}rerender(){if(this.supportDynamicHeights){for(const C of this.items)C.lastDynamicHeightWidth=void 0;this._rerender(this.lastRenderTop,this.lastRenderHeight)}}get length(){return this.items.length}get renderHeight(){return this.scrollableElement.getScrollDimensions().height}get firstVisibleIndex(){const C=this.getRenderRange(this.lastRenderTop,this.lastRenderHeight),W=this.rangeMap.positionAt(C.start),V=this.rangeMap.positionAt(C.start+1);return V!==-1&&(V-W)/2+W<this.scrollTop?C.start+1:C.start}element(C){return this.items[C].element}domElement(C){const W=this.items[C].row;return W&&W.domNode}elementHeight(C){return this.items[C].size}elementTop(C){return this.rangeMap.positionAt(C)}indexAt(C){return this.rangeMap.indexAt(C)}indexAfter(C){return this.rangeMap.indexAfter(C)}layout(C,W){const V={height:typeof C=="number"?C:getContentHeight(this.domNode)};this.scrollableElementUpdateDisposable&&(this.scrollableElementUpdateDisposable.dispose(),this.scrollableElementUpdateDisposable=null,V.scrollHeight=this.scrollHeight),this.scrollableElement.setScrollDimensions(V),typeof W<"u"&&(this.renderWidth=W,this.supportDynamicHeights&&this._rerender(this.scrollTop,this.renderHeight)),this.horizontalScrolling&&this.scrollableElement.setScrollDimensions({width:typeof W=="number"?W:getContentWidth(this.domNode)})}render(C,W,V,U,G,Z=!1){const X=this.getRenderRange(W,V),Q=Range$1.relativeComplement(X,C),J=Range$1.relativeComplement(C,X),ee=this.getNextToLastElement(Q);if(Z){const te=Range$1.intersect(C,X);for(let ie=te.start;ie<te.end;ie++)this.updateItemInDOM(this.items[ie],ie)}this.cache.transact(()=>{for(const te of J)for(let ie=te.start;ie<te.end;ie++)this.removeItemFromDOM(ie);for(const te of Q)for(let ie=te.start;ie<te.end;ie++)this.insertItemInDOM(ie,ee)}),U!==void 0&&(this.rowsContainer.style.left=`-${U}px`),this.rowsContainer.style.top=`-${W}px`,this.horizontalScrolling&&G!==void 0&&(this.rowsContainer.style.width=`${Math.max(G,this.renderWidth)}px`),this.lastRenderTop=W,this.lastRenderHeight=V}insertItemInDOM(C,W,V){const U=this.items[C];let G=!1;if(!U.row)if(V)U.row=V;else{const ee=this.cache.alloc(U.templateId);U.row=ee.row,G=ee.isReusingConnectedDomNode}const Z=this.accessibilityProvider.getRole(U.element)||"listitem";U.row.domNode.setAttribute("role",Z);const X=this.accessibilityProvider.isChecked(U.element);if(typeof X=="boolean")U.row.domNode.setAttribute("aria-checked",String(!!X));else if(X){const ee=te=>U.row.domNode.setAttribute("aria-checked",String(!!te));ee(X.value),U.checkedDisposable=X.onDidChange(ee)}(G||!U.row.domNode.parentElement)&&(W?this.rowsContainer.insertBefore(U.row.domNode,W):this.rowsContainer.appendChild(U.row.domNode)),this.updateItemInDOM(U,C);const Q=this.renderers.get(U.templateId);if(!Q)throw new Error(`No renderer found for template id ${U.templateId}`);Q==null||Q.renderElement(U.element,C,U.row.templateData,U.size);const J=this.dnd.getDragURI(U.element);U.dragStartDisposable.dispose(),U.row.domNode.draggable=!!J,J&&(U.dragStartDisposable=addDisposableListener(U.row.domNode,"dragstart",ee=>this.onDragStart(U.element,J,ee))),this.horizontalScrolling&&(this.measureItemWidth(U),this.eventuallyUpdateScrollWidth())}measureItemWidth(C){if(!C.row||!C.row.domNode)return;C.row.domNode.style.width="fit-content",C.width=getContentWidth(C.row.domNode);const W=window.getComputedStyle(C.row.domNode);W.paddingLeft&&(C.width+=parseFloat(W.paddingLeft)),W.paddingRight&&(C.width+=parseFloat(W.paddingRight)),C.row.domNode.style.width=""}updateItemInDOM(C,W){C.row.domNode.style.top=`${this.elementTop(W)}px`,this.setRowHeight&&(C.row.domNode.style.height=`${C.size}px`),this.setRowLineHeight&&(C.row.domNode.style.lineHeight=`${C.size}px`),C.row.domNode.setAttribute("data-index",`${W}`),C.row.domNode.setAttribute("data-last-element",W===this.length-1?"true":"false"),C.row.domNode.setAttribute("data-parity",W%2===0?"even":"odd"),C.row.domNode.setAttribute("aria-setsize",String(this.accessibilityProvider.getSetSize(C.element,W,this.length))),C.row.domNode.setAttribute("aria-posinset",String(this.accessibilityProvider.getPosInSet(C.element,W))),C.row.domNode.setAttribute("id",this.getElementDomId(W)),C.row.domNode.classList.toggle("drop-target",C.dropTarget)}removeItemFromDOM(C){const W=this.items[C];if(W.dragStartDisposable.dispose(),W.checkedDisposable.dispose(),W.row){const V=this.renderers.get(W.templateId);V&&V.disposeElement&&V.disposeElement(W.element,C,W.row.templateData,W.size),this.cache.release(W.row),W.row=null}this.horizontalScrolling&&this.eventuallyUpdateScrollWidth()}getScrollTop(){return this.scrollableElement.getScrollPosition().scrollTop}setScrollTop(C,W){this.scrollableElementUpdateDisposable&&(this.scrollableElementUpdateDisposable.dispose(),this.scrollableElementUpdateDisposable=null,this.scrollableElement.setScrollDimensions({scrollHeight:this.scrollHeight})),this.scrollableElement.setScrollPosition({scrollTop:C,reuseAnimation:W})}get scrollTop(){return this.getScrollTop()}set scrollTop(C){this.setScrollTop(C)}get scrollHeight(){return this._scrollHeight+(this.horizontalScrolling?10:0)+this.paddingBottom}get onMouseClick(){return Event$1.map(this.disposables.add(new DomEmitter(this.domNode,"click")).event,C=>this.toMouseEvent(C),this.disposables)}get onMouseDblClick(){return Event$1.map(this.disposables.add(new DomEmitter(this.domNode,"dblclick")).event,C=>this.toMouseEvent(C),this.disposables)}get onMouseMiddleClick(){return Event$1.filter(Event$1.map(this.disposables.add(new DomEmitter(this.domNode,"auxclick")).event,C=>this.toMouseEvent(C),this.disposables),C=>C.browserEvent.button===1,this.disposables)}get onMouseDown(){return Event$1.map(this.disposables.add(new DomEmitter(this.domNode,"mousedown")).event,C=>this.toMouseEvent(C),this.disposables)}get onMouseOver(){return Event$1.map(this.disposables.add(new DomEmitter(this.domNode,"mouseover")).event,C=>this.toMouseEvent(C),this.disposables)}get onMouseOut(){return Event$1.map(this.disposables.add(new DomEmitter(this.domNode,"mouseout")).event,C=>this.toMouseEvent(C),this.disposables)}get onContextMenu(){return Event$1.any(Event$1.map(this.disposables.add(new DomEmitter(this.domNode,"contextmenu")).event,C=>this.toMouseEvent(C),this.disposables),Event$1.map(this.disposables.add(new DomEmitter(this.domNode,EventType.Contextmenu)).event,C=>this.toGestureEvent(C),this.disposables))}get onTouchStart(){return Event$1.map(this.disposables.add(new DomEmitter(this.domNode,"touchstart")).event,C=>this.toTouchEvent(C),this.disposables)}get onTap(){return Event$1.map(this.disposables.add(new DomEmitter(this.rowsContainer,EventType.Tap)).event,C=>this.toGestureEvent(C),this.disposables)}toMouseEvent(C){const W=this.getItemIndexFromEventTarget(C.target||null),V=typeof W>"u"?void 0:this.items[W],U=V&&V.element;return{browserEvent:C,index:W,element:U}}toTouchEvent(C){const W=this.getItemIndexFromEventTarget(C.target||null),V=typeof W>"u"?void 0:this.items[W],U=V&&V.element;return{browserEvent:C,index:W,element:U}}toGestureEvent(C){const W=this.getItemIndexFromEventTarget(C.initialTarget||null),V=typeof W>"u"?void 0:this.items[W],U=V&&V.element;return{browserEvent:C,index:W,element:U}}toDragEvent(C){const W=this.getItemIndexFromEventTarget(C.target||null),V=typeof W>"u"?void 0:this.items[W],U=V&&V.element;return{browserEvent:C,index:W,element:U}}onScroll(C){try{const W=this.getRenderRange(this.lastRenderTop,this.lastRenderHeight);this.render(W,C.scrollTop,C.height,C.scrollLeft,C.scrollWidth),this.supportDynamicHeights&&this._rerender(C.scrollTop,C.height,C.inSmoothScrolling)}catch(W){throw console.error("Got bad scroll event:",C),W}}onTouchChange(C){C.preventDefault(),C.stopPropagation(),this.scrollTop-=C.translationY}onDragStart(C,W,V){var U,G;if(!V.dataTransfer)return;const Z=this.dnd.getDragElements(C);if(V.dataTransfer.effectAllowed="copyMove",V.dataTransfer.setData(DataTransfers.TEXT,W),V.dataTransfer.setDragImage){let X;this.dnd.getDragLabel&&(X=this.dnd.getDragLabel(Z,V)),typeof X>"u"&&(X=String(Z.length));const Q=$$d(".monaco-drag-image");Q.textContent=X;const ee=(te=>{for(;te&&!te.classList.contains("monaco-workbench");)te=te.parentElement;return te||document.body})(this.domNode);ee.appendChild(Q),V.dataTransfer.setDragImage(Q,-10,-10),setTimeout(()=>ee.removeChild(Q),0)}this.domNode.classList.add("dragging"),this.currentDragData=new ElementsDragAndDropData(Z),StaticDND.CurrentDragAndDropData=new ExternalElementsDragAndDropData(Z),(G=(U=this.dnd).onDragStart)===null||G===void 0||G.call(U,this.currentDragData,V)}onDragOver(C){var W;if(C.browserEvent.preventDefault(),this.onDragLeaveTimeout.dispose(),StaticDND.CurrentDragAndDropData&&StaticDND.CurrentDragAndDropData.getData()==="vscode-ui"||(this.setupDragAndDropScrollTopAnimation(C.browserEvent),!C.browserEvent.dataTransfer))return!1;if(!this.currentDragData)if(StaticDND.CurrentDragAndDropData)this.currentDragData=StaticDND.CurrentDragAndDropData;else{if(!C.browserEvent.dataTransfer.types)return!1;this.currentDragData=new NativeDragAndDropData}const V=this.dnd.onDragOver(this.currentDragData,C.element,C.index,C.browserEvent);if(this.canDrop=typeof V=="boolean"?V:V.accept,!this.canDrop)return this.currentDragFeedback=void 0,this.currentDragFeedbackDisposable.dispose(),!1;C.browserEvent.dataTransfer.dropEffect=typeof V!="boolean"&&V.effect===0?"copy":"move";let U;if(typeof V!="boolean"&&V.feedback?U=V.feedback:typeof C.index>"u"?U=[-1]:U=[C.index],U=distinct(U).filter(G=>G>=-1&&G<this.length).sort((G,Z)=>G-Z),U=U[0]===-1?[-1]:U,equalsDragFeedback(this.currentDragFeedback,U))return!0;if(this.currentDragFeedback=U,this.currentDragFeedbackDisposable.dispose(),U[0]===-1)this.domNode.classList.add("drop-target"),this.rowsContainer.classList.add("drop-target"),this.currentDragFeedbackDisposable=toDisposable(()=>{this.domNode.classList.remove("drop-target"),this.rowsContainer.classList.remove("drop-target")});else{for(const G of U){const Z=this.items[G];Z.dropTarget=!0,(W=Z.row)===null||W===void 0||W.domNode.classList.add("drop-target")}this.currentDragFeedbackDisposable=toDisposable(()=>{var G;for(const Z of U){const X=this.items[Z];X.dropTarget=!1,(G=X.row)===null||G===void 0||G.domNode.classList.remove("drop-target")}})}return!0}onDragLeave(C){var W,V;this.onDragLeaveTimeout.dispose(),this.onDragLeaveTimeout=disposableTimeout(()=>this.clearDragOverFeedback(),100,this.disposables),this.currentDragData&&((V=(W=this.dnd).onDragLeave)===null||V===void 0||V.call(W,this.currentDragData,C.element,C.index,C.browserEvent))}onDrop(C){if(!this.canDrop)return;const W=this.currentDragData;this.teardownDragAndDropScrollTopAnimation(),this.clearDragOverFeedback(),this.domNode.classList.remove("dragging"),this.currentDragData=void 0,StaticDND.CurrentDragAndDropData=void 0,!(!W||!C.browserEvent.dataTransfer)&&(C.browserEvent.preventDefault(),W.update(C.browserEvent.dataTransfer),this.dnd.drop(W,C.element,C.index,C.browserEvent))}onDragEnd(C){var W,V;this.canDrop=!1,this.teardownDragAndDropScrollTopAnimation(),this.clearDragOverFeedback(),this.domNode.classList.remove("dragging"),this.currentDragData=void 0,StaticDND.CurrentDragAndDropData=void 0,(V=(W=this.dnd).onDragEnd)===null||V===void 0||V.call(W,C)}clearDragOverFeedback(){this.currentDragFeedback=void 0,this.currentDragFeedbackDisposable.dispose(),this.currentDragFeedbackDisposable=Disposable.None}setupDragAndDropScrollTopAnimation(C){if(!this.dragOverAnimationDisposable){const W=getTopLeftOffset(this.domNode).top;this.dragOverAnimationDisposable=animate(this.animateDragAndDropScrollTop.bind(this,W))}this.dragOverAnimationStopDisposable.dispose(),this.dragOverAnimationStopDisposable=disposableTimeout(()=>{this.dragOverAnimationDisposable&&(this.dragOverAnimationDisposable.dispose(),this.dragOverAnimationDisposable=void 0)},1e3,this.disposables),this.dragOverMouseY=C.pageY}animateDragAndDropScrollTop(C){if(this.dragOverMouseY===void 0)return;const W=this.dragOverMouseY-C,V=this.renderHeight-35;W<35?this.scrollTop+=Math.max(-14,Math.floor(.3*(W-35))):W>V&&(this.scrollTop+=Math.min(14,Math.floor(.3*(W-V))))}teardownDragAndDropScrollTopAnimation(){this.dragOverAnimationStopDisposable.dispose(),this.dragOverAnimationDisposable&&(this.dragOverAnimationDisposable.dispose(),this.dragOverAnimationDisposable=void 0)}getItemIndexFromEventTarget(C){const W=this.scrollableElement.getDomNode();let V=C;for(;V instanceof HTMLElement&&V!==this.rowsContainer&&W.contains(V);){const U=V.getAttribute("data-index");if(U){const G=Number(U);if(!isNaN(G))return G}V=V.parentElement}}getRenderRange(C,W){return{start:this.rangeMap.indexAt(C),end:this.rangeMap.indexAfter(C+W-1)}}_rerender(C,W,V){const U=this.getRenderRange(C,W);let G,Z;C===this.elementTop(U.start)?(G=U.start,Z=0):U.end-U.start>1&&(G=U.start+1,Z=this.elementTop(G)-C);let X=0;for(;;){const Q=this.getRenderRange(C,W);let J=!1;for(let ee=Q.start;ee<Q.end;ee++){const te=this.probeDynamicHeight(ee);te!==0&&this.rangeMap.splice(ee,1,[this.items[ee]]),X+=te,J=J||te!==0}if(!J){X!==0&&this.eventuallyUpdateScrollDimensions();const ee=Range$1.relativeComplement(U,Q);for(const ie of ee)for(let ne=ie.start;ne<ie.end;ne++)this.items[ne].row&&this.removeItemFromDOM(ne);const te=Range$1.relativeComplement(Q,U);for(const ie of te)for(let ne=ie.start;ne<ie.end;ne++){const oe=ne+1,re=oe<this.items.length?this.items[oe].row:null,ae=re?re.domNode:null;this.insertItemInDOM(ne,ae)}for(let ie=Q.start;ie<Q.end;ie++)this.items[ie].row&&this.updateItemInDOM(this.items[ie],ie);if(typeof G=="number"){const ie=this.scrollable.getFutureScrollPosition().scrollTop-C,ne=this.elementTop(G)-Z+ie;this.setScrollTop(ne,V)}this._onDidChangeContentHeight.fire(this.contentHeight);return}}}probeDynamicHeight(C){var W,V,U;const G=this.items[C];if(this.virtualDelegate.getDynamicHeight){const J=this.virtualDelegate.getDynamicHeight(G.element);if(J!==null){const ee=G.size;return G.size=J,G.lastDynamicHeightWidth=this.renderWidth,J-ee}}if(!G.hasDynamicHeight||G.lastDynamicHeightWidth===this.renderWidth||this.virtualDelegate.hasDynamicHeight&&!this.virtualDelegate.hasDynamicHeight(G.element))return 0;const Z=G.size;if(G.row)return G.row.domNode.style.height="",G.size=G.row.domNode.offsetHeight,G.lastDynamicHeightWidth=this.renderWidth,G.size-Z;const{row:X}=this.cache.alloc(G.templateId);X.domNode.style.height="",this.rowsContainer.appendChild(X.domNode);const Q=this.renderers.get(G.templateId);if(!Q)throw new BugIndicatingError("Missing renderer for templateId: "+G.templateId);return Q.renderElement(G.element,C,X.templateData,void 0),G.size=X.domNode.offsetHeight,(W=Q.disposeElement)===null||W===void 0||W.call(Q,G.element,C,X.templateData,void 0),(U=(V=this.virtualDelegate).setDynamicHeight)===null||U===void 0||U.call(V,G.element,G.size),G.lastDynamicHeightWidth=this.renderWidth,this.rowsContainer.removeChild(X.domNode),this.cache.release(X),G.size-Z}getNextToLastElement(C){const W=C[C.length-1];if(!W)return null;const V=this.items[W.end];return!V||!V.row?null:V.row.domNode}getElementDomId(C){return`${this.domId}_${C}`}dispose(){var C,W;for(const V of this.items)if(V.dragStartDisposable.dispose(),V.checkedDisposable.dispose(),V.row){const U=this.renderers.get(V.row.templateId);U&&((C=U.disposeElement)===null||C===void 0||C.call(U,V.element,-1,V.row.templateData,void 0),U.disposeTemplate(V.row.templateData))}this.items=[],this.domNode&&this.domNode.parentNode&&this.domNode.parentNode.removeChild(this.domNode),(W=this.dragOverAnimationDisposable)===null||W===void 0||W.dispose(),this.disposables.dispose()}}ListView.InstanceCount=0;__decorate$1T([memoize],ListView.prototype,"onMouseClick",null);__decorate$1T([memoize],ListView.prototype,"onMouseDblClick",null);__decorate$1T([memoize],ListView.prototype,"onMouseMiddleClick",null);__decorate$1T([memoize],ListView.prototype,"onMouseDown",null);__decorate$1T([memoize],ListView.prototype,"onMouseOver",null);__decorate$1T([memoize],ListView.prototype,"onMouseOut",null);__decorate$1T([memoize],ListView.prototype,"onContextMenu",null);__decorate$1T([memoize],ListView.prototype,"onTouchStart",null);__decorate$1T([memoize],ListView.prototype,"onTap",null);var __decorate$1S=globalThis&&globalThis.__decorate||function(K,C,W,V){var U=arguments.length,G=U<3?C:V===null?V=Object.getOwnPropertyDescriptor(C,W):V,Z;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")G=Reflect.decorate(K,C,W,V);else for(var X=K.length-1;X>=0;X--)(Z=K[X])&&(G=(U<3?Z(G):U>3?Z(C,W,G):Z(C,W))||G);return U>3&&G&&Object.defineProperty(C,W,G),G},__awaiter$1o=globalThis&&globalThis.__awaiter||function(K,C,W,V){function U(G){return G instanceof W?G:new W(function(Z){Z(G)})}return new(W||(W=Promise))(function(G,Z){function X(ee){try{J(V.next(ee))}catch(te){Z(te)}}function Q(ee){try{J(V.throw(ee))}catch(te){Z(te)}}function J(ee){ee.done?G(ee.value):U(ee.value).then(X,Q)}J((V=V.apply(K,C||[])).next())})};class TraitRenderer{constructor(C){this.trait=C,this.renderedElements=[]}get templateId(){return`template:${this.trait.name}`}renderTemplate(C){return C}renderElement(C,W,V){const U=this.renderedElements.findIndex(G=>G.templateData===V);if(U>=0){const G=this.renderedElements[U];this.trait.unrender(V),G.index=W}else{const G={index:W,templateData:V};this.renderedElements.push(G)}this.trait.renderIndex(W,V)}splice(C,W,V){const U=[];for(const G of this.renderedElements)G.index<C?U.push(G):G.index>=C+W&&U.push({index:G.index+V-W,templateData:G.templateData});this.renderedElements=U}renderIndexes(C){for(const{index:W,templateData:V}of this.renderedElements)C.indexOf(W)>-1&&this.trait.renderIndex(W,V)}disposeTemplate(C){const W=this.renderedElements.findIndex(V=>V.templateData===C);W<0||this.renderedElements.splice(W,1)}}let Trait$1=class{get name(){return this._trait}get renderer(){return new TraitRenderer(this)}constructor(C){this._trait=C,this.length=0,this.indexes=[],this.sortedIndexes=[],this._onChange=new Emitter$1,this.onChange=this._onChange.event}splice(C,W,V){var U;W=Math.max(0,Math.min(W,this.length-C));const G=V.length-W,Z=C+W,X=[];let Q=0;for(;Q<this.sortedIndexes.length&&this.sortedIndexes[Q]<C;)X.push(this.sortedIndexes[Q++]);for(let ee=0;ee<V.length;ee++)V[ee]&&X.push(ee+C);for(;Q<this.sortedIndexes.length&&this.sortedIndexes[Q]>=Z;)X.push(this.sortedIndexes[Q++]+G);const J=this.length+G;if(this.sortedIndexes.length>0&&X.length===0&&J>0){const ee=(U=this.sortedIndexes.find(te=>te>=C))!==null&&U!==void 0?U:J-1;X.push(Math.min(ee,J-1))}this.renderer.splice(C,W,V.length),this._set(X,X),this.length=J}renderIndex(C,W){W.classList.toggle(this._trait,this.contains(C))}unrender(C){C.classList.remove(this._trait)}set(C,W){return this._set(C,[...C].sort(numericSort),W)}_set(C,W,V){const U=this.indexes,G=this.sortedIndexes;this.indexes=C,this.sortedIndexes=W;const Z=disjunction(G,C);return this.renderer.renderIndexes(Z),this._onChange.fire({indexes:C,browserEvent:V}),U}get(){return this.indexes}contains(C){return binarySearch(this.sortedIndexes,C,numericSort)>=0}dispose(){dispose(this._onChange)}};__decorate$1S([memoize],Trait$1.prototype,"renderer",null);class SelectionTrait extends Trait$1{constructor(C){super("selected"),this.setAriaSelected=C}renderIndex(C,W){super.renderIndex(C,W),this.setAriaSelected&&(this.contains(C)?W.setAttribute("aria-selected","true"):W.setAttribute("aria-selected","false"))}}class TraitSpliceable{constructor(C,W,V){this.trait=C,this.view=W,this.identityProvider=V}splice(C,W,V){if(!this.identityProvider)return this.trait.splice(C,W,new Array(V.length).fill(!1));const U=this.trait.get().map(X=>this.identityProvider.getId(this.view.element(X)).toString());if(U.length===0)return this.trait.splice(C,W,new Array(V.length).fill(!1));const G=new Set(U),Z=V.map(X=>G.has(this.identityProvider.getId(X).toString()));this.trait.splice(C,W,Z)}}function isInputElement(K){return K.tagName==="INPUT"||K.tagName==="TEXTAREA"}function isMonacoEditor(K){return K.classList.contains("monaco-editor")?!0:K.classList.contains("monaco-list")||!K.parentElement?!1:isMonacoEditor(K.parentElement)}function isButton(K){return K.tagName==="A"&&K.classList.contains("monaco-button")||K.tagName==="DIV"&&K.classList.contains("monaco-button-dropdown")?!0:K.classList.contains("monaco-list")||!K.parentElement?!1:isButton(K.parentElement)}class KeyboardController{get onKeyDown(){return Event$1.chain(this.disposables.add(new DomEmitter(this.view.domNode,"keydown")).event,C=>C.filter(W=>!isInputElement(W.target)).map(W=>new StandardKeyboardEvent(W)))}constructor(C,W,V){this.list=C,this.view=W,this.disposables=new DisposableStore,this.multipleSelectionDisposables=new DisposableStore,this.multipleSelectionSupport=V.multipleSelectionSupport,this.disposables.add(this.onKeyDown(U=>{switch(U.keyCode){case 3:return this.onEnter(U);case 16:return this.onUpArrow(U);case 18:return this.onDownArrow(U);case 11:return this.onPageUpArrow(U);case 12:return this.onPageDownArrow(U);case 9:return this.onEscape(U);case 31:this.multipleSelectionSupport&&(isMacintosh?U.metaKey:U.ctrlKey)&&this.onCtrlA(U)}}))}updateOptions(C){C.multipleSelectionSupport!==void 0&&(this.multipleSelectionSupport=C.multipleSelectionSupport)}onEnter(C){C.preventDefault(),C.stopPropagation(),this.list.setSelection(this.list.getFocus(),C.browserEvent)}onUpArrow(C){C.preventDefault(),C.stopPropagation(),this.list.focusPrevious(1,!1,C.browserEvent);const W=this.list.getFocus()[0];this.list.setAnchor(W),this.list.reveal(W),this.view.domNode.focus()}onDownArrow(C){C.preventDefault(),C.stopPropagation(),this.list.focusNext(1,!1,C.browserEvent);const W=this.list.getFocus()[0];this.list.setAnchor(W),this.list.reveal(W),this.view.domNode.focus()}onPageUpArrow(C){C.preventDefault(),C.stopPropagation(),this.list.focusPreviousPage(C.browserEvent);const W=this.list.getFocus()[0];this.list.setAnchor(W),this.list.reveal(W),this.view.domNode.focus()}onPageDownArrow(C){C.preventDefault(),C.stopPropagation(),this.list.focusNextPage(C.browserEvent);const W=this.list.getFocus()[0];this.list.setAnchor(W),this.list.reveal(W),this.view.domNode.focus()}onCtrlA(C){C.preventDefault(),C.stopPropagation(),this.list.setSelection(range$2(this.list.length),C.browserEvent),this.list.setAnchor(void 0),this.view.domNode.focus()}onEscape(C){this.list.getSelection().length&&(C.preventDefault(),C.stopPropagation(),this.list.setSelection([],C.browserEvent),this.list.setAnchor(void 0),this.view.domNode.focus())}dispose(){this.disposables.dispose(),this.multipleSelectionDisposables.dispose()}}__decorate$1S([memoize],KeyboardController.prototype,"onKeyDown",null);var TypeNavigationMode;(function(K){K[K.Automatic=0]="Automatic",K[K.Trigger=1]="Trigger"})(TypeNavigationMode||(TypeNavigationMode={}));var TypeNavigationControllerState;(function(K){K[K.Idle=0]="Idle",K[K.Typing=1]="Typing"})(TypeNavigationControllerState||(TypeNavigationControllerState={}));const DefaultKeyboardNavigationDelegate=new class{mightProducePrintableCharacter(K){return K.ctrlKey||K.metaKey||K.altKey?!1:K.keyCode>=31&&K.keyCode<=56||K.keyCode>=21&&K.keyCode<=30||K.keyCode>=98&&K.keyCode<=107||K.keyCode>=85&&K.keyCode<=95}};class TypeNavigationController{constructor(C,W,V,U,G){this.list=C,this.view=W,this.keyboardNavigationLabelProvider=V,this.keyboardNavigationEventFilter=U,this.delegate=G,this.enabled=!1,this.state=TypeNavigationControllerState.Idle,this.mode=TypeNavigationMode.Automatic,this.triggered=!1,this.previouslyFocused=-1,this.enabledDisposables=new DisposableStore,this.disposables=new DisposableStore,this.updateOptions(C.options)}updateOptions(C){var W,V;!((W=C.typeNavigationEnabled)!==null&&W!==void 0)||W?this.enable():this.disable(),this.mode=(V=C.typeNavigationMode)!==null&&V!==void 0?V:TypeNavigationMode.Automatic}enable(){if(this.enabled)return;let C=!1;const W=Event$1.chain(this.enabledDisposables.add(new DomEmitter(this.view.domNode,"keydown")).event,G=>G.filter(Z=>!isInputElement(Z.target)).filter(()=>this.mode===TypeNavigationMode.Automatic||this.triggered).map(Z=>new StandardKeyboardEvent(Z)).filter(Z=>C||this.keyboardNavigationEventFilter(Z)).filter(Z=>this.delegate.mightProducePrintableCharacter(Z)).forEach(Z=>EventHelper.stop(Z,!0)).map(Z=>Z.browserEvent.key)),V=Event$1.debounce(W,()=>null,800,void 0,void 0,void 0,this.enabledDisposables);Event$1.reduce(Event$1.any(W,V),(G,Z)=>Z===null?null:(G||"")+Z,void 0,this.enabledDisposables)(this.onInput,this,this.enabledDisposables),V(this.onClear,this,this.enabledDisposables),W(()=>C=!0,void 0,this.enabledDisposables),V(()=>C=!1,void 0,this.enabledDisposables),this.enabled=!0,this.triggered=!1}disable(){this.enabled&&(this.enabledDisposables.clear(),this.enabled=!1,this.triggered=!1)}onClear(){var C;const W=this.list.getFocus();if(W.length>0&&W[0]===this.previouslyFocused){const V=(C=this.list.options.accessibilityProvider)===null||C===void 0?void 0:C.getAriaLabel(this.list.element(W[0]));V&&alert(V)}this.previouslyFocused=-1}onInput(C){if(!C){this.state=TypeNavigationControllerState.Idle,this.triggered=!1;return}const W=this.list.getFocus(),V=W.length>0?W[0]:0,U=this.state===TypeNavigationControllerState.Idle?1:0;this.state=TypeNavigationControllerState.Typing;for(let G=0;G<this.list.length;G++){const Z=(V+G+U)%this.list.length,X=this.keyboardNavigationLabelProvider.getKeyboardNavigationLabel(this.view.element(Z)),Q=X&&X.toString();if(this.list.options.typeNavigationEnabled){if(typeof Q<"u"){if(matchesPrefix(C,Q)){this.previouslyFocused=V,this.list.setFocus([Z]),this.list.reveal(Z);return}const J=matchesFuzzy2(C,Q);if(J&&J[0].end-J[0].start>1&&J.length===1){this.previouslyFocused=V,this.list.setFocus([Z]),this.list.reveal(Z);return}}}else if(typeof Q>"u"||matchesPrefix(C,Q)){this.previouslyFocused=V,this.list.setFocus([Z]),this.list.reveal(Z);return}}}dispose(){this.disable(),this.enabledDisposables.dispose(),this.disposables.dispose()}}class DOMFocusController{constructor(C,W){this.list=C,this.view=W,this.disposables=new DisposableStore;const V=Event$1.chain(this.disposables.add(new DomEmitter(W.domNode,"keydown")).event,G=>G.filter(Z=>!isInputElement(Z.target)).map(Z=>new StandardKeyboardEvent(Z)));Event$1.chain(V,G=>G.filter(Z=>Z.keyCode===2&&!Z.ctrlKey&&!Z.metaKey&&!Z.shiftKey&&!Z.altKey))(this.onTab,this,this.disposables)}onTab(C){if(C.target!==this.view.domNode)return;const W=this.list.getFocus();if(W.length===0)return;const V=this.view.domElement(W[0]);if(!V)return;const U=V.querySelector("[tabIndex]");if(!U||!(U instanceof HTMLElement)||U.tabIndex===-1)return;const G=window.getComputedStyle(U);G.visibility==="hidden"||G.display==="none"||(C.preventDefault(),C.stopPropagation(),U.focus())}dispose(){this.disposables.dispose()}}function isSelectionSingleChangeEvent(K){return isMacintosh?K.browserEvent.metaKey:K.browserEvent.ctrlKey}function isSelectionRangeChangeEvent(K){return K.browserEvent.shiftKey}function isMouseRightClick(K){return K instanceof MouseEvent&&K.button===2}const DefaultMultipleSelectionController={isSelectionSingleChangeEvent,isSelectionRangeChangeEvent};class MouseController{constructor(C){this.list=C,this.disposables=new DisposableStore,this._onPointer=new Emitter$1,this.onPointer=this._onPointer.event,C.options.multipleSelectionSupport!==!1&&(this.multipleSelectionController=this.list.options.multipleSelectionController||DefaultMultipleSelectionController),this.mouseSupport=typeof C.options.mouseSupport>"u"||!!C.options.mouseSupport,this.mouseSupport&&(C.onMouseDown(this.onMouseDown,this,this.disposables),C.onContextMenu(this.onContextMenu,this,this.disposables),C.onMouseDblClick(this.onDoubleClick,this,this.disposables),C.onTouchStart(this.onMouseDown,this,this.disposables),this.disposables.add(Gesture.addTarget(C.getHTMLElement()))),Event$1.any(C.onMouseClick,C.onMouseMiddleClick,C.onTap)(this.onViewPointer,this,this.disposables)}updateOptions(C){C.multipleSelectionSupport!==void 0&&(this.multipleSelectionController=void 0,C.multipleSelectionSupport&&(this.multipleSelectionController=this.list.options.multipleSelectionController||DefaultMultipleSelectionController))}isSelectionSingleChangeEvent(C){return this.multipleSelectionController?this.multipleSelectionController.isSelectionSingleChangeEvent(C):!1}isSelectionRangeChangeEvent(C){return this.multipleSelectionController?this.multipleSelectionController.isSelectionRangeChangeEvent(C):!1}isSelectionChangeEvent(C){return this.isSelectionSingleChangeEvent(C)||this.isSelectionRangeChangeEvent(C)}onMouseDown(C){isMonacoEditor(C.browserEvent.target)||document.activeElement!==C.browserEvent.target&&this.list.domFocus()}onContextMenu(C){if(isInputElement(C.browserEvent.target)||isMonacoEditor(C.browserEvent.target))return;const W=typeof C.index>"u"?[]:[C.index];this.list.setFocus(W,C.browserEvent)}onViewPointer(C){if(!this.mouseSupport||isInputElement(C.browserEvent.target)||isMonacoEditor(C.browserEvent.target)||C.browserEvent.isHandledByList)return;C.browserEvent.isHandledByList=!0;const W=C.index;if(typeof W>"u"){this.list.setFocus([],C.browserEvent),this.list.setSelection([],C.browserEvent),this.list.setAnchor(void 0);return}if(this.isSelectionChangeEvent(C))return this.changeSelection(C);this.list.setFocus([W],C.browserEvent),this.list.setAnchor(W),isMouseRightClick(C.browserEvent)||this.list.setSelection([W],C.browserEvent),this._onPointer.fire(C)}onDoubleClick(C){if(isInputElement(C.browserEvent.target)||isMonacoEditor(C.browserEvent.target)||this.isSelectionChangeEvent(C)||C.browserEvent.isHandledByList)return;C.browserEvent.isHandledByList=!0;const W=this.list.getFocus();this.list.setSelection(W,C.browserEvent)}changeSelection(C){const W=C.index;let V=this.list.getAnchor();if(this.isSelectionRangeChangeEvent(C)){if(typeof V>"u"){const ee=this.list.getFocus()[0];V=ee??W,this.list.setAnchor(V)}const U=Math.min(V,W),G=Math.max(V,W),Z=range$2(U,G+1),X=this.list.getSelection(),Q=getContiguousRangeContaining(disjunction(X,[V]),V);if(Q.length===0)return;const J=disjunction(Z,relativeComplement(X,Q));this.list.setSelection(J,C.browserEvent),this.list.setFocus([W],C.browserEvent)}else if(this.isSelectionSingleChangeEvent(C)){const U=this.list.getSelection(),G=U.filter(Z=>Z!==W);this.list.setFocus([W]),this.list.setAnchor(W),U.length===G.length?this.list.setSelection([...G,W],C.browserEvent):this.list.setSelection(G,C.browserEvent)}}dispose(){this.disposables.dispose()}}class DefaultStyleController{constructor(C,W){this.styleElement=C,this.selectorSuffix=W}style(C){var W,V;const U=this.selectorSuffix&&`.${this.selectorSuffix}`,G=[];C.listBackground&&G.push(`.monaco-list${U} .monaco-list-rows { background: ${C.listBackground}; }`),C.listFocusBackground&&(G.push(`.monaco-list${U}:focus .monaco-list-row.focused { background-color: ${C.listFocusBackground}; }`),G.push(`.monaco-list${U}:focus .monaco-list-row.focused:hover { background-color: ${C.listFocusBackground}; }`)),C.listFocusForeground&&G.push(`.monaco-list${U}:focus .monaco-list-row.focused { color: ${C.listFocusForeground}; }`),C.listActiveSelectionBackground&&(G.push(`.monaco-list${U}:focus .monaco-list-row.selected { background-color: ${C.listActiveSelectionBackground}; }`),G.push(`.monaco-list${U}:focus .monaco-list-row.selected:hover { background-color: ${C.listActiveSelectionBackground}; }`)),C.listActiveSelectionForeground&&G.push(`.monaco-list${U}:focus .monaco-list-row.selected { color: ${C.listActiveSelectionForeground}; }`),C.listActiveSelectionIconForeground&&G.push(`.monaco-list${U}:focus .monaco-list-row.selected .codicon { color: ${C.listActiveSelectionIconForeground}; }`),C.listFocusAndSelectionBackground&&G.push(`
				.monaco-drag-image,
				.monaco-list${U}:focus .monaco-list-row.selected.focused { background-color: ${C.listFocusAndSelectionBackground}; }
			`),C.listFocusAndSelectionForeground&&G.push(`
				.monaco-drag-image,
				.monaco-list${U}:focus .monaco-list-row.selected.focused { color: ${C.listFocusAndSelectionForeground}; }
			`),C.listInactiveFocusForeground&&(G.push(`.monaco-list${U} .monaco-list-row.focused { color:  ${C.listInactiveFocusForeground}; }`),G.push(`.monaco-list${U} .monaco-list-row.focused:hover { color:  ${C.listInactiveFocusForeground}; }`)),C.listInactiveSelectionIconForeground&&G.push(`.monaco-list${U} .monaco-list-row.focused .codicon { color:  ${C.listInactiveSelectionIconForeground}; }`),C.listInactiveFocusBackground&&(G.push(`.monaco-list${U} .monaco-list-row.focused { background-color:  ${C.listInactiveFocusBackground}; }`),G.push(`.monaco-list${U} .monaco-list-row.focused:hover { background-color:  ${C.listInactiveFocusBackground}; }`)),C.listInactiveSelectionBackground&&(G.push(`.monaco-list${U} .monaco-list-row.selected { background-color:  ${C.listInactiveSelectionBackground}; }`),G.push(`.monaco-list${U} .monaco-list-row.selected:hover { background-color:  ${C.listInactiveSelectionBackground}; }`)),C.listInactiveSelectionForeground&&G.push(`.monaco-list${U} .monaco-list-row.selected { color: ${C.listInactiveSelectionForeground}; }`),C.listHoverBackground&&G.push(`.monaco-list${U}:not(.drop-target):not(.dragging) .monaco-list-row:hover:not(.selected):not(.focused) { background-color: ${C.listHoverBackground}; }`),C.listHoverForeground&&G.push(`.monaco-list${U}:not(.drop-target):not(.dragging) .monaco-list-row:hover:not(.selected):not(.focused) { color:  ${C.listHoverForeground}; }`);const Z=asCssValueWithDefault(C.listFocusAndSelectionOutline,asCssValueWithDefault(C.listSelectionOutline,(W=C.listFocusOutline)!==null&&W!==void 0?W:""));Z&&G.push(`.monaco-list${U}:focus .monaco-list-row.focused.selected { outline: 1px solid ${Z}; outline-offset: -1px;}`),C.listFocusOutline&&G.push(`
				.monaco-drag-image,
				.monaco-list${U}:focus .monaco-list-row.focused { outline: 1px solid ${C.listFocusOutline}; outline-offset: -1px; }
				.monaco-workbench.context-menu-visible .monaco-list${U}.last-focused .monaco-list-row.focused { outline: 1px solid ${C.listFocusOutline}; outline-offset: -1px; }
			`);const X=asCssValueWithDefault(C.listSelectionOutline,(V=C.listInactiveFocusOutline)!==null&&V!==void 0?V:"");X&&G.push(`.monaco-list${U} .monaco-list-row.focused.selected { outline: 1px dotted ${X}; outline-offset: -1px; }`),C.listSelectionOutline&&G.push(`.monaco-list${U} .monaco-list-row.selected { outline: 1px dotted ${C.listSelectionOutline}; outline-offset: -1px; }`),C.listInactiveFocusOutline&&G.push(`.monaco-list${U} .monaco-list-row.focused { outline: 1px dotted ${C.listInactiveFocusOutline}; outline-offset: -1px; }`),C.listHoverOutline&&G.push(`.monaco-list${U} .monaco-list-row:hover { outline: 1px dashed ${C.listHoverOutline}; outline-offset: -1px; }`),C.listDropBackground&&G.push(`
				.monaco-list${U}.drop-target,
				.monaco-list${U} .monaco-list-rows.drop-target,
				.monaco-list${U} .monaco-list-row.drop-target { background-color: ${C.listDropBackground} !important; color: inherit !important; }
			`),C.tableColumnsBorder&&G.push(`
				.monaco-table > .monaco-split-view2,
				.monaco-table > .monaco-split-view2 .monaco-sash.vertical::before,
				.monaco-workbench:not(.reduce-motion) .monaco-table:hover > .monaco-split-view2,
				.monaco-workbench:not(.reduce-motion) .monaco-table:hover > .monaco-split-view2 .monaco-sash.vertical::before {
					border-color: ${C.tableColumnsBorder};
				}

				.monaco-workbench:not(.reduce-motion) .monaco-table > .monaco-split-view2,
				.monaco-workbench:not(.reduce-motion) .monaco-table > .monaco-split-view2 .monaco-sash.vertical::before {
					border-color: transparent;
				}
			`),C.tableOddRowsBackgroundColor&&G.push(`
				.monaco-table .monaco-list-row[data-parity=odd]:not(.focused):not(.selected):not(:hover) .monaco-table-tr,
				.monaco-table .monaco-list:not(:focus) .monaco-list-row[data-parity=odd].focused:not(.selected):not(:hover) .monaco-table-tr,
				.monaco-table .monaco-list:not(.focused) .monaco-list-row[data-parity=odd].focused:not(.selected):not(:hover) .monaco-table-tr {
					background-color: ${C.tableOddRowsBackgroundColor};
				}
			`),this.styleElement.textContent=G.join(`
`)}}const unthemedListStyles={listFocusBackground:"#7FB0D0",listActiveSelectionBackground:"#0E639C",listActiveSelectionForeground:"#FFFFFF",listActiveSelectionIconForeground:"#FFFFFF",listFocusAndSelectionOutline:"#90C2F9",listFocusAndSelectionBackground:"#094771",listFocusAndSelectionForeground:"#FFFFFF",listInactiveSelectionBackground:"#3F3F46",listInactiveSelectionIconForeground:"#FFFFFF",listHoverBackground:"#2A2D2E",listDropBackground:"#383B3D",treeIndentGuidesStroke:"#a9a9a9",treeInactiveIndentGuidesStroke:Color.fromHex("#a9a9a9").transparent(.4).toString(),tableColumnsBorder:Color.fromHex("#cccccc").transparent(.2).toString(),tableOddRowsBackgroundColor:Color.fromHex("#cccccc").transparent(.04).toString(),listBackground:void 0,listFocusForeground:void 0,listInactiveSelectionForeground:void 0,listInactiveFocusForeground:void 0,listInactiveFocusBackground:void 0,listHoverForeground:void 0,listFocusOutline:void 0,listInactiveFocusOutline:void 0,listSelectionOutline:void 0,listHoverOutline:void 0},DefaultOptions={keyboardSupport:!0,mouseSupport:!0,multipleSelectionSupport:!0,dnd:{getDragURI(){return null},onDragStart(){},onDragOver(){return!1},drop(){},dispose(){}}};function getContiguousRangeContaining(K,C){const W=K.indexOf(C);if(W===-1)return[];const V=[];let U=W-1;for(;U>=0&&K[U]===C-(W-U);)V.push(K[U--]);for(V.reverse(),U=W;U<K.length&&K[U]===C+(U-W);)V.push(K[U++]);return V}function disjunction(K,C){const W=[];let V=0,U=0;for(;V<K.length||U<C.length;)if(V>=K.length)W.push(C[U++]);else if(U>=C.length)W.push(K[V++]);else if(K[V]===C[U]){W.push(K[V]),V++,U++;continue}else K[V]<C[U]?W.push(K[V++]):W.push(C[U++]);return W}function relativeComplement(K,C){const W=[];let V=0,U=0;for(;V<K.length||U<C.length;)if(V>=K.length)W.push(C[U++]);else if(U>=C.length)W.push(K[V++]);else if(K[V]===C[U]){V++,U++;continue}else K[V]<C[U]?W.push(K[V++]):U++;return W}const numericSort=(K,C)=>K-C;class PipelineRenderer{constructor(C,W){this._templateId=C,this.renderers=W}get templateId(){return this._templateId}renderTemplate(C){return this.renderers.map(W=>W.renderTemplate(C))}renderElement(C,W,V,U){let G=0;for(const Z of this.renderers)Z.renderElement(C,W,V[G++],U)}disposeElement(C,W,V,U){var G;let Z=0;for(const X of this.renderers)(G=X.disposeElement)===null||G===void 0||G.call(X,C,W,V[Z],U),Z+=1}disposeTemplate(C){let W=0;for(const V of this.renderers)V.disposeTemplate(C[W++])}}class AccessibiltyRenderer{constructor(C){this.accessibilityProvider=C,this.templateId="a18n"}renderTemplate(C){return C}renderElement(C,W,V){const U=this.accessibilityProvider.getAriaLabel(C);U?V.setAttribute("aria-label",U):V.removeAttribute("aria-label");const G=this.accessibilityProvider.getAriaLevel&&this.accessibilityProvider.getAriaLevel(C);typeof G=="number"?V.setAttribute("aria-level",`${G}`):V.removeAttribute("aria-level")}disposeTemplate(C){}}class ListViewDragAndDrop{constructor(C,W){this.list=C,this.dnd=W}getDragElements(C){const W=this.list.getSelectedElements();return W.indexOf(C)>-1?W:[C]}getDragURI(C){return this.dnd.getDragURI(C)}getDragLabel(C,W){if(this.dnd.getDragLabel)return this.dnd.getDragLabel(C,W)}onDragStart(C,W){var V,U;(U=(V=this.dnd).onDragStart)===null||U===void 0||U.call(V,C,W)}onDragOver(C,W,V,U){return this.dnd.onDragOver(C,W,V,U)}onDragLeave(C,W,V,U){var G,Z;(Z=(G=this.dnd).onDragLeave)===null||Z===void 0||Z.call(G,C,W,V,U)}onDragEnd(C){var W,V;(V=(W=this.dnd).onDragEnd)===null||V===void 0||V.call(W,C)}drop(C,W,V,U){this.dnd.drop(C,W,V,U)}dispose(){this.dnd.dispose()}}let List$1=class{get onDidChangeFocus(){return Event$1.map(this.eventBufferer.wrapEvent(this.focus.onChange),C=>this.toListEvent(C),this.disposables)}get onDidChangeSelection(){return Event$1.map(this.eventBufferer.wrapEvent(this.selection.onChange),C=>this.toListEvent(C),this.disposables)}get domId(){return this.view.domId}get onDidScroll(){return this.view.onDidScroll}get onMouseClick(){return this.view.onMouseClick}get onMouseDblClick(){return this.view.onMouseDblClick}get onMouseMiddleClick(){return this.view.onMouseMiddleClick}get onPointer(){return this.mouseController.onPointer}get onMouseDown(){return this.view.onMouseDown}get onMouseOver(){return this.view.onMouseOver}get onMouseOut(){return this.view.onMouseOut}get onTouchStart(){return this.view.onTouchStart}get onTap(){return this.view.onTap}get onContextMenu(){let C=!1;const W=Event$1.chain(this.disposables.add(new DomEmitter(this.view.domNode,"keydown")).event,G=>G.map(Z=>new StandardKeyboardEvent(Z)).filter(Z=>C=Z.keyCode===58||Z.shiftKey&&Z.keyCode===68).map(Z=>EventHelper.stop(Z,!0)).filter(()=>!1)),V=Event$1.chain(this.disposables.add(new DomEmitter(this.view.domNode,"keyup")).event,G=>G.forEach(()=>C=!1).map(Z=>new StandardKeyboardEvent(Z)).filter(Z=>Z.keyCode===58||Z.shiftKey&&Z.keyCode===68).map(Z=>EventHelper.stop(Z,!0)).map(({browserEvent:Z})=>{const X=this.getFocus(),Q=X.length?X[0]:void 0,J=typeof Q<"u"?this.view.element(Q):void 0,ee=typeof Q<"u"?this.view.domElement(Q):this.view.domNode;return{index:Q,element:J,anchor:ee,browserEvent:Z}})),U=Event$1.chain(this.view.onContextMenu,G=>G.filter(Z=>!C).map(({element:Z,index:X,browserEvent:Q})=>({element:Z,index:X,anchor:new StandardMouseEvent(Q),browserEvent:Q})));return Event$1.any(W,V,U)}get onKeyDown(){return this.disposables.add(new DomEmitter(this.view.domNode,"keydown")).event}get onDidFocus(){return Event$1.signal(this.disposables.add(new DomEmitter(this.view.domNode,"focus",!0)).event)}constructor(C,W,V,U,G=DefaultOptions){var Z,X,Q,J;this.user=C,this._options=G,this.focus=new Trait$1("focused"),this.anchor=new Trait$1("anchor"),this.eventBufferer=new EventBufferer,this._ariaLabel="",this.disposables=new DisposableStore,this._onDidDispose=new Emitter$1,this.onDidDispose=this._onDidDispose.event;const ee=this._options.accessibilityProvider&&this._options.accessibilityProvider.getWidgetRole?(Z=this._options.accessibilityProvider)===null||Z===void 0?void 0:Z.getWidgetRole():"list";this.selection=new SelectionTrait(ee!=="listbox");const te=[this.focus.renderer,this.selection.renderer];this.accessibilityProvider=G.accessibilityProvider,this.accessibilityProvider&&(te.push(new AccessibiltyRenderer(this.accessibilityProvider)),(Q=(X=this.accessibilityProvider).onDidChangeActiveDescendant)===null||Q===void 0||Q.call(X,this.onDidChangeActiveDescendant,this,this.disposables)),U=U.map(ne=>new PipelineRenderer(ne.templateId,[...te,ne]));const ie=Object.assign(Object.assign({},G),{dnd:G.dnd&&new ListViewDragAndDrop(this,G.dnd)});if(this.view=this.createListView(W,V,U,ie),this.view.domNode.setAttribute("role",ee),G.styleController)this.styleController=G.styleController(this.view.domId);else{const ne=createStyleSheet(this.view.domNode);this.styleController=new DefaultStyleController(ne,this.view.domId)}if(this.spliceable=new CombinedSpliceable([new TraitSpliceable(this.focus,this.view,G.identityProvider),new TraitSpliceable(this.selection,this.view,G.identityProvider),new TraitSpliceable(this.anchor,this.view,G.identityProvider),this.view]),this.disposables.add(this.focus),this.disposables.add(this.selection),this.disposables.add(this.anchor),this.disposables.add(this.view),this.disposables.add(this._onDidDispose),this.disposables.add(new DOMFocusController(this,this.view)),(typeof G.keyboardSupport!="boolean"||G.keyboardSupport)&&(this.keyboardController=new KeyboardController(this,this.view,G),this.disposables.add(this.keyboardController)),G.keyboardNavigationLabelProvider){const ne=G.keyboardNavigationDelegate||DefaultKeyboardNavigationDelegate;this.typeNavigationController=new TypeNavigationController(this,this.view,G.keyboardNavigationLabelProvider,(J=G.keyboardNavigationEventFilter)!==null&&J!==void 0?J:()=>!0,ne),this.disposables.add(this.typeNavigationController)}this.mouseController=this.createMouseController(G),this.disposables.add(this.mouseController),this.onDidChangeFocus(this._onFocusChange,this,this.disposables),this.onDidChangeSelection(this._onSelectionChange,this,this.disposables),this.accessibilityProvider&&(this.ariaLabel=this.accessibilityProvider.getWidgetAriaLabel()),this._options.multipleSelectionSupport!==!1&&this.view.domNode.setAttribute("aria-multiselectable","true")}createListView(C,W,V,U){return new ListView(C,W,V,U)}createMouseController(C){return new MouseController(this)}updateOptions(C={}){var W,V;this._options=Object.assign(Object.assign({},this._options),C),(W=this.typeNavigationController)===null||W===void 0||W.updateOptions(this._options),this._options.multipleSelectionController!==void 0&&(this._options.multipleSelectionSupport?this.view.domNode.setAttribute("aria-multiselectable","true"):this.view.domNode.removeAttribute("aria-multiselectable")),this.mouseController.updateOptions(C),(V=this.keyboardController)===null||V===void 0||V.updateOptions(C),this.view.updateOptions(C)}get options(){return this._options}splice(C,W,V=[]){if(C<0||C>this.view.length)throw new ListError(this.user,`Invalid start index: ${C}`);if(W<0)throw new ListError(this.user,`Invalid delete count: ${W}`);W===0&&V.length===0||this.eventBufferer.bufferEvents(()=>this.spliceable.splice(C,W,V))}rerender(){this.view.rerender()}element(C){return this.view.element(C)}get length(){return this.view.length}get contentHeight(){return this.view.contentHeight}get scrollTop(){return this.view.getScrollTop()}set scrollTop(C){this.view.setScrollTop(C)}get scrollHeight(){return this.view.scrollHeight}get renderHeight(){return this.view.renderHeight}get firstVisibleIndex(){return this.view.firstVisibleIndex}get ariaLabel(){return this._ariaLabel}set ariaLabel(C){this._ariaLabel=C,this.view.domNode.setAttribute("aria-label",C)}domFocus(){this.view.domNode.focus({preventScroll:!0})}layout(C,W){this.view.layout(C,W)}setSelection(C,W){for(const V of C)if(V<0||V>=this.length)throw new ListError(this.user,`Invalid index ${V}`);this.selection.set(C,W)}getSelection(){return this.selection.get()}getSelectedElements(){return this.getSelection().map(C=>this.view.element(C))}setAnchor(C){if(typeof C>"u"){this.anchor.set([]);return}if(C<0||C>=this.length)throw new ListError(this.user,`Invalid index ${C}`);this.anchor.set([C])}getAnchor(){return firstOrDefault(this.anchor.get(),void 0)}getAnchorElement(){const C=this.getAnchor();return typeof C>"u"?void 0:this.element(C)}setFocus(C,W){for(const V of C)if(V<0||V>=this.length)throw new ListError(this.user,`Invalid index ${V}`);this.focus.set(C,W)}focusNext(C=1,W=!1,V,U){if(this.length===0)return;const G=this.focus.get(),Z=this.findNextIndex(G.length>0?G[0]+C:0,W,U);Z>-1&&this.setFocus([Z],V)}focusPrevious(C=1,W=!1,V,U){if(this.length===0)return;const G=this.focus.get(),Z=this.findPreviousIndex(G.length>0?G[0]-C:0,W,U);Z>-1&&this.setFocus([Z],V)}focusNextPage(C,W){return __awaiter$1o(this,void 0,void 0,function*(){let V=this.view.indexAt(this.view.getScrollTop()+this.view.renderHeight);V=V===0?0:V-1;const U=this.getFocus()[0];if(U!==V&&(U===void 0||V>U)){const G=this.findPreviousIndex(V,!1,W);G>-1&&U!==G?this.setFocus([G],C):this.setFocus([V],C)}else{const G=this.view.getScrollTop();let Z=G+this.view.renderHeight;V>U&&(Z-=this.view.elementHeight(V)),this.view.setScrollTop(Z),this.view.getScrollTop()!==G&&(this.setFocus([]),yield timeout(0),yield this.focusNextPage(C,W))}})}focusPreviousPage(C,W){return __awaiter$1o(this,void 0,void 0,function*(){let V;const U=this.view.getScrollTop();U===0?V=this.view.indexAt(U):V=this.view.indexAfter(U-1);const G=this.getFocus()[0];if(G!==V&&(G===void 0||G>=V)){const Z=this.findNextIndex(V,!1,W);Z>-1&&G!==Z?this.setFocus([Z],C):this.setFocus([V],C)}else{const Z=U;this.view.setScrollTop(U-this.view.renderHeight),this.view.getScrollTop()!==Z&&(this.setFocus([]),yield timeout(0),yield this.focusPreviousPage(C,W))}})}focusLast(C,W){if(this.length===0)return;const V=this.findPreviousIndex(this.length-1,!1,W);V>-1&&this.setFocus([V],C)}focusFirst(C,W){this.focusNth(0,C,W)}focusNth(C,W,V){if(this.length===0)return;const U=this.findNextIndex(C,!1,V);U>-1&&this.setFocus([U],W)}findNextIndex(C,W=!1,V){for(let U=0;U<this.length;U++){if(C>=this.length&&!W)return-1;if(C=C%this.length,!V||V(this.element(C)))return C;C++}return-1}findPreviousIndex(C,W=!1,V){for(let U=0;U<this.length;U++){if(C<0&&!W)return-1;if(C=(this.length+C%this.length)%this.length,!V||V(this.element(C)))return C;C--}return-1}getFocus(){return this.focus.get()}getFocusedElements(){return this.getFocus().map(C=>this.view.element(C))}reveal(C,W){if(C<0||C>=this.length)throw new ListError(this.user,`Invalid index ${C}`);const V=this.view.getScrollTop(),U=this.view.elementTop(C),G=this.view.elementHeight(C);if(isNumber$3(W)){const Z=G-this.view.renderHeight;this.view.setScrollTop(Z*clamp$2(W,0,1)+U)}else{const Z=U+G,X=V+this.view.renderHeight;U<V&&Z>=X||(U<V||Z>=X&&G>=this.view.renderHeight?this.view.setScrollTop(U):Z>=X&&this.view.setScrollTop(Z-this.view.renderHeight))}}getHTMLElement(){return this.view.domNode}getElementID(C){return this.view.getElementDomId(C)}style(C){this.styleController.style(C)}toListEvent({indexes:C,browserEvent:W}){return{indexes:C,elements:C.map(V=>this.view.element(V)),browserEvent:W}}_onFocusChange(){const C=this.focus.get();this.view.domNode.classList.toggle("element-focused",C.length>0),this.onDidChangeActiveDescendant()}onDidChangeActiveDescendant(){var C;const W=this.focus.get();if(W.length>0){let V;!((C=this.accessibilityProvider)===null||C===void 0)&&C.getActiveDescendantId&&(V=this.accessibilityProvider.getActiveDescendantId(this.view.element(W[0]))),this.view.domNode.setAttribute("aria-activedescendant",V||this.view.getElementDomId(W[0]))}else this.view.domNode.removeAttribute("aria-activedescendant")}_onSelectionChange(){const C=this.selection.get();this.view.domNode.classList.toggle("selection-none",C.length===0),this.view.domNode.classList.toggle("selection-single",C.length===1),this.view.domNode.classList.toggle("selection-multiple",C.length>1)}dispose(){this._onDidDispose.fire(),this.disposables.dispose(),this._onDidDispose.dispose()}};__decorate$1S([memoize],List$1.prototype,"onDidChangeFocus",null);__decorate$1S([memoize],List$1.prototype,"onDidChangeSelection",null);__decorate$1S([memoize],List$1.prototype,"onContextMenu",null);__decorate$1S([memoize],List$1.prototype,"onKeyDown",null);__decorate$1S([memoize],List$1.prototype,"onDidFocus",null);const selectBoxCustom="",$$c=$$d,SELECT_OPTION_ENTRY_TEMPLATE_ID="selectOption.entry.template";class SelectListRenderer{get templateId(){return SELECT_OPTION_ENTRY_TEMPLATE_ID}renderTemplate(C){const W=Object.create(null);return W.root=C,W.text=append$3(C,$$c(".option-text")),W.detail=append$3(C,$$c(".option-detail")),W.decoratorRight=append$3(C,$$c(".option-decorator-right")),W}renderElement(C,W,V){const U=V,G=C.text,Z=C.detail,X=C.decoratorRight,Q=C.isDisabled;U.text.textContent=G,U.detail.textContent=Z||"",U.decoratorRight.innerText=X||"",Q?U.root.classList.add("option-disabled"):U.root.classList.remove("option-disabled")}disposeTemplate(C){}}class SelectBoxList extends Disposable{constructor(C,W,V,U,G){super(),this.options=[],this._currentSelection=0,this._hasDetails=!1,this._skipLayout=!1,this._sticky=!1,this._isVisible=!1,this.styles=U,this.selectBoxOptions=G||Object.create(null),typeof this.selectBoxOptions.minBottomMargin!="number"?this.selectBoxOptions.minBottomMargin=SelectBoxList.DEFAULT_DROPDOWN_MINIMUM_BOTTOM_MARGIN:this.selectBoxOptions.minBottomMargin<0&&(this.selectBoxOptions.minBottomMargin=0),this.selectElement=document.createElement("select"),this.selectElement.className="monaco-select-box monaco-select-box-dropdown-padding",typeof this.selectBoxOptions.ariaLabel=="string"&&this.selectElement.setAttribute("aria-label",this.selectBoxOptions.ariaLabel),typeof this.selectBoxOptions.ariaDescription=="string"&&this.selectElement.setAttribute("aria-description",this.selectBoxOptions.ariaDescription),this._onDidSelect=new Emitter$1,this._register(this._onDidSelect),this.registerListeners(),this.constructSelectDropDown(V),this.selected=W||0,C&&this.setOptions(C,W),this.initStyleSheet()}getHeight(){return 22}getTemplateId(){return SELECT_OPTION_ENTRY_TEMPLATE_ID}constructSelectDropDown(C){this.contextViewProvider=C,this.selectDropDownContainer=$$d(".monaco-select-box-dropdown-container"),this.selectDropDownContainer.classList.add("monaco-select-box-dropdown-padding"),this.selectionDetailsPane=append$3(this.selectDropDownContainer,$$c(".select-box-details-pane"));const W=append$3(this.selectDropDownContainer,$$c(".select-box-dropdown-container-width-control")),V=append$3(W,$$c(".width-control-div"));this.widthControlElement=document.createElement("span"),this.widthControlElement.className="option-text-width-control",append$3(V,this.widthControlElement),this._dropDownPosition=0,this.styleElement=createStyleSheet(this.selectDropDownContainer),this.selectDropDownContainer.setAttribute("draggable","true"),this._register(addDisposableListener(this.selectDropDownContainer,EventType$1.DRAG_START,U=>{EventHelper.stop(U,!0)}))}registerListeners(){this._register(addStandardDisposableListener(this.selectElement,"change",W=>{this.selected=W.target.selectedIndex,this._onDidSelect.fire({index:W.target.selectedIndex,selected:W.target.value}),this.options[this.selected]&&this.options[this.selected].text&&(this.selectElement.title=this.options[this.selected].text)})),this._register(addDisposableListener(this.selectElement,EventType$1.CLICK,W=>{EventHelper.stop(W),this._isVisible?this.hideSelectDropDown(!0):this.showSelectDropDown()})),this._register(addDisposableListener(this.selectElement,EventType$1.MOUSE_DOWN,W=>{EventHelper.stop(W)}));let C;this._register(addDisposableListener(this.selectElement,"touchstart",W=>{C=this._isVisible})),this._register(addDisposableListener(this.selectElement,"touchend",W=>{EventHelper.stop(W),C?this.hideSelectDropDown(!0):this.showSelectDropDown()})),this._register(addDisposableListener(this.selectElement,EventType$1.KEY_DOWN,W=>{const V=new StandardKeyboardEvent(W);let U=!1;isMacintosh?(V.keyCode===18||V.keyCode===16||V.keyCode===10||V.keyCode===3)&&(U=!0):(V.keyCode===18&&V.altKey||V.keyCode===16&&V.altKey||V.keyCode===10||V.keyCode===3)&&(U=!0),U&&(this.showSelectDropDown(),EventHelper.stop(W,!0))}))}get onDidSelect(){return this._onDidSelect.event}setOptions(C,W){equals$5(this.options,C)||(this.options=C,this.selectElement.options.length=0,this._hasDetails=!1,this._cachedMaxDetailsHeight=void 0,this.options.forEach((V,U)=>{this.selectElement.add(this.createOption(V.text,U,V.isDisabled)),typeof V.description=="string"&&(this._hasDetails=!0)})),W!==void 0&&(this.select(W),this._currentSelection=this.selected)}setOptionsList(){var C;(C=this.selectList)===null||C===void 0||C.splice(0,this.selectList.length,this.options)}select(C){C>=0&&C<this.options.length?this.selected=C:C>this.options.length-1?this.select(this.options.length-1):this.selected<0&&(this.selected=0),this.selectElement.selectedIndex=this.selected,this.options[this.selected]&&this.options[this.selected].text&&(this.selectElement.title=this.options[this.selected].text)}focus(){this.selectElement&&(this.selectElement.tabIndex=0,this.selectElement.focus())}blur(){this.selectElement&&(this.selectElement.tabIndex=-1,this.selectElement.blur())}setFocusable(C){this.selectElement.tabIndex=C?0:-1}render(C){this.container=C,C.classList.add("select-container"),C.appendChild(this.selectElement),this.styleSelectElement()}initStyleSheet(){const C=[];this.styles.listFocusBackground&&C.push(`.monaco-select-box-dropdown-container > .select-box-dropdown-list-container .monaco-list .monaco-list-row.focused { background-color: ${this.styles.listFocusBackground} !important; }`),this.styles.listFocusForeground&&C.push(`.monaco-select-box-dropdown-container > .select-box-dropdown-list-container .monaco-list .monaco-list-row.focused { color: ${this.styles.listFocusForeground} !important; }`),this.styles.decoratorRightForeground&&C.push(`.monaco-select-box-dropdown-container > .select-box-dropdown-list-container .monaco-list .monaco-list-row:not(.focused) .option-decorator-right { color: ${this.styles.decoratorRightForeground}; }`),this.styles.selectBackground&&this.styles.selectBorder&&this.styles.selectBorder!==this.styles.selectBackground?(C.push(`.monaco-select-box-dropdown-container { border: 1px solid ${this.styles.selectBorder} } `),C.push(`.monaco-select-box-dropdown-container > .select-box-details-pane.border-top { border-top: 1px solid ${this.styles.selectBorder} } `),C.push(`.monaco-select-box-dropdown-container > .select-box-details-pane.border-bottom { border-bottom: 1px solid ${this.styles.selectBorder} } `)):this.styles.selectListBorder&&(C.push(`.monaco-select-box-dropdown-container > .select-box-details-pane.border-top { border-top: 1px solid ${this.styles.selectListBorder} } `),C.push(`.monaco-select-box-dropdown-container > .select-box-details-pane.border-bottom { border-bottom: 1px solid ${this.styles.selectListBorder} } `)),this.styles.listHoverForeground&&C.push(`.monaco-select-box-dropdown-container > .select-box-dropdown-list-container .monaco-list .monaco-list-row:not(.option-disabled):not(.focused):hover { color: ${this.styles.listHoverForeground} !important; }`),this.styles.listHoverBackground&&C.push(`.monaco-select-box-dropdown-container > .select-box-dropdown-list-container .monaco-list .monaco-list-row:not(.option-disabled):not(.focused):hover { background-color: ${this.styles.listHoverBackground} !important; }`),this.styles.listFocusOutline&&C.push(`.monaco-select-box-dropdown-container > .select-box-dropdown-list-container .monaco-list .monaco-list-row.focused { outline: 1.6px dotted ${this.styles.listFocusOutline} !important; outline-offset: -1.6px !important; }`),this.styles.listHoverOutline&&C.push(`.monaco-select-box-dropdown-container > .select-box-dropdown-list-container .monaco-list .monaco-list-row:not(.option-disabled):not(.focused):hover { outline: 1.6px dashed ${this.styles.listHoverOutline} !important; outline-offset: -1.6px !important; }`),C.push(".monaco-select-box-dropdown-container > .select-box-dropdown-list-container .monaco-list .monaco-list-row.option-disabled.focused { background-color: transparent !important; color: inherit !important; outline: none !important; }"),C.push(".monaco-select-box-dropdown-container > .select-box-dropdown-list-container .monaco-list .monaco-list-row.option-disabled:hover { background-color: transparent !important; color: inherit !important; outline: none !important; }"),this.styleElement.textContent=C.join(`
`)}styleSelectElement(){var C,W,V;const U=(C=this.styles.selectBackground)!==null&&C!==void 0?C:"",G=(W=this.styles.selectForeground)!==null&&W!==void 0?W:"",Z=(V=this.styles.selectBorder)!==null&&V!==void 0?V:"";this.selectElement.style.backgroundColor=U,this.selectElement.style.color=G,this.selectElement.style.borderColor=Z}styleList(){var C,W;const V=(C=this.styles.selectBackground)!==null&&C!==void 0?C:"",U=asCssValueWithDefault(this.styles.selectListBackground,V);this.selectDropDownListContainer.style.backgroundColor=U,this.selectionDetailsPane.style.backgroundColor=U;const G=(W=this.styles.focusBorder)!==null&&W!==void 0?W:"";this.selectDropDownContainer.style.outlineColor=G,this.selectDropDownContainer.style.outlineOffset="-1px",this.selectList.style(this.styles)}createOption(C,W,V){const U=document.createElement("option");return U.value=C,U.text=C,U.disabled=!!V,U}showSelectDropDown(){this.selectionDetailsPane.innerText="",!(!this.contextViewProvider||this._isVisible)&&(this.createSelectList(this.selectDropDownContainer),this.setOptionsList(),this.contextViewProvider.showContextView({getAnchor:()=>this.selectElement,render:C=>this.renderSelectDropDown(C,!0),layout:()=>{this.layoutSelectDropDown()},onHide:()=>{this.selectDropDownContainer.classList.remove("visible"),this.selectElement.classList.remove("synthetic-focus")},anchorPosition:this._dropDownPosition},this.selectBoxOptions.optionsAsChildren?this.container:void 0),this._isVisible=!0,this.hideSelectDropDown(!1),this.contextViewProvider.showContextView({getAnchor:()=>this.selectElement,render:C=>this.renderSelectDropDown(C),layout:()=>this.layoutSelectDropDown(),onHide:()=>{this.selectDropDownContainer.classList.remove("visible"),this.selectElement.classList.remove("synthetic-focus")},anchorPosition:this._dropDownPosition},this.selectBoxOptions.optionsAsChildren?this.container:void 0),this._currentSelection=this.selected,this._isVisible=!0,this.selectElement.setAttribute("aria-expanded","true"))}hideSelectDropDown(C){!this.contextViewProvider||!this._isVisible||(this._isVisible=!1,this.selectElement.setAttribute("aria-expanded","false"),C&&this.selectElement.focus(),this.contextViewProvider.hideContextView())}renderSelectDropDown(C,W){return C.appendChild(this.selectDropDownContainer),this.layoutSelectDropDown(W),{dispose:()=>{try{C.removeChild(this.selectDropDownContainer)}catch{}}}}measureMaxDetailsHeight(){let C=0;return this.options.forEach((W,V)=>{this.updateDetail(V),this.selectionDetailsPane.offsetHeight>C&&(C=this.selectionDetailsPane.offsetHeight)}),C}layoutSelectDropDown(C){if(this._skipLayout)return!1;if(this.selectList){this.selectDropDownContainer.classList.add("visible");const W=getDomNodePagePosition(this.selectElement),V=getComputedStyle(this.selectElement),U=parseFloat(V.getPropertyValue("--dropdown-padding-top"))+parseFloat(V.getPropertyValue("--dropdown-padding-bottom")),G=window.innerHeight-W.top-W.height-(this.selectBoxOptions.minBottomMargin||0),Z=W.top-SelectBoxList.DEFAULT_DROPDOWN_MINIMUM_TOP_MARGIN,X=this.selectElement.offsetWidth,Q=this.setWidthControlElement(this.widthControlElement),J=Math.max(Q,Math.round(X)).toString()+"px";this.selectDropDownContainer.style.width=J,this.selectList.getHTMLElement().style.height="",this.selectList.layout();let ee=this.selectList.contentHeight;this._hasDetails&&this._cachedMaxDetailsHeight===void 0&&(this._cachedMaxDetailsHeight=this.measureMaxDetailsHeight());const te=this._hasDetails?this._cachedMaxDetailsHeight:0,ie=ee+U+te,ne=Math.floor((G-U-te)/this.getHeight()),oe=Math.floor((Z-U-te)/this.getHeight());if(C)return W.top+W.height>window.innerHeight-22||W.top<SelectBoxList.DEFAULT_DROPDOWN_MINIMUM_TOP_MARGIN||ne<1&&oe<1?!1:(ne<SelectBoxList.DEFAULT_MINIMUM_VISIBLE_OPTIONS&&oe>ne&&this.options.length>ne?(this._dropDownPosition=1,this.selectDropDownContainer.removeChild(this.selectDropDownListContainer),this.selectDropDownContainer.removeChild(this.selectionDetailsPane),this.selectDropDownContainer.appendChild(this.selectionDetailsPane),this.selectDropDownContainer.appendChild(this.selectDropDownListContainer),this.selectionDetailsPane.classList.remove("border-top"),this.selectionDetailsPane.classList.add("border-bottom")):(this._dropDownPosition=0,this.selectDropDownContainer.removeChild(this.selectDropDownListContainer),this.selectDropDownContainer.removeChild(this.selectionDetailsPane),this.selectDropDownContainer.appendChild(this.selectDropDownListContainer),this.selectDropDownContainer.appendChild(this.selectionDetailsPane),this.selectionDetailsPane.classList.remove("border-bottom"),this.selectionDetailsPane.classList.add("border-top")),!0);if(W.top+W.height>window.innerHeight-22||W.top<SelectBoxList.DEFAULT_DROPDOWN_MINIMUM_TOP_MARGIN||this._dropDownPosition===0&&ne<1||this._dropDownPosition===1&&oe<1)return this.hideSelectDropDown(!0),!1;if(this._dropDownPosition===0){if(this._isVisible&&ne+oe<1)return this.hideSelectDropDown(!0),!1;ie>G&&(ee=ne*this.getHeight())}else ie>Z&&(ee=oe*this.getHeight());return this.selectList.layout(ee),this.selectList.domFocus(),this.selectList.length>0&&(this.selectList.setFocus([this.selected||0]),this.selectList.reveal(this.selectList.getFocus()[0]||0)),this._hasDetails?(this.selectList.getHTMLElement().style.height=ee+U+"px",this.selectDropDownContainer.style.height=""):this.selectDropDownContainer.style.height=ee+U+"px",this.updateDetail(this.selected),this.selectDropDownContainer.style.width=J,this.selectDropDownListContainer.setAttribute("tabindex","0"),this.selectElement.classList.add("synthetic-focus"),this.selectDropDownContainer.classList.add("synthetic-focus"),!0}else return!1}setWidthControlElement(C){let W=0;if(C){let V=0,U=0;this.options.forEach((G,Z)=>{const X=G.detail?G.detail.length:0,Q=G.decoratorRight?G.decoratorRight.length:0,J=G.text.length+X+Q;J>U&&(V=Z,U=J)}),C.textContent=this.options[V].text+(this.options[V].decoratorRight?this.options[V].decoratorRight+" ":""),W=getTotalWidth(C)}return W}createSelectList(C){if(this.selectList)return;this.selectDropDownListContainer=append$3(C,$$c(".select-box-dropdown-list-container")),this.listRenderer=new SelectListRenderer,this.selectList=new List$1("SelectBoxCustom",this.selectDropDownListContainer,this,[this.listRenderer],{useShadows:!1,verticalScrollMode:3,keyboardSupport:!1,mouseSupport:!1,accessibilityProvider:{getAriaLabel:U=>{let G=U.text;return U.detail&&(G+=`. ${U.detail}`),U.decoratorRight&&(G+=`. ${U.decoratorRight}`),U.description&&(G+=`. ${U.description}`),G},getWidgetAriaLabel:()=>localize({key:"selectBox",comment:["Behave like native select dropdown element."]},"Select Box"),getRole:()=>isMacintosh?"":"option",getWidgetRole:()=>"listbox"}}),this.selectBoxOptions.ariaLabel&&(this.selectList.ariaLabel=this.selectBoxOptions.ariaLabel);const W=this._register(new DomEmitter(this.selectDropDownListContainer,"keydown")),V=Event$1.chain(W.event,U=>U.filter(()=>this.selectList.length>0).map(G=>new StandardKeyboardEvent(G)));this._register(Event$1.chain(V,U=>U.filter(G=>G.keyCode===3))(this.onEnter,this)),this._register(Event$1.chain(V,U=>U.filter(G=>G.keyCode===2))(this.onEnter,this)),this._register(Event$1.chain(V,U=>U.filter(G=>G.keyCode===9))(this.onEscape,this)),this._register(Event$1.chain(V,U=>U.filter(G=>G.keyCode===16))(this.onUpArrow,this)),this._register(Event$1.chain(V,U=>U.filter(G=>G.keyCode===18))(this.onDownArrow,this)),this._register(Event$1.chain(V,U=>U.filter(G=>G.keyCode===12))(this.onPageDown,this)),this._register(Event$1.chain(V,U=>U.filter(G=>G.keyCode===11))(this.onPageUp,this)),this._register(Event$1.chain(V,U=>U.filter(G=>G.keyCode===14))(this.onHome,this)),this._register(Event$1.chain(V,U=>U.filter(G=>G.keyCode===13))(this.onEnd,this)),this._register(Event$1.chain(V,U=>U.filter(G=>G.keyCode>=21&&G.keyCode<=56||G.keyCode>=85&&G.keyCode<=113))(this.onCharacter,this)),this._register(addDisposableListener(this.selectList.getHTMLElement(),EventType$1.POINTER_UP,U=>this.onPointerUp(U))),this._register(this.selectList.onMouseOver(U=>typeof U.index<"u"&&this.selectList.setFocus([U.index]))),this._register(this.selectList.onDidChangeFocus(U=>this.onListFocus(U))),this._register(addDisposableListener(this.selectDropDownContainer,EventType$1.FOCUS_OUT,U=>{!this._isVisible||isAncestor$1(U.relatedTarget,this.selectDropDownContainer)||this.onListBlur()})),this.selectList.getHTMLElement().setAttribute("aria-label",this.selectBoxOptions.ariaLabel||""),this.selectList.getHTMLElement().setAttribute("aria-expanded","true"),this.styleList()}onPointerUp(C){if(!this.selectList.length)return;EventHelper.stop(C);const W=C.target;if(!W||W.classList.contains("slider"))return;const V=W.closest(".monaco-list-row");if(!V)return;const U=Number(V.getAttribute("data-index")),G=V.classList.contains("option-disabled");U>=0&&U<this.options.length&&!G&&(this.selected=U,this.select(this.selected),this.selectList.setFocus([this.selected]),this.selectList.reveal(this.selectList.getFocus()[0]),this.selected!==this._currentSelection&&(this._currentSelection=this.selected,this._onDidSelect.fire({index:this.selectElement.selectedIndex,selected:this.options[this.selected].text}),this.options[this.selected]&&this.options[this.selected].text&&(this.selectElement.title=this.options[this.selected].text)),this.hideSelectDropDown(!0))}onListBlur(){this._sticky||(this.selected!==this._currentSelection&&this.select(this._currentSelection),this.hideSelectDropDown(!1))}renderDescriptionMarkdown(C,W){const V=G=>{for(let Z=0;Z<G.childNodes.length;Z++){const X=G.childNodes.item(Z);(X.tagName&&X.tagName.toLowerCase())==="img"?G.removeChild(X):V(X)}},U=renderMarkdown({value:C,supportThemeIcons:!0},{actionHandler:W});return U.element.classList.add("select-box-description-markdown"),V(U.element),U.element}onListFocus(C){!this._isVisible||!this._hasDetails||this.updateDetail(C.indexes[0])}updateDetail(C){var W,V;this.selectionDetailsPane.innerText="";const U=this.options[C],G=(W=U==null?void 0:U.description)!==null&&W!==void 0?W:"",Z=(V=U==null?void 0:U.descriptionIsMarkdown)!==null&&V!==void 0?V:!1;if(G){if(Z){const X=U.descriptionMarkdownActionHandler;this.selectionDetailsPane.appendChild(this.renderDescriptionMarkdown(G,X))}else this.selectionDetailsPane.innerText=G;this.selectionDetailsPane.style.display="block"}else this.selectionDetailsPane.style.display="none";this._skipLayout=!0,this.contextViewProvider.layout(),this._skipLayout=!1}onEscape(C){EventHelper.stop(C),this.select(this._currentSelection),this.hideSelectDropDown(!0)}onEnter(C){EventHelper.stop(C),this.selected!==this._currentSelection&&(this._currentSelection=this.selected,this._onDidSelect.fire({index:this.selectElement.selectedIndex,selected:this.options[this.selected].text}),this.options[this.selected]&&this.options[this.selected].text&&(this.selectElement.title=this.options[this.selected].text)),this.hideSelectDropDown(!0)}onDownArrow(C){if(this.selected<this.options.length-1){EventHelper.stop(C,!0);const W=this.options[this.selected+1].isDisabled;if(W&&this.options.length>this.selected+2)this.selected+=2;else{if(W)return;this.selected++}this.select(this.selected),this.selectList.setFocus([this.selected]),this.selectList.reveal(this.selectList.getFocus()[0])}}onUpArrow(C){this.selected>0&&(EventHelper.stop(C,!0),this.options[this.selected-1].isDisabled&&this.selected>1?this.selected-=2:this.selected--,this.select(this.selected),this.selectList.setFocus([this.selected]),this.selectList.reveal(this.selectList.getFocus()[0]))}onPageUp(C){EventHelper.stop(C),this.selectList.focusPreviousPage(),setTimeout(()=>{this.selected=this.selectList.getFocus()[0],this.options[this.selected].isDisabled&&this.selected<this.options.length-1&&(this.selected++,this.selectList.setFocus([this.selected])),this.selectList.reveal(this.selected),this.select(this.selected)},1)}onPageDown(C){EventHelper.stop(C),this.selectList.focusNextPage(),setTimeout(()=>{this.selected=this.selectList.getFocus()[0],this.options[this.selected].isDisabled&&this.selected>0&&(this.selected--,this.selectList.setFocus([this.selected])),this.selectList.reveal(this.selected),this.select(this.selected)},1)}onHome(C){EventHelper.stop(C),!(this.options.length<2)&&(this.selected=0,this.options[this.selected].isDisabled&&this.selected>1&&this.selected++,this.selectList.setFocus([this.selected]),this.selectList.reveal(this.selected),this.select(this.selected))}onEnd(C){EventHelper.stop(C),!(this.options.length<2)&&(this.selected=this.options.length-1,this.options[this.selected].isDisabled&&this.selected>1&&this.selected--,this.selectList.setFocus([this.selected]),this.selectList.reveal(this.selected),this.select(this.selected))}onCharacter(C){const W=KeyCodeUtils.toString(C.keyCode);let V=-1;for(let U=0;U<this.options.length-1;U++)if(V=(U+this.selected+1)%this.options.length,this.options[V].text.charAt(0).toUpperCase()===W&&!this.options[V].isDisabled){this.select(V),this.selectList.setFocus([V]),this.selectList.reveal(this.selectList.getFocus()[0]),EventHelper.stop(C);break}}dispose(){this.hideSelectDropDown(!1),super.dispose()}}SelectBoxList.DEFAULT_DROPDOWN_MINIMUM_BOTTOM_MARGIN=32;SelectBoxList.DEFAULT_DROPDOWN_MINIMUM_TOP_MARGIN=2;SelectBoxList.DEFAULT_MINIMUM_VISIBLE_OPTIONS=3;class SelectBoxNative extends Disposable{constructor(C,W,V,U){super(),this.selected=0,this.selectBoxOptions=U||Object.create(null),this.options=[],this.selectElement=document.createElement("select"),this.selectElement.className="monaco-select-box",typeof this.selectBoxOptions.ariaLabel=="string"&&this.selectElement.setAttribute("aria-label",this.selectBoxOptions.ariaLabel),typeof this.selectBoxOptions.ariaDescription=="string"&&this.selectElement.setAttribute("aria-description",this.selectBoxOptions.ariaDescription),this._onDidSelect=this._register(new Emitter$1),this.styles=V,this.registerListeners(),this.setOptions(C,W)}registerListeners(){this._register(Gesture.addTarget(this.selectElement)),[EventType.Tap].forEach(C=>{this._register(addDisposableListener(this.selectElement,C,W=>{this.selectElement.focus()}))}),this._register(addStandardDisposableListener(this.selectElement,"click",C=>{EventHelper.stop(C,!0)})),this._register(addStandardDisposableListener(this.selectElement,"change",C=>{this.selectElement.title=C.target.value,this._onDidSelect.fire({index:C.target.selectedIndex,selected:C.target.value})})),this._register(addStandardDisposableListener(this.selectElement,"keydown",C=>{let W=!1;isMacintosh?(C.keyCode===18||C.keyCode===16||C.keyCode===10)&&(W=!0):(C.keyCode===18&&C.altKey||C.keyCode===10||C.keyCode===3)&&(W=!0),W&&C.stopPropagation()}))}get onDidSelect(){return this._onDidSelect.event}setOptions(C,W){(!this.options||!equals$5(this.options,C))&&(this.options=C,this.selectElement.options.length=0,this.options.forEach((V,U)=>{this.selectElement.add(this.createOption(V.text,U,V.isDisabled))})),W!==void 0&&this.select(W)}select(C){this.options.length===0?this.selected=0:C>=0&&C<this.options.length?this.selected=C:C>this.options.length-1?this.select(this.options.length-1):this.selected<0&&(this.selected=0),this.selectElement.selectedIndex=this.selected,this.selected<this.options.length&&typeof this.options[this.selected].text=="string"?this.selectElement.title=this.options[this.selected].text:this.selectElement.title=""}focus(){this.selectElement&&(this.selectElement.tabIndex=0,this.selectElement.focus())}blur(){this.selectElement&&(this.selectElement.tabIndex=-1,this.selectElement.blur())}setFocusable(C){this.selectElement.tabIndex=C?0:-1}render(C){C.classList.add("select-container"),C.appendChild(this.selectElement),this.setOptions(this.options,this.selected),this.applyStyles()}applyStyles(){var C,W,V;this.selectElement&&(this.selectElement.style.backgroundColor=(C=this.styles.selectBackground)!==null&&C!==void 0?C:"",this.selectElement.style.color=(W=this.styles.selectForeground)!==null&&W!==void 0?W:"",this.selectElement.style.borderColor=(V=this.styles.selectBorder)!==null&&V!==void 0?V:"")}createOption(C,W,V){const U=document.createElement("option");return U.value=C,U.text=C,U.disabled=!!V,U}}const selectBox="";class SelectBox extends Widget$1{constructor(C,W,V,U,G){super(),isMacintosh&&!(G!=null&&G.useCustomDrawn)?this.selectBoxDelegate=new SelectBoxNative(C,W,U,G):this.selectBoxDelegate=new SelectBoxList(C,W,V,U,G),this._register(this.selectBoxDelegate)}get onDidSelect(){return this.selectBoxDelegate.onDidSelect}setOptions(C,W){this.selectBoxDelegate.setOptions(C,W)}select(C){this.selectBoxDelegate.select(C)}focus(){this.selectBoxDelegate.focus()}blur(){this.selectBoxDelegate.blur()}setFocusable(C){this.selectBoxDelegate.setFocusable(C)}render(C){this.selectBoxDelegate.render(C)}}const actionbar="";class BaseActionViewItem extends Disposable{get action(){return this._action}constructor(C,W,V={}){super(),this.options=V,this._context=C||this,this._action=W,W instanceof Action&&this._register(W.onDidChange(U=>{this.element&&this.handleActionChangeEvent(U)}))}handleActionChangeEvent(C){C.enabled!==void 0&&this.updateEnabled(),C.checked!==void 0&&this.updateChecked(),C.class!==void 0&&this.updateClass(),C.label!==void 0&&(this.updateLabel(),this.updateTooltip()),C.tooltip!==void 0&&this.updateTooltip()}get actionRunner(){return this._actionRunner||(this._actionRunner=this._register(new ActionRunner)),this._actionRunner}set actionRunner(C){this._actionRunner=C}isEnabled(){return this._action.enabled}setActionContext(C){this._context=C}render(C){const W=this.element=C;this._register(Gesture.addTarget(C));const V=this.options&&this.options.draggable;V&&(C.draggable=!0,isFirefox&&this._register(addDisposableListener(C,EventType$1.DRAG_START,U=>{var G;return(G=U.dataTransfer)===null||G===void 0?void 0:G.setData(DataTransfers.TEXT,this._action.label)}))),this._register(addDisposableListener(W,EventType.Tap,U=>this.onClick(U,!0))),this._register(addDisposableListener(W,EventType$1.MOUSE_DOWN,U=>{V||EventHelper.stop(U,!0),this._action.enabled&&U.button===0&&W.classList.add("active")})),isMacintosh&&this._register(addDisposableListener(W,EventType$1.CONTEXT_MENU,U=>{U.button===0&&U.ctrlKey===!0&&this.onClick(U)})),this._register(addDisposableListener(W,EventType$1.CLICK,U=>{EventHelper.stop(U,!0),this.options&&this.options.isMenu||this.onClick(U)})),this._register(addDisposableListener(W,EventType$1.DBLCLICK,U=>{EventHelper.stop(U,!0)})),[EventType$1.MOUSE_UP,EventType$1.MOUSE_OUT].forEach(U=>{this._register(addDisposableListener(W,U,G=>{EventHelper.stop(G),W.classList.remove("active")}))})}onClick(C,W=!1){var V;EventHelper.stop(C,!0);const U=isUndefinedOrNull(this._context)?!((V=this.options)===null||V===void 0)&&V.useEventAsContext?C:{preserveFocus:W}:this._context;this.actionRunner.run(this._action,U)}focus(){this.element&&(this.element.tabIndex=0,this.element.focus(),this.element.classList.add("focused"))}blur(){this.element&&(this.element.blur(),this.element.tabIndex=-1,this.element.classList.remove("focused"))}setFocusable(C){this.element&&(this.element.tabIndex=C?0:-1)}get trapsArrowNavigation(){return!1}updateEnabled(){}updateLabel(){}getTooltip(){return this.action.tooltip}updateTooltip(){var C;if(!this.element)return;const W=(C=this.getTooltip())!==null&&C!==void 0?C:"";this.updateAriaLabel(),this.options.hoverDelegate?(this.element.title="",this.customHover?this.customHover.update(W):(this.customHover=setupCustomHover(this.options.hoverDelegate,this.element,W),this._store.add(this.customHover))):this.element.title=W}updateAriaLabel(){var C;if(this.element){const W=(C=this.getTooltip())!==null&&C!==void 0?C:"";this.element.setAttribute("aria-label",W)}}updateClass(){}updateChecked(){}dispose(){this.element&&(this.element.remove(),this.element=void 0),this._context=void 0,super.dispose()}}class ActionViewItem extends BaseActionViewItem{constructor(C,W,V){super(C,W,V),this.options=V,this.options.icon=V.icon!==void 0?V.icon:!1,this.options.label=V.label!==void 0?V.label:!0,this.cssClass=""}render(C){super.render(C),this.element&&(this.label=append$3(this.element,$$d("a.action-label"))),this.label&&this.label.setAttribute("role",this.getDefaultAriaRole()),this.options.label&&this.options.keybinding&&this.element&&(append$3(this.element,$$d("span.keybinding")).textContent=this.options.keybinding),this.updateClass(),this.updateLabel(),this.updateTooltip(),this.updateEnabled(),this.updateChecked()}getDefaultAriaRole(){return this._action.id===Separator.ID?"presentation":this.options.isMenu?"menuitem":"button"}focus(){this.label&&(this.label.tabIndex=0,this.label.focus())}blur(){this.label&&(this.label.tabIndex=-1)}setFocusable(C){this.label&&(this.label.tabIndex=C?0:-1)}updateLabel(){this.options.label&&this.label&&(this.label.textContent=this.action.label)}getTooltip(){let C=null;return this.action.tooltip?C=this.action.tooltip:!this.options.label&&this.action.label&&this.options.icon&&(C=this.action.label,this.options.keybinding&&(C=localize({key:"titleLabel",comment:["action title","action keybinding"]},"{0} ({1})",C,this.options.keybinding))),C??void 0}updateClass(){var C;this.cssClass&&this.label&&this.label.classList.remove(...this.cssClass.split(" ")),this.options.icon?(this.cssClass=this.action.class,this.label&&(this.label.classList.add("codicon"),this.cssClass&&this.label.classList.add(...this.cssClass.split(" "))),this.updateEnabled()):(C=this.label)===null||C===void 0||C.classList.remove("codicon")}updateEnabled(){var C,W;this.action.enabled?(this.label&&(this.label.removeAttribute("aria-disabled"),this.label.classList.remove("disabled")),(C=this.element)===null||C===void 0||C.classList.remove("disabled")):(this.label&&(this.label.setAttribute("aria-disabled","true"),this.label.classList.add("disabled")),(W=this.element)===null||W===void 0||W.classList.add("disabled"))}updateAriaLabel(){var C;if(this.label){const W=(C=this.getTooltip())!==null&&C!==void 0?C:"";this.label.setAttribute("aria-label",W)}}updateChecked(){this.label&&(this.action.checked!==void 0?(this.label.classList.toggle("checked",this.action.checked),this.label.setAttribute("aria-checked",this.action.checked?"true":"false"),this.label.setAttribute("role","checkbox")):(this.label.classList.remove("checked"),this.label.setAttribute("aria-checked",""),this.label.setAttribute("role",this.getDefaultAriaRole())))}}class SelectActionViewItem extends BaseActionViewItem{constructor(C,W,V,U,G,Z,X){super(C,W),this.selectBox=new SelectBox(V,U,G,Z,X),this.selectBox.setFocusable(!1),this._register(this.selectBox),this.registerListeners()}select(C){this.selectBox.select(C)}registerListeners(){this._register(this.selectBox.onDidSelect(C=>this.runAction(C.selected,C.index)))}runAction(C,W){this.actionRunner.run(this._action,this.getActionContext(C,W))}getActionContext(C,W){return C}setFocusable(C){this.selectBox.setFocusable(C)}focus(){var C;(C=this.selectBox)===null||C===void 0||C.focus()}blur(){var C;(C=this.selectBox)===null||C===void 0||C.blur()}render(C){this.selectBox.render(C)}}const dropdown="";class BaseDropdown extends ActionRunner{constructor(C,W){super(),this._onDidChangeVisibility=this._register(new Emitter$1),this.onDidChangeVisibility=this._onDidChangeVisibility.event,this._element=append$3(C,$$d(".monaco-dropdown")),this._label=append$3(this._element,$$d(".dropdown-label"));let V=W.labelRenderer;V||(V=G=>(G.textContent=W.label||"",null));for(const G of[EventType$1.CLICK,EventType$1.MOUSE_DOWN,EventType.Tap])this._register(addDisposableListener(this.element,G,Z=>EventHelper.stop(Z,!0)));for(const G of[EventType$1.MOUSE_DOWN,EventType.Tap])this._register(addDisposableListener(this._label,G,Z=>{Z instanceof MouseEvent&&(Z.detail>1||Z.button!==0)||(this.visible?this.hide():this.show())}));this._register(addDisposableListener(this._label,EventType$1.KEY_UP,G=>{const Z=new StandardKeyboardEvent(G);(Z.equals(3)||Z.equals(10))&&(EventHelper.stop(G,!0),this.visible?this.hide():this.show())}));const U=V(this._label);U&&this._register(U),this._register(Gesture.addTarget(this._label))}get element(){return this._element}show(){this.visible||(this.visible=!0,this._onDidChangeVisibility.fire(!0))}hide(){this.visible&&(this.visible=!1,this._onDidChangeVisibility.fire(!1))}dispose(){super.dispose(),this.hide(),this.boxContainer&&(this.boxContainer.remove(),this.boxContainer=void 0),this.contents&&(this.contents.remove(),this.contents=void 0),this._label&&(this._label.remove(),this._label=void 0)}}class DropdownMenu extends BaseDropdown{constructor(C,W){super(C,W),this._options=W,this._actions=[],this.actions=W.actions||[]}set menuOptions(C){this._menuOptions=C}get menuOptions(){return this._menuOptions}get actions(){return this._options.actionProvider?this._options.actionProvider.getActions():this._actions}set actions(C){this._actions=C}show(){super.show(),this.element.classList.add("active"),this._options.contextMenuProvider.showContextMenu({getAnchor:()=>this.element,getActions:()=>this.actions,getActionsContext:()=>this.menuOptions?this.menuOptions.context:null,getActionViewItem:(C,W)=>this.menuOptions&&this.menuOptions.actionViewItemProvider?this.menuOptions.actionViewItemProvider(C,W):void 0,getKeyBinding:C=>this.menuOptions&&this.menuOptions.getKeyBinding?this.menuOptions.getKeyBinding(C):void 0,getMenuClassName:()=>this._options.menuClassName||"",onHide:()=>this.onHide(),actionRunner:this.menuOptions?this.menuOptions.actionRunner:void 0,anchorAlignment:this.menuOptions?this.menuOptions.anchorAlignment:0,domForShadowRoot:this._options.menuAsChild?this.element:void 0,skipTelemetry:this._options.skipTelemetry})}hide(){super.hide()}onHide(){this.hide(),this.element.classList.remove("active")}}class DropdownMenuActionViewItem extends BaseActionViewItem{constructor(C,W,V,U=Object.create(null)){super(null,C,U),this.actionItem=null,this._onDidChangeVisibility=this._register(new Emitter$1),this.onDidChangeVisibility=this._onDidChangeVisibility.event,this.menuActionsOrProvider=W,this.contextMenuProvider=V,this.options=U,this.options.actionRunner&&(this.actionRunner=this.options.actionRunner)}render(C){this.actionItem=C;const W=G=>{this.element=append$3(G,$$d("a.action-label"));let Z=[];return typeof this.options.classNames=="string"?Z=this.options.classNames.split(/\s+/g).filter(X=>!!X):this.options.classNames&&(Z=this.options.classNames),Z.find(X=>X==="icon")||Z.push("codicon"),this.element.classList.add(...Z),this.element.setAttribute("role","button"),this.element.setAttribute("aria-haspopup","true"),this.element.setAttribute("aria-expanded","false"),this.element.title=this._action.label||"",this.element.ariaLabel=this._action.label||"",null},V=Array.isArray(this.menuActionsOrProvider),U={contextMenuProvider:this.contextMenuProvider,labelRenderer:W,menuAsChild:this.options.menuAsChild,actions:V?this.menuActionsOrProvider:void 0,actionProvider:V?void 0:this.menuActionsOrProvider,skipTelemetry:this.options.skipTelemetry};if(this.dropdownMenu=this._register(new DropdownMenu(C,U)),this._register(this.dropdownMenu.onDidChangeVisibility(G=>{var Z;(Z=this.element)===null||Z===void 0||Z.setAttribute("aria-expanded",`${G}`),this._onDidChangeVisibility.fire(G)})),this.dropdownMenu.menuOptions={actionViewItemProvider:this.options.actionViewItemProvider,actionRunner:this.actionRunner,getKeyBinding:this.options.keybindingProvider,context:this._context},this.options.anchorAlignmentProvider){const G=this;this.dropdownMenu.menuOptions=Object.assign(Object.assign({},this.dropdownMenu.menuOptions),{get anchorAlignment(){return G.options.anchorAlignmentProvider()}})}this.updateTooltip(),this.updateEnabled()}getTooltip(){let C=null;return this.action.tooltip?C=this.action.tooltip:this.action.label&&(C=this.action.label),C??void 0}setActionContext(C){super.setActionContext(C),this.dropdownMenu&&(this.dropdownMenu.menuOptions?this.dropdownMenu.menuOptions.context=C:this.dropdownMenu.menuOptions={context:C})}show(){var C;(C=this.dropdownMenu)===null||C===void 0||C.show()}updateEnabled(){var C,W;const V=!this.action.enabled;(C=this.actionItem)===null||C===void 0||C.classList.toggle("disabled",V),(W=this.element)===null||W===void 0||W.classList.toggle("disabled",V)}}const menuEntryActionViewItem="";function isICommandActionToggleInfo(K){return K?K.condition!==void 0:!1}var __awaiter$1n=globalThis&&globalThis.__awaiter||function(K,C,W,V){function U(G){return G instanceof W?G:new W(function(Z){Z(G)})}return new(W||(W=Promise))(function(G,Z){function X(ee){try{J(V.next(ee))}catch(te){Z(te)}}function Q(ee){try{J(V.throw(ee))}catch(te){Z(te)}}function J(ee){ee.done?G(ee.value):U(ee.value).then(X,Q)}J((V=V.apply(K,C||[])).next())})},StorageHint;(function(K){K[K.STORAGE_DOES_NOT_EXIST=0]="STORAGE_DOES_NOT_EXIST",K[K.STORAGE_IN_MEMORY=1]="STORAGE_IN_MEMORY"})(StorageHint||(StorageHint={}));var StorageState;(function(K){K[K.None=0]="None",K[K.Initialized=1]="Initialized",K[K.Closed=2]="Closed"})(StorageState||(StorageState={}));class Storage extends Disposable{constructor(C,W=Object.create(null)){super(),this.database=C,this.options=W,this._onDidChangeStorage=this._register(new PauseableEmitter),this.onDidChangeStorage=this._onDidChangeStorage.event,this.state=StorageState.None,this.cache=new Map,this.flushDelayer=this._register(new ThrottledDelayer(Storage.DEFAULT_FLUSH_DELAY)),this.pendingDeletes=new Set,this.pendingInserts=new Map,this.whenFlushedCallbacks=[],this.registerListeners()}registerListeners(){this._register(this.database.onDidChangeItemsExternal(C=>this.onDidChangeItemsExternal(C)))}onDidChangeItemsExternal(C){var W,V;this._onDidChangeStorage.pause();try{(W=C.changed)===null||W===void 0||W.forEach((U,G)=>this.acceptExternal(G,U)),(V=C.deleted)===null||V===void 0||V.forEach(U=>this.acceptExternal(U,void 0))}finally{this._onDidChangeStorage.resume()}}acceptExternal(C,W){if(this.state===StorageState.Closed)return;let V=!1;isUndefinedOrNull(W)?V=this.cache.delete(C):this.cache.get(C)!==W&&(this.cache.set(C,W),V=!0),V&&this._onDidChangeStorage.fire({key:C,external:!0})}get(C,W){const V=this.cache.get(C);return isUndefinedOrNull(V)?W:V}getBoolean(C,W){const V=this.get(C);return isUndefinedOrNull(V)?W:V==="true"}getNumber(C,W){const V=this.get(C);return isUndefinedOrNull(V)?W:parseInt(V,10)}set(C,W,V=!1){return __awaiter$1n(this,void 0,void 0,function*(){if(this.state===StorageState.Closed)return;if(isUndefinedOrNull(W))return this.delete(C,V);const U=isObject$2(W)||Array.isArray(W)?stringify(W):String(W);if(this.cache.get(C)!==U)return this.cache.set(C,U),this.pendingInserts.set(C,U),this.pendingDeletes.delete(C),this._onDidChangeStorage.fire({key:C,external:V}),this.doFlush()})}delete(C,W=!1){return __awaiter$1n(this,void 0,void 0,function*(){if(!(this.state===StorageState.Closed||!this.cache.delete(C)))return this.pendingDeletes.has(C)||this.pendingDeletes.add(C),this.pendingInserts.delete(C),this._onDidChangeStorage.fire({key:C,external:W}),this.doFlush()})}get hasPending(){return this.pendingInserts.size>0||this.pendingDeletes.size>0}flushPending(){return __awaiter$1n(this,void 0,void 0,function*(){if(!this.hasPending)return;const C={insert:this.pendingInserts,delete:this.pendingDeletes};return this.pendingDeletes=new Set,this.pendingInserts=new Map,this.database.updateItems(C).finally(()=>{var W;if(!this.hasPending)for(;this.whenFlushedCallbacks.length;)(W=this.whenFlushedCallbacks.pop())===null||W===void 0||W()})})}doFlush(C){return __awaiter$1n(this,void 0,void 0,function*(){return this.options.hint===StorageHint.STORAGE_IN_MEMORY?this.flushPending():this.flushDelayer.trigger(()=>this.flushPending(),C)})}}Storage.DEFAULT_FLUSH_DELAY=100;class InMemoryStorageDatabase{constructor(){this.onDidChangeItemsExternal=Event$1.None,this.items=new Map}updateItems(C){var W,V;return __awaiter$1n(this,void 0,void 0,function*(){(W=C.insert)===null||W===void 0||W.forEach((U,G)=>this.items.set(G,U)),(V=C.delete)===null||V===void 0||V.forEach(U=>this.items.delete(U))})}}const TARGET_KEY="__$__targetStorageMarker",IStorageService=createDecorator("storageService");var WillSaveStateReason;(function(K){K[K.NONE=0]="NONE",K[K.SHUTDOWN=1]="SHUTDOWN"})(WillSaveStateReason||(WillSaveStateReason={}));function loadKeyTargets(K){const C=K.get(TARGET_KEY);if(C)try{return JSON.parse(C)}catch{}return Object.create(null)}class AbstractStorageService extends Disposable{constructor(C={flushInterval:AbstractStorageService.DEFAULT_FLUSH_INTERVAL}){super(),this.options=C,this._onDidChangeValue=this._register(new PauseableEmitter),this._onDidChangeTarget=this._register(new PauseableEmitter),this._onWillSaveState=this._register(new Emitter$1),this.onWillSaveState=this._onWillSaveState.event,this._workspaceKeyTargets=void 0,this._profileKeyTargets=void 0,this._applicationKeyTargets=void 0}onDidChangeValue(C,W,V){return Event$1.filter(this._onDidChangeValue.event,U=>U.scope===C&&(W===void 0||U.key===W),V)}emitDidChangeValue(C,W){const{key:V,external:U}=W;if(V===TARGET_KEY){switch(C){case-1:this._applicationKeyTargets=void 0;break;case 0:this._profileKeyTargets=void 0;break;case 1:this._workspaceKeyTargets=void 0;break}this._onDidChangeTarget.fire({scope:C})}else this._onDidChangeValue.fire({scope:C,key:V,target:this.getKeyTargets(C)[V],external:U})}get(C,W,V){var U;return(U=this.getStorage(W))===null||U===void 0?void 0:U.get(C,V)}getBoolean(C,W,V){var U;return(U=this.getStorage(W))===null||U===void 0?void 0:U.getBoolean(C,V)}getNumber(C,W,V){var U;return(U=this.getStorage(W))===null||U===void 0?void 0:U.getNumber(C,V)}store(C,W,V,U,G=!1){if(isUndefinedOrNull(W)){this.remove(C,V,G);return}this.withPausedEmitters(()=>{var Z;this.updateKeyTarget(C,V,U),(Z=this.getStorage(V))===null||Z===void 0||Z.set(C,W,G)})}remove(C,W,V=!1){this.withPausedEmitters(()=>{var U;this.updateKeyTarget(C,W,void 0),(U=this.getStorage(W))===null||U===void 0||U.delete(C,V)})}withPausedEmitters(C){this._onDidChangeValue.pause(),this._onDidChangeTarget.pause();try{C()}finally{this._onDidChangeValue.resume(),this._onDidChangeTarget.resume()}}updateKeyTarget(C,W,V,U=!1){var G,Z;const X=this.getKeyTargets(W);typeof V=="number"?X[C]!==V&&(X[C]=V,(G=this.getStorage(W))===null||G===void 0||G.set(TARGET_KEY,JSON.stringify(X),U)):typeof X[C]=="number"&&(delete X[C],(Z=this.getStorage(W))===null||Z===void 0||Z.set(TARGET_KEY,JSON.stringify(X),U))}get workspaceKeyTargets(){return this._workspaceKeyTargets||(this._workspaceKeyTargets=this.loadKeyTargets(1)),this._workspaceKeyTargets}get profileKeyTargets(){return this._profileKeyTargets||(this._profileKeyTargets=this.loadKeyTargets(0)),this._profileKeyTargets}get applicationKeyTargets(){return this._applicationKeyTargets||(this._applicationKeyTargets=this.loadKeyTargets(-1)),this._applicationKeyTargets}getKeyTargets(C){switch(C){case-1:return this.applicationKeyTargets;case 0:return this.profileKeyTargets;default:return this.workspaceKeyTargets}}loadKeyTargets(C){const W=this.getStorage(C);return W?loadKeyTargets(W):Object.create(null)}}AbstractStorageService.DEFAULT_FLUSH_INTERVAL=60*1e3;class InMemoryStorageService extends AbstractStorageService{constructor(){super(),this.applicationStorage=this._register(new Storage(new InMemoryStorageDatabase,{hint:StorageHint.STORAGE_IN_MEMORY})),this.profileStorage=this._register(new Storage(new InMemoryStorageDatabase,{hint:StorageHint.STORAGE_IN_MEMORY})),this.workspaceStorage=this._register(new Storage(new InMemoryStorageDatabase,{hint:StorageHint.STORAGE_IN_MEMORY})),this._register(this.workspaceStorage.onDidChangeStorage(C=>this.emitDidChangeValue(1,C))),this._register(this.profileStorage.onDidChangeStorage(C=>this.emitDidChangeValue(0,C))),this._register(this.applicationStorage.onDidChangeStorage(C=>this.emitDidChangeValue(-1,C)))}getStorage(C){switch(C){case-1:return this.applicationStorage;case 0:return this.profileStorage;default:return this.workspaceStorage}}}function overrideStyles(K,C){const W=Object.assign({},C);for(const V in K){const U=K[V];W[V]=U!==void 0?asCssVariable(U):void 0}return W}const defaultKeybindingLabelStyles={keybindingLabelBackground:asCssVariable(keybindingLabelBackground),keybindingLabelForeground:asCssVariable(keybindingLabelForeground),keybindingLabelBorder:asCssVariable(keybindingLabelBorder),keybindingLabelBottomBorder:asCssVariable(keybindingLabelBottomBorder),keybindingLabelShadow:asCssVariable(widgetShadow)},defaultButtonStyles={buttonForeground:asCssVariable(buttonForeground),buttonSeparator:asCssVariable(buttonSeparator),buttonBackground:asCssVariable(buttonBackground),buttonHoverBackground:asCssVariable(buttonHoverBackground),buttonSecondaryForeground:asCssVariable(buttonSecondaryForeground),buttonSecondaryBackground:asCssVariable(buttonSecondaryBackground),buttonSecondaryHoverBackground:asCssVariable(buttonSecondaryHoverBackground),buttonBorder:asCssVariable(buttonBorder)},defaultProgressBarStyles={progressBarBackground:asCssVariable(progressBarBackground)},defaultToggleStyles={inputActiveOptionBorder:asCssVariable(inputActiveOptionBorder),inputActiveOptionForeground:asCssVariable(inputActiveOptionForeground),inputActiveOptionBackground:asCssVariable(inputActiveOptionBackground)};asCssVariable(checkboxBackground),asCssVariable(checkboxBorder),asCssVariable(checkboxForeground);asCssVariable(editorWidgetBackground),asCssVariable(editorWidgetForeground),asCssVariable(widgetShadow),asCssVariable(contrastBorder),asCssVariable(problemsErrorIconForeground),asCssVariable(problemsWarningIconForeground),asCssVariable(problemsInfoIconForeground),asCssVariable(textLinkForeground);const defaultInputBoxStyles={inputBackground:asCssVariable(inputBackground),inputForeground:asCssVariable(inputForeground),inputBorder:asCssVariable(inputBorder),inputValidationInfoBorder:asCssVariable(inputValidationInfoBorder),inputValidationInfoBackground:asCssVariable(inputValidationInfoBackground),inputValidationInfoForeground:asCssVariable(inputValidationInfoForeground),inputValidationWarningBorder:asCssVariable(inputValidationWarningBorder),inputValidationWarningBackground:asCssVariable(inputValidationWarningBackground),inputValidationWarningForeground:asCssVariable(inputValidationWarningForeground),inputValidationErrorBorder:asCssVariable(inputValidationErrorBorder),inputValidationErrorBackground:asCssVariable(inputValidationErrorBackground),inputValidationErrorForeground:asCssVariable(inputValidationErrorForeground)},defaultFindWidgetStyles={listFilterWidgetBackground:asCssVariable(listFilterWidgetBackground),listFilterWidgetOutline:asCssVariable(listFilterWidgetOutline),listFilterWidgetNoMatchesOutline:asCssVariable(listFilterWidgetNoMatchesOutline),listFilterWidgetShadow:asCssVariable(listFilterWidgetShadow),inputBoxStyles:defaultInputBoxStyles,toggleStyles:defaultToggleStyles},defaultCountBadgeStyles={badgeBackground:asCssVariable(badgeBackground),badgeForeground:asCssVariable(badgeForeground),badgeBorder:asCssVariable(contrastBorder)};asCssVariable(breadcrumbsBackground),asCssVariable(breadcrumbsForeground),asCssVariable(breadcrumbsFocusForeground),asCssVariable(breadcrumbsFocusForeground),asCssVariable(breadcrumbsActiveSelectionForeground);const defaultListStyles={listBackground:void 0,listInactiveFocusForeground:void 0,listFocusBackground:asCssVariable(listFocusBackground),listFocusForeground:asCssVariable(listFocusForeground),listFocusOutline:asCssVariable(listFocusOutline),listActiveSelectionBackground:asCssVariable(listActiveSelectionBackground),listActiveSelectionForeground:asCssVariable(listActiveSelectionForeground),listActiveSelectionIconForeground:asCssVariable(listActiveSelectionIconForeground),listFocusAndSelectionOutline:asCssVariable(listFocusAndSelectionOutline),listFocusAndSelectionBackground:asCssVariable(listActiveSelectionBackground),listFocusAndSelectionForeground:asCssVariable(listActiveSelectionForeground),listInactiveSelectionBackground:asCssVariable(listInactiveSelectionBackground),listInactiveSelectionIconForeground:asCssVariable(listInactiveSelectionIconForeground),listInactiveSelectionForeground:asCssVariable(listInactiveSelectionForeground),listInactiveFocusBackground:asCssVariable(listInactiveFocusBackground),listInactiveFocusOutline:asCssVariable(listInactiveFocusOutline),listHoverBackground:asCssVariable(listHoverBackground),listHoverForeground:asCssVariable(listHoverForeground),listDropBackground:asCssVariable(listDropBackground),listSelectionOutline:asCssVariable(activeContrastBorder),listHoverOutline:asCssVariable(activeContrastBorder),treeIndentGuidesStroke:asCssVariable(treeIndentGuidesStroke),treeInactiveIndentGuidesStroke:asCssVariable(treeInactiveIndentGuidesStroke),tableColumnsBorder:asCssVariable(tableColumnsBorder),tableOddRowsBackgroundColor:asCssVariable(tableOddRowsBackgroundColor)};function getListStyles(K){return overrideStyles(K,defaultListStyles)}const defaultSelectBoxStyles={selectBackground:asCssVariable(selectBackground),selectListBackground:asCssVariable(selectListBackground),selectForeground:asCssVariable(selectForeground),decoratorRightForeground:asCssVariable(pickerGroupForeground),selectBorder:asCssVariable(selectBorder),focusBorder:asCssVariable(focusBorder),listFocusBackground:asCssVariable(quickInputListFocusBackground),listInactiveSelectionIconForeground:asCssVariable(quickInputListFocusIconForeground),listFocusForeground:asCssVariable(quickInputListFocusForeground),listFocusOutline:asCssVariableWithDefault(activeContrastBorder,Color.transparent.toString()),listHoverBackground:asCssVariable(listHoverBackground),listHoverForeground:asCssVariable(listHoverForeground),listHoverOutline:asCssVariable(activeContrastBorder),selectListBorder:asCssVariable(editorWidgetBorder),listBackground:void 0,listActiveSelectionBackground:void 0,listActiveSelectionForeground:void 0,listActiveSelectionIconForeground:void 0,listFocusAndSelectionBackground:void 0,listDropBackground:void 0,listInactiveSelectionBackground:void 0,listInactiveSelectionForeground:void 0,listInactiveFocusBackground:void 0,listInactiveFocusOutline:void 0,listSelectionOutline:void 0,listFocusAndSelectionForeground:void 0,listFocusAndSelectionOutline:void 0,listInactiveFocusForeground:void 0,tableColumnsBorder:void 0,tableOddRowsBackgroundColor:void 0,treeIndentGuidesStroke:void 0,treeInactiveIndentGuidesStroke:void 0},defaultMenuStyles={shadowColor:asCssVariable(widgetShadow),borderColor:asCssVariable(menuBorder),foregroundColor:asCssVariable(menuForeground),backgroundColor:asCssVariable(menuBackground),selectionForegroundColor:asCssVariable(menuSelectionForeground),selectionBackgroundColor:asCssVariable(menuSelectionBackground),selectionBorderColor:asCssVariable(menuSelectionBorder),separatorColor:asCssVariable(menuSeparatorBackground),scrollbarShadow:asCssVariable(scrollbarShadow),scrollbarSliderBackground:asCssVariable(scrollbarSliderBackground),scrollbarSliderHoverBackground:asCssVariable(scrollbarSliderHoverBackground),scrollbarSliderActiveBackground:asCssVariable(scrollbarSliderActiveBackground)};var __decorate$1R=globalThis&&globalThis.__decorate||function(K,C,W,V){var U=arguments.length,G=U<3?C:V===null?V=Object.getOwnPropertyDescriptor(C,W):V,Z;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")G=Reflect.decorate(K,C,W,V);else for(var X=K.length-1;X>=0;X--)(Z=K[X])&&(G=(U<3?Z(G):U>3?Z(C,W,G):Z(C,W))||G);return U>3&&G&&Object.defineProperty(C,W,G),G},__param$1N=globalThis&&globalThis.__param||function(K,C){return function(W,V){C(W,V,K)}},__awaiter$1m=globalThis&&globalThis.__awaiter||function(K,C,W,V){function U(G){return G instanceof W?G:new W(function(Z){Z(G)})}return new(W||(W=Promise))(function(G,Z){function X(ee){try{J(V.next(ee))}catch(te){Z(te)}}function Q(ee){try{J(V.throw(ee))}catch(te){Z(te)}}function J(ee){ee.done?G(ee.value):U(ee.value).then(X,Q)}J((V=V.apply(K,C||[])).next())})};function createAndFillInContextMenuActions(K,C,W,V){const U=K.getActions(C),G=ModifierKeyEmitter.getInstance(),Z=G.keyStatus.altKey||(isWindows||isLinux)&&G.keyStatus.shiftKey;fillInActions(U,W,Z,V?X=>X===V:X=>X==="navigation")}function createAndFillInActionBarActions(K,C,W,V,U,G){const Z=K.getActions(C);fillInActions(Z,W,!1,typeof V=="string"?Q=>Q===V:V,U,G)}function fillInActions(K,C,W,V=Z=>Z==="navigation",U=()=>!1,G=!1){let Z,X;Array.isArray(C)?(Z=C,X=C):(Z=C.primary,X=C.secondary);const Q=new Set;for(const[J,ee]of K){let te;V(J)?(te=Z,te.length>0&&G&&te.push(new Separator)):(te=X,te.length>0&&te.push(new Separator));for(let ie of ee){W&&(ie=ie instanceof MenuItemAction&&ie.alt?ie.alt:ie);const ne=te.push(ie);ie instanceof SubmenuAction&&Q.add({group:J,action:ie,index:ne-1})}}for(const{group:J,action:ee,index:te}of Q){const ie=V(J)?Z:X,ne=ee.actions;U(ee,J,ie.length)&&ie.splice(te,1,...ne)}}let MenuEntryActionViewItem=class extends ActionViewItem{constructor(C,W,V,U,G,Z,X,Q){super(void 0,C,{icon:!!(C.class||C.item.icon),label:!C.class&&!C.item.icon,draggable:W==null?void 0:W.draggable,keybinding:W==null?void 0:W.keybinding,hoverDelegate:W==null?void 0:W.hoverDelegate}),this._keybindingService=V,this._notificationService=U,this._contextKeyService=G,this._themeService=Z,this._contextMenuService=X,this._accessibilityService=Q,this._wantsAltCommand=!1,this._itemClassDispose=this._register(new MutableDisposable),this._altKey=ModifierKeyEmitter.getInstance()}get _menuItemAction(){return this._action}get _commandAction(){return this._wantsAltCommand&&this._menuItemAction.alt||this._menuItemAction}onClick(C){return __awaiter$1m(this,void 0,void 0,function*(){C.preventDefault(),C.stopPropagation();try{yield this.actionRunner.run(this._commandAction,this._context)}catch(W){this._notificationService.error(W)}})}render(C){if(super.render(C),C.classList.add("menu-entry"),this.options.icon&&this._updateItemClass(this._menuItemAction.item),this._menuItemAction.alt){let W=!1;const V=()=>{var U;const G=!!(!((U=this._menuItemAction.alt)===null||U===void 0)&&U.enabled)&&(!this._accessibilityService.isMotionReduced()||W)&&(this._altKey.keyStatus.altKey||this._altKey.keyStatus.shiftKey&&W);G!==this._wantsAltCommand&&(this._wantsAltCommand=G,this.updateLabel(),this.updateTooltip(),this.updateClass())};this._register(this._altKey.event(V)),this._register(addDisposableListener(C,"mouseleave",U=>{W=!1,V()})),this._register(addDisposableListener(C,"mouseenter",U=>{W=!0,V()})),V()}}updateLabel(){this.options.label&&this.label&&(this.label.textContent=this._commandAction.label)}getTooltip(){var C;const W=this._keybindingService.lookupKeybinding(this._commandAction.id,this._contextKeyService),V=W&&W.getLabel(),U=this._commandAction.tooltip||this._commandAction.label;let G=V?localize("titleAndKb","{0} ({1})",U,V):U;if(!this._wantsAltCommand&&(!((C=this._menuItemAction.alt)===null||C===void 0)&&C.enabled)){const Z=this._menuItemAction.alt.tooltip||this._menuItemAction.alt.label,X=this._keybindingService.lookupKeybinding(this._menuItemAction.alt.id,this._contextKeyService),Q=X&&X.getLabel(),J=Q?localize("titleAndKb","{0} ({1})",Z,Q):Z;G=localize("titleAndKbAndAlt",`{0}
[{1}] {2}`,G,UILabelProvider.modifierLabels[OS].altKey,J)}return G}updateClass(){this.options.icon&&(this._commandAction!==this._menuItemAction?this._menuItemAction.alt&&this._updateItemClass(this._menuItemAction.alt.item):this._updateItemClass(this._menuItemAction.item))}_updateItemClass(C){this._itemClassDispose.value=void 0;const{element:W,label:V}=this;if(!W||!V)return;const U=this._commandAction.checked&&isICommandActionToggleInfo(C.toggled)&&C.toggled.icon?C.toggled.icon:C.icon;if(U)if(ThemeIcon.isThemeIcon(U)){const G=ThemeIcon.asClassNameArray(U);V.classList.add(...G),this._itemClassDispose.value=toDisposable(()=>{V.classList.remove(...G)})}else{const G=isDark(this._themeService.getColorTheme().type)?asCSSUrl(U.dark):asCSSUrl(U.light),Z=$$d("span");Z.style.webkitMask=Z.style.mask=`${G} no-repeat 50% 50%`,Z.style.background="var(--vscode-icon-foreground)",Z.style.display="inline-block",Z.style.width="100%",Z.style.height="100%",V.appendChild(Z),V.classList.add("icon"),this._itemClassDispose.value=combinedDisposable(toDisposable(()=>{V.classList.remove("icon"),reset(V)}),this._themeService.onDidColorThemeChange(()=>{this.updateClass()}))}}};MenuEntryActionViewItem=__decorate$1R([__param$1N(2,IKeybindingService),__param$1N(3,INotificationService),__param$1N(4,IContextKeyService),__param$1N(5,IThemeService),__param$1N(6,IContextMenuService),__param$1N(7,IAccessibilityService)],MenuEntryActionViewItem);let SubmenuEntryActionViewItem=class extends DropdownMenuActionViewItem{constructor(C,W,V,U,G){var Z,X,Q;const J=Object.assign(Object.assign({},W),{menuAsChild:(Z=W==null?void 0:W.menuAsChild)!==null&&Z!==void 0?Z:!1,classNames:(X=W==null?void 0:W.classNames)!==null&&X!==void 0?X:ThemeIcon.isThemeIcon(C.item.icon)?ThemeIcon.asClassName(C.item.icon):void 0,keybindingProvider:(Q=W==null?void 0:W.keybindingProvider)!==null&&Q!==void 0?Q:ee=>V.lookupKeybinding(ee.id)});super(C,{getActions:()=>C.actions},U,J),this._keybindingService=V,this._contextMenuService=U,this._themeService=G}render(C){super.render(C),assertType(this.element),C.classList.add("menu-entry");const W=this._action,{icon:V}=W.item;if(V&&!ThemeIcon.isThemeIcon(V)){this.element.classList.add("icon");const U=()=>{this.element&&(this.element.style.backgroundImage=isDark(this._themeService.getColorTheme().type)?asCSSUrl(V.dark):asCSSUrl(V.light))};U(),this._register(this._themeService.onDidColorThemeChange(()=>{U()}))}}};SubmenuEntryActionViewItem=__decorate$1R([__param$1N(2,IKeybindingService),__param$1N(3,IContextMenuService),__param$1N(4,IThemeService)],SubmenuEntryActionViewItem);let DropdownWithDefaultActionViewItem=class extends BaseActionViewItem{constructor(C,W,V,U,G,Z,X,Q){var J,ee,te;super(null,C),this._keybindingService=V,this._notificationService=U,this._contextMenuService=G,this._menuService=Z,this._instaService=X,this._storageService=Q,this._container=null,this._options=W,this._storageKey=`${C.item.submenu.id}_lastActionId`;let ie;const ne=W!=null&&W.persistLastActionId?Q.get(this._storageKey,1):void 0;ne&&(ie=C.actions.find(re=>ne===re.id)),ie||(ie=C.actions[0]),this._defaultAction=this._instaService.createInstance(MenuEntryActionViewItem,ie,{keybinding:this._getDefaultActionKeybindingLabel(ie)});const oe=Object.assign(Object.assign({keybindingProvider:re=>this._keybindingService.lookupKeybinding(re.id)},W),{menuAsChild:(J=W==null?void 0:W.menuAsChild)!==null&&J!==void 0?J:!0,classNames:(ee=W==null?void 0:W.classNames)!==null&&ee!==void 0?ee:["codicon","codicon-chevron-down"],actionRunner:(te=W==null?void 0:W.actionRunner)!==null&&te!==void 0?te:new ActionRunner});this._dropdown=new DropdownMenuActionViewItem(C,C.actions,this._contextMenuService,oe),this._dropdown.actionRunner.onDidRun(re=>{re.action instanceof MenuItemAction&&this.update(re.action)})}update(C){var W;!((W=this._options)===null||W===void 0)&&W.persistLastActionId&&this._storageService.store(this._storageKey,C.id,1,1),this._defaultAction.dispose(),this._defaultAction=this._instaService.createInstance(MenuEntryActionViewItem,C,{keybinding:this._getDefaultActionKeybindingLabel(C)}),this._defaultAction.actionRunner=new class extends ActionRunner{runAction(V,U){return __awaiter$1m(this,void 0,void 0,function*(){yield V.run(void 0)})}},this._container&&this._defaultAction.render(prepend$3(this._container,$$d(".action-container")))}_getDefaultActionKeybindingLabel(C){var W;let V;if(!((W=this._options)===null||W===void 0)&&W.renderKeybindingWithDefaultActionLabel){const U=this._keybindingService.lookupKeybinding(C.id);U&&(V=`(${U.getLabel()})`)}return V}setActionContext(C){super.setActionContext(C),this._defaultAction.setActionContext(C),this._dropdown.setActionContext(C)}render(C){this._container=C,super.render(this._container),this._container.classList.add("monaco-dropdown-with-default");const W=$$d(".action-container");this._defaultAction.render(append$3(this._container,W)),this._register(addDisposableListener(W,EventType$1.KEY_DOWN,U=>{const G=new StandardKeyboardEvent(U);G.equals(17)&&(this._defaultAction.element.tabIndex=-1,this._dropdown.focus(),G.stopPropagation())}));const V=$$d(".dropdown-action-container");this._dropdown.render(append$3(this._container,V)),this._register(addDisposableListener(V,EventType$1.KEY_DOWN,U=>{var G;const Z=new StandardKeyboardEvent(U);Z.equals(15)&&(this._defaultAction.element.tabIndex=0,this._dropdown.setFocusable(!1),(G=this._defaultAction.element)===null||G===void 0||G.focus(),Z.stopPropagation())}))}focus(C){C?this._dropdown.focus():(this._defaultAction.element.tabIndex=0,this._defaultAction.element.focus())}blur(){this._defaultAction.element.tabIndex=-1,this._dropdown.blur(),this._container.blur()}setFocusable(C){C?this._defaultAction.element.tabIndex=0:(this._defaultAction.element.tabIndex=-1,this._dropdown.setFocusable(!1))}dispose(){this._defaultAction.dispose(),this._dropdown.dispose(),super.dispose()}};DropdownWithDefaultActionViewItem=__decorate$1R([__param$1N(2,IKeybindingService),__param$1N(3,INotificationService),__param$1N(4,IContextMenuService),__param$1N(5,IMenuService),__param$1N(6,IInstantiationService),__param$1N(7,IStorageService)],DropdownWithDefaultActionViewItem);let SubmenuEntrySelectActionViewItem=class extends SelectActionViewItem{constructor(C,W){super(null,C,C.actions.map(V=>({text:V.id===Separator.ID?"─────────":V.label,isDisabled:!V.enabled})),0,W,defaultSelectBoxStyles,{ariaLabel:C.tooltip,optionsAsChildren:!0}),this.select(Math.max(0,C.actions.findIndex(V=>V.checked)))}render(C){super.render(C),C.style.borderColor=asCssVariable(selectBorder)}runAction(C,W){const V=this.action.actions[W];V&&this.actionRunner.run(V)}};SubmenuEntrySelectActionViewItem=__decorate$1R([__param$1N(1,IContextViewService)],SubmenuEntrySelectActionViewItem);function createActionViewItem(K,C,W){return C instanceof MenuItemAction?K.createInstance(MenuEntryActionViewItem,C,W):C instanceof SubmenuItemAction?C.item.isSelection?K.createInstance(SubmenuEntrySelectActionViewItem,C):C.item.rememberDefaultAction?K.createInstance(DropdownWithDefaultActionViewItem,C,Object.assign(Object.assign({},W),{persistLastActionId:!0})):K.createInstance(SubmenuEntryActionViewItem,C,W):void 0}var __awaiter$1l=globalThis&&globalThis.__awaiter||function(K,C,W,V){function U(G){return G instanceof W?G:new W(function(Z){Z(G)})}return new(W||(W=Promise))(function(G,Z){function X(ee){try{J(V.next(ee))}catch(te){Z(te)}}function Q(ee){try{J(V.throw(ee))}catch(te){Z(te)}}function J(ee){ee.done?G(ee.value):U(ee.value).then(X,Q)}J((V=V.apply(K,C||[])).next())})};class ActionBar extends Disposable{constructor(C,W={}){var V,U,G,Z,X,Q;super(),this._actionRunnerDisposables=this._register(new DisposableStore),this.viewItemDisposables=this._register(new DisposableMap),this.triggerKeyDown=!1,this.focusable=!0,this._onDidBlur=this._register(new Emitter$1),this.onDidBlur=this._onDidBlur.event,this._onDidCancel=this._register(new Emitter$1({onWillAddFirstListener:()=>this.cancelHasListener=!0})),this.onDidCancel=this._onDidCancel.event,this.cancelHasListener=!1,this._onDidRun=this._register(new Emitter$1),this.onDidRun=this._onDidRun.event,this._onWillRun=this._register(new Emitter$1),this.onWillRun=this._onWillRun.event,this.options=W,this._context=(V=W.context)!==null&&V!==void 0?V:null,this._orientation=(U=this.options.orientation)!==null&&U!==void 0?U:0,this._triggerKeys={keyDown:(Z=(G=this.options.triggerKeys)===null||G===void 0?void 0:G.keyDown)!==null&&Z!==void 0?Z:!1,keys:(Q=(X=this.options.triggerKeys)===null||X===void 0?void 0:X.keys)!==null&&Q!==void 0?Q:[3,10]},this.options.actionRunner?this._actionRunner=this.options.actionRunner:(this._actionRunner=new ActionRunner,this._actionRunnerDisposables.add(this._actionRunner)),this._actionRunnerDisposables.add(this._actionRunner.onDidRun(te=>this._onDidRun.fire(te))),this._actionRunnerDisposables.add(this._actionRunner.onWillRun(te=>this._onWillRun.fire(te))),this.viewItems=[],this.focusedItem=void 0,this.domNode=document.createElement("div"),this.domNode.className="monaco-action-bar",W.animated!==!1&&this.domNode.classList.add("animated");let J,ee;switch(this._orientation){case 0:J=[15],ee=[17];break;case 1:J=[16],ee=[18],this.domNode.className+=" vertical";break}this._register(addDisposableListener(this.domNode,EventType$1.KEY_DOWN,te=>{const ie=new StandardKeyboardEvent(te);let ne=!0;const oe=typeof this.focusedItem=="number"?this.viewItems[this.focusedItem]:void 0;J&&(ie.equals(J[0])||ie.equals(J[1]))?ne=this.focusPrevious():ee&&(ie.equals(ee[0])||ie.equals(ee[1]))?ne=this.focusNext():ie.equals(9)&&this.cancelHasListener?this._onDidCancel.fire():ie.equals(14)?ne=this.focusFirst():ie.equals(13)?ne=this.focusLast():ie.equals(2)&&oe instanceof BaseActionViewItem&&oe.trapsArrowNavigation?ne=this.focusNext():this.isTriggerKeyEvent(ie)?this._triggerKeys.keyDown?this.doTrigger(ie):this.triggerKeyDown=!0:ne=!1,ne&&(ie.preventDefault(),ie.stopPropagation())})),this._register(addDisposableListener(this.domNode,EventType$1.KEY_UP,te=>{const ie=new StandardKeyboardEvent(te);this.isTriggerKeyEvent(ie)?(!this._triggerKeys.keyDown&&this.triggerKeyDown&&(this.triggerKeyDown=!1,this.doTrigger(ie)),ie.preventDefault(),ie.stopPropagation()):(ie.equals(2)||ie.equals(1026))&&this.updateFocusedItem()})),this.focusTracker=this._register(trackFocus(this.domNode)),this._register(this.focusTracker.onDidBlur(()=>{(getActiveElement()===this.domNode||!isAncestor$1(getActiveElement(),this.domNode))&&(this._onDidBlur.fire(),this.previouslyFocusedItem=this.focusedItem,this.focusedItem=void 0,this.triggerKeyDown=!1)})),this._register(this.focusTracker.onDidFocus(()=>this.updateFocusedItem())),this.actionsList=document.createElement("ul"),this.actionsList.className="actions-container",this.options.highlightToggledItems&&this.actionsList.classList.add("highlight-toggled"),this.actionsList.setAttribute("role",this.options.ariaRole||"toolbar"),this.options.ariaLabel&&this.actionsList.setAttribute("aria-label",this.options.ariaLabel),this.domNode.appendChild(this.actionsList),C.appendChild(this.domNode)}refreshRole(){this.length()>=2?this.actionsList.setAttribute("role",this.options.ariaRole||"toolbar"):this.actionsList.setAttribute("role","presentation")}setFocusable(C){if(this.focusable=C,this.focusable){const W=this.viewItems.find(V=>V instanceof BaseActionViewItem&&V.isEnabled());W instanceof BaseActionViewItem&&W.setFocusable(!0)}else this.viewItems.forEach(W=>{W instanceof BaseActionViewItem&&W.setFocusable(!1)})}isTriggerKeyEvent(C){let W=!1;return this._triggerKeys.keys.forEach(V=>{W=W||C.equals(V)}),W}updateFocusedItem(){for(let C=0;C<this.actionsList.children.length;C++){const W=this.actionsList.children[C];if(isAncestor$1(getActiveElement(),W)){this.focusedItem=C;break}}}get context(){return this._context}set context(C){this._context=C,this.viewItems.forEach(W=>W.setActionContext(C))}get actionRunner(){return this._actionRunner}set actionRunner(C){this._actionRunner=C,this._actionRunnerDisposables.clear(),this._actionRunnerDisposables.add(this._actionRunner.onDidRun(W=>this._onDidRun.fire(W))),this._actionRunnerDisposables.add(this._actionRunner.onWillRun(W=>this._onWillRun.fire(W))),this.viewItems.forEach(W=>W.actionRunner=C)}getContainer(){return this.domNode}getAction(C){var W;if(typeof C=="number")return(W=this.viewItems[C])===null||W===void 0?void 0:W.action;if(C instanceof HTMLElement){for(;C.parentElement!==this.actionsList;){if(!C.parentElement)return;C=C.parentElement}for(let V=0;V<this.actionsList.childNodes.length;V++)if(this.actionsList.childNodes[V]===C)return this.viewItems[V].action}}push(C,W={}){const V=Array.isArray(C)?C:[C];let U=isNumber$3(W.index)?W.index:null;V.forEach(G=>{const Z=document.createElement("li");Z.className="action-item",Z.setAttribute("role","presentation");let X;const Q=Object.assign({hoverDelegate:this.options.hoverDelegate},W);this.options.actionViewItemProvider&&(X=this.options.actionViewItemProvider(G,Q)),X||(X=new ActionViewItem(this.context,G,Q)),this.options.allowContextMenu||this.viewItemDisposables.set(X,addDisposableListener(Z,EventType$1.CONTEXT_MENU,J=>{EventHelper.stop(J,!0)})),X.actionRunner=this._actionRunner,X.setActionContext(this.context),X.render(Z),this.focusable&&X instanceof BaseActionViewItem&&this.viewItems.length===0&&X.setFocusable(!0),U===null||U<0||U>=this.actionsList.children.length?(this.actionsList.appendChild(Z),this.viewItems.push(X)):(this.actionsList.insertBefore(Z,this.actionsList.children[U]),this.viewItems.splice(U,0,X),U++)}),typeof this.focusedItem=="number"&&this.focus(this.focusedItem),this.refreshRole()}clear(){this.isEmpty()||(this.viewItems=dispose(this.viewItems),this.viewItemDisposables.clearAndDisposeAll(),clearNode(this.actionsList),this.refreshRole())}length(){return this.viewItems.length}isEmpty(){return this.viewItems.length===0}focus(C){let W=!1,V;if(C===void 0?W=!0:typeof C=="number"?V=C:typeof C=="boolean"&&(W=C),W&&typeof this.focusedItem>"u"){const U=this.viewItems.findIndex(G=>G.isEnabled());this.focusedItem=U===-1?void 0:U,this.updateFocus(void 0,void 0,!0)}else V!==void 0&&(this.focusedItem=V),this.updateFocus(void 0,void 0,!0)}focusFirst(){return this.focusedItem=this.length()-1,this.focusNext(!0)}focusLast(){return this.focusedItem=0,this.focusPrevious(!0)}focusNext(C){if(typeof this.focusedItem>"u")this.focusedItem=this.viewItems.length-1;else if(this.viewItems.length<=1)return!1;const W=this.focusedItem;let V;do{if(!C&&this.options.preventLoopNavigation&&this.focusedItem+1>=this.viewItems.length)return this.focusedItem=W,!1;this.focusedItem=(this.focusedItem+1)%this.viewItems.length,V=this.viewItems[this.focusedItem]}while(this.focusedItem!==W&&(this.options.focusOnlyEnabledItems&&!V.isEnabled()||V.action.id===Separator.ID));return this.updateFocus(),!0}focusPrevious(C){if(typeof this.focusedItem>"u")this.focusedItem=0;else if(this.viewItems.length<=1)return!1;const W=this.focusedItem;let V;do{if(this.focusedItem=this.focusedItem-1,this.focusedItem<0){if(!C&&this.options.preventLoopNavigation)return this.focusedItem=W,!1;this.focusedItem=this.viewItems.length-1}V=this.viewItems[this.focusedItem]}while(this.focusedItem!==W&&(this.options.focusOnlyEnabledItems&&!V.isEnabled()||V.action.id===Separator.ID));return this.updateFocus(!0),!0}updateFocus(C,W,V=!1){var U;typeof this.focusedItem>"u"&&this.actionsList.focus({preventScroll:W}),this.previouslyFocusedItem!==void 0&&this.previouslyFocusedItem!==this.focusedItem&&((U=this.viewItems[this.previouslyFocusedItem])===null||U===void 0||U.blur());const G=this.focusedItem!==void 0&&this.viewItems[this.focusedItem];if(G){let Z=!0;isFunction$2(G.focus)||(Z=!1),this.options.focusOnlyEnabledItems&&isFunction$2(G.isEnabled)&&!G.isEnabled()&&(Z=!1),G.action.id===Separator.ID&&(Z=!1),Z?(V||this.previouslyFocusedItem!==this.focusedItem)&&(G.focus(C),this.previouslyFocusedItem=this.focusedItem):(this.actionsList.focus({preventScroll:W}),this.previouslyFocusedItem=void 0)}}doTrigger(C){if(typeof this.focusedItem>"u")return;const W=this.viewItems[this.focusedItem];if(W instanceof BaseActionViewItem){const V=W._context===null||W._context===void 0?C:W._context;this.run(W._action,V)}}run(C,W){return __awaiter$1l(this,void 0,void 0,function*(){yield this._actionRunner.run(C,W)})}dispose(){this._context=void 0,this.viewItems=dispose(this.viewItems),this.getContainer().remove(),super.dispose()}}const MENU_MNEMONIC_REGEX=/\(&([^\s&])\)|(^|[^&])&([^\s&])/,MENU_ESCAPED_MNEMONIC_REGEX=/(&amp;)?(&amp;)([^\s&])/g;var Direction;(function(K){K[K.Right=0]="Right",K[K.Left=1]="Left"})(Direction||(Direction={}));class Menu extends ActionBar{constructor(C,W,V,U){C.classList.add("monaco-menu-container"),C.setAttribute("role","presentation");const G=document.createElement("div");G.classList.add("monaco-menu"),G.setAttribute("role","presentation"),super(G,{orientation:1,actionViewItemProvider:Q=>this.doGetActionViewItem(Q,V,Z),context:V.context,actionRunner:V.actionRunner,ariaLabel:V.ariaLabel,ariaRole:"menu",focusOnlyEnabledItems:!0,triggerKeys:{keys:[3,...isMacintosh||isLinux?[10]:[]],keyDown:!0}}),this.menuStyles=U,this.menuElement=G,this.actionsList.tabIndex=0,this.menuDisposables=this._register(new DisposableStore),this.initializeOrUpdateStyleSheet(C,U),this._register(Gesture.addTarget(G)),addDisposableListener(G,EventType$1.KEY_DOWN,Q=>{new StandardKeyboardEvent(Q).equals(2)&&Q.preventDefault()}),V.enableMnemonics&&this.menuDisposables.add(addDisposableListener(G,EventType$1.KEY_DOWN,Q=>{const J=Q.key.toLocaleLowerCase();if(this.mnemonics.has(J)){EventHelper.stop(Q,!0);const ee=this.mnemonics.get(J);if(ee.length===1&&(ee[0]instanceof SubmenuMenuActionViewItem&&ee[0].container&&this.focusItemByElement(ee[0].container),ee[0].onClick(Q)),ee.length>1){const te=ee.shift();te&&te.container&&(this.focusItemByElement(te.container),ee.push(te)),this.mnemonics.set(J,ee)}}})),isLinux&&this._register(addDisposableListener(G,EventType$1.KEY_DOWN,Q=>{const J=new StandardKeyboardEvent(Q);J.equals(14)||J.equals(11)?(this.focusedItem=this.viewItems.length-1,this.focusNext(),EventHelper.stop(Q,!0)):(J.equals(13)||J.equals(12))&&(this.focusedItem=0,this.focusPrevious(),EventHelper.stop(Q,!0))})),this._register(addDisposableListener(this.domNode,EventType$1.MOUSE_OUT,Q=>{const J=Q.relatedTarget;isAncestor$1(J,this.domNode)||(this.focusedItem=void 0,this.updateFocus(),Q.stopPropagation())})),this._register(addDisposableListener(this.actionsList,EventType$1.MOUSE_OVER,Q=>{let J=Q.target;if(!(!J||!isAncestor$1(J,this.actionsList)||J===this.actionsList)){for(;J.parentElement!==this.actionsList&&J.parentElement!==null;)J=J.parentElement;if(J.classList.contains("action-item")){const ee=this.focusedItem;this.setFocusedItem(J),ee!==this.focusedItem&&this.updateFocus()}}})),this._register(Gesture.addTarget(this.actionsList)),this._register(addDisposableListener(this.actionsList,EventType.Tap,Q=>{let J=Q.initialTarget;if(!(!J||!isAncestor$1(J,this.actionsList)||J===this.actionsList)){for(;J.parentElement!==this.actionsList&&J.parentElement!==null;)J=J.parentElement;if(J.classList.contains("action-item")){const ee=this.focusedItem;this.setFocusedItem(J),ee!==this.focusedItem&&this.updateFocus()}}}));const Z={parent:this};this.mnemonics=new Map,this.scrollableElement=this._register(new DomScrollableElement(G,{alwaysConsumeMouseWheel:!0,horizontal:2,vertical:3,verticalScrollbarSize:7,handleMouseWheel:!0,useShadows:!0}));const X=this.scrollableElement.getDomNode();X.style.position="",this.styleScrollElement(X,U),this._register(addDisposableListener(G,EventType.Change,Q=>{EventHelper.stop(Q,!0);const J=this.scrollableElement.getScrollPosition().scrollTop;this.scrollableElement.setScrollPosition({scrollTop:J-Q.translationY})})),this._register(addDisposableListener(X,EventType$1.MOUSE_UP,Q=>{Q.preventDefault()})),G.style.maxHeight=`${Math.max(10,window.innerHeight-C.getBoundingClientRect().top-35)}px`,W=W.filter(Q=>{var J;return!((J=V.submenuIds)===null||J===void 0)&&J.has(Q.id)?(console.warn(`Found submenu cycle: ${Q.id}`),!1):!0}),this.push(W,{icon:!0,label:!0,isMenu:!0}),C.appendChild(this.scrollableElement.getDomNode()),this.scrollableElement.scanDomNode(),this.viewItems.filter(Q=>!(Q instanceof MenuSeparatorActionViewItem)).forEach((Q,J,ee)=>{Q.updatePositionInSet(J+1,ee.length)})}initializeOrUpdateStyleSheet(C,W){this.styleSheet||(isInShadowDOM(C)?this.styleSheet=createStyleSheet(C):(Menu.globalStyleSheet||(Menu.globalStyleSheet=createStyleSheet()),this.styleSheet=Menu.globalStyleSheet)),this.styleSheet.textContent=getMenuWidgetCSS(W,isInShadowDOM(C))}styleScrollElement(C,W){var V,U;const G=(V=W.foregroundColor)!==null&&V!==void 0?V:"",Z=(U=W.backgroundColor)!==null&&U!==void 0?U:"",X=W.borderColor?`1px solid ${W.borderColor}`:"",Q="5px",J=W.shadowColor?`0 2px 8px ${W.shadowColor}`:"";C.style.outline=X,C.style.borderRadius=Q,C.style.color=G,C.style.backgroundColor=Z,C.style.boxShadow=J}getContainer(){return this.scrollableElement.getDomNode()}get onScroll(){return this.scrollableElement.onScroll}focusItemByElement(C){const W=this.focusedItem;this.setFocusedItem(C),W!==this.focusedItem&&this.updateFocus()}setFocusedItem(C){for(let W=0;W<this.actionsList.children.length;W++){const V=this.actionsList.children[W];if(C===V){this.focusedItem=W;break}}}updateFocus(C){super.updateFocus(C,!0,!0),typeof this.focusedItem<"u"&&this.scrollableElement.setScrollPosition({scrollTop:Math.round(this.menuElement.scrollTop)})}doGetActionViewItem(C,W,V){if(C instanceof Separator)return new MenuSeparatorActionViewItem(W.context,C,{icon:!0},this.menuStyles);if(C instanceof SubmenuAction){const U=new SubmenuMenuActionViewItem(C,C.actions,V,Object.assign(Object.assign({},W),{submenuIds:new Set([...W.submenuIds||[],C.id])}),this.menuStyles);if(W.enableMnemonics){const G=U.getMnemonic();if(G&&U.isEnabled()){let Z=[];this.mnemonics.has(G)&&(Z=this.mnemonics.get(G)),Z.push(U),this.mnemonics.set(G,Z)}}return U}else{const U={enableMnemonics:W.enableMnemonics,useEventAsContext:W.useEventAsContext};if(W.getKeyBinding){const Z=W.getKeyBinding(C);if(Z){const X=Z.getLabel();X&&(U.keybinding=X)}}const G=new BaseMenuActionViewItem(W.context,C,U,this.menuStyles);if(W.enableMnemonics){const Z=G.getMnemonic();if(Z&&G.isEnabled()){let X=[];this.mnemonics.has(Z)&&(X=this.mnemonics.get(Z)),X.push(G),this.mnemonics.set(Z,X)}}return G}}}class BaseMenuActionViewItem extends BaseActionViewItem{constructor(C,W,V,U){if(V.isMenu=!0,super(W,W,V),this.menuStyle=U,this.options=V,this.options.icon=V.icon!==void 0?V.icon:!1,this.options.label=V.label!==void 0?V.label:!0,this.cssClass="",this.options.label&&V.enableMnemonics){const G=this.action.label;if(G){const Z=MENU_MNEMONIC_REGEX.exec(G);Z&&(this.mnemonic=(Z[1]?Z[1]:Z[3]).toLocaleLowerCase())}}this.runOnceToEnableMouseUp=new RunOnceScheduler(()=>{this.element&&(this._register(addDisposableListener(this.element,EventType$1.MOUSE_UP,G=>{if(EventHelper.stop(G,!0),isFirefox){if(new StandardMouseEvent(G).rightButton)return;this.onClick(G)}else setTimeout(()=>{this.onClick(G)},0)})),this._register(addDisposableListener(this.element,EventType$1.CONTEXT_MENU,G=>{EventHelper.stop(G,!0)})))},100),this._register(this.runOnceToEnableMouseUp)}render(C){super.render(C),this.element&&(this.container=C,this.item=append$3(this.element,$$d("a.action-menu-item")),this._action.id===Separator.ID?this.item.setAttribute("role","presentation"):(this.item.setAttribute("role","menuitem"),this.mnemonic&&this.item.setAttribute("aria-keyshortcuts",`${this.mnemonic}`)),this.check=append$3(this.item,$$d("span.menu-item-check"+ThemeIcon.asCSSSelector(Codicon.menuSelection))),this.check.setAttribute("role","none"),this.label=append$3(this.item,$$d("span.action-label")),this.options.label&&this.options.keybinding&&(append$3(this.item,$$d("span.keybinding")).textContent=this.options.keybinding),this.runOnceToEnableMouseUp.schedule(),this.updateClass(),this.updateLabel(),this.updateTooltip(),this.updateEnabled(),this.updateChecked(),this.applyStyle())}blur(){super.blur(),this.applyStyle()}focus(){var C;super.focus(),(C=this.item)===null||C===void 0||C.focus(),this.applyStyle()}updatePositionInSet(C,W){this.item&&(this.item.setAttribute("aria-posinset",`${C}`),this.item.setAttribute("aria-setsize",`${W}`))}updateLabel(){var C;if(this.label&&this.options.label){clearNode(this.label);let W=stripIcons(this.action.label);if(W){const V=cleanMnemonic(W);this.options.enableMnemonics||(W=V),this.label.setAttribute("aria-label",V.replace(/&&/g,"&"));const U=MENU_MNEMONIC_REGEX.exec(W);if(U){W=escape(W),MENU_ESCAPED_MNEMONIC_REGEX.lastIndex=0;let G=MENU_ESCAPED_MNEMONIC_REGEX.exec(W);for(;G&&G[1];)G=MENU_ESCAPED_MNEMONIC_REGEX.exec(W);const Z=X=>X.replace(/&amp;&amp;/g,"&amp;");G?this.label.append(ltrim(Z(W.substr(0,G.index))," "),$$d("u",{"aria-hidden":"true"},G[3]),rtrim(Z(W.substr(G.index+G[0].length))," ")):this.label.innerText=Z(W).trim(),(C=this.item)===null||C===void 0||C.setAttribute("aria-keyshortcuts",(U[1]?U[1]:U[3]).toLocaleLowerCase())}else this.label.innerText=W.replace(/&&/g,"&").trim()}}}updateTooltip(){}updateClass(){this.cssClass&&this.item&&this.item.classList.remove(...this.cssClass.split(" ")),this.options.icon&&this.label?(this.cssClass=this.action.class||"",this.label.classList.add("icon"),this.cssClass&&this.label.classList.add(...this.cssClass.split(" ")),this.updateEnabled()):this.label&&this.label.classList.remove("icon")}updateEnabled(){this.action.enabled?(this.element&&(this.element.classList.remove("disabled"),this.element.removeAttribute("aria-disabled")),this.item&&(this.item.classList.remove("disabled"),this.item.removeAttribute("aria-disabled"),this.item.tabIndex=0)):(this.element&&(this.element.classList.add("disabled"),this.element.setAttribute("aria-disabled","true")),this.item&&(this.item.classList.add("disabled"),this.item.setAttribute("aria-disabled","true")))}updateChecked(){if(!this.item)return;const C=this.action.checked;this.item.classList.toggle("checked",!!C),C!==void 0?(this.item.setAttribute("role","menuitemcheckbox"),this.item.setAttribute("aria-checked",C?"true":"false")):(this.item.setAttribute("role","menuitem"),this.item.setAttribute("aria-checked",""))}getMnemonic(){return this.mnemonic}applyStyle(){const C=this.element&&this.element.classList.contains("focused"),W=C&&this.menuStyle.selectionForegroundColor?this.menuStyle.selectionForegroundColor:this.menuStyle.foregroundColor,V=C&&this.menuStyle.selectionBackgroundColor?this.menuStyle.selectionBackgroundColor:void 0,U=C&&this.menuStyle.selectionBorderColor?`1px solid ${this.menuStyle.selectionBorderColor}`:"",G=C&&this.menuStyle.selectionBorderColor?"-1px":"";this.item&&(this.item.style.color=W??"",this.item.style.backgroundColor=V??"",this.item.style.outline=U,this.item.style.outlineOffset=G),this.check&&(this.check.style.color=W??"")}}class SubmenuMenuActionViewItem extends BaseMenuActionViewItem{constructor(C,W,V,U,G){super(C,C,U,G),this.submenuActions=W,this.parentData=V,this.submenuOptions=U,this.mysubmenu=null,this.submenuDisposables=this._register(new DisposableStore),this.mouseOver=!1,this.expandDirection=U&&U.expandDirection!==void 0?U.expandDirection:Direction.Right,this.showScheduler=new RunOnceScheduler(()=>{this.mouseOver&&(this.cleanupExistingSubmenu(!1),this.createSubmenu(!1))},250),this.hideScheduler=new RunOnceScheduler(()=>{this.element&&!isAncestor$1(getActiveElement(),this.element)&&this.parentData.submenu===this.mysubmenu&&(this.parentData.parent.focus(!1),this.cleanupExistingSubmenu(!0))},750)}render(C){super.render(C),this.element&&(this.item&&(this.item.classList.add("monaco-submenu-item"),this.item.tabIndex=0,this.item.setAttribute("aria-haspopup","true"),this.updateAriaExpanded("false"),this.submenuIndicator=append$3(this.item,$$d("span.submenu-indicator"+ThemeIcon.asCSSSelector(Codicon.menuSubmenu))),this.submenuIndicator.setAttribute("aria-hidden","true")),this._register(addDisposableListener(this.element,EventType$1.KEY_UP,W=>{const V=new StandardKeyboardEvent(W);(V.equals(17)||V.equals(3))&&(EventHelper.stop(W,!0),this.createSubmenu(!0))})),this._register(addDisposableListener(this.element,EventType$1.KEY_DOWN,W=>{const V=new StandardKeyboardEvent(W);getActiveElement()===this.item&&(V.equals(17)||V.equals(3))&&EventHelper.stop(W,!0)})),this._register(addDisposableListener(this.element,EventType$1.MOUSE_OVER,W=>{this.mouseOver||(this.mouseOver=!0,this.showScheduler.schedule())})),this._register(addDisposableListener(this.element,EventType$1.MOUSE_LEAVE,W=>{this.mouseOver=!1})),this._register(addDisposableListener(this.element,EventType$1.FOCUS_OUT,W=>{this.element&&!isAncestor$1(getActiveElement(),this.element)&&this.hideScheduler.schedule()})),this._register(this.parentData.parent.onScroll(()=>{this.parentData.submenu===this.mysubmenu&&(this.parentData.parent.focus(!1),this.cleanupExistingSubmenu(!0))})))}updateEnabled(){}onClick(C){EventHelper.stop(C,!0),this.cleanupExistingSubmenu(!1),this.createSubmenu(!0)}cleanupExistingSubmenu(C){if(this.parentData.submenu&&(C||this.parentData.submenu!==this.mysubmenu)){try{this.parentData.submenu.dispose()}catch{}this.parentData.submenu=void 0,this.updateAriaExpanded("false"),this.submenuContainer&&(this.submenuDisposables.clear(),this.submenuContainer=void 0)}}calculateSubmenuMenuLayout(C,W,V,U){const G={top:0,left:0};return G.left=layout(C.width,W.width,{position:U===Direction.Right?0:1,offset:V.left,size:V.width}),G.left>=V.left&&G.left<V.left+V.width&&(V.left+10+W.width<=C.width&&(G.left=V.left+10),V.top+=10,V.height=0),G.top=layout(C.height,W.height,{position:0,offset:V.top,size:0}),G.top+W.height===V.top&&G.top+V.height+W.height<=C.height&&(G.top+=V.height),G}createSubmenu(C=!0){if(this.element)if(this.parentData.submenu)this.parentData.submenu.focus(!1);else{this.updateAriaExpanded("true"),this.submenuContainer=append$3(this.element,$$d("div.monaco-submenu")),this.submenuContainer.classList.add("menubar-menu-items-holder","context-view");const W=getComputedStyle(this.parentData.parent.domNode),V=parseFloat(W.paddingTop||"0")||0;this.submenuContainer.style.zIndex="1",this.submenuContainer.style.position="fixed",this.submenuContainer.style.top="0",this.submenuContainer.style.left="0",this.parentData.submenu=new Menu(this.submenuContainer,this.submenuActions.length?this.submenuActions:[new EmptySubmenuAction],this.submenuOptions,this.menuStyle);const U=this.element.getBoundingClientRect(),G={top:U.top-V,left:U.left,height:U.height+2*V,width:U.width},Z=this.submenuContainer.getBoundingClientRect(),{top:X,left:Q}=this.calculateSubmenuMenuLayout(new Dimension(window.innerWidth,window.innerHeight),Dimension.lift(Z),G,this.expandDirection);this.submenuContainer.style.left=`${Q-Z.left}px`,this.submenuContainer.style.top=`${X-Z.top}px`,this.submenuDisposables.add(addDisposableListener(this.submenuContainer,EventType$1.KEY_UP,J=>{new StandardKeyboardEvent(J).equals(15)&&(EventHelper.stop(J,!0),this.parentData.parent.focus(),this.cleanupExistingSubmenu(!0))})),this.submenuDisposables.add(addDisposableListener(this.submenuContainer,EventType$1.KEY_DOWN,J=>{new StandardKeyboardEvent(J).equals(15)&&EventHelper.stop(J,!0)})),this.submenuDisposables.add(this.parentData.submenu.onDidCancel(()=>{this.parentData.parent.focus(),this.cleanupExistingSubmenu(!0)})),this.parentData.submenu.focus(C),this.mysubmenu=this.parentData.submenu}}updateAriaExpanded(C){var W;this.item&&((W=this.item)===null||W===void 0||W.setAttribute("aria-expanded",C))}applyStyle(){super.applyStyle();const W=this.element&&this.element.classList.contains("focused")&&this.menuStyle.selectionForegroundColor?this.menuStyle.selectionForegroundColor:this.menuStyle.foregroundColor;this.submenuIndicator&&(this.submenuIndicator.style.color=W??"")}dispose(){super.dispose(),this.hideScheduler.dispose(),this.mysubmenu&&(this.mysubmenu.dispose(),this.mysubmenu=null),this.submenuContainer&&(this.submenuContainer=void 0)}}class MenuSeparatorActionViewItem extends ActionViewItem{constructor(C,W,V,U){super(C,W,V),this.menuStyles=U}render(C){super.render(C),this.label&&(this.label.style.borderBottomColor=this.menuStyles.separatorColor?`${this.menuStyles.separatorColor}`:"")}}function cleanMnemonic(K){const C=MENU_MNEMONIC_REGEX,W=C.exec(K);if(!W)return K;const V=!W[1];return K.replace(C,V?"$2$3":"").trim()}function formatRule(K){const C=getCodiconFontCharacters()[K.id];return`.codicon-${K.id}:before { content: '\\${C.toString(16)}'; }`}function getMenuWidgetCSS(K,C){let W=`
.monaco-menu {
	font-size: 13px;
	border-radius: 5px;
	min-width: 160px;
}

${formatRule(Codicon.menuSelection)}
${formatRule(Codicon.menuSubmenu)}

.monaco-menu .monaco-action-bar {
	text-align: right;
	overflow: hidden;
	white-space: nowrap;
}

.monaco-menu .monaco-action-bar .actions-container {
	display: flex;
	margin: 0 auto;
	padding: 0;
	width: 100%;
	justify-content: flex-end;
}

.monaco-menu .monaco-action-bar.vertical .actions-container {
	display: inline-block;
}

.monaco-menu .monaco-action-bar.reverse .actions-container {
	flex-direction: row-reverse;
}

.monaco-menu .monaco-action-bar .action-item {
	cursor: pointer;
	display: inline-block;
	transition: transform 50ms ease;
	position: relative;  /* DO NOT REMOVE - this is the key to preventing the ghosting icon bug in Chrome 42 */
}

.monaco-menu .monaco-action-bar .action-item.disabled {
	cursor: default;
}

.monaco-menu .monaco-action-bar.animated .action-item.active {
	transform: scale(1.272019649, 1.272019649); /* 1.272019649 = √φ */
}

.monaco-menu .monaco-action-bar .action-item .icon,
.monaco-menu .monaco-action-bar .action-item .codicon {
	display: inline-block;
}

.monaco-menu .monaco-action-bar .action-item .codicon {
	display: flex;
	align-items: center;
}

.monaco-menu .monaco-action-bar .action-label {
	font-size: 11px;
	margin-right: 4px;
}

.monaco-menu .monaco-action-bar .action-item.disabled .action-label,
.monaco-menu .monaco-action-bar .action-item.disabled .action-label:hover {
	color: var(--vscode-disabledForeground);
}

/* Vertical actions */

.monaco-menu .monaco-action-bar.vertical {
	text-align: left;
}

.monaco-menu .monaco-action-bar.vertical .action-item {
	display: block;
}

.monaco-menu .monaco-action-bar.vertical .action-label.separator {
	display: block;
	border-bottom: 1px solid var(--vscode-menu-separatorBackground);
	padding-top: 1px;
	padding: 30px;
}

.monaco-menu .secondary-actions .monaco-action-bar .action-label {
	margin-left: 6px;
}

/* Action Items */
.monaco-menu .monaco-action-bar .action-item.select-container {
	overflow: hidden; /* somehow the dropdown overflows its container, we prevent it here to not push */
	flex: 1;
	max-width: 170px;
	min-width: 60px;
	display: flex;
	align-items: center;
	justify-content: center;
	margin-right: 10px;
}

.monaco-menu .monaco-action-bar.vertical {
	margin-left: 0;
	overflow: visible;
}

.monaco-menu .monaco-action-bar.vertical .actions-container {
	display: block;
}

.monaco-menu .monaco-action-bar.vertical .action-item {
	padding: 0;
	transform: none;
	display: flex;
}

.monaco-menu .monaco-action-bar.vertical .action-item.active {
	transform: none;
}

.monaco-menu .monaco-action-bar.vertical .action-menu-item {
	flex: 1 1 auto;
	display: flex;
	height: 2em;
	align-items: center;
	position: relative;
	margin: 0 4px;
	border-radius: 4px;
}

.monaco-menu .monaco-action-bar.vertical .action-menu-item:hover .keybinding,
.monaco-menu .monaco-action-bar.vertical .action-menu-item:focus .keybinding {
	opacity: unset;
}

.monaco-menu .monaco-action-bar.vertical .action-label {
	flex: 1 1 auto;
	text-decoration: none;
	padding: 0 1em;
	background: none;
	font-size: 12px;
	line-height: 1;
}

.monaco-menu .monaco-action-bar.vertical .keybinding,
.monaco-menu .monaco-action-bar.vertical .submenu-indicator {
	display: inline-block;
	flex: 2 1 auto;
	padding: 0 1em;
	text-align: right;
	font-size: 12px;
	line-height: 1;
}

.monaco-menu .monaco-action-bar.vertical .submenu-indicator {
	height: 100%;
}

.monaco-menu .monaco-action-bar.vertical .submenu-indicator.codicon {
	font-size: 16px !important;
	display: flex;
	align-items: center;
}

.monaco-menu .monaco-action-bar.vertical .submenu-indicator.codicon::before {
	margin-left: auto;
	margin-right: -20px;
}

.monaco-menu .monaco-action-bar.vertical .action-item.disabled .keybinding,
.monaco-menu .monaco-action-bar.vertical .action-item.disabled .submenu-indicator {
	opacity: 0.4;
}

.monaco-menu .monaco-action-bar.vertical .action-label:not(.separator) {
	display: inline-block;
	box-sizing: border-box;
	margin: 0;
}

.monaco-menu .monaco-action-bar.vertical .action-item {
	position: static;
	overflow: visible;
}

.monaco-menu .monaco-action-bar.vertical .action-item .monaco-submenu {
	position: absolute;
}

.monaco-menu .monaco-action-bar.vertical .action-label.separator {
	width: 100%;
	height: 0px !important;
	opacity: 1;
}

.monaco-menu .monaco-action-bar.vertical .action-label.separator.text {
	padding: 0.7em 1em 0.1em 1em;
	font-weight: bold;
	opacity: 1;
}

.monaco-menu .monaco-action-bar.vertical .action-label:hover {
	color: inherit;
}

.monaco-menu .monaco-action-bar.vertical .menu-item-check {
	position: absolute;
	visibility: hidden;
	width: 1em;
	height: 100%;
}

.monaco-menu .monaco-action-bar.vertical .action-menu-item.checked .menu-item-check {
	visibility: visible;
	display: flex;
	align-items: center;
	justify-content: center;
}

/* Context Menu */

.context-view.monaco-menu-container {
	outline: 0;
	border: none;
	animation: fadeIn 0.083s linear;
	-webkit-app-region: no-drag;
}

.context-view.monaco-menu-container :focus,
.context-view.monaco-menu-container .monaco-action-bar.vertical:focus,
.context-view.monaco-menu-container .monaco-action-bar.vertical :focus {
	outline: 0;
}

.hc-black .context-view.monaco-menu-container,
.hc-light .context-view.monaco-menu-container,
:host-context(.hc-black) .context-view.monaco-menu-container,
:host-context(.hc-light) .context-view.monaco-menu-container {
	box-shadow: none;
}

.hc-black .monaco-menu .monaco-action-bar.vertical .action-item.focused,
.hc-light .monaco-menu .monaco-action-bar.vertical .action-item.focused,
:host-context(.hc-black) .monaco-menu .monaco-action-bar.vertical .action-item.focused,
:host-context(.hc-light) .monaco-menu .monaco-action-bar.vertical .action-item.focused {
	background: none;
}

/* Vertical Action Bar Styles */

.monaco-menu .monaco-action-bar.vertical {
	padding: 4px 0;
}

.monaco-menu .monaco-action-bar.vertical .action-menu-item {
	height: 2em;
}

.monaco-menu .monaco-action-bar.vertical .action-label:not(.separator),
.monaco-menu .monaco-action-bar.vertical .keybinding {
	font-size: inherit;
	padding: 0 2em;
}

.monaco-menu .monaco-action-bar.vertical .menu-item-check {
	font-size: inherit;
	width: 2em;
}

.monaco-menu .monaco-action-bar.vertical .action-label.separator {
	font-size: inherit;
	margin: 5px 0 !important;
	padding: 0;
	border-radius: 0;
}

.linux .monaco-menu .monaco-action-bar.vertical .action-label.separator,
:host-context(.linux) .monaco-menu .monaco-action-bar.vertical .action-label.separator {
	margin-left: 0;
	margin-right: 0;
}

.monaco-menu .monaco-action-bar.vertical .submenu-indicator {
	font-size: 60%;
	padding: 0 1.8em;
}

.linux .monaco-menu .monaco-action-bar.vertical .submenu-indicator,
:host-context(.linux) .monaco-menu .monaco-action-bar.vertical .submenu-indicator {
	height: 100%;
	mask-size: 10px 10px;
	-webkit-mask-size: 10px 10px;
}

.monaco-menu .action-item {
	cursor: default;
}`;if(C){W+=`
			/* Arrows */
			.monaco-scrollable-element > .scrollbar > .scra {
				cursor: pointer;
				font-size: 11px !important;
			}

			.monaco-scrollable-element > .visible {
				opacity: 1;

				/* Background rule added for IE9 - to allow clicks on dom node */
				background:rgba(0,0,0,0);

				transition: opacity 100ms linear;
			}
			.monaco-scrollable-element > .invisible {
				opacity: 0;
				pointer-events: none;
			}
			.monaco-scrollable-element > .invisible.fade {
				transition: opacity 800ms linear;
			}

			/* Scrollable Content Inset Shadow */
			.monaco-scrollable-element > .shadow {
				position: absolute;
				display: none;
			}
			.monaco-scrollable-element > .shadow.top {
				display: block;
				top: 0;
				left: 3px;
				height: 3px;
				width: 100%;
			}
			.monaco-scrollable-element > .shadow.left {
				display: block;
				top: 3px;
				left: 0;
				height: 100%;
				width: 3px;
			}
			.monaco-scrollable-element > .shadow.top-left-corner {
				display: block;
				top: 0;
				left: 0;
				height: 3px;
				width: 3px;
			}
		`;const V=K.scrollbarShadow;V&&(W+=`
				.monaco-scrollable-element > .shadow.top {
					box-shadow: ${V} 0 6px 6px -6px inset;
				}

				.monaco-scrollable-element > .shadow.left {
					box-shadow: ${V} 6px 0 6px -6px inset;
				}

				.monaco-scrollable-element > .shadow.top.left {
					box-shadow: ${V} 6px 6px 6px -6px inset;
				}
			`);const U=K.scrollbarSliderBackground;U&&(W+=`
				.monaco-scrollable-element > .scrollbar > .slider {
					background: ${U};
				}
			`);const G=K.scrollbarSliderHoverBackground;G&&(W+=`
				.monaco-scrollable-element > .scrollbar > .slider:hover {
					background: ${G};
				}
			`);const Z=K.scrollbarSliderActiveBackground;Z&&(W+=`
				.monaco-scrollable-element > .scrollbar > .slider.active {
					background: ${Z};
				}
			`)}return W}class ContextMenuHandler{constructor(C,W,V,U){this.contextViewService=C,this.telemetryService=W,this.notificationService=V,this.keybindingService=U,this.focusToReturn=null,this.lastContainer=null,this.block=null,this.blockDisposable=null,this.options={blockMouse:!0}}configure(C){this.options=C}showContextMenu(C){const W=C.getActions();if(!W.length)return;this.focusToReturn=document.activeElement;let V;const U=isHTMLElement(C.domForShadowRoot)?C.domForShadowRoot:void 0;this.contextViewService.showContextView({getAnchor:()=>C.getAnchor(),canRelayout:!1,anchorAlignment:C.anchorAlignment,anchorAxisAlignment:C.anchorAxisAlignment,render:G=>{var Z;this.lastContainer=G;const X=C.getMenuClassName?C.getMenuClassName():"";X&&(G.className+=" "+X),this.options.blockMouse&&(this.block=G.appendChild($$d(".context-view-block")),this.block.style.position="fixed",this.block.style.cursor="initial",this.block.style.left="0",this.block.style.top="0",this.block.style.width="100%",this.block.style.height="100%",this.block.style.zIndex="-1",(Z=this.blockDisposable)===null||Z===void 0||Z.dispose(),this.blockDisposable=addDisposableListener(this.block,EventType$1.MOUSE_DOWN,ee=>ee.stopPropagation()));const Q=new DisposableStore,J=C.actionRunner||new ActionRunner;return J.onWillRun(ee=>this.onActionRun(ee,!C.skipTelemetry),this,Q),J.onDidRun(this.onDidActionRun,this,Q),V=new Menu(G,W,{actionViewItemProvider:C.getActionViewItem,context:C.getActionsContext?C.getActionsContext():null,actionRunner:J,getKeyBinding:C.getKeyBinding?C.getKeyBinding:ee=>this.keybindingService.lookupKeybinding(ee.id)},defaultMenuStyles),V.onDidCancel(()=>this.contextViewService.hideContextView(!0),null,Q),V.onDidBlur(()=>this.contextViewService.hideContextView(!0),null,Q),Q.add(addDisposableListener(window,EventType$1.BLUR,()=>this.contextViewService.hideContextView(!0))),Q.add(addDisposableListener(window,EventType$1.MOUSE_DOWN,ee=>{if(ee.defaultPrevented)return;const te=new StandardMouseEvent(ee);let ie=te.target;if(!te.rightButton){for(;ie;){if(ie===G)return;ie=ie.parentElement}this.contextViewService.hideContextView(!0)}})),combinedDisposable(Q,V)},focus:()=>{V==null||V.focus(!!C.autoSelectFirstItem)},onHide:G=>{var Z,X,Q;(Z=C.onHide)===null||Z===void 0||Z.call(C,!!G),this.block&&(this.block.remove(),this.block=null),(X=this.blockDisposable)===null||X===void 0||X.dispose(),this.blockDisposable=null,this.lastContainer&&(getActiveElement()===this.lastContainer||isAncestor$1(getActiveElement(),this.lastContainer))&&((Q=this.focusToReturn)===null||Q===void 0||Q.focus()),this.lastContainer=null}},U,!!U)}onActionRun(C,W){W&&this.telemetryService.publicLog2("workbenchActionExecuted",{id:C.action.id,from:"contextMenu"}),this.contextViewService.hideContextView(!1)}onDidActionRun(C){C.error&&!isCancellationError(C.error)&&this.notificationService.error(C.error)}}var __decorate$1Q=globalThis&&globalThis.__decorate||function(K,C,W,V){var U=arguments.length,G=U<3?C:V===null?V=Object.getOwnPropertyDescriptor(C,W):V,Z;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")G=Reflect.decorate(K,C,W,V);else for(var X=K.length-1;X>=0;X--)(Z=K[X])&&(G=(U<3?Z(G):U>3?Z(C,W,G):Z(C,W))||G);return U>3&&G&&Object.defineProperty(C,W,G),G},__param$1M=globalThis&&globalThis.__param||function(K,C){return function(W,V){C(W,V,K)}};let ContextMenuService=class extends Disposable{get contextMenuHandler(){return this._contextMenuHandler||(this._contextMenuHandler=new ContextMenuHandler(this.contextViewService,this.telemetryService,this.notificationService,this.keybindingService)),this._contextMenuHandler}constructor(C,W,V,U,G,Z){super(),this.telemetryService=C,this.notificationService=W,this.contextViewService=V,this.keybindingService=U,this.menuService=G,this.contextKeyService=Z,this._contextMenuHandler=void 0,this._onDidShowContextMenu=this._store.add(new Emitter$1),this._onDidHideContextMenu=this._store.add(new Emitter$1)}configure(C){this.contextMenuHandler.configure(C)}showContextMenu(C){C=ContextMenuMenuDelegate.transform(C,this.menuService,this.contextKeyService),this.contextMenuHandler.showContextMenu(Object.assign(Object.assign({},C),{onHide:W=>{var V;(V=C.onHide)===null||V===void 0||V.call(C,W),this._onDidHideContextMenu.fire()}})),ModifierKeyEmitter.getInstance().resetKeyStatus(),this._onDidShowContextMenu.fire()}};ContextMenuService=__decorate$1Q([__param$1M(0,ITelemetryService),__param$1M(1,INotificationService),__param$1M(2,IContextViewService),__param$1M(3,IKeybindingService),__param$1M(4,IMenuService),__param$1M(5,IContextKeyService)],ContextMenuService);var ContextMenuMenuDelegate;(function(K){function C(V){return V&&V.menuId instanceof MenuId}function W(V,U,G){if(!C(V))return V;const{menuId:Z,menuActionOptions:X,contextKeyService:Q}=V;return Object.assign(Object.assign({},V),{getActions:()=>{const J=[];if(Z){const ee=U.createMenu(Z,Q??G);createAndFillInContextMenuActions(ee,X,J),ee.dispose()}return V.getActions?Separator.join(V.getActions(),J):J}})}K.transform=W})(ContextMenuMenuDelegate||(ContextMenuMenuDelegate={}));var EditorOpenSource;(function(K){K[K.API=0]="API",K[K.USER=1]="USER"})(EditorOpenSource||(EditorOpenSource={}));var __decorate$1P=globalThis&&globalThis.__decorate||function(K,C,W,V){var U=arguments.length,G=U<3?C:V===null?V=Object.getOwnPropertyDescriptor(C,W):V,Z;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")G=Reflect.decorate(K,C,W,V);else for(var X=K.length-1;X>=0;X--)(Z=K[X])&&(G=(U<3?Z(G):U>3?Z(C,W,G):Z(C,W))||G);return U>3&&G&&Object.defineProperty(C,W,G),G},__param$1L=globalThis&&globalThis.__param||function(K,C){return function(W,V){C(W,V,K)}},__awaiter$1k=globalThis&&globalThis.__awaiter||function(K,C,W,V){function U(G){return G instanceof W?G:new W(function(Z){Z(G)})}return new(W||(W=Promise))(function(G,Z){function X(ee){try{J(V.next(ee))}catch(te){Z(te)}}function Q(ee){try{J(V.throw(ee))}catch(te){Z(te)}}function J(ee){ee.done?G(ee.value):U(ee.value).then(X,Q)}J((V=V.apply(K,C||[])).next())})};let CommandOpener=class{constructor(C){this._commandService=C}open(C,W){return __awaiter$1k(this,void 0,void 0,function*(){if(!matchesScheme(C,Schemas.command))return!1;if(!(W!=null&&W.allowCommands)||(typeof C=="string"&&(C=URI.parse(C)),Array.isArray(W.allowCommands)&&!W.allowCommands.includes(C.path)))return!0;let V=[];try{V=parse(decodeURIComponent(C.query))}catch{try{V=parse(C.query)}catch{}}return Array.isArray(V)||(V=[V]),yield this._commandService.executeCommand(C.path,...V),!0})}};CommandOpener=__decorate$1P([__param$1L(0,ICommandService)],CommandOpener);let EditorOpener=class{constructor(C){this._editorService=C}open(C,W){return __awaiter$1k(this,void 0,void 0,function*(){typeof C=="string"&&(C=URI.parse(C));const{selection:V,uri:U}=extractSelection(C);return C=U,C.scheme===Schemas.file&&(C=normalizePath(C)),yield this._editorService.openCodeEditor({resource:C,options:Object.assign({selection:V,source:W!=null&&W.fromUserGesture?EditorOpenSource.USER:EditorOpenSource.API},W==null?void 0:W.editorOptions)},this._editorService.getFocusedCodeEditor(),W==null?void 0:W.openToSide),!0})}};EditorOpener=__decorate$1P([__param$1L(0,ICodeEditorService)],EditorOpener);let OpenerService=class{constructor(C,W){this._openers=new LinkedList,this._validators=new LinkedList,this._resolvers=new LinkedList,this._resolvedUriTargets=new ResourceMap(V=>V.with({path:null,fragment:null,query:null}).toString()),this._externalOpeners=new LinkedList,this._defaultExternalOpener={openExternal:V=>__awaiter$1k(this,void 0,void 0,function*(){return matchesSomeScheme(V,Schemas.http,Schemas.https)?windowOpenNoOpener(V):window.location.href=V,!0})},this._openers.push({open:(V,U)=>__awaiter$1k(this,void 0,void 0,function*(){return U!=null&&U.openExternal||matchesSomeScheme(V,Schemas.mailto,Schemas.http,Schemas.https,Schemas.vsls)?(yield this._doOpenExternal(V,U),!0):!1})}),this._openers.push(new CommandOpener(W)),this._openers.push(new EditorOpener(C))}registerOpener(C){return{dispose:this._openers.unshift(C)}}open(C,W){var V;return __awaiter$1k(this,void 0,void 0,function*(){const U=typeof C=="string"?URI.parse(C):C,G=(V=this._resolvedUriTargets.get(U))!==null&&V!==void 0?V:C;for(const Z of this._validators)if(!(yield Z.shouldOpen(G,W)))return!1;for(const Z of this._openers)if(yield Z.open(C,W))return!0;return!1})}resolveExternalUri(C,W){return __awaiter$1k(this,void 0,void 0,function*(){for(const V of this._resolvers)try{const U=yield V.resolveExternalUri(C,W);if(U)return this._resolvedUriTargets.has(U.resolved)||this._resolvedUriTargets.set(U.resolved,C),U}catch{}throw new Error("Could not resolve external URI: "+C.toString())})}_doOpenExternal(C,W){return __awaiter$1k(this,void 0,void 0,function*(){const V=typeof C=="string"?URI.parse(C):C;let U;try{U=(yield this.resolveExternalUri(V,W)).resolved}catch{U=V}let G;if(typeof C=="string"&&V.toString()===U.toString()?G=C:G=encodeURI(U.toString(!0)),W!=null&&W.allowContributedOpeners){const Z=typeof(W==null?void 0:W.allowContributedOpeners)=="string"?W==null?void 0:W.allowContributedOpeners:void 0;for(const X of this._externalOpeners)if(yield X.openExternal(G,{sourceUri:V,preferredOpenerId:Z},CancellationToken.None))return!0}return this._defaultExternalOpener.openExternal(G,{sourceUri:V},CancellationToken.None)})}dispose(){this._validators.clear()}};OpenerService=__decorate$1P([__param$1L(0,ICodeEditorService),__param$1L(1,ICommandService)],OpenerService);const IEditorWorkerService=createDecorator("editorWorkerService");var MarkerSeverity$1;(function(K){K[K.Hint=1]="Hint",K[K.Info=2]="Info",K[K.Warning=4]="Warning",K[K.Error=8]="Error"})(MarkerSeverity$1||(MarkerSeverity$1={}));(function(K){function C(Z,X){return X-Z}K.compare=C;const W=Object.create(null);W[K.Error]=localize("sev.error","Error"),W[K.Warning]=localize("sev.warning","Warning"),W[K.Info]=localize("sev.info","Info");function V(Z){return W[Z]||""}K.toString=V;function U(Z){switch(Z){case Severity$2.Error:return K.Error;case Severity$2.Warning:return K.Warning;case Severity$2.Info:return K.Info;case Severity$2.Ignore:return K.Hint}}K.fromSeverity=U;function G(Z){switch(Z){case K.Error:return Severity$2.Error;case K.Warning:return Severity$2.Warning;case K.Info:return Severity$2.Info;case K.Hint:return Severity$2.Ignore}}K.toSeverity=G})(MarkerSeverity$1||(MarkerSeverity$1={}));var IMarkerData;(function(K){const C="";function W(U){return V(U,!0)}K.makeKey=W;function V(U,G){const Z=[C];return U.source?Z.push(U.source.replace("¦","\\¦")):Z.push(C),U.code?typeof U.code=="string"?Z.push(U.code.replace("¦","\\¦")):Z.push(U.code.value.replace("¦","\\¦")):Z.push(C),U.severity!==void 0&&U.severity!==null?Z.push(MarkerSeverity$1.toString(U.severity)):Z.push(C),U.message&&G?Z.push(U.message.replace("¦","\\¦")):Z.push(C),U.startLineNumber!==void 0&&U.startLineNumber!==null?Z.push(U.startLineNumber.toString()):Z.push(C),U.startColumn!==void 0&&U.startColumn!==null?Z.push(U.startColumn.toString()):Z.push(C),U.endLineNumber!==void 0&&U.endLineNumber!==null?Z.push(U.endLineNumber.toString()):Z.push(C),U.endColumn!==void 0&&U.endColumn!==null?Z.push(U.endColumn.toString()):Z.push(C),Z.push(C),Z.join("¦")}K.makeKeyOptionalMessage=V})(IMarkerData||(IMarkerData={}));const IMarkerService=createDecorator("markerService");function diffSets(K,C){const W=[],V=[];for(const U of K)C.has(U)||W.push(U);for(const U of C)K.has(U)||V.push(U);return{removed:W,added:V}}function intersection$2(K,C){const W=new Set;for(const V of C)K.has(V)&&W.add(V);return W}var __decorate$1O=globalThis&&globalThis.__decorate||function(K,C,W,V){var U=arguments.length,G=U<3?C:V===null?V=Object.getOwnPropertyDescriptor(C,W):V,Z;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")G=Reflect.decorate(K,C,W,V);else for(var X=K.length-1;X>=0;X--)(Z=K[X])&&(G=(U<3?Z(G):U>3?Z(C,W,G):Z(C,W))||G);return U>3&&G&&Object.defineProperty(C,W,G),G},__param$1K=globalThis&&globalThis.__param||function(K,C){return function(W,V){C(W,V,K)}};let MarkerDecorationsService=class extends Disposable{constructor(C,W){super(),this._markerService=W,this._onDidChangeMarker=this._register(new Emitter$1),this._markerDecorations=new ResourceMap,C.getModels().forEach(V=>this._onModelAdded(V)),this._register(C.onModelAdded(this._onModelAdded,this)),this._register(C.onModelRemoved(this._onModelRemoved,this)),this._register(this._markerService.onMarkerChanged(this._handleMarkerChange,this))}dispose(){super.dispose(),this._markerDecorations.forEach(C=>C.dispose()),this._markerDecorations.clear()}getMarker(C,W){const V=this._markerDecorations.get(C);return V&&V.getMarker(W)||null}_handleMarkerChange(C){C.forEach(W=>{const V=this._markerDecorations.get(W);V&&this._updateDecorations(V)})}_onModelAdded(C){const W=new MarkerDecorations(C);this._markerDecorations.set(C.uri,W),this._updateDecorations(W)}_onModelRemoved(C){var W;const V=this._markerDecorations.get(C.uri);V&&(V.dispose(),this._markerDecorations.delete(C.uri)),(C.uri.scheme===Schemas.inMemory||C.uri.scheme===Schemas.internal||C.uri.scheme===Schemas.vscode)&&((W=this._markerService)===null||W===void 0||W.read({resource:C.uri}).map(U=>U.owner).forEach(U=>this._markerService.remove(U,[C.uri])))}_updateDecorations(C){const W=this._markerService.read({resource:C.model.uri,take:500});C.update(W)&&this._onDidChangeMarker.fire(C.model)}};MarkerDecorationsService=__decorate$1O([__param$1K(0,IModelService),__param$1K(1,IMarkerService)],MarkerDecorationsService);class MarkerDecorations extends Disposable{constructor(C){super(),this.model=C,this._map=new BidirectionalMap,this._register(toDisposable(()=>{this.model.deltaDecorations([...this._map.values()],[]),this._map.clear()}))}update(C){const{added:W,removed:V}=diffSets(new Set(this._map.keys()),new Set(C));if(W.length===0&&V.length===0)return!1;const U=V.map(X=>this._map.get(X)),G=W.map(X=>({range:this._createDecorationRange(this.model,X),options:this._createDecorationOption(X)})),Z=this.model.deltaDecorations(U,G);for(const X of V)this._map.delete(X);for(let X=0;X<Z.length;X++)this._map.set(W[X],Z[X]);return!0}getMarker(C){return this._map.getKey(C.id)}_createDecorationRange(C,W){let V=Range$2.lift(W);if(W.severity===MarkerSeverity$1.Hint&&!this._hasMarkerTag(W,1)&&!this._hasMarkerTag(W,2)&&(V=V.setEndPosition(V.startLineNumber,V.startColumn+2)),V=C.validateRange(V),V.isEmpty()){const U=C.getLineLastNonWhitespaceColumn(V.startLineNumber)||C.getLineMaxColumn(V.startLineNumber);if(U===1||V.endColumn>=U)return V;const G=C.getWordAtPosition(V.getStartPosition());G&&(V=new Range$2(V.startLineNumber,G.startColumn,V.endLineNumber,G.endColumn))}else if(W.endColumn===Number.MAX_VALUE&&W.startColumn===1&&V.startLineNumber===V.endLineNumber){const U=C.getLineFirstNonWhitespaceColumn(W.startLineNumber);U<V.endColumn&&(V=new Range$2(V.startLineNumber,U,V.endLineNumber,V.endColumn),W.startColumn=U)}return V}_createDecorationOption(C){let W,V,U,G,Z;switch(C.severity){case MarkerSeverity$1.Hint:this._hasMarkerTag(C,2)?W=void 0:this._hasMarkerTag(C,1)?W="squiggly-unnecessary":W="squiggly-hint",U=0;break;case MarkerSeverity$1.Info:W="squiggly-info",V=themeColorFromId(overviewRulerInfo),U=10,Z={color:themeColorFromId(minimapInfo),position:MinimapPosition.Inline};break;case MarkerSeverity$1.Warning:W="squiggly-warning",V=themeColorFromId(overviewRulerWarning),U=20,Z={color:themeColorFromId(minimapWarning),position:MinimapPosition.Inline};break;case MarkerSeverity$1.Error:default:W="squiggly-error",V=themeColorFromId(overviewRulerError),U=30,Z={color:themeColorFromId(minimapError),position:MinimapPosition.Inline};break}return C.tags&&(C.tags.indexOf(1)!==-1&&(G="squiggly-inline-unnecessary"),C.tags.indexOf(2)!==-1&&(G="squiggly-inline-deprecated")),{description:"marker-decoration",stickiness:1,className:W,showIfCollapsed:!0,overviewRuler:{color:V,position:OverviewRulerLane.Right},minimap:Z,zIndex:U,inlineClassName:G}}_hasMarkerTag(C,W){return C.tags?C.tags.indexOf(W)>=0:!1}}var __decorate$1N=globalThis&&globalThis.__decorate||function(K,C,W,V){var U=arguments.length,G=U<3?C:V===null?V=Object.getOwnPropertyDescriptor(C,W):V,Z;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")G=Reflect.decorate(K,C,W,V);else for(var X=K.length-1;X>=0;X--)(Z=K[X])&&(G=(U<3?Z(G):U>3?Z(C,W,G):Z(C,W))||G);return U>3&&G&&Object.defineProperty(C,W,G),G},__param$1J=globalThis&&globalThis.__param||function(K,C){return function(W,V){C(W,V,K)}},ModelService_1;function MODEL_ID(K){return K.toString()}class ModelData{constructor(C,W,V){this.model=C,this._modelEventListeners=new DisposableStore,this.model=C,this._modelEventListeners.add(C.onWillDispose(()=>W(C))),this._modelEventListeners.add(C.onDidChangeLanguage(U=>V(C,U)))}dispose(){this._modelEventListeners.dispose()}}const DEFAULT_EOL=isLinux||isMacintosh?1:2;class DisposedModelInfo{constructor(C,W,V,U,G,Z,X,Q){this.uri=C,this.initialUndoRedoSnapshot=W,this.time=V,this.sharesUndoRedoStack=U,this.heapSize=G,this.sha1=Z,this.versionId=X,this.alternativeVersionId=Q}}let ModelService=ModelService_1=class extends Disposable{constructor(C,W,V,U,G){super(),this._configurationService=C,this._resourcePropertiesService=W,this._undoRedoService=V,this._languageService=U,this._languageConfigurationService=G,this._onModelAdded=this._register(new Emitter$1),this.onModelAdded=this._onModelAdded.event,this._onModelRemoved=this._register(new Emitter$1),this.onModelRemoved=this._onModelRemoved.event,this._onModelModeChanged=this._register(new Emitter$1),this.onModelLanguageChanged=this._onModelModeChanged.event,this._modelCreationOptionsByLanguageAndResource=Object.create(null),this._models={},this._disposedModels=new Map,this._disposedModelsHeapSize=0,this._register(this._configurationService.onDidChangeConfiguration(Z=>this._updateModelOptions(Z))),this._updateModelOptions(void 0)}static _readModelOptions(C,W){var V;let U=EDITOR_MODEL_DEFAULTS.tabSize;if(C.editor&&typeof C.editor.tabSize<"u"){const ne=parseInt(C.editor.tabSize,10);isNaN(ne)||(U=ne),U<1&&(U=1)}let G="tabSize";if(C.editor&&typeof C.editor.indentSize<"u"&&C.editor.indentSize!=="tabSize"){const ne=parseInt(C.editor.indentSize,10);isNaN(ne)||(G=Math.max(ne,1))}let Z=EDITOR_MODEL_DEFAULTS.insertSpaces;C.editor&&typeof C.editor.insertSpaces<"u"&&(Z=C.editor.insertSpaces==="false"?!1:!!C.editor.insertSpaces);let X=DEFAULT_EOL;const Q=C.eol;Q===`\r
`?X=2:Q===`
`&&(X=1);let J=EDITOR_MODEL_DEFAULTS.trimAutoWhitespace;C.editor&&typeof C.editor.trimAutoWhitespace<"u"&&(J=C.editor.trimAutoWhitespace==="false"?!1:!!C.editor.trimAutoWhitespace);let ee=EDITOR_MODEL_DEFAULTS.detectIndentation;C.editor&&typeof C.editor.detectIndentation<"u"&&(ee=C.editor.detectIndentation==="false"?!1:!!C.editor.detectIndentation);let te=EDITOR_MODEL_DEFAULTS.largeFileOptimizations;C.editor&&typeof C.editor.largeFileOptimizations<"u"&&(te=C.editor.largeFileOptimizations==="false"?!1:!!C.editor.largeFileOptimizations);let ie=EDITOR_MODEL_DEFAULTS.bracketPairColorizationOptions;return!((V=C.editor)===null||V===void 0)&&V.bracketPairColorization&&typeof C.editor.bracketPairColorization=="object"&&(ie={enabled:!!C.editor.bracketPairColorization.enabled,independentColorPoolPerBracketType:!!C.editor.bracketPairColorization.independentColorPoolPerBracketType}),{isForSimpleWidget:W,tabSize:U,indentSize:G,insertSpaces:Z,detectIndentation:ee,defaultEOL:X,trimAutoWhitespace:J,largeFileOptimizations:te,bracketPairColorizationOptions:ie}}_getEOL(C,W){if(C)return this._resourcePropertiesService.getEOL(C,W);const V=this._configurationService.getValue("files.eol",{overrideIdentifier:W});return V&&typeof V=="string"&&V!=="auto"?V:OS===3||OS===2?`
`:`\r
`}_shouldRestoreUndoStack(){const C=this._configurationService.getValue("files.restoreUndoStack");return typeof C=="boolean"?C:!0}getCreationOptions(C,W,V){const U=typeof C=="string"?C:C.languageId;let G=this._modelCreationOptionsByLanguageAndResource[U+W];if(!G){const Z=this._configurationService.getValue("editor",{overrideIdentifier:U,resource:W}),X=this._getEOL(W,U);G=ModelService_1._readModelOptions({editor:Z,eol:X},V),this._modelCreationOptionsByLanguageAndResource[U+W]=G}return G}_updateModelOptions(C){const W=this._modelCreationOptionsByLanguageAndResource;this._modelCreationOptionsByLanguageAndResource=Object.create(null);const V=Object.keys(this._models);for(let U=0,G=V.length;U<G;U++){const Z=V[U],X=this._models[Z],Q=X.model.getLanguageId(),J=X.model.uri;if(C&&!C.affectsConfiguration("editor",{overrideIdentifier:Q,resource:J})&&!C.affectsConfiguration("files.eol",{overrideIdentifier:Q,resource:J}))continue;const ee=W[Q+J],te=this.getCreationOptions(Q,J,X.model.isForSimpleWidget);ModelService_1._setModelOptionsForModel(X.model,te,ee)}}static _setModelOptionsForModel(C,W,V){V&&V.defaultEOL!==W.defaultEOL&&C.getLineCount()===1&&C.setEOL(W.defaultEOL===1?0:1),!(V&&V.detectIndentation===W.detectIndentation&&V.insertSpaces===W.insertSpaces&&V.tabSize===W.tabSize&&V.indentSize===W.indentSize&&V.trimAutoWhitespace===W.trimAutoWhitespace&&equals$4(V.bracketPairColorizationOptions,W.bracketPairColorizationOptions))&&(W.detectIndentation?(C.detectIndentation(W.insertSpaces,W.tabSize),C.updateOptions({trimAutoWhitespace:W.trimAutoWhitespace,bracketColorizationOptions:W.bracketPairColorizationOptions})):C.updateOptions({insertSpaces:W.insertSpaces,tabSize:W.tabSize,indentSize:W.indentSize,trimAutoWhitespace:W.trimAutoWhitespace,bracketColorizationOptions:W.bracketPairColorizationOptions}))}_insertDisposedModel(C){this._disposedModels.set(MODEL_ID(C.uri),C),this._disposedModelsHeapSize+=C.heapSize}_removeDisposedModel(C){const W=this._disposedModels.get(MODEL_ID(C));return W&&(this._disposedModelsHeapSize-=W.heapSize),this._disposedModels.delete(MODEL_ID(C)),W}_ensureDisposedModelsHeapSize(C){if(this._disposedModelsHeapSize>C){const W=[];for(this._disposedModels.forEach(V=>{V.sharesUndoRedoStack||W.push(V)}),W.sort((V,U)=>V.time-U.time);W.length>0&&this._disposedModelsHeapSize>C;){const V=W.shift();this._removeDisposedModel(V.uri),V.initialUndoRedoSnapshot!==null&&this._undoRedoService.restoreSnapshot(V.initialUndoRedoSnapshot)}}}_createModelData(C,W,V,U){const G=this.getCreationOptions(W,V,U),Z=new TextModel(C,W,G,V,this._undoRedoService,this._languageService,this._languageConfigurationService);if(V&&this._disposedModels.has(MODEL_ID(V))){const J=this._removeDisposedModel(V),ee=this._undoRedoService.getElements(V),te=this._getSHA1Computer(),ie=te.canComputeSHA1(Z)?te.computeSHA1(Z)===J.sha1:!1;if(ie||J.sharesUndoRedoStack){for(const ne of ee.past)isEditStackElement(ne)&&ne.matchesResource(V)&&ne.setModel(Z);for(const ne of ee.future)isEditStackElement(ne)&&ne.matchesResource(V)&&ne.setModel(Z);this._undoRedoService.setElementsValidFlag(V,!0,ne=>isEditStackElement(ne)&&ne.matchesResource(V)),ie&&(Z._overwriteVersionId(J.versionId),Z._overwriteAlternativeVersionId(J.alternativeVersionId),Z._overwriteInitialUndoRedoSnapshot(J.initialUndoRedoSnapshot))}else J.initialUndoRedoSnapshot!==null&&this._undoRedoService.restoreSnapshot(J.initialUndoRedoSnapshot)}const X=MODEL_ID(Z.uri);if(this._models[X])throw new Error("ModelService: Cannot add model because it already exists!");const Q=new ModelData(Z,J=>this._onWillDispose(J),(J,ee)=>this._onDidChangeLanguage(J,ee));return this._models[X]=Q,Q}createModel(C,W,V,U=!1){let G;return W?G=this._createModelData(C,W,V,U):G=this._createModelData(C,PLAINTEXT_LANGUAGE_ID,V,U),this._onModelAdded.fire(G.model),G.model}getModels(){const C=[],W=Object.keys(this._models);for(let V=0,U=W.length;V<U;V++){const G=W[V];C.push(this._models[G].model)}return C}getModel(C){const W=MODEL_ID(C),V=this._models[W];return V?V.model:null}_schemaShouldMaintainUndoRedoElements(C){return C.scheme===Schemas.file||C.scheme===Schemas.vscodeRemote||C.scheme===Schemas.vscodeUserData||C.scheme===Schemas.vscodeNotebookCell||C.scheme==="fake-fs"}_onWillDispose(C){const W=MODEL_ID(C.uri),V=this._models[W],U=this._undoRedoService.getUriComparisonKey(C.uri)!==C.uri.toString();let G=!1,Z=0;if(U||this._shouldRestoreUndoStack()&&this._schemaShouldMaintainUndoRedoElements(C.uri)){const J=this._undoRedoService.getElements(C.uri);if(J.past.length>0||J.future.length>0){for(const ee of J.past)isEditStackElement(ee)&&ee.matchesResource(C.uri)&&(G=!0,Z+=ee.heapSize(C.uri),ee.setModel(C.uri));for(const ee of J.future)isEditStackElement(ee)&&ee.matchesResource(C.uri)&&(G=!0,Z+=ee.heapSize(C.uri),ee.setModel(C.uri))}}const X=ModelService_1.MAX_MEMORY_FOR_CLOSED_FILES_UNDO_STACK,Q=this._getSHA1Computer();if(G)if(!U&&(Z>X||!Q.canComputeSHA1(C))){const J=V.model.getInitialUndoRedoSnapshot();J!==null&&this._undoRedoService.restoreSnapshot(J)}else this._ensureDisposedModelsHeapSize(X-Z),this._undoRedoService.setElementsValidFlag(C.uri,!1,J=>isEditStackElement(J)&&J.matchesResource(C.uri)),this._insertDisposedModel(new DisposedModelInfo(C.uri,V.model.getInitialUndoRedoSnapshot(),Date.now(),U,Z,Q.computeSHA1(C),C.getVersionId(),C.getAlternativeVersionId()));else if(!U){const J=V.model.getInitialUndoRedoSnapshot();J!==null&&this._undoRedoService.restoreSnapshot(J)}delete this._models[W],V.dispose(),delete this._modelCreationOptionsByLanguageAndResource[C.getLanguageId()+C.uri],this._onModelRemoved.fire(C)}_onDidChangeLanguage(C,W){const V=W.oldLanguage,U=C.getLanguageId(),G=this.getCreationOptions(V,C.uri,C.isForSimpleWidget),Z=this.getCreationOptions(U,C.uri,C.isForSimpleWidget);ModelService_1._setModelOptionsForModel(C,Z,G),this._onModelModeChanged.fire({model:C,oldLanguageId:V})}_getSHA1Computer(){return new DefaultModelSHA1Computer}};ModelService.MAX_MEMORY_FOR_CLOSED_FILES_UNDO_STACK=20*1024*1024;ModelService=ModelService_1=__decorate$1N([__param$1J(0,IConfigurationService),__param$1J(1,ITextResourcePropertiesService),__param$1J(2,IUndoRedoService),__param$1J(3,ILanguageService),__param$1J(4,ILanguageConfigurationService)],ModelService);class DefaultModelSHA1Computer{canComputeSHA1(C){return C.getValueLength()<=DefaultModelSHA1Computer.MAX_MODEL_SIZE}computeSHA1(C){const W=new StringSHA1,V=C.createSnapshot();let U;for(;U=V.read();)W.update(U);return W.digest()}}DefaultModelSHA1Computer.MAX_MODEL_SIZE=10*1024*1024;const standaloneQuickInput="";class PagedRenderer{get templateId(){return this.renderer.templateId}constructor(C,W){this.renderer=C,this.modelProvider=W}renderTemplate(C){return{data:this.renderer.renderTemplate(C),disposable:Disposable.None}}renderElement(C,W,V,U){var G;if((G=V.disposable)===null||G===void 0||G.dispose(),!V.data)return;const Z=this.modelProvider();if(Z.isResolved(C))return this.renderer.renderElement(Z.get(C),C,V.data,U);const X=new CancellationTokenSource$1,Q=Z.resolve(C,X.token);V.disposable={dispose:()=>X.cancel()},this.renderer.renderPlaceholder(C,V.data),Q.then(J=>this.renderer.renderElement(J,C,V.data,U))}disposeTemplate(C){C.disposable&&(C.disposable.dispose(),C.disposable=void 0),C.data&&(this.renderer.disposeTemplate(C.data),C.data=void 0)}}class PagedAccessibilityProvider{constructor(C,W){this.modelProvider=C,this.accessibilityProvider=W}getWidgetAriaLabel(){return this.accessibilityProvider.getWidgetAriaLabel()}getAriaLabel(C){const W=this.modelProvider();return W.isResolved(C)?this.accessibilityProvider.getAriaLabel(W.get(C)):null}}function fromPagedListOptions(K,C){return Object.assign(Object.assign({},C),{accessibilityProvider:C.accessibilityProvider&&new PagedAccessibilityProvider(K,C.accessibilityProvider)})}class PagedList{constructor(C,W,V,U,G={}){const Z=()=>this.model,X=U.map(Q=>new PagedRenderer(Q,Z));this.list=new List$1(C,W,V,X,fromPagedListOptions(Z,G))}updateOptions(C){this.list.updateOptions(C)}getHTMLElement(){return this.list.getHTMLElement()}get onDidFocus(){return this.list.onDidFocus}get widget(){return this.list}get onDidDispose(){return this.list.onDidDispose}get onMouseDblClick(){return Event$1.map(this.list.onMouseDblClick,({element:C,index:W,browserEvent:V})=>({element:C===void 0?void 0:this._model.get(C),index:W,browserEvent:V}))}get onPointer(){return Event$1.map(this.list.onPointer,({element:C,index:W,browserEvent:V})=>({element:C===void 0?void 0:this._model.get(C),index:W,browserEvent:V}))}get onDidChangeSelection(){return Event$1.map(this.list.onDidChangeSelection,({elements:C,indexes:W,browserEvent:V})=>({elements:C.map(U=>this._model.get(U)),indexes:W,browserEvent:V}))}get model(){return this._model}set model(C){this._model=C,this.list.splice(0,this.list.length,range$2(C.length))}getFocus(){return this.list.getFocus()}getSelection(){return this.list.getSelection()}getSelectedElements(){return this.getSelection().map(C=>this.model.get(C))}style(C){this.list.style(C)}dispose(){this.list.dispose()}}const sash="";var __decorate$1M=globalThis&&globalThis.__decorate||function(K,C,W,V){var U=arguments.length,G=U<3?C:V===null?V=Object.getOwnPropertyDescriptor(C,W):V,Z;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")G=Reflect.decorate(K,C,W,V);else for(var X=K.length-1;X>=0;X--)(Z=K[X])&&(G=(U<3?Z(G):U>3?Z(C,W,G):Z(C,W))||G);return U>3&&G&&Object.defineProperty(C,W,G),G};const DEBUG=!1;var OrthogonalEdge;(function(K){K.North="north",K.South="south",K.East="east",K.West="west"})(OrthogonalEdge||(OrthogonalEdge={}));let globalSize=4;const onDidChangeGlobalSize=new Emitter$1;let globalHoverDelay=300;const onDidChangeHoverDelay=new Emitter$1;class MouseEventFactory{constructor(){this.disposables=new DisposableStore}get onPointerMove(){return this.disposables.add(new DomEmitter(window,"mousemove")).event}get onPointerUp(){return this.disposables.add(new DomEmitter(window,"mouseup")).event}dispose(){this.disposables.dispose()}}__decorate$1M([memoize],MouseEventFactory.prototype,"onPointerMove",null);__decorate$1M([memoize],MouseEventFactory.prototype,"onPointerUp",null);class GestureEventFactory{get onPointerMove(){return this.disposables.add(new DomEmitter(this.el,EventType.Change)).event}get onPointerUp(){return this.disposables.add(new DomEmitter(this.el,EventType.End)).event}constructor(C){this.el=C,this.disposables=new DisposableStore}dispose(){this.disposables.dispose()}}__decorate$1M([memoize],GestureEventFactory.prototype,"onPointerMove",null);__decorate$1M([memoize],GestureEventFactory.prototype,"onPointerUp",null);class OrthogonalPointerEventFactory{get onPointerMove(){return this.factory.onPointerMove}get onPointerUp(){return this.factory.onPointerUp}constructor(C){this.factory=C}dispose(){}}__decorate$1M([memoize],OrthogonalPointerEventFactory.prototype,"onPointerMove",null);__decorate$1M([memoize],OrthogonalPointerEventFactory.prototype,"onPointerUp",null);const PointerEventsDisabledCssClass="pointer-events-disabled";class Sash extends Disposable{get state(){return this._state}get orthogonalStartSash(){return this._orthogonalStartSash}get orthogonalEndSash(){return this._orthogonalEndSash}set state(C){this._state!==C&&(this.el.classList.toggle("disabled",C===0),this.el.classList.toggle("minimum",C===1),this.el.classList.toggle("maximum",C===2),this._state=C,this.onDidEnablementChange.fire(C))}set orthogonalStartSash(C){if(this._orthogonalStartSash!==C){if(this.orthogonalStartDragHandleDisposables.clear(),this.orthogonalStartSashDisposables.clear(),C){const W=V=>{this.orthogonalStartDragHandleDisposables.clear(),V!==0&&(this._orthogonalStartDragHandle=append$3(this.el,$$d(".orthogonal-drag-handle.start")),this.orthogonalStartDragHandleDisposables.add(toDisposable(()=>this._orthogonalStartDragHandle.remove())),this.orthogonalStartDragHandleDisposables.add(new DomEmitter(this._orthogonalStartDragHandle,"mouseenter")).event(()=>Sash.onMouseEnter(C),void 0,this.orthogonalStartDragHandleDisposables),this.orthogonalStartDragHandleDisposables.add(new DomEmitter(this._orthogonalStartDragHandle,"mouseleave")).event(()=>Sash.onMouseLeave(C),void 0,this.orthogonalStartDragHandleDisposables))};this.orthogonalStartSashDisposables.add(C.onDidEnablementChange.event(W,this)),W(C.state)}this._orthogonalStartSash=C}}set orthogonalEndSash(C){if(this._orthogonalEndSash!==C){if(this.orthogonalEndDragHandleDisposables.clear(),this.orthogonalEndSashDisposables.clear(),C){const W=V=>{this.orthogonalEndDragHandleDisposables.clear(),V!==0&&(this._orthogonalEndDragHandle=append$3(this.el,$$d(".orthogonal-drag-handle.end")),this.orthogonalEndDragHandleDisposables.add(toDisposable(()=>this._orthogonalEndDragHandle.remove())),this.orthogonalEndDragHandleDisposables.add(new DomEmitter(this._orthogonalEndDragHandle,"mouseenter")).event(()=>Sash.onMouseEnter(C),void 0,this.orthogonalEndDragHandleDisposables),this.orthogonalEndDragHandleDisposables.add(new DomEmitter(this._orthogonalEndDragHandle,"mouseleave")).event(()=>Sash.onMouseLeave(C),void 0,this.orthogonalEndDragHandleDisposables))};this.orthogonalEndSashDisposables.add(C.onDidEnablementChange.event(W,this)),W(C.state)}this._orthogonalEndSash=C}}constructor(C,W,V){super(),this.hoverDelay=globalHoverDelay,this.hoverDelayer=this._register(new Delayer(this.hoverDelay)),this._state=3,this.onDidEnablementChange=this._register(new Emitter$1),this._onDidStart=this._register(new Emitter$1),this._onDidChange=this._register(new Emitter$1),this._onDidReset=this._register(new Emitter$1),this._onDidEnd=this._register(new Emitter$1),this.orthogonalStartSashDisposables=this._register(new DisposableStore),this.orthogonalStartDragHandleDisposables=this._register(new DisposableStore),this.orthogonalEndSashDisposables=this._register(new DisposableStore),this.orthogonalEndDragHandleDisposables=this._register(new DisposableStore),this.onDidStart=this._onDidStart.event,this.onDidChange=this._onDidChange.event,this.onDidReset=this._onDidReset.event,this.onDidEnd=this._onDidEnd.event,this.linkedSash=void 0,this.el=append$3(C,$$d(".monaco-sash")),V.orthogonalEdge&&this.el.classList.add(`orthogonal-edge-${V.orthogonalEdge}`),isMacintosh&&this.el.classList.add("mac");const U=this._register(new DomEmitter(this.el,"mousedown")).event;this._register(U(te=>this.onPointerStart(te,new MouseEventFactory),this));const G=this._register(new DomEmitter(this.el,"dblclick")).event;this._register(G(this.onPointerDoublePress,this));const Z=this._register(new DomEmitter(this.el,"mouseenter")).event;this._register(Z(()=>Sash.onMouseEnter(this)));const X=this._register(new DomEmitter(this.el,"mouseleave")).event;this._register(X(()=>Sash.onMouseLeave(this))),this._register(Gesture.addTarget(this.el));const Q=this._register(new DomEmitter(this.el,EventType.Start)).event;this._register(Q(te=>this.onPointerStart(te,new GestureEventFactory(this.el)),this));const J=this._register(new DomEmitter(this.el,EventType.Tap)).event;let ee;this._register(J(te=>{if(ee){clearTimeout(ee),ee=void 0,this.onPointerDoublePress(te);return}clearTimeout(ee),ee=setTimeout(()=>ee=void 0,250)},this)),typeof V.size=="number"?(this.size=V.size,V.orientation===0?this.el.style.width=`${this.size}px`:this.el.style.height=`${this.size}px`):(this.size=globalSize,this._register(onDidChangeGlobalSize.event(te=>{this.size=te,this.layout()}))),this._register(onDidChangeHoverDelay.event(te=>this.hoverDelay=te)),this.layoutProvider=W,this.orthogonalStartSash=V.orthogonalStartSash,this.orthogonalEndSash=V.orthogonalEndSash,this.orientation=V.orientation||0,this.orientation===1?(this.el.classList.add("horizontal"),this.el.classList.remove("vertical")):(this.el.classList.remove("horizontal"),this.el.classList.add("vertical")),this.el.classList.toggle("debug",DEBUG),this.layout()}onPointerStart(C,W){EventHelper.stop(C);let V=!1;if(!C.__orthogonalSashEvent){const oe=this.getOrthogonalSash(C);oe&&(V=!0,C.__orthogonalSashEvent=!0,oe.onPointerStart(C,new OrthogonalPointerEventFactory(W)))}if(this.linkedSash&&!C.__linkedSashEvent&&(C.__linkedSashEvent=!0,this.linkedSash.onPointerStart(C,new OrthogonalPointerEventFactory(W))),!this.state)return;const U=document.getElementsByTagName("iframe");for(const oe of U)oe.classList.add(PointerEventsDisabledCssClass);const G=C.pageX,Z=C.pageY,X=C.altKey,Q={startX:G,currentX:G,startY:Z,currentY:Z,altKey:X};this.el.classList.add("active"),this._onDidStart.fire(Q);const J=createStyleSheet(this.el),ee=()=>{let oe="";V?oe="all-scroll":this.orientation===1?this.state===1?oe="s-resize":this.state===2?oe="n-resize":oe=isMacintosh?"row-resize":"ns-resize":this.state===1?oe="e-resize":this.state===2?oe="w-resize":oe=isMacintosh?"col-resize":"ew-resize",J.textContent=`* { cursor: ${oe} !important; }`},te=new DisposableStore;ee(),V||this.onDidEnablementChange.event(ee,null,te);const ie=oe=>{EventHelper.stop(oe,!1);const re={startX:G,currentX:oe.pageX,startY:Z,currentY:oe.pageY,altKey:X};this._onDidChange.fire(re)},ne=oe=>{EventHelper.stop(oe,!1),this.el.removeChild(J),this.el.classList.remove("active"),this._onDidEnd.fire(),te.dispose();for(const re of U)re.classList.remove(PointerEventsDisabledCssClass)};W.onPointerMove(ie,null,te),W.onPointerUp(ne,null,te),te.add(W)}onPointerDoublePress(C){const W=this.getOrthogonalSash(C);W&&W._onDidReset.fire(),this.linkedSash&&this.linkedSash._onDidReset.fire(),this._onDidReset.fire()}static onMouseEnter(C,W=!1){C.el.classList.contains("active")?(C.hoverDelayer.cancel(),C.el.classList.add("hover")):C.hoverDelayer.trigger(()=>C.el.classList.add("hover"),C.hoverDelay).then(void 0,()=>{}),!W&&C.linkedSash&&Sash.onMouseEnter(C.linkedSash,!0)}static onMouseLeave(C,W=!1){C.hoverDelayer.cancel(),C.el.classList.remove("hover"),!W&&C.linkedSash&&Sash.onMouseLeave(C.linkedSash,!0)}clearSashHoverState(){Sash.onMouseLeave(this)}layout(){if(this.orientation===0){const C=this.layoutProvider;this.el.style.left=C.getVerticalSashLeft(this)-this.size/2+"px",C.getVerticalSashTop&&(this.el.style.top=C.getVerticalSashTop(this)+"px"),C.getVerticalSashHeight&&(this.el.style.height=C.getVerticalSashHeight(this)+"px")}else{const C=this.layoutProvider;this.el.style.top=C.getHorizontalSashTop(this)-this.size/2+"px",C.getHorizontalSashLeft&&(this.el.style.left=C.getHorizontalSashLeft(this)+"px"),C.getHorizontalSashWidth&&(this.el.style.width=C.getHorizontalSashWidth(this)+"px")}}getOrthogonalSash(C){var W;const V=(W=C.initialTarget)!==null&&W!==void 0?W:C.target;if(!(!V||!(V instanceof HTMLElement))&&V.classList.contains("orthogonal-drag-handle"))return V.classList.contains("start")?this.orthogonalStartSash:this.orthogonalEndSash}dispose(){super.dispose(),this.el.remove()}}const splitview="",defaultStyles={separatorBorder:Color.transparent};class ViewItem{set size(C){this._size=C}get size(){return this._size}get visible(){return typeof this._cachedVisibleSize>"u"}setVisible(C,W){var V,U;C!==this.visible&&(C?(this.size=clamp$2(this._cachedVisibleSize,this.viewMinimumSize,this.viewMaximumSize),this._cachedVisibleSize=void 0):(this._cachedVisibleSize=typeof W=="number"?W:this.size,this.size=0),this.container.classList.toggle("visible",C),(U=(V=this.view).setVisible)===null||U===void 0||U.call(V,C))}get minimumSize(){return this.visible?this.view.minimumSize:0}get viewMinimumSize(){return this.view.minimumSize}get maximumSize(){return this.visible?this.view.maximumSize:0}get viewMaximumSize(){return this.view.maximumSize}get priority(){return this.view.priority}get proportionalLayout(){var C;return(C=this.view.proportionalLayout)!==null&&C!==void 0?C:!0}get snap(){return!!this.view.snap}set enabled(C){this.container.style.pointerEvents=C?"":"none"}constructor(C,W,V,U){this.container=C,this.view=W,this.disposable=U,this._cachedVisibleSize=void 0,typeof V=="number"?(this._size=V,this._cachedVisibleSize=void 0,C.classList.add("visible")):(this._size=0,this._cachedVisibleSize=V.cachedVisibleSize)}layout(C,W){this.layoutContainer(C),this.view.layout(this.size,C,W)}dispose(){this.disposable.dispose()}}class VerticalViewItem extends ViewItem{layoutContainer(C){this.container.style.top=`${C}px`,this.container.style.height=`${this.size}px`}}class HorizontalViewItem extends ViewItem{layoutContainer(C){this.container.style.left=`${C}px`,this.container.style.width=`${this.size}px`}}var State;(function(K){K[K.Idle=0]="Idle",K[K.Busy=1]="Busy"})(State||(State={}));var Sizing;(function(K){K.Distribute={type:"distribute"};function C(U){return{type:"split",index:U}}K.Split=C;function W(U){return{type:"auto",index:U}}K.Auto=W;function V(U){return{type:"invisible",cachedVisibleSize:U}}K.Invisible=V})(Sizing||(Sizing={}));class SplitView extends Disposable{get orthogonalStartSash(){return this._orthogonalStartSash}get orthogonalEndSash(){return this._orthogonalEndSash}get startSnappingEnabled(){return this._startSnappingEnabled}get endSnappingEnabled(){return this._endSnappingEnabled}set orthogonalStartSash(C){for(const W of this.sashItems)W.sash.orthogonalStartSash=C;this._orthogonalStartSash=C}set orthogonalEndSash(C){for(const W of this.sashItems)W.sash.orthogonalEndSash=C;this._orthogonalEndSash=C}set startSnappingEnabled(C){this._startSnappingEnabled!==C&&(this._startSnappingEnabled=C,this.updateSashEnablement())}set endSnappingEnabled(C){this._endSnappingEnabled!==C&&(this._endSnappingEnabled=C,this.updateSashEnablement())}constructor(C,W={}){var V,U,G,Z,X;super(),this.size=0,this.contentSize=0,this.proportions=void 0,this.viewItems=[],this.sashItems=[],this.state=State.Idle,this._onDidSashChange=this._register(new Emitter$1),this._onDidSashReset=this._register(new Emitter$1),this._startSnappingEnabled=!0,this._endSnappingEnabled=!0,this.onDidSashChange=this._onDidSashChange.event,this.onDidSashReset=this._onDidSashReset.event,this.orientation=(V=W.orientation)!==null&&V!==void 0?V:0,this.inverseAltBehavior=(U=W.inverseAltBehavior)!==null&&U!==void 0?U:!1,this.proportionalLayout=(G=W.proportionalLayout)!==null&&G!==void 0?G:!0,this.getSashOrthogonalSize=W.getSashOrthogonalSize,this.el=document.createElement("div"),this.el.classList.add("monaco-split-view2"),this.el.classList.add(this.orientation===0?"vertical":"horizontal"),C.appendChild(this.el),this.sashContainer=append$3(this.el,$$d(".sash-container")),this.viewContainer=$$d(".split-view-container"),this.scrollable=this._register(new Scrollable({forceIntegerValues:!0,smoothScrollDuration:125,scheduleAtNextAnimationFrame})),this.scrollableElement=this._register(new SmoothScrollableElement(this.viewContainer,{vertical:this.orientation===0?(Z=W.scrollbarVisibility)!==null&&Z!==void 0?Z:1:2,horizontal:this.orientation===1?(X=W.scrollbarVisibility)!==null&&X!==void 0?X:1:2},this.scrollable));const Q=this._register(new DomEmitter(this.viewContainer,"scroll")).event;this._register(Q(J=>{const ee=this.scrollableElement.getScrollPosition(),te=Math.abs(this.viewContainer.scrollLeft-ee.scrollLeft)<=1?void 0:this.viewContainer.scrollLeft,ie=Math.abs(this.viewContainer.scrollTop-ee.scrollTop)<=1?void 0:this.viewContainer.scrollTop;(te!==void 0||ie!==void 0)&&this.scrollableElement.setScrollPosition({scrollLeft:te,scrollTop:ie})})),this.onDidScroll=this.scrollableElement.onScroll,this._register(this.onDidScroll(J=>{J.scrollTopChanged&&(this.viewContainer.scrollTop=J.scrollTop),J.scrollLeftChanged&&(this.viewContainer.scrollLeft=J.scrollLeft)})),append$3(this.el,this.scrollableElement.getDomNode()),this.style(W.styles||defaultStyles),W.descriptor&&(this.size=W.descriptor.size,W.descriptor.views.forEach((J,ee)=>{const te=isUndefined$2(J.visible)||J.visible?J.size:{type:"invisible",cachedVisibleSize:J.size},ie=J.view;this.doAddView(ie,te,ee,!0)}),this.contentSize=this.viewItems.reduce((J,ee)=>J+ee.size,0),this.saveProportions())}style(C){C.separatorBorder.isTransparent()?(this.el.classList.remove("separator-border"),this.el.style.removeProperty("--separator-border")):(this.el.classList.add("separator-border"),this.el.style.setProperty("--separator-border",C.separatorBorder.toString()))}addView(C,W,V=this.viewItems.length,U){this.doAddView(C,W,V,U)}layout(C,W){const V=Math.max(this.size,this.contentSize);if(this.size=C,this.layoutContext=W,this.proportions){let U=0;for(let G=0;G<this.viewItems.length;G++){const Z=this.viewItems[G],X=this.proportions[G];typeof X=="number"?U+=X:C-=Z.size}for(let G=0;G<this.viewItems.length;G++){const Z=this.viewItems[G],X=this.proportions[G];typeof X=="number"&&(Z.size=clamp$2(Math.round(X*C/U),Z.minimumSize,Z.maximumSize))}}else{const U=range$2(this.viewItems.length),G=U.filter(X=>this.viewItems[X].priority===1),Z=U.filter(X=>this.viewItems[X].priority===2);this.resize(this.viewItems.length-1,C-V,void 0,G,Z)}this.distributeEmptySpace(),this.layoutViews()}saveProportions(){this.proportionalLayout&&this.contentSize>0&&(this.proportions=this.viewItems.map(C=>C.proportionalLayout?C.size/this.contentSize:void 0))}onSashStart({sash:C,start:W,alt:V}){for(const X of this.viewItems)X.enabled=!1;const U=this.sashItems.findIndex(X=>X.sash===C),G=combinedDisposable(addDisposableListener(document.body,"keydown",X=>Z(this.sashDragState.current,X.altKey)),addDisposableListener(document.body,"keyup",()=>Z(this.sashDragState.current,!1))),Z=(X,Q)=>{const J=this.viewItems.map(oe=>oe.size);let ee=Number.NEGATIVE_INFINITY,te=Number.POSITIVE_INFINITY;if(this.inverseAltBehavior&&(Q=!Q),Q)if(U===this.sashItems.length-1){const re=this.viewItems[U];ee=(re.minimumSize-re.size)/2,te=(re.maximumSize-re.size)/2}else{const re=this.viewItems[U+1];ee=(re.size-re.maximumSize)/2,te=(re.size-re.minimumSize)/2}let ie,ne;if(!Q){const oe=range$2(U,-1),re=range$2(U+1,this.viewItems.length),ae=oe.reduce((fe,pe)=>fe+(this.viewItems[pe].minimumSize-J[pe]),0),se=oe.reduce((fe,pe)=>fe+(this.viewItems[pe].viewMaximumSize-J[pe]),0),le=re.length===0?Number.POSITIVE_INFINITY:re.reduce((fe,pe)=>fe+(J[pe]-this.viewItems[pe].minimumSize),0),ce=re.length===0?Number.NEGATIVE_INFINITY:re.reduce((fe,pe)=>fe+(J[pe]-this.viewItems[pe].viewMaximumSize),0),de=Math.max(ae,ce),ue=Math.min(le,se),ge=this.findFirstSnapIndex(oe),he=this.findFirstSnapIndex(re);if(typeof ge=="number"){const fe=this.viewItems[ge],pe=Math.floor(fe.viewMinimumSize/2);ie={index:ge,limitDelta:fe.visible?de-pe:de+pe,size:fe.size}}if(typeof he=="number"){const fe=this.viewItems[he],pe=Math.floor(fe.viewMinimumSize/2);ne={index:he,limitDelta:fe.visible?ue+pe:ue-pe,size:fe.size}}}this.sashDragState={start:X,current:X,index:U,sizes:J,minDelta:ee,maxDelta:te,alt:Q,snapBefore:ie,snapAfter:ne,disposable:G}};Z(W,V)}onSashChange({current:C}){const{index:W,start:V,sizes:U,alt:G,minDelta:Z,maxDelta:X,snapBefore:Q,snapAfter:J}=this.sashDragState;this.sashDragState.current=C;const ee=C-V,te=this.resize(W,ee,U,void 0,void 0,Z,X,Q,J);if(G){const ie=W===this.sashItems.length-1,ne=this.viewItems.map(ce=>ce.size),oe=ie?W:W+1,re=this.viewItems[oe],ae=re.size-re.maximumSize,se=re.size-re.minimumSize,le=ie?W-1:W+1;this.resize(le,-te,ne,void 0,void 0,ae,se)}this.distributeEmptySpace(),this.layoutViews()}onSashEnd(C){this._onDidSashChange.fire(C),this.sashDragState.disposable.dispose(),this.saveProportions();for(const W of this.viewItems)W.enabled=!0}onViewChange(C,W){const V=this.viewItems.indexOf(C);V<0||V>=this.viewItems.length||(W=typeof W=="number"?W:C.size,W=clamp$2(W,C.minimumSize,C.maximumSize),this.inverseAltBehavior&&V>0?(this.resize(V-1,Math.floor((C.size-W)/2)),this.distributeEmptySpace(),this.layoutViews()):(C.size=W,this.relayout([V],void 0)))}resizeView(C,W){if(this.state!==State.Idle)throw new Error("Cant modify splitview");if(this.state=State.Busy,C<0||C>=this.viewItems.length)return;const V=range$2(this.viewItems.length).filter(X=>X!==C),U=[...V.filter(X=>this.viewItems[X].priority===1),C],G=V.filter(X=>this.viewItems[X].priority===2),Z=this.viewItems[C];W=Math.round(W),W=clamp$2(W,Z.minimumSize,Math.min(Z.maximumSize,this.size)),Z.size=W,this.relayout(U,G),this.state=State.Idle}distributeViewSizes(){const C=[];let W=0;for(const X of this.viewItems)X.maximumSize-X.minimumSize>0&&(C.push(X),W+=X.size);const V=Math.floor(W/C.length);for(const X of C)X.size=clamp$2(V,X.minimumSize,X.maximumSize);const U=range$2(this.viewItems.length),G=U.filter(X=>this.viewItems[X].priority===1),Z=U.filter(X=>this.viewItems[X].priority===2);this.relayout(G,Z)}getViewSize(C){return C<0||C>=this.viewItems.length?-1:this.viewItems[C].size}doAddView(C,W,V=this.viewItems.length,U){if(this.state!==State.Idle)throw new Error("Cant modify splitview");this.state=State.Busy;const G=$$d(".split-view-view");V===this.viewItems.length?this.viewContainer.appendChild(G):this.viewContainer.insertBefore(G,this.viewContainer.children.item(V));const Z=C.onDidChange(ie=>this.onViewChange(ee,ie)),X=toDisposable(()=>this.viewContainer.removeChild(G)),Q=combinedDisposable(Z,X);let J;typeof W=="number"?J=W:(W.type==="auto"&&(this.areViewsDistributed()?W={type:"distribute"}:W={type:"split",index:W.index}),W.type==="split"?J=this.getViewSize(W.index)/2:W.type==="invisible"?J={cachedVisibleSize:W.cachedVisibleSize}:J=C.minimumSize);const ee=this.orientation===0?new VerticalViewItem(G,C,J,Q):new HorizontalViewItem(G,C,J,Q);if(this.viewItems.splice(V,0,ee),this.viewItems.length>1){const ie={orthogonalStartSash:this.orthogonalStartSash,orthogonalEndSash:this.orthogonalEndSash},ne=this.orientation===0?new Sash(this.sashContainer,{getHorizontalSashTop:fe=>this.getSashPosition(fe),getHorizontalSashWidth:this.getSashOrthogonalSize},Object.assign(Object.assign({},ie),{orientation:1})):new Sash(this.sashContainer,{getVerticalSashLeft:fe=>this.getSashPosition(fe),getVerticalSashHeight:this.getSashOrthogonalSize},Object.assign(Object.assign({},ie),{orientation:0})),oe=this.orientation===0?fe=>({sash:ne,start:fe.startY,current:fe.currentY,alt:fe.altKey}):fe=>({sash:ne,start:fe.startX,current:fe.currentX,alt:fe.altKey}),ae=Event$1.map(ne.onDidStart,oe)(this.onSashStart,this),le=Event$1.map(ne.onDidChange,oe)(this.onSashChange,this),de=Event$1.map(ne.onDidEnd,()=>this.sashItems.findIndex(fe=>fe.sash===ne))(this.onSashEnd,this),ue=ne.onDidReset(()=>{const fe=this.sashItems.findIndex(Ce=>Ce.sash===ne),pe=range$2(fe,-1),Se=range$2(fe+1,this.viewItems.length),Le=this.findFirstSnapIndex(pe),be=this.findFirstSnapIndex(Se);typeof Le=="number"&&!this.viewItems[Le].visible||typeof be=="number"&&!this.viewItems[be].visible||this._onDidSashReset.fire(fe)}),ge=combinedDisposable(ae,le,de,ue,ne),he={sash:ne,disposable:ge};this.sashItems.splice(V-1,0,he)}G.appendChild(C.element);let te;typeof W!="number"&&W.type==="split"&&(te=[W.index]),U||this.relayout([V],te),this.state=State.Idle,!U&&typeof W!="number"&&W.type==="distribute"&&this.distributeViewSizes()}relayout(C,W){const V=this.viewItems.reduce((U,G)=>U+G.size,0);this.resize(this.viewItems.length-1,this.size-V,void 0,C,W),this.distributeEmptySpace(),this.layoutViews(),this.saveProportions()}resize(C,W,V=this.viewItems.map(ee=>ee.size),U,G,Z=Number.NEGATIVE_INFINITY,X=Number.POSITIVE_INFINITY,Q,J){if(C<0||C>=this.viewItems.length)return 0;const ee=range$2(C,-1),te=range$2(C+1,this.viewItems.length);if(G)for(const he of G)pushToStart(ee,he),pushToStart(te,he);if(U)for(const he of U)pushToEnd(ee,he),pushToEnd(te,he);const ie=ee.map(he=>this.viewItems[he]),ne=ee.map(he=>V[he]),oe=te.map(he=>this.viewItems[he]),re=te.map(he=>V[he]),ae=ee.reduce((he,fe)=>he+(this.viewItems[fe].minimumSize-V[fe]),0),se=ee.reduce((he,fe)=>he+(this.viewItems[fe].maximumSize-V[fe]),0),le=te.length===0?Number.POSITIVE_INFINITY:te.reduce((he,fe)=>he+(V[fe]-this.viewItems[fe].minimumSize),0),ce=te.length===0?Number.NEGATIVE_INFINITY:te.reduce((he,fe)=>he+(V[fe]-this.viewItems[fe].maximumSize),0),de=Math.max(ae,ce,Z),ue=Math.min(le,se,X);let ge=!1;if(Q){const he=this.viewItems[Q.index],fe=W>=Q.limitDelta;ge=fe!==he.visible,he.setVisible(fe,Q.size)}if(!ge&&J){const he=this.viewItems[J.index],fe=W<J.limitDelta;ge=fe!==he.visible,he.setVisible(fe,J.size)}if(ge)return this.resize(C,W,V,U,G,Z,X);W=clamp$2(W,de,ue);for(let he=0,fe=W;he<ie.length;he++){const pe=ie[he],Se=clamp$2(ne[he]+fe,pe.minimumSize,pe.maximumSize),Le=Se-ne[he];fe-=Le,pe.size=Se}for(let he=0,fe=W;he<oe.length;he++){const pe=oe[he],Se=clamp$2(re[he]-fe,pe.minimumSize,pe.maximumSize),Le=Se-re[he];fe+=Le,pe.size=Se}return W}distributeEmptySpace(C){const W=this.viewItems.reduce((X,Q)=>X+Q.size,0);let V=this.size-W;const U=range$2(this.viewItems.length-1,-1),G=U.filter(X=>this.viewItems[X].priority===1),Z=U.filter(X=>this.viewItems[X].priority===2);for(const X of Z)pushToStart(U,X);for(const X of G)pushToEnd(U,X);typeof C=="number"&&pushToEnd(U,C);for(let X=0;V!==0&&X<U.length;X++){const Q=this.viewItems[U[X]],J=clamp$2(Q.size+V,Q.minimumSize,Q.maximumSize),ee=J-Q.size;V-=ee,Q.size=J}}layoutViews(){this.contentSize=this.viewItems.reduce((W,V)=>W+V.size,0);let C=0;for(const W of this.viewItems)W.layout(C,this.layoutContext),C+=W.size;this.sashItems.forEach(W=>W.sash.layout()),this.updateSashEnablement(),this.updateScrollableElement()}updateScrollableElement(){this.orientation===0?this.scrollableElement.setScrollDimensions({height:this.size,scrollHeight:this.contentSize}):this.scrollableElement.setScrollDimensions({width:this.size,scrollWidth:this.contentSize})}updateSashEnablement(){let C=!1;const W=this.viewItems.map(Q=>C=Q.size-Q.minimumSize>0||C);C=!1;const V=this.viewItems.map(Q=>C=Q.maximumSize-Q.size>0||C),U=[...this.viewItems].reverse();C=!1;const G=U.map(Q=>C=Q.size-Q.minimumSize>0||C).reverse();C=!1;const Z=U.map(Q=>C=Q.maximumSize-Q.size>0||C).reverse();let X=0;for(let Q=0;Q<this.sashItems.length;Q++){const{sash:J}=this.sashItems[Q],ee=this.viewItems[Q];X+=ee.size;const te=!(W[Q]&&Z[Q+1]),ie=!(V[Q]&&G[Q+1]);if(te&&ie){const ne=range$2(Q,-1),oe=range$2(Q+1,this.viewItems.length),re=this.findFirstSnapIndex(ne),ae=this.findFirstSnapIndex(oe),se=typeof re=="number"&&!this.viewItems[re].visible,le=typeof ae=="number"&&!this.viewItems[ae].visible;se&&G[Q]&&(X>0||this.startSnappingEnabled)?J.state=1:le&&W[Q]&&(X<this.contentSize||this.endSnappingEnabled)?J.state=2:J.state=0}else te&&!ie?J.state=1:!te&&ie?J.state=2:J.state=3}}getSashPosition(C){let W=0;for(let V=0;V<this.sashItems.length;V++)if(W+=this.viewItems[V].size,this.sashItems[V].sash===C)return W;return 0}findFirstSnapIndex(C){for(const W of C){const V=this.viewItems[W];if(V.visible&&V.snap)return W}for(const W of C){const V=this.viewItems[W];if(V.visible&&V.maximumSize-V.minimumSize>0)return;if(!V.visible&&V.snap)return W}}areViewsDistributed(){let C,W;for(const V of this.viewItems)if(C=C===void 0?V.size:Math.min(C,V.size),W=W===void 0?V.size:Math.max(W,V.size),W-C>2)return!1;return!0}dispose(){var C;(C=this.sashDragState)===null||C===void 0||C.disposable.dispose(),dispose(this.viewItems),this.viewItems=[],this.sashItems.forEach(W=>W.disposable.dispose()),this.sashItems=[],super.dispose()}}const table="";class TableListRenderer{constructor(C,W,V){this.columns=C,this.getColumnSize=V,this.templateId=TableListRenderer.TemplateId,this.renderedTemplates=new Set;const U=new Map(W.map(G=>[G.templateId,G]));this.renderers=[];for(const G of C){const Z=U.get(G.templateId);if(!Z)throw new Error(`Table cell renderer for template id ${G.templateId} not found.`);this.renderers.push(Z)}}renderTemplate(C){const W=append$3(C,$$d(".monaco-table-tr")),V=[],U=[];for(let Z=0;Z<this.columns.length;Z++){const X=this.renderers[Z],Q=append$3(W,$$d(".monaco-table-td",{"data-col-index":Z}));Q.style.width=`${this.getColumnSize(Z)}px`,V.push(Q),U.push(X.renderTemplate(Q))}const G={container:C,cellContainers:V,cellTemplateData:U};return this.renderedTemplates.add(G),G}renderElement(C,W,V,U){for(let G=0;G<this.columns.length;G++){const X=this.columns[G].project(C);this.renderers[G].renderElement(X,W,V.cellTemplateData[G],U)}}disposeElement(C,W,V,U){for(let G=0;G<this.columns.length;G++){const Z=this.renderers[G];if(Z.disposeElement){const Q=this.columns[G].project(C);Z.disposeElement(Q,W,V.cellTemplateData[G],U)}}}disposeTemplate(C){for(let W=0;W<this.columns.length;W++)this.renderers[W].disposeTemplate(C.cellTemplateData[W]);clearNode(C.container),this.renderedTemplates.delete(C)}layoutColumn(C,W){for(const{cellContainers:V}of this.renderedTemplates)V[C].style.width=`${W}px`}}TableListRenderer.TemplateId="row";function asListVirtualDelegate(K){return{getHeight(C){return K.getHeight(C)},getTemplateId(){return TableListRenderer.TemplateId}}}class ColumnHeader{get minimumSize(){var C;return(C=this.column.minimumWidth)!==null&&C!==void 0?C:120}get maximumSize(){var C;return(C=this.column.maximumWidth)!==null&&C!==void 0?C:Number.POSITIVE_INFINITY}get onDidChange(){var C;return(C=this.column.onDidChangeWidthConstraints)!==null&&C!==void 0?C:Event$1.None}constructor(C,W){this.column=C,this.index=W,this._onDidLayout=new Emitter$1,this.onDidLayout=this._onDidLayout.event,this.element=$$d(".monaco-table-th",{"data-col-index":W,title:C.tooltip},C.label)}layout(C){this._onDidLayout.fire([this.index,C])}}class Table{get onDidChangeFocus(){return this.list.onDidChangeFocus}get onDidChangeSelection(){return this.list.onDidChangeSelection}get onDidScroll(){return this.list.onDidScroll}get onMouseDblClick(){return this.list.onMouseDblClick}get onPointer(){return this.list.onPointer}get onDidFocus(){return this.list.onDidFocus}get scrollTop(){return this.list.scrollTop}set scrollTop(C){this.list.scrollTop=C}get scrollHeight(){return this.list.scrollHeight}get renderHeight(){return this.list.renderHeight}get onDidDispose(){return this.list.onDidDispose}constructor(C,W,V,U,G,Z){this.virtualDelegate=V,this.domId=`table_id_${++Table.InstanceCount}`,this.disposables=new DisposableStore,this.cachedWidth=0,this.cachedHeight=0,this.domNode=append$3(W,$$d(`.monaco-table.${this.domId}`));const X=U.map((ee,te)=>new ColumnHeader(ee,te)),Q={size:X.reduce((ee,te)=>ee+te.column.weight,0),views:X.map(ee=>({size:ee.column.weight,view:ee}))};this.splitview=this.disposables.add(new SplitView(this.domNode,{orientation:1,scrollbarVisibility:2,getSashOrthogonalSize:()=>this.cachedHeight,descriptor:Q})),this.splitview.el.style.height=`${V.headerRowHeight}px`,this.splitview.el.style.lineHeight=`${V.headerRowHeight}px`;const J=new TableListRenderer(U,G,ee=>this.splitview.getViewSize(ee));this.list=this.disposables.add(new List$1(C,this.domNode,asListVirtualDelegate(V),[J],Z)),Event$1.any(...X.map(ee=>ee.onDidLayout))(([ee,te])=>J.layoutColumn(ee,te),null,this.disposables),this.splitview.onDidSashReset(ee=>{const te=U.reduce((ne,oe)=>ne+oe.weight,0),ie=U[ee].weight/te*this.cachedWidth;this.splitview.resizeView(ee,ie)},null,this.disposables),this.styleElement=createStyleSheet(this.domNode),this.style(unthemedListStyles)}updateOptions(C){this.list.updateOptions(C)}splice(C,W,V=[]){this.list.splice(C,W,V)}getHTMLElement(){return this.domNode}style(C){const W=[];W.push(`.monaco-table.${this.domId} > .monaco-split-view2 .monaco-sash.vertical::before {
			top: ${this.virtualDelegate.headerRowHeight+1}px;
			height: calc(100% - ${this.virtualDelegate.headerRowHeight}px);
		}`),this.styleElement.textContent=W.join(`
`),this.list.style(C)}getSelectedElements(){return this.list.getSelectedElements()}getSelection(){return this.list.getSelection()}getFocus(){return this.list.getFocus()}dispose(){this.disposables.dispose()}}Table.InstanceCount=0;const toggle="";class Toggle extends Widget$1{constructor(C){super(),this._onChange=this._register(new Emitter$1),this.onChange=this._onChange.event,this._onKeyDown=this._register(new Emitter$1),this.onKeyDown=this._onKeyDown.event,this._opts=C,this._checked=this._opts.isChecked;const W=["monaco-custom-toggle"];this._opts.icon&&(this._icon=this._opts.icon,W.push(...ThemeIcon.asClassNameArray(this._icon))),this._opts.actionClassName&&W.push(...this._opts.actionClassName.split(" ")),this._checked&&W.push("checked"),this.domNode=document.createElement("div"),this.domNode.title=this._opts.title,this.domNode.classList.add(...W),this._opts.notFocusable||(this.domNode.tabIndex=0),this.domNode.setAttribute("role","checkbox"),this.domNode.setAttribute("aria-checked",String(this._checked)),this.domNode.setAttribute("aria-label",this._opts.title),this.applyStyles(),this.onclick(this.domNode,V=>{this.enabled&&(this.checked=!this._checked,this._onChange.fire(!1),V.preventDefault())}),this._register(this.ignoreGesture(this.domNode)),this.onkeydown(this.domNode,V=>{if(V.keyCode===10||V.keyCode===3){this.checked=!this._checked,this._onChange.fire(!0),V.preventDefault(),V.stopPropagation();return}this._onKeyDown.fire(V)})}get enabled(){return this.domNode.getAttribute("aria-disabled")!=="true"}focus(){this.domNode.focus()}get checked(){return this._checked}set checked(C){this._checked=C,this.domNode.setAttribute("aria-checked",String(this._checked)),this.domNode.classList.toggle("checked",this._checked),this.applyStyles()}width(){return 2+2+2+16}applyStyles(){this.domNode&&(this.domNode.style.borderColor=this._checked&&this._opts.inputActiveOptionBorder||"",this.domNode.style.color=this._checked&&this._opts.inputActiveOptionForeground||"inherit",this.domNode.style.backgroundColor=this._checked&&this._opts.inputActiveOptionBackground||"")}enable(){this.domNode.setAttribute("aria-disabled",String(!1))}disable(){this.domNode.setAttribute("aria-disabled",String(!0))}}const NLS_CASE_SENSITIVE_TOGGLE_LABEL=localize("caseDescription","Match Case"),NLS_WHOLE_WORD_TOGGLE_LABEL=localize("wordsDescription","Match Whole Word"),NLS_REGEX_TOGGLE_LABEL=localize("regexDescription","Use Regular Expression");class CaseSensitiveToggle extends Toggle{constructor(C){super({icon:Codicon.caseSensitive,title:NLS_CASE_SENSITIVE_TOGGLE_LABEL+C.appendTitle,isChecked:C.isChecked,inputActiveOptionBorder:C.inputActiveOptionBorder,inputActiveOptionForeground:C.inputActiveOptionForeground,inputActiveOptionBackground:C.inputActiveOptionBackground})}}class WholeWordsToggle extends Toggle{constructor(C){super({icon:Codicon.wholeWord,title:NLS_WHOLE_WORD_TOGGLE_LABEL+C.appendTitle,isChecked:C.isChecked,inputActiveOptionBorder:C.inputActiveOptionBorder,inputActiveOptionForeground:C.inputActiveOptionForeground,inputActiveOptionBackground:C.inputActiveOptionBackground})}}class RegexToggle extends Toggle{constructor(C){super({icon:Codicon.regex,title:NLS_REGEX_TOGGLE_LABEL+C.appendTitle,isChecked:C.isChecked,inputActiveOptionBorder:C.inputActiveOptionBorder,inputActiveOptionForeground:C.inputActiveOptionForeground,inputActiveOptionBackground:C.inputActiveOptionBackground})}}class ArrayNavigator{constructor(C,W=0,V=C.length,U=W-1){this.items=C,this.start=W,this.end=V,this.index=U}current(){return this.index===this.start-1||this.index===this.end?null:this.items[this.index]}next(){return this.index=Math.min(this.index+1,this.end),this.current()}previous(){return this.index=Math.max(this.index-1,this.start-1),this.current()}first(){return this.index=this.start,this.current()}last(){return this.index=this.end-1,this.current()}}class HistoryNavigator{constructor(C=[],W=10){this._initialize(C),this._limit=W,this._onChange()}getHistory(){return this._elements}add(C){this._history.delete(C),this._history.add(C),this._onChange()}next(){return this._navigator.next()}previous(){return this._currentPosition()!==0?this._navigator.previous():null}current(){return this._navigator.current()}first(){return this._navigator.first()}last(){return this._navigator.last()}isLast(){return this._currentPosition()>=this._elements.length-1}isNowhere(){return this._navigator.current()===null}has(C){return this._history.has(C)}_onChange(){this._reduceToLimit();const C=this._elements;this._navigator=new ArrayNavigator(C,0,C.length,C.length)}_reduceToLimit(){const C=this._elements;C.length>this._limit&&this._initialize(C.slice(C.length-this._limit))}_currentPosition(){const C=this._navigator.current();return C?this._elements.indexOf(C):-1}_initialize(C){this._history=new Set;for(const W of C)this._history.add(W)}get _elements(){const C=[];return this._history.forEach(W=>C.push(W)),C}}const inputBox="",$$b=$$d;let InputBox$1=class extends Widget$1{constructor(C,W,V){var U;super(),this.state="idle",this.maxHeight=Number.POSITIVE_INFINITY,this._onDidChange=this._register(new Emitter$1),this.onDidChange=this._onDidChange.event,this._onDidHeightChange=this._register(new Emitter$1),this.onDidHeightChange=this._onDidHeightChange.event,this.contextViewProvider=W,this.options=V,this.message=null,this.placeholder=this.options.placeholder||"",this.tooltip=(U=this.options.tooltip)!==null&&U!==void 0?U:this.placeholder||"",this.ariaLabel=this.options.ariaLabel||"",this.options.validationOptions&&(this.validation=this.options.validationOptions.validation),this.element=append$3(C,$$b(".monaco-inputbox.idle"));const G=this.options.flexibleHeight?"textarea":"input",Z=append$3(this.element,$$b(".ibwrapper"));if(this.input=append$3(Z,$$b(G+".input.empty")),this.input.setAttribute("autocorrect","off"),this.input.setAttribute("autocapitalize","off"),this.input.setAttribute("spellcheck","false"),this.onfocus(this.input,()=>this.element.classList.add("synthetic-focus")),this.onblur(this.input,()=>this.element.classList.remove("synthetic-focus")),this.options.flexibleHeight){this.maxHeight=typeof this.options.flexibleMaxHeight=="number"?this.options.flexibleMaxHeight:Number.POSITIVE_INFINITY,this.mirror=append$3(Z,$$b("div.mirror")),this.mirror.innerText=" ",this.scrollableElement=new ScrollableElement(this.element,{vertical:1}),this.options.flexibleWidth&&(this.input.setAttribute("wrap","off"),this.mirror.style.whiteSpace="pre",this.mirror.style.wordWrap="initial"),append$3(C,this.scrollableElement.getDomNode()),this._register(this.scrollableElement),this._register(this.scrollableElement.onScroll(J=>this.input.scrollTop=J.scrollTop));const X=this._register(new DomEmitter(document,"selectionchange")),Q=Event$1.filter(X.event,()=>{const J=document.getSelection();return(J==null?void 0:J.anchorNode)===Z});this._register(Q(this.updateScrollDimensions,this)),this._register(this.onDidHeightChange(this.updateScrollDimensions,this))}else this.input.type=this.options.type||"text",this.input.setAttribute("wrap","off");this.ariaLabel&&this.input.setAttribute("aria-label",this.ariaLabel),this.placeholder&&!this.options.showPlaceholderOnFocus&&this.setPlaceHolder(this.placeholder),this.tooltip&&this.setTooltip(this.tooltip),this.oninput(this.input,()=>this.onValueChange()),this.onblur(this.input,()=>this.onBlur()),this.onfocus(this.input,()=>this.onFocus()),this._register(this.ignoreGesture(this.input)),setTimeout(()=>this.updateMirror(),0),this.options.actions&&(this.actionbar=this._register(new ActionBar(this.element)),this.actionbar.push(this.options.actions,{icon:!0,label:!1})),this.applyStyles()}onBlur(){this._hideMessage(),this.options.showPlaceholderOnFocus&&this.input.setAttribute("placeholder","")}onFocus(){this._showMessage(),this.options.showPlaceholderOnFocus&&this.input.setAttribute("placeholder",this.placeholder||"")}setPlaceHolder(C){this.placeholder=C,this.input.setAttribute("placeholder",C)}setTooltip(C){this.tooltip=C,this.input.title=C}get inputElement(){return this.input}get value(){return this.input.value}set value(C){this.input.value!==C&&(this.input.value=C,this.onValueChange())}get height(){return typeof this.cachedHeight=="number"?this.cachedHeight:getTotalHeight(this.element)}focus(){this.input.focus()}blur(){this.input.blur()}hasFocus(){return document.activeElement===this.input}select(C=null){this.input.select(),C&&(this.input.setSelectionRange(C.start,C.end),C.end===this.input.value.length&&(this.input.scrollLeft=this.input.scrollWidth))}isSelectionAtEnd(){return this.input.selectionEnd===this.input.value.length&&this.input.selectionStart===this.input.selectionEnd}enable(){this.input.removeAttribute("disabled")}disable(){this.blur(),this.input.disabled=!0,this._hideMessage()}set paddingRight(C){this.input.style.width=`calc(100% - ${C}px)`,this.mirror&&(this.mirror.style.paddingRight=C+"px")}updateScrollDimensions(){if(typeof this.cachedContentHeight!="number"||typeof this.cachedHeight!="number"||!this.scrollableElement)return;const C=this.cachedContentHeight,W=this.cachedHeight,V=this.input.scrollTop;this.scrollableElement.setScrollDimensions({scrollHeight:C,height:W}),this.scrollableElement.setScrollPosition({scrollTop:V})}showMessage(C,W){if(this.state==="open"&&equals$4(this.message,C))return;this.message=C,this.element.classList.remove("idle"),this.element.classList.remove("info"),this.element.classList.remove("warning"),this.element.classList.remove("error"),this.element.classList.add(this.classForType(C.type));const V=this.stylesForType(this.message.type);this.element.style.border=`1px solid ${asCssValueWithDefault(V.border,"transparent")}`,this.message.content&&(this.hasFocus()||W)&&this._showMessage()}hideMessage(){this.message=null,this.element.classList.remove("info"),this.element.classList.remove("warning"),this.element.classList.remove("error"),this.element.classList.add("idle"),this._hideMessage(),this.applyStyles()}validate(){let C=null;return this.validation&&(C=this.validation(this.value),C?(this.inputElement.setAttribute("aria-invalid","true"),this.showMessage(C)):this.inputElement.hasAttribute("aria-invalid")&&(this.inputElement.removeAttribute("aria-invalid"),this.hideMessage())),C==null?void 0:C.type}stylesForType(C){const W=this.options.inputBoxStyles;switch(C){case 1:return{border:W.inputValidationInfoBorder,background:W.inputValidationInfoBackground,foreground:W.inputValidationInfoForeground};case 2:return{border:W.inputValidationWarningBorder,background:W.inputValidationWarningBackground,foreground:W.inputValidationWarningForeground};default:return{border:W.inputValidationErrorBorder,background:W.inputValidationErrorBackground,foreground:W.inputValidationErrorForeground}}}classForType(C){switch(C){case 1:return"info";case 2:return"warning";default:return"error"}}_showMessage(){if(!this.contextViewProvider||!this.message)return;let C;const W=()=>C.style.width=getTotalWidth(this.element)+"px";this.contextViewProvider.showContextView({getAnchor:()=>this.element,anchorAlignment:1,render:U=>{var G,Z;if(!this.message)return null;C=append$3(U,$$b(".monaco-inputbox-container")),W();const X={inline:!0,className:"monaco-inputbox-message"},Q=this.message.formatContent?renderFormattedText(this.message.content,X):renderText(this.message.content,X);Q.classList.add(this.classForType(this.message.type));const J=this.stylesForType(this.message.type);return Q.style.backgroundColor=(G=J.background)!==null&&G!==void 0?G:"",Q.style.color=(Z=J.foreground)!==null&&Z!==void 0?Z:"",Q.style.border=J.border?`1px solid ${J.border}`:"",append$3(C,Q),null},onHide:()=>{this.state="closed"},layout:W});let V;this.message.type===3?V=localize("alertErrorMessage","Error: {0}",this.message.content):this.message.type===2?V=localize("alertWarningMessage","Warning: {0}",this.message.content):V=localize("alertInfoMessage","Info: {0}",this.message.content),alert(V),this.state="open"}_hideMessage(){this.contextViewProvider&&(this.state==="open"&&this.contextViewProvider.hideContextView(),this.state="idle")}onValueChange(){this._onDidChange.fire(this.value),this.validate(),this.updateMirror(),this.input.classList.toggle("empty",!this.value),this.state==="open"&&this.contextViewProvider&&this.contextViewProvider.layout()}updateMirror(){if(!this.mirror)return;const C=this.value,V=C.charCodeAt(C.length-1)===10?" ":"";(C+V).replace(/\u000c/g,"")?this.mirror.textContent=C+V:this.mirror.innerText=" ",this.layout()}applyStyles(){var C,W,V;const U=this.options.inputBoxStyles,G=(C=U.inputBackground)!==null&&C!==void 0?C:"",Z=(W=U.inputForeground)!==null&&W!==void 0?W:"",X=(V=U.inputBorder)!==null&&V!==void 0?V:"";this.element.style.backgroundColor=G,this.element.style.color=Z,this.input.style.backgroundColor="inherit",this.input.style.color=Z,this.element.style.border=`1px solid ${asCssValueWithDefault(X,"transparent")}`}layout(){if(!this.mirror)return;const C=this.cachedContentHeight;this.cachedContentHeight=getTotalHeight(this.mirror),C!==this.cachedContentHeight&&(this.cachedHeight=Math.min(this.cachedContentHeight,this.maxHeight),this.input.style.height=this.cachedHeight+"px",this._onDidHeightChange.fire(this.cachedContentHeight))}insertAtCursor(C){const W=this.inputElement,V=W.selectionStart,U=W.selectionEnd,G=W.value;V!==null&&U!==null&&(this.value=G.substr(0,V)+C+G.substr(U),W.setSelectionRange(V+1,V+1),this.layout())}dispose(){var C;this._hideMessage(),this.message=null,(C=this.actionbar)===null||C===void 0||C.dispose(),super.dispose()}};class HistoryInputBox extends InputBox$1{constructor(C,W,V){const U=localize({key:"history.inputbox.hint",comment:["Text will be prefixed with ⇅ plus a single space, then used as a hint where input field keeps history"]},"for history"),G=` or ⇅ ${U}`,Z=` (⇅ ${U})`;super(C,W,V),this._onDidFocus=this._register(new Emitter$1),this.onDidFocus=this._onDidFocus.event,this._onDidBlur=this._register(new Emitter$1),this.onDidBlur=this._onDidBlur.event,this.history=new HistoryNavigator(V.history,100);const X=()=>{if(V.showHistoryHint&&V.showHistoryHint()&&!this.placeholder.endsWith(G)&&!this.placeholder.endsWith(Z)&&this.history.getHistory().length){const Q=this.placeholder.endsWith(")")?G:Z,J=this.placeholder+Q;V.showPlaceholderOnFocus&&document.activeElement!==this.input?this.placeholder=J:this.setPlaceHolder(J)}};this.observer=new MutationObserver((Q,J)=>{Q.forEach(ee=>{ee.target.textContent||X()})}),this.observer.observe(this.input,{attributeFilter:["class"]}),this.onfocus(this.input,()=>X()),this.onblur(this.input,()=>{const Q=J=>{if(this.placeholder.endsWith(J)){const ee=this.placeholder.slice(0,this.placeholder.length-J.length);return V.showPlaceholderOnFocus?this.placeholder=ee:this.setPlaceHolder(ee),!0}else return!1};Q(Z)||Q(G)})}dispose(){super.dispose(),this.observer&&(this.observer.disconnect(),this.observer=void 0)}addToHistory(C){this.value&&(C||this.value!==this.getCurrentValue())&&this.history.add(this.value)}isAtLastInHistory(){return this.history.isLast()}isNowhereInHistory(){return this.history.isNowhere()}showNextValue(){this.history.has(this.value)||this.addToHistory();let C=this.getNextValue();C&&(C=C===this.value?this.getNextValue():C),this.value=C??"",status(this.value?this.value:localize("clearedInput","Cleared Input"))}showPreviousValue(){this.history.has(this.value)||this.addToHistory();let C=this.getPreviousValue();C&&(C=C===this.value?this.getPreviousValue():C),C&&(this.value=C,status(this.value))}onBlur(){super.onBlur(),this._onDidBlur.fire()}onFocus(){super.onFocus(),this._onDidFocus.fire()}getCurrentValue(){let C=this.history.current();return C||(C=this.history.last(),this.history.next()),C}getPreviousValue(){return this.history.previous()||this.history.first()}getNextValue(){return this.history.next()}}const findInput="",NLS_DEFAULT_LABEL$1=localize("defaultLabel","input");class FindInput extends Widget$1{constructor(C,W,V){super(),this.fixFocusOnOptionClickEnabled=!0,this.imeSessionInProgress=!1,this.additionalTogglesDisposables=this._register(new MutableDisposable),this.additionalToggles=[],this._onDidOptionChange=this._register(new Emitter$1),this.onDidOptionChange=this._onDidOptionChange.event,this._onKeyDown=this._register(new Emitter$1),this.onKeyDown=this._onKeyDown.event,this._onMouseDown=this._register(new Emitter$1),this.onMouseDown=this._onMouseDown.event,this._onInput=this._register(new Emitter$1),this._onKeyUp=this._register(new Emitter$1),this._onCaseSensitiveKeyDown=this._register(new Emitter$1),this.onCaseSensitiveKeyDown=this._onCaseSensitiveKeyDown.event,this._onRegexKeyDown=this._register(new Emitter$1),this.onRegexKeyDown=this._onRegexKeyDown.event,this._lastHighlightFindOptions=0,this.placeholder=V.placeholder||"",this.validation=V.validation,this.label=V.label||NLS_DEFAULT_LABEL$1,this.showCommonFindToggles=!!V.showCommonFindToggles;const U=V.appendCaseSensitiveLabel||"",G=V.appendWholeWordsLabel||"",Z=V.appendRegexLabel||"",X=V.history||[],Q=!!V.flexibleHeight,J=!!V.flexibleWidth,ee=V.flexibleMaxHeight;if(this.domNode=document.createElement("div"),this.domNode.classList.add("monaco-findInput"),this.inputBox=this._register(new HistoryInputBox(this.domNode,W,{placeholder:this.placeholder||"",ariaLabel:this.label||"",validationOptions:{validation:this.validation},history:X,showHistoryHint:V.showHistoryHint,flexibleHeight:Q,flexibleWidth:J,flexibleMaxHeight:ee,inputBoxStyles:V.inputBoxStyles})),this.showCommonFindToggles){this.regex=this._register(new RegexToggle(Object.assign({appendTitle:Z,isChecked:!1},V.toggleStyles))),this._register(this.regex.onChange(ie=>{this._onDidOptionChange.fire(ie),!ie&&this.fixFocusOnOptionClickEnabled&&this.inputBox.focus(),this.validate()})),this._register(this.regex.onKeyDown(ie=>{this._onRegexKeyDown.fire(ie)})),this.wholeWords=this._register(new WholeWordsToggle(Object.assign({appendTitle:G,isChecked:!1},V.toggleStyles))),this._register(this.wholeWords.onChange(ie=>{this._onDidOptionChange.fire(ie),!ie&&this.fixFocusOnOptionClickEnabled&&this.inputBox.focus(),this.validate()})),this.caseSensitive=this._register(new CaseSensitiveToggle(Object.assign({appendTitle:U,isChecked:!1},V.toggleStyles))),this._register(this.caseSensitive.onChange(ie=>{this._onDidOptionChange.fire(ie),!ie&&this.fixFocusOnOptionClickEnabled&&this.inputBox.focus(),this.validate()})),this._register(this.caseSensitive.onKeyDown(ie=>{this._onCaseSensitiveKeyDown.fire(ie)}));const te=[this.caseSensitive.domNode,this.wholeWords.domNode,this.regex.domNode];this.onkeydown(this.domNode,ie=>{if(ie.equals(15)||ie.equals(17)||ie.equals(9)){const ne=te.indexOf(document.activeElement);if(ne>=0){let oe=-1;ie.equals(17)?oe=(ne+1)%te.length:ie.equals(15)&&(ne===0?oe=te.length-1:oe=ne-1),ie.equals(9)?(te[ne].blur(),this.inputBox.focus()):oe>=0&&te[oe].focus(),EventHelper.stop(ie,!0)}}})}this.controls=document.createElement("div"),this.controls.className="controls",this.controls.style.display=this.showCommonFindToggles?"":"none",this.caseSensitive&&this.controls.append(this.caseSensitive.domNode),this.wholeWords&&this.controls.appendChild(this.wholeWords.domNode),this.regex&&this.controls.appendChild(this.regex.domNode),this.setAdditionalToggles(V==null?void 0:V.additionalToggles),this.controls&&this.domNode.appendChild(this.controls),C==null||C.appendChild(this.domNode),this._register(addDisposableListener(this.inputBox.inputElement,"compositionstart",te=>{this.imeSessionInProgress=!0})),this._register(addDisposableListener(this.inputBox.inputElement,"compositionend",te=>{this.imeSessionInProgress=!1,this._onInput.fire()})),this.onkeydown(this.inputBox.inputElement,te=>this._onKeyDown.fire(te)),this.onkeyup(this.inputBox.inputElement,te=>this._onKeyUp.fire(te)),this.oninput(this.inputBox.inputElement,te=>this._onInput.fire()),this.onmousedown(this.inputBox.inputElement,te=>this._onMouseDown.fire(te))}get onDidChange(){return this.inputBox.onDidChange}layout(C){this.inputBox.layout(),this.updateInputBoxPadding(C.collapsedFindWidget)}enable(){var C,W,V;this.domNode.classList.remove("disabled"),this.inputBox.enable(),(C=this.regex)===null||C===void 0||C.enable(),(W=this.wholeWords)===null||W===void 0||W.enable(),(V=this.caseSensitive)===null||V===void 0||V.enable();for(const U of this.additionalToggles)U.enable()}disable(){var C,W,V;this.domNode.classList.add("disabled"),this.inputBox.disable(),(C=this.regex)===null||C===void 0||C.disable(),(W=this.wholeWords)===null||W===void 0||W.disable(),(V=this.caseSensitive)===null||V===void 0||V.disable();for(const U of this.additionalToggles)U.disable()}setFocusInputOnOptionClick(C){this.fixFocusOnOptionClickEnabled=C}setEnabled(C){C?this.enable():this.disable()}setAdditionalToggles(C){for(const W of this.additionalToggles)W.domNode.remove();this.additionalToggles=[],this.additionalTogglesDisposables.value=new DisposableStore;for(const W of C??[])this.additionalTogglesDisposables.value.add(W),this.controls.appendChild(W.domNode),this.additionalTogglesDisposables.value.add(W.onChange(V=>{this._onDidOptionChange.fire(V),!V&&this.fixFocusOnOptionClickEnabled&&this.inputBox.focus()})),this.additionalToggles.push(W);this.additionalToggles.length>0&&(this.controls.style.display=""),this.updateInputBoxPadding()}updateInputBoxPadding(C=!1){var W,V,U,G,Z,X;C?this.inputBox.paddingRight=0:this.inputBox.paddingRight=((V=(W=this.caseSensitive)===null||W===void 0?void 0:W.width())!==null&&V!==void 0?V:0)+((G=(U=this.wholeWords)===null||U===void 0?void 0:U.width())!==null&&G!==void 0?G:0)+((X=(Z=this.regex)===null||Z===void 0?void 0:Z.width())!==null&&X!==void 0?X:0)+this.additionalToggles.reduce((Q,J)=>Q+J.width(),0)}getValue(){return this.inputBox.value}setValue(C){this.inputBox.value!==C&&(this.inputBox.value=C)}select(){this.inputBox.select()}focus(){this.inputBox.focus()}getCaseSensitive(){var C,W;return(W=(C=this.caseSensitive)===null||C===void 0?void 0:C.checked)!==null&&W!==void 0?W:!1}setCaseSensitive(C){this.caseSensitive&&(this.caseSensitive.checked=C)}getWholeWords(){var C,W;return(W=(C=this.wholeWords)===null||C===void 0?void 0:C.checked)!==null&&W!==void 0?W:!1}setWholeWords(C){this.wholeWords&&(this.wholeWords.checked=C)}getRegex(){var C,W;return(W=(C=this.regex)===null||C===void 0?void 0:C.checked)!==null&&W!==void 0?W:!1}setRegex(C){this.regex&&(this.regex.checked=C,this.validate())}focusOnCaseSensitive(){var C;(C=this.caseSensitive)===null||C===void 0||C.focus()}highlightFindOptions(){this.domNode.classList.remove("highlight-"+this._lastHighlightFindOptions),this._lastHighlightFindOptions=1-this._lastHighlightFindOptions,this.domNode.classList.add("highlight-"+this._lastHighlightFindOptions)}validate(){this.inputBox.validate()}showMessage(C){this.inputBox.showMessage(C)}clearMessage(){this.inputBox.hideMessage()}}var ObjectTreeElementCollapseState;(function(K){K[K.Expanded=0]="Expanded",K[K.Collapsed=1]="Collapsed",K[K.PreserveOrExpanded=2]="PreserveOrExpanded",K[K.PreserveOrCollapsed=3]="PreserveOrCollapsed"})(ObjectTreeElementCollapseState||(ObjectTreeElementCollapseState={}));var TreeMouseEventTarget;(function(K){K[K.Unknown=0]="Unknown",K[K.Twistie=1]="Twistie",K[K.Element=2]="Element",K[K.Filter=3]="Filter"})(TreeMouseEventTarget||(TreeMouseEventTarget={}));class TreeError extends Error{constructor(C,W){super(`TreeError [${C}] ${W}`)}}class WeakMapper{constructor(C){this.fn=C,this._map=new WeakMap}map(C){let W=this._map.get(C);return W||(W=this.fn(C),this._map.set(C,W)),W}}function isFilterResult(K){return typeof K=="object"&&"visibility"in K&&"data"in K}function getVisibleState(K){switch(K){case!0:return 1;case!1:return 0;default:return K}}function isCollapsibleStateUpdate(K){return typeof K.collapsible=="boolean"}class IndexTreeModel{constructor(C,W,V,U={}){this.user=C,this.list=W,this.rootRef=[],this.eventBufferer=new EventBufferer,this._onDidChangeCollapseState=new Emitter$1,this.onDidChangeCollapseState=this.eventBufferer.wrapEvent(this._onDidChangeCollapseState.event),this._onDidChangeRenderNodeCount=new Emitter$1,this.onDidChangeRenderNodeCount=this.eventBufferer.wrapEvent(this._onDidChangeRenderNodeCount.event),this._onDidSplice=new Emitter$1,this.onDidSplice=this._onDidSplice.event,this.refilterDelayer=new Delayer(MicrotaskDelay),this.collapseByDefault=typeof U.collapseByDefault>"u"?!1:U.collapseByDefault,this.filter=U.filter,this.autoExpandSingleChildren=typeof U.autoExpandSingleChildren>"u"?!1:U.autoExpandSingleChildren,this.root={parent:void 0,element:V,children:[],depth:0,visibleChildrenCount:0,visibleChildIndex:-1,collapsible:!1,collapsed:!1,renderNodeCount:0,visibility:1,visible:!0,filterData:void 0}}splice(C,W,V=Iterable.empty(),U={}){if(C.length===0)throw new TreeError(this.user,"Invalid tree location");U.diffIdentityProvider?this.spliceSmart(U.diffIdentityProvider,C,W,V,U):this.spliceSimple(C,W,V,U)}spliceSmart(C,W,V,U,G,Z){var X;U===void 0&&(U=Iterable.empty()),Z===void 0&&(Z=(X=G.diffDepth)!==null&&X!==void 0?X:0);const{parentNode:Q}=this.getParentNodeWithListIndex(W);if(!Q.lastDiffIds)return this.spliceSimple(W,V,U,G);const J=[...U],ee=W[W.length-1],te=new LcsDiff({getElements:()=>Q.lastDiffIds},{getElements:()=>[...Q.children.slice(0,ee),...J,...Q.children.slice(ee+V)].map(ae=>C.getId(ae.element).toString())}).ComputeDiff(!1);if(te.quitEarly)return Q.lastDiffIds=void 0,this.spliceSimple(W,V,J,G);const ie=W.slice(0,-1),ne=(ae,se,le)=>{if(Z>0)for(let ce=0;ce<le;ce++)ae--,se--,this.spliceSmart(C,[...ie,ae,0],Number.MAX_SAFE_INTEGER,J[se].children,G,Z-1)};let oe=Math.min(Q.children.length,ee+V),re=J.length;for(const ae of te.changes.sort((se,le)=>le.originalStart-se.originalStart))ne(oe,re,oe-(ae.originalStart+ae.originalLength)),oe=ae.originalStart,re=ae.modifiedStart-ee,this.spliceSimple([...ie,oe],ae.originalLength,Iterable.slice(J,re,re+ae.modifiedLength),G);ne(oe,re,oe)}spliceSimple(C,W,V=Iterable.empty(),{onDidCreateNode:U,onDidDeleteNode:G,diffIdentityProvider:Z}){const{parentNode:X,listIndex:Q,revealed:J,visible:ee}=this.getParentNodeWithListIndex(C),te=[],ie=Iterable.map(V,he=>this.createTreeNode(he,X,X.visible?1:0,J,te,U)),ne=C[C.length-1],oe=X.children.length>0;let re=0;for(let he=ne;he>=0&&he<X.children.length;he--){const fe=X.children[he];if(fe.visible){re=fe.visibleChildIndex;break}}const ae=[];let se=0,le=0;for(const he of ie)ae.push(he),le+=he.renderNodeCount,he.visible&&(he.visibleChildIndex=re+se++);const ce=splice$1(X.children,ne,W,ae);Z?X.lastDiffIds?splice$1(X.lastDiffIds,ne,W,ae.map(he=>Z.getId(he.element).toString())):X.lastDiffIds=X.children.map(he=>Z.getId(he.element).toString()):X.lastDiffIds=void 0;let de=0;for(const he of ce)he.visible&&de++;if(de!==0)for(let he=ne+ae.length;he<X.children.length;he++){const fe=X.children[he];fe.visible&&(fe.visibleChildIndex-=de)}if(X.visibleChildrenCount+=se-de,J&&ee){const he=ce.reduce((fe,pe)=>fe+(pe.visible?pe.renderNodeCount:0),0);this._updateAncestorsRenderNodeCount(X,le-he),this.list.splice(Q,he,te)}if(ce.length>0&&G){const he=fe=>{G(fe),fe.children.forEach(he)};ce.forEach(he)}this._onDidSplice.fire({insertedNodes:ae,deletedNodes:ce});const ue=X.children.length>0;oe!==ue&&this.setCollapsible(C.slice(0,-1),ue);let ge=X;for(;ge;){if(ge.visibility===2){this.refilterDelayer.trigger(()=>this.refilter());break}ge=ge.parent}}rerender(C){if(C.length===0)throw new TreeError(this.user,"Invalid tree location");const{node:W,listIndex:V,revealed:U}=this.getTreeNodeWithListIndex(C);W.visible&&U&&this.list.splice(V,1,[W])}has(C){return this.hasTreeNode(C)}getListIndex(C){const{listIndex:W,visible:V,revealed:U}=this.getTreeNodeWithListIndex(C);return V&&U?W:-1}getListRenderCount(C){return this.getTreeNode(C).renderNodeCount}isCollapsible(C){return this.getTreeNode(C).collapsible}setCollapsible(C,W){const V=this.getTreeNode(C);typeof W>"u"&&(W=!V.collapsible);const U={collapsible:W};return this.eventBufferer.bufferEvents(()=>this._setCollapseState(C,U))}isCollapsed(C){return this.getTreeNode(C).collapsed}setCollapsed(C,W,V){const U=this.getTreeNode(C);typeof W>"u"&&(W=!U.collapsed);const G={collapsed:W,recursive:V||!1};return this.eventBufferer.bufferEvents(()=>this._setCollapseState(C,G))}_setCollapseState(C,W){const{node:V,listIndex:U,revealed:G}=this.getTreeNodeWithListIndex(C),Z=this._setListNodeCollapseState(V,U,G,W);if(V!==this.root&&this.autoExpandSingleChildren&&Z&&!isCollapsibleStateUpdate(W)&&V.collapsible&&!V.collapsed&&!W.recursive){let X=-1;for(let Q=0;Q<V.children.length;Q++)if(V.children[Q].visible)if(X>-1){X=-1;break}else X=Q;X>-1&&this._setCollapseState([...C,X],W)}return Z}_setListNodeCollapseState(C,W,V,U){const G=this._setNodeCollapseState(C,U,!1);if(!V||!C.visible||!G)return G;const Z=C.renderNodeCount,X=this.updateNodeAfterCollapseChange(C),Q=Z-(W===-1?0:1);return this.list.splice(W+1,Q,X.slice(1)),G}_setNodeCollapseState(C,W,V){let U;if(C===this.root?U=!1:(isCollapsibleStateUpdate(W)?(U=C.collapsible!==W.collapsible,C.collapsible=W.collapsible):C.collapsible?(U=C.collapsed!==W.collapsed,C.collapsed=W.collapsed):U=!1,U&&this._onDidChangeCollapseState.fire({node:C,deep:V})),!isCollapsibleStateUpdate(W)&&W.recursive)for(const G of C.children)U=this._setNodeCollapseState(G,W,!0)||U;return U}expandTo(C){this.eventBufferer.bufferEvents(()=>{let W=this.getTreeNode(C);for(;W.parent;)W=W.parent,C=C.slice(0,C.length-1),W.collapsed&&this._setCollapseState(C,{collapsed:!1,recursive:!1})})}refilter(){const C=this.root.renderNodeCount,W=this.updateNodeAfterFilterChange(this.root);this.list.splice(0,C,W),this.refilterDelayer.cancel()}createTreeNode(C,W,V,U,G,Z){const X={parent:W,element:C.element,children:[],depth:W.depth+1,visibleChildrenCount:0,visibleChildIndex:-1,collapsible:typeof C.collapsible=="boolean"?C.collapsible:typeof C.collapsed<"u",collapsed:typeof C.collapsed>"u"?this.collapseByDefault:C.collapsed,renderNodeCount:1,visibility:1,visible:!0,filterData:void 0},Q=this._filterNode(X,V);X.visibility=Q,U&&G.push(X);const J=C.children||Iterable.empty(),ee=U&&Q!==0&&!X.collapsed;let te=0,ie=1;for(const ne of J){const oe=this.createTreeNode(ne,X,Q,ee,G,Z);X.children.push(oe),ie+=oe.renderNodeCount,oe.visible&&(oe.visibleChildIndex=te++)}return X.collapsible=X.collapsible||X.children.length>0,X.visibleChildrenCount=te,X.visible=Q===2?te>0:Q===1,X.visible?X.collapsed||(X.renderNodeCount=ie):(X.renderNodeCount=0,U&&G.pop()),Z==null||Z(X),X}updateNodeAfterCollapseChange(C){const W=C.renderNodeCount,V=[];return this._updateNodeAfterCollapseChange(C,V),this._updateAncestorsRenderNodeCount(C.parent,V.length-W),V}_updateNodeAfterCollapseChange(C,W){if(C.visible===!1)return 0;if(W.push(C),C.renderNodeCount=1,!C.collapsed)for(const V of C.children)C.renderNodeCount+=this._updateNodeAfterCollapseChange(V,W);return this._onDidChangeRenderNodeCount.fire(C),C.renderNodeCount}updateNodeAfterFilterChange(C){const W=C.renderNodeCount,V=[];return this._updateNodeAfterFilterChange(C,C.visible?1:0,V),this._updateAncestorsRenderNodeCount(C.parent,V.length-W),V}_updateNodeAfterFilterChange(C,W,V,U=!0){let G;if(C!==this.root){if(G=this._filterNode(C,W),G===0)return C.visible=!1,C.renderNodeCount=0,!1;U&&V.push(C)}const Z=V.length;C.renderNodeCount=C===this.root?0:1;let X=!1;if(!C.collapsed||G!==0){let Q=0;for(const J of C.children)X=this._updateNodeAfterFilterChange(J,G,V,U&&!C.collapsed)||X,J.visible&&(J.visibleChildIndex=Q++);C.visibleChildrenCount=Q}else C.visibleChildrenCount=0;return C!==this.root&&(C.visible=G===2?X:G===1,C.visibility=G),C.visible?C.collapsed||(C.renderNodeCount+=V.length-Z):(C.renderNodeCount=0,U&&V.pop()),this._onDidChangeRenderNodeCount.fire(C),C.visible}_updateAncestorsRenderNodeCount(C,W){if(W!==0)for(;C;)C.renderNodeCount+=W,this._onDidChangeRenderNodeCount.fire(C),C=C.parent}_filterNode(C,W){const V=this.filter?this.filter.filter(C.element,W):1;return typeof V=="boolean"?(C.filterData=void 0,V?1:0):isFilterResult(V)?(C.filterData=V.data,getVisibleState(V.visibility)):(C.filterData=void 0,getVisibleState(V))}hasTreeNode(C,W=this.root){if(!C||C.length===0)return!0;const[V,...U]=C;return V<0||V>W.children.length?!1:this.hasTreeNode(U,W.children[V])}getTreeNode(C,W=this.root){if(!C||C.length===0)return W;const[V,...U]=C;if(V<0||V>W.children.length)throw new TreeError(this.user,"Invalid tree location");return this.getTreeNode(U,W.children[V])}getTreeNodeWithListIndex(C){if(C.length===0)return{node:this.root,listIndex:-1,revealed:!0,visible:!1};const{parentNode:W,listIndex:V,revealed:U,visible:G}=this.getParentNodeWithListIndex(C),Z=C[C.length-1];if(Z<0||Z>W.children.length)throw new TreeError(this.user,"Invalid tree location");const X=W.children[Z];return{node:X,listIndex:V,revealed:U,visible:G&&X.visible}}getParentNodeWithListIndex(C,W=this.root,V=0,U=!0,G=!0){const[Z,...X]=C;if(Z<0||Z>W.children.length)throw new TreeError(this.user,"Invalid tree location");for(let Q=0;Q<Z;Q++)V+=W.children[Q].renderNodeCount;return U=U&&!W.collapsed,G=G&&W.visible,X.length===0?{parentNode:W,listIndex:V,revealed:U,visible:G}:this.getParentNodeWithListIndex(X,W.children[Z],V+1,U,G)}getNode(C=[]){return this.getTreeNode(C)}getNodeLocation(C){const W=[];let V=C;for(;V.parent;)W.push(V.parent.children.indexOf(V)),V=V.parent;return W.reverse()}getParentNodeLocation(C){if(C.length!==0)return C.length===1?[]:tail2(C)[0]}getFirstElementChild(C){const W=this.getTreeNode(C);if(W.children.length!==0)return W.children[0].element}}const tree="";globalThis&&globalThis.__awaiter;class TreeElementsDragAndDropData extends ElementsDragAndDropData{constructor(C){super(C.elements.map(W=>W.element)),this.data=C}}function asTreeDragAndDropData(K){return K instanceof ElementsDragAndDropData?new TreeElementsDragAndDropData(K):K}class TreeNodeListDragAndDrop{constructor(C,W){this.modelProvider=C,this.dnd=W,this.autoExpandDisposable=Disposable.None,this.disposables=new DisposableStore}getDragURI(C){return this.dnd.getDragURI(C.element)}getDragLabel(C,W){if(this.dnd.getDragLabel)return this.dnd.getDragLabel(C.map(V=>V.element),W)}onDragStart(C,W){var V,U;(U=(V=this.dnd).onDragStart)===null||U===void 0||U.call(V,asTreeDragAndDropData(C),W)}onDragOver(C,W,V,U,G=!0){const Z=this.dnd.onDragOver(asTreeDragAndDropData(C),W&&W.element,V,U),X=this.autoExpandNode!==W;if(X&&(this.autoExpandDisposable.dispose(),this.autoExpandNode=W),typeof W>"u")return Z;if(X&&typeof Z!="boolean"&&Z.autoExpand&&(this.autoExpandDisposable=disposableTimeout(()=>{const ie=this.modelProvider(),ne=ie.getNodeLocation(W);ie.isCollapsed(ne)&&ie.setCollapsed(ne,!1),this.autoExpandNode=void 0},500,this.disposables)),typeof Z=="boolean"||!Z.accept||typeof Z.bubble>"u"||Z.feedback){if(!G){const ie=typeof Z=="boolean"?Z:Z.accept,ne=typeof Z=="boolean"?void 0:Z.effect;return{accept:ie,effect:ne,feedback:[V]}}return Z}if(Z.bubble===1){const ie=this.modelProvider(),ne=ie.getNodeLocation(W),oe=ie.getParentNodeLocation(ne),re=ie.getNode(oe),ae=oe&&ie.getListIndex(oe);return this.onDragOver(C,re,ae,U,!1)}const Q=this.modelProvider(),J=Q.getNodeLocation(W),ee=Q.getListIndex(J),te=Q.getListRenderCount(J);return Object.assign(Object.assign({},Z),{feedback:range$2(ee,ee+te)})}drop(C,W,V,U){this.autoExpandDisposable.dispose(),this.autoExpandNode=void 0,this.dnd.drop(asTreeDragAndDropData(C),W&&W.element,V,U)}onDragEnd(C){var W,V;(V=(W=this.dnd).onDragEnd)===null||V===void 0||V.call(W,C)}dispose(){this.disposables.dispose(),this.dnd.dispose()}}function asListOptions(K,C){return C&&Object.assign(Object.assign({},C),{identityProvider:C.identityProvider&&{getId(W){return C.identityProvider.getId(W.element)}},dnd:C.dnd&&new TreeNodeListDragAndDrop(K,C.dnd),multipleSelectionController:C.multipleSelectionController&&{isSelectionSingleChangeEvent(W){return C.multipleSelectionController.isSelectionSingleChangeEvent(Object.assign(Object.assign({},W),{element:W.element}))},isSelectionRangeChangeEvent(W){return C.multipleSelectionController.isSelectionRangeChangeEvent(Object.assign(Object.assign({},W),{element:W.element}))}},accessibilityProvider:C.accessibilityProvider&&Object.assign(Object.assign({},C.accessibilityProvider),{getSetSize(W){const V=K(),U=V.getNodeLocation(W),G=V.getParentNodeLocation(U);return V.getNode(G).visibleChildrenCount},getPosInSet(W){return W.visibleChildIndex+1},isChecked:C.accessibilityProvider&&C.accessibilityProvider.isChecked?W=>C.accessibilityProvider.isChecked(W.element):void 0,getRole:C.accessibilityProvider&&C.accessibilityProvider.getRole?W=>C.accessibilityProvider.getRole(W.element):()=>"treeitem",getAriaLabel(W){return C.accessibilityProvider.getAriaLabel(W.element)},getWidgetAriaLabel(){return C.accessibilityProvider.getWidgetAriaLabel()},getWidgetRole:C.accessibilityProvider&&C.accessibilityProvider.getWidgetRole?()=>C.accessibilityProvider.getWidgetRole():()=>"tree",getAriaLevel:C.accessibilityProvider&&C.accessibilityProvider.getAriaLevel?W=>C.accessibilityProvider.getAriaLevel(W.element):W=>W.depth,getActiveDescendantId:C.accessibilityProvider.getActiveDescendantId&&(W=>C.accessibilityProvider.getActiveDescendantId(W.element))}),keyboardNavigationLabelProvider:C.keyboardNavigationLabelProvider&&Object.assign(Object.assign({},C.keyboardNavigationLabelProvider),{getKeyboardNavigationLabel(W){return C.keyboardNavigationLabelProvider.getKeyboardNavigationLabel(W.element)}})})}class ComposedTreeDelegate{constructor(C){this.delegate=C}getHeight(C){return this.delegate.getHeight(C.element)}getTemplateId(C){return this.delegate.getTemplateId(C.element)}hasDynamicHeight(C){return!!this.delegate.hasDynamicHeight&&this.delegate.hasDynamicHeight(C.element)}setDynamicHeight(C,W){var V,U;(U=(V=this.delegate).setDynamicHeight)===null||U===void 0||U.call(V,C.element,W)}}var RenderIndentGuides;(function(K){K.None="none",K.OnHover="onHover",K.Always="always"})(RenderIndentGuides||(RenderIndentGuides={}));class EventCollection{get elements(){return this._elements}constructor(C,W=[]){this._elements=W,this.disposables=new DisposableStore,this.onDidChange=Event$1.forEach(C,V=>this._elements=V,this.disposables)}dispose(){this.disposables.dispose()}}class TreeRenderer{constructor(C,W,V,U,G,Z={}){var X;this.renderer=C,this.modelProvider=W,this.activeNodes=U,this.renderedIndentGuides=G,this.renderedElements=new Map,this.renderedNodes=new Map,this.indent=TreeRenderer.DefaultIndent,this.hideTwistiesOfChildlessElements=!1,this.shouldRenderIndentGuides=!1,this.activeIndentNodes=new Set,this.indentGuidesDisposable=Disposable.None,this.disposables=new DisposableStore,this.templateId=C.templateId,this.updateOptions(Z),Event$1.map(V,Q=>Q.node)(this.onDidChangeNodeTwistieState,this,this.disposables),(X=C.onDidChangeTwistieState)===null||X===void 0||X.call(C,this.onDidChangeTwistieState,this,this.disposables)}updateOptions(C={}){if(typeof C.indent<"u"){const W=clamp$2(C.indent,0,40);if(W!==this.indent){this.indent=W;for(const[V,U]of this.renderedNodes)this.renderTreeElement(V,U)}}if(typeof C.renderIndentGuides<"u"){const W=C.renderIndentGuides!==RenderIndentGuides.None;if(W!==this.shouldRenderIndentGuides){this.shouldRenderIndentGuides=W;for(const[V,U]of this.renderedNodes)this._renderIndentGuides(V,U);if(this.indentGuidesDisposable.dispose(),W){const V=new DisposableStore;this.activeNodes.onDidChange(this._onDidChangeActiveNodes,this,V),this.indentGuidesDisposable=V,this._onDidChangeActiveNodes(this.activeNodes.elements)}}}typeof C.hideTwistiesOfChildlessElements<"u"&&(this.hideTwistiesOfChildlessElements=C.hideTwistiesOfChildlessElements)}renderTemplate(C){const W=append$3(C,$$d(".monaco-tl-row")),V=append$3(W,$$d(".monaco-tl-indent")),U=append$3(W,$$d(".monaco-tl-twistie")),G=append$3(W,$$d(".monaco-tl-contents")),Z=this.renderer.renderTemplate(G);return{container:C,indent:V,twistie:U,indentGuidesDisposable:Disposable.None,templateData:Z}}renderElement(C,W,V,U){this.renderedNodes.set(C,V),this.renderedElements.set(C.element,C),this.renderTreeElement(C,V),this.renderer.renderElement(C,W,V.templateData,U)}disposeElement(C,W,V,U){var G,Z;V.indentGuidesDisposable.dispose(),(Z=(G=this.renderer).disposeElement)===null||Z===void 0||Z.call(G,C,W,V.templateData,U),typeof U=="number"&&(this.renderedNodes.delete(C),this.renderedElements.delete(C.element))}disposeTemplate(C){this.renderer.disposeTemplate(C.templateData)}onDidChangeTwistieState(C){const W=this.renderedElements.get(C);W&&this.onDidChangeNodeTwistieState(W)}onDidChangeNodeTwistieState(C){const W=this.renderedNodes.get(C);W&&(this._onDidChangeActiveNodes(this.activeNodes.elements),this.renderTreeElement(C,W))}renderTreeElement(C,W){const V=TreeRenderer.DefaultIndent+(C.depth-1)*this.indent;W.twistie.style.paddingLeft=`${V}px`,W.indent.style.width=`${V+this.indent-16}px`,C.collapsible?W.container.setAttribute("aria-expanded",String(!C.collapsed)):W.container.removeAttribute("aria-expanded"),W.twistie.classList.remove(...ThemeIcon.asClassNameArray(Codicon.treeItemExpanded));let U=!1;this.renderer.renderTwistie&&(U=this.renderer.renderTwistie(C.element,W.twistie)),C.collapsible&&(!this.hideTwistiesOfChildlessElements||C.visibleChildrenCount>0)?(U||W.twistie.classList.add(...ThemeIcon.asClassNameArray(Codicon.treeItemExpanded)),W.twistie.classList.add("collapsible"),W.twistie.classList.toggle("collapsed",C.collapsed)):W.twistie.classList.remove("collapsible","collapsed"),this._renderIndentGuides(C,W)}_renderIndentGuides(C,W){if(clearNode(W.indent),W.indentGuidesDisposable.dispose(),!this.shouldRenderIndentGuides)return;const V=new DisposableStore,U=this.modelProvider();for(;;){const G=U.getNodeLocation(C),Z=U.getParentNodeLocation(G);if(!Z)break;const X=U.getNode(Z),Q=$$d(".indent-guide",{style:`width: ${this.indent}px`});this.activeIndentNodes.has(X)&&Q.classList.add("active"),W.indent.childElementCount===0?W.indent.appendChild(Q):W.indent.insertBefore(Q,W.indent.firstElementChild),this.renderedIndentGuides.add(X,Q),V.add(toDisposable(()=>this.renderedIndentGuides.delete(X,Q))),C=X}W.indentGuidesDisposable=V}_onDidChangeActiveNodes(C){if(!this.shouldRenderIndentGuides)return;const W=new Set,V=this.modelProvider();C.forEach(U=>{const G=V.getNodeLocation(U);try{const Z=V.getParentNodeLocation(G);U.collapsible&&U.children.length>0&&!U.collapsed?W.add(U):Z&&W.add(V.getNode(Z))}catch{}}),this.activeIndentNodes.forEach(U=>{W.has(U)||this.renderedIndentGuides.forEach(U,G=>G.classList.remove("active"))}),W.forEach(U=>{this.activeIndentNodes.has(U)||this.renderedIndentGuides.forEach(U,G=>G.classList.add("active"))}),this.activeIndentNodes=W}dispose(){this.renderedNodes.clear(),this.renderedElements.clear(),this.indentGuidesDisposable.dispose(),dispose(this.disposables)}}TreeRenderer.DefaultIndent=8;class FindFilter{get totalCount(){return this._totalCount}get matchCount(){return this._matchCount}constructor(C,W,V){this.tree=C,this.keyboardNavigationLabelProvider=W,this._filter=V,this._totalCount=0,this._matchCount=0,this._pattern="",this._lowercasePattern="",this.disposables=new DisposableStore,C.onWillRefilter(this.reset,this,this.disposables)}filter(C,W){let V=1;if(this._filter){const Z=this._filter.filter(C,W);if(typeof Z=="boolean"?V=Z?1:0:isFilterResult(Z)?V=getVisibleState(Z.visibility):V=Z,V===0)return!1}if(this._totalCount++,!this._pattern)return this._matchCount++,{data:FuzzyScore.Default,visibility:V};const U=this.keyboardNavigationLabelProvider.getKeyboardNavigationLabel(C),G=Array.isArray(U)?U:[U];for(const Z of G){const X=Z&&Z.toString();if(typeof X>"u")return{data:FuzzyScore.Default,visibility:V};let Q;if(this.tree.findMatchType===TreeFindMatchType.Contiguous){const J=X.toLowerCase().indexOf(this._lowercasePattern);if(J>-1){Q=[Number.MAX_SAFE_INTEGER,0];for(let ee=this._lowercasePattern.length;ee>0;ee--)Q.push(J+ee-1)}}else Q=fuzzyScore(this._pattern,this._lowercasePattern,0,X,X.toLowerCase(),0,{firstMatchCanBeWeak:!0,boostFullMatch:!0});if(Q)return this._matchCount++,G.length===1?{data:Q,visibility:V}:{data:{label:X,score:Q},visibility:V}}return this.tree.findMode===TreeFindMode.Filter?typeof this.tree.options.defaultFindVisibility=="number"?this.tree.options.defaultFindVisibility:this.tree.options.defaultFindVisibility?this.tree.options.defaultFindVisibility(C):2:{data:FuzzyScore.Default,visibility:V}}reset(){this._totalCount=0,this._matchCount=0}dispose(){dispose(this.disposables)}}var TreeFindMode;(function(K){K[K.Highlight=0]="Highlight",K[K.Filter=1]="Filter"})(TreeFindMode||(TreeFindMode={}));var TreeFindMatchType;(function(K){K[K.Fuzzy=0]="Fuzzy",K[K.Contiguous=1]="Contiguous"})(TreeFindMatchType||(TreeFindMatchType={}));let FindController$1=class{get pattern(){return this._pattern}get mode(){return this._mode}set mode(C){C!==this._mode&&(this._mode=C,this.widget&&(this.widget.mode=this._mode),this.tree.refilter(),this.render(),this._onDidChangeMode.fire(C))}get matchType(){return this._matchType}set matchType(C){C!==this._matchType&&(this._matchType=C,this.widget&&(this.widget.matchType=this._matchType),this.tree.refilter(),this.render(),this._onDidChangeMatchType.fire(C))}constructor(C,W,V,U,G,Z={}){var X,Q;this.tree=C,this.view=V,this.filter=U,this.contextViewProvider=G,this.options=Z,this._pattern="",this.width=0,this._onDidChangeMode=new Emitter$1,this.onDidChangeMode=this._onDidChangeMode.event,this._onDidChangeMatchType=new Emitter$1,this.onDidChangeMatchType=this._onDidChangeMatchType.event,this._onDidChangePattern=new Emitter$1,this._onDidChangeOpenState=new Emitter$1,this.onDidChangeOpenState=this._onDidChangeOpenState.event,this.enabledDisposables=new DisposableStore,this.disposables=new DisposableStore,this._mode=(X=C.options.defaultFindMode)!==null&&X!==void 0?X:TreeFindMode.Highlight,this._matchType=(Q=C.options.defaultFindMatchType)!==null&&Q!==void 0?Q:TreeFindMatchType.Fuzzy,W.onDidSplice(this.onDidSpliceModel,this,this.disposables)}updateOptions(C={}){C.defaultFindMode!==void 0&&(this.mode=C.defaultFindMode),C.defaultFindMatchType!==void 0&&(this.matchType=C.defaultFindMatchType)}onDidSpliceModel(){!this.widget||this.pattern.length===0||(this.tree.refilter(),this.render())}render(){var C,W,V,U;const G=this.filter.totalCount>0&&this.filter.matchCount===0;this.pattern&&G?!((C=this.tree.options.showNotFoundMessage)!==null&&C!==void 0)||C?(W=this.widget)===null||W===void 0||W.showMessage({type:2,content:localize("not found","No elements found.")}):(V=this.widget)===null||V===void 0||V.showMessage({type:2}):(U=this.widget)===null||U===void 0||U.clearMessage()}shouldAllowFocus(C){return!this.widget||!this.pattern||this._mode===TreeFindMode.Filter||this.filter.totalCount>0&&this.filter.matchCount<=1?!0:!FuzzyScore.isDefault(C.filterData)}layout(C){var W;this.width=C,(W=this.widget)===null||W===void 0||W.layout(C)}dispose(){this._history=void 0,this._onDidChangePattern.dispose(),this.enabledDisposables.dispose(),this.disposables.dispose()}};function asTreeMouseEvent$1(K){let C=TreeMouseEventTarget.Unknown;return hasParentWithClass(K.browserEvent.target,"monaco-tl-twistie","monaco-tl-row")?C=TreeMouseEventTarget.Twistie:hasParentWithClass(K.browserEvent.target,"monaco-tl-contents","monaco-tl-row")?C=TreeMouseEventTarget.Element:hasParentWithClass(K.browserEvent.target,"monaco-tree-type-filter","monaco-list")&&(C=TreeMouseEventTarget.Filter),{browserEvent:K.browserEvent,element:K.element?K.element.element:null,target:C}}function dfs$1(K,C){C(K),K.children.forEach(W=>dfs$1(W,C))}class Trait{get nodeSet(){return this._nodeSet||(this._nodeSet=this.createNodeSet()),this._nodeSet}constructor(C,W){this.getFirstViewElementWithTrait=C,this.identityProvider=W,this.nodes=[],this._onDidChange=new Emitter$1,this.onDidChange=this._onDidChange.event}set(C,W){!(W!=null&&W.__forceEvent)&&equals$5(this.nodes,C)||this._set(C,!1,W)}_set(C,W,V){if(this.nodes=[...C],this.elements=void 0,this._nodeSet=void 0,!W){const U=this;this._onDidChange.fire({get elements(){return U.get()},browserEvent:V})}}get(){return this.elements||(this.elements=this.nodes.map(C=>C.element)),[...this.elements]}getNodes(){return this.nodes}has(C){return this.nodeSet.has(C)}onDidModelSplice({insertedNodes:C,deletedNodes:W}){if(!this.identityProvider){const Q=this.createNodeSet(),J=ee=>Q.delete(ee);W.forEach(ee=>dfs$1(ee,J)),this.set([...Q.values()]);return}const V=new Set,U=Q=>V.add(this.identityProvider.getId(Q.element).toString());W.forEach(Q=>dfs$1(Q,U));const G=new Map,Z=Q=>G.set(this.identityProvider.getId(Q.element).toString(),Q);C.forEach(Q=>dfs$1(Q,Z));const X=[];for(const Q of this.nodes){const J=this.identityProvider.getId(Q.element).toString();if(!V.has(J))X.push(Q);else{const te=G.get(J);te&&te.visible&&X.push(te)}}if(this.nodes.length>0&&X.length===0){const Q=this.getFirstViewElementWithTrait();Q&&X.push(Q)}this._set(X,!0)}createNodeSet(){const C=new Set;for(const W of this.nodes)C.add(W);return C}}class TreeNodeListMouseController extends MouseController{constructor(C,W){super(C),this.tree=W}onViewPointer(C){if(isButton(C.browserEvent.target)||isInputElement(C.browserEvent.target)||isMonacoEditor(C.browserEvent.target)||C.browserEvent.isHandledByList)return;const W=C.element;if(!W)return super.onViewPointer(C);if(this.isSelectionRangeChangeEvent(C)||this.isSelectionSingleChangeEvent(C))return super.onViewPointer(C);const V=C.browserEvent.target,U=V.classList.contains("monaco-tl-twistie")||V.classList.contains("monaco-icon-label")&&V.classList.contains("folder-icon")&&C.browserEvent.offsetX<16;let G=!1;if(typeof this.tree.expandOnlyOnTwistieClick=="function"?G=this.tree.expandOnlyOnTwistieClick(W.element):G=!!this.tree.expandOnlyOnTwistieClick,G&&!U&&C.browserEvent.detail!==2)return super.onViewPointer(C);if(!this.tree.expandOnDoubleClick&&C.browserEvent.detail===2)return super.onViewPointer(C);if(W.collapsible){const Z=this.tree.getNodeLocation(W),X=C.browserEvent.altKey;if(this.tree.setFocus([Z]),this.tree.toggleCollapsed(Z,X),G&&U){C.browserEvent.isHandledByList=!0;return}}super.onViewPointer(C)}onDoubleClick(C){C.browserEvent.target.classList.contains("monaco-tl-twistie")||!this.tree.expandOnDoubleClick||C.browserEvent.isHandledByList||super.onDoubleClick(C)}}class TreeNodeList extends List$1{constructor(C,W,V,U,G,Z,X,Q){super(C,W,V,U,Q),this.focusTrait=G,this.selectionTrait=Z,this.anchorTrait=X}createMouseController(C){return new TreeNodeListMouseController(this,C.tree)}splice(C,W,V=[]){if(super.splice(C,W,V),V.length===0)return;const U=[],G=[];let Z;V.forEach((X,Q)=>{this.focusTrait.has(X)&&U.push(C+Q),this.selectionTrait.has(X)&&G.push(C+Q),this.anchorTrait.has(X)&&(Z=C+Q)}),U.length>0&&super.setFocus(distinct([...super.getFocus(),...U])),G.length>0&&super.setSelection(distinct([...super.getSelection(),...G])),typeof Z=="number"&&super.setAnchor(Z)}setFocus(C,W,V=!1){super.setFocus(C,W),V||this.focusTrait.set(C.map(U=>this.element(U)),W)}setSelection(C,W,V=!1){super.setSelection(C,W),V||this.selectionTrait.set(C.map(U=>this.element(U)),W)}setAnchor(C,W=!1){super.setAnchor(C),W||(typeof C>"u"?this.anchorTrait.set([]):this.anchorTrait.set([this.element(C)]))}}class AbstractTree{get onDidScroll(){return this.view.onDidScroll}get onDidChangeFocus(){return this.eventBufferer.wrapEvent(this.focus.onDidChange)}get onDidChangeSelection(){return this.eventBufferer.wrapEvent(this.selection.onDidChange)}get onMouseDblClick(){return Event$1.filter(Event$1.map(this.view.onMouseDblClick,asTreeMouseEvent$1),C=>C.target!==TreeMouseEventTarget.Filter)}get onPointer(){return Event$1.map(this.view.onPointer,asTreeMouseEvent$1)}get onDidFocus(){return this.view.onDidFocus}get onDidChangeModel(){return Event$1.signal(this.model.onDidSplice)}get onDidChangeCollapseState(){return this.model.onDidChangeCollapseState}get findMode(){var C,W;return(W=(C=this.findController)===null||C===void 0?void 0:C.mode)!==null&&W!==void 0?W:TreeFindMode.Highlight}set findMode(C){this.findController&&(this.findController.mode=C)}get findMatchType(){var C,W;return(W=(C=this.findController)===null||C===void 0?void 0:C.matchType)!==null&&W!==void 0?W:TreeFindMatchType.Fuzzy}set findMatchType(C){this.findController&&(this.findController.matchType=C)}get expandOnDoubleClick(){return typeof this._options.expandOnDoubleClick>"u"?!0:this._options.expandOnDoubleClick}get expandOnlyOnTwistieClick(){return typeof this._options.expandOnlyOnTwistieClick>"u"?!0:this._options.expandOnlyOnTwistieClick}get onDidDispose(){return this.view.onDidDispose}constructor(C,W,V,U,G={}){var Z;this._user=C,this._options=G,this.eventBufferer=new EventBufferer,this.onDidChangeFindOpenState=Event$1.None,this.disposables=new DisposableStore,this._onWillRefilter=new Emitter$1,this.onWillRefilter=this._onWillRefilter.event,this._onDidUpdateOptions=new Emitter$1;const X=new ComposedTreeDelegate(V),Q=new Relay,J=new Relay,ee=this.disposables.add(new EventCollection(J.event)),te=new SetMap;this.renderers=U.map(ae=>new TreeRenderer(ae,()=>this.model,Q.event,ee,te,G));for(const ae of this.renderers)this.disposables.add(ae);let ie;G.keyboardNavigationLabelProvider&&(ie=new FindFilter(this,G.keyboardNavigationLabelProvider,G.filter),G=Object.assign(Object.assign({},G),{filter:ie}),this.disposables.add(ie)),this.focus=new Trait(()=>this.view.getFocusedElements()[0],G.identityProvider),this.selection=new Trait(()=>this.view.getSelectedElements()[0],G.identityProvider),this.anchor=new Trait(()=>this.view.getAnchorElement(),G.identityProvider),this.view=new TreeNodeList(C,W,X,this.renderers,this.focus,this.selection,this.anchor,Object.assign(Object.assign({},asListOptions(()=>this.model,G)),{tree:this})),this.model=this.createModel(C,this.view,G),Q.input=this.model.onDidChangeCollapseState;const ne=Event$1.forEach(this.model.onDidSplice,ae=>{this.eventBufferer.bufferEvents(()=>{this.focus.onDidModelSplice(ae),this.selection.onDidModelSplice(ae)})},this.disposables);ne(()=>null,null,this.disposables);const oe=this.disposables.add(new Emitter$1),re=this.disposables.add(new Delayer(0));if(this.disposables.add(Event$1.any(ne,this.focus.onDidChange,this.selection.onDidChange)(()=>{re.trigger(()=>{const ae=new Set;for(const se of this.focus.getNodes())ae.add(se);for(const se of this.selection.getNodes())ae.add(se);oe.fire([...ae.values()])})})),J.input=oe.event,G.keyboardSupport!==!1){const ae=Event$1.chain(this.view.onKeyDown,se=>se.filter(le=>!isInputElement(le.target)).map(le=>new StandardKeyboardEvent(le)));Event$1.chain(ae,se=>se.filter(le=>le.keyCode===15))(this.onLeftArrow,this,this.disposables),Event$1.chain(ae,se=>se.filter(le=>le.keyCode===17))(this.onRightArrow,this,this.disposables),Event$1.chain(ae,se=>se.filter(le=>le.keyCode===10))(this.onSpace,this,this.disposables)}if((!((Z=G.findWidgetEnabled)!==null&&Z!==void 0)||Z)&&G.keyboardNavigationLabelProvider&&G.contextViewProvider){const ae=this.options.findWidgetStyles?{styles:this.options.findWidgetStyles}:void 0;this.findController=new FindController$1(this,this.model,this.view,ie,G.contextViewProvider,ae),this.focusNavigationFilter=se=>this.findController.shouldAllowFocus(se),this.onDidChangeFindOpenState=this.findController.onDidChangeOpenState,this.disposables.add(this.findController),this.onDidChangeFindMode=this.findController.onDidChangeMode,this.onDidChangeFindMatchType=this.findController.onDidChangeMatchType}else this.onDidChangeFindMode=Event$1.None,this.onDidChangeFindMatchType=Event$1.None;this.styleElement=createStyleSheet(this.view.getHTMLElement()),this.getHTMLElement().classList.toggle("always",this._options.renderIndentGuides===RenderIndentGuides.Always)}updateOptions(C={}){var W;this._options=Object.assign(Object.assign({},this._options),C);for(const V of this.renderers)V.updateOptions(C);this.view.updateOptions(this._options),(W=this.findController)===null||W===void 0||W.updateOptions(C),this._onDidUpdateOptions.fire(this._options),this.getHTMLElement().classList.toggle("always",this._options.renderIndentGuides===RenderIndentGuides.Always)}get options(){return this._options}getHTMLElement(){return this.view.getHTMLElement()}get scrollTop(){return this.view.scrollTop}set scrollTop(C){this.view.scrollTop=C}get scrollHeight(){return this.view.scrollHeight}get renderHeight(){return this.view.renderHeight}domFocus(){this.view.domFocus()}layout(C,W){var V;this.view.layout(C,W),isNumber$3(W)&&((V=this.findController)===null||V===void 0||V.layout(W))}style(C){const W=`.${this.view.domId}`,V=[];C.treeIndentGuidesStroke&&(V.push(`.monaco-list${W}:hover .monaco-tl-indent > .indent-guide, .monaco-list${W}.always .monaco-tl-indent > .indent-guide  { border-color: ${C.treeInactiveIndentGuidesStroke}; }`),V.push(`.monaco-list${W} .monaco-tl-indent > .indent-guide.active { border-color: ${C.treeIndentGuidesStroke}; }`)),this.styleElement.textContent=V.join(`
`),this.view.style(C)}getParentElement(C){const W=this.model.getParentNodeLocation(C);return this.model.getNode(W).element}getFirstElementChild(C){return this.model.getFirstElementChild(C)}getNode(C){return this.model.getNode(C)}getNodeLocation(C){return this.model.getNodeLocation(C)}collapse(C,W=!1){return this.model.setCollapsed(C,!0,W)}expand(C,W=!1){return this.model.setCollapsed(C,!1,W)}toggleCollapsed(C,W=!1){return this.model.setCollapsed(C,void 0,W)}isCollapsible(C){return this.model.isCollapsible(C)}setCollapsible(C,W){return this.model.setCollapsible(C,W)}isCollapsed(C){return this.model.isCollapsed(C)}refilter(){this._onWillRefilter.fire(void 0),this.model.refilter()}setSelection(C,W){const V=C.map(G=>this.model.getNode(G));this.selection.set(V,W);const U=C.map(G=>this.model.getListIndex(G)).filter(G=>G>-1);this.view.setSelection(U,W,!0)}getSelection(){return this.selection.get()}setFocus(C,W){const V=C.map(G=>this.model.getNode(G));this.focus.set(V,W);const U=C.map(G=>this.model.getListIndex(G)).filter(G=>G>-1);this.view.setFocus(U,W,!0)}getFocus(){return this.focus.get()}reveal(C,W){this.model.expandTo(C);const V=this.model.getListIndex(C);V!==-1&&this.view.reveal(V,W)}onLeftArrow(C){C.preventDefault(),C.stopPropagation();const W=this.view.getFocusedElements();if(W.length===0)return;const V=W[0],U=this.model.getNodeLocation(V);if(!this.model.setCollapsed(U,!0)){const Z=this.model.getParentNodeLocation(U);if(!Z)return;const X=this.model.getListIndex(Z);this.view.reveal(X),this.view.setFocus([X])}}onRightArrow(C){C.preventDefault(),C.stopPropagation();const W=this.view.getFocusedElements();if(W.length===0)return;const V=W[0],U=this.model.getNodeLocation(V);if(!this.model.setCollapsed(U,!1)){if(!V.children.some(Q=>Q.visible))return;const[Z]=this.view.getFocus(),X=Z+1;this.view.reveal(X),this.view.setFocus([X])}}onSpace(C){C.preventDefault(),C.stopPropagation();const W=this.view.getFocusedElements();if(W.length===0)return;const V=W[0],U=this.model.getNodeLocation(V),G=C.browserEvent.altKey;this.model.setCollapsed(U,void 0,G)}dispose(){dispose(this.disposables),this.view.dispose()}}class ObjectTreeModel{constructor(C,W,V={}){this.user=C,this.rootRef=null,this.nodes=new Map,this.nodesByIdentity=new Map,this.model=new IndexTreeModel(C,W,null,V),this.onDidSplice=this.model.onDidSplice,this.onDidChangeCollapseState=this.model.onDidChangeCollapseState,this.onDidChangeRenderNodeCount=this.model.onDidChangeRenderNodeCount,V.sorter&&(this.sorter={compare(U,G){return V.sorter.compare(U.element,G.element)}}),this.identityProvider=V.identityProvider}setChildren(C,W=Iterable.empty(),V={}){const U=this.getElementLocation(C);this._setChildren(U,this.preserveCollapseState(W),V)}_setChildren(C,W=Iterable.empty(),V){const U=new Set,G=new Set,Z=Q=>{var J;if(Q.element===null)return;const ee=Q;if(U.add(ee.element),this.nodes.set(ee.element,ee),this.identityProvider){const te=this.identityProvider.getId(ee.element).toString();G.add(te),this.nodesByIdentity.set(te,ee)}(J=V.onDidCreateNode)===null||J===void 0||J.call(V,ee)},X=Q=>{var J;if(Q.element===null)return;const ee=Q;if(U.has(ee.element)||this.nodes.delete(ee.element),this.identityProvider){const te=this.identityProvider.getId(ee.element).toString();G.has(te)||this.nodesByIdentity.delete(te)}(J=V.onDidDeleteNode)===null||J===void 0||J.call(V,ee)};this.model.splice([...C,0],Number.MAX_VALUE,W,Object.assign(Object.assign({},V),{onDidCreateNode:Z,onDidDeleteNode:X}))}preserveCollapseState(C=Iterable.empty()){return this.sorter&&(C=[...C].sort(this.sorter.compare.bind(this.sorter))),Iterable.map(C,W=>{let V=this.nodes.get(W.element);if(!V&&this.identityProvider){const Z=this.identityProvider.getId(W.element).toString();V=this.nodesByIdentity.get(Z)}if(!V){let Z;return typeof W.collapsed>"u"?Z=void 0:W.collapsed===ObjectTreeElementCollapseState.Collapsed||W.collapsed===ObjectTreeElementCollapseState.PreserveOrCollapsed?Z=!0:W.collapsed===ObjectTreeElementCollapseState.Expanded||W.collapsed===ObjectTreeElementCollapseState.PreserveOrExpanded?Z=!1:Z=!!W.collapsed,Object.assign(Object.assign({},W),{children:this.preserveCollapseState(W.children),collapsed:Z})}const U=typeof W.collapsible=="boolean"?W.collapsible:V.collapsible;let G;return typeof W.collapsed>"u"||W.collapsed===ObjectTreeElementCollapseState.PreserveOrCollapsed||W.collapsed===ObjectTreeElementCollapseState.PreserveOrExpanded?G=V.collapsed:W.collapsed===ObjectTreeElementCollapseState.Collapsed?G=!0:W.collapsed===ObjectTreeElementCollapseState.Expanded?G=!1:G=!!W.collapsed,Object.assign(Object.assign({},W),{collapsible:U,collapsed:G,children:this.preserveCollapseState(W.children)})})}rerender(C){const W=this.getElementLocation(C);this.model.rerender(W)}getFirstElementChild(C=null){const W=this.getElementLocation(C);return this.model.getFirstElementChild(W)}has(C){return this.nodes.has(C)}getListIndex(C){const W=this.getElementLocation(C);return this.model.getListIndex(W)}getListRenderCount(C){const W=this.getElementLocation(C);return this.model.getListRenderCount(W)}isCollapsible(C){const W=this.getElementLocation(C);return this.model.isCollapsible(W)}setCollapsible(C,W){const V=this.getElementLocation(C);return this.model.setCollapsible(V,W)}isCollapsed(C){const W=this.getElementLocation(C);return this.model.isCollapsed(W)}setCollapsed(C,W,V){const U=this.getElementLocation(C);return this.model.setCollapsed(U,W,V)}expandTo(C){const W=this.getElementLocation(C);this.model.expandTo(W)}refilter(){this.model.refilter()}getNode(C=null){if(C===null)return this.model.getNode(this.model.rootRef);const W=this.nodes.get(C);if(!W)throw new TreeError(this.user,`Tree element not found: ${C}`);return W}getNodeLocation(C){return C.element}getParentNodeLocation(C){if(C===null)throw new TreeError(this.user,"Invalid getParentNodeLocation call");const W=this.nodes.get(C);if(!W)throw new TreeError(this.user,`Tree element not found: ${C}`);const V=this.model.getNodeLocation(W),U=this.model.getParentNodeLocation(V);return this.model.getNode(U).element}getElementLocation(C){if(C===null)return[];const W=this.nodes.get(C);if(!W)throw new TreeError(this.user,`Tree element not found: ${C}`);return this.model.getNodeLocation(W)}}function noCompress(K){const C=[K.element],W=K.incompressible||!1;return{element:{elements:C,incompressible:W},children:Iterable.map(Iterable.from(K.children),noCompress),collapsible:K.collapsible,collapsed:K.collapsed}}function compress(K){const C=[K.element],W=K.incompressible||!1;let V,U;for(;[U,V]=Iterable.consume(Iterable.from(K.children),2),!(U.length!==1||U[0].incompressible);)K=U[0],C.push(K.element);return{element:{elements:C,incompressible:W},children:Iterable.map(Iterable.concat(U,V),compress),collapsible:K.collapsible,collapsed:K.collapsed}}function _decompress(K,C=0){let W;return C<K.element.elements.length-1?W=[_decompress(K,C+1)]:W=Iterable.map(Iterable.from(K.children),V=>_decompress(V,0)),C===0&&K.element.incompressible?{element:K.element.elements[C],children:W,incompressible:!0,collapsible:K.collapsible,collapsed:K.collapsed}:{element:K.element.elements[C],children:W,collapsible:K.collapsible,collapsed:K.collapsed}}function decompress(K){return _decompress(K,0)}function splice(K,C,W){return K.element===C?Object.assign(Object.assign({},K),{children:W}):Object.assign(Object.assign({},K),{children:Iterable.map(Iterable.from(K.children),V=>splice(V,C,W))})}const wrapIdentityProvider=K=>({getId(C){return C.elements.map(W=>K.getId(W).toString()).join("\0")}});class CompressedObjectTreeModel{get onDidSplice(){return this.model.onDidSplice}get onDidChangeCollapseState(){return this.model.onDidChangeCollapseState}get onDidChangeRenderNodeCount(){return this.model.onDidChangeRenderNodeCount}constructor(C,W,V={}){this.user=C,this.rootRef=null,this.nodes=new Map,this.model=new ObjectTreeModel(C,W,V),this.enabled=typeof V.compressionEnabled>"u"?!0:V.compressionEnabled,this.identityProvider=V.identityProvider}setChildren(C,W=Iterable.empty(),V){const U=V.diffIdentityProvider&&wrapIdentityProvider(V.diffIdentityProvider);if(C===null){const oe=Iterable.map(W,this.enabled?compress:noCompress);this._setChildren(null,oe,{diffIdentityProvider:U,diffDepth:1/0});return}const G=this.nodes.get(C);if(!G)throw new TreeError(this.user,"Unknown compressed tree node");const Z=this.model.getNode(G),X=this.model.getParentNodeLocation(G),Q=this.model.getNode(X),J=decompress(Z),ee=splice(J,C,W),te=(this.enabled?compress:noCompress)(ee),ie=V.diffIdentityProvider?(oe,re)=>V.diffIdentityProvider.getId(oe)===V.diffIdentityProvider.getId(re):void 0;if(equals$5(te.element.elements,Z.element.elements,ie)){this._setChildren(G,te.children||Iterable.empty(),{diffIdentityProvider:U,diffDepth:1});return}const ne=Q.children.map(oe=>oe===Z?te:oe);this._setChildren(Q.element,ne,{diffIdentityProvider:U,diffDepth:Z.depth-Q.depth})}setCompressionEnabled(C){if(C===this.enabled)return;this.enabled=C;const V=this.model.getNode().children,U=Iterable.map(V,decompress),G=Iterable.map(U,C?compress:noCompress);this._setChildren(null,G,{diffIdentityProvider:this.identityProvider,diffDepth:1/0})}_setChildren(C,W,V){const U=new Set,G=X=>{for(const Q of X.element.elements)U.add(Q),this.nodes.set(Q,X.element)},Z=X=>{for(const Q of X.element.elements)U.has(Q)||this.nodes.delete(Q)};this.model.setChildren(C,W,Object.assign(Object.assign({},V),{onDidCreateNode:G,onDidDeleteNode:Z}))}has(C){return this.nodes.has(C)}getListIndex(C){const W=this.getCompressedNode(C);return this.model.getListIndex(W)}getListRenderCount(C){const W=this.getCompressedNode(C);return this.model.getListRenderCount(W)}getNode(C){if(typeof C>"u")return this.model.getNode();const W=this.getCompressedNode(C);return this.model.getNode(W)}getNodeLocation(C){const W=this.model.getNodeLocation(C);return W===null?null:W.elements[W.elements.length-1]}getParentNodeLocation(C){const W=this.getCompressedNode(C),V=this.model.getParentNodeLocation(W);return V===null?null:V.elements[V.elements.length-1]}getFirstElementChild(C){const W=this.getCompressedNode(C);return this.model.getFirstElementChild(W)}isCollapsible(C){const W=this.getCompressedNode(C);return this.model.isCollapsible(W)}setCollapsible(C,W){const V=this.getCompressedNode(C);return this.model.setCollapsible(V,W)}isCollapsed(C){const W=this.getCompressedNode(C);return this.model.isCollapsed(W)}setCollapsed(C,W,V){const U=this.getCompressedNode(C);return this.model.setCollapsed(U,W,V)}expandTo(C){const W=this.getCompressedNode(C);this.model.expandTo(W)}rerender(C){const W=this.getCompressedNode(C);this.model.rerender(W)}refilter(){this.model.refilter()}getCompressedNode(C){if(C===null)return null;const W=this.nodes.get(C);if(!W)throw new TreeError(this.user,`Tree element not found: ${C}`);return W}}const DefaultElementMapper=K=>K[K.length-1];class CompressedTreeNodeWrapper{get element(){return this.node.element===null?null:this.unwrapper(this.node.element)}get children(){return this.node.children.map(C=>new CompressedTreeNodeWrapper(this.unwrapper,C))}get depth(){return this.node.depth}get visibleChildrenCount(){return this.node.visibleChildrenCount}get visibleChildIndex(){return this.node.visibleChildIndex}get collapsible(){return this.node.collapsible}get collapsed(){return this.node.collapsed}get visible(){return this.node.visible}get filterData(){return this.node.filterData}constructor(C,W){this.unwrapper=C,this.node=W}}function mapList(K,C){return{splice(W,V,U){C.splice(W,V,U.map(G=>K.map(G)))},updateElementHeight(W,V){C.updateElementHeight(W,V)}}}function mapOptions(K,C){return Object.assign(Object.assign({},C),{identityProvider:C.identityProvider&&{getId(W){return C.identityProvider.getId(K(W))}},sorter:C.sorter&&{compare(W,V){return C.sorter.compare(W.elements[0],V.elements[0])}},filter:C.filter&&{filter(W,V){return C.filter.filter(K(W),V)}}})}class CompressibleObjectTreeModel{get onDidSplice(){return Event$1.map(this.model.onDidSplice,({insertedNodes:C,deletedNodes:W})=>({insertedNodes:C.map(V=>this.nodeMapper.map(V)),deletedNodes:W.map(V=>this.nodeMapper.map(V))}))}get onDidChangeCollapseState(){return Event$1.map(this.model.onDidChangeCollapseState,({node:C,deep:W})=>({node:this.nodeMapper.map(C),deep:W}))}get onDidChangeRenderNodeCount(){return Event$1.map(this.model.onDidChangeRenderNodeCount,C=>this.nodeMapper.map(C))}constructor(C,W,V={}){this.rootRef=null,this.elementMapper=V.elementMapper||DefaultElementMapper;const U=G=>this.elementMapper(G.elements);this.nodeMapper=new WeakMapper(G=>new CompressedTreeNodeWrapper(U,G)),this.model=new CompressedObjectTreeModel(C,mapList(this.nodeMapper,W),mapOptions(U,V))}setChildren(C,W=Iterable.empty(),V={}){this.model.setChildren(C,W,V)}setCompressionEnabled(C){this.model.setCompressionEnabled(C)}has(C){return this.model.has(C)}getListIndex(C){return this.model.getListIndex(C)}getListRenderCount(C){return this.model.getListRenderCount(C)}getNode(C){return this.nodeMapper.map(this.model.getNode(C))}getNodeLocation(C){return C.element}getParentNodeLocation(C){return this.model.getParentNodeLocation(C)}getFirstElementChild(C){const W=this.model.getFirstElementChild(C);return W===null||typeof W>"u"?W:this.elementMapper(W.elements)}isCollapsible(C){return this.model.isCollapsible(C)}setCollapsible(C,W){return this.model.setCollapsible(C,W)}isCollapsed(C){return this.model.isCollapsed(C)}setCollapsed(C,W,V){return this.model.setCollapsed(C,W,V)}expandTo(C){return this.model.expandTo(C)}rerender(C){return this.model.rerender(C)}refilter(){return this.model.refilter()}getCompressedTreeNode(C=null){return this.model.getNode(C)}}var __decorate$1L=globalThis&&globalThis.__decorate||function(K,C,W,V){var U=arguments.length,G=U<3?C:V===null?V=Object.getOwnPropertyDescriptor(C,W):V,Z;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")G=Reflect.decorate(K,C,W,V);else for(var X=K.length-1;X>=0;X--)(Z=K[X])&&(G=(U<3?Z(G):U>3?Z(C,W,G):Z(C,W))||G);return U>3&&G&&Object.defineProperty(C,W,G),G};class ObjectTree extends AbstractTree{get onDidChangeCollapseState(){return this.model.onDidChangeCollapseState}constructor(C,W,V,U,G={}){super(C,W,V,U,G),this.user=C}setChildren(C,W=Iterable.empty(),V){this.model.setChildren(C,W,V)}rerender(C){if(C===void 0){this.view.rerender();return}this.model.rerender(C)}hasElement(C){return this.model.has(C)}createModel(C,W,V){return new ObjectTreeModel(C,W,V)}}class CompressibleRenderer{get compressedTreeNodeProvider(){return this._compressedTreeNodeProvider()}constructor(C,W){this._compressedTreeNodeProvider=C,this.renderer=W,this.templateId=W.templateId,W.onDidChangeTwistieState&&(this.onDidChangeTwistieState=W.onDidChangeTwistieState)}renderTemplate(C){return{compressedTreeNode:void 0,data:this.renderer.renderTemplate(C)}}renderElement(C,W,V,U){const G=this.compressedTreeNodeProvider.getCompressedTreeNode(C.element);G.element.elements.length===1?(V.compressedTreeNode=void 0,this.renderer.renderElement(C,W,V.data,U)):(V.compressedTreeNode=G,this.renderer.renderCompressedElements(G,W,V.data,U))}disposeElement(C,W,V,U){var G,Z,X,Q;V.compressedTreeNode?(Z=(G=this.renderer).disposeCompressedElements)===null||Z===void 0||Z.call(G,V.compressedTreeNode,W,V.data,U):(Q=(X=this.renderer).disposeElement)===null||Q===void 0||Q.call(X,C,W,V.data,U)}disposeTemplate(C){this.renderer.disposeTemplate(C.data)}renderTwistie(C,W){return this.renderer.renderTwistie?this.renderer.renderTwistie(C,W):!1}}__decorate$1L([memoize],CompressibleRenderer.prototype,"compressedTreeNodeProvider",null);function asObjectTreeOptions$1(K,C){return C&&Object.assign(Object.assign({},C),{keyboardNavigationLabelProvider:C.keyboardNavigationLabelProvider&&{getKeyboardNavigationLabel(W){let V;try{V=K().getCompressedTreeNode(W)}catch{return C.keyboardNavigationLabelProvider.getKeyboardNavigationLabel(W)}return V.element.elements.length===1?C.keyboardNavigationLabelProvider.getKeyboardNavigationLabel(W):C.keyboardNavigationLabelProvider.getCompressedNodeKeyboardNavigationLabel(V.element.elements)}}})}class CompressibleObjectTree extends ObjectTree{constructor(C,W,V,U,G={}){const Z=()=>this,X=U.map(Q=>new CompressibleRenderer(Z,Q));super(C,W,V,X,asObjectTreeOptions$1(Z,G))}setChildren(C,W=Iterable.empty(),V){this.model.setChildren(C,W,V)}createModel(C,W,V){return new CompressibleObjectTreeModel(C,W,V)}updateOptions(C={}){super.updateOptions(C),typeof C.compressionEnabled<"u"&&this.model.setCompressionEnabled(C.compressionEnabled)}getCompressedTreeNode(C=null){return this.model.getCompressedTreeNode(C)}}var __awaiter$1j=globalThis&&globalThis.__awaiter||function(K,C,W,V){function U(G){return G instanceof W?G:new W(function(Z){Z(G)})}return new(W||(W=Promise))(function(G,Z){function X(ee){try{J(V.next(ee))}catch(te){Z(te)}}function Q(ee){try{J(V.throw(ee))}catch(te){Z(te)}}function J(ee){ee.done?G(ee.value):U(ee.value).then(X,Q)}J((V=V.apply(K,C||[])).next())})};function createAsyncDataTreeNode(K){return Object.assign(Object.assign({},K),{children:[],refreshPromise:void 0,stale:!0,slow:!1,collapsedByDefault:void 0})}function isAncestor(K,C){return C.parent?C.parent===K?!0:isAncestor(K,C.parent):!1}function intersects(K,C){return K===C||isAncestor(K,C)||isAncestor(C,K)}class AsyncDataTreeNodeWrapper{get element(){return this.node.element.element}get children(){return this.node.children.map(C=>new AsyncDataTreeNodeWrapper(C))}get depth(){return this.node.depth}get visibleChildrenCount(){return this.node.visibleChildrenCount}get visibleChildIndex(){return this.node.visibleChildIndex}get collapsible(){return this.node.collapsible}get collapsed(){return this.node.collapsed}get visible(){return this.node.visible}get filterData(){return this.node.filterData}constructor(C){this.node=C}}class AsyncDataTreeRenderer{constructor(C,W,V){this.renderer=C,this.nodeMapper=W,this.onDidChangeTwistieState=V,this.renderedNodes=new Map,this.templateId=C.templateId}renderTemplate(C){return{templateData:this.renderer.renderTemplate(C)}}renderElement(C,W,V,U){this.renderer.renderElement(this.nodeMapper.map(C),W,V.templateData,U)}renderTwistie(C,W){return C.slow?(W.classList.add(...ThemeIcon.asClassNameArray(Codicon.treeItemLoading)),!0):(W.classList.remove(...ThemeIcon.asClassNameArray(Codicon.treeItemLoading)),!1)}disposeElement(C,W,V,U){var G,Z;(Z=(G=this.renderer).disposeElement)===null||Z===void 0||Z.call(G,this.nodeMapper.map(C),W,V.templateData,U)}disposeTemplate(C){this.renderer.disposeTemplate(C.templateData)}dispose(){this.renderedNodes.clear()}}function asTreeEvent(K){return{browserEvent:K.browserEvent,elements:K.elements.map(C=>C.element)}}function asTreeMouseEvent(K){return{browserEvent:K.browserEvent,element:K.element&&K.element.element,target:K.target}}class AsyncDataTreeElementsDragAndDropData extends ElementsDragAndDropData{constructor(C){super(C.elements.map(W=>W.element)),this.data=C}}function asAsyncDataTreeDragAndDropData(K){return K instanceof ElementsDragAndDropData?new AsyncDataTreeElementsDragAndDropData(K):K}class AsyncDataTreeNodeListDragAndDrop{constructor(C){this.dnd=C}getDragURI(C){return this.dnd.getDragURI(C.element)}getDragLabel(C,W){if(this.dnd.getDragLabel)return this.dnd.getDragLabel(C.map(V=>V.element),W)}onDragStart(C,W){var V,U;(U=(V=this.dnd).onDragStart)===null||U===void 0||U.call(V,asAsyncDataTreeDragAndDropData(C),W)}onDragOver(C,W,V,U,G=!0){return this.dnd.onDragOver(asAsyncDataTreeDragAndDropData(C),W&&W.element,V,U)}drop(C,W,V,U){this.dnd.drop(asAsyncDataTreeDragAndDropData(C),W&&W.element,V,U)}onDragEnd(C){var W,V;(V=(W=this.dnd).onDragEnd)===null||V===void 0||V.call(W,C)}dispose(){this.dnd.dispose()}}function asObjectTreeOptions(K){return K&&Object.assign(Object.assign({},K),{collapseByDefault:!0,identityProvider:K.identityProvider&&{getId(C){return K.identityProvider.getId(C.element)}},dnd:K.dnd&&new AsyncDataTreeNodeListDragAndDrop(K.dnd),multipleSelectionController:K.multipleSelectionController&&{isSelectionSingleChangeEvent(C){return K.multipleSelectionController.isSelectionSingleChangeEvent(Object.assign(Object.assign({},C),{element:C.element}))},isSelectionRangeChangeEvent(C){return K.multipleSelectionController.isSelectionRangeChangeEvent(Object.assign(Object.assign({},C),{element:C.element}))}},accessibilityProvider:K.accessibilityProvider&&Object.assign(Object.assign({},K.accessibilityProvider),{getPosInSet:void 0,getSetSize:void 0,getRole:K.accessibilityProvider.getRole?C=>K.accessibilityProvider.getRole(C.element):()=>"treeitem",isChecked:K.accessibilityProvider.isChecked?C=>{var W;return!!(!((W=K.accessibilityProvider)===null||W===void 0)&&W.isChecked(C.element))}:void 0,getAriaLabel(C){return K.accessibilityProvider.getAriaLabel(C.element)},getWidgetAriaLabel(){return K.accessibilityProvider.getWidgetAriaLabel()},getWidgetRole:K.accessibilityProvider.getWidgetRole?()=>K.accessibilityProvider.getWidgetRole():()=>"tree",getAriaLevel:K.accessibilityProvider.getAriaLevel&&(C=>K.accessibilityProvider.getAriaLevel(C.element)),getActiveDescendantId:K.accessibilityProvider.getActiveDescendantId&&(C=>K.accessibilityProvider.getActiveDescendantId(C.element))}),filter:K.filter&&{filter(C,W){return K.filter.filter(C.element,W)}},keyboardNavigationLabelProvider:K.keyboardNavigationLabelProvider&&Object.assign(Object.assign({},K.keyboardNavigationLabelProvider),{getKeyboardNavigationLabel(C){return K.keyboardNavigationLabelProvider.getKeyboardNavigationLabel(C.element)}}),sorter:void 0,expandOnlyOnTwistieClick:typeof K.expandOnlyOnTwistieClick>"u"?void 0:typeof K.expandOnlyOnTwistieClick!="function"?K.expandOnlyOnTwistieClick:C=>K.expandOnlyOnTwistieClick(C.element),defaultFindVisibility:C=>C.hasChildren&&C.stale?1:typeof K.defaultFindVisibility=="number"?K.defaultFindVisibility:typeof K.defaultFindVisibility>"u"?2:K.defaultFindVisibility(C.element)})}function dfs(K,C){C(K),K.children.forEach(W=>dfs(W,C))}class AsyncDataTree{get onDidScroll(){return this.tree.onDidScroll}get onDidChangeFocus(){return Event$1.map(this.tree.onDidChangeFocus,asTreeEvent)}get onDidChangeSelection(){return Event$1.map(this.tree.onDidChangeSelection,asTreeEvent)}get onMouseDblClick(){return Event$1.map(this.tree.onMouseDblClick,asTreeMouseEvent)}get onPointer(){return Event$1.map(this.tree.onPointer,asTreeMouseEvent)}get onDidFocus(){return this.tree.onDidFocus}get onDidChangeModel(){return this.tree.onDidChangeModel}get onDidChangeCollapseState(){return this.tree.onDidChangeCollapseState}get onDidChangeFindOpenState(){return this.tree.onDidChangeFindOpenState}get onDidDispose(){return this.tree.onDidDispose}constructor(C,W,V,U,G,Z={}){this.user=C,this.dataSource=G,this.nodes=new Map,this.subTreeRefreshPromises=new Map,this.refreshPromises=new Map,this._onDidRender=new Emitter$1,this._onDidChangeNodeSlowState=new Emitter$1,this.nodeMapper=new WeakMapper(X=>new AsyncDataTreeNodeWrapper(X)),this.disposables=new DisposableStore,this.identityProvider=Z.identityProvider,this.autoExpandSingleChildren=typeof Z.autoExpandSingleChildren>"u"?!1:Z.autoExpandSingleChildren,this.sorter=Z.sorter,this.collapseByDefault=Z.collapseByDefault,this.tree=this.createTree(C,W,V,U,Z),this.onDidChangeFindMode=this.tree.onDidChangeFindMode,this.root=createAsyncDataTreeNode({element:void 0,parent:null,hasChildren:!0}),this.identityProvider&&(this.root=Object.assign(Object.assign({},this.root),{id:null})),this.nodes.set(null,this.root),this.tree.onDidChangeCollapseState(this._onDidChangeCollapseState,this,this.disposables)}createTree(C,W,V,U,G){const Z=new ComposedTreeDelegate(V),X=U.map(J=>new AsyncDataTreeRenderer(J,this.nodeMapper,this._onDidChangeNodeSlowState.event)),Q=asObjectTreeOptions(G)||{};return new ObjectTree(C,W,Z,X,Q)}updateOptions(C={}){this.tree.updateOptions(C)}getHTMLElement(){return this.tree.getHTMLElement()}get scrollTop(){return this.tree.scrollTop}set scrollTop(C){this.tree.scrollTop=C}get scrollHeight(){return this.tree.scrollHeight}get renderHeight(){return this.tree.renderHeight}domFocus(){this.tree.domFocus()}layout(C,W){this.tree.layout(C,W)}style(C){this.tree.style(C)}getInput(){return this.root.element}setInput(C,W){return __awaiter$1j(this,void 0,void 0,function*(){this.refreshPromises.forEach(U=>U.cancel()),this.refreshPromises.clear(),this.root.element=C;const V=W&&{viewState:W,focus:[],selection:[]};yield this._updateChildren(C,!0,!1,V),V&&(this.tree.setFocus(V.focus),this.tree.setSelection(V.selection)),W&&typeof W.scrollTop=="number"&&(this.scrollTop=W.scrollTop)})}_updateChildren(C=this.root.element,W=!0,V=!1,U,G){return __awaiter$1j(this,void 0,void 0,function*(){if(typeof this.root.element>"u")throw new TreeError(this.user,"Tree input not set");this.root.refreshPromise&&(yield this.root.refreshPromise,yield Event$1.toPromise(this._onDidRender.event));const Z=this.getDataNode(C);if(yield this.refreshAndRenderNode(Z,W,U,G),V)try{this.tree.rerender(Z)}catch{}})}rerender(C){if(C===void 0||C===this.root.element){this.tree.rerender();return}const W=this.getDataNode(C);this.tree.rerender(W)}getNode(C=this.root.element){const W=this.getDataNode(C),V=this.tree.getNode(W===this.root?null:W);return this.nodeMapper.map(V)}collapse(C,W=!1){const V=this.getDataNode(C);return this.tree.collapse(V===this.root?null:V,W)}expand(C,W=!1){return __awaiter$1j(this,void 0,void 0,function*(){if(typeof this.root.element>"u")throw new TreeError(this.user,"Tree input not set");this.root.refreshPromise&&(yield this.root.refreshPromise,yield Event$1.toPromise(this._onDidRender.event));const V=this.getDataNode(C);if(this.tree.hasElement(V)&&!this.tree.isCollapsible(V)||(V.refreshPromise&&(yield this.root.refreshPromise,yield Event$1.toPromise(this._onDidRender.event)),V!==this.root&&!V.refreshPromise&&!this.tree.isCollapsed(V)))return!1;const U=this.tree.expand(V===this.root?null:V,W);return V.refreshPromise&&(yield this.root.refreshPromise,yield Event$1.toPromise(this._onDidRender.event)),U})}setSelection(C,W){const V=C.map(U=>this.getDataNode(U));this.tree.setSelection(V,W)}getSelection(){return this.tree.getSelection().map(W=>W.element)}setFocus(C,W){const V=C.map(U=>this.getDataNode(U));this.tree.setFocus(V,W)}getFocus(){return this.tree.getFocus().map(W=>W.element)}reveal(C,W){this.tree.reveal(this.getDataNode(C),W)}getParentElement(C){const W=this.tree.getParentElement(this.getDataNode(C));return W&&W.element}getFirstElementChild(C=this.root.element){const W=this.getDataNode(C),V=this.tree.getFirstElementChild(W===this.root?null:W);return V&&V.element}getDataNode(C){const W=this.nodes.get(C===this.root.element?null:C);if(!W)throw new TreeError(this.user,`Data tree node not found: ${C}`);return W}refreshAndRenderNode(C,W,V,U){return __awaiter$1j(this,void 0,void 0,function*(){yield this.refreshNode(C,W,V),this.render(C,V,U)})}refreshNode(C,W,V){return __awaiter$1j(this,void 0,void 0,function*(){let U;if(this.subTreeRefreshPromises.forEach((G,Z)=>{!U&&intersects(Z,C)&&(U=G.then(()=>this.refreshNode(C,W,V)))}),U)return U;if(C!==this.root&&this.tree.getNode(C).collapsed){C.hasChildren=!!this.dataSource.hasChildren(C.element),C.stale=!0;return}return this.doRefreshSubTree(C,W,V)})}doRefreshSubTree(C,W,V){return __awaiter$1j(this,void 0,void 0,function*(){let U;C.refreshPromise=new Promise(G=>U=G),this.subTreeRefreshPromises.set(C,C.refreshPromise),C.refreshPromise.finally(()=>{C.refreshPromise=void 0,this.subTreeRefreshPromises.delete(C)});try{const G=yield this.doRefreshNode(C,W,V);C.stale=!1,yield Promises.settled(G.map(Z=>this.doRefreshSubTree(Z,W,V)))}finally{U()}})}doRefreshNode(C,W,V){return __awaiter$1j(this,void 0,void 0,function*(){C.hasChildren=!!this.dataSource.hasChildren(C.element);let U;if(!C.hasChildren)U=Promise.resolve(Iterable.empty());else{const G=this.doGetChildren(C);if(isIterable$2(G))U=Promise.resolve(G);else{const Z=timeout(800);Z.then(()=>{C.slow=!0,this._onDidChangeNodeSlowState.fire(C)},X=>null),U=G.finally(()=>Z.cancel())}}try{const G=yield U;return this.setChildren(C,G,W,V)}catch(G){if(C!==this.root&&this.tree.hasElement(C)&&this.tree.collapse(C),isCancellationError(G))return[];throw G}finally{C.slow&&(C.slow=!1,this._onDidChangeNodeSlowState.fire(C))}})}doGetChildren(C){let W=this.refreshPromises.get(C);if(W)return W;const V=this.dataSource.getChildren(C.element);return isIterable$2(V)?this.processChildren(V):(W=createCancelablePromise(()=>__awaiter$1j(this,void 0,void 0,function*(){return this.processChildren(yield V)})),this.refreshPromises.set(C,W),W.finally(()=>{this.refreshPromises.delete(C)}))}_onDidChangeCollapseState({node:C,deep:W}){C.element!==null&&!C.collapsed&&C.element.stale&&(W?this.collapse(C.element.element):this.refreshAndRenderNode(C.element,!1).catch(onUnexpectedError))}setChildren(C,W,V,U){const G=[...W];if(C.children.length===0&&G.length===0)return[];const Z=new Map,X=new Map;for(const ee of C.children)if(Z.set(ee.element,ee),this.identityProvider){const te=this.tree.isCollapsed(ee);X.set(ee.id,{node:ee,collapsed:te})}const Q=[],J=G.map(ee=>{const te=!!this.dataSource.hasChildren(ee);if(!this.identityProvider){const re=createAsyncDataTreeNode({element:ee,parent:C,hasChildren:te});return te&&this.collapseByDefault&&!this.collapseByDefault(ee)&&(re.collapsedByDefault=!1,Q.push(re)),re}const ie=this.identityProvider.getId(ee).toString(),ne=X.get(ie);if(ne){const re=ne.node;return Z.delete(re.element),this.nodes.delete(re.element),this.nodes.set(ee,re),re.element=ee,re.hasChildren=te,V?ne.collapsed?(re.children.forEach(ae=>dfs(ae,se=>this.nodes.delete(se.element))),re.children.splice(0,re.children.length),re.stale=!0):Q.push(re):te&&this.collapseByDefault&&!this.collapseByDefault(ee)&&(re.collapsedByDefault=!1,Q.push(re)),re}const oe=createAsyncDataTreeNode({element:ee,parent:C,id:ie,hasChildren:te});return U&&U.viewState.focus&&U.viewState.focus.indexOf(ie)>-1&&U.focus.push(oe),U&&U.viewState.selection&&U.viewState.selection.indexOf(ie)>-1&&U.selection.push(oe),U&&U.viewState.expanded&&U.viewState.expanded.indexOf(ie)>-1?Q.push(oe):te&&this.collapseByDefault&&!this.collapseByDefault(ee)&&(oe.collapsedByDefault=!1,Q.push(oe)),oe});for(const ee of Z.values())dfs(ee,te=>this.nodes.delete(te.element));for(const ee of J)this.nodes.set(ee.element,ee);return C.children.splice(0,C.children.length,...J),C!==this.root&&this.autoExpandSingleChildren&&J.length===1&&Q.length===0&&(J[0].collapsedByDefault=!1,Q.push(J[0])),Q}render(C,W,V){const U=C.children.map(Z=>this.asTreeElement(Z,W)),G=V&&Object.assign(Object.assign({},V),{diffIdentityProvider:V.diffIdentityProvider&&{getId(Z){return V.diffIdentityProvider.getId(Z.element)}}});this.tree.setChildren(C===this.root?null:C,U,G),C!==this.root&&this.tree.setCollapsible(C,C.hasChildren),this._onDidRender.fire()}asTreeElement(C,W){if(C.stale)return{element:C,collapsible:C.hasChildren,collapsed:!0};let V;return W&&W.viewState.expanded&&C.id&&W.viewState.expanded.indexOf(C.id)>-1?V=!1:V=C.collapsedByDefault,C.collapsedByDefault=void 0,{element:C,children:C.hasChildren?Iterable.map(C.children,U=>this.asTreeElement(U,W)):[],collapsible:C.hasChildren,collapsed:V}}processChildren(C){return this.sorter&&(C=[...C].sort(this.sorter.compare.bind(this.sorter))),C}dispose(){this.disposables.dispose(),this.tree.dispose()}}class CompressibleAsyncDataTreeNodeWrapper{get element(){return{elements:this.node.element.elements.map(C=>C.element),incompressible:this.node.element.incompressible}}get children(){return this.node.children.map(C=>new CompressibleAsyncDataTreeNodeWrapper(C))}get depth(){return this.node.depth}get visibleChildrenCount(){return this.node.visibleChildrenCount}get visibleChildIndex(){return this.node.visibleChildIndex}get collapsible(){return this.node.collapsible}get collapsed(){return this.node.collapsed}get visible(){return this.node.visible}get filterData(){return this.node.filterData}constructor(C){this.node=C}}class CompressibleAsyncDataTreeRenderer{constructor(C,W,V,U){this.renderer=C,this.nodeMapper=W,this.compressibleNodeMapperProvider=V,this.onDidChangeTwistieState=U,this.renderedNodes=new Map,this.disposables=[],this.templateId=C.templateId}renderTemplate(C){return{templateData:this.renderer.renderTemplate(C)}}renderElement(C,W,V,U){this.renderer.renderElement(this.nodeMapper.map(C),W,V.templateData,U)}renderCompressedElements(C,W,V,U){this.renderer.renderCompressedElements(this.compressibleNodeMapperProvider().map(C),W,V.templateData,U)}renderTwistie(C,W){return C.slow?(W.classList.add(...ThemeIcon.asClassNameArray(Codicon.treeItemLoading)),!0):(W.classList.remove(...ThemeIcon.asClassNameArray(Codicon.treeItemLoading)),!1)}disposeElement(C,W,V,U){var G,Z;(Z=(G=this.renderer).disposeElement)===null||Z===void 0||Z.call(G,this.nodeMapper.map(C),W,V.templateData,U)}disposeCompressedElements(C,W,V,U){var G,Z;(Z=(G=this.renderer).disposeCompressedElements)===null||Z===void 0||Z.call(G,this.compressibleNodeMapperProvider().map(C),W,V.templateData,U)}disposeTemplate(C){this.renderer.disposeTemplate(C.templateData)}dispose(){this.renderedNodes.clear(),this.disposables=dispose(this.disposables)}}function asCompressibleObjectTreeOptions(K){const C=K&&asObjectTreeOptions(K);return C&&Object.assign(Object.assign({},C),{keyboardNavigationLabelProvider:C.keyboardNavigationLabelProvider&&Object.assign(Object.assign({},C.keyboardNavigationLabelProvider),{getCompressedNodeKeyboardNavigationLabel(W){return K.keyboardNavigationLabelProvider.getCompressedNodeKeyboardNavigationLabel(W.map(V=>V.element))}})})}class CompressibleAsyncDataTree extends AsyncDataTree{constructor(C,W,V,U,G,Z,X={}){super(C,W,V,G,Z,X),this.compressionDelegate=U,this.compressibleNodeMapper=new WeakMapper(Q=>new CompressibleAsyncDataTreeNodeWrapper(Q)),this.filter=X.filter}createTree(C,W,V,U,G){const Z=new ComposedTreeDelegate(V),X=U.map(J=>new CompressibleAsyncDataTreeRenderer(J,this.nodeMapper,()=>this.compressibleNodeMapper,this._onDidChangeNodeSlowState.event)),Q=asCompressibleObjectTreeOptions(G)||{};return new CompressibleObjectTree(C,W,Z,X,Q)}asTreeElement(C,W){return Object.assign({incompressible:this.compressionDelegate.isIncompressible(C.element)},super.asTreeElement(C,W))}updateOptions(C={}){this.tree.updateOptions(C)}render(C,W){if(!this.identityProvider)return super.render(C,W);const V=ie=>this.identityProvider.getId(ie).toString(),U=ie=>{const ne=new Set;for(const oe of ie){const re=this.tree.getCompressedTreeNode(oe===this.root?null:oe);if(re.element)for(const ae of re.element.elements)ne.add(V(ae.element))}return ne},G=U(this.tree.getSelection()),Z=U(this.tree.getFocus());super.render(C,W);const X=this.getSelection();let Q=!1;const J=this.getFocus();let ee=!1;const te=ie=>{const ne=ie.element;if(ne)for(let oe=0;oe<ne.elements.length;oe++){const re=V(ne.elements[oe].element),ae=ne.elements[ne.elements.length-1].element;G.has(re)&&X.indexOf(ae)===-1&&(X.push(ae),Q=!0),Z.has(re)&&J.indexOf(ae)===-1&&(J.push(ae),ee=!0)}ie.children.forEach(te)};te(this.tree.getCompressedTreeNode(C===this.root?null:C)),Q&&this.setSelection(X),ee&&this.setFocus(J)}processChildren(C){return this.filter&&(C=Iterable.filter(C,W=>{const V=this.filter.filter(W,1),U=getVisibility(V);if(U===2)throw new Error("Recursive tree visibility not supported in async data compressed trees");return U===1})),super.processChildren(C)}}function getVisibility(K){return typeof K=="boolean"?K?1:0:isFilterResult(K)?getVisibleState(K.visibility):getVisibleState(K)}class DataTree extends AbstractTree{constructor(C,W,V,U,G,Z={}){super(C,W,V,U,Z),this.user=C,this.dataSource=G,this.identityProvider=Z.identityProvider}createModel(C,W,V){return new ObjectTreeModel(C,W,V)}}new RawContextKey("isMac",isMacintosh,localize("isMac","Whether the operating system is macOS"));new RawContextKey("isLinux",isLinux,localize("isLinux","Whether the operating system is Linux"));const IsWindowsContext=new RawContextKey("isWindows",isWindows,localize("isWindows","Whether the operating system is Windows")),IsWebContext=new RawContextKey("isWeb",isWeb,localize("isWeb","Whether the platform is a web browser"));new RawContextKey("isMacNative",isMacintosh&&!isWeb,localize("isMacNative","Whether the operating system is macOS on a non-browser platform"));new RawContextKey("isIOS",isIOS,localize("isIOS","Whether the operating system is iOS"));new RawContextKey("isMobile",isMobile,localize("isMobile","Whether the platform is a mobile web browser"));new RawContextKey("isDevelopment",!1,!0);new RawContextKey("productQualityType","",localize("productQualityType","Quality type of VS Code"));const InputFocusedContextKey="inputFocus";new RawContextKey(InputFocusedContextKey,!1,localize("inputFocus","Whether keyboard focus is inside an input box"));var __decorate$1K=globalThis&&globalThis.__decorate||function(K,C,W,V){var U=arguments.length,G=U<3?C:V===null?V=Object.getOwnPropertyDescriptor(C,W):V,Z;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")G=Reflect.decorate(K,C,W,V);else for(var X=K.length-1;X>=0;X--)(Z=K[X])&&(G=(U<3?Z(G):U>3?Z(C,W,G):Z(C,W))||G);return U>3&&G&&Object.defineProperty(C,W,G),G},__param$1I=globalThis&&globalThis.__param||function(K,C){return function(W,V){C(W,V,K)}};const IListService=createDecorator("listService");class ListService{get lastFocusedList(){return this._lastFocusedWidget}constructor(){this.disposables=new DisposableStore,this.lists=[],this._lastFocusedWidget=void 0,this._hasCreatedStyleController=!1}setLastFocusedList(C){var W,V;C!==this._lastFocusedWidget&&((W=this._lastFocusedWidget)===null||W===void 0||W.getHTMLElement().classList.remove("last-focused"),this._lastFocusedWidget=C,(V=this._lastFocusedWidget)===null||V===void 0||V.getHTMLElement().classList.add("last-focused"))}register(C,W){if(this._hasCreatedStyleController||(this._hasCreatedStyleController=!0,new DefaultStyleController(createStyleSheet(),"").style(defaultListStyles)),this.lists.some(U=>U.widget===C))throw new Error("Cannot register the same widget multiple times");const V={widget:C,extraContextKeys:W};return this.lists.push(V),C.getHTMLElement()===document.activeElement&&this.setLastFocusedList(C),combinedDisposable(C.onDidFocus(()=>this.setLastFocusedList(C)),toDisposable(()=>this.lists.splice(this.lists.indexOf(V),1)),C.onDidDispose(()=>{this.lists=this.lists.filter(U=>U!==V),this._lastFocusedWidget===C&&this.setLastFocusedList(void 0)}))}dispose(){this.disposables.dispose()}}const RawWorkbenchListScrollAtBoundaryContextKey=new RawContextKey("listScrollAtBoundary","none");ContextKeyExpr.or(RawWorkbenchListScrollAtBoundaryContextKey.isEqualTo("top"),RawWorkbenchListScrollAtBoundaryContextKey.isEqualTo("both"));ContextKeyExpr.or(RawWorkbenchListScrollAtBoundaryContextKey.isEqualTo("bottom"),RawWorkbenchListScrollAtBoundaryContextKey.isEqualTo("both"));const RawWorkbenchListFocusContextKey=new RawContextKey("listFocus",!0),WorkbenchListSupportsMultiSelectContextKey=new RawContextKey("listSupportsMultiselect",!0),WorkbenchListFocusContextKey=ContextKeyExpr.and(RawWorkbenchListFocusContextKey,ContextKeyExpr.not(InputFocusedContextKey)),WorkbenchListHasSelectionOrFocus=new RawContextKey("listHasSelectionOrFocus",!1),WorkbenchListDoubleSelection=new RawContextKey("listDoubleSelection",!1),WorkbenchListMultiSelection=new RawContextKey("listMultiSelection",!1),WorkbenchListSelectionNavigation=new RawContextKey("listSelectionNavigation",!1),WorkbenchListSupportsFind=new RawContextKey("listSupportsFind",!0),WorkbenchTreeElementCanCollapse=new RawContextKey("treeElementCanCollapse",!1),WorkbenchTreeElementHasParent=new RawContextKey("treeElementHasParent",!1),WorkbenchTreeElementCanExpand=new RawContextKey("treeElementCanExpand",!1),WorkbenchTreeElementHasChild=new RawContextKey("treeElementHasChild",!1),WorkbenchTreeFindOpen=new RawContextKey("treeFindOpen",!1),WorkbenchListTypeNavigationModeKey="listTypeNavigationMode",WorkbenchListAutomaticKeyboardNavigationLegacyKey="listAutomaticKeyboardNavigation";function createScopedContextKeyService(K,C){const W=K.createScoped(C.getHTMLElement());return RawWorkbenchListFocusContextKey.bindTo(W),W}function createScrollObserver(K,C){const W=RawWorkbenchListScrollAtBoundaryContextKey.bindTo(K),V=()=>{const U=C.scrollTop===0,G=C.scrollHeight-C.renderHeight-C.scrollTop<1;U&&G?W.set("both"):U?W.set("top"):G?W.set("bottom"):W.set("none")};return V(),C.onDidScroll(V)}const multiSelectModifierSettingKey="workbench.list.multiSelectModifier",openModeSettingKey="workbench.list.openMode",horizontalScrollingKey="workbench.list.horizontalScrolling",defaultFindModeSettingKey="workbench.list.defaultFindMode",typeNavigationModeSettingKey="workbench.list.typeNavigationMode",keyboardNavigationSettingKey="workbench.list.keyboardNavigation",scrollByPageKey="workbench.list.scrollByPage",defaultFindMatchTypeSettingKey="workbench.list.defaultFindMatchType",treeIndentKey="workbench.tree.indent",treeRenderIndentGuidesKey="workbench.tree.renderIndentGuides",listSmoothScrolling="workbench.list.smoothScrolling",mouseWheelScrollSensitivityKey="workbench.list.mouseWheelScrollSensitivity",fastScrollSensitivityKey="workbench.list.fastScrollSensitivity",treeExpandMode="workbench.tree.expandMode";function useAltAsMultipleSelectionModifier(K){return K.getValue(multiSelectModifierSettingKey)==="alt"}class MultipleSelectionController extends Disposable{constructor(C){super(),this.configurationService=C,this.useAltAsMultipleSelectionModifier=useAltAsMultipleSelectionModifier(C),this.registerListeners()}registerListeners(){this._register(this.configurationService.onDidChangeConfiguration(C=>{C.affectsConfiguration(multiSelectModifierSettingKey)&&(this.useAltAsMultipleSelectionModifier=useAltAsMultipleSelectionModifier(this.configurationService))}))}isSelectionSingleChangeEvent(C){return this.useAltAsMultipleSelectionModifier?C.browserEvent.altKey:isSelectionSingleChangeEvent(C)}isSelectionRangeChangeEvent(C){return isSelectionRangeChangeEvent(C)}}function toWorkbenchListOptions(K,C){var W;const V=K.get(IConfigurationService),U=K.get(IKeybindingService),G=new DisposableStore;return[Object.assign(Object.assign({},C),{keyboardNavigationDelegate:{mightProducePrintableCharacter(X){return U.mightProducePrintableCharacter(X)}},smoothScrolling:!!V.getValue(listSmoothScrolling),mouseWheelScrollSensitivity:V.getValue(mouseWheelScrollSensitivityKey),fastScrollSensitivity:V.getValue(fastScrollSensitivityKey),multipleSelectionController:(W=C.multipleSelectionController)!==null&&W!==void 0?W:G.add(new MultipleSelectionController(V)),keyboardNavigationEventFilter:createKeyboardNavigationEventFilter(U),scrollByPage:!!V.getValue(scrollByPageKey)}),G]}let WorkbenchList=class extends List$1{constructor(C,W,V,U,G,Z,X,Q,J){const ee=typeof G.horizontalScrolling<"u"?G.horizontalScrolling:!!Q.getValue(horizontalScrollingKey),[te,ie]=J.invokeFunction(toWorkbenchListOptions,G);super(C,W,V,U,Object.assign(Object.assign({keyboardSupport:!1},te),{horizontalScrolling:ee})),this.disposables.add(ie),this.contextKeyService=createScopedContextKeyService(Z,this),this.disposables.add(createScrollObserver(this.contextKeyService,this)),this.listSupportsMultiSelect=WorkbenchListSupportsMultiSelectContextKey.bindTo(this.contextKeyService),this.listSupportsMultiSelect.set(G.multipleSelectionSupport!==!1),WorkbenchListSelectionNavigation.bindTo(this.contextKeyService).set(!!G.selectionNavigation),this.listHasSelectionOrFocus=WorkbenchListHasSelectionOrFocus.bindTo(this.contextKeyService),this.listDoubleSelection=WorkbenchListDoubleSelection.bindTo(this.contextKeyService),this.listMultiSelection=WorkbenchListMultiSelection.bindTo(this.contextKeyService),this.horizontalScrolling=G.horizontalScrolling,this._useAltAsMultipleSelectionModifier=useAltAsMultipleSelectionModifier(Q),this.disposables.add(this.contextKeyService),this.disposables.add(X.register(this)),this.updateStyles(G.overrideStyles),this.disposables.add(this.onDidChangeSelection(()=>{const oe=this.getSelection(),re=this.getFocus();this.contextKeyService.bufferChangeEvents(()=>{this.listHasSelectionOrFocus.set(oe.length>0||re.length>0),this.listMultiSelection.set(oe.length>1),this.listDoubleSelection.set(oe.length===2)})})),this.disposables.add(this.onDidChangeFocus(()=>{const oe=this.getSelection(),re=this.getFocus();this.listHasSelectionOrFocus.set(oe.length>0||re.length>0)})),this.disposables.add(Q.onDidChangeConfiguration(oe=>{oe.affectsConfiguration(multiSelectModifierSettingKey)&&(this._useAltAsMultipleSelectionModifier=useAltAsMultipleSelectionModifier(Q));let re={};if(oe.affectsConfiguration(horizontalScrollingKey)&&this.horizontalScrolling===void 0){const ae=!!Q.getValue(horizontalScrollingKey);re=Object.assign(Object.assign({},re),{horizontalScrolling:ae})}if(oe.affectsConfiguration(scrollByPageKey)){const ae=!!Q.getValue(scrollByPageKey);re=Object.assign(Object.assign({},re),{scrollByPage:ae})}if(oe.affectsConfiguration(listSmoothScrolling)){const ae=!!Q.getValue(listSmoothScrolling);re=Object.assign(Object.assign({},re),{smoothScrolling:ae})}if(oe.affectsConfiguration(mouseWheelScrollSensitivityKey)){const ae=Q.getValue(mouseWheelScrollSensitivityKey);re=Object.assign(Object.assign({},re),{mouseWheelScrollSensitivity:ae})}if(oe.affectsConfiguration(fastScrollSensitivityKey)){const ae=Q.getValue(fastScrollSensitivityKey);re=Object.assign(Object.assign({},re),{fastScrollSensitivity:ae})}Object.keys(re).length>0&&this.updateOptions(re)})),this.navigator=new ListResourceNavigator(this,Object.assign({configurationService:Q},G)),this.disposables.add(this.navigator)}updateOptions(C){super.updateOptions(C),C.overrideStyles!==void 0&&this.updateStyles(C.overrideStyles),C.multipleSelectionSupport!==void 0&&this.listSupportsMultiSelect.set(!!C.multipleSelectionSupport)}updateStyles(C){this.style(C?getListStyles(C):defaultListStyles)}};WorkbenchList=__decorate$1K([__param$1I(5,IContextKeyService),__param$1I(6,IListService),__param$1I(7,IConfigurationService),__param$1I(8,IInstantiationService)],WorkbenchList);let WorkbenchPagedList=class extends PagedList{constructor(C,W,V,U,G,Z,X,Q,J){const ee=typeof G.horizontalScrolling<"u"?G.horizontalScrolling:!!Q.getValue(horizontalScrollingKey),[te,ie]=J.invokeFunction(toWorkbenchListOptions,G);super(C,W,V,U,Object.assign(Object.assign({keyboardSupport:!1},te),{horizontalScrolling:ee})),this.disposables=new DisposableStore,this.disposables.add(ie),this.contextKeyService=createScopedContextKeyService(Z,this),this.disposables.add(createScrollObserver(this.contextKeyService,this.widget)),this.horizontalScrolling=G.horizontalScrolling,this.listSupportsMultiSelect=WorkbenchListSupportsMultiSelectContextKey.bindTo(this.contextKeyService),this.listSupportsMultiSelect.set(G.multipleSelectionSupport!==!1),WorkbenchListSelectionNavigation.bindTo(this.contextKeyService).set(!!G.selectionNavigation),this._useAltAsMultipleSelectionModifier=useAltAsMultipleSelectionModifier(Q),this.disposables.add(this.contextKeyService),this.disposables.add(X.register(this)),this.updateStyles(G.overrideStyles),this.disposables.add(Q.onDidChangeConfiguration(oe=>{oe.affectsConfiguration(multiSelectModifierSettingKey)&&(this._useAltAsMultipleSelectionModifier=useAltAsMultipleSelectionModifier(Q));let re={};if(oe.affectsConfiguration(horizontalScrollingKey)&&this.horizontalScrolling===void 0){const ae=!!Q.getValue(horizontalScrollingKey);re=Object.assign(Object.assign({},re),{horizontalScrolling:ae})}if(oe.affectsConfiguration(scrollByPageKey)){const ae=!!Q.getValue(scrollByPageKey);re=Object.assign(Object.assign({},re),{scrollByPage:ae})}if(oe.affectsConfiguration(listSmoothScrolling)){const ae=!!Q.getValue(listSmoothScrolling);re=Object.assign(Object.assign({},re),{smoothScrolling:ae})}if(oe.affectsConfiguration(mouseWheelScrollSensitivityKey)){const ae=Q.getValue(mouseWheelScrollSensitivityKey);re=Object.assign(Object.assign({},re),{mouseWheelScrollSensitivity:ae})}if(oe.affectsConfiguration(fastScrollSensitivityKey)){const ae=Q.getValue(fastScrollSensitivityKey);re=Object.assign(Object.assign({},re),{fastScrollSensitivity:ae})}Object.keys(re).length>0&&this.updateOptions(re)})),this.navigator=new ListResourceNavigator(this,Object.assign({configurationService:Q},G)),this.disposables.add(this.navigator)}updateOptions(C){super.updateOptions(C),C.overrideStyles!==void 0&&this.updateStyles(C.overrideStyles),C.multipleSelectionSupport!==void 0&&this.listSupportsMultiSelect.set(!!C.multipleSelectionSupport)}updateStyles(C){this.style(C?getListStyles(C):defaultListStyles)}dispose(){this.disposables.dispose(),super.dispose()}};WorkbenchPagedList=__decorate$1K([__param$1I(5,IContextKeyService),__param$1I(6,IListService),__param$1I(7,IConfigurationService),__param$1I(8,IInstantiationService)],WorkbenchPagedList);let WorkbenchTable=class extends Table{constructor(C,W,V,U,G,Z,X,Q,J,ee){const te=typeof Z.horizontalScrolling<"u"?Z.horizontalScrolling:!!J.getValue(horizontalScrollingKey),[ie,ne]=ee.invokeFunction(toWorkbenchListOptions,Z);super(C,W,V,U,G,Object.assign(Object.assign({keyboardSupport:!1},ie),{horizontalScrolling:te})),this.disposables.add(ne),this.contextKeyService=createScopedContextKeyService(X,this),this.disposables.add(createScrollObserver(this.contextKeyService,this)),this.listSupportsMultiSelect=WorkbenchListSupportsMultiSelectContextKey.bindTo(this.contextKeyService),this.listSupportsMultiSelect.set(Z.multipleSelectionSupport!==!1),WorkbenchListSelectionNavigation.bindTo(this.contextKeyService).set(!!Z.selectionNavigation),this.listHasSelectionOrFocus=WorkbenchListHasSelectionOrFocus.bindTo(this.contextKeyService),this.listDoubleSelection=WorkbenchListDoubleSelection.bindTo(this.contextKeyService),this.listMultiSelection=WorkbenchListMultiSelection.bindTo(this.contextKeyService),this.horizontalScrolling=Z.horizontalScrolling,this._useAltAsMultipleSelectionModifier=useAltAsMultipleSelectionModifier(J),this.disposables.add(this.contextKeyService),this.disposables.add(Q.register(this)),this.updateStyles(Z.overrideStyles),this.disposables.add(this.onDidChangeSelection(()=>{const re=this.getSelection(),ae=this.getFocus();this.contextKeyService.bufferChangeEvents(()=>{this.listHasSelectionOrFocus.set(re.length>0||ae.length>0),this.listMultiSelection.set(re.length>1),this.listDoubleSelection.set(re.length===2)})})),this.disposables.add(this.onDidChangeFocus(()=>{const re=this.getSelection(),ae=this.getFocus();this.listHasSelectionOrFocus.set(re.length>0||ae.length>0)})),this.disposables.add(J.onDidChangeConfiguration(re=>{re.affectsConfiguration(multiSelectModifierSettingKey)&&(this._useAltAsMultipleSelectionModifier=useAltAsMultipleSelectionModifier(J));let ae={};if(re.affectsConfiguration(horizontalScrollingKey)&&this.horizontalScrolling===void 0){const se=!!J.getValue(horizontalScrollingKey);ae=Object.assign(Object.assign({},ae),{horizontalScrolling:se})}if(re.affectsConfiguration(scrollByPageKey)){const se=!!J.getValue(scrollByPageKey);ae=Object.assign(Object.assign({},ae),{scrollByPage:se})}if(re.affectsConfiguration(listSmoothScrolling)){const se=!!J.getValue(listSmoothScrolling);ae=Object.assign(Object.assign({},ae),{smoothScrolling:se})}if(re.affectsConfiguration(mouseWheelScrollSensitivityKey)){const se=J.getValue(mouseWheelScrollSensitivityKey);ae=Object.assign(Object.assign({},ae),{mouseWheelScrollSensitivity:se})}if(re.affectsConfiguration(fastScrollSensitivityKey)){const se=J.getValue(fastScrollSensitivityKey);ae=Object.assign(Object.assign({},ae),{fastScrollSensitivity:se})}Object.keys(ae).length>0&&this.updateOptions(ae)})),this.navigator=new TableResourceNavigator(this,Object.assign({configurationService:J},Z)),this.disposables.add(this.navigator)}updateOptions(C){super.updateOptions(C),C.overrideStyles!==void 0&&this.updateStyles(C.overrideStyles),C.multipleSelectionSupport!==void 0&&this.listSupportsMultiSelect.set(!!C.multipleSelectionSupport)}updateStyles(C){this.style(C?getListStyles(C):defaultListStyles)}dispose(){this.disposables.dispose(),super.dispose()}};WorkbenchTable=__decorate$1K([__param$1I(6,IContextKeyService),__param$1I(7,IListService),__param$1I(8,IConfigurationService),__param$1I(9,IInstantiationService)],WorkbenchTable);class ResourceNavigator extends Disposable{constructor(C,W){var V;super(),this.widget=C,this._onDidOpen=this._register(new Emitter$1),this.onDidOpen=this._onDidOpen.event,this._register(Event$1.filter(this.widget.onDidChangeSelection,U=>U.browserEvent instanceof KeyboardEvent)(U=>this.onSelectionFromKeyboard(U))),this._register(this.widget.onPointer(U=>this.onPointer(U.element,U.browserEvent))),this._register(this.widget.onMouseDblClick(U=>this.onMouseDblClick(U.element,U.browserEvent))),typeof(W==null?void 0:W.openOnSingleClick)!="boolean"&&(W!=null&&W.configurationService)?(this.openOnSingleClick=(W==null?void 0:W.configurationService.getValue(openModeSettingKey))!=="doubleClick",this._register(W==null?void 0:W.configurationService.onDidChangeConfiguration(U=>{U.affectsConfiguration(openModeSettingKey)&&(this.openOnSingleClick=(W==null?void 0:W.configurationService.getValue(openModeSettingKey))!=="doubleClick")}))):this.openOnSingleClick=(V=W==null?void 0:W.openOnSingleClick)!==null&&V!==void 0?V:!0}onSelectionFromKeyboard(C){if(C.elements.length!==1)return;const W=C.browserEvent,V=typeof W.preserveFocus=="boolean"?W.preserveFocus:!0,U=typeof W.pinned=="boolean"?W.pinned:!V,G=!1;this._open(this.getSelectedElement(),V,U,G,C.browserEvent)}onPointer(C,W){if(!this.openOnSingleClick||W.detail===2)return;const U=W.button===1,G=!0,Z=U,X=W.ctrlKey||W.metaKey||W.altKey;this._open(C,G,Z,X,W)}onMouseDblClick(C,W){if(!W)return;const V=W.target;if(V.classList.contains("monaco-tl-twistie")||V.classList.contains("monaco-icon-label")&&V.classList.contains("folder-icon")&&W.offsetX<16)return;const G=!1,Z=!0,X=W.ctrlKey||W.metaKey||W.altKey;this._open(C,G,Z,X,W)}_open(C,W,V,U,G){C&&this._onDidOpen.fire({editorOptions:{preserveFocus:W,pinned:V,revealIfVisible:!0},sideBySide:U,element:C,browserEvent:G})}}class ListResourceNavigator extends ResourceNavigator{constructor(C,W){super(C,W),this.widget=C}getSelectedElement(){return this.widget.getSelectedElements()[0]}}class TableResourceNavigator extends ResourceNavigator{constructor(C,W){super(C,W)}getSelectedElement(){return this.widget.getSelectedElements()[0]}}class TreeResourceNavigator extends ResourceNavigator{constructor(C,W){super(C,W)}getSelectedElement(){var C;return(C=this.widget.getSelection()[0])!==null&&C!==void 0?C:void 0}}function createKeyboardNavigationEventFilter(K){let C=!1;return W=>{if(W.toKeyCodeChord().isModifierKey())return!1;if(C)return C=!1,!1;const V=K.softDispatch(W,W.target);return V.kind===1?(C=!0,!1):(C=!1,V.kind===0)}}let WorkbenchObjectTree=class extends ObjectTree{constructor(C,W,V,U,G,Z,X,Q,J){const{options:ee,getTypeNavigationMode:te,disposable:ie}=Z.invokeFunction(workbenchTreeDataPreamble,G);super(C,W,V,U,ee),this.disposables.add(ie),this.internals=new WorkbenchTreeInternals(this,G,te,G.overrideStyles,X,Q,J),this.disposables.add(this.internals)}updateOptions(C){super.updateOptions(C),this.internals.updateOptions(C)}};WorkbenchObjectTree=__decorate$1K([__param$1I(5,IInstantiationService),__param$1I(6,IContextKeyService),__param$1I(7,IListService),__param$1I(8,IConfigurationService)],WorkbenchObjectTree);let WorkbenchCompressibleObjectTree=class extends CompressibleObjectTree{constructor(C,W,V,U,G,Z,X,Q,J){const{options:ee,getTypeNavigationMode:te,disposable:ie}=Z.invokeFunction(workbenchTreeDataPreamble,G);super(C,W,V,U,ee),this.disposables.add(ie),this.internals=new WorkbenchTreeInternals(this,G,te,G.overrideStyles,X,Q,J),this.disposables.add(this.internals)}updateOptions(C={}){super.updateOptions(C),C.overrideStyles&&this.internals.updateStyleOverrides(C.overrideStyles),this.internals.updateOptions(C)}};WorkbenchCompressibleObjectTree=__decorate$1K([__param$1I(5,IInstantiationService),__param$1I(6,IContextKeyService),__param$1I(7,IListService),__param$1I(8,IConfigurationService)],WorkbenchCompressibleObjectTree);let WorkbenchDataTree=class extends DataTree{constructor(C,W,V,U,G,Z,X,Q,J,ee){const{options:te,getTypeNavigationMode:ie,disposable:ne}=X.invokeFunction(workbenchTreeDataPreamble,Z);super(C,W,V,U,G,te),this.disposables.add(ne),this.internals=new WorkbenchTreeInternals(this,Z,ie,Z.overrideStyles,Q,J,ee),this.disposables.add(this.internals)}updateOptions(C={}){super.updateOptions(C),C.overrideStyles!==void 0&&this.internals.updateStyleOverrides(C.overrideStyles),this.internals.updateOptions(C)}};WorkbenchDataTree=__decorate$1K([__param$1I(6,IInstantiationService),__param$1I(7,IContextKeyService),__param$1I(8,IListService),__param$1I(9,IConfigurationService)],WorkbenchDataTree);let WorkbenchAsyncDataTree=class extends AsyncDataTree{get onDidOpen(){return this.internals.onDidOpen}constructor(C,W,V,U,G,Z,X,Q,J,ee){const{options:te,getTypeNavigationMode:ie,disposable:ne}=X.invokeFunction(workbenchTreeDataPreamble,Z);super(C,W,V,U,G,te),this.disposables.add(ne),this.internals=new WorkbenchTreeInternals(this,Z,ie,Z.overrideStyles,Q,J,ee),this.disposables.add(this.internals)}updateOptions(C={}){super.updateOptions(C),C.overrideStyles&&this.internals.updateStyleOverrides(C.overrideStyles),this.internals.updateOptions(C)}};WorkbenchAsyncDataTree=__decorate$1K([__param$1I(6,IInstantiationService),__param$1I(7,IContextKeyService),__param$1I(8,IListService),__param$1I(9,IConfigurationService)],WorkbenchAsyncDataTree);let WorkbenchCompressibleAsyncDataTree=class extends CompressibleAsyncDataTree{constructor(C,W,V,U,G,Z,X,Q,J,ee,te){const{options:ie,getTypeNavigationMode:ne,disposable:oe}=Q.invokeFunction(workbenchTreeDataPreamble,X);super(C,W,V,U,G,Z,ie),this.disposables.add(oe),this.internals=new WorkbenchTreeInternals(this,X,ne,X.overrideStyles,J,ee,te),this.disposables.add(this.internals)}updateOptions(C){super.updateOptions(C),this.internals.updateOptions(C)}};WorkbenchCompressibleAsyncDataTree=__decorate$1K([__param$1I(7,IInstantiationService),__param$1I(8,IContextKeyService),__param$1I(9,IListService),__param$1I(10,IConfigurationService)],WorkbenchCompressibleAsyncDataTree);function getDefaultTreeFindMode(K){const C=K.getValue(defaultFindModeSettingKey);if(C==="highlight")return TreeFindMode.Highlight;if(C==="filter")return TreeFindMode.Filter;const W=K.getValue(keyboardNavigationSettingKey);if(W==="simple"||W==="highlight")return TreeFindMode.Highlight;if(W==="filter")return TreeFindMode.Filter}function getDefaultTreeFindMatchType(K){const C=K.getValue(defaultFindMatchTypeSettingKey);if(C==="fuzzy")return TreeFindMatchType.Fuzzy;if(C==="contiguous")return TreeFindMatchType.Contiguous}function workbenchTreeDataPreamble(K,C){var W;const V=K.get(IConfigurationService),U=K.get(IContextViewService),G=K.get(IContextKeyService),Z=K.get(IInstantiationService),X=()=>{const ne=G.getContextKeyValue(WorkbenchListTypeNavigationModeKey);if(ne==="automatic")return TypeNavigationMode.Automatic;if(ne==="trigger"||G.getContextKeyValue(WorkbenchListAutomaticKeyboardNavigationLegacyKey)===!1)return TypeNavigationMode.Trigger;const re=V.getValue(typeNavigationModeSettingKey);if(re==="automatic")return TypeNavigationMode.Automatic;if(re==="trigger")return TypeNavigationMode.Trigger},Q=C.horizontalScrolling!==void 0?C.horizontalScrolling:!!V.getValue(horizontalScrollingKey),[J,ee]=Z.invokeFunction(toWorkbenchListOptions,C),te=C.paddingBottom,ie=C.renderIndentGuides!==void 0?C.renderIndentGuides:V.getValue(treeRenderIndentGuidesKey);return{getTypeNavigationMode:X,disposable:ee,options:Object.assign(Object.assign({keyboardSupport:!1},J),{indent:typeof V.getValue(treeIndentKey)=="number"?V.getValue(treeIndentKey):void 0,renderIndentGuides:ie,smoothScrolling:!!V.getValue(listSmoothScrolling),defaultFindMode:getDefaultTreeFindMode(V),defaultFindMatchType:getDefaultTreeFindMatchType(V),horizontalScrolling:Q,scrollByPage:!!V.getValue(scrollByPageKey),paddingBottom:te,hideTwistiesOfChildlessElements:C.hideTwistiesOfChildlessElements,expandOnlyOnTwistieClick:(W=C.expandOnlyOnTwistieClick)!==null&&W!==void 0?W:V.getValue(treeExpandMode)==="doubleClick",contextViewProvider:U,findWidgetStyles:defaultFindWidgetStyles})}}let WorkbenchTreeInternals=class{get onDidOpen(){return this.navigator.onDidOpen}constructor(C,W,V,U,G,Z,X){var Q;this.tree=C,this.disposables=[],this.contextKeyService=createScopedContextKeyService(G,C),this.disposables.push(createScrollObserver(this.contextKeyService,C)),this.listSupportsMultiSelect=WorkbenchListSupportsMultiSelectContextKey.bindTo(this.contextKeyService),this.listSupportsMultiSelect.set(W.multipleSelectionSupport!==!1),WorkbenchListSelectionNavigation.bindTo(this.contextKeyService).set(!!W.selectionNavigation),this.listSupportFindWidget=WorkbenchListSupportsFind.bindTo(this.contextKeyService),this.listSupportFindWidget.set((Q=W.findWidgetEnabled)!==null&&Q!==void 0?Q:!0),this.hasSelectionOrFocus=WorkbenchListHasSelectionOrFocus.bindTo(this.contextKeyService),this.hasDoubleSelection=WorkbenchListDoubleSelection.bindTo(this.contextKeyService),this.hasMultiSelection=WorkbenchListMultiSelection.bindTo(this.contextKeyService),this.treeElementCanCollapse=WorkbenchTreeElementCanCollapse.bindTo(this.contextKeyService),this.treeElementHasParent=WorkbenchTreeElementHasParent.bindTo(this.contextKeyService),this.treeElementCanExpand=WorkbenchTreeElementCanExpand.bindTo(this.contextKeyService),this.treeElementHasChild=WorkbenchTreeElementHasChild.bindTo(this.contextKeyService),this.treeFindOpen=WorkbenchTreeFindOpen.bindTo(this.contextKeyService),this._useAltAsMultipleSelectionModifier=useAltAsMultipleSelectionModifier(X),this.updateStyleOverrides(U);const ee=()=>{const ie=C.getFocus()[0];if(!ie)return;const ne=C.getNode(ie);this.treeElementCanCollapse.set(ne.collapsible&&!ne.collapsed),this.treeElementHasParent.set(!!C.getParentElement(ie)),this.treeElementCanExpand.set(ne.collapsible&&ne.collapsed),this.treeElementHasChild.set(!!C.getFirstElementChild(ie))},te=new Set;te.add(WorkbenchListTypeNavigationModeKey),te.add(WorkbenchListAutomaticKeyboardNavigationLegacyKey),this.disposables.push(this.contextKeyService,Z.register(C),C.onDidChangeSelection(()=>{const ie=C.getSelection(),ne=C.getFocus();this.contextKeyService.bufferChangeEvents(()=>{this.hasSelectionOrFocus.set(ie.length>0||ne.length>0),this.hasMultiSelection.set(ie.length>1),this.hasDoubleSelection.set(ie.length===2)})}),C.onDidChangeFocus(()=>{const ie=C.getSelection(),ne=C.getFocus();this.hasSelectionOrFocus.set(ie.length>0||ne.length>0),ee()}),C.onDidChangeCollapseState(ee),C.onDidChangeModel(ee),C.onDidChangeFindOpenState(ie=>this.treeFindOpen.set(ie)),X.onDidChangeConfiguration(ie=>{let ne={};if(ie.affectsConfiguration(multiSelectModifierSettingKey)&&(this._useAltAsMultipleSelectionModifier=useAltAsMultipleSelectionModifier(X)),ie.affectsConfiguration(treeIndentKey)){const oe=X.getValue(treeIndentKey);ne=Object.assign(Object.assign({},ne),{indent:oe})}if(ie.affectsConfiguration(treeRenderIndentGuidesKey)&&W.renderIndentGuides===void 0){const oe=X.getValue(treeRenderIndentGuidesKey);ne=Object.assign(Object.assign({},ne),{renderIndentGuides:oe})}if(ie.affectsConfiguration(listSmoothScrolling)){const oe=!!X.getValue(listSmoothScrolling);ne=Object.assign(Object.assign({},ne),{smoothScrolling:oe})}if(ie.affectsConfiguration(defaultFindModeSettingKey)||ie.affectsConfiguration(keyboardNavigationSettingKey)){const oe=getDefaultTreeFindMode(X);ne=Object.assign(Object.assign({},ne),{defaultFindMode:oe})}if(ie.affectsConfiguration(typeNavigationModeSettingKey)||ie.affectsConfiguration(keyboardNavigationSettingKey)){const oe=V();ne=Object.assign(Object.assign({},ne),{typeNavigationMode:oe})}if(ie.affectsConfiguration(defaultFindMatchTypeSettingKey)){const oe=getDefaultTreeFindMatchType(X);ne=Object.assign(Object.assign({},ne),{defaultFindMatchType:oe})}if(ie.affectsConfiguration(horizontalScrollingKey)&&W.horizontalScrolling===void 0){const oe=!!X.getValue(horizontalScrollingKey);ne=Object.assign(Object.assign({},ne),{horizontalScrolling:oe})}if(ie.affectsConfiguration(scrollByPageKey)){const oe=!!X.getValue(scrollByPageKey);ne=Object.assign(Object.assign({},ne),{scrollByPage:oe})}if(ie.affectsConfiguration(treeExpandMode)&&W.expandOnlyOnTwistieClick===void 0&&(ne=Object.assign(Object.assign({},ne),{expandOnlyOnTwistieClick:X.getValue(treeExpandMode)==="doubleClick"})),ie.affectsConfiguration(mouseWheelScrollSensitivityKey)){const oe=X.getValue(mouseWheelScrollSensitivityKey);ne=Object.assign(Object.assign({},ne),{mouseWheelScrollSensitivity:oe})}if(ie.affectsConfiguration(fastScrollSensitivityKey)){const oe=X.getValue(fastScrollSensitivityKey);ne=Object.assign(Object.assign({},ne),{fastScrollSensitivity:oe})}Object.keys(ne).length>0&&C.updateOptions(ne)}),this.contextKeyService.onDidChangeContext(ie=>{ie.affectsSome(te)&&C.updateOptions({typeNavigationMode:V()})})),this.navigator=new TreeResourceNavigator(C,Object.assign({configurationService:X},W)),this.disposables.push(this.navigator)}updateOptions(C){C.multipleSelectionSupport!==void 0&&this.listSupportsMultiSelect.set(!!C.multipleSelectionSupport)}updateStyleOverrides(C){this.tree.style(C?getListStyles(C):defaultListStyles)}dispose(){this.disposables=dispose(this.disposables)}};WorkbenchTreeInternals=__decorate$1K([__param$1I(4,IContextKeyService),__param$1I(5,IListService),__param$1I(6,IConfigurationService)],WorkbenchTreeInternals);const configurationRegistry=Registry.as(Extensions$6.Configuration);configurationRegistry.registerConfiguration({id:"workbench",order:7,title:localize("workbenchConfigurationTitle","Workbench"),type:"object",properties:{[multiSelectModifierSettingKey]:{type:"string",enum:["ctrlCmd","alt"],markdownEnumDescriptions:[localize("multiSelectModifier.ctrlCmd","Maps to `Control` on Windows and Linux and to `Command` on macOS."),localize("multiSelectModifier.alt","Maps to `Alt` on Windows and Linux and to `Option` on macOS.")],default:"ctrlCmd",description:localize({key:"multiSelectModifier",comment:["- `ctrlCmd` refers to a value the setting can take and should not be localized.","- `Control` and `Command` refer to the modifier keys Ctrl or Cmd on the keyboard and can be localized."]},"The modifier to be used to add an item in trees and lists to a multi-selection with the mouse (for example in the explorer, open editors and scm view). The 'Open to Side' mouse gestures - if supported - will adapt such that they do not conflict with the multiselect modifier.")},[openModeSettingKey]:{type:"string",enum:["singleClick","doubleClick"],default:"singleClick",description:localize({key:"openModeModifier",comment:["`singleClick` and `doubleClick` refers to a value the setting can take and should not be localized."]},"Controls how to open items in trees and lists using the mouse (if supported). Note that some trees and lists might choose to ignore this setting if it is not applicable.")},[horizontalScrollingKey]:{type:"boolean",default:!1,description:localize("horizontalScrolling setting","Controls whether lists and trees support horizontal scrolling in the workbench. Warning: turning on this setting has a performance implication.")},[scrollByPageKey]:{type:"boolean",default:!1,description:localize("list.scrollByPage","Controls whether clicks in the scrollbar scroll page by page.")},[treeIndentKey]:{type:"number",default:8,minimum:4,maximum:40,description:localize("tree indent setting","Controls tree indentation in pixels.")},[treeRenderIndentGuidesKey]:{type:"string",enum:["none","onHover","always"],default:"onHover",description:localize("render tree indent guides","Controls whether the tree should render indent guides.")},[listSmoothScrolling]:{type:"boolean",default:!1,description:localize("list smoothScrolling setting","Controls whether lists and trees have smooth scrolling.")},[mouseWheelScrollSensitivityKey]:{type:"number",default:1,markdownDescription:localize("Mouse Wheel Scroll Sensitivity","A multiplier to be used on the `deltaX` and `deltaY` of mouse wheel scroll events.")},[fastScrollSensitivityKey]:{type:"number",default:5,markdownDescription:localize("Fast Scroll Sensitivity","Scrolling speed multiplier when pressing `Alt`.")},[defaultFindModeSettingKey]:{type:"string",enum:["highlight","filter"],enumDescriptions:[localize("defaultFindModeSettingKey.highlight","Highlight elements when searching. Further up and down navigation will traverse only the highlighted elements."),localize("defaultFindModeSettingKey.filter","Filter elements when searching.")],default:"highlight",description:localize("defaultFindModeSettingKey","Controls the default find mode for lists and trees in the workbench.")},[keyboardNavigationSettingKey]:{type:"string",enum:["simple","highlight","filter"],enumDescriptions:[localize("keyboardNavigationSettingKey.simple","Simple keyboard navigation focuses elements which match the keyboard input. Matching is done only on prefixes."),localize("keyboardNavigationSettingKey.highlight","Highlight keyboard navigation highlights elements which match the keyboard input. Further up and down navigation will traverse only the highlighted elements."),localize("keyboardNavigationSettingKey.filter","Filter keyboard navigation will filter out and hide all the elements which do not match the keyboard input.")],default:"highlight",description:localize("keyboardNavigationSettingKey","Controls the keyboard navigation style for lists and trees in the workbench. Can be simple, highlight and filter."),deprecated:!0,deprecationMessage:localize("keyboardNavigationSettingKeyDeprecated","Please use 'workbench.list.defaultFindMode' and	'workbench.list.typeNavigationMode' instead.")},[defaultFindMatchTypeSettingKey]:{type:"string",enum:["fuzzy","contiguous"],enumDescriptions:[localize("defaultFindMatchTypeSettingKey.fuzzy","Use fuzzy matching when searching."),localize("defaultFindMatchTypeSettingKey.contiguous","Use contiguous matching when searching.")],default:"fuzzy",description:localize("defaultFindMatchTypeSettingKey","Controls the type of matching used when searching lists and trees in the workbench.")},[treeExpandMode]:{type:"string",enum:["singleClick","doubleClick"],default:"singleClick",description:localize("expand mode","Controls how tree folders are expanded when clicking the folder names. Note that some trees and lists might choose to ignore this setting if it is not applicable.")},[typeNavigationModeSettingKey]:{type:"string",enum:["automatic","trigger"],default:"automatic",markdownDescription:localize("typeNavigationMode2","Controls how type navigation works in lists and trees in the workbench. When set to `trigger`, type navigation begins once the `list.triggerTypeNavigation` command is run.")}}});var DefaultQuickAccessFilterValue;(function(K){K[K.PRESERVE=0]="PRESERVE",K[K.LAST=1]="LAST"})(DefaultQuickAccessFilterValue||(DefaultQuickAccessFilterValue={}));const Extensions$2={Quickaccess:"workbench.contributions.quickaccess"};class QuickAccessRegistry{constructor(){this.providers=[],this.defaultProvider=void 0}registerQuickAccessProvider(C){return C.prefix.length===0?this.defaultProvider=C:this.providers.push(C),this.providers.sort((W,V)=>V.prefix.length-W.prefix.length),toDisposable(()=>{this.providers.splice(this.providers.indexOf(C),1),this.defaultProvider===C&&(this.defaultProvider=void 0)})}getQuickAccessProviders(){return coalesce([this.defaultProvider,...this.providers])}getQuickAccessProvider(C){return C&&this.providers.find(V=>C.startsWith(V.prefix))||void 0||this.defaultProvider}}Registry.add(Extensions$2.Quickaccess,new QuickAccessRegistry);const NO_KEY_MODS={ctrlCmd:!1,alt:!1};var QuickInputHideReason;(function(K){K[K.Blur=1]="Blur",K[K.Gesture=2]="Gesture",K[K.Other=3]="Other"})(QuickInputHideReason||(QuickInputHideReason={}));var ItemActivation;(function(K){K[K.NONE=0]="NONE",K[K.FIRST=1]="FIRST",K[K.SECOND=2]="SECOND",K[K.LAST=3]="LAST"})(ItemActivation||(ItemActivation={}));const IQuickInputService=createDecorator("quickInputService");var __decorate$1J=globalThis&&globalThis.__decorate||function(K,C,W,V){var U=arguments.length,G=U<3?C:V===null?V=Object.getOwnPropertyDescriptor(C,W):V,Z;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")G=Reflect.decorate(K,C,W,V);else for(var X=K.length-1;X>=0;X--)(Z=K[X])&&(G=(U<3?Z(G):U>3?Z(C,W,G):Z(C,W))||G);return U>3&&G&&Object.defineProperty(C,W,G),G},__param$1H=globalThis&&globalThis.__param||function(K,C){return function(W,V){C(W,V,K)}};let QuickAccessController=class extends Disposable{constructor(C,W){super(),this.quickInputService=C,this.instantiationService=W,this.registry=Registry.as(Extensions$2.Quickaccess),this.mapProviderToDescriptor=new Map,this.lastAcceptedPickerValues=new Map,this.visibleQuickAccess=void 0}show(C="",W){this.doShowOrPick(C,!1,W)}doShowOrPick(C,W,V){var U;const[G,Z]=this.getOrInstantiateProvider(C),X=this.visibleQuickAccess,Q=X==null?void 0:X.descriptor;if(X&&Z&&Q===Z){C!==Z.prefix&&!(V!=null&&V.preserveValue)&&(X.picker.value=C),this.adjustValueSelection(X.picker,Z,V);return}if(Z&&!(V!=null&&V.preserveValue)){let ne;if(X&&Q&&Q!==Z){const oe=X.value.substr(Q.prefix.length);oe&&(ne=`${Z.prefix}${oe}`)}if(!ne){const oe=G==null?void 0:G.defaultFilterValue;oe===DefaultQuickAccessFilterValue.LAST?ne=this.lastAcceptedPickerValues.get(Z):typeof oe=="string"&&(ne=`${Z.prefix}${oe}`)}typeof ne=="string"&&(C=ne)}const J=new DisposableStore,ee=J.add(this.quickInputService.createQuickPick());ee.value=C,this.adjustValueSelection(ee,Z,V),ee.placeholder=Z==null?void 0:Z.placeholder,ee.quickNavigate=V==null?void 0:V.quickNavigateConfiguration,ee.hideInput=!!ee.quickNavigate&&!X,(typeof(V==null?void 0:V.itemActivation)=="number"||V!=null&&V.quickNavigateConfiguration)&&(ee.itemActivation=(U=V==null?void 0:V.itemActivation)!==null&&U!==void 0?U:ItemActivation.SECOND),ee.contextKey=Z==null?void 0:Z.contextKey,ee.filterValue=ne=>ne.substring(Z?Z.prefix.length:0);let te;W&&(te=new DeferredPromise,J.add(Event$1.once(ee.onWillAccept)(ne=>{ne.veto(),ee.hide()}))),J.add(this.registerPickerListeners(ee,G,Z,C,V==null?void 0:V.providerOptions));const ie=J.add(new CancellationTokenSource$1);if(G&&J.add(G.provide(ee,ie.token,V==null?void 0:V.providerOptions)),Event$1.once(ee.onDidHide)(()=>{ee.selectedItems.length===0&&ie.cancel(),J.dispose(),te==null||te.complete(ee.selectedItems.slice(0))}),ee.show(),W)return te==null?void 0:te.p}adjustValueSelection(C,W,V){var U;let G;V!=null&&V.preserveValue?G=[C.value.length,C.value.length]:G=[(U=W==null?void 0:W.prefix.length)!==null&&U!==void 0?U:0,C.value.length],C.valueSelection=G}registerPickerListeners(C,W,V,U,G){const Z=new DisposableStore,X=this.visibleQuickAccess={picker:C,descriptor:V,value:U};return Z.add(toDisposable(()=>{X===this.visibleQuickAccess&&(this.visibleQuickAccess=void 0)})),Z.add(C.onDidChangeValue(Q=>{const[J]=this.getOrInstantiateProvider(Q);J!==W?this.show(Q,{preserveValue:!0,providerOptions:G}):X.value=Q})),V&&Z.add(C.onDidAccept(()=>{this.lastAcceptedPickerValues.set(V,C.value)})),Z}getOrInstantiateProvider(C){const W=this.registry.getQuickAccessProvider(C);if(!W)return[void 0,void 0];let V=this.mapProviderToDescriptor.get(W);return V||(V=this.instantiationService.createInstance(W.ctor),this.mapProviderToDescriptor.set(W,V)),[V,W]}};QuickAccessController=__decorate$1J([__param$1H(0,IQuickInputService),__param$1H(1,IInstantiationService)],QuickAccessController);const button="";Color.white.toString(),Color.white.toString();class Button extends Disposable{get onDidClick(){return this._onDidClick.event}constructor(C,W){super(),this._label="",this._onDidClick=this._register(new Emitter$1),this.options=W,this._element=document.createElement("a"),this._element.classList.add("monaco-button"),this._element.tabIndex=0,this._element.setAttribute("role","button"),this._element.classList.toggle("secondary",!!W.secondary);const V=W.secondary?W.buttonSecondaryBackground:W.buttonBackground,U=W.secondary?W.buttonSecondaryForeground:W.buttonForeground;this._element.style.color=U||"",this._element.style.backgroundColor=V||"",W.supportShortLabel&&(this._labelShortElement=document.createElement("div"),this._labelShortElement.classList.add("monaco-button-label-short"),this._element.appendChild(this._labelShortElement),this._labelElement=document.createElement("div"),this._labelElement.classList.add("monaco-button-label"),this._element.appendChild(this._labelElement),this._element.classList.add("monaco-text-button-with-short-label")),C.appendChild(this._element),this._register(Gesture.addTarget(this._element)),[EventType$1.CLICK,EventType.Tap].forEach(G=>{this._register(addDisposableListener(this._element,G,Z=>{if(!this.enabled){EventHelper.stop(Z);return}this._onDidClick.fire(Z)}))}),this._register(addDisposableListener(this._element,EventType$1.KEY_DOWN,G=>{const Z=new StandardKeyboardEvent(G);let X=!1;this.enabled&&(Z.equals(3)||Z.equals(10))?(this._onDidClick.fire(G),X=!0):Z.equals(9)&&(this._element.blur(),X=!0),X&&EventHelper.stop(Z,!0)})),this._register(addDisposableListener(this._element,EventType$1.MOUSE_OVER,G=>{this._element.classList.contains("disabled")||this.updateBackground(!0)})),this._register(addDisposableListener(this._element,EventType$1.MOUSE_OUT,G=>{this.updateBackground(!1)})),this.focusTracker=this._register(trackFocus(this._element)),this._register(this.focusTracker.onDidFocus(()=>{this.enabled&&this.updateBackground(!0)})),this._register(this.focusTracker.onDidBlur(()=>{this.enabled&&this.updateBackground(!1)}))}dispose(){super.dispose(),this._element.remove()}getContentElements(C){const W=[];for(let V of renderLabelWithIcons(C))if(typeof V=="string"){if(V=V.trim(),V==="")continue;const U=document.createElement("span");U.textContent=V,W.push(U)}else W.push(V);return W}updateBackground(C){let W;this.options.secondary?W=C?this.options.buttonSecondaryHoverBackground:this.options.buttonSecondaryBackground:W=C?this.options.buttonHoverBackground:this.options.buttonBackground,W&&(this._element.style.backgroundColor=W)}get element(){return this._element}set label(C){var W;if(this._label===C||isMarkdownString(this._label)&&isMarkdownString(C)&&markdownStringEqual(this._label,C))return;this._element.classList.add("monaco-text-button");const V=this.options.supportShortLabel?this._labelElement:this._element;if(isMarkdownString(C)){const U=renderMarkdown(C,{inline:!0});U.dispose();const G=(W=U.element.querySelector("p"))===null||W===void 0?void 0:W.innerHTML;if(G){const Z=sanitize$1(G,{ADD_TAGS:["b","i","u","code","span"],ALLOWED_ATTR:["class"],RETURN_TRUSTED_TYPE:!0});V.innerHTML=Z}else reset(V)}else this.options.supportIcons?reset(V,...this.getContentElements(C)):V.textContent=C;typeof this.options.title=="string"?this._element.title=this.options.title:this.options.title&&(this._element.title=renderStringAsPlaintext(C)),this._label=C}get label(){return this._label}set enabled(C){C?(this._element.classList.remove("disabled"),this._element.setAttribute("aria-disabled",String(!1)),this._element.tabIndex=0):(this._element.classList.add("disabled"),this._element.setAttribute("aria-disabled",String(!0)))}get enabled(){return!this._element.classList.contains("disabled")}}const countBadge="";class CountBadge{constructor(C,W,V){this.options=W,this.styles=V,this.count=0,this.element=append$3(C,$$d(".monaco-count-badge")),this.countFormat=this.options.countFormat||"{0}",this.titleFormat=this.options.titleFormat||"",this.setCount(this.options.count||0)}setCount(C){this.count=C,this.render()}setTitleFormat(C){this.titleFormat=C,this.render()}render(){var C,W;this.element.textContent=format(this.countFormat,this.count),this.element.title=format(this.titleFormat,this.count),this.element.style.backgroundColor=(C=this.styles.badgeBackground)!==null&&C!==void 0?C:"",this.element.style.color=(W=this.styles.badgeForeground)!==null&&W!==void 0?W:"",this.styles.badgeBorder&&(this.element.style.border=`1px solid ${this.styles.badgeBorder}`)}}const progressbar="",CSS_DONE="done",CSS_ACTIVE="active",CSS_INFINITE="infinite",CSS_INFINITE_LONG_RUNNING="infinite-long-running",CSS_DISCRETE="discrete";class ProgressBar extends Disposable{constructor(C,W){super(),this.workedVal=0,this.showDelayedScheduler=this._register(new RunOnceScheduler(()=>show(this.element),0)),this.longRunningScheduler=this._register(new RunOnceScheduler(()=>this.infiniteLongRunning(),ProgressBar.LONG_RUNNING_INFINITE_THRESHOLD)),this.create(C,W)}create(C,W){this.element=document.createElement("div"),this.element.classList.add("monaco-progress-container"),this.element.setAttribute("role","progressbar"),this.element.setAttribute("aria-valuemin","0"),C.appendChild(this.element),this.bit=document.createElement("div"),this.bit.classList.add("progress-bit"),this.bit.style.backgroundColor=(W==null?void 0:W.progressBarBackground)||"#0E70C0",this.element.appendChild(this.bit)}off(){this.bit.style.width="inherit",this.bit.style.opacity="1",this.element.classList.remove(CSS_ACTIVE,CSS_INFINITE,CSS_INFINITE_LONG_RUNNING,CSS_DISCRETE),this.workedVal=0,this.totalWork=void 0,this.longRunningScheduler.cancel()}stop(){return this.doDone(!1)}doDone(C){return this.element.classList.add(CSS_DONE),this.element.classList.contains(CSS_INFINITE)?(this.bit.style.opacity="0",C?setTimeout(()=>this.off(),200):this.off()):(this.bit.style.width="inherit",C?setTimeout(()=>this.off(),200):this.off()),this}infinite(){return this.bit.style.width="2%",this.bit.style.opacity="1",this.element.classList.remove(CSS_DISCRETE,CSS_DONE,CSS_INFINITE_LONG_RUNNING),this.element.classList.add(CSS_ACTIVE,CSS_INFINITE),this.longRunningScheduler.schedule(),this}infiniteLongRunning(){this.element.classList.add(CSS_INFINITE_LONG_RUNNING)}getContainer(){return this.element}}ProgressBar.LONG_RUNNING_INFINITE_THRESHOLD=1e4;const quickInput="",$$a=$$d;class QuickInputBox extends Disposable{constructor(C,W,V){super(),this.parent=C,this.onKeyDown=G=>addDisposableListener(this.findInput.inputBox.inputElement,EventType$1.KEY_DOWN,Z=>{G(new StandardKeyboardEvent(Z))}),this.onMouseDown=G=>addDisposableListener(this.findInput.inputBox.inputElement,EventType$1.MOUSE_DOWN,Z=>{G(new StandardMouseEvent(Z))}),this.onDidChange=G=>this.findInput.onDidChange(G),this.container=append$3(this.parent,$$a(".quick-input-box")),this.findInput=this._register(new FindInput(this.container,void 0,{label:"",inputBoxStyles:W,toggleStyles:V}));const U=this.findInput.inputBox.inputElement;U.role="combobox",U.ariaHasPopup="menu",U.ariaAutoComplete="list",U.ariaExpanded="true"}get value(){return this.findInput.getValue()}set value(C){this.findInput.setValue(C)}select(C=null){this.findInput.inputBox.select(C)}isSelectionAtEnd(){return this.findInput.inputBox.isSelectionAtEnd()}get placeholder(){return this.findInput.inputBox.inputElement.getAttribute("placeholder")||""}set placeholder(C){this.findInput.inputBox.setPlaceHolder(C)}get password(){return this.findInput.inputBox.inputElement.type==="password"}set password(C){this.findInput.inputBox.inputElement.type=C?"password":"text"}set enabled(C){this.findInput.inputBox.inputElement.toggleAttribute("readonly",!C)}set toggles(C){this.findInput.setAdditionalToggles(C)}setAttribute(C,W){this.findInput.inputBox.inputElement.setAttribute(C,W)}showDecoration(C){C===Severity$2.Ignore?this.findInput.clearMessage():this.findInput.showMessage({type:C===Severity$2.Info?1:C===Severity$2.Warning?2:3,content:""})}stylesForType(C){return this.findInput.inputBox.stylesForType(C===Severity$2.Info?1:C===Severity$2.Warning?2:3)}setFocus(){this.findInput.focus()}layout(){this.findInput.inputBox.layout()}}const iconlabel="";class HighlightedLabel{constructor(C,W){var V;this.text="",this.title="",this.highlights=[],this.didEverRender=!1,this.supportIcons=(V=W==null?void 0:W.supportIcons)!==null&&V!==void 0?V:!1,this.domNode=append$3(C,$$d("span.monaco-highlighted-label"))}get element(){return this.domNode}set(C,W=[],V="",U){C||(C=""),U&&(C=HighlightedLabel.escapeNewLines(C,W)),!(this.didEverRender&&this.text===C&&this.title===V&&equals$4(this.highlights,W))&&(this.text=C,this.title=V,this.highlights=W,this.render())}render(){const C=[];let W=0;for(const V of this.highlights){if(V.end===V.start)continue;if(W<V.start){const Z=this.text.substring(W,V.start);this.supportIcons?C.push(...renderLabelWithIcons(Z)):C.push(Z),W=V.start}const U=this.text.substring(W,V.end),G=$$d("span.highlight",void 0,...this.supportIcons?renderLabelWithIcons(U):[U]);V.extraClasses&&G.classList.add(...V.extraClasses),C.push(G),W=V.end}if(W<this.text.length){const V=this.text.substring(W);this.supportIcons?C.push(...renderLabelWithIcons(V)):C.push(V)}reset(this.domNode,...C),this.title?this.domNode.title=this.title:this.domNode.removeAttribute("title"),this.didEverRender=!0}static escapeNewLines(C,W){let V=0,U=0;return C.replace(/\r\n|\r|\n/g,(G,Z)=>{U=G===`\r
`?-1:0,Z+=V;for(const X of W)X.end<=Z||(X.start>=Z&&(X.start+=U),X.end>=Z&&(X.end+=U));return V+=U,"⏎"})}}class FastLabelNode{constructor(C){this._element=C}get element(){return this._element}set textContent(C){this.disposed||C===this._textContent||(this._textContent=C,this._element.textContent=C)}set className(C){this.disposed||C===this._className||(this._className=C,this._element.className=C)}set empty(C){this.disposed||C===this._empty||(this._empty=C,this._element.style.marginLeft=C?"0":"")}dispose(){this.disposed=!0}}class IconLabel extends Disposable{constructor(C,W){super(),this.customHovers=new Map,this.creationOptions=W,this.domNode=this._register(new FastLabelNode(append$3(C,$$d(".monaco-icon-label")))),this.labelContainer=append$3(this.domNode.element,$$d(".monaco-icon-label-container"));const V=append$3(this.labelContainer,$$d("span.monaco-icon-name-container"));W!=null&&W.supportHighlights||W!=null&&W.supportIcons?this.nameNode=new LabelWithHighlights(V,!!W.supportIcons):this.nameNode=new Label(V),this.hoverDelegate=W==null?void 0:W.hoverDelegate}get element(){return this.domNode.element}setLabel(C,W,V){const U=["monaco-icon-label"],G=["monaco-icon-label-container"];let Z="";if(V&&(V.extraClasses&&U.push(...V.extraClasses),V.italic&&U.push("italic"),V.strikethrough&&U.push("strikethrough"),V.disabledCommand&&G.push("disabled"),V.title&&(Z+=V.title)),this.domNode.className=U.join(" "),this.domNode.element.setAttribute("aria-label",Z),this.labelContainer.className=G.join(" "),this.setupHover(V!=null&&V.descriptionTitle?this.labelContainer:this.element,V==null?void 0:V.title),this.nameNode.setLabel(C,V),W||this.descriptionNode){const X=this.getOrCreateDescriptionNode();X instanceof HighlightedLabel?(X.set(W||"",V?V.descriptionMatches:void 0,void 0,V==null?void 0:V.labelEscapeNewLines),this.setupHover(X.element,V==null?void 0:V.descriptionTitle)):(X.textContent=W&&(V!=null&&V.labelEscapeNewLines)?HighlightedLabel.escapeNewLines(W,[]):W||"",this.setupHover(X.element,(V==null?void 0:V.descriptionTitle)||""),X.empty=!W)}}setupHover(C,W){const V=this.customHovers.get(C);if(V&&(V.dispose(),this.customHovers.delete(C)),!W){C.removeAttribute("title");return}if(!this.hoverDelegate)setupNativeHover(C,W);else{const U=setupCustomHover(this.hoverDelegate,C,W);U&&this.customHovers.set(C,U)}}dispose(){super.dispose();for(const C of this.customHovers.values())C.dispose();this.customHovers.clear()}getOrCreateDescriptionNode(){var C;if(!this.descriptionNode){const W=this._register(new FastLabelNode(append$3(this.labelContainer,$$d("span.monaco-icon-description-container"))));!((C=this.creationOptions)===null||C===void 0)&&C.supportDescriptionHighlights?this.descriptionNode=new HighlightedLabel(append$3(W.element,$$d("span.label-description")),{supportIcons:!!this.creationOptions.supportIcons}):this.descriptionNode=this._register(new FastLabelNode(append$3(W.element,$$d("span.label-description"))))}return this.descriptionNode}}class Label{constructor(C){this.container=C,this.label=void 0,this.singleLabel=void 0}setLabel(C,W){if(!(this.label===C&&equals$4(this.options,W)))if(this.label=C,this.options=W,typeof C=="string")this.singleLabel||(this.container.innerText="",this.container.classList.remove("multiple"),this.singleLabel=append$3(this.container,$$d("a.label-name",{id:W==null?void 0:W.domId}))),this.singleLabel.textContent=C;else{this.container.innerText="",this.container.classList.add("multiple"),this.singleLabel=void 0;for(let V=0;V<C.length;V++){const U=C[V],G=(W==null?void 0:W.domId)&&`${W==null?void 0:W.domId}_${V}`;append$3(this.container,$$d("a.label-name",{id:G,"data-icon-label-count":C.length,"data-icon-label-index":V,role:"treeitem"},U)),V<C.length-1&&append$3(this.container,$$d("span.label-separator",void 0,(W==null?void 0:W.separator)||"/"))}}}}function splitMatches(K,C,W){if(!W)return;let V=0;return K.map(U=>{const G={start:V,end:V+U.length},Z=W.map(X=>Range$1.intersect(G,X)).filter(X=>!Range$1.isEmpty(X)).map(({start:X,end:Q})=>({start:X-V,end:Q-V}));return V=G.end+C.length,Z})}class LabelWithHighlights{constructor(C,W){this.container=C,this.supportIcons=W,this.label=void 0,this.singleLabel=void 0}setLabel(C,W){if(!(this.label===C&&equals$4(this.options,W)))if(this.label=C,this.options=W,typeof C=="string")this.singleLabel||(this.container.innerText="",this.container.classList.remove("multiple"),this.singleLabel=new HighlightedLabel(append$3(this.container,$$d("a.label-name",{id:W==null?void 0:W.domId})),{supportIcons:this.supportIcons})),this.singleLabel.set(C,W==null?void 0:W.matches,void 0,W==null?void 0:W.labelEscapeNewLines);else{this.container.innerText="",this.container.classList.add("multiple"),this.singleLabel=void 0;const V=(W==null?void 0:W.separator)||"/",U=splitMatches(C,V,W==null?void 0:W.matches);for(let G=0;G<C.length;G++){const Z=C[G],X=U?U[G]:void 0,Q=(W==null?void 0:W.domId)&&`${W==null?void 0:W.domId}_${G}`,J=$$d("a.label-name",{id:Q,"data-icon-label-count":C.length,"data-icon-label-index":G,role:"treeitem"});new HighlightedLabel(append$3(this.container,J),{supportIcons:this.supportIcons}).set(Z,X,void 0,W==null?void 0:W.labelEscapeNewLines),G<C.length-1&&append$3(J,$$d("span.label-separator",void 0,V))}}}}const keybindingLabel="",$$9=$$d,unthemedKeybindingLabelOptions={keybindingLabelBackground:void 0,keybindingLabelForeground:void 0,keybindingLabelBorder:void 0,keybindingLabelBottomBorder:void 0,keybindingLabelShadow:void 0};class KeybindingLabel{constructor(C,W,V){this.os=W,this.keyElements=new Set,this.options=V||Object.create(null);const U=this.options.keybindingLabelForeground;this.domNode=append$3(C,$$9(".monaco-keybinding")),U&&(this.domNode.style.color=U),this.didEverRender=!1,C.appendChild(this.domNode)}get element(){return this.domNode}set(C,W){this.didEverRender&&this.keybinding===C&&KeybindingLabel.areSame(this.matches,W)||(this.keybinding=C,this.matches=W,this.render())}render(){var C;if(this.clear(),this.keybinding){const W=this.keybinding.getChords();W[0]&&this.renderChord(this.domNode,W[0],this.matches?this.matches.firstPart:null);for(let U=1;U<W.length;U++)append$3(this.domNode,$$9("span.monaco-keybinding-key-chord-separator",void 0," ")),this.renderChord(this.domNode,W[U],this.matches?this.matches.chordPart:null);const V=(C=this.options.disableTitle)!==null&&C!==void 0&&C?void 0:this.keybinding.getAriaLabel()||void 0;V!==void 0?this.domNode.title=V:this.domNode.removeAttribute("title")}else this.options&&this.options.renderUnboundKeybindings&&this.renderUnbound(this.domNode);this.didEverRender=!0}clear(){clearNode(this.domNode),this.keyElements.clear()}renderChord(C,W,V){const U=UILabelProvider.modifierLabels[this.os];W.ctrlKey&&this.renderKey(C,U.ctrlKey,!!(V!=null&&V.ctrlKey),U.separator),W.shiftKey&&this.renderKey(C,U.shiftKey,!!(V!=null&&V.shiftKey),U.separator),W.altKey&&this.renderKey(C,U.altKey,!!(V!=null&&V.altKey),U.separator),W.metaKey&&this.renderKey(C,U.metaKey,!!(V!=null&&V.metaKey),U.separator);const G=W.keyLabel;G&&this.renderKey(C,G,!!(V!=null&&V.keyCode),"")}renderKey(C,W,V,U){append$3(C,this.createKeyElement(W,V?".highlight":"")),U&&append$3(C,$$9("span.monaco-keybinding-key-separator",void 0,U))}renderUnbound(C){append$3(C,this.createKeyElement(localize("unbound","Unbound")))}createKeyElement(C,W=""){const V=$$9("span.monaco-keybinding-key"+W,void 0,C);return this.keyElements.add(V),this.options.keybindingLabelBackground&&(V.style.backgroundColor=this.options.keybindingLabelBackground),this.options.keybindingLabelBorder&&(V.style.borderColor=this.options.keybindingLabelBorder),this.options.keybindingLabelBottomBorder&&(V.style.borderBottomColor=this.options.keybindingLabelBottomBorder),this.options.keybindingLabelShadow&&(V.style.boxShadow=`inset 0 -1px 0 ${this.options.keybindingLabelShadow}`),V}static areSame(C,W){return C===W||!C&&!W?!0:!!C&&!!W&&equals$4(C.firstPart,W.firstPart)&&equals$4(C.chordPart,W.chordPart)}}const intlFileNameCollatorBaseNumeric=new Lazy(()=>{const K=new Intl.Collator(void 0,{numeric:!0,sensitivity:"base"});return{collator:K,collatorIsNumeric:K.resolvedOptions().numeric}});function compareFileNames(K,C,W=!1){const V=K||"",U=C||"",G=intlFileNameCollatorBaseNumeric.value.collator.compare(V,U);return intlFileNameCollatorBaseNumeric.value.collatorIsNumeric&&G===0&&V!==U?V<U?-1:1:G}function compareAnything(K,C,W){const V=K.toLowerCase(),U=C.toLowerCase(),G=compareByPrefix(K,C,W);if(G)return G;const Z=V.endsWith(W),X=U.endsWith(W);if(Z!==X)return Z?-1:1;const Q=compareFileNames(V,U);return Q!==0?Q:V.localeCompare(U)}function compareByPrefix(K,C,W){const V=K.toLowerCase(),U=C.toLowerCase(),G=V.startsWith(W),Z=U.startsWith(W);if(G!==Z)return G?-1:1;if(G&&Z){if(V.length<U.length)return-1;if(V.length>U.length)return 1}return 0}var __decorate$1I=globalThis&&globalThis.__decorate||function(K,C,W,V){var U=arguments.length,G=U<3?C:V===null?V=Object.getOwnPropertyDescriptor(C,W):V,Z;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")G=Reflect.decorate(K,C,W,V);else for(var X=K.length-1;X>=0;X--)(Z=K[X])&&(G=(U<3?Z(G):U>3?Z(C,W,G):Z(C,W))||G);return U>3&&G&&Object.defineProperty(C,W,G),G};class LinkedText{constructor(C){this.nodes=C}toString(){return this.nodes.map(C=>typeof C=="string"?C:C.label).join("")}}__decorate$1I([memoize],LinkedText.prototype,"toString",null);const LINK_REGEX=/\[([^\]]+)\]\(((?:https?:\/\/|command:|file:)[^\)\s]+)(?: (["'])(.+?)(\3))?\)/gi;function parseLinkedText(K){const C=[];let W=0,V;for(;V=LINK_REGEX.exec(K);){V.index-W>0&&C.push(K.substring(W,V.index));const[,U,G,,Z]=V;Z?C.push({label:U,href:G,title:Z}):C.push({label:U,href:G}),W=V.index+V[0].length}return W<K.length&&C.push(K.substring(W)),new LinkedText(C)}const iconPathToClass={},iconClassGenerator=new IdGenerator("quick-input-button-icon-");function getIconClass(K){if(!K)return;let C;const W=K.dark.toString();return iconPathToClass[W]?C=iconPathToClass[W]:(C=iconClassGenerator.nextId(),createCSSRule(`.${C}, .hc-light .${C}`,`background-image: ${asCSSUrl(K.light||K.dark)}`),createCSSRule(`.vs-dark .${C}, .hc-black .${C}`,`background-image: ${asCSSUrl(K.dark)}`),iconPathToClass[W]=C),C}function renderQuickInputDescription(K,C,W){reset(C);const V=parseLinkedText(K);let U=0;for(const G of V.nodes)if(typeof G=="string")C.append(...renderLabelWithIcons(G));else{let Z=G.title;!Z&&G.href.startsWith("command:")?Z=localize("executeCommand","Click to execute command '{0}'",G.href.substring(8)):Z||(Z=G.href);const X=$$d("a",{href:G.href,title:Z,tabIndex:U++},G.label);X.style.textDecoration="underline";const Q=ne=>{isEventLike(ne)&&EventHelper.stop(ne,!0),W.callback(G.href)},J=W.disposables.add(new DomEmitter(X,EventType$1.CLICK)).event,ee=W.disposables.add(new DomEmitter(X,EventType$1.KEY_DOWN)).event,te=Event$1.chain(ee,ne=>ne.filter(oe=>{const re=new StandardKeyboardEvent(oe);return re.equals(10)||re.equals(3)}));W.disposables.add(Gesture.addTarget(X));const ie=W.disposables.add(new DomEmitter(X,EventType.Tap)).event;Event$1.any(J,ie,te)(Q,null,W.disposables),C.appendChild(X)}}var __decorate$1H=globalThis&&globalThis.__decorate||function(K,C,W,V){var U=arguments.length,G=U<3?C:V===null?V=Object.getOwnPropertyDescriptor(C,W):V,Z;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")G=Reflect.decorate(K,C,W,V);else for(var X=K.length-1;X>=0;X--)(Z=K[X])&&(G=(U<3?Z(G):U>3?Z(C,W,G):Z(C,W))||G);return U>3&&G&&Object.defineProperty(C,W,G),G},__awaiter$1i=globalThis&&globalThis.__awaiter||function(K,C,W,V){function U(G){return G instanceof W?G:new W(function(Z){Z(G)})}return new(W||(W=Promise))(function(G,Z){function X(ee){try{J(V.next(ee))}catch(te){Z(te)}}function Q(ee){try{J(V.throw(ee))}catch(te){Z(te)}}function J(ee){ee.done?G(ee.value):U(ee.value).then(X,Q)}J((V=V.apply(K,C||[])).next())})};const $$8=$$d;class ListElement{constructor(C,W,V,U,G,Z,X){var Q,J,ee;this._checked=!1,this._hidden=!1,this.hasCheckbox=U,this.index=V,this.fireButtonTriggered=G,this.fireSeparatorButtonTriggered=Z,this._onChecked=X,this.onChecked=U?Event$1.map(Event$1.filter(this._onChecked.event,te=>te.listElement===this),te=>te.checked):Event$1.None,C.type==="separator"?this._separator=C:(this.item=C,W&&W.type==="separator"&&!W.buttons&&(this._separator=W),this.saneDescription=this.item.description,this.saneDetail=this.item.detail,this._labelHighlights=(Q=this.item.highlights)===null||Q===void 0?void 0:Q.label,this._descriptionHighlights=(J=this.item.highlights)===null||J===void 0?void 0:J.description,this._detailHighlights=(ee=this.item.highlights)===null||ee===void 0?void 0:ee.detail,this.saneTooltip=this.item.tooltip),this._init=new Lazy(()=>{var te;const ie=(te=C.label)!==null&&te!==void 0?te:"",ne=parseLabelWithIcons(ie).text.trim(),oe=C.ariaLabel||[ie,this.saneDescription,this.saneDetail].map(re=>getCodiconAriaLabel(re)).filter(re=>!!re).join(", ");return{saneLabel:ie,saneSortLabel:ne,saneAriaLabel:oe}})}get saneLabel(){return this._init.value.saneLabel}get saneSortLabel(){return this._init.value.saneSortLabel}get saneAriaLabel(){return this._init.value.saneAriaLabel}get element(){return this._element}set element(C){this._element=C}get hidden(){return this._hidden}set hidden(C){this._hidden=C}get checked(){return this._checked}set checked(C){C!==this._checked&&(this._checked=C,this._onChecked.fire({listElement:this,checked:C}))}get separator(){return this._separator}set separator(C){this._separator=C}get labelHighlights(){return this._labelHighlights}set labelHighlights(C){this._labelHighlights=C}get descriptionHighlights(){return this._descriptionHighlights}set descriptionHighlights(C){this._descriptionHighlights=C}get detailHighlights(){return this._detailHighlights}set detailHighlights(C){this._detailHighlights=C}}class ListElementRenderer{constructor(C){this.themeService=C}get templateId(){return ListElementRenderer.ID}renderTemplate(C){const W=Object.create(null);W.toDisposeElement=[],W.toDisposeTemplate=[],W.entry=append$3(C,$$8(".quick-input-list-entry"));const V=append$3(W.entry,$$8("label.quick-input-list-label"));W.toDisposeTemplate.push(addStandardDisposableListener(V,EventType$1.CLICK,J=>{W.checkbox.offsetParent||J.preventDefault()})),W.checkbox=append$3(V,$$8("input.quick-input-list-checkbox")),W.checkbox.type="checkbox",W.toDisposeTemplate.push(addStandardDisposableListener(W.checkbox,EventType$1.CHANGE,J=>{W.element.checked=W.checkbox.checked}));const U=append$3(V,$$8(".quick-input-list-rows")),G=append$3(U,$$8(".quick-input-list-row")),Z=append$3(U,$$8(".quick-input-list-row"));W.label=new IconLabel(G,{supportHighlights:!0,supportDescriptionHighlights:!0,supportIcons:!0}),W.toDisposeTemplate.push(W.label),W.icon=prepend$3(W.label.element,$$8(".quick-input-list-icon"));const X=append$3(G,$$8(".quick-input-list-entry-keybinding"));W.keybinding=new KeybindingLabel(X,OS);const Q=append$3(Z,$$8(".quick-input-list-label-meta"));return W.detail=new IconLabel(Q,{supportHighlights:!0,supportIcons:!0}),W.toDisposeTemplate.push(W.detail),W.separator=append$3(W.entry,$$8(".quick-input-list-separator")),W.actionBar=new ActionBar(W.entry),W.actionBar.domNode.classList.add("quick-input-list-entry-action-bar"),W.toDisposeTemplate.push(W.actionBar),W}renderElement(C,W,V){var U,G,Z,X;V.element=C,C.element=(U=V.entry)!==null&&U!==void 0?U:void 0;const Q=C.item?C.item:C.separator;V.checkbox.checked=C.checked,V.toDisposeElement.push(C.onChecked(oe=>V.checkbox.checked=oe));const{labelHighlights:J,descriptionHighlights:ee,detailHighlights:te}=C;if(!((G=C.item)===null||G===void 0)&&G.iconPath){const oe=isDark(this.themeService.getColorTheme().type)?C.item.iconPath.dark:(Z=C.item.iconPath.light)!==null&&Z!==void 0?Z:C.item.iconPath.dark,re=URI.revive(oe);V.icon.className="quick-input-list-icon",V.icon.style.backgroundImage=asCSSUrl(re)}else V.icon.style.backgroundImage="",V.icon.className=!((X=C.item)===null||X===void 0)&&X.iconClass?`quick-input-list-icon ${C.item.iconClass}`:"";const ie={matches:J||[],descriptionTitle:C.saneDescription,descriptionMatches:ee||[],labelEscapeNewLines:!0};Q.type!=="separator"?(ie.extraClasses=Q.iconClasses,ie.italic=Q.italic,ie.strikethrough=Q.strikethrough,V.entry.classList.remove("quick-input-list-separator-as-item")):V.entry.classList.add("quick-input-list-separator-as-item"),V.label.setLabel(C.saneLabel,C.saneDescription,ie),V.keybinding.set(Q.type==="separator"?void 0:Q.keybinding),C.saneDetail?(V.detail.element.style.display="",V.detail.setLabel(C.saneDetail,void 0,{matches:te,title:C.saneDetail,labelEscapeNewLines:!0})):V.detail.element.style.display="none",C.item&&C.separator&&C.separator.label?(V.separator.textContent=C.separator.label,V.separator.style.display=""):V.separator.style.display="none",V.entry.classList.toggle("quick-input-list-separator-border",!!C.separator);const ne=Q.buttons;ne&&ne.length?(V.actionBar.push(ne.map((oe,re)=>{let ae=oe.iconClass||(oe.iconPath?getIconClass(oe.iconPath):void 0);return oe.alwaysVisible&&(ae=ae?`${ae} always-visible`:"always-visible"),{id:`id-${re}`,class:ae,enabled:!0,label:"",tooltip:oe.tooltip||"",run:()=>{Q.type!=="separator"?C.fireButtonTriggered({button:oe,item:Q}):C.fireSeparatorButtonTriggered({button:oe,separator:Q})}}}),{icon:!0,label:!1}),V.entry.classList.add("has-actions")):V.entry.classList.remove("has-actions")}disposeElement(C,W,V){V.toDisposeElement=dispose(V.toDisposeElement),V.actionBar.clear()}disposeTemplate(C){C.toDisposeElement=dispose(C.toDisposeElement),C.toDisposeTemplate=dispose(C.toDisposeTemplate)}}ListElementRenderer.ID="listelement";class ListElementDelegate{getHeight(C){return C.item?C.saneDetail?44:22:24}getTemplateId(C){return ListElementRenderer.ID}}var QuickInputListFocus;(function(K){K[K.First=1]="First",K[K.Second=2]="Second",K[K.Last=3]="Last",K[K.Next=4]="Next",K[K.Previous=5]="Previous",K[K.NextPage=6]="NextPage",K[K.PreviousPage=7]="PreviousPage"})(QuickInputListFocus||(QuickInputListFocus={}));class QuickInputList{constructor(C,W,V,U){this.parent=C,this.options=V,this.inputElements=[],this.elements=[],this.elementsToIndexes=new Map,this.matchOnDescription=!1,this.matchOnDetail=!1,this.matchOnLabel=!0,this.matchOnLabelMode="fuzzy",this.sortByLabel=!0,this._onChangedAllVisibleChecked=new Emitter$1,this.onChangedAllVisibleChecked=this._onChangedAllVisibleChecked.event,this._onChangedCheckedCount=new Emitter$1,this.onChangedCheckedCount=this._onChangedCheckedCount.event,this._onChangedVisibleCount=new Emitter$1,this.onChangedVisibleCount=this._onChangedVisibleCount.event,this._onChangedCheckedElements=new Emitter$1,this.onChangedCheckedElements=this._onChangedCheckedElements.event,this._onButtonTriggered=new Emitter$1,this.onButtonTriggered=this._onButtonTriggered.event,this._onSeparatorButtonTriggered=new Emitter$1,this.onSeparatorButtonTriggered=this._onSeparatorButtonTriggered.event,this._onKeyDown=new Emitter$1,this.onKeyDown=this._onKeyDown.event,this._onLeave=new Emitter$1,this.onLeave=this._onLeave.event,this._listElementChecked=new Emitter$1,this._fireCheckedEvents=!0,this.elementDisposables=[],this.disposables=[],this.id=W,this.container=append$3(this.parent,$$8(".quick-input-list"));const G=new ListElementDelegate,Z=new QuickInputAccessibilityProvider;if(this.list=V.createList("QuickInput",this.container,G,[new ListElementRenderer(U)],{identityProvider:{getId:X=>{var Q,J,ee,te,ie,ne,oe,re;return(re=(ne=(te=(J=(Q=X.item)===null||Q===void 0?void 0:Q.id)!==null&&J!==void 0?J:(ee=X.item)===null||ee===void 0?void 0:ee.label)!==null&&te!==void 0?te:(ie=X.separator)===null||ie===void 0?void 0:ie.id)!==null&&ne!==void 0?ne:(oe=X.separator)===null||oe===void 0?void 0:oe.label)!==null&&re!==void 0?re:""}},setRowLineHeight:!1,multipleSelectionSupport:!1,horizontalScrolling:!1,accessibilityProvider:Z}),this.list.getHTMLElement().id=W,this.disposables.push(this.list),this.disposables.push(this.list.onKeyDown(X=>{const Q=new StandardKeyboardEvent(X);switch(Q.keyCode){case 10:this.toggleCheckbox();break;case 31:(isMacintosh?X.metaKey:X.ctrlKey)&&this.list.setFocus(range$2(this.list.length));break;case 16:{const J=this.list.getFocus();J.length===1&&J[0]===0&&this._onLeave.fire();break}case 18:{const J=this.list.getFocus();J.length===1&&J[0]===this.list.length-1&&this._onLeave.fire();break}}this._onKeyDown.fire(Q)})),this.disposables.push(this.list.onMouseDown(X=>{X.browserEvent.button!==2&&X.browserEvent.preventDefault()})),this.disposables.push(addDisposableListener(this.container,EventType$1.CLICK,X=>{(X.x||X.y)&&this._onLeave.fire()})),this.disposables.push(this.list.onMouseMiddleClick(X=>{this._onLeave.fire()})),this.disposables.push(this.list.onContextMenu(X=>{typeof X.index=="number"&&(X.browserEvent.preventDefault(),this.list.setSelection([X.index]))})),V.hoverDelegate){const X=new ThrottledDelayer(V.hoverDelegate.delay);this.disposables.push(this.list.onMouseOver(Q=>__awaiter$1i(this,void 0,void 0,function*(){var J;if(Q.browserEvent.target instanceof HTMLAnchorElement){X.cancel();return}if(!(!(Q.browserEvent.relatedTarget instanceof HTMLAnchorElement)&&isAncestor$1(Q.browserEvent.relatedTarget,(J=Q.element)===null||J===void 0?void 0:J.element)))try{yield X.trigger(()=>__awaiter$1i(this,void 0,void 0,function*(){Q.element&&this.showHover(Q.element)}))}catch(ee){if(!isCancellationError(ee))throw ee}}))),this.disposables.push(this.list.onMouseOut(Q=>{var J;isAncestor$1(Q.browserEvent.relatedTarget,(J=Q.element)===null||J===void 0?void 0:J.element)||X.cancel()})),this.disposables.push(X)}this.disposables.push(this._listElementChecked.event(X=>this.fireCheckedEvents())),this.disposables.push(this._onChangedAllVisibleChecked,this._onChangedCheckedCount,this._onChangedVisibleCount,this._onChangedCheckedElements,this._onButtonTriggered,this._onSeparatorButtonTriggered,this._onLeave,this._onKeyDown)}get onDidChangeFocus(){return Event$1.map(this.list.onDidChangeFocus,C=>C.elements.map(W=>W.item))}get onDidChangeSelection(){return Event$1.map(this.list.onDidChangeSelection,C=>({items:C.elements.map(W=>W.item),event:C.browserEvent}))}get scrollTop(){return this.list.scrollTop}set scrollTop(C){this.list.scrollTop=C}get ariaLabel(){return this.list.getHTMLElement().ariaLabel}set ariaLabel(C){this.list.getHTMLElement().ariaLabel=C}getAllVisibleChecked(){return this.allVisibleChecked(this.elements,!1)}allVisibleChecked(C,W=!0){for(let V=0,U=C.length;V<U;V++){const G=C[V];if(!G.hidden)if(G.checked)W=!0;else return!1}return W}getCheckedCount(){let C=0;const W=this.elements;for(let V=0,U=W.length;V<U;V++)W[V].checked&&C++;return C}getVisibleCount(){let C=0;const W=this.elements;for(let V=0,U=W.length;V<U;V++)W[V].hidden||C++;return C}setAllVisibleChecked(C){try{this._fireCheckedEvents=!1,this.elements.forEach(W=>{W.hidden||(W.checked=C)})}finally{this._fireCheckedEvents=!0,this.fireCheckedEvents()}}setElements(C){this.elementDisposables=dispose(this.elementDisposables);const W=Z=>this.fireButtonTriggered(Z),V=Z=>this.fireSeparatorButtonTriggered(Z);this.inputElements=C;const U=new Map,G=this.parent.classList.contains("show-checkboxes");this.elements=C.reduce((Z,X,Q)=>{var J;const ee=Q>0?C[Q-1]:void 0;if(X.type==="separator"&&!X.buttons)return Z;const te=new ListElement(X,ee,Q,G,W,V,this._listElementChecked),ie=Z.length;return Z.push(te),U.set((J=te.item)!==null&&J!==void 0?J:te.separator,ie),Z},[]),this.elementsToIndexes=U,this.list.splice(0,this.list.length),this.list.splice(0,this.list.length,this.elements),this._onChangedVisibleCount.fire(this.elements.length)}getFocusedElements(){return this.list.getFocusedElements().map(C=>C.item)}setFocusedElements(C){if(this.list.setFocus(C.filter(W=>this.elementsToIndexes.has(W)).map(W=>this.elementsToIndexes.get(W))),C.length>0){const W=this.list.getFocus()[0];typeof W=="number"&&this.list.reveal(W)}}getActiveDescendant(){return this.list.getHTMLElement().getAttribute("aria-activedescendant")}setSelectedElements(C){this.list.setSelection(C.filter(W=>this.elementsToIndexes.has(W)).map(W=>this.elementsToIndexes.get(W)))}getCheckedElements(){return this.elements.filter(C=>C.checked).map(C=>C.item).filter(C=>!!C)}setCheckedElements(C){try{this._fireCheckedEvents=!1;const W=new Set;for(const V of C)W.add(V);for(const V of this.elements)V.checked=W.has(V.item)}finally{this._fireCheckedEvents=!0,this.fireCheckedEvents()}}set enabled(C){this.list.getHTMLElement().style.pointerEvents=C?"":"none"}focus(C){if(!this.list.length)return;switch(C===QuickInputListFocus.Second&&this.list.length<2&&(C=QuickInputListFocus.First),C){case QuickInputListFocus.First:this.list.scrollTop=0,this.list.focusFirst(void 0,V=>!!V.item);break;case QuickInputListFocus.Second:this.list.scrollTop=0,this.list.focusNth(1,void 0,V=>!!V.item);break;case QuickInputListFocus.Last:this.list.scrollTop=this.list.scrollHeight,this.list.focusLast(void 0,V=>!!V.item);break;case QuickInputListFocus.Next:{this.list.focusNext(void 0,!0,void 0,U=>!!U.item);const V=this.list.getFocus()[0];V!==0&&!this.elements[V-1].item&&this.list.firstVisibleIndex>V-1&&this.list.reveal(V-1);break}case QuickInputListFocus.Previous:{this.list.focusPrevious(void 0,!0,void 0,U=>!!U.item);const V=this.list.getFocus()[0];V!==0&&!this.elements[V-1].item&&this.list.firstVisibleIndex>V-1&&this.list.reveal(V-1);break}case QuickInputListFocus.NextPage:this.list.focusNextPage(void 0,V=>!!V.item);break;case QuickInputListFocus.PreviousPage:this.list.focusPreviousPage(void 0,V=>!!V.item);break}const W=this.list.getFocus()[0];typeof W=="number"&&this.list.reveal(W)}clearFocus(){this.list.setFocus([])}domFocus(){this.list.domFocus()}showHover(C){var W,V,U;this.options.hoverDelegate!==void 0&&(this._lastHover&&!this._lastHover.isDisposed&&((V=(W=this.options.hoverDelegate).onDidHideHover)===null||V===void 0||V.call(W),(U=this._lastHover)===null||U===void 0||U.dispose()),!(!C.element||!C.saneTooltip)&&(this._lastHover=this.options.hoverDelegate.showHover({content:C.saneTooltip,target:C.element,linkHandler:G=>{this.options.linkOpenerDelegate(G)},showPointer:!0,container:this.container,hoverPosition:1},!1)))}layout(C){this.list.getHTMLElement().style.maxHeight=C?`${Math.floor(C/44)*44+6}px`:"",this.list.layout()}filter(C){if(!(this.sortByLabel||this.matchOnLabel||this.matchOnDescription||this.matchOnDetail))return this.list.layout(),!1;const W=C;if(C=C.trim(),!C||!(this.matchOnLabel||this.matchOnDescription||this.matchOnDetail))this.elements.forEach(U=>{U.labelHighlights=void 0,U.descriptionHighlights=void 0,U.detailHighlights=void 0,U.hidden=!1;const G=U.index&&this.inputElements[U.index-1];U.item&&(U.separator=G&&G.type==="separator"&&!G.buttons?G:void 0)});else{let U;this.elements.forEach(G=>{var Z,X,Q,J;let ee;this.matchOnLabelMode==="fuzzy"?ee=this.matchOnLabel&&(Z=matchesFuzzyIconAware(C,parseLabelWithIcons(G.saneLabel)))!==null&&Z!==void 0?Z:void 0:ee=this.matchOnLabel&&(X=matchesContiguousIconAware(W,parseLabelWithIcons(G.saneLabel)))!==null&&X!==void 0?X:void 0;const te=this.matchOnDescription&&(Q=matchesFuzzyIconAware(C,parseLabelWithIcons(G.saneDescription||"")))!==null&&Q!==void 0?Q:void 0,ie=this.matchOnDetail&&(J=matchesFuzzyIconAware(C,parseLabelWithIcons(G.saneDetail||"")))!==null&&J!==void 0?J:void 0;if(ee||te||ie?(G.labelHighlights=ee,G.descriptionHighlights=te,G.detailHighlights=ie,G.hidden=!1):(G.labelHighlights=void 0,G.descriptionHighlights=void 0,G.detailHighlights=void 0,G.hidden=G.item?!G.item.alwaysShow:!0),G.item?G.separator=void 0:G.separator&&(G.hidden=!0),!this.sortByLabel){const ne=G.index&&this.inputElements[G.index-1];U=ne&&ne.type==="separator"?ne:U,U&&!G.hidden&&(G.separator=U,U=void 0)}})}const V=this.elements.filter(U=>!U.hidden);if(this.sortByLabel&&C){const U=C.toLowerCase();V.sort((G,Z)=>compareEntries(G,Z,U))}return this.elementsToIndexes=V.reduce((U,G,Z)=>{var X;return U.set((X=G.item)!==null&&X!==void 0?X:G.separator,Z),U},new Map),this.list.splice(0,this.list.length,V),this.list.setFocus([]),this.list.layout(),this._onChangedAllVisibleChecked.fire(this.getAllVisibleChecked()),this._onChangedVisibleCount.fire(V.length),!0}toggleCheckbox(){try{this._fireCheckedEvents=!1;const C=this.list.getFocusedElements(),W=this.allVisibleChecked(C);for(const V of C)V.checked=!W}finally{this._fireCheckedEvents=!0,this.fireCheckedEvents()}}display(C){this.container.style.display=C?"":"none"}isDisplayed(){return this.container.style.display!=="none"}dispose(){this.elementDisposables=dispose(this.elementDisposables),this.disposables=dispose(this.disposables)}fireCheckedEvents(){this._fireCheckedEvents&&(this._onChangedAllVisibleChecked.fire(this.getAllVisibleChecked()),this._onChangedCheckedCount.fire(this.getCheckedCount()),this._onChangedCheckedElements.fire(this.getCheckedElements()))}fireButtonTriggered(C){this._onButtonTriggered.fire(C)}fireSeparatorButtonTriggered(C){this._onSeparatorButtonTriggered.fire(C)}style(C){this.list.style(C)}toggleHover(){const C=this.list.getFocusedElements()[0];if(!(C!=null&&C.saneTooltip))return;if(this._lastHover&&!this._lastHover.isDisposed){this._lastHover.dispose();return}const W=this.list.getFocusedElements()[0];if(!W)return;this.showHover(W);const V=new DisposableStore;V.add(this.list.onDidChangeFocus(U=>{U.indexes.length&&this.showHover(U.elements[0])})),this._lastHover&&V.add(this._lastHover),this._toggleHover=V,this.elementDisposables.push(this._toggleHover)}}__decorate$1H([memoize],QuickInputList.prototype,"onDidChangeFocus",null);__decorate$1H([memoize],QuickInputList.prototype,"onDidChangeSelection",null);function matchesContiguousIconAware(K,C){const{text:W,iconOffsets:V}=C;if(!V||V.length===0)return matchesContiguous(K,W);const U=ltrim(W," "),G=W.length-U.length,Z=matchesContiguous(K,U);if(Z)for(const X of Z){const Q=V[X.start+G]+G;X.start+=Q,X.end+=Q}return Z}function matchesContiguous(K,C){const W=C.toLowerCase().indexOf(K.toLowerCase());return W!==-1?[{start:W,end:W+K.length}]:null}function compareEntries(K,C,W){const V=K.labelHighlights||[],U=C.labelHighlights||[];return V.length&&!U.length?-1:!V.length&&U.length?1:V.length===0&&U.length===0?0:compareAnything(K.saneSortLabel,C.saneSortLabel,W)}class QuickInputAccessibilityProvider{getWidgetAriaLabel(){return localize("quickInput","Quick Input")}getAriaLabel(C){var W;return!((W=C.separator)===null||W===void 0)&&W.label?`${C.saneAriaLabel}, ${C.separator.label}`:C.saneAriaLabel}getWidgetRole(){return"listbox"}getRole(C){return C.hasCheckbox?"checkbox":"option"}isChecked(C){if(C.hasCheckbox)return{value:C.checked,onDidChange:C.onChecked}}}var __awaiter$1h=globalThis&&globalThis.__awaiter||function(K,C,W,V){function U(G){return G instanceof W?G:new W(function(Z){Z(G)})}return new(W||(W=Promise))(function(G,Z){function X(ee){try{J(V.next(ee))}catch(te){Z(te)}}function Q(ee){try{J(V.throw(ee))}catch(te){Z(te)}}function J(ee){ee.done?G(ee.value):U(ee.value).then(X,Q)}J((V=V.apply(K,C||[])).next())})};const backButton={iconClass:ThemeIcon.asClassName(Codicon.quickInputBack),tooltip:localize("quickInput.back","Back"),handle:-1};class QuickInput extends Disposable{constructor(C){super(),this.ui=C,this._widgetUpdated=!1,this.visible=!1,this._enabled=!0,this._busy=!1,this._ignoreFocusOut=!1,this._buttons=[],this.buttonsUpdated=!1,this._toggles=[],this.togglesUpdated=!1,this.noValidationMessage=QuickInput.noPromptMessage,this._severity=Severity$2.Ignore,this.onDidTriggerButtonEmitter=this._register(new Emitter$1),this.onDidHideEmitter=this._register(new Emitter$1),this.onDisposeEmitter=this._register(new Emitter$1),this.visibleDisposables=this._register(new DisposableStore),this.onDidHide=this.onDidHideEmitter.event}get title(){return this._title}set title(C){this._title=C,this.update()}get description(){return this._description}set description(C){this._description=C,this.update()}get step(){return this._steps}set step(C){this._steps=C,this.update()}get totalSteps(){return this._totalSteps}set totalSteps(C){this._totalSteps=C,this.update()}get enabled(){return this._enabled}set enabled(C){this._enabled=C,this.update()}get contextKey(){return this._contextKey}set contextKey(C){this._contextKey=C,this.update()}get busy(){return this._busy}set busy(C){this._busy=C,this.update()}get ignoreFocusOut(){return this._ignoreFocusOut}set ignoreFocusOut(C){const W=this._ignoreFocusOut!==C&&!isIOS;this._ignoreFocusOut=C&&!isIOS,W&&this.update()}get buttons(){return this._buttons}set buttons(C){this._buttons=C,this.buttonsUpdated=!0,this.update()}get toggles(){return this._toggles}set toggles(C){this._toggles=C??[],this.togglesUpdated=!0,this.update()}get validationMessage(){return this._validationMessage}set validationMessage(C){this._validationMessage=C,this.update()}get severity(){return this._severity}set severity(C){this._severity=C,this.update()}show(){this.visible||(this.visibleDisposables.add(this.ui.onDidTriggerButton(C=>{this.buttons.indexOf(C)!==-1&&this.onDidTriggerButtonEmitter.fire(C)})),this.ui.show(this),this.visible=!0,this._lastValidationMessage=void 0,this._lastSeverity=void 0,this.buttons.length&&(this.buttonsUpdated=!0),this.toggles.length&&(this.togglesUpdated=!0),this.update())}hide(){this.visible&&this.ui.hide()}didHide(C=QuickInputHideReason.Other){this.visible=!1,this.visibleDisposables.clear(),this.onDidHideEmitter.fire({reason:C})}update(){var C,W;if(!this.visible)return;const V=this.getTitle();V&&this.ui.title.textContent!==V?this.ui.title.textContent=V:!V&&this.ui.title.innerHTML!=="&nbsp;"&&(this.ui.title.innerText=" ");const U=this.getDescription();if(this.ui.description1.textContent!==U&&(this.ui.description1.textContent=U),this.ui.description2.textContent!==U&&(this.ui.description2.textContent=U),this._widgetUpdated&&(this._widgetUpdated=!1,this._widget?reset(this.ui.widget,this._widget):reset(this.ui.widget)),this.busy&&!this.busyDelay&&(this.busyDelay=new TimeoutTimer,this.busyDelay.setIfNotSet(()=>{this.visible&&this.ui.progressBar.infinite()},800)),!this.busy&&this.busyDelay&&(this.ui.progressBar.stop(),this.busyDelay.cancel(),this.busyDelay=void 0),this.buttonsUpdated){this.buttonsUpdated=!1,this.ui.leftActionBar.clear();const Z=this.buttons.filter(Q=>Q===backButton);this.ui.leftActionBar.push(Z.map((Q,J)=>{const ee=new Action(`id-${J}`,"",Q.iconClass||getIconClass(Q.iconPath),!0,()=>__awaiter$1h(this,void 0,void 0,function*(){this.onDidTriggerButtonEmitter.fire(Q)}));return ee.tooltip=Q.tooltip||"",ee}),{icon:!0,label:!1}),this.ui.rightActionBar.clear();const X=this.buttons.filter(Q=>Q!==backButton);this.ui.rightActionBar.push(X.map((Q,J)=>{const ee=new Action(`id-${J}`,"",Q.iconClass||getIconClass(Q.iconPath),!0,()=>__awaiter$1h(this,void 0,void 0,function*(){this.onDidTriggerButtonEmitter.fire(Q)}));return ee.tooltip=Q.tooltip||"",ee}),{icon:!0,label:!1})}if(this.togglesUpdated){this.togglesUpdated=!1;const Z=(W=(C=this.toggles)===null||C===void 0?void 0:C.filter(X=>X instanceof Toggle))!==null&&W!==void 0?W:[];this.ui.inputBox.toggles=Z}this.ui.ignoreFocusOut=this.ignoreFocusOut,this.ui.setEnabled(this.enabled),this.ui.setContextKey(this.contextKey);const G=this.validationMessage||this.noValidationMessage;this._lastValidationMessage!==G&&(this._lastValidationMessage=G,reset(this.ui.message),renderQuickInputDescription(G,this.ui.message,{callback:Z=>{this.ui.linkOpenerDelegate(Z)},disposables:this.visibleDisposables})),this._lastSeverity!==this.severity&&(this._lastSeverity=this.severity,this.showMessageDecoration(this.severity))}getTitle(){return this.title&&this.step?`${this.title} (${this.getSteps()})`:this.title?this.title:this.step?this.getSteps():""}getDescription(){return this.description||""}getSteps(){return this.step&&this.totalSteps?localize("quickInput.steps","{0}/{1}",this.step,this.totalSteps):this.step?String(this.step):""}showMessageDecoration(C){if(this.ui.inputBox.showDecoration(C),C!==Severity$2.Ignore){const W=this.ui.inputBox.stylesForType(C);this.ui.message.style.color=W.foreground?`${W.foreground}`:"",this.ui.message.style.backgroundColor=W.background?`${W.background}`:"",this.ui.message.style.border=W.border?`1px solid ${W.border}`:"",this.ui.message.style.marginBottom="-2px"}else this.ui.message.style.color="",this.ui.message.style.backgroundColor="",this.ui.message.style.border="",this.ui.message.style.marginBottom=""}dispose(){this.hide(),this.onDisposeEmitter.fire(),super.dispose()}}QuickInput.noPromptMessage=localize("inputModeEntry","Press 'Enter' to confirm your input or 'Escape' to cancel");class QuickPick extends QuickInput{constructor(){super(...arguments),this._value="",this.onDidChangeValueEmitter=this._register(new Emitter$1),this.onWillAcceptEmitter=this._register(new Emitter$1),this.onDidAcceptEmitter=this._register(new Emitter$1),this.onDidCustomEmitter=this._register(new Emitter$1),this._items=[],this.itemsUpdated=!1,this._canSelectMany=!1,this._canAcceptInBackground=!1,this._matchOnDescription=!1,this._matchOnDetail=!1,this._matchOnLabel=!0,this._matchOnLabelMode="fuzzy",this._sortByLabel=!0,this._autoFocusOnList=!0,this._keepScrollPosition=!1,this._itemActivation=ItemActivation.FIRST,this._activeItems=[],this.activeItemsUpdated=!1,this.activeItemsToConfirm=[],this.onDidChangeActiveEmitter=this._register(new Emitter$1),this._selectedItems=[],this.selectedItemsUpdated=!1,this.selectedItemsToConfirm=[],this.onDidChangeSelectionEmitter=this._register(new Emitter$1),this.onDidTriggerItemButtonEmitter=this._register(new Emitter$1),this.onDidTriggerSeparatorButtonEmitter=this._register(new Emitter$1),this.valueSelectionUpdated=!0,this._ok="default",this._customButton=!1,this.filterValue=C=>C,this.onDidChangeValue=this.onDidChangeValueEmitter.event,this.onWillAccept=this.onWillAcceptEmitter.event,this.onDidAccept=this.onDidAcceptEmitter.event,this.onDidChangeActive=this.onDidChangeActiveEmitter.event,this.onDidChangeSelection=this.onDidChangeSelectionEmitter.event,this.onDidTriggerItemButton=this.onDidTriggerItemButtonEmitter.event,this.onDidTriggerSeparatorButton=this.onDidTriggerSeparatorButtonEmitter.event}get quickNavigate(){return this._quickNavigate}set quickNavigate(C){this._quickNavigate=C,this.update()}get value(){return this._value}set value(C){this.doSetValue(C)}doSetValue(C,W){this._value!==C&&(this._value=C,W||this.update(),this.visible&&this.ui.list.filter(this.filterValue(this._value))&&this.trySelectFirst(),this.onDidChangeValueEmitter.fire(this._value))}set ariaLabel(C){this._ariaLabel=C,this.update()}get ariaLabel(){return this._ariaLabel}get placeholder(){return this._placeholder}set placeholder(C){this._placeholder=C,this.update()}get items(){return this._items}get scrollTop(){return this.ui.list.scrollTop}set scrollTop(C){this.ui.list.scrollTop=C}set items(C){this._items=C,this.itemsUpdated=!0,this.update()}get canSelectMany(){return this._canSelectMany}set canSelectMany(C){this._canSelectMany=C,this.update()}get canAcceptInBackground(){return this._canAcceptInBackground}set canAcceptInBackground(C){this._canAcceptInBackground=C}get matchOnDescription(){return this._matchOnDescription}set matchOnDescription(C){this._matchOnDescription=C,this.update()}get matchOnDetail(){return this._matchOnDetail}set matchOnDetail(C){this._matchOnDetail=C,this.update()}get matchOnLabel(){return this._matchOnLabel}set matchOnLabel(C){this._matchOnLabel=C,this.update()}get matchOnLabelMode(){return this._matchOnLabelMode}set matchOnLabelMode(C){this._matchOnLabelMode=C,this.update()}get sortByLabel(){return this._sortByLabel}set sortByLabel(C){this._sortByLabel=C,this.update()}get autoFocusOnList(){return this._autoFocusOnList}set autoFocusOnList(C){this._autoFocusOnList=C,this.update()}get keepScrollPosition(){return this._keepScrollPosition}set keepScrollPosition(C){this._keepScrollPosition=C}get itemActivation(){return this._itemActivation}set itemActivation(C){this._itemActivation=C}get activeItems(){return this._activeItems}set activeItems(C){this._activeItems=C,this.activeItemsUpdated=!0,this.update()}get selectedItems(){return this._selectedItems}set selectedItems(C){this._selectedItems=C,this.selectedItemsUpdated=!0,this.update()}get keyMods(){return this._quickNavigate?NO_KEY_MODS:this.ui.keyMods}set valueSelection(C){this._valueSelection=C,this.valueSelectionUpdated=!0,this.update()}get customButton(){return this._customButton}set customButton(C){this._customButton=C,this.update()}get customLabel(){return this._customButtonLabel}set customLabel(C){this._customButtonLabel=C,this.update()}get customHover(){return this._customButtonHover}set customHover(C){this._customButtonHover=C,this.update()}get ok(){return this._ok}set ok(C){this._ok=C,this.update()}get hideInput(){return!!this._hideInput}set hideInput(C){this._hideInput=C,this.update()}trySelectFirst(){this.autoFocusOnList&&(this.canSelectMany||this.ui.list.focus(QuickInputListFocus.First))}show(){this.visible||(this.visibleDisposables.add(this.ui.inputBox.onDidChange(C=>{this.doSetValue(C,!0)})),this.visibleDisposables.add(this.ui.inputBox.onMouseDown(C=>{this.autoFocusOnList||this.ui.list.clearFocus()})),this.visibleDisposables.add((this._hideInput?this.ui.list:this.ui.inputBox).onKeyDown(C=>{switch(C.keyCode){case 18:this.ui.list.focus(QuickInputListFocus.Next),this.canSelectMany&&this.ui.list.domFocus(),EventHelper.stop(C,!0);break;case 16:this.ui.list.getFocusedElements().length?this.ui.list.focus(QuickInputListFocus.Previous):this.ui.list.focus(QuickInputListFocus.Last),this.canSelectMany&&this.ui.list.domFocus(),EventHelper.stop(C,!0);break;case 12:this.ui.list.focus(QuickInputListFocus.NextPage),this.canSelectMany&&this.ui.list.domFocus(),EventHelper.stop(C,!0);break;case 11:this.ui.list.focus(QuickInputListFocus.PreviousPage),this.canSelectMany&&this.ui.list.domFocus(),EventHelper.stop(C,!0);break;case 17:if(!this._canAcceptInBackground||!this.ui.inputBox.isSelectionAtEnd())return;this.activeItems[0]&&(this._selectedItems=[this.activeItems[0]],this.onDidChangeSelectionEmitter.fire(this.selectedItems),this.handleAccept(!0));break;case 14:(C.ctrlKey||C.metaKey)&&!C.shiftKey&&!C.altKey&&(this.ui.list.focus(QuickInputListFocus.First),EventHelper.stop(C,!0));break;case 13:(C.ctrlKey||C.metaKey)&&!C.shiftKey&&!C.altKey&&(this.ui.list.focus(QuickInputListFocus.Last),EventHelper.stop(C,!0));break}})),this.visibleDisposables.add(this.ui.onDidAccept(()=>{this.canSelectMany?this.ui.list.getCheckedElements().length||(this._selectedItems=[],this.onDidChangeSelectionEmitter.fire(this.selectedItems)):this.activeItems[0]&&(this._selectedItems=[this.activeItems[0]],this.onDidChangeSelectionEmitter.fire(this.selectedItems)),this.handleAccept(!1)})),this.visibleDisposables.add(this.ui.onDidCustom(()=>{this.onDidCustomEmitter.fire()})),this.visibleDisposables.add(this.ui.list.onDidChangeFocus(C=>{this.activeItemsUpdated||this.activeItemsToConfirm!==this._activeItems&&equals$5(C,this._activeItems,(W,V)=>W===V)||(this._activeItems=C,this.onDidChangeActiveEmitter.fire(C))})),this.visibleDisposables.add(this.ui.list.onDidChangeSelection(({items:C,event:W})=>{if(this.canSelectMany){C.length&&this.ui.list.setSelectedElements([]);return}this.selectedItemsToConfirm!==this._selectedItems&&equals$5(C,this._selectedItems,(V,U)=>V===U)||(this._selectedItems=C,this.onDidChangeSelectionEmitter.fire(C),C.length&&this.handleAccept(W instanceof MouseEvent&&W.button===1))})),this.visibleDisposables.add(this.ui.list.onChangedCheckedElements(C=>{this.canSelectMany&&(this.selectedItemsToConfirm!==this._selectedItems&&equals$5(C,this._selectedItems,(W,V)=>W===V)||(this._selectedItems=C,this.onDidChangeSelectionEmitter.fire(C)))})),this.visibleDisposables.add(this.ui.list.onButtonTriggered(C=>this.onDidTriggerItemButtonEmitter.fire(C))),this.visibleDisposables.add(this.ui.list.onSeparatorButtonTriggered(C=>this.onDidTriggerSeparatorButtonEmitter.fire(C))),this.visibleDisposables.add(this.registerQuickNavigation()),this.valueSelectionUpdated=!0),super.show()}handleAccept(C){let W=!1;this.onWillAcceptEmitter.fire({veto:()=>W=!0}),W||this.onDidAcceptEmitter.fire({inBackground:C})}registerQuickNavigation(){return addDisposableListener(this.ui.container,EventType$1.KEY_UP,C=>{if(this.canSelectMany||!this._quickNavigate)return;const W=new StandardKeyboardEvent(C),V=W.keyCode;this._quickNavigate.keybindings.some(Z=>{const X=Z.getChords();return X.length>1?!1:X[0].shiftKey&&V===4?!(W.ctrlKey||W.altKey||W.metaKey):!!(X[0].altKey&&V===6||X[0].ctrlKey&&V===5||X[0].metaKey&&V===57)})&&(this.activeItems[0]&&(this._selectedItems=[this.activeItems[0]],this.onDidChangeSelectionEmitter.fire(this.selectedItems),this.handleAccept(!1)),this._quickNavigate=void 0)})}update(){if(!this.visible)return;const C=this.keepScrollPosition?this.scrollTop:0,W=!!this.description,V={title:!!this.title||!!this.step||!!this.buttons.length,description:W,checkAll:this.canSelectMany&&!this._hideCheckAll,checkBox:this.canSelectMany,inputBox:!this._hideInput,progressBar:!this._hideInput||W,visibleCount:!0,count:this.canSelectMany&&!this._hideCountBadge,ok:this.ok==="default"?this.canSelectMany:this.ok,list:!0,message:!!this.validationMessage,customButton:this.customButton};this.ui.setVisibilities(V),super.update(),this.ui.inputBox.value!==this.value&&(this.ui.inputBox.value=this.value),this.valueSelectionUpdated&&(this.valueSelectionUpdated=!1,this.ui.inputBox.select(this._valueSelection&&{start:this._valueSelection[0],end:this._valueSelection[1]})),this.ui.inputBox.placeholder!==(this.placeholder||"")&&(this.ui.inputBox.placeholder=this.placeholder||"");let U=this.ariaLabel;if(!U&&V.inputBox&&(U=this.placeholder||QuickPick.DEFAULT_ARIA_LABEL,this.title&&(U+=` - ${this.title}`)),this.ui.list.ariaLabel!==U&&(this.ui.list.ariaLabel=U??null),this.ui.list.matchOnDescription=this.matchOnDescription,this.ui.list.matchOnDetail=this.matchOnDetail,this.ui.list.matchOnLabel=this.matchOnLabel,this.ui.list.matchOnLabelMode=this.matchOnLabelMode,this.ui.list.sortByLabel=this.sortByLabel,this.itemsUpdated)switch(this.itemsUpdated=!1,this.ui.list.setElements(this.items),this.ui.list.filter(this.filterValue(this.ui.inputBox.value)),this.ui.checkAll.checked=this.ui.list.getAllVisibleChecked(),this.ui.visibleCount.setCount(this.ui.list.getVisibleCount()),this.ui.count.setCount(this.ui.list.getCheckedCount()),this._itemActivation){case ItemActivation.NONE:this._itemActivation=ItemActivation.FIRST;break;case ItemActivation.SECOND:this.ui.list.focus(QuickInputListFocus.Second),this._itemActivation=ItemActivation.FIRST;break;case ItemActivation.LAST:this.ui.list.focus(QuickInputListFocus.Last),this._itemActivation=ItemActivation.FIRST;break;default:this.trySelectFirst();break}this.ui.container.classList.contains("show-checkboxes")!==!!this.canSelectMany&&(this.canSelectMany?this.ui.list.clearFocus():this.trySelectFirst()),this.activeItemsUpdated&&(this.activeItemsUpdated=!1,this.activeItemsToConfirm=this._activeItems,this.ui.list.setFocusedElements(this.activeItems),this.activeItemsToConfirm===this._activeItems&&(this.activeItemsToConfirm=null)),this.selectedItemsUpdated&&(this.selectedItemsUpdated=!1,this.selectedItemsToConfirm=this._selectedItems,this.canSelectMany?this.ui.list.setCheckedElements(this.selectedItems):this.ui.list.setSelectedElements(this.selectedItems),this.selectedItemsToConfirm===this._selectedItems&&(this.selectedItemsToConfirm=null)),this.ui.customButton.label=this.customLabel||"",this.ui.customButton.element.title=this.customHover||"",V.inputBox||(this.ui.list.domFocus(),this.canSelectMany&&this.ui.list.focus(QuickInputListFocus.First)),this.keepScrollPosition&&(this.scrollTop=C)}}QuickPick.DEFAULT_ARIA_LABEL=localize("quickInputBox.ariaLabel","Type to narrow down results.");class InputBox extends QuickInput{constructor(){super(...arguments),this._value="",this.valueSelectionUpdated=!0,this._password=!1,this.onDidValueChangeEmitter=this._register(new Emitter$1),this.onDidAcceptEmitter=this._register(new Emitter$1),this.onDidChangeValue=this.onDidValueChangeEmitter.event,this.onDidAccept=this.onDidAcceptEmitter.event}get value(){return this._value}set value(C){this._value=C||"",this.update()}get placeholder(){return this._placeholder}set placeholder(C){this._placeholder=C,this.update()}get password(){return this._password}set password(C){this._password=C,this.update()}show(){this.visible||(this.visibleDisposables.add(this.ui.inputBox.onDidChange(C=>{C!==this.value&&(this._value=C,this.onDidValueChangeEmitter.fire(C))})),this.visibleDisposables.add(this.ui.onDidAccept(()=>this.onDidAcceptEmitter.fire())),this.valueSelectionUpdated=!0),super.show()}update(){if(!this.visible)return;this.ui.container.classList.remove("hidden-input");const C={title:!!this.title||!!this.step||!!this.buttons.length,description:!!this.description||!!this.step,inputBox:!0,message:!0,progressBar:!0};this.ui.setVisibilities(C),super.update(),this.ui.inputBox.value!==this.value&&(this.ui.inputBox.value=this.value),this.valueSelectionUpdated&&(this.valueSelectionUpdated=!1,this.ui.inputBox.select(this._valueSelection&&{start:this._valueSelection[0],end:this._valueSelection[1]})),this.ui.inputBox.placeholder!==(this.placeholder||"")&&(this.ui.inputBox.placeholder=this.placeholder||""),this.ui.inputBox.password!==this.password&&(this.ui.inputBox.password=this.password)}}const $$7=$$d;class QuickInputController extends Disposable{constructor(C,W){super(),this.options=C,this.themeService=W,this.enabled=!0,this.onDidAcceptEmitter=this._register(new Emitter$1),this.onDidCustomEmitter=this._register(new Emitter$1),this.onDidTriggerButtonEmitter=this._register(new Emitter$1),this.keyMods={ctrlCmd:!1,alt:!1},this.controller=null,this.onShowEmitter=this._register(new Emitter$1),this.onShow=this.onShowEmitter.event,this.onHideEmitter=this._register(new Emitter$1),this.onHide=this.onHideEmitter.event,this.idPrefix=C.idPrefix,this.parentElement=C.container,this.styles=C.styles,this.registerKeyModsListeners()}registerKeyModsListeners(){const C=W=>{this.keyMods.ctrlCmd=W.ctrlKey||W.metaKey,this.keyMods.alt=W.altKey};this._register(addDisposableListener(window,EventType$1.KEY_DOWN,C,!0)),this._register(addDisposableListener(window,EventType$1.KEY_UP,C,!0)),this._register(addDisposableListener(window,EventType$1.MOUSE_DOWN,C,!0))}getUI(){if(this.ui)return this.ui;const C=append$3(this.parentElement,$$7(".quick-input-widget.show-file-icons"));C.tabIndex=-1,C.style.display="none";const W=createStyleSheet(C),V=append$3(C,$$7(".quick-input-titlebar")),U=this.options.hoverDelegate?{hoverDelegate:this.options.hoverDelegate}:void 0,G=this._register(new ActionBar(V,U));G.domNode.classList.add("quick-input-left-action-bar");const Z=append$3(V,$$7(".quick-input-title")),X=this._register(new ActionBar(V,U));X.domNode.classList.add("quick-input-right-action-bar");const Q=append$3(C,$$7(".quick-input-header")),J=append$3(Q,$$7("input.quick-input-check-all"));J.type="checkbox",J.setAttribute("aria-label",localize("quickInput.checkAll","Toggle all checkboxes")),this._register(addStandardDisposableListener(J,EventType$1.CHANGE,Ce=>{const De=J.checked;Le.setAllVisibleChecked(De)})),this._register(addDisposableListener(J,EventType$1.CLICK,Ce=>{(Ce.x||Ce.y)&&ne.setFocus()}));const ee=append$3(Q,$$7(".quick-input-description")),te=append$3(Q,$$7(".quick-input-and-message")),ie=append$3(te,$$7(".quick-input-filter")),ne=this._register(new QuickInputBox(ie,this.styles.inputBox,this.styles.toggle));ne.setAttribute("aria-describedby",`${this.idPrefix}message`);const oe=append$3(ie,$$7(".quick-input-visible-count"));oe.setAttribute("aria-live","polite"),oe.setAttribute("aria-atomic","true");const re=new CountBadge(oe,{countFormat:localize({key:"quickInput.visibleCount",comment:["This tells the user how many items are shown in a list of items to select from. The items can be anything. Currently not visible, but read by screen readers."]},"{0} Results")},this.styles.countBadge),ae=append$3(ie,$$7(".quick-input-count"));ae.setAttribute("aria-live","polite");const se=new CountBadge(ae,{countFormat:localize({key:"quickInput.countSelected",comment:["This tells the user how many items are selected in a list of items to select from. The items can be anything."]},"{0} Selected")},this.styles.countBadge),le=append$3(Q,$$7(".quick-input-action")),ce=this._register(new Button(le,this.styles.button));ce.label=localize("ok","OK"),this._register(ce.onDidClick(Ce=>{this.onDidAcceptEmitter.fire()}));const de=append$3(Q,$$7(".quick-input-action")),ue=this._register(new Button(de,this.styles.button));ue.label=localize("custom","Custom"),this._register(ue.onDidClick(Ce=>{this.onDidCustomEmitter.fire()}));const ge=append$3(te,$$7(`#${this.idPrefix}message.quick-input-message`)),he=this._register(new ProgressBar(C,this.styles.progressBar));he.getContainer().classList.add("quick-input-progress");const fe=append$3(C,$$7(".quick-input-html-widget"));fe.tabIndex=-1;const pe=append$3(C,$$7(".quick-input-description")),Se=this.idPrefix+"list",Le=this._register(new QuickInputList(C,Se,this.options,this.themeService));ne.setAttribute("aria-controls",Se),this._register(Le.onDidChangeFocus(()=>{var Ce;ne.setAttribute("aria-activedescendant",(Ce=Le.getActiveDescendant())!==null&&Ce!==void 0?Ce:"")})),this._register(Le.onChangedAllVisibleChecked(Ce=>{J.checked=Ce})),this._register(Le.onChangedVisibleCount(Ce=>{re.setCount(Ce)})),this._register(Le.onChangedCheckedCount(Ce=>{se.setCount(Ce)})),this._register(Le.onLeave(()=>{setTimeout(()=>{ne.setFocus(),this.controller instanceof QuickPick&&this.controller.canSelectMany&&Le.clearFocus()},0)}));const be=trackFocus(C);return this._register(be),this._register(addDisposableListener(C,EventType$1.FOCUS,Ce=>{isAncestor$1(Ce.relatedTarget,C)||(this.previousFocusElement=Ce.relatedTarget instanceof HTMLElement?Ce.relatedTarget:void 0)},!0)),this._register(be.onDidBlur(()=>{!this.getUI().ignoreFocusOut&&!this.options.ignoreFocusOut()&&this.hide(QuickInputHideReason.Blur),this.previousFocusElement=void 0})),this._register(addDisposableListener(C,EventType$1.FOCUS,Ce=>{ne.setFocus()})),this._register(addStandardDisposableListener(C,EventType$1.KEY_DOWN,Ce=>{if(!isAncestor$1(Ce.target,fe))switch(Ce.keyCode){case 3:EventHelper.stop(Ce,!0),this.enabled&&this.onDidAcceptEmitter.fire();break;case 9:EventHelper.stop(Ce,!0),this.hide(QuickInputHideReason.Gesture);break;case 2:if(!Ce.altKey&&!Ce.ctrlKey&&!Ce.metaKey){const De=[".quick-input-list .monaco-action-bar .always-visible",".quick-input-list-entry:hover .monaco-action-bar",".monaco-list-row.focused .monaco-action-bar"];if(C.classList.contains("show-checkboxes")?De.push("input"):De.push("input[type=text]"),this.getUI().list.isDisplayed()&&De.push(".monaco-list"),this.getUI().message&&De.push(".quick-input-message a"),this.getUI().widget){if(isAncestor$1(Ce.target,this.getUI().widget))break;De.push(".quick-input-html-widget")}const ke=C.querySelectorAll(De.join(", "));Ce.shiftKey&&Ce.target===ke[0]?(EventHelper.stop(Ce,!0),Le.clearFocus()):!Ce.shiftKey&&isAncestor$1(Ce.target,ke[ke.length-1])&&(EventHelper.stop(Ce,!0),ke[0].focus())}break;case 10:Ce.ctrlKey&&(EventHelper.stop(Ce,!0),this.getUI().list.toggleHover());break}})),this.ui={container:C,styleSheet:W,leftActionBar:G,titleBar:V,title:Z,description1:pe,description2:ee,widget:fe,rightActionBar:X,checkAll:J,inputContainer:te,filterContainer:ie,inputBox:ne,visibleCountContainer:oe,visibleCount:re,countContainer:ae,count:se,okContainer:le,ok:ce,message:ge,customButtonContainer:de,customButton:ue,list:Le,progressBar:he,onDidAccept:this.onDidAcceptEmitter.event,onDidCustom:this.onDidCustomEmitter.event,onDidTriggerButton:this.onDidTriggerButtonEmitter.event,ignoreFocusOut:!1,keyMods:this.keyMods,show:Ce=>this.show(Ce),hide:()=>this.hide(),setVisibilities:Ce=>this.setVisibilities(Ce),setEnabled:Ce=>this.setEnabled(Ce),setContextKey:Ce=>this.options.setContextKey(Ce),linkOpenerDelegate:Ce=>this.options.linkOpenerDelegate(Ce)},this.updateStyles(),this.ui}pick(C,W={},V=CancellationToken.None){return new Promise((U,G)=>{let Z=ee=>{var te;Z=U,(te=W.onKeyMods)===null||te===void 0||te.call(W,X.keyMods),U(ee)};if(V.isCancellationRequested){Z(void 0);return}const X=this.createQuickPick();let Q;const J=[X,X.onDidAccept(()=>{if(X.canSelectMany)Z(X.selectedItems.slice()),X.hide();else{const ee=X.activeItems[0];ee&&(Z(ee),X.hide())}}),X.onDidChangeActive(ee=>{const te=ee[0];te&&W.onDidFocus&&W.onDidFocus(te)}),X.onDidChangeSelection(ee=>{if(!X.canSelectMany){const te=ee[0];te&&(Z(te),X.hide())}}),X.onDidTriggerItemButton(ee=>W.onDidTriggerItemButton&&W.onDidTriggerItemButton(Object.assign(Object.assign({},ee),{removeItem:()=>{const te=X.items.indexOf(ee.item);if(te!==-1){const ie=X.items.slice(),ne=ie.splice(te,1),oe=X.activeItems.filter(ae=>ae!==ne[0]),re=X.keepScrollPosition;X.keepScrollPosition=!0,X.items=ie,oe&&(X.activeItems=oe),X.keepScrollPosition=re}}}))),X.onDidTriggerSeparatorButton(ee=>{var te;return(te=W.onDidTriggerSeparatorButton)===null||te===void 0?void 0:te.call(W,ee)}),X.onDidChangeValue(ee=>{Q&&!ee&&(X.activeItems.length!==1||X.activeItems[0]!==Q)&&(X.activeItems=[Q])}),V.onCancellationRequested(()=>{X.hide()}),X.onDidHide(()=>{dispose(J),Z(void 0)})];X.title=W.title,X.canSelectMany=!!W.canPickMany,X.placeholder=W.placeHolder,X.ignoreFocusOut=!!W.ignoreFocusLost,X.matchOnDescription=!!W.matchOnDescription,X.matchOnDetail=!!W.matchOnDetail,X.matchOnLabel=W.matchOnLabel===void 0||W.matchOnLabel,X.autoFocusOnList=W.autoFocusOnList===void 0||W.autoFocusOnList,X.quickNavigate=W.quickNavigate,X.hideInput=!!W.hideInput,X.contextKey=W.contextKey,X.busy=!0,Promise.all([C,W.activeItem]).then(([ee,te])=>{Q=te,X.busy=!1,X.items=ee,X.canSelectMany&&(X.selectedItems=ee.filter(ie=>ie.type!=="separator"&&ie.picked)),Q&&(X.activeItems=[Q])}),X.show(),Promise.resolve(C).then(void 0,ee=>{G(ee),X.hide()})})}createQuickPick(){const C=this.getUI();return new QuickPick(C)}createInputBox(){const C=this.getUI();return new InputBox(C)}show(C){const W=this.getUI();this.onShowEmitter.fire();const V=this.controller;this.controller=C,V==null||V.didHide(),this.setEnabled(!0),W.leftActionBar.clear(),W.title.textContent="",W.description1.textContent="",W.description2.textContent="",reset(W.widget),W.rightActionBar.clear(),W.checkAll.checked=!1,W.inputBox.placeholder="",W.inputBox.password=!1,W.inputBox.showDecoration(Severity$2.Ignore),W.visibleCount.setCount(0),W.count.setCount(0),reset(W.message),W.progressBar.stop(),W.list.setElements([]),W.list.matchOnDescription=!1,W.list.matchOnDetail=!1,W.list.matchOnLabel=!0,W.list.sortByLabel=!0,W.ignoreFocusOut=!1,W.inputBox.toggles=void 0;const U=this.options.backKeybindingLabel();backButton.tooltip=U?localize("quickInput.backWithKeybinding","Back ({0})",U):localize("quickInput.back","Back"),W.container.style.display="",this.updateLayout(),W.inputBox.setFocus()}setVisibilities(C){const W=this.getUI();W.title.style.display=C.title?"":"none",W.description1.style.display=C.description&&(C.inputBox||C.checkAll)?"":"none",W.description2.style.display=C.description&&!(C.inputBox||C.checkAll)?"":"none",W.checkAll.style.display=C.checkAll?"":"none",W.inputContainer.style.display=C.inputBox?"":"none",W.filterContainer.style.display=C.inputBox?"":"none",W.visibleCountContainer.style.display=C.visibleCount?"":"none",W.countContainer.style.display=C.count?"":"none",W.okContainer.style.display=C.ok?"":"none",W.customButtonContainer.style.display=C.customButton?"":"none",W.message.style.display=C.message?"":"none",W.progressBar.getContainer().style.display=C.progressBar?"":"none",W.list.display(!!C.list),W.container.classList.toggle("show-checkboxes",!!C.checkBox),W.container.classList.toggle("hidden-input",!C.inputBox&&!C.description),this.updateLayout()}setEnabled(C){if(C!==this.enabled){this.enabled=C;for(const W of this.getUI().leftActionBar.viewItems)W.action.enabled=C;for(const W of this.getUI().rightActionBar.viewItems)W.action.enabled=C;this.getUI().checkAll.disabled=!C,this.getUI().inputBox.enabled=C,this.getUI().ok.enabled=C,this.getUI().list.enabled=C}}hide(C){var W,V,U;const G=this.controller;if(!G)return;const Z=!isAncestor$1(document.activeElement,(V=(W=this.ui)===null||W===void 0?void 0:W.container)!==null&&V!==void 0?V:null);if(this.controller=null,this.onHideEmitter.fire(),this.getUI().container.style.display="none",!Z){let X=this.previousFocusElement;for(;X&&!X.offsetParent;)X=(U=X.parentElement)!==null&&U!==void 0?U:void 0;X!=null&&X.offsetParent?(X.focus(),this.previousFocusElement=void 0):this.options.returnFocus()}G.didHide(C)}layout(C,W){this.dimension=C,this.titleBarOffset=W,this.updateLayout()}updateLayout(){if(this.ui&&this.isDisplayed()){this.ui.container.style.top=`${this.titleBarOffset}px`;const C=this.ui.container.style,W=Math.min(this.dimension.width*.62,QuickInputController.MAX_WIDTH);C.width=W+"px",C.marginLeft="-"+W/2+"px",this.ui.inputBox.layout(),this.ui.list.layout(this.dimension&&this.dimension.height*.4)}}applyStyles(C){this.styles=C,this.updateStyles()}updateStyles(){if(this.ui){const{quickInputTitleBackground:C,quickInputBackground:W,quickInputForeground:V,widgetBorder:U,widgetShadow:G}=this.styles.widget;this.ui.titleBar.style.backgroundColor=C??"",this.ui.container.style.backgroundColor=W??"",this.ui.container.style.color=V??"",this.ui.container.style.border=U?`1px solid ${U}`:"",this.ui.container.style.boxShadow=G?`0 0 8px 2px ${G}`:"",this.ui.list.style(this.styles.list);const Z=[];this.styles.pickerGroup.pickerGroupBorder&&Z.push(`.quick-input-list .quick-input-list-entry { border-top-color:  ${this.styles.pickerGroup.pickerGroupBorder}; }`),this.styles.pickerGroup.pickerGroupForeground&&Z.push(`.quick-input-list .quick-input-list-separator { color:  ${this.styles.pickerGroup.pickerGroupForeground}; }`),this.styles.pickerGroup.pickerGroupForeground&&Z.push(".quick-input-list .quick-input-list-separator-as-item { color: var(--vscode-descriptionForeground); }"),(this.styles.keybindingLabel.keybindingLabelBackground||this.styles.keybindingLabel.keybindingLabelBorder||this.styles.keybindingLabel.keybindingLabelBottomBorder||this.styles.keybindingLabel.keybindingLabelShadow||this.styles.keybindingLabel.keybindingLabelForeground)&&(Z.push(".quick-input-list .monaco-keybinding > .monaco-keybinding-key {"),this.styles.keybindingLabel.keybindingLabelBackground&&Z.push(`background-color: ${this.styles.keybindingLabel.keybindingLabelBackground};`),this.styles.keybindingLabel.keybindingLabelBorder&&Z.push(`border-color: ${this.styles.keybindingLabel.keybindingLabelBorder};`),this.styles.keybindingLabel.keybindingLabelBottomBorder&&Z.push(`border-bottom-color: ${this.styles.keybindingLabel.keybindingLabelBottomBorder};`),this.styles.keybindingLabel.keybindingLabelShadow&&Z.push(`box-shadow: inset 0 -1px 0 ${this.styles.keybindingLabel.keybindingLabelShadow};`),this.styles.keybindingLabel.keybindingLabelForeground&&Z.push(`color: ${this.styles.keybindingLabel.keybindingLabelForeground};`),Z.push("}"));const X=Z.join(`
`);X!==this.ui.styleSheet.textContent&&(this.ui.styleSheet.textContent=X)}}isDisplayed(){return this.ui&&this.ui.container.style.display!=="none"}}QuickInputController.MAX_WIDTH=600;var __decorate$1G=globalThis&&globalThis.__decorate||function(K,C,W,V){var U=arguments.length,G=U<3?C:V===null?V=Object.getOwnPropertyDescriptor(C,W):V,Z;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")G=Reflect.decorate(K,C,W,V);else for(var X=K.length-1;X>=0;X--)(Z=K[X])&&(G=(U<3?Z(G):U>3?Z(C,W,G):Z(C,W))||G);return U>3&&G&&Object.defineProperty(C,W,G),G},__param$1G=globalThis&&globalThis.__param||function(K,C){return function(W,V){C(W,V,K)}};let QuickInputService=class extends Themable{get controller(){return this._controller||(this._controller=this._register(this.createController())),this._controller}get hasController(){return!!this._controller}get quickAccess(){return this._quickAccess||(this._quickAccess=this._register(this.instantiationService.createInstance(QuickAccessController))),this._quickAccess}constructor(C,W,V,U){super(V),this.instantiationService=C,this.contextKeyService=W,this.layoutService=U,this._onShow=this._register(new Emitter$1),this._onHide=this._register(new Emitter$1),this.contexts=new Map}createController(C=this.layoutService,W){const V={idPrefix:"quickInput_",container:C.container,ignoreFocusOut:()=>!1,backKeybindingLabel:()=>{},setContextKey:G=>this.setContextKey(G),linkOpenerDelegate:G=>{this.instantiationService.invokeFunction(Z=>{Z.get(IOpenerService).open(G,{allowCommands:!0,fromUserGesture:!0})})},returnFocus:()=>C.focus(),createList:(G,Z,X,Q,J)=>this.instantiationService.createInstance(WorkbenchList,G,Z,X,Q,J),styles:this.computeStyles()},U=this._register(new QuickInputController(Object.assign(Object.assign({},V),W),this.themeService));return U.layout(C.dimension,C.offset.quickPickTop),this._register(C.onDidLayout(G=>U.layout(G,C.offset.quickPickTop))),this._register(U.onShow(()=>{this.resetContextKeys(),this._onShow.fire()})),this._register(U.onHide(()=>{this.resetContextKeys(),this._onHide.fire()})),U}setContextKey(C){let W;C&&(W=this.contexts.get(C),W||(W=new RawContextKey(C,!1).bindTo(this.contextKeyService),this.contexts.set(C,W))),!(W&&W.get())&&(this.resetContextKeys(),W==null||W.set(!0))}resetContextKeys(){this.contexts.forEach(C=>{C.get()&&C.reset()})}pick(C,W={},V=CancellationToken.None){return this.controller.pick(C,W,V)}createQuickPick(){return this.controller.createQuickPick()}createInputBox(){return this.controller.createInputBox()}updateStyles(){this.hasController&&this.controller.applyStyles(this.computeStyles())}computeStyles(){return{widget:{quickInputBackground:asCssVariable(quickInputBackground),quickInputForeground:asCssVariable(quickInputForeground),quickInputTitleBackground:asCssVariable(quickInputTitleBackground),widgetBorder:asCssVariable(widgetBorder),widgetShadow:asCssVariable(widgetShadow)},inputBox:defaultInputBoxStyles,toggle:defaultToggleStyles,countBadge:defaultCountBadgeStyles,button:defaultButtonStyles,progressBar:defaultProgressBarStyles,keybindingLabel:defaultKeybindingLabelStyles,list:getListStyles({listBackground:quickInputBackground,listFocusBackground:quickInputListFocusBackground,listFocusForeground:quickInputListFocusForeground,listInactiveFocusForeground:quickInputListFocusForeground,listInactiveSelectionIconForeground:quickInputListFocusIconForeground,listInactiveFocusBackground:quickInputListFocusBackground,listFocusOutline:activeContrastBorder,listInactiveFocusOutline:activeContrastBorder}),pickerGroup:{pickerGroupBorder:asCssVariable(pickerGroupBorder),pickerGroupForeground:asCssVariable(pickerGroupForeground)}}}};QuickInputService=__decorate$1G([__param$1G(0,IInstantiationService),__param$1G(1,IContextKeyService),__param$1G(2,IThemeService),__param$1G(3,ILayoutService)],QuickInputService);var __decorate$1F=globalThis&&globalThis.__decorate||function(K,C,W,V){var U=arguments.length,G=U<3?C:V===null?V=Object.getOwnPropertyDescriptor(C,W):V,Z;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")G=Reflect.decorate(K,C,W,V);else for(var X=K.length-1;X>=0;X--)(Z=K[X])&&(G=(U<3?Z(G):U>3?Z(C,W,G):Z(C,W))||G);return U>3&&G&&Object.defineProperty(C,W,G),G},__param$1F=globalThis&&globalThis.__param||function(K,C){return function(W,V){C(W,V,K)}};let EditorScopedQuickInputService=class extends QuickInputService{constructor(C,W,V,U,G){super(W,V,U,new EditorScopedLayoutService(C.getContainerDomNode(),G)),this.host=void 0;const Z=QuickInputEditorContribution.get(C);if(Z){const X=Z.widget;this.host={_serviceBrand:void 0,get hasContainer(){return!0},get container(){return X.getDomNode()},get dimension(){return C.getLayoutInfo()},get onDidLayout(){return C.onDidLayoutChange},focus:()=>C.focus(),offset:{top:0,quickPickTop:0}}}else this.host=void 0}createController(){return super.createController(this.host)}};EditorScopedQuickInputService=__decorate$1F([__param$1F(1,IInstantiationService),__param$1F(2,IContextKeyService),__param$1F(3,IThemeService),__param$1F(4,ICodeEditorService)],EditorScopedQuickInputService);let StandaloneQuickInputService=class{get activeService(){const C=this.codeEditorService.getFocusedCodeEditor();if(!C)throw new Error("Quick input service needs a focused editor to work.");let W=this.mapEditorToService.get(C);if(!W){const V=W=this.instantiationService.createInstance(EditorScopedQuickInputService,C);this.mapEditorToService.set(C,W),createSingleCallFunction(C.onDidDispose)(()=>{V.dispose(),this.mapEditorToService.delete(C)})}return W}get quickAccess(){return this.activeService.quickAccess}constructor(C,W){this.instantiationService=C,this.codeEditorService=W,this.mapEditorToService=new Map}pick(C,W={},V=CancellationToken.None){return this.activeService.pick(C,W,V)}createQuickPick(){return this.activeService.createQuickPick()}createInputBox(){return this.activeService.createInputBox()}};StandaloneQuickInputService=__decorate$1F([__param$1F(0,IInstantiationService),__param$1F(1,ICodeEditorService)],StandaloneQuickInputService);class QuickInputEditorContribution{static get(C){return C.getContribution(QuickInputEditorContribution.ID)}constructor(C){this.editor=C,this.widget=new QuickInputEditorWidget(this.editor)}dispose(){this.widget.dispose()}}QuickInputEditorContribution.ID="editor.controller.quickInput";class QuickInputEditorWidget{constructor(C){this.codeEditor=C,this.domNode=document.createElement("div"),this.codeEditor.addOverlayWidget(this)}getId(){return QuickInputEditorWidget.ID}getDomNode(){return this.domNode}getPosition(){return{preference:2}}dispose(){this.codeEditor.removeOverlayWidget(this)}}QuickInputEditorWidget.ID="editor.contrib.quickInputWidget";registerEditorContribution(QuickInputEditorContribution.ID,QuickInputEditorContribution,4);class ParsedTokenThemeRule{constructor(C,W,V,U,G){this._parsedThemeRuleBrand=void 0,this.token=C,this.index=W,this.fontStyle=V,this.foreground=U,this.background=G}}function parseTokenTheme(K){if(!K||!Array.isArray(K))return[];const C=[];let W=0;for(let V=0,U=K.length;V<U;V++){const G=K[V];let Z=-1;if(typeof G.fontStyle=="string"){Z=0;const J=G.fontStyle.split(" ");for(let ee=0,te=J.length;ee<te;ee++)switch(J[ee]){case"italic":Z=Z|1;break;case"bold":Z=Z|2;break;case"underline":Z=Z|4;break;case"strikethrough":Z=Z|8;break}}let X=null;typeof G.foreground=="string"&&(X=G.foreground);let Q=null;typeof G.background=="string"&&(Q=G.background),C[W++]=new ParsedTokenThemeRule(G.token||"",V,Z,X,Q)}return C}function resolveParsedTokenThemeRules(K,C){K.sort((ee,te)=>{const ie=strcmp(ee.token,te.token);return ie!==0?ie:ee.index-te.index});let W=0,V="000000",U="ffffff";for(;K.length>=1&&K[0].token==="";){const ee=K.shift();ee.fontStyle!==-1&&(W=ee.fontStyle),ee.foreground!==null&&(V=ee.foreground),ee.background!==null&&(U=ee.background)}const G=new ColorMap;for(const ee of C)G.getId(ee);const Z=G.getId(V),X=G.getId(U),Q=new ThemeTrieElementRule(W,Z,X),J=new ThemeTrieElement(Q);for(let ee=0,te=K.length;ee<te;ee++){const ie=K[ee];J.insert(ie.token,ie.fontStyle,G.getId(ie.foreground),G.getId(ie.background))}return new TokenTheme(G,J)}const colorRegExp=/^#?([0-9A-Fa-f]{6})([0-9A-Fa-f]{2})?$/;class ColorMap{constructor(){this._lastColorId=0,this._id2color=[],this._color2id=new Map}getId(C){if(C===null)return 0;const W=C.match(colorRegExp);if(!W)throw new Error("Illegal value for token color: "+C);C=W[1].toUpperCase();let V=this._color2id.get(C);return V||(V=++this._lastColorId,this._color2id.set(C,V),this._id2color[V]=Color.fromHex("#"+C),V)}getColorMap(){return this._id2color.slice(0)}}class TokenTheme{static createFromRawTokenTheme(C,W){return this.createFromParsedTokenTheme(parseTokenTheme(C),W)}static createFromParsedTokenTheme(C,W){return resolveParsedTokenThemeRules(C,W)}constructor(C,W){this._colorMap=C,this._root=W,this._cache=new Map}getColorMap(){return this._colorMap.getColorMap()}_match(C){return this._root.match(C)}match(C,W){let V=this._cache.get(W);if(typeof V>"u"){const U=this._match(W),G=toStandardTokenType(W);V=(U.metadata|G<<8)>>>0,this._cache.set(W,V)}return(V|C<<0)>>>0}}const STANDARD_TOKEN_TYPE_REGEXP=/\b(comment|string|regex|regexp)\b/;function toStandardTokenType(K){const C=K.match(STANDARD_TOKEN_TYPE_REGEXP);if(!C)return 0;switch(C[1]){case"comment":return 1;case"string":return 2;case"regex":return 3;case"regexp":return 3}throw new Error("Unexpected match for standard token type!")}function strcmp(K,C){return K<C?-1:K>C?1:0}class ThemeTrieElementRule{constructor(C,W,V){this._themeTrieElementRuleBrand=void 0,this._fontStyle=C,this._foreground=W,this._background=V,this.metadata=(this._fontStyle<<11|this._foreground<<15|this._background<<24)>>>0}clone(){return new ThemeTrieElementRule(this._fontStyle,this._foreground,this._background)}acceptOverwrite(C,W,V){C!==-1&&(this._fontStyle=C),W!==0&&(this._foreground=W),V!==0&&(this._background=V),this.metadata=(this._fontStyle<<11|this._foreground<<15|this._background<<24)>>>0}}class ThemeTrieElement{constructor(C){this._themeTrieElementBrand=void 0,this._mainRule=C,this._children=new Map}match(C){if(C==="")return this._mainRule;const W=C.indexOf(".");let V,U;W===-1?(V=C,U=""):(V=C.substring(0,W),U=C.substring(W+1));const G=this._children.get(V);return typeof G<"u"?G.match(U):this._mainRule}insert(C,W,V,U){if(C===""){this._mainRule.acceptOverwrite(W,V,U);return}const G=C.indexOf(".");let Z,X;G===-1?(Z=C,X=""):(Z=C.substring(0,G),X=C.substring(G+1));let Q=this._children.get(Z);typeof Q>"u"&&(Q=new ThemeTrieElement(this._mainRule.clone()),this._children.set(Z,Q)),Q.insert(X,W,V,U)}}function generateTokensCSSForColorMap(K){const C=[];for(let W=1,V=K.length;W<V;W++){const U=K[W];C[W]=`.mtk${W} { color: ${U}; }`}return C.push(".mtki { font-style: italic; }"),C.push(".mtkb { font-weight: bold; }"),C.push(".mtku { text-decoration: underline; text-underline-position: under; }"),C.push(".mtks { text-decoration: line-through; }"),C.push(".mtks.mtku { text-decoration: underline line-through; text-underline-position: under; }"),C.join(`
`)}const vs={base:"vs",inherit:!1,rules:[{token:"",foreground:"000000",background:"fffffe"},{token:"invalid",foreground:"cd3131"},{token:"emphasis",fontStyle:"italic"},{token:"strong",fontStyle:"bold"},{token:"variable",foreground:"001188"},{token:"variable.predefined",foreground:"4864AA"},{token:"constant",foreground:"dd0000"},{token:"comment",foreground:"008000"},{token:"number",foreground:"098658"},{token:"number.hex",foreground:"3030c0"},{token:"regexp",foreground:"800000"},{token:"annotation",foreground:"808080"},{token:"type",foreground:"008080"},{token:"delimiter",foreground:"000000"},{token:"delimiter.html",foreground:"383838"},{token:"delimiter.xml",foreground:"0000FF"},{token:"tag",foreground:"800000"},{token:"tag.id.pug",foreground:"4F76AC"},{token:"tag.class.pug",foreground:"4F76AC"},{token:"meta.scss",foreground:"800000"},{token:"metatag",foreground:"e00000"},{token:"metatag.content.html",foreground:"FF0000"},{token:"metatag.html",foreground:"808080"},{token:"metatag.xml",foreground:"808080"},{token:"metatag.php",fontStyle:"bold"},{token:"key",foreground:"863B00"},{token:"string.key.json",foreground:"A31515"},{token:"string.value.json",foreground:"0451A5"},{token:"attribute.name",foreground:"FF0000"},{token:"attribute.value",foreground:"0451A5"},{token:"attribute.value.number",foreground:"098658"},{token:"attribute.value.unit",foreground:"098658"},{token:"attribute.value.html",foreground:"0000FF"},{token:"attribute.value.xml",foreground:"0000FF"},{token:"string",foreground:"A31515"},{token:"string.html",foreground:"0000FF"},{token:"string.sql",foreground:"FF0000"},{token:"string.yaml",foreground:"0451A5"},{token:"keyword",foreground:"0000FF"},{token:"keyword.json",foreground:"0451A5"},{token:"keyword.flow",foreground:"AF00DB"},{token:"keyword.flow.scss",foreground:"0000FF"},{token:"operator.scss",foreground:"666666"},{token:"operator.sql",foreground:"778899"},{token:"operator.swift",foreground:"666666"},{token:"predefined.sql",foreground:"C700C7"}],colors:{[editorBackground]:"#FFFFFE",[editorForeground]:"#000000",[editorInactiveSelection]:"#E5EBF1",[editorIndentGuide1]:"#D3D3D3",[editorActiveIndentGuide1]:"#939393",[editorSelectionHighlight]:"#ADD6FF4D"}},vs_dark={base:"vs-dark",inherit:!1,rules:[{token:"",foreground:"D4D4D4",background:"1E1E1E"},{token:"invalid",foreground:"f44747"},{token:"emphasis",fontStyle:"italic"},{token:"strong",fontStyle:"bold"},{token:"variable",foreground:"74B0DF"},{token:"variable.predefined",foreground:"4864AA"},{token:"variable.parameter",foreground:"9CDCFE"},{token:"constant",foreground:"569CD6"},{token:"comment",foreground:"608B4E"},{token:"number",foreground:"B5CEA8"},{token:"number.hex",foreground:"5BB498"},{token:"regexp",foreground:"B46695"},{token:"annotation",foreground:"cc6666"},{token:"type",foreground:"3DC9B0"},{token:"delimiter",foreground:"DCDCDC"},{token:"delimiter.html",foreground:"808080"},{token:"delimiter.xml",foreground:"808080"},{token:"tag",foreground:"569CD6"},{token:"tag.id.pug",foreground:"4F76AC"},{token:"tag.class.pug",foreground:"4F76AC"},{token:"meta.scss",foreground:"A79873"},{token:"meta.tag",foreground:"CE9178"},{token:"metatag",foreground:"DD6A6F"},{token:"metatag.content.html",foreground:"9CDCFE"},{token:"metatag.html",foreground:"569CD6"},{token:"metatag.xml",foreground:"569CD6"},{token:"metatag.php",fontStyle:"bold"},{token:"key",foreground:"9CDCFE"},{token:"string.key.json",foreground:"9CDCFE"},{token:"string.value.json",foreground:"CE9178"},{token:"attribute.name",foreground:"9CDCFE"},{token:"attribute.value",foreground:"CE9178"},{token:"attribute.value.number.css",foreground:"B5CEA8"},{token:"attribute.value.unit.css",foreground:"B5CEA8"},{token:"attribute.value.hex.css",foreground:"D4D4D4"},{token:"string",foreground:"CE9178"},{token:"string.sql",foreground:"FF0000"},{token:"keyword",foreground:"569CD6"},{token:"keyword.flow",foreground:"C586C0"},{token:"keyword.json",foreground:"CE9178"},{token:"keyword.flow.scss",foreground:"569CD6"},{token:"operator.scss",foreground:"909090"},{token:"operator.sql",foreground:"778899"},{token:"operator.swift",foreground:"909090"},{token:"predefined.sql",foreground:"FF00FF"}],colors:{[editorBackground]:"#1E1E1E",[editorForeground]:"#D4D4D4",[editorInactiveSelection]:"#3A3D41",[editorIndentGuide1]:"#404040",[editorActiveIndentGuide1]:"#707070",[editorSelectionHighlight]:"#ADD6FF26"}},hc_black={base:"hc-black",inherit:!1,rules:[{token:"",foreground:"FFFFFF",background:"000000"},{token:"invalid",foreground:"f44747"},{token:"emphasis",fontStyle:"italic"},{token:"strong",fontStyle:"bold"},{token:"variable",foreground:"1AEBFF"},{token:"variable.parameter",foreground:"9CDCFE"},{token:"constant",foreground:"569CD6"},{token:"comment",foreground:"608B4E"},{token:"number",foreground:"FFFFFF"},{token:"regexp",foreground:"C0C0C0"},{token:"annotation",foreground:"569CD6"},{token:"type",foreground:"3DC9B0"},{token:"delimiter",foreground:"FFFF00"},{token:"delimiter.html",foreground:"FFFF00"},{token:"tag",foreground:"569CD6"},{token:"tag.id.pug",foreground:"4F76AC"},{token:"tag.class.pug",foreground:"4F76AC"},{token:"meta",foreground:"D4D4D4"},{token:"meta.tag",foreground:"CE9178"},{token:"metatag",foreground:"569CD6"},{token:"metatag.content.html",foreground:"1AEBFF"},{token:"metatag.html",foreground:"569CD6"},{token:"metatag.xml",foreground:"569CD6"},{token:"metatag.php",fontStyle:"bold"},{token:"key",foreground:"9CDCFE"},{token:"string.key",foreground:"9CDCFE"},{token:"string.value",foreground:"CE9178"},{token:"attribute.name",foreground:"569CD6"},{token:"attribute.value",foreground:"3FF23F"},{token:"string",foreground:"CE9178"},{token:"string.sql",foreground:"FF0000"},{token:"keyword",foreground:"569CD6"},{token:"keyword.flow",foreground:"C586C0"},{token:"operator.sql",foreground:"778899"},{token:"operator.swift",foreground:"909090"},{token:"predefined.sql",foreground:"FF00FF"}],colors:{[editorBackground]:"#000000",[editorForeground]:"#FFFFFF",[editorIndentGuide1]:"#FFFFFF",[editorActiveIndentGuide1]:"#FFFFFF"}},hc_light={base:"hc-light",inherit:!1,rules:[{token:"",foreground:"292929",background:"FFFFFF"},{token:"invalid",foreground:"B5200D"},{token:"emphasis",fontStyle:"italic"},{token:"strong",fontStyle:"bold"},{token:"variable",foreground:"264F70"},{token:"variable.predefined",foreground:"4864AA"},{token:"constant",foreground:"dd0000"},{token:"comment",foreground:"008000"},{token:"number",foreground:"098658"},{token:"number.hex",foreground:"3030c0"},{token:"regexp",foreground:"800000"},{token:"annotation",foreground:"808080"},{token:"type",foreground:"008080"},{token:"delimiter",foreground:"000000"},{token:"delimiter.html",foreground:"383838"},{token:"tag",foreground:"800000"},{token:"tag.id.pug",foreground:"4F76AC"},{token:"tag.class.pug",foreground:"4F76AC"},{token:"meta.scss",foreground:"800000"},{token:"metatag",foreground:"e00000"},{token:"metatag.content.html",foreground:"B5200D"},{token:"metatag.html",foreground:"808080"},{token:"metatag.xml",foreground:"808080"},{token:"metatag.php",fontStyle:"bold"},{token:"key",foreground:"863B00"},{token:"string.key.json",foreground:"A31515"},{token:"string.value.json",foreground:"0451A5"},{token:"attribute.name",foreground:"264F78"},{token:"attribute.value",foreground:"0451A5"},{token:"string",foreground:"A31515"},{token:"string.sql",foreground:"B5200D"},{token:"keyword",foreground:"0000FF"},{token:"keyword.flow",foreground:"AF00DB"},{token:"operator.sql",foreground:"778899"},{token:"operator.swift",foreground:"666666"},{token:"predefined.sql",foreground:"C700C7"}],colors:{[editorBackground]:"#FFFFFF",[editorForeground]:"#292929",[editorIndentGuide1]:"#292929",[editorActiveIndentGuide1]:"#292929"}},Extensions$1={IconContribution:"base.contributions.icons"};var IconContribution;(function(K){function C(W,V){let U=W.defaults;for(;ThemeIcon.isThemeIcon(U);){const G=iconRegistry.getIcon(U.id);if(!G)return;U=G.defaults}return U}K.getDefinition=C})(IconContribution||(IconContribution={}));var IconFontDefinition;(function(K){function C(V){return{weight:V.weight,style:V.style,src:V.src.map(U=>({format:U.format,location:U.location.toString()}))}}K.toJSONObject=C;function W(V){const U=G=>isString$3(G)?G:void 0;if(V&&Array.isArray(V.src)&&V.src.every(G=>isString$3(G.format)&&isString$3(G.location)))return{weight:U(V.weight),style:U(V.style),src:V.src.map(G=>({format:G.format,location:URI.parse(G.location)}))}}K.fromJSONObject=W})(IconFontDefinition||(IconFontDefinition={}));class IconRegistry{constructor(){this._onDidChange=new Emitter$1,this.onDidChange=this._onDidChange.event,this.iconSchema={definitions:{icons:{type:"object",properties:{fontId:{type:"string",description:localize("iconDefinition.fontId","The id of the font to use. If not set, the font that is defined first is used.")},fontCharacter:{type:"string",description:localize("iconDefinition.fontCharacter","The font character associated with the icon definition.")}},additionalProperties:!1,defaultSnippets:[{body:{fontCharacter:"\\\\e030"}}]}},type:"object",properties:{}},this.iconReferenceSchema={type:"string",pattern:`^${ThemeIcon.iconNameExpression}$`,enum:[],enumDescriptions:[]},this.iconsById={},this.iconFontsById={}}registerIcon(C,W,V,U){const G=this.iconsById[C];if(G){if(V&&!G.description){G.description=V,this.iconSchema.properties[C].markdownDescription=`${V} $(${C})`;const Q=this.iconReferenceSchema.enum.indexOf(C);Q!==-1&&(this.iconReferenceSchema.enumDescriptions[Q]=V),this._onDidChange.fire()}return G}const Z={id:C,description:V,defaults:W,deprecationMessage:U};this.iconsById[C]=Z;const X={$ref:"#/definitions/icons"};return U&&(X.deprecationMessage=U),V&&(X.markdownDescription=`${V}: $(${C})`),this.iconSchema.properties[C]=X,this.iconReferenceSchema.enum.push(C),this.iconReferenceSchema.enumDescriptions.push(V||""),this._onDidChange.fire(),{id:C}}getIcons(){return Object.keys(this.iconsById).map(C=>this.iconsById[C])}getIcon(C){return this.iconsById[C]}getIconSchema(){return this.iconSchema}toString(){const C=(G,Z)=>G.id.localeCompare(Z.id),W=G=>{for(;ThemeIcon.isThemeIcon(G.defaults);)G=this.iconsById[G.defaults.id];return`codicon codicon-${G?G.id:""}`},V=[];V.push("| preview     | identifier                        | default codicon ID                | description"),V.push("| ----------- | --------------------------------- | --------------------------------- | --------------------------------- |");const U=Object.keys(this.iconsById).map(G=>this.iconsById[G]);for(const G of U.filter(Z=>!!Z.description).sort(C))V.push(`|<i class="${W(G)}"></i>|${G.id}|${ThemeIcon.isThemeIcon(G.defaults)?G.defaults.id:G.id}|${G.description||""}|`);V.push("| preview     | identifier                        "),V.push("| ----------- | --------------------------------- |");for(const G of U.filter(Z=>!ThemeIcon.isThemeIcon(Z.defaults)).sort(C))V.push(`|<i class="${W(G)}"></i>|${G.id}|`);return V.join(`
`)}}const iconRegistry=new IconRegistry;Registry.add(Extensions$1.IconContribution,iconRegistry);function registerIcon(K,C,W,V){return iconRegistry.registerIcon(K,C,W,V)}function getIconRegistry(){return iconRegistry}function initialize(){const K=getCodiconFontCharacters();for(const C in K){const W="\\"+K[C].toString(16);iconRegistry.registerIcon(C,{fontCharacter:W})}}initialize();const iconsSchemaId="vscode://schemas/icons",schemaRegistry=Registry.as(Extensions$7.JSONContribution);schemaRegistry.registerSchema(iconsSchemaId,iconRegistry.getIconSchema());const delayer=new RunOnceScheduler(()=>schemaRegistry.notifySchemaChanged(iconsSchemaId),200);iconRegistry.onDidChange(()=>{delayer.isScheduled()||delayer.schedule()});const widgetClose=registerIcon("widget-close",Codicon.close,localize("widgetClose","Icon for the close action in widgets."));registerIcon("goto-previous-location",Codicon.arrowUp,localize("previousChangeIcon","Icon for goto previous editor location."));registerIcon("goto-next-location",Codicon.arrowDown,localize("nextChangeIcon","Icon for goto next editor location."));ThemeIcon.modify(Codicon.sync,"spin");ThemeIcon.modify(Codicon.loading,"spin");function getIconsStyleSheet(K){const C=new DisposableStore,W=C.add(new Emitter$1),V=getIconRegistry();return C.add(V.onDidChange(()=>W.fire())),K&&C.add(K.onDidProductIconThemeChange(()=>W.fire())),{dispose:()=>C.dispose(),onDidChange:W.event,getCSS(){const U=K?K.getProductIconTheme():new UnthemedProductIconTheme,G={},Z=Q=>{const J=U.getIcon(Q);if(!J)return;const ee=J.font;return ee?(G[ee.id]=ee.definition,`.codicon-${Q.id}:before { content: '${J.fontCharacter}'; font-family: ${asCSSPropertyValue(ee.id)}; }`):`.codicon-${Q.id}:before { content: '${J.fontCharacter}'; }`},X=[];for(const Q of V.getIcons()){const J=Z(Q);J&&X.push(J)}for(const Q in G){const J=G[Q],ee=J.weight?`font-weight: ${J.weight};`:"",te=J.style?`font-style: ${J.style};`:"",ie=J.src.map(ne=>`${asCSSUrl(ne.location)} format('${ne.format}')`).join(", ");X.push(`@font-face { src: ${ie}; font-family: ${asCSSPropertyValue(Q)};${ee}${te} font-display: block; }`)}return X.join(`
`)}}}class UnthemedProductIconTheme{getIcon(C){const W=getIconRegistry();let V=C.defaults;for(;ThemeIcon.isThemeIcon(V);){const U=W.getIcon(V.id);if(!U)return;V=U.defaults}return V}}const VS_LIGHT_THEME_NAME="vs",VS_DARK_THEME_NAME="vs-dark",HC_BLACK_THEME_NAME="hc-black",HC_LIGHT_THEME_NAME="hc-light",colorRegistry=Registry.as(Extensions$4.ColorContribution),themingRegistry=Registry.as(Extensions$3.ThemingContribution);class StandaloneTheme{constructor(C,W){this.semanticHighlighting=!1,this.themeData=W;const V=W.base;C.length>0?(isBuiltinTheme(C)?this.id=C:this.id=V+" "+C,this.themeName=C):(this.id=V,this.themeName=V),this.colors=null,this.defaultColors=Object.create(null),this._tokenTheme=null}get base(){return this.themeData.base}notifyBaseUpdated(){this.themeData.inherit&&(this.colors=null,this._tokenTheme=null)}getColors(){if(!this.colors){const C=new Map;for(const W in this.themeData.colors)C.set(W,Color.fromHex(this.themeData.colors[W]));if(this.themeData.inherit){const W=getBuiltinRules(this.themeData.base);for(const V in W.colors)C.has(V)||C.set(V,Color.fromHex(W.colors[V]))}this.colors=C}return this.colors}getColor(C,W){const V=this.getColors().get(C);if(V)return V;if(W!==!1)return this.getDefault(C)}getDefault(C){let W=this.defaultColors[C];return W||(W=colorRegistry.resolveDefaultColor(C,this),this.defaultColors[C]=W,W)}defines(C){return this.getColors().has(C)}get type(){switch(this.base){case VS_LIGHT_THEME_NAME:return ColorScheme.LIGHT;case HC_BLACK_THEME_NAME:return ColorScheme.HIGH_CONTRAST_DARK;case HC_LIGHT_THEME_NAME:return ColorScheme.HIGH_CONTRAST_LIGHT;default:return ColorScheme.DARK}}get tokenTheme(){if(!this._tokenTheme){let C=[],W=[];if(this.themeData.inherit){const G=getBuiltinRules(this.themeData.base);C=G.rules,G.encodedTokensColors&&(W=G.encodedTokensColors)}const V=this.themeData.colors["editor.foreground"],U=this.themeData.colors["editor.background"];if(V||U){const G={token:""};V&&(G.foreground=V),U&&(G.background=U),C.push(G)}C=C.concat(this.themeData.rules),this.themeData.encodedTokensColors&&(W=this.themeData.encodedTokensColors),this._tokenTheme=TokenTheme.createFromRawTokenTheme(C,W)}return this._tokenTheme}getTokenStyleMetadata(C,W,V){const G=this.tokenTheme._match([C].concat(W).join(".")).metadata,Z=TokenMetadata.getForeground(G),X=TokenMetadata.getFontStyle(G);return{foreground:Z,italic:!!(X&1),bold:!!(X&2),underline:!!(X&4),strikethrough:!!(X&8)}}}function isBuiltinTheme(K){return K===VS_LIGHT_THEME_NAME||K===VS_DARK_THEME_NAME||K===HC_BLACK_THEME_NAME||K===HC_LIGHT_THEME_NAME}function getBuiltinRules(K){switch(K){case VS_LIGHT_THEME_NAME:return vs;case VS_DARK_THEME_NAME:return vs_dark;case HC_BLACK_THEME_NAME:return hc_black;case HC_LIGHT_THEME_NAME:return hc_light}}function newBuiltInTheme(K){const C=getBuiltinRules(K);return new StandaloneTheme(K,C)}class StandaloneThemeService extends Disposable{constructor(){super(),this._onColorThemeChange=this._register(new Emitter$1),this.onDidColorThemeChange=this._onColorThemeChange.event,this._onProductIconThemeChange=this._register(new Emitter$1),this.onDidProductIconThemeChange=this._onProductIconThemeChange.event,this._environment=Object.create(null),this._builtInProductIconTheme=new UnthemedProductIconTheme,this._autoDetectHighContrast=!0,this._knownThemes=new Map,this._knownThemes.set(VS_LIGHT_THEME_NAME,newBuiltInTheme(VS_LIGHT_THEME_NAME)),this._knownThemes.set(VS_DARK_THEME_NAME,newBuiltInTheme(VS_DARK_THEME_NAME)),this._knownThemes.set(HC_BLACK_THEME_NAME,newBuiltInTheme(HC_BLACK_THEME_NAME)),this._knownThemes.set(HC_LIGHT_THEME_NAME,newBuiltInTheme(HC_LIGHT_THEME_NAME));const C=this._register(getIconsStyleSheet(this));this._codiconCSS=C.getCSS(),this._themeCSS="",this._allCSS=`${this._codiconCSS}
${this._themeCSS}`,this._globalStyleElement=null,this._styleElements=[],this._colorMapOverride=null,this.setTheme(VS_LIGHT_THEME_NAME),this._onOSSchemeChanged(),this._register(C.onDidChange(()=>{this._codiconCSS=C.getCSS(),this._updateCSS()})),addMatchMediaChangeListener("(forced-colors: active)",()=>{this._onOSSchemeChanged()})}registerEditorContainer(C){return isInShadowDOM(C)?this._registerShadowDomContainer(C):this._registerRegularEditorContainer()}_registerRegularEditorContainer(){return this._globalStyleElement||(this._globalStyleElement=createStyleSheet(void 0,C=>{C.className="monaco-colors",C.textContent=this._allCSS}),this._styleElements.push(this._globalStyleElement)),Disposable.None}_registerShadowDomContainer(C){const W=createStyleSheet(C,V=>{V.className="monaco-colors",V.textContent=this._allCSS});return this._styleElements.push(W),{dispose:()=>{for(let V=0;V<this._styleElements.length;V++)if(this._styleElements[V]===W){this._styleElements.splice(V,1);return}}}}defineTheme(C,W){if(!/^[a-z0-9\-]+$/i.test(C))throw new Error("Illegal theme name!");if(!isBuiltinTheme(W.base)&&!isBuiltinTheme(C))throw new Error("Illegal theme base!");this._knownThemes.set(C,new StandaloneTheme(C,W)),isBuiltinTheme(C)&&this._knownThemes.forEach(V=>{V.base===C&&V.notifyBaseUpdated()}),this._theme.themeName===C&&this.setTheme(C)}getColorTheme(){return this._theme}setColorMapOverride(C){this._colorMapOverride=C,this._updateThemeOrColorMap()}setTheme(C){let W;this._knownThemes.has(C)?W=this._knownThemes.get(C):W=this._knownThemes.get(VS_LIGHT_THEME_NAME),this._updateActualTheme(W)}_updateActualTheme(C){!C||this._theme===C||(this._theme=C,this._updateThemeOrColorMap())}_onOSSchemeChanged(){if(this._autoDetectHighContrast){const C=window.matchMedia("(forced-colors: active)").matches;if(C!==isHighContrast(this._theme.type)){let W;isDark(this._theme.type)?W=C?HC_BLACK_THEME_NAME:VS_DARK_THEME_NAME:W=C?HC_LIGHT_THEME_NAME:VS_LIGHT_THEME_NAME,this._updateActualTheme(this._knownThemes.get(W))}}}setAutoDetectHighContrast(C){this._autoDetectHighContrast=C,this._onOSSchemeChanged()}_updateThemeOrColorMap(){const C=[],W={},V={addRule:Z=>{W[Z]||(C.push(Z),W[Z]=!0)}};themingRegistry.getThemingParticipants().forEach(Z=>Z(this._theme,V,this._environment));const U=[];for(const Z of colorRegistry.getColors()){const X=this._theme.getColor(Z.id,!0);X&&U.push(`${asCssVariableName(Z.id)}: ${X.toString()};`)}V.addRule(`.monaco-editor, .monaco-diff-editor { ${U.join(`
`)} }`);const G=this._colorMapOverride||this._theme.tokenTheme.getColorMap();V.addRule(generateTokensCSSForColorMap(G)),this._themeCSS=C.join(`
`),this._updateCSS(),TokenizationRegistry.setColorMap(G),this._onColorThemeChange.fire(this._theme)}_updateCSS(){this._allCSS=`${this._codiconCSS}
${this._themeCSS}`,this._styleElements.forEach(C=>C.textContent=this._allCSS)}getFileIconTheme(){return{hasFileIcons:!1,hasFolderIcons:!1,hidesExplorerArrows:!1}}getProductIconTheme(){return this._builtInProductIconTheme}}const IStandaloneThemeService=createDecorator("themeService");var __decorate$1E=globalThis&&globalThis.__decorate||function(K,C,W,V){var U=arguments.length,G=U<3?C:V===null?V=Object.getOwnPropertyDescriptor(C,W):V,Z;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")G=Reflect.decorate(K,C,W,V);else for(var X=K.length-1;X>=0;X--)(Z=K[X])&&(G=(U<3?Z(G):U>3?Z(C,W,G):Z(C,W))||G);return U>3&&G&&Object.defineProperty(C,W,G),G},__param$1E=globalThis&&globalThis.__param||function(K,C){return function(W,V){C(W,V,K)}};let AccessibilityService=class extends Disposable{constructor(C,W,V){super(),this._contextKeyService=C,this._layoutService=W,this._configurationService=V,this._accessibilitySupport=0,this._onDidChangeScreenReaderOptimized=new Emitter$1,this._onDidChangeReducedMotion=new Emitter$1,this._accessibilityModeEnabledContext=CONTEXT_ACCESSIBILITY_MODE_ENABLED.bindTo(this._contextKeyService);const U=()=>this._accessibilityModeEnabledContext.set(this.isScreenReaderOptimized());this._register(this._configurationService.onDidChangeConfiguration(Z=>{Z.affectsConfiguration("editor.accessibilitySupport")&&(U(),this._onDidChangeScreenReaderOptimized.fire()),Z.affectsConfiguration("workbench.reduceMotion")&&(this._configMotionReduced=this._configurationService.getValue("workbench.reduceMotion"),this._onDidChangeReducedMotion.fire())})),U(),this._register(this.onDidChangeScreenReaderOptimized(()=>U()));const G=window.matchMedia("(prefers-reduced-motion: reduce)");this._systemMotionReduced=G.matches,this._configMotionReduced=this._configurationService.getValue("workbench.reduceMotion"),this.initReducedMotionListeners(G)}initReducedMotionListeners(C){if(!this._layoutService.hasContainer)return;this._register(addDisposableListener(C,"change",()=>{this._systemMotionReduced=C.matches,this._configMotionReduced==="auto"&&this._onDidChangeReducedMotion.fire()}));const W=()=>{const V=this.isMotionReduced();this._layoutService.container.classList.toggle("reduce-motion",V),this._layoutService.container.classList.toggle("enable-motion",!V)};W(),this._register(this.onDidChangeReducedMotion(()=>W()))}get onDidChangeScreenReaderOptimized(){return this._onDidChangeScreenReaderOptimized.event}isScreenReaderOptimized(){const C=this._configurationService.getValue("editor.accessibilitySupport");return C==="on"||C==="auto"&&this._accessibilitySupport===2}get onDidChangeReducedMotion(){return this._onDidChangeReducedMotion.event}isMotionReduced(){const C=this._configMotionReduced;return C==="on"||C==="auto"&&this._systemMotionReduced}getAccessibilitySupport(){return this._accessibilitySupport}};AccessibilityService=__decorate$1E([__param$1E(0,IContextKeyService),__param$1E(1,ILayoutService),__param$1E(2,IConfigurationService)],AccessibilityService);var __decorate$1D=globalThis&&globalThis.__decorate||function(K,C,W,V){var U=arguments.length,G=U<3?C:V===null?V=Object.getOwnPropertyDescriptor(C,W):V,Z;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")G=Reflect.decorate(K,C,W,V);else for(var X=K.length-1;X>=0;X--)(Z=K[X])&&(G=(U<3?Z(G):U>3?Z(C,W,G):Z(C,W))||G);return U>3&&G&&Object.defineProperty(C,W,G),G},__param$1D=globalThis&&globalThis.__param||function(K,C){return function(W,V){C(W,V,K)}},PersistedMenuHideState_1,MenuInfo_1;let MenuService=class{constructor(C,W){this._commandService=C,this._hiddenStates=new PersistedMenuHideState(W)}createMenu(C,W,V){return new MenuImpl(C,this._hiddenStates,Object.assign({emitEventsForSubmenuChanges:!1,eventDebounceDelay:50},V),this._commandService,W)}resetHiddenStates(C){this._hiddenStates.reset(C)}};MenuService=__decorate$1D([__param$1D(0,ICommandService),__param$1D(1,IStorageService)],MenuService);let PersistedMenuHideState=PersistedMenuHideState_1=class{constructor(C){this._storageService=C,this._disposables=new DisposableStore,this._onDidChange=new Emitter$1,this.onDidChange=this._onDidChange.event,this._ignoreChangeEvent=!1,this._hiddenByDefaultCache=new Map;try{const W=C.get(PersistedMenuHideState_1._key,0,"{}");this._data=JSON.parse(W)}catch{this._data=Object.create(null)}this._disposables.add(C.onDidChangeValue(0,PersistedMenuHideState_1._key,this._disposables)(()=>{if(!this._ignoreChangeEvent)try{const W=C.get(PersistedMenuHideState_1._key,0,"{}");this._data=JSON.parse(W)}catch(W){console.log("FAILED to read storage after UPDATE",W)}this._onDidChange.fire()}))}dispose(){this._onDidChange.dispose(),this._disposables.dispose()}_isHiddenByDefault(C,W){var V;return(V=this._hiddenByDefaultCache.get(`${C.id}/${W}`))!==null&&V!==void 0?V:!1}setDefaultState(C,W,V){this._hiddenByDefaultCache.set(`${C.id}/${W}`,V)}isHidden(C,W){var V,U;const G=this._isHiddenByDefault(C,W),Z=(U=(V=this._data[C.id])===null||V===void 0?void 0:V.includes(W))!==null&&U!==void 0?U:!1;return G?!Z:Z}updateHidden(C,W,V){this._isHiddenByDefault(C,W)&&(V=!V);const G=this._data[C.id];if(V)G?G.indexOf(W)<0&&G.push(W):this._data[C.id]=[W];else if(G){const Z=G.indexOf(W);Z>=0&&removeFastWithoutKeepingOrder(G,Z),G.length===0&&delete this._data[C.id]}this._persist()}reset(C){if(C===void 0)this._data=Object.create(null),this._persist();else{for(const{id:W}of C)this._data[W]&&delete this._data[W];this._persist()}}_persist(){try{this._ignoreChangeEvent=!0;const C=JSON.stringify(this._data);this._storageService.store(PersistedMenuHideState_1._key,C,0,0)}finally{this._ignoreChangeEvent=!1}}};PersistedMenuHideState._key="menu.hiddenCommands";PersistedMenuHideState=PersistedMenuHideState_1=__decorate$1D([__param$1D(0,IStorageService)],PersistedMenuHideState);let MenuInfo=MenuInfo_1=class{constructor(C,W,V,U,G){this._id=C,this._hiddenStates=W,this._collectContextKeysForSubmenus=V,this._commandService=U,this._contextKeyService=G,this._menuGroups=[],this._structureContextKeys=new Set,this._preconditionContextKeys=new Set,this._toggledContextKeys=new Set,this.refresh()}get structureContextKeys(){return this._structureContextKeys}get preconditionContextKeys(){return this._preconditionContextKeys}get toggledContextKeys(){return this._toggledContextKeys}refresh(){this._menuGroups.length=0,this._structureContextKeys.clear(),this._preconditionContextKeys.clear(),this._toggledContextKeys.clear();const C=MenuRegistry.getMenuItems(this._id);let W;C.sort(MenuInfo_1._compareMenuItems);for(const V of C){const U=V.group||"";(!W||W[0]!==U)&&(W=[U,[]],this._menuGroups.push(W)),W[1].push(V),this._collectContextKeys(V)}}_collectContextKeys(C){if(MenuInfo_1._fillInKbExprKeys(C.when,this._structureContextKeys),isIMenuItem(C)){if(C.command.precondition&&MenuInfo_1._fillInKbExprKeys(C.command.precondition,this._preconditionContextKeys),C.command.toggled){const W=C.command.toggled.condition||C.command.toggled;MenuInfo_1._fillInKbExprKeys(W,this._toggledContextKeys)}}else this._collectContextKeysForSubmenus&&MenuRegistry.getMenuItems(C.submenu).forEach(this._collectContextKeys,this)}createActionGroups(C){const W=[];for(const V of this._menuGroups){const[U,G]=V,Z=[];for(const X of G)if(this._contextKeyService.contextMatchesRules(X.when)){const Q=isIMenuItem(X);Q&&this._hiddenStates.setDefaultState(this._id,X.command.id,!!X.isHiddenByDefault);const J=createMenuHide(this._id,Q?X.command:X,this._hiddenStates);if(Q)Z.push(new MenuItemAction(X.command,X.alt,C,J,this._contextKeyService,this._commandService));else{const ee=new MenuInfo_1(X.submenu,this._hiddenStates,this._collectContextKeysForSubmenus,this._commandService,this._contextKeyService).createActionGroups(C),te=Separator.join(...ee.map(ie=>ie[1]));te.length>0&&Z.push(new SubmenuItemAction(X,J,te))}}Z.length>0&&W.push([U,Z])}return W}static _fillInKbExprKeys(C,W){if(C)for(const V of C.keys())W.add(V)}static _compareMenuItems(C,W){const V=C.group,U=W.group;if(V!==U){if(V){if(!U)return-1}else return 1;if(V==="navigation")return-1;if(U==="navigation")return 1;const X=V.localeCompare(U);if(X!==0)return X}const G=C.order||0,Z=W.order||0;return G<Z?-1:G>Z?1:MenuInfo_1._compareTitles(isIMenuItem(C)?C.command.title:C.title,isIMenuItem(W)?W.command.title:W.title)}static _compareTitles(C,W){const V=typeof C=="string"?C:C.original,U=typeof W=="string"?W:W.original;return V.localeCompare(U)}};MenuInfo=MenuInfo_1=__decorate$1D([__param$1D(3,ICommandService),__param$1D(4,IContextKeyService)],MenuInfo);let MenuImpl=class{constructor(C,W,V,U,G){this._disposables=new DisposableStore,this._menuInfo=new MenuInfo(C,W,V.emitEventsForSubmenuChanges,U,G);const Z=new RunOnceScheduler(()=>{this._menuInfo.refresh(),this._onDidChange.fire({menu:this,isStructuralChange:!0,isEnablementChange:!0,isToggleChange:!0})},V.eventDebounceDelay);this._disposables.add(Z),this._disposables.add(MenuRegistry.onDidChangeMenu(ee=>{ee.has(C)&&Z.schedule()}));const X=this._disposables.add(new DisposableStore),Q=ee=>{let te=!1,ie=!1,ne=!1;for(const oe of ee)if(te=te||oe.isStructuralChange,ie=ie||oe.isEnablementChange,ne=ne||oe.isToggleChange,te&&ie&&ne)break;return{menu:this,isStructuralChange:te,isEnablementChange:ie,isToggleChange:ne}},J=()=>{X.add(G.onDidChangeContext(ee=>{const te=ee.affectsSome(this._menuInfo.structureContextKeys),ie=ee.affectsSome(this._menuInfo.preconditionContextKeys),ne=ee.affectsSome(this._menuInfo.toggledContextKeys);(te||ie||ne)&&this._onDidChange.fire({menu:this,isStructuralChange:te,isEnablementChange:ie,isToggleChange:ne})})),X.add(W.onDidChange(ee=>{this._onDidChange.fire({menu:this,isStructuralChange:!0,isEnablementChange:!1,isToggleChange:!1})}))};this._onDidChange=new DebounceEmitter({onWillAddFirstListener:J,onDidRemoveLastListener:X.clear.bind(X),delay:V.eventDebounceDelay,merge:Q}),this.onDidChange=this._onDidChange.event}getActions(C){return this._menuInfo.createActionGroups(C)}dispose(){this._disposables.dispose(),this._onDidChange.dispose()}};MenuImpl=__decorate$1D([__param$1D(3,ICommandService),__param$1D(4,IContextKeyService)],MenuImpl);function createMenuHide(K,C,W){const V=isISubmenuItem(C)?C.submenu.id:C.id,U=typeof C.title=="string"?C.title:C.title.value,G=toAction({id:`hide/${K.id}/${V}`,label:localize("hide.label","Hide '{0}'",U),run(){W.updateHidden(K,V,!0)}}),Z=toAction({id:`toggle/${K.id}/${V}`,label:U,get checked(){return!W.isHidden(K,V)},run(){W.updateHidden(K,V,!!this.checked)}});return{hide:G,toggle:Z,get isHidden(){return!Z.checked}}}var __decorate$1C=globalThis&&globalThis.__decorate||function(K,C,W,V){var U=arguments.length,G=U<3?C:V===null?V=Object.getOwnPropertyDescriptor(C,W):V,Z;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")G=Reflect.decorate(K,C,W,V);else for(var X=K.length-1;X>=0;X--)(Z=K[X])&&(G=(U<3?Z(G):U>3?Z(C,W,G):Z(C,W))||G);return U>3&&G&&Object.defineProperty(C,W,G),G},__param$1C=globalThis&&globalThis.__param||function(K,C){return function(W,V){C(W,V,K)}},__awaiter$1g=globalThis&&globalThis.__awaiter||function(K,C,W,V){function U(G){return G instanceof W?G:new W(function(Z){Z(G)})}return new(W||(W=Promise))(function(G,Z){function X(ee){try{J(V.next(ee))}catch(te){Z(te)}}function Q(ee){try{J(V.throw(ee))}catch(te){Z(te)}}function J(ee){ee.done?G(ee.value):U(ee.value).then(X,Q)}J((V=V.apply(K,C||[])).next())})};let BrowserClipboardService=class extends Disposable{constructor(C,W){super(),this.layoutService=C,this.logService=W,this.mapTextToType=new Map,this.findText="",this.resources=[],(isSafari||isWebkitWebView)&&this.installWebKitWriteTextWorkaround()}installWebKitWriteTextWorkaround(){const C=()=>{const W=new DeferredPromise;this.webKitPendingClipboardWritePromise&&!this.webKitPendingClipboardWritePromise.isSettled&&this.webKitPendingClipboardWritePromise.cancel(),this.webKitPendingClipboardWritePromise=W,navigator.clipboard.write([new ClipboardItem({"text/plain":W.p})]).catch(V=>__awaiter$1g(this,void 0,void 0,function*(){(!(V instanceof Error)||V.name!=="NotAllowedError"||!W.isRejected)&&this.logService.error(V)}))};this.layoutService.hasContainer&&(this._register(addDisposableListener(this.layoutService.container,"click",C)),this._register(addDisposableListener(this.layoutService.container,"keydown",C)))}writeText(C,W){return __awaiter$1g(this,void 0,void 0,function*(){if(W){this.mapTextToType.set(W,C);return}if(this.webKitPendingClipboardWritePromise)return this.webKitPendingClipboardWritePromise.complete(C);try{return yield navigator.clipboard.writeText(C)}catch(G){console.error(G)}const V=document.activeElement,U=document.body.appendChild($$d("textarea",{"aria-hidden":!0}));U.style.height="1px",U.style.width="1px",U.style.position="absolute",U.value=C,U.focus(),U.select(),document.execCommand("copy"),V instanceof HTMLElement&&V.focus(),document.body.removeChild(U)})}readText(C){return __awaiter$1g(this,void 0,void 0,function*(){if(C)return this.mapTextToType.get(C)||"";try{return yield navigator.clipboard.readText()}catch(W){return console.error(W),""}})}readFindText(){return __awaiter$1g(this,void 0,void 0,function*(){return this.findText})}writeFindText(C){return __awaiter$1g(this,void 0,void 0,function*(){this.findText=C})}writeResources(C){return __awaiter$1g(this,void 0,void 0,function*(){this.resources=C})}readResources(){return __awaiter$1g(this,void 0,void 0,function*(){return this.resources})}};BrowserClipboardService=__decorate$1C([__param$1C(0,ILayoutService),__param$1C(1,ILogService)],BrowserClipboardService);const IClipboardService=createDecorator("clipboardService");var __decorate$1B=globalThis&&globalThis.__decorate||function(K,C,W,V){var U=arguments.length,G=U<3?C:V===null?V=Object.getOwnPropertyDescriptor(C,W):V,Z;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")G=Reflect.decorate(K,C,W,V);else for(var X=K.length-1;X>=0;X--)(Z=K[X])&&(G=(U<3?Z(G):U>3?Z(C,W,G):Z(C,W))||G);return U>3&&G&&Object.defineProperty(C,W,G),G},__param$1B=globalThis&&globalThis.__param||function(K,C){return function(W,V){C(W,V,K)}};const KEYBINDING_CONTEXT_ATTR="data-keybinding-context";let Context$2=class{constructor(C,W){this._id=C,this._parent=W,this._value=Object.create(null),this._value._contextId=C}get value(){return Object.assign({},this._value)}setValue(C,W){return this._value[C]!==W?(this._value[C]=W,!0):!1}removeValue(C){return C in this._value?(delete this._value[C],!0):!1}getValue(C){const W=this._value[C];return typeof W>"u"&&this._parent?this._parent.getValue(C):W}};class NullContext extends Context$2{constructor(){super(-1,null)}setValue(C,W){return!1}removeValue(C){return!1}getValue(C){}}NullContext.INSTANCE=new NullContext;class ConfigAwareContextValuesContainer extends Context$2{constructor(C,W,V){super(C,null),this._configurationService=W,this._values=TernarySearchTree.forConfigKeys(),this._listener=this._configurationService.onDidChangeConfiguration(U=>{if(U.source===7){const G=Array.from(this._values,([Z])=>Z);this._values.clear(),V.fire(new ArrayContextKeyChangeEvent(G))}else{const G=[];for(const Z of U.affectedKeys){const X=`config.${Z}`,Q=this._values.findSuperstr(X);Q!==void 0&&(G.push(...Iterable.map(Q,([J])=>J)),this._values.deleteSuperstr(X)),this._values.has(X)&&(G.push(X),this._values.delete(X))}V.fire(new ArrayContextKeyChangeEvent(G))}})}dispose(){this._listener.dispose()}getValue(C){if(C.indexOf(ConfigAwareContextValuesContainer._keyPrefix)!==0)return super.getValue(C);if(this._values.has(C))return this._values.get(C);const W=C.substr(ConfigAwareContextValuesContainer._keyPrefix.length),V=this._configurationService.getValue(W);let U;switch(typeof V){case"number":case"boolean":case"string":U=V;break;default:Array.isArray(V)?U=JSON.stringify(V):U=V}return this._values.set(C,U),U}setValue(C,W){return super.setValue(C,W)}removeValue(C){return super.removeValue(C)}}ConfigAwareContextValuesContainer._keyPrefix="config.";class ContextKey{constructor(C,W,V){this._service=C,this._key=W,this._defaultValue=V,this.reset()}set(C){this._service.setContext(this._key,C)}reset(){typeof this._defaultValue>"u"?this._service.removeContext(this._key):this._service.setContext(this._key,this._defaultValue)}get(){return this._service.getContextKeyValue(this._key)}}class SimpleContextKeyChangeEvent{constructor(C){this.key=C}affectsSome(C){return C.has(this.key)}allKeysContainedIn(C){return this.affectsSome(C)}}class ArrayContextKeyChangeEvent{constructor(C){this.keys=C}affectsSome(C){for(const W of this.keys)if(C.has(W))return!0;return!1}allKeysContainedIn(C){return this.keys.every(W=>C.has(W))}}class CompositeContextKeyChangeEvent{constructor(C){this.events=C}affectsSome(C){for(const W of this.events)if(W.affectsSome(C))return!0;return!1}allKeysContainedIn(C){return this.events.every(W=>W.allKeysContainedIn(C))}}function allEventKeysInContext(K,C){return K.allKeysContainedIn(new Set(Object.keys(C)))}class AbstractContextKeyService extends Disposable{constructor(C){super(),this._onDidChangeContext=this._register(new PauseableEmitter({merge:W=>new CompositeContextKeyChangeEvent(W)})),this.onDidChangeContext=this._onDidChangeContext.event,this._isDisposed=!1,this._myContextId=C}createKey(C,W){if(this._isDisposed)throw new Error("AbstractContextKeyService has been disposed");return new ContextKey(this,C,W)}bufferChangeEvents(C){this._onDidChangeContext.pause();try{C()}finally{this._onDidChangeContext.resume()}}createScoped(C){if(this._isDisposed)throw new Error("AbstractContextKeyService has been disposed");return new ScopedContextKeyService(this,C)}contextMatchesRules(C){if(this._isDisposed)throw new Error("AbstractContextKeyService has been disposed");const W=this.getContextValuesContainer(this._myContextId);return C?C.evaluate(W):!0}getContextKeyValue(C){if(!this._isDisposed)return this.getContextValuesContainer(this._myContextId).getValue(C)}setContext(C,W){if(this._isDisposed)return;const V=this.getContextValuesContainer(this._myContextId);V&&V.setValue(C,W)&&this._onDidChangeContext.fire(new SimpleContextKeyChangeEvent(C))}removeContext(C){this._isDisposed||this.getContextValuesContainer(this._myContextId).removeValue(C)&&this._onDidChangeContext.fire(new SimpleContextKeyChangeEvent(C))}getContext(C){return this._isDisposed?NullContext.INSTANCE:this.getContextValuesContainer(findContextAttr(C))}dispose(){super.dispose(),this._isDisposed=!0}}let ContextKeyService=class extends AbstractContextKeyService{constructor(C){super(0),this._contexts=new Map,this._lastContextId=0;const W=this._register(new ConfigAwareContextValuesContainer(this._myContextId,C,this._onDidChangeContext));this._contexts.set(this._myContextId,W)}getContextValuesContainer(C){return this._isDisposed?NullContext.INSTANCE:this._contexts.get(C)||NullContext.INSTANCE}createChildContext(C=this._myContextId){if(this._isDisposed)throw new Error("ContextKeyService has been disposed");const W=++this._lastContextId;return this._contexts.set(W,new Context$2(W,this.getContextValuesContainer(C))),W}disposeContext(C){this._isDisposed||this._contexts.delete(C)}};ContextKeyService=__decorate$1B([__param$1B(0,IConfigurationService)],ContextKeyService);class ScopedContextKeyService extends AbstractContextKeyService{constructor(C,W){if(super(C.createChildContext()),this._parentChangeListener=this._register(new MutableDisposable),this._parent=C,this._updateParentChangeListener(),this._domNode=W,this._domNode.hasAttribute(KEYBINDING_CONTEXT_ATTR)){let V="";this._domNode.classList&&(V=Array.from(this._domNode.classList.values()).join(", ")),console.error(`Element already has context attribute${V?": "+V:""}`)}this._domNode.setAttribute(KEYBINDING_CONTEXT_ATTR,String(this._myContextId))}_updateParentChangeListener(){this._parentChangeListener.value=this._parent.onDidChangeContext(C=>{const V=this._parent.getContextValuesContainer(this._myContextId).value;allEventKeysInContext(C,V)||this._onDidChangeContext.fire(C)})}dispose(){this._isDisposed||(this._parent.disposeContext(this._myContextId),this._domNode.removeAttribute(KEYBINDING_CONTEXT_ATTR),super.dispose())}getContextValuesContainer(C){return this._isDisposed?NullContext.INSTANCE:this._parent.getContextValuesContainer(C)}createChildContext(C=this._myContextId){if(this._isDisposed)throw new Error("ScopedContextKeyService has been disposed");return this._parent.createChildContext(C)}disposeContext(C){this._isDisposed||this._parent.disposeContext(C)}}function findContextAttr(K){for(;K;){if(K.hasAttribute(KEYBINDING_CONTEXT_ATTR)){const C=K.getAttribute(KEYBINDING_CONTEXT_ATTR);return C?parseInt(C,10):NaN}K=K.parentElement}return 0}function setContext(K,C,W){K.get(IContextKeyService).createKey(String(C),stringifyURIs(W))}function stringifyURIs(K){return cloneAndChange(K,C=>{if(typeof C=="object"&&C.$mid===1)return URI.revive(C).toString();if(C instanceof URI)return C.toString()})}CommandsRegistry.registerCommand("_setContext",setContext);CommandsRegistry.registerCommand({id:"getContextKeyInfo",handler(){return[...RawContextKey.all()].sort((K,C)=>K.key.localeCompare(C.key))},description:{description:localize("getContextKeyInfo","A command that returns information about context keys"),args:[]}});CommandsRegistry.registerCommand("_generateContextKeyInfo",function(){const K=[],C=new Set;for(const W of RawContextKey.all())C.has(W.key)||(C.add(W.key),K.push(W));K.sort((W,V)=>W.key.localeCompare(V.key)),console.log(JSON.stringify(K,void 0,2))});let Node$1=class{constructor(C,W){this.key=C,this.data=W,this.incoming=new Map,this.outgoing=new Map}};class Graph{constructor(C){this._hashFn=C,this._nodes=new Map}roots(){const C=[];for(const W of this._nodes.values())W.outgoing.size===0&&C.push(W);return C}insertEdge(C,W){const V=this.lookupOrInsertNode(C),U=this.lookupOrInsertNode(W);V.outgoing.set(U.key,U),U.incoming.set(V.key,V)}removeNode(C){const W=this._hashFn(C);this._nodes.delete(W);for(const V of this._nodes.values())V.outgoing.delete(W),V.incoming.delete(W)}lookupOrInsertNode(C){const W=this._hashFn(C);let V=this._nodes.get(W);return V||(V=new Node$1(W,C),this._nodes.set(W,V)),V}isEmpty(){return this._nodes.size===0}toString(){const C=[];for(const[W,V]of this._nodes)C.push(`${W}
	(-> incoming)[${[...V.incoming.keys()].join(", ")}]
	(outgoing ->)[${[...V.outgoing.keys()].join(",")}]
`);return C.join(`
`)}findCycleSlow(){for(const[C,W]of this._nodes){const V=new Set([C]),U=this._findCycle(W,V);if(U)return U}}_findCycle(C,W){for(const[V,U]of C.outgoing){if(W.has(V))return[...W,V].join(" -> ");W.add(V);const G=this._findCycle(U,W);if(G)return G;W.delete(V)}}}const _enableAllTracing=!1;class CyclicDependencyError extends Error{constructor(C){var W;super("cyclic dependency between services"),this.message=(W=C.findCycleSlow())!==null&&W!==void 0?W:`UNABLE to detect cycle, dumping graph: 
${C.toString()}`}}class InstantiationService{constructor(C=new ServiceCollection,W=!1,V,U=_enableAllTracing){var G;this._services=C,this._strict=W,this._parent=V,this._enableTracing=U,this._activeInstantiations=new Set,this._services.set(IInstantiationService,this),this._globalGraph=U?(G=V==null?void 0:V._globalGraph)!==null&&G!==void 0?G:new Graph(Z=>Z):void 0}createChild(C){return new InstantiationService(C,this._strict,this,this._enableTracing)}invokeFunction(C,...W){const V=Trace.traceInvocation(this._enableTracing,C);let U=!1;try{return C({get:Z=>{if(U)throw illegalState("service accessor is only valid during the invocation of its target method");const X=this._getOrCreateServiceInstance(Z,V);if(!X)throw new Error(`[invokeFunction] unknown service '${Z}'`);return X}},...W)}finally{U=!0,V.stop()}}createInstance(C,...W){let V,U;return C instanceof SyncDescriptor?(V=Trace.traceCreation(this._enableTracing,C.ctor),U=this._createInstance(C.ctor,C.staticArguments.concat(W),V)):(V=Trace.traceCreation(this._enableTracing,C),U=this._createInstance(C,W,V)),V.stop(),U}_createInstance(C,W=[],V){const U=_util.getServiceDependencies(C).sort((X,Q)=>X.index-Q.index),G=[];for(const X of U){const Q=this._getOrCreateServiceInstance(X.id,V);Q||this._throwIfStrict(`[createInstance] ${C.name} depends on UNKNOWN service ${X.id}.`,!1),G.push(Q)}const Z=U.length>0?U[0].index:W.length;if(W.length!==Z){console.trace(`[createInstance] First service dependency of ${C.name} at position ${Z+1} conflicts with ${W.length} static arguments`);const X=Z-W.length;X>0?W=W.concat(new Array(X)):W=W.slice(0,Z)}return Reflect.construct(C,W.concat(G))}_setServiceInstance(C,W){if(this._services.get(C)instanceof SyncDescriptor)this._services.set(C,W);else if(this._parent)this._parent._setServiceInstance(C,W);else throw new Error("illegalState - setting UNKNOWN service instance")}_getServiceInstanceOrDescriptor(C){const W=this._services.get(C);return!W&&this._parent?this._parent._getServiceInstanceOrDescriptor(C):W}_getOrCreateServiceInstance(C,W){this._globalGraph&&this._globalGraphImplicitDependency&&this._globalGraph.insertEdge(this._globalGraphImplicitDependency,String(C));const V=this._getServiceInstanceOrDescriptor(C);return V instanceof SyncDescriptor?this._safeCreateAndCacheServiceInstance(C,V,W.branch(C,!0)):(W.branch(C,!1),V)}_safeCreateAndCacheServiceInstance(C,W,V){if(this._activeInstantiations.has(C))throw new Error(`illegal state - RECURSIVELY instantiating service '${C}'`);this._activeInstantiations.add(C);try{return this._createAndCacheServiceInstance(C,W,V)}finally{this._activeInstantiations.delete(C)}}_createAndCacheServiceInstance(C,W,V){var U;const G=new Graph(Q=>Q.id.toString());let Z=0;const X=[{id:C,desc:W,_trace:V}];for(;X.length;){const Q=X.pop();if(G.lookupOrInsertNode(Q),Z++>1e3)throw new CyclicDependencyError(G);for(const J of _util.getServiceDependencies(Q.desc.ctor)){const ee=this._getServiceInstanceOrDescriptor(J.id);if(ee||this._throwIfStrict(`[createInstance] ${C} depends on ${J.id} which is NOT registered.`,!0),(U=this._globalGraph)===null||U===void 0||U.insertEdge(String(Q.id),String(J.id)),ee instanceof SyncDescriptor){const te={id:J.id,desc:ee,_trace:Q._trace.branch(J.id,!0)};G.insertEdge(Q,te),X.push(te)}}}for(;;){const Q=G.roots();if(Q.length===0){if(!G.isEmpty())throw new CyclicDependencyError(G);break}for(const{data:J}of Q){if(this._getServiceInstanceOrDescriptor(J.id)instanceof SyncDescriptor){const te=this._createServiceInstanceWithOwner(J.id,J.desc.ctor,J.desc.staticArguments,J.desc.supportsDelayedInstantiation,J._trace);this._setServiceInstance(J.id,te)}G.removeNode(J)}}return this._getServiceInstanceOrDescriptor(C)}_createServiceInstanceWithOwner(C,W,V=[],U,G){if(this._services.get(C)instanceof SyncDescriptor)return this._createServiceInstance(C,W,V,U,G);if(this._parent)return this._parent._createServiceInstanceWithOwner(C,W,V,U,G);throw new Error(`illegalState - creating UNKNOWN service instance ${W.name}`)}_createServiceInstance(C,W,V=[],U,G){if(U){const Z=new InstantiationService(void 0,this._strict,this,this._enableTracing);Z._globalGraphImplicitDependency=String(C);const X=new Map,Q=new IdleValue(()=>{const J=Z._createInstance(W,V,G);for(const[ee,te]of X){const ie=J[ee];if(typeof ie=="function")for(const ne of te)ie.apply(J,ne)}return X.clear(),J});return new Proxy(Object.create(null),{get(J,ee){if(!Q.isInitialized&&typeof ee=="string"&&(ee.startsWith("onDid")||ee.startsWith("onWill"))){let ne=X.get(ee);return ne||(ne=new LinkedList,X.set(ee,ne)),(re,ae,se)=>{const le=ne.push([re,ae,se]);return toDisposable(le)}}if(ee in J)return J[ee];const te=Q.value;let ie=te[ee];return typeof ie!="function"||(ie=ie.bind(te),J[ee]=ie),ie},set(J,ee,te){return Q.value[ee]=te,!0},getPrototypeOf(J){return W.prototype}})}else return this._createInstance(W,V,G)}_throwIfStrict(C,W){if(W&&console.warn(C),this._strict)throw new Error(C)}}class Trace{static traceInvocation(C,W){return C?new Trace(2,W.name||new Error().stack.split(`
`).slice(3,4).join(`
`)):Trace._None}static traceCreation(C,W){return C?new Trace(1,W.name):Trace._None}constructor(C,W){this.type=C,this.name=W,this._start=Date.now(),this._dep=[]}branch(C,W){const V=new Trace(3,C.toString());return this._dep.push([C,W,V]),V}stop(){const C=Date.now()-this._start;Trace._totals+=C;let W=!1;function V(G,Z){const X=[],Q=new Array(G+1).join("	");for(const[J,ee,te]of Z._dep)if(ee&&te){W=!0,X.push(`${Q}CREATES -> ${J}`);const ie=V(G+1,te);ie&&X.push(ie)}else X.push(`${Q}uses -> ${J}`);return X.join(`
`)}const U=[`${this.type===1?"CREATE":"CALL"} ${this.name}`,`${V(1,this)}`,`DONE, took ${C.toFixed(2)}ms (grand total ${Trace._totals.toFixed(2)}ms)`];(C>2||W)&&Trace.all.add(U.join(`
`))}}Trace.all=new Set;Trace._None=new class extends Trace{constructor(){super(0,null)}stop(){}branch(){return this}};Trace._totals=0;const unsupportedSchemas=new Set([Schemas.inMemory,Schemas.vscodeSourceControl,Schemas.walkThrough,Schemas.walkThroughSnippet]);class DoubleResourceMap{constructor(){this._byResource=new ResourceMap,this._byOwner=new Map}set(C,W,V){let U=this._byResource.get(C);U||(U=new Map,this._byResource.set(C,U)),U.set(W,V);let G=this._byOwner.get(W);G||(G=new ResourceMap,this._byOwner.set(W,G)),G.set(C,V)}get(C,W){const V=this._byResource.get(C);return V==null?void 0:V.get(W)}delete(C,W){let V=!1,U=!1;const G=this._byResource.get(C);G&&(V=G.delete(W));const Z=this._byOwner.get(W);if(Z&&(U=Z.delete(C)),V!==U)throw new Error("illegal state");return V&&U}values(C){var W,V,U,G;return typeof C=="string"?(V=(W=this._byOwner.get(C))===null||W===void 0?void 0:W.values())!==null&&V!==void 0?V:Iterable.empty():URI.isUri(C)?(G=(U=this._byResource.get(C))===null||U===void 0?void 0:U.values())!==null&&G!==void 0?G:Iterable.empty():Iterable.map(Iterable.concat(...this._byOwner.values()),Z=>Z[1])}}class MarkerStats{constructor(C){this.errors=0,this.infos=0,this.warnings=0,this.unknowns=0,this._data=new ResourceMap,this._service=C,this._subscription=C.onMarkerChanged(this._update,this)}dispose(){this._subscription.dispose()}_update(C){for(const W of C){const V=this._data.get(W);V&&this._substract(V);const U=this._resourceStats(W);this._add(U),this._data.set(W,U)}}_resourceStats(C){const W={errors:0,warnings:0,infos:0,unknowns:0};if(unsupportedSchemas.has(C.scheme))return W;for(const{severity:V}of this._service.read({resource:C}))V===MarkerSeverity$1.Error?W.errors+=1:V===MarkerSeverity$1.Warning?W.warnings+=1:V===MarkerSeverity$1.Info?W.infos+=1:W.unknowns+=1;return W}_substract(C){this.errors-=C.errors,this.warnings-=C.warnings,this.infos-=C.infos,this.unknowns-=C.unknowns}_add(C){this.errors+=C.errors,this.warnings+=C.warnings,this.infos+=C.infos,this.unknowns+=C.unknowns}}class MarkerService{constructor(){this._onMarkerChanged=new DebounceEmitter({delay:0,merge:MarkerService._merge}),this.onMarkerChanged=this._onMarkerChanged.event,this._data=new DoubleResourceMap,this._stats=new MarkerStats(this)}dispose(){this._stats.dispose(),this._onMarkerChanged.dispose()}remove(C,W){for(const V of W||[])this.changeOne(C,V,[])}changeOne(C,W,V){if(isFalsyOrEmpty(V))this._data.delete(W,C)&&this._onMarkerChanged.fire([W]);else{const U=[];for(const G of V){const Z=MarkerService._toMarker(C,W,G);Z&&U.push(Z)}this._data.set(W,C,U),this._onMarkerChanged.fire([W])}}static _toMarker(C,W,V){let{code:U,severity:G,message:Z,source:X,startLineNumber:Q,startColumn:J,endLineNumber:ee,endColumn:te,relatedInformation:ie,tags:ne}=V;if(Z)return Q=Q>0?Q:1,J=J>0?J:1,ee=ee>=Q?ee:Q,te=te>0?te:J,{resource:W,owner:C,code:U,severity:G,message:Z,source:X,startLineNumber:Q,startColumn:J,endLineNumber:ee,endColumn:te,relatedInformation:ie,tags:ne}}changeAll(C,W){const V=[],U=this._data.values(C);if(U)for(const G of U){const Z=Iterable.first(G);Z&&(V.push(Z.resource),this._data.delete(Z.resource,C))}if(isNonEmptyArray$2(W)){const G=new ResourceMap;for(const{resource:Z,marker:X}of W){const Q=MarkerService._toMarker(C,Z,X);if(!Q)continue;const J=G.get(Z);J?J.push(Q):(G.set(Z,[Q]),V.push(Z))}for(const[Z,X]of G)this._data.set(Z,C,X)}V.length>0&&this._onMarkerChanged.fire(V)}read(C=Object.create(null)){let{owner:W,resource:V,severities:U,take:G}=C;if((!G||G<0)&&(G=-1),W&&V){const Z=this._data.get(V,W);if(Z){const X=[];for(const Q of Z)if(MarkerService._accept(Q,U)){const J=X.push(Q);if(G>0&&J===G)break}return X}else return[]}else if(!W&&!V){const Z=[];for(const X of this._data.values())for(const Q of X)if(MarkerService._accept(Q,U)){const J=Z.push(Q);if(G>0&&J===G)return Z}return Z}else{const Z=this._data.values(V??W),X=[];for(const Q of Z)for(const J of Q)if(MarkerService._accept(J,U)){const ee=X.push(J);if(G>0&&ee===G)return X}return X}}static _accept(C,W){return W===void 0||(W&C.severity)===C.severity}static _merge(C){const W=new ResourceMap;for(const V of C)for(const U of V)W.set(U,!0);return Array.from(W.keys())}}class DefaultConfiguration extends Disposable{constructor(){super(...arguments),this._configurationModel=new ConfigurationModel}get configurationModel(){return this._configurationModel}reload(){return this.resetConfigurationModel(),this.configurationModel}getConfigurationDefaultOverrides(){return{}}resetConfigurationModel(){this._configurationModel=new ConfigurationModel;const C=Registry.as(Extensions$6.Configuration).getConfigurationProperties();this.updateConfigurationModel(Object.keys(C),C)}updateConfigurationModel(C,W){const V=this.getConfigurationDefaultOverrides();for(const U of C){const G=V[U],Z=W[U];G!==void 0?this._configurationModel.addValue(U,G):Z?this._configurationModel.addValue(U,Z.default):this._configurationModel.removeValue(U)}}}const IAudioCueService=createDecorator("audioCue");class Sound{static register(C){return new Sound(C.fileName)}constructor(C){this.fileName=C}}Sound.error=Sound.register({fileName:"error.mp3"});Sound.warning=Sound.register({fileName:"warning.mp3"});Sound.foldedArea=Sound.register({fileName:"foldedAreas.mp3"});Sound.break=Sound.register({fileName:"break.mp3"});Sound.quickFixes=Sound.register({fileName:"quickFixes.mp3"});Sound.taskCompleted=Sound.register({fileName:"taskCompleted.mp3"});Sound.taskFailed=Sound.register({fileName:"taskFailed.mp3"});Sound.terminalBell=Sound.register({fileName:"terminalBell.mp3"});Sound.diffLineInserted=Sound.register({fileName:"diffLineInserted.mp3"});Sound.diffLineDeleted=Sound.register({fileName:"diffLineDeleted.mp3"});Sound.diffLineModified=Sound.register({fileName:"diffLineModified.mp3"});Sound.chatRequestSent=Sound.register({fileName:"chatRequestSent.mp3"});Sound.chatResponsePending=Sound.register({fileName:"chatResponsePending.mp3"});Sound.chatResponseReceived1=Sound.register({fileName:"chatResponseReceived1.mp3"});Sound.chatResponseReceived2=Sound.register({fileName:"chatResponseReceived2.mp3"});Sound.chatResponseReceived3=Sound.register({fileName:"chatResponseReceived3.mp3"});Sound.chatResponseReceived4=Sound.register({fileName:"chatResponseReceived4.mp3"});class SoundSource{constructor(C){this.randomOneOf=C}}class AudioCue{static register(C){const W=new SoundSource("randomOneOf"in C.sound?C.sound.randomOneOf:[C.sound]),V=new AudioCue(W,C.name,C.settingsKey);return AudioCue._audioCues.add(V),V}constructor(C,W,V){this.sound=C,this.name=W,this.settingsKey=V}}AudioCue._audioCues=new Set;AudioCue.error=AudioCue.register({name:localize("audioCues.lineHasError.name","Error on Line"),sound:Sound.error,settingsKey:"audioCues.lineHasError"});AudioCue.warning=AudioCue.register({name:localize("audioCues.lineHasWarning.name","Warning on Line"),sound:Sound.warning,settingsKey:"audioCues.lineHasWarning"});AudioCue.foldedArea=AudioCue.register({name:localize("audioCues.lineHasFoldedArea.name","Folded Area on Line"),sound:Sound.foldedArea,settingsKey:"audioCues.lineHasFoldedArea"});AudioCue.break=AudioCue.register({name:localize("audioCues.lineHasBreakpoint.name","Breakpoint on Line"),sound:Sound.break,settingsKey:"audioCues.lineHasBreakpoint"});AudioCue.inlineSuggestion=AudioCue.register({name:localize("audioCues.lineHasInlineSuggestion.name","Inline Suggestion on Line"),sound:Sound.quickFixes,settingsKey:"audioCues.lineHasInlineSuggestion"});AudioCue.terminalQuickFix=AudioCue.register({name:localize("audioCues.terminalQuickFix.name","Terminal Quick Fix"),sound:Sound.quickFixes,settingsKey:"audioCues.terminalQuickFix"});AudioCue.onDebugBreak=AudioCue.register({name:localize("audioCues.onDebugBreak.name","Debugger Stopped on Breakpoint"),sound:Sound.break,settingsKey:"audioCues.onDebugBreak"});AudioCue.noInlayHints=AudioCue.register({name:localize("audioCues.noInlayHints","No Inlay Hints on Line"),sound:Sound.error,settingsKey:"audioCues.noInlayHints"});AudioCue.taskCompleted=AudioCue.register({name:localize("audioCues.taskCompleted","Task Completed"),sound:Sound.taskCompleted,settingsKey:"audioCues.taskCompleted"});AudioCue.taskFailed=AudioCue.register({name:localize("audioCues.taskFailed","Task Failed"),sound:Sound.taskFailed,settingsKey:"audioCues.taskFailed"});AudioCue.terminalCommandFailed=AudioCue.register({name:localize("audioCues.terminalCommandFailed","Terminal Command Failed"),sound:Sound.error,settingsKey:"audioCues.terminalCommandFailed"});AudioCue.terminalBell=AudioCue.register({name:localize("audioCues.terminalBell","Terminal Bell"),sound:Sound.terminalBell,settingsKey:"audioCues.terminalBell"});AudioCue.notebookCellCompleted=AudioCue.register({name:localize("audioCues.notebookCellCompleted","Notebook Cell Completed"),sound:Sound.taskCompleted,settingsKey:"audioCues.notebookCellCompleted"});AudioCue.notebookCellFailed=AudioCue.register({name:localize("audioCues.notebookCellFailed","Notebook Cell Failed"),sound:Sound.taskFailed,settingsKey:"audioCues.notebookCellFailed"});AudioCue.diffLineInserted=AudioCue.register({name:localize("audioCues.diffLineInserted","Diff Line Inserted"),sound:Sound.diffLineInserted,settingsKey:"audioCues.diffLineInserted"});AudioCue.diffLineDeleted=AudioCue.register({name:localize("audioCues.diffLineDeleted","Diff Line Deleted"),sound:Sound.diffLineDeleted,settingsKey:"audioCues.diffLineDeleted"});AudioCue.diffLineModified=AudioCue.register({name:localize("audioCues.diffLineModified","Diff Line Modified"),sound:Sound.diffLineModified,settingsKey:"audioCues.diffLineModified"});AudioCue.chatRequestSent=AudioCue.register({name:localize("audioCues.chatRequestSent","Chat Request Sent"),sound:Sound.chatRequestSent,settingsKey:"audioCues.chatRequestSent"});AudioCue.chatResponseReceived=AudioCue.register({name:localize("audioCues.chatResponseReceived","Chat Response Received"),settingsKey:"audioCues.chatResponseReceived",sound:{randomOneOf:[Sound.chatResponseReceived1,Sound.chatResponseReceived2,Sound.chatResponseReceived3,Sound.chatResponseReceived4]}});AudioCue.chatResponsePending=AudioCue.register({name:localize("audioCues.chatResponsePending","Chat Response Pending"),sound:Sound.chatResponsePending,settingsKey:"audioCues.chatResponsePending"});class LogService extends Disposable{constructor(C,W=[]){super(),this.logger=new MultiplexLogger([C,...W]),this._register(C.onDidChangeLogLevel(V=>this.setLevel(V)))}get onDidChangeLogLevel(){return this.logger.onDidChangeLogLevel}setLevel(C){this.logger.setLevel(C)}getLevel(){return this.logger.getLevel()}trace(C,...W){this.logger.trace(C,...W)}debug(C,...W){this.logger.debug(C,...W)}info(C,...W){this.logger.info(C,...W)}warn(C,...W){this.logger.warn(C,...W)}error(C,...W){this.logger.error(C,...W)}}const editorFeatures=[];function registerEditorFeature(K){editorFeatures.push(K)}function getEditorFeatures(){return editorFeatures.slice(0)}var __decorate$1A=globalThis&&globalThis.__decorate||function(K,C,W,V){var U=arguments.length,G=U<3?C:V===null?V=Object.getOwnPropertyDescriptor(C,W):V,Z;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")G=Reflect.decorate(K,C,W,V);else for(var X=K.length-1;X>=0;X--)(Z=K[X])&&(G=(U<3?Z(G):U>3?Z(C,W,G):Z(C,W))||G);return U>3&&G&&Object.defineProperty(C,W,G),G},__param$1A=globalThis&&globalThis.__param||function(K,C){return function(W,V){C(W,V,K)}},__awaiter$1f=globalThis&&globalThis.__awaiter||function(K,C,W,V){function U(G){return G instanceof W?G:new W(function(Z){Z(G)})}return new(W||(W=Promise))(function(G,Z){function X(ee){try{J(V.next(ee))}catch(te){Z(te)}}function Q(ee){try{J(V.throw(ee))}catch(te){Z(te)}}function J(ee){ee.done?G(ee.value):U(ee.value).then(X,Q)}J((V=V.apply(K,C||[])).next())})};class SimpleModel{constructor(C){this.disposed=!1,this.model=C,this._onWillDispose=new Emitter$1}get textEditorModel(){return this.model}dispose(){this.disposed=!0,this._onWillDispose.fire()}}let StandaloneTextModelService=class{constructor(C){this.modelService=C}createModelReference(C){const W=this.modelService.getModel(C);return W?Promise.resolve(new ImmortalReference(new SimpleModel(W))):Promise.reject(new Error("Model not found"))}};StandaloneTextModelService=__decorate$1A([__param$1A(0,IModelService)],StandaloneTextModelService);class StandaloneEditorProgressService{show(){return StandaloneEditorProgressService.NULL_PROGRESS_RUNNER}showWhile(C,W){return __awaiter$1f(this,void 0,void 0,function*(){yield C})}}StandaloneEditorProgressService.NULL_PROGRESS_RUNNER={done:()=>{},total:()=>{},worked:()=>{}};class StandaloneProgressService{withProgress(C,W,V){return W({report:()=>{}})}}class StandaloneEnvironmentService{constructor(){this.isExtensionDevelopment=!1,this.isBuilt=!1}}class StandaloneDialogService{confirm(C){return __awaiter$1f(this,void 0,void 0,function*(){return{confirmed:this.doConfirm(C.message,C.detail),checkboxChecked:!1}})}doConfirm(C,W){let V=C;return W&&(V=V+`

`+W),window.confirm(V)}prompt(C){var W,V;return __awaiter$1f(this,void 0,void 0,function*(){let U;if(this.doConfirm(C.message,C.detail)){const Z=[...(W=C.buttons)!==null&&W!==void 0?W:[]];C.cancelButton&&typeof C.cancelButton!="string"&&typeof C.cancelButton!="boolean"&&Z.push(C.cancelButton),U=yield(V=Z[0])===null||V===void 0?void 0:V.run({checkboxChecked:!1})}return{result:U}})}error(C,W){return __awaiter$1f(this,void 0,void 0,function*(){yield this.prompt({type:Severity$2.Error,message:C,detail:W})})}}class StandaloneNotificationService{info(C){return this.notify({severity:Severity$2.Info,message:C})}warn(C){return this.notify({severity:Severity$2.Warning,message:C})}error(C){return this.notify({severity:Severity$2.Error,message:C})}notify(C){switch(C.severity){case Severity$2.Error:console.error(C.message);break;case Severity$2.Warning:console.warn(C.message);break;default:console.log(C.message);break}return StandaloneNotificationService.NO_OP}prompt(C,W,V,U){return StandaloneNotificationService.NO_OP}status(C,W){return Disposable.None}}StandaloneNotificationService.NO_OP=new NoOpNotification;let StandaloneCommandService=class{constructor(C){this._onWillExecuteCommand=new Emitter$1,this._onDidExecuteCommand=new Emitter$1,this.onDidExecuteCommand=this._onDidExecuteCommand.event,this._instantiationService=C}executeCommand(C,...W){const V=CommandsRegistry.getCommand(C);if(!V)return Promise.reject(new Error(`command '${C}' not found`));try{this._onWillExecuteCommand.fire({commandId:C,args:W});const U=this._instantiationService.invokeFunction.apply(this._instantiationService,[V.handler,...W]);return this._onDidExecuteCommand.fire({commandId:C,args:W}),Promise.resolve(U)}catch(U){return Promise.reject(U)}}};StandaloneCommandService=__decorate$1A([__param$1A(0,IInstantiationService)],StandaloneCommandService);let StandaloneKeybindingService=class extends AbstractKeybindingService{constructor(C,W,V,U,G,Z){super(C,W,V,U,G),this._cachedResolver=null,this._dynamicKeybindings=[],this._domNodeListeners=[];const X=ne=>{const oe=new DisposableStore;oe.add(addDisposableListener(ne,EventType$1.KEY_DOWN,re=>{const ae=new StandardKeyboardEvent(re);this._dispatch(ae,ae.target)&&(ae.preventDefault(),ae.stopPropagation())})),oe.add(addDisposableListener(ne,EventType$1.KEY_UP,re=>{const ae=new StandardKeyboardEvent(re);this._singleModifierDispatch(ae,ae.target)&&ae.preventDefault()})),this._domNodeListeners.push(new DomNodeListeners(ne,oe))},Q=ne=>{for(let oe=0;oe<this._domNodeListeners.length;oe++){const re=this._domNodeListeners[oe];re.domNode===ne&&(this._domNodeListeners.splice(oe,1),re.dispose())}},J=ne=>{ne.getOption(61)||X(ne.getContainerDomNode())},ee=ne=>{ne.getOption(61)||Q(ne.getContainerDomNode())};this._register(Z.onCodeEditorAdd(J)),this._register(Z.onCodeEditorRemove(ee)),Z.listCodeEditors().forEach(J);const te=ne=>{X(ne.getContainerDomNode())},ie=ne=>{Q(ne.getContainerDomNode())};this._register(Z.onDiffEditorAdd(te)),this._register(Z.onDiffEditorRemove(ie)),Z.listDiffEditors().forEach(te)}addDynamicKeybinding(C,W,V,U){return combinedDisposable(CommandsRegistry.registerCommand(C,V),this.addDynamicKeybindings([{keybinding:W,command:C,when:U}]))}addDynamicKeybindings(C){const W=C.map(V=>{var U;return{keybinding:decodeKeybinding(V.keybinding,OS),command:(U=V.command)!==null&&U!==void 0?U:null,commandArgs:V.commandArgs,when:V.when,weight1:1e3,weight2:0,extensionId:null,isBuiltinExtension:!1}});return this._dynamicKeybindings=this._dynamicKeybindings.concat(W),this.updateResolver(),toDisposable(()=>{for(let V=0;V<this._dynamicKeybindings.length;V++)if(this._dynamicKeybindings[V]===W[0]){this._dynamicKeybindings.splice(V,W.length),this.updateResolver();return}})}updateResolver(){this._cachedResolver=null,this._onDidUpdateKeybindings.fire()}_getResolver(){if(!this._cachedResolver){const C=this._toNormalizedKeybindingItems(KeybindingsRegistry.getDefaultKeybindings(),!0),W=this._toNormalizedKeybindingItems(this._dynamicKeybindings,!1);this._cachedResolver=new KeybindingResolver(C,W,V=>this._log(V))}return this._cachedResolver}_documentHasFocus(){return document.hasFocus()}_toNormalizedKeybindingItems(C,W){const V=[];let U=0;for(const G of C){const Z=G.when||void 0,X=G.keybinding;if(!X)V[U++]=new ResolvedKeybindingItem(void 0,G.command,G.commandArgs,Z,W,null,!1);else{const Q=USLayoutResolvedKeybinding.resolveKeybinding(X,OS);for(const J of Q)V[U++]=new ResolvedKeybindingItem(J,G.command,G.commandArgs,Z,W,null,!1)}}return V}resolveKeyboardEvent(C){const W=new KeyCodeChord(C.ctrlKey,C.shiftKey,C.altKey,C.metaKey,C.keyCode);return new USLayoutResolvedKeybinding([W],OS)}};StandaloneKeybindingService=__decorate$1A([__param$1A(0,IContextKeyService),__param$1A(1,ICommandService),__param$1A(2,ITelemetryService),__param$1A(3,INotificationService),__param$1A(4,ILogService),__param$1A(5,ICodeEditorService)],StandaloneKeybindingService);class DomNodeListeners extends Disposable{constructor(C,W){super(),this.domNode=C,this._register(W)}}function isConfigurationOverrides(K){return K&&typeof K=="object"&&(!K.overrideIdentifier||typeof K.overrideIdentifier=="string")&&(!K.resource||K.resource instanceof URI)}class StandaloneConfigurationService{constructor(){this._onDidChangeConfiguration=new Emitter$1,this.onDidChangeConfiguration=this._onDidChangeConfiguration.event;const C=new DefaultConfiguration;this._configuration=new Configuration(C.reload(),new ConfigurationModel,new ConfigurationModel,new ConfigurationModel),C.dispose()}getValue(C,W){const V=typeof C=="string"?C:void 0,U=isConfigurationOverrides(C)?C:isConfigurationOverrides(W)?W:{};return this._configuration.getValue(V,U,void 0)}updateValues(C){const W={data:this._configuration.toData()},V=[];for(const U of C){const[G,Z]=U;this.getValue(G)!==Z&&(this._configuration.updateValue(G,Z),V.push(G))}if(V.length>0){const U=new ConfigurationChangeEvent({keys:V,overrides:[]},W,this._configuration);U.source=8,U.sourceConfig=null,this._onDidChangeConfiguration.fire(U)}return Promise.resolve()}updateValue(C,W,V,U){return this.updateValues([[C,W]])}inspect(C,W={}){return this._configuration.inspect(C,W,void 0)}}let StandaloneResourceConfigurationService=class{constructor(C,W,V){this.configurationService=C,this.modelService=W,this.languageService=V,this._onDidChangeConfiguration=new Emitter$1,this.configurationService.onDidChangeConfiguration(U=>{this._onDidChangeConfiguration.fire({affectedKeys:U.affectedKeys,affectsConfiguration:(G,Z)=>U.affectsConfiguration(Z)})})}getValue(C,W,V){const U=Position$1.isIPosition(W)?W:null,G=U?typeof V=="string"?V:void 0:typeof W=="string"?W:void 0,Z=C?this.getLanguage(C,U):void 0;return typeof G>"u"?this.configurationService.getValue({resource:C,overrideIdentifier:Z}):this.configurationService.getValue(G,{resource:C,overrideIdentifier:Z})}getLanguage(C,W){const V=this.modelService.getModel(C);return V?W?V.getLanguageIdAtPosition(W.lineNumber,W.column):V.getLanguageId():this.languageService.guessLanguageIdByFilepathOrFirstLine(C)}};StandaloneResourceConfigurationService=__decorate$1A([__param$1A(0,IConfigurationService),__param$1A(1,IModelService),__param$1A(2,ILanguageService)],StandaloneResourceConfigurationService);let StandaloneResourcePropertiesService=class{constructor(C){this.configurationService=C}getEOL(C,W){const V=this.configurationService.getValue("files.eol",{overrideIdentifier:W,resource:C});return V&&typeof V=="string"&&V!=="auto"?V:isLinux||isMacintosh?`
`:`\r
`}};StandaloneResourcePropertiesService=__decorate$1A([__param$1A(0,IConfigurationService)],StandaloneResourcePropertiesService);class StandaloneTelemetryService{publicLog2(){}}class StandaloneWorkspaceContextService{constructor(){const C=URI.from({scheme:StandaloneWorkspaceContextService.SCHEME,authority:"model",path:"/"});this.workspace={id:STANDALONE_EDITOR_WORKSPACE_ID,folders:[new WorkspaceFolder({uri:C,name:"",index:0})]}}getWorkspace(){return this.workspace}getWorkspaceFolder(C){return C&&C.scheme===StandaloneWorkspaceContextService.SCHEME?this.workspace.folders[0]:null}}StandaloneWorkspaceContextService.SCHEME="inmemory";function updateConfigurationService(K,C,W){if(!C||!(K instanceof StandaloneConfigurationService))return;const V=[];Object.keys(C).forEach(U=>{isEditorConfigurationKey(U)&&V.push([`editor.${U}`,C[U]]),W&&isDiffEditorConfigurationKey(U)&&V.push([`diffEditor.${U}`,C[U]])}),V.length>0&&K.updateValues(V)}let StandaloneBulkEditService=class{constructor(C){this._modelService=C}hasPreviewHandler(){return!1}apply(C,W){return __awaiter$1f(this,void 0,void 0,function*(){const V=Array.isArray(C)?C:ResourceEdit.convert(C),U=new Map;for(const X of V){if(!(X instanceof ResourceTextEdit))throw new Error("bad edit - only text edits are supported");const Q=this._modelService.getModel(X.resource);if(!Q)throw new Error("bad edit - model not found");if(typeof X.versionId=="number"&&Q.getVersionId()!==X.versionId)throw new Error("bad state - model changed in the meantime");let J=U.get(Q);J||(J=[],U.set(Q,J)),J.push(EditOperation.replaceMove(Range$2.lift(X.textEdit.range),X.textEdit.text))}let G=0,Z=0;for(const[X,Q]of U)X.pushStackElement(),X.pushEditOperations([],Q,()=>[]),X.pushStackElement(),Z+=1,G+=Q.length;return{ariaSummary:format(StandaloneServicesNLS.bulkEditServiceSummary,G,Z),isApplied:G>0}})}};StandaloneBulkEditService=__decorate$1A([__param$1A(0,IModelService)],StandaloneBulkEditService);class StandaloneUriLabelService{getUriLabel(C,W){return C.scheme==="file"?C.fsPath:C.path}getUriBasenameLabel(C){return basename(C)}}let StandaloneContextViewService=class extends ContextViewService{constructor(C,W){super(C),this._codeEditorService=W}showContextView(C,W,V){if(!W){const U=this._codeEditorService.getFocusedCodeEditor()||this._codeEditorService.getActiveCodeEditor();U&&(W=U.getContainerDomNode())}return super.showContextView(C,W,V)}};StandaloneContextViewService=__decorate$1A([__param$1A(0,ILayoutService),__param$1A(1,ICodeEditorService)],StandaloneContextViewService);class StandaloneWorkspaceTrustManagementService{constructor(){this._neverEmitter=new Emitter$1,this.onDidChangeTrust=this._neverEmitter.event}isWorkspaceTrusted(){return!0}}class StandaloneLanguageService extends LanguageService{constructor(){super()}}class StandaloneLogService extends LogService{constructor(){super(new ConsoleLogger)}}let StandaloneContextMenuService=class extends ContextMenuService{constructor(C,W,V,U,G,Z){super(C,W,V,U,G,Z),this.configure({blockMouse:!1})}};StandaloneContextMenuService=__decorate$1A([__param$1A(0,ITelemetryService),__param$1A(1,INotificationService),__param$1A(2,IContextViewService),__param$1A(3,IKeybindingService),__param$1A(4,IMenuService),__param$1A(5,IContextKeyService)],StandaloneContextMenuService);class StandaloneAudioService{playAudioCue(C,W){return __awaiter$1f(this,void 0,void 0,function*(){})}}registerSingleton(IConfigurationService,StandaloneConfigurationService,0);registerSingleton(ITextResourceConfigurationService,StandaloneResourceConfigurationService,0);registerSingleton(ITextResourcePropertiesService,StandaloneResourcePropertiesService,0);registerSingleton(IWorkspaceContextService,StandaloneWorkspaceContextService,0);registerSingleton(ILabelService,StandaloneUriLabelService,0);registerSingleton(ITelemetryService,StandaloneTelemetryService,0);registerSingleton(IDialogService,StandaloneDialogService,0);registerSingleton(IEnvironmentService,StandaloneEnvironmentService,0);registerSingleton(INotificationService,StandaloneNotificationService,0);registerSingleton(IMarkerService,MarkerService,0);registerSingleton(ILanguageService,StandaloneLanguageService,0);registerSingleton(IStandaloneThemeService,StandaloneThemeService,0);registerSingleton(ILogService,StandaloneLogService,0);registerSingleton(IModelService,ModelService,0);registerSingleton(IMarkerDecorationsService,MarkerDecorationsService,0);registerSingleton(IContextKeyService,ContextKeyService,0);registerSingleton(IProgressService,StandaloneProgressService,0);registerSingleton(IEditorProgressService,StandaloneEditorProgressService,0);registerSingleton(IStorageService,InMemoryStorageService,0);registerSingleton(IEditorWorkerService,EditorWorkerService,0);registerSingleton(IBulkEditService,StandaloneBulkEditService,0);registerSingleton(IWorkspaceTrustManagementService,StandaloneWorkspaceTrustManagementService,0);registerSingleton(ITextModelService,StandaloneTextModelService,0);registerSingleton(IAccessibilityService,AccessibilityService,0);registerSingleton(IListService,ListService,0);registerSingleton(ICommandService,StandaloneCommandService,0);registerSingleton(IKeybindingService,StandaloneKeybindingService,0);registerSingleton(IQuickInputService,StandaloneQuickInputService,0);registerSingleton(IContextViewService,StandaloneContextViewService,0);registerSingleton(IOpenerService,OpenerService,0);registerSingleton(IClipboardService,BrowserClipboardService,0);registerSingleton(IContextMenuService,StandaloneContextMenuService,0);registerSingleton(IMenuService,MenuService,0);registerSingleton(IAudioCueService,StandaloneAudioService,0);var StandaloneServices;(function(K){const C=new ServiceCollection;for(const[Q,J]of getSingletonServiceDescriptors())C.set(Q,J);const W=new InstantiationService(C,!0);C.set(IInstantiationService,W);function V(Q){U||Z({});const J=C.get(Q);if(!J)throw new Error("Missing service "+Q);return J instanceof SyncDescriptor?W.invokeFunction(ee=>ee.get(Q)):J}K.get=V;let U=!1;const G=new Emitter$1;function Z(Q){if(U)return W;U=!0;for(const[ee,te]of getSingletonServiceDescriptors())C.get(ee)||C.set(ee,te);for(const ee in Q)if(Q.hasOwnProperty(ee)){const te=createDecorator(ee);C.get(te)instanceof SyncDescriptor&&C.set(te,Q[ee])}const J=getEditorFeatures();for(const ee of J)try{W.createInstance(ee)}catch(te){onUnexpectedError(te)}return G.fire(),W}K.initialize=Z;function X(Q){if(U)return Q();const J=new DisposableStore,ee=J.add(G.event(()=>{ee.dispose(),J.add(Q())}));return J}K.withServices=X})(StandaloneServices||(StandaloneServices={}));let globalObservableLogger;function getLogger(){return globalObservableLogger}let _derived;function _setDerivedOpts(K){_derived=K}class ConvenientObservable{get TChange(){return null}reportChanges(){this.get()}read(C){return C?C.readObservable(this):this.get()}map(C,W){const V=W===void 0?void 0:C,U=W===void 0?C:W;return _derived({owner:V,debugName:()=>{const G=getFunctionName(U);if(G!==void 0)return G;const X=/^\s*\(?\s*([a-zA-Z_$][a-zA-Z_$0-9]*)\s*\)?\s*=>\s*\1\.([a-zA-Z_$][a-zA-Z_$0-9]*)\s*$/.exec(U.toString());if(X)return`${this.debugName}.${X[2]}`;if(!V)return`${this.debugName} (mapped)`}},G=>U(this.read(G),G))}}class BaseObservable extends ConvenientObservable{constructor(){super(...arguments),this.observers=new Set}addObserver(C){const W=this.observers.size;this.observers.add(C),W===0&&this.onFirstObserverAdded()}removeObserver(C){this.observers.delete(C)&&this.observers.size===0&&this.onLastObserverRemoved()}onFirstObserverAdded(){}onLastObserverRemoved(){}}function transaction(K,C){const W=new TransactionImpl(K,C);try{K(W)}finally{W.finish()}}function subtransaction(K,C,W){K?C(K):transaction(C,W)}class TransactionImpl{constructor(C,W){var V;this._fn=C,this._getDebugName=W,this.updatingObservers=[],(V=getLogger())===null||V===void 0||V.handleBeginTransaction(this)}getDebugName(){return this._getDebugName?this._getDebugName():getFunctionName(this._fn)}updateObserver(C,W){this.updatingObservers.push({observer:C,observable:W}),C.beginUpdate(W)}finish(){var C;const W=this.updatingObservers;this.updatingObservers=null;for(const{observer:V,observable:U}of W)V.endUpdate(U);(C=getLogger())===null||C===void 0||C.handleEndTransaction()}}function getDebugName(K,C,W,V){let U;if(K!==void 0)if(typeof K=="function"){if(U=K(),U!==void 0)return U}else return K;if(C!==void 0&&(U=getFunctionName(C),U!==void 0))return U;if(W!==void 0){for(const G in W)if(W[G]===V)return G}}function getFunctionName(K){const C=K.toString(),V=/\/\*\*\s*@description\s*([^*]*)\*\//.exec(C),U=V?V[1]:void 0;return U==null?void 0:U.trim()}function observableValue(K,C){return typeof K=="string"?new ObservableValue(void 0,K,C):new ObservableValue(K,void 0,C)}class ObservableValue extends BaseObservable{get debugName(){var C;return(C=getDebugName(this._debugName,void 0,this._owner,this))!==null&&C!==void 0?C:"ObservableValue"}constructor(C,W,V){super(),this._owner=C,this._debugName=W,this._value=V}get(){return this._value}set(C,W,V){var U;if(this._value===C)return;let G;W||(W=G=new TransactionImpl(()=>{},()=>`Setting ${this.debugName}`));try{const Z=this._value;this._setValue(C),(U=getLogger())===null||U===void 0||U.handleObservableChanged(this,{oldValue:Z,newValue:C,change:V,didChange:!0,hadValue:!0});for(const X of this.observers)W.updateObserver(X,this),X.handleChange(this,V)}finally{G&&G.finish()}}toString(){return`${this.debugName}: ${this._value}`}_setValue(C){this._value=C}}function disposableObservableValue(K,C){return typeof K=="string"?new DisposableObservableValue(void 0,K,C):new DisposableObservableValue(K,void 0,C)}class DisposableObservableValue extends ObservableValue{_setValue(C){this._value!==C&&(this._value&&this._value.dispose(),this._value=C)}dispose(){var C;(C=this._value)===null||C===void 0||C.dispose()}}const defaultEqualityComparer=(K,C)=>K===C;function derived(K,C){return C!==void 0?new Derived(K,void 0,C,void 0,void 0,void 0,defaultEqualityComparer):new Derived(void 0,void 0,K,void 0,void 0,void 0,defaultEqualityComparer)}function derivedOpts(K,C){var W;return new Derived(K.owner,K.debugName,C,void 0,void 0,void 0,(W=K.equalityComparer)!==null&&W!==void 0?W:defaultEqualityComparer)}function derivedHandleChanges(K,C){var W;return new Derived(K.owner,K.debugName,C,K.createEmptyChangeSummary,K.handleChange,void 0,(W=K.equalityComparer)!==null&&W!==void 0?W:defaultEqualityComparer)}function derivedWithStore(K,C){let W,V;C===void 0?(W=K,V=void 0):(V=K,W=C);const U=new DisposableStore;return new Derived(V,()=>{var G;return(G=getFunctionName(W))!==null&&G!==void 0?G:"(anonymous)"},G=>(U.clear(),W(G,U)),void 0,void 0,()=>U.dispose(),defaultEqualityComparer)}_setDerivedOpts(derived);class Derived extends BaseObservable{get debugName(){var C;return(C=getDebugName(this._debugName,this._computeFn,this._owner,this))!==null&&C!==void 0?C:"(anonymous)"}constructor(C,W,V,U,G,Z=void 0,X){var Q,J;super(),this._owner=C,this._debugName=W,this._computeFn=V,this.createChangeSummary=U,this._handleChange=G,this._handleLastObserverRemoved=Z,this._equalityComparator=X,this.state=0,this.value=void 0,this.updateCount=0,this.dependencies=new Set,this.dependenciesToBeRemoved=new Set,this.changeSummary=void 0,this.changeSummary=(Q=this.createChangeSummary)===null||Q===void 0?void 0:Q.call(this),(J=getLogger())===null||J===void 0||J.handleDerivedCreated(this)}onLastObserverRemoved(){var C;this.state=0,this.value=void 0;for(const W of this.dependencies)W.removeObserver(this);this.dependencies.clear(),(C=this._handleLastObserverRemoved)===null||C===void 0||C.call(this)}get(){var C;if(this.observers.size===0){const W=this._computeFn(this,(C=this.createChangeSummary)===null||C===void 0?void 0:C.call(this));return this.onLastObserverRemoved(),W}else{do{if(this.state===1){for(const W of this.dependencies)if(W.reportChanges(),this.state===2)break}this.state===1&&(this.state=3),this._recomputeIfNeeded()}while(this.state!==3);return this.value}}_recomputeIfNeeded(){var C,W;if(this.state===3)return;const V=this.dependenciesToBeRemoved;this.dependenciesToBeRemoved=this.dependencies,this.dependencies=V;const U=this.state!==0,G=this.value;this.state=3;const Z=this.changeSummary;this.changeSummary=(C=this.createChangeSummary)===null||C===void 0?void 0:C.call(this);try{this.value=this._computeFn(this,Z)}finally{for(const Q of this.dependenciesToBeRemoved)Q.removeObserver(this);this.dependenciesToBeRemoved.clear()}const X=U&&!this._equalityComparator(G,this.value);if((W=getLogger())===null||W===void 0||W.handleDerivedRecomputed(this,{oldValue:G,newValue:this.value,change:void 0,didChange:X,hadValue:U}),X)for(const Q of this.observers)Q.handleChange(this,void 0)}toString(){return`LazyDerived<${this.debugName}>`}beginUpdate(C){this.updateCount++;const W=this.updateCount===1;if(this.state===3&&(this.state=1,!W))for(const V of this.observers)V.handlePossibleChange(this);if(W)for(const V of this.observers)V.beginUpdate(this)}endUpdate(C){if(this.updateCount--,this.updateCount===0){const W=[...this.observers];for(const V of W)V.endUpdate(this)}if(this.updateCount<0)throw new BugIndicatingError}handlePossibleChange(C){if(this.state===3&&this.dependencies.has(C)&&!this.dependenciesToBeRemoved.has(C)){this.state=1;for(const W of this.observers)W.handlePossibleChange(this)}}handleChange(C,W){if(this.dependencies.has(C)&&!this.dependenciesToBeRemoved.has(C)){const V=this._handleChange?this._handleChange({changedObservable:C,change:W,didChange:G=>G===C},this.changeSummary):!0,U=this.state===3;if(V&&(this.state===1||U)&&(this.state=2,U))for(const G of this.observers)G.handlePossibleChange(this)}}readObservable(C){C.addObserver(this);const W=C.get();return this.dependencies.add(C),this.dependenciesToBeRemoved.delete(C),W}addObserver(C){const W=!this.observers.has(C)&&this.updateCount>0;super.addObserver(C),W&&C.beginUpdate(this)}removeObserver(C){const W=this.observers.has(C)&&this.updateCount>0;super.removeObserver(C),W&&C.endUpdate(this)}}function autorunOpts(K,C){return new AutorunObserver(K.debugName,C,void 0,void 0)}function autorun(K){return new AutorunObserver(void 0,K,void 0,void 0)}function autorunHandleChanges(K,C){return new AutorunObserver(K.debugName,C,K.createEmptyChangeSummary,K.handleChange)}function autorunWithStore(K){const C=new DisposableStore,W=autorunOpts({debugName:()=>getFunctionName(K)||"(anonymous)"},V=>{C.clear(),K(V,C)});return toDisposable(()=>{W.dispose(),C.dispose()})}class AutorunObserver{get debugName(){if(typeof this._debugName=="string")return this._debugName;if(typeof this._debugName=="function"){const W=this._debugName();if(W!==void 0)return W}const C=getFunctionName(this._runFn);return C!==void 0?C:"(anonymous)"}constructor(C,W,V,U){var G,Z;this._debugName=C,this._runFn=W,this.createChangeSummary=V,this._handleChange=U,this.state=2,this.updateCount=0,this.disposed=!1,this.dependencies=new Set,this.dependenciesToBeRemoved=new Set,this.changeSummary=(G=this.createChangeSummary)===null||G===void 0?void 0:G.call(this),(Z=getLogger())===null||Z===void 0||Z.handleAutorunCreated(this),this._runIfNeeded()}dispose(){this.disposed=!0;for(const C of this.dependencies)C.removeObserver(this);this.dependencies.clear()}_runIfNeeded(){var C,W,V;if(this.state===3)return;const U=this.dependenciesToBeRemoved;this.dependenciesToBeRemoved=this.dependencies,this.dependencies=U,this.state=3;try{if(!this.disposed){(C=getLogger())===null||C===void 0||C.handleAutorunTriggered(this);const G=this.changeSummary;this.changeSummary=(W=this.createChangeSummary)===null||W===void 0?void 0:W.call(this),this._runFn(this,G)}}finally{(V=getLogger())===null||V===void 0||V.handleAutorunFinished(this);for(const G of this.dependenciesToBeRemoved)G.removeObserver(this);this.dependenciesToBeRemoved.clear()}}toString(){return`Autorun<${this.debugName}>`}beginUpdate(){this.state===3&&(this.state=1),this.updateCount++}endUpdate(){if(this.updateCount===1)do{if(this.state===1){this.state=3;for(const C of this.dependencies)if(C.reportChanges(),this.state===2)break}this._runIfNeeded()}while(this.state!==3);this.updateCount--,assertFn(()=>this.updateCount>=0)}handlePossibleChange(C){this.state===3&&this.dependencies.has(C)&&!this.dependenciesToBeRemoved.has(C)&&(this.state=1)}handleChange(C,W){this.dependencies.has(C)&&!this.dependenciesToBeRemoved.has(C)&&(!this._handleChange||this._handleChange({changedObservable:C,change:W,didChange:U=>U===C},this.changeSummary))&&(this.state=2)}readObservable(C){if(this.disposed)return C.get();C.addObserver(this);const W=C.get();return this.dependencies.add(C),this.dependenciesToBeRemoved.delete(C),W}}(function(K){K.Observer=AutorunObserver})(autorun||(autorun={}));function constObservable(K){return new ConstObservable(K)}class ConstObservable extends ConvenientObservable{constructor(C){super(),this.value=C}get debugName(){return this.toString()}get(){return this.value}addObserver(C){}removeObserver(C){}toString(){return`Const: ${this.value}`}}function waitForState(K,C){return new Promise(W=>{let V=!1,U=!1;const G=autorun(Z=>{const X=K.read(Z);C(X)&&(V?G.dispose():U=!0,W(X))});V=!0,U&&G.dispose()})}function observableFromEvent(K,C){return new FromEventObservable(K,C)}class FromEventObservable extends BaseObservable{constructor(C,W){super(),this.event=C,this._getValue=W,this.hasValue=!1,this.handleEvent=V=>{var U;const G=this._getValue(V),Z=!this.hasValue||this.value!==G;(U=getLogger())===null||U===void 0||U.handleFromEventObservableTriggered(this,{oldValue:this.value,newValue:G,change:void 0,didChange:Z,hadValue:this.hasValue}),Z&&(this.value=G,this.hasValue&&transaction(X=>{for(const Q of this.observers)X.updateObserver(Q,this),Q.handleChange(this,void 0)},()=>{const X=this.getDebugName();return"Event fired"+(X?`: ${X}`:"")}),this.hasValue=!0)}}getDebugName(){return getFunctionName(this._getValue)}get debugName(){const C=this.getDebugName();return"From Event"+(C?`: ${C}`:"")}onFirstObserverAdded(){this.subscription=this.event(this.handleEvent)}onLastObserverRemoved(){this.subscription.dispose(),this.subscription=void 0,this.hasValue=!1,this.value=void 0}get(){return this.subscription?(this.hasValue||this.handleEvent(void 0),this.value):this._getValue(void 0)}}(function(K){K.Observer=FromEventObservable})(observableFromEvent||(observableFromEvent={}));function observableSignalFromEvent(K,C){return new FromEventObservableSignal(K,C)}class FromEventObservableSignal extends BaseObservable{constructor(C,W){super(),this.debugName=C,this.event=W,this.handleEvent=()=>{transaction(V=>{for(const U of this.observers)V.updateObserver(U,this),U.handleChange(this,void 0)},()=>this.debugName)}}onFirstObserverAdded(){this.subscription=this.event(this.handleEvent)}onLastObserverRemoved(){this.subscription.dispose(),this.subscription=void 0}get(){}}function observableSignal(K){return typeof K=="string"?new ObservableSignal(K):new ObservableSignal(void 0,K)}class ObservableSignal extends BaseObservable{get debugName(){var C;return(C=getDebugName(this._debugName,void 0,this._owner,this))!==null&&C!==void 0?C:"Observable Signal"}constructor(C,W){super(),this._debugName=C,this._owner=W}trigger(C,W){if(!C){transaction(V=>{this.trigger(V,W)},()=>`Trigger signal ${this.debugName}`);return}for(const V of this.observers)C.updateObserver(V,this),V.handleChange(this,W)}get(){}}function recomputeInitiallyAndOnChange(K){const C=new KeepAliveObserver(!0);return K.addObserver(C),K.reportChanges(),toDisposable(()=>{K.removeObserver(C)})}class KeepAliveObserver{constructor(C){this.forceRecompute=C,this.counter=0}beginUpdate(C){this.counter++}endUpdate(C){this.counter--,this.counter===0&&this.forceRecompute&&C.reportChanges()}handlePossibleChange(C){}handleChange(C,W){}}const style="";function isHotReloadEnabled(){return!!env.VSCODE_DEV}function registerHotReloadHandler(K){if(isHotReloadEnabled()){const C=registerGlobalHotReloadHandler();return C.add(K),{dispose(){C.delete(K)}}}else return{dispose(){}}}function registerGlobalHotReloadHandler(){hotReloadHandlers||(hotReloadHandlers=new Set);const K=globalThis;return K.$hotReload_applyNewExports||(K.$hotReload_applyNewExports=C=>{for(const W of hotReloadHandlers){const V=W(C);if(V)return V}}),hotReloadHandlers}let hotReloadHandlers;function joinCombine(K,C,W,V){if(K.length===0)return C;if(C.length===0)return K;const U=[];let G=0,Z=0;for(;G<K.length&&Z<C.length;){const X=K[G],Q=C[Z],J=W(X),ee=W(Q);J<ee?(U.push(X),G++):J>ee?(U.push(Q),Z++):(U.push(V(X,Q)),G++,Z++)}for(;G<K.length;)U.push(K[G]),G++;for(;Z<C.length;)U.push(C[Z]),Z++;return U}function applyObservableDecorations$1(K,C){const W=new DisposableStore,V=K.createDecorationsCollection();return W.add(autorunOpts({debugName:()=>`Apply decorations from ${C.debugName}`},U=>{const G=C.read(U);V.set(G)})),W.add({dispose:()=>{V.clear()}}),W}function appendRemoveOnDispose(K,C){return K.appendChild(C),toDisposable(()=>{K.removeChild(C)})}class ObservableElementSizeObserver extends Disposable{get width(){return this._width}get height(){return this._height}constructor(C,W){super(),this.elementSizeObserver=this._register(new ElementSizeObserver(C,W)),this._width=observableValue(this,this.elementSizeObserver.getWidth()),this._height=observableValue(this,this.elementSizeObserver.getHeight()),this._register(this.elementSizeObserver.onDidChange(V=>transaction(U=>{this._width.set(this.elementSizeObserver.getWidth(),U),this._height.set(this.elementSizeObserver.getHeight(),U)})))}observe(C){this.elementSizeObserver.observe(C)}setAutomaticLayout(C){C?this.elementSizeObserver.startObserving():this.elementSizeObserver.stopObserving()}}function animatedObservable(K,C){let W=K.get(),V=W,U=W;const G=observableValue("animatedValue",W);let Z=-1;const X=300;let Q;C.add(autorunHandleChanges({createEmptyChangeSummary:()=>({animate:!1}),handleChange:(ee,te)=>(ee.didChange(K)&&(te.animate=te.animate||ee.change),!0)},(ee,te)=>{Q!==void 0&&(cancelAnimationFrame(Q),Q=void 0),V=U,W=K.read(ee),Z=Date.now()-(te.animate?0:X),J()}));function J(){const ee=Date.now()-Z;U=Math.floor(easeOutExpo(ee,V,W-V,X)),ee<X?Q=requestAnimationFrame(J):U=W,G.set(U,void 0)}return G}function easeOutExpo(K,C,W,V){return K===V?C+W:W*(-Math.pow(2,-10*K/V)+1)+C}class ViewZoneOverlayWidget extends Disposable{constructor(C,W,V){super(),this._register(new ManagedOverlayWidget(C,V)),this._register(applyStyle(V,{height:W.actualHeight,top:W.actualTop}))}}class PlaceholderViewZone{get afterLineNumber(){return this._afterLineNumber.get()}constructor(C,W){this._afterLineNumber=C,this.heightInPx=W,this.domNode=document.createElement("div"),this._actualTop=observableValue(this,void 0),this._actualHeight=observableValue(this,void 0),this.actualTop=this._actualTop,this.actualHeight=this._actualHeight,this.showInHiddenAreas=!0,this.onChange=this._afterLineNumber,this.onDomNodeTop=V=>{this._actualTop.set(V,void 0)},this.onComputedHeight=V=>{this._actualHeight.set(V,void 0)}}}class ManagedOverlayWidget{constructor(C,W){this._editor=C,this._domElement=W,this._overlayWidgetId=`managedOverlayWidget-${ManagedOverlayWidget._counter++}`,this._overlayWidget={getId:()=>this._overlayWidgetId,getDomNode:()=>this._domElement,getPosition:()=>null},this._editor.addOverlayWidget(this._overlayWidget)}dispose(){this._editor.removeOverlayWidget(this._overlayWidget)}}ManagedOverlayWidget._counter=0;function applyStyle(K,C){return autorun(W=>{for(let[V,U]of Object.entries(C))U&&typeof U=="object"&&"read"in U&&(U=U.read(W)),typeof U=="number"&&(U=`${U}px`),V=V.replace(/[A-Z]/g,G=>"-"+G.toLowerCase()),K.style[V]=U})}function readHotReloadableExport(K,C){return observeHotReloadableExports([K],C),K}function observeHotReloadableExports(K,C){isHotReloadEnabled()&&observableSignalFromEvent("reload",V=>registerHotReloadHandler(U=>{if([...Object.values(U)].some(G=>K.includes(G)))return G=>(V(void 0),!0)})).read(C)}function applyViewZones(K,C,W){const V=new DisposableStore,U=[];return V.add(autorun(G=>{const Z=C.read(G),X=new Map,Q=new Map;W&&W(!0),K.changeViewZones(J=>{for(const ee of U)J.removeZone(ee);U.length=0;for(const ee of Z){const te=J.addZone(ee);U.push(te),X.set(ee,te)}}),W&&W(!1),V.add(autorunHandleChanges({createEmptyChangeSummary(){return[]},handleChange(J,ee){const te=Q.get(J.changedObservable);return te!==void 0&&ee.push(te),!0}},(J,ee)=>{for(const te of Z)te.onChange&&(Q.set(te.onChange,X.get(te)),te.onChange.read(J));W&&W(!0),K.changeViewZones(te=>{for(const ie of ee)te.layoutZone(ie)}),W&&W(!1)}))})),V.add({dispose(){W&&W(!0),K.changeViewZones(G=>{for(const Z of U)G.removeZone(Z)}),W&&W(!1)}}),V}class DisposableCancellationTokenSource extends CancellationTokenSource$1{dispose(){super.dispose(!0)}}const accessibleDiffViewer="";var __decorate$1z=globalThis&&globalThis.__decorate||function(K,C,W,V){var U=arguments.length,G=U<3?C:V===null?V=Object.getOwnPropertyDescriptor(C,W):V,Z;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")G=Reflect.decorate(K,C,W,V);else for(var X=K.length-1;X>=0;X--)(Z=K[X])&&(G=(U<3?Z(G):U>3?Z(C,W,G):Z(C,W))||G);return U>3&&G&&Object.defineProperty(C,W,G),G},__param$1z=globalThis&&globalThis.__param||function(K,C){return function(W,V){C(W,V,K)}},__awaiter$1e=globalThis&&globalThis.__awaiter||function(K,C,W,V){function U(G){return G instanceof W?G:new W(function(Z){Z(G)})}return new(W||(W=Promise))(function(G,Z){function X(ee){try{J(V.next(ee))}catch(te){Z(te)}}function Q(ee){try{J(V.throw(ee))}catch(te){Z(te)}}function J(ee){ee.done?G(ee.value):U(ee.value).then(X,Q)}J((V=V.apply(K,C||[])).next())})};const accessibleDiffViewerInsertIcon=registerIcon("diff-review-insert",Codicon.add,localize("accessibleDiffViewerInsertIcon","Icon for 'Insert' in accessible diff viewer.")),accessibleDiffViewerRemoveIcon=registerIcon("diff-review-remove",Codicon.remove,localize("accessibleDiffViewerRemoveIcon","Icon for 'Remove' in accessible diff viewer.")),accessibleDiffViewerCloseIcon=registerIcon("diff-review-close",Codicon.close,localize("accessibleDiffViewerCloseIcon","Icon for 'Close' in accessible diff viewer."));let AccessibleDiffViewer=class extends Disposable{constructor(C,W,V,U,G,Z,X,Q,J){super(),this._parentNode=C,this._visible=W,this._setVisible=V,this._canClose=U,this._width=G,this._height=Z,this._diffs=X,this._editors=Q,this._instantiationService=J,this.model=derivedWithStore(this,(ee,te)=>{const ie=this._visible.read(ee);if(this._parentNode.style.visibility=ie?"visible":"hidden",!ie)return null;const ne=te.add(this._instantiationService.createInstance(ViewModel,this._diffs,this._editors,this._setVisible,this._canClose)),oe=te.add(this._instantiationService.createInstance(View,this._parentNode,ne,this._width,this._height,this._editors));return{model:ne,view:oe}}),this._register(recomputeInitiallyAndOnChange(this.model))}next(){transaction(C=>{const W=this._visible.get();this._setVisible(!0,C),W&&this.model.get().model.nextGroup(C)})}prev(){transaction(C=>{this._setVisible(!0,C),this.model.get().model.previousGroup(C)})}close(){transaction(C=>{this._setVisible(!1,C)})}};AccessibleDiffViewer._ttPolicy=createTrustedTypesPolicy("diffReview",{createHTML:K=>K});AccessibleDiffViewer=__decorate$1z([__param$1z(8,IInstantiationService)],AccessibleDiffViewer);let ViewModel=class extends Disposable{constructor(C,W,V,U,G){super(),this._diffs=C,this._editors=W,this._setVisible=V,this.canClose=U,this._audioCueService=G,this._groups=observableValue(this,[]),this._currentGroupIdx=observableValue(this,0),this._currentElementIdx=observableValue(this,0),this.groups=this._groups,this.currentGroup=this._currentGroupIdx.map((Z,X)=>this._groups.read(X)[Z]),this.currentGroupIndex=this._currentGroupIdx,this.currentElement=this._currentElementIdx.map((Z,X)=>{var Q;return(Q=this.currentGroup.read(X))===null||Q===void 0?void 0:Q.lines[Z]}),this._register(autorun(Z=>{const X=this._diffs.read(Z);if(!X){this._groups.set([],void 0);return}const Q=computeViewElementGroups(X,this._editors.original.getModel().getLineCount(),this._editors.modified.getModel().getLineCount());transaction(J=>{const ee=this._editors.modified.getPosition();if(ee){const te=Q.findIndex(ie=>(ee==null?void 0:ee.lineNumber)<ie.range.modified.endLineNumberExclusive);te!==-1&&this._currentGroupIdx.set(te,J)}this._groups.set(Q,J)})})),this._register(autorun(Z=>{const X=this.currentElement.read(Z);(X==null?void 0:X.type)===LineType.Deleted?this._audioCueService.playAudioCue(AudioCue.diffLineDeleted,{source:"accessibleDiffViewer.currentElementChanged"}):(X==null?void 0:X.type)===LineType.Added&&this._audioCueService.playAudioCue(AudioCue.diffLineInserted,{source:"accessibleDiffViewer.currentElementChanged"})})),this._register(autorun(Z=>{var X;const Q=this.currentElement.read(Z);if(Q&&Q.type!==LineType.Header){const J=(X=Q.modifiedLineNumber)!==null&&X!==void 0?X:Q.diff.modified.startLineNumber;this._editors.modified.setSelection(Range$2.fromPositions(new Position$1(J,1)))}}))}_goToGroupDelta(C,W){const V=this.groups.get();!V||V.length<=1||subtransaction(W,U=>{this._currentGroupIdx.set(OffsetRange.ofLength(V.length).clipCyclic(this._currentGroupIdx.get()+C),U),this._currentElementIdx.set(0,U)})}nextGroup(C){this._goToGroupDelta(1,C)}previousGroup(C){this._goToGroupDelta(-1,C)}_goToLineDelta(C){const W=this.currentGroup.get();!W||W.lines.length<=1||transaction(V=>{this._currentElementIdx.set(OffsetRange.ofLength(W.lines.length).clip(this._currentElementIdx.get()+C),V)})}goToNextLine(){this._goToLineDelta(1)}goToPreviousLine(){this._goToLineDelta(-1)}goToLine(C){const W=this.currentGroup.get();if(!W)return;const V=W.lines.indexOf(C);V!==-1&&transaction(U=>{this._currentElementIdx.set(V,U)})}revealCurrentElementInEditor(){this._setVisible(!1,void 0);const C=this.currentElement.get();C&&(C.type===LineType.Deleted?(this._editors.original.setSelection(Range$2.fromPositions(new Position$1(C.originalLineNumber,1))),this._editors.original.revealLine(C.originalLineNumber),this._editors.original.focus()):(C.type!==LineType.Header&&(this._editors.modified.setSelection(Range$2.fromPositions(new Position$1(C.modifiedLineNumber,1))),this._editors.modified.revealLine(C.modifiedLineNumber)),this._editors.modified.focus()))}close(){this._setVisible(!1,void 0),this._editors.modified.focus()}};ViewModel=__decorate$1z([__param$1z(4,IAudioCueService)],ViewModel);const viewElementGroupLineMargin=3;function computeViewElementGroups(K,C,W){const V=[];for(const U of groupAdjacentBy(K,(G,Z)=>Z.modified.startLineNumber-G.modified.endLineNumberExclusive<2*viewElementGroupLineMargin)){const G=[];G.push(new HeaderViewElement);const Z=new LineRange$1(Math.max(1,U[0].original.startLineNumber-viewElementGroupLineMargin),Math.min(U[U.length-1].original.endLineNumberExclusive+viewElementGroupLineMargin,C+1)),X=new LineRange$1(Math.max(1,U[0].modified.startLineNumber-viewElementGroupLineMargin),Math.min(U[U.length-1].modified.endLineNumberExclusive+viewElementGroupLineMargin,W+1));forEachAdjacent(U,(ee,te)=>{const ie=new LineRange$1(ee?ee.original.endLineNumberExclusive:Z.startLineNumber,te?te.original.startLineNumber:Z.endLineNumberExclusive),ne=new LineRange$1(ee?ee.modified.endLineNumberExclusive:X.startLineNumber,te?te.modified.startLineNumber:X.endLineNumberExclusive);ie.forEach(oe=>{G.push(new UnchangedLineViewElement(oe,ne.startLineNumber+(oe-ie.startLineNumber)))}),te&&(te.original.forEach(oe=>{G.push(new DeletedLineViewElement(te,oe))}),te.modified.forEach(oe=>{G.push(new AddedLineViewElement(te,oe))}))});const Q=U[0].modified.join(U[U.length-1].modified),J=U[0].original.join(U[U.length-1].original);V.push(new ViewElementGroup(new LineRangeMapping(Q,J),G))}return V}var LineType;(function(K){K[K.Header=0]="Header",K[K.Unchanged=1]="Unchanged",K[K.Deleted=2]="Deleted",K[K.Added=3]="Added"})(LineType||(LineType={}));class ViewElementGroup{constructor(C,W){this.range=C,this.lines=W}}class HeaderViewElement{constructor(){this.type=LineType.Header}}class DeletedLineViewElement{constructor(C,W){this.diff=C,this.originalLineNumber=W,this.type=LineType.Deleted,this.modifiedLineNumber=void 0}}class AddedLineViewElement{constructor(C,W){this.diff=C,this.modifiedLineNumber=W,this.type=LineType.Added,this.originalLineNumber=void 0}}class UnchangedLineViewElement{constructor(C,W){this.originalLineNumber=C,this.modifiedLineNumber=W,this.type=LineType.Unchanged}}let View=class extends Disposable{constructor(C,W,V,U,G,Z){super(),this._element=C,this._model=W,this._width=V,this._height=U,this._editors=G,this._languageService=Z,this.domNode=this._element,this.domNode.className="diff-review monaco-editor-background";const X=document.createElement("div");X.className="diff-review-actions",this._actionBar=this._register(new ActionBar(X)),this._register(autorun(Q=>{this._actionBar.clear(),this._model.canClose.read(Q)&&this._actionBar.push(new Action("diffreview.close",localize("label.close","Close"),"close-diff-review "+ThemeIcon.asClassName(accessibleDiffViewerCloseIcon),!0,()=>__awaiter$1e(this,void 0,void 0,function*(){return W.close()})),{label:!1,icon:!0})})),this._content=document.createElement("div"),this._content.className="diff-review-content",this._content.setAttribute("role","code"),this._scrollbar=this._register(new DomScrollableElement(this._content,{})),reset(this.domNode,this._scrollbar.getDomNode(),X),this._register(toDisposable(()=>{reset(this.domNode)})),this._register(applyStyle(this.domNode,{width:this._width,height:this._height})),this._register(applyStyle(this._content,{width:this._width,height:this._height})),this._register(autorunWithStore((Q,J)=>{this._model.currentGroup.read(Q),this._render(J)})),this._register(addStandardDisposableListener(this.domNode,"keydown",Q=>{(Q.equals(18)||Q.equals(2066)||Q.equals(530))&&(Q.preventDefault(),this._model.goToNextLine()),(Q.equals(16)||Q.equals(2064)||Q.equals(528))&&(Q.preventDefault(),this._model.goToPreviousLine()),(Q.equals(9)||Q.equals(2057)||Q.equals(521)||Q.equals(1033))&&(Q.preventDefault(),this._model.close()),(Q.equals(10)||Q.equals(3))&&(Q.preventDefault(),this._model.revealCurrentElementInEditor())}))}_render(C){const W=this._editors.original.getOptions(),V=this._editors.modified.getOptions(),U=document.createElement("div");U.className="diff-review-table",U.setAttribute("role","list"),U.setAttribute("aria-label",localize("ariaLabel","Accessible Diff Viewer. Use arrow up and down to navigate.")),applyFontInfo(U,V.get(50)),reset(this._content,U);const G=this._editors.original.getModel(),Z=this._editors.modified.getModel();if(!G||!Z)return;const X=G.getOptions(),Q=Z.getOptions(),J=V.get(66),ee=this._model.currentGroup.get();for(const te of(ee==null?void 0:ee.lines)||[]){if(!ee)break;let ie;if(te.type===LineType.Header){const oe=document.createElement("div");oe.className="diff-review-row",oe.setAttribute("role","listitem");const re=ee.range,ae=this._model.currentGroupIndex.get(),se=this._model.groups.get().length,le=ge=>ge===0?localize("no_lines_changed","no lines changed"):ge===1?localize("one_line_changed","1 line changed"):localize("more_lines_changed","{0} lines changed",ge),ce=le(re.original.length),de=le(re.modified.length);oe.setAttribute("aria-label",localize({key:"header",comment:["This is the ARIA label for a git diff header.","A git diff header looks like this: @@ -154,12 +159,39 @@.","That encodes that at original line 154 (which is now line 159), 12 lines were removed/changed with 39 lines.","Variables 0 and 1 refer to the diff index out of total number of diffs.","Variables 2 and 4 will be numbers (a line number).",'Variables 3 and 5 will be "no lines changed", "1 line changed" or "X lines changed", localized separately.']},"Difference {0} of {1}: original line {2}, {3}, modified line {4}, {5}",ae+1,se,re.original.startLineNumber,ce,re.modified.startLineNumber,de));const ue=document.createElement("div");ue.className="diff-review-cell diff-review-summary",ue.appendChild(document.createTextNode(`${ae+1}/${se}: @@ -${re.original.startLineNumber},${re.original.length} +${re.modified.startLineNumber},${re.modified.length} @@`)),oe.appendChild(ue),ie=oe}else ie=this._createRow(te,J,this._width.get(),W,G,X,V,Z,Q);U.appendChild(ie);const ne=derived(oe=>this._model.currentElement.read(oe)===te);C.add(autorun(oe=>{const re=ne.read(oe);ie.tabIndex=re?0:-1,re&&ie.focus()})),C.add(addDisposableListener(ie,"focus",()=>{this._model.goToLine(te)}))}this._scrollbar.scanDomNode()}_createRow(C,W,V,U,G,Z,X,Q,J){const ee=U.get(143),te=ee.glyphMarginWidth+ee.lineNumbersWidth,ie=X.get(143),ne=10+ie.glyphMarginWidth+ie.lineNumbersWidth;let oe="diff-review-row",re="";const ae="diff-review-spacer";let se=null;switch(C.type){case LineType.Added:oe="diff-review-row line-insert",re=" char-insert",se=accessibleDiffViewerInsertIcon;break;case LineType.Deleted:oe="diff-review-row line-delete",re=" char-delete",se=accessibleDiffViewerRemoveIcon;break}const le=document.createElement("div");le.style.minWidth=V+"px",le.className=oe,le.setAttribute("role","listitem"),le.ariaLevel="";const ce=document.createElement("div");ce.className="diff-review-cell",ce.style.height=`${W}px`,le.appendChild(ce);const de=document.createElement("span");de.style.width=te+"px",de.style.minWidth=te+"px",de.className="diff-review-line-number"+re,C.originalLineNumber!==void 0?de.appendChild(document.createTextNode(String(C.originalLineNumber))):de.innerText=" ",ce.appendChild(de);const ue=document.createElement("span");ue.style.width=ne+"px",ue.style.minWidth=ne+"px",ue.style.paddingRight="10px",ue.className="diff-review-line-number"+re,C.modifiedLineNumber!==void 0?ue.appendChild(document.createTextNode(String(C.modifiedLineNumber))):ue.innerText=" ",ce.appendChild(ue);const ge=document.createElement("span");if(ge.className=ae,se){const pe=document.createElement("span");pe.className=ThemeIcon.asClassName(se),pe.innerText="  ",ge.appendChild(pe)}else ge.innerText="  ";ce.appendChild(ge);let he;if(C.modifiedLineNumber!==void 0){let pe=this._getLineHtml(Q,X,J.tabSize,C.modifiedLineNumber,this._languageService.languageIdCodec);AccessibleDiffViewer._ttPolicy&&(pe=AccessibleDiffViewer._ttPolicy.createHTML(pe)),ce.insertAdjacentHTML("beforeend",pe),he=Q.getLineContent(C.modifiedLineNumber)}else{let pe=this._getLineHtml(G,U,Z.tabSize,C.originalLineNumber,this._languageService.languageIdCodec);AccessibleDiffViewer._ttPolicy&&(pe=AccessibleDiffViewer._ttPolicy.createHTML(pe)),ce.insertAdjacentHTML("beforeend",pe),he=G.getLineContent(C.originalLineNumber)}he.length===0&&(he=localize("blankLine","blank"));let fe="";switch(C.type){case LineType.Unchanged:C.originalLineNumber===C.modifiedLineNumber?fe=localize({key:"unchangedLine",comment:["The placeholders are contents of the line and should not be translated."]},"{0} unchanged line {1}",he,C.originalLineNumber):fe=localize("equalLine","{0} original line {1} modified line {2}",he,C.originalLineNumber,C.modifiedLineNumber);break;case LineType.Added:fe=localize("insertLine","+ {0} modified line {1}",he,C.modifiedLineNumber);break;case LineType.Deleted:fe=localize("deleteLine","- {0} original line {1}",he,C.originalLineNumber);break}return le.setAttribute("aria-label",fe),le}_getLineHtml(C,W,V,U,G){const Z=C.getLineContent(U),X=W.get(50),Q=LineTokens.createEmpty(Z,G),J=ViewLineRenderingData.isBasicASCII(Z,C.mightContainNonBasicASCII()),ee=ViewLineRenderingData.containsRTL(Z,J,C.mightContainRTL());return renderViewLine2(new RenderLineInput(X.isMonospace&&!W.get(33),X.canUseHalfwidthRightwardsArrow,Z,!1,J,ee,0,Q,[],V,0,X.spaceWidth,X.middotWidth,X.wsmiddotWidth,W.get(116),W.get(98),W.get(93),W.get(51)!==EditorFontLigatures.OFF,null)).html}};View=__decorate$1z([__param$1z(5,ILanguageService)],View);const diffInsertIcon=registerIcon("diff-insert",Codicon.add,localize("diffInsertIcon","Line decoration for inserts in the diff editor.")),diffRemoveIcon=registerIcon("diff-remove",Codicon.remove,localize("diffRemoveIcon","Line decoration for removals in the diff editor.")),diffLineAddDecorationBackgroundWithIndicator=ModelDecorationOptions.register({className:"line-insert",description:"line-insert",isWholeLine:!0,linesDecorationsClassName:"insert-sign "+ThemeIcon.asClassName(diffInsertIcon),marginClassName:"gutter-insert"}),diffLineDeleteDecorationBackgroundWithIndicator=ModelDecorationOptions.register({className:"line-delete",description:"line-delete",isWholeLine:!0,linesDecorationsClassName:"delete-sign "+ThemeIcon.asClassName(diffRemoveIcon),marginClassName:"gutter-delete"}),diffLineAddDecorationBackground=ModelDecorationOptions.register({className:"line-insert",description:"line-insert",isWholeLine:!0,marginClassName:"gutter-insert"}),diffLineDeleteDecorationBackground=ModelDecorationOptions.register({className:"line-delete",description:"line-delete",isWholeLine:!0,marginClassName:"gutter-delete"}),diffAddDecoration=ModelDecorationOptions.register({className:"char-insert",description:"char-insert",shouldFillLineOnLineBreak:!0}),diffWholeLineAddDecoration=ModelDecorationOptions.register({className:"char-insert",description:"char-insert",isWholeLine:!0}),diffAddDecorationEmpty=ModelDecorationOptions.register({className:"char-insert diff-range-empty",description:"char-insert diff-range-empty"}),diffDeleteDecoration=ModelDecorationOptions.register({className:"char-delete",description:"char-delete",shouldFillLineOnLineBreak:!0}),diffWholeLineDeleteDecoration=ModelDecorationOptions.register({className:"char-delete",description:"char-delete",isWholeLine:!0}),diffDeleteDecorationEmpty=ModelDecorationOptions.register({className:"char-delete diff-range-empty",description:"char-delete diff-range-empty"}),arrowRevertChange=ModelDecorationOptions.register({description:"diff-editor-arrow-revert-change",glyphMarginHoverMessage:new MarkdownString(void 0,{isTrusted:!0,supportThemeIcons:!0}).appendMarkdown(localize("revertChangeHoverMessage","Click to revert change")),glyphMarginClassName:"arrow-revert-change "+ThemeIcon.asClassName(Codicon.arrowRight),zIndex:10001});class MovedBlocksLinesPart extends Disposable{constructor(C,W,V,U,G){super(),this._rootElement=C,this._diffModel=W,this._originalEditorLayoutInfo=V,this._modifiedEditorLayoutInfo=U,this._editors=G,this._originalScrollTop=observableFromEvent(this._editors.original.onDidScrollChange,()=>this._editors.original.getScrollTop()),this._modifiedScrollTop=observableFromEvent(this._editors.modified.onDidScrollChange,()=>this._editors.modified.getScrollTop()),this._viewZonesChanged=observableSignalFromEvent("onDidChangeViewZones",this._editors.modified.onDidChangeViewZones),this.width=observableValue(this,0),this._modifiedViewZonesChangedSignal=observableSignalFromEvent("modified.onDidChangeViewZones",this._editors.modified.onDidChangeViewZones),this._originalViewZonesChangedSignal=observableSignalFromEvent("original.onDidChangeViewZones",this._editors.original.onDidChangeViewZones),this._state=derivedWithStore((ie,ne)=>{var oe;this._element.replaceChildren();const re=this._diffModel.read(ie),ae=(oe=re==null?void 0:re.diff.read(ie))===null||oe===void 0?void 0:oe.movedTexts;if(!ae||ae.length===0){this.width.set(0,void 0);return}this._viewZonesChanged.read(ie);const se=this._originalEditorLayoutInfo.read(ie),le=this._modifiedEditorLayoutInfo.read(ie);if(!se||!le){this.width.set(0,void 0);return}this._modifiedViewZonesChangedSignal.read(ie),this._originalViewZonesChangedSignal.read(ie);const ce=ae.map(Se=>{function Le(Ue,ze){const Fe=ze.getTopForLineNumber(Ue.startLineNumber,!0),Ae=ze.getTopForLineNumber(Ue.endLineNumberExclusive,!0);return(Fe+Ae)/2}const be=Le(Se.lineRangeMapping.original,this._editors.original),Ce=this._originalScrollTop.read(ie),De=Le(Se.lineRangeMapping.modified,this._editors.modified),ke=this._modifiedScrollTop.read(ie),Me=be-Ce,Oe=De-ke,Be=Math.min(be,De),Pe=Math.max(be,De);return{range:new OffsetRange(Be,Pe),from:Me,to:Oe,fromWithoutScroll:be,toWithoutScroll:De,move:Se}});ce.sort(tieBreakComparators(compareBy(Se=>Se.fromWithoutScroll>Se.toWithoutScroll,booleanComparator),compareBy(Se=>Se.fromWithoutScroll>Se.toWithoutScroll?Se.fromWithoutScroll:-Se.toWithoutScroll,numberComparator)));const de=LinesLayout.compute(ce.map(Se=>Se.range)),ue=10,ge=se.verticalScrollbarWidth,he=(de.getTrackCount()-1)*10+ue*2,fe=ge+he+(le.contentLeft-MovedBlocksLinesPart.movedCodeBlockPadding);let pe=0;for(const Se of ce){const Le=de.getTrack(pe),be=ge+ue+Le*10,Ce=15,De=15,ke=fe,Me=le.glyphMarginWidth+le.lineNumbersWidth,Oe=18,Be=document.createElementNS("http://www.w3.org/2000/svg","rect");Be.classList.add("arrow-rectangle"),Be.setAttribute("x",`${ke-Me}`),Be.setAttribute("y",`${Se.to-Oe/2}`),Be.setAttribute("width",`${Me}`),Be.setAttribute("height",`${Oe}`),this._element.appendChild(Be);const Pe=document.createElementNS("http://www.w3.org/2000/svg","g"),Ue=document.createElementNS("http://www.w3.org/2000/svg","path");Ue.setAttribute("d",`M 0 ${Se.from} L ${be} ${Se.from} L ${be} ${Se.to} L ${ke-De} ${Se.to}`),Ue.setAttribute("fill","none"),Pe.appendChild(Ue);const ze=document.createElementNS("http://www.w3.org/2000/svg","polygon");ze.classList.add("arrow"),ne.add(autorun(Fe=>{Ue.classList.toggle("currentMove",Se.move===re.activeMovedText.read(Fe)),ze.classList.toggle("currentMove",Se.move===re.activeMovedText.read(Fe))})),ze.setAttribute("points",`${ke-De},${Se.to-Ce/2} ${ke},${Se.to} ${ke-De},${Se.to+Ce/2}`),Pe.appendChild(ze),this._element.appendChild(Pe),pe++}this.width.set(he,void 0)}),this._element=document.createElementNS("http://www.w3.org/2000/svg","svg"),this._element.setAttribute("class","moved-blocks-lines"),this._rootElement.appendChild(this._element),this._register(toDisposable(()=>this._element.remove())),this._register(autorun(ie=>{const ne=this._originalEditorLayoutInfo.read(ie),oe=this._modifiedEditorLayoutInfo.read(ie);!ne||!oe||(this._element.style.left=`${ne.width-ne.verticalScrollbarWidth}px`,this._element.style.height=`${ne.height}px`,this._element.style.width=`${ne.verticalScrollbarWidth+ne.contentLeft-MovedBlocksLinesPart.movedCodeBlockPadding+this.width.read(ie)}px`)})),this._register(recomputeInitiallyAndOnChange(this._state));const Z=derived(ie=>{const ne=this._diffModel.read(ie),oe=ne==null?void 0:ne.diff.read(ie);return oe?oe.movedTexts.map(re=>({move:re,original:new PlaceholderViewZone(constObservable(re.lineRangeMapping.original.startLineNumber-1),18),modified:new PlaceholderViewZone(constObservable(re.lineRangeMapping.modified.startLineNumber-1),18)})):[]});this._register(applyViewZones(this._editors.original,Z.map(ie=>ie.map(ne=>ne.original)))),this._register(applyViewZones(this._editors.modified,Z.map(ie=>ie.map(ne=>ne.modified)))),this._register(autorunWithStore((ie,ne)=>{const oe=Z.read(ie);for(const re of oe)ne.add(new MovedBlockOverlayWidget(this._editors.original,re.original,re.move,"original",this._diffModel.get())),ne.add(new MovedBlockOverlayWidget(this._editors.modified,re.modified,re.move,"modified",this._diffModel.get()))}));const X=observableFromEvent(this._editors.original.onDidChangeCursorPosition,()=>this._editors.original.getPosition()),Q=observableFromEvent(this._editors.modified.onDidChangeCursorPosition,()=>this._editors.modified.getPosition()),J=observableSignalFromEvent("original.onDidFocusEditorWidget",ie=>this._editors.original.onDidFocusEditorWidget(()=>setTimeout(()=>ie(void 0),0))),ee=observableSignalFromEvent("modified.onDidFocusEditorWidget",ie=>this._editors.modified.onDidFocusEditorWidget(()=>setTimeout(()=>ie(void 0),0)));let te="modified";this._register(autorunHandleChanges({createEmptyChangeSummary:()=>{},handleChange:(ie,ne)=>(ie.didChange(J)&&(te="original"),ie.didChange(ee)&&(te="modified"),!0)},ie=>{J.read(ie),ee.read(ie);const ne=this._diffModel.read(ie);if(!ne)return;const oe=ne.diff.read(ie);let re;if(oe&&te==="original"){const ae=X.read(ie);ae&&(re=oe.movedTexts.find(se=>se.lineRangeMapping.original.contains(ae.lineNumber)))}if(oe&&te==="modified"){const ae=Q.read(ie);ae&&(re=oe.movedTexts.find(se=>se.lineRangeMapping.modified.contains(ae.lineNumber)))}re!==ne.movedTextToCompare.get()&&ne.movedTextToCompare.set(void 0,void 0),ne.setActiveMovedText(re)}))}}MovedBlocksLinesPart.movedCodeBlockPadding=4;class LinesLayout{static compute(C){const W=[],V=[];for(const U of C){let G=W.findIndex(Z=>!Z.intersectsStrict(U));G===-1&&(W.length>=6?G=findMaxIdxBy(W,compareBy(X=>X.intersectWithRangeLength(U),numberComparator)):(G=W.length,W.push(new OffsetRangeSet))),W[G].addRange(U),V.push(G)}return new LinesLayout(W.length,V)}constructor(C,W){this._trackCount=C,this.trackPerLineIdx=W}getTrack(C){return this.trackPerLineIdx[C]}getTrackCount(){return this._trackCount}}class MovedBlockOverlayWidget extends ViewZoneOverlayWidget{constructor(C,W,V,U,G){const Z=h("div.diff-hidden-lines-widget");super(C,W,Z.root),this._editor=C,this._move=V,this._kind=U,this._diffModel=G,this._nodes=h("div.diff-moved-code-block",{style:{marginRight:"4px"}},[h("div.text-content@textContent"),h("div.action-bar@actionBar")]),Z.root.appendChild(this._nodes.root);const X=observableFromEvent(this._editor.onDidLayoutChange,()=>this._editor.getLayoutInfo());this._register(applyStyle(this._nodes.root,{paddingRight:X.map(ie=>ie.verticalScrollbarWidth)}));let Q;V.changes.length>0?Q=this._kind==="original"?localize("codeMovedToWithChanges","Code moved with changes to line {0}-{1}",this._move.lineRangeMapping.modified.startLineNumber,this._move.lineRangeMapping.modified.endLineNumberExclusive-1):localize("codeMovedFromWithChanges","Code moved with changes from line {0}-{1}",this._move.lineRangeMapping.original.startLineNumber,this._move.lineRangeMapping.original.endLineNumberExclusive-1):Q=this._kind==="original"?localize("codeMovedTo","Code moved to line {0}-{1}",this._move.lineRangeMapping.modified.startLineNumber,this._move.lineRangeMapping.modified.endLineNumberExclusive-1):localize("codeMovedFrom","Code moved from line {0}-{1}",this._move.lineRangeMapping.original.startLineNumber,this._move.lineRangeMapping.original.endLineNumberExclusive-1);const J=this._register(new ActionBar(this._nodes.actionBar,{highlightToggledItems:!0})),ee=new Action("",Q,"",!1);J.push(ee,{icon:!1,label:!0});const te=new Action("","Compare",ThemeIcon.asClassName(Codicon.compareChanges),!0,()=>{this._editor.focus(),this._diffModel.movedTextToCompare.set(this._diffModel.movedTextToCompare.get()===V?void 0:this._move,void 0)});this._register(autorun(ie=>{const ne=this._diffModel.movedTextToCompare.read(ie)===V;te.checked=ne})),J.push(te,{icon:!1,label:!0})}}class DiffEditorDecorations extends Disposable{constructor(C,W,V){super(),this._editors=C,this._diffModel=W,this._options=V,this._decorations=derived(this,U=>{var G;const Z=(G=this._diffModel.read(U))===null||G===void 0?void 0:G.diff.read(U);if(!Z)return null;const X=this._diffModel.read(U).movedTextToCompare.read(U),Q=this._options.renderIndicators.read(U),J=this._options.showEmptyDecorations.read(U),ee=[],te=[];if(!X)for(const ne of Z.mappings){if(ne.lineRangeMapping.original.isEmpty||ee.push({range:ne.lineRangeMapping.original.toInclusiveRange(),options:Q?diffLineDeleteDecorationBackgroundWithIndicator:diffLineDeleteDecorationBackground}),ne.lineRangeMapping.modified.isEmpty||te.push({range:ne.lineRangeMapping.modified.toInclusiveRange(),options:Q?diffLineAddDecorationBackgroundWithIndicator:diffLineAddDecorationBackground}),ne.lineRangeMapping.modified.isEmpty||ne.lineRangeMapping.original.isEmpty)ne.lineRangeMapping.original.isEmpty||ee.push({range:ne.lineRangeMapping.original.toInclusiveRange(),options:diffWholeLineDeleteDecoration}),ne.lineRangeMapping.modified.isEmpty||te.push({range:ne.lineRangeMapping.modified.toInclusiveRange(),options:diffWholeLineAddDecoration});else for(const oe of ne.lineRangeMapping.innerChanges||[])ne.lineRangeMapping.original.contains(oe.originalRange.startLineNumber)&&ee.push({range:oe.originalRange,options:oe.originalRange.isEmpty()&&J?diffDeleteDecorationEmpty:diffDeleteDecoration}),ne.lineRangeMapping.modified.contains(oe.modifiedRange.startLineNumber)&&te.push({range:oe.modifiedRange,options:oe.modifiedRange.isEmpty()&&J?diffAddDecorationEmpty:diffAddDecoration});!ne.lineRangeMapping.modified.isEmpty&&this._options.shouldRenderRevertArrows.read(U)&&!X&&te.push({range:Range$2.fromPositions(new Position$1(ne.lineRangeMapping.modified.startLineNumber,1)),options:arrowRevertChange})}if(X)for(const ne of X.changes){const oe=ne.original.toInclusiveRange();oe&&ee.push({range:oe,options:Q?diffLineDeleteDecorationBackgroundWithIndicator:diffLineDeleteDecorationBackground});const re=ne.modified.toInclusiveRange();re&&te.push({range:re,options:Q?diffLineAddDecorationBackgroundWithIndicator:diffLineAddDecorationBackground});for(const ae of ne.innerChanges||[])ee.push({range:ae.originalRange,options:diffDeleteDecoration}),te.push({range:ae.modifiedRange,options:diffAddDecoration})}const ie=this._diffModel.read(U).activeMovedText.read(U);for(const ne of Z.movedTexts)ee.push({range:ne.lineRangeMapping.original.toInclusiveRange(),options:{description:"moved",blockClassName:"movedOriginal"+(ne===ie?" currentMove":""),blockPadding:[MovedBlocksLinesPart.movedCodeBlockPadding,0,MovedBlocksLinesPart.movedCodeBlockPadding,MovedBlocksLinesPart.movedCodeBlockPadding]}}),te.push({range:ne.lineRangeMapping.modified.toInclusiveRange(),options:{description:"moved",blockClassName:"movedModified"+(ne===ie?" currentMove":""),blockPadding:[4,0,4,4]}});return{originalDecorations:ee,modifiedDecorations:te}}),this._register(applyObservableDecorations$1(this._editors.original,this._decorations.map(U=>(U==null?void 0:U.originalDecorations)||[]))),this._register(applyObservableDecorations$1(this._editors.modified,this._decorations.map(U=>(U==null?void 0:U.modifiedDecorations)||[])))}}class DiffEditorSash extends Disposable{constructor(C,W,V){super(),this._options=C,this._domNode=W,this._dimensions=V,this._sashRatio=observableValue(this,void 0),this.sashLeft=derived(this,U=>{var G;const Z=(G=this._sashRatio.read(U))!==null&&G!==void 0?G:this._options.splitViewDefaultRatio.read(U);return this._computeSashLeft(Z,U)}),this._sash=this._register(new Sash(this._domNode,{getVerticalSashTop:U=>0,getVerticalSashLeft:U=>this.sashLeft.get(),getVerticalSashHeight:U=>this._dimensions.height.get()},{orientation:0})),this._startSashPosition=void 0,this._register(this._sash.onDidStart(()=>{this._startSashPosition=this.sashLeft.get()})),this._register(this._sash.onDidChange(U=>{const G=this._dimensions.width.get(),Z=this._computeSashLeft((this._startSashPosition+(U.currentX-U.startX))/G,void 0);this._sashRatio.set(Z/G,void 0)})),this._register(this._sash.onDidEnd(()=>this._sash.layout())),this._register(this._sash.onDidReset(()=>this._sashRatio.set(void 0,void 0))),this._register(autorun(U=>{const G=this._options.enableSplitViewResizing.read(U);this._sash.state=G?3:0,this.sashLeft.read(U),this._dimensions.height.read(U),this._sash.layout()}))}setBoundarySashes(C){this._sash.orthogonalEndSash=C.bottom}_computeSashLeft(C,W){const V=this._dimensions.width.read(W),U=Math.floor(this._options.splitViewDefaultRatio.read(W)*V),G=this._options.enableSplitViewResizing.read(W)?Math.floor(C*V):U,Z=100;return V<=Z*2?U:G<Z?Z:G>V-Z?V-Z:G}}let TreeElement$1=class{remove(){var C;(C=this.parent)===null||C===void 0||C.children.delete(this.id)}static findId(C,W){let V;typeof C=="string"?V=`${W.id}/${C}`:(V=`${W.id}/${C.name}`,W.children.get(V)!==void 0&&(V=`${W.id}/${C.name}_${C.range.startLineNumber}_${C.range.startColumn}`));let U=V;for(let G=0;W.children.get(U)!==void 0;G++)U=`${V}_${G}`;return U}static empty(C){return C.children.size===0}},OutlineElement$1=class extends TreeElement$1{constructor(C,W,V){super(),this.id=C,this.parent=W,this.symbol=V,this.children=new Map}},OutlineGroup$1=class extends TreeElement$1{constructor(C,W,V,U){super(),this.id=C,this.parent=W,this.label=V,this.order=U,this.children=new Map}},OutlineModel$1=class $t extends TreeElement$1{static create(C,W,V){const U=new CancellationTokenSource$1(V),G=new $t(W.uri),Z=C.ordered(W),X=Z.map((J,ee)=>{var te;const ie=TreeElement$1.findId(`provider_${ee}`,G),ne=new OutlineGroup$1(ie,G,(te=J.displayName)!==null&&te!==void 0?te:"Unknown Outline Provider",ee);return Promise.resolve(J.provideDocumentSymbols(W,U.token)).then(oe=>{for(const re of oe||[])$t._makeOutlineElement(re,ne);return ne},oe=>(onUnexpectedExternalError(oe),ne)).then(oe=>{TreeElement$1.empty(oe)?oe.remove():G._groups.set(ie,oe)})}),Q=C.onDidChange(()=>{const J=C.ordered(W);equals$5(J,Z)||U.cancel()});return Promise.all(X).then(()=>U.token.isCancellationRequested&&!V.isCancellationRequested?$t.create(C,W,V):G._compact()).finally(()=>{U.dispose(),Q.dispose()})}static _makeOutlineElement(C,W){const V=TreeElement$1.findId(C,W),U=new OutlineElement$1(V,W,C);if(C.children)for(const G of C.children)$t._makeOutlineElement(G,U);W.children.set(U.id,U)}constructor(C){super(),this.uri=C,this.id="root",this.parent=void 0,this._groups=new Map,this.children=new Map,this.id="root",this.parent=void 0}_compact(){let C=0;for(const[W,V]of this._groups)V.children.size===0?this._groups.delete(W):C+=1;if(C!==1)this.children=this._groups;else{const W=Iterable.first(this._groups.values());for(const[,V]of W.children)V.parent=this,this.children.set(V.id,V)}return this}getTopLevelSymbols(){const C=[];for(const W of this.children.values())W instanceof OutlineElement$1?C.push(W.symbol):C.push(...Iterable.map(W.children.values(),V=>V.symbol));return C.sort((W,V)=>Range$2.compareRangesUsingStarts(W.range,V.range))}asListOfDocumentSymbols(){const C=this.getTopLevelSymbols(),W=[];return $t._flattenDocumentSymbols(W,C,""),W.sort((V,U)=>Position$1.compare(Range$2.getStartPosition(V.range),Range$2.getStartPosition(U.range))||Position$1.compare(Range$2.getEndPosition(U.range),Range$2.getEndPosition(V.range)))}static _flattenDocumentSymbols(C,W,V){for(const U of W)C.push({kind:U.kind,tags:U.tags,name:U.name,detail:U.detail,containerName:U.containerName||V,range:U.range,selectionRange:U.selectionRange,children:void 0}),U.children&&$t._flattenDocumentSymbols(C,U.children,U.name)}};var __decorate$1y=globalThis&&globalThis.__decorate||function(K,C,W,V){var U=arguments.length,G=U<3?C:V===null?V=Object.getOwnPropertyDescriptor(C,W):V,Z;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")G=Reflect.decorate(K,C,W,V);else for(var X=K.length-1;X>=0;X--)(Z=K[X])&&(G=(U<3?Z(G):U>3?Z(C,W,G):Z(C,W))||G);return U>3&&G&&Object.defineProperty(C,W,G),G},__param$1y=globalThis&&globalThis.__param||function(K,C){return function(W,V){C(W,V,K)}},__awaiter$1d=globalThis&&globalThis.__awaiter||function(K,C,W,V){function U(G){return G instanceof W?G:new W(function(Z){Z(G)})}return new(W||(W=Promise))(function(G,Z){function X(ee){try{J(V.next(ee))}catch(te){Z(te)}}function Q(ee){try{J(V.throw(ee))}catch(te){Z(te)}}function J(ee){ee.done?G(ee.value):U(ee.value).then(X,Q)}J((V=V.apply(K,C||[])).next())})};let HideUnchangedRegionsFeature=class extends Disposable{get isUpdatingViewZones(){return this._isUpdatingViewZones}constructor(C,W,V,U){super(),this._editors=C,this._diffModel=W,this._options=V,this._languageFeaturesService=U,this._isUpdatingViewZones=!1,this._modifiedOutlineSource=derivedWithStore(this,(J,ee)=>{const te=this._editors.modifiedModel.read(J);if(te)return ee.add(new OutlineSource(this._languageFeaturesService,te))}),this._register(this._editors.original.onDidChangeCursorPosition(J=>{if(J.reason===3){const ee=this._diffModel.get();transaction(te=>{for(const ie of this._editors.original.getSelections()||[])ee==null||ee.ensureOriginalLineIsVisible(ie.getStartPosition().lineNumber,te),ee==null||ee.ensureOriginalLineIsVisible(ie.getEndPosition().lineNumber,te)})}})),this._register(this._editors.modified.onDidChangeCursorPosition(J=>{if(J.reason===3){const ee=this._diffModel.get();transaction(te=>{for(const ie of this._editors.modified.getSelections()||[])ee==null||ee.ensureModifiedLineIsVisible(ie.getStartPosition().lineNumber,te),ee==null||ee.ensureModifiedLineIsVisible(ie.getEndPosition().lineNumber,te)})}}));const G=this._diffModel.map((J,ee)=>{var te,ie;return((te=J==null?void 0:J.diff.read(ee))===null||te===void 0?void 0:te.mappings.length)===0?[]:(ie=J==null?void 0:J.unchangedRegions.read(ee))!==null&&ie!==void 0?ie:[]}),Z=derivedWithStore(this,(J,ee)=>{const te=this._modifiedOutlineSource.read(J);if(!te)return{origViewZones:[],modViewZones:[]};const ie=[],ne=[],oe=this._options.renderSideBySide.read(J),re=G.read(J);for(const ae of re)if(!ae.shouldHideControls(J)){{const se=derived(ce=>ae.getHiddenOriginalRange(ce).startLineNumber-1),le=new PlaceholderViewZone(se,24);ie.push(le),ee.add(new CollapsedCodeOverlayWidget(this._editors.original,le,ae,ae.originalUnchangedRange,!oe,te,ce=>this._diffModel.get().ensureModifiedLineIsVisible(ce,void 0),this._options))}{const se=derived(ce=>ae.getHiddenModifiedRange(ce).startLineNumber-1),le=new PlaceholderViewZone(se,24);ne.push(le),ee.add(new CollapsedCodeOverlayWidget(this._editors.modified,le,ae,ae.modifiedUnchangedRange,!1,te,ce=>this._diffModel.get().ensureModifiedLineIsVisible(ce,void 0),this._options))}}return{origViewZones:ie,modViewZones:ne}}),X={description:"unchanged lines",className:"diff-unchanged-lines",isWholeLine:!0},Q={description:"Fold Unchanged",glyphMarginHoverMessage:new MarkdownString(void 0,{isTrusted:!0,supportThemeIcons:!0}).appendMarkdown(localize("foldUnchanged","Fold Unchanged Region")),glyphMarginClassName:"fold-unchanged "+ThemeIcon.asClassName(Codicon.fold),zIndex:10001};this._register(applyObservableDecorations$1(this._editors.original,derived(J=>{const ee=G.read(J),te=ee.map(ie=>({range:ie.originalUnchangedRange.toInclusiveRange(),options:X}));for(const ie of ee)ie.shouldHideControls(J)&&te.push({range:Range$2.fromPositions(new Position$1(ie.originalLineNumber,1)),options:Q});return te}))),this._register(applyObservableDecorations$1(this._editors.modified,derived(J=>{const ee=G.read(J),te=ee.map(ie=>({range:ie.modifiedUnchangedRange.toInclusiveRange(),options:X}));for(const ie of ee)ie.shouldHideControls(J)&&te.push({range:LineRange$1.ofLength(ie.modifiedLineNumber,1).toInclusiveRange(),options:Q});return te}))),this._register(applyViewZones(this._editors.original,Z.map(J=>J.origViewZones),J=>this._isUpdatingViewZones=J)),this._register(applyViewZones(this._editors.modified,Z.map(J=>J.modViewZones),J=>this._isUpdatingViewZones=J)),this._register(autorun(J=>{const ee=G.read(J);this._editors.original.setHiddenAreas(ee.map(te=>te.getHiddenOriginalRange(J).toInclusiveRange()).filter(isDefined)),this._editors.modified.setHiddenAreas(ee.map(te=>te.getHiddenModifiedRange(J).toInclusiveRange()).filter(isDefined))})),this._register(this._editors.modified.onMouseUp(J=>{var ee;if(!J.event.rightButton&&J.target.position&&(!((ee=J.target.element)===null||ee===void 0)&&ee.className.includes("fold-unchanged"))){const te=J.target.position.lineNumber,ie=this._diffModel.get();if(!ie)return;const ne=ie.unchangedRegions.get().find(oe=>oe.modifiedUnchangedRange.includes(te));if(!ne)return;ne.collapseAll(void 0),J.event.stopPropagation(),J.event.preventDefault()}})),this._register(this._editors.original.onMouseUp(J=>{var ee;if(!J.event.rightButton&&J.target.position&&(!((ee=J.target.element)===null||ee===void 0)&&ee.className.includes("fold-unchanged"))){const te=J.target.position.lineNumber,ie=this._diffModel.get();if(!ie)return;const ne=ie.unchangedRegions.get().find(oe=>oe.originalUnchangedRange.includes(te));if(!ne)return;ne.collapseAll(void 0),J.event.stopPropagation(),J.event.preventDefault()}}))}};HideUnchangedRegionsFeature=__decorate$1y([__param$1y(3,ILanguageFeaturesService)],HideUnchangedRegionsFeature);let OutlineSource=class extends Disposable{constructor(C,W){super(),this._languageFeaturesService=C,this._textModel=W,this._currentModel=observableValue(this,void 0);const V=observableSignalFromEvent("documentSymbolProvider.onDidChange",this._languageFeaturesService.documentSymbolProvider.onDidChange),U=observableSignalFromEvent("_textModel.onDidChangeContent",Event$1.debounce(G=>this._textModel.onDidChangeContent(G),()=>{},100));this._register(autorunWithStore((G,Z)=>__awaiter$1d(this,void 0,void 0,function*(){V.read(G),U.read(G);const X=Z.add(new DisposableCancellationTokenSource),Q=yield OutlineModel$1.create(this._languageFeaturesService.documentSymbolProvider,this._textModel,X.token);Z.isDisposed||this._currentModel.set(Q,void 0)})))}getBreadcrumbItems(C,W){const V=this._currentModel.read(W);if(!V)return[];const U=V.asListOfDocumentSymbols().filter(G=>C.contains(G.range.startLineNumber)&&!C.contains(G.range.endLineNumber));return U.sort(reverseOrder(compareBy(G=>G.range.endLineNumber-G.range.startLineNumber,numberComparator))),U.map(G=>({name:G.name,kind:G.kind,startLineNumber:G.range.startLineNumber}))}};OutlineSource=__decorate$1y([__param$1y(0,ILanguageFeaturesService)],OutlineSource);class CollapsedCodeOverlayWidget extends ViewZoneOverlayWidget{constructor(C,W,V,U,G,Z,X,Q){const J=h("div.diff-hidden-lines-widget");super(C,W,J.root),this._editor=C,this._unchangedRegion=V,this._unchangedRegionRange=U,this.hide=G,this._modifiedOutlineSource=Z,this._revealModifiedHiddenLine=X,this._options=Q,this._nodes=h("div.diff-hidden-lines",[h("div.top@top",{title:localize("diff.hiddenLines.top","Click or drag to show more above")}),h("div.center@content",{style:{display:"flex"}},[h("div@first",{style:{display:"flex",justifyContent:"center",alignItems:"center",flexShrink:"0"}},[$$d("a",{title:localize("showAll","Show all"),role:"button",onclick:()=>{this._unchangedRegion.showAll(void 0)}},...renderLabelWithIcons("$(unfold)"))]),h("div@others",{style:{display:"flex",justifyContent:"center",alignItems:"center"}})]),h("div.bottom@bottom",{title:localize("diff.bottom","Click or drag to show more below"),role:"button"})]),J.root.appendChild(this._nodes.root);const ee=observableFromEvent(this._editor.onDidLayoutChange,()=>this._editor.getLayoutInfo());this.hide?reset(this._nodes.first):this._register(applyStyle(this._nodes.first,{width:ee.map(ie=>ie.contentLeft)}));const te=this._editor;this._register(addDisposableListener(this._nodes.top,"mousedown",ie=>{if(ie.button!==0)return;this._nodes.top.classList.toggle("dragging",!0),this._nodes.root.classList.toggle("dragging",!0),ie.preventDefault();const ne=ie.clientY;let oe=!1;const re=this._unchangedRegion.visibleLineCountTop.get();this._unchangedRegion.isDragged.set(!0,void 0);const ae=addDisposableListener(window,"mousemove",le=>{const de=le.clientY-ne;oe=oe||Math.abs(de)>2;const ue=Math.round(de/te.getOption(66)),ge=Math.max(0,Math.min(re+ue,this._unchangedRegion.getMaxVisibleLineCountTop()));this._unchangedRegion.visibleLineCountTop.set(ge,void 0)}),se=addDisposableListener(window,"mouseup",le=>{oe||this._unchangedRegion.showMoreAbove(this._options.hideUnchangedRegionsRevealLineCount.get(),void 0),this._nodes.top.classList.toggle("dragging",!1),this._nodes.root.classList.toggle("dragging",!1),this._unchangedRegion.isDragged.set(!1,void 0),ae.dispose(),se.dispose()})})),this._register(addDisposableListener(this._nodes.bottom,"mousedown",ie=>{if(ie.button!==0)return;this._nodes.bottom.classList.toggle("dragging",!0),this._nodes.root.classList.toggle("dragging",!0),ie.preventDefault();const ne=ie.clientY;let oe=!1;const re=this._unchangedRegion.visibleLineCountBottom.get();this._unchangedRegion.isDragged.set(!0,void 0);const ae=addDisposableListener(window,"mousemove",le=>{const de=le.clientY-ne;oe=oe||Math.abs(de)>2;const ue=Math.round(de/te.getOption(66)),ge=Math.max(0,Math.min(re-ue,this._unchangedRegion.getMaxVisibleLineCountBottom())),he=te.getTopForLineNumber(this._unchangedRegionRange.endLineNumberExclusive);this._unchangedRegion.visibleLineCountBottom.set(ge,void 0);const fe=te.getTopForLineNumber(this._unchangedRegionRange.endLineNumberExclusive);te.setScrollTop(te.getScrollTop()+(fe-he))}),se=addDisposableListener(window,"mouseup",le=>{if(this._unchangedRegion.isDragged.set(!1,void 0),!oe){const ce=te.getTopForLineNumber(this._unchangedRegionRange.endLineNumberExclusive);this._unchangedRegion.showMoreBelow(this._options.hideUnchangedRegionsRevealLineCount.get(),void 0);const de=te.getTopForLineNumber(this._unchangedRegionRange.endLineNumberExclusive);te.setScrollTop(te.getScrollTop()+(de-ce))}this._nodes.bottom.classList.toggle("dragging",!1),this._nodes.root.classList.toggle("dragging",!1),ae.dispose(),se.dispose()})})),this._register(autorun(ie=>{const ne=[];if(!this.hide){const oe=V.getHiddenModifiedRange(ie).length,re=localize("hiddenLines","{0} hidden lines",oe),ae=$$d("span",{title:localize("diff.hiddenLines.expandAll","Double click to unfold")},re);ae.addEventListener("dblclick",ce=>{ce.button===0&&(ce.preventDefault(),this._unchangedRegion.showAll(void 0))}),ne.push(ae);const se=this._unchangedRegion.getHiddenModifiedRange(ie),le=this._modifiedOutlineSource.getBreadcrumbItems(se,ie);if(le.length>0){ne.push($$d("span",void 0,"  |  "));for(let ce=0;ce<le.length;ce++){const de=le[ce],ue=SymbolKinds.toIcon(de.kind),ge=h("div.breadcrumb-item",{style:{display:"flex",alignItems:"center"}},[renderIcon(ue)," ",de.name,...ce===le.length-1?[]:[renderIcon(Codicon.chevronRight)]]).root;ne.push(ge),ge.onclick=()=>{this._revealModifiedHiddenLine(de.startLineNumber)}}}}reset(this._nodes.others,...ne)}))}}class StableEditorScrollState{static capture(C){if(C.getScrollTop()===0||C.hasPendingScrollAnimation())return new StableEditorScrollState(C.getScrollTop(),C.getContentHeight(),null,0,null);let W=null,V=0;const U=C.getVisibleRanges();if(U.length>0){W=U[0].getStartPosition();const G=C.getTopForPosition(W.lineNumber,W.column);V=C.getScrollTop()-G}return new StableEditorScrollState(C.getScrollTop(),C.getContentHeight(),W,V,C.getPosition())}constructor(C,W,V,U,G){this._initialScrollTop=C,this._initialContentHeight=W,this._visiblePosition=V,this._visiblePositionScrollDelta=U,this._cursorPosition=G}restore(C){if(!(this._initialContentHeight===C.getContentHeight()&&this._initialScrollTop===C.getScrollTop())&&this._visiblePosition){const W=C.getTopForPosition(this._visiblePosition.lineNumber,this._visiblePosition.column);C.setScrollTop(W+this._visiblePositionScrollDelta)}}restoreRelativeVerticalPositionOfCursor(C){if(this._initialContentHeight===C.getContentHeight()&&this._initialScrollTop===C.getScrollTop())return;const W=C.getPosition();if(!this._cursorPosition||!W)return;const V=C.getTopForLineNumber(W.lineNumber)-C.getTopForLineNumber(this._cursorPosition.lineNumber);C.setScrollTop(C.getScrollTop()+V)}}var __decorate$1x=globalThis&&globalThis.__decorate||function(K,C,W,V){var U=arguments.length,G=U<3?C:V===null?V=Object.getOwnPropertyDescriptor(C,W):V,Z;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")G=Reflect.decorate(K,C,W,V);else for(var X=K.length-1;X>=0;X--)(Z=K[X])&&(G=(U<3?Z(G):U>3?Z(C,W,G):Z(C,W))||G);return U>3&&G&&Object.defineProperty(C,W,G),G},__param$1x=globalThis&&globalThis.__param||function(K,C){return function(W,V){C(W,V,K)}},__awaiter$1c=globalThis&&globalThis.__awaiter||function(K,C,W,V){function U(G){return G instanceof W?G:new W(function(Z){Z(G)})}return new(W||(W=Promise))(function(G,Z){function X(ee){try{J(V.next(ee))}catch(te){Z(te)}}function Q(ee){try{J(V.throw(ee))}catch(te){Z(te)}}function J(ee){ee.done?G(ee.value):U(ee.value).then(X,Q)}J((V=V.apply(K,C||[])).next())})},WorkerBasedDocumentDiffProvider_1;let WorkerBasedDocumentDiffProvider=WorkerBasedDocumentDiffProvider_1=class{constructor(C,W,V){this.editorWorkerService=W,this.telemetryService=V,this.onDidChangeEventEmitter=new Emitter$1,this.onDidChange=this.onDidChangeEventEmitter.event,this.diffAlgorithm="advanced",this.diffAlgorithmOnDidChangeSubscription=void 0,this.setOptions(C)}dispose(){var C;(C=this.diffAlgorithmOnDidChangeSubscription)===null||C===void 0||C.dispose()}computeDiff(C,W,V,U){var G,Z;return __awaiter$1c(this,void 0,void 0,function*(){if(typeof this.diffAlgorithm!="string")return this.diffAlgorithm.computeDiff(C,W,V,U);if(C.getLineCount()===1&&C.getLineMaxColumn(1)===1)return W.getLineCount()===1&&W.getLineMaxColumn(1)===1?{changes:[],identical:!0,quitEarly:!1,moves:[]}:{changes:[new DetailedLineRangeMapping(new LineRange$1(1,2),new LineRange$1(1,W.getLineCount()+1),[new RangeMapping(C.getFullModelRange(),W.getFullModelRange())])],identical:!1,quitEarly:!1,moves:[]};const X=JSON.stringify([C.uri.toString(),W.uri.toString()]),Q=JSON.stringify([C.id,W.id,C.getAlternativeVersionId(),W.getAlternativeVersionId(),JSON.stringify(V)]),J=WorkerBasedDocumentDiffProvider_1.diffCache.get(X);if(J&&J.context===Q)return J.result;const ee=StopWatch.create(),te=yield this.editorWorkerService.computeDiff(C.uri,W.uri,V,this.diffAlgorithm),ie=ee.elapsed();if(this.telemetryService.publicLog2("diffEditor.computeDiff",{timeMs:ie,timedOut:(G=te==null?void 0:te.quitEarly)!==null&&G!==void 0?G:!0,detectedMoves:V.computeMoves?(Z=te==null?void 0:te.moves.length)!==null&&Z!==void 0?Z:0:-1}),U.isCancellationRequested)return{changes:[],identical:!1,quitEarly:!0,moves:[]};if(!te)throw new Error("no diff result available");return WorkerBasedDocumentDiffProvider_1.diffCache.size>10&&WorkerBasedDocumentDiffProvider_1.diffCache.delete(WorkerBasedDocumentDiffProvider_1.diffCache.keys().next().value),WorkerBasedDocumentDiffProvider_1.diffCache.set(X,{result:te,context:Q}),te})}setOptions(C){var W;let V=!1;C.diffAlgorithm&&this.diffAlgorithm!==C.diffAlgorithm&&((W=this.diffAlgorithmOnDidChangeSubscription)===null||W===void 0||W.dispose(),this.diffAlgorithmOnDidChangeSubscription=void 0,this.diffAlgorithm=C.diffAlgorithm,typeof C.diffAlgorithm!="string"&&(this.diffAlgorithmOnDidChangeSubscription=C.diffAlgorithm.onDidChange(()=>this.onDidChangeEventEmitter.fire())),V=!0),V&&this.onDidChangeEventEmitter.fire()}};WorkerBasedDocumentDiffProvider.diffCache=new Map;WorkerBasedDocumentDiffProvider=WorkerBasedDocumentDiffProvider_1=__decorate$1x([__param$1x(1,IEditorWorkerService),__param$1x(2,ITelemetryService)],WorkerBasedDocumentDiffProvider);var __decorate$1w=globalThis&&globalThis.__decorate||function(K,C,W,V){var U=arguments.length,G=U<3?C:V===null?V=Object.getOwnPropertyDescriptor(C,W):V,Z;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")G=Reflect.decorate(K,C,W,V);else for(var X=K.length-1;X>=0;X--)(Z=K[X])&&(G=(U<3?Z(G):U>3?Z(C,W,G):Z(C,W))||G);return U>3&&G&&Object.defineProperty(C,W,G),G},__param$1w=globalThis&&globalThis.__param||function(K,C){return function(W,V){C(W,V,K)}};const IDiffProviderFactoryService=createDecorator("diffProviderFactoryService");let DiffProviderFactoryService=class{constructor(C){this.instantiationService=C}createDiffProvider(C,W){return this.instantiationService.createInstance(WorkerBasedDocumentDiffProvider,W)}};DiffProviderFactoryService=__decorate$1w([__param$1w(0,IInstantiationService)],DiffProviderFactoryService);registerSingleton(IDiffProviderFactoryService,DiffProviderFactoryService,1);var __decorate$1v=globalThis&&globalThis.__decorate||function(K,C,W,V){var U=arguments.length,G=U<3?C:V===null?V=Object.getOwnPropertyDescriptor(C,W):V,Z;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")G=Reflect.decorate(K,C,W,V);else for(var X=K.length-1;X>=0;X--)(Z=K[X])&&(G=(U<3?Z(G):U>3?Z(C,W,G):Z(C,W))||G);return U>3&&G&&Object.defineProperty(C,W,G),G},__param$1v=globalThis&&globalThis.__param||function(K,C){return function(W,V){C(W,V,K)}},__awaiter$1b=globalThis&&globalThis.__awaiter||function(K,C,W,V){function U(G){return G instanceof W?G:new W(function(Z){Z(G)})}return new(W||(W=Promise))(function(G,Z){function X(ee){try{J(V.next(ee))}catch(te){Z(te)}}function Q(ee){try{J(V.throw(ee))}catch(te){Z(te)}}function J(ee){ee.done?G(ee.value):U(ee.value).then(X,Q)}J((V=V.apply(K,C||[])).next())})};let DiffEditorViewModel=class extends Disposable{setActiveMovedText(C){this._activeMovedText.set(C,void 0)}constructor(C,W,V,U){super(),this.model=C,this._options=W,this._editor=V,this._diffProviderFactoryService=U,this._isDiffUpToDate=observableValue(this,!1),this.isDiffUpToDate=this._isDiffUpToDate,this._diff=observableValue(this,void 0),this.diff=this._diff,this._unchangedRegions=observableValue(this,{regions:[],originalDecorationIds:[],modifiedDecorationIds:[]}),this.unchangedRegions=derived(this,Q=>this._options.hideUnchangedRegions.read(Q)?this._unchangedRegions.read(Q).regions:(transaction(J=>{for(const ee of this._unchangedRegions.get().regions)ee.collapseAll(J)}),[])),this.movedTextToCompare=observableValue(this,void 0),this._activeMovedText=observableValue(this,void 0),this._hoveredMovedText=observableValue(this,void 0),this.activeMovedText=derived(this,Q=>{var J,ee;return(ee=(J=this.movedTextToCompare.read(Q))!==null&&J!==void 0?J:this._hoveredMovedText.read(Q))!==null&&ee!==void 0?ee:this._activeMovedText.read(Q)}),this._cancellationTokenSource=new CancellationTokenSource$1,this._diffProvider=derived(this,Q=>{const J=this._diffProviderFactoryService.createDiffProvider(this._editor,{diffAlgorithm:this._options.diffAlgorithm.read(Q)}),ee=observableSignalFromEvent("onDidChange",J.onDidChange);return{diffProvider:J,onChangeSignal:ee}}),this._register(toDisposable(()=>this._cancellationTokenSource.cancel()));const G=observableSignal("contentChangedSignal"),Z=this._register(new RunOnceScheduler(()=>G.trigger(void 0),200)),X=(Q,J,ee)=>{const te=UnchangedRegion.fromDiffs(Q.changes,C.original.getLineCount(),C.modified.getLineCount(),this._options.hideUnchangedRegionsMinimumLineCount.read(ee),this._options.hideUnchangedRegionsContextLineCount.read(ee)),ie=this._unchangedRegions.get(),ne=ie.originalDecorationIds.map(se=>C.original.getDecorationRange(se)).filter(se=>!!se).map(se=>LineRange$1.fromRange(se)),oe=ie.modifiedDecorationIds.map(se=>C.modified.getDecorationRange(se)).filter(se=>!!se).map(se=>LineRange$1.fromRange(se)),re=C.original.deltaDecorations(ie.originalDecorationIds,te.map(se=>({range:se.originalUnchangedRange.toInclusiveRange(),options:{description:"unchanged"}}))),ae=C.modified.deltaDecorations(ie.modifiedDecorationIds,te.map(se=>({range:se.modifiedUnchangedRange.toInclusiveRange(),options:{description:"unchanged"}})));for(const se of te)for(let le=0;le<ie.regions.length;le++)if(se.originalUnchangedRange.intersectsStrict(ne[le])&&se.modifiedUnchangedRange.intersectsStrict(oe[le])){se.setHiddenModifiedRange(ie.regions[le].getHiddenModifiedRange(void 0),J);break}this._unchangedRegions.set({regions:te,originalDecorationIds:re,modifiedDecorationIds:ae},J)};this._register(C.modified.onDidChangeContent(Q=>{if(this._diff.get()){const ee=TextEditInfo.fromModelContentChanges(Q.changes);this._lastDiff,C.original,C.modified}Z.schedule()})),this._register(C.original.onDidChangeContent(Q=>{if(this._diff.get()){const ee=TextEditInfo.fromModelContentChanges(Q.changes);this._lastDiff,C.original,C.modified}Z.schedule()})),this._register(autorunWithStore((Q,J)=>__awaiter$1b(this,void 0,void 0,function*(){var ee,te;this._options.hideUnchangedRegionsMinimumLineCount.read(Q),this._options.hideUnchangedRegionsContextLineCount.read(Q),Z.cancel(),G.read(Q);const ie=this._diffProvider.read(Q);ie.onChangeSignal.read(Q),readHotReloadableExport(DefaultLinesDiffComputer,Q),readHotReloadableExport(optimizeSequenceDiffs,Q),this._isDiffUpToDate.set(!1,void 0);let ne=[];J.add(C.original.onDidChangeContent(ae=>{const se=TextEditInfo.fromModelContentChanges(ae.changes);ne=combineTextEditInfos(ne,se)}));let oe=[];J.add(C.modified.onDidChangeContent(ae=>{const se=TextEditInfo.fromModelContentChanges(ae.changes);oe=combineTextEditInfos(oe,se)}));let re=yield ie.diffProvider.computeDiff(C.original,C.modified,{ignoreTrimWhitespace:this._options.ignoreTrimWhitespace.read(Q),maxComputationTimeMs:this._options.maxComputationTimeMs.read(Q),computeMoves:this._options.showMoves.read(Q)},this._cancellationTokenSource.token);this._cancellationTokenSource.token.isCancellationRequested||(re=normalizeDocumentDiff(re,C.original,C.modified),re=(ee=(C.original,C.modified,void 0))!==null&&ee!==void 0?ee:re,re=(te=(C.original,C.modified,void 0))!==null&&te!==void 0?te:re,transaction(ae=>{X(re,ae),this._lastDiff=re;const se=DiffState.fromDiffResult(re);this._diff.set(se,ae),this._isDiffUpToDate.set(!0,ae);const le=this.movedTextToCompare.get();this.movedTextToCompare.set(le?this._lastDiff.moves.find(ce=>ce.lineRangeMapping.modified.intersect(le.lineRangeMapping.modified)):void 0,ae)}))})))}ensureModifiedLineIsVisible(C,W){var V;if(((V=this.diff.get())===null||V===void 0?void 0:V.mappings.length)===0)return;const U=this._unchangedRegions.get().regions;for(const G of U)if(G.getHiddenModifiedRange(void 0).contains(C)){G.showModifiedLine(C,W);return}}ensureOriginalLineIsVisible(C,W){var V;if(((V=this.diff.get())===null||V===void 0?void 0:V.mappings.length)===0)return;const U=this._unchangedRegions.get().regions;for(const G of U)if(G.getHiddenOriginalRange(void 0).contains(C)){G.showOriginalLine(C,W);return}}waitForDiff(){return __awaiter$1b(this,void 0,void 0,function*(){yield waitForState(this.isDiffUpToDate,C=>C)})}serializeState(){return{collapsedRegions:this._unchangedRegions.get().regions.map(W=>({range:W.getHiddenModifiedRange(void 0).serialize()}))}}restoreSerializedState(C){const W=C.collapsedRegions.map(U=>LineRange$1.deserialize(U.range)),V=this._unchangedRegions.get();transaction(U=>{for(const G of V.regions)for(const Z of W)if(G.modifiedUnchangedRange.intersect(Z)){G.setHiddenModifiedRange(Z,U);break}})}};DiffEditorViewModel=__decorate$1v([__param$1v(3,IDiffProviderFactoryService)],DiffEditorViewModel);function normalizeDocumentDiff(K,C,W){return{changes:K.changes.map(V=>new DetailedLineRangeMapping(V.original,V.modified,V.innerChanges?V.innerChanges.map(U=>normalizeRangeMapping(U,C,W)):void 0)),moves:K.moves,identical:K.identical,quitEarly:K.quitEarly}}function normalizeRangeMapping(K,C,W){let V=K.originalRange,U=K.modifiedRange;return(V.endColumn!==1||U.endColumn!==1)&&V.endColumn===C.getLineMaxColumn(V.endLineNumber)&&U.endColumn===W.getLineMaxColumn(U.endLineNumber)&&V.endLineNumber<C.getLineCount()&&U.endLineNumber<W.getLineCount()&&(V=V.setEndPosition(V.endLineNumber+1,1),U=U.setEndPosition(U.endLineNumber+1,1)),new RangeMapping(V,U)}class DiffState{static fromDiffResult(C){return new DiffState(C.changes.map(W=>new DiffMapping(W)),C.moves||[],C.identical,C.quitEarly)}constructor(C,W,V,U){this.mappings=C,this.movedTexts=W,this.identical=V,this.quitEarly=U}}class DiffMapping{constructor(C){this.lineRangeMapping=C}}class UnchangedRegion{static fromDiffs(C,W,V,U,G){const Z=DetailedLineRangeMapping.inverse(C,W,V),X=[];for(const Q of Z){let J=Q.original.startLineNumber,ee=Q.modified.startLineNumber,te=Q.original.length;const ie=J===1&&ee===1,ne=J+te===W+1&&ee+te===V+1;(ie||ne)&&te>=G+U?(ie&&!ne&&(te-=G),ne&&!ie&&(J+=G,ee+=G,te-=G),X.push(new UnchangedRegion(J,ee,te,0,0))):te>=G*2+U&&(J+=G,ee+=G,te-=G*2,X.push(new UnchangedRegion(J,ee,te,0,0)))}return X}get originalUnchangedRange(){return LineRange$1.ofLength(this.originalLineNumber,this.lineCount)}get modifiedUnchangedRange(){return LineRange$1.ofLength(this.modifiedLineNumber,this.lineCount)}constructor(C,W,V,U,G){this.originalLineNumber=C,this.modifiedLineNumber=W,this.lineCount=V,this._visibleLineCountTop=observableValue(this,0),this.visibleLineCountTop=this._visibleLineCountTop,this._visibleLineCountBottom=observableValue(this,0),this.visibleLineCountBottom=this._visibleLineCountBottom,this._shouldHideControls=derived(this,Z=>this.visibleLineCountTop.read(Z)+this.visibleLineCountBottom.read(Z)===this.lineCount&&!this.isDragged.read(Z)),this.isDragged=observableValue(this,!1),this._visibleLineCountTop.set(U,void 0),this._visibleLineCountBottom.set(G,void 0)}shouldHideControls(C){return this._shouldHideControls.read(C)}getHiddenOriginalRange(C){return LineRange$1.ofLength(this.originalLineNumber+this._visibleLineCountTop.read(C),this.lineCount-this._visibleLineCountTop.read(C)-this._visibleLineCountBottom.read(C))}getHiddenModifiedRange(C){return LineRange$1.ofLength(this.modifiedLineNumber+this._visibleLineCountTop.read(C),this.lineCount-this._visibleLineCountTop.read(C)-this._visibleLineCountBottom.read(C))}setHiddenModifiedRange(C,W){const V=C.startLineNumber-this.modifiedLineNumber,U=this.modifiedLineNumber+this.lineCount-C.endLineNumberExclusive;this.setState(V,U,W)}getMaxVisibleLineCountTop(){return this.lineCount-this._visibleLineCountBottom.get()}getMaxVisibleLineCountBottom(){return this.lineCount-this._visibleLineCountTop.get()}showMoreAbove(C=10,W){const V=this.getMaxVisibleLineCountTop();this._visibleLineCountTop.set(Math.min(this._visibleLineCountTop.get()+C,V),W)}showMoreBelow(C=10,W){const V=this.lineCount-this._visibleLineCountTop.get();this._visibleLineCountBottom.set(Math.min(this._visibleLineCountBottom.get()+C,V),W)}showAll(C){this._visibleLineCountBottom.set(this.lineCount-this._visibleLineCountTop.get(),C)}showModifiedLine(C,W){const V=C+1-(this.modifiedLineNumber+this._visibleLineCountTop.get()),U=this.modifiedLineNumber-this._visibleLineCountBottom.get()+this.lineCount-C;V<U?this._visibleLineCountTop.set(this._visibleLineCountTop.get()+V,W):this._visibleLineCountBottom.set(this._visibleLineCountBottom.get()+U,W)}showOriginalLine(C,W){const V=C-this.originalLineNumber,U=this.originalLineNumber+this.lineCount-C;V<U?this._visibleLineCountTop.set(Math.min(this._visibleLineCountTop.get()+U-V,this.getMaxVisibleLineCountTop()),W):this._visibleLineCountBottom.set(Math.min(this._visibleLineCountBottom.get()+V-U,this.getMaxVisibleLineCountBottom()),W)}collapseAll(C){this._visibleLineCountTop.set(0,C),this._visibleLineCountBottom.set(0,C)}setState(C,W,V){C=Math.max(Math.min(C,this.lineCount),0),W=Math.max(Math.min(W,this.lineCount-C),0),this._visibleLineCountTop.set(C,V),this._visibleLineCountBottom.set(W,V)}}function applyOriginalEdits(K,C,W,V){}function applyModifiedEdits(K,C,W,V){}var __awaiter$1a=globalThis&&globalThis.__awaiter||function(K,C,W,V){function U(G){return G instanceof W?G:new W(function(Z){Z(G)})}return new(W||(W=Promise))(function(G,Z){function X(ee){try{J(V.next(ee))}catch(te){Z(te)}}function Q(ee){try{J(V.throw(ee))}catch(te){Z(te)}}function J(ee){ee.done?G(ee.value):U(ee.value).then(X,Q)}J((V=V.apply(K,C||[])).next())})};class InlineDiffDeletedCodeMargin extends Disposable{get visibility(){return this._visibility}set visibility(C){this._visibility!==C&&(this._visibility=C,this._diffActions.style.visibility=C?"visible":"hidden")}constructor(C,W,V,U,G,Z,X,Q,J){super(),this._getViewZoneId=C,this._marginDomNode=W,this._modifiedEditor=V,this._diff=U,this._editor=G,this._viewLineCounts=Z,this._originalTextModel=X,this._contextMenuService=Q,this._clipboardService=J,this._visibility=!1,this._marginDomNode.style.zIndex="10",this._diffActions=document.createElement("div"),this._diffActions.className=ThemeIcon.asClassName(Codicon.lightBulb)+" lightbulb-glyph",this._diffActions.style.position="absolute";const ee=this._modifiedEditor.getOption(66);this._diffActions.style.right="0px",this._diffActions.style.visibility="hidden",this._diffActions.style.height=`${ee}px`,this._diffActions.style.lineHeight=`${ee}px`,this._marginDomNode.appendChild(this._diffActions);let te=0;const ie=V.getOption(126)&&!isIOS,ne=(oe,re)=>{var ae;this._contextMenuService.showContextMenu({domForShadowRoot:ie&&(ae=V.getDomNode())!==null&&ae!==void 0?ae:void 0,getAnchor:()=>({x:oe,y:re}),getActions:()=>{const se=[],le=U.modified.isEmpty;return se.push(new Action("diff.clipboard.copyDeletedContent",le?U.original.length>1?localize("diff.clipboard.copyDeletedLinesContent.label","Copy deleted lines"):localize("diff.clipboard.copyDeletedLinesContent.single.label","Copy deleted line"):U.original.length>1?localize("diff.clipboard.copyChangedLinesContent.label","Copy changed lines"):localize("diff.clipboard.copyChangedLinesContent.single.label","Copy changed line"),void 0,!0,()=>__awaiter$1a(this,void 0,void 0,function*(){const de=this._originalTextModel.getValueInRange(U.original.toExclusiveRange());yield this._clipboardService.writeText(de)}))),U.original.length>1&&se.push(new Action("diff.clipboard.copyDeletedLineContent",le?localize("diff.clipboard.copyDeletedLineContent.label","Copy deleted line ({0})",U.original.startLineNumber+te):localize("diff.clipboard.copyChangedLineContent.label","Copy changed line ({0})",U.original.startLineNumber+te),void 0,!0,()=>__awaiter$1a(this,void 0,void 0,function*(){let de=this._originalTextModel.getLineContent(U.original.startLineNumber+te);de===""&&(de=this._originalTextModel.getEndOfLineSequence()===0?`
`:`\r
`),yield this._clipboardService.writeText(de)}))),V.getOption(90)||se.push(new Action("diff.inline.revertChange",localize("diff.inline.revertChange.label","Revert this change"),void 0,!0,()=>__awaiter$1a(this,void 0,void 0,function*(){this._editor.revert(this._diff)}))),se},autoSelectFirstItem:!0})};this._register(addStandardDisposableListener(this._diffActions,"mousedown",oe=>{const{top:re,height:ae}=getDomNodePagePosition(this._diffActions),se=Math.floor(ee/3);oe.preventDefault(),ne(oe.posx,re+ae+se)})),this._register(V.onMouseMove(oe=>{(oe.target.type===8||oe.target.type===5)&&oe.target.detail.viewZoneId===this._getViewZoneId()?(te=this._updateLightBulbPosition(this._marginDomNode,oe.event.browserEvent.y,ee),this.visibility=!0):this.visibility=!1})),this._register(V.onMouseDown(oe=>{oe.event.rightButton&&(oe.target.type===8||oe.target.type===5)&&oe.target.detail.viewZoneId===this._getViewZoneId()&&(oe.event.preventDefault(),te=this._updateLightBulbPosition(this._marginDomNode,oe.event.browserEvent.y,ee),ne(oe.event.posx,oe.event.posy+ee))}))}_updateLightBulbPosition(C,W,V){const{top:U}=getDomNodePagePosition(C),G=W-U,Z=Math.floor(G/V),X=Z*V;if(this._diffActions.style.top=`${X}px`,this._viewLineCounts){let Q=0;for(let J=0;J<this._viewLineCounts.length;J++)if(Q+=this._viewLineCounts[J],Z<Q)return J}return Z}}const ttPolicy$1=createTrustedTypesPolicy("diffEditorWidget",{createHTML:K=>K});function renderLines$1(K,C,W,V){applyFontInfo(V,C.fontInfo);const U=W.length>0,G=new StringBuilder(1e4);let Z=0,X=0;const Q=[];for(let ie=0;ie<K.lineTokens.length;ie++){const ne=ie+1,oe=K.lineTokens[ie],re=K.lineBreakData[ie],ae=LineDecoration.filter(W,ne,1,Number.MAX_SAFE_INTEGER);if(re){let se=0;for(const le of re.breakOffsets){const ce=oe.sliceAndInflate(se,le,0);Z=Math.max(Z,renderOriginalLine(X,ce,LineDecoration.extractWrapped(ae,se,le),U,K.mightContainNonBasicASCII,K.mightContainRTL,C,G)),X++,se=le}Q.push(re.breakOffsets.length)}else Q.push(1),Z=Math.max(Z,renderOriginalLine(X,oe,ae,U,K.mightContainNonBasicASCII,K.mightContainRTL,C,G)),X++}Z+=C.scrollBeyondLastColumn;const J=G.build(),ee=ttPolicy$1?ttPolicy$1.createHTML(J):J;V.innerHTML=ee;const te=Z*C.typicalHalfwidthCharacterWidth;return{heightInLines:X,minWidthInPx:te,viewLineCounts:Q}}class LineSource{constructor(C,W,V,U){this.lineTokens=C,this.lineBreakData=W,this.mightContainNonBasicASCII=V,this.mightContainRTL=U}}class RenderOptions{static fromEditor(C){var W;const V=C.getOptions(),U=V.get(50),G=V.get(143);return new RenderOptions(((W=C.getModel())===null||W===void 0?void 0:W.getOptions().tabSize)||0,U,V.get(33),U.typicalHalfwidthCharacterWidth,V.get(103),V.get(66),G.decorationsWidth,V.get(116),V.get(98),V.get(93),V.get(51))}constructor(C,W,V,U,G,Z,X,Q,J,ee,te){this.tabSize=C,this.fontInfo=W,this.disableMonospaceOptimizations=V,this.typicalHalfwidthCharacterWidth=U,this.scrollBeyondLastColumn=G,this.lineHeight=Z,this.lineDecorationsWidth=X,this.stopRenderingLineAfter=Q,this.renderWhitespace=J,this.renderControlCharacters=ee,this.fontLigatures=te}}function renderOriginalLine(K,C,W,V,U,G,Z,X){X.appendString('<div class="view-line'),V||X.appendString(" char-delete"),X.appendString('" style="top:'),X.appendString(String(K*Z.lineHeight)),X.appendString('px;width:1000000px;">');const Q=C.getLineContent(),J=ViewLineRenderingData.isBasicASCII(Q,U),ee=ViewLineRenderingData.containsRTL(Q,J,G),te=renderViewLine(new RenderLineInput(Z.fontInfo.isMonospace&&!Z.disableMonospaceOptimizations,Z.fontInfo.canUseHalfwidthRightwardsArrow,Q,!1,J,ee,0,C,W,Z.tabSize,0,Z.fontInfo.spaceWidth,Z.fontInfo.middotWidth,Z.fontInfo.wsmiddotWidth,Z.stopRenderingLineAfter,Z.renderWhitespace,Z.renderControlCharacters,Z.fontLigatures!==EditorFontLigatures.OFF,null),X);return X.appendString("</div>"),te.characterMapping.getHorizontalOffset(te.characterMapping.length)}var __decorate$1u=globalThis&&globalThis.__decorate||function(K,C,W,V){var U=arguments.length,G=U<3?C:V===null?V=Object.getOwnPropertyDescriptor(C,W):V,Z;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")G=Reflect.decorate(K,C,W,V);else for(var X=K.length-1;X>=0;X--)(Z=K[X])&&(G=(U<3?Z(G):U>3?Z(C,W,G):Z(C,W))||G);return U>3&&G&&Object.defineProperty(C,W,G),G},__param$1u=globalThis&&globalThis.__param||function(K,C){return function(W,V){C(W,V,K)}};let ViewZoneManager=class extends Disposable{constructor(C,W,V,U,G,Z,X){super(),this._editors=C,this._diffModel=W,this._options=V,this._diffEditorWidget=U,this._canIgnoreViewZoneUpdateEvent=G,this._clipboardService=Z,this._contextMenuService=X,this._originalTopPadding=observableValue(this,0),this._originalScrollOffset=observableValue(this,0),this._originalScrollOffsetAnimated=animatedObservable(this._originalScrollOffset,this._store),this._modifiedTopPadding=observableValue(this,0),this._modifiedScrollOffset=observableValue(this,0),this._modifiedScrollOffsetAnimated=animatedObservable(this._modifiedScrollOffset,this._store);let Q=!1;const J=observableValue("state",0),ee=this._register(new RunOnceScheduler(()=>{J.set(J.get()+1,void 0)},0));this._register(this._editors.original.onDidChangeViewZones(de=>{!Q&&!this._canIgnoreViewZoneUpdateEvent()&&ee.schedule()})),this._register(this._editors.modified.onDidChangeViewZones(de=>{!Q&&!this._canIgnoreViewZoneUpdateEvent()&&ee.schedule()})),this._register(this._editors.original.onDidChangeConfiguration(de=>{(de.hasChanged(144)||de.hasChanged(66))&&ee.schedule()})),this._register(this._editors.modified.onDidChangeConfiguration(de=>{(de.hasChanged(144)||de.hasChanged(66))&&ee.schedule()}));const te=this._diffModel.map(de=>de?observableFromEvent(de.model.original.onDidChangeTokens,()=>de.model.original.tokenization.backgroundTokenizationState===2):void 0).map((de,ue)=>de==null?void 0:de.read(ue)),ie=new Set,ne=new Set,oe=derived(de=>{const ue=this._diffModel.read(de),ge=ue==null?void 0:ue.diff.read(de);if(!ue||!ge)return null;J.read(de);const fe=this._options.renderSideBySide.read(de);return computeRangeAlignment(this._editors.original,this._editors.modified,ge.mappings,ie,ne,fe)}),re=derived(de=>{var ue;const ge=(ue=this._diffModel.read(de))===null||ue===void 0?void 0:ue.movedTextToCompare.read(de);if(!ge)return null;J.read(de);const he=ge.changes.map(fe=>new DiffMapping(fe));return computeRangeAlignment(this._editors.original,this._editors.modified,he,ie,ne,!0)});function ae(){const de=document.createElement("div");return de.className="diagonal-fill",de}const se=this._register(new DisposableStore),le=derived(de=>{var ue,ge,he,fe,pe,Se,Le,be;se.clear();const Ce=oe.read(de)||[],De=[],ke=[],Me=this._modifiedTopPadding.read(de);Me>0&&ke.push({afterLineNumber:0,domNode:document.createElement("div"),heightInPx:Me,showInHiddenAreas:!0,suppressMouseDown:!0});const Oe=this._originalTopPadding.read(de);Oe>0&&De.push({afterLineNumber:0,domNode:document.createElement("div"),heightInPx:Oe,showInHiddenAreas:!0,suppressMouseDown:!0});const Be=this._options.renderSideBySide.read(de),Pe=Be||(ue=this._editors.modified._getViewModel())===null||ue===void 0?void 0:ue.createLineBreaksComputer();if(Pe){for(const Xe of Ce)if(Xe.diff)for(let ct=Xe.originalRange.startLineNumber;ct<Xe.originalRange.endLineNumberExclusive;ct++)Pe==null||Pe.addRequest(this._editors.original.getModel().getLineContent(ct),null,null)}const Ue=(ge=Pe==null?void 0:Pe.finalize())!==null&&ge!==void 0?ge:[];let ze=0;const Fe=this._editors.modified.getOption(66),Ae=(he=this._diffModel.read(de))===null||he===void 0?void 0:he.movedTextToCompare.read(de),ot=(pe=(fe=this._editors.original.getModel())===null||fe===void 0?void 0:fe.mightContainNonBasicASCII())!==null&&pe!==void 0?pe:!1,ft=(Le=(Se=this._editors.original.getModel())===null||Se===void 0?void 0:Se.mightContainRTL())!==null&&Le!==void 0?Le:!1,rt=RenderOptions.fromEditor(this._editors.modified);for(const Xe of Ce)if(Xe.diff&&!Be){if(!Xe.originalRange.isEmpty){te.read(de);const vt=document.createElement("div");vt.classList.add("view-lines","line-delete","monaco-mouse-cursor-text");const pt=new LineSource(Xe.originalRange.mapToLineArray(ut=>this._editors.original.getModel().tokenization.getLineTokens(ut)),Xe.originalRange.mapToLineArray(ut=>Ue[ze++]),ot,ft),je=[];for(const ut of Xe.diff.innerChanges||[])je.push(new InlineDecoration(ut.originalRange.delta(-(Xe.diff.original.startLineNumber-1)),diffDeleteDecoration.className,0));const Ct=renderLines$1(pt,rt,je,vt),wt=document.createElement("div");if(wt.className="inline-deleted-margin-view-zone",applyFontInfo(wt,rt.fontInfo),this._options.renderIndicators.read(de))for(let ut=0;ut<Ct.heightInLines;ut++){const _t=document.createElement("div");_t.className=`delete-sign ${ThemeIcon.asClassName(diffRemoveIcon)}`,_t.setAttribute("style",`position:absolute;top:${ut*Fe}px;width:${rt.lineDecorationsWidth}px;height:${Fe}px;right:0;`),wt.appendChild(_t)}let Lt;se.add(new InlineDiffDeletedCodeMargin(()=>assertIsDefined(Lt),wt,this._editors.modified,Xe.diff,this._diffEditorWidget,Ct.viewLineCounts,this._editors.original.getModel(),this._contextMenuService,this._clipboardService));for(let ut=0;ut<Ct.viewLineCounts.length;ut++){const _t=Ct.viewLineCounts[ut];_t>1&&De.push({afterLineNumber:Xe.originalRange.startLineNumber+ut,domNode:ae(),heightInPx:(_t-1)*Fe,showInHiddenAreas:!0,suppressMouseDown:!0})}ke.push({afterLineNumber:Xe.modifiedRange.startLineNumber-1,domNode:vt,heightInPx:Ct.heightInLines*Fe,minWidthInPx:Ct.minWidthInPx,marginDomNode:wt,setZoneId(ut){Lt=ut},showInHiddenAreas:!0,suppressMouseDown:!0})}const ct=document.createElement("div");ct.className="gutter-delete",De.push({afterLineNumber:Xe.originalRange.endLineNumberExclusive-1,domNode:ae(),heightInPx:Xe.modifiedHeightInPx,marginDomNode:ct,showInHiddenAreas:!0,suppressMouseDown:!0})}else{const ct=Xe.modifiedHeightInPx-Xe.originalHeightInPx;if(ct>0){if(Ae!=null&&Ae.lineRangeMapping.original.delta(-1).deltaLength(2).contains(Xe.originalRange.endLineNumberExclusive-1))continue;De.push({afterLineNumber:Xe.originalRange.endLineNumberExclusive-1,domNode:ae(),heightInPx:ct,showInHiddenAreas:!0,suppressMouseDown:!0})}else{let vt=function(){const je=document.createElement("div");return je.className="arrow-revert-change "+ThemeIcon.asClassName(Codicon.arrowRight),$$d("div",{},je)};if(Ae!=null&&Ae.lineRangeMapping.modified.delta(-1).deltaLength(2).contains(Xe.modifiedRange.endLineNumberExclusive-1))continue;let pt;Xe.diff&&Xe.diff.modified.isEmpty&&this._options.shouldRenderRevertArrows.read(de)&&(pt=vt()),ke.push({afterLineNumber:Xe.modifiedRange.endLineNumberExclusive-1,domNode:ae(),heightInPx:-ct,marginDomNode:pt,showInHiddenAreas:!0,suppressMouseDown:!0})}}for(const Xe of(be=re.read(de))!==null&&be!==void 0?be:[]){if(!(Ae!=null&&Ae.lineRangeMapping.original.intersect(Xe.originalRange))||!(Ae!=null&&Ae.lineRangeMapping.modified.intersect(Xe.modifiedRange)))continue;const ct=Xe.modifiedHeightInPx-Xe.originalHeightInPx;ct>0?De.push({afterLineNumber:Xe.originalRange.endLineNumberExclusive-1,domNode:ae(),heightInPx:ct,showInHiddenAreas:!0,suppressMouseDown:!0}):ke.push({afterLineNumber:Xe.modifiedRange.endLineNumberExclusive-1,domNode:ae(),heightInPx:-ct,showInHiddenAreas:!0,suppressMouseDown:!0})}return{orig:De,mod:ke}});this._register(autorunWithStore(de=>{const ue=StableEditorScrollState.capture(this._editors.modified),ge=le.read(de);Q=!0,this._editors.original.changeViewZones(he=>{for(const fe of ie)he.removeZone(fe);ie.clear();for(const fe of ge.orig){const pe=he.addZone(fe);fe.setZoneId&&fe.setZoneId(pe),ie.add(pe)}}),this._editors.modified.changeViewZones(he=>{for(const fe of ne)he.removeZone(fe);ne.clear();for(const fe of ge.mod){const pe=he.addZone(fe);fe.setZoneId&&fe.setZoneId(pe),ne.add(pe)}}),Q=!1,ue.restore(this._editors.modified)})),this._register(toDisposable(()=>{this._editors.original.changeViewZones(de=>{for(const ue of ie)de.removeZone(ue);ie.clear()}),this._editors.modified.changeViewZones(de=>{for(const ue of ne)de.removeZone(ue);ne.clear()})}));let ce=!1;this._register(this._editors.original.onDidScrollChange(de=>{de.scrollLeftChanged&&!ce&&(ce=!0,this._editors.modified.setScrollLeft(de.scrollLeft),ce=!1)})),this._register(this._editors.modified.onDidScrollChange(de=>{de.scrollLeftChanged&&!ce&&(ce=!0,this._editors.original.setScrollLeft(de.scrollLeft),ce=!1)})),this._originalScrollTop=observableFromEvent(this._editors.original.onDidScrollChange,()=>this._editors.original.getScrollTop()),this._modifiedScrollTop=observableFromEvent(this._editors.modified.onDidScrollChange,()=>this._editors.modified.getScrollTop()),this._register(autorun(de=>{const ue=this._originalScrollTop.read(de)-(this._originalScrollOffsetAnimated.get()-this._modifiedScrollOffsetAnimated.read(de))-(this._originalTopPadding.get()-this._modifiedTopPadding.read(de));ue!==this._editors.modified.getScrollTop()&&this._editors.modified.setScrollTop(ue,1)})),this._register(autorun(de=>{const ue=this._modifiedScrollTop.read(de)-(this._modifiedScrollOffsetAnimated.get()-this._originalScrollOffsetAnimated.read(de))-(this._modifiedTopPadding.get()-this._originalTopPadding.read(de));ue!==this._editors.original.getScrollTop()&&this._editors.original.setScrollTop(ue,1)})),this._register(autorun(de=>{var ue;const ge=(ue=this._diffModel.read(de))===null||ue===void 0?void 0:ue.movedTextToCompare.read(de);let he=0;if(ge){const fe=this._editors.original.getTopForLineNumber(ge.lineRangeMapping.original.startLineNumber,!0)-this._originalTopPadding.get();he=this._editors.modified.getTopForLineNumber(ge.lineRangeMapping.modified.startLineNumber,!0)-this._modifiedTopPadding.get()-fe}he>0?(this._modifiedTopPadding.set(0,void 0),this._originalTopPadding.set(he,void 0)):he<0?(this._modifiedTopPadding.set(-he,void 0),this._originalTopPadding.set(0,void 0)):setTimeout(()=>{this._modifiedTopPadding.set(0,void 0),this._originalTopPadding.set(0,void 0)},400),this._editors.modified.hasTextFocus()?this._originalScrollOffset.set(this._modifiedScrollOffset.get()-he,void 0,!0):this._modifiedScrollOffset.set(this._originalScrollOffset.get()+he,void 0,!0)}))}};ViewZoneManager=__decorate$1u([__param$1u(5,IClipboardService),__param$1u(6,IContextMenuService)],ViewZoneManager);function computeRangeAlignment(K,C,W,V,U,G){const Z=new ArrayQueue(getAdditionalLineHeights(K,V)),X=new ArrayQueue(getAdditionalLineHeights(C,U)),Q=K.getOption(66),J=C.getOption(66),ee=[];let te=0,ie=0;function ne(oe,re){for(;;){let ae=Z.peek(),se=X.peek();if(ae&&ae.lineNumber>=oe&&(ae=void 0),se&&se.lineNumber>=re&&(se=void 0),!ae&&!se)break;const le=ae?ae.lineNumber-te:Number.MAX_VALUE,ce=se?se.lineNumber-ie:Number.MAX_VALUE;le<ce?(Z.dequeue(),se={lineNumber:ae.lineNumber-te+ie,heightInPx:0}):le>ce?(X.dequeue(),ae={lineNumber:se.lineNumber-ie+te,heightInPx:0}):(Z.dequeue(),X.dequeue()),ee.push({originalRange:LineRange$1.ofLength(ae.lineNumber,1),modifiedRange:LineRange$1.ofLength(se.lineNumber,1),originalHeightInPx:Q+ae.heightInPx,modifiedHeightInPx:J+se.heightInPx,diff:void 0})}}for(const oe of W){let ce=function(de,ue){var ge,he,fe,pe;if(de<le||ue<se)return;if(ae)ae=!1;else if(de===le||ue===se)return;const Se=new LineRange$1(le,de),Le=new LineRange$1(se,ue);if(Se.isEmpty&&Le.isEmpty)return;const be=(he=(ge=Z.takeWhile(De=>De.lineNumber<de))===null||ge===void 0?void 0:ge.reduce((De,ke)=>De+ke.heightInPx,0))!==null&&he!==void 0?he:0,Ce=(pe=(fe=X.takeWhile(De=>De.lineNumber<ue))===null||fe===void 0?void 0:fe.reduce((De,ke)=>De+ke.heightInPx,0))!==null&&pe!==void 0?pe:0;ee.push({originalRange:Se,modifiedRange:Le,originalHeightInPx:Se.length*Q+be,modifiedHeightInPx:Le.length*J+Ce,diff:oe.lineRangeMapping}),le=de,se=ue};const re=oe.lineRangeMapping;ne(re.original.startLineNumber,re.modified.startLineNumber);let ae=!0,se=re.modified.startLineNumber,le=re.original.startLineNumber;if(G)for(const de of re.innerChanges||[])de.originalRange.startColumn>1&&de.modifiedRange.startColumn>1&&ce(de.originalRange.startLineNumber,de.modifiedRange.startLineNumber),de.originalRange.endColumn<K.getModel().getLineMaxColumn(de.originalRange.endLineNumber)&&ce(de.originalRange.endLineNumber,de.modifiedRange.endLineNumber);ce(re.original.endLineNumberExclusive,re.modified.endLineNumberExclusive),te=re.original.endLineNumberExclusive,ie=re.modified.endLineNumberExclusive}return ne(Number.MAX_VALUE,Number.MAX_VALUE),ee}function getAdditionalLineHeights(K,C){const W=[],V=[],U=K.getOption(144).wrappingColumn!==-1,G=K._getViewModel().coordinatesConverter,Z=K.getOption(66);if(U)for(let Q=1;Q<=K.getModel().getLineCount();Q++){const J=G.getModelLineViewLineCount(Q);J>1&&V.push({lineNumber:Q,heightInPx:Z*(J-1)})}for(const Q of K.getWhitespaces()){if(C.has(Q.id))continue;const J=Q.afterLineNumber===0?0:G.convertViewPositionToModelPosition(new Position$1(Q.afterLineNumber,1)).lineNumber;W.push({lineNumber:J,heightInPx:Q.height})}return joinCombine(W,V,Q=>Q.lineNumber,(Q,J)=>({lineNumber:Q.lineNumber,heightInPx:Q.heightInPx+J.heightInPx}))}var __decorate$1t=globalThis&&globalThis.__decorate||function(K,C,W,V){var U=arguments.length,G=U<3?C:V===null?V=Object.getOwnPropertyDescriptor(C,W):V,Z;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")G=Reflect.decorate(K,C,W,V);else for(var X=K.length-1;X>=0;X--)(Z=K[X])&&(G=(U<3?Z(G):U>3?Z(C,W,G):Z(C,W))||G);return U>3&&G&&Object.defineProperty(C,W,G),G},__param$1t=globalThis&&globalThis.__param||function(K,C){return function(W,V){C(W,V,K)}},OverviewRulerPart_1;let OverviewRulerPart=OverviewRulerPart_1=class extends Disposable{constructor(C,W,V,U,G,Z,X,Q){super(),this._editors=C,this._rootElement=W,this._diffModel=V,this._rootWidth=U,this._rootHeight=G,this._modifiedEditorLayoutInfo=Z,this._options=X,this._themeService=Q;const J=observableFromEvent(this._themeService.onDidColorThemeChange,()=>this._themeService.getColorTheme()),ee=derived(ne=>{const oe=J.read(ne),re=oe.getColor(diffOverviewRulerInserted)||(oe.getColor(diffInserted)||defaultInsertColor).transparent(2),ae=oe.getColor(diffOverviewRulerRemoved)||(oe.getColor(diffRemoved)||defaultRemoveColor).transparent(2);return{insertColor:re,removeColor:ae}}),te=observableFromEvent(this._editors.modified.onDidScrollChange,()=>this._editors.modified.getScrollTop()),ie=observableFromEvent(this._editors.modified.onDidScrollChange,()=>this._editors.modified.getScrollHeight());this._register(autorunWithStore((ne,oe)=>{if(!this._options.renderOverviewRuler.read(ne))return;const re=createFastDomNode(document.createElement("div"));re.setClassName("diffViewport"),re.setPosition("absolute");const ae=h("div.diffOverview",{style:{position:"absolute",top:"0px",width:OverviewRulerPart_1.ENTIRE_DIFF_OVERVIEW_WIDTH+"px"}}).root;oe.add(appendRemoveOnDispose(ae,re.domNode)),oe.add(addStandardDisposableListener(ae,EventType$1.POINTER_DOWN,se=>{this._editors.modified.delegateVerticalScrollbarPointerDown(se)})),oe.add(addDisposableListener(ae,EventType$1.MOUSE_WHEEL,se=>{this._editors.modified.delegateScrollFromMouseWheelEvent(se)},{passive:!1})),oe.add(appendRemoveOnDispose(this._rootElement,ae)),oe.add(autorunWithStore((se,le)=>{const ce=this._diffModel.read(se),de=this._editors.original.createOverviewRuler("original diffOverviewRuler");de&&(le.add(de),le.add(appendRemoveOnDispose(ae,de.getDomNode())));const ue=this._editors.modified.createOverviewRuler("modified diffOverviewRuler");if(ue&&(le.add(ue),le.add(appendRemoveOnDispose(ae,ue.getDomNode()))),!de||!ue)return;const ge=observableSignalFromEvent("viewZoneChanged",this._editors.original.onDidChangeViewZones),he=observableSignalFromEvent("viewZoneChanged",this._editors.modified.onDidChangeViewZones),fe=observableSignalFromEvent("hiddenRangesChanged",this._editors.original.onDidChangeHiddenAreas),pe=observableSignalFromEvent("hiddenRangesChanged",this._editors.modified.onDidChangeHiddenAreas);le.add(autorun(Se=>{var Le;ge.read(Se),he.read(Se),fe.read(Se),pe.read(Se);const be=ee.read(Se),Ce=(Le=ce==null?void 0:ce.diff.read(Se))===null||Le===void 0?void 0:Le.mappings;function De(Oe,Be,Pe){const Ue=Pe._getViewModel();return Ue?Oe.filter(ze=>ze.length>0).map(ze=>{const Fe=Ue.coordinatesConverter.convertModelPositionToViewPosition(new Position$1(ze.startLineNumber,1)),Ae=Ue.coordinatesConverter.convertModelPositionToViewPosition(new Position$1(ze.endLineNumberExclusive,1)),ot=Ae.lineNumber-Fe.lineNumber;return new OverviewRulerZone(Fe.lineNumber,Ae.lineNumber,ot,Be.toString())}):[]}const ke=De((Ce||[]).map(Oe=>Oe.lineRangeMapping.original),be.removeColor,this._editors.original),Me=De((Ce||[]).map(Oe=>Oe.lineRangeMapping.modified),be.insertColor,this._editors.modified);de==null||de.setZones(ke),ue==null||ue.setZones(Me)})),le.add(autorun(Se=>{const Le=this._rootHeight.read(Se),be=this._rootWidth.read(Se),Ce=this._modifiedEditorLayoutInfo.read(Se);if(Ce){const De=OverviewRulerPart_1.ENTIRE_DIFF_OVERVIEW_WIDTH-2*OverviewRulerPart_1.ONE_OVERVIEW_WIDTH;de.setLayout({top:0,height:Le,right:De+OverviewRulerPart_1.ONE_OVERVIEW_WIDTH,width:OverviewRulerPart_1.ONE_OVERVIEW_WIDTH}),ue.setLayout({top:0,height:Le,right:0,width:OverviewRulerPart_1.ONE_OVERVIEW_WIDTH});const ke=te.read(Se),Me=ie.read(Se),Oe=this._editors.modified.getOption(102),Be=new ScrollbarState(Oe.verticalHasArrows?Oe.arrowSize:0,Oe.verticalScrollbarSize,0,Ce.height,Me,ke);re.setTop(Be.getSliderPosition()),re.setHeight(Be.getSliderSize())}else re.setTop(0),re.setHeight(0);ae.style.height=Le+"px",ae.style.left=be-OverviewRulerPart_1.ENTIRE_DIFF_OVERVIEW_WIDTH+"px",re.setWidth(OverviewRulerPart_1.ENTIRE_DIFF_OVERVIEW_WIDTH)}))}))}))}};OverviewRulerPart.ONE_OVERVIEW_WIDTH=15;OverviewRulerPart.ENTIRE_DIFF_OVERVIEW_WIDTH=OverviewRulerPart_1.ONE_OVERVIEW_WIDTH*2;OverviewRulerPart=OverviewRulerPart_1=__decorate$1t([__param$1t(7,IThemeService)],OverviewRulerPart);registerColor("diffEditor.move.border",{dark:"#8b8b8b9c",light:"#8b8b8b9c",hcDark:"#8b8b8b9c",hcLight:"#8b8b8b9c"},localize("diffEditor.move.border","The border color for text that got moved in the diff editor."));registerColor("diffEditor.moveActive.border",{dark:"#FFA500",light:"#FFA500",hcDark:"#FFA500",hcLight:"#FFA500"},localize("diffEditor.moveActive.border","The active border color for text that got moved in the diff editor."));class DelegatingEditor extends Disposable{constructor(){super(...arguments),this._id=++DelegatingEditor.idCounter,this._onDidDispose=this._register(new Emitter$1),this.onDidDispose=this._onDidDispose.event}getId(){return this.getEditorType()+":v2:"+this._id}getVisibleColumnFromPosition(C){return this._targetEditor.getVisibleColumnFromPosition(C)}getPosition(){return this._targetEditor.getPosition()}setPosition(C,W="api"){this._targetEditor.setPosition(C,W)}revealLine(C,W=0){this._targetEditor.revealLine(C,W)}revealLineInCenter(C,W=0){this._targetEditor.revealLineInCenter(C,W)}revealLineInCenterIfOutsideViewport(C,W=0){this._targetEditor.revealLineInCenterIfOutsideViewport(C,W)}revealLineNearTop(C,W=0){this._targetEditor.revealLineNearTop(C,W)}revealPosition(C,W=0){this._targetEditor.revealPosition(C,W)}revealPositionInCenter(C,W=0){this._targetEditor.revealPositionInCenter(C,W)}revealPositionInCenterIfOutsideViewport(C,W=0){this._targetEditor.revealPositionInCenterIfOutsideViewport(C,W)}revealPositionNearTop(C,W=0){this._targetEditor.revealPositionNearTop(C,W)}getSelection(){return this._targetEditor.getSelection()}getSelections(){return this._targetEditor.getSelections()}setSelection(C,W="api"){this._targetEditor.setSelection(C,W)}setSelections(C,W="api"){this._targetEditor.setSelections(C,W)}revealLines(C,W,V=0){this._targetEditor.revealLines(C,W,V)}revealLinesInCenter(C,W,V=0){this._targetEditor.revealLinesInCenter(C,W,V)}revealLinesInCenterIfOutsideViewport(C,W,V=0){this._targetEditor.revealLinesInCenterIfOutsideViewport(C,W,V)}revealLinesNearTop(C,W,V=0){this._targetEditor.revealLinesNearTop(C,W,V)}revealRange(C,W=0,V=!1,U=!0){this._targetEditor.revealRange(C,W,V,U)}revealRangeInCenter(C,W=0){this._targetEditor.revealRangeInCenter(C,W)}revealRangeInCenterIfOutsideViewport(C,W=0){this._targetEditor.revealRangeInCenterIfOutsideViewport(C,W)}revealRangeNearTop(C,W=0){this._targetEditor.revealRangeNearTop(C,W)}revealRangeNearTopIfOutsideViewport(C,W=0){this._targetEditor.revealRangeNearTopIfOutsideViewport(C,W)}revealRangeAtTop(C,W=0){this._targetEditor.revealRangeAtTop(C,W)}getSupportedActions(){return this._targetEditor.getSupportedActions()}focus(){this._targetEditor.focus()}trigger(C,W,V){this._targetEditor.trigger(C,W,V)}createDecorationsCollection(C){return this._targetEditor.createDecorationsCollection(C)}changeDecorations(C){return this._targetEditor.changeDecorations(C)}}DelegatingEditor.idCounter=0;var __decorate$1s=globalThis&&globalThis.__decorate||function(K,C,W,V){var U=arguments.length,G=U<3?C:V===null?V=Object.getOwnPropertyDescriptor(C,W):V,Z;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")G=Reflect.decorate(K,C,W,V);else for(var X=K.length-1;X>=0;X--)(Z=K[X])&&(G=(U<3?Z(G):U>3?Z(C,W,G):Z(C,W))||G);return U>3&&G&&Object.defineProperty(C,W,G),G},__param$1s=globalThis&&globalThis.__param||function(K,C){return function(W,V){C(W,V,K)}};let DiffEditorEditors=class extends Disposable{constructor(C,W,V,U,G,Z,X){super(),this.originalEditorElement=C,this.modifiedEditorElement=W,this._options=V,this._createInnerEditor=G,this._instantiationService=Z,this._keybindingService=X,this._onDidContentSizeChange=this._register(new Emitter$1),this.original=this._register(this._createLeftHandSideEditor(V.editorOptions.get(),U.originalEditor||{})),this.modified=this._register(this._createRightHandSideEditor(V.editorOptions.get(),U.modifiedEditor||{})),this.modifiedModel=observableFromEvent(this.modified.onDidChangeModel,()=>this.modified.getModel()),this._register(autorunHandleChanges({createEmptyChangeSummary:()=>({}),handleChange:(Q,J)=>(Q.didChange(V.editorOptions)&&Object.assign(J,Q.change.changedOptions),!0)},(Q,J)=>{V.editorOptions.read(Q),this._options.renderSideBySide.read(Q),this.modified.updateOptions(this._adjustOptionsForRightHandSide(Q,J)),this.original.updateOptions(this._adjustOptionsForLeftHandSide(Q,J))}))}_createLeftHandSideEditor(C,W){const V=this._adjustOptionsForLeftHandSide(void 0,C),U=this._constructInnerEditor(this._instantiationService,this.originalEditorElement,V,W);return U.setContextValue("isInDiffLeftEditor",!0),U}_createRightHandSideEditor(C,W){const V=this._adjustOptionsForRightHandSide(void 0,C),U=this._constructInnerEditor(this._instantiationService,this.modifiedEditorElement,V,W);return U.setContextValue("isInDiffRightEditor",!0),U}_constructInnerEditor(C,W,V,U){const G=this._createInnerEditor(C,W,V,U);return this._register(G.onDidContentSizeChange(Z=>{const X=this.original.getContentWidth()+this.modified.getContentWidth()+OverviewRulerPart.ENTIRE_DIFF_OVERVIEW_WIDTH,Q=Math.max(this.modified.getContentHeight(),this.original.getContentHeight());this._onDidContentSizeChange.fire({contentHeight:Q,contentWidth:X,contentHeightChanged:Z.contentHeightChanged,contentWidthChanged:Z.contentWidthChanged})})),G}_adjustOptionsForLeftHandSide(C,W){const V=this._adjustOptionsForSubEditor(W);return this._options.renderSideBySide.get()?(V.unicodeHighlight=this._options.editorOptions.get().unicodeHighlight||{},V.wordWrapOverride1=this._options.diffWordWrap.get()):(V.wordWrapOverride1="off",V.wordWrapOverride2="off",V.stickyScroll={enabled:!1},V.unicodeHighlight={nonBasicASCII:!1,ambiguousCharacters:!1,invisibleCharacters:!1}),W.originalAriaLabel&&(V.ariaLabel=W.originalAriaLabel),V.ariaLabel=this._updateAriaLabel(V.ariaLabel),V.readOnly=!this._options.originalEditable.get(),V.dropIntoEditor={enabled:!V.readOnly},V.extraEditorClassName="original-in-monaco-diff-editor",V}_adjustOptionsForRightHandSide(C,W){const V=this._adjustOptionsForSubEditor(W);return W.modifiedAriaLabel&&(V.ariaLabel=W.modifiedAriaLabel),V.ariaLabel=this._updateAriaLabel(V.ariaLabel),V.wordWrapOverride1=this._options.diffWordWrap.get(),V.revealHorizontalRightPadding=EditorOptions.revealHorizontalRightPadding.defaultValue+OverviewRulerPart.ENTIRE_DIFF_OVERVIEW_WIDTH,V.scrollbar.verticalHasArrows=!1,V.extraEditorClassName="modified-in-monaco-diff-editor",V}_adjustOptionsForSubEditor(C){const W=Object.assign(Object.assign({},C),{dimension:{height:0,width:0}});return W.inDiffEditor=!0,W.automaticLayout=!1,W.scrollbar=Object.assign({},W.scrollbar||{}),W.scrollbar.vertical="visible",W.folding=!1,W.codeLens=this._options.diffCodeLens.get(),W.fixedOverflowWidgets=!0,W.minimap=Object.assign({},W.minimap||{}),W.minimap.enabled=!1,this._options.hideUnchangedRegions.get()?W.stickyScroll={enabled:!1}:W.stickyScroll=this._options.editorOptions.get().stickyScroll,W}_updateAriaLabel(C){var W;C||(C="");const V=localize("diff-aria-navigation-tip"," use {0} to open the accessibility help.",(W=this._keybindingService.lookupKeybinding("editor.action.accessibilityHelp"))===null||W===void 0?void 0:W.getAriaLabel());return this._options.accessibilityVerbose.get()?C+V:C?C.replaceAll(V,""):""}};DiffEditorEditors=__decorate$1s([__param$1s(5,IInstantiationService),__param$1s(6,IKeybindingService)],DiffEditorEditors);class DiffEditorOptions{get editorOptions(){return this._options}constructor(C,W){this.diffEditorWidth=W,this.couldShowInlineViewBecauseOfSize=derived(this,U=>this._options.read(U).renderSideBySide&&this.diffEditorWidth.read(U)<=this._options.read(U).renderSideBySideInlineBreakpoint),this.renderOverviewRuler=derived(this,U=>this._options.read(U).renderOverviewRuler),this.renderSideBySide=derived(this,U=>this._options.read(U).renderSideBySide&&!(this._options.read(U).useInlineViewWhenSpaceIsLimited&&this.couldShowInlineViewBecauseOfSize.read(U))),this.readOnly=derived(this,U=>this._options.read(U).readOnly),this.shouldRenderRevertArrows=derived(this,U=>!(!this._options.read(U).renderMarginRevertIcon||!this.renderSideBySide.read(U)||this.readOnly.read(U))),this.renderIndicators=derived(this,U=>this._options.read(U).renderIndicators),this.enableSplitViewResizing=derived(this,U=>this._options.read(U).enableSplitViewResizing),this.splitViewDefaultRatio=derived(this,U=>this._options.read(U).splitViewDefaultRatio),this.ignoreTrimWhitespace=derived(this,U=>this._options.read(U).ignoreTrimWhitespace),this.maxComputationTimeMs=derived(this,U=>this._options.read(U).maxComputationTime),this.showMoves=derived(this,U=>this._options.read(U).experimental.showMoves&&this.renderSideBySide.read(U)),this.isInEmbeddedEditor=derived(this,U=>this._options.read(U).isInEmbeddedEditor),this.diffWordWrap=derived(this,U=>this._options.read(U).diffWordWrap),this.originalEditable=derived(this,U=>this._options.read(U).originalEditable),this.diffCodeLens=derived(this,U=>this._options.read(U).diffCodeLens),this.accessibilityVerbose=derived(this,U=>this._options.read(U).accessibilityVerbose),this.diffAlgorithm=derived(this,U=>this._options.read(U).diffAlgorithm),this.showEmptyDecorations=derived(this,U=>this._options.read(U).experimental.showEmptyDecorations),this.onlyShowAccessibleDiffViewer=derived(this,U=>this._options.read(U).onlyShowAccessibleDiffViewer),this.hideUnchangedRegions=derived(this,U=>this._options.read(U).hideUnchangedRegions.enabled),this.hideUnchangedRegionsRevealLineCount=derived(this,U=>this._options.read(U).hideUnchangedRegions.revealLineCount),this.hideUnchangedRegionsContextLineCount=derived(this,U=>this._options.read(U).hideUnchangedRegions.contextLineCount),this.hideUnchangedRegionsMinimumLineCount=derived(this,U=>this._options.read(U).hideUnchangedRegions.minimumLineCount);const V=Object.assign(Object.assign({},C),validateDiffEditorOptions(C,diffEditorDefaultOptions));this._options=observableValue(this,V)}updateOptions(C){const W=validateDiffEditorOptions(C,this._options.get()),V=Object.assign(Object.assign(Object.assign({},this._options.get()),C),W);this._options.set(V,void 0,{changedOptions:C})}}function validateDiffEditorOptions(K,C){var W,V,U,G,Z,X,Q,J;return{enableSplitViewResizing:boolean$1(K.enableSplitViewResizing,C.enableSplitViewResizing),splitViewDefaultRatio:clampedFloat(K.splitViewDefaultRatio,.5,.1,.9),renderSideBySide:boolean$1(K.renderSideBySide,C.renderSideBySide),renderMarginRevertIcon:boolean$1(K.renderMarginRevertIcon,C.renderMarginRevertIcon),maxComputationTime:clampedInt(K.maxComputationTime,C.maxComputationTime,0,1073741824),maxFileSize:clampedInt(K.maxFileSize,C.maxFileSize,0,1073741824),ignoreTrimWhitespace:boolean$1(K.ignoreTrimWhitespace,C.ignoreTrimWhitespace),renderIndicators:boolean$1(K.renderIndicators,C.renderIndicators),originalEditable:boolean$1(K.originalEditable,C.originalEditable),diffCodeLens:boolean$1(K.diffCodeLens,C.diffCodeLens),renderOverviewRuler:boolean$1(K.renderOverviewRuler,C.renderOverviewRuler),diffWordWrap:stringSet(K.diffWordWrap,C.diffWordWrap,["off","on","inherit"]),diffAlgorithm:stringSet(K.diffAlgorithm,C.diffAlgorithm,["legacy","advanced"],{smart:"legacy",experimental:"advanced"}),accessibilityVerbose:boolean$1(K.accessibilityVerbose,C.accessibilityVerbose),experimental:{showMoves:boolean$1((W=K.experimental)===null||W===void 0?void 0:W.showMoves,C.experimental.showMoves),showEmptyDecorations:boolean$1((V=K.experimental)===null||V===void 0?void 0:V.showEmptyDecorations,C.experimental.showEmptyDecorations)},hideUnchangedRegions:{enabled:boolean$1((G=(U=K.hideUnchangedRegions)===null||U===void 0?void 0:U.enabled)!==null&&G!==void 0?G:(Z=K.experimental)===null||Z===void 0?void 0:Z.collapseUnchangedRegions,C.hideUnchangedRegions.enabled),contextLineCount:clampedInt((X=K.hideUnchangedRegions)===null||X===void 0?void 0:X.contextLineCount,C.hideUnchangedRegions.contextLineCount,0,1073741824),minimumLineCount:clampedInt((Q=K.hideUnchangedRegions)===null||Q===void 0?void 0:Q.minimumLineCount,C.hideUnchangedRegions.minimumLineCount,0,1073741824),revealLineCount:clampedInt((J=K.hideUnchangedRegions)===null||J===void 0?void 0:J.revealLineCount,C.hideUnchangedRegions.revealLineCount,0,1073741824)},isInEmbeddedEditor:boolean$1(K.isInEmbeddedEditor,C.isInEmbeddedEditor),onlyShowAccessibleDiffViewer:boolean$1(K.onlyShowAccessibleDiffViewer,C.onlyShowAccessibleDiffViewer),renderSideBySideInlineBreakpoint:clampedInt(K.renderSideBySideInlineBreakpoint,C.renderSideBySideInlineBreakpoint,0,1073741824),useInlineViewWhenSpaceIsLimited:boolean$1(K.useInlineViewWhenSpaceIsLimited,C.useInlineViewWhenSpaceIsLimited)}}var __decorate$1r=globalThis&&globalThis.__decorate||function(K,C,W,V){var U=arguments.length,G=U<3?C:V===null?V=Object.getOwnPropertyDescriptor(C,W):V,Z;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")G=Reflect.decorate(K,C,W,V);else for(var X=K.length-1;X>=0;X--)(Z=K[X])&&(G=(U<3?Z(G):U>3?Z(C,W,G):Z(C,W))||G);return U>3&&G&&Object.defineProperty(C,W,G),G},__param$1r=globalThis&&globalThis.__param||function(K,C){return function(W,V){C(W,V,K)}};let DiffEditorWidget=class extends DelegatingEditor{constructor(C,W,V,U,G,Z,X,Q){var J;super(),this._domElement=C,this._parentContextKeyService=U,this._parentInstantiationService=G,this._audioCueService=X,this._editorProgressService=Q,this.elements=h("div.monaco-diff-editor.side-by-side",{style:{position:"relative",height:"100%"}},[h("div.noModificationsOverlay@overlay",{style:{position:"absolute",height:"100%",visibility:"hidden"}},[$$d("span",{},"No Changes")]),h("div.editor.original@original",{style:{position:"absolute",height:"100%"}}),h("div.editor.modified@modified",{style:{position:"absolute",height:"100%"}}),h("div.accessibleDiffViewer@accessibleDiffViewer",{style:{position:"absolute",height:"100%"}})]),this._diffModel=this._register(disposableObservableValue("diffModel",void 0)),this.onDidChangeModel=Event$1.fromObservableLight(this._diffModel),this._contextKeyService=this._register(this._parentContextKeyService.createScoped(this._domElement)),this._instantiationService=this._parentInstantiationService.createChild(new ServiceCollection([IContextKeyService,this._contextKeyService])),this._boundarySashes=observableValue(this,void 0),this._accessibleDiffViewerShouldBeVisible=observableValue(this,!1),this._accessibleDiffViewerVisible=derived(this,re=>this._options.onlyShowAccessibleDiffViewer.read(re)?!0:this._accessibleDiffViewerShouldBeVisible.read(re)),this.movedBlocksLinesPart=observableValue(this,void 0),this._layoutInfo=derived(this,re=>{var ae,se,le;const ce=this._rootSizeObserver.width.read(re),de=this._rootSizeObserver.height.read(re),ue=(ae=this._sash.read(re))===null||ae===void 0?void 0:ae.sashLeft.read(re),ge=ue??Math.max(5,this._editors.original.getLayoutInfo().decorationsLeft),he=ce-ge-(this._options.renderOverviewRuler.read(re)?OverviewRulerPart.ENTIRE_DIFF_OVERVIEW_WIDTH:0),fe=(le=(se=this.movedBlocksLinesPart.read(re))===null||se===void 0?void 0:se.width.read(re))!==null&&le!==void 0?le:0,pe=ge-fe;return this.elements.original.style.width=pe+"px",this.elements.original.style.left="0px",this.elements.modified.style.width=he+"px",this.elements.modified.style.left=ge+"px",this._editors.original.layout({width:pe,height:de}),this._editors.modified.layout({width:he,height:de}),{modifiedEditor:this._editors.modified.getLayoutInfo(),originalEditor:this._editors.original.getLayoutInfo()}}),this._diffValue=this._diffModel.map((re,ae)=>re==null?void 0:re.diff.read(ae)),this.onDidUpdateDiff=Event$1.fromObservableLight(this._diffValue),Z.willCreateDiffEditor(),this._contextKeyService.createKey("isInDiffEditor",!0),this._domElement.appendChild(this.elements.root),this._register(toDisposable(()=>this._domElement.removeChild(this.elements.root))),this._rootSizeObserver=this._register(new ObservableElementSizeObserver(this.elements.root,W.dimension)),this._rootSizeObserver.setAutomaticLayout((J=W.automaticLayout)!==null&&J!==void 0?J:!1),this._options=new DiffEditorOptions(W,this._rootSizeObserver.width),this._contextKeyService.createKey(EditorContextKeys.isEmbeddedDiffEditor.key,!1);const ee=EditorContextKeys.isEmbeddedDiffEditor.bindTo(this._contextKeyService);this._register(autorun(re=>{ee.set(this._options.isInEmbeddedEditor.read(re))}));const te=EditorContextKeys.comparingMovedCode.bindTo(this._contextKeyService);this._register(autorun(re=>{var ae;te.set(!!(!((ae=this._diffModel.read(re))===null||ae===void 0)&&ae.movedTextToCompare.read(re)))}));const ie=EditorContextKeys.diffEditorRenderSideBySideInlineBreakpointReached.bindTo(this._contextKeyService);this._register(autorun(re=>{ie.set(this._options.couldShowInlineViewBecauseOfSize.read(re))})),this._editors=this._register(this._instantiationService.createInstance(DiffEditorEditors,this.elements.original,this.elements.modified,this._options,V,(re,ae,se,le)=>this._createInnerEditor(re,ae,se,le))),this._sash=derivedWithStore(this,(re,ae)=>{const se=this._options.renderSideBySide.read(re);if(this.elements.root.classList.toggle("side-by-side",se),!se)return;const le=ae.add(new DiffEditorSash(this._options,this.elements.root,{height:this._rootSizeObserver.height,width:this._rootSizeObserver.width.map((ce,de)=>ce-(this._options.renderOverviewRuler.read(de)?OverviewRulerPart.ENTIRE_DIFF_OVERVIEW_WIDTH:0))}));return ae.add(autorun(ce=>{const de=this._boundarySashes.read(ce);de&&le.setBoundarySashes(de)})),le}),this._register(recomputeInitiallyAndOnChange(this._sash)),this._register(autorunWithStore((re,ae)=>{this.unchangedRangesFeature=ae.add(this._instantiationService.createInstance(readHotReloadableExport(HideUnchangedRegionsFeature,re),this._editors,this._diffModel,this._options))})),this._register(autorunWithStore((re,ae)=>{ae.add(new(readHotReloadableExport(DiffEditorDecorations,re))(this._editors,this._diffModel,this._options))})),this._register(autorunWithStore((re,ae)=>{ae.add(this._instantiationService.createInstance(readHotReloadableExport(ViewZoneManager,re),this._editors,this._diffModel,this._options,this,()=>this.unchangedRangesFeature.isUpdatingViewZones))})),this._register(autorunWithStore((re,ae)=>{ae.add(this._instantiationService.createInstance(readHotReloadableExport(OverviewRulerPart,re),this._editors,this.elements.root,this._diffModel,this._rootSizeObserver.width,this._rootSizeObserver.height,this._layoutInfo.map(se=>se.modifiedEditor),this._options))})),this._register(autorunWithStore((re,ae)=>{this._accessibleDiffViewer=ae.add(this._register(this._instantiationService.createInstance(readHotReloadableExport(AccessibleDiffViewer,re),this.elements.accessibleDiffViewer,this._accessibleDiffViewerVisible,(se,le)=>this._accessibleDiffViewerShouldBeVisible.set(se,le),this._options.onlyShowAccessibleDiffViewer.map(se=>!se),this._rootSizeObserver.width,this._rootSizeObserver.height,this._diffModel.map((se,le)=>{var ce;return(ce=se==null?void 0:se.diff.read(le))===null||ce===void 0?void 0:ce.mappings.map(de=>de.lineRangeMapping)}),this._editors)))}));const ne=this._accessibleDiffViewerVisible.map(re=>re?"hidden":"visible");this._register(applyStyle(this.elements.modified,{visibility:ne})),this._register(applyStyle(this.elements.original,{visibility:ne})),this._createDiffEditorContributions(),Z.addDiffEditor(this),this._register(recomputeInitiallyAndOnChange(this._layoutInfo)),this._register(autorunWithStore((re,ae)=>{this.movedBlocksLinesPart.set(ae.add(new(readHotReloadableExport(MovedBlocksLinesPart,re))(this.elements.root,this._diffModel,this._layoutInfo.map(se=>se.originalEditor),this._layoutInfo.map(se=>se.modifiedEditor),this._editors)),void 0)})),this._register(applyStyle(this.elements.overlay,{width:this._layoutInfo.map((re,ae)=>re.originalEditor.width+(this._options.renderSideBySide.read(ae)?0:re.modifiedEditor.width)),visibility:derived(re=>{var ae,se;return this._options.hideUnchangedRegions.read(re)&&((se=(ae=this._diffModel.read(re))===null||ae===void 0?void 0:ae.diff.read(re))===null||se===void 0?void 0:se.mappings.length)===0?"visible":"hidden"})})),this._register(this._editors.modified.onMouseDown(re=>{var ae,se;if(!re.event.rightButton&&re.target.position&&(!((ae=re.target.element)===null||ae===void 0)&&ae.className.includes("arrow-revert-change"))){const le=re.target.position.lineNumber,ce=re.target,de=this._diffModel.get();if(!de)return;const ue=(se=de.diff.get())===null||se===void 0?void 0:se.mappings;if(!ue)return;const ge=ue.find(he=>(ce==null?void 0:ce.detail.afterLineNumber)===he.lineRangeMapping.modified.startLineNumber-1||he.lineRangeMapping.modified.startLineNumber===le);if(!ge)return;this.revert(ge.lineRangeMapping),re.event.stopPropagation()}})),this._register(Event$1.runAndSubscribe(this._editors.modified.onDidChangeCursorPosition,re=>{var ae,se;if((re==null?void 0:re.reason)===3){const le=(se=(ae=this._diffModel.get())===null||ae===void 0?void 0:ae.diff.get())===null||se===void 0?void 0:se.mappings.find(ce=>ce.lineRangeMapping.modified.contains(re.position.lineNumber));le!=null&&le.lineRangeMapping.modified.isEmpty?this._audioCueService.playAudioCue(AudioCue.diffLineDeleted,{source:"diffEditor.cursorPositionChanged"}):le!=null&&le.lineRangeMapping.original.isEmpty?this._audioCueService.playAudioCue(AudioCue.diffLineInserted,{source:"diffEditor.cursorPositionChanged"}):le&&this._audioCueService.playAudioCue(AudioCue.diffLineModified,{source:"diffEditor.cursorPositionChanged"})}}));const oe=this._diffModel.map((re,ae)=>re==null?void 0:re.isDiffUpToDate.read(ae));this._register(autorunWithStore((re,ae)=>{if(oe.read(re)===!1){const se=this._editorProgressService.show(!0,1e3);ae.add(toDisposable(()=>se.done()))}}))}_createInnerEditor(C,W,V,U){return C.createInstance(CodeEditorWidget,W,V,U)}_createDiffEditorContributions(){const C=EditorExtensionsRegistry.getDiffEditorContributions();for(const W of C)try{this._register(this._instantiationService.createInstance(W.ctor,this))}catch(V){onUnexpectedError(V)}}get _targetEditor(){return this._editors.modified}getEditorType(){return EditorType.IDiffEditor}layout(C){this._rootSizeObserver.observe(C)}hasTextFocus(){return this._editors.original.hasTextFocus()||this._editors.modified.hasTextFocus()}saveViewState(){var C;const W=this._editors.original.saveViewState(),V=this._editors.modified.saveViewState();return{original:W,modified:V,modelState:(C=this._diffModel.get())===null||C===void 0?void 0:C.serializeState()}}restoreViewState(C){var W;if(C&&C.original&&C.modified){const V=C;this._editors.original.restoreViewState(V.original),this._editors.modified.restoreViewState(V.modified),V.modelState&&((W=this._diffModel.get())===null||W===void 0||W.restoreSerializedState(V.modelState))}}createViewModel(C){return this._instantiationService.createInstance(DiffEditorViewModel,C,this._options,this)}getModel(){var C,W;return(W=(C=this._diffModel.get())===null||C===void 0?void 0:C.model)!==null&&W!==void 0?W:null}setModel(C){!C&&this._diffModel.get()&&this._accessibleDiffViewer.close();const W=C?"model"in C?C:this.createViewModel(C):void 0;this._editors.original.setModel(W?W.model.original:null),this._editors.modified.setModel(W?W.model.modified:null),transaction(V=>{this._diffModel.set(W,V)})}updateOptions(C){this._options.updateOptions(C)}getContainerDomNode(){return this._domElement}getOriginalEditor(){return this._editors.original}getModifiedEditor(){return this._editors.modified}getLineChanges(){var C;const W=(C=this._diffModel.get())===null||C===void 0?void 0:C.diff.get();return W?toLineChanges(W):null}revert(C){var W;const V=(W=this._diffModel.get())===null||W===void 0?void 0:W.model;if(!V)return;const U=C.innerChanges?C.innerChanges.map(G=>({range:G.modifiedRange,text:V.original.getValueInRange(G.originalRange)})):[{range:C.modified.toExclusiveRange(),text:V.original.getValueInRange(C.original.toExclusiveRange())}];this._editors.modified.executeEdits("diffEditor",U)}accessibleDiffViewerNext(){this._accessibleDiffViewer.next()}accessibleDiffViewerPrev(){this._accessibleDiffViewer.prev()}mapToOtherSide(){var C,W;const V=this._editors.modified.hasWidgetFocus(),U=V?this._editors.modified:this._editors.original,G=V?this._editors.original:this._editors.modified;let Z;const X=U.getSelection();if(X){const Q=(W=(C=this._diffModel.get())===null||C===void 0?void 0:C.diff.get())===null||W===void 0?void 0:W.mappings.map(J=>V?J.lineRangeMapping.flip():J.lineRangeMapping);if(Q){const J=translatePosition(X.getStartPosition(),Q),ee=translatePosition(X.getEndPosition(),Q);Z=Range$2.plusRange(J,ee)}}return{destination:G,destinationSelection:Z}}switchSide(){const{destination:C,destinationSelection:W}=this.mapToOtherSide();C.focus(),W&&C.setSelection(W)}exitCompareMove(){const C=this._diffModel.get();C&&C.movedTextToCompare.set(void 0,void 0)}collapseAllUnchangedRegions(){var C;const W=(C=this._diffModel.get())===null||C===void 0?void 0:C.unchangedRegions.get();W&&transaction(V=>{for(const U of W)U.collapseAll(V)})}showAllUnchangedRegions(){var C;const W=(C=this._diffModel.get())===null||C===void 0?void 0:C.unchangedRegions.get();W&&transaction(V=>{for(const U of W)U.showAll(V)})}};DiffEditorWidget=__decorate$1r([__param$1r(3,IContextKeyService),__param$1r(4,IInstantiationService),__param$1r(5,ICodeEditorService),__param$1r(6,IAudioCueService),__param$1r(7,IEditorProgressService)],DiffEditorWidget);function translatePosition(K,C){const W=findLast$2(C,U=>U.original.startLineNumber<=K.lineNumber);if(!W)return Range$2.fromPositions(K);if(W.original.endLineNumberExclusive<=K.lineNumber){const U=K.lineNumber-W.original.endLineNumberExclusive+W.modified.endLineNumberExclusive;return Range$2.fromPositions(new Position$1(U,K.column))}if(!W.innerChanges)return Range$2.fromPositions(new Position$1(W.modified.startLineNumber,1));const V=findLast$2(W.innerChanges,U=>U.originalRange.getStartPosition().isBeforeOrEqual(K));if(!V){const U=K.lineNumber-W.original.startLineNumber+W.modified.startLineNumber;return Range$2.fromPositions(new Position$1(U,K.column))}if(V.originalRange.containsPosition(K))return V.modifiedRange;{const U=lengthBetweenPositions(V.originalRange.getEndPosition(),K);return Range$2.fromPositions(addLength(V.modifiedRange.getEndPosition(),U))}}function lengthBetweenPositions(K,C){return K.lineNumber===C.lineNumber?new LengthObj(0,C.column-K.column):new LengthObj(C.lineNumber-K.lineNumber,C.column-1)}function addLength(K,C){return C.lineCount===0?new Position$1(K.lineNumber,K.column+C.columnCount):new Position$1(K.lineNumber+C.lineCount,C.columnCount+1)}function toLineChanges(K){return K.mappings.map(C=>{const W=C.lineRangeMapping;let V,U,G,Z,X=W.innerChanges;return W.original.isEmpty?(V=W.original.startLineNumber-1,U=0,X=void 0):(V=W.original.startLineNumber,U=W.original.endLineNumberExclusive-1),W.modified.isEmpty?(G=W.modified.startLineNumber-1,Z=0,X=void 0):(G=W.modified.startLineNumber,Z=W.modified.endLineNumberExclusive-1),{originalStartLineNumber:V,originalEndLineNumber:U,modifiedStartLineNumber:G,modifiedEndLineNumber:Z,charChanges:X==null?void 0:X.map(Q=>({originalStartLineNumber:Q.originalRange.startLineNumber,originalStartColumn:Q.originalRange.startColumn,originalEndLineNumber:Q.originalRange.endLineNumber,originalEndColumn:Q.originalRange.endColumn,modifiedStartLineNumber:Q.modifiedRange.startLineNumber,modifiedStartColumn:Q.modifiedRange.startColumn,modifiedEndLineNumber:Q.modifiedRange.endLineNumber,modifiedEndColumn:Q.modifiedRange.endColumn}))}})}var __decorate$1q=globalThis&&globalThis.__decorate||function(K,C,W,V){var U=arguments.length,G=U<3?C:V===null?V=Object.getOwnPropertyDescriptor(C,W):V,Z;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")G=Reflect.decorate(K,C,W,V);else for(var X=K.length-1;X>=0;X--)(Z=K[X])&&(G=(U<3?Z(G):U>3?Z(C,W,G):Z(C,W))||G);return U>3&&G&&Object.defineProperty(C,W,G),G},__param$1q=globalThis&&globalThis.__param||function(K,C){return function(W,V){C(W,V,K)}};let LAST_GENERATED_COMMAND_ID=0,ariaDomNodeCreated=!1;function createAriaDomNode(K){if(!K){if(ariaDomNodeCreated)return;ariaDomNodeCreated=!0}setARIAContainer(K||document.body)}let StandaloneCodeEditor=class extends CodeEditorWidget{constructor(C,W,V,U,G,Z,X,Q,J,ee,te,ie){const ne=Object.assign({},W);ne.ariaLabel=ne.ariaLabel||StandaloneCodeEditorNLS.editorViewAccessibleLabel,ne.ariaLabel=ne.ariaLabel+";"+StandaloneCodeEditorNLS.accessibilityHelpMessage,super(C,ne,{},V,U,G,Z,Q,J,ee,te,ie),X instanceof StandaloneKeybindingService?this._standaloneKeybindingService=X:this._standaloneKeybindingService=null,createAriaDomNode(ne.ariaContainerElement)}addCommand(C,W,V){if(!this._standaloneKeybindingService)return console.warn("Cannot add command because the editor is configured with an unrecognized KeybindingService"),null;const U="DYNAMIC_"+ ++LAST_GENERATED_COMMAND_ID,G=ContextKeyExpr.deserialize(V);return this._standaloneKeybindingService.addDynamicKeybinding(U,C,W,G),U}createContextKey(C,W){return this._contextKeyService.createKey(C,W)}addAction(C){if(typeof C.id!="string"||typeof C.label!="string"||typeof C.run!="function")throw new Error("Invalid action descriptor, `id`, `label` and `run` are required properties!");if(!this._standaloneKeybindingService)return console.warn("Cannot add keybinding because the editor is configured with an unrecognized KeybindingService"),Disposable.None;const W=C.id,V=C.label,U=ContextKeyExpr.and(ContextKeyExpr.equals("editorId",this.getId()),ContextKeyExpr.deserialize(C.precondition)),G=C.keybindings,Z=ContextKeyExpr.and(U,ContextKeyExpr.deserialize(C.keybindingContext)),X=C.contextMenuGroupId||null,Q=C.contextMenuOrder||0,J=(ne,...oe)=>Promise.resolve(C.run(this,...oe)),ee=new DisposableStore,te=this.getId()+":"+W;if(ee.add(CommandsRegistry.registerCommand(te,J)),X){const ne={command:{id:te,title:V},when:U,group:X,order:Q};ee.add(MenuRegistry.appendMenuItem(MenuId.EditorContext,ne))}if(Array.isArray(G))for(const ne of G)ee.add(this._standaloneKeybindingService.addDynamicKeybinding(te,ne,J,Z));const ie=new InternalEditorAction(te,V,V,U,(...ne)=>Promise.resolve(C.run(this,...ne)),this._contextKeyService);return this._actions.set(W,ie),ee.add(toDisposable(()=>{this._actions.delete(W)})),ee}_triggerCommand(C,W){if(this._codeEditorService instanceof StandaloneCodeEditorService)try{this._codeEditorService.setActiveCodeEditor(this),super._triggerCommand(C,W)}finally{this._codeEditorService.setActiveCodeEditor(null)}else super._triggerCommand(C,W)}};StandaloneCodeEditor=__decorate$1q([__param$1q(2,IInstantiationService),__param$1q(3,ICodeEditorService),__param$1q(4,ICommandService),__param$1q(5,IContextKeyService),__param$1q(6,IKeybindingService),__param$1q(7,IThemeService),__param$1q(8,INotificationService),__param$1q(9,IAccessibilityService),__param$1q(10,ILanguageConfigurationService),__param$1q(11,ILanguageFeaturesService)],StandaloneCodeEditor);let StandaloneEditor=class extends StandaloneCodeEditor{constructor(C,W,V,U,G,Z,X,Q,J,ee,te,ie,ne,oe,re){const ae=Object.assign({},W);updateConfigurationService(ee,ae,!1);const se=Q.registerEditorContainer(C);typeof ae.theme=="string"&&Q.setTheme(ae.theme),typeof ae.autoDetectHighContrast<"u"&&Q.setAutoDetectHighContrast(!!ae.autoDetectHighContrast);const le=ae.model;delete ae.model,super(C,ae,V,U,G,Z,X,Q,J,te,oe,re),this._configurationService=ee,this._standaloneThemeService=Q,this._register(se);let ce;if(typeof le>"u"){const de=ne.getLanguageIdByMimeType(ae.language)||ae.language||PLAINTEXT_LANGUAGE_ID;ce=createTextModel(ie,ne,ae.value||"",de,void 0),this._ownsModel=!0}else ce=le,this._ownsModel=!1;if(this._attachModel(ce),ce){const de={oldModelUrl:null,newModelUrl:ce.uri};this._onDidChangeModel.fire(de)}}dispose(){super.dispose()}updateOptions(C){updateConfigurationService(this._configurationService,C,!1),typeof C.theme=="string"&&this._standaloneThemeService.setTheme(C.theme),typeof C.autoDetectHighContrast<"u"&&this._standaloneThemeService.setAutoDetectHighContrast(!!C.autoDetectHighContrast),super.updateOptions(C)}_postDetachModelCleanup(C){super._postDetachModelCleanup(C),C&&this._ownsModel&&(C.dispose(),this._ownsModel=!1)}};StandaloneEditor=__decorate$1q([__param$1q(2,IInstantiationService),__param$1q(3,ICodeEditorService),__param$1q(4,ICommandService),__param$1q(5,IContextKeyService),__param$1q(6,IKeybindingService),__param$1q(7,IStandaloneThemeService),__param$1q(8,INotificationService),__param$1q(9,IConfigurationService),__param$1q(10,IAccessibilityService),__param$1q(11,IModelService),__param$1q(12,ILanguageService),__param$1q(13,ILanguageConfigurationService),__param$1q(14,ILanguageFeaturesService)],StandaloneEditor);let StandaloneDiffEditor2=class extends DiffEditorWidget{constructor(C,W,V,U,G,Z,X,Q,J,ee,te,ie){const ne=Object.assign({},W);updateConfigurationService(Q,ne,!0);const oe=Z.registerEditorContainer(C);typeof ne.theme=="string"&&Z.setTheme(ne.theme),typeof ne.autoDetectHighContrast<"u"&&Z.setAutoDetectHighContrast(!!ne.autoDetectHighContrast),super(C,ne,{},U,V,G,ie,ee),this._configurationService=Q,this._standaloneThemeService=Z,this._register(oe)}dispose(){super.dispose()}updateOptions(C){updateConfigurationService(this._configurationService,C,!0),typeof C.theme=="string"&&this._standaloneThemeService.setTheme(C.theme),typeof C.autoDetectHighContrast<"u"&&this._standaloneThemeService.setAutoDetectHighContrast(!!C.autoDetectHighContrast),super.updateOptions(C)}_createInnerEditor(C,W,V){return C.createInstance(StandaloneCodeEditor,W,V)}getOriginalEditor(){return super.getOriginalEditor()}getModifiedEditor(){return super.getModifiedEditor()}addCommand(C,W,V){return this.getModifiedEditor().addCommand(C,W,V)}createContextKey(C,W){return this.getModifiedEditor().createContextKey(C,W)}addAction(C){return this.getModifiedEditor().addAction(C)}};StandaloneDiffEditor2=__decorate$1q([__param$1q(2,IInstantiationService),__param$1q(3,IContextKeyService),__param$1q(4,ICodeEditorService),__param$1q(5,IStandaloneThemeService),__param$1q(6,INotificationService),__param$1q(7,IConfigurationService),__param$1q(8,IContextMenuService),__param$1q(9,IEditorProgressService),__param$1q(10,IClipboardService),__param$1q(11,IAudioCueService)],StandaloneDiffEditor2);function createTextModel(K,C,W,V,U){if(W=W||"",!V){const G=W.indexOf(`
`);let Z=W;return G!==-1&&(Z=W.substring(0,G)),doCreateModel(K,W,C.createByFilepathOrFirstLine(U||null,Z),U)}return doCreateModel(K,W,C.createById(V),U)}function doCreateModel(K,C,W,V){return K.createModel(C,W,V)}var __awaiter$19=globalThis&&globalThis.__awaiter||function(K,C,W,V){function U(G){return G instanceof W?G:new W(function(Z){Z(G)})}return new(W||(W=Promise))(function(G,Z){function X(ee){try{J(V.next(ee))}catch(te){Z(te)}}function Q(ee){try{J(V.throw(ee))}catch(te){Z(te)}}function J(ee){ee.done?G(ee.value):U(ee.value).then(X,Q)}J((V=V.apply(K,C||[])).next())})};function create(K,C,W){return StandaloneServices.initialize(W||{}).createInstance(StandaloneEditor,K,C)}function onDidCreateEditor(K){return StandaloneServices.get(ICodeEditorService).onCodeEditorAdd(W=>{K(W)})}function onDidCreateDiffEditor(K){return StandaloneServices.get(ICodeEditorService).onDiffEditorAdd(W=>{K(W)})}function getEditors(){return StandaloneServices.get(ICodeEditorService).listCodeEditors()}function getDiffEditors(){return StandaloneServices.get(ICodeEditorService).listDiffEditors()}function createDiffEditor(K,C,W){return StandaloneServices.initialize(W||{}).createInstance(StandaloneDiffEditor2,K,C)}function addCommand(K){if(typeof K.id!="string"||typeof K.run!="function")throw new Error("Invalid command descriptor, `id` and `run` are required properties!");return CommandsRegistry.registerCommand(K.id,K.run)}function addEditorAction(K){if(typeof K.id!="string"||typeof K.label!="string"||typeof K.run!="function")throw new Error("Invalid action descriptor, `id`, `label` and `run` are required properties!");const C=ContextKeyExpr.deserialize(K.precondition),W=(U,...G)=>EditorCommand.runEditorCommand(U,G,C,(Z,X,Q)=>Promise.resolve(K.run(X,...Q))),V=new DisposableStore;if(V.add(CommandsRegistry.registerCommand(K.id,W)),K.contextMenuGroupId){const U={command:{id:K.id,title:K.label},when:C,group:K.contextMenuGroupId,order:K.contextMenuOrder||0};V.add(MenuRegistry.appendMenuItem(MenuId.EditorContext,U))}if(Array.isArray(K.keybindings)){const U=StandaloneServices.get(IKeybindingService);if(!(U instanceof StandaloneKeybindingService))console.warn("Cannot add keybinding because the editor is configured with an unrecognized KeybindingService");else{const G=ContextKeyExpr.and(C,ContextKeyExpr.deserialize(K.keybindingContext));V.add(U.addDynamicKeybindings(K.keybindings.map(Z=>({keybinding:Z,command:K.id,when:G}))))}}return V}function addKeybindingRule(K){return addKeybindingRules([K])}function addKeybindingRules(K){const C=StandaloneServices.get(IKeybindingService);return C instanceof StandaloneKeybindingService?C.addDynamicKeybindings(K.map(W=>({keybinding:W.keybinding,command:W.command,commandArgs:W.commandArgs,when:ContextKeyExpr.deserialize(W.when)}))):(console.warn("Cannot add keybinding because the editor is configured with an unrecognized KeybindingService"),Disposable.None)}function createModel(K,C,W){const V=StandaloneServices.get(ILanguageService),U=V.getLanguageIdByMimeType(C)||C;return createTextModel(StandaloneServices.get(IModelService),V,K,U,W)}function setModelLanguage(K,C){const W=StandaloneServices.get(ILanguageService),V=W.getLanguageIdByMimeType(C)||C||PLAINTEXT_LANGUAGE_ID;K.setLanguage(W.createById(V))}function setModelMarkers(K,C,W){K&&StandaloneServices.get(IMarkerService).changeOne(C,K.uri,W)}function removeAllMarkers(K){StandaloneServices.get(IMarkerService).changeAll(K,[])}function getModelMarkers(K){return StandaloneServices.get(IMarkerService).read(K)}function onDidChangeMarkers(K){return StandaloneServices.get(IMarkerService).onMarkerChanged(K)}function getModel(K){return StandaloneServices.get(IModelService).getModel(K)}function getModels(){return StandaloneServices.get(IModelService).getModels()}function onDidCreateModel(K){return StandaloneServices.get(IModelService).onModelAdded(K)}function onWillDisposeModel(K){return StandaloneServices.get(IModelService).onModelRemoved(K)}function onDidChangeModelLanguage(K){return StandaloneServices.get(IModelService).onModelLanguageChanged(W=>{K({model:W.model,oldLanguage:W.oldLanguageId})})}function createWebWorker(K){return createWebWorker$1(StandaloneServices.get(IModelService),StandaloneServices.get(ILanguageConfigurationService),K)}function colorizeElement(K,C){const W=StandaloneServices.get(ILanguageService),V=StandaloneServices.get(IStandaloneThemeService);return Colorizer.colorizeElement(V,W,K,C).then(()=>{V.registerEditorContainer(K)})}function colorize(K,C,W){const V=StandaloneServices.get(ILanguageService);return StandaloneServices.get(IStandaloneThemeService).registerEditorContainer(document.body),Colorizer.colorize(V,K,C,W)}function colorizeModelLine(K,C,W=4){return StandaloneServices.get(IStandaloneThemeService).registerEditorContainer(document.body),Colorizer.colorizeModelLine(K,C,W)}function getSafeTokenizationSupport$1(K){const C=TokenizationRegistry.get(K);return C||{getInitialState:()=>NullState,tokenize:(W,V,U)=>nullTokenize(K,U)}}function tokenize(K,C){TokenizationRegistry.getOrCreate(C);const W=getSafeTokenizationSupport$1(C),V=splitLines(K),U=[];let G=W.getInitialState();for(let Z=0,X=V.length;Z<X;Z++){const Q=V[Z],J=W.tokenize(Q,!0,G);U[Z]=J.tokens,G=J.endState}return U}function defineTheme(K,C){StandaloneServices.get(IStandaloneThemeService).defineTheme(K,C)}function setTheme(K){StandaloneServices.get(IStandaloneThemeService).setTheme(K)}function remeasureFonts(){FontMeasurements.clearAllFontInfos()}function registerCommand$1(K,C){return CommandsRegistry.registerCommand({id:K,handler:C})}function registerLinkOpener(K){return StandaloneServices.get(IOpenerService).registerOpener({open(W){return __awaiter$19(this,void 0,void 0,function*(){return typeof W=="string"&&(W=URI.parse(W)),K.open(W)})}})}function registerEditorOpener(K){return StandaloneServices.get(ICodeEditorService).registerCodeEditorOpenHandler((W,V,U)=>__awaiter$19(this,void 0,void 0,function*(){var G;if(!V)return null;const Z=(G=W.options)===null||G===void 0?void 0:G.selection;let X;return Z&&typeof Z.endLineNumber=="number"&&typeof Z.endColumn=="number"?X=Z:Z&&(X={lineNumber:Z.startLineNumber,column:Z.startColumn}),(yield K.openCodeEditor(V,W.resource,X))?V:null}))}function createMonacoEditorAPI(){return{create,getEditors,getDiffEditors,onDidCreateEditor,onDidCreateDiffEditor,createDiffEditor,addCommand,addEditorAction,addKeybindingRule,addKeybindingRules,createModel,setModelLanguage,setModelMarkers,getModelMarkers,removeAllMarkers,onDidChangeMarkers,getModels,getModel,onDidCreateModel,onWillDisposeModel,onDidChangeModelLanguage,createWebWorker,colorizeElement,colorize,colorizeModelLine,tokenize,defineTheme,setTheme,remeasureFonts,registerCommand:registerCommand$1,registerLinkOpener,registerEditorOpener,AccessibilitySupport,ContentWidgetPositionPreference,CursorChangeReason,DefaultEndOfLine,EditorAutoIndentStrategy,EditorOption,EndOfLinePreference,EndOfLineSequence,MinimapPosition:MinimapPosition$1,MouseTargetType,OverlayWidgetPositionPreference,OverviewRulerLane:OverviewRulerLane$1,GlyphMarginLane:GlyphMarginLane$1,RenderLineNumbersType,RenderMinimap,ScrollbarVisibility,ScrollType,TextEditorCursorBlinkingStyle,TextEditorCursorStyle,TrackedRangeStickiness,WrappingIndent,InjectedTextCursorStops:InjectedTextCursorStops$1,PositionAffinity,ConfigurationChangedEvent,BareFontInfo,FontInfo,TextModelResolvedOptions,FindMatch,ApplyUpdateResult,EditorZoom,EditorType,EditorOptions}}function isArrayOf(K,C){if(!C||!Array.isArray(C))return!1;for(const W of C)if(!K(W))return!1;return!0}function bool(K,C){return typeof K=="boolean"?K:C}function string$1(K,C){return typeof K=="string"?K:C}function arrayToHash(K){const C={};for(const W of K)C[W]=!0;return C}function createKeywordMatcher(K,C=!1){C&&(K=K.map(function(V){return V.toLowerCase()}));const W=arrayToHash(K);return C?function(V){return W[V.toLowerCase()]!==void 0&&W.hasOwnProperty(V.toLowerCase())}:function(V){return W[V]!==void 0&&W.hasOwnProperty(V)}}function compileRegExp(K,C){C=C.replace(/@@/g,"");let W=0,V;do V=!1,C=C.replace(/@(\w+)/g,function(G,Z){V=!0;let X="";if(typeof K[Z]=="string")X=K[Z];else if(K[Z]&&K[Z]instanceof RegExp)X=K[Z].source;else throw K[Z]===void 0?createError(K,"language definition does not contain attribute '"+Z+"', used at: "+C):createError(K,"attribute reference '"+Z+"' must be a string, used at: "+C);return empty$2(X)?"":"(?:"+X+")"}),W++;while(V&&W<5);C=C.replace(/\x01/g,"@");const U=(K.ignoreCase?"i":"")+(K.unicode?"u":"");return new RegExp(C,U)}function selectScrutinee(K,C,W,V){if(V<0)return K;if(V<C.length)return C[V];if(V>=100){V=V-100;const U=W.split(".");if(U.unshift(W),V<U.length)return U[V]}return null}function createGuard(K,C,W,V){let U=-1,G=W,Z=W.match(/^\$(([sS]?)(\d\d?)|#)(.*)$/);Z&&(Z[3]&&(U=parseInt(Z[3]),Z[2]&&(U=U+100)),G=Z[4]);let X="~",Q=G;!G||G.length===0?(X="!=",Q=""):/^\w*$/.test(Q)?X="==":(Z=G.match(/^(@|!@|~|!~|==|!=)(.*)$/),Z&&(X=Z[1],Q=Z[2]));let J;if((X==="~"||X==="!~")&&/^(\w|\|)*$/.test(Q)){const ee=createKeywordMatcher(Q.split("|"),K.ignoreCase);J=function(te){return X==="~"?ee(te):!ee(te)}}else if(X==="@"||X==="!@"){const ee=K[Q];if(!ee)throw createError(K,"the @ match target '"+Q+"' is not defined, in rule: "+C);if(!isArrayOf(function(ie){return typeof ie=="string"},ee))throw createError(K,"the @ match target '"+Q+"' must be an array of strings, in rule: "+C);const te=createKeywordMatcher(ee,K.ignoreCase);J=function(ie){return X==="@"?te(ie):!te(ie)}}else if(X==="~"||X==="!~")if(Q.indexOf("$")<0){const ee=compileRegExp(K,"^"+Q+"$");J=function(te){return X==="~"?ee.test(te):!ee.test(te)}}else J=function(ee,te,ie,ne){return compileRegExp(K,"^"+substituteMatches(K,Q,te,ie,ne)+"$").test(ee)};else if(Q.indexOf("$")<0){const ee=fixCase(K,Q);J=function(te){return X==="=="?te===ee:te!==ee}}else{const ee=fixCase(K,Q);J=function(te,ie,ne,oe,re){const ae=substituteMatches(K,ee,ie,ne,oe);return X==="=="?te===ae:te!==ae}}return U===-1?{name:W,value:V,test:function(ee,te,ie,ne){return J(ee,ee,te,ie,ne)}}:{name:W,value:V,test:function(ee,te,ie,ne){const oe=selectScrutinee(ee,te,ie,U);return J(oe||"",ee,te,ie,ne)}}}function compileAction(K,C,W){if(W){if(typeof W=="string")return W;if(W.token||W.token===""){if(typeof W.token!="string")throw createError(K,"a 'token' attribute must be of type string, in rule: "+C);{const V={token:W.token};if(W.token.indexOf("$")>=0&&(V.tokenSubst=!0),typeof W.bracket=="string")if(W.bracket==="@open")V.bracket=1;else if(W.bracket==="@close")V.bracket=-1;else throw createError(K,"a 'bracket' attribute must be either '@open' or '@close', in rule: "+C);if(W.next){if(typeof W.next!="string")throw createError(K,"the next state must be a string value in rule: "+C);{let U=W.next;if(!/^(@pop|@push|@popall)$/.test(U)&&(U[0]==="@"&&(U=U.substr(1)),U.indexOf("$")<0&&!stateExists(K,substituteMatches(K,U,"",[],""))))throw createError(K,"the next state '"+W.next+"' is not defined in rule: "+C);V.next=U}}return typeof W.goBack=="number"&&(V.goBack=W.goBack),typeof W.switchTo=="string"&&(V.switchTo=W.switchTo),typeof W.log=="string"&&(V.log=W.log),typeof W.nextEmbedded=="string"&&(V.nextEmbedded=W.nextEmbedded,K.usesEmbedded=!0),V}}else if(Array.isArray(W)){const V=[];for(let U=0,G=W.length;U<G;U++)V[U]=compileAction(K,C,W[U]);return{group:V}}else if(W.cases){const V=[];for(const G in W.cases)if(W.cases.hasOwnProperty(G)){const Z=compileAction(K,C,W.cases[G]);G==="@default"||G==="@"||G===""?V.push({test:void 0,value:Z,name:G}):G==="@eos"?V.push({test:function(X,Q,J,ee){return ee},value:Z,name:G}):V.push(createGuard(K,C,G,Z))}const U=K.defaultToken;return{test:function(G,Z,X,Q){for(const J of V)if(!J.test||J.test(G,Z,X,Q))return J.value;return U}}}else throw createError(K,"an action must be a string, an object with a 'token' or 'cases' attribute, or an array of actions; in rule: "+C)}else return{token:""}}class Rule{constructor(C){this.regex=new RegExp(""),this.action={token:""},this.matchOnlyAtLineStart=!1,this.name="",this.name=C}setRegex(C,W){let V;if(typeof W=="string")V=W;else if(W instanceof RegExp)V=W.source;else throw createError(C,"rules must start with a match string or regular expression: "+this.name);this.matchOnlyAtLineStart=V.length>0&&V[0]==="^",this.name=this.name+": "+V,this.regex=compileRegExp(C,"^(?:"+(this.matchOnlyAtLineStart?V.substr(1):V)+")")}setAction(C,W){this.action=compileAction(C,this.name,W)}}function compile(K,C){if(!C||typeof C!="object")throw new Error("Monarch: expecting a language definition object");const W={};W.languageId=K,W.includeLF=bool(C.includeLF,!1),W.noThrow=!1,W.maxStack=100,W.start=typeof C.start=="string"?C.start:null,W.ignoreCase=bool(C.ignoreCase,!1),W.unicode=bool(C.unicode,!1),W.tokenPostfix=string$1(C.tokenPostfix,"."+W.languageId),W.defaultToken=string$1(C.defaultToken,"source"),W.usesEmbedded=!1;const V=C;V.languageId=K,V.includeLF=W.includeLF,V.ignoreCase=W.ignoreCase,V.unicode=W.unicode,V.noThrow=W.noThrow,V.usesEmbedded=W.usesEmbedded,V.stateNames=C.tokenizer,V.defaultToken=W.defaultToken;function U(Z,X,Q){for(const J of Q){let ee=J.include;if(ee){if(typeof ee!="string")throw createError(W,"an 'include' attribute must be a string at: "+Z);if(ee[0]==="@"&&(ee=ee.substr(1)),!C.tokenizer[ee])throw createError(W,"include target '"+ee+"' is not defined at: "+Z);U(Z+"."+ee,X,C.tokenizer[ee])}else{const te=new Rule(Z);if(Array.isArray(J)&&J.length>=1&&J.length<=3)if(te.setRegex(V,J[0]),J.length>=3)if(typeof J[1]=="string")te.setAction(V,{token:J[1],next:J[2]});else if(typeof J[1]=="object"){const ie=J[1];ie.next=J[2],te.setAction(V,ie)}else throw createError(W,"a next state as the last element of a rule can only be given if the action is either an object or a string, at: "+Z);else te.setAction(V,J[1]);else{if(!J.regex)throw createError(W,"a rule must either be an array, or an object with a 'regex' or 'include' field at: "+Z);J.name&&typeof J.name=="string"&&(te.name=J.name),J.matchOnlyAtStart&&(te.matchOnlyAtLineStart=bool(J.matchOnlyAtLineStart,!1)),te.setRegex(V,J.regex),te.setAction(V,J.action)}X.push(te)}}}if(!C.tokenizer||typeof C.tokenizer!="object")throw createError(W,"a language definition must define the 'tokenizer' attribute as an object");W.tokenizer=[];for(const Z in C.tokenizer)if(C.tokenizer.hasOwnProperty(Z)){W.start||(W.start=Z);const X=C.tokenizer[Z];W.tokenizer[Z]=new Array,U("tokenizer."+Z,W.tokenizer[Z],X)}if(W.usesEmbedded=V.usesEmbedded,C.brackets){if(!Array.isArray(C.brackets))throw createError(W,"the 'brackets' attribute must be defined as an array")}else C.brackets=[{open:"{",close:"}",token:"delimiter.curly"},{open:"[",close:"]",token:"delimiter.square"},{open:"(",close:")",token:"delimiter.parenthesis"},{open:"<",close:">",token:"delimiter.angle"}];const G=[];for(const Z of C.brackets){let X=Z;if(X&&Array.isArray(X)&&X.length===3&&(X={token:X[2],open:X[0],close:X[1]}),X.open===X.close)throw createError(W,"open and close brackets in a 'brackets' attribute must be different: "+X.open+`
 hint: use the 'bracket' attribute if matching on equal brackets is required.`);if(typeof X.open=="string"&&typeof X.token=="string"&&typeof X.close=="string")G.push({token:X.token+W.tokenPostfix,open:fixCase(W,X.open),close:fixCase(W,X.close)});else throw createError(W,"every element in the 'brackets' array must be a '{open,close,token}' object or array")}return W.brackets=G,W.noThrow=!0,W}var __awaiter$18=globalThis&&globalThis.__awaiter||function(K,C,W,V){function U(G){return G instanceof W?G:new W(function(Z){Z(G)})}return new(W||(W=Promise))(function(G,Z){function X(ee){try{J(V.next(ee))}catch(te){Z(te)}}function Q(ee){try{J(V.throw(ee))}catch(te){Z(te)}}function J(ee){ee.done?G(ee.value):U(ee.value).then(X,Q)}J((V=V.apply(K,C||[])).next())})};function register(K){ModesRegistry.registerLanguage(K)}function getLanguages(){let K=[];return K=K.concat(ModesRegistry.getLanguages()),K}function getEncodedLanguageId(K){return StandaloneServices.get(ILanguageService).languageIdCodec.encodeLanguageId(K)}function onLanguage(K,C){return StandaloneServices.withServices(()=>{const V=StandaloneServices.get(ILanguageService).onDidRequestRichLanguageFeatures(U=>{U===K&&(V.dispose(),C())});return V})}function onLanguageEncountered(K,C){return StandaloneServices.withServices(()=>{const V=StandaloneServices.get(ILanguageService).onDidRequestBasicLanguageFeatures(U=>{U===K&&(V.dispose(),C())});return V})}function setLanguageConfiguration(K,C){if(!StandaloneServices.get(ILanguageService).isRegisteredLanguageId(K))throw new Error(`Cannot set configuration for unknown language ${K}`);return StandaloneServices.get(ILanguageConfigurationService).register(K,C,100)}class EncodedTokenizationSupportAdapter{constructor(C,W){this._languageId=C,this._actual=W}dispose(){}getInitialState(){return this._actual.getInitialState()}tokenize(C,W,V){if(typeof this._actual.tokenize=="function")return TokenizationSupportAdapter.adaptTokenize(this._languageId,this._actual,C,V);throw new Error("Not supported!")}tokenizeEncoded(C,W,V){const U=this._actual.tokenizeEncoded(C,V);return new EncodedTokenizationResult(U.tokens,U.endState)}}class TokenizationSupportAdapter{constructor(C,W,V,U){this._languageId=C,this._actual=W,this._languageService=V,this._standaloneThemeService=U}dispose(){}getInitialState(){return this._actual.getInitialState()}static _toClassicTokens(C,W){const V=[];let U=0;for(let G=0,Z=C.length;G<Z;G++){const X=C[G];let Q=X.startIndex;G===0?Q=0:Q<U&&(Q=U),V[G]=new Token$2(Q,X.scopes,W),U=Q}return V}static adaptTokenize(C,W,V,U){const G=W.tokenize(V,U),Z=TokenizationSupportAdapter._toClassicTokens(G.tokens,C);let X;return G.endState.equals(U)?X=U:X=G.endState,new TokenizationResult(Z,X)}tokenize(C,W,V){return TokenizationSupportAdapter.adaptTokenize(this._languageId,this._actual,C,V)}_toBinaryTokens(C,W){const V=C.encodeLanguageId(this._languageId),U=this._standaloneThemeService.getColorTheme().tokenTheme,G=[];let Z=0,X=0;for(let J=0,ee=W.length;J<ee;J++){const te=W[J],ie=U.match(V,te.scopes)|1024;if(Z>0&&G[Z-1]===ie)continue;let ne=te.startIndex;J===0?ne=0:ne<X&&(ne=X),G[Z++]=ne,G[Z++]=ie,X=ne}const Q=new Uint32Array(Z);for(let J=0;J<Z;J++)Q[J]=G[J];return Q}tokenizeEncoded(C,W,V){const U=this._actual.tokenize(C,V),G=this._toBinaryTokens(this._languageService.languageIdCodec,U.tokens);let Z;return U.endState.equals(V)?Z=V:Z=U.endState,new EncodedTokenizationResult(G,Z)}}function isATokensProvider(K){return typeof K.getInitialState=="function"}function isEncodedTokensProvider(K){return"tokenizeEncoded"in K}function isThenable$2(K){return K&&typeof K.then=="function"}function setColorMap(K){const C=StandaloneServices.get(IStandaloneThemeService);if(K){const W=[null];for(let V=1,U=K.length;V<U;V++)W[V]=Color.fromHex(K[V]);C.setColorMapOverride(W)}else C.setColorMapOverride(null)}function createTokenizationSupportAdapter(K,C){return isEncodedTokensProvider(C)?new EncodedTokenizationSupportAdapter(K,C):new TokenizationSupportAdapter(K,C,StandaloneServices.get(ILanguageService),StandaloneServices.get(IStandaloneThemeService))}function registerTokensProviderFactory(K,C){const W=new LazyTokenizationSupport(()=>__awaiter$18(this,void 0,void 0,function*(){const V=yield Promise.resolve(C.create());return V?isATokensProvider(V)?createTokenizationSupportAdapter(K,V):new MonarchTokenizer(StandaloneServices.get(ILanguageService),StandaloneServices.get(IStandaloneThemeService),K,compile(K,V),StandaloneServices.get(IConfigurationService)):null}));return TokenizationRegistry.registerFactory(K,W)}function setTokensProvider(K,C){if(!StandaloneServices.get(ILanguageService).isRegisteredLanguageId(K))throw new Error(`Cannot set tokens provider for unknown language ${K}`);return isThenable$2(C)?registerTokensProviderFactory(K,{create:()=>C}):TokenizationRegistry.register(K,createTokenizationSupportAdapter(K,C))}function setMonarchTokensProvider(K,C){const W=V=>new MonarchTokenizer(StandaloneServices.get(ILanguageService),StandaloneServices.get(IStandaloneThemeService),K,compile(K,V),StandaloneServices.get(IConfigurationService));return isThenable$2(C)?registerTokensProviderFactory(K,{create:()=>C}):TokenizationRegistry.register(K,W(C))}function registerReferenceProvider(K,C){return StandaloneServices.get(ILanguageFeaturesService).referenceProvider.register(K,C)}function registerRenameProvider(K,C){return StandaloneServices.get(ILanguageFeaturesService).renameProvider.register(K,C)}function registerSignatureHelpProvider(K,C){return StandaloneServices.get(ILanguageFeaturesService).signatureHelpProvider.register(K,C)}function registerHoverProvider(K,C){return StandaloneServices.get(ILanguageFeaturesService).hoverProvider.register(K,{provideHover:(V,U,G)=>{const Z=V.getWordAtPosition(U);return Promise.resolve(C.provideHover(V,U,G)).then(X=>{if(X)return!X.range&&Z&&(X.range=new Range$2(U.lineNumber,Z.startColumn,U.lineNumber,Z.endColumn)),X.range||(X.range=new Range$2(U.lineNumber,U.column,U.lineNumber,U.column)),X})}})}function registerDocumentSymbolProvider(K,C){return StandaloneServices.get(ILanguageFeaturesService).documentSymbolProvider.register(K,C)}function registerDocumentHighlightProvider(K,C){return StandaloneServices.get(ILanguageFeaturesService).documentHighlightProvider.register(K,C)}function registerLinkedEditingRangeProvider(K,C){return StandaloneServices.get(ILanguageFeaturesService).linkedEditingRangeProvider.register(K,C)}function registerDefinitionProvider(K,C){return StandaloneServices.get(ILanguageFeaturesService).definitionProvider.register(K,C)}function registerImplementationProvider(K,C){return StandaloneServices.get(ILanguageFeaturesService).implementationProvider.register(K,C)}function registerTypeDefinitionProvider(K,C){return StandaloneServices.get(ILanguageFeaturesService).typeDefinitionProvider.register(K,C)}function registerCodeLensProvider(K,C){return StandaloneServices.get(ILanguageFeaturesService).codeLensProvider.register(K,C)}function registerCodeActionProvider(K,C,W){return StandaloneServices.get(ILanguageFeaturesService).codeActionProvider.register(K,{providedCodeActionKinds:W==null?void 0:W.providedCodeActionKinds,documentation:W==null?void 0:W.documentation,provideCodeActions:(U,G,Z,X)=>{const J=StandaloneServices.get(IMarkerService).read({resource:U.uri}).filter(ee=>Range$2.areIntersectingOrTouching(ee,G));return C.provideCodeActions(U,G,{markers:J,only:Z.only,trigger:Z.trigger},X)},resolveCodeAction:C.resolveCodeAction})}function registerDocumentFormattingEditProvider(K,C){return StandaloneServices.get(ILanguageFeaturesService).documentFormattingEditProvider.register(K,C)}function registerDocumentRangeFormattingEditProvider(K,C){return StandaloneServices.get(ILanguageFeaturesService).documentRangeFormattingEditProvider.register(K,C)}function registerOnTypeFormattingEditProvider(K,C){return StandaloneServices.get(ILanguageFeaturesService).onTypeFormattingEditProvider.register(K,C)}function registerLinkProvider(K,C){return StandaloneServices.get(ILanguageFeaturesService).linkProvider.register(K,C)}function registerCompletionItemProvider(K,C){return StandaloneServices.get(ILanguageFeaturesService).completionProvider.register(K,C)}function registerColorProvider(K,C){return StandaloneServices.get(ILanguageFeaturesService).colorProvider.register(K,C)}function registerFoldingRangeProvider(K,C){return StandaloneServices.get(ILanguageFeaturesService).foldingRangeProvider.register(K,C)}function registerDeclarationProvider(K,C){return StandaloneServices.get(ILanguageFeaturesService).declarationProvider.register(K,C)}function registerSelectionRangeProvider(K,C){return StandaloneServices.get(ILanguageFeaturesService).selectionRangeProvider.register(K,C)}function registerDocumentSemanticTokensProvider(K,C){return StandaloneServices.get(ILanguageFeaturesService).documentSemanticTokensProvider.register(K,C)}function registerDocumentRangeSemanticTokensProvider(K,C){return StandaloneServices.get(ILanguageFeaturesService).documentRangeSemanticTokensProvider.register(K,C)}function registerInlineCompletionsProvider(K,C){return StandaloneServices.get(ILanguageFeaturesService).inlineCompletionsProvider.register(K,C)}function registerInlayHintsProvider(K,C){return StandaloneServices.get(ILanguageFeaturesService).inlayHintsProvider.register(K,C)}function createMonacoLanguagesAPI(){return{register,getLanguages,onLanguage,onLanguageEncountered,getEncodedLanguageId,setLanguageConfiguration,setColorMap,registerTokensProviderFactory,setTokensProvider,setMonarchTokensProvider,registerReferenceProvider,registerRenameProvider,registerCompletionItemProvider,registerSignatureHelpProvider,registerHoverProvider,registerDocumentSymbolProvider,registerDocumentHighlightProvider,registerLinkedEditingRangeProvider,registerDefinitionProvider,registerImplementationProvider,registerTypeDefinitionProvider,registerCodeLensProvider,registerCodeActionProvider,registerDocumentFormattingEditProvider,registerDocumentRangeFormattingEditProvider,registerOnTypeFormattingEditProvider,registerLinkProvider,registerColorProvider,registerFoldingRangeProvider,registerDeclarationProvider,registerSelectionRangeProvider,registerDocumentSemanticTokensProvider,registerDocumentRangeSemanticTokensProvider,registerInlineCompletionsProvider,registerInlayHintsProvider,DocumentHighlightKind,CompletionItemKind,CompletionItemTag,CompletionItemInsertTextRule,SymbolKind,SymbolTag,IndentAction:IndentAction$1,CompletionTriggerKind,SignatureHelpTriggerKind,InlayHintKind,InlineCompletionTriggerKind,CodeActionTriggerType,FoldingRangeKind,SelectedSuggestionInfo}}const IEditorCancellationTokens=createDecorator("IEditorCancelService"),ctxCancellableOperation=new RawContextKey("cancellableOperation",!1,localize("cancellableOperation","Whether the editor runs a cancellable operation, e.g. like 'Peek References'"));registerSingleton(IEditorCancellationTokens,class{constructor(){this._tokens=new WeakMap}add(K,C){let W=this._tokens.get(K);W||(W=K.invokeWithinContext(U=>{const G=ctxCancellableOperation.bindTo(U.get(IContextKeyService)),Z=new LinkedList;return{key:G,tokens:Z}}),this._tokens.set(K,W));let V;return W.key.set(!0),V=W.tokens.push(C),()=>{V&&(V(),W.key.set(!W.tokens.isEmpty()),V=void 0)}}cancel(K){const C=this._tokens.get(K);if(!C)return;const W=C.tokens.pop();W&&(W.cancel(),C.key.set(!C.tokens.isEmpty()))}},1);class EditorKeybindingCancellationTokenSource extends CancellationTokenSource$1{constructor(C,W){super(W),this.editor=C,this._unregister=C.invokeWithinContext(V=>V.get(IEditorCancellationTokens).add(C,this))}dispose(){this._unregister(),super.dispose()}}registerEditorCommand(new class extends EditorCommand{constructor(){super({id:"editor.cancelOperation",kbOpts:{weight:100,primary:9},precondition:ctxCancellableOperation})}runEditorCommand(K,C){K.get(IEditorCancellationTokens).cancel(C)}});let EditorState$1=class Yt{constructor(C,W){if(this.flags=W,this.flags&1){const V=C.getModel();this.modelVersionId=V?format("{0}#{1}",V.uri.toString(),V.getVersionId()):null}else this.modelVersionId=null;this.flags&4?this.position=C.getPosition():this.position=null,this.flags&2?this.selection=C.getSelection():this.selection=null,this.flags&8?(this.scrollLeft=C.getScrollLeft(),this.scrollTop=C.getScrollTop()):(this.scrollLeft=-1,this.scrollTop=-1)}_equals(C){if(!(C instanceof Yt))return!1;const W=C;return!(this.modelVersionId!==W.modelVersionId||this.scrollLeft!==W.scrollLeft||this.scrollTop!==W.scrollTop||!this.position&&W.position||this.position&&!W.position||this.position&&W.position&&!this.position.equals(W.position)||!this.selection&&W.selection||this.selection&&!W.selection||this.selection&&W.selection&&!this.selection.equalsRange(W.selection))}validate(C){return this._equals(new Yt(C,this.flags))}};class EditorStateCancellationTokenSource extends EditorKeybindingCancellationTokenSource{constructor(C,W,V,U){super(C,U),this._listener=new DisposableStore,W&4&&this._listener.add(C.onDidChangeCursorPosition(G=>{(!V||!Range$2.containsPosition(V,G.position))&&this.cancel()})),W&2&&this._listener.add(C.onDidChangeCursorSelection(G=>{(!V||!Range$2.containsRange(V,G.selection))&&this.cancel()})),W&8&&this._listener.add(C.onDidScrollChange(G=>this.cancel())),W&1&&(this._listener.add(C.onDidChangeModel(G=>this.cancel())),this._listener.add(C.onDidChangeModelContent(G=>this.cancel())))}dispose(){this._listener.dispose(),super.dispose()}}class TextModelCancellationTokenSource extends CancellationTokenSource$1{constructor(C,W){super(W),this._listener=C.onDidChangeContent(()=>this.cancel())}dispose(){this._listener.dispose(),super.dispose()}}function isCodeEditor(K){return K&&typeof K.getEditorType=="function"?K.getEditorType()===EditorType.ICodeEditor:!1}function isDiffEditor(K){return K&&typeof K.getEditorType=="function"?K.getEditorType()===EditorType.IDiffEditor:!1}function isCompositeEditor(K){return!!K&&typeof K=="object"&&typeof K.onDidChangeActiveEditor=="function"}function getCodeEditor(K){return isCodeEditor(K)?K:isDiffEditor(K)?K.getModifiedEditor():isCompositeEditor(K)&&isCodeEditor(K.activeCodeEditor)?K.activeCodeEditor:null}class FormattingEdit{static _handleEolEdits(C,W){let V;const U=[];for(const G of W)typeof G.eol=="number"&&(V=G.eol),G.range&&typeof G.text=="string"&&U.push(G);return typeof V=="number"&&C.hasModel()&&C.getModel().pushEOL(V),U}static _isFullModelReplaceEdit(C,W){if(!C.hasModel())return!1;const V=C.getModel(),U=V.validateRange(W.range);return V.getFullModelRange().equalsRange(U)}static execute(C,W,V){V&&C.pushUndoStop();const U=StableEditorScrollState.capture(C),G=FormattingEdit._handleEolEdits(C,W);G.length===1&&FormattingEdit._isFullModelReplaceEdit(C,G[0])?C.executeEdits("formatEditsCommand",G.map(Z=>EditOperation.replace(Range$2.lift(Z.range),Z.text))):C.executeEdits("formatEditsCommand",G.map(Z=>EditOperation.replaceMove(Range$2.lift(Z.range),Z.text))),V&&C.pushUndoStop(),U.restoreRelativeVerticalPositionOfCursor(C)}}class ExtensionIdentifier{constructor(C){this.value=C,this._lower=C.toLowerCase()}static toKey(C){return typeof C=="string"?C.toLowerCase():C._lower}}class ExtensionIdentifierSet{constructor(C){if(this._set=new Set,C)for(const W of C)this.add(W)}add(C){this._set.add(ExtensionIdentifier.toKey(C))}has(C){return this._set.has(ExtensionIdentifier.toKey(C))}}var __awaiter$17=globalThis&&globalThis.__awaiter||function(K,C,W,V){function U(G){return G instanceof W?G:new W(function(Z){Z(G)})}return new(W||(W=Promise))(function(G,Z){function X(ee){try{J(V.next(ee))}catch(te){Z(te)}}function Q(ee){try{J(V.throw(ee))}catch(te){Z(te)}}function J(ee){ee.done?G(ee.value):U(ee.value).then(X,Q)}J((V=V.apply(K,C||[])).next())})};function alertFormattingEdits(K){if(K=K.filter(U=>U.range),!K.length)return;let{range:C}=K[0];for(let U=1;U<K.length;U++)C=Range$2.plusRange(C,K[U].range);const{startLineNumber:W,endLineNumber:V}=C;W===V?K.length===1?alert(localize("hint11","Made 1 formatting edit on line {0}",W)):alert(localize("hintn1","Made {0} formatting edits on line {1}",K.length,W)):K.length===1?alert(localize("hint1n","Made 1 formatting edit between lines {0} and {1}",W,V)):alert(localize("hintnn","Made {0} formatting edits between lines {1} and {2}",K.length,W,V))}function getRealAndSyntheticDocumentFormattersOrdered(K,C,W){const V=[],U=new ExtensionIdentifierSet,G=K.ordered(W);for(const X of G)V.push(X),X.extensionId&&U.add(X.extensionId);const Z=C.ordered(W);for(const X of Z){if(X.extensionId){if(U.has(X.extensionId))continue;U.add(X.extensionId)}V.push({displayName:X.displayName,extensionId:X.extensionId,provideDocumentFormattingEdits(Q,J,ee){return X.provideDocumentRangeFormattingEdits(Q,Q.getFullModelRange(),J,ee)}})}return V}class FormattingConflicts{static setFormatterSelector(C){return{dispose:FormattingConflicts._selectors.unshift(C)}}static select(C,W,V){return __awaiter$17(this,void 0,void 0,function*(){if(C.length===0)return;const U=Iterable.first(FormattingConflicts._selectors);if(U)return yield U(C,W,V)})}}FormattingConflicts._selectors=new LinkedList;function formatDocumentRangesWithSelectedProvider(K,C,W,V,U,G){return __awaiter$17(this,void 0,void 0,function*(){const Z=K.get(IInstantiationService),{documentRangeFormattingEditProvider:X}=K.get(ILanguageFeaturesService),Q=isCodeEditor(C)?C.getModel():C,J=X.ordered(Q),ee=yield FormattingConflicts.select(J,Q,V);ee&&(U.report(ee),yield Z.invokeFunction(formatDocumentRangesWithProvider,ee,C,W,G))})}function formatDocumentRangesWithProvider(K,C,W,V,U){var G,Z;return __awaiter$17(this,void 0,void 0,function*(){const X=K.get(IEditorWorkerService),Q=K.get(ILogService);let J,ee;isCodeEditor(W)?(J=W.getModel(),ee=new EditorStateCancellationTokenSource(W,5,void 0,U)):(J=W,ee=new TextModelCancellationTokenSource(W,U));const te=[];let ie=0;for(const se of asArray(V).sort(Range$2.compareRangesUsingStarts))ie>0&&Range$2.areIntersectingOrTouching(te[ie-1],se)?te[ie-1]=Range$2.fromPositions(te[ie-1].getStartPosition(),se.getEndPosition()):ie=te.push(se);const ne=se=>__awaiter$17(this,void 0,void 0,function*(){var le,ce;Q.trace("[format][provideDocumentRangeFormattingEdits] (request)",(le=C.extensionId)===null||le===void 0?void 0:le.value,se);const de=(yield C.provideDocumentRangeFormattingEdits(J,se,J.getFormattingOptions(),ee.token))||[];return Q.trace("[format][provideDocumentRangeFormattingEdits] (response)",(ce=C.extensionId)===null||ce===void 0?void 0:ce.value,de),de}),oe=(se,le)=>{if(!se.length||!le.length)return!1;const ce=se.reduce((de,ue)=>Range$2.plusRange(de,ue.range),se[0].range);if(!le.some(de=>Range$2.intersectRanges(ce,de.range)))return!1;for(const de of se)for(const ue of le)if(Range$2.intersectRanges(de.range,ue.range))return!0;return!1},re=[],ae=[];try{if(typeof C.provideDocumentRangesFormattingEdits=="function"){Q.trace("[format][provideDocumentRangeFormattingEdits] (request)",(G=C.extensionId)===null||G===void 0?void 0:G.value,te);const se=(yield C.provideDocumentRangesFormattingEdits(J,te,J.getFormattingOptions(),ee.token))||[];Q.trace("[format][provideDocumentRangeFormattingEdits] (response)",(Z=C.extensionId)===null||Z===void 0?void 0:Z.value,se),ae.push(se)}else{for(const se of te){if(ee.token.isCancellationRequested)return!0;ae.push(yield ne(se))}for(let se=0;se<te.length;++se)for(let le=se+1;le<te.length;++le){if(ee.token.isCancellationRequested)return!0;if(oe(ae[se],ae[le])){const ce=Range$2.plusRange(te[se],te[le]),de=yield ne(ce);te.splice(le,1),te.splice(se,1),te.push(ce),ae.splice(le,1),ae.splice(se,1),ae.push(de),se=0,le=0}}}for(const se of ae){if(ee.token.isCancellationRequested)return!0;const le=yield X.computeMoreMinimalEdits(J.uri,se);le&&re.push(...le)}}finally{ee.dispose()}if(re.length===0)return!1;if(isCodeEditor(W))FormattingEdit.execute(W,re,!0),alertFormattingEdits(re),W.revealPositionInCenterIfOutsideViewport(W.getPosition(),1);else{const[{range:se}]=re,le=new Selection$1(se.startLineNumber,se.startColumn,se.endLineNumber,se.endColumn);J.pushEditOperations([le],re.map(ce=>({text:ce.text,range:Range$2.lift(ce.range),forceMoveMarkers:!0})),ce=>{for(const{range:de}of ce)if(Range$2.areIntersectingOrTouching(de,le))return[new Selection$1(de.startLineNumber,de.startColumn,de.endLineNumber,de.endColumn)];return null})}return!0})}function formatDocumentWithSelectedProvider(K,C,W,V,U){return __awaiter$17(this,void 0,void 0,function*(){const G=K.get(IInstantiationService),Z=K.get(ILanguageFeaturesService),X=isCodeEditor(C)?C.getModel():C,Q=getRealAndSyntheticDocumentFormattersOrdered(Z.documentFormattingEditProvider,Z.documentRangeFormattingEditProvider,X),J=yield FormattingConflicts.select(Q,X,W);J&&(V.report(J),yield G.invokeFunction(formatDocumentWithProvider,J,C,W,U))})}function formatDocumentWithProvider(K,C,W,V,U){return __awaiter$17(this,void 0,void 0,function*(){const G=K.get(IEditorWorkerService);let Z,X;isCodeEditor(W)?(Z=W.getModel(),X=new EditorStateCancellationTokenSource(W,5,void 0,U)):(Z=W,X=new TextModelCancellationTokenSource(W,U));let Q;try{const J=yield C.provideDocumentFormattingEdits(Z,Z.getFormattingOptions(),X.token);if(Q=yield G.computeMoreMinimalEdits(Z.uri,J),X.token.isCancellationRequested)return!0}finally{X.dispose()}if(!Q||Q.length===0)return!1;if(isCodeEditor(W))FormattingEdit.execute(W,Q,V!==2),V!==2&&(alertFormattingEdits(Q),W.revealPositionInCenterIfOutsideViewport(W.getPosition(),1));else{const[{range:J}]=Q,ee=new Selection$1(J.startLineNumber,J.startColumn,J.endLineNumber,J.endColumn);Z.pushEditOperations([ee],Q.map(te=>({text:te.text,range:Range$2.lift(te.range),forceMoveMarkers:!0})),te=>{for(const{range:ie}of te)if(Range$2.areIntersectingOrTouching(ie,ee))return[new Selection$1(ie.startLineNumber,ie.startColumn,ie.endLineNumber,ie.endColumn)];return null})}return!0})}function getDocumentRangeFormattingEditsUntilResult(K,C,W,V,U,G){return __awaiter$17(this,void 0,void 0,function*(){const Z=C.documentRangeFormattingEditProvider.ordered(W);for(const X of Z){const Q=yield Promise.resolve(X.provideDocumentRangeFormattingEdits(W,V,U,G)).catch(onUnexpectedExternalError);if(isNonEmptyArray$2(Q))return yield K.computeMoreMinimalEdits(W.uri,Q)}})}function getDocumentFormattingEditsUntilResult(K,C,W,V,U){return __awaiter$17(this,void 0,void 0,function*(){const G=getRealAndSyntheticDocumentFormattersOrdered(C.documentFormattingEditProvider,C.documentRangeFormattingEditProvider,W);for(const Z of G){const X=yield Promise.resolve(Z.provideDocumentFormattingEdits(W,V,U)).catch(onUnexpectedExternalError);if(isNonEmptyArray$2(X))return yield K.computeMoreMinimalEdits(W.uri,X)}})}function getOnTypeFormattingEdits(K,C,W,V,U,G,Z){const X=C.onTypeFormattingEditProvider.ordered(W);return X.length===0||X[0].autoFormatTriggerCharacters.indexOf(U)<0?Promise.resolve(void 0):Promise.resolve(X[0].provideOnTypeFormattingEdits(W,V,U,G,Z)).catch(onUnexpectedExternalError).then(Q=>K.computeMoreMinimalEdits(W.uri,Q))}CommandsRegistry.registerCommand("_executeFormatRangeProvider",function(K,...C){return __awaiter$17(this,void 0,void 0,function*(){const[W,V,U]=C;assertType(URI.isUri(W)),assertType(Range$2.isIRange(V));const G=K.get(ITextModelService),Z=K.get(IEditorWorkerService),X=K.get(ILanguageFeaturesService),Q=yield G.createModelReference(W);try{return getDocumentRangeFormattingEditsUntilResult(Z,X,Q.object.textEditorModel,Range$2.lift(V),U,CancellationToken.None)}finally{Q.dispose()}})});CommandsRegistry.registerCommand("_executeFormatDocumentProvider",function(K,...C){return __awaiter$17(this,void 0,void 0,function*(){const[W,V]=C;assertType(URI.isUri(W));const U=K.get(ITextModelService),G=K.get(IEditorWorkerService),Z=K.get(ILanguageFeaturesService),X=yield U.createModelReference(W);try{return getDocumentFormattingEditsUntilResult(G,Z,X.object.textEditorModel,V,CancellationToken.None)}finally{X.dispose()}})});CommandsRegistry.registerCommand("_executeFormatOnTypeProvider",function(K,...C){return __awaiter$17(this,void 0,void 0,function*(){const[W,V,U,G]=C;assertType(URI.isUri(W)),assertType(Position$1.isIPosition(V)),assertType(typeof U=="string");const Z=K.get(ITextModelService),X=K.get(IEditorWorkerService),Q=K.get(ILanguageFeaturesService),J=yield Z.createModelReference(W);try{return getOnTypeFormattingEdits(X,Q,J.object.textEditorModel,Position$1.lift(V),U,G,CancellationToken.None)}finally{J.dispose()}})});EditorOptions.wrappingIndent.defaultValue=0;EditorOptions.glyphMargin.defaultValue=!1;EditorOptions.autoIndent.defaultValue=3;EditorOptions.overviewRulerLanes.defaultValue=2;FormattingConflicts.setFormatterSelector((K,C,W)=>Promise.resolve(K[0]));const api=createMonacoBaseAPI();api.editor=createMonacoEditorAPI();api.languages=createMonacoLanguagesAPI();const CancellationTokenSource=api.CancellationTokenSource,Emitter=api.Emitter,KeyCode=api.KeyCode,KeyMod=api.KeyMod,Position=api.Position,Range=api.Range,Selection=api.Selection,SelectionDirection=api.SelectionDirection,MarkerSeverity=api.MarkerSeverity,MarkerTag=api.MarkerTag,Uri=api.Uri,Token=api.Token,editor$1=api.editor,languages=api.languages,monacoEnvironment=globalThis.MonacoEnvironment;(monacoEnvironment!=null&&monacoEnvironment.globalAPI||typeof define=="function"&&define.amd)&&(globalThis.monaco=api);typeof globalThis.require<"u"&&typeof globalThis.require.config=="function"&&globalThis.require.config({ignoreDuplicateModules:["vscode-languageserver-types","vscode-languageserver-types/main","vscode-languageserver-textdocument","vscode-languageserver-textdocument/main","vscode-nls","vscode-nls/vscode-nls","jsonc-parser","jsonc-parser/main","vscode-uri","vscode-uri/index","vs/basic-languages/typescript/typescript"]});const monaco_editor_core_star=Object.freeze(Object.defineProperty({__proto__:null,CancellationTokenSource,Emitter,KeyCode,KeyMod,MarkerSeverity,MarkerTag,Position,Range,Selection,SelectionDirection,Token,Uri,editor:editor$1,languages},Symbol.toStringTag,{value:"Module"})),scriptRel="modulepreload",assetsURL=function(K){return"/"+K},seen={},__vitePreload=function(C,W,V){if(!W||W.length===0)return C();const U=document.getElementsByTagName("link");return Promise.all(W.map(G=>{if(G=assetsURL(G),G in seen)return;seen[G]=!0;const Z=G.endsWith(".css"),X=Z?'[rel="stylesheet"]':"";if(!!V)for(let ee=U.length-1;ee>=0;ee--){const te=U[ee];if(te.href===G&&(!Z||te.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${G}"]${X}`))return;const J=document.createElement("link");if(J.rel=Z?"stylesheet":scriptRel,Z||(J.as="script",J.crossOrigin=""),J.href=G,document.head.appendChild(J),Z)return new Promise((ee,te)=>{J.addEventListener("load",ee),J.addEventListener("error",()=>te(new Error(`Unable to preload CSS for ${G}`)))})})).then(()=>C()).catch(G=>{const Z=new Event("vite:preloadError",{cancelable:!0});if(Z.payload=G,window.dispatchEvent(Z),!Z.defaultPrevented)throw G})};/*!-----------------------------------------------------------------------------
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Version: 0.44.0(3e047efd345ff102c8c61b5398fb30845aaac166)
 * Released under the MIT license
 * https://github.com/microsoft/monaco-editor/blob/main/LICENSE.txt
 *-----------------------------------------------------------------------------*/var __defProp$4=Object.defineProperty,__getOwnPropDesc$4=Object.getOwnPropertyDescriptor,__getOwnPropNames$4=Object.getOwnPropertyNames,__hasOwnProp$4=Object.prototype.hasOwnProperty,__copyProps$4=(K,C,W,V)=>{if(C&&typeof C=="object"||typeof C=="function")for(let U of __getOwnPropNames$4(C))!__hasOwnProp$4.call(K,U)&&U!==W&&__defProp$4(K,U,{get:()=>C[U],enumerable:!(V=__getOwnPropDesc$4(C,U))||V.enumerable});return K},__reExport$4=(K,C,W)=>(__copyProps$4(K,C,"default"),W&&__copyProps$4(W,C,"default")),monaco_editor_core_exports$4={};__reExport$4(monaco_editor_core_exports$4,monaco_editor_core_star);var languageDefinitions={},lazyLanguageLoaders={},LazyLanguageLoader=class{constructor(K){et(this,"_languageId");et(this,"_loadingTriggered");et(this,"_lazyLoadPromise");et(this,"_lazyLoadPromiseResolve");et(this,"_lazyLoadPromiseReject");this._languageId=K,this._loadingTriggered=!1,this._lazyLoadPromise=new Promise((C,W)=>{this._lazyLoadPromiseResolve=C,this._lazyLoadPromiseReject=W})}static getOrCreate(K){return lazyLanguageLoaders[K]||(lazyLanguageLoaders[K]=new LazyLanguageLoader(K)),lazyLanguageLoaders[K]}load(){return this._loadingTriggered||(this._loadingTriggered=!0,languageDefinitions[this._languageId].loader().then(K=>this._lazyLoadPromiseResolve(K),K=>this._lazyLoadPromiseReject(K))),this._lazyLoadPromise}};function registerLanguage(K){const C=K.id;languageDefinitions[C]=K,monaco_editor_core_exports$4.languages.register(K);const W=LazyLanguageLoader.getOrCreate(C);monaco_editor_core_exports$4.languages.registerTokensProviderFactory(C,{create:async()=>(await W.load()).language}),monaco_editor_core_exports$4.languages.onLanguageEncountered(C,async()=>{const V=await W.load();monaco_editor_core_exports$4.languages.setLanguageConfiguration(C,V.conf)})}registerLanguage({id:"abap",extensions:[".abap"],aliases:["abap","ABAP"],loader:()=>__vitePreload(()=>import("./abap-e5f08dc1.js"),[])});registerLanguage({id:"apex",extensions:[".cls"],aliases:["Apex","apex"],mimetypes:["text/x-apex-source","text/x-apex"],loader:()=>__vitePreload(()=>import("./apex-fc8a734c.js"),[])});registerLanguage({id:"azcli",extensions:[".azcli"],aliases:["Azure CLI","azcli"],loader:()=>__vitePreload(()=>import("./azcli-c4358445.js"),[])});registerLanguage({id:"bat",extensions:[".bat",".cmd"],aliases:["Batch","bat"],loader:()=>__vitePreload(()=>import("./bat-eaac827b.js"),[])});registerLanguage({id:"bicep",extensions:[".bicep"],aliases:["Bicep"],loader:()=>__vitePreload(()=>import("./bicep-9f8671bb.js"),[])});registerLanguage({id:"cameligo",extensions:[".mligo"],aliases:["Cameligo"],loader:()=>__vitePreload(()=>import("./cameligo-ff939f45.js"),[])});registerLanguage({id:"clojure",extensions:[".clj",".cljs",".cljc",".edn"],aliases:["clojure","Clojure"],loader:()=>__vitePreload(()=>import("./clojure-4a1da11c.js"),[])});registerLanguage({id:"coffeescript",extensions:[".coffee"],aliases:["CoffeeScript","coffeescript","coffee"],mimetypes:["text/x-coffeescript","text/coffeescript"],loader:()=>__vitePreload(()=>import("./coffee-97023918.js"),[])});registerLanguage({id:"c",extensions:[".c",".h"],aliases:["C","c"],loader:()=>__vitePreload(()=>import("./cpp-a410d69a.js"),[])});registerLanguage({id:"cpp",extensions:[".cpp",".cc",".cxx",".hpp",".hh",".hxx"],aliases:["C++","Cpp","cpp"],loader:()=>__vitePreload(()=>import("./cpp-a410d69a.js"),[])});registerLanguage({id:"csharp",extensions:[".cs",".csx",".cake"],aliases:["C#","csharp"],loader:()=>__vitePreload(()=>import("./csharp-0765aa28.js"),[])});registerLanguage({id:"csp",extensions:[],aliases:["CSP","csp"],loader:()=>__vitePreload(()=>import("./csp-dba4fa86.js"),[])});registerLanguage({id:"css",extensions:[".css"],aliases:["CSS","css"],mimetypes:["text/css"],loader:()=>__vitePreload(()=>import("./css-f18eed00.js"),[])});registerLanguage({id:"cypher",extensions:[".cypher",".cyp"],aliases:["Cypher","OpenCypher"],loader:()=>__vitePreload(()=>import("./cypher-4b1a5b20.js"),[])});registerLanguage({id:"dart",extensions:[".dart"],aliases:["Dart","dart"],mimetypes:["text/x-dart-source","text/x-dart"],loader:()=>__vitePreload(()=>import("./dart-c70c4314.js"),[])});registerLanguage({id:"dockerfile",extensions:[".dockerfile"],filenames:["Dockerfile"],aliases:["Dockerfile"],loader:()=>__vitePreload(()=>import("./dockerfile-ff7f0401.js"),[])});registerLanguage({id:"ecl",extensions:[".ecl"],aliases:["ECL","Ecl","ecl"],loader:()=>__vitePreload(()=>import("./ecl-3129e183.js"),[])});registerLanguage({id:"elixir",extensions:[".ex",".exs"],aliases:["Elixir","elixir","ex"],loader:()=>__vitePreload(()=>import("./elixir-ac388b4d.js"),[])});registerLanguage({id:"flow9",extensions:[".flow"],aliases:["Flow9","Flow","flow9","flow"],loader:()=>__vitePreload(()=>import("./flow9-049a8a6c.js"),[])});registerLanguage({id:"fsharp",extensions:[".fs",".fsi",".ml",".mli",".fsx",".fsscript"],aliases:["F#","FSharp","fsharp"],loader:()=>__vitePreload(()=>import("./fsharp-535d9fe2.js"),[])});registerLanguage({id:"freemarker2",extensions:[".ftl",".ftlh",".ftlx"],aliases:["FreeMarker2","Apache FreeMarker2"],loader:()=>__vitePreload(()=>import("./freemarker2-99c5ee5a.js"),[]).then(K=>K.TagAutoInterpolationDollar)});registerLanguage({id:"freemarker2.tag-angle.interpolation-dollar",aliases:["FreeMarker2 (Angle/Dollar)","Apache FreeMarker2 (Angle/Dollar)"],loader:()=>__vitePreload(()=>import("./freemarker2-99c5ee5a.js"),[]).then(K=>K.TagAngleInterpolationDollar)});registerLanguage({id:"freemarker2.tag-bracket.interpolation-dollar",aliases:["FreeMarker2 (Bracket/Dollar)","Apache FreeMarker2 (Bracket/Dollar)"],loader:()=>__vitePreload(()=>import("./freemarker2-99c5ee5a.js"),[]).then(K=>K.TagBracketInterpolationDollar)});registerLanguage({id:"freemarker2.tag-angle.interpolation-bracket",aliases:["FreeMarker2 (Angle/Bracket)","Apache FreeMarker2 (Angle/Bracket)"],loader:()=>__vitePreload(()=>import("./freemarker2-99c5ee5a.js"),[]).then(K=>K.TagAngleInterpolationBracket)});registerLanguage({id:"freemarker2.tag-bracket.interpolation-bracket",aliases:["FreeMarker2 (Bracket/Bracket)","Apache FreeMarker2 (Bracket/Bracket)"],loader:()=>__vitePreload(()=>import("./freemarker2-99c5ee5a.js"),[]).then(K=>K.TagBracketInterpolationBracket)});registerLanguage({id:"freemarker2.tag-auto.interpolation-dollar",aliases:["FreeMarker2 (Auto/Dollar)","Apache FreeMarker2 (Auto/Dollar)"],loader:()=>__vitePreload(()=>import("./freemarker2-99c5ee5a.js"),[]).then(K=>K.TagAutoInterpolationDollar)});registerLanguage({id:"freemarker2.tag-auto.interpolation-bracket",aliases:["FreeMarker2 (Auto/Bracket)","Apache FreeMarker2 (Auto/Bracket)"],loader:()=>__vitePreload(()=>import("./freemarker2-99c5ee5a.js"),[]).then(K=>K.TagAutoInterpolationBracket)});registerLanguage({id:"go",extensions:[".go"],aliases:["Go"],loader:()=>__vitePreload(()=>import("./go-d4bfa116.js"),[])});registerLanguage({id:"graphql",extensions:[".graphql",".gql"],aliases:["GraphQL","graphql","gql"],mimetypes:["application/graphql"],loader:()=>__vitePreload(()=>import("./graphql-e5a73eb7.js"),[])});registerLanguage({id:"handlebars",extensions:[".handlebars",".hbs"],aliases:["Handlebars","handlebars","hbs"],mimetypes:["text/x-handlebars-template"],loader:()=>__vitePreload(()=>import("./handlebars-dc3262a8.js"),[])});registerLanguage({id:"hcl",extensions:[".tf",".tfvars",".hcl"],aliases:["Terraform","tf","HCL","hcl"],loader:()=>__vitePreload(()=>import("./hcl-8b69c899.js"),[])});registerLanguage({id:"html",extensions:[".html",".htm",".shtml",".xhtml",".mdoc",".jsp",".asp",".aspx",".jshtm"],aliases:["HTML","htm","html","xhtml"],mimetypes:["text/html","text/x-jshtm","text/template","text/ng-template"],loader:()=>__vitePreload(()=>import("./html-067a6e4e.js"),[])});registerLanguage({id:"ini",extensions:[".ini",".properties",".gitconfig"],filenames:["config",".gitattributes",".gitconfig",".editorconfig"],aliases:["Ini","ini"],loader:()=>__vitePreload(()=>import("./ini-83ae2a3a.js"),[])});registerLanguage({id:"java",extensions:[".java",".jav"],aliases:["Java","java"],mimetypes:["text/x-java-source","text/x-java"],loader:()=>__vitePreload(()=>import("./java-4806d9f5.js"),[])});registerLanguage({id:"javascript",extensions:[".js",".es6",".jsx",".mjs",".cjs"],firstLine:"^#!.*\\bnode",filenames:["jakefile"],aliases:["JavaScript","javascript","js"],mimetypes:["text/javascript"],loader:()=>__vitePreload(()=>import("./javascript-644d9db2.js"),["assets/javascript-644d9db2.js","assets/typescript-26201573.js"])});registerLanguage({id:"julia",extensions:[".jl"],aliases:["julia","Julia"],loader:()=>__vitePreload(()=>import("./julia-334b5fb9.js"),[])});registerLanguage({id:"kotlin",extensions:[".kt",".kts"],aliases:["Kotlin","kotlin"],mimetypes:["text/x-kotlin-source","text/x-kotlin"],loader:()=>__vitePreload(()=>import("./kotlin-ed14cfc6.js"),[])});registerLanguage({id:"less",extensions:[".less"],aliases:["Less","less"],mimetypes:["text/x-less","text/less"],loader:()=>__vitePreload(()=>import("./less-58d9b66b.js"),[])});registerLanguage({id:"lexon",extensions:[".lex"],aliases:["Lexon"],loader:()=>__vitePreload(()=>import("./lexon-8bf535e2.js"),[])});registerLanguage({id:"lua",extensions:[".lua"],aliases:["Lua","lua"],loader:()=>__vitePreload(()=>import("./lua-96829d0e.js"),[])});registerLanguage({id:"liquid",extensions:[".liquid",".html.liquid"],aliases:["Liquid","liquid"],mimetypes:["application/liquid"],loader:()=>__vitePreload(()=>import("./liquid-647240a9.js"),[])});registerLanguage({id:"m3",extensions:[".m3",".i3",".mg",".ig"],aliases:["Modula-3","Modula3","modula3","m3"],loader:()=>__vitePreload(()=>import("./m3-815f612a.js"),[])});registerLanguage({id:"markdown",extensions:[".md",".markdown",".mdown",".mkdn",".mkd",".mdwn",".mdtxt",".mdtext"],aliases:["Markdown","markdown"],loader:()=>__vitePreload(()=>import("./markdown-1cddbf33.js"),[])});registerLanguage({id:"mdx",extensions:[".mdx"],aliases:["MDX","mdx"],loader:()=>__vitePreload(()=>import("./mdx-daad12c2.js"),[])});registerLanguage({id:"mips",extensions:[".s"],aliases:["MIPS","MIPS-V"],mimetypes:["text/x-mips","text/mips","text/plaintext"],loader:()=>__vitePreload(()=>import("./mips-361940ec.js"),[])});registerLanguage({id:"msdax",extensions:[".dax",".msdax"],aliases:["DAX","MSDAX"],loader:()=>__vitePreload(()=>import("./msdax-b98f6248.js"),[])});registerLanguage({id:"mysql",extensions:[],aliases:["MySQL","mysql"],loader:()=>__vitePreload(()=>import("./mysql-b4d05809.js"),[])});registerLanguage({id:"objective-c",extensions:[".m"],aliases:["Objective-C"],loader:()=>__vitePreload(()=>import("./objective-c-64e6f89b.js"),[])});registerLanguage({id:"pascal",extensions:[".pas",".p",".pp"],aliases:["Pascal","pas"],mimetypes:["text/x-pascal-source","text/x-pascal"],loader:()=>__vitePreload(()=>import("./pascal-e1cbffd7.js"),[])});registerLanguage({id:"pascaligo",extensions:[".ligo"],aliases:["Pascaligo","ligo"],loader:()=>__vitePreload(()=>import("./pascaligo-013c6c0b.js"),[])});registerLanguage({id:"perl",extensions:[".pl",".pm"],aliases:["Perl","pl"],loader:()=>__vitePreload(()=>import("./perl-d9423546.js"),[])});registerLanguage({id:"pgsql",extensions:[],aliases:["PostgreSQL","postgres","pg","postgre"],loader:()=>__vitePreload(()=>import("./pgsql-423e077d.js"),[])});registerLanguage({id:"php",extensions:[".php",".php4",".php5",".phtml",".ctp"],aliases:["PHP","php"],mimetypes:["application/x-php"],loader:()=>__vitePreload(()=>import("./php-fb65b6b4.js"),[])});registerLanguage({id:"pla",extensions:[".pla"],loader:()=>__vitePreload(()=>import("./pla-09e93e1b.js"),[])});registerLanguage({id:"postiats",extensions:[".dats",".sats",".hats"],aliases:["ATS","ATS/Postiats"],loader:()=>__vitePreload(()=>import("./postiats-429bd8e8.js"),[])});registerLanguage({id:"powerquery",extensions:[".pq",".pqm"],aliases:["PQ","M","Power Query","Power Query M"],loader:()=>__vitePreload(()=>import("./powerquery-0470a494.js"),[])});registerLanguage({id:"powershell",extensions:[".ps1",".psm1",".psd1"],aliases:["PowerShell","powershell","ps","ps1"],loader:()=>__vitePreload(()=>import("./powershell-b433b622.js"),[])});registerLanguage({id:"proto",extensions:[".proto"],aliases:["protobuf","Protocol Buffers"],loader:()=>__vitePreload(()=>import("./protobuf-3e557056.js"),[])});registerLanguage({id:"pug",extensions:[".jade",".pug"],aliases:["Pug","Jade","jade"],loader:()=>__vitePreload(()=>import("./pug-b7980504.js"),[])});registerLanguage({id:"python",extensions:[".py",".rpy",".pyw",".cpy",".gyp",".gypi"],aliases:["Python","py"],firstLine:"^#!/.*\\bpython[0-9.-]*\\b",loader:()=>__vitePreload(()=>import("./python-630ac884.js"),[])});registerLanguage({id:"qsharp",extensions:[".qs"],aliases:["Q#","qsharp"],loader:()=>__vitePreload(()=>import("./qsharp-eed62033.js"),[])});registerLanguage({id:"r",extensions:[".r",".rhistory",".rmd",".rprofile",".rt"],aliases:["R","r"],loader:()=>__vitePreload(()=>import("./r-8ce27f67.js"),[])});registerLanguage({id:"razor",extensions:[".cshtml"],aliases:["Razor","razor"],mimetypes:["text/x-cshtml"],loader:()=>__vitePreload(()=>import("./razor-101f3304.js"),[])});registerLanguage({id:"redis",extensions:[".redis"],aliases:["redis"],loader:()=>__vitePreload(()=>import("./redis-aec7cdf4.js"),[])});registerLanguage({id:"redshift",extensions:[],aliases:["Redshift","redshift"],loader:()=>__vitePreload(()=>import("./redshift-7d933e7a.js"),[])});registerLanguage({id:"restructuredtext",extensions:[".rst"],aliases:["reStructuredText","restructuredtext"],loader:()=>__vitePreload(()=>import("./restructuredtext-a9e4c4cc.js"),[])});registerLanguage({id:"ruby",extensions:[".rb",".rbx",".rjs",".gemspec",".pp"],filenames:["rakefile","Gemfile"],aliases:["Ruby","rb"],loader:()=>__vitePreload(()=>import("./ruby-c9974e35.js"),[])});registerLanguage({id:"rust",extensions:[".rs",".rlib"],aliases:["Rust","rust"],loader:()=>__vitePreload(()=>import("./rust-9669a673.js"),[])});registerLanguage({id:"sb",extensions:[".sb"],aliases:["Small Basic","sb"],loader:()=>__vitePreload(()=>import("./sb-b221a0fc.js"),[])});registerLanguage({id:"scala",extensions:[".scala",".sc",".sbt"],aliases:["Scala","scala","SBT","Sbt","sbt","Dotty","dotty"],mimetypes:["text/x-scala-source","text/x-scala","text/x-sbt","text/x-dotty"],loader:()=>__vitePreload(()=>import("./scala-9222416a.js"),[])});registerLanguage({id:"scheme",extensions:[".scm",".ss",".sch",".rkt"],aliases:["scheme","Scheme"],loader:()=>__vitePreload(()=>import("./scheme-86110af1.js"),[])});registerLanguage({id:"scss",extensions:[".scss"],aliases:["Sass","sass","scss"],mimetypes:["text/x-scss","text/scss"],loader:()=>__vitePreload(()=>import("./scss-7da24d39.js"),[])});registerLanguage({id:"shell",extensions:[".sh",".bash"],aliases:["Shell","sh"],loader:()=>__vitePreload(()=>import("./shell-0ca4f4ad.js"),[])});registerLanguage({id:"sol",extensions:[".sol"],aliases:["sol","solidity","Solidity"],loader:()=>__vitePreload(()=>import("./solidity-0072896b.js"),[])});registerLanguage({id:"aes",extensions:[".aes"],aliases:["aes","sophia","Sophia"],loader:()=>__vitePreload(()=>import("./sophia-bc45fa87.js"),[])});registerLanguage({id:"sparql",extensions:[".rq"],aliases:["sparql","SPARQL"],loader:()=>__vitePreload(()=>import("./sparql-28fc150c.js"),[])});registerLanguage({id:"sql",extensions:[".sql"],aliases:["SQL"],loader:()=>__vitePreload(()=>import("./sql-96f7b353.js"),[])});registerLanguage({id:"st",extensions:[".st",".iecst",".iecplc",".lc3lib",".TcPOU",".TcDUT",".TcGVL",".TcIO"],aliases:["StructuredText","scl","stl"],loader:()=>__vitePreload(()=>import("./st-c45997f6.js"),[])});registerLanguage({id:"swift",aliases:["Swift","swift"],extensions:[".swift"],mimetypes:["text/swift"],loader:()=>__vitePreload(()=>import("./swift-3b85cc8e.js"),[])});registerLanguage({id:"systemverilog",extensions:[".sv",".svh"],aliases:["SV","sv","SystemVerilog","systemverilog"],loader:()=>__vitePreload(()=>import("./systemverilog-2ec460af.js"),[])});registerLanguage({id:"verilog",extensions:[".v",".vh"],aliases:["V","v","Verilog","verilog"],loader:()=>__vitePreload(()=>import("./systemverilog-2ec460af.js"),[])});registerLanguage({id:"tcl",extensions:[".tcl"],aliases:["tcl","Tcl","tcltk","TclTk","tcl/tk","Tcl/Tk"],loader:()=>__vitePreload(()=>import("./tcl-37e129b8.js"),[])});registerLanguage({id:"twig",extensions:[".twig"],aliases:["Twig","twig"],mimetypes:["text/x-twig"],loader:()=>__vitePreload(()=>import("./twig-1734ec31.js"),[])});registerLanguage({id:"typescript",extensions:[".ts",".tsx",".cts",".mts"],aliases:["TypeScript","ts","typescript"],mimetypes:["text/typescript"],loader:()=>__vitePreload(()=>import("./typescript-26201573.js"),[])});registerLanguage({id:"vb",extensions:[".vb"],aliases:["Visual Basic","vb"],loader:()=>__vitePreload(()=>import("./vb-77962f32.js"),[])});registerLanguage({id:"wgsl",extensions:[".wgsl"],aliases:["WebGPU Shading Language","WGSL","wgsl"],loader:()=>__vitePreload(()=>import("./wgsl-e67d25e4.js"),[])});registerLanguage({id:"xml",extensions:[".xml",".xsd",".dtd",".ascx",".csproj",".config",".props",".targets",".wxi",".wxl",".wxs",".xaml",".svg",".svgz",".opf",".xslt",".xsl"],firstLine:"(\\<\\?xml.*)|(\\<svg)|(\\<\\!doctype\\s+svg)",aliases:["XML","xml"],mimetypes:["text/xml","application/xml","application/xaml+xml","application/xml-dtd"],loader:()=>__vitePreload(()=>import("./xml-963729a7.js"),[])});registerLanguage({id:"yaml",extensions:[".yaml",".yml"],aliases:["YAML","yaml","YML","yml"],mimetypes:["application/x-yaml","text/x-yaml"],loader:()=>__vitePreload(()=>import("./yaml-fa38795d.js"),[])});/*!-----------------------------------------------------------------------------
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Version: 0.44.0(3e047efd345ff102c8c61b5398fb30845aaac166)
 * Released under the MIT license
 * https://github.com/microsoft/monaco-editor/blob/main/LICENSE.txt
 *-----------------------------------------------------------------------------*/var __defProp$3=Object.defineProperty,__getOwnPropDesc$3=Object.getOwnPropertyDescriptor,__getOwnPropNames$3=Object.getOwnPropertyNames,__hasOwnProp$3=Object.prototype.hasOwnProperty,__copyProps$3=(K,C,W,V)=>{if(C&&typeof C=="object"||typeof C=="function")for(let U of __getOwnPropNames$3(C))!__hasOwnProp$3.call(K,U)&&U!==W&&__defProp$3(K,U,{get:()=>C[U],enumerable:!(V=__getOwnPropDesc$3(C,U))||V.enumerable});return K},__reExport$3=(K,C,W)=>(__copyProps$3(K,C,"default"),W&&__copyProps$3(W,C,"default")),monaco_editor_core_exports$3={};__reExport$3(monaco_editor_core_exports$3,monaco_editor_core_star);var LanguageServiceDefaultsImpl$3=class{constructor(C,W,V){et(this,"_onDidChange",new monaco_editor_core_exports$3.Emitter);et(this,"_options");et(this,"_modeConfiguration");et(this,"_languageId");this._languageId=C,this.setOptions(W),this.setModeConfiguration(V)}get onDidChange(){return this._onDidChange.event}get languageId(){return this._languageId}get modeConfiguration(){return this._modeConfiguration}get diagnosticsOptions(){return this.options}get options(){return this._options}setOptions(C){this._options=C||Object.create(null),this._onDidChange.fire(this)}setDiagnosticsOptions(C){this.setOptions(C)}setModeConfiguration(C){this._modeConfiguration=C||Object.create(null),this._onDidChange.fire(this)}},optionsDefault$1={validate:!0,lint:{compatibleVendorPrefixes:"ignore",vendorPrefix:"warning",duplicateProperties:"warning",emptyRules:"warning",importStatement:"ignore",boxModel:"ignore",universalSelector:"ignore",zeroUnits:"ignore",fontFaceProperties:"warning",hexColorLength:"error",argumentsInColorFunction:"error",unknownProperties:"warning",ieHack:"ignore",unknownVendorSpecificProperties:"ignore",propertyIgnoredDueToDisplay:"warning",important:"ignore",float:"ignore",idSelector:"ignore"},data:{useDefaultDataProvider:!0},format:{newlineBetweenSelectors:!0,newlineBetweenRules:!0,spaceAroundSelectorSeparator:!1,braceStyle:"collapse",maxPreserveNewLines:void 0,preserveNewLines:!0}},modeConfigurationDefault$2={completionItems:!0,hovers:!0,documentSymbols:!0,definitions:!0,references:!0,documentHighlights:!0,rename:!0,colors:!0,foldingRanges:!0,diagnostics:!0,selectionRanges:!0,documentFormattingEdits:!0,documentRangeFormattingEdits:!0},cssDefaults=new LanguageServiceDefaultsImpl$3("css",optionsDefault$1,modeConfigurationDefault$2),scssDefaults=new LanguageServiceDefaultsImpl$3("scss",optionsDefault$1,modeConfigurationDefault$2),lessDefaults=new LanguageServiceDefaultsImpl$3("less",optionsDefault$1,modeConfigurationDefault$2);monaco_editor_core_exports$3.languages.css={cssDefaults,lessDefaults,scssDefaults};function getMode$3(){return __vitePreload(()=>import("./cssMode-4a74c8dc.js"),[])}monaco_editor_core_exports$3.languages.onLanguage("less",()=>{getMode$3().then(K=>K.setupMode(lessDefaults))});monaco_editor_core_exports$3.languages.onLanguage("scss",()=>{getMode$3().then(K=>K.setupMode(scssDefaults))});monaco_editor_core_exports$3.languages.onLanguage("css",()=>{getMode$3().then(K=>K.setupMode(cssDefaults))});/*!-----------------------------------------------------------------------------
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Version: 0.44.0(3e047efd345ff102c8c61b5398fb30845aaac166)
 * Released under the MIT license
 * https://github.com/microsoft/monaco-editor/blob/main/LICENSE.txt
 *-----------------------------------------------------------------------------*/var __defProp$2=Object.defineProperty,__getOwnPropDesc$2=Object.getOwnPropertyDescriptor,__getOwnPropNames$2=Object.getOwnPropertyNames,__hasOwnProp$2=Object.prototype.hasOwnProperty,__copyProps$2=(K,C,W,V)=>{if(C&&typeof C=="object"||typeof C=="function")for(let U of __getOwnPropNames$2(C))!__hasOwnProp$2.call(K,U)&&U!==W&&__defProp$2(K,U,{get:()=>C[U],enumerable:!(V=__getOwnPropDesc$2(C,U))||V.enumerable});return K},__reExport$2=(K,C,W)=>(__copyProps$2(K,C,"default"),W&&__copyProps$2(W,C,"default")),monaco_editor_core_exports$2={};__reExport$2(monaco_editor_core_exports$2,monaco_editor_core_star);var LanguageServiceDefaultsImpl$2=class{constructor(C,W,V){et(this,"_onDidChange",new monaco_editor_core_exports$2.Emitter);et(this,"_options");et(this,"_modeConfiguration");et(this,"_languageId");this._languageId=C,this.setOptions(W),this.setModeConfiguration(V)}get onDidChange(){return this._onDidChange.event}get languageId(){return this._languageId}get options(){return this._options}get modeConfiguration(){return this._modeConfiguration}setOptions(C){this._options=C||Object.create(null),this._onDidChange.fire(this)}setModeConfiguration(C){this._modeConfiguration=C||Object.create(null),this._onDidChange.fire(this)}},formatDefaults={tabSize:4,insertSpaces:!1,wrapLineLength:120,unformatted:'default": "a, abbr, acronym, b, bdo, big, br, button, cite, code, dfn, em, i, img, input, kbd, label, map, object, q, samp, select, small, span, strong, sub, sup, textarea, tt, var',contentUnformatted:"pre",indentInnerHtml:!1,preserveNewLines:!0,maxPreserveNewLines:void 0,indentHandlebars:!1,endWithNewline:!1,extraLiners:"head, body, /html",wrapAttributes:"auto"},optionsDefault={format:formatDefaults,suggest:{},data:{useDefaultDataProvider:!0}};function getConfigurationDefault(K){return{completionItems:!0,hovers:!0,documentSymbols:!0,links:!0,documentHighlights:!0,rename:!0,colors:!0,foldingRanges:!0,selectionRanges:!0,diagnostics:K===htmlLanguageId,documentFormattingEdits:K===htmlLanguageId,documentRangeFormattingEdits:K===htmlLanguageId}}var htmlLanguageId="html",handlebarsLanguageId="handlebars",razorLanguageId="razor",htmlLanguageService=registerHTMLLanguageService(htmlLanguageId,optionsDefault,getConfigurationDefault(htmlLanguageId)),htmlDefaults=htmlLanguageService.defaults,handlebarLanguageService=registerHTMLLanguageService(handlebarsLanguageId,optionsDefault,getConfigurationDefault(handlebarsLanguageId)),handlebarDefaults=handlebarLanguageService.defaults,razorLanguageService=registerHTMLLanguageService(razorLanguageId,optionsDefault,getConfigurationDefault(razorLanguageId)),razorDefaults=razorLanguageService.defaults;monaco_editor_core_exports$2.languages.html={htmlDefaults,razorDefaults,handlebarDefaults,htmlLanguageService,handlebarLanguageService,razorLanguageService,registerHTMLLanguageService};function getMode$2(){return __vitePreload(()=>import("./htmlMode-c7a1a70b.js"),[])}function registerHTMLLanguageService(K,C=optionsDefault,W=getConfigurationDefault(K)){const V=new LanguageServiceDefaultsImpl$2(K,C,W);let U;const G=monaco_editor_core_exports$2.languages.onLanguage(K,async()=>{U=(await getMode$2()).setupMode(V)});return{defaults:V,dispose(){G.dispose(),U==null||U.dispose(),U=void 0}}}/*!-----------------------------------------------------------------------------
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Version: 0.44.0(3e047efd345ff102c8c61b5398fb30845aaac166)
 * Released under the MIT license
 * https://github.com/microsoft/monaco-editor/blob/main/LICENSE.txt
 *-----------------------------------------------------------------------------*/var __defProp$1=Object.defineProperty,__getOwnPropDesc$1=Object.getOwnPropertyDescriptor,__getOwnPropNames$1=Object.getOwnPropertyNames,__hasOwnProp$1=Object.prototype.hasOwnProperty,__copyProps$1=(K,C,W,V)=>{if(C&&typeof C=="object"||typeof C=="function")for(let U of __getOwnPropNames$1(C))!__hasOwnProp$1.call(K,U)&&U!==W&&__defProp$1(K,U,{get:()=>C[U],enumerable:!(V=__getOwnPropDesc$1(C,U))||V.enumerable});return K},__reExport$1=(K,C,W)=>(__copyProps$1(K,C,"default"),W&&__copyProps$1(W,C,"default")),monaco_editor_core_exports$1={};__reExport$1(monaco_editor_core_exports$1,monaco_editor_core_star);var LanguageServiceDefaultsImpl$1=class{constructor(C,W,V){et(this,"_onDidChange",new monaco_editor_core_exports$1.Emitter);et(this,"_diagnosticsOptions");et(this,"_modeConfiguration");et(this,"_languageId");this._languageId=C,this.setDiagnosticsOptions(W),this.setModeConfiguration(V)}get onDidChange(){return this._onDidChange.event}get languageId(){return this._languageId}get modeConfiguration(){return this._modeConfiguration}get diagnosticsOptions(){return this._diagnosticsOptions}setDiagnosticsOptions(C){this._diagnosticsOptions=C||Object.create(null),this._onDidChange.fire(this)}setModeConfiguration(C){this._modeConfiguration=C||Object.create(null),this._onDidChange.fire(this)}},diagnosticDefault={validate:!0,allowComments:!0,schemas:[],enableSchemaRequest:!1,schemaRequest:"warning",schemaValidation:"warning",comments:"error",trailingCommas:"error"},modeConfigurationDefault$1={documentFormattingEdits:!0,documentRangeFormattingEdits:!0,completionItems:!0,hovers:!0,documentSymbols:!0,tokens:!0,colors:!0,foldingRanges:!0,diagnostics:!0,selectionRanges:!0},jsonDefaults=new LanguageServiceDefaultsImpl$1("json",diagnosticDefault,modeConfigurationDefault$1);monaco_editor_core_exports$1.languages.json={jsonDefaults};function getMode$1(){return __vitePreload(()=>import("./jsonMode-2b2671ea.js"),[])}monaco_editor_core_exports$1.languages.register({id:"json",extensions:[".json",".bowerrc",".jshintrc",".jscsrc",".eslintrc",".babelrc",".har"],aliases:["JSON","json"],mimetypes:["application/json"]});monaco_editor_core_exports$1.languages.onLanguage("json",()=>{getMode$1().then(K=>K.setupMode(jsonDefaults))});/*!-----------------------------------------------------------------------------
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Version: 0.44.0(3e047efd345ff102c8c61b5398fb30845aaac166)
 * Released under the MIT license
 * https://github.com/microsoft/monaco-editor/blob/main/LICENSE.txt
 *-----------------------------------------------------------------------------*/var __defProp=Object.defineProperty,__getOwnPropDesc=Object.getOwnPropertyDescriptor,__getOwnPropNames=Object.getOwnPropertyNames,__hasOwnProp=Object.prototype.hasOwnProperty,__copyProps=(K,C,W,V)=>{if(C&&typeof C=="object"||typeof C=="function")for(let U of __getOwnPropNames(C))!__hasOwnProp.call(K,U)&&U!==W&&__defProp(K,U,{get:()=>C[U],enumerable:!(V=__getOwnPropDesc(C,U))||V.enumerable});return K},__reExport=(K,C,W)=>(__copyProps(K,C,"default"),W&&__copyProps(W,C,"default")),typescriptVersion="5.0.2",monaco_editor_core_exports={};__reExport(monaco_editor_core_exports,monaco_editor_core_star);var ModuleKind=(K=>(K[K.None=0]="None",K[K.CommonJS=1]="CommonJS",K[K.AMD=2]="AMD",K[K.UMD=3]="UMD",K[K.System=4]="System",K[K.ES2015=5]="ES2015",K[K.ESNext=99]="ESNext",K))(ModuleKind||{}),JsxEmit=(K=>(K[K.None=0]="None",K[K.Preserve=1]="Preserve",K[K.React=2]="React",K[K.ReactNative=3]="ReactNative",K[K.ReactJSX=4]="ReactJSX",K[K.ReactJSXDev=5]="ReactJSXDev",K))(JsxEmit||{}),NewLineKind=(K=>(K[K.CarriageReturnLineFeed=0]="CarriageReturnLineFeed",K[K.LineFeed=1]="LineFeed",K))(NewLineKind||{}),ScriptTarget=(K=>(K[K.ES3=0]="ES3",K[K.ES5=1]="ES5",K[K.ES2015=2]="ES2015",K[K.ES2016=3]="ES2016",K[K.ES2017=4]="ES2017",K[K.ES2018=5]="ES2018",K[K.ES2019=6]="ES2019",K[K.ES2020=7]="ES2020",K[K.ESNext=99]="ESNext",K[K.JSON=100]="JSON",K[K.Latest=99]="Latest",K))(ScriptTarget||{}),ModuleResolutionKind=(K=>(K[K.Classic=1]="Classic",K[K.NodeJs=2]="NodeJs",K))(ModuleResolutionKind||{}),LanguageServiceDefaultsImpl=class{constructor(K,C,W,V,U){et(this,"_onDidChange",new monaco_editor_core_exports.Emitter);et(this,"_onDidExtraLibsChange",new monaco_editor_core_exports.Emitter);et(this,"_extraLibs");et(this,"_removedExtraLibs");et(this,"_eagerModelSync");et(this,"_compilerOptions");et(this,"_diagnosticsOptions");et(this,"_workerOptions");et(this,"_onDidExtraLibsChangeTimeout");et(this,"_inlayHintsOptions");et(this,"_modeConfiguration");this._extraLibs=Object.create(null),this._removedExtraLibs=Object.create(null),this._eagerModelSync=!1,this.setCompilerOptions(K),this.setDiagnosticsOptions(C),this.setWorkerOptions(W),this.setInlayHintsOptions(V),this.setModeConfiguration(U),this._onDidExtraLibsChangeTimeout=-1}get onDidChange(){return this._onDidChange.event}get onDidExtraLibsChange(){return this._onDidExtraLibsChange.event}get modeConfiguration(){return this._modeConfiguration}get workerOptions(){return this._workerOptions}get inlayHintsOptions(){return this._inlayHintsOptions}getExtraLibs(){return this._extraLibs}addExtraLib(K,C){let W;if(typeof C>"u"?W=`ts:extralib-${Math.random().toString(36).substring(2,15)}`:W=C,this._extraLibs[W]&&this._extraLibs[W].content===K)return{dispose:()=>{}};let V=1;return this._removedExtraLibs[W]&&(V=this._removedExtraLibs[W]+1),this._extraLibs[W]&&(V=this._extraLibs[W].version+1),this._extraLibs[W]={content:K,version:V},this._fireOnDidExtraLibsChangeSoon(),{dispose:()=>{let U=this._extraLibs[W];U&&U.version===V&&(delete this._extraLibs[W],this._removedExtraLibs[W]=V,this._fireOnDidExtraLibsChangeSoon())}}}setExtraLibs(K){for(const C in this._extraLibs)this._removedExtraLibs[C]=this._extraLibs[C].version;if(this._extraLibs=Object.create(null),K&&K.length>0)for(const C of K){const W=C.filePath||`ts:extralib-${Math.random().toString(36).substring(2,15)}`,V=C.content;let U=1;this._removedExtraLibs[W]&&(U=this._removedExtraLibs[W]+1),this._extraLibs[W]={content:V,version:U}}this._fireOnDidExtraLibsChangeSoon()}_fireOnDidExtraLibsChangeSoon(){this._onDidExtraLibsChangeTimeout===-1&&(this._onDidExtraLibsChangeTimeout=window.setTimeout(()=>{this._onDidExtraLibsChangeTimeout=-1,this._onDidExtraLibsChange.fire(void 0)},0))}getCompilerOptions(){return this._compilerOptions}setCompilerOptions(K){this._compilerOptions=K||Object.create(null),this._onDidChange.fire(void 0)}getDiagnosticsOptions(){return this._diagnosticsOptions}setDiagnosticsOptions(K){this._diagnosticsOptions=K||Object.create(null),this._onDidChange.fire(void 0)}setWorkerOptions(K){this._workerOptions=K||Object.create(null),this._onDidChange.fire(void 0)}setInlayHintsOptions(K){this._inlayHintsOptions=K||Object.create(null),this._onDidChange.fire(void 0)}setMaximumWorkerIdleTime(K){}setEagerModelSync(K){this._eagerModelSync=K}getEagerModelSync(){return this._eagerModelSync}setModeConfiguration(K){this._modeConfiguration=K||Object.create(null),this._onDidChange.fire(void 0)}},typescriptVersion2=typescriptVersion,modeConfigurationDefault={completionItems:!0,hovers:!0,documentSymbols:!0,definitions:!0,references:!0,documentHighlights:!0,rename:!0,diagnostics:!0,documentRangeFormattingEdits:!0,signatureHelp:!0,onTypeFormattingEdits:!0,codeActions:!0,inlayHints:!0},typescriptDefaults=new LanguageServiceDefaultsImpl({allowNonTsExtensions:!0,target:99},{noSemanticValidation:!1,noSyntaxValidation:!1,onlyVisible:!1},{},{},modeConfigurationDefault),javascriptDefaults=new LanguageServiceDefaultsImpl({allowNonTsExtensions:!0,allowJs:!0,target:99},{noSemanticValidation:!0,noSyntaxValidation:!1,onlyVisible:!1},{},{},modeConfigurationDefault),getTypeScriptWorker=()=>getMode().then(K=>K.getTypeScriptWorker()),getJavaScriptWorker=()=>getMode().then(K=>K.getJavaScriptWorker());monaco_editor_core_exports.languages.typescript={ModuleKind,JsxEmit,NewLineKind,ScriptTarget,ModuleResolutionKind,typescriptVersion:typescriptVersion2,typescriptDefaults,javascriptDefaults,getTypeScriptWorker,getJavaScriptWorker};function getMode(){return __vitePreload(()=>import("./tsMode-92892650.js"),[])}monaco_editor_core_exports.languages.onLanguage("typescript",()=>getMode().then(K=>K.setupTypeScript(typescriptDefaults)));monaco_editor_core_exports.languages.onLanguage("javascript",()=>getMode().then(K=>K.setupJavaScript(javascriptDefaults)));class ToggleCollapseUnchangedRegions extends Action2{constructor(){super({id:"diffEditor.toggleCollapseUnchangedRegions",title:{value:localize("toggleCollapseUnchangedRegions","Toggle Collapse Unchanged Regions"),original:"Toggle Collapse Unchanged Regions"},icon:Codicon.map,toggled:ContextKeyExpr.has("config.diffEditor.hideUnchangedRegions.enabled"),precondition:ContextKeyExpr.has("isInDiffEditor"),menu:{when:ContextKeyExpr.has("isInDiffEditor"),id:MenuId.EditorTitle,order:22,group:"navigation"}})}run(C,...W){const V=C.get(IConfigurationService),U=!V.getValue("diffEditor.hideUnchangedRegions.enabled");V.updateValue("diffEditor.hideUnchangedRegions.enabled",U)}}registerAction2(ToggleCollapseUnchangedRegions);class ToggleShowMovedCodeBlocks extends Action2{constructor(){super({id:"diffEditor.toggleShowMovedCodeBlocks",title:{value:localize("toggleShowMovedCodeBlocks","Toggle Show Moved Code Blocks"),original:"Toggle Show Moved Code Blocks"},precondition:ContextKeyExpr.has("isInDiffEditor")})}run(C,...W){const V=C.get(IConfigurationService),U=!V.getValue("diffEditor.experimental.showMoves");V.updateValue("diffEditor.experimental.showMoves",U)}}registerAction2(ToggleShowMovedCodeBlocks);class ToggleUseInlineViewWhenSpaceIsLimited extends Action2{constructor(){super({id:"diffEditor.toggleUseInlineViewWhenSpaceIsLimited",title:{value:localize("toggleUseInlineViewWhenSpaceIsLimited","Toggle Use Inline View When Space Is Limited"),original:"Toggle Use Inline View When Space Is Limited"},precondition:ContextKeyExpr.has("isInDiffEditor")})}run(C,...W){const V=C.get(IConfigurationService),U=!V.getValue("diffEditor.useInlineViewWhenSpaceIsLimited");V.updateValue("diffEditor.useInlineViewWhenSpaceIsLimited",U)}}registerAction2(ToggleUseInlineViewWhenSpaceIsLimited);MenuRegistry.appendMenuItem(MenuId.EditorTitle,{command:{id:new ToggleUseInlineViewWhenSpaceIsLimited().desc.id,title:localize("useInlineViewWhenSpaceIsLimited","Use Inline View When Space Is Limited"),toggled:ContextKeyExpr.has("config.diffEditor.useInlineViewWhenSpaceIsLimited"),precondition:ContextKeyExpr.has("isInDiffEditor")},order:11,group:"1_diff",when:ContextKeyExpr.and(EditorContextKeys.diffEditorRenderSideBySideInlineBreakpointReached,ContextKeyExpr.has("isInDiffEditor"))});MenuRegistry.appendMenuItem(MenuId.EditorTitle,{command:{id:new ToggleShowMovedCodeBlocks().desc.id,title:localize("showMoves","Show Moved Code Blocks"),icon:Codicon.move,toggled:ContextKeyEqualsExpr.create("config.diffEditor.experimental.showMoves",!0),precondition:ContextKeyExpr.has("isInDiffEditor")},order:10,group:"1_diff",when:ContextKeyExpr.has("isInDiffEditor")});const diffEditorCategory={value:localize("diffEditor","Diff Editor"),original:"Diff Editor"};class SwitchSide extends EditorAction2{constructor(){super({id:"diffEditor.switchSide",title:{value:localize("switchSide","Switch Side"),original:"Switch Side"},icon:Codicon.arrowSwap,precondition:ContextKeyExpr.has("isInDiffEditor"),f1:!0,category:diffEditorCategory})}runEditorCommand(C,W,V){const U=findFocusedDiffEditor(C);if(U instanceof DiffEditorWidget){if(V&&V.dryRun)return{destinationSelection:U.mapToOtherSide().destinationSelection};U.switchSide()}}}registerAction2(SwitchSide);class ExitCompareMove extends EditorAction2{constructor(){super({id:"diffEditor.exitCompareMove",title:{value:localize("exitCompareMove","Exit Compare Move"),original:"Exit Compare Move"},icon:Codicon.close,precondition:EditorContextKeys.comparingMovedCode,f1:!1,category:diffEditorCategory,keybinding:{weight:1e4,primary:9}})}runEditorCommand(C,W,...V){const U=findFocusedDiffEditor(C);U instanceof DiffEditorWidget&&U.exitCompareMove()}}registerAction2(ExitCompareMove);class CollapseAllUnchangedRegions extends EditorAction2{constructor(){super({id:"diffEditor.collapseAllUnchangedRegions",title:{value:localize("collapseAllUnchangedRegions","Collapse All Unchanged Regions"),original:"Collapse All Unchanged Regions"},icon:Codicon.fold,precondition:ContextKeyExpr.has("isInDiffEditor"),f1:!0,category:diffEditorCategory})}runEditorCommand(C,W,...V){const U=findFocusedDiffEditor(C);U instanceof DiffEditorWidget&&U.collapseAllUnchangedRegions()}}registerAction2(CollapseAllUnchangedRegions);class ShowAllUnchangedRegions extends EditorAction2{constructor(){super({id:"diffEditor.showAllUnchangedRegions",title:{value:localize("showAllUnchangedRegions","Show All Unchanged Regions"),original:"Show All Unchanged Regions"},icon:Codicon.unfold,precondition:ContextKeyExpr.has("isInDiffEditor"),f1:!0,category:diffEditorCategory})}runEditorCommand(C,W,...V){const U=findFocusedDiffEditor(C);U instanceof DiffEditorWidget&&U.showAllUnchangedRegions()}}registerAction2(ShowAllUnchangedRegions);const accessibleDiffViewerCategory={value:localize("accessibleDiffViewer","Accessible Diff Viewer"),original:"Accessible Diff Viewer"};class AccessibleDiffViewerNext extends Action2{constructor(){super({id:AccessibleDiffViewerNext.id,title:{value:localize("editor.action.accessibleDiffViewer.next","Go to Next Difference"),original:"Go to Next Difference"},category:accessibleDiffViewerCategory,precondition:ContextKeyExpr.has("isInDiffEditor"),keybinding:{primary:65,weight:100},f1:!0})}run(C){const W=findFocusedDiffEditor(C);W==null||W.accessibleDiffViewerNext()}}AccessibleDiffViewerNext.id="editor.action.accessibleDiffViewer.next";MenuRegistry.appendMenuItem(MenuId.EditorTitle,{command:{id:AccessibleDiffViewerNext.id,title:localize("Open Accessible Diff Viewer","Open Accessible Diff Viewer"),precondition:ContextKeyExpr.has("isInDiffEditor")},order:10,group:"2_diff",when:ContextKeyExpr.and(EditorContextKeys.accessibleDiffViewerVisible.negate(),ContextKeyExpr.has("isInDiffEditor"))});class AccessibleDiffViewerPrev extends Action2{constructor(){super({id:AccessibleDiffViewerPrev.id,title:{value:localize("editor.action.accessibleDiffViewer.prev","Go to Previous Difference"),original:"Go to Previous Difference"},category:accessibleDiffViewerCategory,precondition:ContextKeyExpr.has("isInDiffEditor"),keybinding:{primary:1089,weight:100},f1:!0})}run(C){const W=findFocusedDiffEditor(C);W==null||W.accessibleDiffViewerPrev()}}AccessibleDiffViewerPrev.id="editor.action.accessibleDiffViewer.prev";function findFocusedDiffEditor(K){var C;const W=K.get(ICodeEditorService),V=W.listDiffEditors(),U=(C=W.getFocusedCodeEditor())!==null&&C!==void 0?C:W.getActiveCodeEditor();if(!U)return null;for(let Z=0,X=V.length;Z<X;Z++){const Q=V[Z];if(Q.getModifiedEditor().getId()===U.getId()||Q.getOriginalEditor().getId()===U.getId())return Q}const G=getActiveElement();if(G)for(const Z of V){const X=Z.getContainerDomNode();if(isElementOrParentOf(X,G))return Z}return null}function isElementOrParentOf(K,C){let W=C;for(;W;){if(W===K)return!0;W=W.parentElement}return!1}CommandsRegistry.registerCommandAlias("editor.action.diffReview.next",AccessibleDiffViewerNext.id);registerAction2(AccessibleDiffViewerNext);CommandsRegistry.registerCommandAlias("editor.action.diffReview.prev",AccessibleDiffViewerPrev.id);registerAction2(AccessibleDiffViewerPrev);const anchorSelect="";var __decorate$1p=globalThis&&globalThis.__decorate||function(K,C,W,V){var U=arguments.length,G=U<3?C:V===null?V=Object.getOwnPropertyDescriptor(C,W):V,Z;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")G=Reflect.decorate(K,C,W,V);else for(var X=K.length-1;X>=0;X--)(Z=K[X])&&(G=(U<3?Z(G):U>3?Z(C,W,G):Z(C,W))||G);return U>3&&G&&Object.defineProperty(C,W,G),G},__param$1p=globalThis&&globalThis.__param||function(K,C){return function(W,V){C(W,V,K)}},__awaiter$16=globalThis&&globalThis.__awaiter||function(K,C,W,V){function U(G){return G instanceof W?G:new W(function(Z){Z(G)})}return new(W||(W=Promise))(function(G,Z){function X(ee){try{J(V.next(ee))}catch(te){Z(te)}}function Q(ee){try{J(V.throw(ee))}catch(te){Z(te)}}function J(ee){ee.done?G(ee.value):U(ee.value).then(X,Q)}J((V=V.apply(K,C||[])).next())})},SelectionAnchorController_1;const SelectionAnchorSet=new RawContextKey("selectionAnchorSet",!1);let SelectionAnchorController=SelectionAnchorController_1=class{static get(C){return C.getContribution(SelectionAnchorController_1.ID)}constructor(C,W){this.editor=C,this.selectionAnchorSetContextKey=SelectionAnchorSet.bindTo(W),this.modelChangeListener=C.onDidChangeModel(()=>this.selectionAnchorSetContextKey.reset())}setSelectionAnchor(){if(this.editor.hasModel()){const C=this.editor.getPosition();this.editor.changeDecorations(W=>{this.decorationId&&W.removeDecoration(this.decorationId),this.decorationId=W.addDecoration(Selection$1.fromPositions(C,C),{description:"selection-anchor",stickiness:1,hoverMessage:new MarkdownString().appendText(localize("selectionAnchor","Selection Anchor")),className:"selection-anchor"})}),this.selectionAnchorSetContextKey.set(!!this.decorationId),alert(localize("anchorSet","Anchor set at {0}:{1}",C.lineNumber,C.column))}}goToSelectionAnchor(){if(this.editor.hasModel()&&this.decorationId){const C=this.editor.getModel().getDecorationRange(this.decorationId);C&&this.editor.setPosition(C.getStartPosition())}}selectFromAnchorToCursor(){if(this.editor.hasModel()&&this.decorationId){const C=this.editor.getModel().getDecorationRange(this.decorationId);if(C){const W=this.editor.getPosition();this.editor.setSelection(Selection$1.fromPositions(C.getStartPosition(),W)),this.cancelSelectionAnchor()}}}cancelSelectionAnchor(){if(this.decorationId){const C=this.decorationId;this.editor.changeDecorations(W=>{W.removeDecoration(C),this.decorationId=void 0}),this.selectionAnchorSetContextKey.set(!1)}}dispose(){this.cancelSelectionAnchor(),this.modelChangeListener.dispose()}};SelectionAnchorController.ID="editor.contrib.selectionAnchorController";SelectionAnchorController=SelectionAnchorController_1=__decorate$1p([__param$1p(1,IContextKeyService)],SelectionAnchorController);class SetSelectionAnchor extends EditorAction{constructor(){super({id:"editor.action.setSelectionAnchor",label:localize("setSelectionAnchor","Set Selection Anchor"),alias:"Set Selection Anchor",precondition:void 0,kbOpts:{kbExpr:EditorContextKeys.editorTextFocus,primary:KeyChord(2089,2080),weight:100}})}run(C,W){var V;return __awaiter$16(this,void 0,void 0,function*(){(V=SelectionAnchorController.get(W))===null||V===void 0||V.setSelectionAnchor()})}}class GoToSelectionAnchor extends EditorAction{constructor(){super({id:"editor.action.goToSelectionAnchor",label:localize("goToSelectionAnchor","Go to Selection Anchor"),alias:"Go to Selection Anchor",precondition:SelectionAnchorSet})}run(C,W){var V;return __awaiter$16(this,void 0,void 0,function*(){(V=SelectionAnchorController.get(W))===null||V===void 0||V.goToSelectionAnchor()})}}class SelectFromAnchorToCursor extends EditorAction{constructor(){super({id:"editor.action.selectFromAnchorToCursor",label:localize("selectFromAnchorToCursor","Select from Anchor to Cursor"),alias:"Select from Anchor to Cursor",precondition:SelectionAnchorSet,kbOpts:{kbExpr:EditorContextKeys.editorTextFocus,primary:KeyChord(2089,2089),weight:100}})}run(C,W){var V;return __awaiter$16(this,void 0,void 0,function*(){(V=SelectionAnchorController.get(W))===null||V===void 0||V.selectFromAnchorToCursor()})}}class CancelSelectionAnchor extends EditorAction{constructor(){super({id:"editor.action.cancelSelectionAnchor",label:localize("cancelSelectionAnchor","Cancel Selection Anchor"),alias:"Cancel Selection Anchor",precondition:SelectionAnchorSet,kbOpts:{kbExpr:EditorContextKeys.editorTextFocus,primary:9,weight:100}})}run(C,W){var V;return __awaiter$16(this,void 0,void 0,function*(){(V=SelectionAnchorController.get(W))===null||V===void 0||V.cancelSelectionAnchor()})}}registerEditorContribution(SelectionAnchorController.ID,SelectionAnchorController,4);registerEditorAction(SetSelectionAnchor);registerEditorAction(GoToSelectionAnchor);registerEditorAction(SelectFromAnchorToCursor);registerEditorAction(CancelSelectionAnchor);const bracketMatching="",overviewRulerBracketMatchForeground=registerColor("editorOverviewRuler.bracketMatchForeground",{dark:"#A0A0A0",light:"#A0A0A0",hcDark:"#A0A0A0",hcLight:"#A0A0A0"},localize("overviewRulerBracketMatchForeground","Overview ruler marker color for matching brackets."));class JumpToBracketAction extends EditorAction{constructor(){super({id:"editor.action.jumpToBracket",label:localize("smartSelect.jumpBracket","Go to Bracket"),alias:"Go to Bracket",precondition:void 0,kbOpts:{kbExpr:EditorContextKeys.editorTextFocus,primary:3165,weight:100}})}run(C,W){var V;(V=BracketMatchingController.get(W))===null||V===void 0||V.jumpToBracket()}}class SelectToBracketAction extends EditorAction{constructor(){super({id:"editor.action.selectToBracket",label:localize("smartSelect.selectToBracket","Select to Bracket"),alias:"Select to Bracket",precondition:void 0,description:{description:"Select to Bracket",args:[{name:"args",schema:{type:"object",properties:{selectBrackets:{type:"boolean",default:!0}}}}]}})}run(C,W,V){var U;let G=!0;V&&V.selectBrackets===!1&&(G=!1),(U=BracketMatchingController.get(W))===null||U===void 0||U.selectToBracket(G)}}class RemoveBracketsAction extends EditorAction{constructor(){super({id:"editor.action.removeBrackets",label:localize("smartSelect.removeBrackets","Remove Brackets"),alias:"Remove Brackets",precondition:void 0,kbOpts:{kbExpr:EditorContextKeys.editorTextFocus,primary:2561,weight:100}})}run(C,W){var V;(V=BracketMatchingController.get(W))===null||V===void 0||V.removeBrackets(this.id)}}class BracketsData{constructor(C,W,V){this.position=C,this.brackets=W,this.options=V}}class BracketMatchingController extends Disposable{static get(C){return C.getContribution(BracketMatchingController.ID)}constructor(C){super(),this._editor=C,this._lastBracketsData=[],this._lastVersionId=0,this._decorations=this._editor.createDecorationsCollection(),this._updateBracketsSoon=this._register(new RunOnceScheduler(()=>this._updateBrackets(),50)),this._matchBrackets=this._editor.getOption(71),this._updateBracketsSoon.schedule(),this._register(C.onDidChangeCursorPosition(W=>{this._matchBrackets!=="never"&&this._updateBracketsSoon.schedule()})),this._register(C.onDidChangeModelContent(W=>{this._updateBracketsSoon.schedule()})),this._register(C.onDidChangeModel(W=>{this._lastBracketsData=[],this._updateBracketsSoon.schedule()})),this._register(C.onDidChangeModelLanguageConfiguration(W=>{this._lastBracketsData=[],this._updateBracketsSoon.schedule()})),this._register(C.onDidChangeConfiguration(W=>{W.hasChanged(71)&&(this._matchBrackets=this._editor.getOption(71),this._decorations.clear(),this._lastBracketsData=[],this._lastVersionId=0,this._updateBracketsSoon.schedule())})),this._register(C.onDidBlurEditorWidget(()=>{this._updateBracketsSoon.schedule()})),this._register(C.onDidFocusEditorWidget(()=>{this._updateBracketsSoon.schedule()}))}jumpToBracket(){if(!this._editor.hasModel())return;const C=this._editor.getModel(),W=this._editor.getSelections().map(V=>{const U=V.getStartPosition(),G=C.bracketPairs.matchBracket(U);let Z=null;if(G)G[0].containsPosition(U)&&!G[1].containsPosition(U)?Z=G[1].getStartPosition():G[1].containsPosition(U)&&(Z=G[0].getStartPosition());else{const X=C.bracketPairs.findEnclosingBrackets(U);if(X)Z=X[1].getStartPosition();else{const Q=C.bracketPairs.findNextBracket(U);Q&&Q.range&&(Z=Q.range.getStartPosition())}}return Z?new Selection$1(Z.lineNumber,Z.column,Z.lineNumber,Z.column):new Selection$1(U.lineNumber,U.column,U.lineNumber,U.column)});this._editor.setSelections(W),this._editor.revealRange(W[0])}selectToBracket(C){if(!this._editor.hasModel())return;const W=this._editor.getModel(),V=[];this._editor.getSelections().forEach(U=>{const G=U.getStartPosition();let Z=W.bracketPairs.matchBracket(G);if(!Z&&(Z=W.bracketPairs.findEnclosingBrackets(G),!Z)){const J=W.bracketPairs.findNextBracket(G);J&&J.range&&(Z=W.bracketPairs.matchBracket(J.range.getStartPosition()))}let X=null,Q=null;if(Z){Z.sort(Range$2.compareRangesUsingStarts);const[J,ee]=Z;if(X=C?J.getStartPosition():J.getEndPosition(),Q=C?ee.getEndPosition():ee.getStartPosition(),ee.containsPosition(G)){const te=X;X=Q,Q=te}}X&&Q&&V.push(new Selection$1(X.lineNumber,X.column,Q.lineNumber,Q.column))}),V.length>0&&(this._editor.setSelections(V),this._editor.revealRange(V[0]))}removeBrackets(C){if(!this._editor.hasModel())return;const W=this._editor.getModel();this._editor.getSelections().forEach(V=>{const U=V.getPosition();let G=W.bracketPairs.matchBracket(U);G||(G=W.bracketPairs.findEnclosingBrackets(U)),G&&(this._editor.pushUndoStop(),this._editor.executeEdits(C,[{range:G[0],text:""},{range:G[1],text:""}]),this._editor.pushUndoStop())})}_updateBrackets(){if(this._matchBrackets==="never")return;this._recomputeBrackets();const C=[];let W=0;for(const V of this._lastBracketsData){const U=V.brackets;U&&(C[W++]={range:U[0],options:V.options},C[W++]={range:U[1],options:V.options})}this._decorations.set(C)}_recomputeBrackets(){if(!this._editor.hasModel()||!this._editor.hasWidgetFocus()){this._lastBracketsData=[],this._lastVersionId=0;return}const C=this._editor.getSelections();if(C.length>100){this._lastBracketsData=[],this._lastVersionId=0;return}const W=this._editor.getModel(),V=W.getVersionId();let U=[];this._lastVersionId===V&&(U=this._lastBracketsData);const G=[];let Z=0;for(let te=0,ie=C.length;te<ie;te++){const ne=C[te];ne.isEmpty()&&(G[Z++]=ne.getStartPosition())}G.length>1&&G.sort(Position$1.compare);const X=[];let Q=0,J=0;const ee=U.length;for(let te=0,ie=G.length;te<ie;te++){const ne=G[te];for(;J<ee&&U[J].position.isBefore(ne);)J++;if(J<ee&&U[J].position.equals(ne))X[Q++]=U[J];else{let oe=W.bracketPairs.matchBracket(ne,20),re=BracketMatchingController._DECORATION_OPTIONS_WITH_OVERVIEW_RULER;!oe&&this._matchBrackets==="always"&&(oe=W.bracketPairs.findEnclosingBrackets(ne,20),re=BracketMatchingController._DECORATION_OPTIONS_WITHOUT_OVERVIEW_RULER),X[Q++]=new BracketsData(ne,oe,re)}}this._lastBracketsData=X,this._lastVersionId=V}}BracketMatchingController.ID="editor.contrib.bracketMatchingController";BracketMatchingController._DECORATION_OPTIONS_WITH_OVERVIEW_RULER=ModelDecorationOptions.register({description:"bracket-match-overview",stickiness:1,className:"bracket-match",overviewRuler:{color:themeColorFromId(overviewRulerBracketMatchForeground),position:OverviewRulerLane.Center}});BracketMatchingController._DECORATION_OPTIONS_WITHOUT_OVERVIEW_RULER=ModelDecorationOptions.register({description:"bracket-match-no-overview",stickiness:1,className:"bracket-match"});registerEditorContribution(BracketMatchingController.ID,BracketMatchingController,1);registerEditorAction(SelectToBracketAction);registerEditorAction(JumpToBracketAction);registerEditorAction(RemoveBracketsAction);MenuRegistry.appendMenuItem(MenuId.MenubarGoMenu,{group:"5_infile_nav",command:{id:"editor.action.jumpToBracket",title:localize({key:"miGoToBracket",comment:["&& denotes a mnemonic"]},"Go to &&Bracket")},order:2});class MoveCaretCommand{constructor(C,W){this._selection=C,this._isMovingLeft=W}getEditOperations(C,W){if(this._selection.startLineNumber!==this._selection.endLineNumber||this._selection.isEmpty())return;const V=this._selection.startLineNumber,U=this._selection.startColumn,G=this._selection.endColumn;if(!(this._isMovingLeft&&U===1)&&!(!this._isMovingLeft&&G===C.getLineMaxColumn(V)))if(this._isMovingLeft){const Z=new Range$2(V,U-1,V,U),X=C.getValueInRange(Z);W.addEditOperation(Z,null),W.addEditOperation(new Range$2(V,G,V,G),X)}else{const Z=new Range$2(V,G,V,G+1),X=C.getValueInRange(Z);W.addEditOperation(Z,null),W.addEditOperation(new Range$2(V,U,V,U),X)}}computeCursorState(C,W){return this._isMovingLeft?new Selection$1(this._selection.startLineNumber,this._selection.startColumn-1,this._selection.endLineNumber,this._selection.endColumn-1):new Selection$1(this._selection.startLineNumber,this._selection.startColumn+1,this._selection.endLineNumber,this._selection.endColumn+1)}}class MoveCaretAction extends EditorAction{constructor(C,W){super(W),this.left=C}run(C,W){if(!W.hasModel())return;const V=[],U=W.getSelections();for(const G of U)V.push(new MoveCaretCommand(G,this.left));W.pushUndoStop(),W.executeCommands(this.id,V),W.pushUndoStop()}}class MoveCaretLeftAction extends MoveCaretAction{constructor(){super(!0,{id:"editor.action.moveCarretLeftAction",label:localize("caret.moveLeft","Move Selected Text Left"),alias:"Move Selected Text Left",precondition:EditorContextKeys.writable})}}class MoveCaretRightAction extends MoveCaretAction{constructor(){super(!1,{id:"editor.action.moveCarretRightAction",label:localize("caret.moveRight","Move Selected Text Right"),alias:"Move Selected Text Right",precondition:EditorContextKeys.writable})}}registerEditorAction(MoveCaretLeftAction);registerEditorAction(MoveCaretRightAction);class TransposeLettersAction extends EditorAction{constructor(){super({id:"editor.action.transposeLetters",label:localize("transposeLetters.label","Transpose Letters"),alias:"Transpose Letters",precondition:EditorContextKeys.writable,kbOpts:{kbExpr:EditorContextKeys.textInputFocus,primary:0,mac:{primary:306},weight:100}})}run(C,W){if(!W.hasModel())return;const V=W.getModel(),U=[],G=W.getSelections();for(const Z of G){if(!Z.isEmpty())continue;const X=Z.startLineNumber,Q=Z.startColumn,J=V.getLineMaxColumn(X);if(X===1&&(Q===1||Q===2&&J===2))continue;const ee=Q===J?Z.getPosition():MoveOperations.rightPosition(V,Z.getPosition().lineNumber,Z.getPosition().column),te=MoveOperations.leftPosition(V,ee),ie=MoveOperations.leftPosition(V,te),ne=V.getValueInRange(Range$2.fromPositions(ie,te)),oe=V.getValueInRange(Range$2.fromPositions(te,ee)),re=Range$2.fromPositions(ie,ee);U.push(new ReplaceCommand(re,oe+ne))}U.length>0&&(W.pushUndoStop(),W.executeCommands(this.id,U),W.pushUndoStop())}}registerEditorAction(TransposeLettersAction);var __awaiter$15=globalThis&&globalThis.__awaiter||function(K,C,W,V){function U(G){return G instanceof W?G:new W(function(Z){Z(G)})}return new(W||(W=Promise))(function(G,Z){function X(ee){try{J(V.next(ee))}catch(te){Z(te)}}function Q(ee){try{J(V.throw(ee))}catch(te){Z(te)}}function J(ee){ee.done?G(ee.value):U(ee.value).then(X,Q)}J((V=V.apply(K,C||[])).next())})};const CLIPBOARD_CONTEXT_MENU_GROUP="9_cutcopypaste",supportsCut=isNative||document.queryCommandSupported("cut"),supportsCopy=isNative||document.queryCommandSupported("copy"),supportsPaste=typeof navigator.clipboard>"u"||isFirefox?document.queryCommandSupported("paste"):!0;function registerCommand(K){return K.register(),K}const CutAction=supportsCut?registerCommand(new MultiCommand({id:"editor.action.clipboardCutAction",precondition:void 0,kbOpts:isNative?{primary:2102,win:{primary:2102,secondary:[1044]},weight:100}:void 0,menuOpts:[{menuId:MenuId.MenubarEditMenu,group:"2_ccp",title:localize({key:"miCut",comment:["&& denotes a mnemonic"]},"Cu&&t"),order:1},{menuId:MenuId.EditorContext,group:CLIPBOARD_CONTEXT_MENU_GROUP,title:localize("actions.clipboard.cutLabel","Cut"),when:EditorContextKeys.writable,order:1},{menuId:MenuId.CommandPalette,group:"",title:localize("actions.clipboard.cutLabel","Cut"),order:1},{menuId:MenuId.SimpleEditorContext,group:CLIPBOARD_CONTEXT_MENU_GROUP,title:localize("actions.clipboard.cutLabel","Cut"),when:EditorContextKeys.writable,order:1}]})):void 0,CopyAction=supportsCopy?registerCommand(new MultiCommand({id:"editor.action.clipboardCopyAction",precondition:void 0,kbOpts:isNative?{primary:2081,win:{primary:2081,secondary:[2067]},weight:100}:void 0,menuOpts:[{menuId:MenuId.MenubarEditMenu,group:"2_ccp",title:localize({key:"miCopy",comment:["&& denotes a mnemonic"]},"&&Copy"),order:2},{menuId:MenuId.EditorContext,group:CLIPBOARD_CONTEXT_MENU_GROUP,title:localize("actions.clipboard.copyLabel","Copy"),order:2},{menuId:MenuId.CommandPalette,group:"",title:localize("actions.clipboard.copyLabel","Copy"),order:1},{menuId:MenuId.SimpleEditorContext,group:CLIPBOARD_CONTEXT_MENU_GROUP,title:localize("actions.clipboard.copyLabel","Copy"),order:2}]})):void 0;MenuRegistry.appendMenuItem(MenuId.MenubarEditMenu,{submenu:MenuId.MenubarCopy,title:{value:localize("copy as","Copy As"),original:"Copy As"},group:"2_ccp",order:3});MenuRegistry.appendMenuItem(MenuId.EditorContext,{submenu:MenuId.EditorContextCopy,title:{value:localize("copy as","Copy As"),original:"Copy As"},group:CLIPBOARD_CONTEXT_MENU_GROUP,order:3});MenuRegistry.appendMenuItem(MenuId.EditorContext,{submenu:MenuId.EditorContextShare,title:{value:localize("share","Share"),original:"Share"},group:"11_share",order:-1,when:ContextKeyExpr.and(ContextKeyExpr.notEquals("resourceScheme","output"),EditorContextKeys.editorTextFocus)});MenuRegistry.appendMenuItem(MenuId.EditorTitleContext,{submenu:MenuId.EditorTitleContextShare,title:{value:localize("share","Share"),original:"Share"},group:"11_share",order:-1});MenuRegistry.appendMenuItem(MenuId.ExplorerContext,{submenu:MenuId.ExplorerContextShare,title:{value:localize("share","Share"),original:"Share"},group:"11_share",order:-1});const PasteAction=supportsPaste?registerCommand(new MultiCommand({id:"editor.action.clipboardPasteAction",precondition:void 0,kbOpts:isNative?{primary:2100,win:{primary:2100,secondary:[1043]},linux:{primary:2100,secondary:[1043]},weight:100}:void 0,menuOpts:[{menuId:MenuId.MenubarEditMenu,group:"2_ccp",title:localize({key:"miPaste",comment:["&& denotes a mnemonic"]},"&&Paste"),order:4},{menuId:MenuId.EditorContext,group:CLIPBOARD_CONTEXT_MENU_GROUP,title:localize("actions.clipboard.pasteLabel","Paste"),when:EditorContextKeys.writable,order:4},{menuId:MenuId.CommandPalette,group:"",title:localize("actions.clipboard.pasteLabel","Paste"),order:1},{menuId:MenuId.SimpleEditorContext,group:CLIPBOARD_CONTEXT_MENU_GROUP,title:localize("actions.clipboard.pasteLabel","Paste"),when:EditorContextKeys.writable,order:4}]})):void 0;class ExecCommandCopyWithSyntaxHighlightingAction extends EditorAction{constructor(){super({id:"editor.action.clipboardCopyWithSyntaxHighlightingAction",label:localize("actions.clipboard.copyWithSyntaxHighlightingLabel","Copy With Syntax Highlighting"),alias:"Copy With Syntax Highlighting",precondition:void 0,kbOpts:{kbExpr:EditorContextKeys.textInputFocus,primary:0,weight:100}})}run(C,W){!W.hasModel()||!W.getOption(37)&&W.getSelection().isEmpty()||(CopyOptions.forceCopyWithSyntaxHighlighting=!0,W.focus(),W.getContainerDomNode().ownerDocument.execCommand("copy"),CopyOptions.forceCopyWithSyntaxHighlighting=!1)}}function registerExecCommandImpl(K,C){K&&(K.addImplementation(1e4,"code-editor",(W,V)=>{const U=W.get(ICodeEditorService).getFocusedCodeEditor();if(U&&U.hasTextFocus()){const G=U.getOption(37),Z=U.getSelection();return Z&&Z.isEmpty()&&!G||U.getContainerDomNode().ownerDocument.execCommand(C),!0}return!1}),K.addImplementation(0,"generic-dom",(W,V)=>(getActiveDocument().execCommand(C),!0)))}registerExecCommandImpl(CutAction,"cut");registerExecCommandImpl(CopyAction,"copy");PasteAction&&(PasteAction.addImplementation(1e4,"code-editor",(K,C)=>{const W=K.get(ICodeEditorService),V=K.get(IClipboardService),U=W.getFocusedCodeEditor();return U&&U.hasTextFocus()?!U.getContainerDomNode().ownerDocument.execCommand("paste")&&isWeb?(()=>__awaiter$15(void 0,void 0,void 0,function*(){const Z=yield V.readText();if(Z!==""){const X=InMemoryClipboardMetadataManager.INSTANCE.get(Z);let Q=!1,J=null,ee=null;X&&(Q=U.getOption(37)&&!!X.isFromEmptySelection,J=typeof X.multicursorText<"u"?X.multicursorText:null,ee=X.mode),U.trigger("keyboard","paste",{text:Z,pasteOnNewLine:Q,multicursorText:J,mode:ee})}}))():!0:!1}),PasteAction.addImplementation(0,"generic-dom",(K,C)=>(getActiveDocument().execCommand("paste"),!0)));supportsCopy&&registerEditorAction(ExecCommandCopyWithSyntaxHighlightingAction);var __awaiter$14=globalThis&&globalThis.__awaiter||function(K,C,W,V){function U(G){return G instanceof W?G:new W(function(Z){Z(G)})}return new(W||(W=Promise))(function(G,Z){function X(ee){try{J(V.next(ee))}catch(te){Z(te)}}function Q(ee){try{J(V.throw(ee))}catch(te){Z(te)}}function J(ee){ee.done?G(ee.value):U(ee.value).then(X,Q)}J((V=V.apply(K,C||[])).next())})};class CodeActionKind{constructor(C){this.value=C}equals(C){return this.value===C.value}contains(C){return this.equals(C)||this.value===""||C.value.startsWith(this.value+CodeActionKind.sep)}intersects(C){return this.contains(C)||C.contains(this)}append(C){return new CodeActionKind(this.value+CodeActionKind.sep+C)}}CodeActionKind.sep=".";CodeActionKind.None=new CodeActionKind("@@none@@");CodeActionKind.Empty=new CodeActionKind("");CodeActionKind.QuickFix=new CodeActionKind("quickfix");CodeActionKind.Refactor=new CodeActionKind("refactor");CodeActionKind.RefactorExtract=CodeActionKind.Refactor.append("extract");CodeActionKind.RefactorInline=CodeActionKind.Refactor.append("inline");CodeActionKind.RefactorMove=CodeActionKind.Refactor.append("move");CodeActionKind.RefactorRewrite=CodeActionKind.Refactor.append("rewrite");CodeActionKind.Notebook=new CodeActionKind("notebook");CodeActionKind.Source=new CodeActionKind("source");CodeActionKind.SourceOrganizeImports=CodeActionKind.Source.append("organizeImports");CodeActionKind.SourceFixAll=CodeActionKind.Source.append("fixAll");CodeActionKind.SurroundWith=CodeActionKind.Refactor.append("surround");var CodeActionTriggerSource;(function(K){K.Refactor="refactor",K.RefactorPreview="refactor preview",K.Lightbulb="lightbulb",K.Default="other (default)",K.SourceAction="source action",K.QuickFix="quick fix action",K.FixAll="fix all",K.OrganizeImports="organize imports",K.AutoFix="auto fix",K.QuickFixHover="quick fix hover window",K.OnSave="save participants",K.ProblemsView="problems view"})(CodeActionTriggerSource||(CodeActionTriggerSource={}));function mayIncludeActionsOfKind(K,C){return!(K.include&&!K.include.intersects(C)||K.excludes&&K.excludes.some(W=>excludesAction(C,W,K.include))||!K.includeSourceActions&&CodeActionKind.Source.contains(C))}function filtersAction(K,C){const W=C.kind?new CodeActionKind(C.kind):void 0;return!(K.include&&(!W||!K.include.contains(W))||K.excludes&&W&&K.excludes.some(V=>excludesAction(W,V,K.include))||!K.includeSourceActions&&W&&CodeActionKind.Source.contains(W)||K.onlyIncludePreferredActions&&!C.isPreferred)}function excludesAction(K,C,W){return!(!C.contains(K)||W&&C.contains(W))}class CodeActionCommandArgs{static fromUser(C,W){return!C||typeof C!="object"?new CodeActionCommandArgs(W.kind,W.apply,!1):new CodeActionCommandArgs(CodeActionCommandArgs.getKindFromUser(C,W.kind),CodeActionCommandArgs.getApplyFromUser(C,W.apply),CodeActionCommandArgs.getPreferredUser(C))}static getApplyFromUser(C,W){switch(typeof C.apply=="string"?C.apply.toLowerCase():""){case"first":return"first";case"never":return"never";case"ifsingle":return"ifSingle";default:return W}}static getKindFromUser(C,W){return typeof C.kind=="string"?new CodeActionKind(C.kind):W}static getPreferredUser(C){return typeof C.preferred=="boolean"?C.preferred:!1}constructor(C,W,V){this.kind=C,this.apply=W,this.preferred=V}}class CodeActionItem{constructor(C,W,V){this.action=C,this.provider=W,this.highlightRange=V}resolve(C){var W;return __awaiter$14(this,void 0,void 0,function*(){if(!((W=this.provider)===null||W===void 0)&&W.resolveCodeAction&&!this.action.edit){let V;try{V=yield this.provider.resolveCodeAction(this.action,C)}catch(U){onUnexpectedExternalError(U)}V&&(this.action.edit=V.edit)}return this})}}var __awaiter$13=globalThis&&globalThis.__awaiter||function(K,C,W,V){function U(G){return G instanceof W?G:new W(function(Z){Z(G)})}return new(W||(W=Promise))(function(G,Z){function X(ee){try{J(V.next(ee))}catch(te){Z(te)}}function Q(ee){try{J(V.throw(ee))}catch(te){Z(te)}}function J(ee){ee.done?G(ee.value):U(ee.value).then(X,Q)}J((V=V.apply(K,C||[])).next())})};const codeActionCommandId="editor.action.codeAction",quickFixCommandId="editor.action.quickFix",autoFixCommandId="editor.action.autoFix",refactorCommandId="editor.action.refactor",sourceActionCommandId="editor.action.sourceAction",organizeImportsCommandId="editor.action.organizeImports",fixAllCommandId="editor.action.fixAll";class ManagedCodeActionSet extends Disposable{static codeActionsPreferredComparator(C,W){return C.isPreferred&&!W.isPreferred?-1:!C.isPreferred&&W.isPreferred?1:0}static codeActionsComparator({action:C},{action:W}){return isNonEmptyArray$2(C.diagnostics)?isNonEmptyArray$2(W.diagnostics)?ManagedCodeActionSet.codeActionsPreferredComparator(C,W):-1:isNonEmptyArray$2(W.diagnostics)?1:ManagedCodeActionSet.codeActionsPreferredComparator(C,W)}constructor(C,W,V){super(),this.documentation=W,this._register(V),this.allActions=[...C].sort(ManagedCodeActionSet.codeActionsComparator),this.validActions=this.allActions.filter(({action:U})=>!U.disabled)}get hasAutoFix(){return this.validActions.some(({action:C})=>!!C.kind&&CodeActionKind.QuickFix.contains(new CodeActionKind(C.kind))&&!!C.isPreferred)}}const emptyCodeActionsResponse={actions:[],documentation:void 0};function getCodeActions(K,C,W,V,U,G){var Z;return __awaiter$13(this,void 0,void 0,function*(){const X=V.filter||{},Q=Object.assign(Object.assign({},X),{excludes:[...X.excludes||[],CodeActionKind.Notebook]}),J={only:(Z=X.include)===null||Z===void 0?void 0:Z.value,trigger:V.type},ee=new TextModelCancellationTokenSource(C,G),te=V.type===2,ie=getCodeActionProviders(K,C,te?Q:X),ne=new DisposableStore,oe=ie.map(ae=>__awaiter$13(this,void 0,void 0,function*(){try{U.report(ae);const se=yield ae.provideCodeActions(C,W,J,ee.token);if(se&&ne.add(se),ee.token.isCancellationRequested)return emptyCodeActionsResponse;const le=((se==null?void 0:se.actions)||[]).filter(de=>de&&filtersAction(X,de)),ce=getDocumentationFromProvider(ae,le,X.include);return{actions:le.map(de=>new CodeActionItem(de,ae)),documentation:ce}}catch(se){if(isCancellationError(se))throw se;return onUnexpectedExternalError(se),emptyCodeActionsResponse}})),re=K.onDidChange(()=>{const ae=K.all(C);equals$5(ae,ie)||ee.cancel()});try{const ae=yield Promise.all(oe),se=ae.map(ce=>ce.actions).flat(),le=[...coalesce(ae.map(ce=>ce.documentation)),...getAdditionalDocumentationForShowingActions(K,C,V,se)];return new ManagedCodeActionSet(se,le,ne)}finally{re.dispose(),ee.dispose()}})}function getCodeActionProviders(K,C,W){return K.all(C).filter(V=>V.providedCodeActionKinds?V.providedCodeActionKinds.some(U=>mayIncludeActionsOfKind(W,new CodeActionKind(U))):!0)}function*getAdditionalDocumentationForShowingActions(K,C,W,V){var U,G,Z;if(C&&V.length)for(const X of K.all(C))X._getAdditionalMenuItems&&(yield*(U=X._getAdditionalMenuItems)===null||U===void 0?void 0:U.call(X,{trigger:W.type,only:(Z=(G=W.filter)===null||G===void 0?void 0:G.include)===null||Z===void 0?void 0:Z.value},V.map(Q=>Q.action)))}function getDocumentationFromProvider(K,C,W){if(!K.documentation)return;const V=K.documentation.map(U=>({kind:new CodeActionKind(U.kind),command:U.command}));if(W){let U;for(const G of V)G.kind.contains(W)&&(U?U.kind.contains(G.kind)&&(U=G):U=G);if(U)return U==null?void 0:U.command}for(const U of C)if(U.kind){for(const G of V)if(G.kind.contains(new CodeActionKind(U.kind)))return G.command}}var ApplyCodeActionReason;(function(K){K.OnSave="onSave",K.FromProblemsView="fromProblemsView",K.FromCodeActions="fromCodeActions"})(ApplyCodeActionReason||(ApplyCodeActionReason={}));function applyCodeAction(K,C,W,V,U=CancellationToken.None){var G;return __awaiter$13(this,void 0,void 0,function*(){const Z=K.get(IBulkEditService),X=K.get(ICommandService),Q=K.get(ITelemetryService),J=K.get(INotificationService);if(Q.publicLog2("codeAction.applyCodeAction",{codeActionTitle:C.action.title,codeActionKind:C.action.kind,codeActionIsPreferred:!!C.action.isPreferred,reason:W}),yield C.resolve(U),!U.isCancellationRequested&&!(!((G=C.action.edit)===null||G===void 0)&&G.edits.length&&!(yield Z.apply(C.action.edit,{editor:V==null?void 0:V.editor,label:C.action.title,quotableLabel:C.action.title,code:"undoredo.codeAction",respectAutoSaveConfig:W!==ApplyCodeActionReason.OnSave,showPreview:V==null?void 0:V.preview})).isApplied)&&C.action.command)try{yield X.executeCommand(C.action.command.id,...C.action.command.arguments||[])}catch(ee){const te=asMessage(ee);J.error(typeof te=="string"?te:localize("applyCodeActionFailed","An unknown error occurred while applying the code action"))}})}function asMessage(K){return typeof K=="string"?K:K instanceof Error&&typeof K.message=="string"?K.message:void 0}CommandsRegistry.registerCommand("_executeCodeActionProvider",function(K,C,W,V,U){return __awaiter$13(this,void 0,void 0,function*(){if(!(C instanceof URI))throw illegalArgument();const{codeActionProvider:G}=K.get(ILanguageFeaturesService),Z=K.get(IModelService).getModel(C);if(!Z)throw illegalArgument();const X=Selection$1.isISelection(W)?Selection$1.liftSelection(W):Range$2.isIRange(W)?Z.validateRange(W):void 0;if(!X)throw illegalArgument();const Q=typeof V=="string"?new CodeActionKind(V):void 0,J=yield getCodeActions(G,Z,X,{type:1,triggerAction:CodeActionTriggerSource.Default,filter:{includeSourceActions:!0,include:Q}},Progress.None,CancellationToken.None),ee=[],te=Math.min(J.validActions.length,typeof U=="number"?U:0);for(let ie=0;ie<te;ie++)ee.push(J.validActions[ie].resolve(CancellationToken.None));try{return yield Promise.all(ee),J.validActions.map(ie=>ie.action)}finally{setTimeout(()=>J.dispose(),100)}})});var __decorate$1o=globalThis&&globalThis.__decorate||function(K,C,W,V){var U=arguments.length,G=U<3?C:V===null?V=Object.getOwnPropertyDescriptor(C,W):V,Z;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")G=Reflect.decorate(K,C,W,V);else for(var X=K.length-1;X>=0;X--)(Z=K[X])&&(G=(U<3?Z(G):U>3?Z(C,W,G):Z(C,W))||G);return U>3&&G&&Object.defineProperty(C,W,G),G},__param$1o=globalThis&&globalThis.__param||function(K,C){return function(W,V){C(W,V,K)}},CodeActionKeybindingResolver_1;let CodeActionKeybindingResolver=CodeActionKeybindingResolver_1=class{constructor(C){this.keybindingService=C}getResolver(){const C=new Lazy(()=>this.keybindingService.getKeybindings().filter(W=>CodeActionKeybindingResolver_1.codeActionCommands.indexOf(W.command)>=0).filter(W=>W.resolvedKeybinding).map(W=>{let V=W.commandArgs;return W.command===organizeImportsCommandId?V={kind:CodeActionKind.SourceOrganizeImports.value}:W.command===fixAllCommandId&&(V={kind:CodeActionKind.SourceFixAll.value}),Object.assign({resolvedKeybinding:W.resolvedKeybinding},CodeActionCommandArgs.fromUser(V,{kind:CodeActionKind.None,apply:"never"}))}));return W=>{if(W.kind){const V=this.bestKeybindingForCodeAction(W,C.value);return V==null?void 0:V.resolvedKeybinding}}}bestKeybindingForCodeAction(C,W){if(!C.kind)return;const V=new CodeActionKind(C.kind);return W.filter(U=>U.kind.contains(V)).filter(U=>U.preferred?C.isPreferred:!0).reduceRight((U,G)=>U?U.kind.contains(G.kind)?G:U:G,void 0)}};CodeActionKeybindingResolver.codeActionCommands=[refactorCommandId,codeActionCommandId,sourceActionCommandId,organizeImportsCommandId,fixAllCommandId];CodeActionKeybindingResolver=CodeActionKeybindingResolver_1=__decorate$1o([__param$1o(0,IKeybindingService)],CodeActionKeybindingResolver);const codicon="",codiconModifiers="",symbolIcons="";registerColor("symbolIcon.arrayForeground",{dark:foreground,light:foreground,hcDark:foreground,hcLight:foreground},localize("symbolIcon.arrayForeground","The foreground color for array symbols. These symbols appear in the outline, breadcrumb, and suggest widget."));registerColor("symbolIcon.booleanForeground",{dark:foreground,light:foreground,hcDark:foreground,hcLight:foreground},localize("symbolIcon.booleanForeground","The foreground color for boolean symbols. These symbols appear in the outline, breadcrumb, and suggest widget."));registerColor("symbolIcon.classForeground",{dark:"#EE9D28",light:"#D67E00",hcDark:"#EE9D28",hcLight:"#D67E00"},localize("symbolIcon.classForeground","The foreground color for class symbols. These symbols appear in the outline, breadcrumb, and suggest widget."));registerColor("symbolIcon.colorForeground",{dark:foreground,light:foreground,hcDark:foreground,hcLight:foreground},localize("symbolIcon.colorForeground","The foreground color for color symbols. These symbols appear in the outline, breadcrumb, and suggest widget."));registerColor("symbolIcon.constantForeground",{dark:foreground,light:foreground,hcDark:foreground,hcLight:foreground},localize("symbolIcon.constantForeground","The foreground color for constant symbols. These symbols appear in the outline, breadcrumb, and suggest widget."));registerColor("symbolIcon.constructorForeground",{dark:"#B180D7",light:"#652D90",hcDark:"#B180D7",hcLight:"#652D90"},localize("symbolIcon.constructorForeground","The foreground color for constructor symbols. These symbols appear in the outline, breadcrumb, and suggest widget."));registerColor("symbolIcon.enumeratorForeground",{dark:"#EE9D28",light:"#D67E00",hcDark:"#EE9D28",hcLight:"#D67E00"},localize("symbolIcon.enumeratorForeground","The foreground color for enumerator symbols. These symbols appear in the outline, breadcrumb, and suggest widget."));registerColor("symbolIcon.enumeratorMemberForeground",{dark:"#75BEFF",light:"#007ACC",hcDark:"#75BEFF",hcLight:"#007ACC"},localize("symbolIcon.enumeratorMemberForeground","The foreground color for enumerator member symbols. These symbols appear in the outline, breadcrumb, and suggest widget."));registerColor("symbolIcon.eventForeground",{dark:"#EE9D28",light:"#D67E00",hcDark:"#EE9D28",hcLight:"#D67E00"},localize("symbolIcon.eventForeground","The foreground color for event symbols. These symbols appear in the outline, breadcrumb, and suggest widget."));registerColor("symbolIcon.fieldForeground",{dark:"#75BEFF",light:"#007ACC",hcDark:"#75BEFF",hcLight:"#007ACC"},localize("symbolIcon.fieldForeground","The foreground color for field symbols. These symbols appear in the outline, breadcrumb, and suggest widget."));registerColor("symbolIcon.fileForeground",{dark:foreground,light:foreground,hcDark:foreground,hcLight:foreground},localize("symbolIcon.fileForeground","The foreground color for file symbols. These symbols appear in the outline, breadcrumb, and suggest widget."));registerColor("symbolIcon.folderForeground",{dark:foreground,light:foreground,hcDark:foreground,hcLight:foreground},localize("symbolIcon.folderForeground","The foreground color for folder symbols. These symbols appear in the outline, breadcrumb, and suggest widget."));registerColor("symbolIcon.functionForeground",{dark:"#B180D7",light:"#652D90",hcDark:"#B180D7",hcLight:"#652D90"},localize("symbolIcon.functionForeground","The foreground color for function symbols. These symbols appear in the outline, breadcrumb, and suggest widget."));registerColor("symbolIcon.interfaceForeground",{dark:"#75BEFF",light:"#007ACC",hcDark:"#75BEFF",hcLight:"#007ACC"},localize("symbolIcon.interfaceForeground","The foreground color for interface symbols. These symbols appear in the outline, breadcrumb, and suggest widget."));registerColor("symbolIcon.keyForeground",{dark:foreground,light:foreground,hcDark:foreground,hcLight:foreground},localize("symbolIcon.keyForeground","The foreground color for key symbols. These symbols appear in the outline, breadcrumb, and suggest widget."));registerColor("symbolIcon.keywordForeground",{dark:foreground,light:foreground,hcDark:foreground,hcLight:foreground},localize("symbolIcon.keywordForeground","The foreground color for keyword symbols. These symbols appear in the outline, breadcrumb, and suggest widget."));registerColor("symbolIcon.methodForeground",{dark:"#B180D7",light:"#652D90",hcDark:"#B180D7",hcLight:"#652D90"},localize("symbolIcon.methodForeground","The foreground color for method symbols. These symbols appear in the outline, breadcrumb, and suggest widget."));registerColor("symbolIcon.moduleForeground",{dark:foreground,light:foreground,hcDark:foreground,hcLight:foreground},localize("symbolIcon.moduleForeground","The foreground color for module symbols. These symbols appear in the outline, breadcrumb, and suggest widget."));registerColor("symbolIcon.namespaceForeground",{dark:foreground,light:foreground,hcDark:foreground,hcLight:foreground},localize("symbolIcon.namespaceForeground","The foreground color for namespace symbols. These symbols appear in the outline, breadcrumb, and suggest widget."));registerColor("symbolIcon.nullForeground",{dark:foreground,light:foreground,hcDark:foreground,hcLight:foreground},localize("symbolIcon.nullForeground","The foreground color for null symbols. These symbols appear in the outline, breadcrumb, and suggest widget."));registerColor("symbolIcon.numberForeground",{dark:foreground,light:foreground,hcDark:foreground,hcLight:foreground},localize("symbolIcon.numberForeground","The foreground color for number symbols. These symbols appear in the outline, breadcrumb, and suggest widget."));registerColor("symbolIcon.objectForeground",{dark:foreground,light:foreground,hcDark:foreground,hcLight:foreground},localize("symbolIcon.objectForeground","The foreground color for object symbols. These symbols appear in the outline, breadcrumb, and suggest widget."));registerColor("symbolIcon.operatorForeground",{dark:foreground,light:foreground,hcDark:foreground,hcLight:foreground},localize("symbolIcon.operatorForeground","The foreground color for operator symbols. These symbols appear in the outline, breadcrumb, and suggest widget."));registerColor("symbolIcon.packageForeground",{dark:foreground,light:foreground,hcDark:foreground,hcLight:foreground},localize("symbolIcon.packageForeground","The foreground color for package symbols. These symbols appear in the outline, breadcrumb, and suggest widget."));registerColor("symbolIcon.propertyForeground",{dark:foreground,light:foreground,hcDark:foreground,hcLight:foreground},localize("symbolIcon.propertyForeground","The foreground color for property symbols. These symbols appear in the outline, breadcrumb, and suggest widget."));registerColor("symbolIcon.referenceForeground",{dark:foreground,light:foreground,hcDark:foreground,hcLight:foreground},localize("symbolIcon.referenceForeground","The foreground color for reference symbols. These symbols appear in the outline, breadcrumb, and suggest widget."));registerColor("symbolIcon.snippetForeground",{dark:foreground,light:foreground,hcDark:foreground,hcLight:foreground},localize("symbolIcon.snippetForeground","The foreground color for snippet symbols. These symbols appear in the outline, breadcrumb, and suggest widget."));registerColor("symbolIcon.stringForeground",{dark:foreground,light:foreground,hcDark:foreground,hcLight:foreground},localize("symbolIcon.stringForeground","The foreground color for string symbols. These symbols appear in the outline, breadcrumb, and suggest widget."));registerColor("symbolIcon.structForeground",{dark:foreground,light:foreground,hcDark:foreground,hcLight:foreground},localize("symbolIcon.structForeground","The foreground color for struct symbols. These symbols appear in the outline, breadcrumb, and suggest widget."));registerColor("symbolIcon.textForeground",{dark:foreground,light:foreground,hcDark:foreground,hcLight:foreground},localize("symbolIcon.textForeground","The foreground color for text symbols. These symbols appear in the outline, breadcrumb, and suggest widget."));registerColor("symbolIcon.typeParameterForeground",{dark:foreground,light:foreground,hcDark:foreground,hcLight:foreground},localize("symbolIcon.typeParameterForeground","The foreground color for type parameter symbols. These symbols appear in the outline, breadcrumb, and suggest widget."));registerColor("symbolIcon.unitForeground",{dark:foreground,light:foreground,hcDark:foreground,hcLight:foreground},localize("symbolIcon.unitForeground","The foreground color for unit symbols. These symbols appear in the outline, breadcrumb, and suggest widget."));registerColor("symbolIcon.variableForeground",{dark:"#75BEFF",light:"#007ACC",hcDark:"#75BEFF",hcLight:"#007ACC"},localize("symbolIcon.variableForeground","The foreground color for variable symbols. These symbols appear in the outline, breadcrumb, and suggest widget."));const uncategorizedCodeActionGroup=Object.freeze({kind:CodeActionKind.Empty,title:localize("codeAction.widget.id.more","More Actions...")}),codeActionGroups=Object.freeze([{kind:CodeActionKind.QuickFix,title:localize("codeAction.widget.id.quickfix","Quick Fix")},{kind:CodeActionKind.RefactorExtract,title:localize("codeAction.widget.id.extract","Extract"),icon:Codicon.wrench},{kind:CodeActionKind.RefactorInline,title:localize("codeAction.widget.id.inline","Inline"),icon:Codicon.wrench},{kind:CodeActionKind.RefactorRewrite,title:localize("codeAction.widget.id.convert","Rewrite"),icon:Codicon.wrench},{kind:CodeActionKind.RefactorMove,title:localize("codeAction.widget.id.move","Move"),icon:Codicon.wrench},{kind:CodeActionKind.SurroundWith,title:localize("codeAction.widget.id.surround","Surround With"),icon:Codicon.symbolSnippet},{kind:CodeActionKind.Source,title:localize("codeAction.widget.id.source","Source Action"),icon:Codicon.symbolFile},uncategorizedCodeActionGroup]);function toMenuItems(K,C,W){if(!C)return K.map(G=>{var Z;return{kind:"action",item:G,group:uncategorizedCodeActionGroup,disabled:!!G.action.disabled,label:G.action.disabled||G.action.title,canPreview:!!(!((Z=G.action.edit)===null||Z===void 0)&&Z.edits.length)}});const V=codeActionGroups.map(G=>({group:G,actions:[]}));for(const G of K){const Z=G.action.kind?new CodeActionKind(G.action.kind):CodeActionKind.None;for(const X of V)if(X.group.kind.contains(Z)){X.actions.push(G);break}}const U=[];for(const G of V)if(G.actions.length){U.push({kind:"header",group:G.group});for(const Z of G.actions)U.push({kind:"action",item:Z,group:G.group,label:Z.action.title,disabled:!!Z.action.disabled,keybinding:W(Z.action)})}return U}const lightBulbWidget="";var __decorate$1n=globalThis&&globalThis.__decorate||function(K,C,W,V){var U=arguments.length,G=U<3?C:V===null?V=Object.getOwnPropertyDescriptor(C,W):V,Z;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")G=Reflect.decorate(K,C,W,V);else for(var X=K.length-1;X>=0;X--)(Z=K[X])&&(G=(U<3?Z(G):U>3?Z(C,W,G):Z(C,W))||G);return U>3&&G&&Object.defineProperty(C,W,G),G},__param$1n=globalThis&&globalThis.__param||function(K,C){return function(W,V){C(W,V,K)}},LightBulbWidget_1,LightBulbState;(function(K){K.Hidden={type:0};class C{constructor(V,U,G,Z){this.actions=V,this.trigger=U,this.editorPosition=G,this.widgetPosition=Z,this.type=1}}K.Showing=C})(LightBulbState||(LightBulbState={}));let LightBulbWidget=LightBulbWidget_1=class extends Disposable{constructor(C,W){super(),this._editor=C,this._onClick=this._register(new Emitter$1),this.onClick=this._onClick.event,this._state=LightBulbState.Hidden,this._domNode=$$d("div.lightBulbWidget"),this._register(Gesture.ignoreTarget(this._domNode)),this._editor.addContentWidget(this),this._register(this._editor.onDidChangeModelContent(V=>{const U=this._editor.getModel();(this.state.type!==1||!U||this.state.editorPosition.lineNumber>=U.getLineCount())&&this.hide()})),this._register(addStandardDisposableGenericMouseDownListener(this._domNode,V=>{if(this.state.type!==1)return;this._editor.focus(),V.preventDefault();const{top:U,height:G}=getDomNodePagePosition(this._domNode),Z=this._editor.getOption(66);let X=Math.floor(Z/3);this.state.widgetPosition.position!==null&&this.state.widgetPosition.position.lineNumber<this.state.editorPosition.lineNumber&&(X+=Z),this._onClick.fire({x:V.posx,y:U+G+X,actions:this.state.actions,trigger:this.state.trigger})})),this._register(addDisposableListener(this._domNode,"mouseenter",V=>{(V.buttons&1)===1&&this.hide()})),this._register(this._editor.onDidChangeConfiguration(V=>{V.hasChanged(64)&&!this._editor.getOption(64).enabled&&this.hide()})),this._register(Event$1.runAndSubscribe(W.onDidUpdateKeybindings,()=>{var V,U,G,Z;this._preferredKbLabel=(U=(V=W.lookupKeybinding(autoFixCommandId))===null||V===void 0?void 0:V.getLabel())!==null&&U!==void 0?U:void 0,this._quickFixKbLabel=(Z=(G=W.lookupKeybinding(quickFixCommandId))===null||G===void 0?void 0:G.getLabel())!==null&&Z!==void 0?Z:void 0,this._updateLightBulbTitleAndIcon()}))}dispose(){super.dispose(),this._editor.removeContentWidget(this)}getId(){return"LightBulbWidget"}getDomNode(){return this._domNode}getPosition(){return this._state.type===1?this._state.widgetPosition:null}update(C,W,V){if(C.validActions.length<=0)return this.hide();const U=this._editor.getOptions();if(!U.get(64).enabled)return this.hide();const G=this._editor.getModel();if(!G)return this.hide();const{lineNumber:Z,column:X}=G.validatePosition(V),Q=G.getOptions().tabSize,J=U.get(50),ee=G.getLineContent(Z),te=computeIndentLevel(ee,Q),ie=J.spaceWidth*te>22,ne=re=>re>2&&this._editor.getTopForLineNumber(re)===this._editor.getTopForLineNumber(re-1);let oe=Z;if(!ie){if(Z>1&&!ne(Z-1))oe-=1;else if(!ne(Z+1))oe+=1;else if(X*J.spaceWidth<22)return this.hide()}this.state=new LightBulbState.Showing(C,W,V,{position:{lineNumber:oe,column:1},preference:LightBulbWidget_1._posPref}),this._editor.layoutContentWidget(this)}hide(){this.state!==LightBulbState.Hidden&&(this.state=LightBulbState.Hidden,this._editor.layoutContentWidget(this))}get state(){return this._state}set state(C){this._state=C,this._updateLightBulbTitleAndIcon()}_updateLightBulbTitleAndIcon(){if(this.state.type===1&&this.state.actions.hasAutoFix&&(this._domNode.classList.remove(...ThemeIcon.asClassNameArray(Codicon.lightBulb)),this._domNode.classList.add(...ThemeIcon.asClassNameArray(Codicon.lightbulbAutofix)),this._preferredKbLabel)){this.title=localize("preferredcodeActionWithKb","Show Code Actions. Preferred Quick Fix Available ({0})",this._preferredKbLabel);return}this._domNode.classList.remove(...ThemeIcon.asClassNameArray(Codicon.lightbulbAutofix)),this._domNode.classList.add(...ThemeIcon.asClassNameArray(Codicon.lightBulb)),this._quickFixKbLabel?this.title=localize("codeActionWithKb","Show Code Actions ({0})",this._quickFixKbLabel):this.title=localize("codeAction","Show Code Actions")}set title(C){this._domNode.title=C}};LightBulbWidget.ID="editor.contrib.lightbulbWidget";LightBulbWidget._posPref=[0];LightBulbWidget=LightBulbWidget_1=__decorate$1n([__param$1n(1,IKeybindingService)],LightBulbWidget);const messageController="",renderedMarkdown="";var __decorate$1m=globalThis&&globalThis.__decorate||function(K,C,W,V){var U=arguments.length,G=U<3?C:V===null?V=Object.getOwnPropertyDescriptor(C,W):V,Z;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")G=Reflect.decorate(K,C,W,V);else for(var X=K.length-1;X>=0;X--)(Z=K[X])&&(G=(U<3?Z(G):U>3?Z(C,W,G):Z(C,W))||G);return U>3&&G&&Object.defineProperty(C,W,G),G},__param$1m=globalThis&&globalThis.__param||function(K,C){return function(W,V){C(W,V,K)}},__awaiter$12=globalThis&&globalThis.__awaiter||function(K,C,W,V){function U(G){return G instanceof W?G:new W(function(Z){Z(G)})}return new(W||(W=Promise))(function(G,Z){function X(ee){try{J(V.next(ee))}catch(te){Z(te)}}function Q(ee){try{J(V.throw(ee))}catch(te){Z(te)}}function J(ee){ee.done?G(ee.value):U(ee.value).then(X,Q)}J((V=V.apply(K,C||[])).next())})},MarkdownRenderer_1;let MarkdownRenderer=MarkdownRenderer_1=class{constructor(C,W,V){this._options=C,this._languageService=W,this._openerService=V,this._onDidRenderAsync=new Emitter$1,this.onDidRenderAsync=this._onDidRenderAsync.event}dispose(){this._onDidRenderAsync.dispose()}render(C,W,V){if(!C)return{element:document.createElement("span"),dispose:()=>{}};const U=new DisposableStore,G=U.add(renderMarkdown(C,Object.assign(Object.assign({},this._getRenderOptions(C,U)),W),V));return G.element.classList.add("rendered-markdown"),{element:G.element,dispose:()=>U.dispose()}}_getRenderOptions(C,W){return{codeBlockRenderer:(V,U)=>__awaiter$12(this,void 0,void 0,function*(){var G,Z,X;let Q;V?Q=this._languageService.getLanguageIdByLanguageName(V):this._options.editor&&(Q=(G=this._options.editor.getModel())===null||G===void 0?void 0:G.getLanguageId()),Q||(Q=PLAINTEXT_LANGUAGE_ID);const J=yield tokenizeToString(this._languageService,U,Q),ee=document.createElement("span");if(ee.innerHTML=(X=(Z=MarkdownRenderer_1._ttpTokenizer)===null||Z===void 0?void 0:Z.createHTML(J))!==null&&X!==void 0?X:J,this._options.editor){const te=this._options.editor.getOption(50);applyFontInfo(ee,te)}else this._options.codeBlockFontFamily&&(ee.style.fontFamily=this._options.codeBlockFontFamily);return this._options.codeBlockFontSize!==void 0&&(ee.style.fontSize=this._options.codeBlockFontSize),ee}),asyncRenderCallback:()=>this._onDidRenderAsync.fire(),actionHandler:{callback:V=>openLinkFromMarkdown(this._openerService,V,C.isTrusted),disposables:W}}}};MarkdownRenderer._ttpTokenizer=createTrustedTypesPolicy("tokenizeToString",{createHTML(K){return K}});MarkdownRenderer=MarkdownRenderer_1=__decorate$1m([__param$1m(1,ILanguageService),__param$1m(2,IOpenerService)],MarkdownRenderer);function openLinkFromMarkdown(K,C,W){return __awaiter$12(this,void 0,void 0,function*(){try{return yield K.open(C,{fromUserGesture:!0,allowContributedOpeners:!0,allowCommands:toAllowCommandsOption(W)})}catch(V){return onUnexpectedError(V),!1}})}function toAllowCommandsOption(K){return K===!0?!0:K&&Array.isArray(K.enabledCommands)?K.enabledCommands:!1}var __decorate$1l=globalThis&&globalThis.__decorate||function(K,C,W,V){var U=arguments.length,G=U<3?C:V===null?V=Object.getOwnPropertyDescriptor(C,W):V,Z;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")G=Reflect.decorate(K,C,W,V);else for(var X=K.length-1;X>=0;X--)(Z=K[X])&&(G=(U<3?Z(G):U>3?Z(C,W,G):Z(C,W))||G);return U>3&&G&&Object.defineProperty(C,W,G),G},__param$1l=globalThis&&globalThis.__param||function(K,C){return function(W,V){C(W,V,K)}},MessageController_1;let MessageController=MessageController_1=class{static get(C){return C.getContribution(MessageController_1.ID)}constructor(C,W,V){this._openerService=V,this._messageWidget=new MutableDisposable,this._messageListeners=new DisposableStore,this._mouseOverMessage=!1,this._editor=C,this._visible=MessageController_1.MESSAGE_VISIBLE.bindTo(W)}dispose(){var C;(C=this._message)===null||C===void 0||C.dispose(),this._messageListeners.dispose(),this._messageWidget.dispose(),this._visible.reset()}showMessage(C,W){alert(isMarkdownString(C)?C.value:C),this._visible.set(!0),this._messageWidget.clear(),this._messageListeners.clear(),this._message=isMarkdownString(C)?renderMarkdown(C,{actionHandler:{callback:U=>openLinkFromMarkdown(this._openerService,U,isMarkdownString(C)?C.isTrusted:void 0),disposables:this._messageListeners}}):void 0,this._messageWidget.value=new MessageWidget$1(this._editor,W,typeof C=="string"?C:this._message.element),this._messageListeners.add(Event$1.debounce(this._editor.onDidBlurEditorText,(U,G)=>G,0)(()=>{this._mouseOverMessage||this._messageWidget.value&&isAncestor$1(getActiveElement(),this._messageWidget.value.getDomNode())||this.closeMessage()})),this._messageListeners.add(this._editor.onDidChangeCursorPosition(()=>this.closeMessage())),this._messageListeners.add(this._editor.onDidDispose(()=>this.closeMessage())),this._messageListeners.add(this._editor.onDidChangeModel(()=>this.closeMessage())),this._messageListeners.add(addDisposableListener(this._messageWidget.value.getDomNode(),EventType$1.MOUSE_ENTER,()=>this._mouseOverMessage=!0,!0)),this._messageListeners.add(addDisposableListener(this._messageWidget.value.getDomNode(),EventType$1.MOUSE_LEAVE,()=>this._mouseOverMessage=!1,!0));let V;this._messageListeners.add(this._editor.onMouseMove(U=>{U.target.position&&(V?V.containsPosition(U.target.position)||this.closeMessage():V=new Range$2(W.lineNumber-3,1,U.target.position.lineNumber+3,1))}))}closeMessage(){this._visible.reset(),this._messageListeners.clear(),this._messageWidget.value&&this._messageListeners.add(MessageWidget$1.fadeOut(this._messageWidget.value))}};MessageController.ID="editor.contrib.messageController";MessageController.MESSAGE_VISIBLE=new RawContextKey("messageVisible",!1,localize("messageVisible","Whether the editor is currently showing an inline message"));MessageController=MessageController_1=__decorate$1l([__param$1l(1,IContextKeyService),__param$1l(2,IOpenerService)],MessageController);const MessageCommand=EditorCommand.bindToContribution(MessageController.get);registerEditorCommand(new MessageCommand({id:"leaveEditorMessage",precondition:MessageController.MESSAGE_VISIBLE,handler:K=>K.closeMessage(),kbOpts:{weight:100+30,primary:9}}));let MessageWidget$1=class{static fadeOut(C){const W=()=>{C.dispose(),clearTimeout(V),C.getDomNode().removeEventListener("animationend",W)},V=setTimeout(W,110);return C.getDomNode().addEventListener("animationend",W),C.getDomNode().classList.add("fadeOut"),{dispose:W}}constructor(C,{lineNumber:W,column:V},U){this.allowEditorOverflow=!0,this.suppressMouseDown=!1,this._editor=C,this._editor.revealLinesInCenterIfOutsideViewport(W,W,0),this._position={lineNumber:W,column:V},this._domNode=document.createElement("div"),this._domNode.classList.add("monaco-editor-overlaymessage"),this._domNode.style.marginLeft="-6px";const G=document.createElement("div");G.classList.add("anchor","top"),this._domNode.appendChild(G);const Z=document.createElement("div");typeof U=="string"?(Z.classList.add("message"),Z.textContent=U):(U.classList.add("message"),Z.appendChild(U)),this._domNode.appendChild(Z);const X=document.createElement("div");X.classList.add("anchor","below"),this._domNode.appendChild(X),this._editor.addContentWidget(this),this._domNode.classList.add("fadeIn")}dispose(){this._editor.removeContentWidget(this)}getId(){return"messageoverlay"}getDomNode(){return this._domNode}getPosition(){return{position:this._position,preference:[1,2],positionAffinity:1}}afterRender(C){this._domNode.classList.toggle("below",C===2)}};registerEditorContribution(MessageController.ID,MessageController,4);const actionWidget="";var __decorate$1k=globalThis&&globalThis.__decorate||function(K,C,W,V){var U=arguments.length,G=U<3?C:V===null?V=Object.getOwnPropertyDescriptor(C,W):V,Z;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")G=Reflect.decorate(K,C,W,V);else for(var X=K.length-1;X>=0;X--)(Z=K[X])&&(G=(U<3?Z(G):U>3?Z(C,W,G):Z(C,W))||G);return U>3&&G&&Object.defineProperty(C,W,G),G},__param$1k=globalThis&&globalThis.__param||function(K,C){return function(W,V){C(W,V,K)}},__awaiter$11=globalThis&&globalThis.__awaiter||function(K,C,W,V){function U(G){return G instanceof W?G:new W(function(Z){Z(G)})}return new(W||(W=Promise))(function(G,Z){function X(ee){try{J(V.next(ee))}catch(te){Z(te)}}function Q(ee){try{J(V.throw(ee))}catch(te){Z(te)}}function J(ee){ee.done?G(ee.value):U(ee.value).then(X,Q)}J((V=V.apply(K,C||[])).next())})};const acceptSelectedActionCommand="acceptSelectedCodeAction",previewSelectedActionCommand="previewSelectedCodeAction";class HeaderRenderer{get templateId(){return"header"}renderTemplate(C){C.classList.add("group-header");const W=document.createElement("span");return C.append(W),{container:C,text:W}}renderElement(C,W,V){var U,G;V.text.textContent=(G=(U=C.group)===null||U===void 0?void 0:U.title)!==null&&G!==void 0?G:""}disposeTemplate(C){}}let ActionItemRenderer=class{get templateId(){return"action"}constructor(C,W){this._supportsPreview=C,this._keybindingService=W}renderTemplate(C){C.classList.add(this.templateId);const W=document.createElement("div");W.className="icon",C.append(W);const V=document.createElement("span");V.className="title",C.append(V);const U=new KeybindingLabel(C,OS);return{container:C,icon:W,text:V,keybinding:U}}renderElement(C,W,V){var U,G,Z;if(!((U=C.group)===null||U===void 0)&&U.icon?(V.icon.className=ThemeIcon.asClassName(C.group.icon),C.group.icon.color&&(V.icon.style.color=asCssVariable(C.group.icon.color.id))):(V.icon.className=ThemeIcon.asClassName(Codicon.lightBulb),V.icon.style.color="var(--vscode-editorLightBulb-foreground)"),!C.item||!C.label)return;V.text.textContent=stripNewlines(C.label),V.keybinding.set(C.keybinding),setVisibility(!!C.keybinding,V.keybinding.element);const X=(G=this._keybindingService.lookupKeybinding(acceptSelectedActionCommand))===null||G===void 0?void 0:G.getLabel(),Q=(Z=this._keybindingService.lookupKeybinding(previewSelectedActionCommand))===null||Z===void 0?void 0:Z.getLabel();V.container.classList.toggle("option-disabled",C.disabled),C.disabled?V.container.title=C.label:X&&Q?this._supportsPreview&&C.canPreview?V.container.title=localize({key:"label-preview",comment:['placeholders are keybindings, e.g "F2 to apply, Shift+F2 to preview"']},"{0} to apply, {1} to preview",X,Q):V.container.title=localize({key:"label",comment:['placeholder is a keybinding, e.g "F2 to apply"']},"{0} to apply",X):V.container.title=""}disposeTemplate(C){}};ActionItemRenderer=__decorate$1k([__param$1k(1,IKeybindingService)],ActionItemRenderer);class AcceptSelectedEvent extends UIEvent{constructor(){super("acceptSelectedAction")}}class PreviewSelectedEvent extends UIEvent{constructor(){super("previewSelectedAction")}}function getKeyboardNavigationLabel(K){if(K.kind==="action")return K.label}let ActionList=class extends Disposable{constructor(C,W,V,U,G,Z){super(),this._delegate=U,this._contextViewService=G,this._keybindingService=Z,this._actionLineHeight=24,this._headerLineHeight=26,this.cts=this._register(new CancellationTokenSource$1),this.domNode=document.createElement("div"),this.domNode.classList.add("actionList");const X={getHeight:Q=>Q.kind==="header"?this._headerLineHeight:this._actionLineHeight,getTemplateId:Q=>Q.kind};this._list=this._register(new List$1(C,this.domNode,X,[new ActionItemRenderer(W,this._keybindingService),new HeaderRenderer],{keyboardSupport:!1,typeNavigationEnabled:!0,keyboardNavigationLabelProvider:{getKeyboardNavigationLabel},accessibilityProvider:{getAriaLabel:Q=>{if(Q.kind==="action"){let J=Q.label?stripNewlines(Q==null?void 0:Q.label):"";return Q.disabled&&(J=localize({key:"customQuickFixWidget.labels",comment:["Action widget labels for accessibility."]},"{0}, Disabled Reason: {1}",J,Q.disabled)),J}return null},getWidgetAriaLabel:()=>localize({key:"customQuickFixWidget",comment:["An action widget option"]},"Action Widget"),getRole:Q=>Q.kind==="action"?"option":"separator",getWidgetRole:()=>"listbox"}})),this._list.style(defaultListStyles),this._register(this._list.onMouseClick(Q=>this.onListClick(Q))),this._register(this._list.onMouseOver(Q=>this.onListHover(Q))),this._register(this._list.onDidChangeFocus(()=>this.onFocus())),this._register(this._list.onDidChangeSelection(Q=>this.onListSelection(Q))),this._allMenuItems=V,this._list.splice(0,this._list.length,this._allMenuItems),this._list.length&&this.focusNext()}focusCondition(C){return!C.disabled&&C.kind==="action"}hide(C){this._delegate.onHide(C),this.cts.cancel(),this._contextViewService.hideContextView()}layout(C){const W=this._allMenuItems.filter(J=>J.kind==="header").length,U=this._allMenuItems.length*this._actionLineHeight+W*this._headerLineHeight-W*this._actionLineHeight;this._list.layout(U);const G=this._allMenuItems.map((J,ee)=>{const te=document.getElementById(this._list.getElementID(ee));if(te){te.style.width="auto";const ie=te.getBoundingClientRect().width;return te.style.width="",ie}return 0}),Z=Math.max(...G,C),X=.7,Q=Math.min(U,document.body.clientHeight*X);return this._list.layout(Q,Z),this.domNode.style.height=`${Q}px`,this._list.domFocus(),Z}focusPrevious(){this._list.focusPrevious(1,!0,void 0,this.focusCondition)}focusNext(){this._list.focusNext(1,!0,void 0,this.focusCondition)}acceptSelected(C){const W=this._list.getFocus();if(W.length===0)return;const V=W[0],U=this._list.element(V);if(!this.focusCondition(U))return;const G=C?new PreviewSelectedEvent:new AcceptSelectedEvent;this._list.setSelection([V],G)}onListSelection(C){if(!C.elements.length)return;const W=C.elements[0];W.item&&this.focusCondition(W)?this._delegate.onSelect(W.item,C.browserEvent instanceof PreviewSelectedEvent):this._list.setSelection([])}onFocus(){var C,W;this._list.domFocus();const V=this._list.getFocus();if(V.length===0)return;const U=V[0],G=this._list.element(U);(W=(C=this._delegate).onFocus)===null||W===void 0||W.call(C,G.item)}onListHover(C){return __awaiter$11(this,void 0,void 0,function*(){const W=C.element;if(W&&W.item&&this.focusCondition(W)){if(this._delegate.onHover&&!W.disabled&&W.kind==="action"){const V=yield this._delegate.onHover(W.item,this.cts.token);W.canPreview=V?V.canPreview:void 0}C.index&&this._list.splice(C.index,1,[W])}this._list.setFocus(typeof C.index=="number"?[C.index]:[])})}onListClick(C){C.element&&this.focusCondition(C.element)&&this._list.setFocus([])}};ActionList=__decorate$1k([__param$1k(4,IContextViewService),__param$1k(5,IKeybindingService)],ActionList);function stripNewlines(K){return K.replace(/\r\n|\r|\n/g," ")}var __decorate$1j=globalThis&&globalThis.__decorate||function(K,C,W,V){var U=arguments.length,G=U<3?C:V===null?V=Object.getOwnPropertyDescriptor(C,W):V,Z;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")G=Reflect.decorate(K,C,W,V);else for(var X=K.length-1;X>=0;X--)(Z=K[X])&&(G=(U<3?Z(G):U>3?Z(C,W,G):Z(C,W))||G);return U>3&&G&&Object.defineProperty(C,W,G),G},__param$1j=globalThis&&globalThis.__param||function(K,C){return function(W,V){C(W,V,K)}};registerColor("actionBar.toggledBackground",{dark:inputActiveOptionBackground,light:inputActiveOptionBackground,hcDark:inputActiveOptionBackground,hcLight:inputActiveOptionBackground},localize("actionBar.toggledBackground","Background color for toggled action items in action bar."));const ActionWidgetContextKeys={Visible:new RawContextKey("codeActionMenuVisible",!1,localize("codeActionMenuVisible","Whether the action widget list is visible"))},IActionWidgetService=createDecorator("actionWidgetService");let ActionWidgetService=class extends Disposable{get isVisible(){return ActionWidgetContextKeys.Visible.getValue(this._contextKeyService)||!1}constructor(C,W,V){super(),this._contextViewService=C,this._contextKeyService=W,this._instantiationService=V,this._list=this._register(new MutableDisposable)}show(C,W,V,U,G,Z,X){const Q=ActionWidgetContextKeys.Visible.bindTo(this._contextKeyService),J=this._instantiationService.createInstance(ActionList,C,W,V,U);this._contextViewService.showContextView({getAnchor:()=>G,render:ee=>(Q.set(!0),this._renderWidget(ee,J,X??[])),onHide:ee=>{Q.reset(),this._onWidgetClosed(ee)}},Z,!1)}acceptSelected(C){var W;(W=this._list.value)===null||W===void 0||W.acceptSelected(C)}focusPrevious(){var C,W;(W=(C=this._list)===null||C===void 0?void 0:C.value)===null||W===void 0||W.focusPrevious()}focusNext(){var C,W;(W=(C=this._list)===null||C===void 0?void 0:C.value)===null||W===void 0||W.focusNext()}hide(){var C;(C=this._list.value)===null||C===void 0||C.hide(),this._list.clear()}_renderWidget(C,W,V){var U;const G=document.createElement("div");if(G.classList.add("action-widget"),C.appendChild(G),this._list.value=W,this._list.value)G.appendChild(this._list.value.domNode);else throw new Error("List has no value");const Z=new DisposableStore,X=document.createElement("div"),Q=C.appendChild(X);Q.classList.add("context-view-block"),Z.add(addDisposableListener(Q,EventType$1.MOUSE_DOWN,oe=>oe.stopPropagation()));const J=document.createElement("div"),ee=C.appendChild(J);ee.classList.add("context-view-pointerBlock"),Z.add(addDisposableListener(ee,EventType$1.POINTER_MOVE,()=>ee.remove())),Z.add(addDisposableListener(ee,EventType$1.MOUSE_DOWN,()=>ee.remove()));let te=0;if(V.length){const oe=this._createActionBar(".action-widget-action-bar",V);oe&&(G.appendChild(oe.getContainer().parentElement),Z.add(oe),te=oe.getContainer().offsetWidth)}const ie=(U=this._list.value)===null||U===void 0?void 0:U.layout(te);G.style.width=`${ie}px`;const ne=Z.add(trackFocus(C));return Z.add(ne.onDidBlur(()=>this.hide())),Z}_createActionBar(C,W){if(!W.length)return;const V=$$d(C),U=new ActionBar(V);return U.push(W,{icon:!1,label:!0}),U}_onWidgetClosed(C){var W;(W=this._list.value)===null||W===void 0||W.hide(C)}};ActionWidgetService=__decorate$1j([__param$1j(0,IContextViewService),__param$1j(1,IContextKeyService),__param$1j(2,IInstantiationService)],ActionWidgetService);registerSingleton(IActionWidgetService,ActionWidgetService,1);const weight$3=100+1e3;registerAction2(class extends Action2{constructor(){super({id:"hideCodeActionWidget",title:{value:localize("hideCodeActionWidget.title","Hide action widget"),original:"Hide action widget"},precondition:ActionWidgetContextKeys.Visible,keybinding:{weight:weight$3,primary:9,secondary:[1033]}})}run(K){K.get(IActionWidgetService).hide()}});registerAction2(class extends Action2{constructor(){super({id:"selectPrevCodeAction",title:{value:localize("selectPrevCodeAction.title","Select previous action"),original:"Select previous action"},precondition:ActionWidgetContextKeys.Visible,keybinding:{weight:weight$3,primary:16,secondary:[2064],mac:{primary:16,secondary:[2064,302]}}})}run(K){const C=K.get(IActionWidgetService);C instanceof ActionWidgetService&&C.focusPrevious()}});registerAction2(class extends Action2{constructor(){super({id:"selectNextCodeAction",title:{value:localize("selectNextCodeAction.title","Select next action"),original:"Select next action"},precondition:ActionWidgetContextKeys.Visible,keybinding:{weight:weight$3,primary:18,secondary:[2066],mac:{primary:18,secondary:[2066,300]}}})}run(K){const C=K.get(IActionWidgetService);C instanceof ActionWidgetService&&C.focusNext()}});registerAction2(class extends Action2{constructor(){super({id:acceptSelectedActionCommand,title:{value:localize("acceptSelected.title","Accept selected action"),original:"Accept selected action"},precondition:ActionWidgetContextKeys.Visible,keybinding:{weight:weight$3,primary:3,secondary:[2137]}})}run(K){const C=K.get(IActionWidgetService);C instanceof ActionWidgetService&&C.acceptSelected()}});registerAction2(class extends Action2{constructor(){super({id:previewSelectedActionCommand,title:{value:localize("previewSelected.title","Preview selected action"),original:"Preview selected action"},precondition:ActionWidgetContextKeys.Visible,keybinding:{weight:weight$3,primary:2051}})}run(K){const C=K.get(IActionWidgetService);C instanceof ActionWidgetService&&C.acceptSelected(!0)}});var __awaiter$10=globalThis&&globalThis.__awaiter||function(K,C,W,V){function U(G){return G instanceof W?G:new W(function(Z){Z(G)})}return new(W||(W=Promise))(function(G,Z){function X(ee){try{J(V.next(ee))}catch(te){Z(te)}}function Q(ee){try{J(V.throw(ee))}catch(te){Z(te)}}function J(ee){ee.done?G(ee.value):U(ee.value).then(X,Q)}J((V=V.apply(K,C||[])).next())})};const SUPPORTED_CODE_ACTIONS=new RawContextKey("supportedCodeAction","");class CodeActionOracle extends Disposable{constructor(C,W,V,U=250){super(),this._editor=C,this._markerService=W,this._signalChange=V,this._delay=U,this._autoTriggerTimer=this._register(new TimeoutTimer),this._register(this._markerService.onMarkerChanged(G=>this._onMarkerChanges(G))),this._register(this._editor.onDidChangeCursorPosition(()=>this._tryAutoTrigger()))}trigger(C){const W=this._getRangeOfSelectionUnlessWhitespaceEnclosed(C);this._signalChange(W?{trigger:C,selection:W}:void 0)}_onMarkerChanges(C){const W=this._editor.getModel();W&&C.some(V=>isEqual(V,W.uri))&&this._tryAutoTrigger()}_tryAutoTrigger(){this._autoTriggerTimer.cancelAndSet(()=>{this.trigger({type:2,triggerAction:CodeActionTriggerSource.Default})},this._delay)}_getRangeOfSelectionUnlessWhitespaceEnclosed(C){if(!this._editor.hasModel())return;const W=this._editor.getModel(),V=this._editor.getSelection();if(V.isEmpty()&&C.type===2){const{lineNumber:U,column:G}=V.getPosition(),Z=W.getLineContent(U);if(Z.length===0)return;if(G===1){if(/\s/.test(Z[0]))return}else if(G===W.getLineMaxColumn(U)){if(/\s/.test(Z[Z.length-1]))return}else if(/\s/.test(Z[G-2])&&/\s/.test(Z[G-1]))return}return V}}var CodeActionsState;(function(K){K.Empty={type:0};class C{constructor(V,U,G){this.trigger=V,this.position=U,this._cancellablePromise=G,this.type=1,this.actions=G.catch(Z=>{if(isCancellationError(Z))return emptyCodeActionSet;throw Z})}cancel(){this._cancellablePromise.cancel()}}K.Triggered=C})(CodeActionsState||(CodeActionsState={}));const emptyCodeActionSet=Object.freeze({allActions:[],validActions:[],dispose:()=>{},documentation:[],hasAutoFix:!1});class CodeActionModel extends Disposable{constructor(C,W,V,U,G,Z){super(),this._editor=C,this._registry=W,this._markerService=V,this._progressService=G,this._configurationService=Z,this._codeActionOracle=this._register(new MutableDisposable),this._state=CodeActionsState.Empty,this._onDidChangeState=this._register(new Emitter$1),this.onDidChangeState=this._onDidChangeState.event,this._disposed=!1,this._supportedCodeActions=SUPPORTED_CODE_ACTIONS.bindTo(U),this._register(this._editor.onDidChangeModel(()=>this._update())),this._register(this._editor.onDidChangeModelLanguage(()=>this._update())),this._register(this._registry.onDidChange(()=>this._update())),this._update()}dispose(){this._disposed||(this._disposed=!0,super.dispose(),this.setState(CodeActionsState.Empty,!0))}_settingEnabledNearbyQuickfixes(){var C;const W=(C=this._editor)===null||C===void 0?void 0:C.getModel();return this._configurationService?this._configurationService.getValue("editor.codeActionWidget.includeNearbyQuickfixes",{resource:W==null?void 0:W.uri}):!1}_update(){if(this._disposed)return;this._codeActionOracle.value=void 0,this.setState(CodeActionsState.Empty);const C=this._editor.getModel();if(C&&this._registry.has(C)&&!this._editor.getOption(90)){const W=this._registry.all(C).flatMap(V=>{var U;return(U=V.providedCodeActionKinds)!==null&&U!==void 0?U:[]});this._supportedCodeActions.set(W.join(" ")),this._codeActionOracle.value=new CodeActionOracle(this._editor,this._markerService,V=>{var U;if(!V){this.setState(CodeActionsState.Empty);return}const G=V.selection.getStartPosition(),Z=createCancelablePromise(X=>__awaiter$10(this,void 0,void 0,function*(){var Q,J,ee,te,ie,ne;if(this._settingEnabledNearbyQuickfixes()&&V.trigger.type===1&&(V.trigger.triggerAction===CodeActionTriggerSource.QuickFix||!((J=(Q=V.trigger.filter)===null||Q===void 0?void 0:Q.include)===null||J===void 0)&&J.contains(CodeActionKind.QuickFix))){const oe=yield getCodeActions(this._registry,C,V.selection,V.trigger,Progress.None,X);if(X.isCancellationRequested)return emptyCodeActionSet;if(!((ee=oe.validActions)===null||ee===void 0?void 0:ee.some(ae=>ae.action.kind?CodeActionKind.QuickFix.contains(new CodeActionKind(ae.action.kind)):!1))){const ae=this._markerService.read({resource:C.uri});if(ae.length>0){const se=V.selection.getPosition();let le=se,ce=Number.MAX_VALUE,de=!1;for(const ue of ae){const ge=ue.endColumn,he=ue.endLineNumber,fe=ue.startLineNumber;(he===se.lineNumber||fe===se.lineNumber)&&Math.abs(se.column-ge)<ce&&(ce=Math.abs(se.column-ge),de=!0,le=new Position$1(he,ge))}if(de){const ue={type:V.trigger.type,triggerAction:V.trigger.triggerAction,filter:{include:!((te=V.trigger.filter)===null||te===void 0)&&te.include?(ie=V.trigger.filter)===null||ie===void 0?void 0:ie.include:CodeActionKind.QuickFix},autoApply:V.trigger.autoApply,context:{notAvailableMessage:((ne=V.trigger.context)===null||ne===void 0?void 0:ne.notAvailableMessage)||"",position:le}},ge=new Selection$1(le.lineNumber,le.column,le.lineNumber,le.column),he=yield getCodeActions(this._registry,C,ge,ue,Progress.None,X),fe=[...oe.validActions];return he.validActions.length!==0&&(he.validActions.forEach(pe=>{pe.highlightRange=pe.action.isPreferred}),fe.push(...he.validActions)),{validActions:fe,allActions:oe.allActions,documentation:oe.documentation,hasAutoFix:oe.hasAutoFix,dispose:()=>{oe.dispose()}}}}}}return getCodeActions(this._registry,C,V.selection,V.trigger,Progress.None,X)}));V.trigger.type===1&&((U=this._progressService)===null||U===void 0||U.showWhile(Z,250)),this.setState(new CodeActionsState.Triggered(V.trigger,G,Z))},void 0),this._codeActionOracle.value.trigger({type:2,triggerAction:CodeActionTriggerSource.Default})}else this._supportedCodeActions.reset()}trigger(C){var W;(W=this._codeActionOracle.value)===null||W===void 0||W.trigger(C)}setState(C,W){C!==this._state&&(this._state.type===1&&this._state.cancel(),this._state=C,!W&&!this._disposed&&this._onDidChangeState.fire(C))}}var __decorate$1i=globalThis&&globalThis.__decorate||function(K,C,W,V){var U=arguments.length,G=U<3?C:V===null?V=Object.getOwnPropertyDescriptor(C,W):V,Z;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")G=Reflect.decorate(K,C,W,V);else for(var X=K.length-1;X>=0;X--)(Z=K[X])&&(G=(U<3?Z(G):U>3?Z(C,W,G):Z(C,W))||G);return U>3&&G&&Object.defineProperty(C,W,G),G},__param$1i=globalThis&&globalThis.__param||function(K,C){return function(W,V){C(W,V,K)}},__awaiter$$=globalThis&&globalThis.__awaiter||function(K,C,W,V){function U(G){return G instanceof W?G:new W(function(Z){Z(G)})}return new(W||(W=Promise))(function(G,Z){function X(ee){try{J(V.next(ee))}catch(te){Z(te)}}function Q(ee){try{J(V.throw(ee))}catch(te){Z(te)}}function J(ee){ee.done?G(ee.value):U(ee.value).then(X,Q)}J((V=V.apply(K,C||[])).next())})},CodeActionController_1;const DECORATION_CLASS_NAME$1="quickfix-edit-highlight";let CodeActionController=CodeActionController_1=class extends Disposable{static get(C){return C.getContribution(CodeActionController_1.ID)}constructor(C,W,V,U,G,Z,X,Q,J,ee){super(),this._commandService=X,this._configurationService=Q,this._actionWidgetService=J,this._instantiationService=ee,this._activeCodeActions=this._register(new MutableDisposable),this._showDisabled=!1,this._disposed=!1,this._editor=C,this._model=this._register(new CodeActionModel(this._editor,G.codeActionProvider,W,V,Z,Q)),this._register(this._model.onDidChangeState(te=>this.update(te))),this._lightBulbWidget=new Lazy(()=>{const te=this._editor.getContribution(LightBulbWidget.ID);return te&&this._register(te.onClick(ie=>this.showCodeActionList(ie.actions,ie,{includeDisabledActions:!1,fromLightbulb:!0}))),te}),this._resolver=U.createInstance(CodeActionKeybindingResolver),this._register(this._editor.onDidLayoutChange(()=>this._actionWidgetService.hide()))}dispose(){this._disposed=!0,super.dispose()}showCodeActions(C,W,V){return this.showCodeActionList(W,V,{includeDisabledActions:!1,fromLightbulb:!1})}manualTriggerAtCurrentPosition(C,W,V,U){var G;if(!this._editor.hasModel())return;(G=MessageController.get(this._editor))===null||G===void 0||G.closeMessage();const Z=this._editor.getPosition();this._trigger({type:1,triggerAction:W,filter:V,autoApply:U,context:{notAvailableMessage:C,position:Z}})}_trigger(C){return this._model.trigger(C)}_applyCodeAction(C,W,V){return __awaiter$$(this,void 0,void 0,function*(){try{yield this._instantiationService.invokeFunction(applyCodeAction,C,ApplyCodeActionReason.FromCodeActions,{preview:V,editor:this._editor})}finally{W&&this._trigger({type:2,triggerAction:CodeActionTriggerSource.QuickFix,filter:{}})}})}update(C){var W,V,U,G,Z,X,Q;return __awaiter$$(this,void 0,void 0,function*(){if(C.type!==1){(W=this._lightBulbWidget.rawValue)===null||W===void 0||W.hide();return}let J;try{J=yield C.actions}catch(ee){onUnexpectedError(ee);return}if(!this._disposed)if((V=this._lightBulbWidget.value)===null||V===void 0||V.update(J,C.trigger,C.position),C.trigger.type===1){if(!((U=C.trigger.filter)===null||U===void 0)&&U.include){const te=this.tryGetValidActionToApply(C.trigger,J);if(te){try{(G=this._lightBulbWidget.value)===null||G===void 0||G.hide(),yield this._applyCodeAction(te,!1,!1)}finally{J.dispose()}return}if(C.trigger.context){const ie=this.getInvalidActionThatWouldHaveBeenApplied(C.trigger,J);if(ie&&ie.action.disabled){(Z=MessageController.get(this._editor))===null||Z===void 0||Z.showMessage(ie.action.disabled,C.trigger.context.position),J.dispose();return}}}const ee=!!(!((X=C.trigger.filter)===null||X===void 0)&&X.include);if(C.trigger.context&&(!J.allActions.length||!ee&&!J.validActions.length)){(Q=MessageController.get(this._editor))===null||Q===void 0||Q.showMessage(C.trigger.context.notAvailableMessage,C.trigger.context.position),this._activeCodeActions.value=J,J.dispose();return}this._activeCodeActions.value=J,this.showCodeActionList(J,this.toCoords(C.position),{includeDisabledActions:ee,fromLightbulb:!1})}else this._actionWidgetService.isVisible?J.dispose():this._activeCodeActions.value=J})}getInvalidActionThatWouldHaveBeenApplied(C,W){if(W.allActions.length&&(C.autoApply==="first"&&W.validActions.length===0||C.autoApply==="ifSingle"&&W.allActions.length===1))return W.allActions.find(({action:V})=>V.disabled)}tryGetValidActionToApply(C,W){if(W.validActions.length&&(C.autoApply==="first"&&W.validActions.length>0||C.autoApply==="ifSingle"&&W.validActions.length===1))return W.validActions[0]}showCodeActionList(C,W,V){return __awaiter$$(this,void 0,void 0,function*(){const U=this._editor.createDecorationsCollection(),G=this._editor.getDomNode();if(!G)return;const Z=V.includeDisabledActions&&(this._showDisabled||C.validActions.length===0)?C.allActions:C.validActions;if(!Z.length)return;const X=Position$1.isIPosition(W)?this.toCoords(W):W,Q={onSelect:(J,ee)=>__awaiter$$(this,void 0,void 0,function*(){this._applyCodeAction(J,!0,!!ee),this._actionWidgetService.hide(),U.clear()}),onHide:()=>{var J;(J=this._editor)===null||J===void 0||J.focus(),U.clear()},onHover:(J,ee)=>__awaiter$$(this,void 0,void 0,function*(){var te;if(yield J.resolve(ee),!ee.isCancellationRequested)return{canPreview:!!(!((te=J.action.edit)===null||te===void 0)&&te.edits.length)}}),onFocus:J=>{var ee,te;if(J&&J.highlightRange&&J.action.diagnostics){const ie=[{range:J.action.diagnostics[0],options:CodeActionController_1.DECORATION}];U.set(ie);const ne=J.action.diagnostics[0],oe=(te=(ee=this._editor.getModel())===null||ee===void 0?void 0:ee.getWordAtPosition({lineNumber:ne.startLineNumber,column:ne.startColumn}))===null||te===void 0?void 0:te.word;status(localize("editingNewSelection","Context: {0} at line {1} and column {2}.",oe,ne.startLineNumber,ne.startColumn))}else U.clear()}};this._actionWidgetService.show("codeActionWidget",!0,toMenuItems(Z,this._shouldShowHeaders(),this._resolver.getResolver()),Q,X,G,this._getActionBarActions(C,W,V))})}toCoords(C){if(!this._editor.hasModel())return{x:0,y:0};this._editor.revealPosition(C,1),this._editor.render();const W=this._editor.getScrolledVisiblePosition(C),V=getDomNodePagePosition(this._editor.getDomNode()),U=V.left+W.left,G=V.top+W.top+W.height;return{x:U,y:G}}_shouldShowHeaders(){var C;const W=(C=this._editor)===null||C===void 0?void 0:C.getModel();return this._configurationService.getValue("editor.codeActionWidget.showHeaders",{resource:W==null?void 0:W.uri})}_getActionBarActions(C,W,V){if(V.fromLightbulb)return[];const U=C.documentation.map(G=>{var Z;return{id:G.id,label:G.title,tooltip:(Z=G.tooltip)!==null&&Z!==void 0?Z:"",class:void 0,enabled:!0,run:()=>{var X;return this._commandService.executeCommand(G.id,...(X=G.arguments)!==null&&X!==void 0?X:[])}}});return V.includeDisabledActions&&C.validActions.length>0&&C.allActions.length!==C.validActions.length&&U.push(this._showDisabled?{id:"hideMoreActions",label:localize("hideMoreActions","Hide Disabled"),enabled:!0,tooltip:"",class:void 0,run:()=>(this._showDisabled=!1,this.showCodeActionList(C,W,V))}:{id:"showMoreActions",label:localize("showMoreActions","Show Disabled"),enabled:!0,tooltip:"",class:void 0,run:()=>(this._showDisabled=!0,this.showCodeActionList(C,W,V))}),U}};CodeActionController.ID="editor.contrib.codeActionController";CodeActionController.DECORATION=ModelDecorationOptions.register({description:"quickfix-highlight",className:DECORATION_CLASS_NAME$1});CodeActionController=CodeActionController_1=__decorate$1i([__param$1i(1,IMarkerService),__param$1i(2,IContextKeyService),__param$1i(3,IInstantiationService),__param$1i(4,ILanguageFeaturesService),__param$1i(5,IEditorProgressService),__param$1i(6,ICommandService),__param$1i(7,IConfigurationService),__param$1i(8,IActionWidgetService),__param$1i(9,IInstantiationService)],CodeActionController);registerThemingParticipant((K,C)=>{((U,G)=>{G&&C.addRule(`.monaco-editor ${U} { background-color: ${G}; }`)})(".quickfix-edit-highlight",K.getColor(editorFindMatchHighlight));const V=K.getColor(editorFindMatchHighlightBorder);V&&C.addRule(`.monaco-editor .quickfix-edit-highlight { border: 1px ${isHighContrast(K.type)?"dotted":"solid"} ${V}; box-sizing: border-box; }`)});function contextKeyForSupportedActions(K){return ContextKeyExpr.regex(SUPPORTED_CODE_ACTIONS.keys()[0],new RegExp("(\\s|^)"+escapeRegExpCharacters(K.value)+"\\b"))}const argsSchema={type:"object",defaultSnippets:[{body:{kind:""}}],properties:{kind:{type:"string",description:localize("args.schema.kind","Kind of the code action to run.")},apply:{type:"string",description:localize("args.schema.apply","Controls when the returned actions are applied."),default:"ifSingle",enum:["first","ifSingle","never"],enumDescriptions:[localize("args.schema.apply.first","Always apply the first returned code action."),localize("args.schema.apply.ifSingle","Apply the first returned code action if it is the only one."),localize("args.schema.apply.never","Do not apply the returned code actions.")]},preferred:{type:"boolean",default:!1,description:localize("args.schema.preferred","Controls if only preferred code actions should be returned.")}}};function triggerCodeActionsForEditorSelection(K,C,W,V,U=CodeActionTriggerSource.Default){if(K.hasModel()){const G=CodeActionController.get(K);G==null||G.manualTriggerAtCurrentPosition(C,U,W,V)}}class QuickFixAction extends EditorAction{constructor(){super({id:quickFixCommandId,label:localize("quickfix.trigger.label","Quick Fix..."),alias:"Quick Fix...",precondition:ContextKeyExpr.and(EditorContextKeys.writable,EditorContextKeys.hasCodeActionsProvider),kbOpts:{kbExpr:EditorContextKeys.textInputFocus,primary:2137,weight:100}})}run(C,W){return triggerCodeActionsForEditorSelection(W,localize("editor.action.quickFix.noneMessage","No code actions available"),void 0,void 0,CodeActionTriggerSource.QuickFix)}}class CodeActionCommand extends EditorCommand{constructor(){super({id:codeActionCommandId,precondition:ContextKeyExpr.and(EditorContextKeys.writable,EditorContextKeys.hasCodeActionsProvider),description:{description:"Trigger a code action",args:[{name:"args",schema:argsSchema}]}})}runEditorCommand(C,W,V){const U=CodeActionCommandArgs.fromUser(V,{kind:CodeActionKind.Empty,apply:"ifSingle"});return triggerCodeActionsForEditorSelection(W,typeof(V==null?void 0:V.kind)=="string"?U.preferred?localize("editor.action.codeAction.noneMessage.preferred.kind","No preferred code actions for '{0}' available",V.kind):localize("editor.action.codeAction.noneMessage.kind","No code actions for '{0}' available",V.kind):U.preferred?localize("editor.action.codeAction.noneMessage.preferred","No preferred code actions available"):localize("editor.action.codeAction.noneMessage","No code actions available"),{include:U.kind,includeSourceActions:!0,onlyIncludePreferredActions:U.preferred},U.apply)}}class RefactorAction extends EditorAction{constructor(){super({id:refactorCommandId,label:localize("refactor.label","Refactor..."),alias:"Refactor...",precondition:ContextKeyExpr.and(EditorContextKeys.writable,EditorContextKeys.hasCodeActionsProvider),kbOpts:{kbExpr:EditorContextKeys.textInputFocus,primary:3120,mac:{primary:1328},weight:100},contextMenuOpts:{group:"1_modification",order:2,when:ContextKeyExpr.and(EditorContextKeys.writable,contextKeyForSupportedActions(CodeActionKind.Refactor))},description:{description:"Refactor...",args:[{name:"args",schema:argsSchema}]}})}run(C,W,V){const U=CodeActionCommandArgs.fromUser(V,{kind:CodeActionKind.Refactor,apply:"never"});return triggerCodeActionsForEditorSelection(W,typeof(V==null?void 0:V.kind)=="string"?U.preferred?localize("editor.action.refactor.noneMessage.preferred.kind","No preferred refactorings for '{0}' available",V.kind):localize("editor.action.refactor.noneMessage.kind","No refactorings for '{0}' available",V.kind):U.preferred?localize("editor.action.refactor.noneMessage.preferred","No preferred refactorings available"):localize("editor.action.refactor.noneMessage","No refactorings available"),{include:CodeActionKind.Refactor.contains(U.kind)?U.kind:CodeActionKind.None,onlyIncludePreferredActions:U.preferred},U.apply,CodeActionTriggerSource.Refactor)}}class SourceAction extends EditorAction{constructor(){super({id:sourceActionCommandId,label:localize("source.label","Source Action..."),alias:"Source Action...",precondition:ContextKeyExpr.and(EditorContextKeys.writable,EditorContextKeys.hasCodeActionsProvider),contextMenuOpts:{group:"1_modification",order:2.1,when:ContextKeyExpr.and(EditorContextKeys.writable,contextKeyForSupportedActions(CodeActionKind.Source))},description:{description:"Source Action...",args:[{name:"args",schema:argsSchema}]}})}run(C,W,V){const U=CodeActionCommandArgs.fromUser(V,{kind:CodeActionKind.Source,apply:"never"});return triggerCodeActionsForEditorSelection(W,typeof(V==null?void 0:V.kind)=="string"?U.preferred?localize("editor.action.source.noneMessage.preferred.kind","No preferred source actions for '{0}' available",V.kind):localize("editor.action.source.noneMessage.kind","No source actions for '{0}' available",V.kind):U.preferred?localize("editor.action.source.noneMessage.preferred","No preferred source actions available"):localize("editor.action.source.noneMessage","No source actions available"),{include:CodeActionKind.Source.contains(U.kind)?U.kind:CodeActionKind.None,includeSourceActions:!0,onlyIncludePreferredActions:U.preferred},U.apply,CodeActionTriggerSource.SourceAction)}}class OrganizeImportsAction extends EditorAction{constructor(){super({id:organizeImportsCommandId,label:localize("organizeImports.label","Organize Imports"),alias:"Organize Imports",precondition:ContextKeyExpr.and(EditorContextKeys.writable,contextKeyForSupportedActions(CodeActionKind.SourceOrganizeImports)),kbOpts:{kbExpr:EditorContextKeys.textInputFocus,primary:1581,weight:100}})}run(C,W){return triggerCodeActionsForEditorSelection(W,localize("editor.action.organize.noneMessage","No organize imports action available"),{include:CodeActionKind.SourceOrganizeImports,includeSourceActions:!0},"ifSingle",CodeActionTriggerSource.OrganizeImports)}}class FixAllAction extends EditorAction{constructor(){super({id:fixAllCommandId,label:localize("fixAll.label","Fix All"),alias:"Fix All",precondition:ContextKeyExpr.and(EditorContextKeys.writable,contextKeyForSupportedActions(CodeActionKind.SourceFixAll))})}run(C,W){return triggerCodeActionsForEditorSelection(W,localize("fixAll.noneMessage","No fix all action available"),{include:CodeActionKind.SourceFixAll,includeSourceActions:!0},"ifSingle",CodeActionTriggerSource.FixAll)}}class AutoFixAction extends EditorAction{constructor(){super({id:autoFixCommandId,label:localize("autoFix.label","Auto Fix..."),alias:"Auto Fix...",precondition:ContextKeyExpr.and(EditorContextKeys.writable,contextKeyForSupportedActions(CodeActionKind.QuickFix)),kbOpts:{kbExpr:EditorContextKeys.textInputFocus,primary:1625,mac:{primary:2649},weight:100}})}run(C,W){return triggerCodeActionsForEditorSelection(W,localize("editor.action.autoFix.noneMessage","No auto fixes available"),{include:CodeActionKind.QuickFix,onlyIncludePreferredActions:!0},"ifSingle",CodeActionTriggerSource.AutoFix)}}registerEditorContribution(CodeActionController.ID,CodeActionController,3);registerEditorContribution(LightBulbWidget.ID,LightBulbWidget,4);registerEditorAction(QuickFixAction);registerEditorAction(RefactorAction);registerEditorAction(SourceAction);registerEditorAction(OrganizeImportsAction);registerEditorAction(AutoFixAction);registerEditorAction(FixAllAction);registerEditorCommand(new CodeActionCommand);Registry.as(Extensions$6.Configuration).registerConfiguration(Object.assign(Object.assign({},editorConfigurationBaseNode),{properties:{"editor.codeActionWidget.showHeaders":{type:"boolean",scope:5,description:localize("showCodeActionHeaders","Enable/disable showing group headers in the Code Action menu."),default:!0}}}));Registry.as(Extensions$6.Configuration).registerConfiguration(Object.assign(Object.assign({},editorConfigurationBaseNode),{properties:{"editor.codeActionWidget.includeNearbyQuickfixes":{type:"boolean",scope:5,description:localize("includeNearbyQuickfixes","Enable/disable showing nearest quickfix within a line when not currently on a diagnostic."),default:!1}}}));var __awaiter$_=globalThis&&globalThis.__awaiter||function(K,C,W,V){function U(G){return G instanceof W?G:new W(function(Z){Z(G)})}return new(W||(W=Promise))(function(G,Z){function X(ee){try{J(V.next(ee))}catch(te){Z(te)}}function Q(ee){try{J(V.throw(ee))}catch(te){Z(te)}}function J(ee){ee.done?G(ee.value):U(ee.value).then(X,Q)}J((V=V.apply(K,C||[])).next())})};class CodeLensModel{constructor(){this.lenses=[],this._disposables=new DisposableStore}dispose(){this._disposables.dispose()}get isDisposed(){return this._disposables.isDisposed}add(C,W){this._disposables.add(C);for(const V of C.lenses)this.lenses.push({symbol:V,provider:W})}}function getCodeLensModel(K,C,W){return __awaiter$_(this,void 0,void 0,function*(){const V=K.ordered(C),U=new Map,G=new CodeLensModel,Z=V.map((X,Q)=>__awaiter$_(this,void 0,void 0,function*(){U.set(X,Q);try{const J=yield Promise.resolve(X.provideCodeLenses(C,W));J&&G.add(J,X)}catch(J){onUnexpectedExternalError(J)}}));return yield Promise.all(Z),G.lenses=G.lenses.sort((X,Q)=>X.symbol.range.startLineNumber<Q.symbol.range.startLineNumber?-1:X.symbol.range.startLineNumber>Q.symbol.range.startLineNumber?1:U.get(X.provider)<U.get(Q.provider)?-1:U.get(X.provider)>U.get(Q.provider)?1:X.symbol.range.startColumn<Q.symbol.range.startColumn?-1:X.symbol.range.startColumn>Q.symbol.range.startColumn?1:0),G})}CommandsRegistry.registerCommand("_executeCodeLensProvider",function(K,...C){let[W,V]=C;assertType(URI.isUri(W)),assertType(typeof V=="number"||!V);const{codeLensProvider:U}=K.get(ILanguageFeaturesService),G=K.get(IModelService).getModel(W);if(!G)throw illegalArgument();const Z=[],X=new DisposableStore;return getCodeLensModel(U,G,CancellationToken.None).then(Q=>{X.add(Q);const J=[];for(const ee of Q.lenses)V==null||ee.symbol.command?Z.push(ee.symbol):V-- >0&&ee.provider.resolveCodeLens&&J.push(Promise.resolve(ee.provider.resolveCodeLens(G,ee.symbol,CancellationToken.None)).then(te=>Z.push(te||ee.symbol)));return Promise.all(J)}).then(()=>Z).finally(()=>{setTimeout(()=>X.dispose(),100)})});var __decorate$1h=globalThis&&globalThis.__decorate||function(K,C,W,V){var U=arguments.length,G=U<3?C:V===null?V=Object.getOwnPropertyDescriptor(C,W):V,Z;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")G=Reflect.decorate(K,C,W,V);else for(var X=K.length-1;X>=0;X--)(Z=K[X])&&(G=(U<3?Z(G):U>3?Z(C,W,G):Z(C,W))||G);return U>3&&G&&Object.defineProperty(C,W,G),G},__param$1h=globalThis&&globalThis.__param||function(K,C){return function(W,V){C(W,V,K)}};const ICodeLensCache=createDecorator("ICodeLensCache");class CacheItem{constructor(C,W){this.lineCount=C,this.data=W}}let CodeLensCache=class{constructor(C){this._fakeProvider=new class{provideCodeLenses(){throw new Error("not supported")}},this._cache=new LRUCache(20,.75);const W="codelens/cache";runWhenIdle(()=>C.remove(W,1));const V="codelens/cache2",U=C.get(V,1,"{}");this._deserialize(U),Event$1.once(C.onWillSaveState)(G=>{G.reason===WillSaveStateReason.SHUTDOWN&&C.store(V,this._serialize(),1,1)})}put(C,W){const V=W.lenses.map(Z=>{var X;return{range:Z.symbol.range,command:Z.symbol.command&&{id:"",title:(X=Z.symbol.command)===null||X===void 0?void 0:X.title}}}),U=new CodeLensModel;U.add({lenses:V,dispose:()=>{}},this._fakeProvider);const G=new CacheItem(C.getLineCount(),U);this._cache.set(C.uri.toString(),G)}get(C){const W=this._cache.get(C.uri.toString());return W&&W.lineCount===C.getLineCount()?W.data:void 0}delete(C){this._cache.delete(C.uri.toString())}_serialize(){const C=Object.create(null);for(const[W,V]of this._cache){const U=new Set;for(const G of V.data.lenses)U.add(G.symbol.range.startLineNumber);C[W]={lineCount:V.lineCount,lines:[...U.values()]}}return JSON.stringify(C)}_deserialize(C){try{const W=JSON.parse(C);for(const V in W){const U=W[V],G=[];for(const X of U.lines)G.push({range:new Range$2(X,1,X,11)});const Z=new CodeLensModel;Z.add({lenses:G,dispose(){}},this._fakeProvider),this._cache.set(V,new CacheItem(U.lineCount,Z))}}catch{}}};CodeLensCache=__decorate$1h([__param$1h(0,IStorageService)],CodeLensCache);registerSingleton(ICodeLensCache,CodeLensCache,1);const codelensWidget="";class CodeLensViewZone{constructor(C,W,V){this.afterColumn=1073741824,this.afterLineNumber=C,this.heightInPx=W,this._onHeight=V,this.suppressMouseDown=!0,this.domNode=document.createElement("div")}onComputedHeight(C){this._lastHeight===void 0?this._lastHeight=C:this._lastHeight!==C&&(this._lastHeight=C,this._onHeight())}isVisible(){return this._lastHeight!==0&&this.domNode.hasAttribute("monaco-visible-view-zone")}}class CodeLensContentWidget{constructor(C,W){this.allowEditorOverflow=!1,this.suppressMouseDown=!0,this._commands=new Map,this._isEmpty=!0,this._editor=C,this._id=`codelens.widget-${CodeLensContentWidget._idPool++}`,this.updatePosition(W),this._domNode=document.createElement("span"),this._domNode.className="codelens-decoration"}withCommands(C,W){this._commands.clear();const V=[];let U=!1;for(let G=0;G<C.length;G++){const Z=C[G];if(Z&&(U=!0,Z.command)){const X=renderLabelWithIcons(Z.command.title.trim());Z.command.id?(V.push($$d("a",{id:String(G),title:Z.command.tooltip,role:"button"},...X)),this._commands.set(String(G),Z.command)):V.push($$d("span",{title:Z.command.tooltip},...X)),G+1<C.length&&V.push($$d("span",void 0," | "))}}U?(reset(this._domNode,...V),this._isEmpty&&W&&this._domNode.classList.add("fadein"),this._isEmpty=!1):reset(this._domNode,$$d("span",void 0,"no commands"))}getCommand(C){return C.parentElement===this._domNode?this._commands.get(C.id):void 0}getId(){return this._id}getDomNode(){return this._domNode}updatePosition(C){const W=this._editor.getModel().getLineFirstNonWhitespaceColumn(C);this._widgetPosition={position:{lineNumber:C,column:W},preference:[1]}}getPosition(){return this._widgetPosition||null}}CodeLensContentWidget._idPool=0;class CodeLensHelper{constructor(){this._removeDecorations=[],this._addDecorations=[],this._addDecorationsCallbacks=[]}addDecoration(C,W){this._addDecorations.push(C),this._addDecorationsCallbacks.push(W)}removeDecoration(C){this._removeDecorations.push(C)}commit(C){const W=C.deltaDecorations(this._removeDecorations,this._addDecorations);for(let V=0,U=W.length;V<U;V++)this._addDecorationsCallbacks[V](W[V])}}const codeLensDecorationOptions=ModelDecorationOptions.register({collapseOnReplaceEdit:!0,description:"codelens"});class CodeLensWidget{constructor(C,W,V,U,G,Z){this._isDisposed=!1,this._editor=W,this._data=C,this._decorationIds=[];let X;const Q=[];this._data.forEach((J,ee)=>{J.symbol.command&&Q.push(J.symbol),V.addDecoration({range:J.symbol.range,options:codeLensDecorationOptions},te=>this._decorationIds[ee]=te),X?X=Range$2.plusRange(X,J.symbol.range):X=Range$2.lift(J.symbol.range)}),this._viewZone=new CodeLensViewZone(X.startLineNumber-1,G,Z),this._viewZoneId=U.addZone(this._viewZone),Q.length>0&&(this._createContentWidgetIfNecessary(),this._contentWidget.withCommands(Q,!1))}_createContentWidgetIfNecessary(){this._contentWidget?this._editor.layoutContentWidget(this._contentWidget):(this._contentWidget=new CodeLensContentWidget(this._editor,this._viewZone.afterLineNumber+1),this._editor.addContentWidget(this._contentWidget))}dispose(C,W){this._decorationIds.forEach(C.removeDecoration,C),this._decorationIds=[],W==null||W.removeZone(this._viewZoneId),this._contentWidget&&(this._editor.removeContentWidget(this._contentWidget),this._contentWidget=void 0),this._isDisposed=!0}isDisposed(){return this._isDisposed}isValid(){return this._decorationIds.some((C,W)=>{const V=this._editor.getModel().getDecorationRange(C),U=this._data[W].symbol;return!!(V&&Range$2.isEmpty(U.range)===V.isEmpty())})}updateCodeLensSymbols(C,W){this._decorationIds.forEach(W.removeDecoration,W),this._decorationIds=[],this._data=C,this._data.forEach((V,U)=>{W.addDecoration({range:V.symbol.range,options:codeLensDecorationOptions},G=>this._decorationIds[U]=G)})}updateHeight(C,W){this._viewZone.heightInPx=C,W.layoutZone(this._viewZoneId),this._contentWidget&&this._editor.layoutContentWidget(this._contentWidget)}computeIfNecessary(C){if(!this._viewZone.isVisible())return null;for(let W=0;W<this._decorationIds.length;W++){const V=C.getDecorationRange(this._decorationIds[W]);V&&(this._data[W].symbol.range=V)}return this._data}updateCommands(C){this._createContentWidgetIfNecessary(),this._contentWidget.withCommands(C,!0);for(let W=0;W<this._data.length;W++){const V=C[W];if(V){const{symbol:U}=this._data[W];U.command=V.command||U.command}}}getCommand(C){var W;return(W=this._contentWidget)===null||W===void 0?void 0:W.getCommand(C)}getLineNumber(){const C=this._editor.getModel().getDecorationRange(this._decorationIds[0]);return C?C.startLineNumber:-1}update(C){if(this.isValid()){const W=this._editor.getModel().getDecorationRange(this._decorationIds[0]);W&&(this._viewZone.afterLineNumber=W.startLineNumber-1,C.layoutZone(this._viewZoneId),this._contentWidget&&(this._contentWidget.updatePosition(W.startLineNumber),this._editor.layoutContentWidget(this._contentWidget)))}}}var __decorate$1g=globalThis&&globalThis.__decorate||function(K,C,W,V){var U=arguments.length,G=U<3?C:V===null?V=Object.getOwnPropertyDescriptor(C,W):V,Z;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")G=Reflect.decorate(K,C,W,V);else for(var X=K.length-1;X>=0;X--)(Z=K[X])&&(G=(U<3?Z(G):U>3?Z(C,W,G):Z(C,W))||G);return U>3&&G&&Object.defineProperty(C,W,G),G},__param$1g=globalThis&&globalThis.__param||function(K,C){return function(W,V){C(W,V,K)}},__awaiter$Z=globalThis&&globalThis.__awaiter||function(K,C,W,V){function U(G){return G instanceof W?G:new W(function(Z){Z(G)})}return new(W||(W=Promise))(function(G,Z){function X(ee){try{J(V.next(ee))}catch(te){Z(te)}}function Q(ee){try{J(V.throw(ee))}catch(te){Z(te)}}function J(ee){ee.done?G(ee.value):U(ee.value).then(X,Q)}J((V=V.apply(K,C||[])).next())})};let CodeLensContribution=class{constructor(C,W,V,U,G,Z){this._editor=C,this._languageFeaturesService=W,this._commandService=U,this._notificationService=G,this._codeLensCache=Z,this._disposables=new DisposableStore,this._localToDispose=new DisposableStore,this._lenses=[],this._oldCodeLensModels=new DisposableStore,this._provideCodeLensDebounce=V.for(W.codeLensProvider,"CodeLensProvide",{min:250}),this._resolveCodeLensesDebounce=V.for(W.codeLensProvider,"CodeLensResolve",{min:250,salt:"resolve"}),this._resolveCodeLensesScheduler=new RunOnceScheduler(()=>this._resolveCodeLensesInViewport(),this._resolveCodeLensesDebounce.default()),this._disposables.add(this._editor.onDidChangeModel(()=>this._onModelChange())),this._disposables.add(this._editor.onDidChangeModelLanguage(()=>this._onModelChange())),this._disposables.add(this._editor.onDidChangeConfiguration(X=>{(X.hasChanged(50)||X.hasChanged(19)||X.hasChanged(18))&&this._updateLensStyle(),X.hasChanged(17)&&this._onModelChange()})),this._disposables.add(W.codeLensProvider.onDidChange(this._onModelChange,this)),this._onModelChange(),this._updateLensStyle()}dispose(){var C;this._localDispose(),this._disposables.dispose(),this._oldCodeLensModels.dispose(),(C=this._currentCodeLensModel)===null||C===void 0||C.dispose()}_getLayoutInfo(){const C=Math.max(1.3,this._editor.getOption(66)/this._editor.getOption(52));let W=this._editor.getOption(19);return(!W||W<5)&&(W=this._editor.getOption(52)*.9|0),{fontSize:W,codeLensHeight:W*C|0}}_updateLensStyle(){const{codeLensHeight:C,fontSize:W}=this._getLayoutInfo(),V=this._editor.getOption(18),U=this._editor.getOption(50),{style:G}=this._editor.getContainerDomNode();G.setProperty("--vscode-editorCodeLens-lineHeight",`${C}px`),G.setProperty("--vscode-editorCodeLens-fontSize",`${W}px`),G.setProperty("--vscode-editorCodeLens-fontFeatureSettings",U.fontFeatureSettings),V&&(G.setProperty("--vscode-editorCodeLens-fontFamily",V),G.setProperty("--vscode-editorCodeLens-fontFamilyDefault",EDITOR_FONT_DEFAULTS.fontFamily)),this._editor.changeViewZones(Z=>{for(const X of this._lenses)X.updateHeight(C,Z)})}_localDispose(){var C,W,V;(C=this._getCodeLensModelPromise)===null||C===void 0||C.cancel(),this._getCodeLensModelPromise=void 0,(W=this._resolveCodeLensesPromise)===null||W===void 0||W.cancel(),this._resolveCodeLensesPromise=void 0,this._localToDispose.clear(),this._oldCodeLensModels.clear(),(V=this._currentCodeLensModel)===null||V===void 0||V.dispose()}_onModelChange(){this._localDispose();const C=this._editor.getModel();if(!C||!this._editor.getOption(17)||C.isTooLargeForTokenization())return;const W=this._codeLensCache.get(C);if(W&&this._renderCodeLensSymbols(W),!this._languageFeaturesService.codeLensProvider.has(C)){W&&this._localToDispose.add(disposableTimeout(()=>{const U=this._codeLensCache.get(C);W===U&&(this._codeLensCache.delete(C),this._onModelChange())},30*1e3));return}for(const U of this._languageFeaturesService.codeLensProvider.all(C))if(typeof U.onDidChange=="function"){const G=U.onDidChange(()=>V.schedule());this._localToDispose.add(G)}const V=new RunOnceScheduler(()=>{var U;const G=Date.now();(U=this._getCodeLensModelPromise)===null||U===void 0||U.cancel(),this._getCodeLensModelPromise=createCancelablePromise(Z=>getCodeLensModel(this._languageFeaturesService.codeLensProvider,C,Z)),this._getCodeLensModelPromise.then(Z=>{this._currentCodeLensModel&&this._oldCodeLensModels.add(this._currentCodeLensModel),this._currentCodeLensModel=Z,this._codeLensCache.put(C,Z);const X=this._provideCodeLensDebounce.update(C,Date.now()-G);V.delay=X,this._renderCodeLensSymbols(Z),this._resolveCodeLensesInViewportSoon()},onUnexpectedError)},this._provideCodeLensDebounce.get(C));this._localToDispose.add(V),this._localToDispose.add(toDisposable(()=>this._resolveCodeLensesScheduler.cancel())),this._localToDispose.add(this._editor.onDidChangeModelContent(()=>{var U;this._editor.changeDecorations(G=>{this._editor.changeViewZones(Z=>{const X=[];let Q=-1;this._lenses.forEach(ee=>{!ee.isValid()||Q===ee.getLineNumber()?X.push(ee):(ee.update(Z),Q=ee.getLineNumber())});const J=new CodeLensHelper;X.forEach(ee=>{ee.dispose(J,Z),this._lenses.splice(this._lenses.indexOf(ee),1)}),J.commit(G)})}),V.schedule(),this._resolveCodeLensesScheduler.cancel(),(U=this._resolveCodeLensesPromise)===null||U===void 0||U.cancel(),this._resolveCodeLensesPromise=void 0})),this._localToDispose.add(this._editor.onDidFocusEditorWidget(()=>{V.schedule()})),this._localToDispose.add(this._editor.onDidBlurEditorText(()=>{V.cancel()})),this._localToDispose.add(this._editor.onDidScrollChange(U=>{U.scrollTopChanged&&this._lenses.length>0&&this._resolveCodeLensesInViewportSoon()})),this._localToDispose.add(this._editor.onDidLayoutChange(()=>{this._resolveCodeLensesInViewportSoon()})),this._localToDispose.add(toDisposable(()=>{if(this._editor.getModel()){const U=StableEditorScrollState.capture(this._editor);this._editor.changeDecorations(G=>{this._editor.changeViewZones(Z=>{this._disposeAllLenses(G,Z)})}),U.restore(this._editor)}else this._disposeAllLenses(void 0,void 0)})),this._localToDispose.add(this._editor.onMouseDown(U=>{if(U.target.type!==9)return;let G=U.target.element;if((G==null?void 0:G.tagName)==="SPAN"&&(G=G.parentElement),(G==null?void 0:G.tagName)==="A")for(const Z of this._lenses){const X=Z.getCommand(G);if(X){this._commandService.executeCommand(X.id,...X.arguments||[]).catch(Q=>this._notificationService.error(Q));break}}})),V.schedule()}_disposeAllLenses(C,W){const V=new CodeLensHelper;for(const U of this._lenses)U.dispose(V,W);C&&V.commit(C),this._lenses.length=0}_renderCodeLensSymbols(C){if(!this._editor.hasModel())return;const W=this._editor.getModel().getLineCount(),V=[];let U;for(const X of C.lenses){const Q=X.symbol.range.startLineNumber;Q<1||Q>W||(U&&U[U.length-1].symbol.range.startLineNumber===Q?U.push(X):(U=[X],V.push(U)))}if(!V.length&&!this._lenses.length)return;const G=StableEditorScrollState.capture(this._editor),Z=this._getLayoutInfo();this._editor.changeDecorations(X=>{this._editor.changeViewZones(Q=>{const J=new CodeLensHelper;let ee=0,te=0;for(;te<V.length&&ee<this._lenses.length;){const ie=V[te][0].symbol.range.startLineNumber,ne=this._lenses[ee].getLineNumber();ne<ie?(this._lenses[ee].dispose(J,Q),this._lenses.splice(ee,1)):ne===ie?(this._lenses[ee].updateCodeLensSymbols(V[te],J),te++,ee++):(this._lenses.splice(ee,0,new CodeLensWidget(V[te],this._editor,J,Q,Z.codeLensHeight,()=>this._resolveCodeLensesInViewportSoon())),ee++,te++)}for(;ee<this._lenses.length;)this._lenses[ee].dispose(J,Q),this._lenses.splice(ee,1);for(;te<V.length;)this._lenses.push(new CodeLensWidget(V[te],this._editor,J,Q,Z.codeLensHeight,()=>this._resolveCodeLensesInViewportSoon())),te++;J.commit(X)})}),G.restore(this._editor)}_resolveCodeLensesInViewportSoon(){this._editor.getModel()&&this._resolveCodeLensesScheduler.schedule()}_resolveCodeLensesInViewport(){var C;(C=this._resolveCodeLensesPromise)===null||C===void 0||C.cancel(),this._resolveCodeLensesPromise=void 0;const W=this._editor.getModel();if(!W)return;const V=[],U=[];if(this._lenses.forEach(X=>{const Q=X.computeIfNecessary(W);Q&&(V.push(Q),U.push(X))}),V.length===0)return;const G=Date.now(),Z=createCancelablePromise(X=>{const Q=V.map((J,ee)=>{const te=new Array(J.length),ie=J.map((ne,oe)=>!ne.symbol.command&&typeof ne.provider.resolveCodeLens=="function"?Promise.resolve(ne.provider.resolveCodeLens(W,ne.symbol,X)).then(re=>{te[oe]=re},onUnexpectedExternalError):(te[oe]=ne.symbol,Promise.resolve(void 0)));return Promise.all(ie).then(()=>{!X.isCancellationRequested&&!U[ee].isDisposed()&&U[ee].updateCommands(te)})});return Promise.all(Q)});this._resolveCodeLensesPromise=Z,this._resolveCodeLensesPromise.then(()=>{const X=this._resolveCodeLensesDebounce.update(W,Date.now()-G);this._resolveCodeLensesScheduler.delay=X,this._currentCodeLensModel&&this._codeLensCache.put(W,this._currentCodeLensModel),this._oldCodeLensModels.clear(),Z===this._resolveCodeLensesPromise&&(this._resolveCodeLensesPromise=void 0)},X=>{onUnexpectedError(X),Z===this._resolveCodeLensesPromise&&(this._resolveCodeLensesPromise=void 0)})}getModel(){var C;return __awaiter$Z(this,void 0,void 0,function*(){return yield this._getCodeLensModelPromise,yield this._resolveCodeLensesPromise,!((C=this._currentCodeLensModel)===null||C===void 0)&&C.isDisposed?void 0:this._currentCodeLensModel})}};CodeLensContribution.ID="css.editor.codeLens";CodeLensContribution=__decorate$1g([__param$1g(1,ILanguageFeaturesService),__param$1g(2,ILanguageFeatureDebounceService),__param$1g(3,ICommandService),__param$1g(4,INotificationService),__param$1g(5,ICodeLensCache)],CodeLensContribution);registerEditorContribution(CodeLensContribution.ID,CodeLensContribution,1);registerEditorAction(class extends EditorAction{constructor(){super({id:"codelens.showLensesInCurrentLine",precondition:EditorContextKeys.hasCodeLensProvider,label:localize("showLensOnLine","Show CodeLens Commands For Current Line"),alias:"Show CodeLens Commands For Current Line"})}run(C,W){return __awaiter$Z(this,void 0,void 0,function*(){if(!W.hasModel())return;const V=C.get(IQuickInputService),U=C.get(ICommandService),G=C.get(INotificationService),Z=W.getSelection().positionLineNumber,X=W.getContribution(CodeLensContribution.ID);if(!X)return;const Q=yield X.getModel();if(!Q)return;const J=[];for(const ie of Q.lenses)ie.symbol.command&&ie.symbol.range.startLineNumber===Z&&J.push({label:ie.symbol.command.title,command:ie.symbol.command});if(J.length===0)return;const ee=yield V.pick(J,{canPickMany:!1,placeHolder:localize("placeHolder","Select a command")});if(!ee)return;let te=ee.command;if(Q.isDisposed){const ie=yield X.getModel(),ne=ie==null?void 0:ie.lenses.find(oe=>{var re;return oe.symbol.range.startLineNumber===Z&&((re=oe.symbol.command)===null||re===void 0?void 0:re.title)===te.title});if(!ne||!ne.symbol.command)return;te=ne.symbol.command}try{yield U.executeCommand(te.id,...te.arguments||[])}catch(ie){G.error(ie)}})}});var __decorate$1f=globalThis&&globalThis.__decorate||function(K,C,W,V){var U=arguments.length,G=U<3?C:V===null?V=Object.getOwnPropertyDescriptor(C,W):V,Z;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")G=Reflect.decorate(K,C,W,V);else for(var X=K.length-1;X>=0;X--)(Z=K[X])&&(G=(U<3?Z(G):U>3?Z(C,W,G):Z(C,W))||G);return U>3&&G&&Object.defineProperty(C,W,G),G},__param$1f=globalThis&&globalThis.__param||function(K,C){return function(W,V){C(W,V,K)}},__awaiter$Y=globalThis&&globalThis.__awaiter||function(K,C,W,V){function U(G){return G instanceof W?G:new W(function(Z){Z(G)})}return new(W||(W=Promise))(function(G,Z){function X(ee){try{J(V.next(ee))}catch(te){Z(te)}}function Q(ee){try{J(V.throw(ee))}catch(te){Z(te)}}function J(ee){ee.done?G(ee.value):U(ee.value).then(X,Q)}J((V=V.apply(K,C||[])).next())})};class DefaultDocumentColorProvider{constructor(C,W){this._editorWorkerClient=new EditorWorkerClient(C,!1,"editorWorkerService",W)}provideDocumentColors(C,W){return __awaiter$Y(this,void 0,void 0,function*(){return this._editorWorkerClient.computeDefaultDocumentColors(C.uri)})}provideColorPresentations(C,W,V){const U=W.range,G=W.color,Z=G.alpha,X=new Color(new RGBA(Math.round(255*G.red),Math.round(255*G.green),Math.round(255*G.blue),Z)),Q=Z?Color.Format.CSS.formatRGB(X):Color.Format.CSS.formatRGBA(X),J=Z?Color.Format.CSS.formatHSL(X):Color.Format.CSS.formatHSLA(X),ee=Z?Color.Format.CSS.formatHex(X):Color.Format.CSS.formatHexA(X),te=[];return te.push({label:Q,textEdit:{range:U,text:Q}}),te.push({label:J,textEdit:{range:U,text:J}}),te.push({label:ee,textEdit:{range:U,text:ee}}),te}}let DefaultDocumentColorProviderFeature=class extends Disposable{constructor(C,W,V){super(),this._register(V.colorProvider.register("*",new DefaultDocumentColorProvider(C,W)))}};DefaultDocumentColorProviderFeature=__decorate$1f([__param$1f(0,IModelService),__param$1f(1,ILanguageConfigurationService),__param$1f(2,ILanguageFeaturesService)],DefaultDocumentColorProviderFeature);registerEditorFeature(DefaultDocumentColorProviderFeature);var __awaiter$X=globalThis&&globalThis.__awaiter||function(K,C,W,V){function U(G){return G instanceof W?G:new W(function(Z){Z(G)})}return new(W||(W=Promise))(function(G,Z){function X(ee){try{J(V.next(ee))}catch(te){Z(te)}}function Q(ee){try{J(V.throw(ee))}catch(te){Z(te)}}function J(ee){ee.done?G(ee.value):U(ee.value).then(X,Q)}J((V=V.apply(K,C||[])).next())})};function getColors(K,C,W,V=!0){return __awaiter$X(this,void 0,void 0,function*(){return _findColorData(new ColorDataCollector,K,C,W,V)})}function getColorPresentations(K,C,W,V){return Promise.resolve(W.provideColorPresentations(K,C,V))}class ColorDataCollector{constructor(){}compute(C,W,V,U){return __awaiter$X(this,void 0,void 0,function*(){const G=yield C.provideDocumentColors(W,V);if(Array.isArray(G))for(const Z of G)U.push({colorInfo:Z,provider:C});return Array.isArray(G)})}}class ExtColorDataCollector{constructor(){}compute(C,W,V,U){return __awaiter$X(this,void 0,void 0,function*(){const G=yield C.provideDocumentColors(W,V);if(Array.isArray(G))for(const Z of G)U.push({range:Z.range,color:[Z.color.red,Z.color.green,Z.color.blue,Z.color.alpha]});return Array.isArray(G)})}}class ColorPresentationsCollector{constructor(C){this.colorInfo=C}compute(C,W,V,U){return __awaiter$X(this,void 0,void 0,function*(){const G=yield C.provideColorPresentations(W,this.colorInfo,CancellationToken.None);return Array.isArray(G)&&U.push(...G),Array.isArray(G)})}}function _findColorData(K,C,W,V,U){return __awaiter$X(this,void 0,void 0,function*(){let G=!1,Z;const X=[],Q=C.ordered(W);for(let J=Q.length-1;J>=0;J--){const ee=Q[J];if(ee instanceof DefaultDocumentColorProvider)Z=ee;else try{(yield K.compute(ee,W,V,X))&&(G=!0)}catch(te){onUnexpectedExternalError(te)}}return G?X:Z&&U?(yield K.compute(Z,W,V,X),X):[]})}function _setupColorCommand(K,C){const{colorProvider:W}=K.get(ILanguageFeaturesService),V=K.get(IModelService).getModel(C);if(!V)throw illegalArgument();const U=K.get(IConfigurationService).getValue("editor.defaultColorDecorators",{resource:C});return{model:V,colorProviderRegistry:W,isDefaultColorDecoratorsEnabled:U}}CommandsRegistry.registerCommand("_executeDocumentColorProvider",function(K,...C){const[W]=C;if(!(W instanceof URI))throw illegalArgument();const{model:V,colorProviderRegistry:U,isDefaultColorDecoratorsEnabled:G}=_setupColorCommand(K,W);return _findColorData(new ExtColorDataCollector,U,V,CancellationToken.None,G)});CommandsRegistry.registerCommand("_executeColorPresentationProvider",function(K,...C){const[W,V]=C,{uri:U,range:G}=V;if(!(U instanceof URI)||!Array.isArray(W)||W.length!==4||!Range$2.isIRange(G))throw illegalArgument();const{model:Z,colorProviderRegistry:X,isDefaultColorDecoratorsEnabled:Q}=_setupColorCommand(K,U),[J,ee,te,ie]=W;return _findColorData(new ColorPresentationsCollector({range:G,color:{red:J,green:ee,blue:te,alpha:ie}}),X,Z,CancellationToken.None,Q)});var __decorate$1e=globalThis&&globalThis.__decorate||function(K,C,W,V){var U=arguments.length,G=U<3?C:V===null?V=Object.getOwnPropertyDescriptor(C,W):V,Z;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")G=Reflect.decorate(K,C,W,V);else for(var X=K.length-1;X>=0;X--)(Z=K[X])&&(G=(U<3?Z(G):U>3?Z(C,W,G):Z(C,W))||G);return U>3&&G&&Object.defineProperty(C,W,G),G},__param$1e=globalThis&&globalThis.__param||function(K,C){return function(W,V){C(W,V,K)}},__awaiter$W=globalThis&&globalThis.__awaiter||function(K,C,W,V){function U(G){return G instanceof W?G:new W(function(Z){Z(G)})}return new(W||(W=Promise))(function(G,Z){function X(ee){try{J(V.next(ee))}catch(te){Z(te)}}function Q(ee){try{J(V.throw(ee))}catch(te){Z(te)}}function J(ee){ee.done?G(ee.value):U(ee.value).then(X,Q)}J((V=V.apply(K,C||[])).next())})},ColorDetector_1;const ColorDecorationInjectedTextMarker=Object.create({});let ColorDetector=ColorDetector_1=class extends Disposable{constructor(C,W,V,U){super(),this._editor=C,this._configurationService=W,this._languageFeaturesService=V,this._localToDispose=this._register(new DisposableStore),this._decorationsIds=[],this._colorDatas=new Map,this._colorDecoratorIds=this._editor.createDecorationsCollection(),this._ruleFactory=new DynamicCssRules(this._editor),this._decoratorLimitReporter=new DecoratorLimitReporter,this._colorDecorationClassRefs=this._register(new DisposableStore),this._debounceInformation=U.for(V.colorProvider,"Document Colors",{min:ColorDetector_1.RECOMPUTE_TIME}),this._register(C.onDidChangeModel(()=>{this._isColorDecoratorsEnabled=this.isEnabled(),this.updateColors()})),this._register(C.onDidChangeModelLanguage(()=>this.updateColors())),this._register(V.colorProvider.onDidChange(()=>this.updateColors())),this._register(C.onDidChangeConfiguration(G=>{const Z=this._isColorDecoratorsEnabled;this._isColorDecoratorsEnabled=this.isEnabled(),this._isDefaultColorDecoratorsEnabled=this._editor.getOption(145);const X=Z!==this._isColorDecoratorsEnabled||G.hasChanged(21),Q=G.hasChanged(145);(X||Q)&&(this._isColorDecoratorsEnabled?this.updateColors():this.removeAllDecorations())})),this._timeoutTimer=null,this._computePromise=null,this._isColorDecoratorsEnabled=this.isEnabled(),this._isDefaultColorDecoratorsEnabled=this._editor.getOption(145),this.updateColors()}isEnabled(){const C=this._editor.getModel();if(!C)return!1;const W=C.getLanguageId(),V=this._configurationService.getValue(W);if(V&&typeof V=="object"){const U=V.colorDecorators;if(U&&U.enable!==void 0&&!U.enable)return U.enable}return this._editor.getOption(20)}static get(C){return C.getContribution(this.ID)}dispose(){this.stop(),this.removeAllDecorations(),super.dispose()}updateColors(){if(this.stop(),!this._isColorDecoratorsEnabled)return;const C=this._editor.getModel();!C||!this._languageFeaturesService.colorProvider.has(C)||(this._localToDispose.add(this._editor.onDidChangeModelContent(()=>{this._timeoutTimer||(this._timeoutTimer=new TimeoutTimer,this._timeoutTimer.cancelAndSet(()=>{this._timeoutTimer=null,this.beginCompute()},this._debounceInformation.get(C)))})),this.beginCompute())}beginCompute(){return __awaiter$W(this,void 0,void 0,function*(){this._computePromise=createCancelablePromise(C=>__awaiter$W(this,void 0,void 0,function*(){const W=this._editor.getModel();if(!W)return[];const V=new StopWatch(!1),U=yield getColors(this._languageFeaturesService.colorProvider,W,C,this._isDefaultColorDecoratorsEnabled);return this._debounceInformation.update(W,V.elapsed()),U}));try{const C=yield this._computePromise;this.updateDecorations(C),this.updateColorDecorators(C),this._computePromise=null}catch(C){onUnexpectedError(C)}})}stop(){this._timeoutTimer&&(this._timeoutTimer.cancel(),this._timeoutTimer=null),this._computePromise&&(this._computePromise.cancel(),this._computePromise=null),this._localToDispose.clear()}updateDecorations(C){const W=C.map(V=>({range:{startLineNumber:V.colorInfo.range.startLineNumber,startColumn:V.colorInfo.range.startColumn,endLineNumber:V.colorInfo.range.endLineNumber,endColumn:V.colorInfo.range.endColumn},options:ModelDecorationOptions.EMPTY}));this._editor.changeDecorations(V=>{this._decorationsIds=V.deltaDecorations(this._decorationsIds,W),this._colorDatas=new Map,this._decorationsIds.forEach((U,G)=>this._colorDatas.set(U,C[G]))})}updateColorDecorators(C){this._colorDecorationClassRefs.clear();const W=[],V=this._editor.getOption(21);for(let G=0;G<C.length&&W.length<V;G++){const{red:Z,green:X,blue:Q,alpha:J}=C[G].colorInfo.color,ee=new RGBA(Math.round(Z*255),Math.round(X*255),Math.round(Q*255),J),te=`rgba(${ee.r}, ${ee.g}, ${ee.b}, ${ee.a})`,ie=this._colorDecorationClassRefs.add(this._ruleFactory.createClassNameRef({backgroundColor:te}));W.push({range:{startLineNumber:C[G].colorInfo.range.startLineNumber,startColumn:C[G].colorInfo.range.startColumn,endLineNumber:C[G].colorInfo.range.endLineNumber,endColumn:C[G].colorInfo.range.endColumn},options:{description:"colorDetector",before:{content:noBreakWhitespace,inlineClassName:`${ie.className} colorpicker-color-decoration`,inlineClassNameAffectsLetterSpacing:!0,attachedData:ColorDecorationInjectedTextMarker}}})}const U=V<C.length?V:!1;this._decoratorLimitReporter.update(C.length,U),this._colorDecoratorIds.set(W)}removeAllDecorations(){this._editor.removeDecorations(this._decorationsIds),this._decorationsIds=[],this._colorDecoratorIds.clear(),this._colorDecorationClassRefs.clear()}getColorData(C){const W=this._editor.getModel();if(!W)return null;const V=W.getDecorationsInRange(Range$2.fromPositions(C,C)).filter(U=>this._colorDatas.has(U.id));return V.length===0?null:this._colorDatas.get(V[0].id)}isColorDecoration(C){return this._colorDecoratorIds.has(C)}};ColorDetector.ID="editor.contrib.colorDetector";ColorDetector.RECOMPUTE_TIME=1e3;ColorDetector=ColorDetector_1=__decorate$1e([__param$1e(1,IConfigurationService),__param$1e(2,ILanguageFeaturesService),__param$1e(3,ILanguageFeatureDebounceService)],ColorDetector);class DecoratorLimitReporter{constructor(){this._onDidChange=new Emitter$1,this._computed=0,this._limited=!1}update(C,W){(C!==this._computed||W!==this._limited)&&(this._computed=C,this._limited=W,this._onDidChange.fire())}}registerEditorContribution(ColorDetector.ID,ColorDetector,1);class ColorPickerModel{get color(){return this._color}set color(C){this._color.equals(C)||(this._color=C,this._onDidChangeColor.fire(C))}get presentation(){return this.colorPresentations[this.presentationIndex]}get colorPresentations(){return this._colorPresentations}set colorPresentations(C){this._colorPresentations=C,this.presentationIndex>C.length-1&&(this.presentationIndex=0),this._onDidChangePresentation.fire(this.presentation)}constructor(C,W,V){this.presentationIndex=V,this._onColorFlushed=new Emitter$1,this.onColorFlushed=this._onColorFlushed.event,this._onDidChangeColor=new Emitter$1,this.onDidChangeColor=this._onDidChangeColor.event,this._onDidChangePresentation=new Emitter$1,this.onDidChangePresentation=this._onDidChangePresentation.event,this.originalColor=C,this._color=C,this._colorPresentations=W}selectNextColorPresentation(){this.presentationIndex=(this.presentationIndex+1)%this.colorPresentations.length,this.flushColor(),this._onDidChangePresentation.fire(this.presentation)}guessColorPresentation(C,W){let V=-1;for(let U=0;U<this.colorPresentations.length;U++)if(W.toLowerCase()===this.colorPresentations[U].label){V=U;break}if(V===-1){const U=W.split("(")[0].toLowerCase();for(let G=0;G<this.colorPresentations.length;G++)if(this.colorPresentations[G].label.toLowerCase().startsWith(U)){V=G;break}}V!==-1&&V!==this.presentationIndex&&(this.presentationIndex=V,this._onDidChangePresentation.fire(this.presentation))}flushColor(){this._onColorFlushed.fire(this._color)}}const colorPicker="",$$6=$$d;class ColorPickerHeader extends Disposable{constructor(C,W,V,U=!1){super(),this.model=W,this.showingStandaloneColorPicker=U,this._closeButton=null,this._domNode=$$6(".colorpicker-header"),append$3(C,this._domNode),this._pickedColorNode=append$3(this._domNode,$$6(".picked-color")),append$3(this._pickedColorNode,$$6("span.codicon.codicon-color-mode")),this._pickedColorPresentation=append$3(this._pickedColorNode,document.createElement("span")),this._pickedColorPresentation.classList.add("picked-color-presentation");const G=localize("clickToToggleColorOptions","Click to toggle color options (rgb/hsl/hex)");this._pickedColorNode.setAttribute("title",G),this._originalColorNode=append$3(this._domNode,$$6(".original-color")),this._originalColorNode.style.backgroundColor=Color.Format.CSS.format(this.model.originalColor)||"",this.backgroundColor=V.getColorTheme().getColor(editorHoverBackground)||Color.white,this._register(V.onDidColorThemeChange(Z=>{this.backgroundColor=Z.getColor(editorHoverBackground)||Color.white})),this._register(addDisposableListener(this._pickedColorNode,EventType$1.CLICK,()=>this.model.selectNextColorPresentation())),this._register(addDisposableListener(this._originalColorNode,EventType$1.CLICK,()=>{this.model.color=this.model.originalColor,this.model.flushColor()})),this._register(W.onDidChangeColor(this.onDidChangeColor,this)),this._register(W.onDidChangePresentation(this.onDidChangePresentation,this)),this._pickedColorNode.style.backgroundColor=Color.Format.CSS.format(W.color)||"",this._pickedColorNode.classList.toggle("light",W.color.rgba.a<.5?this.backgroundColor.isLighter():W.color.isLighter()),this.onDidChangeColor(this.model.color),this.showingStandaloneColorPicker&&(this._domNode.classList.add("standalone-colorpicker"),this._closeButton=this._register(new CloseButton(this._domNode)))}get closeButton(){return this._closeButton}get pickedColorNode(){return this._pickedColorNode}get originalColorNode(){return this._originalColorNode}onDidChangeColor(C){this._pickedColorNode.style.backgroundColor=Color.Format.CSS.format(C)||"",this._pickedColorNode.classList.toggle("light",C.rgba.a<.5?this.backgroundColor.isLighter():C.isLighter()),this.onDidChangePresentation()}onDidChangePresentation(){this._pickedColorPresentation.textContent=this.model.presentation?this.model.presentation.label:""}}class CloseButton extends Disposable{constructor(C){super(),this._onClicked=this._register(new Emitter$1),this.onClicked=this._onClicked.event,this._button=document.createElement("div"),this._button.classList.add("close-button"),append$3(C,this._button);const W=document.createElement("div");W.classList.add("close-button-inner-div"),append$3(this._button,W),append$3(W,$$6(".button"+ThemeIcon.asCSSSelector(registerIcon("color-picker-close",Codicon.close,localize("closeIcon","Icon to close the color picker"))))).classList.add("close-icon"),this._button.onclick=()=>{this._onClicked.fire()}}}class ColorPickerBody extends Disposable{constructor(C,W,V,U=!1){super(),this.model=W,this.pixelRatio=V,this._insertButton=null,this._domNode=$$6(".colorpicker-body"),append$3(C,this._domNode),this._saturationBox=new SaturationBox(this._domNode,this.model,this.pixelRatio),this._register(this._saturationBox),this._register(this._saturationBox.onDidChange(this.onDidSaturationValueChange,this)),this._register(this._saturationBox.onColorFlushed(this.flushColor,this)),this._opacityStrip=new OpacityStrip(this._domNode,this.model,U),this._register(this._opacityStrip),this._register(this._opacityStrip.onDidChange(this.onDidOpacityChange,this)),this._register(this._opacityStrip.onColorFlushed(this.flushColor,this)),this._hueStrip=new HueStrip(this._domNode,this.model,U),this._register(this._hueStrip),this._register(this._hueStrip.onDidChange(this.onDidHueChange,this)),this._register(this._hueStrip.onColorFlushed(this.flushColor,this)),U&&(this._insertButton=this._register(new InsertButton(this._domNode)),this._domNode.classList.add("standalone-colorpicker"))}flushColor(){this.model.flushColor()}onDidSaturationValueChange({s:C,v:W}){const V=this.model.color.hsva;this.model.color=new Color(new HSVA(V.h,C,W,V.a))}onDidOpacityChange(C){const W=this.model.color.hsva;this.model.color=new Color(new HSVA(W.h,W.s,W.v,C))}onDidHueChange(C){const W=this.model.color.hsva,V=(1-C)*360;this.model.color=new Color(new HSVA(V===360?0:V,W.s,W.v,W.a))}get domNode(){return this._domNode}get saturationBox(){return this._saturationBox}get enterButton(){return this._insertButton}layout(){this._saturationBox.layout(),this._opacityStrip.layout(),this._hueStrip.layout()}}class SaturationBox extends Disposable{constructor(C,W,V){super(),this.model=W,this.pixelRatio=V,this._onDidChange=new Emitter$1,this.onDidChange=this._onDidChange.event,this._onColorFlushed=new Emitter$1,this.onColorFlushed=this._onColorFlushed.event,this._domNode=$$6(".saturation-wrap"),append$3(C,this._domNode),this._canvas=document.createElement("canvas"),this._canvas.className="saturation-box",append$3(this._domNode,this._canvas),this.selection=$$6(".saturation-selection"),append$3(this._domNode,this.selection),this.layout(),this._register(addDisposableListener(this._domNode,EventType$1.POINTER_DOWN,U=>this.onPointerDown(U))),this._register(this.model.onDidChangeColor(this.onDidChangeColor,this)),this.monitor=null}get domNode(){return this._domNode}onPointerDown(C){if(!C.target||!(C.target instanceof Element))return;this.monitor=this._register(new GlobalPointerMoveMonitor);const W=getDomNodePagePosition(this._domNode);C.target!==this.selection&&this.onDidChangePosition(C.offsetX,C.offsetY),this.monitor.startMonitoring(C.target,C.pointerId,C.buttons,U=>this.onDidChangePosition(U.pageX-W.left,U.pageY-W.top),()=>null);const V=addDisposableListener(C.target.ownerDocument,EventType$1.POINTER_UP,()=>{this._onColorFlushed.fire(),V.dispose(),this.monitor&&(this.monitor.stopMonitoring(!0),this.monitor=null)},!0)}onDidChangePosition(C,W){const V=Math.max(0,Math.min(1,C/this.width)),U=Math.max(0,Math.min(1,1-W/this.height));this.paintSelection(V,U),this._onDidChange.fire({s:V,v:U})}layout(){this.width=this._domNode.offsetWidth,this.height=this._domNode.offsetHeight,this._canvas.width=this.width*this.pixelRatio,this._canvas.height=this.height*this.pixelRatio,this.paint();const C=this.model.color.hsva;this.paintSelection(C.s,C.v)}paint(){const C=this.model.color.hsva,W=new Color(new HSVA(C.h,1,1,1)),V=this._canvas.getContext("2d"),U=V.createLinearGradient(0,0,this._canvas.width,0);U.addColorStop(0,"rgba(255, 255, 255, 1)"),U.addColorStop(.5,"rgba(255, 255, 255, 0.5)"),U.addColorStop(1,"rgba(255, 255, 255, 0)");const G=V.createLinearGradient(0,0,0,this._canvas.height);G.addColorStop(0,"rgba(0, 0, 0, 0)"),G.addColorStop(1,"rgba(0, 0, 0, 1)"),V.rect(0,0,this._canvas.width,this._canvas.height),V.fillStyle=Color.Format.CSS.format(W),V.fill(),V.fillStyle=U,V.fill(),V.fillStyle=G,V.fill()}paintSelection(C,W){this.selection.style.left=`${C*this.width}px`,this.selection.style.top=`${this.height-W*this.height}px`}onDidChangeColor(C){if(this.monitor&&this.monitor.isMonitoring())return;this.paint();const W=C.hsva;this.paintSelection(W.s,W.v)}}class Strip extends Disposable{constructor(C,W,V=!1){super(),this.model=W,this._onDidChange=new Emitter$1,this.onDidChange=this._onDidChange.event,this._onColorFlushed=new Emitter$1,this.onColorFlushed=this._onColorFlushed.event,V?(this.domNode=append$3(C,$$6(".standalone-strip")),this.overlay=append$3(this.domNode,$$6(".standalone-overlay"))):(this.domNode=append$3(C,$$6(".strip")),this.overlay=append$3(this.domNode,$$6(".overlay"))),this.slider=append$3(this.domNode,$$6(".slider")),this.slider.style.top="0px",this._register(addDisposableListener(this.domNode,EventType$1.POINTER_DOWN,U=>this.onPointerDown(U))),this._register(W.onDidChangeColor(this.onDidChangeColor,this)),this.layout()}layout(){this.height=this.domNode.offsetHeight-this.slider.offsetHeight;const C=this.getValue(this.model.color);this.updateSliderPosition(C)}onDidChangeColor(C){const W=this.getValue(C);this.updateSliderPosition(W)}onPointerDown(C){if(!C.target||!(C.target instanceof Element))return;const W=this._register(new GlobalPointerMoveMonitor),V=getDomNodePagePosition(this.domNode);this.domNode.classList.add("grabbing"),C.target!==this.slider&&this.onDidChangeTop(C.offsetY),W.startMonitoring(C.target,C.pointerId,C.buttons,G=>this.onDidChangeTop(G.pageY-V.top),()=>null);const U=addDisposableListener(C.target.ownerDocument,EventType$1.POINTER_UP,()=>{this._onColorFlushed.fire(),U.dispose(),W.stopMonitoring(!0),this.domNode.classList.remove("grabbing")},!0)}onDidChangeTop(C){const W=Math.max(0,Math.min(1,1-C/this.height));this.updateSliderPosition(W),this._onDidChange.fire(W)}updateSliderPosition(C){this.slider.style.top=`${(1-C)*this.height}px`}}class OpacityStrip extends Strip{constructor(C,W,V=!1){super(C,W,V),this.domNode.classList.add("opacity-strip"),this.onDidChangeColor(this.model.color)}onDidChangeColor(C){super.onDidChangeColor(C);const{r:W,g:V,b:U}=C.rgba,G=new Color(new RGBA(W,V,U,1)),Z=new Color(new RGBA(W,V,U,0));this.overlay.style.background=`linear-gradient(to bottom, ${G} 0%, ${Z} 100%)`}getValue(C){return C.hsva.a}}class HueStrip extends Strip{constructor(C,W,V=!1){super(C,W,V),this.domNode.classList.add("hue-strip")}getValue(C){return 1-C.hsva.h/360}}class InsertButton extends Disposable{constructor(C){super(),this._onClicked=this._register(new Emitter$1),this.onClicked=this._onClicked.event,this._button=append$3(C,document.createElement("button")),this._button.classList.add("insert-button"),this._button.textContent="Insert",this._button.onclick=W=>{this._onClicked.fire()}}get button(){return this._button}}class ColorPickerWidget extends Widget$1{constructor(C,W,V,U,G=!1){super(),this.model=W,this.pixelRatio=V,this._register(PixelRatio.onDidChange(()=>this.layout()));const Z=$$6(".colorpicker-widget");C.appendChild(Z),this.header=this._register(new ColorPickerHeader(Z,this.model,U,G)),this.body=this._register(new ColorPickerBody(Z,this.model,this.pixelRatio,G))}layout(){this.body.layout()}}var __decorate$1d=globalThis&&globalThis.__decorate||function(K,C,W,V){var U=arguments.length,G=U<3?C:V===null?V=Object.getOwnPropertyDescriptor(C,W):V,Z;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")G=Reflect.decorate(K,C,W,V);else for(var X=K.length-1;X>=0;X--)(Z=K[X])&&(G=(U<3?Z(G):U>3?Z(C,W,G):Z(C,W))||G);return U>3&&G&&Object.defineProperty(C,W,G),G},__param$1d=globalThis&&globalThis.__param||function(K,C){return function(W,V){C(W,V,K)}},__awaiter$V=globalThis&&globalThis.__awaiter||function(K,C,W,V){function U(G){return G instanceof W?G:new W(function(Z){Z(G)})}return new(W||(W=Promise))(function(G,Z){function X(ee){try{J(V.next(ee))}catch(te){Z(te)}}function Q(ee){try{J(V.throw(ee))}catch(te){Z(te)}}function J(ee){ee.done?G(ee.value):U(ee.value).then(X,Q)}J((V=V.apply(K,C||[])).next())})};class ColorHover{constructor(C,W,V,U){this.owner=C,this.range=W,this.model=V,this.provider=U,this.forceShowAtRange=!0}isValidForHoverAnchor(C){return C.type===1&&this.range.startColumn<=C.range.startColumn&&this.range.endColumn>=C.range.endColumn}}let ColorHoverParticipant=class{constructor(C,W){this._editor=C,this._themeService=W,this.hoverOrdinal=2}computeSync(C,W){return[]}computeAsync(C,W,V){return AsyncIterableObject.fromPromise(this._computeAsync(C,W,V))}_computeAsync(C,W,V){return __awaiter$V(this,void 0,void 0,function*(){if(!this._editor.hasModel())return[];const U=ColorDetector.get(this._editor);if(!U)return[];for(const G of W){if(!U.isColorDecoration(G))continue;const Z=U.getColorData(G.range.getStartPosition());if(Z)return[yield _createColorHover(this,this._editor.getModel(),Z.colorInfo,Z.provider)]}return[]})}renderHoverParts(C,W){return renderHoverParts(this,this._editor,this._themeService,W,C)}};ColorHoverParticipant=__decorate$1d([__param$1d(1,IThemeService)],ColorHoverParticipant);class StandaloneColorPickerHover{constructor(C,W,V,U){this.owner=C,this.range=W,this.model=V,this.provider=U}}let StandaloneColorPickerParticipant=class{constructor(C,W){this._editor=C,this._themeService=W,this._color=null}createColorHover(C,W,V){return __awaiter$V(this,void 0,void 0,function*(){if(!this._editor.hasModel()||!ColorDetector.get(this._editor))return null;const G=yield getColors(V,this._editor.getModel(),CancellationToken.None);let Z=null,X=null;for(const te of G){const ie=te.colorInfo;Range$2.containsRange(ie.range,C.range)&&(Z=ie,X=te.provider)}const Q=Z??C,J=X??W,ee=!!Z;return{colorHover:yield _createColorHover(this,this._editor.getModel(),Q,J),foundInEditor:ee}})}updateEditorModel(C){return __awaiter$V(this,void 0,void 0,function*(){if(!this._editor.hasModel())return;const W=C.model;let V=new Range$2(C.range.startLineNumber,C.range.startColumn,C.range.endLineNumber,C.range.endColumn);this._color&&(yield _updateColorPresentations(this._editor.getModel(),W,this._color,V,C),V=_updateEditorModel(this._editor,V,W))})}renderHoverParts(C,W){return renderHoverParts(this,this._editor,this._themeService,W,C)}set color(C){this._color=C}get color(){return this._color}};StandaloneColorPickerParticipant=__decorate$1d([__param$1d(1,IThemeService)],StandaloneColorPickerParticipant);function _createColorHover(K,C,W,V){return __awaiter$V(this,void 0,void 0,function*(){const U=C.getValueInRange(W.range),{red:G,green:Z,blue:X,alpha:Q}=W.color,J=new RGBA(Math.round(G*255),Math.round(Z*255),Math.round(X*255),Q),ee=new Color(J),te=yield getColorPresentations(C,W,V,CancellationToken.None),ie=new ColorPickerModel(ee,[],0);return ie.colorPresentations=te||[],ie.guessColorPresentation(ee,U),K instanceof ColorHoverParticipant?new ColorHover(K,Range$2.lift(W.range),ie,V):new StandaloneColorPickerHover(K,Range$2.lift(W.range),ie,V)})}function renderHoverParts(K,C,W,V,U){if(V.length===0||!C.hasModel())return Disposable.None;if(U.setMinimumDimensions){const ie=C.getOption(66)+8;U.setMinimumDimensions(new Dimension(302,ie))}const G=new DisposableStore,Z=V[0],X=C.getModel(),Q=Z.model,J=G.add(new ColorPickerWidget(U.fragment,Q,C.getOption(141),W,K instanceof StandaloneColorPickerParticipant));U.setColorPicker(J);let ee=!1,te=new Range$2(Z.range.startLineNumber,Z.range.startColumn,Z.range.endLineNumber,Z.range.endColumn);if(K instanceof StandaloneColorPickerParticipant){const ie=V[0].model.color;K.color=ie,_updateColorPresentations(X,Q,ie,te,Z),G.add(Q.onColorFlushed(ne=>{K.color=ne}))}else G.add(Q.onColorFlushed(ie=>__awaiter$V(this,void 0,void 0,function*(){yield _updateColorPresentations(X,Q,ie,te,Z),ee=!0,te=_updateEditorModel(C,te,Q,U)})));return G.add(Q.onDidChangeColor(ie=>{_updateColorPresentations(X,Q,ie,te,Z)})),G.add(C.onDidChangeModelContent(ie=>{ee?ee=!1:(U.hide(),C.focus())})),G}function _updateEditorModel(K,C,W,V){let U,G;if(W.presentation.textEdit){U=[W.presentation.textEdit],G=new Range$2(W.presentation.textEdit.range.startLineNumber,W.presentation.textEdit.range.startColumn,W.presentation.textEdit.range.endLineNumber,W.presentation.textEdit.range.endColumn);const Z=K.getModel()._setTrackedRange(null,G,3);K.pushUndoStop(),K.executeEdits("colorpicker",U),G=K.getModel()._getTrackedRange(Z)||G}else U=[{range:C,text:W.presentation.label,forceMoveMarkers:!1}],G=C.setEndPosition(C.endLineNumber,C.startColumn+W.presentation.label.length),K.pushUndoStop(),K.executeEdits("colorpicker",U);return W.presentation.additionalTextEdits&&(U=[...W.presentation.additionalTextEdits],K.executeEdits("colorpicker",U),V&&V.hide()),K.pushUndoStop(),G}function _updateColorPresentations(K,C,W,V,U){return __awaiter$V(this,void 0,void 0,function*(){const G=yield getColorPresentations(K,{range:V,color:{red:W.rgba.r/255,green:W.rgba.g/255,blue:W.rgba.b/255,alpha:W.rgba.a}},U.provider,CancellationToken.None);C.colorPresentations=G||[]})}const goToDefinitionAtPosition="";function hasModifier(K,C){return!!K[C]}class ClickLinkMouseEvent{constructor(C,W){this.target=C.target,this.isLeftClick=C.event.leftButton,this.isMiddleClick=C.event.middleButton,this.isRightClick=C.event.rightButton,this.hasTriggerModifier=hasModifier(C.event,W.triggerModifier),this.hasSideBySideModifier=hasModifier(C.event,W.triggerSideBySideModifier),this.isNoneOrSingleMouseDown=C.event.detail<=1}}class ClickLinkKeyboardEvent{constructor(C,W){this.keyCodeIsTriggerKey=C.keyCode===W.triggerKey,this.keyCodeIsSideBySideKey=C.keyCode===W.triggerSideBySideKey,this.hasTriggerModifier=hasModifier(C,W.triggerModifier)}}class ClickLinkOptions{constructor(C,W,V,U){this.triggerKey=C,this.triggerModifier=W,this.triggerSideBySideKey=V,this.triggerSideBySideModifier=U}equals(C){return this.triggerKey===C.triggerKey&&this.triggerModifier===C.triggerModifier&&this.triggerSideBySideKey===C.triggerSideBySideKey&&this.triggerSideBySideModifier===C.triggerSideBySideModifier}}function createOptions(K){return K==="altKey"?isMacintosh?new ClickLinkOptions(57,"metaKey",6,"altKey"):new ClickLinkOptions(5,"ctrlKey",6,"altKey"):isMacintosh?new ClickLinkOptions(6,"altKey",57,"metaKey"):new ClickLinkOptions(6,"altKey",5,"ctrlKey")}class ClickLinkGesture extends Disposable{constructor(C,W){var V;super(),this._onMouseMoveOrRelevantKeyDown=this._register(new Emitter$1),this.onMouseMoveOrRelevantKeyDown=this._onMouseMoveOrRelevantKeyDown.event,this._onExecute=this._register(new Emitter$1),this.onExecute=this._onExecute.event,this._onCancel=this._register(new Emitter$1),this.onCancel=this._onCancel.event,this._editor=C,this._extractLineNumberFromMouseEvent=(V=W==null?void 0:W.extractLineNumberFromMouseEvent)!==null&&V!==void 0?V:U=>U.target.position?U.target.position.lineNumber:0,this._opts=createOptions(this._editor.getOption(77)),this._lastMouseMoveEvent=null,this._hasTriggerKeyOnMouseDown=!1,this._lineNumberOnMouseDown=0,this._register(this._editor.onDidChangeConfiguration(U=>{if(U.hasChanged(77)){const G=createOptions(this._editor.getOption(77));if(this._opts.equals(G))return;this._opts=G,this._lastMouseMoveEvent=null,this._hasTriggerKeyOnMouseDown=!1,this._lineNumberOnMouseDown=0,this._onCancel.fire()}})),this._register(this._editor.onMouseMove(U=>this._onEditorMouseMove(new ClickLinkMouseEvent(U,this._opts)))),this._register(this._editor.onMouseDown(U=>this._onEditorMouseDown(new ClickLinkMouseEvent(U,this._opts)))),this._register(this._editor.onMouseUp(U=>this._onEditorMouseUp(new ClickLinkMouseEvent(U,this._opts)))),this._register(this._editor.onKeyDown(U=>this._onEditorKeyDown(new ClickLinkKeyboardEvent(U,this._opts)))),this._register(this._editor.onKeyUp(U=>this._onEditorKeyUp(new ClickLinkKeyboardEvent(U,this._opts)))),this._register(this._editor.onMouseDrag(()=>this._resetHandler())),this._register(this._editor.onDidChangeCursorSelection(U=>this._onDidChangeCursorSelection(U))),this._register(this._editor.onDidChangeModel(U=>this._resetHandler())),this._register(this._editor.onDidChangeModelContent(()=>this._resetHandler())),this._register(this._editor.onDidScrollChange(U=>{(U.scrollTopChanged||U.scrollLeftChanged)&&this._resetHandler()}))}_onDidChangeCursorSelection(C){C.selection&&C.selection.startColumn!==C.selection.endColumn&&this._resetHandler()}_onEditorMouseMove(C){this._lastMouseMoveEvent=C,this._onMouseMoveOrRelevantKeyDown.fire([C,null])}_onEditorMouseDown(C){this._hasTriggerKeyOnMouseDown=C.hasTriggerModifier,this._lineNumberOnMouseDown=this._extractLineNumberFromMouseEvent(C)}_onEditorMouseUp(C){const W=this._extractLineNumberFromMouseEvent(C);this._hasTriggerKeyOnMouseDown&&this._lineNumberOnMouseDown&&this._lineNumberOnMouseDown===W&&this._onExecute.fire(C)}_onEditorKeyDown(C){this._lastMouseMoveEvent&&(C.keyCodeIsTriggerKey||C.keyCodeIsSideBySideKey&&C.hasTriggerModifier)?this._onMouseMoveOrRelevantKeyDown.fire([this._lastMouseMoveEvent,C]):C.hasTriggerModifier&&this._onCancel.fire()}_onEditorKeyUp(C){C.keyCodeIsTriggerKey&&this._onCancel.fire()}_resetHandler(){this._lastMouseMoveEvent=null,this._hasTriggerKeyOnMouseDown=!1,this._onCancel.fire()}}const peekViewWidget="";var __decorate$1c=globalThis&&globalThis.__decorate||function(K,C,W,V){var U=arguments.length,G=U<3?C:V===null?V=Object.getOwnPropertyDescriptor(C,W):V,Z;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")G=Reflect.decorate(K,C,W,V);else for(var X=K.length-1;X>=0;X--)(Z=K[X])&&(G=(U<3?Z(G):U>3?Z(C,W,G):Z(C,W))||G);return U>3&&G&&Object.defineProperty(C,W,G),G},__param$1c=globalThis&&globalThis.__param||function(K,C){return function(W,V){C(W,V,K)}};let EmbeddedCodeEditorWidget=class extends CodeEditorWidget{constructor(C,W,V,U,G,Z,X,Q,J,ee,te,ie,ne){super(C,Object.assign(Object.assign({},U.getRawOptions()),{overflowWidgetsDomNode:U.getOverflowWidgetsDomNode()}),V,G,Z,X,Q,J,ee,te,ie,ne),this._parentEditor=U,this._overwriteOptions=W,super.updateOptions(this._overwriteOptions),this._register(U.onDidChangeConfiguration(oe=>this._onParentConfigurationChanged(oe)))}getParentEditor(){return this._parentEditor}_onParentConfigurationChanged(C){super.updateOptions(this._parentEditor.getRawOptions()),super.updateOptions(this._overwriteOptions)}updateOptions(C){mixin(this._overwriteOptions,C,!0),super.updateOptions(this._overwriteOptions)}};EmbeddedCodeEditorWidget=__decorate$1c([__param$1c(4,IInstantiationService),__param$1c(5,ICodeEditorService),__param$1c(6,ICommandService),__param$1c(7,IContextKeyService),__param$1c(8,IThemeService),__param$1c(9,INotificationService),__param$1c(10,IAccessibilityService),__param$1c(11,ILanguageConfigurationService),__param$1c(12,ILanguageFeaturesService)],EmbeddedCodeEditorWidget);const zoneWidget="",defaultColor=new Color(new RGBA(0,122,204)),defaultOptions$1={showArrow:!0,showFrame:!0,className:"",frameColor:defaultColor,arrowColor:defaultColor,keepEditorSelection:!1},WIDGET_ID="vs.editor.contrib.zoneWidget";class ViewZoneDelegate{constructor(C,W,V,U,G,Z,X,Q){this.id="",this.domNode=C,this.afterLineNumber=W,this.afterColumn=V,this.heightInLines=U,this.showInHiddenAreas=X,this.ordinal=Q,this._onDomNodeTop=G,this._onComputedHeight=Z}onDomNodeTop(C){this._onDomNodeTop(C)}onComputedHeight(C){this._onComputedHeight(C)}}class OverlayWidgetDelegate{constructor(C,W){this._id=C,this._domNode=W}getId(){return this._id}getDomNode(){return this._domNode}getPosition(){return null}}class Arrow{constructor(C){this._editor=C,this._ruleName=Arrow._IdGenerator.nextId(),this._decorations=this._editor.createDecorationsCollection(),this._color=null,this._height=-1}dispose(){this.hide(),removeCSSRulesContainingSelector(this._ruleName)}set color(C){this._color!==C&&(this._color=C,this._updateStyle())}set height(C){this._height!==C&&(this._height=C,this._updateStyle())}_updateStyle(){removeCSSRulesContainingSelector(this._ruleName),createCSSRule(`.monaco-editor ${this._ruleName}`,`border-style: solid; border-color: transparent; border-bottom-color: ${this._color}; border-width: ${this._height}px; bottom: -${this._height}px; margin-left: -${this._height}px; `)}show(C){C.column===1&&(C={lineNumber:C.lineNumber,column:2}),this._decorations.set([{range:Range$2.fromPositions(C),options:{description:"zone-widget-arrow",className:this._ruleName,stickiness:1}}])}hide(){this._decorations.clear()}}Arrow._IdGenerator=new IdGenerator(".arrow-decoration-");class ZoneWidget{constructor(C,W={}){this._arrow=null,this._overlayWidget=null,this._resizeSash=null,this._viewZone=null,this._disposables=new DisposableStore,this.container=null,this._isShowing=!1,this.editor=C,this._positionMarkerId=this.editor.createDecorationsCollection(),this.options=deepClone(W),mixin(this.options,defaultOptions$1,!1),this.domNode=document.createElement("div"),this.options.isAccessible||(this.domNode.setAttribute("aria-hidden","true"),this.domNode.setAttribute("role","presentation")),this._disposables.add(this.editor.onDidLayoutChange(V=>{const U=this._getWidth(V);this.domNode.style.width=U+"px",this.domNode.style.left=this._getLeft(V)+"px",this._onWidth(U)}))}dispose(){this._overlayWidget&&(this.editor.removeOverlayWidget(this._overlayWidget),this._overlayWidget=null),this._viewZone&&this.editor.changeViewZones(C=>{this._viewZone&&C.removeZone(this._viewZone.id),this._viewZone=null}),this._positionMarkerId.clear(),this._disposables.dispose()}create(){this.domNode.classList.add("zone-widget"),this.options.className&&this.domNode.classList.add(this.options.className),this.container=document.createElement("div"),this.container.classList.add("zone-widget-container"),this.domNode.appendChild(this.container),this.options.showArrow&&(this._arrow=new Arrow(this.editor),this._disposables.add(this._arrow)),this._fillContainer(this.container),this._initSash(),this._applyStyles()}style(C){C.frameColor&&(this.options.frameColor=C.frameColor),C.arrowColor&&(this.options.arrowColor=C.arrowColor),this._applyStyles()}_applyStyles(){if(this.container&&this.options.frameColor){const C=this.options.frameColor.toString();this.container.style.borderTopColor=C,this.container.style.borderBottomColor=C}if(this._arrow&&this.options.arrowColor){const C=this.options.arrowColor.toString();this._arrow.color=C}}_getWidth(C){return C.width-C.minimap.minimapWidth-C.verticalScrollbarWidth}_getLeft(C){return C.minimap.minimapWidth>0&&C.minimap.minimapLeft===0?C.minimap.minimapWidth:0}_onViewZoneTop(C){this.domNode.style.top=C+"px"}_onViewZoneHeight(C){var W;if(this.domNode.style.height=`${C}px`,this.container){const V=C-this._decoratingElementsHeight();this.container.style.height=`${V}px`;const U=this.editor.getLayoutInfo();this._doLayout(V,this._getWidth(U))}(W=this._resizeSash)===null||W===void 0||W.layout()}get position(){const C=this._positionMarkerId.getRange(0);if(C)return C.getStartPosition()}show(C,W){const V=Range$2.isIRange(C)?Range$2.lift(C):Range$2.fromPositions(C);this._isShowing=!0,this._showImpl(V,W),this._isShowing=!1,this._positionMarkerId.set([{range:V,options:ModelDecorationOptions.EMPTY}])}hide(){var C;this._viewZone&&(this.editor.changeViewZones(W=>{this._viewZone&&W.removeZone(this._viewZone.id)}),this._viewZone=null),this._overlayWidget&&(this.editor.removeOverlayWidget(this._overlayWidget),this._overlayWidget=null),(C=this._arrow)===null||C===void 0||C.hide(),this._positionMarkerId.clear()}_decoratingElementsHeight(){const C=this.editor.getOption(66);let W=0;if(this.options.showArrow){const V=Math.round(C/3);W+=2*V}if(this.options.showFrame){const V=Math.round(C/9);W+=2*V}return W}_showImpl(C,W){const V=C.getStartPosition(),U=this.editor.getLayoutInfo(),G=this._getWidth(U);this.domNode.style.width=`${G}px`,this.domNode.style.left=this._getLeft(U)+"px";const Z=document.createElement("div");Z.style.overflow="hidden";const X=this.editor.getOption(66);if(!this.options.allowUnlimitedHeight){const ie=Math.max(12,this.editor.getLayoutInfo().height/X*.8);W=Math.min(W,ie)}let Q=0,J=0;if(this._arrow&&this.options.showArrow&&(Q=Math.round(X/3),this._arrow.height=Q,this._arrow.show(V)),this.options.showFrame&&(J=Math.round(X/9)),this.editor.changeViewZones(ie=>{this._viewZone&&ie.removeZone(this._viewZone.id),this._overlayWidget&&(this.editor.removeOverlayWidget(this._overlayWidget),this._overlayWidget=null),this.domNode.style.top="-1000px",this._viewZone=new ViewZoneDelegate(Z,V.lineNumber,V.column,W,ne=>this._onViewZoneTop(ne),ne=>this._onViewZoneHeight(ne),this.options.showInHiddenAreas,this.options.ordinal),this._viewZone.id=ie.addZone(this._viewZone),this._overlayWidget=new OverlayWidgetDelegate(WIDGET_ID+this._viewZone.id,this.domNode),this.editor.addOverlayWidget(this._overlayWidget)}),this.container&&this.options.showFrame){const ie=this.options.frameWidth?this.options.frameWidth:J;this.container.style.borderTopWidth=ie+"px",this.container.style.borderBottomWidth=ie+"px"}const ee=W*X-this._decoratingElementsHeight();this.container&&(this.container.style.top=Q+"px",this.container.style.height=ee+"px",this.container.style.overflow="hidden"),this._doLayout(ee,G),this.options.keepEditorSelection||this.editor.setSelection(C);const te=this.editor.getModel();if(te){const ie=te.validateRange(new Range$2(C.startLineNumber,1,C.endLineNumber+1,1));this.revealRange(ie,ie.startLineNumber===te.getLineCount())}}revealRange(C,W){W?this.editor.revealLineNearTop(C.endLineNumber,0):this.editor.revealRange(C,0)}setCssClass(C,W){this.container&&(W&&this.container.classList.remove(W),this.container.classList.add(C))}_onWidth(C){}_doLayout(C,W){}_relayout(C){this._viewZone&&this._viewZone.heightInLines!==C&&this.editor.changeViewZones(W=>{this._viewZone&&(this._viewZone.heightInLines=C,W.layoutZone(this._viewZone.id))})}_initSash(){if(this._resizeSash)return;this._resizeSash=this._disposables.add(new Sash(this.domNode,this,{orientation:1})),this.options.isResizeable||(this._resizeSash.state=0);let C;this._disposables.add(this._resizeSash.onDidStart(W=>{this._viewZone&&(C={startY:W.startY,heightInLines:this._viewZone.heightInLines})})),this._disposables.add(this._resizeSash.onDidEnd(()=>{C=void 0})),this._disposables.add(this._resizeSash.onDidChange(W=>{if(C){const V=(W.currentY-C.startY)/this.editor.getOption(66),U=V<0?Math.ceil(V):Math.floor(V),G=C.heightInLines+U;G>5&&G<35&&this._relayout(G)}}))}getHorizontalSashLeft(){return 0}getHorizontalSashTop(){return(this.domNode.style.height===null?0:parseInt(this.domNode.style.height))-this._decoratingElementsHeight()/2}getHorizontalSashWidth(){const C=this.editor.getLayoutInfo();return C.width-C.minimap.minimapWidth}}var __decorate$1b=globalThis&&globalThis.__decorate||function(K,C,W,V){var U=arguments.length,G=U<3?C:V===null?V=Object.getOwnPropertyDescriptor(C,W):V,Z;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")G=Reflect.decorate(K,C,W,V);else for(var X=K.length-1;X>=0;X--)(Z=K[X])&&(G=(U<3?Z(G):U>3?Z(C,W,G):Z(C,W))||G);return U>3&&G&&Object.defineProperty(C,W,G),G},__param$1b=globalThis&&globalThis.__param||function(K,C){return function(W,V){C(W,V,K)}};const IPeekViewService=createDecorator("IPeekViewService");registerSingleton(IPeekViewService,class{constructor(){this._widgets=new Map}addExclusiveWidget(K,C){const W=this._widgets.get(K);W&&(W.listener.dispose(),W.widget.dispose());const V=()=>{const U=this._widgets.get(K);U&&U.widget===C&&(U.listener.dispose(),this._widgets.delete(K))};this._widgets.set(K,{widget:C,listener:C.onDidClose(V)})}},1);var PeekContext;(function(K){K.inPeekEditor=new RawContextKey("inReferenceSearchEditor",!0,localize("inReferenceSearchEditor","Whether the current code editor is embedded inside peek")),K.notInPeekEditor=K.inPeekEditor.toNegated()})(PeekContext||(PeekContext={}));let PeekContextController=class{constructor(C,W){C instanceof EmbeddedCodeEditorWidget&&PeekContext.inPeekEditor.bindTo(W)}dispose(){}};PeekContextController.ID="editor.contrib.referenceController";PeekContextController=__decorate$1b([__param$1b(1,IContextKeyService)],PeekContextController);registerEditorContribution(PeekContextController.ID,PeekContextController,0);function getOuterEditor(K){const C=K.get(ICodeEditorService).getFocusedCodeEditor();return C instanceof EmbeddedCodeEditorWidget?C.getParentEditor():C}const defaultOptions={headerBackgroundColor:Color.white,primaryHeadingColor:Color.fromHex("#333333"),secondaryHeadingColor:Color.fromHex("#6c6c6cb3")};let PeekViewWidget=class extends ZoneWidget{constructor(C,W,V){super(C,W),this.instantiationService=V,this._onDidClose=new Emitter$1,this.onDidClose=this._onDidClose.event,mixin(this.options,defaultOptions,!1)}dispose(){this.disposed||(this.disposed=!0,super.dispose(),this._onDidClose.fire(this))}style(C){const W=this.options;C.headerBackgroundColor&&(W.headerBackgroundColor=C.headerBackgroundColor),C.primaryHeadingColor&&(W.primaryHeadingColor=C.primaryHeadingColor),C.secondaryHeadingColor&&(W.secondaryHeadingColor=C.secondaryHeadingColor),super.style(C)}_applyStyles(){super._applyStyles();const C=this.options;this._headElement&&C.headerBackgroundColor&&(this._headElement.style.backgroundColor=C.headerBackgroundColor.toString()),this._primaryHeading&&C.primaryHeadingColor&&(this._primaryHeading.style.color=C.primaryHeadingColor.toString()),this._secondaryHeading&&C.secondaryHeadingColor&&(this._secondaryHeading.style.color=C.secondaryHeadingColor.toString()),this._bodyElement&&C.frameColor&&(this._bodyElement.style.borderColor=C.frameColor.toString())}_fillContainer(C){this.setCssClass("peekview-widget"),this._headElement=$$d(".head"),this._bodyElement=$$d(".body"),this._fillHead(this._headElement),this._fillBody(this._bodyElement),C.appendChild(this._headElement),C.appendChild(this._bodyElement)}_fillHead(C,W){this._titleElement=$$d(".peekview-title"),this.options.supportOnTitleClick&&(this._titleElement.classList.add("clickable"),addStandardDisposableListener(this._titleElement,"click",G=>this._onTitleClick(G))),append$3(this._headElement,this._titleElement),this._fillTitleIcon(this._titleElement),this._primaryHeading=$$d("span.filename"),this._secondaryHeading=$$d("span.dirname"),this._metaHeading=$$d("span.meta"),append$3(this._titleElement,this._primaryHeading,this._secondaryHeading,this._metaHeading);const V=$$d(".peekview-actions");append$3(this._headElement,V);const U=this._getActionBarOptions();this._actionbarWidget=new ActionBar(V,U),this._disposables.add(this._actionbarWidget),W||this._actionbarWidget.push(new Action("peekview.close",localize("label.close","Close"),ThemeIcon.asClassName(Codicon.close),!0,()=>(this.dispose(),Promise.resolve())),{label:!1,icon:!0})}_fillTitleIcon(C){}_getActionBarOptions(){return{actionViewItemProvider:createActionViewItem.bind(void 0,this.instantiationService),orientation:0}}_onTitleClick(C){}setTitle(C,W){this._primaryHeading&&this._secondaryHeading&&(this._primaryHeading.innerText=C,this._primaryHeading.setAttribute("title",C),W?this._secondaryHeading.innerText=W:clearNode(this._secondaryHeading))}setMetaTitle(C){this._metaHeading&&(C?(this._metaHeading.innerText=C,show(this._metaHeading)):hide(this._metaHeading))}_doLayout(C,W){if(!this._isShowing&&C<0){this.dispose();return}const V=Math.ceil(this.editor.getOption(66)*1.2),U=Math.round(C-(V+2));this._doLayoutHead(V,W),this._doLayoutBody(U,W)}_doLayoutHead(C,W){this._headElement&&(this._headElement.style.height=`${C}px`,this._headElement.style.lineHeight=this._headElement.style.height)}_doLayoutBody(C,W){this._bodyElement&&(this._bodyElement.style.height=`${C}px`)}};PeekViewWidget=__decorate$1b([__param$1b(2,IInstantiationService)],PeekViewWidget);const peekViewTitleBackground=registerColor("peekViewTitle.background",{dark:"#252526",light:"#F3F3F3",hcDark:Color.black,hcLight:Color.white},localize("peekViewTitleBackground","Background color of the peek view title area.")),peekViewTitleForeground=registerColor("peekViewTitleLabel.foreground",{dark:Color.white,light:Color.black,hcDark:Color.white,hcLight:editorForeground},localize("peekViewTitleForeground","Color of the peek view title.")),peekViewTitleInfoForeground=registerColor("peekViewTitleDescription.foreground",{dark:"#ccccccb3",light:"#616161",hcDark:"#FFFFFF99",hcLight:"#292929"},localize("peekViewTitleInfoForeground","Color of the peek view title info.")),peekViewBorder=registerColor("peekView.border",{dark:editorInfoForeground,light:editorInfoForeground,hcDark:contrastBorder,hcLight:contrastBorder},localize("peekViewBorder","Color of the peek view borders and arrow.")),peekViewResultsBackground=registerColor("peekViewResult.background",{dark:"#252526",light:"#F3F3F3",hcDark:Color.black,hcLight:Color.white},localize("peekViewResultsBackground","Background color of the peek view result list."));registerColor("peekViewResult.lineForeground",{dark:"#bbbbbb",light:"#646465",hcDark:Color.white,hcLight:editorForeground},localize("peekViewResultsMatchForeground","Foreground color for line nodes in the peek view result list."));registerColor("peekViewResult.fileForeground",{dark:Color.white,light:"#1E1E1E",hcDark:Color.white,hcLight:editorForeground},localize("peekViewResultsFileForeground","Foreground color for file nodes in the peek view result list."));registerColor("peekViewResult.selectionBackground",{dark:"#3399ff33",light:"#3399ff33",hcDark:null,hcLight:null},localize("peekViewResultsSelectionBackground","Background color of the selected entry in the peek view result list."));registerColor("peekViewResult.selectionForeground",{dark:Color.white,light:"#6C6C6C",hcDark:Color.white,hcLight:editorForeground},localize("peekViewResultsSelectionForeground","Foreground color of the selected entry in the peek view result list."));const peekViewEditorBackground=registerColor("peekViewEditor.background",{dark:"#001F33",light:"#F2F8FC",hcDark:Color.black,hcLight:Color.white},localize("peekViewEditorBackground","Background color of the peek view editor."));registerColor("peekViewEditorGutter.background",{dark:peekViewEditorBackground,light:peekViewEditorBackground,hcDark:peekViewEditorBackground,hcLight:peekViewEditorBackground},localize("peekViewEditorGutterBackground","Background color of the gutter in the peek view editor."));registerColor("peekViewEditorStickyScroll.background",{dark:peekViewEditorBackground,light:peekViewEditorBackground,hcDark:peekViewEditorBackground,hcLight:peekViewEditorBackground},localize("peekViewEditorStickScrollBackground","Background color of sticky scroll in the peek view editor."));registerColor("peekViewResult.matchHighlightBackground",{dark:"#ea5c004d",light:"#ea5c004d",hcDark:null,hcLight:null},localize("peekViewResultsMatchHighlight","Match highlight color in the peek view result list."));registerColor("peekViewEditor.matchHighlightBackground",{dark:"#ff8f0099",light:"#f5d802de",hcDark:null,hcLight:null},localize("peekViewEditorMatchHighlight","Match highlight color in the peek view editor."));registerColor("peekViewEditor.matchHighlightBorder",{dark:null,light:null,hcDark:activeContrastBorder,hcLight:activeContrastBorder},localize("peekViewEditorMatchHighlightBorder","Match highlight border in the peek view editor."));var __awaiter$U=globalThis&&globalThis.__awaiter||function(K,C,W,V){function U(G){return G instanceof W?G:new W(function(Z){Z(G)})}return new(W||(W=Promise))(function(G,Z){function X(ee){try{J(V.next(ee))}catch(te){Z(te)}}function Q(ee){try{J(V.throw(ee))}catch(te){Z(te)}}function J(ee){ee.done?G(ee.value):U(ee.value).then(X,Q)}J((V=V.apply(K,C||[])).next())})};class OneReference{constructor(C,W,V,U){this.isProviderFirst=C,this.parent=W,this.link=V,this._rangeCallback=U,this.id=defaultGenerator.nextId()}get uri(){return this.link.uri}get range(){var C,W;return(W=(C=this._range)!==null&&C!==void 0?C:this.link.targetSelectionRange)!==null&&W!==void 0?W:this.link.range}set range(C){this._range=C,this._rangeCallback(this)}get ariaMessage(){var C;const W=(C=this.parent.getPreview(this))===null||C===void 0?void 0:C.preview(this.range);return W?localize({key:"aria.oneReference.preview",comment:["Placeholders are: 0: filename, 1:line number, 2: column number, 3: preview snippet of source code"]},"{0} in {1} on line {2} at column {3}",W.value,basename(this.uri),this.range.startLineNumber,this.range.startColumn):localize("aria.oneReference","in {0} on line {1} at column {2}",basename(this.uri),this.range.startLineNumber,this.range.startColumn)}}class FilePreview{constructor(C){this._modelReference=C}dispose(){this._modelReference.dispose()}preview(C,W=8){const V=this._modelReference.object.textEditorModel;if(!V)return;const{startLineNumber:U,startColumn:G,endLineNumber:Z,endColumn:X}=C,Q=V.getWordUntilPosition({lineNumber:U,column:G-W}),J=new Range$2(U,Q.startColumn,U,G),ee=new Range$2(Z,X,Z,1073741824),te=V.getValueInRange(J).replace(/^\s+/,""),ie=V.getValueInRange(C),ne=V.getValueInRange(ee).replace(/\s+$/,"");return{value:te+ie+ne,highlight:{start:te.length,end:te.length+ie.length}}}}class FileReferences{constructor(C,W){this.parent=C,this.uri=W,this.children=[],this._previews=new ResourceMap}dispose(){dispose(this._previews.values()),this._previews.clear()}getPreview(C){return this._previews.get(C.uri)}get ariaMessage(){const C=this.children.length;return C===1?localize("aria.fileReferences.1","1 symbol in {0}, full path {1}",basename(this.uri),this.uri.fsPath):localize("aria.fileReferences.N","{0} symbols in {1}, full path {2}",C,basename(this.uri),this.uri.fsPath)}resolve(C){return __awaiter$U(this,void 0,void 0,function*(){if(this._previews.size!==0)return this;for(const W of this.children)if(!this._previews.has(W.uri))try{const V=yield C.createModelReference(W.uri);this._previews.set(W.uri,new FilePreview(V))}catch(V){onUnexpectedError(V)}return this})}}class ReferencesModel{constructor(C,W){this.groups=[],this.references=[],this._onDidChangeReferenceRange=new Emitter$1,this.onDidChangeReferenceRange=this._onDidChangeReferenceRange.event,this._links=C,this._title=W;const[V]=C;C.sort(ReferencesModel._compareReferences);let U;for(const G of C)if((!U||!extUri.isEqual(U.uri,G.uri,!0))&&(U=new FileReferences(this,G.uri),this.groups.push(U)),U.children.length===0||ReferencesModel._compareReferences(G,U.children[U.children.length-1])!==0){const Z=new OneReference(V===G,U,G,X=>this._onDidChangeReferenceRange.fire(X));this.references.push(Z),U.children.push(Z)}}dispose(){dispose(this.groups),this._onDidChangeReferenceRange.dispose(),this.groups.length=0}clone(){return new ReferencesModel(this._links,this._title)}get title(){return this._title}get isEmpty(){return this.groups.length===0}get ariaMessage(){return this.isEmpty?localize("aria.result.0","No results found"):this.references.length===1?localize("aria.result.1","Found 1 symbol in {0}",this.references[0].uri.fsPath):this.groups.length===1?localize("aria.result.n1","Found {0} symbols in {1}",this.references.length,this.groups[0].uri.fsPath):localize("aria.result.nm","Found {0} symbols in {1} files",this.references.length,this.groups.length)}nextOrPreviousReference(C,W){const{parent:V}=C;let U=V.children.indexOf(C);const G=V.children.length,Z=V.parent.groups.length;return Z===1||W&&U+1<G||!W&&U>0?(W?U=(U+1)%G:U=(U+G-1)%G,V.children[U]):(U=V.parent.groups.indexOf(V),W?(U=(U+1)%Z,V.parent.groups[U].children[0]):(U=(U+Z-1)%Z,V.parent.groups[U].children[V.parent.groups[U].children.length-1]))}nearestReference(C,W){const V=this.references.map((U,G)=>({idx:G,prefixLen:commonPrefixLength(U.uri.toString(),C.toString()),offsetDist:Math.abs(U.range.startLineNumber-W.lineNumber)*100+Math.abs(U.range.startColumn-W.column)})).sort((U,G)=>U.prefixLen>G.prefixLen?-1:U.prefixLen<G.prefixLen?1:U.offsetDist<G.offsetDist?-1:U.offsetDist>G.offsetDist?1:0)[0];if(V)return this.references[V.idx]}referenceAt(C,W){for(const V of this.references)if(V.uri.toString()===C.toString()&&Range$2.containsPosition(V.range,W))return V}firstReference(){for(const C of this.references)if(C.isProviderFirst)return C;return this.references[0]}static _compareReferences(C,W){return extUri.compare(C.uri,W.uri)||Range$2.compareRangesUsingStarts(C.range,W.range)}}const referencesWidget="";var __decorate$1a=globalThis&&globalThis.__decorate||function(K,C,W,V){var U=arguments.length,G=U<3?C:V===null?V=Object.getOwnPropertyDescriptor(C,W):V,Z;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")G=Reflect.decorate(K,C,W,V);else for(var X=K.length-1;X>=0;X--)(Z=K[X])&&(G=(U<3?Z(G):U>3?Z(C,W,G):Z(C,W))||G);return U>3&&G&&Object.defineProperty(C,W,G),G},__param$1a=globalThis&&globalThis.__param||function(K,C){return function(W,V){C(W,V,K)}},FileReferencesRenderer_1;let DataSource=class{constructor(C){this._resolverService=C}hasChildren(C){return C instanceof ReferencesModel||C instanceof FileReferences}getChildren(C){if(C instanceof ReferencesModel)return C.groups;if(C instanceof FileReferences)return C.resolve(this._resolverService).then(W=>W.children);throw new Error("bad tree")}};DataSource=__decorate$1a([__param$1a(0,ITextModelService)],DataSource);class Delegate{getHeight(){return 23}getTemplateId(C){return C instanceof FileReferences?FileReferencesRenderer.id:OneReferenceRenderer.id}}let StringRepresentationProvider=class{constructor(C){this._keybindingService=C}getKeyboardNavigationLabel(C){var W;if(C instanceof OneReference){const V=(W=C.parent.getPreview(C))===null||W===void 0?void 0:W.preview(C.range);if(V)return V.value}return basename(C.uri)}};StringRepresentationProvider=__decorate$1a([__param$1a(0,IKeybindingService)],StringRepresentationProvider);class IdentityProvider{getId(C){return C instanceof OneReference?C.id:C.uri}}let FileReferencesTemplate=class extends Disposable{constructor(C,W){super(),this._labelService=W;const V=document.createElement("div");V.classList.add("reference-file"),this.file=this._register(new IconLabel(V,{supportHighlights:!0})),this.badge=new CountBadge(append$3(V,$$d(".count")),{},defaultCountBadgeStyles),C.appendChild(V)}set(C,W){const V=dirname(C.uri);this.file.setLabel(this._labelService.getUriBasenameLabel(C.uri),this._labelService.getUriLabel(V,{relative:!0}),{title:this._labelService.getUriLabel(C.uri),matches:W});const U=C.children.length;this.badge.setCount(U),U>1?this.badge.setTitleFormat(localize("referencesCount","{0} references",U)):this.badge.setTitleFormat(localize("referenceCount","{0} reference",U))}};FileReferencesTemplate=__decorate$1a([__param$1a(1,ILabelService)],FileReferencesTemplate);let FileReferencesRenderer=FileReferencesRenderer_1=class{constructor(C){this._instantiationService=C,this.templateId=FileReferencesRenderer_1.id}renderTemplate(C){return this._instantiationService.createInstance(FileReferencesTemplate,C)}renderElement(C,W,V){V.set(C.element,createMatches(C.filterData))}disposeTemplate(C){C.dispose()}};FileReferencesRenderer.id="FileReferencesRenderer";FileReferencesRenderer=FileReferencesRenderer_1=__decorate$1a([__param$1a(0,IInstantiationService)],FileReferencesRenderer);class OneReferenceTemplate{constructor(C){this.label=new HighlightedLabel(C)}set(C,W){var V;const U=(V=C.parent.getPreview(C))===null||V===void 0?void 0:V.preview(C.range);if(!U||!U.value)this.label.set(`${basename(C.uri)}:${C.range.startLineNumber+1}:${C.range.startColumn+1}`);else{const{value:G,highlight:Z}=U;W&&!FuzzyScore.isDefault(W)?(this.label.element.classList.toggle("referenceMatch",!1),this.label.set(G,createMatches(W))):(this.label.element.classList.toggle("referenceMatch",!0),this.label.set(G,[Z]))}}}class OneReferenceRenderer{constructor(){this.templateId=OneReferenceRenderer.id}renderTemplate(C){return new OneReferenceTemplate(C)}renderElement(C,W,V){V.set(C.element,C.filterData)}disposeTemplate(){}}OneReferenceRenderer.id="OneReferenceRenderer";class AccessibilityProvider{getWidgetAriaLabel(){return localize("treeAriaLabel","References")}getAriaLabel(C){return C.ariaMessage}}var __decorate$19=globalThis&&globalThis.__decorate||function(K,C,W,V){var U=arguments.length,G=U<3?C:V===null?V=Object.getOwnPropertyDescriptor(C,W):V,Z;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")G=Reflect.decorate(K,C,W,V);else for(var X=K.length-1;X>=0;X--)(Z=K[X])&&(G=(U<3?Z(G):U>3?Z(C,W,G):Z(C,W))||G);return U>3&&G&&Object.defineProperty(C,W,G),G},__param$19=globalThis&&globalThis.__param||function(K,C){return function(W,V){C(W,V,K)}},__awaiter$T=globalThis&&globalThis.__awaiter||function(K,C,W,V){function U(G){return G instanceof W?G:new W(function(Z){Z(G)})}return new(W||(W=Promise))(function(G,Z){function X(ee){try{J(V.next(ee))}catch(te){Z(te)}}function Q(ee){try{J(V.throw(ee))}catch(te){Z(te)}}function J(ee){ee.done?G(ee.value):U(ee.value).then(X,Q)}J((V=V.apply(K,C||[])).next())})};class DecorationsManager{constructor(C,W){this._editor=C,this._model=W,this._decorations=new Map,this._decorationIgnoreSet=new Set,this._callOnDispose=new DisposableStore,this._callOnModelChange=new DisposableStore,this._callOnDispose.add(this._editor.onDidChangeModel(()=>this._onModelChanged())),this._onModelChanged()}dispose(){this._callOnModelChange.dispose(),this._callOnDispose.dispose(),this.removeDecorations()}_onModelChanged(){this._callOnModelChange.clear();const C=this._editor.getModel();if(C){for(const W of this._model.references)if(W.uri.toString()===C.uri.toString()){this._addDecorations(W.parent);return}}}_addDecorations(C){if(!this._editor.hasModel())return;this._callOnModelChange.add(this._editor.getModel().onDidChangeDecorations(()=>this._onDecorationChanged()));const W=[],V=[];for(let U=0,G=C.children.length;U<G;U++){const Z=C.children[U];this._decorationIgnoreSet.has(Z.id)||Z.uri.toString()===this._editor.getModel().uri.toString()&&(W.push({range:Z.range,options:DecorationsManager.DecorationOptions}),V.push(U))}this._editor.changeDecorations(U=>{const G=U.deltaDecorations([],W);for(let Z=0;Z<G.length;Z++)this._decorations.set(G[Z],C.children[V[Z]])})}_onDecorationChanged(){const C=[],W=this._editor.getModel();if(W){for(const[V,U]of this._decorations){const G=W.getDecorationRange(V);if(!G)continue;let Z=!1;if(!Range$2.equalsRange(G,U.range)){if(Range$2.spansMultipleLines(G))Z=!0;else{const X=U.range.endColumn-U.range.startColumn,Q=G.endColumn-G.startColumn;X!==Q&&(Z=!0)}Z?(this._decorationIgnoreSet.add(U.id),C.push(V)):U.range=G}}for(let V=0,U=C.length;V<U;V++)this._decorations.delete(C[V]);this._editor.removeDecorations(C)}}removeDecorations(){this._editor.removeDecorations([...this._decorations.keys()]),this._decorations.clear()}}DecorationsManager.DecorationOptions=ModelDecorationOptions.register({description:"reference-decoration",stickiness:1,className:"reference-decoration"});class LayoutData{constructor(){this.ratio=.7,this.heightInLines=18}static fromJSON(C){let W,V;try{const U=JSON.parse(C);W=U.ratio,V=U.heightInLines}catch{}return{ratio:W||.7,heightInLines:V||18}}}class ReferencesTree extends WorkbenchAsyncDataTree{}let ReferenceWidget=class extends PeekViewWidget{constructor(C,W,V,U,G,Z,X,Q,J,ee,te,ie){super(C,{showFrame:!1,showArrow:!0,isResizeable:!0,isAccessible:!0,supportOnTitleClick:!0},Z),this._defaultTreeKeyboardSupport=W,this.layoutData=V,this._textModelResolverService=G,this._instantiationService=Z,this._peekViewService=X,this._uriLabel=Q,this._undoRedoService=J,this._keybindingService=ee,this._languageService=te,this._languageConfigurationService=ie,this._disposeOnNewModel=new DisposableStore,this._callOnDispose=new DisposableStore,this._onDidSelectReference=new Emitter$1,this.onDidSelectReference=this._onDidSelectReference.event,this._dim=new Dimension(0,0),this._applyTheme(U.getColorTheme()),this._callOnDispose.add(U.onDidColorThemeChange(this._applyTheme.bind(this))),this._peekViewService.addExclusiveWidget(C,this),this.create()}dispose(){this.setModel(void 0),this._callOnDispose.dispose(),this._disposeOnNewModel.dispose(),dispose(this._preview),dispose(this._previewNotAvailableMessage),dispose(this._tree),dispose(this._previewModelReference),this._splitView.dispose(),super.dispose()}_applyTheme(C){const W=C.getColor(peekViewBorder)||Color.transparent;this.style({arrowColor:W,frameColor:W,headerBackgroundColor:C.getColor(peekViewTitleBackground)||Color.transparent,primaryHeadingColor:C.getColor(peekViewTitleForeground),secondaryHeadingColor:C.getColor(peekViewTitleInfoForeground)})}show(C){super.show(C,this.layoutData.heightInLines||18)}focusOnReferenceTree(){this._tree.domFocus()}focusOnPreviewEditor(){this._preview.focus()}isPreviewEditorFocused(){return this._preview.hasTextFocus()}_onTitleClick(C){this._preview&&this._preview.getModel()&&this._onDidSelectReference.fire({element:this._getFocusedReference(),kind:C.ctrlKey||C.metaKey||C.altKey?"side":"open",source:"title"})}_fillBody(C){this.setCssClass("reference-zone-widget"),this._messageContainer=append$3(C,$$d("div.messages")),hide(this._messageContainer),this._splitView=new SplitView(C,{orientation:1}),this._previewContainer=append$3(C,$$d("div.preview.inline"));const W={scrollBeyondLastLine:!1,scrollbar:{verticalScrollbarSize:14,horizontal:"auto",useShadows:!0,verticalHasArrows:!1,horizontalHasArrows:!1,alwaysConsumeMouseWheel:!0},overviewRulerLanes:2,fixedOverflowWidgets:!0,minimap:{enabled:!1}};this._preview=this._instantiationService.createInstance(EmbeddedCodeEditorWidget,this._previewContainer,W,{},this.editor),hide(this._previewContainer),this._previewNotAvailableMessage=new TextModel(localize("missingPreviewMessage","no preview available"),PLAINTEXT_LANGUAGE_ID,TextModel.DEFAULT_CREATION_OPTIONS,null,this._undoRedoService,this._languageService,this._languageConfigurationService),this._treeContainer=append$3(C,$$d("div.ref-tree.inline"));const V={keyboardSupport:this._defaultTreeKeyboardSupport,accessibilityProvider:new AccessibilityProvider,keyboardNavigationLabelProvider:this._instantiationService.createInstance(StringRepresentationProvider),identityProvider:new IdentityProvider,openOnSingleClick:!0,selectionNavigation:!0,overrideStyles:{listBackground:peekViewResultsBackground}};this._defaultTreeKeyboardSupport&&this._callOnDispose.add(addStandardDisposableListener(this._treeContainer,"keydown",G=>{G.equals(9)&&(this._keybindingService.dispatchEvent(G,G.target),G.stopPropagation())},!0)),this._tree=this._instantiationService.createInstance(ReferencesTree,"ReferencesWidget",this._treeContainer,new Delegate,[this._instantiationService.createInstance(FileReferencesRenderer),this._instantiationService.createInstance(OneReferenceRenderer)],this._instantiationService.createInstance(DataSource),V),this._splitView.addView({onDidChange:Event$1.None,element:this._previewContainer,minimumSize:200,maximumSize:Number.MAX_VALUE,layout:G=>{this._preview.layout({height:this._dim.height,width:G})}},Sizing.Distribute),this._splitView.addView({onDidChange:Event$1.None,element:this._treeContainer,minimumSize:100,maximumSize:Number.MAX_VALUE,layout:G=>{this._treeContainer.style.height=`${this._dim.height}px`,this._treeContainer.style.width=`${G}px`,this._tree.layout(this._dim.height,G)}},Sizing.Distribute),this._disposables.add(this._splitView.onDidSashChange(()=>{this._dim.width&&(this.layoutData.ratio=this._splitView.getViewSize(0)/this._dim.width)},void 0));const U=(G,Z)=>{G instanceof OneReference&&(Z==="show"&&this._revealReference(G,!1),this._onDidSelectReference.fire({element:G,kind:Z,source:"tree"}))};this._tree.onDidOpen(G=>{G.sideBySide?U(G.element,"side"):G.editorOptions.pinned?U(G.element,"goto"):U(G.element,"show")}),hide(this._treeContainer)}_onWidth(C){this._dim&&this._doLayoutBody(this._dim.height,C)}_doLayoutBody(C,W){super._doLayoutBody(C,W),this._dim=new Dimension(W,C),this.layoutData.heightInLines=this._viewZone?this._viewZone.heightInLines:this.layoutData.heightInLines,this._splitView.layout(W),this._splitView.resizeView(0,W*this.layoutData.ratio)}setSelection(C){return this._revealReference(C,!0).then(()=>{this._model&&(this._tree.setSelection([C]),this._tree.setFocus([C]))})}setModel(C){return this._disposeOnNewModel.clear(),this._model=C,this._model?this._onNewModel():Promise.resolve()}_onNewModel(){return this._model?this._model.isEmpty?(this.setTitle(""),this._messageContainer.innerText=localize("noResults","No results"),show(this._messageContainer),Promise.resolve(void 0)):(hide(this._messageContainer),this._decorationsManager=new DecorationsManager(this._preview,this._model),this._disposeOnNewModel.add(this._decorationsManager),this._disposeOnNewModel.add(this._model.onDidChangeReferenceRange(C=>this._tree.rerender(C))),this._disposeOnNewModel.add(this._preview.onMouseDown(C=>{const{event:W,target:V}=C;if(W.detail!==2)return;const U=this._getFocusedReference();U&&this._onDidSelectReference.fire({element:{uri:U.uri,range:V.range},kind:W.ctrlKey||W.metaKey||W.altKey?"side":"open",source:"editor"})})),this.container.classList.add("results-loaded"),show(this._treeContainer),show(this._previewContainer),this._splitView.layout(this._dim.width),this.focusOnReferenceTree(),this._tree.setInput(this._model.groups.length===1?this._model.groups[0]:this._model)):Promise.resolve(void 0)}_getFocusedReference(){const[C]=this._tree.getFocus();if(C instanceof OneReference)return C;if(C instanceof FileReferences&&C.children.length>0)return C.children[0]}revealReference(C){return __awaiter$T(this,void 0,void 0,function*(){yield this._revealReference(C,!1),this._onDidSelectReference.fire({element:C,kind:"goto",source:"tree"})})}_revealReference(C,W){return __awaiter$T(this,void 0,void 0,function*(){if(this._revealedReference===C)return;this._revealedReference=C,C.uri.scheme!==Schemas.inMemory?this.setTitle(basenameOrAuthority(C.uri),this._uriLabel.getUriLabel(dirname(C.uri))):this.setTitle(localize("peekView.alternateTitle","References"));const V=this._textModelResolverService.createModelReference(C.uri);this._tree.getInput()===C.parent?this._tree.reveal(C):(W&&this._tree.reveal(C.parent),yield this._tree.expand(C.parent),this._tree.reveal(C));const U=yield V;if(!this._model){U.dispose();return}dispose(this._previewModelReference);const G=U.object;if(G){const Z=this._preview.getModel()===G.textEditorModel?0:1,X=Range$2.lift(C.range).collapseToStart();this._previewModelReference=U,this._preview.setModel(G.textEditorModel),this._preview.setSelection(X),this._preview.revealRangeInCenter(X,Z)}else this._preview.setModel(this._previewNotAvailableMessage),U.dispose()})}};ReferenceWidget=__decorate$19([__param$19(3,IThemeService),__param$19(4,ITextModelService),__param$19(5,IInstantiationService),__param$19(6,IPeekViewService),__param$19(7,ILabelService),__param$19(8,IUndoRedoService),__param$19(9,IKeybindingService),__param$19(10,ILanguageService),__param$19(11,ILanguageConfigurationService)],ReferenceWidget);var __decorate$18=globalThis&&globalThis.__decorate||function(K,C,W,V){var U=arguments.length,G=U<3?C:V===null?V=Object.getOwnPropertyDescriptor(C,W):V,Z;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")G=Reflect.decorate(K,C,W,V);else for(var X=K.length-1;X>=0;X--)(Z=K[X])&&(G=(U<3?Z(G):U>3?Z(C,W,G):Z(C,W))||G);return U>3&&G&&Object.defineProperty(C,W,G),G},__param$18=globalThis&&globalThis.__param||function(K,C){return function(W,V){C(W,V,K)}},__awaiter$S=globalThis&&globalThis.__awaiter||function(K,C,W,V){function U(G){return G instanceof W?G:new W(function(Z){Z(G)})}return new(W||(W=Promise))(function(G,Z){function X(ee){try{J(V.next(ee))}catch(te){Z(te)}}function Q(ee){try{J(V.throw(ee))}catch(te){Z(te)}}function J(ee){ee.done?G(ee.value):U(ee.value).then(X,Q)}J((V=V.apply(K,C||[])).next())})},ReferencesController_1;const ctxReferenceSearchVisible=new RawContextKey("referenceSearchVisible",!1,localize("referenceSearchVisible","Whether reference peek is visible, like 'Peek References' or 'Peek Definition'"));let ReferencesController=ReferencesController_1=class{static get(C){return C.getContribution(ReferencesController_1.ID)}constructor(C,W,V,U,G,Z,X,Q){this._defaultTreeKeyboardSupport=C,this._editor=W,this._editorService=U,this._notificationService=G,this._instantiationService=Z,this._storageService=X,this._configurationService=Q,this._disposables=new DisposableStore,this._requestIdPool=0,this._ignoreModelChangeEvent=!1,this._referenceSearchVisible=ctxReferenceSearchVisible.bindTo(V)}dispose(){var C,W;this._referenceSearchVisible.reset(),this._disposables.dispose(),(C=this._widget)===null||C===void 0||C.dispose(),(W=this._model)===null||W===void 0||W.dispose(),this._widget=void 0,this._model=void 0}toggleWidget(C,W,V){let U;if(this._widget&&(U=this._widget.position),this.closeWidget(),U&&C.containsPosition(U))return;this._peekMode=V,this._referenceSearchVisible.set(!0),this._disposables.add(this._editor.onDidChangeModelLanguage(()=>{this.closeWidget()})),this._disposables.add(this._editor.onDidChangeModel(()=>{this._ignoreModelChangeEvent||this.closeWidget()}));const G="peekViewLayout",Z=LayoutData.fromJSON(this._storageService.get(G,0,"{}"));this._widget=this._instantiationService.createInstance(ReferenceWidget,this._editor,this._defaultTreeKeyboardSupport,Z),this._widget.setTitle(localize("labelLoading","Loading...")),this._widget.show(C),this._disposables.add(this._widget.onDidClose(()=>{W.cancel(),this._widget&&(this._storageService.store(G,JSON.stringify(this._widget.layoutData),0,1),this._widget=void 0),this.closeWidget()})),this._disposables.add(this._widget.onDidSelectReference(Q=>{const{element:J,kind:ee}=Q;if(J)switch(ee){case"open":(Q.source!=="editor"||!this._configurationService.getValue("editor.stablePeek"))&&this.openReference(J,!1,!1);break;case"side":this.openReference(J,!0,!1);break;case"goto":V?this._gotoReference(J,!0):this.openReference(J,!1,!0);break}}));const X=++this._requestIdPool;W.then(Q=>{var J;if(X!==this._requestIdPool||!this._widget){Q.dispose();return}return(J=this._model)===null||J===void 0||J.dispose(),this._model=Q,this._widget.setModel(this._model).then(()=>{if(this._widget&&this._model&&this._editor.hasModel()){this._model.isEmpty?this._widget.setMetaTitle(""):this._widget.setMetaTitle(localize("metaTitle.N","{0} ({1})",this._model.title,this._model.references.length));const ee=this._editor.getModel().uri,te=new Position$1(C.startLineNumber,C.startColumn),ie=this._model.nearestReference(ee,te);if(ie)return this._widget.setSelection(ie).then(()=>{this._widget&&this._editor.getOption(86)==="editor"&&this._widget.focusOnPreviewEditor()})}})},Q=>{this._notificationService.error(Q)})}changeFocusBetweenPreviewAndReferences(){this._widget&&(this._widget.isPreviewEditorFocused()?this._widget.focusOnReferenceTree():this._widget.focusOnPreviewEditor())}goToNextOrPreviousReference(C){return __awaiter$S(this,void 0,void 0,function*(){if(!this._editor.hasModel()||!this._model||!this._widget)return;const W=this._widget.position;if(!W)return;const V=this._model.nearestReference(this._editor.getModel().uri,W);if(!V)return;const U=this._model.nextOrPreviousReference(V,C),G=this._editor.hasTextFocus(),Z=this._widget.isPreviewEditorFocused();yield this._widget.setSelection(U),yield this._gotoReference(U,!1),G?this._editor.focus():this._widget&&Z&&this._widget.focusOnPreviewEditor()})}revealReference(C){return __awaiter$S(this,void 0,void 0,function*(){!this._editor.hasModel()||!this._model||!this._widget||(yield this._widget.revealReference(C))})}closeWidget(C=!0){var W,V;(W=this._widget)===null||W===void 0||W.dispose(),(V=this._model)===null||V===void 0||V.dispose(),this._referenceSearchVisible.reset(),this._disposables.clear(),this._widget=void 0,this._model=void 0,C&&this._editor.focus(),this._requestIdPool+=1}_gotoReference(C,W){var V;(V=this._widget)===null||V===void 0||V.hide(),this._ignoreModelChangeEvent=!0;const U=Range$2.lift(C.range).collapseToStart();return this._editorService.openCodeEditor({resource:C.uri,options:{selection:U,selectionSource:"code.jump",pinned:W}},this._editor).then(G=>{var Z;if(this._ignoreModelChangeEvent=!1,!G||!this._widget){this.closeWidget();return}if(this._editor===G)this._widget.show(U),this._widget.focusOnReferenceTree();else{const X=ReferencesController_1.get(G),Q=this._model.clone();this.closeWidget(),G.focus(),X==null||X.toggleWidget(U,createCancelablePromise(J=>Promise.resolve(Q)),(Z=this._peekMode)!==null&&Z!==void 0?Z:!1)}},G=>{this._ignoreModelChangeEvent=!1,onUnexpectedError(G)})}openReference(C,W,V){W||this.closeWidget();const{uri:U,range:G}=C;this._editorService.openCodeEditor({resource:U,options:{selection:G,selectionSource:"code.jump",pinned:V}},this._editor,W)}};ReferencesController.ID="editor.contrib.referencesController";ReferencesController=ReferencesController_1=__decorate$18([__param$18(2,IContextKeyService),__param$18(3,ICodeEditorService),__param$18(4,INotificationService),__param$18(5,IInstantiationService),__param$18(6,IStorageService),__param$18(7,IConfigurationService)],ReferencesController);function withController(K,C){const W=getOuterEditor(K);if(!W)return;const V=ReferencesController.get(W);V&&C(V)}KeybindingsRegistry.registerCommandAndKeybindingRule({id:"togglePeekWidgetFocus",weight:100,primary:KeyChord(2089,60),when:ContextKeyExpr.or(ctxReferenceSearchVisible,PeekContext.inPeekEditor),handler(K){withController(K,C=>{C.changeFocusBetweenPreviewAndReferences()})}});KeybindingsRegistry.registerCommandAndKeybindingRule({id:"goToNextReference",weight:100-10,primary:62,secondary:[70],when:ContextKeyExpr.or(ctxReferenceSearchVisible,PeekContext.inPeekEditor),handler(K){withController(K,C=>{C.goToNextOrPreviousReference(!0)})}});KeybindingsRegistry.registerCommandAndKeybindingRule({id:"goToPreviousReference",weight:100-10,primary:1086,secondary:[1094],when:ContextKeyExpr.or(ctxReferenceSearchVisible,PeekContext.inPeekEditor),handler(K){withController(K,C=>{C.goToNextOrPreviousReference(!1)})}});CommandsRegistry.registerCommandAlias("goToNextReferenceFromEmbeddedEditor","goToNextReference");CommandsRegistry.registerCommandAlias("goToPreviousReferenceFromEmbeddedEditor","goToPreviousReference");CommandsRegistry.registerCommandAlias("closeReferenceSearchEditor","closeReferenceSearch");CommandsRegistry.registerCommand("closeReferenceSearch",K=>withController(K,C=>C.closeWidget()));KeybindingsRegistry.registerKeybindingRule({id:"closeReferenceSearch",weight:100-101,primary:9,secondary:[1033],when:ContextKeyExpr.and(PeekContext.inPeekEditor,ContextKeyExpr.not("config.editor.stablePeek"))});KeybindingsRegistry.registerKeybindingRule({id:"closeReferenceSearch",weight:200+50,primary:9,secondary:[1033],when:ContextKeyExpr.and(ctxReferenceSearchVisible,ContextKeyExpr.not("config.editor.stablePeek"))});KeybindingsRegistry.registerCommandAndKeybindingRule({id:"revealReference",weight:200,primary:3,mac:{primary:3,secondary:[2066]},when:ContextKeyExpr.and(ctxReferenceSearchVisible,WorkbenchListFocusContextKey,WorkbenchTreeElementCanCollapse.negate(),WorkbenchTreeElementCanExpand.negate()),handler(K){var C;const V=(C=K.get(IListService).lastFocusedList)===null||C===void 0?void 0:C.getFocus();Array.isArray(V)&&V[0]instanceof OneReference&&withController(K,U=>U.revealReference(V[0]))}});KeybindingsRegistry.registerCommandAndKeybindingRule({id:"openReferenceToSide",weight:100,primary:2051,mac:{primary:259},when:ContextKeyExpr.and(ctxReferenceSearchVisible,WorkbenchListFocusContextKey,WorkbenchTreeElementCanCollapse.negate(),WorkbenchTreeElementCanExpand.negate()),handler(K){var C;const V=(C=K.get(IListService).lastFocusedList)===null||C===void 0?void 0:C.getFocus();Array.isArray(V)&&V[0]instanceof OneReference&&withController(K,U=>U.openReference(V[0],!0,!0))}});CommandsRegistry.registerCommand("openReference",K=>{var C;const V=(C=K.get(IListService).lastFocusedList)===null||C===void 0?void 0:C.getFocus();Array.isArray(V)&&V[0]instanceof OneReference&&withController(K,U=>U.openReference(V[0],!1,!0))});var __decorate$17=globalThis&&globalThis.__decorate||function(K,C,W,V){var U=arguments.length,G=U<3?C:V===null?V=Object.getOwnPropertyDescriptor(C,W):V,Z;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")G=Reflect.decorate(K,C,W,V);else for(var X=K.length-1;X>=0;X--)(Z=K[X])&&(G=(U<3?Z(G):U>3?Z(C,W,G):Z(C,W))||G);return U>3&&G&&Object.defineProperty(C,W,G),G},__param$17=globalThis&&globalThis.__param||function(K,C){return function(W,V){C(W,V,K)}};const ctxHasSymbols=new RawContextKey("hasSymbols",!1,localize("hasSymbols","Whether there are symbol locations that can be navigated via keyboard-only.")),ISymbolNavigationService=createDecorator("ISymbolNavigationService");let SymbolNavigationService=class{constructor(C,W,V,U){this._editorService=W,this._notificationService=V,this._keybindingService=U,this._currentModel=void 0,this._currentIdx=-1,this._ignoreEditorChange=!1,this._ctxHasSymbols=ctxHasSymbols.bindTo(C)}reset(){var C,W;this._ctxHasSymbols.reset(),(C=this._currentState)===null||C===void 0||C.dispose(),(W=this._currentMessage)===null||W===void 0||W.dispose(),this._currentModel=void 0,this._currentIdx=-1}put(C){const W=C.parent.parent;if(W.references.length<=1){this.reset();return}this._currentModel=W,this._currentIdx=W.references.indexOf(C),this._ctxHasSymbols.set(!0),this._showMessage();const V=new EditorState(this._editorService),U=V.onDidChange(G=>{if(this._ignoreEditorChange)return;const Z=this._editorService.getActiveCodeEditor();if(!Z)return;const X=Z.getModel(),Q=Z.getPosition();if(!X||!Q)return;let J=!1,ee=!1;for(const te of W.references)if(isEqual(te.uri,X.uri))J=!0,ee=ee||Range$2.containsPosition(te.range,Q);else if(J)break;(!J||!ee)&&this.reset()});this._currentState=combinedDisposable(V,U)}revealNext(C){if(!this._currentModel)return Promise.resolve();this._currentIdx+=1,this._currentIdx%=this._currentModel.references.length;const W=this._currentModel.references[this._currentIdx];return this._showMessage(),this._ignoreEditorChange=!0,this._editorService.openCodeEditor({resource:W.uri,options:{selection:Range$2.collapseToStart(W.range),selectionRevealType:3}},C).finally(()=>{this._ignoreEditorChange=!1})}_showMessage(){var C;(C=this._currentMessage)===null||C===void 0||C.dispose();const W=this._keybindingService.lookupKeybinding("editor.gotoNextSymbolFromResult"),V=W?localize("location.kb","Symbol {0} of {1}, {2} for next",this._currentIdx+1,this._currentModel.references.length,W.getLabel()):localize("location","Symbol {0} of {1}",this._currentIdx+1,this._currentModel.references.length);this._currentMessage=this._notificationService.status(V)}};SymbolNavigationService=__decorate$17([__param$17(0,IContextKeyService),__param$17(1,ICodeEditorService),__param$17(2,INotificationService),__param$17(3,IKeybindingService)],SymbolNavigationService);registerSingleton(ISymbolNavigationService,SymbolNavigationService,1);registerEditorCommand(new class extends EditorCommand{constructor(){super({id:"editor.gotoNextSymbolFromResult",precondition:ctxHasSymbols,kbOpts:{weight:100,primary:70}})}runEditorCommand(K,C){return K.get(ISymbolNavigationService).revealNext(C)}});KeybindingsRegistry.registerCommandAndKeybindingRule({id:"editor.gotoNextSymbolFromResult.cancel",weight:100,when:ctxHasSymbols,primary:9,handler(K){K.get(ISymbolNavigationService).reset()}});let EditorState=class{constructor(C){this._listener=new Map,this._disposables=new DisposableStore,this._onDidChange=new Emitter$1,this.onDidChange=this._onDidChange.event,this._disposables.add(C.onCodeEditorRemove(this._onDidRemoveEditor,this)),this._disposables.add(C.onCodeEditorAdd(this._onDidAddEditor,this)),C.listCodeEditors().forEach(this._onDidAddEditor,this)}dispose(){this._disposables.dispose(),this._onDidChange.dispose(),dispose(this._listener.values())}_onDidAddEditor(C){this._listener.set(C,combinedDisposable(C.onDidChangeCursorPosition(W=>this._onDidChange.fire({editor:C})),C.onDidChangeModelContent(W=>this._onDidChange.fire({editor:C}))))}_onDidRemoveEditor(C){var W;(W=this._listener.get(C))===null||W===void 0||W.dispose(),this._listener.delete(C)}};EditorState=__decorate$17([__param$17(0,ICodeEditorService)],EditorState);var __awaiter$R=globalThis&&globalThis.__awaiter||function(K,C,W,V){function U(G){return G instanceof W?G:new W(function(Z){Z(G)})}return new(W||(W=Promise))(function(G,Z){function X(ee){try{J(V.next(ee))}catch(te){Z(te)}}function Q(ee){try{J(V.throw(ee))}catch(te){Z(te)}}function J(ee){ee.done?G(ee.value):U(ee.value).then(X,Q)}J((V=V.apply(K,C||[])).next())})};function getLocationLinks(K,C,W,V){return __awaiter$R(this,void 0,void 0,function*(){const G=W.ordered(K).map(X=>Promise.resolve(V(X,K,C)).then(void 0,Q=>{onUnexpectedExternalError(Q)})),Z=yield Promise.all(G);return coalesce(Z.flat())})}function getDefinitionsAtPosition(K,C,W,V){return getLocationLinks(C,W,K,(U,G,Z)=>U.provideDefinition(G,Z,V))}function getDeclarationsAtPosition(K,C,W,V){return getLocationLinks(C,W,K,(U,G,Z)=>U.provideDeclaration(G,Z,V))}function getImplementationsAtPosition(K,C,W,V){return getLocationLinks(C,W,K,(U,G,Z)=>U.provideImplementation(G,Z,V))}function getTypeDefinitionsAtPosition(K,C,W,V){return getLocationLinks(C,W,K,(U,G,Z)=>U.provideTypeDefinition(G,Z,V))}function getReferencesAtPosition(K,C,W,V,U){return getLocationLinks(C,W,K,(G,Z,X)=>__awaiter$R(this,void 0,void 0,function*(){const Q=yield G.provideReferences(Z,X,{includeDeclaration:!0},U);if(!V||!Q||Q.length!==2)return Q;const J=yield G.provideReferences(Z,X,{includeDeclaration:!1},U);return J&&J.length===1?J:Q}))}function _sortedAndDeduped(K){return __awaiter$R(this,void 0,void 0,function*(){const C=yield K(),W=new ReferencesModel(C,""),V=W.references.map(U=>U.link);return W.dispose(),V})}registerModelAndPositionCommand("_executeDefinitionProvider",(K,C,W)=>{const V=K.get(ILanguageFeaturesService),U=getDefinitionsAtPosition(V.definitionProvider,C,W,CancellationToken.None);return _sortedAndDeduped(()=>U)});registerModelAndPositionCommand("_executeTypeDefinitionProvider",(K,C,W)=>{const V=K.get(ILanguageFeaturesService),U=getTypeDefinitionsAtPosition(V.typeDefinitionProvider,C,W,CancellationToken.None);return _sortedAndDeduped(()=>U)});registerModelAndPositionCommand("_executeDeclarationProvider",(K,C,W)=>{const V=K.get(ILanguageFeaturesService),U=getDeclarationsAtPosition(V.declarationProvider,C,W,CancellationToken.None);return _sortedAndDeduped(()=>U)});registerModelAndPositionCommand("_executeReferenceProvider",(K,C,W)=>{const V=K.get(ILanguageFeaturesService),U=getReferencesAtPosition(V.referenceProvider,C,W,!1,CancellationToken.None);return _sortedAndDeduped(()=>U)});registerModelAndPositionCommand("_executeImplementationProvider",(K,C,W)=>{const V=K.get(ILanguageFeaturesService),U=getImplementationsAtPosition(V.implementationProvider,C,W,CancellationToken.None);return _sortedAndDeduped(()=>U)});var __awaiter$Q=globalThis&&globalThis.__awaiter||function(K,C,W,V){function U(G){return G instanceof W?G:new W(function(Z){Z(G)})}return new(W||(W=Promise))(function(G,Z){function X(ee){try{J(V.next(ee))}catch(te){Z(te)}}function Q(ee){try{J(V.throw(ee))}catch(te){Z(te)}}function J(ee){ee.done?G(ee.value):U(ee.value).then(X,Q)}J((V=V.apply(K,C||[])).next())})},_a$1,_b,_c,_d,_e,_f,_g,_h;MenuRegistry.appendMenuItem(MenuId.EditorContext,{submenu:MenuId.EditorContextPeek,title:localize("peek.submenu","Peek"),group:"navigation",order:100});class SymbolNavigationAnchor{static is(C){return!C||typeof C!="object"?!1:!!(C instanceof SymbolNavigationAnchor||Position$1.isIPosition(C.position)&&C.model)}constructor(C,W){this.model=C,this.position=W}}class SymbolNavigationAction extends EditorAction2{static all(){return SymbolNavigationAction._allSymbolNavigationCommands.values()}static _patchConfig(C){const W=Object.assign(Object.assign({},C),{f1:!0});if(W.menu)for(const V of Iterable.wrap(W.menu))(V.id===MenuId.EditorContext||V.id===MenuId.EditorContextPeek)&&(V.when=ContextKeyExpr.and(C.precondition,V.when));return W}constructor(C,W){super(SymbolNavigationAction._patchConfig(W)),this.configuration=C,SymbolNavigationAction._allSymbolNavigationCommands.set(W.id,this)}runEditorCommand(C,W,V,U){if(!W.hasModel())return Promise.resolve(void 0);const G=C.get(INotificationService),Z=C.get(ICodeEditorService),X=C.get(IEditorProgressService),Q=C.get(ISymbolNavigationService),J=C.get(ILanguageFeaturesService),ee=C.get(IInstantiationService),te=W.getModel(),ie=W.getPosition(),ne=SymbolNavigationAnchor.is(V)?V:new SymbolNavigationAnchor(te,ie),oe=new EditorStateCancellationTokenSource(W,5),re=raceCancellation(this._getLocationModel(J,ne.model,ne.position,oe.token),oe.token).then(ae=>__awaiter$Q(this,void 0,void 0,function*(){var se;if(!ae||oe.token.isCancellationRequested)return;alert(ae.ariaMessage);let le;if(ae.referenceAt(te.uri,ie)){const de=this._getAlternativeCommand(W);!SymbolNavigationAction._activeAlternativeCommands.has(de)&&SymbolNavigationAction._allSymbolNavigationCommands.has(de)&&(le=SymbolNavigationAction._allSymbolNavigationCommands.get(de))}const ce=ae.references.length;if(ce===0){if(!this.configuration.muteMessage){const de=te.getWordAtPosition(ie);(se=MessageController.get(W))===null||se===void 0||se.showMessage(this._getNoResultFoundMessage(de),ie)}}else if(ce===1&&le)SymbolNavigationAction._activeAlternativeCommands.add(this.desc.id),ee.invokeFunction(de=>le.runEditorCommand(de,W,V,U).finally(()=>{SymbolNavigationAction._activeAlternativeCommands.delete(this.desc.id)}));else return this._onResult(Z,Q,W,ae,U)}),ae=>{G.error(ae)}).finally(()=>{oe.dispose()});return X.showWhile(re,250),re}_onResult(C,W,V,U,G){return __awaiter$Q(this,void 0,void 0,function*(){const Z=this._getGoToPreference(V);if(!(V instanceof EmbeddedCodeEditorWidget)&&(this.configuration.openInPeek||Z==="peek"&&U.references.length>1))this._openInPeek(V,U,G);else{const X=U.firstReference(),Q=U.references.length>1&&Z==="gotoAndPeek",J=yield this._openReference(V,C,X,this.configuration.openToSide,!Q);Q&&J?this._openInPeek(J,U,G):U.dispose(),Z==="goto"&&W.put(X)}})}_openReference(C,W,V,U,G){return __awaiter$Q(this,void 0,void 0,function*(){let Z;if(isLocationLink(V)&&(Z=V.targetSelectionRange),Z||(Z=V.range),!Z)return;const X=yield W.openCodeEditor({resource:V.uri,options:{selection:Range$2.collapseToStart(Z),selectionRevealType:3,selectionSource:"code.jump"}},C,U);if(X){if(G){const Q=X.getModel(),J=X.createDecorationsCollection([{range:Z,options:{description:"symbol-navigate-action-highlight",className:"symbolHighlight"}}]);setTimeout(()=>{X.getModel()===Q&&J.clear()},350)}return X}})}_openInPeek(C,W,V){const U=ReferencesController.get(C);U&&C.hasModel()?U.toggleWidget(V??C.getSelection(),createCancelablePromise(G=>Promise.resolve(W)),this.configuration.openInPeek):W.dispose()}}SymbolNavigationAction._allSymbolNavigationCommands=new Map;SymbolNavigationAction._activeAlternativeCommands=new Set;class DefinitionAction extends SymbolNavigationAction{_getLocationModel(C,W,V,U){return __awaiter$Q(this,void 0,void 0,function*(){return new ReferencesModel(yield getDefinitionsAtPosition(C.definitionProvider,W,V,U),localize("def.title","Definitions"))})}_getNoResultFoundMessage(C){return C&&C.word?localize("noResultWord","No definition found for '{0}'",C.word):localize("generic.noResults","No definition found")}_getAlternativeCommand(C){return C.getOption(58).alternativeDefinitionCommand}_getGoToPreference(C){return C.getOption(58).multipleDefinitions}}registerAction2((_a$1=class extends DefinitionAction{constructor(){super({openToSide:!1,openInPeek:!1,muteMessage:!1},{id:_a$1.id,title:{value:localize("actions.goToDecl.label","Go to Definition"),original:"Go to Definition",mnemonicTitle:localize({key:"miGotoDefinition",comment:["&& denotes a mnemonic"]},"Go to &&Definition")},precondition:ContextKeyExpr.and(EditorContextKeys.hasDefinitionProvider,EditorContextKeys.isInWalkThroughSnippet.toNegated()),keybinding:[{when:EditorContextKeys.editorTextFocus,primary:70,weight:100},{when:ContextKeyExpr.and(EditorContextKeys.editorTextFocus,IsWebContext),primary:2118,weight:100}],menu:[{id:MenuId.EditorContext,group:"navigation",order:1.1},{id:MenuId.MenubarGoMenu,precondition:null,group:"4_symbol_nav",order:2}]}),CommandsRegistry.registerCommandAlias("editor.action.goToDeclaration",_a$1.id)}},_a$1.id="editor.action.revealDefinition",_a$1));registerAction2((_b=class extends DefinitionAction{constructor(){super({openToSide:!0,openInPeek:!1,muteMessage:!1},{id:_b.id,title:{value:localize("actions.goToDeclToSide.label","Open Definition to the Side"),original:"Open Definition to the Side"},precondition:ContextKeyExpr.and(EditorContextKeys.hasDefinitionProvider,EditorContextKeys.isInWalkThroughSnippet.toNegated()),keybinding:[{when:EditorContextKeys.editorTextFocus,primary:KeyChord(2089,70),weight:100},{when:ContextKeyExpr.and(EditorContextKeys.editorTextFocus,IsWebContext),primary:KeyChord(2089,2118),weight:100}]}),CommandsRegistry.registerCommandAlias("editor.action.openDeclarationToTheSide",_b.id)}},_b.id="editor.action.revealDefinitionAside",_b));registerAction2((_c=class extends DefinitionAction{constructor(){super({openToSide:!1,openInPeek:!0,muteMessage:!1},{id:_c.id,title:{value:localize("actions.previewDecl.label","Peek Definition"),original:"Peek Definition"},precondition:ContextKeyExpr.and(EditorContextKeys.hasDefinitionProvider,PeekContext.notInPeekEditor,EditorContextKeys.isInWalkThroughSnippet.toNegated()),keybinding:{when:EditorContextKeys.editorTextFocus,primary:582,linux:{primary:3140},weight:100},menu:{id:MenuId.EditorContextPeek,group:"peek",order:2}}),CommandsRegistry.registerCommandAlias("editor.action.previewDeclaration",_c.id)}},_c.id="editor.action.peekDefinition",_c));class DeclarationAction extends SymbolNavigationAction{_getLocationModel(C,W,V,U){return __awaiter$Q(this,void 0,void 0,function*(){return new ReferencesModel(yield getDeclarationsAtPosition(C.declarationProvider,W,V,U),localize("decl.title","Declarations"))})}_getNoResultFoundMessage(C){return C&&C.word?localize("decl.noResultWord","No declaration found for '{0}'",C.word):localize("decl.generic.noResults","No declaration found")}_getAlternativeCommand(C){return C.getOption(58).alternativeDeclarationCommand}_getGoToPreference(C){return C.getOption(58).multipleDeclarations}}registerAction2((_d=class extends DeclarationAction{constructor(){super({openToSide:!1,openInPeek:!1,muteMessage:!1},{id:_d.id,title:{value:localize("actions.goToDeclaration.label","Go to Declaration"),original:"Go to Declaration",mnemonicTitle:localize({key:"miGotoDeclaration",comment:["&& denotes a mnemonic"]},"Go to &&Declaration")},precondition:ContextKeyExpr.and(EditorContextKeys.hasDeclarationProvider,EditorContextKeys.isInWalkThroughSnippet.toNegated()),menu:[{id:MenuId.EditorContext,group:"navigation",order:1.3},{id:MenuId.MenubarGoMenu,precondition:null,group:"4_symbol_nav",order:3}]})}_getNoResultFoundMessage(C){return C&&C.word?localize("decl.noResultWord","No declaration found for '{0}'",C.word):localize("decl.generic.noResults","No declaration found")}},_d.id="editor.action.revealDeclaration",_d));registerAction2(class extends DeclarationAction{constructor(){super({openToSide:!1,openInPeek:!0,muteMessage:!1},{id:"editor.action.peekDeclaration",title:{value:localize("actions.peekDecl.label","Peek Declaration"),original:"Peek Declaration"},precondition:ContextKeyExpr.and(EditorContextKeys.hasDeclarationProvider,PeekContext.notInPeekEditor,EditorContextKeys.isInWalkThroughSnippet.toNegated()),menu:{id:MenuId.EditorContextPeek,group:"peek",order:3}})}});class TypeDefinitionAction extends SymbolNavigationAction{_getLocationModel(C,W,V,U){return __awaiter$Q(this,void 0,void 0,function*(){return new ReferencesModel(yield getTypeDefinitionsAtPosition(C.typeDefinitionProvider,W,V,U),localize("typedef.title","Type Definitions"))})}_getNoResultFoundMessage(C){return C&&C.word?localize("goToTypeDefinition.noResultWord","No type definition found for '{0}'",C.word):localize("goToTypeDefinition.generic.noResults","No type definition found")}_getAlternativeCommand(C){return C.getOption(58).alternativeTypeDefinitionCommand}_getGoToPreference(C){return C.getOption(58).multipleTypeDefinitions}}registerAction2((_e=class extends TypeDefinitionAction{constructor(){super({openToSide:!1,openInPeek:!1,muteMessage:!1},{id:_e.ID,title:{value:localize("actions.goToTypeDefinition.label","Go to Type Definition"),original:"Go to Type Definition",mnemonicTitle:localize({key:"miGotoTypeDefinition",comment:["&& denotes a mnemonic"]},"Go to &&Type Definition")},precondition:ContextKeyExpr.and(EditorContextKeys.hasTypeDefinitionProvider,EditorContextKeys.isInWalkThroughSnippet.toNegated()),keybinding:{when:EditorContextKeys.editorTextFocus,primary:0,weight:100},menu:[{id:MenuId.EditorContext,group:"navigation",order:1.4},{id:MenuId.MenubarGoMenu,precondition:null,group:"4_symbol_nav",order:3}]})}},_e.ID="editor.action.goToTypeDefinition",_e));registerAction2((_f=class extends TypeDefinitionAction{constructor(){super({openToSide:!1,openInPeek:!0,muteMessage:!1},{id:_f.ID,title:{value:localize("actions.peekTypeDefinition.label","Peek Type Definition"),original:"Peek Type Definition"},precondition:ContextKeyExpr.and(EditorContextKeys.hasTypeDefinitionProvider,PeekContext.notInPeekEditor,EditorContextKeys.isInWalkThroughSnippet.toNegated()),menu:{id:MenuId.EditorContextPeek,group:"peek",order:4}})}},_f.ID="editor.action.peekTypeDefinition",_f));class ImplementationAction extends SymbolNavigationAction{_getLocationModel(C,W,V,U){return __awaiter$Q(this,void 0,void 0,function*(){return new ReferencesModel(yield getImplementationsAtPosition(C.implementationProvider,W,V,U),localize("impl.title","Implementations"))})}_getNoResultFoundMessage(C){return C&&C.word?localize("goToImplementation.noResultWord","No implementation found for '{0}'",C.word):localize("goToImplementation.generic.noResults","No implementation found")}_getAlternativeCommand(C){return C.getOption(58).alternativeImplementationCommand}_getGoToPreference(C){return C.getOption(58).multipleImplementations}}registerAction2((_g=class extends ImplementationAction{constructor(){super({openToSide:!1,openInPeek:!1,muteMessage:!1},{id:_g.ID,title:{value:localize("actions.goToImplementation.label","Go to Implementations"),original:"Go to Implementations",mnemonicTitle:localize({key:"miGotoImplementation",comment:["&& denotes a mnemonic"]},"Go to &&Implementations")},precondition:ContextKeyExpr.and(EditorContextKeys.hasImplementationProvider,EditorContextKeys.isInWalkThroughSnippet.toNegated()),keybinding:{when:EditorContextKeys.editorTextFocus,primary:2118,weight:100},menu:[{id:MenuId.EditorContext,group:"navigation",order:1.45},{id:MenuId.MenubarGoMenu,precondition:null,group:"4_symbol_nav",order:4}]})}},_g.ID="editor.action.goToImplementation",_g));registerAction2((_h=class extends ImplementationAction{constructor(){super({openToSide:!1,openInPeek:!0,muteMessage:!1},{id:_h.ID,title:{value:localize("actions.peekImplementation.label","Peek Implementations"),original:"Peek Implementations"},precondition:ContextKeyExpr.and(EditorContextKeys.hasImplementationProvider,PeekContext.notInPeekEditor,EditorContextKeys.isInWalkThroughSnippet.toNegated()),keybinding:{when:EditorContextKeys.editorTextFocus,primary:3142,weight:100},menu:{id:MenuId.EditorContextPeek,group:"peek",order:5}})}},_h.ID="editor.action.peekImplementation",_h));class ReferencesAction extends SymbolNavigationAction{_getNoResultFoundMessage(C){return C?localize("references.no","No references found for '{0}'",C.word):localize("references.noGeneric","No references found")}_getAlternativeCommand(C){return C.getOption(58).alternativeReferenceCommand}_getGoToPreference(C){return C.getOption(58).multipleReferences}}registerAction2(class extends ReferencesAction{constructor(){super({openToSide:!1,openInPeek:!1,muteMessage:!1},{id:"editor.action.goToReferences",title:{value:localize("goToReferences.label","Go to References"),original:"Go to References",mnemonicTitle:localize({key:"miGotoReference",comment:["&& denotes a mnemonic"]},"Go to &&References")},precondition:ContextKeyExpr.and(EditorContextKeys.hasReferenceProvider,PeekContext.notInPeekEditor,EditorContextKeys.isInWalkThroughSnippet.toNegated()),keybinding:{when:EditorContextKeys.editorTextFocus,primary:1094,weight:100},menu:[{id:MenuId.EditorContext,group:"navigation",order:1.45},{id:MenuId.MenubarGoMenu,precondition:null,group:"4_symbol_nav",order:5}]})}_getLocationModel(C,W,V,U){return __awaiter$Q(this,void 0,void 0,function*(){return new ReferencesModel(yield getReferencesAtPosition(C.referenceProvider,W,V,!0,U),localize("ref.title","References"))})}});registerAction2(class extends ReferencesAction{constructor(){super({openToSide:!1,openInPeek:!0,muteMessage:!1},{id:"editor.action.referenceSearch.trigger",title:{value:localize("references.action.label","Peek References"),original:"Peek References"},precondition:ContextKeyExpr.and(EditorContextKeys.hasReferenceProvider,PeekContext.notInPeekEditor,EditorContextKeys.isInWalkThroughSnippet.toNegated()),menu:{id:MenuId.EditorContextPeek,group:"peek",order:6}})}_getLocationModel(C,W,V,U){return __awaiter$Q(this,void 0,void 0,function*(){return new ReferencesModel(yield getReferencesAtPosition(C.referenceProvider,W,V,!1,U),localize("ref.title","References"))})}});class GenericGoToLocationAction extends SymbolNavigationAction{constructor(C,W,V){super(C,{id:"editor.action.goToLocation",title:{value:localize("label.generic","Go to Any Symbol"),original:"Go to Any Symbol"},precondition:ContextKeyExpr.and(PeekContext.notInPeekEditor,EditorContextKeys.isInWalkThroughSnippet.toNegated())}),this._references=W,this._gotoMultipleBehaviour=V}_getLocationModel(C,W,V,U){return __awaiter$Q(this,void 0,void 0,function*(){return new ReferencesModel(this._references,localize("generic.title","Locations"))})}_getNoResultFoundMessage(C){return C&&localize("generic.noResult","No results for '{0}'",C.word)||""}_getGoToPreference(C){var W;return(W=this._gotoMultipleBehaviour)!==null&&W!==void 0?W:C.getOption(58).multipleReferences}_getAlternativeCommand(){return""}}CommandsRegistry.registerCommand({id:"editor.action.goToLocations",description:{description:"Go to locations from a position in a file",args:[{name:"uri",description:"The text document in which to start",constraint:URI},{name:"position",description:"The position at which to start",constraint:Position$1.isIPosition},{name:"locations",description:"An array of locations.",constraint:Array},{name:"multiple",description:"Define what to do when having multiple results, either `peek`, `gotoAndPeek`, or `goto"},{name:"noResultsMessage",description:"Human readable message that shows when locations is empty."}]},handler:(K,C,W,V,U,G,Z)=>__awaiter$Q(void 0,void 0,void 0,function*(){assertType(URI.isUri(C)),assertType(Position$1.isIPosition(W)),assertType(Array.isArray(V)),assertType(typeof U>"u"||typeof U=="string"),assertType(typeof Z>"u"||typeof Z=="boolean");const X=K.get(ICodeEditorService),Q=yield X.openCodeEditor({resource:C},X.getFocusedCodeEditor());if(isCodeEditor(Q))return Q.setPosition(W),Q.revealPositionInCenterIfOutsideViewport(W,0),Q.invokeWithinContext(J=>{const ee=new class extends GenericGoToLocationAction{_getNoResultFoundMessage(te){return G||super._getNoResultFoundMessage(te)}}({muteMessage:!G,openInPeek:!!Z,openToSide:!1},V,U);J.get(IInstantiationService).invokeFunction(ee.run.bind(ee),Q)})})});CommandsRegistry.registerCommand({id:"editor.action.peekLocations",description:{description:"Peek locations from a position in a file",args:[{name:"uri",description:"The text document in which to start",constraint:URI},{name:"position",description:"The position at which to start",constraint:Position$1.isIPosition},{name:"locations",description:"An array of locations.",constraint:Array},{name:"multiple",description:"Define what to do when having multiple results, either `peek`, `gotoAndPeek`, or `goto"}]},handler:(K,C,W,V,U)=>__awaiter$Q(void 0,void 0,void 0,function*(){K.get(ICommandService).executeCommand("editor.action.goToLocations",C,W,V,U,void 0,!0)})});CommandsRegistry.registerCommand({id:"editor.action.findReferences",handler:(K,C,W)=>{assertType(URI.isUri(C)),assertType(Position$1.isIPosition(W));const V=K.get(ILanguageFeaturesService),U=K.get(ICodeEditorService);return U.openCodeEditor({resource:C},U.getFocusedCodeEditor()).then(G=>{if(!isCodeEditor(G)||!G.hasModel())return;const Z=ReferencesController.get(G);if(!Z)return;const X=createCancelablePromise(J=>getReferencesAtPosition(V.referenceProvider,G.getModel(),Position$1.lift(W),!1,J).then(ee=>new ReferencesModel(ee,localize("ref.title","References")))),Q=new Range$2(W.lineNumber,W.column,W.lineNumber,W.column);return Promise.resolve(Z.toggleWidget(Q,X,!1))})}});CommandsRegistry.registerCommandAlias("editor.action.showReferences","editor.action.peekLocations");var __decorate$16=globalThis&&globalThis.__decorate||function(K,C,W,V){var U=arguments.length,G=U<3?C:V===null?V=Object.getOwnPropertyDescriptor(C,W):V,Z;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")G=Reflect.decorate(K,C,W,V);else for(var X=K.length-1;X>=0;X--)(Z=K[X])&&(G=(U<3?Z(G):U>3?Z(C,W,G):Z(C,W))||G);return U>3&&G&&Object.defineProperty(C,W,G),G},__param$16=globalThis&&globalThis.__param||function(K,C){return function(W,V){C(W,V,K)}},__awaiter$P=globalThis&&globalThis.__awaiter||function(K,C,W,V){function U(G){return G instanceof W?G:new W(function(Z){Z(G)})}return new(W||(W=Promise))(function(G,Z){function X(ee){try{J(V.next(ee))}catch(te){Z(te)}}function Q(ee){try{J(V.throw(ee))}catch(te){Z(te)}}function J(ee){ee.done?G(ee.value):U(ee.value).then(X,Q)}J((V=V.apply(K,C||[])).next())})},GotoDefinitionAtPositionEditorContribution_1;let GotoDefinitionAtPositionEditorContribution=GotoDefinitionAtPositionEditorContribution_1=class{constructor(C,W,V,U){this.textModelResolverService=W,this.languageService=V,this.languageFeaturesService=U,this.toUnhook=new DisposableStore,this.toUnhookForKeyboard=new DisposableStore,this.currentWordAtPosition=null,this.previousPromise=null,this.editor=C,this.linkDecorations=this.editor.createDecorationsCollection();const G=new ClickLinkGesture(C);this.toUnhook.add(G),this.toUnhook.add(G.onMouseMoveOrRelevantKeyDown(([Z,X])=>{this.startFindDefinitionFromMouse(Z,X??void 0)})),this.toUnhook.add(G.onExecute(Z=>{this.isEnabled(Z)&&this.gotoDefinition(Z.target.position,Z.hasSideBySideModifier).catch(X=>{onUnexpectedError(X)}).finally(()=>{this.removeLinkDecorations()})})),this.toUnhook.add(G.onCancel(()=>{this.removeLinkDecorations(),this.currentWordAtPosition=null}))}static get(C){return C.getContribution(GotoDefinitionAtPositionEditorContribution_1.ID)}startFindDefinitionFromCursor(C){return __awaiter$P(this,void 0,void 0,function*(){yield this.startFindDefinition(C),this.toUnhookForKeyboard.add(this.editor.onDidChangeCursorPosition(()=>{this.currentWordAtPosition=null,this.removeLinkDecorations(),this.toUnhookForKeyboard.clear()})),this.toUnhookForKeyboard.add(this.editor.onKeyDown(W=>{W&&(this.currentWordAtPosition=null,this.removeLinkDecorations(),this.toUnhookForKeyboard.clear())}))})}startFindDefinitionFromMouse(C,W){if(C.target.type===9&&this.linkDecorations.length>0)return;if(!this.editor.hasModel()||!this.isEnabled(C,W)){this.currentWordAtPosition=null,this.removeLinkDecorations();return}const V=C.target.position;this.startFindDefinition(V)}startFindDefinition(C){var W;return __awaiter$P(this,void 0,void 0,function*(){this.toUnhookForKeyboard.clear();const V=C?(W=this.editor.getModel())===null||W===void 0?void 0:W.getWordAtPosition(C):null;if(!V){this.currentWordAtPosition=null,this.removeLinkDecorations();return}if(this.currentWordAtPosition&&this.currentWordAtPosition.startColumn===V.startColumn&&this.currentWordAtPosition.endColumn===V.endColumn&&this.currentWordAtPosition.word===V.word)return;this.currentWordAtPosition=V;const U=new EditorState$1(this.editor,15);this.previousPromise&&(this.previousPromise.cancel(),this.previousPromise=null),this.previousPromise=createCancelablePromise(X=>this.findDefinition(C,X));let G;try{G=yield this.previousPromise}catch(X){onUnexpectedError(X);return}if(!G||!G.length||!U.validate(this.editor)){this.removeLinkDecorations();return}const Z=G[0].originSelectionRange?Range$2.lift(G[0].originSelectionRange):new Range$2(C.lineNumber,V.startColumn,C.lineNumber,V.endColumn);if(G.length>1){let X=Z;for(const{originSelectionRange:Q}of G)Q&&(X=Range$2.plusRange(X,Q));this.addDecoration(X,new MarkdownString().appendText(localize("multipleResults","Click to show {0} definitions.",G.length)))}else{const X=G[0];if(!X.uri)return;this.textModelResolverService.createModelReference(X.uri).then(Q=>{if(!Q.object||!Q.object.textEditorModel){Q.dispose();return}const{object:{textEditorModel:J}}=Q,{startLineNumber:ee}=X.range;if(ee<1||ee>J.getLineCount()){Q.dispose();return}const te=this.getPreviewValue(J,ee,X),ie=this.languageService.guessLanguageIdByFilepathOrFirstLine(J.uri);this.addDecoration(Z,te?new MarkdownString().appendCodeblock(ie||"",te):void 0),Q.dispose()})}})}getPreviewValue(C,W,V){let U=V.range;return U.endLineNumber-U.startLineNumber>=GotoDefinitionAtPositionEditorContribution_1.MAX_SOURCE_PREVIEW_LINES&&(U=this.getPreviewRangeBasedOnIndentation(C,W)),this.stripIndentationFromPreviewRange(C,W,U)}stripIndentationFromPreviewRange(C,W,V){let G=C.getLineFirstNonWhitespaceColumn(W);for(let X=W+1;X<V.endLineNumber;X++){const Q=C.getLineFirstNonWhitespaceColumn(X);G=Math.min(G,Q)}return C.getValueInRange(V).replace(new RegExp(`^\\s{${G-1}}`,"gm"),"").trim()}getPreviewRangeBasedOnIndentation(C,W){const V=C.getLineFirstNonWhitespaceColumn(W),U=Math.min(C.getLineCount(),W+GotoDefinitionAtPositionEditorContribution_1.MAX_SOURCE_PREVIEW_LINES);let G=W+1;for(;G<U;G++){const Z=C.getLineFirstNonWhitespaceColumn(G);if(V===Z)break}return new Range$2(W,1,G+1,1)}addDecoration(C,W){const V={range:C,options:{description:"goto-definition-link",inlineClassName:"goto-definition-link",hoverMessage:W}};this.linkDecorations.set([V])}removeLinkDecorations(){this.linkDecorations.clear()}isEnabled(C,W){var V;return this.editor.hasModel()&&C.isLeftClick&&C.isNoneOrSingleMouseDown&&C.target.type===6&&!(((V=C.target.detail.injectedText)===null||V===void 0?void 0:V.options)instanceof ModelDecorationInjectedTextOptions)&&(C.hasTriggerModifier||(W?W.keyCodeIsTriggerKey:!1))&&this.languageFeaturesService.definitionProvider.has(this.editor.getModel())}findDefinition(C,W){const V=this.editor.getModel();return V?getDefinitionsAtPosition(this.languageFeaturesService.definitionProvider,V,C,W):Promise.resolve(null)}gotoDefinition(C,W){return this.editor.setPosition(C),this.editor.invokeWithinContext(V=>{const U=!W&&this.editor.getOption(87)&&!this.isInPeekEditor(V);return new DefinitionAction({openToSide:W,openInPeek:U,muteMessage:!0},{title:{value:"",original:""},id:"",precondition:void 0}).run(V)})}isInPeekEditor(C){const W=C.get(IContextKeyService);return PeekContext.inPeekEditor.getValue(W)}dispose(){this.toUnhook.dispose(),this.toUnhookForKeyboard.dispose()}};GotoDefinitionAtPositionEditorContribution.ID="editor.contrib.gotodefinitionatposition";GotoDefinitionAtPositionEditorContribution.MAX_SOURCE_PREVIEW_LINES=8;GotoDefinitionAtPositionEditorContribution=GotoDefinitionAtPositionEditorContribution_1=__decorate$16([__param$16(1,ITextModelService),__param$16(2,ILanguageService),__param$16(3,ILanguageFeaturesService)],GotoDefinitionAtPositionEditorContribution);registerEditorContribution(GotoDefinitionAtPositionEditorContribution.ID,GotoDefinitionAtPositionEditorContribution,2);const hover$1="",$$5=$$d;class HoverWidget extends Disposable{constructor(){super(),this.containerDomNode=document.createElement("div"),this.containerDomNode.className="monaco-hover",this.containerDomNode.tabIndex=0,this.containerDomNode.setAttribute("role","tooltip"),this.contentsDomNode=document.createElement("div"),this.contentsDomNode.className="monaco-hover-content",this.scrollbar=this._register(new DomScrollableElement(this.contentsDomNode,{consumeMouseWheelIfScrollbarIsNeeded:!0})),this.containerDomNode.appendChild(this.scrollbar.getDomNode())}onContentsChanged(){this.scrollbar.scanDomNode()}}class HoverAction extends Disposable{static render(C,W,V){return new HoverAction(C,W,V)}constructor(C,W,V){super(),this.actionContainer=append$3(C,$$5("div.action-container")),this.actionContainer.setAttribute("tabindex","0"),this.action=append$3(this.actionContainer,$$5("a.action")),this.action.setAttribute("role","button"),W.iconClass&&append$3(this.action,$$5(`span.icon.${W.iconClass}`));const U=append$3(this.action,$$5("span"));U.textContent=V?`${W.label} (${V})`:W.label,this._register(addDisposableListener(this.actionContainer,EventType$1.CLICK,G=>{G.stopPropagation(),G.preventDefault(),W.run(this.actionContainer)})),this._register(addDisposableListener(this.actionContainer,EventType$1.KEY_DOWN,G=>{const Z=new StandardKeyboardEvent(G);(Z.equals(3)||Z.equals(10))&&(G.stopPropagation(),G.preventDefault(),W.run(this.actionContainer))})),this.setEnabled(!0)}setEnabled(C){C?(this.actionContainer.classList.remove("disabled"),this.actionContainer.removeAttribute("aria-disabled")):(this.actionContainer.classList.add("disabled"),this.actionContainer.setAttribute("aria-disabled","true"))}}function getHoverAccessibleViewHint(K,C){return K&&C?localize("acessibleViewHint","Inspect this in the accessible view with {0}.",C):K?localize("acessibleViewHintNoKbOpen","Inspect this in the accessible view via the command Open Accessible View which is currently not triggerable via keybinding."):""}var __awaiter$O=globalThis&&globalThis.__awaiter||function(K,C,W,V){function U(G){return G instanceof W?G:new W(function(Z){Z(G)})}return new(W||(W=Promise))(function(G,Z){function X(ee){try{J(V.next(ee))}catch(te){Z(te)}}function Q(ee){try{J(V.throw(ee))}catch(te){Z(te)}}function J(ee){ee.done?G(ee.value):U(ee.value).then(X,Q)}J((V=V.apply(K,C||[])).next())})},__asyncValues$1=globalThis&&globalThis.__asyncValues||function(K){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var C=K[Symbol.asyncIterator],W;return C?C.call(K):(K=typeof __values=="function"?__values(K):K[Symbol.iterator](),W={},V("next"),V("throw"),V("return"),W[Symbol.asyncIterator]=function(){return this},W);function V(G){W[G]=K[G]&&function(Z){return new Promise(function(X,Q){Z=K[G](Z),U(X,Q,Z.done,Z.value)})}}function U(G,Z,X,Q){Promise.resolve(Q).then(function(J){G({value:J,done:X})},Z)}};let HoverResult$1=class{constructor(C,W,V){this.value=C,this.isComplete=W,this.hasLoadingMessage=V}};class HoverOperation extends Disposable{constructor(C,W){super(),this._editor=C,this._computer=W,this._onResult=this._register(new Emitter$1),this.onResult=this._onResult.event,this._firstWaitScheduler=this._register(new RunOnceScheduler(()=>this._triggerAsyncComputation(),0)),this._secondWaitScheduler=this._register(new RunOnceScheduler(()=>this._triggerSyncComputation(),0)),this._loadingMessageScheduler=this._register(new RunOnceScheduler(()=>this._triggerLoadingMessage(),0)),this._state=0,this._asyncIterable=null,this._asyncIterableDone=!1,this._result=[]}dispose(){this._asyncIterable&&(this._asyncIterable.cancel(),this._asyncIterable=null),super.dispose()}get _hoverTime(){return this._editor.getOption(60).delay}get _firstWaitTime(){return this._hoverTime/2}get _secondWaitTime(){return this._hoverTime-this._firstWaitTime}get _loadingMessageTime(){return 3*this._hoverTime}_setState(C,W=!0){this._state=C,W&&this._fireResult()}_triggerAsyncComputation(){this._setState(2),this._secondWaitScheduler.schedule(this._secondWaitTime),this._computer.computeAsync?(this._asyncIterableDone=!1,this._asyncIterable=createCancelableAsyncIterable(C=>this._computer.computeAsync(C)),__awaiter$O(this,void 0,void 0,function*(){var C,W,V,U;try{try{for(var G=!0,Z=__asyncValues$1(this._asyncIterable),X;X=yield Z.next(),C=X.done,!C;G=!0){U=X.value,G=!1;const Q=U;Q&&(this._result.push(Q),this._fireResult())}}catch(Q){W={error:Q}}finally{try{!G&&!C&&(V=Z.return)&&(yield V.call(Z))}finally{if(W)throw W.error}}this._asyncIterableDone=!0,(this._state===3||this._state===4)&&this._setState(0)}catch(Q){onUnexpectedError(Q)}})):this._asyncIterableDone=!0}_triggerSyncComputation(){this._computer.computeSync&&(this._result=this._result.concat(this._computer.computeSync())),this._setState(this._asyncIterableDone?0:3)}_triggerLoadingMessage(){this._state===3&&this._setState(4)}_fireResult(){if(this._state===1||this._state===2)return;const C=this._state===0,W=this._state===4;this._onResult.fire(new HoverResult$1(this._result.slice(0),C,W))}start(C){if(C===0)this._state===0&&(this._setState(1),this._firstWaitScheduler.schedule(this._firstWaitTime),this._loadingMessageScheduler.schedule(this._loadingMessageTime));else switch(this._state){case 0:this._triggerAsyncComputation(),this._secondWaitScheduler.cancel(),this._triggerSyncComputation();break;case 2:this._secondWaitScheduler.cancel(),this._triggerSyncComputation();break}}cancel(){this._firstWaitScheduler.cancel(),this._secondWaitScheduler.cancel(),this._loadingMessageScheduler.cancel(),this._asyncIterable&&(this._asyncIterable.cancel(),this._asyncIterable=null),this._result=[],this._setState(0,!1)}}class HoverRangeAnchor{constructor(C,W,V,U){this.priority=C,this.range=W,this.initialMousePosX=V,this.initialMousePosY=U,this.type=1}equals(C){return C.type===1&&this.range.equalsRange(C.range)}canAdoptVisibleHover(C,W){return C.type===1&&W.lineNumber===this.range.startLineNumber}}class HoverForeignElementAnchor{constructor(C,W,V,U,G,Z){this.priority=C,this.owner=W,this.range=V,this.initialMousePosX=U,this.initialMousePosY=G,this.supportsMarkerHover=Z,this.type=2}equals(C){return C.type===2&&this.owner===C.owner}canAdoptVisibleHover(C,W){return C.type===2&&this.owner===C.owner}}const HoverParticipantRegistry=new class{constructor(){this._participants=[]}register(C){this._participants.push(C)}getAll(){return this._participants}};class ResizableHTMLElement{constructor(){this._onDidWillResize=new Emitter$1,this.onDidWillResize=this._onDidWillResize.event,this._onDidResize=new Emitter$1,this.onDidResize=this._onDidResize.event,this._sashListener=new DisposableStore,this._size=new Dimension(0,0),this._minSize=new Dimension(0,0),this._maxSize=new Dimension(Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER),this.domNode=document.createElement("div"),this._eastSash=new Sash(this.domNode,{getVerticalSashLeft:()=>this._size.width},{orientation:0}),this._westSash=new Sash(this.domNode,{getVerticalSashLeft:()=>0},{orientation:0}),this._northSash=new Sash(this.domNode,{getHorizontalSashTop:()=>0},{orientation:1,orthogonalEdge:OrthogonalEdge.North}),this._southSash=new Sash(this.domNode,{getHorizontalSashTop:()=>this._size.height},{orientation:1,orthogonalEdge:OrthogonalEdge.South}),this._northSash.orthogonalStartSash=this._westSash,this._northSash.orthogonalEndSash=this._eastSash,this._southSash.orthogonalStartSash=this._westSash,this._southSash.orthogonalEndSash=this._eastSash;let C,W=0,V=0;this._sashListener.add(Event$1.any(this._northSash.onDidStart,this._eastSash.onDidStart,this._southSash.onDidStart,this._westSash.onDidStart)(()=>{C===void 0&&(this._onDidWillResize.fire(),C=this._size,W=0,V=0)})),this._sashListener.add(Event$1.any(this._northSash.onDidEnd,this._eastSash.onDidEnd,this._southSash.onDidEnd,this._westSash.onDidEnd)(()=>{C!==void 0&&(C=void 0,W=0,V=0,this._onDidResize.fire({dimension:this._size,done:!0}))})),this._sashListener.add(this._eastSash.onDidChange(U=>{C&&(V=U.currentX-U.startX,this.layout(C.height+W,C.width+V),this._onDidResize.fire({dimension:this._size,done:!1,east:!0}))})),this._sashListener.add(this._westSash.onDidChange(U=>{C&&(V=-(U.currentX-U.startX),this.layout(C.height+W,C.width+V),this._onDidResize.fire({dimension:this._size,done:!1,west:!0}))})),this._sashListener.add(this._northSash.onDidChange(U=>{C&&(W=-(U.currentY-U.startY),this.layout(C.height+W,C.width+V),this._onDidResize.fire({dimension:this._size,done:!1,north:!0}))})),this._sashListener.add(this._southSash.onDidChange(U=>{C&&(W=U.currentY-U.startY,this.layout(C.height+W,C.width+V),this._onDidResize.fire({dimension:this._size,done:!1,south:!0}))})),this._sashListener.add(Event$1.any(this._eastSash.onDidReset,this._westSash.onDidReset)(U=>{this._preferredSize&&(this.layout(this._size.height,this._preferredSize.width),this._onDidResize.fire({dimension:this._size,done:!0}))})),this._sashListener.add(Event$1.any(this._northSash.onDidReset,this._southSash.onDidReset)(U=>{this._preferredSize&&(this.layout(this._preferredSize.height,this._size.width),this._onDidResize.fire({dimension:this._size,done:!0}))}))}dispose(){this._northSash.dispose(),this._southSash.dispose(),this._eastSash.dispose(),this._westSash.dispose(),this._sashListener.dispose(),this._onDidResize.dispose(),this._onDidWillResize.dispose(),this.domNode.remove()}enableSashes(C,W,V,U){this._northSash.state=C?3:0,this._eastSash.state=W?3:0,this._southSash.state=V?3:0,this._westSash.state=U?3:0}layout(C=this.size.height,W=this.size.width){const{height:V,width:U}=this._minSize,{height:G,width:Z}=this._maxSize;C=Math.max(V,Math.min(G,C)),W=Math.max(U,Math.min(Z,W));const X=new Dimension(W,C);Dimension.equals(X,this._size)||(this.domNode.style.height=C+"px",this.domNode.style.width=W+"px",this._size=X,this._northSash.layout(),this._eastSash.layout(),this._southSash.layout(),this._westSash.layout())}clearSashHoverState(){this._eastSash.clearSashHoverState(),this._westSash.clearSashHoverState(),this._northSash.clearSashHoverState(),this._southSash.clearSashHoverState()}get size(){return this._size}set maxSize(C){this._maxSize=C}get maxSize(){return this._maxSize}set minSize(C){this._minSize=C}get minSize(){return this._minSize}set preferredSize(C){this._preferredSize=C}get preferredSize(){return this._preferredSize}}const TOP_HEIGHT=30,BOTTOM_HEIGHT=24;class ResizableContentWidget extends Disposable{constructor(C,W=new Dimension(10,10)){super(),this._editor=C,this.allowEditorOverflow=!0,this.suppressMouseDown=!1,this._resizableNode=this._register(new ResizableHTMLElement),this._contentPosition=null,this._isResizing=!1,this._resizableNode.domNode.style.position="absolute",this._resizableNode.minSize=Dimension.lift(W),this._resizableNode.layout(W.height,W.width),this._resizableNode.enableSashes(!0,!0,!0,!0),this._register(this._resizableNode.onDidResize(V=>{this._resize(new Dimension(V.dimension.width,V.dimension.height)),V.done&&(this._isResizing=!1)})),this._register(this._resizableNode.onDidWillResize(()=>{this._isResizing=!0}))}get isResizing(){return this._isResizing}getDomNode(){return this._resizableNode.domNode}getPosition(){return this._contentPosition}get position(){var C;return!((C=this._contentPosition)===null||C===void 0)&&C.position?Position$1.lift(this._contentPosition.position):void 0}_availableVerticalSpaceAbove(C){const W=this._editor.getDomNode(),V=this._editor.getScrolledVisiblePosition(C);return!W||!V?void 0:getDomNodePagePosition(W).top+V.top-TOP_HEIGHT}_availableVerticalSpaceBelow(C){const W=this._editor.getDomNode(),V=this._editor.getScrolledVisiblePosition(C);if(!W||!V)return;const U=getDomNodePagePosition(W),G=getClientArea(W.ownerDocument.body),Z=U.top+V.top+V.height;return G.height-Z-BOTTOM_HEIGHT}_findPositionPreference(C,W){var V,U;const G=Math.min((V=this._availableVerticalSpaceBelow(W))!==null&&V!==void 0?V:1/0,C),Z=Math.min((U=this._availableVerticalSpaceAbove(W))!==null&&U!==void 0?U:1/0,C),X=Math.min(Math.max(Z,G),C),Q=Math.min(C,X);let J;return this._editor.getOption(60).above?J=Q<=Z?1:2:J=Q<=G?2:1,J===1?this._resizableNode.enableSashes(!0,!0,!1,!1):this._resizableNode.enableSashes(!1,!0,!0,!1),J}_resize(C){this._resizableNode.layout(C.height,C.width)}}var __decorate$15=globalThis&&globalThis.__decorate||function(K,C,W,V){var U=arguments.length,G=U<3?C:V===null?V=Object.getOwnPropertyDescriptor(C,W):V,Z;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")G=Reflect.decorate(K,C,W,V);else for(var X=K.length-1;X>=0;X--)(Z=K[X])&&(G=(U<3?Z(G):U>3?Z(C,W,G):Z(C,W))||G);return U>3&&G&&Object.defineProperty(C,W,G),G},__param$15=globalThis&&globalThis.__param||function(K,C){return function(W,V){C(W,V,K)}},ContentHoverController_1,ContentHoverWidget_1;const $$4=$$d;let ContentHoverController=ContentHoverController_1=class extends Disposable{constructor(C,W,V){super(),this._editor=C,this._instantiationService=W,this._keybindingService=V,this._currentResult=null,this._widget=this._register(this._instantiationService.createInstance(ContentHoverWidget,this._editor)),this._participants=[];for(const U of HoverParticipantRegistry.getAll())this._participants.push(this._instantiationService.createInstance(U,this._editor));this._participants.sort((U,G)=>U.hoverOrdinal-G.hoverOrdinal),this._computer=new ContentHoverComputer(this._editor,this._participants),this._hoverOperation=this._register(new HoverOperation(this._editor,this._computer)),this._register(this._hoverOperation.onResult(U=>{if(!this._computer.anchor)return;const G=U.hasLoadingMessage?this._addLoadingMessage(U.value):U.value;this._withResult(new HoverResult(this._computer.anchor,G,U.isComplete))})),this._register(addStandardDisposableListener(this._widget.getDomNode(),"keydown",U=>{U.equals(9)&&this.hide()})),this._register(TokenizationRegistry.onDidChange(()=>{this._widget.position&&this._currentResult&&this._setCurrentResult(this._currentResult)}))}get widget(){return this._widget}maybeShowAt(C){if(this._widget.isResizing)return!0;const W=[];for(const U of this._participants)if(U.suggestHoverAnchor){const G=U.suggestHoverAnchor(C);G&&W.push(G)}const V=C.target;if(V.type===6&&W.push(new HoverRangeAnchor(0,V.range,C.event.posx,C.event.posy)),V.type===7){const U=this._editor.getOption(50).typicalHalfwidthCharacterWidth/2;!V.detail.isAfterLines&&typeof V.detail.horizontalDistanceToText=="number"&&V.detail.horizontalDistanceToText<U&&W.push(new HoverRangeAnchor(0,V.range,C.event.posx,C.event.posy))}return W.length===0?this._startShowingOrUpdateHover(null,0,0,!1,C):(W.sort((U,G)=>G.priority-U.priority),this._startShowingOrUpdateHover(W[0],0,0,!1,C))}startShowingAtRange(C,W,V,U){this._startShowingOrUpdateHover(new HoverRangeAnchor(0,C,void 0,void 0),W,V,U,null)}_startShowingOrUpdateHover(C,W,V,U,G){return!this._widget.position||!this._currentResult?C?(this._startHoverOperationIfNecessary(C,W,V,U,!1),!0):!1:this._editor.getOption(60).sticky&&G&&this._widget.isMouseGettingCloser(G.event.posx,G.event.posy)?(C&&this._startHoverOperationIfNecessary(C,W,V,U,!0),!0):C?C&&this._currentResult.anchor.equals(C)?!0:C.canAdoptVisibleHover(this._currentResult.anchor,this._widget.position)?(this._setCurrentResult(this._currentResult.filter(C)),this._startHoverOperationIfNecessary(C,W,V,U,!1),!0):(this._setCurrentResult(null),this._startHoverOperationIfNecessary(C,W,V,U,!1),!0):(this._setCurrentResult(null),!1)}_startHoverOperationIfNecessary(C,W,V,U,G){this._computer.anchor&&this._computer.anchor.equals(C)||(this._hoverOperation.cancel(),this._computer.anchor=C,this._computer.shouldFocus=U,this._computer.source=V,this._computer.insistOnKeepingHoverVisible=G,this._hoverOperation.start(W))}_setCurrentResult(C){this._currentResult!==C&&(C&&C.messages.length===0&&(C=null),this._currentResult=C,this._currentResult?this._renderMessages(this._currentResult.anchor,this._currentResult.messages):this._widget.hide())}hide(){this._computer.anchor=null,this._hoverOperation.cancel(),this._setCurrentResult(null)}get isColorPickerVisible(){return this._widget.isColorPickerVisible}get isVisibleFromKeyboard(){return this._widget.isVisibleFromKeyboard}get isVisible(){return this._widget.isVisible}get isFocused(){return this._widget.isFocused}get isResizing(){return this._widget.isResizing}containsNode(C){return C?this._widget.getDomNode().contains(C):!1}_addLoadingMessage(C){if(this._computer.anchor){for(const W of this._participants)if(W.createLoadingMessage){const V=W.createLoadingMessage(this._computer.anchor);if(V)return C.slice(0).concat([V])}}return C}_withResult(C){this._widget.position&&this._currentResult&&this._currentResult.isComplete&&(!C.isComplete||this._computer.insistOnKeepingHoverVisible&&C.messages.length===0)||this._setCurrentResult(C)}_renderMessages(C,W){const{showAtPosition:V,showAtSecondaryPosition:U,highlightRange:G}=ContentHoverController_1.computeHoverRanges(this._editor,C.range,W),Z=new DisposableStore,X=Z.add(new EditorHoverStatusBar(this._keybindingService)),Q=document.createDocumentFragment();let J=null;const ee={fragment:Q,statusBar:X,setColorPicker:ie=>J=ie,onContentsChanged:()=>this._widget.onContentsChanged(),setMinimumDimensions:ie=>this._widget.setMinimumDimensions(ie),hide:()=>this.hide()};for(const ie of this._participants){const ne=W.filter(oe=>oe.owner===ie);ne.length>0&&Z.add(ie.renderHoverParts(ee,ne))}const te=W.some(ie=>ie.isBeforeContent);if(X.hasContent&&Q.appendChild(X.hoverElement),Q.hasChildNodes()){if(G){const ie=this._editor.createDecorationsCollection();ie.set([{range:G,options:ContentHoverController_1._DECORATION_OPTIONS}]),Z.add(toDisposable(()=>{ie.clear()}))}this._widget.showAt(Q,new ContentHoverVisibleData(J,V,U,this._editor.getOption(60).above,this._computer.shouldFocus,this._computer.source,te,C.initialMousePosX,C.initialMousePosY,Z))}else Z.dispose()}static computeHoverRanges(C,W,V){let U=1;if(C.hasModel()){const J=C._getViewModel(),ee=J.coordinatesConverter,te=ee.convertModelRangeToViewRange(W),ie=new Position$1(te.startLineNumber,J.getLineMinColumn(te.startLineNumber));U=ee.convertViewPositionToModelPosition(ie).column}const G=W.startLineNumber;let Z=W.startColumn,X=V[0].range,Q=null;for(const J of V)X=Range$2.plusRange(X,J.range),J.range.startLineNumber===G&&J.range.endLineNumber===G&&(Z=Math.max(Math.min(Z,J.range.startColumn),U)),J.forceShowAtRange&&(Q=J.range);return{showAtPosition:Q?Q.getStartPosition():new Position$1(G,W.startColumn),showAtSecondaryPosition:Q?Q.getStartPosition():new Position$1(G,Z),highlightRange:X}}focus(){this._widget.focus()}scrollUp(){this._widget.scrollUp()}scrollDown(){this._widget.scrollDown()}scrollLeft(){this._widget.scrollLeft()}scrollRight(){this._widget.scrollRight()}pageUp(){this._widget.pageUp()}pageDown(){this._widget.pageDown()}goToTop(){this._widget.goToTop()}goToBottom(){this._widget.goToBottom()}};ContentHoverController._DECORATION_OPTIONS=ModelDecorationOptions.register({description:"content-hover-highlight",className:"hoverHighlight"});ContentHoverController=ContentHoverController_1=__decorate$15([__param$15(1,IInstantiationService),__param$15(2,IKeybindingService)],ContentHoverController);class HoverResult{constructor(C,W,V){this.anchor=C,this.messages=W,this.isComplete=V}filter(C){const W=this.messages.filter(V=>V.isValidForHoverAnchor(C));return W.length===this.messages.length?this:new FilteredHoverResult(this,this.anchor,W,this.isComplete)}}class FilteredHoverResult extends HoverResult{constructor(C,W,V,U){super(W,V,U),this.original=C}filter(C){return this.original.filter(C)}}class ContentHoverVisibleData{constructor(C,W,V,U,G,Z,X,Q,J,ee){this.colorPicker=C,this.showAtPosition=W,this.showAtSecondaryPosition=V,this.preferAbove=U,this.stoleFocus=G,this.source=Z,this.isBeforeContent=X,this.initialMousePosX=Q,this.initialMousePosY=J,this.disposables=ee,this.closestMouseDistance=void 0}}const HORIZONTAL_SCROLLING_BY=30,SCROLLBAR_WIDTH=10,CONTAINER_HEIGHT_PADDING=6;let ContentHoverWidget=ContentHoverWidget_1=class extends ResizableContentWidget{get isColorPickerVisible(){var C;return!!(!((C=this._visibleData)===null||C===void 0)&&C.colorPicker)}get isVisibleFromKeyboard(){var C;return((C=this._visibleData)===null||C===void 0?void 0:C.source)===1}get isVisible(){var C;return(C=this._hoverVisibleKey.get())!==null&&C!==void 0?C:!1}get isFocused(){var C;return(C=this._hoverFocusedKey.get())!==null&&C!==void 0?C:!1}constructor(C,W,V,U,G){const Z=C.getOption(66)+8,X=150,Q=new Dimension(X,Z);super(C,Q),this._configurationService=V,this._accessibilityService=U,this._keybindingService=G,this._hover=this._register(new HoverWidget),this._minimumSize=Q,this._hoverVisibleKey=EditorContextKeys.hoverVisible.bindTo(W),this._hoverFocusedKey=EditorContextKeys.hoverFocused.bindTo(W),append$3(this._resizableNode.domNode,this._hover.containerDomNode),this._resizableNode.domNode.style.zIndex="50",this._register(this._editor.onDidLayoutChange(()=>this._layout())),this._register(this._editor.onDidChangeConfiguration(ee=>{ee.hasChanged(50)&&this._updateFont()}));const J=this._register(trackFocus(this._resizableNode.domNode));this._register(J.onDidFocus(()=>{this._hoverFocusedKey.set(!0)})),this._register(J.onDidBlur(()=>{this._hoverFocusedKey.set(!1)})),this._setHoverData(void 0),this._layout(),this._editor.addContentWidget(this)}dispose(){var C;super.dispose(),(C=this._visibleData)===null||C===void 0||C.disposables.dispose(),this._editor.removeContentWidget(this)}getId(){return ContentHoverWidget_1.ID}static _applyDimensions(C,W,V){const U=typeof W=="number"?`${W}px`:W,G=typeof V=="number"?`${V}px`:V;C.style.width=U,C.style.height=G}_setContentsDomNodeDimensions(C,W){const V=this._hover.contentsDomNode;return ContentHoverWidget_1._applyDimensions(V,C,W)}_setContainerDomNodeDimensions(C,W){const V=this._hover.containerDomNode;return ContentHoverWidget_1._applyDimensions(V,C,W)}_setHoverWidgetDimensions(C,W){this._setContentsDomNodeDimensions(C,W),this._setContainerDomNodeDimensions(C,W),this._layoutContentWidget()}static _applyMaxDimensions(C,W,V){const U=typeof W=="number"?`${W}px`:W,G=typeof V=="number"?`${V}px`:V;C.style.maxWidth=U,C.style.maxHeight=G}_setHoverWidgetMaxDimensions(C,W){ContentHoverWidget_1._applyMaxDimensions(this._hover.contentsDomNode,C,W),ContentHoverWidget_1._applyMaxDimensions(this._hover.containerDomNode,C,W),this._hover.containerDomNode.style.setProperty("--vscode-hover-maxWidth",typeof C=="number"?`${C}px`:C),this._layoutContentWidget()}_hasHorizontalScrollbar(){const C=this._hover.scrollbar.getScrollDimensions();return C.scrollWidth>C.width}_adjustContentsBottomPadding(){const C=this._hover.contentsDomNode,W=`${this._hover.scrollbar.options.horizontalScrollbarSize}px`;C.style.paddingBottom!==W&&(C.style.paddingBottom=W)}_setAdjustedHoverWidgetDimensions(C){this._setHoverWidgetMaxDimensions("none","none");const W=C.width,V=C.height;this._setHoverWidgetDimensions(W,V),this._hasHorizontalScrollbar()&&(this._adjustContentsBottomPadding(),this._setContentsDomNodeDimensions(W,V-SCROLLBAR_WIDTH))}_updateResizableNodeMaxDimensions(){var C,W;const V=(C=this._findMaximumRenderingWidth())!==null&&C!==void 0?C:1/0,U=(W=this._findMaximumRenderingHeight())!==null&&W!==void 0?W:1/0;this._resizableNode.maxSize=new Dimension(V,U),this._setHoverWidgetMaxDimensions(V,U)}_resize(C){var W,V;ContentHoverWidget_1._lastDimensions=new Dimension(C.width,C.height),this._setAdjustedHoverWidgetDimensions(C),this._resizableNode.layout(C.height,C.width),this._updateResizableNodeMaxDimensions(),this._hover.scrollbar.scanDomNode(),this._editor.layoutContentWidget(this),(V=(W=this._visibleData)===null||W===void 0?void 0:W.colorPicker)===null||V===void 0||V.layout()}_findAvailableSpaceVertically(){var C;const W=(C=this._visibleData)===null||C===void 0?void 0:C.showAtPosition;if(W)return this._positionPreference===1?this._availableVerticalSpaceAbove(W):this._availableVerticalSpaceBelow(W)}_findMaximumRenderingHeight(){const C=this._findAvailableSpaceVertically();if(!C)return;let W=CONTAINER_HEIGHT_PADDING;return Array.from(this._hover.contentsDomNode.children).forEach(V=>{W+=V.clientHeight}),this._hasHorizontalScrollbar()&&(W+=SCROLLBAR_WIDTH),Math.min(C,W)}_isHoverTextOverflowing(){this._hover.containerDomNode.style.setProperty("--vscode-hover-whiteSpace","nowrap"),this._hover.containerDomNode.style.setProperty("--vscode-hover-sourceWhiteSpace","nowrap");const C=Array.from(this._hover.contentsDomNode.children).some(W=>W.scrollWidth>W.clientWidth);return this._hover.containerDomNode.style.removeProperty("--vscode-hover-whiteSpace"),this._hover.containerDomNode.style.removeProperty("--vscode-hover-sourceWhiteSpace"),C}_findMaximumRenderingWidth(){if(!this._editor||!this._editor.hasModel())return;const C=this._isHoverTextOverflowing(),W=typeof this._contentWidth>"u"?0:this._contentWidth-2;return C||this._hover.containerDomNode.clientWidth<W?getClientArea(this._hover.containerDomNode.ownerDocument.body).width-14:this._hover.containerDomNode.clientWidth+2}isMouseGettingCloser(C,W){if(!this._visibleData)return!1;if(typeof this._visibleData.initialMousePosX>"u"||typeof this._visibleData.initialMousePosY>"u")return this._visibleData.initialMousePosX=C,this._visibleData.initialMousePosY=W,!1;const V=getDomNodePagePosition(this.getDomNode());typeof this._visibleData.closestMouseDistance>"u"&&(this._visibleData.closestMouseDistance=computeDistanceFromPointToRectangle(this._visibleData.initialMousePosX,this._visibleData.initialMousePosY,V.left,V.top,V.width,V.height));const U=computeDistanceFromPointToRectangle(C,W,V.left,V.top,V.width,V.height);return U>this._visibleData.closestMouseDistance+4?!1:(this._visibleData.closestMouseDistance=Math.min(this._visibleData.closestMouseDistance,U),!0)}_setHoverData(C){var W;(W=this._visibleData)===null||W===void 0||W.disposables.dispose(),this._visibleData=C,this._hoverVisibleKey.set(!!C),this._hover.containerDomNode.classList.toggle("hidden",!C)}_layout(){const{fontSize:C,lineHeight:W}=this._editor.getOption(50),V=this._hover.contentsDomNode;V.style.fontSize=`${C}px`,V.style.lineHeight=`${W/C}`,this._updateMaxDimensions()}_updateFont(){Array.prototype.slice.call(this._hover.contentsDomNode.getElementsByClassName("code")).forEach(W=>this._editor.applyFontInfo(W))}_updateContent(C){const W=this._hover.contentsDomNode;W.style.paddingBottom="",W.textContent="",W.appendChild(C)}_layoutContentWidget(){this._editor.layoutContentWidget(this),this._hover.onContentsChanged()}_updateMaxDimensions(){const C=Math.max(this._editor.getLayoutInfo().height/4,250,ContentHoverWidget_1._lastDimensions.height),W=Math.max(this._editor.getLayoutInfo().width*.66,500,ContentHoverWidget_1._lastDimensions.width);this._setHoverWidgetMaxDimensions(W,C)}_render(C,W){this._setHoverData(W),this._updateFont(),this._updateContent(C),this._updateMaxDimensions(),this.onContentsChanged(),this._editor.render()}getPosition(){var C;return this._visibleData?{position:this._visibleData.showAtPosition,secondaryPosition:this._visibleData.showAtSecondaryPosition,positionAffinity:this._visibleData.isBeforeContent?3:void 0,preference:[(C=this._positionPreference)!==null&&C!==void 0?C:1]}:null}showAt(C,W){var V,U,G,Z;if(!this._editor||!this._editor.hasModel())return;this._render(C,W);const X=getTotalHeight(this._hover.containerDomNode),Q=W.showAtPosition;this._positionPreference=(V=this._findPositionPreference(X,Q))!==null&&V!==void 0?V:1,this.onContentsChanged(),W.stoleFocus&&this._hover.containerDomNode.focus(),(U=W.colorPicker)===null||U===void 0||U.layout();const J=getHoverAccessibleViewHint(this._configurationService.getValue("accessibility.verbosity.hover")===!0&&this._accessibilityService.isScreenReaderOptimized(),(Z=(G=this._keybindingService.lookupKeybinding("editor.action.accessibleView"))===null||G===void 0?void 0:G.getAriaLabel())!==null&&Z!==void 0?Z:"");J&&(this._hover.contentsDomNode.ariaLabel=this._hover.contentsDomNode.textContent+", "+J)}hide(){if(!this._visibleData)return;const C=this._visibleData.stoleFocus||this._hoverFocusedKey.get();this._setHoverData(void 0),this._resizableNode.maxSize=new Dimension(1/0,1/0),this._resizableNode.clearSashHoverState(),this._hoverFocusedKey.set(!1),this._editor.layoutContentWidget(this),C&&this._editor.focus()}_removeConstraintsRenderNormally(){const C=this._editor.getLayoutInfo();this._resizableNode.layout(C.height,C.width),this._setHoverWidgetDimensions("auto","auto")}_adjustHoverHeightForScrollbar(C){var W;const V=this._hover.containerDomNode,U=this._hover.contentsDomNode,G=(W=this._findMaximumRenderingHeight())!==null&&W!==void 0?W:1/0;this._setContainerDomNodeDimensions(getTotalWidth(V),Math.min(G,C)),this._setContentsDomNodeDimensions(getTotalWidth(U),Math.min(G,C-SCROLLBAR_WIDTH))}setMinimumDimensions(C){this._minimumSize=new Dimension(Math.max(this._minimumSize.width,C.width),Math.max(this._minimumSize.height,C.height)),this._updateMinimumWidth()}_updateMinimumWidth(){const C=typeof this._contentWidth>"u"?this._minimumSize.width:Math.min(this._contentWidth,this._minimumSize.width);this._resizableNode.minSize=new Dimension(C,this._minimumSize.height)}onContentsChanged(){var C;this._removeConstraintsRenderNormally();const W=this._hover.containerDomNode;let V=getTotalHeight(W),U=getTotalWidth(W);if(this._resizableNode.layout(V,U),this._setHoverWidgetDimensions(U,V),V=getTotalHeight(W),U=getTotalWidth(W),this._contentWidth=U,this._updateMinimumWidth(),this._resizableNode.layout(V,U),this._hasHorizontalScrollbar()&&(this._adjustContentsBottomPadding(),this._adjustHoverHeightForScrollbar(V)),!((C=this._visibleData)===null||C===void 0)&&C.showAtPosition){const G=getTotalHeight(this._hover.containerDomNode);this._positionPreference=this._findPositionPreference(G,this._visibleData.showAtPosition)}this._layoutContentWidget()}focus(){this._hover.containerDomNode.focus()}scrollUp(){const C=this._hover.scrollbar.getScrollPosition().scrollTop,W=this._editor.getOption(50);this._hover.scrollbar.setScrollPosition({scrollTop:C-W.lineHeight})}scrollDown(){const C=this._hover.scrollbar.getScrollPosition().scrollTop,W=this._editor.getOption(50);this._hover.scrollbar.setScrollPosition({scrollTop:C+W.lineHeight})}scrollLeft(){const C=this._hover.scrollbar.getScrollPosition().scrollLeft;this._hover.scrollbar.setScrollPosition({scrollLeft:C-HORIZONTAL_SCROLLING_BY})}scrollRight(){const C=this._hover.scrollbar.getScrollPosition().scrollLeft;this._hover.scrollbar.setScrollPosition({scrollLeft:C+HORIZONTAL_SCROLLING_BY})}pageUp(){const C=this._hover.scrollbar.getScrollPosition().scrollTop,W=this._hover.scrollbar.getScrollDimensions().height;this._hover.scrollbar.setScrollPosition({scrollTop:C-W})}pageDown(){const C=this._hover.scrollbar.getScrollPosition().scrollTop,W=this._hover.scrollbar.getScrollDimensions().height;this._hover.scrollbar.setScrollPosition({scrollTop:C+W})}goToTop(){this._hover.scrollbar.setScrollPosition({scrollTop:0})}goToBottom(){this._hover.scrollbar.setScrollPosition({scrollTop:this._hover.scrollbar.getScrollDimensions().scrollHeight})}};ContentHoverWidget.ID="editor.contrib.resizableContentHoverWidget";ContentHoverWidget._lastDimensions=new Dimension(0,0);ContentHoverWidget=ContentHoverWidget_1=__decorate$15([__param$15(1,IContextKeyService),__param$15(2,IConfigurationService),__param$15(3,IAccessibilityService),__param$15(4,IKeybindingService)],ContentHoverWidget);let EditorHoverStatusBar=class extends Disposable{get hasContent(){return this._hasContent}constructor(C){super(),this._keybindingService=C,this._hasContent=!1,this.hoverElement=$$4("div.hover-row.status-bar"),this.actionsElement=append$3(this.hoverElement,$$4("div.actions"))}addAction(C){const W=this._keybindingService.lookupKeybinding(C.commandId),V=W?W.getLabel():null;return this._hasContent=!0,this._register(HoverAction.render(this.actionsElement,C,V))}append(C){const W=append$3(this.actionsElement,C);return this._hasContent=!0,W}};EditorHoverStatusBar=__decorate$15([__param$15(0,IKeybindingService)],EditorHoverStatusBar);class ContentHoverComputer{get anchor(){return this._anchor}set anchor(C){this._anchor=C}get shouldFocus(){return this._shouldFocus}set shouldFocus(C){this._shouldFocus=C}get source(){return this._source}set source(C){this._source=C}get insistOnKeepingHoverVisible(){return this._insistOnKeepingHoverVisible}set insistOnKeepingHoverVisible(C){this._insistOnKeepingHoverVisible=C}constructor(C,W){this._editor=C,this._participants=W,this._anchor=null,this._shouldFocus=!1,this._source=0,this._insistOnKeepingHoverVisible=!1}static _getLineDecorations(C,W){if(W.type!==1&&!W.supportsMarkerHover)return[];const V=C.getModel(),U=W.range.startLineNumber;if(U>V.getLineCount())return[];const G=V.getLineMaxColumn(U);return C.getLineDecorations(U).filter(Z=>{if(Z.options.isWholeLine)return!0;const X=Z.range.startLineNumber===U?Z.range.startColumn:1,Q=Z.range.endLineNumber===U?Z.range.endColumn:G;if(Z.options.showIfCollapsed){if(X>W.range.startColumn+1||W.range.endColumn-1>Q)return!1}else if(X>W.range.startColumn||W.range.endColumn>Q)return!1;return!0})}computeAsync(C){const W=this._anchor;if(!this._editor.hasModel()||!W)return AsyncIterableObject.EMPTY;const V=ContentHoverComputer._getLineDecorations(this._editor,W);return AsyncIterableObject.merge(this._participants.map(U=>U.computeAsync?U.computeAsync(W,V,C):AsyncIterableObject.EMPTY))}computeSync(){if(!this._editor.hasModel()||!this._anchor)return[];const C=ContentHoverComputer._getLineDecorations(this._editor,this._anchor);let W=[];for(const V of this._participants)W=W.concat(V.computeSync(this._anchor,C));return coalesce(W)}}function computeDistanceFromPointToRectangle(K,C,W,V,U,G){const Z=W+U/2,X=V+G/2,Q=Math.max(Math.abs(K-Z)-U/2,0),J=Math.max(Math.abs(C-X)-G/2,0);return Math.sqrt(Q*Q+J*J)}const $$3=$$d;class MarginHoverWidget extends Disposable{constructor(C,W,V){super(),this._renderDisposeables=this._register(new DisposableStore),this._editor=C,this._isVisible=!1,this._messages=[],this._hover=this._register(new HoverWidget),this._hover.containerDomNode.classList.toggle("hidden",!this._isVisible),this._markdownRenderer=this._register(new MarkdownRenderer({editor:this._editor},W,V)),this._computer=new MarginHoverComputer(this._editor),this._hoverOperation=this._register(new HoverOperation(this._editor,this._computer)),this._register(this._hoverOperation.onResult(U=>{this._withResult(U.value)})),this._register(this._editor.onDidChangeModelDecorations(()=>this._onModelDecorationsChanged())),this._register(this._editor.onDidChangeConfiguration(U=>{U.hasChanged(50)&&this._updateFont()})),this._editor.addOverlayWidget(this)}dispose(){this._editor.removeOverlayWidget(this),super.dispose()}getId(){return MarginHoverWidget.ID}getDomNode(){return this._hover.containerDomNode}getPosition(){return null}_updateFont(){Array.prototype.slice.call(this._hover.contentsDomNode.getElementsByClassName("code")).forEach(W=>this._editor.applyFontInfo(W))}_onModelDecorationsChanged(){this._isVisible&&(this._hoverOperation.cancel(),this._hoverOperation.start(0))}startShowingAt(C){this._computer.lineNumber!==C&&(this._hoverOperation.cancel(),this.hide(),this._computer.lineNumber=C,this._hoverOperation.start(0))}hide(){this._computer.lineNumber=-1,this._hoverOperation.cancel(),this._isVisible&&(this._isVisible=!1,this._hover.containerDomNode.classList.toggle("hidden",!this._isVisible))}_withResult(C){this._messages=C,this._messages.length>0?this._renderMessages(this._computer.lineNumber,this._messages):this.hide()}_renderMessages(C,W){this._renderDisposeables.clear();const V=document.createDocumentFragment();for(const U of W){const G=$$3("div.hover-row.markdown-hover"),Z=append$3(G,$$3("div.hover-contents")),X=this._renderDisposeables.add(this._markdownRenderer.render(U.value));Z.appendChild(X.element),V.appendChild(G)}this._updateContents(V),this._showAt(C)}_updateContents(C){this._hover.contentsDomNode.textContent="",this._hover.contentsDomNode.appendChild(C),this._updateFont()}_showAt(C){this._isVisible||(this._isVisible=!0,this._hover.containerDomNode.classList.toggle("hidden",!this._isVisible));const W=this._editor.getLayoutInfo(),V=this._editor.getTopForLineNumber(C),U=this._editor.getScrollTop(),G=this._editor.getOption(66),Z=this._hover.containerDomNode.clientHeight,X=V-U-(Z-G)/2;this._hover.containerDomNode.style.left=`${W.glyphMarginLeft+W.glyphMarginWidth}px`,this._hover.containerDomNode.style.top=`${Math.max(Math.round(X),0)}px`}}MarginHoverWidget.ID="editor.contrib.modesGlyphHoverWidget";class MarginHoverComputer{get lineNumber(){return this._lineNumber}set lineNumber(C){this._lineNumber=C}constructor(C){this._editor=C,this._lineNumber=-1}computeSync(){const C=U=>({value:U}),W=this._editor.getLineDecorations(this._lineNumber),V=[];if(!W)return V;for(const U of W){if(!U.options.glyphMarginClassName)continue;const G=U.options.glyphMarginHoverMessage;!G||isEmptyMarkdownString(G)||V.push(...asArray(G).map(C))}return V}}var __awaiter$N=globalThis&&globalThis.__awaiter||function(K,C,W,V){function U(G){return G instanceof W?G:new W(function(Z){Z(G)})}return new(W||(W=Promise))(function(G,Z){function X(ee){try{J(V.next(ee))}catch(te){Z(te)}}function Q(ee){try{J(V.throw(ee))}catch(te){Z(te)}}function J(ee){ee.done?G(ee.value):U(ee.value).then(X,Q)}J((V=V.apply(K,C||[])).next())})};class HoverProviderResult{constructor(C,W,V){this.provider=C,this.hover=W,this.ordinal=V}}function executeProvider(K,C,W,V,U){return __awaiter$N(this,void 0,void 0,function*(){try{const G=yield Promise.resolve(K.provideHover(W,V,U));if(G&&isValid(G))return new HoverProviderResult(K,G,C)}catch(G){onUnexpectedExternalError(G)}})}function getHover(K,C,W,V){const G=K.ordered(C).map((Z,X)=>executeProvider(Z,X,C,W,V));return AsyncIterableObject.fromPromises(G).coalesce()}function getHoverPromise(K,C,W,V){return getHover(K,C,W,V).map(U=>U.hover).toPromise()}registerModelAndPositionCommand("_executeHoverProvider",(K,C,W)=>{const V=K.get(ILanguageFeaturesService);return getHoverPromise(V.hoverProvider,C,W,CancellationToken.None)});function isValid(K){const C=typeof K.range<"u",W=typeof K.contents<"u"&&K.contents&&K.contents.length>0;return C&&W}var __decorate$14=globalThis&&globalThis.__decorate||function(K,C,W,V){var U=arguments.length,G=U<3?C:V===null?V=Object.getOwnPropertyDescriptor(C,W):V,Z;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")G=Reflect.decorate(K,C,W,V);else for(var X=K.length-1;X>=0;X--)(Z=K[X])&&(G=(U<3?Z(G):U>3?Z(C,W,G):Z(C,W))||G);return U>3&&G&&Object.defineProperty(C,W,G),G},__param$14=globalThis&&globalThis.__param||function(K,C){return function(W,V){C(W,V,K)}};const $$2=$$d;class MarkdownHover{constructor(C,W,V,U,G){this.owner=C,this.range=W,this.contents=V,this.isBeforeContent=U,this.ordinal=G}isValidForHoverAnchor(C){return C.type===1&&this.range.startColumn<=C.range.startColumn&&this.range.endColumn>=C.range.endColumn}}let MarkdownHoverParticipant=class{constructor(C,W,V,U,G){this._editor=C,this._languageService=W,this._openerService=V,this._configurationService=U,this._languageFeaturesService=G,this.hoverOrdinal=3}createLoadingMessage(C){return new MarkdownHover(this,C.range,[new MarkdownString().appendText(localize("modesContentHover.loading","Loading..."))],!1,2e3)}computeSync(C,W){if(!this._editor.hasModel()||C.type!==1)return[];const V=this._editor.getModel(),U=C.range.startLineNumber,G=V.getLineMaxColumn(U),Z=[];let X=1e3;const Q=V.getLineLength(U),J=V.getLanguageIdAtPosition(C.range.startLineNumber,C.range.startColumn),ee=this._editor.getOption(116),te=this._configurationService.getValue("editor.maxTokenizationLineLength",{overrideIdentifier:J});let ie=!1;ee>=0&&Q>ee&&C.range.startColumn>=ee&&(ie=!0,Z.push(new MarkdownHover(this,C.range,[{value:localize("stopped rendering","Rendering paused for long line for performance reasons. This can be configured via `editor.stopRenderingLineAfter`.")}],!1,X++))),!ie&&typeof te=="number"&&Q>=te&&Z.push(new MarkdownHover(this,C.range,[{value:localize("too many characters","Tokenization is skipped for long lines for performance reasons. This can be configured via `editor.maxTokenizationLineLength`.")}],!1,X++));let ne=!1;for(const oe of W){const re=oe.range.startLineNumber===U?oe.range.startColumn:1,ae=oe.range.endLineNumber===U?oe.range.endColumn:G,se=oe.options.hoverMessage;if(!se||isEmptyMarkdownString(se))continue;oe.options.beforeContentClassName&&(ne=!0);const le=new Range$2(C.range.startLineNumber,re,C.range.startLineNumber,ae);Z.push(new MarkdownHover(this,le,asArray(se),ne,X++))}return Z}computeAsync(C,W,V){if(!this._editor.hasModel()||C.type!==1)return AsyncIterableObject.EMPTY;const U=this._editor.getModel();if(!this._languageFeaturesService.hoverProvider.has(U))return AsyncIterableObject.EMPTY;const G=new Position$1(C.range.startLineNumber,C.range.startColumn);return getHover(this._languageFeaturesService.hoverProvider,U,G,V).filter(Z=>!isEmptyMarkdownString(Z.hover.contents)).map(Z=>{const X=Z.hover.range?Range$2.lift(Z.hover.range):C.range;return new MarkdownHover(this,X,Z.hover.contents,!1,Z.ordinal)})}renderHoverParts(C,W){return renderMarkdownHovers(C,W,this._editor,this._languageService,this._openerService)}};MarkdownHoverParticipant=__decorate$14([__param$14(1,ILanguageService),__param$14(2,IOpenerService),__param$14(3,IConfigurationService),__param$14(4,ILanguageFeaturesService)],MarkdownHoverParticipant);function renderMarkdownHovers(K,C,W,V,U){C.sort((Z,X)=>Z.ordinal-X.ordinal);const G=new DisposableStore;for(const Z of C)for(const X of Z.contents){if(isEmptyMarkdownString(X))continue;const Q=$$2("div.hover-row.markdown-hover"),J=append$3(Q,$$2("div.hover-contents")),ee=G.add(new MarkdownRenderer({editor:W},V,U));G.add(ee.onDidRenderAsync(()=>{J.className="hover-contents code-hover-contents",K.onContentsChanged()}));const te=G.add(ee.render(X));J.appendChild(te.element),K.fragment.appendChild(Q)}return G}var __decorate$13=globalThis&&globalThis.__decorate||function(K,C,W,V){var U=arguments.length,G=U<3?C:V===null?V=Object.getOwnPropertyDescriptor(C,W):V,Z;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")G=Reflect.decorate(K,C,W,V);else for(var X=K.length-1;X>=0;X--)(Z=K[X])&&(G=(U<3?Z(G):U>3?Z(C,W,G):Z(C,W))||G);return U>3&&G&&Object.defineProperty(C,W,G),G},__param$13=globalThis&&globalThis.__param||function(K,C){return function(W,V){C(W,V,K)}};class MarkerCoordinate{constructor(C,W,V){this.marker=C,this.index=W,this.total=V}}let MarkerList=class{constructor(C,W,V){this._markerService=W,this._configService=V,this._onDidChange=new Emitter$1,this.onDidChange=this._onDidChange.event,this._dispoables=new DisposableStore,this._markers=[],this._nextIdx=-1,URI.isUri(C)?this._resourceFilter=X=>X.toString()===C.toString():C&&(this._resourceFilter=C);const U=this._configService.getValue("problems.sortOrder"),G=(X,Q)=>{let J=compare$1(X.resource.toString(),Q.resource.toString());return J===0&&(U==="position"?J=Range$2.compareRangesUsingStarts(X,Q)||MarkerSeverity$1.compare(X.severity,Q.severity):J=MarkerSeverity$1.compare(X.severity,Q.severity)||Range$2.compareRangesUsingStarts(X,Q)),J},Z=()=>{this._markers=this._markerService.read({resource:URI.isUri(C)?C:void 0,severities:MarkerSeverity$1.Error|MarkerSeverity$1.Warning|MarkerSeverity$1.Info}),typeof C=="function"&&(this._markers=this._markers.filter(X=>this._resourceFilter(X.resource))),this._markers.sort(G)};Z(),this._dispoables.add(W.onMarkerChanged(X=>{(!this._resourceFilter||X.some(Q=>this._resourceFilter(Q)))&&(Z(),this._nextIdx=-1,this._onDidChange.fire())}))}dispose(){this._dispoables.dispose(),this._onDidChange.dispose()}matches(C){return!this._resourceFilter&&!C?!0:!this._resourceFilter||!C?!1:this._resourceFilter(C)}get selected(){const C=this._markers[this._nextIdx];return C&&new MarkerCoordinate(C,this._nextIdx+1,this._markers.length)}_initIdx(C,W,V){let U=!1,G=this._markers.findIndex(Z=>Z.resource.toString()===C.uri.toString());G<0&&(G=binarySearch(this._markers,{resource:C.uri},(Z,X)=>compare$1(Z.resource.toString(),X.resource.toString())),G<0&&(G=~G));for(let Z=G;Z<this._markers.length;Z++){let X=Range$2.lift(this._markers[Z]);if(X.isEmpty()){const Q=C.getWordAtPosition(X.getStartPosition());Q&&(X=new Range$2(X.startLineNumber,Q.startColumn,X.startLineNumber,Q.endColumn))}if(W&&(X.containsPosition(W)||W.isBeforeOrEqual(X.getStartPosition()))){this._nextIdx=Z,U=!0;break}if(this._markers[Z].resource.toString()!==C.uri.toString())break}U||(this._nextIdx=V?0:this._markers.length-1),this._nextIdx<0&&(this._nextIdx=this._markers.length-1)}resetIndex(){this._nextIdx=-1}move(C,W,V){if(this._markers.length===0)return!1;const U=this._nextIdx;return this._nextIdx===-1?this._initIdx(W,V,C):C?this._nextIdx=(this._nextIdx+1)%this._markers.length:C||(this._nextIdx=(this._nextIdx-1+this._markers.length)%this._markers.length),U!==this._nextIdx}find(C,W){let V=this._markers.findIndex(U=>U.resource.toString()===C.toString());if(!(V<0)){for(;V<this._markers.length;V++)if(Range$2.containsPosition(this._markers[V],W))return new MarkerCoordinate(this._markers[V],V+1,this._markers.length)}}};MarkerList=__decorate$13([__param$13(1,IMarkerService),__param$13(2,IConfigurationService)],MarkerList);const IMarkerNavigationService=createDecorator("IMarkerNavigationService");let MarkerNavigationService=class{constructor(C,W){this._markerService=C,this._configService=W,this._provider=new LinkedList}getMarkerList(C){for(const W of this._provider){const V=W.getMarkerList(C);if(V)return V}return new MarkerList(C,this._markerService,this._configService)}};MarkerNavigationService=__decorate$13([__param$13(0,IMarkerService),__param$13(1,IConfigurationService)],MarkerNavigationService);registerSingleton(IMarkerNavigationService,MarkerNavigationService,1);const gotoErrorWidget="",severityIcon="";var SeverityIcon;(function(K){function C(W){switch(W){case Severity$2.Ignore:return"severity-ignore "+ThemeIcon.asClassName(Codicon.info);case Severity$2.Info:return ThemeIcon.asClassName(Codicon.info);case Severity$2.Warning:return ThemeIcon.asClassName(Codicon.warning);case Severity$2.Error:return ThemeIcon.asClassName(Codicon.error);default:return""}}K.className=C})(SeverityIcon||(SeverityIcon={}));var __decorate$12=globalThis&&globalThis.__decorate||function(K,C,W,V){var U=arguments.length,G=U<3?C:V===null?V=Object.getOwnPropertyDescriptor(C,W):V,Z;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")G=Reflect.decorate(K,C,W,V);else for(var X=K.length-1;X>=0;X--)(Z=K[X])&&(G=(U<3?Z(G):U>3?Z(C,W,G):Z(C,W))||G);return U>3&&G&&Object.defineProperty(C,W,G),G},__param$12=globalThis&&globalThis.__param||function(K,C){return function(W,V){C(W,V,K)}},MarkerNavigationWidget_1;class MessageWidget{constructor(C,W,V,U,G){this._openerService=U,this._labelService=G,this._lines=0,this._longestLineLength=0,this._relatedDiagnostics=new WeakMap,this._disposables=new DisposableStore,this._editor=W;const Z=document.createElement("div");Z.className="descriptioncontainer",this._messageBlock=document.createElement("div"),this._messageBlock.classList.add("message"),this._messageBlock.setAttribute("aria-live","assertive"),this._messageBlock.setAttribute("role","alert"),Z.appendChild(this._messageBlock),this._relatedBlock=document.createElement("div"),Z.appendChild(this._relatedBlock),this._disposables.add(addStandardDisposableListener(this._relatedBlock,"click",X=>{X.preventDefault();const Q=this._relatedDiagnostics.get(X.target);Q&&V(Q)})),this._scrollable=new ScrollableElement(Z,{horizontal:1,vertical:1,useShadows:!1,horizontalScrollbarSize:6,verticalScrollbarSize:6}),C.appendChild(this._scrollable.getDomNode()),this._disposables.add(this._scrollable.onScroll(X=>{Z.style.left=`-${X.scrollLeft}px`,Z.style.top=`-${X.scrollTop}px`})),this._disposables.add(this._scrollable)}dispose(){dispose(this._disposables)}update(C){const{source:W,message:V,relatedInformation:U,code:G}=C;let Z=((W==null?void 0:W.length)||0)+2;G&&(typeof G=="string"?Z+=G.length:Z+=G.value.length);const X=splitLines(V);this._lines=X.length,this._longestLineLength=0;for(const ie of X)this._longestLineLength=Math.max(ie.length+Z,this._longestLineLength);clearNode(this._messageBlock),this._messageBlock.setAttribute("aria-label",this.getAriaLabel(C)),this._editor.applyFontInfo(this._messageBlock);let Q=this._messageBlock;for(const ie of X)Q=document.createElement("div"),Q.innerText=ie,ie===""&&(Q.style.height=this._messageBlock.style.lineHeight),this._messageBlock.appendChild(Q);if(W||G){const ie=document.createElement("span");if(ie.classList.add("details"),Q.appendChild(ie),W){const ne=document.createElement("span");ne.innerText=W,ne.classList.add("source"),ie.appendChild(ne)}if(G)if(typeof G=="string"){const ne=document.createElement("span");ne.innerText=`(${G})`,ne.classList.add("code"),ie.appendChild(ne)}else{this._codeLink=$$d("a.code-link"),this._codeLink.setAttribute("href",`${G.target.toString()}`),this._codeLink.onclick=oe=>{this._openerService.open(G.target,{allowCommands:!0}),oe.preventDefault(),oe.stopPropagation()};const ne=append$3(this._codeLink,$$d("span"));ne.innerText=G.value,ie.appendChild(this._codeLink)}}if(clearNode(this._relatedBlock),this._editor.applyFontInfo(this._relatedBlock),isNonEmptyArray$2(U)){const ie=this._relatedBlock.appendChild(document.createElement("div"));ie.style.paddingTop=`${Math.floor(this._editor.getOption(66)*.66)}px`,this._lines+=1;for(const ne of U){const oe=document.createElement("div"),re=document.createElement("a");re.classList.add("filename"),re.innerText=`${this._labelService.getUriBasenameLabel(ne.resource)}(${ne.startLineNumber}, ${ne.startColumn}): `,re.title=this._labelService.getUriLabel(ne.resource),this._relatedDiagnostics.set(re,ne);const ae=document.createElement("span");ae.innerText=ne.message,oe.appendChild(re),oe.appendChild(ae),this._lines+=1,ie.appendChild(oe)}}const J=this._editor.getOption(50),ee=Math.ceil(J.typicalFullwidthCharacterWidth*this._longestLineLength*.75),te=J.lineHeight*this._lines;this._scrollable.setScrollDimensions({scrollWidth:ee,scrollHeight:te})}layout(C,W){this._scrollable.getDomNode().style.height=`${C}px`,this._scrollable.getDomNode().style.width=`${W}px`,this._scrollable.setScrollDimensions({width:W,height:C})}getHeightInLines(){return Math.min(17,this._lines)}getAriaLabel(C){let W="";switch(C.severity){case MarkerSeverity$1.Error:W=localize("Error","Error");break;case MarkerSeverity$1.Warning:W=localize("Warning","Warning");break;case MarkerSeverity$1.Info:W=localize("Info","Info");break;case MarkerSeverity$1.Hint:W=localize("Hint","Hint");break}let V=localize("marker aria","{0} at {1}. ",W,C.startLineNumber+":"+C.startColumn);const U=this._editor.getModel();return U&&C.startLineNumber<=U.getLineCount()&&C.startLineNumber>=1&&(V=`${U.getLineContent(C.startLineNumber)}, ${V}`),V}}let MarkerNavigationWidget=MarkerNavigationWidget_1=class extends PeekViewWidget{constructor(C,W,V,U,G,Z,X){super(C,{showArrow:!0,showFrame:!0,isAccessible:!0,frameWidth:1},G),this._themeService=W,this._openerService=V,this._menuService=U,this._contextKeyService=Z,this._labelService=X,this._callOnDispose=new DisposableStore,this._onDidSelectRelatedInformation=new Emitter$1,this.onDidSelectRelatedInformation=this._onDidSelectRelatedInformation.event,this._severity=MarkerSeverity$1.Warning,this._backgroundColor=Color.white,this._applyTheme(W.getColorTheme()),this._callOnDispose.add(W.onDidColorThemeChange(this._applyTheme.bind(this))),this.create()}_applyTheme(C){this._backgroundColor=C.getColor(editorMarkerNavigationBackground);let W=editorMarkerNavigationError,V=editorMarkerNavigationErrorHeader;this._severity===MarkerSeverity$1.Warning?(W=editorMarkerNavigationWarning,V=editorMarkerNavigationWarningHeader):this._severity===MarkerSeverity$1.Info&&(W=editorMarkerNavigationInfo,V=editorMarkerNavigationInfoHeader);const U=C.getColor(W),G=C.getColor(V);this.style({arrowColor:U,frameColor:U,headerBackgroundColor:G,primaryHeadingColor:C.getColor(peekViewTitleForeground),secondaryHeadingColor:C.getColor(peekViewTitleInfoForeground)})}_applyStyles(){this._parentContainer&&(this._parentContainer.style.backgroundColor=this._backgroundColor?this._backgroundColor.toString():""),super._applyStyles()}dispose(){this._callOnDispose.dispose(),super.dispose()}_fillHead(C){super._fillHead(C),this._disposables.add(this._actionbarWidget.actionRunner.onWillRun(U=>this.editor.focus()));const W=[],V=this._menuService.createMenu(MarkerNavigationWidget_1.TitleMenu,this._contextKeyService);createAndFillInActionBarActions(V,void 0,W),this._actionbarWidget.push(W,{label:!1,icon:!0,index:0}),V.dispose()}_fillTitleIcon(C){this._icon=append$3(C,$$d(""))}_fillBody(C){this._parentContainer=C,C.classList.add("marker-widget"),this._parentContainer.tabIndex=0,this._parentContainer.setAttribute("role","tooltip"),this._container=document.createElement("div"),C.appendChild(this._container),this._message=new MessageWidget(this._container,this.editor,W=>this._onDidSelectRelatedInformation.fire(W),this._openerService,this._labelService),this._disposables.add(this._message)}show(){throw new Error("call showAtMarker")}showAtMarker(C,W,V){this._container.classList.remove("stale"),this._message.update(C),this._severity=C.severity,this._applyTheme(this._themeService.getColorTheme());const U=Range$2.lift(C),G=this.editor.getPosition(),Z=G&&U.containsPosition(G)?G:U.getStartPosition();super.show(Z,this.computeRequiredHeight());const X=this.editor.getModel();if(X){const Q=V>1?localize("problems","{0} of {1} problems",W,V):localize("change","{0} of {1} problem",W,V);this.setTitle(basename(X.uri),Q)}this._icon.className=`codicon ${SeverityIcon.className(MarkerSeverity$1.toSeverity(this._severity))}`,this.editor.revealPositionNearTop(Z,0),this.editor.focus()}updateMarker(C){this._container.classList.remove("stale"),this._message.update(C)}showStale(){this._container.classList.add("stale"),this._relayout()}_doLayoutBody(C,W){super._doLayoutBody(C,W),this._heightInPixel=C,this._message.layout(C,W),this._container.style.height=`${C}px`}_onWidth(C){this._message.layout(this._heightInPixel,C)}_relayout(){super._relayout(this.computeRequiredHeight())}computeRequiredHeight(){return 3+this._message.getHeightInLines()}};MarkerNavigationWidget.TitleMenu=new MenuId("gotoErrorTitleMenu");MarkerNavigationWidget=MarkerNavigationWidget_1=__decorate$12([__param$12(1,IThemeService),__param$12(2,IOpenerService),__param$12(3,IMenuService),__param$12(4,IInstantiationService),__param$12(5,IContextKeyService),__param$12(6,ILabelService)],MarkerNavigationWidget);const errorDefault=oneOf$1(editorErrorForeground,editorErrorBorder),warningDefault=oneOf$1(editorWarningForeground,editorWarningBorder),infoDefault=oneOf$1(editorInfoForeground,editorInfoBorder),editorMarkerNavigationError=registerColor("editorMarkerNavigationError.background",{dark:errorDefault,light:errorDefault,hcDark:contrastBorder,hcLight:contrastBorder},localize("editorMarkerNavigationError","Editor marker navigation widget error color.")),editorMarkerNavigationErrorHeader=registerColor("editorMarkerNavigationError.headerBackground",{dark:transparent(editorMarkerNavigationError,.1),light:transparent(editorMarkerNavigationError,.1),hcDark:null,hcLight:null},localize("editorMarkerNavigationErrorHeaderBackground","Editor marker navigation widget error heading background.")),editorMarkerNavigationWarning=registerColor("editorMarkerNavigationWarning.background",{dark:warningDefault,light:warningDefault,hcDark:contrastBorder,hcLight:contrastBorder},localize("editorMarkerNavigationWarning","Editor marker navigation widget warning color.")),editorMarkerNavigationWarningHeader=registerColor("editorMarkerNavigationWarning.headerBackground",{dark:transparent(editorMarkerNavigationWarning,.1),light:transparent(editorMarkerNavigationWarning,.1),hcDark:"#0C141F",hcLight:transparent(editorMarkerNavigationWarning,.2)},localize("editorMarkerNavigationWarningBackground","Editor marker navigation widget warning heading background.")),editorMarkerNavigationInfo=registerColor("editorMarkerNavigationInfo.background",{dark:infoDefault,light:infoDefault,hcDark:contrastBorder,hcLight:contrastBorder},localize("editorMarkerNavigationInfo","Editor marker navigation widget info color.")),editorMarkerNavigationInfoHeader=registerColor("editorMarkerNavigationInfo.headerBackground",{dark:transparent(editorMarkerNavigationInfo,.1),light:transparent(editorMarkerNavigationInfo,.1),hcDark:null,hcLight:null},localize("editorMarkerNavigationInfoHeaderBackground","Editor marker navigation widget info heading background.")),editorMarkerNavigationBackground=registerColor("editorMarkerNavigation.background",{dark:editorBackground,light:editorBackground,hcDark:editorBackground,hcLight:editorBackground},localize("editorMarkerNavigationBackground","Editor marker navigation widget background."));var __decorate$11=globalThis&&globalThis.__decorate||function(K,C,W,V){var U=arguments.length,G=U<3?C:V===null?V=Object.getOwnPropertyDescriptor(C,W):V,Z;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")G=Reflect.decorate(K,C,W,V);else for(var X=K.length-1;X>=0;X--)(Z=K[X])&&(G=(U<3?Z(G):U>3?Z(C,W,G):Z(C,W))||G);return U>3&&G&&Object.defineProperty(C,W,G),G},__param$11=globalThis&&globalThis.__param||function(K,C){return function(W,V){C(W,V,K)}},__awaiter$M=globalThis&&globalThis.__awaiter||function(K,C,W,V){function U(G){return G instanceof W?G:new W(function(Z){Z(G)})}return new(W||(W=Promise))(function(G,Z){function X(ee){try{J(V.next(ee))}catch(te){Z(te)}}function Q(ee){try{J(V.throw(ee))}catch(te){Z(te)}}function J(ee){ee.done?G(ee.value):U(ee.value).then(X,Q)}J((V=V.apply(K,C||[])).next())})},MarkerController_1;let MarkerController=MarkerController_1=class{static get(C){return C.getContribution(MarkerController_1.ID)}constructor(C,W,V,U,G){this._markerNavigationService=W,this._contextKeyService=V,this._editorService=U,this._instantiationService=G,this._sessionDispoables=new DisposableStore,this._editor=C,this._widgetVisible=CONTEXT_MARKERS_NAVIGATION_VISIBLE.bindTo(this._contextKeyService)}dispose(){this._cleanUp(),this._sessionDispoables.dispose()}_cleanUp(){this._widgetVisible.reset(),this._sessionDispoables.clear(),this._widget=void 0,this._model=void 0}_getOrCreateModel(C){if(this._model&&this._model.matches(C))return this._model;let W=!1;return this._model&&(W=!0,this._cleanUp()),this._model=this._markerNavigationService.getMarkerList(C),W&&this._model.move(!0,this._editor.getModel(),this._editor.getPosition()),this._widget=this._instantiationService.createInstance(MarkerNavigationWidget,this._editor),this._widget.onDidClose(()=>this.close(),this,this._sessionDispoables),this._widgetVisible.set(!0),this._sessionDispoables.add(this._model),this._sessionDispoables.add(this._widget),this._sessionDispoables.add(this._editor.onDidChangeCursorPosition(V=>{var U,G,Z;(!(!((U=this._model)===null||U===void 0)&&U.selected)||!Range$2.containsPosition((G=this._model)===null||G===void 0?void 0:G.selected.marker,V.position))&&((Z=this._model)===null||Z===void 0||Z.resetIndex())})),this._sessionDispoables.add(this._model.onDidChange(()=>{if(!this._widget||!this._widget.position||!this._model)return;const V=this._model.find(this._editor.getModel().uri,this._widget.position);V?this._widget.updateMarker(V.marker):this._widget.showStale()})),this._sessionDispoables.add(this._widget.onDidSelectRelatedInformation(V=>{this._editorService.openCodeEditor({resource:V.resource,options:{pinned:!0,revealIfOpened:!0,selection:Range$2.lift(V).collapseToStart()}},this._editor),this.close(!1)})),this._sessionDispoables.add(this._editor.onDidChangeModel(()=>this._cleanUp())),this._model}close(C=!0){this._cleanUp(),C&&this._editor.focus()}showAtMarker(C){if(this._editor.hasModel()){const W=this._getOrCreateModel(this._editor.getModel().uri);W.resetIndex(),W.move(!0,this._editor.getModel(),new Position$1(C.startLineNumber,C.startColumn)),W.selected&&this._widget.showAtMarker(W.selected.marker,W.selected.index,W.selected.total)}}nagivate(C,W){var V,U;return __awaiter$M(this,void 0,void 0,function*(){if(this._editor.hasModel()){const G=this._getOrCreateModel(W?void 0:this._editor.getModel().uri);if(G.move(C,this._editor.getModel(),this._editor.getPosition()),!G.selected)return;if(G.selected.marker.resource.toString()!==this._editor.getModel().uri.toString()){this._cleanUp();const Z=yield this._editorService.openCodeEditor({resource:G.selected.marker.resource,options:{pinned:!1,revealIfOpened:!0,selectionRevealType:2,selection:G.selected.marker}},this._editor);Z&&((V=MarkerController_1.get(Z))===null||V===void 0||V.close(),(U=MarkerController_1.get(Z))===null||U===void 0||U.nagivate(C,W))}else this._widget.showAtMarker(G.selected.marker,G.selected.index,G.selected.total)}})}};MarkerController.ID="editor.contrib.markerController";MarkerController=MarkerController_1=__decorate$11([__param$11(1,IMarkerNavigationService),__param$11(2,IContextKeyService),__param$11(3,ICodeEditorService),__param$11(4,IInstantiationService)],MarkerController);class MarkerNavigationAction extends EditorAction{constructor(C,W,V){super(V),this._next=C,this._multiFile=W}run(C,W){var V;return __awaiter$M(this,void 0,void 0,function*(){W.hasModel()&&((V=MarkerController.get(W))===null||V===void 0||V.nagivate(this._next,this._multiFile))})}}class NextMarkerAction extends MarkerNavigationAction{constructor(){super(!0,!1,{id:NextMarkerAction.ID,label:NextMarkerAction.LABEL,alias:"Go to Next Problem (Error, Warning, Info)",precondition:void 0,kbOpts:{kbExpr:EditorContextKeys.focus,primary:578,weight:100},menuOpts:{menuId:MarkerNavigationWidget.TitleMenu,title:NextMarkerAction.LABEL,icon:registerIcon("marker-navigation-next",Codicon.arrowDown,localize("nextMarkerIcon","Icon for goto next marker.")),group:"navigation",order:1}})}}NextMarkerAction.ID="editor.action.marker.next";NextMarkerAction.LABEL=localize("markerAction.next.label","Go to Next Problem (Error, Warning, Info)");class PrevMarkerAction extends MarkerNavigationAction{constructor(){super(!1,!1,{id:PrevMarkerAction.ID,label:PrevMarkerAction.LABEL,alias:"Go to Previous Problem (Error, Warning, Info)",precondition:void 0,kbOpts:{kbExpr:EditorContextKeys.focus,primary:1602,weight:100},menuOpts:{menuId:MarkerNavigationWidget.TitleMenu,title:PrevMarkerAction.LABEL,icon:registerIcon("marker-navigation-previous",Codicon.arrowUp,localize("previousMarkerIcon","Icon for goto previous marker.")),group:"navigation",order:2}})}}PrevMarkerAction.ID="editor.action.marker.prev";PrevMarkerAction.LABEL=localize("markerAction.previous.label","Go to Previous Problem (Error, Warning, Info)");class NextMarkerInFilesAction extends MarkerNavigationAction{constructor(){super(!0,!0,{id:"editor.action.marker.nextInFiles",label:localize("markerAction.nextInFiles.label","Go to Next Problem in Files (Error, Warning, Info)"),alias:"Go to Next Problem in Files (Error, Warning, Info)",precondition:void 0,kbOpts:{kbExpr:EditorContextKeys.focus,primary:66,weight:100},menuOpts:{menuId:MenuId.MenubarGoMenu,title:localize({key:"miGotoNextProblem",comment:["&& denotes a mnemonic"]},"Next &&Problem"),group:"6_problem_nav",order:1}})}}class PrevMarkerInFilesAction extends MarkerNavigationAction{constructor(){super(!1,!0,{id:"editor.action.marker.prevInFiles",label:localize("markerAction.previousInFiles.label","Go to Previous Problem in Files (Error, Warning, Info)"),alias:"Go to Previous Problem in Files (Error, Warning, Info)",precondition:void 0,kbOpts:{kbExpr:EditorContextKeys.focus,primary:1090,weight:100},menuOpts:{menuId:MenuId.MenubarGoMenu,title:localize({key:"miGotoPreviousProblem",comment:["&& denotes a mnemonic"]},"Previous &&Problem"),group:"6_problem_nav",order:2}})}}registerEditorContribution(MarkerController.ID,MarkerController,4);registerEditorAction(NextMarkerAction);registerEditorAction(PrevMarkerAction);registerEditorAction(NextMarkerInFilesAction);registerEditorAction(PrevMarkerInFilesAction);const CONTEXT_MARKERS_NAVIGATION_VISIBLE=new RawContextKey("markersNavigationVisible",!1),MarkerCommand=EditorCommand.bindToContribution(MarkerController.get);registerEditorCommand(new MarkerCommand({id:"closeMarkersNavigation",precondition:CONTEXT_MARKERS_NAVIGATION_VISIBLE,handler:K=>K.close(),kbOpts:{weight:100+50,kbExpr:EditorContextKeys.focus,primary:9,secondary:[1033]}}));var __decorate$10=globalThis&&globalThis.__decorate||function(K,C,W,V){var U=arguments.length,G=U<3?C:V===null?V=Object.getOwnPropertyDescriptor(C,W):V,Z;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")G=Reflect.decorate(K,C,W,V);else for(var X=K.length-1;X>=0;X--)(Z=K[X])&&(G=(U<3?Z(G):U>3?Z(C,W,G):Z(C,W))||G);return U>3&&G&&Object.defineProperty(C,W,G),G},__param$10=globalThis&&globalThis.__param||function(K,C){return function(W,V){C(W,V,K)}};const $$1=$$d;class MarkerHover{constructor(C,W,V){this.owner=C,this.range=W,this.marker=V}isValidForHoverAnchor(C){return C.type===1&&this.range.startColumn<=C.range.startColumn&&this.range.endColumn>=C.range.endColumn}}const markerCodeActionTrigger={type:1,filter:{include:CodeActionKind.QuickFix},triggerAction:CodeActionTriggerSource.QuickFixHover};let MarkerHoverParticipant=class{constructor(C,W,V,U){this._editor=C,this._markerDecorationsService=W,this._openerService=V,this._languageFeaturesService=U,this.hoverOrdinal=1,this.recentMarkerCodeActionsInfo=void 0}computeSync(C,W){if(!this._editor.hasModel()||C.type!==1&&!C.supportsMarkerHover)return[];const V=this._editor.getModel(),U=C.range.startLineNumber,G=V.getLineMaxColumn(U),Z=[];for(const X of W){const Q=X.range.startLineNumber===U?X.range.startColumn:1,J=X.range.endLineNumber===U?X.range.endColumn:G,ee=this._markerDecorationsService.getMarker(V.uri,X);if(!ee)continue;const te=new Range$2(C.range.startLineNumber,Q,C.range.startLineNumber,J);Z.push(new MarkerHover(this,te,ee))}return Z}renderHoverParts(C,W){if(!W.length)return Disposable.None;const V=new DisposableStore;W.forEach(G=>C.fragment.appendChild(this.renderMarkerHover(G,V)));const U=W.length===1?W[0]:W.sort((G,Z)=>MarkerSeverity$1.compare(G.marker.severity,Z.marker.severity))[0];return this.renderMarkerStatusbar(C,U,V),V}renderMarkerHover(C,W){const V=$$1("div.hover-row"),U=append$3(V,$$1("div.marker.hover-contents")),{source:G,message:Z,code:X,relatedInformation:Q}=C.marker;this._editor.applyFontInfo(U);const J=append$3(U,$$1("span"));if(J.style.whiteSpace="pre-wrap",J.innerText=Z,G||X)if(X&&typeof X!="string"){const ee=$$1("span");if(G){const oe=append$3(ee,$$1("span"));oe.innerText=G}const te=append$3(ee,$$1("a.code-link"));te.setAttribute("href",X.target.toString()),W.add(addDisposableListener(te,"click",oe=>{this._openerService.open(X.target,{allowCommands:!0}),oe.preventDefault(),oe.stopPropagation()}));const ie=append$3(te,$$1("span"));ie.innerText=X.value;const ne=append$3(U,ee);ne.style.opacity="0.6",ne.style.paddingLeft="6px"}else{const ee=append$3(U,$$1("span"));ee.style.opacity="0.6",ee.style.paddingLeft="6px",ee.innerText=G&&X?`${G}(${X})`:G||`(${X})`}if(isNonEmptyArray$2(Q))for(const{message:ee,resource:te,startLineNumber:ie,startColumn:ne}of Q){const oe=append$3(U,$$1("div"));oe.style.marginTop="8px";const re=append$3(oe,$$1("a"));re.innerText=`${basename(te)}(${ie}, ${ne}): `,re.style.cursor="pointer",W.add(addDisposableListener(re,"click",se=>{se.stopPropagation(),se.preventDefault(),this._openerService&&this._openerService.open(te,{fromUserGesture:!0,editorOptions:{selection:{startLineNumber:ie,startColumn:ne}}}).catch(onUnexpectedError)}));const ae=append$3(oe,$$1("span"));ae.innerText=ee,this._editor.applyFontInfo(ae)}return V}renderMarkerStatusbar(C,W,V){if((W.marker.severity===MarkerSeverity$1.Error||W.marker.severity===MarkerSeverity$1.Warning||W.marker.severity===MarkerSeverity$1.Info)&&C.statusBar.addAction({label:localize("view problem","View Problem"),commandId:NextMarkerAction.ID,run:()=>{var U;C.hide(),(U=MarkerController.get(this._editor))===null||U===void 0||U.showAtMarker(W.marker),this._editor.focus()}}),!this._editor.getOption(90)){const U=C.statusBar.append($$1("div"));this.recentMarkerCodeActionsInfo&&(IMarkerData.makeKey(this.recentMarkerCodeActionsInfo.marker)===IMarkerData.makeKey(W.marker)?this.recentMarkerCodeActionsInfo.hasCodeActions||(U.textContent=localize("noQuickFixes","No quick fixes available")):this.recentMarkerCodeActionsInfo=void 0);const G=this.recentMarkerCodeActionsInfo&&!this.recentMarkerCodeActionsInfo.hasCodeActions?Disposable.None:V.add(disposableTimeout(()=>U.textContent=localize("checkingForQuickFixes","Checking for quick fixes..."),200));U.textContent||(U.textContent=String.fromCharCode(160));const Z=this.getCodeActions(W.marker);V.add(toDisposable(()=>Z.cancel())),Z.then(X=>{if(G.dispose(),this.recentMarkerCodeActionsInfo={marker:W.marker,hasCodeActions:X.validActions.length>0},!this.recentMarkerCodeActionsInfo.hasCodeActions){X.dispose(),U.textContent=localize("noQuickFixes","No quick fixes available");return}U.style.display="none";let Q=!1;V.add(toDisposable(()=>{Q||X.dispose()})),C.statusBar.addAction({label:localize("quick fixes","Quick Fix..."),commandId:quickFixCommandId,run:J=>{Q=!0;const ee=CodeActionController.get(this._editor),te=getDomNodePagePosition(J);C.hide(),ee==null||ee.showCodeActions(markerCodeActionTrigger,X,{x:te.left,y:te.top,width:te.width,height:te.height})}})},onUnexpectedError)}}getCodeActions(C){return createCancelablePromise(W=>getCodeActions(this._languageFeaturesService.codeActionProvider,this._editor.getModel(),new Range$2(C.startLineNumber,C.startColumn,C.endLineNumber,C.endColumn),markerCodeActionTrigger,Progress.None,W))}};MarkerHoverParticipant=__decorate$10([__param$10(1,IMarkerDecorationsService),__param$10(2,IOpenerService),__param$10(3,ILanguageFeaturesService)],MarkerHoverParticipant);const inlineCompletionsHintsWidget="",inlineSuggestCommitId="editor.action.inlineSuggest.commit",showPreviousInlineSuggestionActionId="editor.action.inlineSuggest.showPrevious",showNextInlineSuggestionActionId="editor.action.inlineSuggest.showNext",toolbar="";var __awaiter$L=globalThis&&globalThis.__awaiter||function(K,C,W,V){function U(G){return G instanceof W?G:new W(function(Z){Z(G)})}return new(W||(W=Promise))(function(G,Z){function X(ee){try{J(V.next(ee))}catch(te){Z(te)}}function Q(ee){try{J(V.throw(ee))}catch(te){Z(te)}}function J(ee){ee.done?G(ee.value):U(ee.value).then(X,Q)}J((V=V.apply(K,C||[])).next())})};class ToolBar extends Disposable{constructor(C,W,V={orientation:0}){super(),this.submenuActionViewItems=[],this.hasSecondaryActions=!1,this._onDidChangeDropdownVisibility=this._register(new EventMultiplexer),this.onDidChangeDropdownVisibility=this._onDidChangeDropdownVisibility.event,this.disposables=this._register(new DisposableStore),this.options=V,this.lookupKeybindings=typeof this.options.getKeyBinding=="function",this.toggleMenuAction=this._register(new ToggleMenuAction(()=>{var U;return(U=this.toggleMenuActionViewItem)===null||U===void 0?void 0:U.show()},V.toggleMenuTitle)),this.element=document.createElement("div"),this.element.className="monaco-toolbar",C.appendChild(this.element),this.actionBar=this._register(new ActionBar(this.element,{orientation:V.orientation,ariaLabel:V.ariaLabel,actionRunner:V.actionRunner,allowContextMenu:V.allowContextMenu,highlightToggledItems:V.highlightToggledItems,actionViewItemProvider:(U,G)=>{var Z;if(U.id===ToggleMenuAction.ID)return this.toggleMenuActionViewItem=new DropdownMenuActionViewItem(U,U.menuActions,W,{actionViewItemProvider:this.options.actionViewItemProvider,actionRunner:this.actionRunner,keybindingProvider:this.options.getKeyBinding,classNames:ThemeIcon.asClassNameArray((Z=V.moreIcon)!==null&&Z!==void 0?Z:Codicon.toolBarMore),anchorAlignmentProvider:this.options.anchorAlignmentProvider,menuAsChild:!!this.options.renderDropdownAsChildElement,skipTelemetry:this.options.skipTelemetry}),this.toggleMenuActionViewItem.setActionContext(this.actionBar.context),this.disposables.add(this._onDidChangeDropdownVisibility.add(this.toggleMenuActionViewItem.onDidChangeVisibility)),this.toggleMenuActionViewItem;if(V.actionViewItemProvider){const X=V.actionViewItemProvider(U,G);if(X)return X}if(U instanceof SubmenuAction){const X=new DropdownMenuActionViewItem(U,U.actions,W,{actionViewItemProvider:this.options.actionViewItemProvider,actionRunner:this.actionRunner,keybindingProvider:this.options.getKeyBinding,classNames:U.class,anchorAlignmentProvider:this.options.anchorAlignmentProvider,menuAsChild:!!this.options.renderDropdownAsChildElement,skipTelemetry:this.options.skipTelemetry});return X.setActionContext(this.actionBar.context),this.submenuActionViewItems.push(X),this.disposables.add(this._onDidChangeDropdownVisibility.add(X.onDidChangeVisibility)),X}}}))}set actionRunner(C){this.actionBar.actionRunner=C}get actionRunner(){return this.actionBar.actionRunner}getElement(){return this.element}getItemAction(C){return this.actionBar.getAction(C)}setActions(C,W){this.clear();const V=C?C.slice(0):[];this.hasSecondaryActions=!!(W&&W.length>0),this.hasSecondaryActions&&W&&(this.toggleMenuAction.menuActions=W.slice(0),V.push(this.toggleMenuAction)),V.forEach(U=>{this.actionBar.push(U,{icon:!0,label:!1,keybinding:this.getKeybindingLabel(U)})})}getKeybindingLabel(C){var W,V,U;const G=this.lookupKeybindings?(V=(W=this.options).getKeyBinding)===null||V===void 0?void 0:V.call(W,C):void 0;return(U=G==null?void 0:G.getLabel())!==null&&U!==void 0?U:void 0}clear(){this.submenuActionViewItems=[],this.disposables.clear(),this.actionBar.clear()}dispose(){this.clear(),this.disposables.dispose(),super.dispose()}}class ToggleMenuAction extends Action{constructor(C,W){W=W||localize("moreActions","More Actions..."),super(ToggleMenuAction.ID,W,void 0,!0),this._menuActions=[],this.toggleDropdownMenu=C}run(){return __awaiter$L(this,void 0,void 0,function*(){this.toggleDropdownMenu()})}get menuActions(){return this._menuActions}set menuActions(C){this._menuActions=C}}ToggleMenuAction.ID="toolbar.toggle.more";var __decorate$$=globalThis&&globalThis.__decorate||function(K,C,W,V){var U=arguments.length,G=U<3?C:V===null?V=Object.getOwnPropertyDescriptor(C,W):V,Z;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")G=Reflect.decorate(K,C,W,V);else for(var X=K.length-1;X>=0;X--)(Z=K[X])&&(G=(U<3?Z(G):U>3?Z(C,W,G):Z(C,W))||G);return U>3&&G&&Object.defineProperty(C,W,G),G},__param$$=globalThis&&globalThis.__param||function(K,C){return function(W,V){C(W,V,K)}};let WorkbenchToolBar=class extends ToolBar{constructor(C,W,V,U,G,Z,X){super(C,G,Object.assign(Object.assign({getKeyBinding:J=>{var ee;return(ee=Z.lookupKeybinding(J.id))!==null&&ee!==void 0?ee:void 0}},W),{allowContextMenu:!0,skipTelemetry:typeof(W==null?void 0:W.telemetrySource)=="string"})),this._options=W,this._menuService=V,this._contextKeyService=U,this._contextMenuService=G,this._sessionDisposables=this._store.add(new DisposableStore);const Q=W==null?void 0:W.telemetrySource;Q&&this._store.add(this.actionBar.onDidRun(J=>X.publicLog2("workbenchActionExecuted",{id:J.action.id,from:Q})))}setActions(C,W=[],V){var U,G,Z;this._sessionDisposables.clear();const X=C.slice(),Q=W.slice(),J=[];let ee=0;const te=[];let ie=!1;if(((U=this._options)===null||U===void 0?void 0:U.hiddenItemStrategy)!==-1)for(let ne=0;ne<X.length;ne++){const oe=X[ne];!(oe instanceof MenuItemAction)&&!(oe instanceof SubmenuItemAction)||oe.hideActions&&(J.push(oe.hideActions.toggle),oe.hideActions.toggle.checked&&ee++,oe.hideActions.isHidden&&(ie=!0,X[ne]=void 0,((G=this._options)===null||G===void 0?void 0:G.hiddenItemStrategy)!==0&&(te[ne]=oe)))}if(((Z=this._options)===null||Z===void 0?void 0:Z.overflowBehavior)!==void 0){const ne=intersection$2(new Set(this._options.overflowBehavior.exempted),Iterable.map(X,ae=>ae==null?void 0:ae.id)),oe=this._options.overflowBehavior.maxItems-ne.size;let re=0;for(let ae=0;ae<X.length;ae++){const se=X[ae];se&&(re++,!ne.has(se.id)&&re>=oe&&(X[ae]=void 0,te[ae]=se))}}coalesceInPlace(X),coalesceInPlace(te),super.setActions(X,Separator.join(te,Q)),J.length>0&&this._sessionDisposables.add(addDisposableListener(this.getElement(),"contextmenu",ne=>{var oe,re,ae,se,le;const ce=new StandardMouseEvent(ne),de=this.getItemAction(ce.target);if(!de)return;ce.preventDefault(),ce.stopPropagation();let ue=!1;if(ee===1&&((oe=this._options)===null||oe===void 0?void 0:oe.hiddenItemStrategy)===0){ue=!0;for(let fe=0;fe<J.length;fe++)if(J[fe].checked){J[fe]=toAction({id:de.id,label:de.label,checked:!0,enabled:!1,run(){}});break}}let ge;if(!ue&&(de instanceof MenuItemAction||de instanceof SubmenuItemAction)){if(!de.hideActions)return;ge=de.hideActions.hide}else ge=toAction({id:"label",label:localize("hide","Hide"),enabled:!1,run(){}});const he=Separator.join([ge],J);!((re=this._options)===null||re===void 0)&&re.resetMenu&&!V&&(V=[this._options.resetMenu]),ie&&V&&(he.push(new Separator),he.push(toAction({id:"resetThisMenu",label:localize("resetThisMenu","Reset Menu"),run:()=>this._menuService.resetHiddenStates(V)}))),this._contextMenuService.showContextMenu({getAnchor:()=>ce,getActions:()=>he,menuId:(ae=this._options)===null||ae===void 0?void 0:ae.contextMenu,menuActionOptions:Object.assign({renderShortTitle:!0},(se=this._options)===null||se===void 0?void 0:se.menuOptions),skipTelemetry:typeof((le=this._options)===null||le===void 0?void 0:le.telemetrySource)=="string",contextKeyService:this._contextKeyService})}))}};WorkbenchToolBar=__decorate$$([__param$$(2,IMenuService),__param$$(3,IContextKeyService),__param$$(4,IContextMenuService),__param$$(5,IKeybindingService),__param$$(6,ITelemetryService)],WorkbenchToolBar);var __decorate$_=globalThis&&globalThis.__decorate||function(K,C,W,V){var U=arguments.length,G=U<3?C:V===null?V=Object.getOwnPropertyDescriptor(C,W):V,Z;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")G=Reflect.decorate(K,C,W,V);else for(var X=K.length-1;X>=0;X--)(Z=K[X])&&(G=(U<3?Z(G):U>3?Z(C,W,G):Z(C,W))||G);return U>3&&G&&Object.defineProperty(C,W,G),G},__param$_=globalThis&&globalThis.__param||function(K,C){return function(W,V){C(W,V,K)}},InlineSuggestionHintsContentWidget_1;let InlineCompletionsHintsWidget=class extends Disposable{constructor(C,W,V){super(),this.editor=C,this.model=W,this.instantiationService=V,this.alwaysShowToolbar=observableFromEvent(this.editor.onDidChangeConfiguration,()=>this.editor.getOption(62).showToolbar==="always"),this.sessionPosition=void 0,this.position=derived(this,U=>{var G,Z,X;const Q=(G=this.model.read(U))===null||G===void 0?void 0:G.ghostText.read(U);if(!this.alwaysShowToolbar.read(U)||!Q||Q.parts.length===0)return this.sessionPosition=void 0,null;const J=Q.parts[0].column;this.sessionPosition&&this.sessionPosition.lineNumber!==Q.lineNumber&&(this.sessionPosition=void 0);const ee=new Position$1(Q.lineNumber,Math.min(J,(X=(Z=this.sessionPosition)===null||Z===void 0?void 0:Z.column)!==null&&X!==void 0?X:Number.MAX_SAFE_INTEGER));return this.sessionPosition=ee,ee}),this._register(autorunWithStore((U,G)=>{const Z=this.model.read(U);if(!Z||!this.alwaysShowToolbar.read(U))return;const X=G.add(this.instantiationService.createInstance(InlineSuggestionHintsContentWidget,this.editor,!0,this.position,Z.selectedInlineCompletionIndex,Z.inlineCompletionsCount,Z.selectedInlineCompletion.map(Q=>{var J;return(J=Q==null?void 0:Q.inlineCompletion.source.inlineCompletions.commands)!==null&&J!==void 0?J:[]})));C.addContentWidget(X),G.add(toDisposable(()=>C.removeContentWidget(X))),G.add(autorun(Q=>{this.position.read(Q)&&Z.lastTriggerKind.read(Q)!==InlineCompletionTriggerKind$1.Explicit&&Z.triggerExplicitly()}))}))}};InlineCompletionsHintsWidget=__decorate$_([__param$_(2,IInstantiationService)],InlineCompletionsHintsWidget);const inlineSuggestionHintsNextIcon=registerIcon("inline-suggestion-hints-next",Codicon.chevronRight,localize("parameterHintsNextIcon","Icon for show next parameter hint.")),inlineSuggestionHintsPreviousIcon=registerIcon("inline-suggestion-hints-previous",Codicon.chevronLeft,localize("parameterHintsPreviousIcon","Icon for show previous parameter hint."));let InlineSuggestionHintsContentWidget=InlineSuggestionHintsContentWidget_1=class extends Disposable{static get dropDownVisible(){return this._dropDownVisible}createCommandAction(C,W,V){const U=new Action(C,W,V,!0,()=>this._commandService.executeCommand(C)),G=this.keybindingService.lookupKeybinding(C,this._contextKeyService);let Z=W;return G&&(Z=localize({key:"content",comment:["A label","A keybinding"]},"{0} ({1})",W,G.getLabel())),U.tooltip=Z,U}constructor(C,W,V,U,G,Z,X,Q,J,ee,te){super(),this.editor=C,this.withBorder=W,this._position=V,this._currentSuggestionIdx=U,this._suggestionCount=G,this._extraCommands=Z,this._commandService=X,this.keybindingService=J,this._contextKeyService=ee,this._menuService=te,this.id=`InlineSuggestionHintsContentWidget${InlineSuggestionHintsContentWidget_1.id++}`,this.allowEditorOverflow=!0,this.suppressMouseDown=!1,this.nodes=h("div.inlineSuggestionsHints",{className:this.withBorder?".withBorder":""},[h("div@toolBar")]),this.previousAction=this.createCommandAction(showPreviousInlineSuggestionActionId,localize("previous","Previous"),ThemeIcon.asClassName(inlineSuggestionHintsPreviousIcon)),this.availableSuggestionCountAction=new Action("inlineSuggestionHints.availableSuggestionCount","",void 0,!1),this.nextAction=this.createCommandAction(showNextInlineSuggestionActionId,localize("next","Next"),ThemeIcon.asClassName(inlineSuggestionHintsNextIcon)),this.inlineCompletionsActionsMenus=this._register(this._menuService.createMenu(MenuId.InlineCompletionsActions,this._contextKeyService)),this.clearAvailableSuggestionCountLabelDebounced=this._register(new RunOnceScheduler(()=>{this.availableSuggestionCountAction.label=""},100)),this.disableButtonsDebounced=this._register(new RunOnceScheduler(()=>{this.previousAction.enabled=this.nextAction.enabled=!1},100)),this.lastCommands=[],this.toolBar=this._register(Q.createInstance(CustomizedMenuWorkbenchToolBar,this.nodes.toolBar,MenuId.InlineSuggestionToolbar,{menuOptions:{renderShortTitle:!0},toolbarOptions:{primaryGroup:ie=>ie.startsWith("primary")},actionViewItemProvider:(ie,ne)=>{if(ie instanceof MenuItemAction)return Q.createInstance(StatusBarViewItem$1,ie,void 0);if(ie===this.availableSuggestionCountAction){const oe=new ActionViewItemWithClassName(void 0,ie,{label:!0,icon:!1});return oe.setClass("availableSuggestionCount"),oe}},telemetrySource:"InlineSuggestionToolbar"})),this.toolBar.setPrependedPrimaryActions([this.previousAction,this.availableSuggestionCountAction,this.nextAction]),this._register(this.toolBar.onDidChangeDropdownVisibility(ie=>{InlineSuggestionHintsContentWidget_1._dropDownVisible=ie})),this._register(autorun(ie=>{this._position.read(ie),this.editor.layoutContentWidget(this)})),this._register(autorun(ie=>{const ne=this._suggestionCount.read(ie),oe=this._currentSuggestionIdx.read(ie);ne!==void 0?(this.clearAvailableSuggestionCountLabelDebounced.cancel(),this.availableSuggestionCountAction.label=`${oe+1}/${ne}`):this.clearAvailableSuggestionCountLabelDebounced.schedule(),ne!==void 0&&ne>1?(this.disableButtonsDebounced.cancel(),this.previousAction.enabled=this.nextAction.enabled=!0):this.disableButtonsDebounced.schedule()})),this._register(autorun(ie=>{const ne=this._extraCommands.read(ie);if(equals$5(this.lastCommands,ne))return;this.lastCommands=ne;const oe=ne.map(re=>({class:void 0,id:re.id,enabled:!0,tooltip:re.tooltip||"",label:re.title,run:ae=>this._commandService.executeCommand(re.id)}));for(const[re,ae]of this.inlineCompletionsActionsMenus.getActions())for(const se of ae)se instanceof MenuItemAction&&oe.push(se);oe.length>0&&oe.unshift(new Separator),this.toolBar.setAdditionalSecondaryActions(oe)}))}getId(){return this.id}getDomNode(){return this.nodes.root}getPosition(){return{position:this._position.get(),preference:[1,2],positionAffinity:3}}};InlineSuggestionHintsContentWidget._dropDownVisible=!1;InlineSuggestionHintsContentWidget.id=0;InlineSuggestionHintsContentWidget=InlineSuggestionHintsContentWidget_1=__decorate$_([__param$_(6,ICommandService),__param$_(7,IInstantiationService),__param$_(8,IKeybindingService),__param$_(9,IContextKeyService),__param$_(10,IMenuService)],InlineSuggestionHintsContentWidget);class ActionViewItemWithClassName extends ActionViewItem{constructor(){super(...arguments),this._className=void 0}setClass(C){this._className=C}render(C){super.render(C),this._className&&C.classList.add(this._className)}}let StatusBarViewItem$1=class extends MenuEntryActionViewItem{updateLabel(){const C=this._keybindingService.lookupKeybinding(this._action.id,this._contextKeyService);if(!C)return super.updateLabel();if(this.label){const W=h("div.keybinding").root;new KeybindingLabel(W,OS,Object.assign({disableTitle:!0},unthemedKeybindingLabelOptions)).set(C),this.label.textContent=this._action.label,this.label.appendChild(W),this.label.classList.add("inlineSuggestionStatusBarItemLabel")}}},CustomizedMenuWorkbenchToolBar=class extends WorkbenchToolBar{constructor(C,W,V,U,G,Z,X,Q){super(C,Object.assign({resetMenu:W},V),U,G,Z,X,Q),this.menuId=W,this.options2=V,this.menuService=U,this.contextKeyService=G,this.menu=this._store.add(this.menuService.createMenu(this.menuId,this.contextKeyService,{emitEventsForSubmenuChanges:!0})),this.additionalActions=[],this.prependedPrimaryActions=[],this._store.add(this.menu.onDidChange(()=>this.updateToolbar())),this.updateToolbar()}updateToolbar(){var C,W,V,U,G,Z,X;const Q=[],J=[];createAndFillInActionBarActions(this.menu,(C=this.options2)===null||C===void 0?void 0:C.menuOptions,{primary:Q,secondary:J},(V=(W=this.options2)===null||W===void 0?void 0:W.toolbarOptions)===null||V===void 0?void 0:V.primaryGroup,(G=(U=this.options2)===null||U===void 0?void 0:U.toolbarOptions)===null||G===void 0?void 0:G.shouldInlineSubmenu,(X=(Z=this.options2)===null||Z===void 0?void 0:Z.toolbarOptions)===null||X===void 0?void 0:X.useSeparatorsInPrimaryActions),J.push(...this.additionalActions),Q.unshift(...this.prependedPrimaryActions),this.setActions(Q,J)}setPrependedPrimaryActions(C){equals$5(this.prependedPrimaryActions,C,(W,V)=>W===V)||(this.prependedPrimaryActions=C,this.updateToolbar())}setAdditionalSecondaryActions(C){equals$5(this.additionalActions,C,(W,V)=>W===V)||(this.additionalActions=C,this.updateToolbar())}};CustomizedMenuWorkbenchToolBar=__decorate$_([__param$_(3,IMenuService),__param$_(4,IContextKeyService),__param$_(5,IContextMenuService),__param$_(6,IKeybindingService),__param$_(7,ITelemetryService)],CustomizedMenuWorkbenchToolBar);const hover="";var __decorate$Z=globalThis&&globalThis.__decorate||function(K,C,W,V){var U=arguments.length,G=U<3?C:V===null?V=Object.getOwnPropertyDescriptor(C,W):V,Z;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")G=Reflect.decorate(K,C,W,V);else for(var X=K.length-1;X>=0;X--)(Z=K[X])&&(G=(U<3?Z(G):U>3?Z(C,W,G):Z(C,W))||G);return U>3&&G&&Object.defineProperty(C,W,G),G},__param$Z=globalThis&&globalThis.__param||function(K,C){return function(W,V){C(W,V,K)}},ModesHoverController_1;const _sticky=!1;let ModesHoverController=ModesHoverController_1=class extends Disposable{static get(C){return C.getContribution(ModesHoverController_1.ID)}constructor(C,W,V,U,G){super(),this._editor=C,this._instantiationService=W,this._openerService=V,this._languageService=U,this._keybindingService=G,this._toUnhook=new DisposableStore,this._hoverActivatedByColorDecoratorClick=!1,this._isMouseDown=!1,this._hoverClicked=!1,this._contentWidget=null,this._glyphWidget=null,this._reactToEditorMouseMoveRunner=this._register(new RunOnceScheduler(()=>this._reactToEditorMouseMove(this._mouseMoveEvent),0)),this._hookEvents(),this._register(this._editor.onDidChangeConfiguration(Z=>{Z.hasChanged(60)&&(this._unhookEvents(),this._hookEvents())})),this._register(this._editor.onMouseLeave(()=>{this._mouseMoveEvent=void 0,this._reactToEditorMouseMoveRunner.cancel()}))}_hookEvents(){const C=()=>this._hideWidgets(),W=this._editor.getOption(60);this._isHoverEnabled=W.enabled,this._isHoverSticky=W.sticky,this._hidingDelay=W.hidingDelay,this._isHoverEnabled?(this._toUnhook.add(this._editor.onMouseDown(V=>this._onEditorMouseDown(V))),this._toUnhook.add(this._editor.onMouseUp(V=>this._onEditorMouseUp(V))),this._toUnhook.add(this._editor.onMouseMove(V=>this._onEditorMouseMove(V))),this._toUnhook.add(this._editor.onKeyDown(V=>this._onKeyDown(V)))):(this._toUnhook.add(this._editor.onMouseMove(V=>this._onEditorMouseMove(V))),this._toUnhook.add(this._editor.onKeyDown(V=>this._onKeyDown(V)))),this._toUnhook.add(this._editor.onMouseLeave(V=>this._onEditorMouseLeave(V))),this._toUnhook.add(this._editor.onDidChangeModel(C)),this._toUnhook.add(this._editor.onDidScrollChange(V=>this._onEditorScrollChanged(V)))}_unhookEvents(){this._toUnhook.clear()}_onEditorScrollChanged(C){(C.scrollTopChanged||C.scrollLeftChanged)&&this._hideWidgets()}_onEditorMouseDown(C){var W;this._isMouseDown=!0;const V=C.target;if(V.type===9&&V.detail===ContentHoverWidget.ID){this._hoverClicked=!0;return}V.type===12&&V.detail===MarginHoverWidget.ID||(V.type!==12&&(this._hoverClicked=!1),!((W=this._contentWidget)===null||W===void 0)&&W.widget.isResizing||this._hideWidgets())}_onEditorMouseUp(C){this._isMouseDown=!1}_onEditorMouseLeave(C){var W,V;const U=C.event.browserEvent.relatedTarget;!((W=this._contentWidget)===null||W===void 0)&&W.widget.isResizing||!((V=this._contentWidget)===null||V===void 0)&&V.containsNode(U)||this._hideWidgets()}_isMouseOverWidget(C){var W,V,U,G,Z;const X=C.target;return!!(this._isHoverSticky&&X.type===9&&X.detail===ContentHoverWidget.ID||this._isHoverSticky&&(!((W=this._contentWidget)===null||W===void 0)&&W.containsNode((V=C.event.browserEvent.view)===null||V===void 0?void 0:V.document.activeElement))&&!(!((G=(U=C.event.browserEvent.view)===null||U===void 0?void 0:U.getSelection())===null||G===void 0)&&G.isCollapsed)||!this._isHoverSticky&&X.type===9&&X.detail===ContentHoverWidget.ID&&(!((Z=this._contentWidget)===null||Z===void 0)&&Z.isColorPickerVisible)||this._isHoverSticky&&X.type===12&&X.detail===MarginHoverWidget.ID)}_onEditorMouseMove(C){var W,V,U,G;if(this._mouseMoveEvent=C,!((W=this._contentWidget)===null||W===void 0)&&W.isFocused||!((V=this._contentWidget)===null||V===void 0)&&V.isResizing||this._isMouseDown&&this._hoverClicked||this._isHoverSticky&&(!((U=this._contentWidget)===null||U===void 0)&&U.isVisibleFromKeyboard))return;if(this._isMouseOverWidget(C)){this._reactToEditorMouseMoveRunner.cancel();return}if(!((G=this._contentWidget)===null||G===void 0)&&G.isVisible&&this._isHoverSticky&&this._hidingDelay>0){this._reactToEditorMouseMoveRunner.isScheduled()||this._reactToEditorMouseMoveRunner.schedule(this._hidingDelay);return}this._reactToEditorMouseMove(C)}_reactToEditorMouseMove(C){var W,V,U;if(!C)return;const G=C.target,Z=(W=G.element)===null||W===void 0?void 0:W.classList.contains("colorpicker-color-decoration"),X=this._editor.getOption(146);if(Z&&(X==="click"&&!this._hoverActivatedByColorDecoratorClick||X==="hover"&&!this._isHoverEnabled&&!_sticky||X==="clickAndHover"&&!this._isHoverEnabled&&!this._hoverActivatedByColorDecoratorClick)||!Z&&!this._isHoverEnabled&&!this._hoverActivatedByColorDecoratorClick){this._hideWidgets();return}if(this._getOrCreateContentWidget().maybeShowAt(C)){(V=this._glyphWidget)===null||V===void 0||V.hide();return}if(G.type===2&&G.position){(U=this._contentWidget)===null||U===void 0||U.hide(),this._glyphWidget||(this._glyphWidget=new MarginHoverWidget(this._editor,this._languageService,this._openerService)),this._glyphWidget.startShowingAt(G.position.lineNumber);return}this._hideWidgets()}_onKeyDown(C){var W;if(!this._editor.hasModel())return;const V=this._keybindingService.softDispatch(C,this._editor.getDomNode()),U=V.kind===1||V.kind===2&&V.commandId==="editor.action.showHover"&&((W=this._contentWidget)===null||W===void 0?void 0:W.isVisible);C.keyCode!==5&&C.keyCode!==6&&C.keyCode!==57&&C.keyCode!==4&&!U&&this._hideWidgets()}_hideWidgets(){var C,W,V;this._isMouseDown&&this._hoverClicked&&(!((C=this._contentWidget)===null||C===void 0)&&C.isColorPickerVisible)||InlineSuggestionHintsContentWidget.dropDownVisible||(this._hoverActivatedByColorDecoratorClick=!1,this._hoverClicked=!1,(W=this._glyphWidget)===null||W===void 0||W.hide(),(V=this._contentWidget)===null||V===void 0||V.hide())}_getOrCreateContentWidget(){return this._contentWidget||(this._contentWidget=this._instantiationService.createInstance(ContentHoverController,this._editor)),this._contentWidget}showContentHover(C,W,V,U,G=!1){this._hoverActivatedByColorDecoratorClick=G,this._getOrCreateContentWidget().startShowingAtRange(C,W,V,U)}focus(){var C;(C=this._contentWidget)===null||C===void 0||C.focus()}scrollUp(){var C;(C=this._contentWidget)===null||C===void 0||C.scrollUp()}scrollDown(){var C;(C=this._contentWidget)===null||C===void 0||C.scrollDown()}scrollLeft(){var C;(C=this._contentWidget)===null||C===void 0||C.scrollLeft()}scrollRight(){var C;(C=this._contentWidget)===null||C===void 0||C.scrollRight()}pageUp(){var C;(C=this._contentWidget)===null||C===void 0||C.pageUp()}pageDown(){var C;(C=this._contentWidget)===null||C===void 0||C.pageDown()}goToTop(){var C;(C=this._contentWidget)===null||C===void 0||C.goToTop()}goToBottom(){var C;(C=this._contentWidget)===null||C===void 0||C.goToBottom()}get isColorPickerVisible(){var C;return(C=this._contentWidget)===null||C===void 0?void 0:C.isColorPickerVisible}get isHoverVisible(){var C;return(C=this._contentWidget)===null||C===void 0?void 0:C.isVisible}dispose(){var C,W;super.dispose(),this._unhookEvents(),this._toUnhook.dispose(),(C=this._glyphWidget)===null||C===void 0||C.dispose(),(W=this._contentWidget)===null||W===void 0||W.dispose()}};ModesHoverController.ID="editor.contrib.hover";ModesHoverController=ModesHoverController_1=__decorate$Z([__param$Z(1,IInstantiationService),__param$Z(2,IOpenerService),__param$Z(3,ILanguageService),__param$Z(4,IKeybindingService)],ModesHoverController);class ShowOrFocusHoverAction extends EditorAction{constructor(){super({id:"editor.action.showHover",label:localize({key:"showOrFocusHover",comment:["Label for action that will trigger the showing/focusing of a hover in the editor.","If the hover is not visible, it will show the hover.","This allows for users to show the hover without using the mouse.","If the hover is already visible, it will take focus."]},"Show or Focus Hover"),description:{description:"Show or Focus Hover",args:[{name:"args",schema:{type:"object",properties:{focus:{description:"Controls if when triggered with the keyboard, the hover should take focus immediately.",type:"boolean",default:!1}}}}]},alias:"Show or Focus Hover",precondition:void 0,kbOpts:{kbExpr:EditorContextKeys.editorTextFocus,primary:KeyChord(2089,2087),weight:100}})}run(C,W,V){if(!W.hasModel())return;const U=ModesHoverController.get(W);if(!U)return;const G=W.getPosition(),Z=new Range$2(G.lineNumber,G.column,G.lineNumber,G.column),X=W.getOption(2)===2||!!(V!=null&&V.focus);U.isHoverVisible?U.focus():U.showContentHover(Z,1,1,X)}}class ShowDefinitionPreviewHoverAction extends EditorAction{constructor(){super({id:"editor.action.showDefinitionPreviewHover",label:localize({key:"showDefinitionPreviewHover",comment:["Label for action that will trigger the showing of definition preview hover in the editor.","This allows for users to show the definition preview hover without using the mouse."]},"Show Definition Preview Hover"),alias:"Show Definition Preview Hover",precondition:void 0})}run(C,W){const V=ModesHoverController.get(W);if(!V)return;const U=W.getPosition();if(!U)return;const G=new Range$2(U.lineNumber,U.column,U.lineNumber,U.column),Z=GotoDefinitionAtPositionEditorContribution.get(W);if(!Z)return;Z.startFindDefinitionFromCursor(U).then(()=>{V.showContentHover(G,1,1,!0)})}}class ScrollUpHoverAction extends EditorAction{constructor(){super({id:"editor.action.scrollUpHover",label:localize({key:"scrollUpHover",comment:["Action that allows to scroll up in the hover widget with the up arrow when the hover widget is focused."]},"Scroll Up Hover"),alias:"Scroll Up Hover",precondition:EditorContextKeys.hoverFocused,kbOpts:{kbExpr:EditorContextKeys.hoverFocused,primary:16,weight:100}})}run(C,W){const V=ModesHoverController.get(W);V&&V.scrollUp()}}class ScrollDownHoverAction extends EditorAction{constructor(){super({id:"editor.action.scrollDownHover",label:localize({key:"scrollDownHover",comment:["Action that allows to scroll down in the hover widget with the up arrow when the hover widget is focused."]},"Scroll Down Hover"),alias:"Scroll Down Hover",precondition:EditorContextKeys.hoverFocused,kbOpts:{kbExpr:EditorContextKeys.hoverFocused,primary:18,weight:100}})}run(C,W){const V=ModesHoverController.get(W);V&&V.scrollDown()}}class ScrollLeftHoverAction extends EditorAction{constructor(){super({id:"editor.action.scrollLeftHover",label:localize({key:"scrollLeftHover",comment:["Action that allows to scroll left in the hover widget with the left arrow when the hover widget is focused."]},"Scroll Left Hover"),alias:"Scroll Left Hover",precondition:EditorContextKeys.hoverFocused,kbOpts:{kbExpr:EditorContextKeys.hoverFocused,primary:15,weight:100}})}run(C,W){const V=ModesHoverController.get(W);V&&V.scrollLeft()}}class ScrollRightHoverAction extends EditorAction{constructor(){super({id:"editor.action.scrollRightHover",label:localize({key:"scrollRightHover",comment:["Action that allows to scroll right in the hover widget with the right arrow when the hover widget is focused."]},"Scroll Right Hover"),alias:"Scroll Right Hover",precondition:EditorContextKeys.hoverFocused,kbOpts:{kbExpr:EditorContextKeys.hoverFocused,primary:17,weight:100}})}run(C,W){const V=ModesHoverController.get(W);V&&V.scrollRight()}}class PageUpHoverAction extends EditorAction{constructor(){super({id:"editor.action.pageUpHover",label:localize({key:"pageUpHover",comment:["Action that allows to page up in the hover widget with the page up command when the hover widget is focused."]},"Page Up Hover"),alias:"Page Up Hover",precondition:EditorContextKeys.hoverFocused,kbOpts:{kbExpr:EditorContextKeys.hoverFocused,primary:11,secondary:[528],weight:100}})}run(C,W){const V=ModesHoverController.get(W);V&&V.pageUp()}}class PageDownHoverAction extends EditorAction{constructor(){super({id:"editor.action.pageDownHover",label:localize({key:"pageDownHover",comment:["Action that allows to page down in the hover widget with the page down command when the hover widget is focused."]},"Page Down Hover"),alias:"Page Down Hover",precondition:EditorContextKeys.hoverFocused,kbOpts:{kbExpr:EditorContextKeys.hoverFocused,primary:12,secondary:[530],weight:100}})}run(C,W){const V=ModesHoverController.get(W);V&&V.pageDown()}}class GoToTopHoverAction extends EditorAction{constructor(){super({id:"editor.action.goToTopHover",label:localize({key:"goToTopHover",comment:["Action that allows to go to the top of the hover widget with the home command when the hover widget is focused."]},"Go To Top Hover"),alias:"Go To Bottom Hover",precondition:EditorContextKeys.hoverFocused,kbOpts:{kbExpr:EditorContextKeys.hoverFocused,primary:14,secondary:[2064],weight:100}})}run(C,W){const V=ModesHoverController.get(W);V&&V.goToTop()}}class GoToBottomHoverAction extends EditorAction{constructor(){super({id:"editor.action.goToBottomHover",label:localize({key:"goToBottomHover",comment:["Action that allows to go to the bottom in the hover widget with the end command when the hover widget is focused."]},"Go To Bottom Hover"),alias:"Go To Bottom Hover",precondition:EditorContextKeys.hoverFocused,kbOpts:{kbExpr:EditorContextKeys.hoverFocused,primary:13,secondary:[2066],weight:100}})}run(C,W){const V=ModesHoverController.get(W);V&&V.goToBottom()}}registerEditorContribution(ModesHoverController.ID,ModesHoverController,2);registerEditorAction(ShowOrFocusHoverAction);registerEditorAction(ShowDefinitionPreviewHoverAction);registerEditorAction(ScrollUpHoverAction);registerEditorAction(ScrollDownHoverAction);registerEditorAction(ScrollLeftHoverAction);registerEditorAction(ScrollRightHoverAction);registerEditorAction(PageUpHoverAction);registerEditorAction(PageDownHoverAction);registerEditorAction(GoToTopHoverAction);registerEditorAction(GoToBottomHoverAction);HoverParticipantRegistry.register(MarkdownHoverParticipant);HoverParticipantRegistry.register(MarkerHoverParticipant);registerThemingParticipant((K,C)=>{const W=K.getColor(editorHoverBorder);W&&(C.addRule(`.monaco-editor .monaco-hover .hover-row:not(:first-child):not(:empty) { border-top: 1px solid ${W.transparent(.5)}; }`),C.addRule(`.monaco-editor .monaco-hover hr { border-top: 1px solid ${W.transparent(.5)}; }`),C.addRule(`.monaco-editor .monaco-hover hr { border-bottom: 0px solid ${W.transparent(.5)}; }`))});class ColorContribution extends Disposable{constructor(C){super(),this._editor=C,this._register(C.onMouseDown(W=>this.onMouseDown(W)))}dispose(){super.dispose()}onMouseDown(C){const W=this._editor.getOption(146);if(W!=="click"&&W!=="clickAndHover")return;const V=C.target;if(V.type!==6||!V.detail.injectedText||V.detail.injectedText.options.attachedData!==ColorDecorationInjectedTextMarker||!V.range)return;const U=this._editor.getContribution(ModesHoverController.ID);if(U&&!U.isColorPickerVisible){const G=new Range$2(V.range.startLineNumber,V.range.startColumn+1,V.range.endLineNumber,V.range.endColumn+1);U.showContentHover(G,1,0,!1,!0)}}}ColorContribution.ID="editor.contrib.colorContribution";registerEditorContribution(ColorContribution.ID,ColorContribution,2);HoverParticipantRegistry.register(ColorHoverParticipant);var __decorate$Y=globalThis&&globalThis.__decorate||function(K,C,W,V){var U=arguments.length,G=U<3?C:V===null?V=Object.getOwnPropertyDescriptor(C,W):V,Z;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")G=Reflect.decorate(K,C,W,V);else for(var X=K.length-1;X>=0;X--)(Z=K[X])&&(G=(U<3?Z(G):U>3?Z(C,W,G):Z(C,W))||G);return U>3&&G&&Object.defineProperty(C,W,G),G},__param$Y=globalThis&&globalThis.__param||function(K,C){return function(W,V){C(W,V,K)}},__awaiter$K=globalThis&&globalThis.__awaiter||function(K,C,W,V){function U(G){return G instanceof W?G:new W(function(Z){Z(G)})}return new(W||(W=Promise))(function(G,Z){function X(ee){try{J(V.next(ee))}catch(te){Z(te)}}function Q(ee){try{J(V.throw(ee))}catch(te){Z(te)}}function J(ee){ee.done?G(ee.value):U(ee.value).then(X,Q)}J((V=V.apply(K,C||[])).next())})},StandaloneColorPickerController_1,StandaloneColorPickerWidget_1;let StandaloneColorPickerController=StandaloneColorPickerController_1=class extends Disposable{constructor(C,W,V,U,G,Z,X){super(),this._editor=C,this._modelService=V,this._keybindingService=U,this._instantiationService=G,this._languageFeatureService=Z,this._languageConfigurationService=X,this._standaloneColorPickerWidget=null,this._standaloneColorPickerVisible=EditorContextKeys.standaloneColorPickerVisible.bindTo(W),this._standaloneColorPickerFocused=EditorContextKeys.standaloneColorPickerFocused.bindTo(W)}showOrFocus(){var C;this._editor.hasModel()&&(this._standaloneColorPickerVisible.get()?this._standaloneColorPickerFocused.get()||(C=this._standaloneColorPickerWidget)===null||C===void 0||C.focus():this._standaloneColorPickerWidget=new StandaloneColorPickerWidget(this._editor,this._standaloneColorPickerVisible,this._standaloneColorPickerFocused,this._instantiationService,this._modelService,this._keybindingService,this._languageFeatureService,this._languageConfigurationService))}hide(){var C;this._standaloneColorPickerFocused.set(!1),this._standaloneColorPickerVisible.set(!1),(C=this._standaloneColorPickerWidget)===null||C===void 0||C.hide(),this._editor.focus()}insertColor(){var C;(C=this._standaloneColorPickerWidget)===null||C===void 0||C.updateEditor(),this.hide()}static get(C){return C.getContribution(StandaloneColorPickerController_1.ID)}};StandaloneColorPickerController.ID="editor.contrib.standaloneColorPickerController";StandaloneColorPickerController=StandaloneColorPickerController_1=__decorate$Y([__param$Y(1,IContextKeyService),__param$Y(2,IModelService),__param$Y(3,IKeybindingService),__param$Y(4,IInstantiationService),__param$Y(5,ILanguageFeaturesService),__param$Y(6,ILanguageConfigurationService)],StandaloneColorPickerController);registerEditorContribution(StandaloneColorPickerController.ID,StandaloneColorPickerController,1);const PADDING=8,CLOSE_BUTTON_WIDTH=22;let StandaloneColorPickerWidget=StandaloneColorPickerWidget_1=class extends Disposable{constructor(C,W,V,U,G,Z,X,Q){var J;super(),this._editor=C,this._standaloneColorPickerVisible=W,this._standaloneColorPickerFocused=V,this._modelService=G,this._keybindingService=Z,this._languageFeaturesService=X,this._languageConfigurationService=Q,this.allowEditorOverflow=!0,this._position=void 0,this._body=document.createElement("div"),this._colorHover=null,this._selectionSetInEditor=!1,this._onResult=this._register(new Emitter$1),this.onResult=this._onResult.event,this._standaloneColorPickerVisible.set(!0),this._standaloneColorPickerParticipant=U.createInstance(StandaloneColorPickerParticipant,this._editor),this._position=(J=this._editor._getViewModel())===null||J===void 0?void 0:J.getPrimaryCursorState().modelState.position;const ee=this._editor.getSelection(),te=ee?{startLineNumber:ee.startLineNumber,startColumn:ee.startColumn,endLineNumber:ee.endLineNumber,endColumn:ee.endColumn}:{startLineNumber:0,endLineNumber:0,endColumn:0,startColumn:0},ie=this._register(trackFocus(this._body));this._register(ie.onDidBlur(ne=>{this.hide()})),this._register(ie.onDidFocus(ne=>{this.focus()})),this._register(this._editor.onDidChangeCursorPosition(()=>{this._selectionSetInEditor?this._selectionSetInEditor=!1:this.hide()})),this._register(this._editor.onMouseMove(ne=>{var oe;const re=(oe=ne.target.element)===null||oe===void 0?void 0:oe.classList;re&&re.contains("colorpicker-color-decoration")&&this.hide()})),this._register(this.onResult(ne=>{this._render(ne.value,ne.foundInEditor)})),this._start(te),this._body.style.zIndex="50",this._editor.addContentWidget(this)}updateEditor(){this._colorHover&&this._standaloneColorPickerParticipant.updateEditorModel(this._colorHover)}getId(){return StandaloneColorPickerWidget_1.ID}getDomNode(){return this._body}getPosition(){if(!this._position)return null;const C=this._editor.getOption(60).above;return{position:this._position,secondaryPosition:this._position,preference:C?[1,2]:[2,1],positionAffinity:2}}hide(){this.dispose(),this._standaloneColorPickerVisible.set(!1),this._standaloneColorPickerFocused.set(!1),this._editor.removeContentWidget(this),this._editor.focus()}focus(){this._standaloneColorPickerFocused.set(!0),this._body.focus()}_start(C){return __awaiter$K(this,void 0,void 0,function*(){const W=yield this._computeAsync(C);W&&this._onResult.fire(new StandaloneColorPickerResult(W.result,W.foundInEditor))})}_computeAsync(C){return __awaiter$K(this,void 0,void 0,function*(){if(!this._editor.hasModel())return null;const W={range:C,color:{red:0,green:0,blue:0,alpha:1}},V=yield this._standaloneColorPickerParticipant.createColorHover(W,new DefaultDocumentColorProvider(this._modelService,this._languageConfigurationService),this._languageFeaturesService.colorProvider);return V?{result:V.colorHover,foundInEditor:V.foundInEditor}:null})}_render(C,W){const V=document.createDocumentFragment(),U=this._register(new EditorHoverStatusBar(this._keybindingService));let G;const Z={fragment:V,statusBar:U,setColorPicker:re=>G=re,onContentsChanged:()=>{},hide:()=>this.hide()};if(this._colorHover=C,this._register(this._standaloneColorPickerParticipant.renderHoverParts(Z,[C])),G===void 0)return;this._body.classList.add("standalone-colorpicker-body"),this._body.style.maxHeight=Math.max(this._editor.getLayoutInfo().height/4,250)+"px",this._body.style.maxWidth=Math.max(this._editor.getLayoutInfo().width*.66,500)+"px",this._body.tabIndex=0,this._body.appendChild(V),G.layout();const X=G.body,Q=X.saturationBox.domNode.clientWidth,J=X.domNode.clientWidth-Q-CLOSE_BUTTON_WIDTH-PADDING,ee=G.body.enterButton;ee==null||ee.onClicked(()=>{this.updateEditor(),this.hide()});const te=G.header,ie=te.pickedColorNode;ie.style.width=Q+PADDING+"px";const ne=te.originalColorNode;ne.style.width=J+"px";const oe=G.header.closeButton;oe==null||oe.onClicked(()=>{this.hide()}),W&&(ee&&(ee.button.textContent="Replace"),this._selectionSetInEditor=!0,this._editor.setSelection(C.range)),this._editor.layoutContentWidget(this)}};StandaloneColorPickerWidget.ID="editor.contrib.standaloneColorPickerWidget";StandaloneColorPickerWidget=StandaloneColorPickerWidget_1=__decorate$Y([__param$Y(3,IInstantiationService),__param$Y(4,IModelService),__param$Y(5,IKeybindingService),__param$Y(6,ILanguageFeaturesService),__param$Y(7,ILanguageConfigurationService)],StandaloneColorPickerWidget);class StandaloneColorPickerResult{constructor(C,W){this.value=C,this.foundInEditor=W}}class ShowOrFocusStandaloneColorPicker extends EditorAction2{constructor(){super({id:"editor.action.showOrFocusStandaloneColorPicker",title:{value:localize("showOrFocusStandaloneColorPicker","Show or Focus Standalone Color Picker"),mnemonicTitle:localize({key:"mishowOrFocusStandaloneColorPicker",comment:["&& denotes a mnemonic"]},"&&Show or Focus Standalone Color Picker"),original:"Show or Focus Standalone Color Picker"},precondition:void 0,menu:[{id:MenuId.CommandPalette}]})}runEditorCommand(C,W){var V;(V=StandaloneColorPickerController.get(W))===null||V===void 0||V.showOrFocus()}}class HideStandaloneColorPicker extends EditorAction{constructor(){super({id:"editor.action.hideColorPicker",label:localize({key:"hideColorPicker",comment:["Action that hides the color picker"]},"Hide the Color Picker"),alias:"Hide the Color Picker",precondition:EditorContextKeys.standaloneColorPickerVisible.isEqualTo(!0),kbOpts:{primary:9,weight:100}})}run(C,W){var V;(V=StandaloneColorPickerController.get(W))===null||V===void 0||V.hide()}}class InsertColorWithStandaloneColorPicker extends EditorAction{constructor(){super({id:"editor.action.insertColorWithStandaloneColorPicker",label:localize({key:"insertColorWithStandaloneColorPicker",comment:["Action that inserts color with standalone color picker"]},"Insert Color with Standalone Color Picker"),alias:"Insert Color with Standalone Color Picker",precondition:EditorContextKeys.standaloneColorPickerFocused.isEqualTo(!0),kbOpts:{primary:3,weight:100}})}run(C,W){var V;(V=StandaloneColorPickerController.get(W))===null||V===void 0||V.insertColor()}}registerEditorAction(HideStandaloneColorPicker);registerEditorAction(InsertColorWithStandaloneColorPicker);registerAction2(ShowOrFocusStandaloneColorPicker);class BlockCommentCommand{constructor(C,W,V){this.languageConfigurationService=V,this._selection=C,this._insertSpace=W,this._usedEndToken=null}static _haystackHasNeedleAtOffset(C,W,V){if(V<0)return!1;const U=W.length,G=C.length;if(V+U>G)return!1;for(let Z=0;Z<U;Z++){const X=C.charCodeAt(V+Z),Q=W.charCodeAt(Z);if(X!==Q&&!(X>=65&&X<=90&&X+32===Q)&&!(Q>=65&&Q<=90&&Q+32===X))return!1}return!0}_createOperationsForBlockComment(C,W,V,U,G,Z){const X=C.startLineNumber,Q=C.startColumn,J=C.endLineNumber,ee=C.endColumn,te=G.getLineContent(X),ie=G.getLineContent(J);let ne=te.lastIndexOf(W,Q-1+W.length),oe=ie.indexOf(V,ee-1-V.length);if(ne!==-1&&oe!==-1)if(X===J)te.substring(ne+W.length,oe).indexOf(V)>=0&&(ne=-1,oe=-1);else{const ae=te.substring(ne+W.length),se=ie.substring(0,oe);(ae.indexOf(V)>=0||se.indexOf(V)>=0)&&(ne=-1,oe=-1)}let re;ne!==-1&&oe!==-1?(U&&ne+W.length<te.length&&te.charCodeAt(ne+W.length)===32&&(W=W+" "),U&&oe>0&&ie.charCodeAt(oe-1)===32&&(V=" "+V,oe-=1),re=BlockCommentCommand._createRemoveBlockCommentOperations(new Range$2(X,ne+W.length+1,J,oe+1),W,V)):(re=BlockCommentCommand._createAddBlockCommentOperations(C,W,V,this._insertSpace),this._usedEndToken=re.length===1?V:null);for(const ae of re)Z.addTrackedEditOperation(ae.range,ae.text)}static _createRemoveBlockCommentOperations(C,W,V){const U=[];return Range$2.isEmpty(C)?U.push(EditOperation.delete(new Range$2(C.startLineNumber,C.startColumn-W.length,C.endLineNumber,C.endColumn+V.length))):(U.push(EditOperation.delete(new Range$2(C.startLineNumber,C.startColumn-W.length,C.startLineNumber,C.startColumn))),U.push(EditOperation.delete(new Range$2(C.endLineNumber,C.endColumn,C.endLineNumber,C.endColumn+V.length)))),U}static _createAddBlockCommentOperations(C,W,V,U){const G=[];return Range$2.isEmpty(C)?G.push(EditOperation.replace(new Range$2(C.startLineNumber,C.startColumn,C.endLineNumber,C.endColumn),W+"  "+V)):(G.push(EditOperation.insert(new Position$1(C.startLineNumber,C.startColumn),W+(U?" ":""))),G.push(EditOperation.insert(new Position$1(C.endLineNumber,C.endColumn),(U?" ":"")+V))),G}getEditOperations(C,W){const V=this._selection.startLineNumber,U=this._selection.startColumn;C.tokenization.tokenizeIfCheap(V);const G=C.getLanguageIdAtPosition(V,U),Z=this.languageConfigurationService.getLanguageConfiguration(G).comments;!Z||!Z.blockCommentStartToken||!Z.blockCommentEndToken||this._createOperationsForBlockComment(this._selection,Z.blockCommentStartToken,Z.blockCommentEndToken,this._insertSpace,C,W)}computeCursorState(C,W){const V=W.getInverseEditOperations();if(V.length===2){const U=V[0],G=V[1];return new Selection$1(U.range.endLineNumber,U.range.endColumn,G.range.startLineNumber,G.range.startColumn)}else{const U=V[0].range,G=this._usedEndToken?-this._usedEndToken.length-1:0;return new Selection$1(U.endLineNumber,U.endColumn+G,U.endLineNumber,U.endColumn+G)}}}class LineCommentCommand{constructor(C,W,V,U,G,Z,X){this.languageConfigurationService=C,this._selection=W,this._tabSize=V,this._type=U,this._insertSpace=G,this._selectionId=null,this._deltaColumn=0,this._moveEndPositionDown=!1,this._ignoreEmptyLines=Z,this._ignoreFirstLine=X||!1}static _gatherPreflightCommentStrings(C,W,V,U){C.tokenization.tokenizeIfCheap(W);const G=C.getLanguageIdAtPosition(W,1),Z=U.getLanguageConfiguration(G).comments,X=Z?Z.lineCommentToken:null;if(!X)return null;const Q=[];for(let J=0,ee=V-W+1;J<ee;J++)Q[J]={ignore:!1,commentStr:X,commentStrOffset:0,commentStrLength:X.length};return Q}static _analyzeLines(C,W,V,U,G,Z,X,Q){let J=!0,ee;C===0?ee=!0:C===1?ee=!1:ee=!0;for(let te=0,ie=U.length;te<ie;te++){const ne=U[te],oe=G+te;if(oe===G&&X){ne.ignore=!0;continue}const re=V.getLineContent(oe),ae=firstNonWhitespaceIndex(re);if(ae===-1){ne.ignore=Z,ne.commentStrOffset=re.length;continue}if(J=!1,ne.ignore=!1,ne.commentStrOffset=ae,ee&&!BlockCommentCommand._haystackHasNeedleAtOffset(re,ne.commentStr,ae)&&(C===0?ee=!1:C===1||(ne.ignore=!0)),ee&&W){const se=ae+ne.commentStrLength;se<re.length&&re.charCodeAt(se)===32&&(ne.commentStrLength+=1)}}if(C===0&&J){ee=!1;for(let te=0,ie=U.length;te<ie;te++)U[te].ignore=!1}return{supported:!0,shouldRemoveComments:ee,lines:U}}static _gatherPreflightData(C,W,V,U,G,Z,X,Q){const J=LineCommentCommand._gatherPreflightCommentStrings(V,U,G,Q);return J===null?{supported:!1}:LineCommentCommand._analyzeLines(C,W,V,J,U,Z,X,Q)}_executeLineComments(C,W,V,U){let G;V.shouldRemoveComments?G=LineCommentCommand._createRemoveLineCommentsOperations(V.lines,U.startLineNumber):(LineCommentCommand._normalizeInsertionPoint(C,V.lines,U.startLineNumber,this._tabSize),G=this._createAddLineCommentsOperations(V.lines,U.startLineNumber));const Z=new Position$1(U.positionLineNumber,U.positionColumn);for(let X=0,Q=G.length;X<Q;X++)W.addEditOperation(G[X].range,G[X].text),Range$2.isEmpty(G[X].range)&&Range$2.getStartPosition(G[X].range).equals(Z)&&C.getLineContent(Z.lineNumber).length+1===Z.column&&(this._deltaColumn=(G[X].text||"").length);this._selectionId=W.trackSelection(U)}_attemptRemoveBlockComment(C,W,V,U){let G=W.startLineNumber,Z=W.endLineNumber;const X=U.length+Math.max(C.getLineFirstNonWhitespaceColumn(W.startLineNumber),W.startColumn);let Q=C.getLineContent(G).lastIndexOf(V,X-1),J=C.getLineContent(Z).indexOf(U,W.endColumn-1-V.length);return Q!==-1&&J===-1&&(J=C.getLineContent(G).indexOf(U,Q+V.length),Z=G),Q===-1&&J!==-1&&(Q=C.getLineContent(Z).lastIndexOf(V,J),G=Z),W.isEmpty()&&(Q===-1||J===-1)&&(Q=C.getLineContent(G).indexOf(V),Q!==-1&&(J=C.getLineContent(G).indexOf(U,Q+V.length))),Q!==-1&&C.getLineContent(G).charCodeAt(Q+V.length)===32&&(V+=" "),J!==-1&&C.getLineContent(Z).charCodeAt(J-1)===32&&(U=" "+U,J-=1),Q!==-1&&J!==-1?BlockCommentCommand._createRemoveBlockCommentOperations(new Range$2(G,Q+V.length+1,Z,J+1),V,U):null}_executeBlockComment(C,W,V){C.tokenization.tokenizeIfCheap(V.startLineNumber);const U=C.getLanguageIdAtPosition(V.startLineNumber,1),G=this.languageConfigurationService.getLanguageConfiguration(U).comments;if(!G||!G.blockCommentStartToken||!G.blockCommentEndToken)return;const Z=G.blockCommentStartToken,X=G.blockCommentEndToken;let Q=this._attemptRemoveBlockComment(C,V,Z,X);if(!Q){if(V.isEmpty()){const J=C.getLineContent(V.startLineNumber);let ee=firstNonWhitespaceIndex(J);ee===-1&&(ee=J.length),Q=BlockCommentCommand._createAddBlockCommentOperations(new Range$2(V.startLineNumber,ee+1,V.startLineNumber,J.length+1),Z,X,this._insertSpace)}else Q=BlockCommentCommand._createAddBlockCommentOperations(new Range$2(V.startLineNumber,C.getLineFirstNonWhitespaceColumn(V.startLineNumber),V.endLineNumber,C.getLineMaxColumn(V.endLineNumber)),Z,X,this._insertSpace);Q.length===1&&(this._deltaColumn=Z.length+1)}this._selectionId=W.trackSelection(V);for(const J of Q)W.addEditOperation(J.range,J.text)}getEditOperations(C,W){let V=this._selection;if(this._moveEndPositionDown=!1,V.startLineNumber===V.endLineNumber&&this._ignoreFirstLine){W.addEditOperation(new Range$2(V.startLineNumber,C.getLineMaxColumn(V.startLineNumber),V.startLineNumber+1,1),V.startLineNumber===C.getLineCount()?"":`
`),this._selectionId=W.trackSelection(V);return}V.startLineNumber<V.endLineNumber&&V.endColumn===1&&(this._moveEndPositionDown=!0,V=V.setEndPosition(V.endLineNumber-1,C.getLineMaxColumn(V.endLineNumber-1)));const U=LineCommentCommand._gatherPreflightData(this._type,this._insertSpace,C,V.startLineNumber,V.endLineNumber,this._ignoreEmptyLines,this._ignoreFirstLine,this.languageConfigurationService);return U.supported?this._executeLineComments(C,W,U,V):this._executeBlockComment(C,W,V)}computeCursorState(C,W){let V=W.getTrackedSelection(this._selectionId);return this._moveEndPositionDown&&(V=V.setEndPosition(V.endLineNumber+1,1)),new Selection$1(V.selectionStartLineNumber,V.selectionStartColumn+this._deltaColumn,V.positionLineNumber,V.positionColumn+this._deltaColumn)}static _createRemoveLineCommentsOperations(C,W){const V=[];for(let U=0,G=C.length;U<G;U++){const Z=C[U];Z.ignore||V.push(EditOperation.delete(new Range$2(W+U,Z.commentStrOffset+1,W+U,Z.commentStrOffset+Z.commentStrLength+1)))}return V}_createAddLineCommentsOperations(C,W){const V=[],U=this._insertSpace?" ":"";for(let G=0,Z=C.length;G<Z;G++){const X=C[G];X.ignore||V.push(EditOperation.insert(new Position$1(W+G,X.commentStrOffset+1),X.commentStr+U))}return V}static nextVisibleColumn(C,W,V,U){return V?C+(W-C%W):C+U}static _normalizeInsertionPoint(C,W,V,U){let G=1073741824,Z,X;for(let Q=0,J=W.length;Q<J;Q++){if(W[Q].ignore)continue;const ee=C.getLineContent(V+Q);let te=0;for(let ie=0,ne=W[Q].commentStrOffset;te<G&&ie<ne;ie++)te=LineCommentCommand.nextVisibleColumn(te,U,ee.charCodeAt(ie)===9,1);te<G&&(G=te)}G=Math.floor(G/U)*U;for(let Q=0,J=W.length;Q<J;Q++){if(W[Q].ignore)continue;const ee=C.getLineContent(V+Q);let te=0;for(Z=0,X=W[Q].commentStrOffset;te<G&&Z<X;Z++)te=LineCommentCommand.nextVisibleColumn(te,U,ee.charCodeAt(Z)===9,1);te>G?W[Q].commentStrOffset=Z-1:W[Q].commentStrOffset=Z}}}class CommentLineAction extends EditorAction{constructor(C,W){super(W),this._type=C}run(C,W){const V=C.get(ILanguageConfigurationService);if(!W.hasModel())return;const U=W.getModel(),G=[],Z=U.getOptions(),X=W.getOption(23),Q=W.getSelections().map((ee,te)=>({selection:ee,index:te,ignoreFirstLine:!1}));Q.sort((ee,te)=>Range$2.compareRangesUsingStarts(ee.selection,te.selection));let J=Q[0];for(let ee=1;ee<Q.length;ee++){const te=Q[ee];J.selection.endLineNumber===te.selection.startLineNumber&&(J.index<te.index?te.ignoreFirstLine=!0:(J.ignoreFirstLine=!0,J=te))}for(const ee of Q)G.push(new LineCommentCommand(V,ee.selection,Z.tabSize,this._type,X.insertSpace,X.ignoreEmptyLines,ee.ignoreFirstLine));W.pushUndoStop(),W.executeCommands(this.id,G),W.pushUndoStop()}}class ToggleCommentLineAction extends CommentLineAction{constructor(){super(0,{id:"editor.action.commentLine",label:localize("comment.line","Toggle Line Comment"),alias:"Toggle Line Comment",precondition:EditorContextKeys.writable,kbOpts:{kbExpr:EditorContextKeys.editorTextFocus,primary:2138,weight:100},menuOpts:{menuId:MenuId.MenubarEditMenu,group:"5_insert",title:localize({key:"miToggleLineComment",comment:["&& denotes a mnemonic"]},"&&Toggle Line Comment"),order:1}})}}class AddLineCommentAction extends CommentLineAction{constructor(){super(1,{id:"editor.action.addCommentLine",label:localize("comment.line.add","Add Line Comment"),alias:"Add Line Comment",precondition:EditorContextKeys.writable,kbOpts:{kbExpr:EditorContextKeys.editorTextFocus,primary:KeyChord(2089,2081),weight:100}})}}class RemoveLineCommentAction extends CommentLineAction{constructor(){super(2,{id:"editor.action.removeCommentLine",label:localize("comment.line.remove","Remove Line Comment"),alias:"Remove Line Comment",precondition:EditorContextKeys.writable,kbOpts:{kbExpr:EditorContextKeys.editorTextFocus,primary:KeyChord(2089,2099),weight:100}})}}class BlockCommentAction extends EditorAction{constructor(){super({id:"editor.action.blockComment",label:localize("comment.block","Toggle Block Comment"),alias:"Toggle Block Comment",precondition:EditorContextKeys.writable,kbOpts:{kbExpr:EditorContextKeys.editorTextFocus,primary:1567,linux:{primary:3103},weight:100},menuOpts:{menuId:MenuId.MenubarEditMenu,group:"5_insert",title:localize({key:"miToggleBlockComment",comment:["&& denotes a mnemonic"]},"Toggle &&Block Comment"),order:2}})}run(C,W){const V=C.get(ILanguageConfigurationService);if(!W.hasModel())return;const U=W.getOption(23),G=[],Z=W.getSelections();for(const X of Z)G.push(new BlockCommentCommand(X,U.insertSpace,V));W.pushUndoStop(),W.executeCommands(this.id,G),W.pushUndoStop()}}registerEditorAction(ToggleCommentLineAction);registerEditorAction(AddLineCommentAction);registerEditorAction(RemoveLineCommentAction);registerEditorAction(BlockCommentAction);var __decorate$X=globalThis&&globalThis.__decorate||function(K,C,W,V){var U=arguments.length,G=U<3?C:V===null?V=Object.getOwnPropertyDescriptor(C,W):V,Z;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")G=Reflect.decorate(K,C,W,V);else for(var X=K.length-1;X>=0;X--)(Z=K[X])&&(G=(U<3?Z(G):U>3?Z(C,W,G):Z(C,W))||G);return U>3&&G&&Object.defineProperty(C,W,G),G},__param$X=globalThis&&globalThis.__param||function(K,C){return function(W,V){C(W,V,K)}},ContextMenuController_1;let ContextMenuController=ContextMenuController_1=class{static get(C){return C.getContribution(ContextMenuController_1.ID)}constructor(C,W,V,U,G,Z,X,Q){this._contextMenuService=W,this._contextViewService=V,this._contextKeyService=U,this._keybindingService=G,this._menuService=Z,this._configurationService=X,this._workspaceContextService=Q,this._toDispose=new DisposableStore,this._contextMenuIsBeingShownCount=0,this._editor=C,this._toDispose.add(this._editor.onContextMenu(J=>this._onContextMenu(J))),this._toDispose.add(this._editor.onMouseWheel(J=>{if(this._contextMenuIsBeingShownCount>0){const ee=this._contextViewService.getContextViewElement(),te=J.srcElement;te.shadowRoot&&getShadowRoot(ee)===te.shadowRoot||this._contextViewService.hideContextView()}})),this._toDispose.add(this._editor.onKeyDown(J=>{this._editor.getOption(24)&&J.keyCode===58&&(J.preventDefault(),J.stopPropagation(),this.showContextMenu())}))}_onContextMenu(C){if(!this._editor.hasModel())return;if(!this._editor.getOption(24)){this._editor.focus(),C.target.position&&!this._editor.getSelection().containsPosition(C.target.position)&&this._editor.setPosition(C.target.position);return}if(C.target.type===12||C.target.type===6&&C.target.detail.injectedText)return;if(C.event.preventDefault(),C.event.stopPropagation(),C.target.type===11)return this._showScrollbarContextMenu(C.event);if(C.target.type!==6&&C.target.type!==7&&C.target.type!==1)return;if(this._editor.focus(),C.target.position){let V=!1;for(const U of this._editor.getSelections())if(U.containsPosition(C.target.position)){V=!0;break}V||this._editor.setPosition(C.target.position)}let W=null;C.target.type!==1&&(W=C.event),this.showContextMenu(W)}showContextMenu(C){if(!this._editor.getOption(24)||!this._editor.hasModel())return;const W=this._getMenuActions(this._editor.getModel(),this._editor.isSimpleWidget?MenuId.SimpleEditorContext:MenuId.EditorContext);W.length>0&&this._doShowContextMenu(W,C)}_getMenuActions(C,W){const V=[],U=this._menuService.createMenu(W,this._contextKeyService),G=U.getActions({arg:C.uri});U.dispose();for(const Z of G){const[,X]=Z;let Q=0;for(const J of X)if(J instanceof SubmenuItemAction){const ee=this._getMenuActions(C,J.item.submenu);ee.length>0&&(V.push(new SubmenuAction(J.id,J.label,ee)),Q++)}else V.push(J),Q++;Q&&V.push(new Separator)}return V.length&&V.pop(),V}_doShowContextMenu(C,W=null){if(!this._editor.hasModel())return;const V=this._editor.getOption(60);this._editor.updateOptions({hover:{enabled:!1}});let U=W;if(!U){this._editor.revealPosition(this._editor.getPosition(),1),this._editor.render();const Z=this._editor.getScrolledVisiblePosition(this._editor.getPosition()),X=getDomNodePagePosition(this._editor.getDomNode()),Q=X.left+Z.left,J=X.top+Z.top+Z.height;U={x:Q,y:J}}const G=this._editor.getOption(126)&&!isIOS;this._contextMenuIsBeingShownCount++,this._contextMenuService.showContextMenu({domForShadowRoot:G?this._editor.getDomNode():void 0,getAnchor:()=>U,getActions:()=>C,getActionViewItem:Z=>{const X=this._keybindingFor(Z);if(X)return new ActionViewItem(Z,Z,{label:!0,keybinding:X.getLabel(),isMenu:!0});const Q=Z;return typeof Q.getActionViewItem=="function"?Q.getActionViewItem():new ActionViewItem(Z,Z,{icon:!0,label:!0,isMenu:!0})},getKeyBinding:Z=>this._keybindingFor(Z),onHide:Z=>{this._contextMenuIsBeingShownCount--,this._editor.updateOptions({hover:V})}})}_showScrollbarContextMenu(C){if(!this._editor.hasModel()||isStandaloneEditorWorkspace(this._workspaceContextService.getWorkspace()))return;const W=this._editor.getOption(72);let V=0;const U=J=>({id:`menu-action-${++V}`,label:J.label,tooltip:"",class:void 0,enabled:typeof J.enabled>"u"?!0:J.enabled,checked:J.checked,run:J.run}),G=(J,ee)=>new SubmenuAction(`menu-action-${++V}`,J,ee,void 0),Z=(J,ee,te,ie,ne)=>{if(!ee)return U({label:J,enabled:ee,run:()=>{}});const oe=ae=>()=>{this._configurationService.updateValue(te,ae)},re=[];for(const ae of ne)re.push(U({label:ae.label,checked:ie===ae.value,run:oe(ae.value)}));return G(J,re)},X=[];X.push(U({label:localize("context.minimap.minimap","Minimap"),checked:W.enabled,run:()=>{this._configurationService.updateValue("editor.minimap.enabled",!W.enabled)}})),X.push(new Separator),X.push(U({label:localize("context.minimap.renderCharacters","Render Characters"),enabled:W.enabled,checked:W.renderCharacters,run:()=>{this._configurationService.updateValue("editor.minimap.renderCharacters",!W.renderCharacters)}})),X.push(Z(localize("context.minimap.size","Vertical size"),W.enabled,"editor.minimap.size",W.size,[{label:localize("context.minimap.size.proportional","Proportional"),value:"proportional"},{label:localize("context.minimap.size.fill","Fill"),value:"fill"},{label:localize("context.minimap.size.fit","Fit"),value:"fit"}])),X.push(Z(localize("context.minimap.slider","Slider"),W.enabled,"editor.minimap.showSlider",W.showSlider,[{label:localize("context.minimap.slider.mouseover","Mouse Over"),value:"mouseover"},{label:localize("context.minimap.slider.always","Always"),value:"always"}]));const Q=this._editor.getOption(126)&&!isIOS;this._contextMenuIsBeingShownCount++,this._contextMenuService.showContextMenu({domForShadowRoot:Q?this._editor.getDomNode():void 0,getAnchor:()=>C,getActions:()=>X,onHide:J=>{this._contextMenuIsBeingShownCount--,this._editor.focus()}})}_keybindingFor(C){return this._keybindingService.lookupKeybinding(C.id)}dispose(){this._contextMenuIsBeingShownCount>0&&this._contextViewService.hideContextView(),this._toDispose.dispose()}};ContextMenuController.ID="editor.contrib.contextmenu";ContextMenuController=ContextMenuController_1=__decorate$X([__param$X(1,IContextMenuService),__param$X(2,IContextViewService),__param$X(3,IContextKeyService),__param$X(4,IKeybindingService),__param$X(5,IMenuService),__param$X(6,IConfigurationService),__param$X(7,IWorkspaceContextService)],ContextMenuController);class ShowContextMenu extends EditorAction{constructor(){super({id:"editor.action.showContextMenu",label:localize("action.showContextMenu.label","Show Editor Context Menu"),alias:"Show Editor Context Menu",precondition:void 0,kbOpts:{kbExpr:EditorContextKeys.textInputFocus,primary:1092,weight:100}})}run(C,W){var V;(V=ContextMenuController.get(W))===null||V===void 0||V.showContextMenu()}}registerEditorContribution(ContextMenuController.ID,ContextMenuController,2);registerEditorAction(ShowContextMenu);class CursorState{constructor(C){this.selections=C}equals(C){const W=this.selections.length,V=C.selections.length;if(W!==V)return!1;for(let U=0;U<W;U++)if(!this.selections[U].equalsSelection(C.selections[U]))return!1;return!0}}class StackElement{constructor(C,W,V){this.cursorState=C,this.scrollTop=W,this.scrollLeft=V}}class CursorUndoRedoController extends Disposable{static get(C){return C.getContribution(CursorUndoRedoController.ID)}constructor(C){super(),this._editor=C,this._isCursorUndoRedo=!1,this._undoStack=[],this._redoStack=[],this._register(C.onDidChangeModel(W=>{this._undoStack=[],this._redoStack=[]})),this._register(C.onDidChangeModelContent(W=>{this._undoStack=[],this._redoStack=[]})),this._register(C.onDidChangeCursorSelection(W=>{if(this._isCursorUndoRedo||!W.oldSelections||W.oldModelVersionId!==W.modelVersionId)return;const V=new CursorState(W.oldSelections);this._undoStack.length>0&&this._undoStack[this._undoStack.length-1].cursorState.equals(V)||(this._undoStack.push(new StackElement(V,C.getScrollTop(),C.getScrollLeft())),this._redoStack=[],this._undoStack.length>50&&this._undoStack.shift())}))}cursorUndo(){!this._editor.hasModel()||this._undoStack.length===0||(this._redoStack.push(new StackElement(new CursorState(this._editor.getSelections()),this._editor.getScrollTop(),this._editor.getScrollLeft())),this._applyState(this._undoStack.pop()))}cursorRedo(){!this._editor.hasModel()||this._redoStack.length===0||(this._undoStack.push(new StackElement(new CursorState(this._editor.getSelections()),this._editor.getScrollTop(),this._editor.getScrollLeft())),this._applyState(this._redoStack.pop()))}_applyState(C){this._isCursorUndoRedo=!0,this._editor.setSelections(C.cursorState.selections),this._editor.setScrollPosition({scrollTop:C.scrollTop,scrollLeft:C.scrollLeft}),this._isCursorUndoRedo=!1}}CursorUndoRedoController.ID="editor.contrib.cursorUndoRedoController";class CursorUndo extends EditorAction{constructor(){super({id:"cursorUndo",label:localize("cursor.undo","Cursor Undo"),alias:"Cursor Undo",precondition:void 0,kbOpts:{kbExpr:EditorContextKeys.textInputFocus,primary:2099,weight:100}})}run(C,W,V){var U;(U=CursorUndoRedoController.get(W))===null||U===void 0||U.cursorUndo()}}class CursorRedo extends EditorAction{constructor(){super({id:"cursorRedo",label:localize("cursor.redo","Cursor Redo"),alias:"Cursor Redo",precondition:void 0})}run(C,W,V){var U;(U=CursorUndoRedoController.get(W))===null||U===void 0||U.cursorRedo()}}registerEditorContribution(CursorUndoRedoController.ID,CursorUndoRedoController,0);registerEditorAction(CursorUndo);registerEditorAction(CursorRedo);const dnd="";class DragAndDropCommand{constructor(C,W,V){this.selection=C,this.targetPosition=W,this.copy=V,this.targetSelection=null}getEditOperations(C,W){const V=C.getValueInRange(this.selection);if(this.copy||W.addEditOperation(this.selection,null),W.addEditOperation(new Range$2(this.targetPosition.lineNumber,this.targetPosition.column,this.targetPosition.lineNumber,this.targetPosition.column),V),this.selection.containsPosition(this.targetPosition)&&!(this.copy&&(this.selection.getEndPosition().equals(this.targetPosition)||this.selection.getStartPosition().equals(this.targetPosition)))){this.targetSelection=this.selection;return}if(this.copy){this.targetSelection=new Selection$1(this.targetPosition.lineNumber,this.targetPosition.column,this.selection.endLineNumber-this.selection.startLineNumber+this.targetPosition.lineNumber,this.selection.startLineNumber===this.selection.endLineNumber?this.targetPosition.column+this.selection.endColumn-this.selection.startColumn:this.selection.endColumn);return}if(this.targetPosition.lineNumber>this.selection.endLineNumber){this.targetSelection=new Selection$1(this.targetPosition.lineNumber-this.selection.endLineNumber+this.selection.startLineNumber,this.targetPosition.column,this.targetPosition.lineNumber,this.selection.startLineNumber===this.selection.endLineNumber?this.targetPosition.column+this.selection.endColumn-this.selection.startColumn:this.selection.endColumn);return}if(this.targetPosition.lineNumber<this.selection.endLineNumber){this.targetSelection=new Selection$1(this.targetPosition.lineNumber,this.targetPosition.column,this.targetPosition.lineNumber+this.selection.endLineNumber-this.selection.startLineNumber,this.selection.startLineNumber===this.selection.endLineNumber?this.targetPosition.column+this.selection.endColumn-this.selection.startColumn:this.selection.endColumn);return}this.selection.endColumn<=this.targetPosition.column?this.targetSelection=new Selection$1(this.targetPosition.lineNumber-this.selection.endLineNumber+this.selection.startLineNumber,this.selection.startLineNumber===this.selection.endLineNumber?this.targetPosition.column-this.selection.endColumn+this.selection.startColumn:this.targetPosition.column-this.selection.endColumn+this.selection.startColumn,this.targetPosition.lineNumber,this.selection.startLineNumber===this.selection.endLineNumber?this.targetPosition.column:this.selection.endColumn):this.targetSelection=new Selection$1(this.targetPosition.lineNumber-this.selection.endLineNumber+this.selection.startLineNumber,this.targetPosition.column,this.targetPosition.lineNumber,this.targetPosition.column+this.selection.endColumn-this.selection.startColumn)}computeCursorState(C,W){return this.targetSelection}}function hasTriggerModifier(K){return isMacintosh?K.altKey:K.ctrlKey}class DragAndDropController extends Disposable{constructor(C){super(),this._editor=C,this._dndDecorationIds=this._editor.createDecorationsCollection(),this._register(this._editor.onMouseDown(W=>this._onEditorMouseDown(W))),this._register(this._editor.onMouseUp(W=>this._onEditorMouseUp(W))),this._register(this._editor.onMouseDrag(W=>this._onEditorMouseDrag(W))),this._register(this._editor.onMouseDrop(W=>this._onEditorMouseDrop(W))),this._register(this._editor.onMouseDropCanceled(()=>this._onEditorMouseDropCanceled())),this._register(this._editor.onKeyDown(W=>this.onEditorKeyDown(W))),this._register(this._editor.onKeyUp(W=>this.onEditorKeyUp(W))),this._register(this._editor.onDidBlurEditorWidget(()=>this.onEditorBlur())),this._register(this._editor.onDidBlurEditorText(()=>this.onEditorBlur())),this._mouseDown=!1,this._modifierPressed=!1,this._dragSelection=null}onEditorBlur(){this._removeDecoration(),this._dragSelection=null,this._mouseDown=!1,this._modifierPressed=!1}onEditorKeyDown(C){!this._editor.getOption(35)||this._editor.getOption(22)||(hasTriggerModifier(C)&&(this._modifierPressed=!0),this._mouseDown&&hasTriggerModifier(C)&&this._editor.updateOptions({mouseStyle:"copy"}))}onEditorKeyUp(C){!this._editor.getOption(35)||this._editor.getOption(22)||(hasTriggerModifier(C)&&(this._modifierPressed=!1),this._mouseDown&&C.keyCode===DragAndDropController.TRIGGER_KEY_VALUE&&this._editor.updateOptions({mouseStyle:"default"}))}_onEditorMouseDown(C){this._mouseDown=!0}_onEditorMouseUp(C){this._mouseDown=!1,this._editor.updateOptions({mouseStyle:"text"})}_onEditorMouseDrag(C){const W=C.target;if(this._dragSelection===null){const U=(this._editor.getSelections()||[]).filter(G=>W.position&&G.containsPosition(W.position));if(U.length===1)this._dragSelection=U[0];else return}hasTriggerModifier(C.event)?this._editor.updateOptions({mouseStyle:"copy"}):this._editor.updateOptions({mouseStyle:"default"}),W.position&&(this._dragSelection.containsPosition(W.position)?this._removeDecoration():this.showAt(W.position))}_onEditorMouseDropCanceled(){this._editor.updateOptions({mouseStyle:"text"}),this._removeDecoration(),this._dragSelection=null,this._mouseDown=!1}_onEditorMouseDrop(C){if(C.target&&(this._hitContent(C.target)||this._hitMargin(C.target))&&C.target.position){const W=new Position$1(C.target.position.lineNumber,C.target.position.column);if(this._dragSelection===null){let V=null;if(C.event.shiftKey){const U=this._editor.getSelection();if(U){const{selectionStartLineNumber:G,selectionStartColumn:Z}=U;V=[new Selection$1(G,Z,W.lineNumber,W.column)]}}else V=(this._editor.getSelections()||[]).map(U=>U.containsPosition(W)?new Selection$1(W.lineNumber,W.column,W.lineNumber,W.column):U);this._editor.setSelections(V||[],"mouse",3)}else(!this._dragSelection.containsPosition(W)||(hasTriggerModifier(C.event)||this._modifierPressed)&&(this._dragSelection.getEndPosition().equals(W)||this._dragSelection.getStartPosition().equals(W)))&&(this._editor.pushUndoStop(),this._editor.executeCommand(DragAndDropController.ID,new DragAndDropCommand(this._dragSelection,W,hasTriggerModifier(C.event)||this._modifierPressed)),this._editor.pushUndoStop())}this._editor.updateOptions({mouseStyle:"text"}),this._removeDecoration(),this._dragSelection=null,this._mouseDown=!1}showAt(C){this._dndDecorationIds.set([{range:new Range$2(C.lineNumber,C.column,C.lineNumber,C.column),options:DragAndDropController._DECORATION_OPTIONS}]),this._editor.revealPosition(C,1)}_removeDecoration(){this._dndDecorationIds.clear()}_hitContent(C){return C.type===6||C.type===7}_hitMargin(C){return C.type===2||C.type===3||C.type===4}dispose(){this._removeDecoration(),this._dragSelection=null,this._mouseDown=!1,this._modifierPressed=!1,super.dispose()}}DragAndDropController.ID="editor.contrib.dragAndDrop";DragAndDropController.TRIGGER_KEY_VALUE=isMacintosh?6:5;DragAndDropController._DECORATION_OPTIONS=ModelDecorationOptions.register({description:"dnd-target",className:"dnd-target"});registerEditorContribution(DragAndDropController.ID,DragAndDropController,2);const generateUuid=function(){if(typeof crypto=="object"&&typeof crypto.randomUUID=="function")return crypto.randomUUID.bind(crypto);let K;typeof crypto=="object"&&typeof crypto.getRandomValues=="function"?K=crypto.getRandomValues.bind(crypto):K=function(V){for(let U=0;U<V.length;U++)V[U]=Math.floor(Math.random()*256);return V};const C=new Uint8Array(16),W=[];for(let V=0;V<256;V++)W.push(V.toString(16).padStart(2,"0"));return function(){K(C),C[6]=C[6]&15|64,C[8]=C[8]&63|128;let U=0,G="";return G+=W[C[U++]],G+=W[C[U++]],G+=W[C[U++]],G+=W[C[U++]],G+="-",G+=W[C[U++]],G+=W[C[U++]],G+="-",G+=W[C[U++]],G+=W[C[U++]],G+="-",G+=W[C[U++]],G+=W[C[U++]],G+="-",G+=W[C[U++]],G+=W[C[U++]],G+=W[C[U++]],G+=W[C[U++]],G+=W[C[U++]],G+=W[C[U++]],G}}();var __awaiter$J=globalThis&&globalThis.__awaiter||function(K,C,W,V){function U(G){return G instanceof W?G:new W(function(Z){Z(G)})}return new(W||(W=Promise))(function(G,Z){function X(ee){try{J(V.next(ee))}catch(te){Z(te)}}function Q(ee){try{J(V.throw(ee))}catch(te){Z(te)}}function J(ee){ee.done?G(ee.value):U(ee.value).then(X,Q)}J((V=V.apply(K,C||[])).next())})};function createStringDataTransferItem(K){return{asString:()=>__awaiter$J(this,void 0,void 0,function*(){return K}),asFile:()=>{},value:typeof K=="string"?K:void 0}}function createFileDataTransferItem(K,C,W){const V={id:generateUuid(),name:K,uri:C,data:W};return{asString:()=>__awaiter$J(this,void 0,void 0,function*(){return""}),asFile:()=>V,value:void 0}}class VSDataTransfer{constructor(){this._entries=new Map}get size(){let C=0;for(const W of this._entries)C++;return C}has(C){return this._entries.has(this.toKey(C))}matches(C){const W=[...this._entries.keys()];return Iterable.some(this,([V,U])=>U.asFile())&&W.push("files"),matchesMimeType_normalized(normalizeMimeType(C),W)}get(C){var W;return(W=this._entries.get(this.toKey(C)))===null||W===void 0?void 0:W[0]}append(C,W){const V=this._entries.get(C);V?V.push(W):this._entries.set(this.toKey(C),[W])}replace(C,W){this._entries.set(this.toKey(C),[W])}delete(C){this._entries.delete(this.toKey(C))}*[Symbol.iterator](){for(const[C,W]of this._entries)for(const V of W)yield[C,V]}toKey(C){return normalizeMimeType(C)}}function normalizeMimeType(K){return K.toLowerCase()}function matchesMimeType(K,C){return matchesMimeType_normalized(normalizeMimeType(K),C.map(normalizeMimeType))}function matchesMimeType_normalized(K,C){if(K==="*/*")return C.length>0;if(C.includes(K))return!0;const W=K.match(/^([a-z]+)\/([a-z]+|\*)$/i);if(!W)return!1;const[V,U,G]=W;return G==="*"?C.some(Z=>Z.startsWith(U+"/")):!1}const UriList=Object.freeze({create:K=>distinct(K.map(C=>C.toString())).join(`\r
`),split:K=>K.split(`\r
`),parse:K=>UriList.split(K).filter(C=>!C.startsWith("#"))}),CodeDataTransfers={EDITORS:"CodeEditors",FILES:"CodeFiles"};class DragAndDropContributionRegistry{}const Extensions={DragAndDropContribution:"workbench.contributions.dragAndDrop"};Registry.add(Extensions.DragAndDropContribution,new DragAndDropContributionRegistry);class LocalSelectionTransfer{constructor(){}static getInstance(){return LocalSelectionTransfer.INSTANCE}hasData(C){return C&&C===this.proto}getData(C){if(this.hasData(C))return this.data}}LocalSelectionTransfer.INSTANCE=new LocalSelectionTransfer;var __awaiter$I=globalThis&&globalThis.__awaiter||function(K,C,W,V){function U(G){return G instanceof W?G:new W(function(Z){Z(G)})}return new(W||(W=Promise))(function(G,Z){function X(ee){try{J(V.next(ee))}catch(te){Z(te)}}function Q(ee){try{J(V.throw(ee))}catch(te){Z(te)}}function J(ee){ee.done?G(ee.value):U(ee.value).then(X,Q)}J((V=V.apply(K,C||[])).next())})};function toVSDataTransfer(K){const C=new VSDataTransfer;for(const W of K.items){const V=W.type;if(W.kind==="string"){const U=new Promise(G=>W.getAsString(G));C.append(V,createStringDataTransferItem(U))}else if(W.kind==="file"){const U=W.getAsFile();U&&C.append(V,createFileDataTransferItemFromFile(U))}}return C}function createFileDataTransferItemFromFile(K){const C=K.path?URI.parse(K.path):void 0;return createFileDataTransferItem(K.name,C,()=>__awaiter$I(this,void 0,void 0,function*(){return new Uint8Array(yield K.arrayBuffer())}))}const INTERNAL_DND_MIME_TYPES=Object.freeze([CodeDataTransfers.EDITORS,CodeDataTransfers.FILES,DataTransfers.RESOURCES,DataTransfers.INTERNAL_URI_LIST]);function toExternalVSDataTransfer(K,C=!1){const W=toVSDataTransfer(K),V=W.get(DataTransfers.INTERNAL_URI_LIST);if(V)W.replace(Mimes.uriList,V);else if(C||!W.has(Mimes.uriList)){const U=[];for(const G of K.items){const Z=G.getAsFile();if(Z){const X=Z.path;try{X?U.push(URI.file(X).toString()):U.push(URI.parse(Z.name,!0).toString())}catch{}}}U.length&&W.replace(Mimes.uriList,createStringDataTransferItem(UriList.create(U)))}for(const U of INTERNAL_DND_MIME_TYPES)W.delete(U);return W}function createCombinedWorkspaceEdit(K,C,W){var V,U;return{edits:[...C.map(G=>new ResourceTextEdit(K,typeof W.insertText=="string"?{range:G,text:W.insertText,insertAsSnippet:!1}:{range:G,text:W.insertText.snippet,insertAsSnippet:!0})),...(U=(V=W.additionalEdit)===null||V===void 0?void 0:V.edits)!==null&&U!==void 0?U:[]]}}function sortEditsByYieldTo(K){var C;function W(X,Q){return"providerId"in X&&X.providerId===Q.providerId||"mimeType"in X&&X.mimeType===Q.handledMimeType}const V=new Map;for(const X of K)for(const Q of(C=X.yieldTo)!==null&&C!==void 0?C:[])for(const J of K)if(J!==X&&W(Q,J)){let ee=V.get(X);ee||(ee=[],V.set(X,ee)),ee.push(J)}if(!V.size)return Array.from(K);const U=new Set,G=[];function Z(X){if(!X.length)return[];const Q=X[0];if(G.includes(Q))return console.warn(`Yield to cycle detected for ${Q.providerId}`),X;if(U.has(Q))return Z(X.slice(1));let J=[];const ee=V.get(Q);return ee&&(G.push(Q),J=Z(ee),G.pop()),U.add(Q),[...J,Q,...Z(X.slice(1))]}return Z(Array.from(K))}const inlineProgressWidget="";var __decorate$W=globalThis&&globalThis.__decorate||function(K,C,W,V){var U=arguments.length,G=U<3?C:V===null?V=Object.getOwnPropertyDescriptor(C,W):V,Z;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")G=Reflect.decorate(K,C,W,V);else for(var X=K.length-1;X>=0;X--)(Z=K[X])&&(G=(U<3?Z(G):U>3?Z(C,W,G):Z(C,W))||G);return U>3&&G&&Object.defineProperty(C,W,G),G},__param$W=globalThis&&globalThis.__param||function(K,C){return function(W,V){C(W,V,K)}},__awaiter$H=globalThis&&globalThis.__awaiter||function(K,C,W,V){function U(G){return G instanceof W?G:new W(function(Z){Z(G)})}return new(W||(W=Promise))(function(G,Z){function X(ee){try{J(V.next(ee))}catch(te){Z(te)}}function Q(ee){try{J(V.throw(ee))}catch(te){Z(te)}}function J(ee){ee.done?G(ee.value):U(ee.value).then(X,Q)}J((V=V.apply(K,C||[])).next())})};const inlineProgressDecoration=ModelDecorationOptions.register({description:"inline-progress-widget",stickiness:1,showIfCollapsed:!0,after:{content:noBreakWhitespace,inlineClassName:"inline-editor-progress-decoration",inlineClassNameAffectsLetterSpacing:!0}});class InlineProgressWidget extends Disposable{constructor(C,W,V,U,G){super(),this.typeId=C,this.editor=W,this.range=V,this.delegate=G,this.allowEditorOverflow=!1,this.suppressMouseDown=!0,this.create(U),this.editor.addContentWidget(this),this.editor.layoutContentWidget(this)}create(C){this.domNode=$$d(".inline-progress-widget"),this.domNode.role="button",this.domNode.title=C;const W=$$d("span.icon");this.domNode.append(W),W.classList.add(...ThemeIcon.asClassNameArray(Codicon.loading),"codicon-modifier-spin");const V=()=>{const U=this.editor.getOption(66);this.domNode.style.height=`${U}px`,this.domNode.style.width=`${Math.ceil(.8*U)}px`};V(),this._register(this.editor.onDidChangeConfiguration(U=>{(U.hasChanged(52)||U.hasChanged(66))&&V()})),this._register(addDisposableListener(this.domNode,EventType$1.CLICK,U=>{this.delegate.cancel()}))}getId(){return InlineProgressWidget.baseId+"."+this.typeId}getDomNode(){return this.domNode}getPosition(){return{position:{lineNumber:this.range.startLineNumber,column:this.range.startColumn},preference:[0]}}dispose(){super.dispose(),this.editor.removeContentWidget(this)}}InlineProgressWidget.baseId="editor.widget.inlineProgressWidget";let InlineProgressManager=class extends Disposable{constructor(C,W,V){super(),this.id=C,this._editor=W,this._instantiationService=V,this._showDelay=500,this._showPromise=this._register(new MutableDisposable),this._currentWidget=new MutableDisposable,this._operationIdPool=0,this._currentDecorations=W.createDecorationsCollection()}showWhile(C,W,V){return __awaiter$H(this,void 0,void 0,function*(){const U=this._operationIdPool++;this._currentOperation=U,this.clear(),this._showPromise.value=disposableTimeout(()=>{const G=Range$2.fromPositions(C);this._currentDecorations.set([{range:G,options:inlineProgressDecoration}]).length>0&&(this._currentWidget.value=this._instantiationService.createInstance(InlineProgressWidget,this.id,this._editor,G,W,V))},this._showDelay);try{return yield V}finally{this._currentOperation===U&&(this.clear(),this._currentOperation=void 0)}})}clear(){this._showPromise.clear(),this._currentDecorations.clear(),this._currentWidget.clear()}};InlineProgressManager=__decorate$W([__param$W(2,IInstantiationService)],InlineProgressManager);const postEditWidget="";var __decorate$V=globalThis&&globalThis.__decorate||function(K,C,W,V){var U=arguments.length,G=U<3?C:V===null?V=Object.getOwnPropertyDescriptor(C,W):V,Z;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")G=Reflect.decorate(K,C,W,V);else for(var X=K.length-1;X>=0;X--)(Z=K[X])&&(G=(U<3?Z(G):U>3?Z(C,W,G):Z(C,W))||G);return U>3&&G&&Object.defineProperty(C,W,G),G},__param$V=globalThis&&globalThis.__param||function(K,C){return function(W,V){C(W,V,K)}},__awaiter$G=globalThis&&globalThis.__awaiter||function(K,C,W,V){function U(G){return G instanceof W?G:new W(function(Z){Z(G)})}return new(W||(W=Promise))(function(G,Z){function X(ee){try{J(V.next(ee))}catch(te){Z(te)}}function Q(ee){try{J(V.throw(ee))}catch(te){Z(te)}}function J(ee){ee.done?G(ee.value):U(ee.value).then(X,Q)}J((V=V.apply(K,C||[])).next())})},PostEditWidget_1;let PostEditWidget=PostEditWidget_1=class extends Disposable{constructor(C,W,V,U,G,Z,X,Q,J,ee){super(),this.typeId=C,this.editor=W,this.showCommand=U,this.range=G,this.edits=Z,this.onSelectNewEdit=X,this._contextMenuService=Q,this._keybindingService=ee,this.allowEditorOverflow=!0,this.suppressMouseDown=!0,this.create(),this.visibleContext=V.bindTo(J),this.visibleContext.set(!0),this._register(toDisposable(()=>this.visibleContext.reset())),this.editor.addContentWidget(this),this.editor.layoutContentWidget(this),this._register(toDisposable(()=>this.editor.removeContentWidget(this))),this._register(this.editor.onDidChangeCursorPosition(te=>{G.containsPosition(te.position)||this.dispose()})),this._register(Event$1.runAndSubscribe(ee.onDidUpdateKeybindings,()=>{this._updateButtonTitle()}))}_updateButtonTitle(){var C;const W=(C=this._keybindingService.lookupKeybinding(this.showCommand.id))===null||C===void 0?void 0:C.getLabel();this.button.element.title=this.showCommand.label+(W?` (${W})`:"")}create(){this.domNode=$$d(".post-edit-widget"),this.button=this._register(new Button(this.domNode,{supportIcons:!0})),this.button.label="$(insert)",this._register(addDisposableListener(this.domNode,EventType$1.CLICK,()=>this.showSelector()))}getId(){return PostEditWidget_1.baseId+"."+this.typeId}getDomNode(){return this.domNode}getPosition(){return{position:this.range.getEndPosition(),preference:[2]}}showSelector(){this._contextMenuService.showContextMenu({getAnchor:()=>{const C=getDomNodePagePosition(this.button.element);return{x:C.left+C.width,y:C.top+C.height}},getActions:()=>this.edits.allEdits.map((C,W)=>toAction({id:"",label:C.label,checked:W===this.edits.activeEditIndex,run:()=>{if(W!==this.edits.activeEditIndex)return this.onSelectNewEdit(W)}}))})}};PostEditWidget.baseId="editor.widget.postEditWidget";PostEditWidget=PostEditWidget_1=__decorate$V([__param$V(7,IContextMenuService),__param$V(8,IContextKeyService),__param$V(9,IKeybindingService)],PostEditWidget);let PostEditWidgetManager=class extends Disposable{constructor(C,W,V,U,G,Z){super(),this._id=C,this._editor=W,this._visibleContext=V,this._showCommand=U,this._instantiationService=G,this._bulkEditService=Z,this._currentWidget=this._register(new MutableDisposable),this._register(Event$1.any(W.onDidChangeModel,W.onDidChangeModelContent)(()=>this.clear()))}applyEditAndShowIfNeeded(C,W,V,U){var G,Z;return __awaiter$G(this,void 0,void 0,function*(){const X=this._editor.getModel();if(!X||!C.length)return;const Q=W.allEdits[W.activeEditIndex];if(!Q)return;let J=[];(typeof Q.insertText=="string"?Q.insertText==="":Q.insertText.snippet==="")?J=[]:J=C.map(ae=>new ResourceTextEdit(X.uri,typeof Q.insertText=="string"?{range:ae,text:Q.insertText,insertAsSnippet:!1}:{range:ae,text:Q.insertText.snippet,insertAsSnippet:!0}));const te={edits:[...J,...(Z=(G=Q.additionalEdit)===null||G===void 0?void 0:G.edits)!==null&&Z!==void 0?Z:[]]},ie=C[0],ne=X.deltaDecorations([],[{range:ie,options:{description:"paste-line-suffix",stickiness:0}}]);let oe,re;try{oe=yield this._bulkEditService.apply(te,{editor:this._editor,token:U}),re=X.getDecorationRange(ne[0])}finally{X.deltaDecorations(ne,[])}V&&oe.isApplied&&W.allEdits.length>1&&this.show(re??ie,W,ae=>__awaiter$G(this,void 0,void 0,function*(){const se=this._editor.getModel();se&&(yield se.undo(),this.applyEditAndShowIfNeeded(C,{activeEditIndex:ae,allEdits:W.allEdits},V,U))}))})}show(C,W,V){this.clear(),this._editor.hasModel()&&(this._currentWidget.value=this._instantiationService.createInstance(PostEditWidget,this._id,this._editor,this._visibleContext,this._showCommand,C,W,V))}clear(){this._currentWidget.clear()}tryShowSelector(){var C;(C=this._currentWidget.value)===null||C===void 0||C.showSelector()}};PostEditWidgetManager=__decorate$V([__param$V(4,IInstantiationService),__param$V(5,IBulkEditService)],PostEditWidgetManager);var __decorate$U=globalThis&&globalThis.__decorate||function(K,C,W,V){var U=arguments.length,G=U<3?C:V===null?V=Object.getOwnPropertyDescriptor(C,W):V,Z;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")G=Reflect.decorate(K,C,W,V);else for(var X=K.length-1;X>=0;X--)(Z=K[X])&&(G=(U<3?Z(G):U>3?Z(C,W,G):Z(C,W))||G);return U>3&&G&&Object.defineProperty(C,W,G),G},__param$U=globalThis&&globalThis.__param||function(K,C){return function(W,V){C(W,V,K)}},__awaiter$F=globalThis&&globalThis.__awaiter||function(K,C,W,V){function U(G){return G instanceof W?G:new W(function(Z){Z(G)})}return new(W||(W=Promise))(function(G,Z){function X(ee){try{J(V.next(ee))}catch(te){Z(te)}}function Q(ee){try{J(V.throw(ee))}catch(te){Z(te)}}function J(ee){ee.done?G(ee.value):U(ee.value).then(X,Q)}J((V=V.apply(K,C||[])).next())})},CopyPasteController_1;const changePasteTypeCommandId="editor.changePasteType",pasteWidgetVisibleCtx=new RawContextKey("pasteWidgetVisible",!1,localize("pasteWidgetVisible","Whether the paste widget is showing")),vscodeClipboardMime="application/vnd.code.copyMetadata";let CopyPasteController=CopyPasteController_1=class extends Disposable{static get(C){return C.getContribution(CopyPasteController_1.ID)}constructor(C,W,V,U,G,Z,X){super(),this._bulkEditService=V,this._clipboardService=U,this._languageFeaturesService=G,this._quickInputService=Z,this._progressService=X,this._editor=C;const Q=C.getContainerDomNode();this._register(addDisposableListener(Q,"copy",J=>this.handleCopy(J))),this._register(addDisposableListener(Q,"cut",J=>this.handleCopy(J))),this._register(addDisposableListener(Q,"paste",J=>this.handlePaste(J),!0)),this._pasteProgressManager=this._register(new InlineProgressManager("pasteIntoEditor",C,W)),this._postPasteWidgetManager=this._register(W.createInstance(PostEditWidgetManager,"pasteIntoEditor",C,pasteWidgetVisibleCtx,{id:changePasteTypeCommandId,label:localize("postPasteWidgetTitle","Show paste options...")}))}changePasteType(){this._postPasteWidgetManager.tryShowSelector()}pasteAs(C){this._editor.focus();try{this._pasteAsActionContext={preferredId:C},getActiveDocument().execCommand("paste")}finally{this._pasteAsActionContext=void 0}}isPasteAsEnabled(){return this._editor.getOption(84).enabled&&!this._editor.getOption(90)}handleCopy(C){var W,V;if(!this._editor.hasTextFocus()||(isWeb&&this._clipboardService.writeResources([]),!C.clipboardData||!this.isPasteAsEnabled()))return;const U=this._editor.getModel(),G=this._editor.getSelections();if(!U||!(G!=null&&G.length))return;const Z=this._editor.getOption(37);let X=G;const Q=G.length===1&&G[0].isEmpty();if(Q){if(!Z)return;X=[new Range$2(X[0].startLineNumber,1,X[0].startLineNumber,1+U.getLineLength(X[0].startLineNumber))]}const J=(W=this._editor._getViewModel())===null||W===void 0?void 0:W.getPlainTextToCopy(G,Z,isWindows),te={multicursorText:Array.isArray(J)?J:null,pasteOnNewLine:Q,mode:null},ie=this._languageFeaturesService.documentPasteEditProvider.ordered(U).filter(se=>!!se.prepareDocumentPaste);if(!ie.length){this.setCopyMetadata(C.clipboardData,{defaultPastePayload:te});return}const ne=toVSDataTransfer(C.clipboardData),oe=ie.flatMap(se=>{var le;return(le=se.copyMimeTypes)!==null&&le!==void 0?le:[]}),re=generateUuid();this.setCopyMetadata(C.clipboardData,{id:re,providerCopyMimeTypes:oe,defaultPastePayload:te});const ae=createCancelablePromise(se=>__awaiter$F(this,void 0,void 0,function*(){const le=coalesce(yield Promise.all(ie.map(ce=>__awaiter$F(this,void 0,void 0,function*(){try{return yield ce.prepareDocumentPaste(U,X,ne,se)}catch(de){console.error(de);return}}))));le.reverse();for(const ce of le)for(const[de,ue]of ce)ne.replace(de,ue);return ne}));(V=this._currentCopyOperation)===null||V===void 0||V.dataTransferPromise.cancel(),this._currentCopyOperation={handle:re,dataTransferPromise:ae}}handlePaste(C){var W,V;return __awaiter$F(this,void 0,void 0,function*(){if(!C.clipboardData||!this._editor.hasTextFocus())return;(W=this._currentPasteOperation)===null||W===void 0||W.cancel(),this._currentPasteOperation=void 0;const U=this._editor.getModel(),G=this._editor.getSelections();if(!(G!=null&&G.length)||!U||!this.isPasteAsEnabled())return;const Z=this.fetchCopyMetadata(C),X=toExternalVSDataTransfer(C.clipboardData);X.delete(vscodeClipboardMime);const Q=[...C.clipboardData.types,...(V=Z==null?void 0:Z.providerCopyMimeTypes)!==null&&V!==void 0?V:[],Mimes.uriList],J=this._languageFeaturesService.documentPasteEditProvider.ordered(U).filter(ee=>{var te;return(te=ee.pasteMimeTypes)===null||te===void 0?void 0:te.some(ie=>matchesMimeType(ie,Q))});J.length&&(C.preventDefault(),C.stopImmediatePropagation(),this._pasteAsActionContext?this.showPasteAsPick(this._pasteAsActionContext.preferredId,J,G,X,Z):this.doPasteInline(J,G,X,Z))})}doPasteInline(C,W,V,U){const G=createCancelablePromise(Z=>__awaiter$F(this,void 0,void 0,function*(){const X=this._editor;if(!X.hasModel())return;const Q=X.getModel(),J=new EditorStateCancellationTokenSource(X,3,void 0,Z);try{if(yield this.mergeInDataFromCopy(V,U,J.token),J.token.isCancellationRequested)return;const ee=C.filter(ie=>isSupportedPasteProvider(ie,V));if(!ee.length||ee.length===1&&ee[0].id==="text"){yield this.applyDefaultPasteHandler(V,U,J.token);return}const te=yield this.getPasteEdits(ee,V,Q,W,J.token);if(J.token.isCancellationRequested)return;if(te.length===1&&te[0].providerId==="text"){yield this.applyDefaultPasteHandler(V,U,J.token);return}if(te.length){const ie=X.getOption(84).showPasteSelector==="afterPaste";return this._postPasteWidgetManager.applyEditAndShowIfNeeded(W,{activeEditIndex:0,allEdits:te},ie,J.token)}yield this.applyDefaultPasteHandler(V,U,J.token)}finally{J.dispose(),this._currentPasteOperation===G&&(this._currentPasteOperation=void 0)}}));this._pasteProgressManager.showWhile(W[0].getEndPosition(),localize("pasteIntoEditorProgress","Running paste handlers. Click to cancel"),G),this._currentPasteOperation=G}showPasteAsPick(C,W,V,U,G){const Z=createCancelablePromise(X=>__awaiter$F(this,void 0,void 0,function*(){const Q=this._editor;if(!Q.hasModel())return;const J=Q.getModel(),ee=new EditorStateCancellationTokenSource(Q,3,void 0,X);try{if(yield this.mergeInDataFromCopy(U,G,ee.token),ee.token.isCancellationRequested)return;let te=W.filter(re=>isSupportedPasteProvider(re,U));C&&(te=te.filter(re=>re.id===C));const ie=yield this.getPasteEdits(te,U,J,V,ee.token);if(ee.token.isCancellationRequested||!ie.length)return;let ne;if(C)ne=ie.at(0);else{const re=yield this._quickInputService.pick(ie.map(ae=>({label:ae.label,description:ae.providerId,detail:ae.detail,edit:ae})),{placeHolder:localize("pasteAsPickerPlaceholder","Select Paste Action")});ne=re==null?void 0:re.edit}if(!ne)return;const oe=createCombinedWorkspaceEdit(J.uri,V,ne);yield this._bulkEditService.apply(oe,{editor:this._editor})}finally{ee.dispose(),this._currentPasteOperation===Z&&(this._currentPasteOperation=void 0)}}));this._progressService.withProgress({location:10,title:localize("pasteAsProgress","Running paste handlers")},()=>Z)}setCopyMetadata(C,W){C.setData(vscodeClipboardMime,JSON.stringify(W))}fetchCopyMetadata(C){var W;if(!C.clipboardData)return;const V=C.clipboardData.getData(vscodeClipboardMime);if(V)try{return JSON.parse(V)}catch{return}const[U,G]=ClipboardEventUtils.getTextData(C.clipboardData);if(G)return{defaultPastePayload:{mode:G.mode,multicursorText:(W=G.multicursorText)!==null&&W!==void 0?W:null,pasteOnNewLine:!!G.isFromEmptySelection}}}mergeInDataFromCopy(C,W,V){var U;return __awaiter$F(this,void 0,void 0,function*(){if(W!=null&&W.id&&((U=this._currentCopyOperation)===null||U===void 0?void 0:U.handle)===W.id){const G=yield this._currentCopyOperation.dataTransferPromise;if(V.isCancellationRequested)return;for(const[Z,X]of G)C.replace(Z,X)}if(!C.has(Mimes.uriList)){const G=yield this._clipboardService.readResources();if(V.isCancellationRequested)return;G.length&&C.append(Mimes.uriList,createStringDataTransferItem(UriList.create(G)))}})}getPasteEdits(C,W,V,U,G){return __awaiter$F(this,void 0,void 0,function*(){const Z=yield raceCancellation(Promise.all(C.map(Q=>__awaiter$F(this,void 0,void 0,function*(){var J;try{const ee=yield(J=Q.provideDocumentPasteEdits)===null||J===void 0?void 0:J.call(Q,V,U,W,G);if(ee)return Object.assign(Object.assign({},ee),{providerId:Q.id})}catch(ee){console.error(ee)}}))),G),X=coalesce(Z??[]);return sortEditsByYieldTo(X)})}applyDefaultPasteHandler(C,W,V){var U,G,Z;return __awaiter$F(this,void 0,void 0,function*(){const X=(U=C.get(Mimes.text))!==null&&U!==void 0?U:C.get("text");if(!X)return;const Q=yield X.asString();if(V.isCancellationRequested)return;const J={text:Q,pasteOnNewLine:(G=W==null?void 0:W.defaultPastePayload.pasteOnNewLine)!==null&&G!==void 0?G:!1,multicursorText:(Z=W==null?void 0:W.defaultPastePayload.multicursorText)!==null&&Z!==void 0?Z:null,mode:null};this._editor.trigger("keyboard","paste",J)})}};CopyPasteController.ID="editor.contrib.copyPasteActionController";CopyPasteController=CopyPasteController_1=__decorate$U([__param$U(1,IInstantiationService),__param$U(2,IBulkEditService),__param$U(3,IClipboardService),__param$U(4,ILanguageFeaturesService),__param$U(5,IQuickInputService),__param$U(6,IProgressService)],CopyPasteController);function isSupportedPasteProvider(K,C){var W;return!!(!((W=K.pasteMimeTypes)===null||W===void 0)&&W.some(V=>C.matches(V)))}var __decorate$T=globalThis&&globalThis.__decorate||function(K,C,W,V){var U=arguments.length,G=U<3?C:V===null?V=Object.getOwnPropertyDescriptor(C,W):V,Z;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")G=Reflect.decorate(K,C,W,V);else for(var X=K.length-1;X>=0;X--)(Z=K[X])&&(G=(U<3?Z(G):U>3?Z(C,W,G):Z(C,W))||G);return U>3&&G&&Object.defineProperty(C,W,G),G},__param$T=globalThis&&globalThis.__param||function(K,C){return function(W,V){C(W,V,K)}},__awaiter$E=globalThis&&globalThis.__awaiter||function(K,C,W,V){function U(G){return G instanceof W?G:new W(function(Z){Z(G)})}return new(W||(W=Promise))(function(G,Z){function X(ee){try{J(V.next(ee))}catch(te){Z(te)}}function Q(ee){try{J(V.throw(ee))}catch(te){Z(te)}}function J(ee){ee.done?G(ee.value):U(ee.value).then(X,Q)}J((V=V.apply(K,C||[])).next())})};const builtInLabel=localize("builtIn","Built-in");class SimplePasteAndDropProvider{provideDocumentPasteEdits(C,W,V,U){return __awaiter$E(this,void 0,void 0,function*(){const G=yield this.getEdit(V,U);return G?{insertText:G.insertText,label:G.label,detail:G.detail,handledMimeType:G.handledMimeType,yieldTo:G.yieldTo}:void 0})}provideDocumentOnDropEdits(C,W,V,U){return __awaiter$E(this,void 0,void 0,function*(){const G=yield this.getEdit(V,U);return G?{insertText:G.insertText,label:G.label,handledMimeType:G.handledMimeType,yieldTo:G.yieldTo}:void 0})}}class DefaultTextProvider extends SimplePasteAndDropProvider{constructor(){super(...arguments),this.id="text",this.dropMimeTypes=[Mimes.text],this.pasteMimeTypes=[Mimes.text]}getEdit(C,W){return __awaiter$E(this,void 0,void 0,function*(){const V=C.get(Mimes.text);if(!V||C.has(Mimes.uriList))return;const U=yield V.asString();return{handledMimeType:Mimes.text,label:localize("text.label","Insert Plain Text"),detail:builtInLabel,insertText:U}})}}class PathProvider extends SimplePasteAndDropProvider{constructor(){super(...arguments),this.id="uri",this.dropMimeTypes=[Mimes.uriList],this.pasteMimeTypes=[Mimes.uriList]}getEdit(C,W){return __awaiter$E(this,void 0,void 0,function*(){const V=yield extractUriList(C);if(!V.length||W.isCancellationRequested)return;let U=0;const G=V.map(({uri:X,originalText:Q})=>X.scheme===Schemas.file?X.fsPath:(U++,Q)).join(" ");let Z;return U>0?Z=V.length>1?localize("defaultDropProvider.uriList.uris","Insert Uris"):localize("defaultDropProvider.uriList.uri","Insert Uri"):Z=V.length>1?localize("defaultDropProvider.uriList.paths","Insert Paths"):localize("defaultDropProvider.uriList.path","Insert Path"),{handledMimeType:Mimes.uriList,insertText:G,label:Z,detail:builtInLabel}})}}let RelativePathProvider=class extends SimplePasteAndDropProvider{constructor(C){super(),this._workspaceContextService=C,this.id="relativePath",this.dropMimeTypes=[Mimes.uriList],this.pasteMimeTypes=[Mimes.uriList]}getEdit(C,W){return __awaiter$E(this,void 0,void 0,function*(){const V=yield extractUriList(C);if(!V.length||W.isCancellationRequested)return;const U=coalesce(V.map(({uri:G})=>{const Z=this._workspaceContextService.getWorkspaceFolder(G);return Z?relativePath(Z.uri,G):void 0}));if(U.length)return{handledMimeType:Mimes.uriList,insertText:U.join(" "),label:V.length>1?localize("defaultDropProvider.uriList.relativePaths","Insert Relative Paths"):localize("defaultDropProvider.uriList.relativePath","Insert Relative Path"),detail:builtInLabel}})}};RelativePathProvider=__decorate$T([__param$T(0,IWorkspaceContextService)],RelativePathProvider);function extractUriList(K){return __awaiter$E(this,void 0,void 0,function*(){const C=K.get(Mimes.uriList);if(!C)return[];const W=yield C.asString(),V=[];for(const U of UriList.parse(W))try{V.push({uri:URI.parse(U),originalText:U})}catch{}return V})}let DefaultDropProvidersFeature=class extends Disposable{constructor(C,W){super(),this._register(C.documentOnDropEditProvider.register("*",new DefaultTextProvider)),this._register(C.documentOnDropEditProvider.register("*",new PathProvider)),this._register(C.documentOnDropEditProvider.register("*",new RelativePathProvider(W)))}};DefaultDropProvidersFeature=__decorate$T([__param$T(0,ILanguageFeaturesService),__param$T(1,IWorkspaceContextService)],DefaultDropProvidersFeature);let DefaultPasteProvidersFeature=class extends Disposable{constructor(C,W){super(),this._register(C.documentPasteEditProvider.register("*",new DefaultTextProvider)),this._register(C.documentPasteEditProvider.register("*",new PathProvider)),this._register(C.documentPasteEditProvider.register("*",new RelativePathProvider(W)))}};DefaultPasteProvidersFeature=__decorate$T([__param$T(0,ILanguageFeaturesService),__param$T(1,IWorkspaceContextService)],DefaultPasteProvidersFeature);registerEditorContribution(CopyPasteController.ID,CopyPasteController,0);registerEditorFeature(DefaultPasteProvidersFeature);registerEditorCommand(new class extends EditorCommand{constructor(){super({id:changePasteTypeCommandId,precondition:pasteWidgetVisibleCtx,kbOpts:{weight:100,primary:2137}})}runEditorCommand(K,C,W){var V;return(V=CopyPasteController.get(C))===null||V===void 0?void 0:V.changePasteType()}});registerEditorAction(class extends EditorAction{constructor(){super({id:"editor.action.pasteAs",label:localize("pasteAs","Paste As..."),alias:"Paste As...",precondition:void 0,description:{description:"Paste as",args:[{name:"args",schema:{type:"object",properties:{id:{type:"string",description:localize("pasteAs.id","The id of the paste edit to try applying. If not provided, the editor will show a picker.")}}}}]}})}run(K,C,W){var V;const U=typeof(W==null?void 0:W.id)=="string"?W.id:void 0;return(V=CopyPasteController.get(C))===null||V===void 0?void 0:V.pasteAs(U)}});class TreeViewsDnDService{constructor(){this._dragOperations=new Map}removeDragOperationTransfer(C){if(C&&this._dragOperations.has(C)){const W=this._dragOperations.get(C);return this._dragOperations.delete(C),W}}}class DraggedTreeItemsIdentifier{constructor(C){this.identifier=C}}const ITreeViewsDnDService=createDecorator("treeViewsDndService");registerSingleton(ITreeViewsDnDService,TreeViewsDnDService,1);var __decorate$S=globalThis&&globalThis.__decorate||function(K,C,W,V){var U=arguments.length,G=U<3?C:V===null?V=Object.getOwnPropertyDescriptor(C,W):V,Z;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")G=Reflect.decorate(K,C,W,V);else for(var X=K.length-1;X>=0;X--)(Z=K[X])&&(G=(U<3?Z(G):U>3?Z(C,W,G):Z(C,W))||G);return U>3&&G&&Object.defineProperty(C,W,G),G},__param$S=globalThis&&globalThis.__param||function(K,C){return function(W,V){C(W,V,K)}},__awaiter$D=globalThis&&globalThis.__awaiter||function(K,C,W,V){function U(G){return G instanceof W?G:new W(function(Z){Z(G)})}return new(W||(W=Promise))(function(G,Z){function X(ee){try{J(V.next(ee))}catch(te){Z(te)}}function Q(ee){try{J(V.throw(ee))}catch(te){Z(te)}}function J(ee){ee.done?G(ee.value):U(ee.value).then(X,Q)}J((V=V.apply(K,C||[])).next())})},DropIntoEditorController_1;const defaultProviderConfig="editor.experimental.dropIntoEditor.defaultProvider",changeDropTypeCommandId="editor.changeDropType",dropWidgetVisibleCtx=new RawContextKey("dropWidgetVisible",!1,localize("dropWidgetVisible","Whether the drop widget is showing"));let DropIntoEditorController=DropIntoEditorController_1=class extends Disposable{static get(C){return C.getContribution(DropIntoEditorController_1.ID)}constructor(C,W,V,U,G){super(),this._configService=V,this._languageFeaturesService=U,this._treeViewsDragAndDropService=G,this.treeItemsTransfer=LocalSelectionTransfer.getInstance(),this._dropProgressManager=this._register(W.createInstance(InlineProgressManager,"dropIntoEditor",C)),this._postDropWidgetManager=this._register(W.createInstance(PostEditWidgetManager,"dropIntoEditor",C,dropWidgetVisibleCtx,{id:changeDropTypeCommandId,label:localize("postDropWidgetTitle","Show drop options...")})),this._register(C.onDropIntoEditor(Z=>this.onDropIntoEditor(C,Z.position,Z.event)))}changeDropType(){this._postDropWidgetManager.tryShowSelector()}onDropIntoEditor(C,W,V){var U;return __awaiter$D(this,void 0,void 0,function*(){if(!V.dataTransfer||!C.hasModel())return;(U=this._currentOperation)===null||U===void 0||U.cancel(),C.focus(),C.setPosition(W);const G=createCancelablePromise(Z=>__awaiter$D(this,void 0,void 0,function*(){const X=new EditorStateCancellationTokenSource(C,1,void 0,Z);try{const Q=yield this.extractDataTransferData(V);if(Q.size===0||X.token.isCancellationRequested)return;const J=C.getModel();if(!J)return;const ee=this._languageFeaturesService.documentOnDropEditProvider.ordered(J).filter(ie=>ie.dropMimeTypes?ie.dropMimeTypes.some(ne=>Q.matches(ne)):!0),te=yield this.getDropEdits(ee,J,W,Q,X);if(X.token.isCancellationRequested)return;if(te.length){const ie=this.getInitialActiveEditIndex(J,te),ne=C.getOption(36).showDropSelector==="afterDrop";yield this._postDropWidgetManager.applyEditAndShowIfNeeded([Range$2.fromPositions(W)],{activeEditIndex:ie,allEdits:te},ne,Z)}}finally{X.dispose(),this._currentOperation===G&&(this._currentOperation=void 0)}}));this._dropProgressManager.showWhile(W,localize("dropIntoEditorProgress","Running drop handlers. Click to cancel"),G),this._currentOperation=G})}getDropEdits(C,W,V,U,G){return __awaiter$D(this,void 0,void 0,function*(){const Z=yield raceCancellation(Promise.all(C.map(Q=>__awaiter$D(this,void 0,void 0,function*(){try{const J=yield Q.provideDocumentOnDropEdits(W,V,U,G.token);if(J)return Object.assign(Object.assign({},J),{providerId:Q.id})}catch(J){console.error(J)}}))),G.token),X=coalesce(Z??[]);return sortEditsByYieldTo(X)})}getInitialActiveEditIndex(C,W){const V=this._configService.getValue(defaultProviderConfig,{resource:C.uri});for(const[U,G]of Object.entries(V)){const Z=W.findIndex(X=>G===X.providerId&&X.handledMimeType&&matchesMimeType(U,[X.handledMimeType]));if(Z>=0)return Z}return 0}extractDataTransferData(C){return __awaiter$D(this,void 0,void 0,function*(){if(!C.dataTransfer)return new VSDataTransfer;const W=toExternalVSDataTransfer(C.dataTransfer);if(this.treeItemsTransfer.hasData(DraggedTreeItemsIdentifier.prototype)){const V=this.treeItemsTransfer.getData(DraggedTreeItemsIdentifier.prototype);if(Array.isArray(V))for(const U of V){const G=yield this._treeViewsDragAndDropService.removeDragOperationTransfer(U.identifier);if(G)for(const[Z,X]of G)W.replace(Z,X)}}return W})}};DropIntoEditorController.ID="editor.contrib.dropIntoEditorController";DropIntoEditorController=DropIntoEditorController_1=__decorate$S([__param$S(1,IInstantiationService),__param$S(2,IConfigurationService),__param$S(3,ILanguageFeaturesService),__param$S(4,ITreeViewsDnDService)],DropIntoEditorController);registerEditorContribution(DropIntoEditorController.ID,DropIntoEditorController,2);registerEditorCommand(new class extends EditorCommand{constructor(){super({id:changeDropTypeCommandId,precondition:dropWidgetVisibleCtx,kbOpts:{weight:100,primary:2137}})}runEditorCommand(K,C,W){var V;(V=DropIntoEditorController.get(C))===null||V===void 0||V.changeDropType()}});registerEditorFeature(DefaultDropProvidersFeature);Registry.as(Extensions$6.Configuration).registerConfiguration(Object.assign(Object.assign({},editorConfigurationBaseNode),{properties:{[defaultProviderConfig]:{type:"object",scope:5,description:localize("defaultProviderDescription","Configures the default drop provider to use for content of a given mime type."),default:{},additionalProperties:{type:"string"}}}}));class FindDecorations{constructor(C){this._editor=C,this._decorations=[],this._overviewRulerApproximateDecorations=[],this._findScopeDecorationIds=[],this._rangeHighlightDecorationId=null,this._highlightedDecorationId=null,this._startPosition=this._editor.getPosition()}dispose(){this._editor.removeDecorations(this._allDecorations()),this._decorations=[],this._overviewRulerApproximateDecorations=[],this._findScopeDecorationIds=[],this._rangeHighlightDecorationId=null,this._highlightedDecorationId=null}reset(){this._decorations=[],this._overviewRulerApproximateDecorations=[],this._findScopeDecorationIds=[],this._rangeHighlightDecorationId=null,this._highlightedDecorationId=null}getCount(){return this._decorations.length}getFindScope(){return this._findScopeDecorationIds[0]?this._editor.getModel().getDecorationRange(this._findScopeDecorationIds[0]):null}getFindScopes(){if(this._findScopeDecorationIds.length){const C=this._findScopeDecorationIds.map(W=>this._editor.getModel().getDecorationRange(W)).filter(W=>!!W);if(C.length)return C}return null}getStartPosition(){return this._startPosition}setStartPosition(C){this._startPosition=C,this.setCurrentFindMatch(null)}_getDecorationIndex(C){const W=this._decorations.indexOf(C);return W>=0?W+1:1}getDecorationRangeAt(C){const W=C<this._decorations.length?this._decorations[C]:null;return W?this._editor.getModel().getDecorationRange(W):null}getCurrentMatchesPosition(C){const W=this._editor.getModel().getDecorationsInRange(C);for(const V of W){const U=V.options;if(U===FindDecorations._FIND_MATCH_DECORATION||U===FindDecorations._CURRENT_FIND_MATCH_DECORATION)return this._getDecorationIndex(V.id)}return 0}setCurrentFindMatch(C){let W=null,V=0;if(C)for(let U=0,G=this._decorations.length;U<G;U++){const Z=this._editor.getModel().getDecorationRange(this._decorations[U]);if(C.equalsRange(Z)){W=this._decorations[U],V=U+1;break}}return(this._highlightedDecorationId!==null||W!==null)&&this._editor.changeDecorations(U=>{if(this._highlightedDecorationId!==null&&(U.changeDecorationOptions(this._highlightedDecorationId,FindDecorations._FIND_MATCH_DECORATION),this._highlightedDecorationId=null),W!==null&&(this._highlightedDecorationId=W,U.changeDecorationOptions(this._highlightedDecorationId,FindDecorations._CURRENT_FIND_MATCH_DECORATION)),this._rangeHighlightDecorationId!==null&&(U.removeDecoration(this._rangeHighlightDecorationId),this._rangeHighlightDecorationId=null),W!==null){let G=this._editor.getModel().getDecorationRange(W);if(G.startLineNumber!==G.endLineNumber&&G.endColumn===1){const Z=G.endLineNumber-1,X=this._editor.getModel().getLineMaxColumn(Z);G=new Range$2(G.startLineNumber,G.startColumn,Z,X)}this._rangeHighlightDecorationId=U.addDecoration(G,FindDecorations._RANGE_HIGHLIGHT_DECORATION)}}),V}set(C,W){this._editor.changeDecorations(V=>{let U=FindDecorations._FIND_MATCH_DECORATION;const G=[];if(C.length>1e3){U=FindDecorations._FIND_MATCH_NO_OVERVIEW_DECORATION;const X=this._editor.getModel().getLineCount(),J=this._editor.getLayoutInfo().height/X,ee=Math.max(2,Math.ceil(3/J));let te=C[0].range.startLineNumber,ie=C[0].range.endLineNumber;for(let ne=1,oe=C.length;ne<oe;ne++){const re=C[ne].range;ie+ee>=re.startLineNumber?re.endLineNumber>ie&&(ie=re.endLineNumber):(G.push({range:new Range$2(te,1,ie,1),options:FindDecorations._FIND_MATCH_ONLY_OVERVIEW_DECORATION}),te=re.startLineNumber,ie=re.endLineNumber)}G.push({range:new Range$2(te,1,ie,1),options:FindDecorations._FIND_MATCH_ONLY_OVERVIEW_DECORATION})}const Z=new Array(C.length);for(let X=0,Q=C.length;X<Q;X++)Z[X]={range:C[X].range,options:U};this._decorations=V.deltaDecorations(this._decorations,Z),this._overviewRulerApproximateDecorations=V.deltaDecorations(this._overviewRulerApproximateDecorations,G),this._rangeHighlightDecorationId&&(V.removeDecoration(this._rangeHighlightDecorationId),this._rangeHighlightDecorationId=null),this._findScopeDecorationIds.length&&(this._findScopeDecorationIds.forEach(X=>V.removeDecoration(X)),this._findScopeDecorationIds=[]),W!=null&&W.length&&(this._findScopeDecorationIds=W.map(X=>V.addDecoration(X,FindDecorations._FIND_SCOPE_DECORATION)))})}matchBeforePosition(C){if(this._decorations.length===0)return null;for(let W=this._decorations.length-1;W>=0;W--){const V=this._decorations[W],U=this._editor.getModel().getDecorationRange(V);if(!(!U||U.endLineNumber>C.lineNumber)){if(U.endLineNumber<C.lineNumber)return U;if(!(U.endColumn>C.column))return U}}return this._editor.getModel().getDecorationRange(this._decorations[this._decorations.length-1])}matchAfterPosition(C){if(this._decorations.length===0)return null;for(let W=0,V=this._decorations.length;W<V;W++){const U=this._decorations[W],G=this._editor.getModel().getDecorationRange(U);if(!(!G||G.startLineNumber<C.lineNumber)){if(G.startLineNumber>C.lineNumber)return G;if(!(G.startColumn<C.column))return G}}return this._editor.getModel().getDecorationRange(this._decorations[0])}_allDecorations(){let C=[];return C=C.concat(this._decorations),C=C.concat(this._overviewRulerApproximateDecorations),this._findScopeDecorationIds.length&&C.push(...this._findScopeDecorationIds),this._rangeHighlightDecorationId&&C.push(this._rangeHighlightDecorationId),C}}FindDecorations._CURRENT_FIND_MATCH_DECORATION=ModelDecorationOptions.register({description:"current-find-match",stickiness:1,zIndex:13,className:"currentFindMatch",showIfCollapsed:!0,overviewRuler:{color:themeColorFromId(overviewRulerFindMatchForeground),position:OverviewRulerLane.Center},minimap:{color:themeColorFromId(minimapFindMatch),position:MinimapPosition.Inline}});FindDecorations._FIND_MATCH_DECORATION=ModelDecorationOptions.register({description:"find-match",stickiness:1,zIndex:10,className:"findMatch",showIfCollapsed:!0,overviewRuler:{color:themeColorFromId(overviewRulerFindMatchForeground),position:OverviewRulerLane.Center},minimap:{color:themeColorFromId(minimapFindMatch),position:MinimapPosition.Inline}});FindDecorations._FIND_MATCH_NO_OVERVIEW_DECORATION=ModelDecorationOptions.register({description:"find-match-no-overview",stickiness:1,className:"findMatch",showIfCollapsed:!0});FindDecorations._FIND_MATCH_ONLY_OVERVIEW_DECORATION=ModelDecorationOptions.register({description:"find-match-only-overview",stickiness:1,overviewRuler:{color:themeColorFromId(overviewRulerFindMatchForeground),position:OverviewRulerLane.Center}});FindDecorations._RANGE_HIGHLIGHT_DECORATION=ModelDecorationOptions.register({description:"find-range-highlight",stickiness:1,className:"rangeHighlight",isWholeLine:!0});FindDecorations._FIND_SCOPE_DECORATION=ModelDecorationOptions.register({description:"find-scope",className:"findScope",isWholeLine:!0});class ReplaceAllCommand{constructor(C,W,V){this._editorSelection=C,this._ranges=W,this._replaceStrings=V,this._trackedEditorSelectionId=null}getEditOperations(C,W){if(this._ranges.length>0){const V=[];for(let Z=0;Z<this._ranges.length;Z++)V.push({range:this._ranges[Z],text:this._replaceStrings[Z]});V.sort((Z,X)=>Range$2.compareRangesUsingStarts(Z.range,X.range));const U=[];let G=V[0];for(let Z=1;Z<V.length;Z++)G.range.endLineNumber===V[Z].range.startLineNumber&&G.range.endColumn===V[Z].range.startColumn?(G.range=G.range.plusRange(V[Z].range),G.text=G.text+V[Z].text):(U.push(G),G=V[Z]);U.push(G);for(const Z of U)W.addEditOperation(Z.range,Z.text)}this._trackedEditorSelectionId=W.trackSelection(this._editorSelection)}computeCursorState(C,W){return W.getTrackedSelection(this._trackedEditorSelectionId)}}function buildReplaceStringWithCasePreserved(K,C){if(K&&K[0]!==""){const W=validateSpecificSpecialCharacter(K,C,"-"),V=validateSpecificSpecialCharacter(K,C,"_");return W&&!V?buildReplaceStringForSpecificSpecialCharacter(K,C,"-"):!W&&V?buildReplaceStringForSpecificSpecialCharacter(K,C,"_"):K[0].toUpperCase()===K[0]?C.toUpperCase():K[0].toLowerCase()===K[0]?C.toLowerCase():containsUppercaseCharacter(K[0][0])&&C.length>0?C[0].toUpperCase()+C.substr(1):K[0][0].toUpperCase()!==K[0][0]&&C.length>0?C[0].toLowerCase()+C.substr(1):C}else return C}function validateSpecificSpecialCharacter(K,C,W){return K[0].indexOf(W)!==-1&&C.indexOf(W)!==-1&&K[0].split(W).length===C.split(W).length}function buildReplaceStringForSpecificSpecialCharacter(K,C,W){const V=C.split(W),U=K[0].split(W);let G="";return V.forEach((Z,X)=>{G+=buildReplaceStringWithCasePreserved([U[X]],Z)+W}),G.slice(0,-1)}class StaticValueReplacePattern{constructor(C){this.staticValue=C,this.kind=0}}class DynamicPiecesReplacePattern{constructor(C){this.pieces=C,this.kind=1}}class ReplacePattern{static fromStaticValue(C){return new ReplacePattern([ReplacePiece.staticValue(C)])}get hasReplacementPatterns(){return this._state.kind===1}constructor(C){!C||C.length===0?this._state=new StaticValueReplacePattern(""):C.length===1&&C[0].staticValue!==null?this._state=new StaticValueReplacePattern(C[0].staticValue):this._state=new DynamicPiecesReplacePattern(C)}buildReplaceString(C,W){if(this._state.kind===0)return W?buildReplaceStringWithCasePreserved(C,this._state.staticValue):this._state.staticValue;let V="";for(let U=0,G=this._state.pieces.length;U<G;U++){const Z=this._state.pieces[U];if(Z.staticValue!==null){V+=Z.staticValue;continue}let X=ReplacePattern._substitute(Z.matchIndex,C);if(Z.caseOps!==null&&Z.caseOps.length>0){const Q=[],J=Z.caseOps.length;let ee=0;for(let te=0,ie=X.length;te<ie;te++){if(ee>=J){Q.push(X.slice(te));break}switch(Z.caseOps[ee]){case"U":Q.push(X[te].toUpperCase());break;case"u":Q.push(X[te].toUpperCase()),ee++;break;case"L":Q.push(X[te].toLowerCase());break;case"l":Q.push(X[te].toLowerCase()),ee++;break;default:Q.push(X[te])}}X=Q.join("")}V+=X}return V}static _substitute(C,W){if(W===null)return"";if(C===0)return W[0];let V="";for(;C>0;){if(C<W.length)return(W[C]||"")+V;V=String(C%10)+V,C=Math.floor(C/10)}return"$"+V}}class ReplacePiece{static staticValue(C){return new ReplacePiece(C,-1,null)}static caseOps(C,W){return new ReplacePiece(null,C,W)}constructor(C,W,V){this.staticValue=C,this.matchIndex=W,!V||V.length===0?this.caseOps=null:this.caseOps=V.slice(0)}}class ReplacePieceBuilder{constructor(C){this._source=C,this._lastCharIndex=0,this._result=[],this._resultLen=0,this._currentStaticPiece=""}emitUnchanged(C){this._emitStatic(this._source.substring(this._lastCharIndex,C)),this._lastCharIndex=C}emitStatic(C,W){this._emitStatic(C),this._lastCharIndex=W}_emitStatic(C){C.length!==0&&(this._currentStaticPiece+=C)}emitMatchIndex(C,W,V){this._currentStaticPiece.length!==0&&(this._result[this._resultLen++]=ReplacePiece.staticValue(this._currentStaticPiece),this._currentStaticPiece=""),this._result[this._resultLen++]=ReplacePiece.caseOps(C,V),this._lastCharIndex=W}finalize(){return this.emitUnchanged(this._source.length),this._currentStaticPiece.length!==0&&(this._result[this._resultLen++]=ReplacePiece.staticValue(this._currentStaticPiece),this._currentStaticPiece=""),new ReplacePattern(this._result)}}function parseReplaceString(K){if(!K||K.length===0)return new ReplacePattern(null);const C=[],W=new ReplacePieceBuilder(K);for(let V=0,U=K.length;V<U;V++){const G=K.charCodeAt(V);if(G===92){if(V++,V>=U)break;const Z=K.charCodeAt(V);switch(Z){case 92:W.emitUnchanged(V-1),W.emitStatic("\\",V+1);break;case 110:W.emitUnchanged(V-1),W.emitStatic(`
`,V+1);break;case 116:W.emitUnchanged(V-1),W.emitStatic("	",V+1);break;case 117:case 85:case 108:case 76:W.emitUnchanged(V-1),W.emitStatic("",V+1),C.push(String.fromCharCode(Z));break}continue}if(G===36){if(V++,V>=U)break;const Z=K.charCodeAt(V);if(Z===36){W.emitUnchanged(V-1),W.emitStatic("$",V+1);continue}if(Z===48||Z===38){W.emitUnchanged(V-1),W.emitMatchIndex(0,V+1,C),C.length=0;continue}if(49<=Z&&Z<=57){let X=Z-48;if(V+1<U){const Q=K.charCodeAt(V+1);if(48<=Q&&Q<=57){V++,X=X*10+(Q-48),W.emitUnchanged(V-2),W.emitMatchIndex(X,V+1,C),C.length=0;continue}}W.emitUnchanged(V-1),W.emitMatchIndex(X,V+1,C),C.length=0;continue}}}return W.finalize()}const CONTEXT_FIND_WIDGET_VISIBLE=new RawContextKey("findWidgetVisible",!1);CONTEXT_FIND_WIDGET_VISIBLE.toNegated();const CONTEXT_FIND_INPUT_FOCUSED=new RawContextKey("findInputFocussed",!1),CONTEXT_REPLACE_INPUT_FOCUSED=new RawContextKey("replaceInputFocussed",!1),ToggleCaseSensitiveKeybinding={primary:545,mac:{primary:2593}},ToggleWholeWordKeybinding={primary:565,mac:{primary:2613}},ToggleRegexKeybinding={primary:560,mac:{primary:2608}},ToggleSearchScopeKeybinding={primary:554,mac:{primary:2602}},TogglePreserveCaseKeybinding={primary:558,mac:{primary:2606}},FIND_IDS={StartFindAction:"actions.find",StartFindWithSelection:"actions.findWithSelection",StartFindWithArgs:"editor.actions.findWithArgs",NextMatchFindAction:"editor.action.nextMatchFindAction",PreviousMatchFindAction:"editor.action.previousMatchFindAction",GoToMatchFindAction:"editor.action.goToMatchFindAction",NextSelectionMatchFindAction:"editor.action.nextSelectionMatchFindAction",PreviousSelectionMatchFindAction:"editor.action.previousSelectionMatchFindAction",StartFindReplaceAction:"editor.action.startFindReplaceAction",CloseFindWidgetCommand:"closeFindWidget",ToggleCaseSensitiveCommand:"toggleFindCaseSensitive",ToggleWholeWordCommand:"toggleFindWholeWord",ToggleRegexCommand:"toggleFindRegex",ToggleSearchScopeCommand:"toggleFindInSelection",TogglePreserveCaseCommand:"togglePreserveCase",ReplaceOneAction:"editor.action.replaceOne",ReplaceAllAction:"editor.action.replaceAll",SelectAllMatchesAction:"editor.action.selectAllMatches"},MATCHES_LIMIT=19999,RESEARCH_DELAY=240;class FindModelBoundToEditorModel{constructor(C,W){this._toDispose=new DisposableStore,this._editor=C,this._state=W,this._isDisposed=!1,this._startSearchingTimer=new TimeoutTimer,this._decorations=new FindDecorations(C),this._toDispose.add(this._decorations),this._updateDecorationsScheduler=new RunOnceScheduler(()=>this.research(!1),100),this._toDispose.add(this._updateDecorationsScheduler),this._toDispose.add(this._editor.onDidChangeCursorPosition(V=>{(V.reason===3||V.reason===5||V.reason===6)&&this._decorations.setStartPosition(this._editor.getPosition())})),this._ignoreModelContentChanged=!1,this._toDispose.add(this._editor.onDidChangeModelContent(V=>{this._ignoreModelContentChanged||(V.isFlush&&this._decorations.reset(),this._decorations.setStartPosition(this._editor.getPosition()),this._updateDecorationsScheduler.schedule())})),this._toDispose.add(this._state.onFindReplaceStateChange(V=>this._onStateChanged(V))),this.research(!1,this._state.searchScope)}dispose(){this._isDisposed=!0,dispose(this._startSearchingTimer),this._toDispose.dispose()}_onStateChanged(C){this._isDisposed||this._editor.hasModel()&&(C.searchString||C.isReplaceRevealed||C.isRegex||C.wholeWord||C.matchCase||C.searchScope)&&(this._editor.getModel().isTooLargeForSyncing()?(this._startSearchingTimer.cancel(),this._startSearchingTimer.setIfNotSet(()=>{C.searchScope?this.research(C.moveCursor,this._state.searchScope):this.research(C.moveCursor)},RESEARCH_DELAY)):C.searchScope?this.research(C.moveCursor,this._state.searchScope):this.research(C.moveCursor))}static _getSearchRange(C,W){return W||C.getFullModelRange()}research(C,W){let V=null;typeof W<"u"?W!==null&&(Array.isArray(W)?V=W:V=[W]):V=this._decorations.getFindScopes(),V!==null&&(V=V.map(X=>{if(X.startLineNumber!==X.endLineNumber){let Q=X.endLineNumber;return X.endColumn===1&&(Q=Q-1),new Range$2(X.startLineNumber,1,Q,this._editor.getModel().getLineMaxColumn(Q))}return X}));const U=this._findMatches(V,!1,MATCHES_LIMIT);this._decorations.set(U,V);const G=this._editor.getSelection();let Z=this._decorations.getCurrentMatchesPosition(G);if(Z===0&&U.length>0){const X=findFirstIdxMonotonousOrArrLen(U.map(Q=>Q.range),Q=>Range$2.compareRangesUsingStarts(Q,G)>=0);Z=X>0?X-1+1:Z}this._state.changeMatchInfo(Z,this._decorations.getCount(),void 0),C&&this._editor.getOption(41).cursorMoveOnType&&this._moveToNextMatch(this._decorations.getStartPosition())}_hasMatches(){return this._state.matchesCount>0}_cannotFind(){if(!this._hasMatches()){const C=this._decorations.getFindScope();return C&&this._editor.revealRangeInCenterIfOutsideViewport(C,0),!0}return!1}_setCurrentFindMatch(C){const W=this._decorations.setCurrentFindMatch(C);this._state.changeMatchInfo(W,this._decorations.getCount(),C),this._editor.setSelection(C),this._editor.revealRangeInCenterIfOutsideViewport(C,0)}_prevSearchPosition(C){const W=this._state.isRegex&&(this._state.searchString.indexOf("^")>=0||this._state.searchString.indexOf("$")>=0);let{lineNumber:V,column:U}=C;const G=this._editor.getModel();return W||U===1?(V===1?V=G.getLineCount():V--,U=G.getLineMaxColumn(V)):U--,new Position$1(V,U)}_moveToPrevMatch(C,W=!1){if(!this._state.canNavigateBack()){const ee=this._decorations.matchAfterPosition(C);ee&&this._setCurrentFindMatch(ee);return}if(this._decorations.getCount()<MATCHES_LIMIT){let ee=this._decorations.matchBeforePosition(C);ee&&ee.isEmpty()&&ee.getStartPosition().equals(C)&&(C=this._prevSearchPosition(C),ee=this._decorations.matchBeforePosition(C)),ee&&this._setCurrentFindMatch(ee);return}if(this._cannotFind())return;const V=this._decorations.getFindScope(),U=FindModelBoundToEditorModel._getSearchRange(this._editor.getModel(),V);U.getEndPosition().isBefore(C)&&(C=U.getEndPosition()),C.isBefore(U.getStartPosition())&&(C=U.getEndPosition());const{lineNumber:G,column:Z}=C,X=this._editor.getModel();let Q=new Position$1(G,Z),J=X.findPreviousMatch(this._state.searchString,Q,this._state.isRegex,this._state.matchCase,this._state.wholeWord?this._editor.getOption(129):null,!1);if(J&&J.range.isEmpty()&&J.range.getStartPosition().equals(Q)&&(Q=this._prevSearchPosition(Q),J=X.findPreviousMatch(this._state.searchString,Q,this._state.isRegex,this._state.matchCase,this._state.wholeWord?this._editor.getOption(129):null,!1)),!!J){if(!W&&!U.containsRange(J.range))return this._moveToPrevMatch(J.range.getStartPosition(),!0);this._setCurrentFindMatch(J.range)}}moveToPrevMatch(){this._moveToPrevMatch(this._editor.getSelection().getStartPosition())}_nextSearchPosition(C){const W=this._state.isRegex&&(this._state.searchString.indexOf("^")>=0||this._state.searchString.indexOf("$")>=0);let{lineNumber:V,column:U}=C;const G=this._editor.getModel();return W||U===G.getLineMaxColumn(V)?(V===G.getLineCount()?V=1:V++,U=1):U++,new Position$1(V,U)}_moveToNextMatch(C){if(!this._state.canNavigateForward()){const V=this._decorations.matchBeforePosition(C);V&&this._setCurrentFindMatch(V);return}if(this._decorations.getCount()<MATCHES_LIMIT){let V=this._decorations.matchAfterPosition(C);V&&V.isEmpty()&&V.getStartPosition().equals(C)&&(C=this._nextSearchPosition(C),V=this._decorations.matchAfterPosition(C)),V&&this._setCurrentFindMatch(V);return}const W=this._getNextMatch(C,!1,!0);W&&this._setCurrentFindMatch(W.range)}_getNextMatch(C,W,V,U=!1){if(this._cannotFind())return null;const G=this._decorations.getFindScope(),Z=FindModelBoundToEditorModel._getSearchRange(this._editor.getModel(),G);Z.getEndPosition().isBefore(C)&&(C=Z.getStartPosition()),C.isBefore(Z.getStartPosition())&&(C=Z.getStartPosition());const{lineNumber:X,column:Q}=C,J=this._editor.getModel();let ee=new Position$1(X,Q),te=J.findNextMatch(this._state.searchString,ee,this._state.isRegex,this._state.matchCase,this._state.wholeWord?this._editor.getOption(129):null,W);return V&&te&&te.range.isEmpty()&&te.range.getStartPosition().equals(ee)&&(ee=this._nextSearchPosition(ee),te=J.findNextMatch(this._state.searchString,ee,this._state.isRegex,this._state.matchCase,this._state.wholeWord?this._editor.getOption(129):null,W)),te?!U&&!Z.containsRange(te.range)?this._getNextMatch(te.range.getEndPosition(),W,V,!0):te:null}moveToNextMatch(){this._moveToNextMatch(this._editor.getSelection().getEndPosition())}_moveToMatch(C){const W=this._decorations.getDecorationRangeAt(C);W&&this._setCurrentFindMatch(W)}moveToMatch(C){this._moveToMatch(C)}_getReplacePattern(){return this._state.isRegex?parseReplaceString(this._state.replaceString):ReplacePattern.fromStaticValue(this._state.replaceString)}replace(){if(!this._hasMatches())return;const C=this._getReplacePattern(),W=this._editor.getSelection(),V=this._getNextMatch(W.getStartPosition(),!0,!1);if(V)if(W.equalsRange(V.range)){const U=C.buildReplaceString(V.matches,this._state.preserveCase),G=new ReplaceCommand(W,U);this._executeEditorCommand("replace",G),this._decorations.setStartPosition(new Position$1(W.startLineNumber,W.startColumn+U.length)),this.research(!0)}else this._decorations.setStartPosition(this._editor.getPosition()),this._setCurrentFindMatch(V.range)}_findMatches(C,W,V){const U=(C||[null]).map(G=>FindModelBoundToEditorModel._getSearchRange(this._editor.getModel(),G));return this._editor.getModel().findMatches(this._state.searchString,U,this._state.isRegex,this._state.matchCase,this._state.wholeWord?this._editor.getOption(129):null,W,V)}replaceAll(){if(!this._hasMatches())return;const C=this._decorations.getFindScopes();C===null&&this._state.matchesCount>=MATCHES_LIMIT?this._largeReplaceAll():this._regularReplaceAll(C),this.research(!1)}_largeReplaceAll(){const W=new SearchParams(this._state.searchString,this._state.isRegex,this._state.matchCase,this._state.wholeWord?this._editor.getOption(129):null).parseSearchRequest();if(!W)return;let V=W.regex;if(!V.multiline){let te="mu";V.ignoreCase&&(te+="i"),V.global&&(te+="g"),V=new RegExp(V.source,te)}const U=this._editor.getModel(),G=U.getValue(1),Z=U.getFullModelRange(),X=this._getReplacePattern();let Q;const J=this._state.preserveCase;X.hasReplacementPatterns||J?Q=G.replace(V,function(){return X.buildReplaceString(arguments,J)}):Q=G.replace(V,X.buildReplaceString(null,J));const ee=new ReplaceCommandThatPreservesSelection(Z,Q,this._editor.getSelection());this._executeEditorCommand("replaceAll",ee)}_regularReplaceAll(C){const W=this._getReplacePattern(),V=this._findMatches(C,W.hasReplacementPatterns||this._state.preserveCase,1073741824),U=[];for(let Z=0,X=V.length;Z<X;Z++)U[Z]=W.buildReplaceString(V[Z].matches,this._state.preserveCase);const G=new ReplaceAllCommand(this._editor.getSelection(),V.map(Z=>Z.range),U);this._executeEditorCommand("replaceAll",G)}selectAllMatches(){if(!this._hasMatches())return;const C=this._decorations.getFindScopes();let V=this._findMatches(C,!1,1073741824).map(G=>new Selection$1(G.range.startLineNumber,G.range.startColumn,G.range.endLineNumber,G.range.endColumn));const U=this._editor.getSelection();for(let G=0,Z=V.length;G<Z;G++)if(V[G].equalsRange(U)){V=[U].concat(V.slice(0,G)).concat(V.slice(G+1));break}this._editor.setSelections(V)}_executeEditorCommand(C,W){try{this._ignoreModelContentChanged=!0,this._editor.pushUndoStop(),this._editor.executeCommand(C,W),this._editor.pushUndoStop()}finally{this._ignoreModelContentChanged=!1}}}const findOptionsWidget="";class FindOptionsWidget extends Widget$1{constructor(C,W,V){super(),this._hideSoon=this._register(new RunOnceScheduler(()=>this._hide(),2e3)),this._isVisible=!1,this._editor=C,this._state=W,this._keybindingService=V,this._domNode=document.createElement("div"),this._domNode.className="findOptionsWidget",this._domNode.style.display="none",this._domNode.style.top="10px",this._domNode.style.zIndex="12",this._domNode.setAttribute("role","presentation"),this._domNode.setAttribute("aria-hidden","true");const U={inputActiveOptionBorder:asCssVariable(inputActiveOptionBorder),inputActiveOptionForeground:asCssVariable(inputActiveOptionForeground),inputActiveOptionBackground:asCssVariable(inputActiveOptionBackground)};this.caseSensitive=this._register(new CaseSensitiveToggle(Object.assign({appendTitle:this._keybindingLabelFor(FIND_IDS.ToggleCaseSensitiveCommand),isChecked:this._state.matchCase},U))),this._domNode.appendChild(this.caseSensitive.domNode),this._register(this.caseSensitive.onChange(()=>{this._state.change({matchCase:this.caseSensitive.checked},!1)})),this.wholeWords=this._register(new WholeWordsToggle(Object.assign({appendTitle:this._keybindingLabelFor(FIND_IDS.ToggleWholeWordCommand),isChecked:this._state.wholeWord},U))),this._domNode.appendChild(this.wholeWords.domNode),this._register(this.wholeWords.onChange(()=>{this._state.change({wholeWord:this.wholeWords.checked},!1)})),this.regex=this._register(new RegexToggle(Object.assign({appendTitle:this._keybindingLabelFor(FIND_IDS.ToggleRegexCommand),isChecked:this._state.isRegex},U))),this._domNode.appendChild(this.regex.domNode),this._register(this.regex.onChange(()=>{this._state.change({isRegex:this.regex.checked},!1)})),this._editor.addOverlayWidget(this),this._register(this._state.onFindReplaceStateChange(G=>{let Z=!1;G.isRegex&&(this.regex.checked=this._state.isRegex,Z=!0),G.wholeWord&&(this.wholeWords.checked=this._state.wholeWord,Z=!0),G.matchCase&&(this.caseSensitive.checked=this._state.matchCase,Z=!0),!this._state.isRevealed&&Z&&this._revealTemporarily()})),this._register(addDisposableListener(this._domNode,EventType$1.MOUSE_LEAVE,G=>this._onMouseLeave())),this._register(addDisposableListener(this._domNode,"mouseover",G=>this._onMouseOver()))}_keybindingLabelFor(C){const W=this._keybindingService.lookupKeybinding(C);return W?` (${W.getLabel()})`:""}dispose(){this._editor.removeOverlayWidget(this),super.dispose()}getId(){return FindOptionsWidget.ID}getDomNode(){return this._domNode}getPosition(){return{preference:0}}highlightFindOptions(){this._revealTemporarily()}_revealTemporarily(){this._show(),this._hideSoon.schedule()}_onMouseLeave(){this._hideSoon.schedule()}_onMouseOver(){this._hideSoon.cancel()}_show(){this._isVisible||(this._isVisible=!0,this._domNode.style.display="block")}_hide(){this._isVisible&&(this._isVisible=!1,this._domNode.style.display="none")}}FindOptionsWidget.ID="editor.contrib.findOptionsWidget";function effectiveOptionValue(K,C){return K===1?!0:K===2?!1:C}class FindReplaceState extends Disposable{get searchString(){return this._searchString}get replaceString(){return this._replaceString}get isRevealed(){return this._isRevealed}get isReplaceRevealed(){return this._isReplaceRevealed}get isRegex(){return effectiveOptionValue(this._isRegexOverride,this._isRegex)}get wholeWord(){return effectiveOptionValue(this._wholeWordOverride,this._wholeWord)}get matchCase(){return effectiveOptionValue(this._matchCaseOverride,this._matchCase)}get preserveCase(){return effectiveOptionValue(this._preserveCaseOverride,this._preserveCase)}get actualIsRegex(){return this._isRegex}get actualWholeWord(){return this._wholeWord}get actualMatchCase(){return this._matchCase}get actualPreserveCase(){return this._preserveCase}get searchScope(){return this._searchScope}get matchesPosition(){return this._matchesPosition}get matchesCount(){return this._matchesCount}get currentMatch(){return this._currentMatch}constructor(){super(),this._onFindReplaceStateChange=this._register(new Emitter$1),this.onFindReplaceStateChange=this._onFindReplaceStateChange.event,this._searchString="",this._replaceString="",this._isRevealed=!1,this._isReplaceRevealed=!1,this._isRegex=!1,this._isRegexOverride=0,this._wholeWord=!1,this._wholeWordOverride=0,this._matchCase=!1,this._matchCaseOverride=0,this._preserveCase=!1,this._preserveCaseOverride=0,this._searchScope=null,this._matchesPosition=0,this._matchesCount=0,this._currentMatch=null,this._loop=!0,this._isSearching=!1,this._filters=null}changeMatchInfo(C,W,V){const U={moveCursor:!1,updateHistory:!1,searchString:!1,replaceString:!1,isRevealed:!1,isReplaceRevealed:!1,isRegex:!1,wholeWord:!1,matchCase:!1,preserveCase:!1,searchScope:!1,matchesPosition:!1,matchesCount:!1,currentMatch:!1,loop:!1,isSearching:!1,filters:!1};let G=!1;W===0&&(C=0),C>W&&(C=W),this._matchesPosition!==C&&(this._matchesPosition=C,U.matchesPosition=!0,G=!0),this._matchesCount!==W&&(this._matchesCount=W,U.matchesCount=!0,G=!0),typeof V<"u"&&(Range$2.equalsRange(this._currentMatch,V)||(this._currentMatch=V,U.currentMatch=!0,G=!0)),G&&this._onFindReplaceStateChange.fire(U)}change(C,W,V=!0){var U;const G={moveCursor:W,updateHistory:V,searchString:!1,replaceString:!1,isRevealed:!1,isReplaceRevealed:!1,isRegex:!1,wholeWord:!1,matchCase:!1,preserveCase:!1,searchScope:!1,matchesPosition:!1,matchesCount:!1,currentMatch:!1,loop:!1,isSearching:!1,filters:!1};let Z=!1;const X=this.isRegex,Q=this.wholeWord,J=this.matchCase,ee=this.preserveCase;typeof C.searchString<"u"&&this._searchString!==C.searchString&&(this._searchString=C.searchString,G.searchString=!0,Z=!0),typeof C.replaceString<"u"&&this._replaceString!==C.replaceString&&(this._replaceString=C.replaceString,G.replaceString=!0,Z=!0),typeof C.isRevealed<"u"&&this._isRevealed!==C.isRevealed&&(this._isRevealed=C.isRevealed,G.isRevealed=!0,Z=!0),typeof C.isReplaceRevealed<"u"&&this._isReplaceRevealed!==C.isReplaceRevealed&&(this._isReplaceRevealed=C.isReplaceRevealed,G.isReplaceRevealed=!0,Z=!0),typeof C.isRegex<"u"&&(this._isRegex=C.isRegex),typeof C.wholeWord<"u"&&(this._wholeWord=C.wholeWord),typeof C.matchCase<"u"&&(this._matchCase=C.matchCase),typeof C.preserveCase<"u"&&(this._preserveCase=C.preserveCase),typeof C.searchScope<"u"&&(!((U=C.searchScope)===null||U===void 0)&&U.every(te=>{var ie;return(ie=this._searchScope)===null||ie===void 0?void 0:ie.some(ne=>!Range$2.equalsRange(ne,te))})||(this._searchScope=C.searchScope,G.searchScope=!0,Z=!0)),typeof C.loop<"u"&&this._loop!==C.loop&&(this._loop=C.loop,G.loop=!0,Z=!0),typeof C.isSearching<"u"&&this._isSearching!==C.isSearching&&(this._isSearching=C.isSearching,G.isSearching=!0,Z=!0),typeof C.filters<"u"&&(this._filters?this._filters.update(C.filters):this._filters=C.filters,G.filters=!0,Z=!0),this._isRegexOverride=typeof C.isRegexOverride<"u"?C.isRegexOverride:0,this._wholeWordOverride=typeof C.wholeWordOverride<"u"?C.wholeWordOverride:0,this._matchCaseOverride=typeof C.matchCaseOverride<"u"?C.matchCaseOverride:0,this._preserveCaseOverride=typeof C.preserveCaseOverride<"u"?C.preserveCaseOverride:0,X!==this.isRegex&&(Z=!0,G.isRegex=!0),Q!==this.wholeWord&&(Z=!0,G.wholeWord=!0),J!==this.matchCase&&(Z=!0,G.matchCase=!0),ee!==this.preserveCase&&(Z=!0,G.preserveCase=!0),Z&&this._onFindReplaceStateChange.fire(G)}canNavigateBack(){return this.canNavigateInLoop()||this.matchesPosition!==1}canNavigateForward(){return this.canNavigateInLoop()||this.matchesPosition<this.matchesCount}canNavigateInLoop(){return this._loop||this.matchesCount>=MATCHES_LIMIT}}const findWidget="",NLS_DEFAULT_LABEL=localize("defaultLabel","input"),NLS_PRESERVE_CASE_LABEL=localize("label.preserveCaseToggle","Preserve Case");class PreserveCaseToggle extends Toggle{constructor(C){super({icon:Codicon.preserveCase,title:NLS_PRESERVE_CASE_LABEL+C.appendTitle,isChecked:C.isChecked,inputActiveOptionBorder:C.inputActiveOptionBorder,inputActiveOptionForeground:C.inputActiveOptionForeground,inputActiveOptionBackground:C.inputActiveOptionBackground})}}class ReplaceInput extends Widget$1{constructor(C,W,V,U){super(),this._showOptionButtons=V,this.fixFocusOnOptionClickEnabled=!0,this.cachedOptionsWidth=0,this._onDidOptionChange=this._register(new Emitter$1),this.onDidOptionChange=this._onDidOptionChange.event,this._onKeyDown=this._register(new Emitter$1),this.onKeyDown=this._onKeyDown.event,this._onMouseDown=this._register(new Emitter$1),this._onInput=this._register(new Emitter$1),this._onKeyUp=this._register(new Emitter$1),this._onPreserveCaseKeyDown=this._register(new Emitter$1),this.onPreserveCaseKeyDown=this._onPreserveCaseKeyDown.event,this.contextViewProvider=W,this.placeholder=U.placeholder||"",this.validation=U.validation,this.label=U.label||NLS_DEFAULT_LABEL;const G=U.appendPreserveCaseLabel||"",Z=U.history||[],X=!!U.flexibleHeight,Q=!!U.flexibleWidth,J=U.flexibleMaxHeight;this.domNode=document.createElement("div"),this.domNode.classList.add("monaco-findInput"),this.inputBox=this._register(new HistoryInputBox(this.domNode,this.contextViewProvider,{ariaLabel:this.label||"",placeholder:this.placeholder||"",validationOptions:{validation:this.validation},history:Z,showHistoryHint:U.showHistoryHint,flexibleHeight:X,flexibleWidth:Q,flexibleMaxHeight:J,inputBoxStyles:U.inputBoxStyles})),this.preserveCase=this._register(new PreserveCaseToggle(Object.assign({appendTitle:G,isChecked:!1},U.toggleStyles))),this._register(this.preserveCase.onChange(ie=>{this._onDidOptionChange.fire(ie),!ie&&this.fixFocusOnOptionClickEnabled&&this.inputBox.focus(),this.validate()})),this._register(this.preserveCase.onKeyDown(ie=>{this._onPreserveCaseKeyDown.fire(ie)})),this._showOptionButtons?this.cachedOptionsWidth=this.preserveCase.width():this.cachedOptionsWidth=0;const ee=[this.preserveCase.domNode];this.onkeydown(this.domNode,ie=>{if(ie.equals(15)||ie.equals(17)||ie.equals(9)){const ne=ee.indexOf(document.activeElement);if(ne>=0){let oe=-1;ie.equals(17)?oe=(ne+1)%ee.length:ie.equals(15)&&(ne===0?oe=ee.length-1:oe=ne-1),ie.equals(9)?(ee[ne].blur(),this.inputBox.focus()):oe>=0&&ee[oe].focus(),EventHelper.stop(ie,!0)}}});const te=document.createElement("div");te.className="controls",te.style.display=this._showOptionButtons?"block":"none",te.appendChild(this.preserveCase.domNode),this.domNode.appendChild(te),C==null||C.appendChild(this.domNode),this.onkeydown(this.inputBox.inputElement,ie=>this._onKeyDown.fire(ie)),this.onkeyup(this.inputBox.inputElement,ie=>this._onKeyUp.fire(ie)),this.oninput(this.inputBox.inputElement,ie=>this._onInput.fire()),this.onmousedown(this.inputBox.inputElement,ie=>this._onMouseDown.fire(ie))}enable(){this.domNode.classList.remove("disabled"),this.inputBox.enable(),this.preserveCase.enable()}disable(){this.domNode.classList.add("disabled"),this.inputBox.disable(),this.preserveCase.disable()}setEnabled(C){C?this.enable():this.disable()}select(){this.inputBox.select()}focus(){this.inputBox.focus()}getPreserveCase(){return this.preserveCase.checked}setPreserveCase(C){this.preserveCase.checked=C}focusOnPreserve(){this.preserveCase.focus()}validate(){var C;(C=this.inputBox)===null||C===void 0||C.validate()}set width(C){this.inputBox.paddingRight=this.cachedOptionsWidth,this.domNode.style.width=C+"px"}dispose(){super.dispose()}}var __decorate$R=globalThis&&globalThis.__decorate||function(K,C,W,V){var U=arguments.length,G=U<3?C:V===null?V=Object.getOwnPropertyDescriptor(C,W):V,Z;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")G=Reflect.decorate(K,C,W,V);else for(var X=K.length-1;X>=0;X--)(Z=K[X])&&(G=(U<3?Z(G):U>3?Z(C,W,G):Z(C,W))||G);return U>3&&G&&Object.defineProperty(C,W,G),G},__param$R=globalThis&&globalThis.__param||function(K,C){return function(W,V){C(W,V,K)}};const historyNavigationVisible=new RawContextKey("suggestWidgetVisible",!1,localize("suggestWidgetVisible","Whether suggestion are visible")),HistoryNavigationWidgetFocusContext="historyNavigationWidgetFocus",HistoryNavigationForwardsEnablementContext="historyNavigationForwardsEnabled",HistoryNavigationBackwardsEnablementContext="historyNavigationBackwardsEnabled";let lastFocusedWidget;const widgets=[];function registerAndCreateHistoryNavigationContext(K,C){if(widgets.includes(C))throw new Error("Cannot register the same widget multiple times");widgets.push(C);const W=new DisposableStore,V=new RawContextKey(HistoryNavigationWidgetFocusContext,!1).bindTo(K),U=new RawContextKey(HistoryNavigationForwardsEnablementContext,!0).bindTo(K),G=new RawContextKey(HistoryNavigationBackwardsEnablementContext,!0).bindTo(K),Z=()=>{V.set(!0),lastFocusedWidget=C},X=()=>{V.set(!1),lastFocusedWidget===C&&(lastFocusedWidget=void 0)};return C.element===document.activeElement&&Z(),W.add(C.onDidFocus(()=>Z())),W.add(C.onDidBlur(()=>X())),W.add(toDisposable(()=>{widgets.splice(widgets.indexOf(C),1),X()})),{historyNavigationForwardsEnablement:U,historyNavigationBackwardsEnablement:G,dispose(){W.dispose()}}}let ContextScopedFindInput=class extends FindInput{constructor(C,W,V,U){super(C,W,V);const G=this._register(U.createScoped(this.inputBox.element));this._register(registerAndCreateHistoryNavigationContext(G,this.inputBox))}};ContextScopedFindInput=__decorate$R([__param$R(3,IContextKeyService)],ContextScopedFindInput);let ContextScopedReplaceInput=class extends ReplaceInput{constructor(C,W,V,U,G=!1){super(C,W,G,V);const Z=this._register(U.createScoped(this.inputBox.element));this._register(registerAndCreateHistoryNavigationContext(Z,this.inputBox))}};ContextScopedReplaceInput=__decorate$R([__param$R(3,IContextKeyService)],ContextScopedReplaceInput);KeybindingsRegistry.registerCommandAndKeybindingRule({id:"history.showPrevious",weight:200,when:ContextKeyExpr.and(ContextKeyExpr.has(HistoryNavigationWidgetFocusContext),ContextKeyExpr.equals(HistoryNavigationBackwardsEnablementContext,!0),ContextKeyExpr.not("isComposing"),historyNavigationVisible.isEqualTo(!1)),primary:16,secondary:[528],handler:K=>{lastFocusedWidget==null||lastFocusedWidget.showPreviousValue()}});KeybindingsRegistry.registerCommandAndKeybindingRule({id:"history.showNext",weight:200,when:ContextKeyExpr.and(ContextKeyExpr.has(HistoryNavigationWidgetFocusContext),ContextKeyExpr.equals(HistoryNavigationForwardsEnablementContext,!0),ContextKeyExpr.not("isComposing"),historyNavigationVisible.isEqualTo(!1)),primary:18,secondary:[530],handler:K=>{lastFocusedWidget==null||lastFocusedWidget.showNextValue()}});function showHistoryKeybindingHint(K){var C,W;return((C=K.lookupKeybinding("history.showPrevious"))===null||C===void 0?void 0:C.getElectronAccelerator())==="Up"&&((W=K.lookupKeybinding("history.showNext"))===null||W===void 0?void 0:W.getElectronAccelerator())==="Down"}var __awaiter$C=globalThis&&globalThis.__awaiter||function(K,C,W,V){function U(G){return G instanceof W?G:new W(function(Z){Z(G)})}return new(W||(W=Promise))(function(G,Z){function X(ee){try{J(V.next(ee))}catch(te){Z(te)}}function Q(ee){try{J(V.throw(ee))}catch(te){Z(te)}}function J(ee){ee.done?G(ee.value):U(ee.value).then(X,Q)}J((V=V.apply(K,C||[])).next())})};const findSelectionIcon=registerIcon("find-selection",Codicon.selection,localize("findSelectionIcon","Icon for 'Find in Selection' in the editor find widget.")),findCollapsedIcon=registerIcon("find-collapsed",Codicon.chevronRight,localize("findCollapsedIcon","Icon to indicate that the editor find widget is collapsed.")),findExpandedIcon=registerIcon("find-expanded",Codicon.chevronDown,localize("findExpandedIcon","Icon to indicate that the editor find widget is expanded.")),findReplaceIcon=registerIcon("find-replace",Codicon.replace,localize("findReplaceIcon","Icon for 'Replace' in the editor find widget.")),findReplaceAllIcon=registerIcon("find-replace-all",Codicon.replaceAll,localize("findReplaceAllIcon","Icon for 'Replace All' in the editor find widget.")),findPreviousMatchIcon=registerIcon("find-previous-match",Codicon.arrowUp,localize("findPreviousMatchIcon","Icon for 'Find Previous' in the editor find widget.")),findNextMatchIcon=registerIcon("find-next-match",Codicon.arrowDown,localize("findNextMatchIcon","Icon for 'Find Next' in the editor find widget.")),NLS_FIND_DIALOG_LABEL=localize("label.findDialog","Find / Replace"),NLS_FIND_INPUT_LABEL=localize("label.find","Find"),NLS_FIND_INPUT_PLACEHOLDER=localize("placeholder.find","Find"),NLS_PREVIOUS_MATCH_BTN_LABEL=localize("label.previousMatchButton","Previous Match"),NLS_NEXT_MATCH_BTN_LABEL=localize("label.nextMatchButton","Next Match"),NLS_TOGGLE_SELECTION_FIND_TITLE=localize("label.toggleSelectionFind","Find in Selection"),NLS_CLOSE_BTN_LABEL=localize("label.closeButton","Close"),NLS_REPLACE_INPUT_LABEL=localize("label.replace","Replace"),NLS_REPLACE_INPUT_PLACEHOLDER=localize("placeholder.replace","Replace"),NLS_REPLACE_BTN_LABEL=localize("label.replaceButton","Replace"),NLS_REPLACE_ALL_BTN_LABEL=localize("label.replaceAllButton","Replace All"),NLS_TOGGLE_REPLACE_MODE_BTN_LABEL=localize("label.toggleReplaceButton","Toggle Replace"),NLS_MATCHES_COUNT_LIMIT_TITLE=localize("title.matchesCountLimit","Only the first {0} results are highlighted, but all find operations work on the entire text.",MATCHES_LIMIT),NLS_MATCHES_LOCATION=localize("label.matchesLocation","{0} of {1}"),NLS_NO_RESULTS=localize("label.noResults","No results"),FIND_WIDGET_INITIAL_WIDTH=419,PART_WIDTH=275,FIND_INPUT_AREA_WIDTH=PART_WIDTH-54;let MAX_MATCHES_COUNT_WIDTH=69;const FIND_INPUT_AREA_HEIGHT=33,ctrlEnterReplaceAllWarningPromptedKey="ctrlEnterReplaceAll.windows.donotask",ctrlKeyMod=isMacintosh?256:2048;class FindWidgetViewZone{constructor(C){this.afterLineNumber=C,this.heightInPx=FIND_INPUT_AREA_HEIGHT,this.suppressMouseDown=!1,this.domNode=document.createElement("div"),this.domNode.className="dock-find-viewzone"}}function stopPropagationForMultiLineUpwards(K,C,W){const V=!!C.match(/\n/);if(W&&V&&W.selectionStart>0){K.stopPropagation();return}}function stopPropagationForMultiLineDownwards(K,C,W){const V=!!C.match(/\n/);if(W&&V&&W.selectionEnd<W.value.length){K.stopPropagation();return}}class FindWidget extends Widget$1{constructor(C,W,V,U,G,Z,X,Q,J){super(),this._cachedHeight=null,this._revealTimeouts=[],this._codeEditor=C,this._controller=W,this._state=V,this._contextViewProvider=U,this._keybindingService=G,this._contextKeyService=Z,this._storageService=Q,this._notificationService=J,this._ctrlEnterReplaceAllWarningPrompted=!!Q.getBoolean(ctrlEnterReplaceAllWarningPromptedKey,0),this._isVisible=!1,this._isReplaceVisible=!1,this._ignoreChangeEvent=!1,this._updateHistoryDelayer=new Delayer(500),this._register(toDisposable(()=>this._updateHistoryDelayer.cancel())),this._register(this._state.onFindReplaceStateChange(ee=>this._onStateChanged(ee))),this._buildDomNode(),this._updateButtons(),this._tryUpdateWidgetWidth(),this._findInput.inputBox.layout(),this._register(this._codeEditor.onDidChangeConfiguration(ee=>{if(ee.hasChanged(90)&&(this._codeEditor.getOption(90)&&this._state.change({isReplaceRevealed:!1},!1),this._updateButtons()),ee.hasChanged(143)&&this._tryUpdateWidgetWidth(),ee.hasChanged(2)&&this.updateAccessibilitySupport(),ee.hasChanged(41)){const te=this._codeEditor.getOption(41).loop;this._state.change({loop:te},!1);const ie=this._codeEditor.getOption(41).addExtraSpaceOnTop;ie&&!this._viewZone&&(this._viewZone=new FindWidgetViewZone(0),this._showViewZone()),!ie&&this._viewZone&&this._removeViewZone()}})),this.updateAccessibilitySupport(),this._register(this._codeEditor.onDidChangeCursorSelection(()=>{this._isVisible&&this._updateToggleSelectionFindButton()})),this._register(this._codeEditor.onDidFocusEditorWidget(()=>__awaiter$C(this,void 0,void 0,function*(){if(this._isVisible){const ee=yield this._controller.getGlobalBufferTerm();ee&&ee!==this._state.searchString&&(this._state.change({searchString:ee},!1),this._findInput.select())}}))),this._findInputFocused=CONTEXT_FIND_INPUT_FOCUSED.bindTo(Z),this._findFocusTracker=this._register(trackFocus(this._findInput.inputBox.inputElement)),this._register(this._findFocusTracker.onDidFocus(()=>{this._findInputFocused.set(!0),this._updateSearchScope()})),this._register(this._findFocusTracker.onDidBlur(()=>{this._findInputFocused.set(!1)})),this._replaceInputFocused=CONTEXT_REPLACE_INPUT_FOCUSED.bindTo(Z),this._replaceFocusTracker=this._register(trackFocus(this._replaceInput.inputBox.inputElement)),this._register(this._replaceFocusTracker.onDidFocus(()=>{this._replaceInputFocused.set(!0),this._updateSearchScope()})),this._register(this._replaceFocusTracker.onDidBlur(()=>{this._replaceInputFocused.set(!1)})),this._codeEditor.addOverlayWidget(this),this._codeEditor.getOption(41).addExtraSpaceOnTop&&(this._viewZone=new FindWidgetViewZone(0)),this._register(this._codeEditor.onDidChangeModel(()=>{this._isVisible&&(this._viewZoneId=void 0)})),this._register(this._codeEditor.onDidScrollChange(ee=>{if(ee.scrollTopChanged){this._layoutViewZone();return}setTimeout(()=>{this._layoutViewZone()},0)}))}getId(){return FindWidget.ID}getDomNode(){return this._domNode}getPosition(){return this._isVisible?{preference:0}:null}_onStateChanged(C){if(C.searchString){try{this._ignoreChangeEvent=!0,this._findInput.setValue(this._state.searchString)}finally{this._ignoreChangeEvent=!1}this._updateButtons()}if(C.replaceString&&(this._replaceInput.inputBox.value=this._state.replaceString),C.isRevealed&&(this._state.isRevealed?this._reveal():this._hide(!0)),C.isReplaceRevealed&&(this._state.isReplaceRevealed?!this._codeEditor.getOption(90)&&!this._isReplaceVisible&&(this._isReplaceVisible=!0,this._replaceInput.width=getTotalWidth(this._findInput.domNode),this._updateButtons(),this._replaceInput.inputBox.layout()):this._isReplaceVisible&&(this._isReplaceVisible=!1,this._updateButtons())),(C.isRevealed||C.isReplaceRevealed)&&(this._state.isRevealed||this._state.isReplaceRevealed)&&this._tryUpdateHeight()&&this._showViewZone(),C.isRegex&&this._findInput.setRegex(this._state.isRegex),C.wholeWord&&this._findInput.setWholeWords(this._state.wholeWord),C.matchCase&&this._findInput.setCaseSensitive(this._state.matchCase),C.preserveCase&&this._replaceInput.setPreserveCase(this._state.preserveCase),C.searchScope&&(this._state.searchScope?this._toggleSelectionFind.checked=!0:this._toggleSelectionFind.checked=!1,this._updateToggleSelectionFindButton()),C.searchString||C.matchesCount||C.matchesPosition){const W=this._state.searchString.length>0&&this._state.matchesCount===0;this._domNode.classList.toggle("no-results",W),this._updateMatchesCount(),this._updateButtons()}(C.searchString||C.currentMatch)&&this._layoutViewZone(),C.updateHistory&&this._delayedUpdateHistory(),C.loop&&this._updateButtons()}_delayedUpdateHistory(){this._updateHistoryDelayer.trigger(this._updateHistory.bind(this)).then(void 0,onUnexpectedError)}_updateHistory(){this._state.searchString&&this._findInput.inputBox.addToHistory(),this._state.replaceString&&this._replaceInput.inputBox.addToHistory()}_updateMatchesCount(){this._matchesCount.style.minWidth=MAX_MATCHES_COUNT_WIDTH+"px",this._state.matchesCount>=MATCHES_LIMIT?this._matchesCount.title=NLS_MATCHES_COUNT_LIMIT_TITLE:this._matchesCount.title="",this._matchesCount.firstChild&&this._matchesCount.removeChild(this._matchesCount.firstChild);let C;if(this._state.matchesCount>0){let W=String(this._state.matchesCount);this._state.matchesCount>=MATCHES_LIMIT&&(W+="+");let V=String(this._state.matchesPosition);V==="0"&&(V="?"),C=format(NLS_MATCHES_LOCATION,V,W)}else C=NLS_NO_RESULTS;this._matchesCount.appendChild(document.createTextNode(C)),alert(this._getAriaLabel(C,this._state.currentMatch,this._state.searchString)),MAX_MATCHES_COUNT_WIDTH=Math.max(MAX_MATCHES_COUNT_WIDTH,this._matchesCount.clientWidth)}_getAriaLabel(C,W,V){if(C===NLS_NO_RESULTS)return V===""?localize("ariaSearchNoResultEmpty","{0} found",C):localize("ariaSearchNoResult","{0} found for '{1}'",C,V);if(W){const U=localize("ariaSearchNoResultWithLineNum","{0} found for '{1}', at {2}",C,V,W.startLineNumber+":"+W.startColumn),G=this._codeEditor.getModel();return G&&W.startLineNumber<=G.getLineCount()&&W.startLineNumber>=1?`${G.getLineContent(W.startLineNumber)}, ${U}`:U}return localize("ariaSearchNoResultWithLineNumNoCurrentMatch","{0} found for '{1}'",C,V)}_updateToggleSelectionFindButton(){const C=this._codeEditor.getSelection(),W=C?C.startLineNumber!==C.endLineNumber||C.startColumn!==C.endColumn:!1,V=this._toggleSelectionFind.checked;this._isVisible&&(V||W)?this._toggleSelectionFind.enable():this._toggleSelectionFind.disable()}_updateButtons(){this._findInput.setEnabled(this._isVisible),this._replaceInput.setEnabled(this._isVisible&&this._isReplaceVisible),this._updateToggleSelectionFindButton(),this._closeBtn.setEnabled(this._isVisible);const C=this._state.searchString.length>0,W=!!this._state.matchesCount;this._prevBtn.setEnabled(this._isVisible&&C&&W&&this._state.canNavigateBack()),this._nextBtn.setEnabled(this._isVisible&&C&&W&&this._state.canNavigateForward()),this._replaceBtn.setEnabled(this._isVisible&&this._isReplaceVisible&&C),this._replaceAllBtn.setEnabled(this._isVisible&&this._isReplaceVisible&&C),this._domNode.classList.toggle("replaceToggled",this._isReplaceVisible),this._toggleReplaceBtn.setExpanded(this._isReplaceVisible);const V=!this._codeEditor.getOption(90);this._toggleReplaceBtn.setEnabled(this._isVisible&&V)}_reveal(){if(this._revealTimeouts.forEach(C=>{clearTimeout(C)}),this._revealTimeouts=[],!this._isVisible){this._isVisible=!0;const C=this._codeEditor.getSelection();switch(this._codeEditor.getOption(41).autoFindInSelection){case"always":this._toggleSelectionFind.checked=!0;break;case"never":this._toggleSelectionFind.checked=!1;break;case"multiline":{const V=!!C&&C.startLineNumber!==C.endLineNumber;this._toggleSelectionFind.checked=V;break}}this._tryUpdateWidgetWidth(),this._updateButtons(),this._revealTimeouts.push(setTimeout(()=>{this._domNode.classList.add("visible"),this._domNode.setAttribute("aria-hidden","false")},0)),this._revealTimeouts.push(setTimeout(()=>{this._findInput.validate()},200)),this._codeEditor.layoutOverlayWidget(this);let W=!0;if(this._codeEditor.getOption(41).seedSearchStringFromSelection&&C){const V=this._codeEditor.getDomNode();if(V){const U=getDomNodePagePosition(V),G=this._codeEditor.getScrolledVisiblePosition(C.getStartPosition()),Z=U.left+(G?G.left:0),X=G?G.top:0;if(this._viewZone&&X<this._viewZone.heightInPx){C.endLineNumber>C.startLineNumber&&(W=!1);const Q=getTopLeftOffset(this._domNode).left;Z>Q&&(W=!1);const J=this._codeEditor.getScrolledVisiblePosition(C.getEndPosition());U.left+(J?J.left:0)>Q&&(W=!1)}}}this._showViewZone(W)}}_hide(C){this._revealTimeouts.forEach(W=>{clearTimeout(W)}),this._revealTimeouts=[],this._isVisible&&(this._isVisible=!1,this._updateButtons(),this._domNode.classList.remove("visible"),this._domNode.setAttribute("aria-hidden","true"),this._findInput.clearMessage(),C&&this._codeEditor.focus(),this._codeEditor.layoutOverlayWidget(this),this._removeViewZone())}_layoutViewZone(C){if(!this._codeEditor.getOption(41).addExtraSpaceOnTop){this._removeViewZone();return}if(!this._isVisible)return;const V=this._viewZone;this._viewZoneId!==void 0||!V||this._codeEditor.changeViewZones(U=>{V.heightInPx=this._getHeight(),this._viewZoneId=U.addZone(V),this._codeEditor.setScrollTop(C||this._codeEditor.getScrollTop()+V.heightInPx)})}_showViewZone(C=!0){if(!this._isVisible||!this._codeEditor.getOption(41).addExtraSpaceOnTop)return;this._viewZone===void 0&&(this._viewZone=new FindWidgetViewZone(0));const V=this._viewZone;this._codeEditor.changeViewZones(U=>{if(this._viewZoneId!==void 0){const G=this._getHeight();if(G===V.heightInPx)return;const Z=G-V.heightInPx;V.heightInPx=G,U.layoutZone(this._viewZoneId),C&&this._codeEditor.setScrollTop(this._codeEditor.getScrollTop()+Z);return}else{let G=this._getHeight();if(G-=this._codeEditor.getOption(83).top,G<=0)return;V.heightInPx=G,this._viewZoneId=U.addZone(V),C&&this._codeEditor.setScrollTop(this._codeEditor.getScrollTop()+G)}})}_removeViewZone(){this._codeEditor.changeViewZones(C=>{this._viewZoneId!==void 0&&(C.removeZone(this._viewZoneId),this._viewZoneId=void 0,this._viewZone&&(this._codeEditor.setScrollTop(this._codeEditor.getScrollTop()-this._viewZone.heightInPx),this._viewZone=void 0))})}_tryUpdateWidgetWidth(){if(!this._isVisible||!isInDOM(this._domNode))return;const C=this._codeEditor.getLayoutInfo();if(C.contentWidth<=0){this._domNode.classList.add("hiddenEditor");return}else this._domNode.classList.contains("hiddenEditor")&&this._domNode.classList.remove("hiddenEditor");const V=C.width,U=C.minimap.minimapWidth;let G=!1,Z=!1,X=!1;if(this._resized&&getTotalWidth(this._domNode)>FIND_WIDGET_INITIAL_WIDTH){this._domNode.style.maxWidth=`${V-28-U-15}px`,this._replaceInput.width=getTotalWidth(this._findInput.domNode);return}if(FIND_WIDGET_INITIAL_WIDTH+28+U>=V&&(Z=!0),FIND_WIDGET_INITIAL_WIDTH+28+U-MAX_MATCHES_COUNT_WIDTH>=V&&(X=!0),FIND_WIDGET_INITIAL_WIDTH+28+U-MAX_MATCHES_COUNT_WIDTH>=V+50&&(G=!0),this._domNode.classList.toggle("collapsed-find-widget",G),this._domNode.classList.toggle("narrow-find-widget",X),this._domNode.classList.toggle("reduced-find-widget",Z),!X&&!G&&(this._domNode.style.maxWidth=`${V-28-U-15}px`),this._findInput.layout({collapsedFindWidget:G,narrowFindWidget:X,reducedFindWidget:Z}),this._resized){const Q=this._findInput.inputBox.element.clientWidth;Q>0&&(this._replaceInput.width=Q)}else this._isReplaceVisible&&(this._replaceInput.width=getTotalWidth(this._findInput.domNode))}_getHeight(){let C=0;return C+=4,C+=this._findInput.inputBox.height+2,this._isReplaceVisible&&(C+=4,C+=this._replaceInput.inputBox.height+2),C+=4,C}_tryUpdateHeight(){const C=this._getHeight();return this._cachedHeight!==null&&this._cachedHeight===C?!1:(this._cachedHeight=C,this._domNode.style.height=`${C}px`,!0)}focusFindInput(){this._findInput.select(),this._findInput.focus()}focusReplaceInput(){this._replaceInput.select(),this._replaceInput.focus()}highlightFindOptions(){this._findInput.highlightFindOptions()}_updateSearchScope(){if(this._codeEditor.hasModel()&&this._toggleSelectionFind.checked){const C=this._codeEditor.getSelections();C.map(W=>{W.endColumn===1&&W.endLineNumber>W.startLineNumber&&(W=W.setEndPosition(W.endLineNumber-1,this._codeEditor.getModel().getLineMaxColumn(W.endLineNumber-1)));const V=this._state.currentMatch;return W.startLineNumber!==W.endLineNumber&&!Range$2.equalsRange(W,V)?W:null}).filter(W=>!!W),C.length&&this._state.change({searchScope:C},!0)}}_onFindInputMouseDown(C){C.middleButton&&C.stopPropagation()}_onFindInputKeyDown(C){if(C.equals(ctrlKeyMod|3))if(this._keybindingService.dispatchEvent(C,C.target)){C.preventDefault();return}else{this._findInput.inputBox.insertAtCursor(`
`),C.preventDefault();return}if(C.equals(2)){this._isReplaceVisible?this._replaceInput.focus():this._findInput.focusOnCaseSensitive(),C.preventDefault();return}if(C.equals(2066)){this._codeEditor.focus(),C.preventDefault();return}if(C.equals(16))return stopPropagationForMultiLineUpwards(C,this._findInput.getValue(),this._findInput.domNode.querySelector("textarea"));if(C.equals(18))return stopPropagationForMultiLineDownwards(C,this._findInput.getValue(),this._findInput.domNode.querySelector("textarea"))}_onReplaceInputKeyDown(C){if(C.equals(ctrlKeyMod|3))if(this._keybindingService.dispatchEvent(C,C.target)){C.preventDefault();return}else{isWindows&&isNative&&!this._ctrlEnterReplaceAllWarningPrompted&&(this._notificationService.info(localize("ctrlEnter.keybindingChanged","Ctrl+Enter now inserts line break instead of replacing all. You can modify the keybinding for editor.action.replaceAll to override this behavior.")),this._ctrlEnterReplaceAllWarningPrompted=!0,this._storageService.store(ctrlEnterReplaceAllWarningPromptedKey,!0,0,0)),this._replaceInput.inputBox.insertAtCursor(`
`),C.preventDefault();return}if(C.equals(2)){this._findInput.focusOnCaseSensitive(),C.preventDefault();return}if(C.equals(1026)){this._findInput.focus(),C.preventDefault();return}if(C.equals(2066)){this._codeEditor.focus(),C.preventDefault();return}if(C.equals(16))return stopPropagationForMultiLineUpwards(C,this._replaceInput.inputBox.value,this._replaceInput.inputBox.element.querySelector("textarea"));if(C.equals(18))return stopPropagationForMultiLineDownwards(C,this._replaceInput.inputBox.value,this._replaceInput.inputBox.element.querySelector("textarea"))}getVerticalSashLeft(C){return 0}_keybindingLabelFor(C){const W=this._keybindingService.lookupKeybinding(C);return W?` (${W.getLabel()})`:""}_buildDomNode(){this._findInput=this._register(new ContextScopedFindInput(null,this._contextViewProvider,{width:FIND_INPUT_AREA_WIDTH,label:NLS_FIND_INPUT_LABEL,placeholder:NLS_FIND_INPUT_PLACEHOLDER,appendCaseSensitiveLabel:this._keybindingLabelFor(FIND_IDS.ToggleCaseSensitiveCommand),appendWholeWordsLabel:this._keybindingLabelFor(FIND_IDS.ToggleWholeWordCommand),appendRegexLabel:this._keybindingLabelFor(FIND_IDS.ToggleRegexCommand),validation:Q=>{if(Q.length===0||!this._findInput.getRegex())return null;try{return new RegExp(Q,"gu"),null}catch(J){return{content:J.message}}},flexibleHeight:!0,flexibleWidth:!0,flexibleMaxHeight:118,showCommonFindToggles:!0,showHistoryHint:()=>showHistoryKeybindingHint(this._keybindingService),inputBoxStyles:defaultInputBoxStyles,toggleStyles:defaultToggleStyles},this._contextKeyService)),this._findInput.setRegex(!!this._state.isRegex),this._findInput.setCaseSensitive(!!this._state.matchCase),this._findInput.setWholeWords(!!this._state.wholeWord),this._register(this._findInput.onKeyDown(Q=>this._onFindInputKeyDown(Q))),this._register(this._findInput.inputBox.onDidChange(()=>{this._ignoreChangeEvent||this._state.change({searchString:this._findInput.getValue()},!0)})),this._register(this._findInput.onDidOptionChange(()=>{this._state.change({isRegex:this._findInput.getRegex(),wholeWord:this._findInput.getWholeWords(),matchCase:this._findInput.getCaseSensitive()},!0)})),this._register(this._findInput.onCaseSensitiveKeyDown(Q=>{Q.equals(1026)&&this._isReplaceVisible&&(this._replaceInput.focus(),Q.preventDefault())})),this._register(this._findInput.onRegexKeyDown(Q=>{Q.equals(2)&&this._isReplaceVisible&&(this._replaceInput.focusOnPreserve(),Q.preventDefault())})),this._register(this._findInput.inputBox.onDidHeightChange(Q=>{this._tryUpdateHeight()&&this._showViewZone()})),isLinux&&this._register(this._findInput.onMouseDown(Q=>this._onFindInputMouseDown(Q))),this._matchesCount=document.createElement("div"),this._matchesCount.className="matchesCount",this._updateMatchesCount(),this._prevBtn=this._register(new SimpleButton({label:NLS_PREVIOUS_MATCH_BTN_LABEL+this._keybindingLabelFor(FIND_IDS.PreviousMatchFindAction),icon:findPreviousMatchIcon,onTrigger:()=>{assertIsDefined(this._codeEditor.getAction(FIND_IDS.PreviousMatchFindAction)).run().then(void 0,onUnexpectedError)}})),this._nextBtn=this._register(new SimpleButton({label:NLS_NEXT_MATCH_BTN_LABEL+this._keybindingLabelFor(FIND_IDS.NextMatchFindAction),icon:findNextMatchIcon,onTrigger:()=>{assertIsDefined(this._codeEditor.getAction(FIND_IDS.NextMatchFindAction)).run().then(void 0,onUnexpectedError)}}));const V=document.createElement("div");V.className="find-part",V.appendChild(this._findInput.domNode);const U=document.createElement("div");U.className="find-actions",V.appendChild(U),U.appendChild(this._matchesCount),U.appendChild(this._prevBtn.domNode),U.appendChild(this._nextBtn.domNode),this._toggleSelectionFind=this._register(new Toggle({icon:findSelectionIcon,title:NLS_TOGGLE_SELECTION_FIND_TITLE+this._keybindingLabelFor(FIND_IDS.ToggleSearchScopeCommand),isChecked:!1,inputActiveOptionBackground:asCssVariable(inputActiveOptionBackground),inputActiveOptionBorder:asCssVariable(inputActiveOptionBorder),inputActiveOptionForeground:asCssVariable(inputActiveOptionForeground)})),this._register(this._toggleSelectionFind.onChange(()=>{if(this._toggleSelectionFind.checked){if(this._codeEditor.hasModel()){const Q=this._codeEditor.getSelections();Q.map(J=>(J.endColumn===1&&J.endLineNumber>J.startLineNumber&&(J=J.setEndPosition(J.endLineNumber-1,this._codeEditor.getModel().getLineMaxColumn(J.endLineNumber-1))),J.isEmpty()?null:J)).filter(J=>!!J),Q.length&&this._state.change({searchScope:Q},!0)}}else this._state.change({searchScope:null},!0)})),U.appendChild(this._toggleSelectionFind.domNode),this._closeBtn=this._register(new SimpleButton({label:NLS_CLOSE_BTN_LABEL+this._keybindingLabelFor(FIND_IDS.CloseFindWidgetCommand),icon:widgetClose,onTrigger:()=>{this._state.change({isRevealed:!1,searchScope:null},!1)},onKeyDown:Q=>{Q.equals(2)&&this._isReplaceVisible&&(this._replaceBtn.isEnabled()?this._replaceBtn.focus():this._codeEditor.focus(),Q.preventDefault())}})),this._replaceInput=this._register(new ContextScopedReplaceInput(null,void 0,{label:NLS_REPLACE_INPUT_LABEL,placeholder:NLS_REPLACE_INPUT_PLACEHOLDER,appendPreserveCaseLabel:this._keybindingLabelFor(FIND_IDS.TogglePreserveCaseCommand),history:[],flexibleHeight:!0,flexibleWidth:!0,flexibleMaxHeight:118,showHistoryHint:()=>showHistoryKeybindingHint(this._keybindingService),inputBoxStyles:defaultInputBoxStyles,toggleStyles:defaultToggleStyles},this._contextKeyService,!0)),this._replaceInput.setPreserveCase(!!this._state.preserveCase),this._register(this._replaceInput.onKeyDown(Q=>this._onReplaceInputKeyDown(Q))),this._register(this._replaceInput.inputBox.onDidChange(()=>{this._state.change({replaceString:this._replaceInput.inputBox.value},!1)})),this._register(this._replaceInput.inputBox.onDidHeightChange(Q=>{this._isReplaceVisible&&this._tryUpdateHeight()&&this._showViewZone()})),this._register(this._replaceInput.onDidOptionChange(()=>{this._state.change({preserveCase:this._replaceInput.getPreserveCase()},!0)})),this._register(this._replaceInput.onPreserveCaseKeyDown(Q=>{Q.equals(2)&&(this._prevBtn.isEnabled()?this._prevBtn.focus():this._nextBtn.isEnabled()?this._nextBtn.focus():this._toggleSelectionFind.enabled?this._toggleSelectionFind.focus():this._closeBtn.isEnabled()&&this._closeBtn.focus(),Q.preventDefault())})),this._replaceBtn=this._register(new SimpleButton({label:NLS_REPLACE_BTN_LABEL+this._keybindingLabelFor(FIND_IDS.ReplaceOneAction),icon:findReplaceIcon,onTrigger:()=>{this._controller.replace()},onKeyDown:Q=>{Q.equals(1026)&&(this._closeBtn.focus(),Q.preventDefault())}})),this._replaceAllBtn=this._register(new SimpleButton({label:NLS_REPLACE_ALL_BTN_LABEL+this._keybindingLabelFor(FIND_IDS.ReplaceAllAction),icon:findReplaceAllIcon,onTrigger:()=>{this._controller.replaceAll()}}));const G=document.createElement("div");G.className="replace-part",G.appendChild(this._replaceInput.domNode);const Z=document.createElement("div");Z.className="replace-actions",G.appendChild(Z),Z.appendChild(this._replaceBtn.domNode),Z.appendChild(this._replaceAllBtn.domNode),this._toggleReplaceBtn=this._register(new SimpleButton({label:NLS_TOGGLE_REPLACE_MODE_BTN_LABEL,className:"codicon toggle left",onTrigger:()=>{this._state.change({isReplaceRevealed:!this._isReplaceVisible},!1),this._isReplaceVisible&&(this._replaceInput.width=getTotalWidth(this._findInput.domNode),this._replaceInput.inputBox.layout()),this._showViewZone()}})),this._toggleReplaceBtn.setExpanded(this._isReplaceVisible),this._domNode=document.createElement("div"),this._domNode.className="editor-widget find-widget",this._domNode.setAttribute("aria-hidden","true"),this._domNode.ariaLabel=NLS_FIND_DIALOG_LABEL,this._domNode.role="dialog",this._domNode.style.width=`${FIND_WIDGET_INITIAL_WIDTH}px`,this._domNode.appendChild(this._toggleReplaceBtn.domNode),this._domNode.appendChild(V),this._domNode.appendChild(this._closeBtn.domNode),this._domNode.appendChild(G),this._resizeSash=new Sash(this._domNode,this,{orientation:0,size:2}),this._resized=!1;let X=FIND_WIDGET_INITIAL_WIDTH;this._register(this._resizeSash.onDidStart(()=>{X=getTotalWidth(this._domNode)})),this._register(this._resizeSash.onDidChange(Q=>{this._resized=!0;const J=X+Q.startX-Q.currentX;if(J<FIND_WIDGET_INITIAL_WIDTH)return;const ee=parseFloat(getComputedStyle$1(this._domNode).maxWidth)||0;J>ee||(this._domNode.style.width=`${J}px`,this._isReplaceVisible&&(this._replaceInput.width=getTotalWidth(this._findInput.domNode)),this._findInput.inputBox.layout(),this._tryUpdateHeight())})),this._register(this._resizeSash.onDidReset(()=>{const Q=getTotalWidth(this._domNode);if(Q<FIND_WIDGET_INITIAL_WIDTH)return;let J=FIND_WIDGET_INITIAL_WIDTH;if(!this._resized||Q===FIND_WIDGET_INITIAL_WIDTH){const ee=this._codeEditor.getLayoutInfo();J=ee.width-28-ee.minimap.minimapWidth-15,this._resized=!0}this._domNode.style.width=`${J}px`,this._isReplaceVisible&&(this._replaceInput.width=getTotalWidth(this._findInput.domNode)),this._findInput.inputBox.layout()}))}updateAccessibilitySupport(){const C=this._codeEditor.getOption(2);this._findInput.setFocusInputOnOptionClick(C!==2)}}FindWidget.ID="editor.contrib.findWidget";class SimpleButton extends Widget$1{constructor(C){super(),this._opts=C;let W="button";this._opts.className&&(W=W+" "+this._opts.className),this._opts.icon&&(W=W+" "+ThemeIcon.asClassName(this._opts.icon)),this._domNode=document.createElement("div"),this._domNode.title=this._opts.label,this._domNode.tabIndex=0,this._domNode.className=W,this._domNode.setAttribute("role","button"),this._domNode.setAttribute("aria-label",this._opts.label),this.onclick(this._domNode,V=>{this._opts.onTrigger(),V.preventDefault()}),this.onkeydown(this._domNode,V=>{var U,G;if(V.equals(10)||V.equals(3)){this._opts.onTrigger(),V.preventDefault();return}(G=(U=this._opts).onKeyDown)===null||G===void 0||G.call(U,V)})}get domNode(){return this._domNode}isEnabled(){return this._domNode.tabIndex>=0}focus(){this._domNode.focus()}setEnabled(C){this._domNode.classList.toggle("disabled",!C),this._domNode.setAttribute("aria-disabled",String(!C)),this._domNode.tabIndex=C?0:-1}setExpanded(C){this._domNode.setAttribute("aria-expanded",String(!!C)),C?(this._domNode.classList.remove(...ThemeIcon.asClassNameArray(findCollapsedIcon)),this._domNode.classList.add(...ThemeIcon.asClassNameArray(findExpandedIcon))):(this._domNode.classList.remove(...ThemeIcon.asClassNameArray(findExpandedIcon)),this._domNode.classList.add(...ThemeIcon.asClassNameArray(findCollapsedIcon)))}}registerThemingParticipant((K,C)=>{const W=(re,ae)=>{ae&&C.addRule(`.monaco-editor ${re} { background-color: ${ae}; }`)};W(".findMatch",K.getColor(editorFindMatchHighlight)),W(".currentFindMatch",K.getColor(editorFindMatch)),W(".findScope",K.getColor(editorFindRangeHighlight));const V=K.getColor(editorWidgetBackground);W(".find-widget",V);const U=K.getColor(widgetShadow);U&&C.addRule(`.monaco-editor .find-widget { box-shadow: 0 0 8px 2px ${U}; }`);const G=K.getColor(widgetBorder);G&&C.addRule(`.monaco-editor .find-widget { border-left: 1px solid ${G}; border-right: 1px solid ${G}; border-bottom: 1px solid ${G}; }`);const Z=K.getColor(editorFindMatchHighlightBorder);Z&&C.addRule(`.monaco-editor .findMatch { border: 1px ${isHighContrast(K.type)?"dotted":"solid"} ${Z}; box-sizing: border-box; }`);const X=K.getColor(editorFindMatchBorder);X&&C.addRule(`.monaco-editor .currentFindMatch { border: 2px solid ${X}; padding: 1px; box-sizing: border-box; }`);const Q=K.getColor(editorFindRangeHighlightBorder);Q&&C.addRule(`.monaco-editor .findScope { border: 1px ${isHighContrast(K.type)?"dashed":"solid"} ${Q}; }`);const J=K.getColor(contrastBorder);J&&C.addRule(`.monaco-editor .find-widget { border: 1px solid ${J}; }`);const ee=K.getColor(editorWidgetForeground);ee&&C.addRule(`.monaco-editor .find-widget { color: ${ee}; }`);const te=K.getColor(errorForeground);te&&C.addRule(`.monaco-editor .find-widget.no-results .matchesCount { color: ${te}; }`);const ie=K.getColor(editorWidgetResizeBorder);if(ie)C.addRule(`.monaco-editor .find-widget .monaco-sash { background-color: ${ie}; }`);else{const re=K.getColor(editorWidgetBorder);re&&C.addRule(`.monaco-editor .find-widget .monaco-sash { background-color: ${re}; }`)}const ne=K.getColor(toolbarHoverBackground);ne&&C.addRule(`
		.monaco-editor .find-widget .button:not(.disabled):hover,
		.monaco-editor .find-widget .codicon-find-selection:hover {
			background-color: ${ne} !important;
		}
	`);const oe=K.getColor(focusBorder);oe&&C.addRule(`.monaco-editor .find-widget .monaco-inputbox.synthetic-focus { outline-color: ${oe}; }`)});var __decorate$Q=globalThis&&globalThis.__decorate||function(K,C,W,V){var U=arguments.length,G=U<3?C:V===null?V=Object.getOwnPropertyDescriptor(C,W):V,Z;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")G=Reflect.decorate(K,C,W,V);else for(var X=K.length-1;X>=0;X--)(Z=K[X])&&(G=(U<3?Z(G):U>3?Z(C,W,G):Z(C,W))||G);return U>3&&G&&Object.defineProperty(C,W,G),G},__param$Q=globalThis&&globalThis.__param||function(K,C){return function(W,V){C(W,V,K)}},__awaiter$B=globalThis&&globalThis.__awaiter||function(K,C,W,V){function U(G){return G instanceof W?G:new W(function(Z){Z(G)})}return new(W||(W=Promise))(function(G,Z){function X(ee){try{J(V.next(ee))}catch(te){Z(te)}}function Q(ee){try{J(V.throw(ee))}catch(te){Z(te)}}function J(ee){ee.done?G(ee.value):U(ee.value).then(X,Q)}J((V=V.apply(K,C||[])).next())})},CommonFindController_1;const SEARCH_STRING_MAX_LENGTH=524288;function getSelectionSearchString(K,C="single",W=!1){if(!K.hasModel())return null;const V=K.getSelection();if(C==="single"&&V.startLineNumber===V.endLineNumber||C==="multiple"){if(V.isEmpty()){const U=K.getConfiguredWordAtPosition(V.getStartPosition());if(U&&W===!1)return U.word}else if(K.getModel().getValueLengthInRange(V)<SEARCH_STRING_MAX_LENGTH)return K.getModel().getValueInRange(V)}return null}let CommonFindController=CommonFindController_1=class extends Disposable{get editor(){return this._editor}static get(C){return C.getContribution(CommonFindController_1.ID)}constructor(C,W,V,U,G){super(),this._editor=C,this._findWidgetVisible=CONTEXT_FIND_WIDGET_VISIBLE.bindTo(W),this._contextKeyService=W,this._storageService=V,this._clipboardService=U,this._notificationService=G,this._updateHistoryDelayer=new Delayer(500),this._state=this._register(new FindReplaceState),this.loadQueryState(),this._register(this._state.onFindReplaceStateChange(Z=>this._onStateChanged(Z))),this._model=null,this._register(this._editor.onDidChangeModel(()=>{const Z=this._editor.getModel()&&this._state.isRevealed;this.disposeModel(),this._state.change({searchScope:null,matchCase:this._storageService.getBoolean("editor.matchCase",1,!1),wholeWord:this._storageService.getBoolean("editor.wholeWord",1,!1),isRegex:this._storageService.getBoolean("editor.isRegex",1,!1),preserveCase:this._storageService.getBoolean("editor.preserveCase",1,!1)},!1),Z&&this._start({forceRevealReplace:!1,seedSearchStringFromSelection:"none",seedSearchStringFromNonEmptySelection:!1,seedSearchStringFromGlobalClipboard:!1,shouldFocus:0,shouldAnimate:!1,updateSearchScope:!1,loop:this._editor.getOption(41).loop})}))}dispose(){this.disposeModel(),super.dispose()}disposeModel(){this._model&&(this._model.dispose(),this._model=null)}_onStateChanged(C){this.saveQueryState(C),C.isRevealed&&(this._state.isRevealed?this._findWidgetVisible.set(!0):(this._findWidgetVisible.reset(),this.disposeModel())),C.searchString&&this.setGlobalBufferTerm(this._state.searchString)}saveQueryState(C){C.isRegex&&this._storageService.store("editor.isRegex",this._state.actualIsRegex,1,1),C.wholeWord&&this._storageService.store("editor.wholeWord",this._state.actualWholeWord,1,1),C.matchCase&&this._storageService.store("editor.matchCase",this._state.actualMatchCase,1,1),C.preserveCase&&this._storageService.store("editor.preserveCase",this._state.actualPreserveCase,1,1)}loadQueryState(){this._state.change({matchCase:this._storageService.getBoolean("editor.matchCase",1,this._state.matchCase),wholeWord:this._storageService.getBoolean("editor.wholeWord",1,this._state.wholeWord),isRegex:this._storageService.getBoolean("editor.isRegex",1,this._state.isRegex),preserveCase:this._storageService.getBoolean("editor.preserveCase",1,this._state.preserveCase)},!1)}isFindInputFocused(){return!!CONTEXT_FIND_INPUT_FOCUSED.getValue(this._contextKeyService)}getState(){return this._state}closeFindWidget(){this._state.change({isRevealed:!1,searchScope:null},!1),this._editor.focus()}toggleCaseSensitive(){this._state.change({matchCase:!this._state.matchCase},!1),this._state.isRevealed||this.highlightFindOptions()}toggleWholeWords(){this._state.change({wholeWord:!this._state.wholeWord},!1),this._state.isRevealed||this.highlightFindOptions()}toggleRegex(){this._state.change({isRegex:!this._state.isRegex},!1),this._state.isRevealed||this.highlightFindOptions()}togglePreserveCase(){this._state.change({preserveCase:!this._state.preserveCase},!1),this._state.isRevealed||this.highlightFindOptions()}toggleSearchScope(){if(this._state.searchScope)this._state.change({searchScope:null},!0);else if(this._editor.hasModel()){const C=this._editor.getSelections();C.map(W=>(W.endColumn===1&&W.endLineNumber>W.startLineNumber&&(W=W.setEndPosition(W.endLineNumber-1,this._editor.getModel().getLineMaxColumn(W.endLineNumber-1))),W.isEmpty()?null:W)).filter(W=>!!W),C.length&&this._state.change({searchScope:C},!0)}}setSearchString(C){this._state.isRegex&&(C=escapeRegExpCharacters(C)),this._state.change({searchString:C},!1)}highlightFindOptions(C=!1){}_start(C,W){return __awaiter$B(this,void 0,void 0,function*(){if(this.disposeModel(),!this._editor.hasModel())return;const V=Object.assign(Object.assign({},W),{isRevealed:!0});if(C.seedSearchStringFromSelection==="single"){const U=getSelectionSearchString(this._editor,C.seedSearchStringFromSelection,C.seedSearchStringFromNonEmptySelection);U&&(this._state.isRegex?V.searchString=escapeRegExpCharacters(U):V.searchString=U)}else if(C.seedSearchStringFromSelection==="multiple"&&!C.updateSearchScope){const U=getSelectionSearchString(this._editor,C.seedSearchStringFromSelection);U&&(V.searchString=U)}if(!V.searchString&&C.seedSearchStringFromGlobalClipboard){const U=yield this.getGlobalBufferTerm();if(!this._editor.hasModel())return;U&&(V.searchString=U)}if(C.forceRevealReplace||V.isReplaceRevealed?V.isReplaceRevealed=!0:this._findWidgetVisible.get()||(V.isReplaceRevealed=!1),C.updateSearchScope){const U=this._editor.getSelections();U.some(G=>!G.isEmpty())&&(V.searchScope=U)}V.loop=C.loop,this._state.change(V,!1),this._model||(this._model=new FindModelBoundToEditorModel(this._editor,this._state))})}start(C,W){return this._start(C,W)}moveToNextMatch(){return this._model?(this._model.moveToNextMatch(),!0):!1}moveToPrevMatch(){return this._model?(this._model.moveToPrevMatch(),!0):!1}goToMatch(C){return this._model?(this._model.moveToMatch(C),!0):!1}replace(){return this._model?(this._model.replace(),!0):!1}replaceAll(){var C;return this._model?!((C=this._editor.getModel())===null||C===void 0)&&C.isTooLargeForHeapOperation()?(this._notificationService.warn(localize("too.large.for.replaceall","The file is too large to perform a replace all operation.")),!1):(this._model.replaceAll(),!0):!1}selectAllMatches(){return this._model?(this._model.selectAllMatches(),this._editor.focus(),!0):!1}getGlobalBufferTerm(){return __awaiter$B(this,void 0,void 0,function*(){return this._editor.getOption(41).globalFindClipboard&&this._editor.hasModel()&&!this._editor.getModel().isTooLargeForSyncing()?this._clipboardService.readFindText():""})}setGlobalBufferTerm(C){this._editor.getOption(41).globalFindClipboard&&this._editor.hasModel()&&!this._editor.getModel().isTooLargeForSyncing()&&this._clipboardService.writeFindText(C)}};CommonFindController.ID="editor.contrib.findController";CommonFindController=CommonFindController_1=__decorate$Q([__param$Q(1,IContextKeyService),__param$Q(2,IStorageService),__param$Q(3,IClipboardService),__param$Q(4,INotificationService)],CommonFindController);let FindController=class extends CommonFindController{constructor(C,W,V,U,G,Z,X,Q){super(C,V,X,Q,Z),this._contextViewService=W,this._keybindingService=U,this._themeService=G,this._widget=null,this._findOptionsWidget=null}_start(C,W){const V=Object.create(null,{_start:{get:()=>super._start}});return __awaiter$B(this,void 0,void 0,function*(){this._widget||this._createFindWidget();const U=this._editor.getSelection();let G=!1;switch(this._editor.getOption(41).autoFindInSelection){case"always":G=!0;break;case"never":G=!1;break;case"multiline":{G=!!U&&U.startLineNumber!==U.endLineNumber;break}}C.updateSearchScope=C.updateSearchScope||G,yield V._start.call(this,C,W),this._widget&&(C.shouldFocus===2?this._widget.focusReplaceInput():C.shouldFocus===1&&this._widget.focusFindInput())})}highlightFindOptions(C=!1){this._widget||this._createFindWidget(),this._state.isRevealed&&!C?this._widget.highlightFindOptions():this._findOptionsWidget.highlightFindOptions()}_createFindWidget(){this._widget=this._register(new FindWidget(this._editor,this,this._state,this._contextViewService,this._keybindingService,this._contextKeyService,this._themeService,this._storageService,this._notificationService)),this._findOptionsWidget=this._register(new FindOptionsWidget(this._editor,this._state,this._keybindingService))}};FindController=__decorate$Q([__param$Q(1,IContextViewService),__param$Q(2,IContextKeyService),__param$Q(3,IKeybindingService),__param$Q(4,IThemeService),__param$Q(5,INotificationService),__param$Q(6,IStorageService),__param$Q(7,IClipboardService)],FindController);const StartFindAction=registerMultiEditorAction(new MultiEditorAction({id:FIND_IDS.StartFindAction,label:localize("startFindAction","Find"),alias:"Find",precondition:ContextKeyExpr.or(EditorContextKeys.focus,ContextKeyExpr.has("editorIsOpen")),kbOpts:{kbExpr:null,primary:2084,weight:100},menuOpts:{menuId:MenuId.MenubarEditMenu,group:"3_find",title:localize({key:"miFind",comment:["&& denotes a mnemonic"]},"&&Find"),order:1}}));StartFindAction.addImplementation(0,(K,C,W)=>{const V=CommonFindController.get(C);return V?V.start({forceRevealReplace:!1,seedSearchStringFromSelection:C.getOption(41).seedSearchStringFromSelection!=="never"?"single":"none",seedSearchStringFromNonEmptySelection:C.getOption(41).seedSearchStringFromSelection==="selection",seedSearchStringFromGlobalClipboard:C.getOption(41).globalFindClipboard,shouldFocus:1,shouldAnimate:!0,updateSearchScope:!1,loop:C.getOption(41).loop}):!1});const findArgDescription={description:"Open a new In-Editor Find Widget.",args:[{name:"Open a new In-Editor Find Widget args",schema:{properties:{searchString:{type:"string"},replaceString:{type:"string"},regex:{type:"boolean"},regexOverride:{type:"number",description:localize("actions.find.isRegexOverride",`Overrides "Use Regular Expression" flag.
The flag will not be saved for the future.
0: Do Nothing
1: True
2: False`)},wholeWord:{type:"boolean"},wholeWordOverride:{type:"number",description:localize("actions.find.wholeWordOverride",`Overrides "Match Whole Word" flag.
The flag will not be saved for the future.
0: Do Nothing
1: True
2: False`)},matchCase:{type:"boolean"},matchCaseOverride:{type:"number",description:localize("actions.find.matchCaseOverride",`Overrides "Math Case" flag.
The flag will not be saved for the future.
0: Do Nothing
1: True
2: False`)},preserveCase:{type:"boolean"},preserveCaseOverride:{type:"number",description:localize("actions.find.preserveCaseOverride",`Overrides "Preserve Case" flag.
The flag will not be saved for the future.
0: Do Nothing
1: True
2: False`)},findInSelection:{type:"boolean"}}}}]};class StartFindWithArgsAction extends EditorAction{constructor(){super({id:FIND_IDS.StartFindWithArgs,label:localize("startFindWithArgsAction","Find With Arguments"),alias:"Find With Arguments",precondition:void 0,kbOpts:{kbExpr:null,primary:0,weight:100},description:findArgDescription})}run(C,W,V){return __awaiter$B(this,void 0,void 0,function*(){const U=CommonFindController.get(W);if(U){const G=V?{searchString:V.searchString,replaceString:V.replaceString,isReplaceRevealed:V.replaceString!==void 0,isRegex:V.isRegex,wholeWord:V.matchWholeWord,matchCase:V.isCaseSensitive,preserveCase:V.preserveCase}:{};yield U.start({forceRevealReplace:!1,seedSearchStringFromSelection:U.getState().searchString.length===0&&W.getOption(41).seedSearchStringFromSelection!=="never"?"single":"none",seedSearchStringFromNonEmptySelection:W.getOption(41).seedSearchStringFromSelection==="selection",seedSearchStringFromGlobalClipboard:!0,shouldFocus:1,shouldAnimate:!0,updateSearchScope:(V==null?void 0:V.findInSelection)||!1,loop:W.getOption(41).loop},G),U.setGlobalBufferTerm(U.getState().searchString)}})}}class StartFindWithSelectionAction extends EditorAction{constructor(){super({id:FIND_IDS.StartFindWithSelection,label:localize("startFindWithSelectionAction","Find With Selection"),alias:"Find With Selection",precondition:void 0,kbOpts:{kbExpr:null,primary:0,mac:{primary:2083},weight:100}})}run(C,W){return __awaiter$B(this,void 0,void 0,function*(){const V=CommonFindController.get(W);V&&(yield V.start({forceRevealReplace:!1,seedSearchStringFromSelection:"multiple",seedSearchStringFromNonEmptySelection:!1,seedSearchStringFromGlobalClipboard:!1,shouldFocus:0,shouldAnimate:!0,updateSearchScope:!1,loop:W.getOption(41).loop}),V.setGlobalBufferTerm(V.getState().searchString))})}}class MatchFindAction extends EditorAction{run(C,W){return __awaiter$B(this,void 0,void 0,function*(){const V=CommonFindController.get(W);V&&!this._run(V)&&(yield V.start({forceRevealReplace:!1,seedSearchStringFromSelection:V.getState().searchString.length===0&&W.getOption(41).seedSearchStringFromSelection!=="never"?"single":"none",seedSearchStringFromNonEmptySelection:W.getOption(41).seedSearchStringFromSelection==="selection",seedSearchStringFromGlobalClipboard:!0,shouldFocus:0,shouldAnimate:!0,updateSearchScope:!1,loop:W.getOption(41).loop}),this._run(V))})}}class NextMatchFindAction extends MatchFindAction{constructor(){super({id:FIND_IDS.NextMatchFindAction,label:localize("findNextMatchAction","Find Next"),alias:"Find Next",precondition:void 0,kbOpts:[{kbExpr:EditorContextKeys.focus,primary:61,mac:{primary:2085,secondary:[61]},weight:100},{kbExpr:ContextKeyExpr.and(EditorContextKeys.focus,CONTEXT_FIND_INPUT_FOCUSED),primary:3,weight:100}]})}_run(C){return C.moveToNextMatch()?(C.editor.pushUndoStop(),!0):!1}}class PreviousMatchFindAction extends MatchFindAction{constructor(){super({id:FIND_IDS.PreviousMatchFindAction,label:localize("findPreviousMatchAction","Find Previous"),alias:"Find Previous",precondition:void 0,kbOpts:[{kbExpr:EditorContextKeys.focus,primary:1085,mac:{primary:3109,secondary:[1085]},weight:100},{kbExpr:ContextKeyExpr.and(EditorContextKeys.focus,CONTEXT_FIND_INPUT_FOCUSED),primary:1027,weight:100}]})}_run(C){return C.moveToPrevMatch()}}class MoveToMatchFindAction extends EditorAction{constructor(){super({id:FIND_IDS.GoToMatchFindAction,label:localize("findMatchAction.goToMatch","Go to Match..."),alias:"Go to Match...",precondition:CONTEXT_FIND_WIDGET_VISIBLE}),this._highlightDecorations=[]}run(C,W,V){const U=CommonFindController.get(W);if(!U)return;const G=U.getState().matchesCount;if(G<1){C.get(INotificationService).notify({severity:Severity.Warning,message:localize("findMatchAction.noResults","No matches. Try searching for something else.")});return}const X=C.get(IQuickInputService).createInputBox();X.placeholder=localize("findMatchAction.inputPlaceHolder","Type a number to go to a specific match (between 1 and {0})",G);const Q=ee=>{const te=parseInt(ee);if(isNaN(te))return;const ie=U.getState().matchesCount;if(te>0&&te<=ie)return te-1;if(te<0&&te>=-ie)return ie+te},J=ee=>{const te=Q(ee);if(typeof te=="number"){X.validationMessage=void 0,U.goToMatch(te);const ie=U.getState().currentMatch;ie&&this.addDecorations(W,ie)}else X.validationMessage=localize("findMatchAction.inputValidationMessage","Please type a number between 1 and {0}",U.getState().matchesCount),this.clearDecorations(W)};X.onDidChangeValue(ee=>{J(ee)}),X.onDidAccept(()=>{const ee=Q(X.value);typeof ee=="number"?(U.goToMatch(ee),X.hide()):X.validationMessage=localize("findMatchAction.inputValidationMessage","Please type a number between 1 and {0}",U.getState().matchesCount)}),X.onDidHide(()=>{this.clearDecorations(W),X.dispose()}),X.show()}clearDecorations(C){C.changeDecorations(W=>{this._highlightDecorations=W.deltaDecorations(this._highlightDecorations,[])})}addDecorations(C,W){C.changeDecorations(V=>{this._highlightDecorations=V.deltaDecorations(this._highlightDecorations,[{range:W,options:{description:"find-match-quick-access-range-highlight",className:"rangeHighlight",isWholeLine:!0}},{range:W,options:{description:"find-match-quick-access-range-highlight-overview",overviewRuler:{color:themeColorFromId(overviewRulerRangeHighlight),position:OverviewRulerLane.Full}}}])})}}class SelectionMatchFindAction extends EditorAction{run(C,W){return __awaiter$B(this,void 0,void 0,function*(){const V=CommonFindController.get(W);if(!V)return;const U=getSelectionSearchString(W,"single",!1);U&&V.setSearchString(U),this._run(V)||(yield V.start({forceRevealReplace:!1,seedSearchStringFromSelection:"none",seedSearchStringFromNonEmptySelection:!1,seedSearchStringFromGlobalClipboard:!1,shouldFocus:0,shouldAnimate:!0,updateSearchScope:!1,loop:W.getOption(41).loop}),this._run(V))})}}class NextSelectionMatchFindAction extends SelectionMatchFindAction{constructor(){super({id:FIND_IDS.NextSelectionMatchFindAction,label:localize("nextSelectionMatchFindAction","Find Next Selection"),alias:"Find Next Selection",precondition:void 0,kbOpts:{kbExpr:EditorContextKeys.focus,primary:2109,weight:100}})}_run(C){return C.moveToNextMatch()}}class PreviousSelectionMatchFindAction extends SelectionMatchFindAction{constructor(){super({id:FIND_IDS.PreviousSelectionMatchFindAction,label:localize("previousSelectionMatchFindAction","Find Previous Selection"),alias:"Find Previous Selection",precondition:void 0,kbOpts:{kbExpr:EditorContextKeys.focus,primary:3133,weight:100}})}_run(C){return C.moveToPrevMatch()}}const StartFindReplaceAction=registerMultiEditorAction(new MultiEditorAction({id:FIND_IDS.StartFindReplaceAction,label:localize("startReplace","Replace"),alias:"Replace",precondition:ContextKeyExpr.or(EditorContextKeys.focus,ContextKeyExpr.has("editorIsOpen")),kbOpts:{kbExpr:null,primary:2086,mac:{primary:2596},weight:100},menuOpts:{menuId:MenuId.MenubarEditMenu,group:"3_find",title:localize({key:"miReplace",comment:["&& denotes a mnemonic"]},"&&Replace"),order:2}}));StartFindReplaceAction.addImplementation(0,(K,C,W)=>{if(!C.hasModel()||C.getOption(90))return!1;const V=CommonFindController.get(C);if(!V)return!1;const U=C.getSelection(),G=V.isFindInputFocused(),Z=!U.isEmpty()&&U.startLineNumber===U.endLineNumber&&C.getOption(41).seedSearchStringFromSelection!=="never"&&!G,X=G||Z?2:1;return V.start({forceRevealReplace:!0,seedSearchStringFromSelection:Z?"single":"none",seedSearchStringFromNonEmptySelection:C.getOption(41).seedSearchStringFromSelection==="selection",seedSearchStringFromGlobalClipboard:C.getOption(41).seedSearchStringFromSelection!=="never",shouldFocus:X,shouldAnimate:!0,updateSearchScope:!1,loop:C.getOption(41).loop})});registerEditorContribution(CommonFindController.ID,FindController,0);registerEditorAction(StartFindWithArgsAction);registerEditorAction(StartFindWithSelectionAction);registerEditorAction(NextMatchFindAction);registerEditorAction(PreviousMatchFindAction);registerEditorAction(MoveToMatchFindAction);registerEditorAction(NextSelectionMatchFindAction);registerEditorAction(PreviousSelectionMatchFindAction);const FindCommand=EditorCommand.bindToContribution(CommonFindController.get);registerEditorCommand(new FindCommand({id:FIND_IDS.CloseFindWidgetCommand,precondition:CONTEXT_FIND_WIDGET_VISIBLE,handler:K=>K.closeFindWidget(),kbOpts:{weight:100+5,kbExpr:ContextKeyExpr.and(EditorContextKeys.focus,ContextKeyExpr.not("isComposing")),primary:9,secondary:[1033]}}));registerEditorCommand(new FindCommand({id:FIND_IDS.ToggleCaseSensitiveCommand,precondition:void 0,handler:K=>K.toggleCaseSensitive(),kbOpts:{weight:100+5,kbExpr:EditorContextKeys.focus,primary:ToggleCaseSensitiveKeybinding.primary,mac:ToggleCaseSensitiveKeybinding.mac,win:ToggleCaseSensitiveKeybinding.win,linux:ToggleCaseSensitiveKeybinding.linux}}));registerEditorCommand(new FindCommand({id:FIND_IDS.ToggleWholeWordCommand,precondition:void 0,handler:K=>K.toggleWholeWords(),kbOpts:{weight:100+5,kbExpr:EditorContextKeys.focus,primary:ToggleWholeWordKeybinding.primary,mac:ToggleWholeWordKeybinding.mac,win:ToggleWholeWordKeybinding.win,linux:ToggleWholeWordKeybinding.linux}}));registerEditorCommand(new FindCommand({id:FIND_IDS.ToggleRegexCommand,precondition:void 0,handler:K=>K.toggleRegex(),kbOpts:{weight:100+5,kbExpr:EditorContextKeys.focus,primary:ToggleRegexKeybinding.primary,mac:ToggleRegexKeybinding.mac,win:ToggleRegexKeybinding.win,linux:ToggleRegexKeybinding.linux}}));registerEditorCommand(new FindCommand({id:FIND_IDS.ToggleSearchScopeCommand,precondition:void 0,handler:K=>K.toggleSearchScope(),kbOpts:{weight:100+5,kbExpr:EditorContextKeys.focus,primary:ToggleSearchScopeKeybinding.primary,mac:ToggleSearchScopeKeybinding.mac,win:ToggleSearchScopeKeybinding.win,linux:ToggleSearchScopeKeybinding.linux}}));registerEditorCommand(new FindCommand({id:FIND_IDS.TogglePreserveCaseCommand,precondition:void 0,handler:K=>K.togglePreserveCase(),kbOpts:{weight:100+5,kbExpr:EditorContextKeys.focus,primary:TogglePreserveCaseKeybinding.primary,mac:TogglePreserveCaseKeybinding.mac,win:TogglePreserveCaseKeybinding.win,linux:TogglePreserveCaseKeybinding.linux}}));registerEditorCommand(new FindCommand({id:FIND_IDS.ReplaceOneAction,precondition:CONTEXT_FIND_WIDGET_VISIBLE,handler:K=>K.replace(),kbOpts:{weight:100+5,kbExpr:EditorContextKeys.focus,primary:3094}}));registerEditorCommand(new FindCommand({id:FIND_IDS.ReplaceOneAction,precondition:CONTEXT_FIND_WIDGET_VISIBLE,handler:K=>K.replace(),kbOpts:{weight:100+5,kbExpr:ContextKeyExpr.and(EditorContextKeys.focus,CONTEXT_REPLACE_INPUT_FOCUSED),primary:3}}));registerEditorCommand(new FindCommand({id:FIND_IDS.ReplaceAllAction,precondition:CONTEXT_FIND_WIDGET_VISIBLE,handler:K=>K.replaceAll(),kbOpts:{weight:100+5,kbExpr:EditorContextKeys.focus,primary:2563}}));registerEditorCommand(new FindCommand({id:FIND_IDS.ReplaceAllAction,precondition:CONTEXT_FIND_WIDGET_VISIBLE,handler:K=>K.replaceAll(),kbOpts:{weight:100+5,kbExpr:ContextKeyExpr.and(EditorContextKeys.focus,CONTEXT_REPLACE_INPUT_FOCUSED),primary:void 0,mac:{primary:2051}}}));registerEditorCommand(new FindCommand({id:FIND_IDS.SelectAllMatchesAction,precondition:CONTEXT_FIND_WIDGET_VISIBLE,handler:K=>K.selectAllMatches(),kbOpts:{weight:100+5,kbExpr:EditorContextKeys.focus,primary:515}}));const folding="",foldSourceAbbr={0:" ",1:"u",2:"r"},MAX_FOLDING_REGIONS=65535,MAX_LINE_NUMBER=16777215,MASK_INDENT=4278190080;class BitField{constructor(C){const W=Math.ceil(C/32);this._states=new Uint32Array(W)}get(C){const W=C/32|0,V=C%32;return(this._states[W]&1<<V)!==0}set(C,W){const V=C/32|0,U=C%32,G=this._states[V];W?this._states[V]=G|1<<U:this._states[V]=G&~(1<<U)}}class FoldingRegions{constructor(C,W,V){if(C.length!==W.length||C.length>MAX_FOLDING_REGIONS)throw new Error("invalid startIndexes or endIndexes size");this._startIndexes=C,this._endIndexes=W,this._collapseStates=new BitField(C.length),this._userDefinedStates=new BitField(C.length),this._recoveredStates=new BitField(C.length),this._types=V,this._parentsComputed=!1}ensureParentIndices(){if(!this._parentsComputed){this._parentsComputed=!0;const C=[],W=(V,U)=>{const G=C[C.length-1];return this.getStartLineNumber(G)<=V&&this.getEndLineNumber(G)>=U};for(let V=0,U=this._startIndexes.length;V<U;V++){const G=this._startIndexes[V],Z=this._endIndexes[V];if(G>MAX_LINE_NUMBER||Z>MAX_LINE_NUMBER)throw new Error("startLineNumber or endLineNumber must not exceed "+MAX_LINE_NUMBER);for(;C.length>0&&!W(G,Z);)C.pop();const X=C.length>0?C[C.length-1]:-1;C.push(V),this._startIndexes[V]=G+((X&255)<<24),this._endIndexes[V]=Z+((X&65280)<<16)}}}get length(){return this._startIndexes.length}getStartLineNumber(C){return this._startIndexes[C]&MAX_LINE_NUMBER}getEndLineNumber(C){return this._endIndexes[C]&MAX_LINE_NUMBER}getType(C){return this._types?this._types[C]:void 0}hasTypes(){return!!this._types}isCollapsed(C){return this._collapseStates.get(C)}setCollapsed(C,W){this._collapseStates.set(C,W)}isUserDefined(C){return this._userDefinedStates.get(C)}setUserDefined(C,W){return this._userDefinedStates.set(C,W)}isRecovered(C){return this._recoveredStates.get(C)}setRecovered(C,W){return this._recoveredStates.set(C,W)}getSource(C){return this.isUserDefined(C)?1:this.isRecovered(C)?2:0}setSource(C,W){W===1?(this.setUserDefined(C,!0),this.setRecovered(C,!1)):W===2?(this.setUserDefined(C,!1),this.setRecovered(C,!0)):(this.setUserDefined(C,!1),this.setRecovered(C,!1))}setCollapsedAllOfType(C,W){let V=!1;if(this._types)for(let U=0;U<this._types.length;U++)this._types[U]===C&&(this.setCollapsed(U,W),V=!0);return V}toRegion(C){return new FoldingRegion(this,C)}getParentIndex(C){this.ensureParentIndices();const W=((this._startIndexes[C]&MASK_INDENT)>>>24)+((this._endIndexes[C]&MASK_INDENT)>>>16);return W===MAX_FOLDING_REGIONS?-1:W}contains(C,W){return this.getStartLineNumber(C)<=W&&this.getEndLineNumber(C)>=W}findIndex(C){let W=0,V=this._startIndexes.length;if(V===0)return-1;for(;W<V;){const U=Math.floor((W+V)/2);C<this.getStartLineNumber(U)?V=U:W=U+1}return W-1}findRange(C){let W=this.findIndex(C);if(W>=0){if(this.getEndLineNumber(W)>=C)return W;for(W=this.getParentIndex(W);W!==-1;){if(this.contains(W,C))return W;W=this.getParentIndex(W)}}return-1}toString(){const C=[];for(let W=0;W<this.length;W++)C[W]=`[${foldSourceAbbr[this.getSource(W)]}${this.isCollapsed(W)?"+":"-"}] ${this.getStartLineNumber(W)}/${this.getEndLineNumber(W)}`;return C.join(", ")}toFoldRange(C){return{startLineNumber:this._startIndexes[C]&MAX_LINE_NUMBER,endLineNumber:this._endIndexes[C]&MAX_LINE_NUMBER,type:this._types?this._types[C]:void 0,isCollapsed:this.isCollapsed(C),source:this.getSource(C)}}static fromFoldRanges(C){const W=C.length,V=new Uint32Array(W),U=new Uint32Array(W);let G=[],Z=!1;for(let Q=0;Q<W;Q++){const J=C[Q];V[Q]=J.startLineNumber,U[Q]=J.endLineNumber,G.push(J.type),J.type&&(Z=!0)}Z||(G=void 0);const X=new FoldingRegions(V,U,G);for(let Q=0;Q<W;Q++)C[Q].isCollapsed&&X.setCollapsed(Q,!0),X.setSource(Q,C[Q].source);return X}static sanitizeAndMerge(C,W,V){V=V??Number.MAX_VALUE;const U=(re,ae)=>Array.isArray(re)?se=>se<ae?re[se]:void 0:se=>se<ae?re.toFoldRange(se):void 0,G=U(C,C.length),Z=U(W,W.length);let X=0,Q=0,J=G(0),ee=Z(0);const te=[];let ie,ne=0;const oe=[];for(;J||ee;){let re;if(ee&&(!J||J.startLineNumber>=ee.startLineNumber))J&&J.startLineNumber===ee.startLineNumber?(ee.source===1?re=ee:(re=J,re.isCollapsed=ee.isCollapsed&&J.endLineNumber===ee.endLineNumber,re.source=0),J=G(++X)):(re=ee,ee.isCollapsed&&ee.source===0&&(re.source=2)),ee=Z(++Q);else{let ae=Q,se=ee;for(;;){if(!se||se.startLineNumber>J.endLineNumber){re=J;break}if(se.source===1&&se.endLineNumber>J.endLineNumber)break;se=Z(++ae)}J=G(++X)}if(re){for(;ie&&ie.endLineNumber<re.startLineNumber;)ie=te.pop();re.endLineNumber>re.startLineNumber&&re.startLineNumber>ne&&re.endLineNumber<=V&&(!ie||ie.endLineNumber>=re.endLineNumber)&&(oe.push(re),ne=re.startLineNumber,ie&&te.push(ie),ie=re)}}return oe}}class FoldingRegion{constructor(C,W){this.ranges=C,this.index=W}get startLineNumber(){return this.ranges.getStartLineNumber(this.index)}get endLineNumber(){return this.ranges.getEndLineNumber(this.index)}get regionIndex(){return this.index}get parentIndex(){return this.ranges.getParentIndex(this.index)}get isCollapsed(){return this.ranges.isCollapsed(this.index)}containedBy(C){return C.startLineNumber<=this.startLineNumber&&C.endLineNumber>=this.endLineNumber}containsLine(C){return this.startLineNumber<=C&&C<=this.endLineNumber}}class FoldingModel{get regions(){return this._regions}get textModel(){return this._textModel}constructor(C,W){this._updateEventEmitter=new Emitter$1,this.onDidChange=this._updateEventEmitter.event,this._textModel=C,this._decorationProvider=W,this._regions=new FoldingRegions(new Uint32Array(0),new Uint32Array(0)),this._editorDecorationIds=[]}toggleCollapseState(C){if(!C.length)return;C=C.sort((V,U)=>V.regionIndex-U.regionIndex);const W={};this._decorationProvider.changeDecorations(V=>{let U=0,G=-1,Z=-1;const X=Q=>{for(;U<Q;){const J=this._regions.getEndLineNumber(U),ee=this._regions.isCollapsed(U);if(J<=G){const te=this.regions.getSource(U)!==0;V.changeDecorationOptions(this._editorDecorationIds[U],this._decorationProvider.getDecorationOption(ee,J<=Z,te))}ee&&J>Z&&(Z=J),U++}};for(const Q of C){const J=Q.regionIndex,ee=this._editorDecorationIds[J];if(ee&&!W[ee]){W[ee]=!0,X(J);const te=!this._regions.isCollapsed(J);this._regions.setCollapsed(J,te),G=Math.max(G,this._regions.getEndLineNumber(J))}}X(this._regions.length)}),this._updateEventEmitter.fire({model:this,collapseStateChanged:C})}removeManualRanges(C){const W=new Array,V=U=>{for(const G of C)if(!(G.startLineNumber>U.endLineNumber||U.startLineNumber>G.endLineNumber))return!0;return!1};for(let U=0;U<this._regions.length;U++){const G=this._regions.toFoldRange(U);(G.source===0||!V(G))&&W.push(G)}this.updatePost(FoldingRegions.fromFoldRanges(W))}update(C,W=[]){const V=this._currentFoldedOrManualRanges(W),U=FoldingRegions.sanitizeAndMerge(C,V,this._textModel.getLineCount());this.updatePost(FoldingRegions.fromFoldRanges(U))}updatePost(C){const W=[];let V=-1;for(let U=0,G=C.length;U<G;U++){const Z=C.getStartLineNumber(U),X=C.getEndLineNumber(U),Q=C.isCollapsed(U),J=C.getSource(U)!==0,ee={startLineNumber:Z,startColumn:this._textModel.getLineMaxColumn(Z),endLineNumber:X,endColumn:this._textModel.getLineMaxColumn(X)+1};W.push({range:ee,options:this._decorationProvider.getDecorationOption(Q,X<=V,J)}),Q&&X>V&&(V=X)}this._decorationProvider.changeDecorations(U=>this._editorDecorationIds=U.deltaDecorations(this._editorDecorationIds,W)),this._regions=C,this._updateEventEmitter.fire({model:this})}_currentFoldedOrManualRanges(C=[]){const W=(U,G)=>{for(const Z of C)if(U<Z&&Z<=G)return!0;return!1},V=[];for(let U=0,G=this._regions.length;U<G;U++){let Z=this.regions.isCollapsed(U);const X=this.regions.getSource(U);if(Z||X!==0){const Q=this._regions.toFoldRange(U),J=this._textModel.getDecorationRange(this._editorDecorationIds[U]);J&&(Z&&W(J.startLineNumber,J.endLineNumber)&&(Z=!1),V.push({startLineNumber:J.startLineNumber,endLineNumber:J.endLineNumber,type:Q.type,isCollapsed:Z,source:X}))}}return V}getMemento(){const C=this._currentFoldedOrManualRanges(),W=[],V=this._textModel.getLineCount();for(let U=0,G=C.length;U<G;U++){const Z=C[U];if(Z.startLineNumber>=Z.endLineNumber||Z.startLineNumber<1||Z.endLineNumber>V)continue;const X=this._getLinesChecksum(Z.startLineNumber+1,Z.endLineNumber);W.push({startLineNumber:Z.startLineNumber,endLineNumber:Z.endLineNumber,isCollapsed:Z.isCollapsed,source:Z.source,checksum:X})}return W.length>0?W:void 0}applyMemento(C){var W,V;if(!Array.isArray(C))return;const U=[],G=this._textModel.getLineCount();for(const X of C){if(X.startLineNumber>=X.endLineNumber||X.startLineNumber<1||X.endLineNumber>G)continue;const Q=this._getLinesChecksum(X.startLineNumber+1,X.endLineNumber);(!X.checksum||Q===X.checksum)&&U.push({startLineNumber:X.startLineNumber,endLineNumber:X.endLineNumber,type:void 0,isCollapsed:(W=X.isCollapsed)!==null&&W!==void 0?W:!0,source:(V=X.source)!==null&&V!==void 0?V:0})}const Z=FoldingRegions.sanitizeAndMerge(this._regions,U,G);this.updatePost(FoldingRegions.fromFoldRanges(Z))}_getLinesChecksum(C,W){return hash(this._textModel.getLineContent(C)+this._textModel.getLineContent(W))%1e6}dispose(){this._decorationProvider.removeDecorations(this._editorDecorationIds)}getAllRegionsAtLine(C,W){const V=[];if(this._regions){let U=this._regions.findRange(C),G=1;for(;U>=0;){const Z=this._regions.toRegion(U);(!W||W(Z,G))&&V.push(Z),G++,U=Z.parentIndex}}return V}getRegionAtLine(C){if(this._regions){const W=this._regions.findRange(C);if(W>=0)return this._regions.toRegion(W)}return null}getRegionsInside(C,W){const V=[],U=C?C.regionIndex+1:0,G=C?C.endLineNumber:Number.MAX_VALUE;if(W&&W.length===2){const Z=[];for(let X=U,Q=this._regions.length;X<Q;X++){const J=this._regions.toRegion(X);if(this._regions.getStartLineNumber(X)<G){for(;Z.length>0&&!J.containedBy(Z[Z.length-1]);)Z.pop();Z.push(J),W(J,Z.length)&&V.push(J)}else break}}else for(let Z=U,X=this._regions.length;Z<X;Z++){const Q=this._regions.toRegion(Z);if(this._regions.getStartLineNumber(Z)<G)(!W||W(Q))&&V.push(Q);else break}return V}}function toggleCollapseState(K,C,W){const V=[];for(const U of W){const G=K.getRegionAtLine(U);if(G){const Z=!G.isCollapsed;if(V.push(G),C>1){const X=K.getRegionsInside(G,(Q,J)=>Q.isCollapsed!==Z&&J<C);V.push(...X)}}}K.toggleCollapseState(V)}function setCollapseStateLevelsDown(K,C,W=Number.MAX_VALUE,V){const U=[];if(V&&V.length>0)for(const G of V){const Z=K.getRegionAtLine(G);if(Z&&(Z.isCollapsed!==C&&U.push(Z),W>1)){const X=K.getRegionsInside(Z,(Q,J)=>Q.isCollapsed!==C&&J<W);U.push(...X)}}else{const G=K.getRegionsInside(null,(Z,X)=>Z.isCollapsed!==C&&X<W);U.push(...G)}K.toggleCollapseState(U)}function setCollapseStateLevelsUp(K,C,W,V){const U=[];for(const G of V){const Z=K.getAllRegionsAtLine(G,(X,Q)=>X.isCollapsed!==C&&Q<=W);U.push(...Z)}K.toggleCollapseState(U)}function setCollapseStateUp(K,C,W){const V=[];for(const U of W){const G=K.getAllRegionsAtLine(U,Z=>Z.isCollapsed!==C);G.length>0&&V.push(G[0])}K.toggleCollapseState(V)}function setCollapseStateAtLevel(K,C,W,V){const U=(Z,X)=>X===C&&Z.isCollapsed!==W&&!V.some(Q=>Z.containsLine(Q)),G=K.getRegionsInside(null,U);K.toggleCollapseState(G)}function setCollapseStateForRest(K,C,W){const V=[];for(const Z of W){const X=K.getAllRegionsAtLine(Z,void 0);X.length>0&&V.push(X[0])}const U=Z=>V.every(X=>!X.containedBy(Z)&&!Z.containedBy(X))&&Z.isCollapsed!==C,G=K.getRegionsInside(null,U);K.toggleCollapseState(G)}function setCollapseStateForMatchingLines(K,C,W){const V=K.textModel,U=K.regions,G=[];for(let Z=U.length-1;Z>=0;Z--)if(W!==U.isCollapsed(Z)){const X=U.getStartLineNumber(Z);C.test(V.getLineContent(X))&&G.push(U.toRegion(Z))}K.toggleCollapseState(G)}function setCollapseStateForType(K,C,W){const V=K.regions,U=[];for(let G=V.length-1;G>=0;G--)W!==V.isCollapsed(G)&&C===V.getType(G)&&U.push(V.toRegion(G));K.toggleCollapseState(U)}function getParentFoldLine(K,C){let W=null;const V=C.getRegionAtLine(K);if(V!==null&&(W=V.startLineNumber,K===W)){const U=V.parentIndex;U!==-1?W=C.regions.getStartLineNumber(U):W=null}return W}function getPreviousFoldLine(K,C){let W=C.getRegionAtLine(K);if(W!==null&&W.startLineNumber===K){if(K!==W.startLineNumber)return W.startLineNumber;{const V=W.parentIndex;let U=0;for(V!==-1&&(U=C.regions.getStartLineNumber(W.parentIndex));W!==null;)if(W.regionIndex>0){if(W=C.regions.toRegion(W.regionIndex-1),W.startLineNumber<=U)return null;if(W.parentIndex===V)return W.startLineNumber}else return null}}else if(C.regions.length>0)for(W=C.regions.toRegion(C.regions.length-1);W!==null;){if(W.startLineNumber<K)return W.startLineNumber;W.regionIndex>0?W=C.regions.toRegion(W.regionIndex-1):W=null}return null}function getNextFoldLine(K,C){let W=C.getRegionAtLine(K);if(W!==null&&W.startLineNumber===K){const V=W.parentIndex;let U=0;if(V!==-1)U=C.regions.getEndLineNumber(W.parentIndex);else{if(C.regions.length===0)return null;U=C.regions.getEndLineNumber(C.regions.length-1)}for(;W!==null;)if(W.regionIndex<C.regions.length){if(W=C.regions.toRegion(W.regionIndex+1),W.startLineNumber>=U)return null;if(W.parentIndex===V)return W.startLineNumber}else return null}else if(C.regions.length>0)for(W=C.regions.toRegion(0);W!==null;){if(W.startLineNumber>K)return W.startLineNumber;W.regionIndex<C.regions.length?W=C.regions.toRegion(W.regionIndex+1):W=null}return null}class HiddenRangeModel{get onDidChange(){return this._updateEventEmitter.event}get hiddenRanges(){return this._hiddenRanges}constructor(C){this._updateEventEmitter=new Emitter$1,this._hasLineChanges=!1,this._foldingModel=C,this._foldingModelListener=C.onDidChange(W=>this.updateHiddenRanges()),this._hiddenRanges=[],C.regions.length&&this.updateHiddenRanges()}notifyChangeModelContent(C){this._hiddenRanges.length&&!this._hasLineChanges&&(this._hasLineChanges=C.changes.some(W=>W.range.endLineNumber!==W.range.startLineNumber||countEOL(W.text)[0]!==0))}updateHiddenRanges(){let C=!1;const W=[];let V=0,U=0,G=Number.MAX_VALUE,Z=-1;const X=this._foldingModel.regions;for(;V<X.length;V++){if(!X.isCollapsed(V))continue;const Q=X.getStartLineNumber(V)+1,J=X.getEndLineNumber(V);G<=Q&&J<=Z||(!C&&U<this._hiddenRanges.length&&this._hiddenRanges[U].startLineNumber===Q&&this._hiddenRanges[U].endLineNumber===J?(W.push(this._hiddenRanges[U]),U++):(C=!0,W.push(new Range$2(Q,1,J,1))),G=Q,Z=J)}(this._hasLineChanges||C||U<this._hiddenRanges.length)&&this.applyHiddenRanges(W)}applyHiddenRanges(C){this._hiddenRanges=C,this._hasLineChanges=!1,this._updateEventEmitter.fire(C)}hasRanges(){return this._hiddenRanges.length>0}isHidden(C){return findRange(this._hiddenRanges,C)!==null}adjustSelections(C){let W=!1;const V=this._foldingModel.textModel;let U=null;const G=Z=>((!U||!isInside(Z,U))&&(U=findRange(this._hiddenRanges,Z)),U?U.startLineNumber-1:null);for(let Z=0,X=C.length;Z<X;Z++){let Q=C[Z];const J=G(Q.startLineNumber);J&&(Q=Q.setStartPosition(J,V.getLineMaxColumn(J)),W=!0);const ee=G(Q.endLineNumber);ee&&(Q=Q.setEndPosition(ee,V.getLineMaxColumn(ee)),W=!0),C[Z]=Q}return W}dispose(){this.hiddenRanges.length>0&&(this._hiddenRanges=[],this._updateEventEmitter.fire(this._hiddenRanges)),this._foldingModelListener&&(this._foldingModelListener.dispose(),this._foldingModelListener=null)}}function isInside(K,C){return K>=C.startLineNumber&&K<=C.endLineNumber}function findRange(K,C){const W=findFirstIdxMonotonousOrArrLen(K,V=>C<V.startLineNumber)-1;return W>=0&&K[W].endLineNumber>=C?K[W]:null}const MAX_FOLDING_REGIONS_FOR_INDENT_DEFAULT=5e3,ID_INDENT_PROVIDER="indent";class IndentRangeProvider{constructor(C,W,V){this.editorModel=C,this.languageConfigurationService=W,this.foldingRangesLimit=V,this.id=ID_INDENT_PROVIDER}dispose(){}compute(C){const W=this.languageConfigurationService.getLanguageConfiguration(this.editorModel.getLanguageId()).foldingRules,V=W&&!!W.offSide,U=W&&W.markers;return Promise.resolve(computeRanges(this.editorModel,V,U,this.foldingRangesLimit))}}let RangesCollector$1=class{constructor(C){this._startIndexes=[],this._endIndexes=[],this._indentOccurrences=[],this._length=0,this._foldingRangesLimit=C}insertFirst(C,W,V){if(C>MAX_LINE_NUMBER||W>MAX_LINE_NUMBER)return;const U=this._length;this._startIndexes[U]=C,this._endIndexes[U]=W,this._length++,V<1e3&&(this._indentOccurrences[V]=(this._indentOccurrences[V]||0)+1)}toIndentRanges(C){const W=this._foldingRangesLimit.limit;if(this._length<=W){this._foldingRangesLimit.update(this._length,!1);const V=new Uint32Array(this._length),U=new Uint32Array(this._length);for(let G=this._length-1,Z=0;G>=0;G--,Z++)V[Z]=this._startIndexes[G],U[Z]=this._endIndexes[G];return new FoldingRegions(V,U)}else{this._foldingRangesLimit.update(this._length,W);let V=0,U=this._indentOccurrences.length;for(let Q=0;Q<this._indentOccurrences.length;Q++){const J=this._indentOccurrences[Q];if(J){if(J+V>W){U=Q;break}V+=J}}const G=C.getOptions().tabSize,Z=new Uint32Array(W),X=new Uint32Array(W);for(let Q=this._length-1,J=0;Q>=0;Q--){const ee=this._startIndexes[Q],te=C.getLineContent(ee),ie=computeIndentLevel(te,G);(ie<U||ie===U&&V++<W)&&(Z[J]=ee,X[J]=this._endIndexes[Q],J++)}return new FoldingRegions(Z,X)}}};const foldingRangesLimitDefault={limit:MAX_FOLDING_REGIONS_FOR_INDENT_DEFAULT,update:()=>{}};function computeRanges(K,C,W,V=foldingRangesLimitDefault){const U=K.getOptions().tabSize,G=new RangesCollector$1(V);let Z;W&&(Z=new RegExp(`(${W.start.source})|(?:${W.end.source})`));const X=[],Q=K.getLineCount()+1;X.push({indent:-1,endAbove:Q,line:Q});for(let J=K.getLineCount();J>0;J--){const ee=K.getLineContent(J),te=computeIndentLevel(ee,U);let ie=X[X.length-1];if(te===-1){C&&(ie.endAbove=J);continue}let ne;if(Z&&(ne=ee.match(Z)))if(ne[1]){let oe=X.length-1;for(;oe>0&&X[oe].indent!==-2;)oe--;if(oe>0){X.length=oe+1,ie=X[oe],G.insertFirst(J,ie.line,te),ie.line=J,ie.indent=te,ie.endAbove=J;continue}}else{X.push({indent:-2,endAbove:J,line:J});continue}if(ie.indent>te){do X.pop(),ie=X[X.length-1];while(ie.indent>te);const oe=ie.endAbove-1;oe-J>=1&&G.insertFirst(J,oe,te)}ie.indent===te?ie.endAbove=J:X.push({indent:te,endAbove:J,line:J})}return G.toIndentRanges(K)}const foldBackground=registerColor("editor.foldBackground",{light:transparent(editorSelectionBackground,.3),dark:transparent(editorSelectionBackground,.3),hcDark:null,hcLight:null},localize("foldBackgroundBackground","Background color behind folded ranges. The color must not be opaque so as not to hide underlying decorations."),!0);registerColor("editorGutter.foldingControlForeground",{dark:iconForeground,light:iconForeground,hcDark:iconForeground,hcLight:iconForeground},localize("editorGutter.foldingControlForeground","Color of the folding control in the editor gutter."));const foldingExpandedIcon=registerIcon("folding-expanded",Codicon.chevronDown,localize("foldingExpandedIcon","Icon for expanded ranges in the editor glyph margin.")),foldingCollapsedIcon=registerIcon("folding-collapsed",Codicon.chevronRight,localize("foldingCollapsedIcon","Icon for collapsed ranges in the editor glyph margin.")),foldingManualCollapsedIcon=registerIcon("folding-manual-collapsed",foldingCollapsedIcon,localize("foldingManualCollapedIcon","Icon for manually collapsed ranges in the editor glyph margin.")),foldingManualExpandedIcon=registerIcon("folding-manual-expanded",foldingExpandedIcon,localize("foldingManualExpandedIcon","Icon for manually expanded ranges in the editor glyph margin.")),foldedBackgroundMinimap={color:themeColorFromId(foldBackground),position:MinimapPosition.Inline};class FoldingDecorationProvider{constructor(C){this.editor=C,this.showFoldingControls="mouseover",this.showFoldingHighlights=!0}getDecorationOption(C,W,V){return W?FoldingDecorationProvider.HIDDEN_RANGE_DECORATION:this.showFoldingControls==="never"?C?this.showFoldingHighlights?FoldingDecorationProvider.NO_CONTROLS_COLLAPSED_HIGHLIGHTED_RANGE_DECORATION:FoldingDecorationProvider.NO_CONTROLS_COLLAPSED_RANGE_DECORATION:FoldingDecorationProvider.NO_CONTROLS_EXPANDED_RANGE_DECORATION:C?V?this.showFoldingHighlights?FoldingDecorationProvider.MANUALLY_COLLAPSED_HIGHLIGHTED_VISUAL_DECORATION:FoldingDecorationProvider.MANUALLY_COLLAPSED_VISUAL_DECORATION:this.showFoldingHighlights?FoldingDecorationProvider.COLLAPSED_HIGHLIGHTED_VISUAL_DECORATION:FoldingDecorationProvider.COLLAPSED_VISUAL_DECORATION:this.showFoldingControls==="mouseover"?V?FoldingDecorationProvider.MANUALLY_EXPANDED_AUTO_HIDE_VISUAL_DECORATION:FoldingDecorationProvider.EXPANDED_AUTO_HIDE_VISUAL_DECORATION:V?FoldingDecorationProvider.MANUALLY_EXPANDED_VISUAL_DECORATION:FoldingDecorationProvider.EXPANDED_VISUAL_DECORATION}changeDecorations(C){return this.editor.changeDecorations(C)}removeDecorations(C){this.editor.removeDecorations(C)}}FoldingDecorationProvider.COLLAPSED_VISUAL_DECORATION=ModelDecorationOptions.register({description:"folding-collapsed-visual-decoration",stickiness:0,afterContentClassName:"inline-folded",isWholeLine:!0,firstLineDecorationClassName:ThemeIcon.asClassName(foldingCollapsedIcon)});FoldingDecorationProvider.COLLAPSED_HIGHLIGHTED_VISUAL_DECORATION=ModelDecorationOptions.register({description:"folding-collapsed-highlighted-visual-decoration",stickiness:0,afterContentClassName:"inline-folded",className:"folded-background",minimap:foldedBackgroundMinimap,isWholeLine:!0,firstLineDecorationClassName:ThemeIcon.asClassName(foldingCollapsedIcon)});FoldingDecorationProvider.MANUALLY_COLLAPSED_VISUAL_DECORATION=ModelDecorationOptions.register({description:"folding-manually-collapsed-visual-decoration",stickiness:0,afterContentClassName:"inline-folded",isWholeLine:!0,firstLineDecorationClassName:ThemeIcon.asClassName(foldingManualCollapsedIcon)});FoldingDecorationProvider.MANUALLY_COLLAPSED_HIGHLIGHTED_VISUAL_DECORATION=ModelDecorationOptions.register({description:"folding-manually-collapsed-highlighted-visual-decoration",stickiness:0,afterContentClassName:"inline-folded",className:"folded-background",minimap:foldedBackgroundMinimap,isWholeLine:!0,firstLineDecorationClassName:ThemeIcon.asClassName(foldingManualCollapsedIcon)});FoldingDecorationProvider.NO_CONTROLS_COLLAPSED_RANGE_DECORATION=ModelDecorationOptions.register({description:"folding-no-controls-range-decoration",stickiness:0,afterContentClassName:"inline-folded",isWholeLine:!0});FoldingDecorationProvider.NO_CONTROLS_COLLAPSED_HIGHLIGHTED_RANGE_DECORATION=ModelDecorationOptions.register({description:"folding-no-controls-range-decoration",stickiness:0,afterContentClassName:"inline-folded",className:"folded-background",minimap:foldedBackgroundMinimap,isWholeLine:!0});FoldingDecorationProvider.EXPANDED_VISUAL_DECORATION=ModelDecorationOptions.register({description:"folding-expanded-visual-decoration",stickiness:1,isWholeLine:!0,firstLineDecorationClassName:"alwaysShowFoldIcons "+ThemeIcon.asClassName(foldingExpandedIcon)});FoldingDecorationProvider.EXPANDED_AUTO_HIDE_VISUAL_DECORATION=ModelDecorationOptions.register({description:"folding-expanded-auto-hide-visual-decoration",stickiness:1,isWholeLine:!0,firstLineDecorationClassName:ThemeIcon.asClassName(foldingExpandedIcon)});FoldingDecorationProvider.MANUALLY_EXPANDED_VISUAL_DECORATION=ModelDecorationOptions.register({description:"folding-manually-expanded-visual-decoration",stickiness:0,isWholeLine:!0,firstLineDecorationClassName:"alwaysShowFoldIcons "+ThemeIcon.asClassName(foldingManualExpandedIcon)});FoldingDecorationProvider.MANUALLY_EXPANDED_AUTO_HIDE_VISUAL_DECORATION=ModelDecorationOptions.register({description:"folding-manually-expanded-auto-hide-visual-decoration",stickiness:0,isWholeLine:!0,firstLineDecorationClassName:ThemeIcon.asClassName(foldingManualExpandedIcon)});FoldingDecorationProvider.NO_CONTROLS_EXPANDED_RANGE_DECORATION=ModelDecorationOptions.register({description:"folding-no-controls-range-decoration",stickiness:0,isWholeLine:!0});FoldingDecorationProvider.HIDDEN_RANGE_DECORATION=ModelDecorationOptions.register({description:"folding-hidden-range-decoration",stickiness:1});const foldingContext={},ID_SYNTAX_PROVIDER="syntax";class SyntaxRangeProvider{constructor(C,W,V,U,G){this.editorModel=C,this.providers=W,this.handleFoldingRangesChange=V,this.foldingRangesLimit=U,this.fallbackRangeProvider=G,this.id=ID_SYNTAX_PROVIDER,this.disposables=new DisposableStore,G&&this.disposables.add(G);for(const Z of W)typeof Z.onDidChange=="function"&&this.disposables.add(Z.onDidChange(V))}compute(C){return collectSyntaxRanges(this.providers,this.editorModel,C).then(W=>{var V,U;return W?sanitizeRanges(W,this.foldingRangesLimit):(U=(V=this.fallbackRangeProvider)===null||V===void 0?void 0:V.compute(C))!==null&&U!==void 0?U:null})}dispose(){this.disposables.dispose()}}function collectSyntaxRanges(K,C,W){let V=null;const U=K.map((G,Z)=>Promise.resolve(G.provideFoldingRanges(C,foldingContext,W)).then(X=>{if(!W.isCancellationRequested&&Array.isArray(X)){Array.isArray(V)||(V=[]);const Q=C.getLineCount();for(const J of X)J.start>0&&J.end>J.start&&J.end<=Q&&V.push({start:J.start,end:J.end,rank:Z,kind:J.kind})}},onUnexpectedExternalError));return Promise.all(U).then(G=>V)}class RangesCollector{constructor(C){this._startIndexes=[],this._endIndexes=[],this._nestingLevels=[],this._nestingLevelCounts=[],this._types=[],this._length=0,this._foldingRangesLimit=C}add(C,W,V,U){if(C>MAX_LINE_NUMBER||W>MAX_LINE_NUMBER)return;const G=this._length;this._startIndexes[G]=C,this._endIndexes[G]=W,this._nestingLevels[G]=U,this._types[G]=V,this._length++,U<30&&(this._nestingLevelCounts[U]=(this._nestingLevelCounts[U]||0)+1)}toIndentRanges(){const C=this._foldingRangesLimit.limit;if(this._length<=C){this._foldingRangesLimit.update(this._length,!1);const W=new Uint32Array(this._length),V=new Uint32Array(this._length);for(let U=0;U<this._length;U++)W[U]=this._startIndexes[U],V[U]=this._endIndexes[U];return new FoldingRegions(W,V,this._types)}else{this._foldingRangesLimit.update(this._length,C);let W=0,V=this._nestingLevelCounts.length;for(let X=0;X<this._nestingLevelCounts.length;X++){const Q=this._nestingLevelCounts[X];if(Q){if(Q+W>C){V=X;break}W+=Q}}const U=new Uint32Array(C),G=new Uint32Array(C),Z=[];for(let X=0,Q=0;X<this._length;X++){const J=this._nestingLevels[X];(J<V||J===V&&W++<C)&&(U[Q]=this._startIndexes[X],G[Q]=this._endIndexes[X],Z[Q]=this._types[X],Q++)}return new FoldingRegions(U,G,Z)}}}function sanitizeRanges(K,C){const W=K.sort((Z,X)=>{let Q=Z.start-X.start;return Q===0&&(Q=Z.rank-X.rank),Q}),V=new RangesCollector(C);let U;const G=[];for(const Z of W)if(!U)U=Z,V.add(Z.start,Z.end,Z.kind&&Z.kind.value,G.length);else if(Z.start>U.start)if(Z.end<=U.end)G.push(U),U=Z,V.add(Z.start,Z.end,Z.kind&&Z.kind.value,G.length);else{if(Z.start>U.end){do U=G.pop();while(U&&Z.start>U.end);U&&G.push(U),U=Z}V.add(Z.start,Z.end,Z.kind&&Z.kind.value,G.length)}return V.toIndentRanges()}var __decorate$P=globalThis&&globalThis.__decorate||function(K,C,W,V){var U=arguments.length,G=U<3?C:V===null?V=Object.getOwnPropertyDescriptor(C,W):V,Z;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")G=Reflect.decorate(K,C,W,V);else for(var X=K.length-1;X>=0;X--)(Z=K[X])&&(G=(U<3?Z(G):U>3?Z(C,W,G):Z(C,W))||G);return U>3&&G&&Object.defineProperty(C,W,G),G},__param$P=globalThis&&globalThis.__param||function(K,C){return function(W,V){C(W,V,K)}},__awaiter$A=globalThis&&globalThis.__awaiter||function(K,C,W,V){function U(G){return G instanceof W?G:new W(function(Z){Z(G)})}return new(W||(W=Promise))(function(G,Z){function X(ee){try{J(V.next(ee))}catch(te){Z(te)}}function Q(ee){try{J(V.throw(ee))}catch(te){Z(te)}}function J(ee){ee.done?G(ee.value):U(ee.value).then(X,Q)}J((V=V.apply(K,C||[])).next())})},FoldingController_1;const CONTEXT_FOLDING_ENABLED=new RawContextKey("foldingEnabled",!1);let FoldingController=FoldingController_1=class extends Disposable{static get(C){return C.getContribution(FoldingController_1.ID)}static getFoldingRangeProviders(C,W){var V,U;const G=C.foldingRangeProvider.ordered(W);return(U=(V=FoldingController_1._foldingRangeSelector)===null||V===void 0?void 0:V.call(FoldingController_1,G,W))!==null&&U!==void 0?U:G}constructor(C,W,V,U,G,Z){super(),this.contextKeyService=W,this.languageConfigurationService=V,this.languageFeaturesService=Z,this.localToDispose=this._register(new DisposableStore),this.editor=C,this._foldingLimitReporter=new RangesLimitReporter(C);const X=this.editor.getOptions();this._isEnabled=X.get(43),this._useFoldingProviders=X.get(44)!=="indentation",this._unfoldOnClickAfterEndOfLine=X.get(48),this._restoringViewState=!1,this._currentModelHasFoldedImports=!1,this._foldingImportsByDefault=X.get(46),this.updateDebounceInfo=G.for(Z.foldingRangeProvider,"Folding",{min:200}),this.foldingModel=null,this.hiddenRangeModel=null,this.rangeProvider=null,this.foldingRegionPromise=null,this.foldingModelPromise=null,this.updateScheduler=null,this.cursorChangedScheduler=null,this.mouseDownInfo=null,this.foldingDecorationProvider=new FoldingDecorationProvider(C),this.foldingDecorationProvider.showFoldingControls=X.get(109),this.foldingDecorationProvider.showFoldingHighlights=X.get(45),this.foldingEnabled=CONTEXT_FOLDING_ENABLED.bindTo(this.contextKeyService),this.foldingEnabled.set(this._isEnabled),this._register(this.editor.onDidChangeModel(()=>this.onModelChanged())),this._register(this.editor.onDidChangeConfiguration(Q=>{if(Q.hasChanged(43)&&(this._isEnabled=this.editor.getOptions().get(43),this.foldingEnabled.set(this._isEnabled),this.onModelChanged()),Q.hasChanged(47)&&this.onModelChanged(),Q.hasChanged(109)||Q.hasChanged(45)){const J=this.editor.getOptions();this.foldingDecorationProvider.showFoldingControls=J.get(109),this.foldingDecorationProvider.showFoldingHighlights=J.get(45),this.triggerFoldingModelChanged()}Q.hasChanged(44)&&(this._useFoldingProviders=this.editor.getOptions().get(44)!=="indentation",this.onFoldingStrategyChanged()),Q.hasChanged(48)&&(this._unfoldOnClickAfterEndOfLine=this.editor.getOptions().get(48)),Q.hasChanged(46)&&(this._foldingImportsByDefault=this.editor.getOptions().get(46))})),this.onModelChanged()}saveViewState(){const C=this.editor.getModel();if(!C||!this._isEnabled||C.isTooLargeForTokenization())return{};if(this.foldingModel){const W=this.foldingModel.getMemento(),V=this.rangeProvider?this.rangeProvider.id:void 0;return{collapsedRegions:W,lineCount:C.getLineCount(),provider:V,foldedImports:this._currentModelHasFoldedImports}}}restoreViewState(C){const W=this.editor.getModel();if(!(!W||!this._isEnabled||W.isTooLargeForTokenization()||!this.hiddenRangeModel)&&C&&(this._currentModelHasFoldedImports=!!C.foldedImports,C.collapsedRegions&&C.collapsedRegions.length>0&&this.foldingModel)){this._restoringViewState=!0;try{this.foldingModel.applyMemento(C.collapsedRegions)}finally{this._restoringViewState=!1}}}onModelChanged(){this.localToDispose.clear();const C=this.editor.getModel();!this._isEnabled||!C||C.isTooLargeForTokenization()||(this._currentModelHasFoldedImports=!1,this.foldingModel=new FoldingModel(C,this.foldingDecorationProvider),this.localToDispose.add(this.foldingModel),this.hiddenRangeModel=new HiddenRangeModel(this.foldingModel),this.localToDispose.add(this.hiddenRangeModel),this.localToDispose.add(this.hiddenRangeModel.onDidChange(W=>this.onHiddenRangesChanges(W))),this.updateScheduler=new Delayer(this.updateDebounceInfo.get(C)),this.cursorChangedScheduler=new RunOnceScheduler(()=>this.revealCursor(),200),this.localToDispose.add(this.cursorChangedScheduler),this.localToDispose.add(this.languageFeaturesService.foldingRangeProvider.onDidChange(()=>this.onFoldingStrategyChanged())),this.localToDispose.add(this.editor.onDidChangeModelLanguageConfiguration(()=>this.onFoldingStrategyChanged())),this.localToDispose.add(this.editor.onDidChangeModelContent(W=>this.onDidChangeModelContent(W))),this.localToDispose.add(this.editor.onDidChangeCursorPosition(()=>this.onCursorPositionChanged())),this.localToDispose.add(this.editor.onMouseDown(W=>this.onEditorMouseDown(W))),this.localToDispose.add(this.editor.onMouseUp(W=>this.onEditorMouseUp(W))),this.localToDispose.add({dispose:()=>{var W,V;this.foldingRegionPromise&&(this.foldingRegionPromise.cancel(),this.foldingRegionPromise=null),(W=this.updateScheduler)===null||W===void 0||W.cancel(),this.updateScheduler=null,this.foldingModel=null,this.foldingModelPromise=null,this.hiddenRangeModel=null,this.cursorChangedScheduler=null,(V=this.rangeProvider)===null||V===void 0||V.dispose(),this.rangeProvider=null}}),this.triggerFoldingModelChanged())}onFoldingStrategyChanged(){var C;(C=this.rangeProvider)===null||C===void 0||C.dispose(),this.rangeProvider=null,this.triggerFoldingModelChanged()}getRangeProvider(C){if(this.rangeProvider)return this.rangeProvider;const W=new IndentRangeProvider(C,this.languageConfigurationService,this._foldingLimitReporter);if(this.rangeProvider=W,this._useFoldingProviders&&this.foldingModel){const V=FoldingController_1.getFoldingRangeProviders(this.languageFeaturesService,C);V.length>0&&(this.rangeProvider=new SyntaxRangeProvider(C,V,()=>this.triggerFoldingModelChanged(),this._foldingLimitReporter,W))}return this.rangeProvider}getFoldingModel(){return this.foldingModelPromise}onDidChangeModelContent(C){var W;(W=this.hiddenRangeModel)===null||W===void 0||W.notifyChangeModelContent(C),this.triggerFoldingModelChanged()}triggerFoldingModelChanged(){this.updateScheduler&&(this.foldingRegionPromise&&(this.foldingRegionPromise.cancel(),this.foldingRegionPromise=null),this.foldingModelPromise=this.updateScheduler.trigger(()=>{const C=this.foldingModel;if(!C)return null;const W=new StopWatch,V=this.getRangeProvider(C.textModel),U=this.foldingRegionPromise=createCancelablePromise(G=>V.compute(G));return U.then(G=>{if(G&&U===this.foldingRegionPromise){let Z;if(this._foldingImportsByDefault&&!this._currentModelHasFoldedImports){const ee=G.setCollapsedAllOfType(FoldingRangeKind.Imports.value,!0);ee&&(Z=StableEditorScrollState.capture(this.editor),this._currentModelHasFoldedImports=ee)}const X=this.editor.getSelections(),Q=X?X.map(ee=>ee.startLineNumber):[];C.update(G,Q),Z==null||Z.restore(this.editor);const J=this.updateDebounceInfo.update(C.textModel,W.elapsed());this.updateScheduler&&(this.updateScheduler.defaultDelay=J)}return C})}).then(void 0,C=>(onUnexpectedError(C),null)))}onHiddenRangesChanges(C){if(this.hiddenRangeModel&&C.length&&!this._restoringViewState){const W=this.editor.getSelections();W&&this.hiddenRangeModel.adjustSelections(W)&&this.editor.setSelections(W)}this.editor.setHiddenAreas(C,this)}onCursorPositionChanged(){this.hiddenRangeModel&&this.hiddenRangeModel.hasRanges()&&this.cursorChangedScheduler.schedule()}revealCursor(){const C=this.getFoldingModel();C&&C.then(W=>{if(W){const V=this.editor.getSelections();if(V&&V.length>0){const U=[];for(const G of V){const Z=G.selectionStartLineNumber;this.hiddenRangeModel&&this.hiddenRangeModel.isHidden(Z)&&U.push(...W.getAllRegionsAtLine(Z,X=>X.isCollapsed&&Z>X.startLineNumber))}U.length&&(W.toggleCollapseState(U),this.reveal(V[0].getPosition()))}}}).then(void 0,onUnexpectedError)}onEditorMouseDown(C){if(this.mouseDownInfo=null,!this.hiddenRangeModel||!C.target||!C.target.range||!C.event.leftButton&&!C.event.middleButton)return;const W=C.target.range;let V=!1;switch(C.target.type){case 4:{const U=C.target.detail,G=C.target.element.offsetLeft;if(U.offsetX-G<4)return;V=!0;break}case 7:{if(this._unfoldOnClickAfterEndOfLine&&this.hiddenRangeModel.hasRanges()&&!C.target.detail.isAfterLines)break;return}case 6:{if(this.hiddenRangeModel.hasRanges()){const U=this.editor.getModel();if(U&&W.startColumn===U.getLineMaxColumn(W.startLineNumber))break}return}default:return}this.mouseDownInfo={lineNumber:W.startLineNumber,iconClicked:V}}onEditorMouseUp(C){const W=this.foldingModel;if(!W||!this.mouseDownInfo||!C.target)return;const V=this.mouseDownInfo.lineNumber,U=this.mouseDownInfo.iconClicked,G=C.target.range;if(!G||G.startLineNumber!==V)return;if(U){if(C.target.type!==4)return}else{const X=this.editor.getModel();if(!X||G.startColumn!==X.getLineMaxColumn(V))return}const Z=W.getRegionAtLine(V);if(Z&&Z.startLineNumber===V){const X=Z.isCollapsed;if(U||X){const Q=C.event.altKey;let J=[];if(Q){const ee=ie=>!ie.containedBy(Z)&&!Z.containedBy(ie),te=W.getRegionsInside(null,ee);for(const ie of te)ie.isCollapsed&&J.push(ie);J.length===0&&(J=te)}else{const ee=C.event.middleButton||C.event.shiftKey;if(ee)for(const te of W.getRegionsInside(Z))te.isCollapsed===X&&J.push(te);(X||!ee||J.length===0)&&J.push(Z)}W.toggleCollapseState(J),this.reveal({lineNumber:V,column:1})}}}reveal(C){this.editor.revealPositionInCenterIfOutsideViewport(C,0)}};FoldingController.ID="editor.contrib.folding";FoldingController=FoldingController_1=__decorate$P([__param$P(1,IContextKeyService),__param$P(2,ILanguageConfigurationService),__param$P(3,INotificationService),__param$P(4,ILanguageFeatureDebounceService),__param$P(5,ILanguageFeaturesService)],FoldingController);class RangesLimitReporter{constructor(C){this.editor=C,this._onDidChange=new Emitter$1,this._computed=0,this._limited=!1}get limit(){return this.editor.getOptions().get(47)}update(C,W){(C!==this._computed||W!==this._limited)&&(this._computed=C,this._limited=W,this._onDidChange.fire())}}class FoldingAction extends EditorAction{runEditorCommand(C,W,V){const U=C.get(ILanguageConfigurationService),G=FoldingController.get(W);if(!G)return;const Z=G.getFoldingModel();if(Z)return this.reportTelemetry(C,W),Z.then(X=>{if(X){this.invoke(G,X,W,V,U);const Q=W.getSelection();Q&&G.reveal(Q.getStartPosition())}})}getSelectedLines(C){const W=C.getSelections();return W?W.map(V=>V.startLineNumber):[]}getLineNumbers(C,W){return C&&C.selectionLines?C.selectionLines.map(V=>V+1):this.getSelectedLines(W)}run(C,W){}}function foldingArgumentsConstraint(K){if(!isUndefined$2(K)){if(!isObject$2(K))return!1;const C=K;if(!isUndefined$2(C.levels)&&!isNumber$3(C.levels)||!isUndefined$2(C.direction)&&!isString$3(C.direction)||!isUndefined$2(C.selectionLines)&&(!Array.isArray(C.selectionLines)||!C.selectionLines.every(isNumber$3)))return!1}return!0}class UnfoldAction extends FoldingAction{constructor(){super({id:"editor.unfold",label:localize("unfoldAction.label","Unfold"),alias:"Unfold",precondition:CONTEXT_FOLDING_ENABLED,kbOpts:{kbExpr:EditorContextKeys.editorTextFocus,primary:3166,mac:{primary:2654},weight:100},description:{description:"Unfold the content in the editor",args:[{name:"Unfold editor argument",description:`Property-value pairs that can be passed through this argument:
						* 'levels': Number of levels to unfold. If not set, defaults to 1.
						* 'direction': If 'up', unfold given number of levels up otherwise unfolds down.
						* 'selectionLines': Array of the start lines (0-based) of the editor selections to apply the unfold action to. If not set, the active selection(s) will be used.
						`,constraint:foldingArgumentsConstraint,schema:{type:"object",properties:{levels:{type:"number",default:1},direction:{type:"string",enum:["up","down"],default:"down"},selectionLines:{type:"array",items:{type:"number"}}}}}]}})}invoke(C,W,V,U){const G=U&&U.levels||1,Z=this.getLineNumbers(U,V);U&&U.direction==="up"?setCollapseStateLevelsUp(W,!1,G,Z):setCollapseStateLevelsDown(W,!1,G,Z)}}class UnFoldRecursivelyAction extends FoldingAction{constructor(){super({id:"editor.unfoldRecursively",label:localize("unFoldRecursivelyAction.label","Unfold Recursively"),alias:"Unfold Recursively",precondition:CONTEXT_FOLDING_ENABLED,kbOpts:{kbExpr:EditorContextKeys.editorTextFocus,primary:KeyChord(2089,2142),weight:100}})}invoke(C,W,V,U){setCollapseStateLevelsDown(W,!1,Number.MAX_VALUE,this.getSelectedLines(V))}}class FoldAction extends FoldingAction{constructor(){super({id:"editor.fold",label:localize("foldAction.label","Fold"),alias:"Fold",precondition:CONTEXT_FOLDING_ENABLED,kbOpts:{kbExpr:EditorContextKeys.editorTextFocus,primary:3164,mac:{primary:2652},weight:100},description:{description:"Fold the content in the editor",args:[{name:"Fold editor argument",description:`Property-value pairs that can be passed through this argument:
							* 'levels': Number of levels to fold.
							* 'direction': If 'up', folds given number of levels up otherwise folds down.
							* 'selectionLines': Array of the start lines (0-based) of the editor selections to apply the fold action to. If not set, the active selection(s) will be used.
							If no levels or direction is set, folds the region at the locations or if already collapsed, the first uncollapsed parent instead.
						`,constraint:foldingArgumentsConstraint,schema:{type:"object",properties:{levels:{type:"number"},direction:{type:"string",enum:["up","down"]},selectionLines:{type:"array",items:{type:"number"}}}}}]}})}invoke(C,W,V,U){const G=this.getLineNumbers(U,V),Z=U&&U.levels,X=U&&U.direction;typeof Z!="number"&&typeof X!="string"?setCollapseStateUp(W,!0,G):X==="up"?setCollapseStateLevelsUp(W,!0,Z||1,G):setCollapseStateLevelsDown(W,!0,Z||1,G)}}class ToggleFoldAction extends FoldingAction{constructor(){super({id:"editor.toggleFold",label:localize("toggleFoldAction.label","Toggle Fold"),alias:"Toggle Fold",precondition:CONTEXT_FOLDING_ENABLED,kbOpts:{kbExpr:EditorContextKeys.editorTextFocus,primary:KeyChord(2089,2090),weight:100}})}invoke(C,W,V){const U=this.getSelectedLines(V);toggleCollapseState(W,1,U)}}class FoldRecursivelyAction extends FoldingAction{constructor(){super({id:"editor.foldRecursively",label:localize("foldRecursivelyAction.label","Fold Recursively"),alias:"Fold Recursively",precondition:CONTEXT_FOLDING_ENABLED,kbOpts:{kbExpr:EditorContextKeys.editorTextFocus,primary:KeyChord(2089,2140),weight:100}})}invoke(C,W,V){const U=this.getSelectedLines(V);setCollapseStateLevelsDown(W,!0,Number.MAX_VALUE,U)}}class FoldAllBlockCommentsAction extends FoldingAction{constructor(){super({id:"editor.foldAllBlockComments",label:localize("foldAllBlockComments.label","Fold All Block Comments"),alias:"Fold All Block Comments",precondition:CONTEXT_FOLDING_ENABLED,kbOpts:{kbExpr:EditorContextKeys.editorTextFocus,primary:KeyChord(2089,2138),weight:100}})}invoke(C,W,V,U,G){if(W.regions.hasTypes())setCollapseStateForType(W,FoldingRangeKind.Comment.value,!0);else{const Z=V.getModel();if(!Z)return;const X=G.getLanguageConfiguration(Z.getLanguageId()).comments;if(X&&X.blockCommentStartToken){const Q=new RegExp("^\\s*"+escapeRegExpCharacters(X.blockCommentStartToken));setCollapseStateForMatchingLines(W,Q,!0)}}}}class FoldAllRegionsAction extends FoldingAction{constructor(){super({id:"editor.foldAllMarkerRegions",label:localize("foldAllMarkerRegions.label","Fold All Regions"),alias:"Fold All Regions",precondition:CONTEXT_FOLDING_ENABLED,kbOpts:{kbExpr:EditorContextKeys.editorTextFocus,primary:KeyChord(2089,2077),weight:100}})}invoke(C,W,V,U,G){if(W.regions.hasTypes())setCollapseStateForType(W,FoldingRangeKind.Region.value,!0);else{const Z=V.getModel();if(!Z)return;const X=G.getLanguageConfiguration(Z.getLanguageId()).foldingRules;if(X&&X.markers&&X.markers.start){const Q=new RegExp(X.markers.start);setCollapseStateForMatchingLines(W,Q,!0)}}}}class UnfoldAllRegionsAction extends FoldingAction{constructor(){super({id:"editor.unfoldAllMarkerRegions",label:localize("unfoldAllMarkerRegions.label","Unfold All Regions"),alias:"Unfold All Regions",precondition:CONTEXT_FOLDING_ENABLED,kbOpts:{kbExpr:EditorContextKeys.editorTextFocus,primary:KeyChord(2089,2078),weight:100}})}invoke(C,W,V,U,G){if(W.regions.hasTypes())setCollapseStateForType(W,FoldingRangeKind.Region.value,!1);else{const Z=V.getModel();if(!Z)return;const X=G.getLanguageConfiguration(Z.getLanguageId()).foldingRules;if(X&&X.markers&&X.markers.start){const Q=new RegExp(X.markers.start);setCollapseStateForMatchingLines(W,Q,!1)}}}}class FoldAllExceptAction extends FoldingAction{constructor(){super({id:"editor.foldAllExcept",label:localize("foldAllExcept.label","Fold All Except Selected"),alias:"Fold All Except Selected",precondition:CONTEXT_FOLDING_ENABLED,kbOpts:{kbExpr:EditorContextKeys.editorTextFocus,primary:KeyChord(2089,2136),weight:100}})}invoke(C,W,V){const U=this.getSelectedLines(V);setCollapseStateForRest(W,!0,U)}}class UnfoldAllExceptAction extends FoldingAction{constructor(){super({id:"editor.unfoldAllExcept",label:localize("unfoldAllExcept.label","Unfold All Except Selected"),alias:"Unfold All Except Selected",precondition:CONTEXT_FOLDING_ENABLED,kbOpts:{kbExpr:EditorContextKeys.editorTextFocus,primary:KeyChord(2089,2134),weight:100}})}invoke(C,W,V){const U=this.getSelectedLines(V);setCollapseStateForRest(W,!1,U)}}class FoldAllAction extends FoldingAction{constructor(){super({id:"editor.foldAll",label:localize("foldAllAction.label","Fold All"),alias:"Fold All",precondition:CONTEXT_FOLDING_ENABLED,kbOpts:{kbExpr:EditorContextKeys.editorTextFocus,primary:KeyChord(2089,2069),weight:100}})}invoke(C,W,V){setCollapseStateLevelsDown(W,!0)}}class UnfoldAllAction extends FoldingAction{constructor(){super({id:"editor.unfoldAll",label:localize("unfoldAllAction.label","Unfold All"),alias:"Unfold All",precondition:CONTEXT_FOLDING_ENABLED,kbOpts:{kbExpr:EditorContextKeys.editorTextFocus,primary:KeyChord(2089,2088),weight:100}})}invoke(C,W,V){setCollapseStateLevelsDown(W,!1)}}class FoldLevelAction extends FoldingAction{getFoldingLevel(){return parseInt(this.id.substr(FoldLevelAction.ID_PREFIX.length))}invoke(C,W,V){setCollapseStateAtLevel(W,this.getFoldingLevel(),!0,this.getSelectedLines(V))}}FoldLevelAction.ID_PREFIX="editor.foldLevel";FoldLevelAction.ID=K=>FoldLevelAction.ID_PREFIX+K;class GotoParentFoldAction extends FoldingAction{constructor(){super({id:"editor.gotoParentFold",label:localize("gotoParentFold.label","Go to Parent Fold"),alias:"Go to Parent Fold",precondition:CONTEXT_FOLDING_ENABLED,kbOpts:{kbExpr:EditorContextKeys.editorTextFocus,weight:100}})}invoke(C,W,V){const U=this.getSelectedLines(V);if(U.length>0){const G=getParentFoldLine(U[0],W);G!==null&&V.setSelection({startLineNumber:G,startColumn:1,endLineNumber:G,endColumn:1})}}}class GotoPreviousFoldAction extends FoldingAction{constructor(){super({id:"editor.gotoPreviousFold",label:localize("gotoPreviousFold.label","Go to Previous Folding Range"),alias:"Go to Previous Folding Range",precondition:CONTEXT_FOLDING_ENABLED,kbOpts:{kbExpr:EditorContextKeys.editorTextFocus,weight:100}})}invoke(C,W,V){const U=this.getSelectedLines(V);if(U.length>0){const G=getPreviousFoldLine(U[0],W);G!==null&&V.setSelection({startLineNumber:G,startColumn:1,endLineNumber:G,endColumn:1})}}}class GotoNextFoldAction extends FoldingAction{constructor(){super({id:"editor.gotoNextFold",label:localize("gotoNextFold.label","Go to Next Folding Range"),alias:"Go to Next Folding Range",precondition:CONTEXT_FOLDING_ENABLED,kbOpts:{kbExpr:EditorContextKeys.editorTextFocus,weight:100}})}invoke(C,W,V){const U=this.getSelectedLines(V);if(U.length>0){const G=getNextFoldLine(U[0],W);G!==null&&V.setSelection({startLineNumber:G,startColumn:1,endLineNumber:G,endColumn:1})}}}class FoldRangeFromSelectionAction extends FoldingAction{constructor(){super({id:"editor.createFoldingRangeFromSelection",label:localize("createManualFoldRange.label","Create Folding Range from Selection"),alias:"Create Folding Range from Selection",precondition:CONTEXT_FOLDING_ENABLED,kbOpts:{kbExpr:EditorContextKeys.editorTextFocus,primary:KeyChord(2089,2135),weight:100}})}invoke(C,W,V){var U;const G=[],Z=V.getSelections();if(Z){for(const X of Z){let Q=X.endLineNumber;X.endColumn===1&&--Q,Q>X.startLineNumber&&(G.push({startLineNumber:X.startLineNumber,endLineNumber:Q,type:void 0,isCollapsed:!0,source:1}),V.setSelection({startLineNumber:X.startLineNumber,startColumn:1,endLineNumber:X.startLineNumber,endColumn:1}))}if(G.length>0){G.sort((Q,J)=>Q.startLineNumber-J.startLineNumber);const X=FoldingRegions.sanitizeAndMerge(W.regions,G,(U=V.getModel())===null||U===void 0?void 0:U.getLineCount());W.updatePost(FoldingRegions.fromFoldRanges(X))}}}}class RemoveFoldRangeFromSelectionAction extends FoldingAction{constructor(){super({id:"editor.removeManualFoldingRanges",label:localize("removeManualFoldingRanges.label","Remove Manual Folding Ranges"),alias:"Remove Manual Folding Ranges",precondition:CONTEXT_FOLDING_ENABLED,kbOpts:{kbExpr:EditorContextKeys.editorTextFocus,primary:KeyChord(2089,2137),weight:100}})}invoke(C,W,V){const U=V.getSelections();if(U){const G=[];for(const Z of U){const{startLineNumber:X,endLineNumber:Q}=Z;G.push(Q>=X?{startLineNumber:X,endLineNumber:Q}:{endLineNumber:Q,startLineNumber:X})}W.removeManualRanges(G),C.triggerFoldingModelChanged()}}}registerEditorContribution(FoldingController.ID,FoldingController,0);registerEditorAction(UnfoldAction);registerEditorAction(UnFoldRecursivelyAction);registerEditorAction(FoldAction);registerEditorAction(FoldRecursivelyAction);registerEditorAction(FoldAllAction);registerEditorAction(UnfoldAllAction);registerEditorAction(FoldAllBlockCommentsAction);registerEditorAction(FoldAllRegionsAction);registerEditorAction(UnfoldAllRegionsAction);registerEditorAction(FoldAllExceptAction);registerEditorAction(UnfoldAllExceptAction);registerEditorAction(ToggleFoldAction);registerEditorAction(GotoParentFoldAction);registerEditorAction(GotoPreviousFoldAction);registerEditorAction(GotoNextFoldAction);registerEditorAction(FoldRangeFromSelectionAction);registerEditorAction(RemoveFoldRangeFromSelectionAction);for(let K=1;K<=7;K++)registerInstantiatedEditorAction(new FoldLevelAction({id:FoldLevelAction.ID(K),label:localize("foldLevelAction.label","Fold Level {0}",K),alias:`Fold Level ${K}`,precondition:CONTEXT_FOLDING_ENABLED,kbOpts:{kbExpr:EditorContextKeys.editorTextFocus,primary:KeyChord(2089,2048|21+K),weight:100}}));CommandsRegistry.registerCommand("_executeFoldingRangeProvider",function(K,...C){return __awaiter$A(this,void 0,void 0,function*(){const[W]=C;if(!(W instanceof URI))throw illegalArgument();const V=K.get(ILanguageFeaturesService),U=K.get(IModelService).getModel(W);if(!U)throw illegalArgument();const G=K.get(IConfigurationService);if(!G.getValue("editor.folding",{resource:W}))return[];const Z=K.get(ILanguageConfigurationService),X=G.getValue("editor.foldingStrategy",{resource:W}),Q={get limit(){return G.getValue("editor.foldingMaximumRegions",{resource:W})},update:(ne,oe)=>{}},J=new IndentRangeProvider(U,Z,Q);let ee=J;if(X!=="indentation"){const ne=FoldingController.getFoldingRangeProviders(V,U);ne.length&&(ee=new SyntaxRangeProvider(U,ne,()=>{},Q,J))}const te=yield ee.compute(CancellationToken.None),ie=[];try{if(te)for(let ne=0;ne<te.length;ne++){const oe=te.getType(ne);ie.push({start:te.getStartLineNumber(ne),end:te.getEndLineNumber(ne),kind:oe?FoldingRangeKind.fromValue(oe):void 0})}return ie}finally{ee.dispose()}})});class EditorFontZoomIn extends EditorAction{constructor(){super({id:"editor.action.fontZoomIn",label:localize("EditorFontZoomIn.label","Editor Font Zoom In"),alias:"Editor Font Zoom In",precondition:void 0})}run(C,W){EditorZoom.setZoomLevel(EditorZoom.getZoomLevel()+1)}}class EditorFontZoomOut extends EditorAction{constructor(){super({id:"editor.action.fontZoomOut",label:localize("EditorFontZoomOut.label","Editor Font Zoom Out"),alias:"Editor Font Zoom Out",precondition:void 0})}run(C,W){EditorZoom.setZoomLevel(EditorZoom.getZoomLevel()-1)}}class EditorFontZoomReset extends EditorAction{constructor(){super({id:"editor.action.fontZoomReset",label:localize("EditorFontZoomReset.label","Editor Font Zoom Reset"),alias:"Editor Font Zoom Reset",precondition:void 0})}run(C,W){EditorZoom.setZoomLevel(0)}}registerEditorAction(EditorFontZoomIn);registerEditorAction(EditorFontZoomOut);registerEditorAction(EditorFontZoomReset);var __decorate$O=globalThis&&globalThis.__decorate||function(K,C,W,V){var U=arguments.length,G=U<3?C:V===null?V=Object.getOwnPropertyDescriptor(C,W):V,Z;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")G=Reflect.decorate(K,C,W,V);else for(var X=K.length-1;X>=0;X--)(Z=K[X])&&(G=(U<3?Z(G):U>3?Z(C,W,G):Z(C,W))||G);return U>3&&G&&Object.defineProperty(C,W,G),G},__param$O=globalThis&&globalThis.__param||function(K,C){return function(W,V){C(W,V,K)}},__awaiter$z=globalThis&&globalThis.__awaiter||function(K,C,W,V){function U(G){return G instanceof W?G:new W(function(Z){Z(G)})}return new(W||(W=Promise))(function(G,Z){function X(ee){try{J(V.next(ee))}catch(te){Z(te)}}function Q(ee){try{J(V.throw(ee))}catch(te){Z(te)}}function J(ee){ee.done?G(ee.value):U(ee.value).then(X,Q)}J((V=V.apply(K,C||[])).next())})};let FormatOnType=class{constructor(C,W,V){this._editor=C,this._languageFeaturesService=W,this._workerService=V,this._disposables=new DisposableStore,this._sessionDisposables=new DisposableStore,this._disposables.add(W.onTypeFormattingEditProvider.onDidChange(this._update,this)),this._disposables.add(C.onDidChangeModel(()=>this._update())),this._disposables.add(C.onDidChangeModelLanguage(()=>this._update())),this._disposables.add(C.onDidChangeConfiguration(U=>{U.hasChanged(56)&&this._update()})),this._update()}dispose(){this._disposables.dispose(),this._sessionDisposables.dispose()}_update(){if(this._sessionDisposables.clear(),!this._editor.getOption(56)||!this._editor.hasModel())return;const C=this._editor.getModel(),[W]=this._languageFeaturesService.onTypeFormattingEditProvider.ordered(C);if(!W||!W.autoFormatTriggerCharacters)return;const V=new CharacterSet;for(const U of W.autoFormatTriggerCharacters)V.add(U.charCodeAt(0));this._sessionDisposables.add(this._editor.onDidType(U=>{const G=U.charCodeAt(U.length-1);V.has(G)&&this._trigger(String.fromCharCode(G))}))}_trigger(C){if(!this._editor.hasModel()||this._editor.getSelections().length>1||!this._editor.getSelection().isEmpty())return;const W=this._editor.getModel(),V=this._editor.getPosition(),U=new CancellationTokenSource$1,G=this._editor.onDidChangeModelContent(Z=>{if(Z.isFlush){U.cancel(),G.dispose();return}for(let X=0,Q=Z.changes.length;X<Q;X++)if(Z.changes[X].range.endLineNumber<=V.lineNumber){U.cancel(),G.dispose();return}});getOnTypeFormattingEdits(this._workerService,this._languageFeaturesService,W,V,C,W.getFormattingOptions(),U.token).then(Z=>{U.token.isCancellationRequested||isNonEmptyArray$2(Z)&&(FormattingEdit.execute(this._editor,Z,!0),alertFormattingEdits(Z))}).finally(()=>{G.dispose()})}};FormatOnType.ID="editor.contrib.autoFormat";FormatOnType=__decorate$O([__param$O(1,ILanguageFeaturesService),__param$O(2,IEditorWorkerService)],FormatOnType);let FormatOnPaste=class{constructor(C,W,V){this.editor=C,this._languageFeaturesService=W,this._instantiationService=V,this._callOnDispose=new DisposableStore,this._callOnModel=new DisposableStore,this._callOnDispose.add(C.onDidChangeConfiguration(()=>this._update())),this._callOnDispose.add(C.onDidChangeModel(()=>this._update())),this._callOnDispose.add(C.onDidChangeModelLanguage(()=>this._update())),this._callOnDispose.add(W.documentRangeFormattingEditProvider.onDidChange(this._update,this))}dispose(){this._callOnDispose.dispose(),this._callOnModel.dispose()}_update(){this._callOnModel.clear(),this.editor.getOption(55)&&this.editor.hasModel()&&this._languageFeaturesService.documentRangeFormattingEditProvider.has(this.editor.getModel())&&this._callOnModel.add(this.editor.onDidPaste(({range:C})=>this._trigger(C)))}_trigger(C){this.editor.hasModel()&&(this.editor.getSelections().length>1||this._instantiationService.invokeFunction(formatDocumentRangesWithSelectedProvider,this.editor,C,2,Progress.None,CancellationToken.None).catch(onUnexpectedError))}};FormatOnPaste.ID="editor.contrib.formatOnPaste";FormatOnPaste=__decorate$O([__param$O(1,ILanguageFeaturesService),__param$O(2,IInstantiationService)],FormatOnPaste);class FormatDocumentAction extends EditorAction{constructor(){super({id:"editor.action.formatDocument",label:localize("formatDocument.label","Format Document"),alias:"Format Document",precondition:ContextKeyExpr.and(EditorContextKeys.notInCompositeEditor,EditorContextKeys.writable,EditorContextKeys.hasDocumentFormattingProvider),kbOpts:{kbExpr:EditorContextKeys.editorTextFocus,primary:1572,linux:{primary:3111},weight:100},contextMenuOpts:{group:"1_modification",order:1.3}})}run(C,W){return __awaiter$z(this,void 0,void 0,function*(){if(W.hasModel()){const V=C.get(IInstantiationService);yield C.get(IEditorProgressService).showWhile(V.invokeFunction(formatDocumentWithSelectedProvider,W,1,Progress.None,CancellationToken.None),250)}})}}class FormatSelectionAction extends EditorAction{constructor(){super({id:"editor.action.formatSelection",label:localize("formatSelection.label","Format Selection"),alias:"Format Selection",precondition:ContextKeyExpr.and(EditorContextKeys.writable,EditorContextKeys.hasDocumentSelectionFormattingProvider),kbOpts:{kbExpr:EditorContextKeys.editorTextFocus,primary:KeyChord(2089,2084),weight:100},contextMenuOpts:{when:EditorContextKeys.hasNonEmptySelection,group:"1_modification",order:1.31}})}run(C,W){return __awaiter$z(this,void 0,void 0,function*(){if(!W.hasModel())return;const V=C.get(IInstantiationService),U=W.getModel(),G=W.getSelections().map(X=>X.isEmpty()?new Range$2(X.startLineNumber,1,X.startLineNumber,U.getLineMaxColumn(X.startLineNumber)):X);yield C.get(IEditorProgressService).showWhile(V.invokeFunction(formatDocumentRangesWithSelectedProvider,W,G,1,Progress.None,CancellationToken.None),250)})}}registerEditorContribution(FormatOnType.ID,FormatOnType,2);registerEditorContribution(FormatOnPaste.ID,FormatOnPaste,2);registerEditorAction(FormatDocumentAction);registerEditorAction(FormatSelectionAction);CommandsRegistry.registerCommand("editor.action.format",K=>__awaiter$z(void 0,void 0,void 0,function*(){const C=K.get(ICodeEditorService).getFocusedCodeEditor();if(!C||!C.hasModel())return;const W=K.get(ICommandService);C.getSelection().isEmpty()?yield W.executeCommand("editor.action.formatDocument"):yield W.executeCommand("editor.action.formatSelection")}));var __decorate$N=globalThis&&globalThis.__decorate||function(K,C,W,V){var U=arguments.length,G=U<3?C:V===null?V=Object.getOwnPropertyDescriptor(C,W):V,Z;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")G=Reflect.decorate(K,C,W,V);else for(var X=K.length-1;X>=0;X--)(Z=K[X])&&(G=(U<3?Z(G):U>3?Z(C,W,G):Z(C,W))||G);return U>3&&G&&Object.defineProperty(C,W,G),G},__param$N=globalThis&&globalThis.__param||function(K,C){return function(W,V){C(W,V,K)}},__awaiter$y=globalThis&&globalThis.__awaiter||function(K,C,W,V){function U(G){return G instanceof W?G:new W(function(Z){Z(G)})}return new(W||(W=Promise))(function(G,Z){function X(ee){try{J(V.next(ee))}catch(te){Z(te)}}function Q(ee){try{J(V.throw(ee))}catch(te){Z(te)}}function J(ee){ee.done?G(ee.value):U(ee.value).then(X,Q)}J((V=V.apply(K,C||[])).next())})};class TreeElement{remove(){var C;(C=this.parent)===null||C===void 0||C.children.delete(this.id)}static findId(C,W){let V;typeof C=="string"?V=`${W.id}/${C}`:(V=`${W.id}/${C.name}`,W.children.get(V)!==void 0&&(V=`${W.id}/${C.name}_${C.range.startLineNumber}_${C.range.startColumn}`));let U=V;for(let G=0;W.children.get(U)!==void 0;G++)U=`${V}_${G}`;return U}static empty(C){return C.children.size===0}}class OutlineElement extends TreeElement{constructor(C,W,V){super(),this.id=C,this.parent=W,this.symbol=V,this.children=new Map}}class OutlineGroup extends TreeElement{constructor(C,W,V,U){super(),this.id=C,this.parent=W,this.label=V,this.order=U,this.children=new Map}}class OutlineModel extends TreeElement{static create(C,W,V){const U=new CancellationTokenSource$1(V),G=new OutlineModel(W.uri),Z=C.ordered(W),X=Z.map((J,ee)=>{var te;const ie=TreeElement.findId(`provider_${ee}`,G),ne=new OutlineGroup(ie,G,(te=J.displayName)!==null&&te!==void 0?te:"Unknown Outline Provider",ee);return Promise.resolve(J.provideDocumentSymbols(W,U.token)).then(oe=>{for(const re of oe||[])OutlineModel._makeOutlineElement(re,ne);return ne},oe=>(onUnexpectedExternalError(oe),ne)).then(oe=>{TreeElement.empty(oe)?oe.remove():G._groups.set(ie,oe)})}),Q=C.onDidChange(()=>{const J=C.ordered(W);equals$5(J,Z)||U.cancel()});return Promise.all(X).then(()=>U.token.isCancellationRequested&&!V.isCancellationRequested?OutlineModel.create(C,W,V):G._compact()).finally(()=>{U.dispose(),Q.dispose(),U.dispose()})}static _makeOutlineElement(C,W){const V=TreeElement.findId(C,W),U=new OutlineElement(V,W,C);if(C.children)for(const G of C.children)OutlineModel._makeOutlineElement(G,U);W.children.set(U.id,U)}constructor(C){super(),this.uri=C,this.id="root",this.parent=void 0,this._groups=new Map,this.children=new Map,this.id="root",this.parent=void 0}_compact(){let C=0;for(const[W,V]of this._groups)V.children.size===0?this._groups.delete(W):C+=1;if(C!==1)this.children=this._groups;else{const W=Iterable.first(this._groups.values());for(const[,V]of W.children)V.parent=this,this.children.set(V.id,V)}return this}getTopLevelSymbols(){const C=[];for(const W of this.children.values())W instanceof OutlineElement?C.push(W.symbol):C.push(...Iterable.map(W.children.values(),V=>V.symbol));return C.sort((W,V)=>Range$2.compareRangesUsingStarts(W.range,V.range))}asListOfDocumentSymbols(){const C=this.getTopLevelSymbols(),W=[];return OutlineModel._flattenDocumentSymbols(W,C,""),W.sort((V,U)=>Position$1.compare(Range$2.getStartPosition(V.range),Range$2.getStartPosition(U.range))||Position$1.compare(Range$2.getEndPosition(U.range),Range$2.getEndPosition(V.range)))}static _flattenDocumentSymbols(C,W,V){for(const U of W)C.push({kind:U.kind,tags:U.tags,name:U.name,detail:U.detail,containerName:U.containerName||V,range:U.range,selectionRange:U.selectionRange,children:void 0}),U.children&&OutlineModel._flattenDocumentSymbols(C,U.children,U.name)}}const IOutlineModelService=createDecorator("IOutlineModelService");let OutlineModelService=class{constructor(C,W,V){this._languageFeaturesService=C,this._disposables=new DisposableStore,this._cache=new LRUCache(10,.7),this._debounceInformation=W.for(C.documentSymbolProvider,"DocumentSymbols",{min:350}),this._disposables.add(V.onModelRemoved(U=>{this._cache.delete(U.id)}))}dispose(){this._disposables.dispose()}getOrCreate(C,W){return __awaiter$y(this,void 0,void 0,function*(){const V=this._languageFeaturesService.documentSymbolProvider,U=V.ordered(C);let G=this._cache.get(C.id);if(!G||G.versionId!==C.getVersionId()||!equals$5(G.provider,U)){const X=new CancellationTokenSource$1;G={versionId:C.getVersionId(),provider:U,promiseCnt:0,source:X,promise:OutlineModel.create(V,C,X.token),model:void 0},this._cache.set(C.id,G);const Q=Date.now();G.promise.then(J=>{G.model=J,this._debounceInformation.update(C,Date.now()-Q)}).catch(J=>{this._cache.delete(C.id)})}if(G.model)return G.model;G.promiseCnt+=1;const Z=W.onCancellationRequested(()=>{--G.promiseCnt===0&&(G.source.cancel(),this._cache.delete(C.id))});try{return yield G.promise}finally{Z.dispose()}})}};OutlineModelService=__decorate$N([__param$N(0,ILanguageFeaturesService),__param$N(1,ILanguageFeatureDebounceService),__param$N(2,IModelService)],OutlineModelService);registerSingleton(IOutlineModelService,OutlineModelService,1);var __awaiter$x=globalThis&&globalThis.__awaiter||function(K,C,W,V){function U(G){return G instanceof W?G:new W(function(Z){Z(G)})}return new(W||(W=Promise))(function(G,Z){function X(ee){try{J(V.next(ee))}catch(te){Z(te)}}function Q(ee){try{J(V.throw(ee))}catch(te){Z(te)}}function J(ee){ee.done?G(ee.value):U(ee.value).then(X,Q)}J((V=V.apply(K,C||[])).next())})};CommandsRegistry.registerCommand("_executeDocumentSymbolProvider",function(K,...C){return __awaiter$x(this,void 0,void 0,function*(){const[W]=C;assertType(URI.isUri(W));const V=K.get(IOutlineModelService),G=yield K.get(ITextModelService).createModelReference(W);try{return(yield V.getOrCreate(G.object.textEditorModel,CancellationToken.None)).getTopLevelSymbols()}finally{G.dispose()}})});class InlineCompletionContextKeys extends Disposable{constructor(C,W){super(),this.contextKeyService=C,this.model=W,this.inlineCompletionVisible=InlineCompletionContextKeys.inlineSuggestionVisible.bindTo(this.contextKeyService),this.inlineCompletionSuggestsIndentation=InlineCompletionContextKeys.inlineSuggestionHasIndentation.bindTo(this.contextKeyService),this.inlineCompletionSuggestsIndentationLessThanTabSize=InlineCompletionContextKeys.inlineSuggestionHasIndentationLessThanTabSize.bindTo(this.contextKeyService),this.suppressSuggestions=InlineCompletionContextKeys.suppressSuggestions.bindTo(this.contextKeyService),this._register(autorun(V=>{const U=this.model.read(V),G=U==null?void 0:U.state.read(V),Z=!!(G!=null&&G.inlineCompletion)&&(G==null?void 0:G.ghostText)!==void 0&&!(G!=null&&G.ghostText.isEmpty());this.inlineCompletionVisible.set(Z),G!=null&&G.ghostText&&(G!=null&&G.inlineCompletion)&&this.suppressSuggestions.set(G.inlineCompletion.inlineCompletion.source.inlineCompletions.suppressSuggestions)})),this._register(autorun(V=>{const U=this.model.read(V);let G=!1,Z=!0;const X=U==null?void 0:U.ghostText.read(V);if(U!=null&&U.selectedSuggestItem&&X&&X.parts.length>0){const{column:Q,lines:J}=X.parts[0],ee=J[0],te=U.textModel.getLineIndentColumn(X.lineNumber);if(Q<=te){let ne=firstNonWhitespaceIndex(ee);ne===-1&&(ne=ee.length-1),G=ne>0;const oe=U.textModel.getOptions().tabSize;Z=CursorColumns.visibleColumnFromColumn(ee,ne+1,oe)<oe}}this.inlineCompletionSuggestsIndentation.set(G),this.inlineCompletionSuggestsIndentationLessThanTabSize.set(Z)}))}}InlineCompletionContextKeys.inlineSuggestionVisible=new RawContextKey("inlineSuggestionVisible",!1,localize("inlineSuggestionVisible","Whether an inline suggestion is visible"));InlineCompletionContextKeys.inlineSuggestionHasIndentation=new RawContextKey("inlineSuggestionHasIndentation",!1,localize("inlineSuggestionHasIndentation","Whether the inline suggestion starts with whitespace"));InlineCompletionContextKeys.inlineSuggestionHasIndentationLessThanTabSize=new RawContextKey("inlineSuggestionHasIndentationLessThanTabSize",!0,localize("inlineSuggestionHasIndentationLessThanTabSize","Whether the inline suggestion starts with whitespace that is less than what would be inserted by tab"));InlineCompletionContextKeys.suppressSuggestions=new RawContextKey("inlineSuggestionSuppressSuggestions",void 0,localize("suppressSuggestions","Whether suggestions should be suppressed for the current suggestion"));const ghostText="";function applyEdits(K,C){const W=new PositionOffsetTransformer(K),V=C.map(U=>{const G=Range$2.lift(U.range);return{startOffset:W.getOffset(G.getStartPosition()),endOffset:W.getOffset(G.getEndPosition()),text:U.text}});V.sort((U,G)=>G.startOffset-U.startOffset);for(const U of V)K=K.substring(0,U.startOffset)+U.text+K.substring(U.endOffset);return K}class PositionOffsetTransformer{constructor(C){this.lineStartOffsetByLineIdx=[],this.lineStartOffsetByLineIdx.push(0);for(let W=0;W<C.length;W++)C.charAt(W)===`
`&&this.lineStartOffsetByLineIdx.push(W+1)}getOffset(C){return this.lineStartOffsetByLineIdx[C.lineNumber-1]+C.column-1}}const array$1=[];function getReadonlyEmptyArray(){return array$1}class ColumnRange{constructor(C,W){if(this.startColumn=C,this.endColumnExclusive=W,C>W)throw new BugIndicatingError(`startColumn ${C} cannot be after endColumnExclusive ${W}`)}toRange(C){return new Range$2(C,this.startColumn,C,this.endColumnExclusive)}equals(C){return this.startColumn===C.startColumn&&this.endColumnExclusive===C.endColumnExclusive}}function applyObservableDecorations(K,C){const W=new DisposableStore,V=K.createDecorationsCollection();return W.add(autorunOpts({debugName:()=>`Apply decorations from ${C.debugName}`},U=>{const G=C.read(U);V.set(G)})),W.add({dispose:()=>{V.clear()}}),W}function addPositions(K,C){return new Position$1(K.lineNumber+C.lineNumber-1,C.lineNumber===1?K.column+C.column-1:C.column)}function lengthOfText(K){let C=1,W=1;for(const V of K)V===`
`?(C++,W=1):W++;return new Position$1(C,W)}class GhostText{constructor(C,W){this.lineNumber=C,this.parts=W}equals(C){return this.lineNumber===C.lineNumber&&this.parts.length===C.parts.length&&this.parts.every((W,V)=>W.equals(C.parts[V]))}renderForScreenReader(C){if(this.parts.length===0)return"";const W=this.parts[this.parts.length-1],V=C.substr(0,W.column-1);return applyEdits(V,this.parts.map(G=>({range:{startLineNumber:1,endLineNumber:1,startColumn:G.column,endColumn:G.column},text:G.lines.join(`
`)}))).substring(this.parts[0].column-1)}isEmpty(){return this.parts.every(C=>C.lines.length===0)}get lineCount(){return 1+this.parts.reduce((C,W)=>C+W.lines.length-1,0)}}class GhostTextPart{constructor(C,W,V){this.column=C,this.lines=W,this.preview=V}equals(C){return this.column===C.column&&this.lines.length===C.lines.length&&this.lines.every((W,V)=>W===C.lines[V])}}class GhostTextReplacement{constructor(C,W,V,U=0){this.lineNumber=C,this.columnRange=W,this.newLines=V,this.additionalReservedLineCount=U,this.parts=[new GhostTextPart(this.columnRange.endColumnExclusive,this.newLines,!1)]}renderForScreenReader(C){return this.newLines.join(`
`)}get lineCount(){return this.newLines.length}isEmpty(){return this.parts.every(C=>C.lines.length===0)}equals(C){return this.lineNumber===C.lineNumber&&this.columnRange.equals(C.columnRange)&&this.newLines.length===C.newLines.length&&this.newLines.every((W,V)=>W===C.newLines[V])&&this.additionalReservedLineCount===C.additionalReservedLineCount}}function ghostTextOrReplacementEquals(K,C){return K===C?!0:!K||!C?!1:K instanceof GhostText&&C instanceof GhostText||K instanceof GhostTextReplacement&&C instanceof GhostTextReplacement?K.equals(C):!1}var __decorate$M=globalThis&&globalThis.__decorate||function(K,C,W,V){var U=arguments.length,G=U<3?C:V===null?V=Object.getOwnPropertyDescriptor(C,W):V,Z;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")G=Reflect.decorate(K,C,W,V);else for(var X=K.length-1;X>=0;X--)(Z=K[X])&&(G=(U<3?Z(G):U>3?Z(C,W,G):Z(C,W))||G);return U>3&&G&&Object.defineProperty(C,W,G),G},__param$M=globalThis&&globalThis.__param||function(K,C){return function(W,V){C(W,V,K)}};const GHOST_TEXT_DESCRIPTION="ghost-text";let GhostTextWidget=class extends Disposable{constructor(C,W,V){super(),this.editor=C,this.model=W,this.languageService=V,this.isDisposed=observableValue(this,!1),this.currentTextModel=observableFromEvent(this.editor.onDidChangeModel,()=>this.editor.getModel()),this.uiState=derived(this,U=>{if(this.isDisposed.read(U))return;const G=this.currentTextModel.read(U);if(G!==this.model.targetTextModel.read(U))return;const Z=this.model.ghostText.read(U);if(!Z)return;const X=Z instanceof GhostTextReplacement?Z.columnRange:void 0,Q=[],J=[];function ee(re,ae){if(J.length>0){const se=J[J.length-1];ae&&se.decorations.push(new LineDecoration(se.content.length+1,se.content.length+1+re[0].length,ae,0)),se.content+=re[0],re=re.slice(1)}for(const se of re)J.push({content:se,decorations:ae?[new LineDecoration(1,se.length+1,ae,0)]:[]})}const te=G.getLineContent(Z.lineNumber);let ie,ne=0;for(const re of Z.parts){let ae=re.lines;ie===void 0?(Q.push({column:re.column,text:ae[0],preview:re.preview}),ae=ae.slice(1)):ee([te.substring(ne,re.column-1)],void 0),ae.length>0&&(ee(ae,GHOST_TEXT_DESCRIPTION),ie===void 0&&re.column<=te.length&&(ie=re.column)),ne=re.column-1}ie!==void 0&&ee([te.substring(ne)],void 0);const oe=ie!==void 0?new ColumnRange(ie,te.length+1):void 0;return{replacedRange:X,inlineTexts:Q,additionalLines:J,hiddenRange:oe,lineNumber:Z.lineNumber,additionalReservedLineCount:this.model.minReservedLineCount.read(U),targetTextModel:G}}),this.decorations=derived(this,U=>{const G=this.uiState.read(U);if(!G)return[];const Z=[];G.replacedRange&&Z.push({range:G.replacedRange.toRange(G.lineNumber),options:{inlineClassName:"inline-completion-text-to-replace",description:"GhostTextReplacement"}}),G.hiddenRange&&Z.push({range:G.hiddenRange.toRange(G.lineNumber),options:{inlineClassName:"ghost-text-hidden",description:"ghost-text-hidden"}});for(const X of G.inlineTexts)Z.push({range:Range$2.fromPositions(new Position$1(G.lineNumber,X.column)),options:{description:GHOST_TEXT_DESCRIPTION,after:{content:X.text,inlineClassName:X.preview?"ghost-text-decoration-preview":"ghost-text-decoration",cursorStops:InjectedTextCursorStops.Left},showIfCollapsed:!0}});return Z}),this.additionalLinesWidget=this._register(new AdditionalLinesWidget(this.editor,this.languageService.languageIdCodec,derived(U=>{const G=this.uiState.read(U);return G?{lineNumber:G.lineNumber,additionalLines:G.additionalLines,minReservedLineCount:G.additionalReservedLineCount,targetTextModel:G.targetTextModel}:void 0}))),this._register(toDisposable(()=>{this.isDisposed.set(!0,void 0)})),this._register(applyObservableDecorations(this.editor,this.decorations))}ownsViewZone(C){return this.additionalLinesWidget.viewZoneId===C}};GhostTextWidget=__decorate$M([__param$M(2,ILanguageService)],GhostTextWidget);class AdditionalLinesWidget extends Disposable{get viewZoneId(){return this._viewZoneId}constructor(C,W,V){super(),this.editor=C,this.languageIdCodec=W,this.lines=V,this._viewZoneId=void 0,this.editorOptionsChanged=observableSignalFromEvent("editorOptionChanged",Event$1.filter(this.editor.onDidChangeConfiguration,U=>U.hasChanged(33)||U.hasChanged(116)||U.hasChanged(98)||U.hasChanged(93)||U.hasChanged(51)||U.hasChanged(50)||U.hasChanged(66))),this._register(autorun(U=>{const G=this.lines.read(U);this.editorOptionsChanged.read(U),G?this.updateLines(G.lineNumber,G.additionalLines,G.minReservedLineCount):this.clear()}))}dispose(){super.dispose(),this.clear()}clear(){this.editor.changeViewZones(C=>{this._viewZoneId&&(C.removeZone(this._viewZoneId),this._viewZoneId=void 0)})}updateLines(C,W,V){const U=this.editor.getModel();if(!U)return;const{tabSize:G}=U.getOptions();this.editor.changeViewZones(Z=>{this._viewZoneId&&(Z.removeZone(this._viewZoneId),this._viewZoneId=void 0);const X=Math.max(W.length,V);if(X>0){const Q=document.createElement("div");renderLines(Q,G,W,this.editor.getOptions(),this.languageIdCodec),this._viewZoneId=Z.addZone({afterLineNumber:C,heightInLines:X,domNode:Q,afterColumnAffinity:1})}})}}function renderLines(K,C,W,V,U){const G=V.get(33),Z=V.get(116),X="none",Q=V.get(93),J=V.get(51),ee=V.get(50),te=V.get(66),ie=new StringBuilder(1e4);ie.appendString('<div class="suggest-preview-text">');for(let re=0,ae=W.length;re<ae;re++){const se=W[re],le=se.content;ie.appendString('<div class="view-line'),ie.appendString('" style="top:'),ie.appendString(String(re*te)),ie.appendString('px;width:1000000px;">');const ce=isBasicASCII(le),de=containsRTL(le),ue=LineTokens.createEmpty(le,U);renderViewLine(new RenderLineInput(ee.isMonospace&&!G,ee.canUseHalfwidthRightwardsArrow,le,!1,ce,de,0,ue,se.decorations,C,0,ee.spaceWidth,ee.middotWidth,ee.wsmiddotWidth,Z,X,Q,J!==EditorFontLigatures.OFF,null),ie),ie.appendString("</div>")}ie.appendString("</div>"),applyFontInfo(K,ee);const ne=ie.build(),oe=ttPolicy?ttPolicy.createHTML(ne):ne;K.innerHTML=oe}const ttPolicy=createTrustedTypesPolicy("editorGhostText",{createHTML:K=>K});function fixBracketsInLine(K,C){const W=new DenseKeyProvider,V=new LanguageAgnosticBracketTokens(W,J=>C.getLanguageConfiguration(J)),U=new TextBufferTokenizer(new StaticTokenizerSource([K]),V),G=parseDocument(U,[],void 0,!0);let Z="";const X=K.getLineContent();function Q(J,ee){if(J.kind===2)if(Q(J.openingBracket,ee),ee=lengthAdd(ee,J.openingBracket.length),J.child&&(Q(J.child,ee),ee=lengthAdd(ee,J.child.length)),J.closingBracket)Q(J.closingBracket,ee),ee=lengthAdd(ee,J.closingBracket.length);else{const ie=V.getSingleLanguageBracketTokens(J.openingBracket.languageId).findClosingTokenText(J.openingBracket.bracketIds);Z+=ie}else if(J.kind!==3){if(J.kind===0||J.kind===1)Z+=X.substring(ee,lengthAdd(ee,J.length));else if(J.kind===4)for(const te of J.children)Q(te,ee),ee=lengthAdd(ee,te.length)}}return Q(G,lengthZero),Z}class StaticTokenizerSource{constructor(C){this.lines=C,this.tokenization={getLineTokens:W=>this.lines[W-1]}}getLineCount(){return this.lines.length}getLineLength(C){return this.lines[C-1].getLineContent().length}}class Scanner{constructor(){this.value="",this.pos=0}static isDigitCharacter(C){return C>=48&&C<=57}static isVariableCharacter(C){return C===95||C>=97&&C<=122||C>=65&&C<=90}text(C){this.value=C,this.pos=0}tokenText(C){return this.value.substr(C.pos,C.len)}next(){if(this.pos>=this.value.length)return{type:14,pos:this.pos,len:0};const C=this.pos;let W=0,V=this.value.charCodeAt(C),U;if(U=Scanner._table[V],typeof U=="number")return this.pos+=1,{type:U,pos:C,len:1};if(Scanner.isDigitCharacter(V)){U=8;do W+=1,V=this.value.charCodeAt(C+W);while(Scanner.isDigitCharacter(V));return this.pos+=W,{type:U,pos:C,len:W}}if(Scanner.isVariableCharacter(V)){U=9;do V=this.value.charCodeAt(C+ ++W);while(Scanner.isVariableCharacter(V)||Scanner.isDigitCharacter(V));return this.pos+=W,{type:U,pos:C,len:W}}U=10;do W+=1,V=this.value.charCodeAt(C+W);while(!isNaN(V)&&typeof Scanner._table[V]>"u"&&!Scanner.isDigitCharacter(V)&&!Scanner.isVariableCharacter(V));return this.pos+=W,{type:U,pos:C,len:W}}}Scanner._table={36:0,58:1,44:2,123:3,125:4,92:5,47:6,124:7,43:11,45:12,63:13};class Marker{constructor(){this._children=[]}appendChild(C){return C instanceof Text&&this._children[this._children.length-1]instanceof Text?this._children[this._children.length-1].value+=C.value:(C.parent=this,this._children.push(C)),this}replace(C,W){const{parent:V}=C,U=V.children.indexOf(C),G=V.children.slice(0);G.splice(U,1,...W),V._children=G,function Z(X,Q){for(const J of X)J.parent=Q,Z(J.children,J)}(W,V)}get children(){return this._children}get rightMostDescendant(){return this._children.length>0?this._children[this._children.length-1].rightMostDescendant:this}get snippet(){let C=this;for(;;){if(!C)return;if(C instanceof TextmateSnippet)return C;C=C.parent}}toString(){return this.children.reduce((C,W)=>C+W.toString(),"")}len(){return 0}}class Text extends Marker{constructor(C){super(),this.value=C}toString(){return this.value}len(){return this.value.length}clone(){return new Text(this.value)}}class TransformableMarker extends Marker{}class Placeholder extends TransformableMarker{static compareByIndex(C,W){return C.index===W.index?0:C.isFinalTabstop?1:W.isFinalTabstop||C.index<W.index?-1:C.index>W.index?1:0}constructor(C){super(),this.index=C}get isFinalTabstop(){return this.index===0}get choice(){return this._children.length===1&&this._children[0]instanceof Choice?this._children[0]:void 0}clone(){const C=new Placeholder(this.index);return this.transform&&(C.transform=this.transform.clone()),C._children=this.children.map(W=>W.clone()),C}}class Choice extends Marker{constructor(){super(...arguments),this.options=[]}appendChild(C){return C instanceof Text&&(C.parent=this,this.options.push(C)),this}toString(){return this.options[0].value}len(){return this.options[0].len()}clone(){const C=new Choice;return this.options.forEach(C.appendChild,C),C}}class Transform extends Marker{constructor(){super(...arguments),this.regexp=new RegExp("")}resolve(C){const W=this;let V=!1,U=C.replace(this.regexp,function(){return V=!0,W._replace(Array.prototype.slice.call(arguments,0,-2))});return!V&&this._children.some(G=>G instanceof FormatString&&!!G.elseValue)&&(U=this._replace([])),U}_replace(C){let W="";for(const V of this._children)if(V instanceof FormatString){let U=C[V.index]||"";U=V.resolve(U),W+=U}else W+=V.toString();return W}toString(){return""}clone(){const C=new Transform;return C.regexp=new RegExp(this.regexp.source,(this.regexp.ignoreCase?"i":"")+(this.regexp.global?"g":"")),C._children=this.children.map(W=>W.clone()),C}}class FormatString extends Marker{constructor(C,W,V,U){super(),this.index=C,this.shorthandName=W,this.ifValue=V,this.elseValue=U}resolve(C){return this.shorthandName==="upcase"?C?C.toLocaleUpperCase():"":this.shorthandName==="downcase"?C?C.toLocaleLowerCase():"":this.shorthandName==="capitalize"?C?C[0].toLocaleUpperCase()+C.substr(1):"":this.shorthandName==="pascalcase"?C?this._toPascalCase(C):"":this.shorthandName==="camelcase"?C?this._toCamelCase(C):"":C&&typeof this.ifValue=="string"?this.ifValue:!C&&typeof this.elseValue=="string"?this.elseValue:C||""}_toPascalCase(C){const W=C.match(/[a-z0-9]+/gi);return W?W.map(V=>V.charAt(0).toUpperCase()+V.substr(1)).join(""):C}_toCamelCase(C){const W=C.match(/[a-z0-9]+/gi);return W?W.map((V,U)=>U===0?V.charAt(0).toLowerCase()+V.substr(1):V.charAt(0).toUpperCase()+V.substr(1)).join(""):C}clone(){return new FormatString(this.index,this.shorthandName,this.ifValue,this.elseValue)}}class Variable extends TransformableMarker{constructor(C){super(),this.name=C}resolve(C){let W=C.resolve(this);return this.transform&&(W=this.transform.resolve(W||"")),W!==void 0?(this._children=[new Text(W)],!0):!1}clone(){const C=new Variable(this.name);return this.transform&&(C.transform=this.transform.clone()),C._children=this.children.map(W=>W.clone()),C}}function walk(K,C){const W=[...K];for(;W.length>0;){const V=W.shift();if(!C(V))break;W.unshift(...V.children)}}class TextmateSnippet extends Marker{get placeholderInfo(){if(!this._placeholders){const C=[];let W;this.walk(function(V){return V instanceof Placeholder&&(C.push(V),W=!W||W.index<V.index?V:W),!0}),this._placeholders={all:C,last:W}}return this._placeholders}get placeholders(){const{all:C}=this.placeholderInfo;return C}offset(C){let W=0,V=!1;return this.walk(U=>U===C?(V=!0,!1):(W+=U.len(),!0)),V?W:-1}fullLen(C){let W=0;return walk([C],V=>(W+=V.len(),!0)),W}enclosingPlaceholders(C){const W=[];let{parent:V}=C;for(;V;)V instanceof Placeholder&&W.push(V),V=V.parent;return W}resolveVariables(C){return this.walk(W=>(W instanceof Variable&&W.resolve(C)&&(this._placeholders=void 0),!0)),this}appendChild(C){return this._placeholders=void 0,super.appendChild(C)}replace(C,W){return this._placeholders=void 0,super.replace(C,W)}clone(){const C=new TextmateSnippet;return this._children=this.children.map(W=>W.clone()),C}walk(C){walk(this.children,C)}}class SnippetParser{constructor(){this._scanner=new Scanner,this._token={type:14,pos:0,len:0}}static escape(C){return C.replace(/\$|}|\\/g,"\\$&")}static guessNeedsClipboard(C){return/\${?CLIPBOARD/.test(C)}parse(C,W,V){const U=new TextmateSnippet;return this.parseFragment(C,U),this.ensureFinalTabstop(U,V??!1,W??!1),U}parseFragment(C,W){const V=W.children.length;for(this._scanner.text(C),this._token=this._scanner.next();this._parse(W););const U=new Map,G=[];W.walk(Q=>(Q instanceof Placeholder&&(Q.isFinalTabstop?U.set(0,void 0):!U.has(Q.index)&&Q.children.length>0?U.set(Q.index,Q.children):G.push(Q)),!0));const Z=(Q,J)=>{const ee=U.get(Q.index);if(!ee)return;const te=new Placeholder(Q.index);te.transform=Q.transform;for(const ie of ee){const ne=ie.clone();te.appendChild(ne),ne instanceof Placeholder&&U.has(ne.index)&&!J.has(ne.index)&&(J.add(ne.index),Z(ne,J),J.delete(ne.index))}W.replace(Q,[te])},X=new Set;for(const Q of G)Z(Q,X);return W.children.slice(V)}ensureFinalTabstop(C,W,V){(W||V&&C.placeholders.length>0)&&(C.placeholders.find(G=>G.index===0)||C.appendChild(new Placeholder(0)))}_accept(C,W){if(C===void 0||this._token.type===C){const V=W?this._scanner.tokenText(this._token):!0;return this._token=this._scanner.next(),V}return!1}_backTo(C){return this._scanner.pos=C.pos+C.len,this._token=C,!1}_until(C){const W=this._token;for(;this._token.type!==C;){if(this._token.type===14)return!1;if(this._token.type===5){const U=this._scanner.next();if(U.type!==0&&U.type!==4&&U.type!==5)return!1}this._token=this._scanner.next()}const V=this._scanner.value.substring(W.pos,this._token.pos).replace(/\\(\$|}|\\)/g,"$1");return this._token=this._scanner.next(),V}_parse(C){return this._parseEscaped(C)||this._parseTabstopOrVariableName(C)||this._parseComplexPlaceholder(C)||this._parseComplexVariable(C)||this._parseAnything(C)}_parseEscaped(C){let W;return(W=this._accept(5,!0))?(W=this._accept(0,!0)||this._accept(4,!0)||this._accept(5,!0)||W,C.appendChild(new Text(W)),!0):!1}_parseTabstopOrVariableName(C){let W;const V=this._token;return this._accept(0)&&(W=this._accept(9,!0)||this._accept(8,!0))?(C.appendChild(/^\d+$/.test(W)?new Placeholder(Number(W)):new Variable(W)),!0):this._backTo(V)}_parseComplexPlaceholder(C){let W;const V=this._token;if(!(this._accept(0)&&this._accept(3)&&(W=this._accept(8,!0))))return this._backTo(V);const G=new Placeholder(Number(W));if(this._accept(1))for(;;){if(this._accept(4))return C.appendChild(G),!0;if(!this._parse(G))return C.appendChild(new Text("${"+W+":")),G.children.forEach(C.appendChild,C),!0}else if(G.index>0&&this._accept(7)){const Z=new Choice;for(;;){if(this._parseChoiceElement(Z)){if(this._accept(2))continue;if(this._accept(7)&&(G.appendChild(Z),this._accept(4)))return C.appendChild(G),!0}return this._backTo(V),!1}}else return this._accept(6)?this._parseTransform(G)?(C.appendChild(G),!0):(this._backTo(V),!1):this._accept(4)?(C.appendChild(G),!0):this._backTo(V)}_parseChoiceElement(C){const W=this._token,V=[];for(;!(this._token.type===2||this._token.type===7);){let U;if((U=this._accept(5,!0))?U=this._accept(2,!0)||this._accept(7,!0)||this._accept(5,!0)||U:U=this._accept(void 0,!0),!U)return this._backTo(W),!1;V.push(U)}return V.length===0?(this._backTo(W),!1):(C.appendChild(new Text(V.join(""))),!0)}_parseComplexVariable(C){let W;const V=this._token;if(!(this._accept(0)&&this._accept(3)&&(W=this._accept(9,!0))))return this._backTo(V);const G=new Variable(W);if(this._accept(1))for(;;){if(this._accept(4))return C.appendChild(G),!0;if(!this._parse(G))return C.appendChild(new Text("${"+W+":")),G.children.forEach(C.appendChild,C),!0}else return this._accept(6)?this._parseTransform(G)?(C.appendChild(G),!0):(this._backTo(V),!1):this._accept(4)?(C.appendChild(G),!0):this._backTo(V)}_parseTransform(C){const W=new Transform;let V="",U="";for(;!this._accept(6);){let G;if(G=this._accept(5,!0)){G=this._accept(6,!0)||G,V+=G;continue}if(this._token.type!==14){V+=this._accept(void 0,!0);continue}return!1}for(;!this._accept(6);){let G;if(G=this._accept(5,!0)){G=this._accept(5,!0)||this._accept(6,!0)||G,W.appendChild(new Text(G));continue}if(!(this._parseFormatString(W)||this._parseAnything(W)))return!1}for(;!this._accept(4);){if(this._token.type!==14){U+=this._accept(void 0,!0);continue}return!1}try{W.regexp=new RegExp(V,U)}catch{return!1}return C.transform=W,!0}_parseFormatString(C){const W=this._token;if(!this._accept(0))return!1;let V=!1;this._accept(3)&&(V=!0);const U=this._accept(8,!0);if(U)if(V){if(this._accept(4))return C.appendChild(new FormatString(Number(U))),!0;if(!this._accept(1))return this._backTo(W),!1}else return C.appendChild(new FormatString(Number(U))),!0;else return this._backTo(W),!1;if(this._accept(6)){const G=this._accept(9,!0);return!G||!this._accept(4)?(this._backTo(W),!1):(C.appendChild(new FormatString(Number(U),G)),!0)}else if(this._accept(11)){const G=this._until(4);if(G)return C.appendChild(new FormatString(Number(U),void 0,G,void 0)),!0}else if(this._accept(12)){const G=this._until(4);if(G)return C.appendChild(new FormatString(Number(U),void 0,void 0,G)),!0}else if(this._accept(13)){const G=this._until(1);if(G){const Z=this._until(4);if(Z)return C.appendChild(new FormatString(Number(U),void 0,G,Z)),!0}}else{const G=this._until(4);if(G)return C.appendChild(new FormatString(Number(U),void 0,void 0,G)),!0}return this._backTo(W),!1}_parseAnything(C){return this._token.type!==14?(C.appendChild(new Text(this._scanner.tokenText(this._token))),this._accept(void 0),!0):!1}}var __awaiter$w=globalThis&&globalThis.__awaiter||function(K,C,W,V){function U(G){return G instanceof W?G:new W(function(Z){Z(G)})}return new(W||(W=Promise))(function(G,Z){function X(ee){try{J(V.next(ee))}catch(te){Z(te)}}function Q(ee){try{J(V.throw(ee))}catch(te){Z(te)}}function J(ee){ee.done?G(ee.value):U(ee.value).then(X,Q)}J((V=V.apply(K,C||[])).next())})};function provideInlineCompletions(K,C,W,V,U=CancellationToken.None,G){return __awaiter$w(this,void 0,void 0,function*(){const Z=getDefaultRange(C,W),X=K.all(W),Q=new SetMap;for(const se of X)se.groupId&&Q.add(se.groupId,se);function J(se){if(!se.yieldsToGroupIds)return[];const le=[];for(const ce of se.yieldsToGroupIds||[]){const de=Q.get(ce);for(const ue of de)le.push(ue)}return le}const ee=new Map,te=new Set;function ie(se,le){if(le=[...le,se],te.has(se))return le;te.add(se);try{const ce=J(se);for(const de of ce){const ue=ie(de,le);if(ue)return ue}}finally{te.delete(se)}}function ne(se){const le=ee.get(se);if(le)return le;const ce=ie(se,[]);ce&&onUnexpectedExternalError(new Error(`Inline completions: cyclic yield-to dependency detected. Path: ${ce.map(ue=>ue.toString?ue.toString():""+ue).join(" -> ")}`));const de=new DeferredPromise;return ee.set(se,de.p),(()=>__awaiter$w(this,void 0,void 0,function*(){if(!ce){const ue=J(se);for(const ge of ue){const he=yield ne(ge);if(he&&he.items.length>0)return}}try{return yield se.provideInlineCompletions(W,C,V,U)}catch(ue){onUnexpectedExternalError(ue);return}}))().then(ue=>de.complete(ue),ue=>de.error(ue)),de.p}const oe=yield Promise.all(X.map(se=>__awaiter$w(this,void 0,void 0,function*(){return{provider:se,completions:yield ne(se)}}))),re=new Map,ae=[];for(const se of oe){const le=se.completions;if(!le)continue;const ce=new InlineCompletionList(le,se.provider);ae.push(ce);for(const de of le.items){const ue=InlineCompletionItem.from(de,ce,Z,W,G);re.set(ue.hash(),ue)}}return new InlineCompletionProviderResult(Array.from(re.values()),new Set(re.keys()),ae)})}class InlineCompletionProviderResult{constructor(C,W,V){this.completions=C,this.hashs=W,this.providerResults=V}has(C){return this.hashs.has(C.hash())}dispose(){for(const C of this.providerResults)C.removeRef()}}class InlineCompletionList{constructor(C,W){this.inlineCompletions=C,this.provider=W,this.refCount=1}addRef(){this.refCount++}removeRef(){this.refCount--,this.refCount===0&&this.provider.freeInlineCompletions(this.inlineCompletions)}}class InlineCompletionItem{static from(C,W,V,U,G){let Z,X,Q=C.range?Range$2.lift(C.range):V;if(typeof C.insertText=="string"){if(Z=C.insertText,G&&C.completeBracketPairs){Z=closeBrackets(Z,Q.getStartPosition(),U,G);const J=Z.length-C.insertText.length;J!==0&&(Q=new Range$2(Q.startLineNumber,Q.startColumn,Q.endLineNumber,Q.endColumn+J))}X=void 0}else if("snippet"in C.insertText){const J=C.insertText.snippet.length;if(G&&C.completeBracketPairs){C.insertText.snippet=closeBrackets(C.insertText.snippet,Q.getStartPosition(),U,G);const te=C.insertText.snippet.length-J;te!==0&&(Q=new Range$2(Q.startLineNumber,Q.startColumn,Q.endLineNumber,Q.endColumn+te))}const ee=new SnippetParser().parse(C.insertText.snippet);ee.children.length===1&&ee.children[0]instanceof Text?(Z=ee.children[0].value,X=void 0):(Z=ee.toString(),X={snippet:C.insertText.snippet,range:Q})}else assertNever(C.insertText);return new InlineCompletionItem(Z,C.command,Q,Z,X,C.additionalTextEdits||getReadonlyEmptyArray(),C,W)}constructor(C,W,V,U,G,Z,X,Q){this.filterText=C,this.command=W,this.range=V,this.insertText=U,this.snippetInfo=G,this.additionalTextEdits=Z,this.sourceInlineCompletion=X,this.source=Q,C=C.replace(/\r\n|\r/g,`
`),U=C.replace(/\r\n|\r/g,`
`)}withRange(C){return new InlineCompletionItem(this.filterText,this.command,C,this.insertText,this.snippetInfo,this.additionalTextEdits,this.sourceInlineCompletion,this.source)}hash(){return JSON.stringify({insertText:this.insertText,range:this.range.toString()})}}function getDefaultRange(K,C){const W=C.getWordAtPosition(K),V=C.getLineMaxColumn(K.lineNumber);return W?new Range$2(K.lineNumber,W.startColumn,K.lineNumber,V):Range$2.fromPositions(K,K.with(void 0,V))}function closeBrackets(K,C,W,V){const G=W.getLineContent(C.lineNumber).substring(0,C.column-1)+K,Z=W.tokenization.tokenizeLineWithEdit(C,G.length-(C.column-1),K),X=Z==null?void 0:Z.sliceAndInflate(C.column-1,G.length,0);return X?fixBracketsInLine(X,V):K}class SingleTextEdit{constructor(C,W){this.range=C,this.text=W}removeCommonPrefix(C,W){const V=W?this.range.intersectRanges(W):this.range;if(!V)return this;const U=C.getValueInRange(V,1),G=commonPrefixLength(U,this.text),Z=addPositions(this.range.getStartPosition(),lengthOfText(U.substring(0,G))),X=this.text.substring(G),Q=Range$2.fromPositions(Z,this.range.getEndPosition());return new SingleTextEdit(Q,X)}augments(C){return this.text.startsWith(C.text)&&rangeExtends(this.range,C.range)}computeGhostText(C,W,V,U=0){let G=this.removeCommonPrefix(C);if(G.range.endLineNumber!==G.range.startLineNumber)return;const Z=C.getLineContent(G.range.startLineNumber),X=getLeadingWhitespace(Z).length;if(G.range.startColumn-1<=X){const oe=getLeadingWhitespace(G.text).length,re=Z.substring(G.range.startColumn-1,X),[ae,se]=[G.range.getStartPosition(),G.range.getEndPosition()],le=ae.column+re.length<=se.column?ae.delta(0,re.length):se,ce=Range$2.fromPositions(le,se),de=G.text.startsWith(re)?G.text.substring(re.length):G.text.substring(oe);G=new SingleTextEdit(ce,de)}const J=C.getValueInRange(G.range),ee=cachingDiff(J,G.text);if(!ee)return;const te=G.range.startLineNumber,ie=new Array;if(W==="prefix"){const oe=ee.filter(re=>re.originalLength===0);if(oe.length>1||oe.length===1&&oe[0].originalStart!==J.length)return}const ne=G.text.length-U;for(const oe of ee){const re=G.range.startColumn+oe.originalStart+oe.originalLength;if(W==="subwordSmart"&&V&&V.lineNumber===G.range.startLineNumber&&re<V.column||oe.originalLength>0)return;if(oe.modifiedLength===0)continue;const ae=oe.modifiedStart+oe.modifiedLength,se=Math.max(oe.modifiedStart,Math.min(ae,ne)),le=G.text.substring(oe.modifiedStart,se),ce=G.text.substring(se,Math.max(oe.modifiedStart,ae));if(le.length>0){const de=splitLines(le);ie.push(new GhostTextPart(re,de,!1))}if(ce.length>0){const de=splitLines(ce);ie.push(new GhostTextPart(re,de,!0))}}return new GhostText(te,ie)}}function rangeExtends(K,C){return C.getStartPosition().equals(K.getStartPosition())&&C.getEndPosition().isBeforeOrEqual(K.getEndPosition())}let lastRequest;function cachingDiff(K,C){if((lastRequest==null?void 0:lastRequest.originalValue)===K&&(lastRequest==null?void 0:lastRequest.newValue)===C)return lastRequest==null?void 0:lastRequest.changes;{let W=smartDiff(K,C,!0);if(W){const V=deletedCharacters(W);if(V>0){const U=smartDiff(K,C,!1);U&&deletedCharacters(U)<V&&(W=U)}}return lastRequest={originalValue:K,newValue:C,changes:W},W}}function deletedCharacters(K){let C=0;for(const W of K)C+=W.originalLength;return C}function smartDiff(K,C,W){if(K.length>5e3||C.length>5e3)return;function V(J){let ee=0;for(let te=0,ie=J.length;te<ie;te++){const ne=J.charCodeAt(te);ne>ee&&(ee=ne)}return ee}const U=Math.max(V(K),V(C));function G(J){if(J<0)throw new Error("unexpected");return U+J+1}function Z(J){let ee=0,te=0;const ie=new Int32Array(J.length);for(let ne=0,oe=J.length;ne<oe;ne++)if(W&&J[ne]==="("){const re=te*100+ee;ie[ne]=G(2*re),ee++}else if(W&&J[ne]===")"){ee=Math.max(ee-1,0);const re=te*100+ee;ie[ne]=G(2*re+1),ee===0&&te++}else ie[ne]=J.charCodeAt(ne);return ie}const X=Z(K),Q=Z(C);return new LcsDiff({getElements:()=>X},{getElements:()=>Q}).ComputeDiff(!1).changes}var __decorate$L=globalThis&&globalThis.__decorate||function(K,C,W,V){var U=arguments.length,G=U<3?C:V===null?V=Object.getOwnPropertyDescriptor(C,W):V,Z;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")G=Reflect.decorate(K,C,W,V);else for(var X=K.length-1;X>=0;X--)(Z=K[X])&&(G=(U<3?Z(G):U>3?Z(C,W,G):Z(C,W))||G);return U>3&&G&&Object.defineProperty(C,W,G),G},__param$L=globalThis&&globalThis.__param||function(K,C){return function(W,V){C(W,V,K)}},__awaiter$v=globalThis&&globalThis.__awaiter||function(K,C,W,V){function U(G){return G instanceof W?G:new W(function(Z){Z(G)})}return new(W||(W=Promise))(function(G,Z){function X(ee){try{J(V.next(ee))}catch(te){Z(te)}}function Q(ee){try{J(V.throw(ee))}catch(te){Z(te)}}function J(ee){ee.done?G(ee.value):U(ee.value).then(X,Q)}J((V=V.apply(K,C||[])).next())})};let InlineCompletionsSource=class extends Disposable{constructor(C,W,V,U,G){super(),this.textModel=C,this.versionId=W,this._debounceValue=V,this.languageFeaturesService=U,this.languageConfigurationService=G,this._updateOperation=this._register(new MutableDisposable),this.inlineCompletions=disposableObservableValue("inlineCompletions",void 0),this.suggestWidgetInlineCompletions=disposableObservableValue("suggestWidgetInlineCompletions",void 0),this._register(this.textModel.onDidChangeContent(()=>{this._updateOperation.clear()}))}fetch(C,W,V){var U,G;const Z=new UpdateRequest(C,W,this.textModel.getVersionId()),X=W.selectedSuggestionInfo?this.suggestWidgetInlineCompletions:this.inlineCompletions;if(!((U=this._updateOperation.value)===null||U===void 0)&&U.request.satisfies(Z))return this._updateOperation.value.promise;if(!((G=X.get())===null||G===void 0)&&G.request.satisfies(Z))return Promise.resolve(!0);const Q=!!this._updateOperation.value;this._updateOperation.clear();const J=new CancellationTokenSource$1,ee=(()=>__awaiter$v(this,void 0,void 0,function*(){if((Q||W.triggerKind===InlineCompletionTriggerKind$1.Automatic)&&(yield wait(this._debounceValue.get(this.textModel))),J.token.isCancellationRequested||this.textModel.getVersionId()!==Z.versionId)return!1;const ne=new Date,oe=yield provideInlineCompletions(this.languageFeaturesService.inlineCompletionsProvider,C,this.textModel,W,J.token,this.languageConfigurationService);if(J.token.isCancellationRequested||this.textModel.getVersionId()!==Z.versionId)return!1;const re=new Date;this._debounceValue.update(this.textModel,re.getTime()-ne.getTime());const ae=new UpToDateInlineCompletions(oe,Z,this.textModel,this.versionId);if(V){const se=V.toInlineCompletion(void 0);V.canBeReused(this.textModel,C)&&!oe.has(se)&&ae.prepend(V.inlineCompletion,se.range,!0)}return this._updateOperation.clear(),transaction(se=>{X.set(ae,se)}),!0}))(),te=new UpdateOperation(Z,J,ee);return this._updateOperation.value=te,ee}clear(C){this._updateOperation.clear(),this.inlineCompletions.set(void 0,C),this.suggestWidgetInlineCompletions.set(void 0,C)}clearSuggestWidgetInlineCompletions(C){var W;!((W=this._updateOperation.value)===null||W===void 0)&&W.request.context.selectedSuggestionInfo&&this._updateOperation.clear(),this.suggestWidgetInlineCompletions.set(void 0,C)}cancelUpdate(){this._updateOperation.clear()}};InlineCompletionsSource=__decorate$L([__param$L(3,ILanguageFeaturesService),__param$L(4,ILanguageConfigurationService)],InlineCompletionsSource);function wait(K,C){return new Promise(W=>{let V;const U=setTimeout(()=>{V&&V.dispose(),W()},K);C&&(V=C.onCancellationRequested(()=>{clearTimeout(U),V&&V.dispose(),W()}))})}class UpdateRequest{constructor(C,W,V){this.position=C,this.context=W,this.versionId=V}satisfies(C){return this.position.equals(C.position)&&equals$3(this.context.selectedSuggestionInfo,C.context.selectedSuggestionInfo,(W,V)=>W.equals(V))&&(C.context.triggerKind===InlineCompletionTriggerKind$1.Automatic||this.context.triggerKind===InlineCompletionTriggerKind$1.Explicit)&&this.versionId===C.versionId}}function equals$3(K,C,W){return!K||!C?K===C:W(K,C)}class UpdateOperation{constructor(C,W,V){this.request=C,this.cancellationTokenSource=W,this.promise=V}dispose(){this.cancellationTokenSource.cancel()}}class UpToDateInlineCompletions{get inlineCompletions(){return this._inlineCompletions}constructor(C,W,V,U){this.inlineCompletionProviderResult=C,this.request=W,this.textModel=V,this.versionId=U,this._refCount=1,this._prependedInlineCompletionItems=[],this._rangeVersionIdValue=0,this._rangeVersionId=derived(this,Z=>{this.versionId.read(Z);let X=!1;for(const Q of this._inlineCompletions)X=X||Q._updateRange(this.textModel);return X&&this._rangeVersionIdValue++,this._rangeVersionIdValue});const G=V.deltaDecorations([],C.completions.map(Z=>({range:Z.range,options:{description:"inline-completion-tracking-range"}})));this._inlineCompletions=C.completions.map((Z,X)=>new InlineCompletionWithUpdatedRange(Z,G[X],this._rangeVersionId))}clone(){return this._refCount++,this}dispose(){if(this._refCount--,this._refCount===0){setTimeout(()=>{this.textModel.isDisposed()||this.textModel.deltaDecorations(this._inlineCompletions.map(C=>C.decorationId),[])},0),this.inlineCompletionProviderResult.dispose();for(const C of this._prependedInlineCompletionItems)C.source.removeRef()}}prepend(C,W,V){V&&C.source.addRef();const U=this.textModel.deltaDecorations([],[{range:W,options:{description:"inline-completion-tracking-range"}}])[0];this._inlineCompletions.unshift(new InlineCompletionWithUpdatedRange(C,U,this._rangeVersionId,W)),this._prependedInlineCompletionItems.push(C)}}class InlineCompletionWithUpdatedRange{get forwardStable(){var C;return(C=this.inlineCompletion.source.inlineCompletions.enableForwardStability)!==null&&C!==void 0?C:!1}constructor(C,W,V,U){this.inlineCompletion=C,this.decorationId=W,this.rangeVersion=V,this.semanticId=JSON.stringify([this.inlineCompletion.filterText,this.inlineCompletion.insertText,this.inlineCompletion.range.getStartPosition().toString()]),this._isValid=!0,this._updatedRange=U??C.range}toInlineCompletion(C){return this.inlineCompletion.withRange(this._getUpdatedRange(C))}toSingleTextEdit(C){return new SingleTextEdit(this._getUpdatedRange(C),this.inlineCompletion.insertText)}isVisible(C,W,V){const U=this._toFilterTextReplacement(V).removeCommonPrefix(C);if(!this._isValid||!this.inlineCompletion.range.getStartPosition().equals(this._getUpdatedRange(V).getStartPosition())||W.lineNumber!==U.range.startLineNumber)return!1;const G=C.getValueInRange(U.range,1).toLowerCase(),Z=U.text.toLowerCase(),X=Math.max(0,W.column-U.range.startColumn);let Q=Z.substring(0,X),J=Z.substring(X),ee=G.substring(0,X),te=G.substring(X);const ie=C.getLineIndentColumn(U.range.startLineNumber);return U.range.startColumn<=ie&&(ee=ee.trimStart(),ee.length===0&&(te=te.trimStart()),Q=Q.trimStart(),Q.length===0&&(J=J.trimStart())),Q.startsWith(ee)&&!!matchesSubString(te,J)}canBeReused(C,W){return this._isValid&&this._getUpdatedRange(void 0).containsPosition(W)&&this.isVisible(C,W,void 0)&&!this._isSmallerThanOriginal(void 0)}_toFilterTextReplacement(C){return new SingleTextEdit(this._getUpdatedRange(C),this.inlineCompletion.filterText)}_isSmallerThanOriginal(C){return length$2(this._getUpdatedRange(C)).isBefore(length$2(this.inlineCompletion.range))}_getUpdatedRange(C){return this.rangeVersion.read(C),this._updatedRange}_updateRange(C){const W=C.getDecorationRange(this.decorationId);return W?this._updatedRange.equalsRange(W)?!1:(this._updatedRange=W,!0):(this._isValid=!1,!0)}}function length$2(K){return K.startLineNumber===K.endLineNumber?new Position$1(1,1+K.endColumn-K.startColumn):new Position$1(1+K.endLineNumber-K.startLineNumber,K.endColumn)}var __awaiter$u=globalThis&&globalThis.__awaiter||function(K,C,W,V){function U(G){return G instanceof W?G:new W(function(Z){Z(G)})}return new(W||(W=Promise))(function(G,Z){function X(ee){try{J(V.next(ee))}catch(te){Z(te)}}function Q(ee){try{J(V.throw(ee))}catch(te){Z(te)}}function J(ee){ee.done?G(ee.value):U(ee.value).then(X,Q)}J((V=V.apply(K,C||[])).next())})};const Context$1={Visible:historyNavigationVisible,HasFocusedSuggestion:new RawContextKey("suggestWidgetHasFocusedSuggestion",!1,localize("suggestWidgetHasSelection","Whether any suggestion is focused")),DetailsVisible:new RawContextKey("suggestWidgetDetailsVisible",!1,localize("suggestWidgetDetailsVisible","Whether suggestion details are visible")),MultipleSuggestions:new RawContextKey("suggestWidgetMultipleSuggestions",!1,localize("suggestWidgetMultipleSuggestions","Whether there are multiple suggestions to pick from")),MakesTextEdit:new RawContextKey("suggestionMakesTextEdit",!0,localize("suggestionMakesTextEdit","Whether inserting the current suggestion yields in a change or has everything already been typed")),AcceptSuggestionsOnEnter:new RawContextKey("acceptSuggestionOnEnter",!0,localize("acceptSuggestionOnEnter","Whether suggestions are inserted when pressing Enter")),HasInsertAndReplaceRange:new RawContextKey("suggestionHasInsertAndReplaceRange",!1,localize("suggestionHasInsertAndReplaceRange","Whether the current suggestion has insert and replace behaviour")),InsertMode:new RawContextKey("suggestionInsertMode",void 0,{type:"string",description:localize("suggestionInsertMode","Whether the default behaviour is to insert or replace")}),CanResolve:new RawContextKey("suggestionCanResolve",!1,localize("suggestionCanResolve","Whether the current suggestion supports to resolve further details"))},suggestWidgetStatusbarMenu=new MenuId("suggestWidgetStatusBar");class CompletionItem{constructor(C,W,V,U){var G;this.position=C,this.completion=W,this.container=V,this.provider=U,this.isInvalid=!1,this.score=FuzzyScore.Default,this.distance=0,this.textLabel=typeof W.label=="string"?W.label:(G=W.label)===null||G===void 0?void 0:G.label,this.labelLow=this.textLabel.toLowerCase(),this.isInvalid=!this.textLabel,this.sortTextLow=W.sortText&&W.sortText.toLowerCase(),this.filterTextLow=W.filterText&&W.filterText.toLowerCase(),this.extensionId=W.extensionId,Range$2.isIRange(W.range)?(this.editStart=new Position$1(W.range.startLineNumber,W.range.startColumn),this.editInsertEnd=new Position$1(W.range.endLineNumber,W.range.endColumn),this.editReplaceEnd=new Position$1(W.range.endLineNumber,W.range.endColumn),this.isInvalid=this.isInvalid||Range$2.spansMultipleLines(W.range)||W.range.startLineNumber!==C.lineNumber):(this.editStart=new Position$1(W.range.insert.startLineNumber,W.range.insert.startColumn),this.editInsertEnd=new Position$1(W.range.insert.endLineNumber,W.range.insert.endColumn),this.editReplaceEnd=new Position$1(W.range.replace.endLineNumber,W.range.replace.endColumn),this.isInvalid=this.isInvalid||Range$2.spansMultipleLines(W.range.insert)||Range$2.spansMultipleLines(W.range.replace)||W.range.insert.startLineNumber!==C.lineNumber||W.range.replace.startLineNumber!==C.lineNumber||W.range.insert.startColumn!==W.range.replace.startColumn),typeof U.resolveCompletionItem!="function"&&(this._resolveCache=Promise.resolve(),this._resolveDuration=0)}get isResolved(){return this._resolveDuration!==void 0}get resolveDuration(){return this._resolveDuration!==void 0?this._resolveDuration:-1}resolve(C){return __awaiter$u(this,void 0,void 0,function*(){if(!this._resolveCache){const W=C.onCancellationRequested(()=>{this._resolveCache=void 0,this._resolveDuration=void 0}),V=new StopWatch(!0);this._resolveCache=Promise.resolve(this.provider.resolveCompletionItem(this.completion,C)).then(U=>{Object.assign(this.completion,U),this._resolveDuration=V.elapsed()},U=>{isCancellationError(U)&&(this._resolveCache=void 0,this._resolveDuration=void 0)}).finally(()=>{W.dispose()})}return this._resolveCache})}}class CompletionOptions{constructor(C=2,W=new Set,V=new Set,U=new Map,G=!0){this.snippetSortOrder=C,this.kindFilter=W,this.providerFilter=V,this.providerItemsToReuse=U,this.showDeprecated=G}}CompletionOptions.default=new CompletionOptions;let _snippetSuggestSupport;function getSnippetSuggestSupport(){return _snippetSuggestSupport}class CompletionItemModel{constructor(C,W,V,U){this.items=C,this.needsClipboard=W,this.durations=V,this.disposable=U}}function provideSuggestionItems(K,C,W,V=CompletionOptions.default,U={triggerKind:0},G=CancellationToken.None){return __awaiter$u(this,void 0,void 0,function*(){const Z=new StopWatch;W=W.clone();const X=C.getWordAtPosition(W),Q=X?new Range$2(W.lineNumber,X.startColumn,W.lineNumber,X.endColumn):Range$2.fromPositions(W),J={replace:Q,insert:Q.setEndPosition(W.lineNumber,W.column)},ee=[],te=new DisposableStore,ie=[];let ne=!1;const oe=(ae,se,le)=>{var ce,de,ue;let ge=!1;if(!se)return ge;for(const he of se.suggestions)if(!V.kindFilter.has(he.kind)){if(!V.showDeprecated&&(!((ce=he==null?void 0:he.tags)===null||ce===void 0)&&ce.includes(1)))continue;he.range||(he.range=J),he.sortText||(he.sortText=typeof he.label=="string"?he.label:he.label.label),!ne&&he.insertTextRules&&he.insertTextRules&4&&(ne=SnippetParser.guessNeedsClipboard(he.insertText)),ee.push(new CompletionItem(W,he,se,ae)),ge=!0}return isDisposable(se)&&te.add(se),ie.push({providerName:(de=ae._debugDisplayName)!==null&&de!==void 0?de:"unknown_provider",elapsedProvider:(ue=se.duration)!==null&&ue!==void 0?ue:-1,elapsedOverall:le.elapsed()}),ge},re=(()=>__awaiter$u(this,void 0,void 0,function*(){}))();for(const ae of K.orderedGroups(C)){let se=!1;if(yield Promise.all(ae.map(le=>__awaiter$u(this,void 0,void 0,function*(){if(V.providerItemsToReuse.has(le)){const ce=V.providerItemsToReuse.get(le);ce.forEach(de=>ee.push(de)),se=se||ce.length>0;return}if(!(V.providerFilter.size>0&&!V.providerFilter.has(le)))try{const ce=new StopWatch,de=yield le.provideCompletionItems(C,W,U,G);se=oe(le,de,ce)||se}catch(ce){onUnexpectedExternalError(ce)}}))),se||G.isCancellationRequested)break}return yield re,G.isCancellationRequested?(te.dispose(),Promise.reject(new CancellationError)):new CompletionItemModel(ee.sort(getSuggestionComparator(V.snippetSortOrder)),ne,{entries:ie,elapsed:Z.elapsed()},te)})}function defaultComparator(K,C){if(K.sortTextLow&&C.sortTextLow){if(K.sortTextLow<C.sortTextLow)return-1;if(K.sortTextLow>C.sortTextLow)return 1}return K.textLabel<C.textLabel?-1:K.textLabel>C.textLabel?1:K.completion.kind-C.completion.kind}function snippetUpComparator(K,C){if(K.completion.kind!==C.completion.kind){if(K.completion.kind===27)return-1;if(C.completion.kind===27)return 1}return defaultComparator(K,C)}function snippetDownComparator(K,C){if(K.completion.kind!==C.completion.kind){if(K.completion.kind===27)return 1;if(C.completion.kind===27)return-1}return defaultComparator(K,C)}const _snippetComparators=new Map;_snippetComparators.set(0,snippetUpComparator);_snippetComparators.set(2,snippetDownComparator);_snippetComparators.set(1,defaultComparator);function getSuggestionComparator(K){return _snippetComparators.get(K)}CommandsRegistry.registerCommand("_executeCompletionItemProvider",(K,...C)=>__awaiter$u(void 0,void 0,void 0,function*(){const[W,V,U,G]=C;assertType(URI.isUri(W)),assertType(Position$1.isIPosition(V)),assertType(typeof U=="string"||!U),assertType(typeof G=="number"||!G);const{completionProvider:Z}=K.get(ILanguageFeaturesService),X=yield K.get(ITextModelService).createModelReference(W);try{const Q={incomplete:!1,suggestions:[]},J=[],ee=X.object.textEditorModel.validatePosition(V),te=yield provideSuggestionItems(Z,X.object.textEditorModel,ee,void 0,{triggerCharacter:U??void 0,triggerKind:U?1:0});for(const ie of te.items)J.length<(G??0)&&J.push(ie.resolve(CancellationToken.None)),Q.incomplete=Q.incomplete||ie.container.incomplete,Q.suggestions.push(ie.completion);try{return yield Promise.all(J),Q}finally{setTimeout(()=>te.disposable.dispose(),100)}}finally{X.dispose()}}));function showSimpleSuggestions(K,C){var W;(W=K.getContribution("editor.contrib.suggestController"))===null||W===void 0||W.triggerSuggest(new Set().add(C),void 0,!0)}class QuickSuggestionsOptions{static isAllOff(C){return C.other==="off"&&C.comments==="off"&&C.strings==="off"}static isAllOn(C){return C.other==="on"&&C.comments==="on"&&C.strings==="on"}static valueFor(C,W){switch(W){case 1:return C.comments;case 2:return C.strings;default:return C.other}}}const snippetSession="";function normalizeDriveLetter(K,C=isWindows){return hasDriveLetter(K,C)?K.charAt(0).toUpperCase()+K.slice(1):K}var __decorate$K=globalThis&&globalThis.__decorate||function(K,C,W,V){var U=arguments.length,G=U<3?C:V===null?V=Object.getOwnPropertyDescriptor(C,W):V,Z;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")G=Reflect.decorate(K,C,W,V);else for(var X=K.length-1;X>=0;X--)(Z=K[X])&&(G=(U<3?Z(G):U>3?Z(C,W,G):Z(C,W))||G);return U>3&&G&&Object.defineProperty(C,W,G),G},__param$K=globalThis&&globalThis.__param||function(K,C){return function(W,V){C(W,V,K)}};class CompositeSnippetVariableResolver{constructor(C){this._delegates=C}resolve(C){for(const W of this._delegates){const V=W.resolve(C);if(V!==void 0)return V}}}class SelectionBasedVariableResolver{constructor(C,W,V,U){this._model=C,this._selection=W,this._selectionIdx=V,this._overtypingCapturer=U}resolve(C){const{name:W}=C;if(W==="SELECTION"||W==="TM_SELECTED_TEXT"){let V=this._model.getValueInRange(this._selection)||void 0,U=this._selection.startLineNumber!==this._selection.endLineNumber;if(!V&&this._overtypingCapturer){const G=this._overtypingCapturer.getLastOvertypedInfo(this._selectionIdx);G&&(V=G.value,U=G.multiline)}if(V&&U&&C.snippet){const G=this._model.getLineContent(this._selection.startLineNumber),Z=getLeadingWhitespace(G,0,this._selection.startColumn-1);let X=Z;C.snippet.walk(J=>J===C?!1:(J instanceof Text&&(X=getLeadingWhitespace(splitLines(J.value).pop())),!0));const Q=commonPrefixLength(X,Z);V=V.replace(/(\r\n|\r|\n)(.*)/g,(J,ee,te)=>`${ee}${X.substr(Q)}${te}`)}return V}else{if(W==="TM_CURRENT_LINE")return this._model.getLineContent(this._selection.positionLineNumber);if(W==="TM_CURRENT_WORD"){const V=this._model.getWordAtPosition({lineNumber:this._selection.positionLineNumber,column:this._selection.positionColumn});return V&&V.word||void 0}else{if(W==="TM_LINE_INDEX")return String(this._selection.positionLineNumber-1);if(W==="TM_LINE_NUMBER")return String(this._selection.positionLineNumber);if(W==="CURSOR_INDEX")return String(this._selectionIdx);if(W==="CURSOR_NUMBER")return String(this._selectionIdx+1)}}}}class ModelBasedVariableResolver{constructor(C,W){this._labelService=C,this._model=W}resolve(C){const{name:W}=C;if(W==="TM_FILENAME")return basename$1(this._model.uri.fsPath);if(W==="TM_FILENAME_BASE"){const V=basename$1(this._model.uri.fsPath),U=V.lastIndexOf(".");return U<=0?V:V.slice(0,U)}else{if(W==="TM_DIRECTORY")return dirname$1(this._model.uri.fsPath)==="."?"":this._labelService.getUriLabel(dirname(this._model.uri));if(W==="TM_FILEPATH")return this._labelService.getUriLabel(this._model.uri);if(W==="RELATIVE_FILEPATH")return this._labelService.getUriLabel(this._model.uri,{relative:!0,noPrefix:!0})}}}class ClipboardBasedVariableResolver{constructor(C,W,V,U){this._readClipboardText=C,this._selectionIdx=W,this._selectionCount=V,this._spread=U}resolve(C){if(C.name!=="CLIPBOARD")return;const W=this._readClipboardText();if(W){if(this._spread){const V=W.split(/\r\n|\n|\r/).filter(U=>!isFalsyOrWhitespace(U));if(V.length===this._selectionCount)return V[this._selectionIdx]}return W}}}let CommentBasedVariableResolver=class{constructor(C,W,V){this._model=C,this._selection=W,this._languageConfigurationService=V}resolve(C){const{name:W}=C,V=this._model.getLanguageIdAtPosition(this._selection.selectionStartLineNumber,this._selection.selectionStartColumn),U=this._languageConfigurationService.getLanguageConfiguration(V).comments;if(U){if(W==="LINE_COMMENT")return U.lineCommentToken||void 0;if(W==="BLOCK_COMMENT_START")return U.blockCommentStartToken||void 0;if(W==="BLOCK_COMMENT_END")return U.blockCommentEndToken||void 0}}};CommentBasedVariableResolver=__decorate$K([__param$K(2,ILanguageConfigurationService)],CommentBasedVariableResolver);class TimeBasedVariableResolver{constructor(){this._date=new Date}resolve(C){const{name:W}=C;if(W==="CURRENT_YEAR")return String(this._date.getFullYear());if(W==="CURRENT_YEAR_SHORT")return String(this._date.getFullYear()).slice(-2);if(W==="CURRENT_MONTH")return String(this._date.getMonth().valueOf()+1).padStart(2,"0");if(W==="CURRENT_DATE")return String(this._date.getDate().valueOf()).padStart(2,"0");if(W==="CURRENT_HOUR")return String(this._date.getHours().valueOf()).padStart(2,"0");if(W==="CURRENT_MINUTE")return String(this._date.getMinutes().valueOf()).padStart(2,"0");if(W==="CURRENT_SECOND")return String(this._date.getSeconds().valueOf()).padStart(2,"0");if(W==="CURRENT_DAY_NAME")return TimeBasedVariableResolver.dayNames[this._date.getDay()];if(W==="CURRENT_DAY_NAME_SHORT")return TimeBasedVariableResolver.dayNamesShort[this._date.getDay()];if(W==="CURRENT_MONTH_NAME")return TimeBasedVariableResolver.monthNames[this._date.getMonth()];if(W==="CURRENT_MONTH_NAME_SHORT")return TimeBasedVariableResolver.monthNamesShort[this._date.getMonth()];if(W==="CURRENT_SECONDS_UNIX")return String(Math.floor(this._date.getTime()/1e3));if(W==="CURRENT_TIMEZONE_OFFSET"){const V=this._date.getTimezoneOffset(),U=V>0?"-":"+",G=Math.trunc(Math.abs(V/60)),Z=G<10?"0"+G:G,X=Math.abs(V)-G*60,Q=X<10?"0"+X:X;return U+Z+":"+Q}}}TimeBasedVariableResolver.dayNames=[localize("Sunday","Sunday"),localize("Monday","Monday"),localize("Tuesday","Tuesday"),localize("Wednesday","Wednesday"),localize("Thursday","Thursday"),localize("Friday","Friday"),localize("Saturday","Saturday")];TimeBasedVariableResolver.dayNamesShort=[localize("SundayShort","Sun"),localize("MondayShort","Mon"),localize("TuesdayShort","Tue"),localize("WednesdayShort","Wed"),localize("ThursdayShort","Thu"),localize("FridayShort","Fri"),localize("SaturdayShort","Sat")];TimeBasedVariableResolver.monthNames=[localize("January","January"),localize("February","February"),localize("March","March"),localize("April","April"),localize("May","May"),localize("June","June"),localize("July","July"),localize("August","August"),localize("September","September"),localize("October","October"),localize("November","November"),localize("December","December")];TimeBasedVariableResolver.monthNamesShort=[localize("JanuaryShort","Jan"),localize("FebruaryShort","Feb"),localize("MarchShort","Mar"),localize("AprilShort","Apr"),localize("MayShort","May"),localize("JuneShort","Jun"),localize("JulyShort","Jul"),localize("AugustShort","Aug"),localize("SeptemberShort","Sep"),localize("OctoberShort","Oct"),localize("NovemberShort","Nov"),localize("DecemberShort","Dec")];class WorkspaceBasedVariableResolver{constructor(C){this._workspaceService=C}resolve(C){if(!this._workspaceService)return;const W=toWorkspaceIdentifier(this._workspaceService.getWorkspace());if(!isEmptyWorkspaceIdentifier(W)){if(C.name==="WORKSPACE_NAME")return this._resolveWorkspaceName(W);if(C.name==="WORKSPACE_FOLDER")return this._resoveWorkspacePath(W)}}_resolveWorkspaceName(C){if(isSingleFolderWorkspaceIdentifier(C))return basename$1(C.uri.path);let W=basename$1(C.configPath.path);return W.endsWith(WORKSPACE_EXTENSION)&&(W=W.substr(0,W.length-WORKSPACE_EXTENSION.length-1)),W}_resoveWorkspacePath(C){if(isSingleFolderWorkspaceIdentifier(C))return normalizeDriveLetter(C.uri.fsPath);const W=basename$1(C.configPath.path);let V=C.configPath.fsPath;return V.endsWith(W)&&(V=V.substr(0,V.length-W.length-1)),V?normalizeDriveLetter(V):"/"}}class RandomBasedVariableResolver{resolve(C){const{name:W}=C;if(W==="RANDOM")return Math.random().toString().slice(-6);if(W==="RANDOM_HEX")return Math.random().toString(16).slice(-6);if(W==="UUID")return generateUuid()}}var __decorate$J=globalThis&&globalThis.__decorate||function(K,C,W,V){var U=arguments.length,G=U<3?C:V===null?V=Object.getOwnPropertyDescriptor(C,W):V,Z;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")G=Reflect.decorate(K,C,W,V);else for(var X=K.length-1;X>=0;X--)(Z=K[X])&&(G=(U<3?Z(G):U>3?Z(C,W,G):Z(C,W))||G);return U>3&&G&&Object.defineProperty(C,W,G),G},__param$J=globalThis&&globalThis.__param||function(K,C){return function(W,V){C(W,V,K)}},SnippetSession_1;class OneSnippet{constructor(C,W,V){this._editor=C,this._snippet=W,this._snippetLineLeadingWhitespace=V,this._offset=-1,this._nestingLevel=1,this._placeholderGroups=groupBy$2(W.placeholders,Placeholder.compareByIndex),this._placeholderGroupsIdx=-1}initialize(C){this._offset=C.newPosition}dispose(){this._placeholderDecorations&&this._editor.removeDecorations([...this._placeholderDecorations.values()]),this._placeholderGroups.length=0}_initDecorations(){if(this._offset===-1)throw new Error("Snippet not initialized!");if(this._placeholderDecorations)return;this._placeholderDecorations=new Map;const C=this._editor.getModel();this._editor.changeDecorations(W=>{for(const V of this._snippet.placeholders){const U=this._snippet.offset(V),G=this._snippet.fullLen(V),Z=Range$2.fromPositions(C.getPositionAt(this._offset+U),C.getPositionAt(this._offset+U+G)),X=V.isFinalTabstop?OneSnippet._decor.inactiveFinal:OneSnippet._decor.inactive,Q=W.addDecoration(Z,X);this._placeholderDecorations.set(V,Q)}})}move(C){if(!this._editor.hasModel())return[];if(this._initDecorations(),this._placeholderGroupsIdx>=0){const U=[];for(const G of this._placeholderGroups[this._placeholderGroupsIdx])if(G.transform){const Z=this._placeholderDecorations.get(G),X=this._editor.getModel().getDecorationRange(Z),Q=this._editor.getModel().getValueInRange(X),J=G.transform.resolve(Q).split(/\r\n|\r|\n/);for(let ee=1;ee<J.length;ee++)J[ee]=this._editor.getModel().normalizeIndentation(this._snippetLineLeadingWhitespace+J[ee]);U.push(EditOperation.replace(X,J.join(this._editor.getModel().getEOL())))}U.length>0&&this._editor.executeEdits("snippet.placeholderTransform",U)}let W=!1;C===!0&&this._placeholderGroupsIdx<this._placeholderGroups.length-1?(this._placeholderGroupsIdx+=1,W=!0):C===!1&&this._placeholderGroupsIdx>0&&(this._placeholderGroupsIdx-=1,W=!0);const V=this._editor.getModel().changeDecorations(U=>{const G=new Set,Z=[];for(const X of this._placeholderGroups[this._placeholderGroupsIdx]){const Q=this._placeholderDecorations.get(X),J=this._editor.getModel().getDecorationRange(Q);Z.push(new Selection$1(J.startLineNumber,J.startColumn,J.endLineNumber,J.endColumn)),W=W&&this._hasPlaceholderBeenCollapsed(X),U.changeDecorationOptions(Q,X.isFinalTabstop?OneSnippet._decor.activeFinal:OneSnippet._decor.active),G.add(X);for(const ee of this._snippet.enclosingPlaceholders(X)){const te=this._placeholderDecorations.get(ee);U.changeDecorationOptions(te,ee.isFinalTabstop?OneSnippet._decor.activeFinal:OneSnippet._decor.active),G.add(ee)}}for(const[X,Q]of this._placeholderDecorations)G.has(X)||U.changeDecorationOptions(Q,X.isFinalTabstop?OneSnippet._decor.inactiveFinal:OneSnippet._decor.inactive);return Z});return W?this.move(C):V??[]}_hasPlaceholderBeenCollapsed(C){let W=C;for(;W;){if(W instanceof Placeholder){const V=this._placeholderDecorations.get(W);if(this._editor.getModel().getDecorationRange(V).isEmpty()&&W.toString().length>0)return!0}W=W.parent}return!1}get isAtFirstPlaceholder(){return this._placeholderGroupsIdx<=0||this._placeholderGroups.length===0}get isAtLastPlaceholder(){return this._placeholderGroupsIdx===this._placeholderGroups.length-1}get hasPlaceholder(){return this._snippet.placeholders.length>0}get isTrivialSnippet(){if(this._snippet.placeholders.length===0)return!0;if(this._snippet.placeholders.length===1){const[C]=this._snippet.placeholders;if(C.isFinalTabstop&&this._snippet.rightMostDescendant===C)return!0}return!1}computePossibleSelections(){const C=new Map;for(const W of this._placeholderGroups){let V;for(const U of W){if(U.isFinalTabstop)break;V||(V=[],C.set(U.index,V));const G=this._placeholderDecorations.get(U),Z=this._editor.getModel().getDecorationRange(G);if(!Z){C.delete(U.index);break}V.push(Z)}}return C}get activeChoice(){if(!this._placeholderDecorations)return;const C=this._placeholderGroups[this._placeholderGroupsIdx][0];if(!(C!=null&&C.choice))return;const W=this._placeholderDecorations.get(C);if(!W)return;const V=this._editor.getModel().getDecorationRange(W);if(V)return{range:V,choice:C.choice}}get hasChoice(){let C=!1;return this._snippet.walk(W=>(C=W instanceof Choice,!C)),C}merge(C){const W=this._editor.getModel();this._nestingLevel*=10,this._editor.changeDecorations(V=>{for(const U of this._placeholderGroups[this._placeholderGroupsIdx]){const G=C.shift();console.assert(G._offset!==-1),console.assert(!G._placeholderDecorations);const Z=G._snippet.placeholderInfo.last.index;for(const Q of G._snippet.placeholderInfo.all)Q.isFinalTabstop?Q.index=U.index+(Z+1)/this._nestingLevel:Q.index=U.index+Q.index/this._nestingLevel;this._snippet.replace(U,G._snippet.children);const X=this._placeholderDecorations.get(U);V.removeDecoration(X),this._placeholderDecorations.delete(U);for(const Q of G._snippet.placeholders){const J=G._snippet.offset(Q),ee=G._snippet.fullLen(Q),te=Range$2.fromPositions(W.getPositionAt(G._offset+J),W.getPositionAt(G._offset+J+ee)),ie=V.addDecoration(te,OneSnippet._decor.inactive);this._placeholderDecorations.set(Q,ie)}}this._placeholderGroups=groupBy$2(this._snippet.placeholders,Placeholder.compareByIndex)})}}OneSnippet._decor={active:ModelDecorationOptions.register({description:"snippet-placeholder-1",stickiness:0,className:"snippet-placeholder"}),inactive:ModelDecorationOptions.register({description:"snippet-placeholder-2",stickiness:1,className:"snippet-placeholder"}),activeFinal:ModelDecorationOptions.register({description:"snippet-placeholder-3",stickiness:1,className:"finish-snippet-placeholder"}),inactiveFinal:ModelDecorationOptions.register({description:"snippet-placeholder-4",stickiness:1,className:"finish-snippet-placeholder"})};const _defaultOptions$1={overwriteBefore:0,overwriteAfter:0,adjustWhitespace:!0,clipboardText:void 0,overtypingCapturer:void 0};let SnippetSession=SnippetSession_1=class{static adjustWhitespace(C,W,V,U,G){const Z=C.getLineContent(W.lineNumber),X=getLeadingWhitespace(Z,0,W.column-1);let Q;return U.walk(J=>{if(!(J instanceof Text)||J.parent instanceof Choice||G&&!G.has(J))return!0;const ee=J.value.split(/\r\n|\r|\n/);if(V){const ie=U.offset(J);if(ie===0)ee[0]=C.normalizeIndentation(ee[0]);else{Q=Q??U.toString();const ne=Q.charCodeAt(ie-1);(ne===10||ne===13)&&(ee[0]=C.normalizeIndentation(X+ee[0]))}for(let ne=1;ne<ee.length;ne++)ee[ne]=C.normalizeIndentation(X+ee[ne])}const te=ee.join(C.getEOL());return te!==J.value&&(J.parent.replace(J,[new Text(te)]),Q=void 0),!0}),X}static adjustSelection(C,W,V,U){if(V!==0||U!==0){const{positionLineNumber:G,positionColumn:Z}=W,X=Z-V,Q=Z+U,J=C.validateRange({startLineNumber:G,startColumn:X,endLineNumber:G,endColumn:Q});W=Selection$1.createWithDirection(J.startLineNumber,J.startColumn,J.endLineNumber,J.endColumn,W.getDirection())}return W}static createEditsAndSnippetsFromSelections(C,W,V,U,G,Z,X,Q,J){const ee=[],te=[];if(!C.hasModel())return{edits:ee,snippets:te};const ie=C.getModel(),ne=C.invokeWithinContext(de=>de.get(IWorkspaceContextService)),oe=C.invokeWithinContext(de=>new ModelBasedVariableResolver(de.get(ILabelService),ie)),re=()=>X,ae=ie.getValueInRange(SnippetSession_1.adjustSelection(ie,C.getSelection(),V,0)),se=ie.getValueInRange(SnippetSession_1.adjustSelection(ie,C.getSelection(),0,U)),le=ie.getLineFirstNonWhitespaceColumn(C.getSelection().positionLineNumber),ce=C.getSelections().map((de,ue)=>({selection:de,idx:ue})).sort((de,ue)=>Range$2.compareRangesUsingStarts(de.selection,ue.selection));for(const{selection:de,idx:ue}of ce){let ge=SnippetSession_1.adjustSelection(ie,de,V,0),he=SnippetSession_1.adjustSelection(ie,de,0,U);ae!==ie.getValueInRange(ge)&&(ge=de),se!==ie.getValueInRange(he)&&(he=de);const fe=de.setStartPosition(ge.startLineNumber,ge.startColumn).setEndPosition(he.endLineNumber,he.endColumn),pe=new SnippetParser().parse(W,!0,G),Se=fe.getStartPosition(),Le=SnippetSession_1.adjustWhitespace(ie,Se,Z||ue>0&&le!==ie.getLineFirstNonWhitespaceColumn(de.positionLineNumber),pe);pe.resolveVariables(new CompositeSnippetVariableResolver([oe,new ClipboardBasedVariableResolver(re,ue,ce.length,C.getOption(78)==="spread"),new SelectionBasedVariableResolver(ie,de,ue,Q),new CommentBasedVariableResolver(ie,de,J),new TimeBasedVariableResolver,new WorkspaceBasedVariableResolver(ne),new RandomBasedVariableResolver])),ee[ue]=EditOperation.replace(fe,pe.toString()),ee[ue].identifier={major:ue,minor:0},ee[ue]._isTracked=!0,te[ue]=new OneSnippet(C,pe,Le)}return{edits:ee,snippets:te}}static createEditsAndSnippetsFromEdits(C,W,V,U,G,Z,X){if(!C.hasModel()||W.length===0)return{edits:[],snippets:[]};const Q=[],J=C.getModel(),ee=new SnippetParser,te=new TextmateSnippet,ie=new CompositeSnippetVariableResolver([C.invokeWithinContext(oe=>new ModelBasedVariableResolver(oe.get(ILabelService),J)),new ClipboardBasedVariableResolver(()=>G,0,C.getSelections().length,C.getOption(78)==="spread"),new SelectionBasedVariableResolver(J,C.getSelection(),0,Z),new CommentBasedVariableResolver(J,C.getSelection(),X),new TimeBasedVariableResolver,new WorkspaceBasedVariableResolver(C.invokeWithinContext(oe=>oe.get(IWorkspaceContextService))),new RandomBasedVariableResolver]);W=W.sort((oe,re)=>Range$2.compareRangesUsingStarts(oe.range,re.range));let ne=0;for(let oe=0;oe<W.length;oe++){const{range:re,template:ae}=W[oe];if(oe>0){const ue=W[oe-1].range,ge=Range$2.fromPositions(ue.getEndPosition(),re.getStartPosition()),he=new Text(J.getValueInRange(ge));te.appendChild(he),ne+=he.value.length}const se=ee.parseFragment(ae,te);SnippetSession_1.adjustWhitespace(J,re.getStartPosition(),!0,te,new Set(se)),te.resolveVariables(ie);const le=te.toString(),ce=le.slice(ne);ne=le.length;const de=EditOperation.replace(re,ce);de.identifier={major:oe,minor:0},de._isTracked=!0,Q.push(de)}return ee.ensureFinalTabstop(te,V,!0),{edits:Q,snippets:[new OneSnippet(C,te,"")]}}constructor(C,W,V=_defaultOptions$1,U){this._editor=C,this._template=W,this._options=V,this._languageConfigurationService=U,this._templateMerges=[],this._snippets=[]}dispose(){dispose(this._snippets)}_logInfo(){return`template="${this._template}", merged_templates="${this._templateMerges.join(" -> ")}"`}insert(){if(!this._editor.hasModel())return;const{edits:C,snippets:W}=typeof this._template=="string"?SnippetSession_1.createEditsAndSnippetsFromSelections(this._editor,this._template,this._options.overwriteBefore,this._options.overwriteAfter,!1,this._options.adjustWhitespace,this._options.clipboardText,this._options.overtypingCapturer,this._languageConfigurationService):SnippetSession_1.createEditsAndSnippetsFromEdits(this._editor,this._template,!1,this._options.adjustWhitespace,this._options.clipboardText,this._options.overtypingCapturer,this._languageConfigurationService);this._snippets=W,this._editor.executeEdits("snippet",C,V=>{const U=V.filter(G=>!!G.identifier);for(let G=0;G<W.length;G++)W[G].initialize(U[G].textChange);return this._snippets[0].hasPlaceholder?this._move(!0):U.map(G=>Selection$1.fromPositions(G.range.getEndPosition()))}),this._editor.revealRange(this._editor.getSelections()[0])}merge(C,W=_defaultOptions$1){if(!this._editor.hasModel())return;this._templateMerges.push([this._snippets[0]._nestingLevel,this._snippets[0]._placeholderGroupsIdx,C]);const{edits:V,snippets:U}=SnippetSession_1.createEditsAndSnippetsFromSelections(this._editor,C,W.overwriteBefore,W.overwriteAfter,!0,W.adjustWhitespace,W.clipboardText,W.overtypingCapturer,this._languageConfigurationService);this._editor.executeEdits("snippet",V,G=>{const Z=G.filter(Q=>!!Q.identifier);for(let Q=0;Q<U.length;Q++)U[Q].initialize(Z[Q].textChange);const X=U[0].isTrivialSnippet;if(!X){for(const Q of this._snippets)Q.merge(U);console.assert(U.length===0)}return this._snippets[0].hasPlaceholder&&!X?this._move(void 0):Z.map(Q=>Selection$1.fromPositions(Q.range.getEndPosition()))})}next(){const C=this._move(!0);this._editor.setSelections(C),this._editor.revealPositionInCenterIfOutsideViewport(C[0].getPosition())}prev(){const C=this._move(!1);this._editor.setSelections(C),this._editor.revealPositionInCenterIfOutsideViewport(C[0].getPosition())}_move(C){const W=[];for(const V of this._snippets){const U=V.move(C);W.push(...U)}return W}get isAtFirstPlaceholder(){return this._snippets[0].isAtFirstPlaceholder}get isAtLastPlaceholder(){return this._snippets[0].isAtLastPlaceholder}get hasPlaceholder(){return this._snippets[0].hasPlaceholder}get hasChoice(){return this._snippets[0].hasChoice}get activeChoice(){return this._snippets[0].activeChoice}isSelectionWithinPlaceholders(){if(!this.hasPlaceholder)return!1;const C=this._editor.getSelections();if(C.length<this._snippets.length)return!1;const W=new Map;for(const V of this._snippets){const U=V.computePossibleSelections();if(W.size===0)for(const[G,Z]of U){Z.sort(Range$2.compareRangesUsingStarts);for(const X of C)if(Z[0].containsRange(X)){W.set(G,[]);break}}if(W.size===0)return!1;W.forEach((G,Z)=>{G.push(...U.get(Z))})}C.sort(Range$2.compareRangesUsingStarts);for(const[V,U]of W){if(U.length!==C.length){W.delete(V);continue}U.sort(Range$2.compareRangesUsingStarts);for(let G=0;G<U.length;G++)if(!U[G].containsRange(C[G])){W.delete(V);continue}}return W.size>0}};SnippetSession=SnippetSession_1=__decorate$J([__param$J(3,ILanguageConfigurationService)],SnippetSession);var __decorate$I=globalThis&&globalThis.__decorate||function(K,C,W,V){var U=arguments.length,G=U<3?C:V===null?V=Object.getOwnPropertyDescriptor(C,W):V,Z;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")G=Reflect.decorate(K,C,W,V);else for(var X=K.length-1;X>=0;X--)(Z=K[X])&&(G=(U<3?Z(G):U>3?Z(C,W,G):Z(C,W))||G);return U>3&&G&&Object.defineProperty(C,W,G),G},__param$I=globalThis&&globalThis.__param||function(K,C){return function(W,V){C(W,V,K)}},SnippetController2_1;const _defaultOptions={overwriteBefore:0,overwriteAfter:0,undoStopBefore:!0,undoStopAfter:!0,adjustWhitespace:!0,clipboardText:void 0,overtypingCapturer:void 0};let SnippetController2=SnippetController2_1=class{static get(C){return C.getContribution(SnippetController2_1.ID)}constructor(C,W,V,U,G){this._editor=C,this._logService=W,this._languageFeaturesService=V,this._languageConfigurationService=G,this._snippetListener=new DisposableStore,this._modelVersionId=-1,this._inSnippet=SnippetController2_1.InSnippetMode.bindTo(U),this._hasNextTabstop=SnippetController2_1.HasNextTabstop.bindTo(U),this._hasPrevTabstop=SnippetController2_1.HasPrevTabstop.bindTo(U)}dispose(){var C;this._inSnippet.reset(),this._hasPrevTabstop.reset(),this._hasNextTabstop.reset(),(C=this._session)===null||C===void 0||C.dispose(),this._snippetListener.dispose()}insert(C,W){try{this._doInsert(C,typeof W>"u"?_defaultOptions:Object.assign(Object.assign({},_defaultOptions),W))}catch(V){this.cancel(),this._logService.error(V),this._logService.error("snippet_error"),this._logService.error("insert_template=",C),this._logService.error("existing_template=",this._session?this._session._logInfo():"<no_session>")}}_doInsert(C,W){var V;if(this._editor.hasModel()){if(this._snippetListener.clear(),W.undoStopBefore&&this._editor.getModel().pushStackElement(),this._session&&typeof C!="string"&&this.cancel(),this._session?(assertType(typeof C=="string"),this._session.merge(C,W)):(this._modelVersionId=this._editor.getModel().getAlternativeVersionId(),this._session=new SnippetSession(this._editor,C,W,this._languageConfigurationService),this._session.insert()),W.undoStopAfter&&this._editor.getModel().pushStackElement(),!((V=this._session)===null||V===void 0)&&V.hasChoice){const U={_debugDisplayName:"snippetChoiceCompletions",provideCompletionItems:(ee,te)=>{if(!this._session||ee!==this._editor.getModel()||!Position$1.equals(this._editor.getPosition(),te))return;const{activeChoice:ie}=this._session;if(!ie||ie.choice.options.length===0)return;const ne=ee.getValueInRange(ie.range),oe=!!ie.choice.options.find(ae=>ae.value===ne),re=[];for(let ae=0;ae<ie.choice.options.length;ae++){const se=ie.choice.options[ae];re.push({kind:13,label:se.value,insertText:se.value,sortText:"a".repeat(ae+1),range:ie.range,filterText:oe?`${ne}_${se.value}`:void 0,command:{id:"jumpToNextSnippetPlaceholder",title:localize("next","Go to next placeholder...")}})}return{suggestions:re}}},G=this._editor.getModel();let Z,X=!1;const Q=()=>{Z==null||Z.dispose(),X=!1},J=()=>{X||(Z=this._languageFeaturesService.completionProvider.register({language:G.getLanguageId(),pattern:G.uri.fsPath,scheme:G.uri.scheme,exclusive:!0},U),this._snippetListener.add(Z),X=!0)};this._choiceCompletions={provider:U,enable:J,disable:Q}}this._updateState(),this._snippetListener.add(this._editor.onDidChangeModelContent(U=>U.isFlush&&this.cancel())),this._snippetListener.add(this._editor.onDidChangeModel(()=>this.cancel())),this._snippetListener.add(this._editor.onDidChangeCursorSelection(()=>this._updateState()))}}_updateState(){if(!(!this._session||!this._editor.hasModel())){if(this._modelVersionId===this._editor.getModel().getAlternativeVersionId())return this.cancel();if(!this._session.hasPlaceholder)return this.cancel();if(this._session.isAtLastPlaceholder||!this._session.isSelectionWithinPlaceholders())return this._editor.getModel().pushStackElement(),this.cancel();this._inSnippet.set(!0),this._hasPrevTabstop.set(!this._session.isAtFirstPlaceholder),this._hasNextTabstop.set(!this._session.isAtLastPlaceholder),this._handleChoice()}}_handleChoice(){var C;if(!this._session||!this._editor.hasModel()){this._currentChoice=void 0;return}const{activeChoice:W}=this._session;if(!W||!this._choiceCompletions){(C=this._choiceCompletions)===null||C===void 0||C.disable(),this._currentChoice=void 0;return}this._currentChoice!==W.choice&&(this._currentChoice=W.choice,this._choiceCompletions.enable(),queueMicrotask(()=>{showSimpleSuggestions(this._editor,this._choiceCompletions.provider)}))}finish(){for(;this._inSnippet.get();)this.next()}cancel(C=!1){var W;this._inSnippet.reset(),this._hasPrevTabstop.reset(),this._hasNextTabstop.reset(),this._snippetListener.clear(),this._currentChoice=void 0,(W=this._session)===null||W===void 0||W.dispose(),this._session=void 0,this._modelVersionId=-1,C&&this._editor.setSelections([this._editor.getSelection()])}prev(){var C;(C=this._session)===null||C===void 0||C.prev(),this._updateState()}next(){var C;(C=this._session)===null||C===void 0||C.next(),this._updateState()}isInSnippet(){return!!this._inSnippet.get()}};SnippetController2.ID="snippetController2";SnippetController2.InSnippetMode=new RawContextKey("inSnippetMode",!1,localize("inSnippetMode","Whether the editor in current in snippet mode"));SnippetController2.HasNextTabstop=new RawContextKey("hasNextTabstop",!1,localize("hasNextTabstop","Whether there is a next tab stop when in snippet mode"));SnippetController2.HasPrevTabstop=new RawContextKey("hasPrevTabstop",!1,localize("hasPrevTabstop","Whether there is a previous tab stop when in snippet mode"));SnippetController2=SnippetController2_1=__decorate$I([__param$I(1,ILogService),__param$I(2,ILanguageFeaturesService),__param$I(3,IContextKeyService),__param$I(4,ILanguageConfigurationService)],SnippetController2);registerEditorContribution(SnippetController2.ID,SnippetController2,4);const CommandCtor=EditorCommand.bindToContribution(SnippetController2.get);registerEditorCommand(new CommandCtor({id:"jumpToNextSnippetPlaceholder",precondition:ContextKeyExpr.and(SnippetController2.InSnippetMode,SnippetController2.HasNextTabstop),handler:K=>K.next(),kbOpts:{weight:100+30,kbExpr:EditorContextKeys.editorTextFocus,primary:2}}));registerEditorCommand(new CommandCtor({id:"jumpToPrevSnippetPlaceholder",precondition:ContextKeyExpr.and(SnippetController2.InSnippetMode,SnippetController2.HasPrevTabstop),handler:K=>K.prev(),kbOpts:{weight:100+30,kbExpr:EditorContextKeys.editorTextFocus,primary:1026}}));registerEditorCommand(new CommandCtor({id:"leaveSnippet",precondition:SnippetController2.InSnippetMode,handler:K=>K.cancel(!0),kbOpts:{weight:100+30,kbExpr:EditorContextKeys.editorTextFocus,primary:9,secondary:[1033]}}));registerEditorCommand(new CommandCtor({id:"acceptSnippet",precondition:SnippetController2.InSnippetMode,handler:K=>K.finish()}));var __decorate$H=globalThis&&globalThis.__decorate||function(K,C,W,V){var U=arguments.length,G=U<3?C:V===null?V=Object.getOwnPropertyDescriptor(C,W):V,Z;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")G=Reflect.decorate(K,C,W,V);else for(var X=K.length-1;X>=0;X--)(Z=K[X])&&(G=(U<3?Z(G):U>3?Z(C,W,G):Z(C,W))||G);return U>3&&G&&Object.defineProperty(C,W,G),G},__param$H=globalThis&&globalThis.__param||function(K,C){return function(W,V){C(W,V,K)}},__awaiter$t=globalThis&&globalThis.__awaiter||function(K,C,W,V){function U(G){return G instanceof W?G:new W(function(Z){Z(G)})}return new(W||(W=Promise))(function(G,Z){function X(ee){try{J(V.next(ee))}catch(te){Z(te)}}function Q(ee){try{J(V.throw(ee))}catch(te){Z(te)}}function J(ee){ee.done?G(ee.value):U(ee.value).then(X,Q)}J((V=V.apply(K,C||[])).next())})},VersionIdChangeReason;(function(K){K[K.Undo=0]="Undo",K[K.Redo=1]="Redo",K[K.AcceptWord=2]="AcceptWord",K[K.Other=3]="Other"})(VersionIdChangeReason||(VersionIdChangeReason={}));let InlineCompletionsModel=class extends Disposable{get isAcceptingPartially(){return this._isAcceptingPartially}constructor(C,W,V,U,G,Z,X,Q,J,ee,te,ie){super(),this.textModel=C,this.selectedSuggestItem=W,this.cursorPosition=V,this.textModelVersionId=U,this._debounceValue=G,this._suggestPreviewEnabled=Z,this._suggestPreviewMode=X,this._inlineSuggestMode=Q,this._enabled=J,this._instantiationService=ee,this._commandService=te,this._languageConfigurationService=ie,this._source=this._register(this._instantiationService.createInstance(InlineCompletionsSource,this.textModel,this.textModelVersionId,this._debounceValue)),this._isActive=observableValue(this,!1),this._forceUpdate=observableSignal("forceUpdate"),this._selectedInlineCompletionId=observableValue(this,void 0),this._isAcceptingPartially=!1,this._preserveCurrentCompletionReasons=new Set([VersionIdChangeReason.Redo,VersionIdChangeReason.Undo,VersionIdChangeReason.AcceptWord]),this._fetchInlineCompletions=derivedHandleChanges({owner:this,createEmptyChangeSummary:()=>({preserveCurrentCompletion:!1,inlineCompletionTriggerKind:InlineCompletionTriggerKind$1.Automatic}),handleChange:(oe,re)=>(oe.didChange(this.textModelVersionId)&&this._preserveCurrentCompletionReasons.has(oe.change)?re.preserveCurrentCompletion=!0:oe.didChange(this._forceUpdate)&&(re.inlineCompletionTriggerKind=oe.change),!0)},(oe,re)=>{if(this._forceUpdate.read(oe),!(this._enabled.read(oe)&&this.selectedSuggestItem.read(oe)||this._isActive.read(oe))){this._source.cancelUpdate();return}this.textModelVersionId.read(oe);const se=this.selectedInlineCompletion.get(),le=re.preserveCurrentCompletion||se!=null&&se.forwardStable?se:void 0,ce=this._source.suggestWidgetInlineCompletions.get(),de=this.selectedSuggestItem.read(oe);if(ce&&!de){const he=this._source.inlineCompletions.get();transaction(fe=>{he&&ce.request.versionId>he.request.versionId&&this._source.inlineCompletions.set(ce.clone(),fe),this._source.clearSuggestWidgetInlineCompletions(fe)})}const ue=this.cursorPosition.read(oe),ge={triggerKind:re.inlineCompletionTriggerKind,selectedSuggestionInfo:de==null?void 0:de.toSelectedSuggestionInfo()};return this._source.fetch(ue,ge,le)}),this._filteredInlineCompletionItems=derived(this,oe=>{const re=this._source.inlineCompletions.read(oe);if(!re)return[];const ae=this.cursorPosition.read(oe);return re.inlineCompletions.filter(le=>le.isVisible(this.textModel,ae,oe))}),this.selectedInlineCompletionIndex=derived(this,oe=>{const re=this._selectedInlineCompletionId.read(oe),ae=this._filteredInlineCompletionItems.read(oe),se=this._selectedInlineCompletionId===void 0?-1:ae.findIndex(le=>le.semanticId===re);return se===-1?(this._selectedInlineCompletionId.set(void 0,void 0),0):se}),this.selectedInlineCompletion=derived(this,oe=>{const re=this._filteredInlineCompletionItems.read(oe),ae=this.selectedInlineCompletionIndex.read(oe);return re[ae]}),this.lastTriggerKind=this._source.inlineCompletions.map(oe=>oe==null?void 0:oe.request.context.triggerKind),this.inlineCompletionsCount=derived(this,oe=>{if(this.lastTriggerKind.read(oe)===InlineCompletionTriggerKind$1.Explicit)return this._filteredInlineCompletionItems.read(oe).length}),this.state=derivedOpts({owner:this,equalityComparer:(oe,re)=>!oe||!re?oe===re:ghostTextOrReplacementEquals(oe.ghostText,re.ghostText)&&oe.inlineCompletion===re.inlineCompletion&&oe.suggestItem===re.suggestItem},oe=>{var re;const ae=this.textModel,se=this.selectedSuggestItem.read(oe);if(se){const le=se.toSingleTextEdit().removeCommonPrefix(ae),ce=this._computeAugmentedCompletion(le,oe);if(!this._suggestPreviewEnabled.read(oe)&&!ce)return;const ue=(re=ce==null?void 0:ce.edit)!==null&&re!==void 0?re:le,ge=ce?ce.edit.text.length-le.text.length:0,he=this._suggestPreviewMode.read(oe),fe=this.cursorPosition.read(oe),pe=ue.computeGhostText(ae,he,fe,ge);return{ghostText:pe??new GhostText(ue.range.endLineNumber,[]),inlineCompletion:ce==null?void 0:ce.completion,suggestItem:se}}else{if(!this._isActive.read(oe))return;const le=this.selectedInlineCompletion.read(oe);if(!le)return;const ce=le.toSingleTextEdit(oe),de=this._inlineSuggestMode.read(oe),ue=this.cursorPosition.read(oe),ge=ce.computeGhostText(ae,de,ue);return ge?{ghostText:ge,inlineCompletion:le,suggestItem:void 0}:void 0}}),this.ghostText=derivedOpts({owner:this,equalityComparer:ghostTextOrReplacementEquals},oe=>{const re=this.state.read(oe);if(re)return re.ghostText}),this._register(recomputeInitiallyAndOnChange(this._fetchInlineCompletions));let ne;this._register(autorun(oe=>{var re,ae;const se=this.state.read(oe),le=se==null?void 0:se.inlineCompletion;if((le==null?void 0:le.semanticId)!==(ne==null?void 0:ne.semanticId)&&(ne=le,le)){const ce=le.inlineCompletion,de=ce.source;(ae=(re=de.provider).handleItemDidShow)===null||ae===void 0||ae.call(re,de.inlineCompletions,ce.sourceInlineCompletion,ce.insertText)}}))}trigger(C){return __awaiter$t(this,void 0,void 0,function*(){this._isActive.set(!0,C),yield this._fetchInlineCompletions.get()})}triggerExplicitly(C){return __awaiter$t(this,void 0,void 0,function*(){subtransaction(C,W=>{this._isActive.set(!0,W),this._forceUpdate.trigger(W,InlineCompletionTriggerKind$1.Explicit)}),yield this._fetchInlineCompletions.get()})}stop(C){subtransaction(C,W=>{this._isActive.set(!1,W),this._source.clear(W)})}_computeAugmentedCompletion(C,W){const V=this.textModel,U=this._source.suggestWidgetInlineCompletions.read(W),G=U?U.inlineCompletions:[this.selectedInlineCompletion.read(W)].filter(isDefined);return mapFindFirst(G,X=>{let Q=X.toSingleTextEdit(W);return Q=Q.removeCommonPrefix(V,Range$2.fromPositions(Q.range.getStartPosition(),C.range.getEndPosition())),Q.augments(C)?{edit:Q,completion:X}:void 0})}_deltaSelectedInlineCompletionIndex(C){return __awaiter$t(this,void 0,void 0,function*(){yield this.triggerExplicitly();const W=this._filteredInlineCompletionItems.get()||[];if(W.length>0){const V=(this.selectedInlineCompletionIndex.get()+C+W.length)%W.length;this._selectedInlineCompletionId.set(W[V].semanticId,void 0)}else this._selectedInlineCompletionId.set(void 0,void 0)})}next(){return __awaiter$t(this,void 0,void 0,function*(){yield this._deltaSelectedInlineCompletionIndex(1)})}previous(){return __awaiter$t(this,void 0,void 0,function*(){yield this._deltaSelectedInlineCompletionIndex(-1)})}accept(C){var W;return __awaiter$t(this,void 0,void 0,function*(){if(C.getModel()!==this.textModel)throw new BugIndicatingError;const V=this.state.get();if(!V||V.ghostText.isEmpty()||!V.inlineCompletion)return;const U=V.inlineCompletion.toInlineCompletion(void 0);C.pushUndoStop(),U.snippetInfo?(C.executeEdits("inlineSuggestion.accept",[EditOperation.replaceMove(U.range,""),...U.additionalTextEdits]),C.setPosition(U.snippetInfo.range.getStartPosition()),(W=SnippetController2.get(C))===null||W===void 0||W.insert(U.snippetInfo.snippet,{undoStopBefore:!1})):C.executeEdits("inlineSuggestion.accept",[EditOperation.replaceMove(U.range,U.insertText),...U.additionalTextEdits]),U.command&&U.source.addRef(),transaction(G=>{this._source.clear(G),this._isActive.set(!1,G)}),U.command&&(yield this._commandService.executeCommand(U.command.id,...U.command.arguments||[]).then(void 0,onUnexpectedExternalError),U.source.removeRef())})}acceptNextWord(C){return __awaiter$t(this,void 0,void 0,function*(){yield this._acceptNext(C,(W,V)=>{const U=this.textModel.getLanguageIdAtPosition(W.lineNumber,W.column),G=this._languageConfigurationService.getLanguageConfiguration(U),Z=new RegExp(G.wordDefinition.source,G.wordDefinition.flags.replace("g","")),X=V.match(Z);let Q=0;X&&X.index!==void 0?X.index===0?Q=X[0].length:Q=X.index:Q=V.length;const ee=/\s+/g.exec(V);return ee&&ee.index!==void 0&&ee.index+ee[0].length<Q&&(Q=ee.index+ee[0].length),Q})})}acceptNextLine(C){return __awaiter$t(this,void 0,void 0,function*(){yield this._acceptNext(C,(W,V)=>{const U=V.match(/\n/);return U&&U.index!==void 0?U.index+1:V.length})})}_acceptNext(C,W){return __awaiter$t(this,void 0,void 0,function*(){if(C.getModel()!==this.textModel)throw new BugIndicatingError;const V=this.state.get();if(!V||V.ghostText.isEmpty()||!V.inlineCompletion)return;const U=V.ghostText,G=V.inlineCompletion.toInlineCompletion(void 0);if(G.snippetInfo||G.filterText!==G.insertText){yield this.accept(C);return}const Z=U.parts[0],X=new Position$1(U.lineNumber,Z.column),Q=Z.lines.join(`
`),J=W(X,Q);if(J===Q.length&&U.parts.length===1){this.accept(C);return}const ee=Q.substring(0,J);this._isAcceptingPartially=!0;try{C.pushUndoStop(),C.executeEdits("inlineSuggestion.accept",[EditOperation.replace(Range$2.fromPositions(X),ee)]);const te=lengthOfText(ee);C.setPosition(addPositions(X,te))}finally{this._isAcceptingPartially=!1}if(G.source.provider.handlePartialAccept){const te=Range$2.fromPositions(G.range.getStartPosition(),addPositions(X,lengthOfText(ee))),ie=C.getModel().getValueInRange(te,1);G.source.provider.handlePartialAccept(G.source.inlineCompletions,G.sourceInlineCompletion,ie.length)}})}handleSuggestAccepted(C){var W,V;const U=C.toSingleTextEdit().removeCommonPrefix(this.textModel),G=this._computeAugmentedCompletion(U,void 0);if(!G)return;const Z=G.completion.inlineCompletion;(V=(W=Z.source.provider).handlePartialAccept)===null||V===void 0||V.call(W,Z.source.inlineCompletions,Z.sourceInlineCompletion,U.text.length)}};InlineCompletionsModel=__decorate$H([__param$H(9,IInstantiationService),__param$H(10,ICommandService),__param$H(11,ILanguageConfigurationService)],InlineCompletionsModel);var __decorate$G=globalThis&&globalThis.__decorate||function(K,C,W,V){var U=arguments.length,G=U<3?C:V===null?V=Object.getOwnPropertyDescriptor(C,W):V,Z;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")G=Reflect.decorate(K,C,W,V);else for(var X=K.length-1;X>=0;X--)(Z=K[X])&&(G=(U<3?Z(G):U>3?Z(C,W,G):Z(C,W))||G);return U>3&&G&&Object.defineProperty(C,W,G),G},__param$G=globalThis&&globalThis.__param||function(K,C){return function(W,V){C(W,V,K)}},SuggestMemoryService_1;class Memory{constructor(C){this.name=C}select(C,W,V){if(V.length===0)return 0;const U=V[0].score[0];for(let G=0;G<V.length;G++){const{score:Z,completion:X}=V[G];if(Z[0]!==U)break;if(X.preselect)return G}return 0}}class NoMemory extends Memory{constructor(){super("first")}memorize(C,W,V){}toJSON(){}fromJSON(){}}class LRUMemory extends Memory{constructor(){super("recentlyUsed"),this._cache=new LRUCache(300,.66),this._seq=0}memorize(C,W,V){const U=`${C.getLanguageId()}/${V.textLabel}`;this._cache.set(U,{touch:this._seq++,type:V.completion.kind,insertText:V.completion.insertText})}select(C,W,V){if(V.length===0)return 0;const U=C.getLineContent(W.lineNumber).substr(W.column-10,W.column-1);if(/\s$/.test(U))return super.select(C,W,V);const G=V[0].score[0];let Z=-1,X=-1,Q=-1;for(let J=0;J<V.length&&V[J].score[0]===G;J++){const ee=`${C.getLanguageId()}/${V[J].textLabel}`,te=this._cache.peek(ee);if(te&&te.touch>Q&&te.type===V[J].completion.kind&&te.insertText===V[J].completion.insertText&&(Q=te.touch,X=J),V[J].completion.preselect&&Z===-1)return Z=J}return X!==-1?X:Z!==-1?Z:0}toJSON(){return this._cache.toJSON()}fromJSON(C){this._cache.clear();const W=0;for(const[V,U]of C)U.touch=W,U.type=typeof U.type=="number"?U.type:CompletionItemKinds.fromString(U.type),this._cache.set(V,U);this._seq=this._cache.size}}class PrefixMemory extends Memory{constructor(){super("recentlyUsedByPrefix"),this._trie=TernarySearchTree.forStrings(),this._seq=0}memorize(C,W,V){const{word:U}=C.getWordUntilPosition(W),G=`${C.getLanguageId()}/${U}`;this._trie.set(G,{type:V.completion.kind,insertText:V.completion.insertText,touch:this._seq++})}select(C,W,V){const{word:U}=C.getWordUntilPosition(W);if(!U)return super.select(C,W,V);const G=`${C.getLanguageId()}/${U}`;let Z=this._trie.get(G);if(Z||(Z=this._trie.findSubstr(G)),Z)for(let X=0;X<V.length;X++){const{kind:Q,insertText:J}=V[X].completion;if(Q===Z.type&&J===Z.insertText)return X}return super.select(C,W,V)}toJSON(){const C=[];return this._trie.forEach((W,V)=>C.push([V,W])),C.sort((W,V)=>-(W[1].touch-V[1].touch)).forEach((W,V)=>W[1].touch=V),C.slice(0,200)}fromJSON(C){if(this._trie.clear(),C.length>0){this._seq=C[0][1].touch+1;for(const[W,V]of C)V.type=typeof V.type=="number"?V.type:CompletionItemKinds.fromString(V.type),this._trie.set(W,V)}}}let SuggestMemoryService=SuggestMemoryService_1=class{constructor(C,W){this._storageService=C,this._configService=W,this._disposables=new DisposableStore,this._persistSoon=new RunOnceScheduler(()=>this._saveState(),500),this._disposables.add(C.onWillSaveState(V=>{V.reason===WillSaveStateReason.SHUTDOWN&&this._saveState()}))}dispose(){this._disposables.dispose(),this._persistSoon.dispose()}memorize(C,W,V){this._withStrategy(C,W).memorize(C,W,V),this._persistSoon.schedule()}select(C,W,V){return this._withStrategy(C,W).select(C,W,V)}_withStrategy(C,W){var V;const U=this._configService.getValue("editor.suggestSelection",{overrideIdentifier:C.getLanguageIdAtPosition(W.lineNumber,W.column),resource:C.uri});if(((V=this._strategy)===null||V===void 0?void 0:V.name)!==U){this._saveState();const G=SuggestMemoryService_1._strategyCtors.get(U)||NoMemory;this._strategy=new G;try{const X=this._configService.getValue("editor.suggest.shareSuggestSelections")?0:1,Q=this._storageService.get(`${SuggestMemoryService_1._storagePrefix}/${U}`,X);Q&&this._strategy.fromJSON(JSON.parse(Q))}catch{}}return this._strategy}_saveState(){if(this._strategy){const W=this._configService.getValue("editor.suggest.shareSuggestSelections")?0:1,V=JSON.stringify(this._strategy);this._storageService.store(`${SuggestMemoryService_1._storagePrefix}/${this._strategy.name}`,V,W,1)}}};SuggestMemoryService._strategyCtors=new Map([["recentlyUsedByPrefix",PrefixMemory],["recentlyUsed",LRUMemory],["first",NoMemory]]);SuggestMemoryService._storagePrefix="suggest/memories";SuggestMemoryService=SuggestMemoryService_1=__decorate$G([__param$G(0,IStorageService),__param$G(1,IConfigurationService)],SuggestMemoryService);const ISuggestMemoryService=createDecorator("ISuggestMemories");registerSingleton(ISuggestMemoryService,SuggestMemoryService,1);var __decorate$F=globalThis&&globalThis.__decorate||function(K,C,W,V){var U=arguments.length,G=U<3?C:V===null?V=Object.getOwnPropertyDescriptor(C,W):V,Z;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")G=Reflect.decorate(K,C,W,V);else for(var X=K.length-1;X>=0;X--)(Z=K[X])&&(G=(U<3?Z(G):U>3?Z(C,W,G):Z(C,W))||G);return U>3&&G&&Object.defineProperty(C,W,G),G},__param$F=globalThis&&globalThis.__param||function(K,C){return function(W,V){C(W,V,K)}},WordContextKey_1;let WordContextKey=WordContextKey_1=class{constructor(C,W){this._editor=C,this._enabled=!1,this._ckAtEnd=WordContextKey_1.AtEnd.bindTo(W),this._configListener=this._editor.onDidChangeConfiguration(V=>V.hasChanged(122)&&this._update()),this._update()}dispose(){var C;this._configListener.dispose(),(C=this._selectionListener)===null||C===void 0||C.dispose(),this._ckAtEnd.reset()}_update(){const C=this._editor.getOption(122)==="on";if(this._enabled!==C)if(this._enabled=C,this._enabled){const W=()=>{if(!this._editor.hasModel()){this._ckAtEnd.set(!1);return}const V=this._editor.getModel(),U=this._editor.getSelection(),G=V.getWordAtPosition(U.getStartPosition());if(!G){this._ckAtEnd.set(!1);return}this._ckAtEnd.set(G.endColumn===U.getStartPosition().column)};this._selectionListener=this._editor.onDidChangeCursorSelection(W),W()}else this._selectionListener&&(this._ckAtEnd.reset(),this._selectionListener.dispose(),this._selectionListener=void 0)}};WordContextKey.AtEnd=new RawContextKey("atEndOfWord",!1);WordContextKey=WordContextKey_1=__decorate$F([__param$F(1,IContextKeyService)],WordContextKey);var __decorate$E=globalThis&&globalThis.__decorate||function(K,C,W,V){var U=arguments.length,G=U<3?C:V===null?V=Object.getOwnPropertyDescriptor(C,W):V,Z;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")G=Reflect.decorate(K,C,W,V);else for(var X=K.length-1;X>=0;X--)(Z=K[X])&&(G=(U<3?Z(G):U>3?Z(C,W,G):Z(C,W))||G);return U>3&&G&&Object.defineProperty(C,W,G),G},__param$E=globalThis&&globalThis.__param||function(K,C){return function(W,V){C(W,V,K)}},SuggestAlternatives_1;let SuggestAlternatives=SuggestAlternatives_1=class{constructor(C,W){this._editor=C,this._index=0,this._ckOtherSuggestions=SuggestAlternatives_1.OtherSuggestions.bindTo(W)}dispose(){this.reset()}reset(){var C;this._ckOtherSuggestions.reset(),(C=this._listener)===null||C===void 0||C.dispose(),this._model=void 0,this._acceptNext=void 0,this._ignore=!1}set({model:C,index:W},V){if(C.items.length===0){this.reset();return}if(SuggestAlternatives_1._moveIndex(!0,C,W)===W){this.reset();return}this._acceptNext=V,this._model=C,this._index=W,this._listener=this._editor.onDidChangeCursorPosition(()=>{this._ignore||this.reset()}),this._ckOtherSuggestions.set(!0)}static _moveIndex(C,W,V){let U=V;for(let G=W.items.length;G>0&&(U=(U+W.items.length+(C?1:-1))%W.items.length,!(U===V||!W.items[U].completion.additionalTextEdits));G--);return U}next(){this._move(!0)}prev(){this._move(!1)}_move(C){if(this._model)try{this._ignore=!0,this._index=SuggestAlternatives_1._moveIndex(C,this._model,this._index),this._acceptNext({index:this._index,item:this._model.items[this._index],model:this._model})}finally{this._ignore=!1}}};SuggestAlternatives.OtherSuggestions=new RawContextKey("hasOtherSuggestions",!1);SuggestAlternatives=SuggestAlternatives_1=__decorate$E([__param$E(1,IContextKeyService)],SuggestAlternatives);class CommitCharacterController{constructor(C,W,V,U){this._disposables=new DisposableStore,this._disposables.add(V.onDidSuggest(G=>{G.completionModel.items.length===0&&this.reset()})),this._disposables.add(V.onDidCancel(G=>{this.reset()})),this._disposables.add(W.onDidShow(()=>this._onItem(W.getFocusedItem()))),this._disposables.add(W.onDidFocus(this._onItem,this)),this._disposables.add(W.onDidHide(this.reset,this)),this._disposables.add(C.onWillType(G=>{if(this._active&&!W.isFrozen()&&V.state!==0){const Z=G.charCodeAt(G.length-1);this._active.acceptCharacters.has(Z)&&C.getOption(0)&&U(this._active.item)}}))}_onItem(C){if(!C||!isNonEmptyArray$2(C.item.completion.commitCharacters)){this.reset();return}if(this._active&&this._active.item.item===C.item)return;const W=new CharacterSet;for(const V of C.item.completion.commitCharacters)V.length>0&&W.add(V.charCodeAt(0));this._active={acceptCharacters:W,item:C}}reset(){this._active=void 0}dispose(){this._disposables.dispose()}}var __awaiter$s=globalThis&&globalThis.__awaiter||function(K,C,W,V){function U(G){return G instanceof W?G:new W(function(Z){Z(G)})}return new(W||(W=Promise))(function(G,Z){function X(ee){try{J(V.next(ee))}catch(te){Z(te)}}function Q(ee){try{J(V.throw(ee))}catch(te){Z(te)}}function J(ee){ee.done?G(ee.value):U(ee.value).then(X,Q)}J((V=V.apply(K,C||[])).next())})};class BracketSelectionRangeProvider{provideSelectionRanges(C,W){return __awaiter$s(this,void 0,void 0,function*(){const V=[];for(const U of W){const G=[];V.push(G);const Z=new Map;yield new Promise(X=>BracketSelectionRangeProvider._bracketsRightYield(X,0,C,U,Z)),yield new Promise(X=>BracketSelectionRangeProvider._bracketsLeftYield(X,0,C,U,Z,G))}return V})}static _bracketsRightYield(C,W,V,U,G){const Z=new Map,X=Date.now();for(;;){if(W>=BracketSelectionRangeProvider._maxRounds){C();break}if(!U){C();break}const Q=V.bracketPairs.findNextBracket(U);if(!Q){C();break}if(Date.now()-X>BracketSelectionRangeProvider._maxDuration){setTimeout(()=>BracketSelectionRangeProvider._bracketsRightYield(C,W+1,V,U,G));break}if(Q.bracketInfo.isOpeningBracket){const ee=Q.bracketInfo.bracketText,te=Z.has(ee)?Z.get(ee):0;Z.set(ee,te+1)}else{const ee=Q.bracketInfo.getOpeningBrackets()[0].bracketText;let te=Z.has(ee)?Z.get(ee):0;if(te-=1,Z.set(ee,Math.max(0,te)),te<0){let ie=G.get(ee);ie||(ie=new LinkedList,G.set(ee,ie)),ie.push(Q.range)}}U=Q.range.getEndPosition()}}static _bracketsLeftYield(C,W,V,U,G,Z){const X=new Map,Q=Date.now();for(;;){if(W>=BracketSelectionRangeProvider._maxRounds&&G.size===0){C();break}if(!U){C();break}const J=V.bracketPairs.findPrevBracket(U);if(!J){C();break}if(Date.now()-Q>BracketSelectionRangeProvider._maxDuration){setTimeout(()=>BracketSelectionRangeProvider._bracketsLeftYield(C,W+1,V,U,G,Z));break}if(J.bracketInfo.isOpeningBracket){const te=J.bracketInfo.bracketText;let ie=X.has(te)?X.get(te):0;if(ie-=1,X.set(te,Math.max(0,ie)),ie<0){const ne=G.get(te);if(ne){const oe=ne.shift();ne.size===0&&G.delete(te);const re=Range$2.fromPositions(J.range.getEndPosition(),oe.getStartPosition()),ae=Range$2.fromPositions(J.range.getStartPosition(),oe.getEndPosition());Z.push({range:re}),Z.push({range:ae}),BracketSelectionRangeProvider._addBracketLeading(V,ae,Z)}}}else{const te=J.bracketInfo.getOpeningBrackets()[0].bracketText,ie=X.has(te)?X.get(te):0;X.set(te,ie+1)}U=J.range.getStartPosition()}}static _addBracketLeading(C,W,V){if(W.startLineNumber===W.endLineNumber)return;const U=W.startLineNumber,G=C.getLineFirstNonWhitespaceColumn(U);G!==0&&G!==W.startColumn&&(V.push({range:Range$2.fromPositions(new Position$1(U,G),W.getEndPosition())}),V.push({range:Range$2.fromPositions(new Position$1(U,1),W.getEndPosition())}));const Z=U-1;if(Z>0){const X=C.getLineFirstNonWhitespaceColumn(Z);X===W.startColumn&&X!==C.getLineLastNonWhitespaceColumn(Z)&&(V.push({range:Range$2.fromPositions(new Position$1(Z,X),W.getEndPosition())}),V.push({range:Range$2.fromPositions(new Position$1(Z,1),W.getEndPosition())}))}}}BracketSelectionRangeProvider._maxDuration=30;BracketSelectionRangeProvider._maxRounds=2;var __awaiter$r=globalThis&&globalThis.__awaiter||function(K,C,W,V){function U(G){return G instanceof W?G:new W(function(Z){Z(G)})}return new(W||(W=Promise))(function(G,Z){function X(ee){try{J(V.next(ee))}catch(te){Z(te)}}function Q(ee){try{J(V.throw(ee))}catch(te){Z(te)}}function J(ee){ee.done?G(ee.value):U(ee.value).then(X,Q)}J((V=V.apply(K,C||[])).next())})};class WordDistance{static create(C,W){return __awaiter$r(this,void 0,void 0,function*(){if(!W.getOption(117).localityBonus||!W.hasModel())return WordDistance.None;const V=W.getModel(),U=W.getPosition();if(!C.canComputeWordRanges(V.uri))return WordDistance.None;const[G]=yield new BracketSelectionRangeProvider().provideSelectionRanges(V,[U]);if(G.length===0)return WordDistance.None;const Z=yield C.computeWordRanges(V.uri,G[0].range);if(!Z)return WordDistance.None;const X=V.getWordUntilPosition(U);return delete Z[X.word],new class extends WordDistance{distance(Q,J){if(!U.equals(W.getPosition()))return 0;if(J.kind===17)return 2<<20;const ee=typeof J.label=="string"?J.label:J.label.label,te=Z[ee];if(isFalsyOrEmpty(te))return 2<<20;const ie=binarySearch(te,Range$2.fromPositions(Q),Range$2.compareRangesUsingStarts),ne=ie>=0?te[ie]:te[Math.max(0,~ie-1)];let oe=G.length;for(const re of G){if(!Range$2.containsRange(re.range,ne))break;oe-=1}return oe}}})}}WordDistance.None=new class extends WordDistance{distance(){return 0}};let LineContext$1=class{constructor(C,W){this.leadingLineContent=C,this.characterCountDelta=W}};class CompletionModel{constructor(C,W,V,U,G,Z,X=FuzzyScoreOptions.default,Q=void 0){this.clipboardText=Q,this._snippetCompareFn=CompletionModel._compareCompletionItems,this._items=C,this._column=W,this._wordDistance=U,this._options=G,this._refilterKind=1,this._lineContext=V,this._fuzzyScoreOptions=X,Z==="top"?this._snippetCompareFn=CompletionModel._compareCompletionItemsSnippetsUp:Z==="bottom"&&(this._snippetCompareFn=CompletionModel._compareCompletionItemsSnippetsDown)}get lineContext(){return this._lineContext}set lineContext(C){(this._lineContext.leadingLineContent!==C.leadingLineContent||this._lineContext.characterCountDelta!==C.characterCountDelta)&&(this._refilterKind=this._lineContext.characterCountDelta<C.characterCountDelta&&this._filteredItems?2:1,this._lineContext=C)}get items(){return this._ensureCachedState(),this._filteredItems}getItemsByProvider(){return this._ensureCachedState(),this._itemsByProvider}getIncompleteProvider(){this._ensureCachedState();const C=new Set;for(const[W,V]of this.getItemsByProvider())V.length>0&&V[0].container.incomplete&&C.add(W);return C}get stats(){return this._ensureCachedState(),this._stats}_ensureCachedState(){this._refilterKind!==0&&this._createCachedState()}_createCachedState(){this._itemsByProvider=new Map;const C=[],{leadingLineContent:W,characterCountDelta:V}=this._lineContext;let U="",G="";const Z=this._refilterKind===1?this._items:this._filteredItems,X=[],Q=!this._options.filterGraceful||Z.length>2e3?fuzzyScore:fuzzyScoreGracefulAggressive;for(let J=0;J<Z.length;J++){const ee=Z[J];if(ee.isInvalid)continue;const te=this._itemsByProvider.get(ee.provider);te?te.push(ee):this._itemsByProvider.set(ee.provider,[ee]);const ie=ee.position.column-ee.editStart.column,ne=ie+V-(ee.position.column-this._column);if(U.length!==ne&&(U=ne===0?"":W.slice(-ne),G=U.toLowerCase()),ee.word=U,ne===0)ee.score=FuzzyScore.Default;else{let oe=0;for(;oe<ie;){const re=U.charCodeAt(oe);if(re===32||re===9)oe+=1;else break}if(oe>=ne)ee.score=FuzzyScore.Default;else if(typeof ee.completion.filterText=="string"){const re=Q(U,G,oe,ee.completion.filterText,ee.filterTextLow,0,this._fuzzyScoreOptions);if(!re)continue;compareIgnoreCase(ee.completion.filterText,ee.textLabel)===0?ee.score=re:(ee.score=anyScore(U,G,oe,ee.textLabel,ee.labelLow,0),ee.score[0]=re[0])}else{const re=Q(U,G,oe,ee.textLabel,ee.labelLow,0,this._fuzzyScoreOptions);if(!re)continue;ee.score=re}}ee.idx=J,ee.distance=this._wordDistance.distance(ee.position,ee.completion),X.push(ee),C.push(ee.textLabel.length)}this._filteredItems=X.sort(this._snippetCompareFn),this._refilterKind=0,this._stats={pLabelLen:C.length?quickSelect(C.length-.85,C,(J,ee)=>J-ee):0}}static _compareCompletionItems(C,W){return C.score[0]>W.score[0]?-1:C.score[0]<W.score[0]?1:C.distance<W.distance?-1:C.distance>W.distance?1:C.idx<W.idx?-1:C.idx>W.idx?1:0}static _compareCompletionItemsSnippetsDown(C,W){if(C.completion.kind!==W.completion.kind){if(C.completion.kind===27)return 1;if(W.completion.kind===27)return-1}return CompletionModel._compareCompletionItems(C,W)}static _compareCompletionItemsSnippetsUp(C,W){if(C.completion.kind!==W.completion.kind){if(C.completion.kind===27)return-1;if(W.completion.kind===27)return 1}return CompletionModel._compareCompletionItems(C,W)}}var __decorate$D=globalThis&&globalThis.__decorate||function(K,C,W,V){var U=arguments.length,G=U<3?C:V===null?V=Object.getOwnPropertyDescriptor(C,W):V,Z;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")G=Reflect.decorate(K,C,W,V);else for(var X=K.length-1;X>=0;X--)(Z=K[X])&&(G=(U<3?Z(G):U>3?Z(C,W,G):Z(C,W))||G);return U>3&&G&&Object.defineProperty(C,W,G),G},__param$D=globalThis&&globalThis.__param||function(K,C){return function(W,V){C(W,V,K)}},__awaiter$q=globalThis&&globalThis.__awaiter||function(K,C,W,V){function U(G){return G instanceof W?G:new W(function(Z){Z(G)})}return new(W||(W=Promise))(function(G,Z){function X(ee){try{J(V.next(ee))}catch(te){Z(te)}}function Q(ee){try{J(V.throw(ee))}catch(te){Z(te)}}function J(ee){ee.done?G(ee.value):U(ee.value).then(X,Q)}J((V=V.apply(K,C||[])).next())})},SuggestModel_1;class LineContext{static shouldAutoTrigger(C){if(!C.hasModel())return!1;const W=C.getModel(),V=C.getPosition();W.tokenization.tokenizeIfCheap(V.lineNumber);const U=W.getWordAtPosition(V);return!(!U||U.endColumn!==V.column&&U.startColumn+1!==V.column||!isNaN(Number(U.word)))}constructor(C,W,V){this.leadingLineContent=C.getLineContent(W.lineNumber).substr(0,W.column-1),this.leadingWord=C.getWordUntilPosition(W),this.lineNumber=W.lineNumber,this.column=W.column,this.triggerOptions=V}}function canShowQuickSuggest(K,C,W){if(!C.getContextKeyValue(InlineCompletionContextKeys.inlineSuggestionVisible.key))return!0;const V=C.getContextKeyValue(InlineCompletionContextKeys.suppressSuggestions.key);return V!==void 0?!V:!K.getOption(62).suppressSuggestions}function canShowSuggestOnTriggerCharacters(K,C,W){if(!C.getContextKeyValue("inlineSuggestionVisible"))return!0;const V=C.getContextKeyValue(InlineCompletionContextKeys.suppressSuggestions.key);return V!==void 0?!V:!K.getOption(62).suppressSuggestions}let SuggestModel=SuggestModel_1=class{constructor(C,W,V,U,G,Z,X,Q,J){this._editor=C,this._editorWorkerService=W,this._clipboardService=V,this._telemetryService=U,this._logService=G,this._contextKeyService=Z,this._configurationService=X,this._languageFeaturesService=Q,this._envService=J,this._toDispose=new DisposableStore,this._triggerCharacterListener=new DisposableStore,this._triggerQuickSuggest=new TimeoutTimer,this._triggerState=void 0,this._completionDisposables=new DisposableStore,this._onDidCancel=new Emitter$1,this._onDidTrigger=new Emitter$1,this._onDidSuggest=new Emitter$1,this.onDidCancel=this._onDidCancel.event,this.onDidTrigger=this._onDidTrigger.event,this.onDidSuggest=this._onDidSuggest.event,this._telemetryGate=0,this._currentSelection=this._editor.getSelection()||new Selection$1(1,1,1,1),this._toDispose.add(this._editor.onDidChangeModel(()=>{this._updateTriggerCharacters(),this.cancel()})),this._toDispose.add(this._editor.onDidChangeModelLanguage(()=>{this._updateTriggerCharacters(),this.cancel()})),this._toDispose.add(this._editor.onDidChangeConfiguration(()=>{this._updateTriggerCharacters()})),this._toDispose.add(this._languageFeaturesService.completionProvider.onDidChange(()=>{this._updateTriggerCharacters(),this._updateActiveSuggestSession()}));let ee=!1;this._toDispose.add(this._editor.onDidCompositionStart(()=>{ee=!0})),this._toDispose.add(this._editor.onDidCompositionEnd(()=>{ee=!1,this._onCompositionEnd()})),this._toDispose.add(this._editor.onDidChangeCursorSelection(te=>{ee||this._onCursorChange(te)})),this._toDispose.add(this._editor.onDidChangeModelContent(()=>{!ee&&this._triggerState!==void 0&&this._refilterCompletionItems()})),this._updateTriggerCharacters()}dispose(){dispose(this._triggerCharacterListener),dispose([this._onDidCancel,this._onDidSuggest,this._onDidTrigger,this._triggerQuickSuggest]),this._toDispose.dispose(),this._completionDisposables.dispose(),this.cancel()}_updateTriggerCharacters(){if(this._triggerCharacterListener.clear(),this._editor.getOption(90)||!this._editor.hasModel()||!this._editor.getOption(120))return;const C=new Map;for(const V of this._languageFeaturesService.completionProvider.all(this._editor.getModel()))for(const U of V.triggerCharacters||[]){let G=C.get(U);G||(G=new Set,G.add(getSnippetSuggestSupport()),C.set(U,G)),G.add(V)}const W=V=>{var U;if(!canShowSuggestOnTriggerCharacters(this._editor,this._contextKeyService,this._configurationService)||LineContext.shouldAutoTrigger(this._editor))return;if(!V){const X=this._editor.getPosition();V=this._editor.getModel().getLineContent(X.lineNumber).substr(0,X.column-1)}let G="";isLowSurrogate(V.charCodeAt(V.length-1))?isHighSurrogate(V.charCodeAt(V.length-2))&&(G=V.substr(V.length-2)):G=V.charAt(V.length-1);const Z=C.get(G);if(Z){const X=new Map;if(this._completionModel)for(const[Q,J]of this._completionModel.getItemsByProvider())Z.has(Q)||X.set(Q,J);this.trigger({auto:!0,triggerKind:1,triggerCharacter:G,retrigger:!!this._completionModel,clipboardText:(U=this._completionModel)===null||U===void 0?void 0:U.clipboardText,completionOptions:{providerFilter:Z,providerItemsToReuse:X}})}};this._triggerCharacterListener.add(this._editor.onDidType(W)),this._triggerCharacterListener.add(this._editor.onDidCompositionEnd(()=>W()))}get state(){return this._triggerState?this._triggerState.auto?2:1:0}cancel(C=!1){var W;this._triggerState!==void 0&&(this._triggerQuickSuggest.cancel(),(W=this._requestToken)===null||W===void 0||W.cancel(),this._requestToken=void 0,this._triggerState=void 0,this._completionModel=void 0,this._context=void 0,this._onDidCancel.fire({retrigger:C}))}clear(){this._completionDisposables.clear()}_updateActiveSuggestSession(){this._triggerState!==void 0&&(!this._editor.hasModel()||!this._languageFeaturesService.completionProvider.has(this._editor.getModel())?this.cancel():this.trigger({auto:this._triggerState.auto,retrigger:!0}))}_onCursorChange(C){if(!this._editor.hasModel())return;const W=this._currentSelection;if(this._currentSelection=this._editor.getSelection(),!C.selection.isEmpty()||C.reason!==0&&C.reason!==3||C.source!=="keyboard"&&C.source!=="deleteLeft"){this.cancel();return}this._triggerState===void 0&&C.reason===0?(W.containsRange(this._currentSelection)||W.getEndPosition().isBeforeOrEqual(this._currentSelection.getPosition()))&&this._doTriggerQuickSuggest():this._triggerState!==void 0&&C.reason===3&&this._refilterCompletionItems()}_onCompositionEnd(){this._triggerState===void 0?this._doTriggerQuickSuggest():this._refilterCompletionItems()}_doTriggerQuickSuggest(){var C;QuickSuggestionsOptions.isAllOff(this._editor.getOption(88))||this._editor.getOption(117).snippetsPreventQuickSuggestions&&(!((C=SnippetController2.get(this._editor))===null||C===void 0)&&C.isInSnippet())||(this.cancel(),this._triggerQuickSuggest.cancelAndSet(()=>{if(this._triggerState!==void 0||!LineContext.shouldAutoTrigger(this._editor)||!this._editor.hasModel()||!this._editor.hasWidgetFocus())return;const W=this._editor.getModel(),V=this._editor.getPosition(),U=this._editor.getOption(88);if(!QuickSuggestionsOptions.isAllOff(U)){if(!QuickSuggestionsOptions.isAllOn(U)){W.tokenization.tokenizeIfCheap(V.lineNumber);const G=W.tokenization.getLineTokens(V.lineNumber),Z=G.getStandardTokenType(G.findTokenIndexAtOffset(Math.max(V.column-1-1,0)));if(QuickSuggestionsOptions.valueFor(U,Z)!=="on")return}canShowQuickSuggest(this._editor,this._contextKeyService,this._configurationService)&&this._languageFeaturesService.completionProvider.has(W)&&this.trigger({auto:!0})}},this._editor.getOption(89)))}_refilterCompletionItems(){assertType(this._editor.hasModel()),assertType(this._triggerState!==void 0);const C=this._editor.getModel(),W=this._editor.getPosition(),V=new LineContext(C,W,Object.assign(Object.assign({},this._triggerState),{refilter:!0}));this._onNewContext(V)}trigger(C){var W,V,U,G,Z,X;if(!this._editor.hasModel())return;const Q=this._editor.getModel(),J=new LineContext(Q,this._editor.getPosition(),C);this.cancel(C.retrigger),this._triggerState=C,this._onDidTrigger.fire({auto:C.auto,shy:(W=C.shy)!==null&&W!==void 0?W:!1,position:this._editor.getPosition()}),this._context=J;let ee={triggerKind:(V=C.triggerKind)!==null&&V!==void 0?V:0};C.triggerCharacter&&(ee={triggerKind:1,triggerCharacter:C.triggerCharacter}),this._requestToken=new CancellationTokenSource$1;const te=this._editor.getOption(111);let ie=1;switch(te){case"top":ie=0;break;case"bottom":ie=2;break}const{itemKind:ne,showDeprecated:oe}=SuggestModel_1._createSuggestFilter(this._editor),re=new CompletionOptions(ie,(G=(U=C.completionOptions)===null||U===void 0?void 0:U.kindFilter)!==null&&G!==void 0?G:ne,(Z=C.completionOptions)===null||Z===void 0?void 0:Z.providerFilter,(X=C.completionOptions)===null||X===void 0?void 0:X.providerItemsToReuse,oe),ae=WordDistance.create(this._editorWorkerService,this._editor),se=provideSuggestionItems(this._languageFeaturesService.completionProvider,Q,this._editor.getPosition(),re,ee,this._requestToken.token);Promise.all([se,ae]).then(([le,ce])=>__awaiter$q(this,void 0,void 0,function*(){var de;if((de=this._requestToken)===null||de===void 0||de.dispose(),!this._editor.hasModel())return;let ue=C==null?void 0:C.clipboardText;if(!ue&&le.needsClipboard&&(ue=yield this._clipboardService.readText()),this._triggerState===void 0)return;const ge=this._editor.getModel(),he=new LineContext(ge,this._editor.getPosition(),C),fe=Object.assign(Object.assign({},FuzzyScoreOptions.default),{firstMatchCanBeWeak:!this._editor.getOption(117).matchOnWordStartOnly});if(this._completionModel=new CompletionModel(le.items,this._context.column,{leadingLineContent:he.leadingLineContent,characterCountDelta:he.column-this._context.column},ce,this._editor.getOption(117),this._editor.getOption(111),fe,ue),this._completionDisposables.add(le.disposable),this._onNewContext(he),this._reportDurationsTelemetry(le.durations),!this._envService.isBuilt||this._envService.isExtensionDevelopment)for(const pe of le.items)pe.isInvalid&&this._logService.warn(`[suggest] did IGNORE invalid completion item from ${pe.provider._debugDisplayName}`,pe.completion)})).catch(onUnexpectedError)}_reportDurationsTelemetry(C){this._telemetryGate++%230===0&&setTimeout(()=>{this._telemetryService.publicLog2("suggest.durations.json",{data:JSON.stringify(C)}),this._logService.debug("suggest.durations.json",C)})}static _createSuggestFilter(C){const W=new Set;C.getOption(111)==="none"&&W.add(27);const U=C.getOption(117);return U.showMethods||W.add(0),U.showFunctions||W.add(1),U.showConstructors||W.add(2),U.showFields||W.add(3),U.showVariables||W.add(4),U.showClasses||W.add(5),U.showStructs||W.add(6),U.showInterfaces||W.add(7),U.showModules||W.add(8),U.showProperties||W.add(9),U.showEvents||W.add(10),U.showOperators||W.add(11),U.showUnits||W.add(12),U.showValues||W.add(13),U.showConstants||W.add(14),U.showEnums||W.add(15),U.showEnumMembers||W.add(16),U.showKeywords||W.add(17),U.showWords||W.add(18),U.showColors||W.add(19),U.showFiles||W.add(20),U.showReferences||W.add(21),U.showColors||W.add(22),U.showFolders||W.add(23),U.showTypeParameters||W.add(24),U.showSnippets||W.add(27),U.showUsers||W.add(25),U.showIssues||W.add(26),{itemKind:W,showDeprecated:U.showDeprecated}}_onNewContext(C){if(this._context){if(C.lineNumber!==this._context.lineNumber){this.cancel();return}if(getLeadingWhitespace(C.leadingLineContent)!==getLeadingWhitespace(this._context.leadingLineContent)){this.cancel();return}if(C.column<this._context.column){C.leadingWord.word?this.trigger({auto:this._context.triggerOptions.auto,retrigger:!0}):this.cancel();return}if(this._completionModel){if(C.leadingWord.word.length!==0&&C.leadingWord.startColumn>this._context.leadingWord.startColumn){if(LineContext.shouldAutoTrigger(this._editor)&&this._context){const V=this._completionModel.getItemsByProvider();this.trigger({auto:this._context.triggerOptions.auto,retrigger:!0,clipboardText:this._completionModel.clipboardText,completionOptions:{providerItemsToReuse:V}})}return}if(C.column>this._context.column&&this._completionModel.getIncompleteProvider().size>0&&C.leadingWord.word.length!==0){const W=new Map,V=new Set;for(const[U,G]of this._completionModel.getItemsByProvider())G.length>0&&G[0].container.incomplete?V.add(U):W.set(U,G);this.trigger({auto:this._context.triggerOptions.auto,triggerKind:2,retrigger:!0,clipboardText:this._completionModel.clipboardText,completionOptions:{providerFilter:V,providerItemsToReuse:W}})}else{const W=this._completionModel.lineContext;let V=!1;if(this._completionModel.lineContext={leadingLineContent:C.leadingLineContent,characterCountDelta:C.column-this._context.column},this._completionModel.items.length===0){const U=LineContext.shouldAutoTrigger(this._editor);if(!this._context){this.cancel();return}if(U&&this._context.leadingWord.endColumn<C.leadingWord.startColumn){this.trigger({auto:this._context.triggerOptions.auto,retrigger:!0});return}if(this._context.triggerOptions.auto){this.cancel();return}else if(this._completionModel.lineContext=W,V=this._completionModel.items.length>0,V&&C.leadingWord.word.length===0){this.cancel();return}}this._onDidSuggest.fire({completionModel:this._completionModel,triggerOptions:C.triggerOptions,isFrozen:V})}}}}};SuggestModel=SuggestModel_1=__decorate$D([__param$D(1,IEditorWorkerService),__param$D(2,IClipboardService),__param$D(3,ITelemetryService),__param$D(4,ILogService),__param$D(5,IContextKeyService),__param$D(6,IConfigurationService),__param$D(7,ILanguageFeaturesService),__param$D(8,IEnvironmentService)],SuggestModel);class OvertypingCapturer{constructor(C,W){this._disposables=new DisposableStore,this._lastOvertyped=[],this._locked=!1,this._disposables.add(C.onWillType(()=>{if(this._locked||!C.hasModel())return;const V=C.getSelections(),U=V.length;let G=!1;for(let X=0;X<U;X++)if(!V[X].isEmpty()){G=!0;break}if(!G){this._lastOvertyped.length!==0&&(this._lastOvertyped.length=0);return}this._lastOvertyped=[];const Z=C.getModel();for(let X=0;X<U;X++){const Q=V[X];if(Z.getValueLengthInRange(Q)>OvertypingCapturer._maxSelectionLength)return;this._lastOvertyped[X]={value:Z.getValueInRange(Q),multiline:Q.startLineNumber!==Q.endLineNumber}}})),this._disposables.add(W.onDidTrigger(V=>{this._locked=!0})),this._disposables.add(W.onDidCancel(V=>{this._locked=!1}))}getLastOvertypedInfo(C){if(C>=0&&C<this._lastOvertyped.length)return this._lastOvertyped[C]}dispose(){this._disposables.dispose()}}OvertypingCapturer._maxSelectionLength=51200;const suggest="";var __decorate$C=globalThis&&globalThis.__decorate||function(K,C,W,V){var U=arguments.length,G=U<3?C:V===null?V=Object.getOwnPropertyDescriptor(C,W):V,Z;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")G=Reflect.decorate(K,C,W,V);else for(var X=K.length-1;X>=0;X--)(Z=K[X])&&(G=(U<3?Z(G):U>3?Z(C,W,G):Z(C,W))||G);return U>3&&G&&Object.defineProperty(C,W,G),G},__param$C=globalThis&&globalThis.__param||function(K,C){return function(W,V){C(W,V,K)}};class StatusBarViewItem extends MenuEntryActionViewItem{updateLabel(){const C=this._keybindingService.lookupKeybinding(this._action.id,this._contextKeyService);if(!C)return super.updateLabel();this.label&&(this.label.textContent=localize({key:"content",comment:["A label","A keybinding"]},"{0} ({1})",this._action.label,StatusBarViewItem.symbolPrintEnter(C)))}static symbolPrintEnter(C){var W;return(W=C.getLabel())===null||W===void 0?void 0:W.replace(/\benter\b/gi,"⏎")}}let SuggestWidgetStatus=class{constructor(C,W,V,U,G){this._menuId=W,this._menuService=U,this._contextKeyService=G,this._menuDisposables=new DisposableStore,this.element=append$3(C,$$d(".suggest-status-bar"));const Z=X=>X instanceof MenuItemAction?V.createInstance(StatusBarViewItem,X,void 0):void 0;this._leftActions=new ActionBar(this.element,{actionViewItemProvider:Z}),this._rightActions=new ActionBar(this.element,{actionViewItemProvider:Z}),this._leftActions.domNode.classList.add("left"),this._rightActions.domNode.classList.add("right")}dispose(){this._menuDisposables.dispose(),this._leftActions.dispose(),this._rightActions.dispose(),this.element.remove()}show(){const C=this._menuService.createMenu(this._menuId,this._contextKeyService),W=()=>{const V=[],U=[];for(const[G,Z]of C.getActions())G==="left"?V.push(...Z):U.push(...Z);this._leftActions.clear(),this._leftActions.push(V),this._rightActions.clear(),this._rightActions.push(U)};this._menuDisposables.add(C.onDidChange(()=>W())),this._menuDisposables.add(C)}hide(){this._menuDisposables.clear()}};SuggestWidgetStatus=__decorate$C([__param$C(2,IInstantiationService),__param$C(3,IMenuService),__param$C(4,IContextKeyService)],SuggestWidgetStatus);var __decorate$B=globalThis&&globalThis.__decorate||function(K,C,W,V){var U=arguments.length,G=U<3?C:V===null?V=Object.getOwnPropertyDescriptor(C,W):V,Z;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")G=Reflect.decorate(K,C,W,V);else for(var X=K.length-1;X>=0;X--)(Z=K[X])&&(G=(U<3?Z(G):U>3?Z(C,W,G):Z(C,W))||G);return U>3&&G&&Object.defineProperty(C,W,G),G},__param$B=globalThis&&globalThis.__param||function(K,C){return function(W,V){C(W,V,K)}};function canExpandCompletionItem(K){return!!K&&!!(K.completion.documentation||K.completion.detail&&K.completion.detail!==K.completion.label)}let SuggestDetailsWidget=class{constructor(C,W){this._editor=C,this._onDidClose=new Emitter$1,this.onDidClose=this._onDidClose.event,this._onDidChangeContents=new Emitter$1,this.onDidChangeContents=this._onDidChangeContents.event,this._disposables=new DisposableStore,this._renderDisposeable=new DisposableStore,this._borderWidth=1,this._size=new Dimension(330,0),this.domNode=$$d(".suggest-details"),this.domNode.classList.add("no-docs"),this._markdownRenderer=W.createInstance(MarkdownRenderer,{editor:C}),this._body=$$d(".body"),this._scrollbar=new DomScrollableElement(this._body,{alwaysConsumeMouseWheel:!0}),append$3(this.domNode,this._scrollbar.getDomNode()),this._disposables.add(this._scrollbar),this._header=append$3(this._body,$$d(".header")),this._close=append$3(this._header,$$d("span"+ThemeIcon.asCSSSelector(Codicon.close))),this._close.title=localize("details.close","Close"),this._type=append$3(this._header,$$d("p.type")),this._docs=append$3(this._body,$$d("p.docs")),this._configureFont(),this._disposables.add(this._editor.onDidChangeConfiguration(V=>{V.hasChanged(50)&&this._configureFont()}))}dispose(){this._disposables.dispose(),this._renderDisposeable.dispose()}_configureFont(){const C=this._editor.getOptions(),W=C.get(50),V=W.getMassagedFontFamily(),U=C.get(118)||W.fontSize,G=C.get(119)||W.lineHeight,Z=W.fontWeight,X=`${U}px`,Q=`${G}px`;this.domNode.style.fontSize=X,this.domNode.style.lineHeight=`${G/U}`,this.domNode.style.fontWeight=Z,this.domNode.style.fontFeatureSettings=W.fontFeatureSettings,this._type.style.fontFamily=V,this._close.style.height=Q,this._close.style.width=Q}getLayoutInfo(){const C=this._editor.getOption(119)||this._editor.getOption(50).lineHeight,W=this._borderWidth,V=W*2;return{lineHeight:C,borderWidth:W,borderHeight:V,verticalPadding:22,horizontalPadding:14}}renderLoading(){this._type.textContent=localize("loading","Loading..."),this._docs.textContent="",this.domNode.classList.remove("no-docs","no-type"),this.layout(this.size.width,this.getLayoutInfo().lineHeight*2),this._onDidChangeContents.fire(this)}renderItem(C,W){var V,U;this._renderDisposeable.clear();let{detail:G,documentation:Z}=C.completion;if(W){let X="";X+=`score: ${C.score[0]}
`,X+=`prefix: ${(V=C.word)!==null&&V!==void 0?V:"(no prefix)"}
`,X+=`word: ${C.completion.filterText?C.completion.filterText+" (filterText)":C.textLabel}
`,X+=`distance: ${C.distance} (localityBonus-setting)
`,X+=`index: ${C.idx}, based on ${C.completion.sortText&&`sortText: "${C.completion.sortText}"`||"label"}
`,X+=`commit_chars: ${(U=C.completion.commitCharacters)===null||U===void 0?void 0:U.join("")}
`,Z=new MarkdownString().appendCodeblock("empty",X),G=`Provider: ${C.provider._debugDisplayName}`}if(!W&&!canExpandCompletionItem(C)){this.clearContents();return}if(this.domNode.classList.remove("no-docs","no-type"),G){const X=G.length>1e5?`${G.substr(0,1e5)}…`:G;this._type.textContent=X,this._type.title=X,show(this._type),this._type.classList.toggle("auto-wrap",!/\r?\n^\s+/gmi.test(X))}else clearNode(this._type),this._type.title="",hide(this._type),this.domNode.classList.add("no-type");if(clearNode(this._docs),typeof Z=="string")this._docs.classList.remove("markdown-docs"),this._docs.textContent=Z;else if(Z){this._docs.classList.add("markdown-docs"),clearNode(this._docs);const X=this._markdownRenderer.render(Z);this._docs.appendChild(X.element),this._renderDisposeable.add(X),this._renderDisposeable.add(this._markdownRenderer.onDidRenderAsync(()=>{this.layout(this._size.width,this._type.clientHeight+this._docs.clientHeight),this._onDidChangeContents.fire(this)}))}this.domNode.style.userSelect="text",this.domNode.tabIndex=-1,this._close.onmousedown=X=>{X.preventDefault(),X.stopPropagation()},this._close.onclick=X=>{X.preventDefault(),X.stopPropagation(),this._onDidClose.fire()},this._body.scrollTop=0,this.layout(this._size.width,this._type.clientHeight+this._docs.clientHeight),this._onDidChangeContents.fire(this)}clearContents(){this.domNode.classList.add("no-docs"),this._type.textContent="",this._docs.textContent=""}get size(){return this._size}layout(C,W){const V=new Dimension(C,W);Dimension.equals(V,this._size)||(this._size=V,size(this.domNode,C,W)),this._scrollbar.scanDomNode()}scrollDown(C=8){this._body.scrollTop+=C}scrollUp(C=8){this._body.scrollTop-=C}scrollTop(){this._body.scrollTop=0}scrollBottom(){this._body.scrollTop=this._body.scrollHeight}pageDown(){this.scrollDown(80)}pageUp(){this.scrollUp(80)}set borderWidth(C){this._borderWidth=C}get borderWidth(){return this._borderWidth}};SuggestDetailsWidget=__decorate$B([__param$B(1,IInstantiationService)],SuggestDetailsWidget);class SuggestDetailsOverlay{constructor(C,W){this.widget=C,this._editor=W,this._disposables=new DisposableStore,this._added=!1,this._preferAlignAtTop=!0,this._resizable=new ResizableHTMLElement,this._resizable.domNode.classList.add("suggest-details-container"),this._resizable.domNode.appendChild(C.domNode),this._resizable.enableSashes(!1,!0,!0,!1);let V,U,G=0,Z=0;this._disposables.add(this._resizable.onDidWillResize(()=>{V=this._topLeft,U=this._resizable.size})),this._disposables.add(this._resizable.onDidResize(X=>{if(V&&U){this.widget.layout(X.dimension.width,X.dimension.height);let Q=!1;X.west&&(Z=U.width-X.dimension.width,Q=!0),X.north&&(G=U.height-X.dimension.height,Q=!0),Q&&this._applyTopLeft({top:V.top+G,left:V.left+Z})}X.done&&(V=void 0,U=void 0,G=0,Z=0,this._userSize=X.dimension)})),this._disposables.add(this.widget.onDidChangeContents(()=>{var X;this._anchorBox&&this._placeAtAnchor(this._anchorBox,(X=this._userSize)!==null&&X!==void 0?X:this.widget.size,this._preferAlignAtTop)}))}dispose(){this._resizable.dispose(),this._disposables.dispose(),this.hide()}getId(){return"suggest.details"}getDomNode(){return this._resizable.domNode}getPosition(){return null}show(){this._added||(this._editor.addOverlayWidget(this),this.getDomNode().style.position="fixed",this._added=!0)}hide(C=!1){this._resizable.clearSashHoverState(),this._added&&(this._editor.removeOverlayWidget(this),this._added=!1,this._anchorBox=void 0,this._topLeft=void 0),C&&(this._userSize=void 0,this.widget.clearContents())}placeAtAnchor(C,W){var V;const U=C.getBoundingClientRect();this._anchorBox=U,this._preferAlignAtTop=W,this._placeAtAnchor(this._anchorBox,(V=this._userSize)!==null&&V!==void 0?V:this.widget.size,W)}_placeAtAnchor(C,W,V){var U;const G=getClientArea(this.getDomNode().ownerDocument.body),Z=this.widget.getLayoutInfo(),X=new Dimension(220,2*Z.lineHeight),Q=C.top,J=function(){const ce=G.width-(C.left+C.width+Z.borderWidth+Z.horizontalPadding),de=-Z.borderWidth+C.left+C.width,ue=new Dimension(ce,G.height-C.top-Z.borderHeight-Z.verticalPadding),ge=ue.with(void 0,C.top+C.height-Z.borderHeight-Z.verticalPadding);return{top:Q,left:de,fit:ce-W.width,maxSizeTop:ue,maxSizeBottom:ge,minSize:X.with(Math.min(ce,X.width))}}(),ee=function(){const ce=C.left-Z.borderWidth-Z.horizontalPadding,de=Math.max(Z.horizontalPadding,C.left-W.width-Z.borderWidth),ue=new Dimension(ce,G.height-C.top-Z.borderHeight-Z.verticalPadding),ge=ue.with(void 0,C.top+C.height-Z.borderHeight-Z.verticalPadding);return{top:Q,left:de,fit:ce-W.width,maxSizeTop:ue,maxSizeBottom:ge,minSize:X.with(Math.min(ce,X.width))}}(),te=function(){const ce=C.left,de=-Z.borderWidth+C.top+C.height,ue=new Dimension(C.width-Z.borderHeight,G.height-C.top-C.height-Z.verticalPadding);return{top:de,left:ce,fit:ue.height-W.height,maxSizeBottom:ue,maxSizeTop:ue,minSize:X.with(ue.width)}}(),ie=[J,ee,te],ne=(U=ie.find(ce=>ce.fit>=0))!==null&&U!==void 0?U:ie.sort((ce,de)=>de.fit-ce.fit)[0],oe=C.top+C.height-Z.borderHeight;let re,ae=W.height;const se=Math.max(ne.maxSizeTop.height,ne.maxSizeBottom.height);ae>se&&(ae=se);let le;V?ae<=ne.maxSizeTop.height?(re=!0,le=ne.maxSizeTop):(re=!1,le=ne.maxSizeBottom):ae<=ne.maxSizeBottom.height?(re=!1,le=ne.maxSizeBottom):(re=!0,le=ne.maxSizeTop),this._applyTopLeft({left:ne.left,top:re?ne.top:oe-ae}),this.getDomNode().style.position="fixed",this._resizable.enableSashes(!re,ne===J,re,ne!==J),this._resizable.minSize=ne.minSize,this._resizable.maxSize=le,this._resizable.layout(ae,Math.min(le.width,W.width)),this.widget.layout(this._resizable.size.width,this._resizable.size.height)}_applyTopLeft(C){this._topLeft=C,this.getDomNode().style.left=`${this._topLeft.left}px`,this.getDomNode().style.top=`${this._topLeft.top}px`}}var FileKind;(function(K){K[K.FILE=0]="FILE",K[K.FOLDER=1]="FOLDER",K[K.ROOT_FOLDER=2]="ROOT_FOLDER"})(FileKind||(FileKind={}));const fileIconDirectoryRegex=/(?:\/|^)(?:([^\/]+)\/)?([^\/]+)$/;function getIconClasses(K,C,W,V){const U=V===FileKind.ROOT_FOLDER?["rootfolder-icon"]:V===FileKind.FOLDER?["folder-icon"]:["file-icon"];if(W){let G;if(W.scheme===Schemas.data)G=DataUri.parseMetaData(W).get(DataUri.META_DATA_LABEL);else{const Z=W.path.match(fileIconDirectoryRegex);Z?(G=cssEscape(Z[2].toLowerCase()),Z[1]&&U.push(`${cssEscape(Z[1].toLowerCase())}-name-dir-icon`)):G=cssEscape(W.authority.toLowerCase())}if(V===FileKind.FOLDER)U.push(`${G}-name-folder-icon`);else{if(G){if(U.push(`${G}-name-file-icon`),U.push("name-file-icon"),G.length<=255){const X=G.split(".");for(let Q=1;Q<X.length;Q++)U.push(`${X.slice(Q).join(".")}-ext-file-icon`)}U.push("ext-file-icon")}const Z=detectLanguageId(K,C,W);Z&&U.push(`${cssEscape(Z)}-lang-file-icon`)}}return U}function detectLanguageId(K,C,W){if(!W)return null;let V=null;if(W.scheme===Schemas.data){const G=DataUri.parseMetaData(W).get(DataUri.META_DATA_MIME);G&&(V=C.getLanguageIdByMimeType(G))}else{const U=K.getModel(W);U&&(V=U.getLanguageId())}return V&&V!==PLAINTEXT_LANGUAGE_ID?V:C.guessLanguageIdByFilepathOrFirstLine(W)}function cssEscape(K){return K.replace(/[\11\12\14\15\40]/g,"/")}var __decorate$A=globalThis&&globalThis.__decorate||function(K,C,W,V){var U=arguments.length,G=U<3?C:V===null?V=Object.getOwnPropertyDescriptor(C,W):V,Z;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")G=Reflect.decorate(K,C,W,V);else for(var X=K.length-1;X>=0;X--)(Z=K[X])&&(G=(U<3?Z(G):U>3?Z(C,W,G):Z(C,W))||G);return U>3&&G&&Object.defineProperty(C,W,G),G},__param$A=globalThis&&globalThis.__param||function(K,C){return function(W,V){C(W,V,K)}},_a;function getAriaId(K){return`suggest-aria-id:${K}`}const suggestMoreInfoIcon=registerIcon("suggest-more-info",Codicon.chevronRight,localize("suggestMoreInfoIcon","Icon for more information in the suggest widget.")),_completionItemColor=new(_a=class{extract(C,W){if(C.textLabel.match(_a._regexStrict))return W[0]=C.textLabel,!0;if(C.completion.detail&&C.completion.detail.match(_a._regexStrict))return W[0]=C.completion.detail,!0;if(typeof C.completion.documentation=="string"){const V=_a._regexRelaxed.exec(C.completion.documentation);if(V&&(V.index===0||V.index+V[0].length===C.completion.documentation.length))return W[0]=V[0],!0}return!1}},_a._regexRelaxed=/(#([\da-fA-F]{3}){1,2}|(rgb|hsl)a\(\s*(\d{1,3}%?\s*,\s*){3}(1|0?\.\d+)\)|(rgb|hsl)\(\s*\d{1,3}%?(\s*,\s*\d{1,3}%?){2}\s*\))/,_a._regexStrict=new RegExp(`^${_a._regexRelaxed.source}$`,"i"),_a);let ItemRenderer=class{constructor(C,W,V,U){this._editor=C,this._modelService=W,this._languageService=V,this._themeService=U,this._onDidToggleDetails=new Emitter$1,this.onDidToggleDetails=this._onDidToggleDetails.event,this.templateId="suggestion"}dispose(){this._onDidToggleDetails.dispose()}renderTemplate(C){const W=new DisposableStore,V=C;V.classList.add("show-file-icons");const U=append$3(C,$$d(".icon")),G=append$3(U,$$d("span.colorspan")),Z=append$3(C,$$d(".contents")),X=append$3(Z,$$d(".main")),Q=append$3(X,$$d(".icon-label.codicon")),J=append$3(X,$$d("span.left")),ee=append$3(X,$$d("span.right")),te=new IconLabel(J,{supportHighlights:!0,supportIcons:!0});W.add(te);const ie=append$3(J,$$d("span.signature-label")),ne=append$3(J,$$d("span.qualifier-label")),oe=append$3(ee,$$d("span.details-label")),re=append$3(ee,$$d("span.readMore"+ThemeIcon.asCSSSelector(suggestMoreInfoIcon)));re.title=localize("readMore","Read More");const ae=()=>{const se=this._editor.getOptions(),le=se.get(50),ce=le.getMassagedFontFamily(),de=le.fontFeatureSettings,ue=se.get(118)||le.fontSize,ge=se.get(119)||le.lineHeight,he=le.fontWeight,fe=le.letterSpacing,pe=`${ue}px`,Se=`${ge}px`,Le=`${fe}px`;V.style.fontSize=pe,V.style.fontWeight=he,V.style.letterSpacing=Le,X.style.fontFamily=ce,X.style.fontFeatureSettings=de,X.style.lineHeight=Se,U.style.height=Se,U.style.width=Se,re.style.height=Se,re.style.width=Se};return ae(),W.add(this._editor.onDidChangeConfiguration(se=>{(se.hasChanged(50)||se.hasChanged(118)||se.hasChanged(119))&&ae()})),{root:V,left:J,right:ee,icon:U,colorspan:G,iconLabel:te,iconContainer:Q,parametersLabel:ie,qualifierLabel:ne,detailsLabel:oe,readMore:re,disposables:W}}renderElement(C,W,V){const{completion:U}=C;V.root.id=getAriaId(W),V.colorspan.style.backgroundColor="";const G={labelEscapeNewLines:!0,matches:createMatches(C.score)},Z=[];if(U.kind===19&&_completionItemColor.extract(C,Z))V.icon.className="icon customcolor",V.iconContainer.className="icon hide",V.colorspan.style.backgroundColor=Z[0];else if(U.kind===20&&this._themeService.getFileIconTheme().hasFileIcons){V.icon.className="icon hide",V.iconContainer.className="icon hide";const X=getIconClasses(this._modelService,this._languageService,URI.from({scheme:"fake",path:C.textLabel}),FileKind.FILE),Q=getIconClasses(this._modelService,this._languageService,URI.from({scheme:"fake",path:U.detail}),FileKind.FILE);G.extraClasses=X.length>Q.length?X:Q}else U.kind===23&&this._themeService.getFileIconTheme().hasFolderIcons?(V.icon.className="icon hide",V.iconContainer.className="icon hide",G.extraClasses=[getIconClasses(this._modelService,this._languageService,URI.from({scheme:"fake",path:C.textLabel}),FileKind.FOLDER),getIconClasses(this._modelService,this._languageService,URI.from({scheme:"fake",path:U.detail}),FileKind.FOLDER)].flat()):(V.icon.className="icon hide",V.iconContainer.className="",V.iconContainer.classList.add("suggest-icon",...ThemeIcon.asClassNameArray(CompletionItemKinds.toIcon(U.kind))));U.tags&&U.tags.indexOf(1)>=0&&(G.extraClasses=(G.extraClasses||[]).concat(["deprecated"]),G.matches=[]),V.iconLabel.setLabel(C.textLabel,void 0,G),typeof U.label=="string"?(V.parametersLabel.textContent="",V.detailsLabel.textContent=stripNewLines(U.detail||""),V.root.classList.add("string-label")):(V.parametersLabel.textContent=stripNewLines(U.label.detail||""),V.detailsLabel.textContent=stripNewLines(U.label.description||""),V.root.classList.remove("string-label")),this._editor.getOption(117).showInlineDetails?show(V.detailsLabel):hide(V.detailsLabel),canExpandCompletionItem(C)?(V.right.classList.add("can-expand-details"),show(V.readMore),V.readMore.onmousedown=X=>{X.stopPropagation(),X.preventDefault()},V.readMore.onclick=X=>{X.stopPropagation(),X.preventDefault(),this._onDidToggleDetails.fire()}):(V.right.classList.remove("can-expand-details"),hide(V.readMore),V.readMore.onmousedown=null,V.readMore.onclick=null)}disposeTemplate(C){C.disposables.dispose()}};ItemRenderer=__decorate$A([__param$A(1,IModelService),__param$A(2,ILanguageService),__param$A(3,IThemeService)],ItemRenderer);function stripNewLines(K){return K.replace(/\r\n|\r|\n/g,"")}var __decorate$z=globalThis&&globalThis.__decorate||function(K,C,W,V){var U=arguments.length,G=U<3?C:V===null?V=Object.getOwnPropertyDescriptor(C,W):V,Z;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")G=Reflect.decorate(K,C,W,V);else for(var X=K.length-1;X>=0;X--)(Z=K[X])&&(G=(U<3?Z(G):U>3?Z(C,W,G):Z(C,W))||G);return U>3&&G&&Object.defineProperty(C,W,G),G},__param$z=globalThis&&globalThis.__param||function(K,C){return function(W,V){C(W,V,K)}},__awaiter$p=globalThis&&globalThis.__awaiter||function(K,C,W,V){function U(G){return G instanceof W?G:new W(function(Z){Z(G)})}return new(W||(W=Promise))(function(G,Z){function X(ee){try{J(V.next(ee))}catch(te){Z(te)}}function Q(ee){try{J(V.throw(ee))}catch(te){Z(te)}}function J(ee){ee.done?G(ee.value):U(ee.value).then(X,Q)}J((V=V.apply(K,C||[])).next())})},SuggestWidget_1;registerColor("editorSuggestWidget.background",{dark:editorWidgetBackground,light:editorWidgetBackground,hcDark:editorWidgetBackground,hcLight:editorWidgetBackground},localize("editorSuggestWidgetBackground","Background color of the suggest widget."));registerColor("editorSuggestWidget.border",{dark:editorWidgetBorder,light:editorWidgetBorder,hcDark:editorWidgetBorder,hcLight:editorWidgetBorder},localize("editorSuggestWidgetBorder","Border color of the suggest widget."));const editorSuggestWidgetForeground=registerColor("editorSuggestWidget.foreground",{dark:editorForeground,light:editorForeground,hcDark:editorForeground,hcLight:editorForeground},localize("editorSuggestWidgetForeground","Foreground color of the suggest widget."));registerColor("editorSuggestWidget.selectedForeground",{dark:quickInputListFocusForeground,light:quickInputListFocusForeground,hcDark:quickInputListFocusForeground,hcLight:quickInputListFocusForeground},localize("editorSuggestWidgetSelectedForeground","Foreground color of the selected entry in the suggest widget."));registerColor("editorSuggestWidget.selectedIconForeground",{dark:quickInputListFocusIconForeground,light:quickInputListFocusIconForeground,hcDark:quickInputListFocusIconForeground,hcLight:quickInputListFocusIconForeground},localize("editorSuggestWidgetSelectedIconForeground","Icon foreground color of the selected entry in the suggest widget."));const editorSuggestWidgetSelectedBackground=registerColor("editorSuggestWidget.selectedBackground",{dark:quickInputListFocusBackground,light:quickInputListFocusBackground,hcDark:quickInputListFocusBackground,hcLight:quickInputListFocusBackground},localize("editorSuggestWidgetSelectedBackground","Background color of the selected entry in the suggest widget."));registerColor("editorSuggestWidget.highlightForeground",{dark:listHighlightForeground,light:listHighlightForeground,hcDark:listHighlightForeground,hcLight:listHighlightForeground},localize("editorSuggestWidgetHighlightForeground","Color of the match highlights in the suggest widget."));registerColor("editorSuggestWidget.focusHighlightForeground",{dark:listFocusHighlightForeground,light:listFocusHighlightForeground,hcDark:listFocusHighlightForeground,hcLight:listFocusHighlightForeground},localize("editorSuggestWidgetFocusHighlightForeground","Color of the match highlights in the suggest widget when an item is focused."));registerColor("editorSuggestWidgetStatus.foreground",{dark:transparent(editorSuggestWidgetForeground,.5),light:transparent(editorSuggestWidgetForeground,.5),hcDark:transparent(editorSuggestWidgetForeground,.5),hcLight:transparent(editorSuggestWidgetForeground,.5)},localize("editorSuggestWidgetStatusForeground","Foreground color of the suggest widget status."));class PersistedWidgetSize{constructor(C,W){this._service=C,this._key=`suggestWidget.size/${W.getEditorType()}/${W instanceof EmbeddedCodeEditorWidget}`}restore(){var C;const W=(C=this._service.get(this._key,0))!==null&&C!==void 0?C:"";try{const V=JSON.parse(W);if(Dimension.is(V))return Dimension.lift(V)}catch{}}store(C){this._service.store(this._key,JSON.stringify(C),0,1)}reset(){this._service.remove(this._key,0)}}let SuggestWidget=SuggestWidget_1=class{constructor(C,W,V,U,G){this.editor=C,this._storageService=W,this._state=0,this._isAuto=!1,this._pendingLayout=new MutableDisposable,this._pendingShowDetails=new MutableDisposable,this._ignoreFocusEvents=!1,this._forceRenderingAbove=!1,this._explainMode=!1,this._showTimeout=new TimeoutTimer,this._disposables=new DisposableStore,this._onDidSelect=new PauseableEmitter,this._onDidFocus=new PauseableEmitter,this._onDidHide=new Emitter$1,this._onDidShow=new Emitter$1,this.onDidSelect=this._onDidSelect.event,this.onDidFocus=this._onDidFocus.event,this.onDidHide=this._onDidHide.event,this.onDidShow=this._onDidShow.event,this._onDetailsKeydown=new Emitter$1,this.onDetailsKeyDown=this._onDetailsKeydown.event,this.element=new ResizableHTMLElement,this.element.domNode.classList.add("editor-widget","suggest-widget"),this._contentWidget=new SuggestContentWidget(this,C),this._persistedSize=new PersistedWidgetSize(W,C);class Z{constructor(ne,oe,re=!1,ae=!1){this.persistedSize=ne,this.currentSize=oe,this.persistHeight=re,this.persistWidth=ae}}let X;this._disposables.add(this.element.onDidWillResize(()=>{this._contentWidget.lockPreference(),X=new Z(this._persistedSize.restore(),this.element.size)})),this._disposables.add(this.element.onDidResize(ie=>{var ne,oe,re,ae;if(this._resize(ie.dimension.width,ie.dimension.height),X&&(X.persistHeight=X.persistHeight||!!ie.north||!!ie.south,X.persistWidth=X.persistWidth||!!ie.east||!!ie.west),!!ie.done){if(X){const{itemHeight:se,defaultSize:le}=this.getLayoutInfo(),ce=Math.round(se/2);let{width:de,height:ue}=this.element.size;(!X.persistHeight||Math.abs(X.currentSize.height-ue)<=ce)&&(ue=(oe=(ne=X.persistedSize)===null||ne===void 0?void 0:ne.height)!==null&&oe!==void 0?oe:le.height),(!X.persistWidth||Math.abs(X.currentSize.width-de)<=ce)&&(de=(ae=(re=X.persistedSize)===null||re===void 0?void 0:re.width)!==null&&ae!==void 0?ae:le.width),this._persistedSize.store(new Dimension(de,ue))}this._contentWidget.unlockPreference(),X=void 0}})),this._messageElement=append$3(this.element.domNode,$$d(".message")),this._listElement=append$3(this.element.domNode,$$d(".tree"));const Q=this._disposables.add(G.createInstance(SuggestDetailsWidget,this.editor));Q.onDidClose(this.toggleDetails,this,this._disposables),this._details=new SuggestDetailsOverlay(Q,this.editor);const J=()=>this.element.domNode.classList.toggle("no-icons",!this.editor.getOption(117).showIcons);J();const ee=G.createInstance(ItemRenderer,this.editor);this._disposables.add(ee),this._disposables.add(ee.onDidToggleDetails(()=>this.toggleDetails())),this._list=new List$1("SuggestWidget",this._listElement,{getHeight:ie=>this.getLayoutInfo().itemHeight,getTemplateId:ie=>"suggestion"},[ee],{alwaysConsumeMouseWheel:!0,useShadows:!1,mouseSupport:!1,multipleSelectionSupport:!1,accessibilityProvider:{getRole:()=>"option",getWidgetAriaLabel:()=>localize("suggest","Suggest"),getWidgetRole:()=>"listbox",getAriaLabel:ie=>{let ne=ie.textLabel;if(typeof ie.completion.label!="string"){const{detail:se,description:le}=ie.completion.label;se&&le?ne=localize("label.full","{0} {1}, {2}",ne,se,le):se?ne=localize("label.detail","{0} {1}",ne,se):le&&(ne=localize("label.desc","{0}, {1}",ne,le))}if(!ie.isResolved||!this._isDetailsVisible())return ne;const{documentation:oe,detail:re}=ie.completion,ae=format("{0}{1}",re||"",oe?typeof oe=="string"?oe:oe.value:"");return localize("ariaCurrenttSuggestionReadDetails","{0}, docs: {1}",ne,ae)}}}),this._list.style(getListStyles({listInactiveFocusBackground:editorSuggestWidgetSelectedBackground,listInactiveFocusOutline:activeContrastBorder})),this._status=G.createInstance(SuggestWidgetStatus,this.element.domNode,suggestWidgetStatusbarMenu);const te=()=>this.element.domNode.classList.toggle("with-status-bar",this.editor.getOption(117).showStatusBar);te(),this._disposables.add(U.onDidColorThemeChange(ie=>this._onThemeChange(ie))),this._onThemeChange(U.getColorTheme()),this._disposables.add(this._list.onMouseDown(ie=>this._onListMouseDownOrTap(ie))),this._disposables.add(this._list.onTap(ie=>this._onListMouseDownOrTap(ie))),this._disposables.add(this._list.onDidChangeSelection(ie=>this._onListSelection(ie))),this._disposables.add(this._list.onDidChangeFocus(ie=>this._onListFocus(ie))),this._disposables.add(this.editor.onDidChangeCursorSelection(()=>this._onCursorSelectionChanged())),this._disposables.add(this.editor.onDidChangeConfiguration(ie=>{ie.hasChanged(117)&&(te(),J())})),this._ctxSuggestWidgetVisible=Context$1.Visible.bindTo(V),this._ctxSuggestWidgetDetailsVisible=Context$1.DetailsVisible.bindTo(V),this._ctxSuggestWidgetMultipleSuggestions=Context$1.MultipleSuggestions.bindTo(V),this._ctxSuggestWidgetHasFocusedSuggestion=Context$1.HasFocusedSuggestion.bindTo(V),this._disposables.add(addStandardDisposableListener(this._details.widget.domNode,"keydown",ie=>{this._onDetailsKeydown.fire(ie)})),this._disposables.add(this.editor.onMouseDown(ie=>this._onEditorMouseDown(ie)))}dispose(){var C;this._details.widget.dispose(),this._details.dispose(),this._list.dispose(),this._status.dispose(),this._disposables.dispose(),(C=this._loadingTimeout)===null||C===void 0||C.dispose(),this._pendingLayout.dispose(),this._pendingShowDetails.dispose(),this._showTimeout.dispose(),this._contentWidget.dispose(),this.element.dispose()}_onEditorMouseDown(C){this._details.widget.domNode.contains(C.target.element)?this._details.widget.domNode.focus():this.element.domNode.contains(C.target.element)&&this.editor.focus()}_onCursorSelectionChanged(){this._state!==0&&this._contentWidget.layout()}_onListMouseDownOrTap(C){typeof C.element>"u"||typeof C.index>"u"||(C.browserEvent.preventDefault(),C.browserEvent.stopPropagation(),this._select(C.element,C.index))}_onListSelection(C){C.elements.length&&this._select(C.elements[0],C.indexes[0])}_select(C,W){const V=this._completionModel;V&&(this._onDidSelect.fire({item:C,index:W,model:V}),this.editor.focus())}_onThemeChange(C){this._details.widget.borderWidth=isHighContrast(C.type)?2:1}_onListFocus(C){var W;if(this._ignoreFocusEvents)return;if(!C.elements.length){this._currentSuggestionDetails&&(this._currentSuggestionDetails.cancel(),this._currentSuggestionDetails=void 0,this._focusedItem=void 0),this.editor.setAriaOptions({activeDescendant:void 0}),this._ctxSuggestWidgetHasFocusedSuggestion.set(!1);return}if(!this._completionModel)return;this._ctxSuggestWidgetHasFocusedSuggestion.set(!0);const V=C.elements[0],U=C.indexes[0];V!==this._focusedItem&&((W=this._currentSuggestionDetails)===null||W===void 0||W.cancel(),this._currentSuggestionDetails=void 0,this._focusedItem=V,this._list.reveal(U),this._currentSuggestionDetails=createCancelablePromise(G=>__awaiter$p(this,void 0,void 0,function*(){const Z=disposableTimeout(()=>{this._isDetailsVisible()&&this.showDetails(!0)},250),X=G.onCancellationRequested(()=>Z.dispose());try{return yield V.resolve(G)}finally{Z.dispose(),X.dispose()}})),this._currentSuggestionDetails.then(()=>{U>=this._list.length||V!==this._list.element(U)||(this._ignoreFocusEvents=!0,this._list.splice(U,1,[V]),this._list.setFocus([U]),this._ignoreFocusEvents=!1,this._isDetailsVisible()?this.showDetails(!1):this.element.domNode.classList.remove("docs-side"),this.editor.setAriaOptions({activeDescendant:getAriaId(U)}))}).catch(onUnexpectedError)),this._onDidFocus.fire({item:V,index:U,model:this._completionModel})}_setState(C){if(this._state!==C)switch(this._state=C,this.element.domNode.classList.toggle("frozen",C===4),this.element.domNode.classList.remove("message"),C){case 0:hide(this._messageElement,this._listElement,this._status.element),this._details.hide(!0),this._status.hide(),this._contentWidget.hide(),this._ctxSuggestWidgetVisible.reset(),this._ctxSuggestWidgetMultipleSuggestions.reset(),this._ctxSuggestWidgetHasFocusedSuggestion.reset(),this._showTimeout.cancel(),this.element.domNode.classList.remove("visible"),this._list.splice(0,this._list.length),this._focusedItem=void 0,this._cappedHeight=void 0,this._explainMode=!1;break;case 1:this.element.domNode.classList.add("message"),this._messageElement.textContent=SuggestWidget_1.LOADING_MESSAGE,hide(this._listElement,this._status.element),show(this._messageElement),this._details.hide(),this._show(),this._focusedItem=void 0,status(SuggestWidget_1.LOADING_MESSAGE);break;case 2:this.element.domNode.classList.add("message"),this._messageElement.textContent=SuggestWidget_1.NO_SUGGESTIONS_MESSAGE,hide(this._listElement,this._status.element),show(this._messageElement),this._details.hide(),this._show(),this._focusedItem=void 0,status(SuggestWidget_1.NO_SUGGESTIONS_MESSAGE);break;case 3:hide(this._messageElement),show(this._listElement,this._status.element),this._show();break;case 4:hide(this._messageElement),show(this._listElement,this._status.element),this._show();break;case 5:hide(this._messageElement),show(this._listElement,this._status.element),this._details.show(),this._show();break}}_show(){this._status.show(),this._contentWidget.show(),this._layout(this._persistedSize.restore()),this._ctxSuggestWidgetVisible.set(!0),this._showTimeout.cancelAndSet(()=>{this.element.domNode.classList.add("visible"),this._onDidShow.fire(this)},100)}showTriggered(C,W){this._state===0&&(this._contentWidget.setPosition(this.editor.getPosition()),this._isAuto=!!C,this._isAuto||(this._loadingTimeout=disposableTimeout(()=>this._setState(1),W)))}showSuggestions(C,W,V,U,G){var Z,X;if(this._contentWidget.setPosition(this.editor.getPosition()),(Z=this._loadingTimeout)===null||Z===void 0||Z.dispose(),(X=this._currentSuggestionDetails)===null||X===void 0||X.cancel(),this._currentSuggestionDetails=void 0,this._completionModel!==C&&(this._completionModel=C),V&&this._state!==2&&this._state!==0){this._setState(4);return}const Q=this._completionModel.items.length,J=Q===0;if(this._ctxSuggestWidgetMultipleSuggestions.set(Q>1),J){this._setState(U?0:2),this._completionModel=void 0;return}this._focusedItem=void 0,this._onDidFocus.pause(),this._onDidSelect.pause();try{this._list.splice(0,this._list.length,this._completionModel.items),this._setState(V?4:3),this._list.reveal(W,0),this._list.setFocus(G?[]:[W])}finally{this._onDidFocus.resume(),this._onDidSelect.resume()}this._pendingLayout.value=runAtThisOrScheduleAtNextAnimationFrame(()=>{this._pendingLayout.clear(),this._layout(this.element.size),this._details.widget.domNode.classList.remove("focused")})}focusSelected(){this._list.length>0&&this._list.setFocus([0])}selectNextPage(){switch(this._state){case 0:return!1;case 5:return this._details.widget.pageDown(),!0;case 1:return!this._isAuto;default:return this._list.focusNextPage(),!0}}selectNext(){switch(this._state){case 0:return!1;case 1:return!this._isAuto;default:return this._list.focusNext(1,!0),!0}}selectLast(){switch(this._state){case 0:return!1;case 5:return this._details.widget.scrollBottom(),!0;case 1:return!this._isAuto;default:return this._list.focusLast(),!0}}selectPreviousPage(){switch(this._state){case 0:return!1;case 5:return this._details.widget.pageUp(),!0;case 1:return!this._isAuto;default:return this._list.focusPreviousPage(),!0}}selectPrevious(){switch(this._state){case 0:return!1;case 1:return!this._isAuto;default:return this._list.focusPrevious(1,!0),!1}}selectFirst(){switch(this._state){case 0:return!1;case 5:return this._details.widget.scrollTop(),!0;case 1:return!this._isAuto;default:return this._list.focusFirst(),!0}}getFocusedItem(){if(this._state!==0&&this._state!==2&&this._state!==1&&this._completionModel&&this._list.getFocus().length>0)return{item:this._list.getFocusedElements()[0],index:this._list.getFocus()[0],model:this._completionModel}}toggleDetailsFocus(){this._state===5?(this._setState(3),this._details.widget.domNode.classList.remove("focused")):this._state===3&&this._isDetailsVisible()&&(this._setState(5),this._details.widget.domNode.classList.add("focused"))}toggleDetails(){this._isDetailsVisible()?(this._pendingShowDetails.clear(),this._ctxSuggestWidgetDetailsVisible.set(!1),this._setDetailsVisible(!1),this._details.hide(),this.element.domNode.classList.remove("shows-details")):(canExpandCompletionItem(this._list.getFocusedElements()[0])||this._explainMode)&&(this._state===3||this._state===5||this._state===4)&&(this._ctxSuggestWidgetDetailsVisible.set(!0),this._setDetailsVisible(!0),this.showDetails(!1))}showDetails(C){this._pendingShowDetails.value=runAtThisOrScheduleAtNextAnimationFrame(()=>{this._pendingShowDetails.clear(),this._details.show(),C?this._details.widget.renderLoading():this._details.widget.renderItem(this._list.getFocusedElements()[0],this._explainMode),this._positionDetails(),this.editor.focus(),this.element.domNode.classList.add("shows-details")})}toggleExplainMode(){this._list.getFocusedElements()[0]&&(this._explainMode=!this._explainMode,this._isDetailsVisible()?this.showDetails(!1):this.toggleDetails())}resetPersistedSize(){this._persistedSize.reset()}hideWidget(){var C;this._pendingLayout.clear(),this._pendingShowDetails.clear(),(C=this._loadingTimeout)===null||C===void 0||C.dispose(),this._setState(0),this._onDidHide.fire(this),this.element.clearSashHoverState();const W=this._persistedSize.restore(),V=Math.ceil(this.getLayoutInfo().itemHeight*4.3);W&&W.height<V&&this._persistedSize.store(W.with(void 0,V))}isFrozen(){return this._state===4}_afterRender(C){if(C===null){this._isDetailsVisible()&&this._details.hide();return}this._state===2||this._state===1||(this._isDetailsVisible()&&this._details.show(),this._positionDetails())}_layout(C){var W,V,U;if(!this.editor.hasModel()||!this.editor.getDomNode())return;const G=getClientArea(this.element.domNode.ownerDocument.body),Z=this.getLayoutInfo();C||(C=Z.defaultSize);let X=C.height,Q=C.width;if(this._status.element.style.height=`${Z.itemHeight}px`,this._state===2||this._state===1)X=Z.itemHeight+Z.borderHeight,Q=Z.defaultSize.width/2,this.element.enableSashes(!1,!1,!1,!1),this.element.minSize=this.element.maxSize=new Dimension(Q,X),this._contentWidget.setPreference(2);else{const J=G.width-Z.borderHeight-2*Z.horizontalPadding;Q>J&&(Q=J);const ee=this._completionModel?this._completionModel.stats.pLabelLen*Z.typicalHalfwidthCharacterWidth:Q,te=Z.statusBarHeight+this._list.contentHeight+Z.borderHeight,ie=Z.itemHeight+Z.statusBarHeight,ne=getDomNodePagePosition(this.editor.getDomNode()),oe=this.editor.getScrolledVisiblePosition(this.editor.getPosition()),re=ne.top+oe.top+oe.height,ae=Math.min(G.height-re-Z.verticalPadding,te),se=ne.top+oe.top-Z.verticalPadding,le=Math.min(se,te);let ce=Math.min(Math.max(le,ae)+Z.borderHeight,te);X===((W=this._cappedHeight)===null||W===void 0?void 0:W.capped)&&(X=this._cappedHeight.wanted),X<ie&&(X=ie),X>ce&&(X=ce);const de=150;X>ae||this._forceRenderingAbove&&se>de?(this._contentWidget.setPreference(1),this.element.enableSashes(!0,!0,!1,!1),ce=le):(this._contentWidget.setPreference(2),this.element.enableSashes(!1,!0,!0,!1),ce=ae),this.element.preferredSize=new Dimension(ee,Z.defaultSize.height),this.element.maxSize=new Dimension(J,ce),this.element.minSize=new Dimension(220,ie),this._cappedHeight=X===te?{wanted:(U=(V=this._cappedHeight)===null||V===void 0?void 0:V.wanted)!==null&&U!==void 0?U:C.height,capped:X}:void 0}this._resize(Q,X)}_resize(C,W){const{width:V,height:U}=this.element.maxSize;C=Math.min(V,C),W=Math.min(U,W);const{statusBarHeight:G}=this.getLayoutInfo();this._list.layout(W-G,C),this._listElement.style.height=`${W-G}px`,this.element.layout(W,C),this._contentWidget.layout(),this._positionDetails()}_positionDetails(){var C;this._isDetailsVisible()&&this._details.placeAtAnchor(this.element.domNode,((C=this._contentWidget.getPosition())===null||C===void 0?void 0:C.preference[0])===2)}getLayoutInfo(){const C=this.editor.getOption(50),W=clamp$2(this.editor.getOption(119)||C.lineHeight,8,1e3),V=!this.editor.getOption(117).showStatusBar||this._state===2||this._state===1?0:W,U=this._details.widget.borderWidth,G=2*U;return{itemHeight:W,statusBarHeight:V,borderWidth:U,borderHeight:G,typicalHalfwidthCharacterWidth:C.typicalHalfwidthCharacterWidth,verticalPadding:22,horizontalPadding:14,defaultSize:new Dimension(430,V+12*W+G)}}_isDetailsVisible(){return this._storageService.getBoolean("expandSuggestionDocs",0,!1)}_setDetailsVisible(C){this._storageService.store("expandSuggestionDocs",C,0,0)}forceRenderingAbove(){this._forceRenderingAbove||(this._forceRenderingAbove=!0,this._layout(this._persistedSize.restore()))}stopForceRenderingAbove(){this._forceRenderingAbove=!1}};SuggestWidget.LOADING_MESSAGE=localize("suggestWidget.loading","Loading...");SuggestWidget.NO_SUGGESTIONS_MESSAGE=localize("suggestWidget.noSuggestions","No suggestions.");SuggestWidget=SuggestWidget_1=__decorate$z([__param$z(1,IStorageService),__param$z(2,IContextKeyService),__param$z(3,IThemeService),__param$z(4,IInstantiationService)],SuggestWidget);class SuggestContentWidget{constructor(C,W){this._widget=C,this._editor=W,this.allowEditorOverflow=!0,this.suppressMouseDown=!1,this._preferenceLocked=!1,this._added=!1,this._hidden=!1}dispose(){this._added&&(this._added=!1,this._editor.removeContentWidget(this))}getId(){return"editor.widget.suggestWidget"}getDomNode(){return this._widget.element.domNode}show(){this._hidden=!1,this._added||(this._added=!0,this._editor.addContentWidget(this))}hide(){this._hidden||(this._hidden=!0,this.layout())}layout(){this._editor.layoutContentWidget(this)}getPosition(){return this._hidden||!this._position||!this._preference?null:{position:this._position,preference:[this._preference]}}beforeRender(){const{height:C,width:W}=this._widget.element.size,{borderWidth:V,horizontalPadding:U}=this._widget.getLayoutInfo();return new Dimension(W+2*V+U,C+2*V)}afterRender(C){this._widget._afterRender(C)}setPreference(C){this._preferenceLocked||(this._preference=C)}lockPreference(){this._preferenceLocked=!0}unlockPreference(){this._preferenceLocked=!1}setPosition(C){this._position=C}}var __decorate$y=globalThis&&globalThis.__decorate||function(K,C,W,V){var U=arguments.length,G=U<3?C:V===null?V=Object.getOwnPropertyDescriptor(C,W):V,Z;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")G=Reflect.decorate(K,C,W,V);else for(var X=K.length-1;X>=0;X--)(Z=K[X])&&(G=(U<3?Z(G):U>3?Z(C,W,G):Z(C,W))||G);return U>3&&G&&Object.defineProperty(C,W,G),G},__param$y=globalThis&&globalThis.__param||function(K,C){return function(W,V){C(W,V,K)}},SuggestController_1;class LineSuffix{constructor(C,W){if(this._model=C,this._position=W,C.getLineMaxColumn(W.lineNumber)!==W.column){const U=C.getOffsetAt(W),G=C.getPositionAt(U+1);this._marker=C.deltaDecorations([],[{range:Range$2.fromPositions(W,G),options:{description:"suggest-line-suffix",stickiness:1}}])}}dispose(){this._marker&&!this._model.isDisposed()&&this._model.deltaDecorations(this._marker,[])}delta(C){if(this._model.isDisposed()||this._position.lineNumber!==C.lineNumber)return 0;if(this._marker){const W=this._model.getDecorationRange(this._marker[0]);return this._model.getOffsetAt(W.getStartPosition())-this._model.getOffsetAt(C)}else return this._model.getLineMaxColumn(C.lineNumber)-C.column}}let SuggestController=SuggestController_1=class{static get(C){return C.getContribution(SuggestController_1.ID)}constructor(C,W,V,U,G,Z,X){this._memoryService=W,this._commandService=V,this._contextKeyService=U,this._instantiationService=G,this._logService=Z,this._telemetryService=X,this._lineSuffix=new MutableDisposable,this._toDispose=new DisposableStore,this._selectors=new PriorityRegistry(te=>te.priority),this._onWillInsertSuggestItem=new Emitter$1,this.onWillInsertSuggestItem=this._onWillInsertSuggestItem.event,this.editor=C,this.model=G.createInstance(SuggestModel,this.editor),this._selectors.register({priority:0,select:(te,ie,ne)=>this._memoryService.select(te,ie,ne)});const Q=Context$1.InsertMode.bindTo(U);Q.set(C.getOption(117).insertMode),this._toDispose.add(this.model.onDidTrigger(()=>Q.set(C.getOption(117).insertMode))),this.widget=this._toDispose.add(new IdleValue(()=>{const te=this._instantiationService.createInstance(SuggestWidget,this.editor);this._toDispose.add(te),this._toDispose.add(te.onDidSelect(ae=>this._insertSuggestion(ae,0),this));const ie=new CommitCharacterController(this.editor,te,this.model,ae=>this._insertSuggestion(ae,2));this._toDispose.add(ie);const ne=Context$1.MakesTextEdit.bindTo(this._contextKeyService),oe=Context$1.HasInsertAndReplaceRange.bindTo(this._contextKeyService),re=Context$1.CanResolve.bindTo(this._contextKeyService);return this._toDispose.add(toDisposable(()=>{ne.reset(),oe.reset(),re.reset()})),this._toDispose.add(te.onDidFocus(({item:ae})=>{const se=this.editor.getPosition(),le=ae.editStart.column,ce=se.column;let de=!0;this.editor.getOption(1)==="smart"&&this.model.state===2&&!ae.completion.additionalTextEdits&&!(ae.completion.insertTextRules&4)&&ce-le===ae.completion.insertText.length&&(de=this.editor.getModel().getValueInRange({startLineNumber:se.lineNumber,startColumn:le,endLineNumber:se.lineNumber,endColumn:ce})!==ae.completion.insertText),ne.set(de),oe.set(!Position$1.equals(ae.editInsertEnd,ae.editReplaceEnd)),re.set(!!ae.provider.resolveCompletionItem||!!ae.completion.documentation||ae.completion.detail!==ae.completion.label)})),this._toDispose.add(te.onDetailsKeyDown(ae=>{if(ae.toKeyCodeChord().equals(new KeyCodeChord(!0,!1,!1,!1,33))||isMacintosh&&ae.toKeyCodeChord().equals(new KeyCodeChord(!1,!1,!1,!0,33))){ae.stopPropagation();return}ae.toKeyCodeChord().isModifierKey()||this.editor.focus()})),te})),this._overtypingCapturer=this._toDispose.add(new IdleValue(()=>this._toDispose.add(new OvertypingCapturer(this.editor,this.model)))),this._alternatives=this._toDispose.add(new IdleValue(()=>this._toDispose.add(new SuggestAlternatives(this.editor,this._contextKeyService)))),this._toDispose.add(G.createInstance(WordContextKey,C)),this._toDispose.add(this.model.onDidTrigger(te=>{this.widget.value.showTriggered(te.auto,te.shy?250:50),this._lineSuffix.value=new LineSuffix(this.editor.getModel(),te.position)})),this._toDispose.add(this.model.onDidSuggest(te=>{if(te.triggerOptions.shy)return;let ie=-1;for(const oe of this._selectors.itemsOrderedByPriorityDesc)if(ie=oe.select(this.editor.getModel(),this.editor.getPosition(),te.completionModel.items),ie!==-1)break;ie===-1&&(ie=0);let ne=!1;if(te.triggerOptions.auto){const oe=this.editor.getOption(117);oe.selectionMode==="never"||oe.selectionMode==="always"?ne=oe.selectionMode==="never":oe.selectionMode==="whenTriggerCharacter"?ne=te.triggerOptions.triggerKind!==1:oe.selectionMode==="whenQuickSuggestion"&&(ne=te.triggerOptions.triggerKind===1&&!te.triggerOptions.refilter)}this.widget.value.showSuggestions(te.completionModel,ie,te.isFrozen,te.triggerOptions.auto,ne)})),this._toDispose.add(this.model.onDidCancel(te=>{te.retrigger||this.widget.value.hideWidget()})),this._toDispose.add(this.editor.onDidBlurEditorWidget(()=>{this.model.cancel(),this.model.clear()}));const J=Context$1.AcceptSuggestionsOnEnter.bindTo(U),ee=()=>{const te=this.editor.getOption(1);J.set(te==="on"||te==="smart")};this._toDispose.add(this.editor.onDidChangeConfiguration(()=>ee())),ee()}dispose(){this._alternatives.dispose(),this._toDispose.dispose(),this.widget.dispose(),this.model.dispose(),this._lineSuffix.dispose(),this._onWillInsertSuggestItem.dispose()}_insertSuggestion(C,W){if(!C||!C.item){this._alternatives.value.reset(),this.model.cancel(),this.model.clear();return}if(!this.editor.hasModel())return;const V=SnippetController2.get(this.editor);if(!V)return;this._onWillInsertSuggestItem.fire({item:C.item});const U=this.editor.getModel(),G=U.getAlternativeVersionId(),{item:Z}=C,X=[],Q=new CancellationTokenSource$1;W&1||this.editor.pushUndoStop();const J=this.getOverwriteInfo(Z,!!(W&8));this._memoryService.memorize(U,this.editor.getPosition(),Z);const ee=Z.isResolved;let te=-1,ie=-1;if(Array.isArray(Z.completion.additionalTextEdits)){this.model.cancel();const oe=StableEditorScrollState.capture(this.editor);this.editor.executeEdits("suggestController.additionalTextEdits.sync",Z.completion.additionalTextEdits.map(re=>EditOperation.replaceMove(Range$2.lift(re.range),re.text))),oe.restoreRelativeVerticalPositionOfCursor(this.editor)}else if(!ee){const oe=new StopWatch;let re;const ae=U.onDidChangeContent(de=>{if(de.isFlush){Q.cancel(),ae.dispose();return}for(const ue of de.changes){const ge=Range$2.getEndPosition(ue.range);(!re||Position$1.isBefore(ge,re))&&(re=ge)}}),se=W;W|=2;let le=!1;const ce=this.editor.onWillType(()=>{ce.dispose(),le=!0,se&2||this.editor.pushUndoStop()});X.push(Z.resolve(Q.token).then(()=>{if(!Z.completion.additionalTextEdits||Q.token.isCancellationRequested)return;if(re&&Z.completion.additionalTextEdits.some(ue=>Position$1.isBefore(re,Range$2.getStartPosition(ue.range))))return!1;le&&this.editor.pushUndoStop();const de=StableEditorScrollState.capture(this.editor);return this.editor.executeEdits("suggestController.additionalTextEdits.async",Z.completion.additionalTextEdits.map(ue=>EditOperation.replaceMove(Range$2.lift(ue.range),ue.text))),de.restoreRelativeVerticalPositionOfCursor(this.editor),(le||!(se&2))&&this.editor.pushUndoStop(),!0}).then(de=>{this._logService.trace("[suggest] async resolving of edits DONE (ms, applied?)",oe.elapsed(),de),ie=de===!0?1:de===!1?0:-2}).finally(()=>{ae.dispose(),ce.dispose()}))}let{insertText:ne}=Z.completion;if(Z.completion.insertTextRules&4||(ne=SnippetParser.escape(ne)),this.model.cancel(),V.insert(ne,{overwriteBefore:J.overwriteBefore,overwriteAfter:J.overwriteAfter,undoStopBefore:!1,undoStopAfter:!1,adjustWhitespace:!(Z.completion.insertTextRules&1),clipboardText:C.model.clipboardText,overtypingCapturer:this._overtypingCapturer.value}),W&2||this.editor.pushUndoStop(),Z.completion.command)if(Z.completion.command.id===TriggerSuggestAction.id)this.model.trigger({auto:!0,retrigger:!0});else{const oe=new StopWatch;X.push(this._commandService.executeCommand(Z.completion.command.id,...Z.completion.command.arguments?[...Z.completion.command.arguments]:[]).catch(re=>{Z.completion.extensionId?onUnexpectedExternalError(re):onUnexpectedError(re)}).finally(()=>{te=oe.elapsed()}))}W&4&&this._alternatives.value.set(C,oe=>{for(Q.cancel();U.canUndo();){G!==U.getAlternativeVersionId()&&U.undo(),this._insertSuggestion(oe,3|(W&8?8:0));break}}),this._alertCompletionItem(Z),Promise.all(X).finally(()=>{this._reportSuggestionAcceptedTelemetry(Z,U,ee,te,ie),this.model.clear(),Q.dispose()})}_reportSuggestionAcceptedTelemetry(C,W,V,U,G){var Z,X,Q;Math.floor(Math.random()*100)!==0&&this._telemetryService.publicLog2("suggest.acceptedSuggestion",{extensionId:(X=(Z=C.extensionId)===null||Z===void 0?void 0:Z.value)!==null&&X!==void 0?X:"unknown",providerId:(Q=C.provider._debugDisplayName)!==null&&Q!==void 0?Q:"unknown",kind:C.completion.kind,basenameHash:hash(basename(W.uri)).toString(16),languageId:W.getLanguageId(),fileExtension:extname(W.uri),resolveInfo:C.provider.resolveCompletionItem?V?1:0:-1,resolveDuration:C.resolveDuration,commandDuration:U,additionalEditsAsync:G})}getOverwriteInfo(C,W){assertType(this.editor.hasModel());let V=this.editor.getOption(117).insertMode==="replace";W&&(V=!V);const U=C.position.column-C.editStart.column,G=(V?C.editReplaceEnd.column:C.editInsertEnd.column)-C.position.column,Z=this.editor.getPosition().column-C.position.column,X=this._lineSuffix.value?this._lineSuffix.value.delta(this.editor.getPosition()):0;return{overwriteBefore:U+Z,overwriteAfter:G+X}}_alertCompletionItem(C){if(isNonEmptyArray$2(C.completion.additionalTextEdits)){const W=localize("aria.alert.snippet","Accepting '{0}' made {1} additional edits",C.textLabel,C.completion.additionalTextEdits.length);alert(W)}}triggerSuggest(C,W,V){this.editor.hasModel()&&(this.model.trigger({auto:W??!1,completionOptions:{providerFilter:C,kindFilter:V?new Set:void 0}}),this.editor.revealPosition(this.editor.getPosition(),0),this.editor.focus())}triggerSuggestAndAcceptBest(C){if(!this.editor.hasModel())return;const W=this.editor.getPosition(),V=()=>{W.equals(this.editor.getPosition())&&this._commandService.executeCommand(C.fallback)},U=G=>{if(G.completion.insertTextRules&4||G.completion.additionalTextEdits)return!0;const Z=this.editor.getPosition(),X=G.editStart.column,Q=Z.column;return Q-X!==G.completion.insertText.length?!0:this.editor.getModel().getValueInRange({startLineNumber:Z.lineNumber,startColumn:X,endLineNumber:Z.lineNumber,endColumn:Q})!==G.completion.insertText};Event$1.once(this.model.onDidTrigger)(G=>{const Z=[];Event$1.any(this.model.onDidTrigger,this.model.onDidCancel)(()=>{dispose(Z),V()},void 0,Z),this.model.onDidSuggest(({completionModel:X})=>{if(dispose(Z),X.items.length===0){V();return}const Q=this._memoryService.select(this.editor.getModel(),this.editor.getPosition(),X.items),J=X.items[Q];if(!U(J)){V();return}this.editor.pushUndoStop(),this._insertSuggestion({index:Q,item:J,model:X},7)},void 0,Z)}),this.model.trigger({auto:!1,shy:!0}),this.editor.revealPosition(W,0),this.editor.focus()}acceptSelectedSuggestion(C,W){const V=this.widget.value.getFocusedItem();let U=0;C&&(U|=4),W&&(U|=8),this._insertSuggestion(V,U)}acceptNextSuggestion(){this._alternatives.value.next()}acceptPrevSuggestion(){this._alternatives.value.prev()}cancelSuggestWidget(){this.model.cancel(),this.model.clear(),this.widget.value.hideWidget()}focusSuggestion(){this.widget.value.focusSelected()}selectNextSuggestion(){this.widget.value.selectNext()}selectNextPageSuggestion(){this.widget.value.selectNextPage()}selectLastSuggestion(){this.widget.value.selectLast()}selectPrevSuggestion(){this.widget.value.selectPrevious()}selectPrevPageSuggestion(){this.widget.value.selectPreviousPage()}selectFirstSuggestion(){this.widget.value.selectFirst()}toggleSuggestionDetails(){this.widget.value.toggleDetails()}toggleExplainMode(){this.widget.value.toggleExplainMode()}toggleSuggestionFocus(){this.widget.value.toggleDetailsFocus()}resetWidgetSize(){this.widget.value.resetPersistedSize()}forceRenderingAbove(){this.widget.value.forceRenderingAbove()}stopForceRenderingAbove(){this.widget.isInitialized&&this.widget.value.stopForceRenderingAbove()}registerSelector(C){return this._selectors.register(C)}};SuggestController.ID="editor.contrib.suggestController";SuggestController=SuggestController_1=__decorate$y([__param$y(1,ISuggestMemoryService),__param$y(2,ICommandService),__param$y(3,IContextKeyService),__param$y(4,IInstantiationService),__param$y(5,ILogService),__param$y(6,ITelemetryService)],SuggestController);class PriorityRegistry{constructor(C){this.prioritySelector=C,this._items=new Array}register(C){if(this._items.indexOf(C)!==-1)throw new Error("Value is already registered");return this._items.push(C),this._items.sort((W,V)=>this.prioritySelector(V)-this.prioritySelector(W)),{dispose:()=>{const W=this._items.indexOf(C);W>=0&&this._items.splice(W,1)}}}get itemsOrderedByPriorityDesc(){return this._items}}class TriggerSuggestAction extends EditorAction{constructor(){super({id:TriggerSuggestAction.id,label:localize("suggest.trigger.label","Trigger Suggest"),alias:"Trigger Suggest",precondition:ContextKeyExpr.and(EditorContextKeys.writable,EditorContextKeys.hasCompletionItemProvider,Context$1.Visible.toNegated()),kbOpts:{kbExpr:EditorContextKeys.textInputFocus,primary:2058,secondary:[2087],mac:{primary:266,secondary:[521,2087]},weight:100}})}run(C,W,V){const U=SuggestController.get(W);if(!U)return;let G;V&&typeof V=="object"&&V.auto===!0&&(G=!0),U.triggerSuggest(void 0,G,void 0)}}TriggerSuggestAction.id="editor.action.triggerSuggest";registerEditorContribution(SuggestController.ID,SuggestController,2);registerEditorAction(TriggerSuggestAction);const weight$2=100+90,SuggestCommand=EditorCommand.bindToContribution(SuggestController.get);registerEditorCommand(new SuggestCommand({id:"acceptSelectedSuggestion",precondition:ContextKeyExpr.and(Context$1.Visible,Context$1.HasFocusedSuggestion),handler(K){K.acceptSelectedSuggestion(!0,!1)},kbOpts:[{primary:2,kbExpr:ContextKeyExpr.and(Context$1.Visible,EditorContextKeys.textInputFocus),weight:weight$2},{primary:3,kbExpr:ContextKeyExpr.and(Context$1.Visible,EditorContextKeys.textInputFocus,Context$1.AcceptSuggestionsOnEnter,Context$1.MakesTextEdit),weight:weight$2}],menuOpts:[{menuId:suggestWidgetStatusbarMenu,title:localize("accept.insert","Insert"),group:"left",order:1,when:Context$1.HasInsertAndReplaceRange.toNegated()},{menuId:suggestWidgetStatusbarMenu,title:localize("accept.insert","Insert"),group:"left",order:1,when:ContextKeyExpr.and(Context$1.HasInsertAndReplaceRange,Context$1.InsertMode.isEqualTo("insert"))},{menuId:suggestWidgetStatusbarMenu,title:localize("accept.replace","Replace"),group:"left",order:1,when:ContextKeyExpr.and(Context$1.HasInsertAndReplaceRange,Context$1.InsertMode.isEqualTo("replace"))}]}));registerEditorCommand(new SuggestCommand({id:"acceptAlternativeSelectedSuggestion",precondition:ContextKeyExpr.and(Context$1.Visible,EditorContextKeys.textInputFocus,Context$1.HasFocusedSuggestion),kbOpts:{weight:weight$2,kbExpr:EditorContextKeys.textInputFocus,primary:1027,secondary:[1026]},handler(K){K.acceptSelectedSuggestion(!1,!0)},menuOpts:[{menuId:suggestWidgetStatusbarMenu,group:"left",order:2,when:ContextKeyExpr.and(Context$1.HasInsertAndReplaceRange,Context$1.InsertMode.isEqualTo("insert")),title:localize("accept.replace","Replace")},{menuId:suggestWidgetStatusbarMenu,group:"left",order:2,when:ContextKeyExpr.and(Context$1.HasInsertAndReplaceRange,Context$1.InsertMode.isEqualTo("replace")),title:localize("accept.insert","Insert")}]}));CommandsRegistry.registerCommandAlias("acceptSelectedSuggestionOnEnter","acceptSelectedSuggestion");registerEditorCommand(new SuggestCommand({id:"hideSuggestWidget",precondition:Context$1.Visible,handler:K=>K.cancelSuggestWidget(),kbOpts:{weight:weight$2,kbExpr:EditorContextKeys.textInputFocus,primary:9,secondary:[1033]}}));registerEditorCommand(new SuggestCommand({id:"selectNextSuggestion",precondition:ContextKeyExpr.and(Context$1.Visible,ContextKeyExpr.or(Context$1.MultipleSuggestions,Context$1.HasFocusedSuggestion.negate())),handler:K=>K.selectNextSuggestion(),kbOpts:{weight:weight$2,kbExpr:EditorContextKeys.textInputFocus,primary:18,secondary:[2066],mac:{primary:18,secondary:[2066,300]}}}));registerEditorCommand(new SuggestCommand({id:"selectNextPageSuggestion",precondition:ContextKeyExpr.and(Context$1.Visible,ContextKeyExpr.or(Context$1.MultipleSuggestions,Context$1.HasFocusedSuggestion.negate())),handler:K=>K.selectNextPageSuggestion(),kbOpts:{weight:weight$2,kbExpr:EditorContextKeys.textInputFocus,primary:12,secondary:[2060]}}));registerEditorCommand(new SuggestCommand({id:"selectLastSuggestion",precondition:ContextKeyExpr.and(Context$1.Visible,ContextKeyExpr.or(Context$1.MultipleSuggestions,Context$1.HasFocusedSuggestion.negate())),handler:K=>K.selectLastSuggestion()}));registerEditorCommand(new SuggestCommand({id:"selectPrevSuggestion",precondition:ContextKeyExpr.and(Context$1.Visible,ContextKeyExpr.or(Context$1.MultipleSuggestions,Context$1.HasFocusedSuggestion.negate())),handler:K=>K.selectPrevSuggestion(),kbOpts:{weight:weight$2,kbExpr:EditorContextKeys.textInputFocus,primary:16,secondary:[2064],mac:{primary:16,secondary:[2064,302]}}}));registerEditorCommand(new SuggestCommand({id:"selectPrevPageSuggestion",precondition:ContextKeyExpr.and(Context$1.Visible,ContextKeyExpr.or(Context$1.MultipleSuggestions,Context$1.HasFocusedSuggestion.negate())),handler:K=>K.selectPrevPageSuggestion(),kbOpts:{weight:weight$2,kbExpr:EditorContextKeys.textInputFocus,primary:11,secondary:[2059]}}));registerEditorCommand(new SuggestCommand({id:"selectFirstSuggestion",precondition:ContextKeyExpr.and(Context$1.Visible,ContextKeyExpr.or(Context$1.MultipleSuggestions,Context$1.HasFocusedSuggestion.negate())),handler:K=>K.selectFirstSuggestion()}));registerEditorCommand(new SuggestCommand({id:"focusSuggestion",precondition:ContextKeyExpr.and(Context$1.Visible,Context$1.HasFocusedSuggestion.negate()),handler:K=>K.focusSuggestion(),kbOpts:{weight:weight$2,kbExpr:EditorContextKeys.textInputFocus,primary:2058,secondary:[2087],mac:{primary:266,secondary:[2087]}}}));registerEditorCommand(new SuggestCommand({id:"focusAndAcceptSuggestion",precondition:ContextKeyExpr.and(Context$1.Visible,Context$1.HasFocusedSuggestion.negate()),handler:K=>{K.focusSuggestion(),K.acceptSelectedSuggestion(!0,!1)}}));registerEditorCommand(new SuggestCommand({id:"toggleSuggestionDetails",precondition:ContextKeyExpr.and(Context$1.Visible,Context$1.HasFocusedSuggestion),handler:K=>K.toggleSuggestionDetails(),kbOpts:{weight:weight$2,kbExpr:EditorContextKeys.textInputFocus,primary:2058,secondary:[2087],mac:{primary:266,secondary:[2087]}},menuOpts:[{menuId:suggestWidgetStatusbarMenu,group:"right",order:1,when:ContextKeyExpr.and(Context$1.DetailsVisible,Context$1.CanResolve),title:localize("detail.more","show less")},{menuId:suggestWidgetStatusbarMenu,group:"right",order:1,when:ContextKeyExpr.and(Context$1.DetailsVisible.toNegated(),Context$1.CanResolve),title:localize("detail.less","show more")}]}));registerEditorCommand(new SuggestCommand({id:"toggleExplainMode",precondition:Context$1.Visible,handler:K=>K.toggleExplainMode(),kbOpts:{weight:100,primary:2138}}));registerEditorCommand(new SuggestCommand({id:"toggleSuggestionFocus",precondition:Context$1.Visible,handler:K=>K.toggleSuggestionFocus(),kbOpts:{weight:weight$2,kbExpr:EditorContextKeys.textInputFocus,primary:2570,mac:{primary:778}}}));registerEditorCommand(new SuggestCommand({id:"insertBestCompletion",precondition:ContextKeyExpr.and(EditorContextKeys.textInputFocus,ContextKeyExpr.equals("config.editor.tabCompletion","on"),WordContextKey.AtEnd,Context$1.Visible.toNegated(),SuggestAlternatives.OtherSuggestions.toNegated(),SnippetController2.InSnippetMode.toNegated()),handler:(K,C)=>{K.triggerSuggestAndAcceptBest(isObject$2(C)?Object.assign({fallback:"tab"},C):{fallback:"tab"})},kbOpts:{weight:weight$2,primary:2}}));registerEditorCommand(new SuggestCommand({id:"insertNextSuggestion",precondition:ContextKeyExpr.and(EditorContextKeys.textInputFocus,ContextKeyExpr.equals("config.editor.tabCompletion","on"),SuggestAlternatives.OtherSuggestions,Context$1.Visible.toNegated(),SnippetController2.InSnippetMode.toNegated()),handler:K=>K.acceptNextSuggestion(),kbOpts:{weight:weight$2,kbExpr:EditorContextKeys.textInputFocus,primary:2}}));registerEditorCommand(new SuggestCommand({id:"insertPrevSuggestion",precondition:ContextKeyExpr.and(EditorContextKeys.textInputFocus,ContextKeyExpr.equals("config.editor.tabCompletion","on"),SuggestAlternatives.OtherSuggestions,Context$1.Visible.toNegated(),SnippetController2.InSnippetMode.toNegated()),handler:K=>K.acceptPrevSuggestion(),kbOpts:{weight:weight$2,kbExpr:EditorContextKeys.textInputFocus,primary:1026}}));registerEditorAction(class extends EditorAction{constructor(){super({id:"editor.action.resetSuggestSize",label:localize("suggest.reset.label","Reset Suggest Widget Size"),alias:"Reset Suggest Widget Size",precondition:void 0})}run(K,C){var W;(W=SuggestController.get(C))===null||W===void 0||W.resetWidgetSize()}});class SuggestWidgetAdaptor extends Disposable{get selectedItem(){return this._selectedItem}constructor(C,W,V,U){super(),this.editor=C,this.suggestControllerPreselector=W,this.checkModelVersion=V,this.onWillAccept=U,this.isSuggestWidgetVisible=!1,this.isShiftKeyPressed=!1,this._isActive=!1,this._currentSuggestItemInfo=void 0,this._selectedItem=observableValue(this,void 0),this._register(C.onKeyDown(Z=>{Z.shiftKey&&!this.isShiftKeyPressed&&(this.isShiftKeyPressed=!0,this.update(this._isActive))})),this._register(C.onKeyUp(Z=>{Z.shiftKey&&this.isShiftKeyPressed&&(this.isShiftKeyPressed=!1,this.update(this._isActive))}));const G=SuggestController.get(this.editor);if(G){this._register(G.registerSelector({priority:100,select:(Q,J,ee)=>{var te;transaction(se=>this.checkModelVersion(se));const ie=this.editor.getModel();if(!ie)return-1;const ne=(te=this.suggestControllerPreselector())===null||te===void 0?void 0:te.removeCommonPrefix(ie);if(!ne)return-1;const oe=Position$1.lift(J),re=ee.map((se,le)=>{const de=SuggestItemInfo.fromSuggestion(G,ie,oe,se,this.isShiftKeyPressed).toSingleTextEdit().removeCommonPrefix(ie),ue=ne.augments(de);return{index:le,valid:ue,prefixLength:de.text.length,suggestItem:se}}).filter(se=>se&&se.valid&&se.prefixLength>0),ae=findFirstMaxBy(re,compareBy(se=>se.prefixLength,numberComparator));return ae?ae.index:-1}}));let Z=!1;const X=()=>{Z||(Z=!0,this._register(G.widget.value.onDidShow(()=>{this.isSuggestWidgetVisible=!0,this.update(!0)})),this._register(G.widget.value.onDidHide(()=>{this.isSuggestWidgetVisible=!1,this.update(!1)})),this._register(G.widget.value.onDidFocus(()=>{this.isSuggestWidgetVisible=!0,this.update(!0)})))};this._register(Event$1.once(G.model.onDidTrigger)(Q=>{X()})),this._register(G.onWillInsertSuggestItem(Q=>{const J=this.editor.getPosition(),ee=this.editor.getModel();if(!J||!ee)return;const te=SuggestItemInfo.fromSuggestion(G,ee,J,Q.item,this.isShiftKeyPressed);this.onWillAccept(te)}))}this.update(this._isActive)}update(C){const W=this.getSuggestItemInfo();(this._isActive!==C||!suggestItemInfoEquals(this._currentSuggestItemInfo,W))&&(this._isActive=C,this._currentSuggestItemInfo=W,transaction(V=>{this.checkModelVersion(V),this._selectedItem.set(this._isActive?this._currentSuggestItemInfo:void 0,V)}))}getSuggestItemInfo(){const C=SuggestController.get(this.editor);if(!C||!this.isSuggestWidgetVisible)return;const W=C.widget.value.getFocusedItem(),V=this.editor.getPosition(),U=this.editor.getModel();if(!(!W||!V||!U))return SuggestItemInfo.fromSuggestion(C,U,V,W.item,this.isShiftKeyPressed)}stopForceRenderingAbove(){const C=SuggestController.get(this.editor);C==null||C.stopForceRenderingAbove()}forceRenderingAbove(){const C=SuggestController.get(this.editor);C==null||C.forceRenderingAbove()}}class SuggestItemInfo{static fromSuggestion(C,W,V,U,G){let{insertText:Z}=U.completion,X=!1;if(U.completion.insertTextRules&4){const J=new SnippetParser().parse(Z);J.children.length<100&&SnippetSession.adjustWhitespace(W,V,!0,J),Z=J.toString(),X=!0}const Q=C.getOverwriteInfo(U,G);return new SuggestItemInfo(Range$2.fromPositions(V.delta(0,-Q.overwriteBefore),V.delta(0,Math.max(Q.overwriteAfter,0))),Z,U.completion.kind,X)}constructor(C,W,V,U){this.range=C,this.insertText=W,this.completionItemKind=V,this.isSnippetText=U}equals(C){return this.range.equalsRange(C.range)&&this.insertText===C.insertText&&this.completionItemKind===C.completionItemKind&&this.isSnippetText===C.isSnippetText}toSelectedSuggestionInfo(){return new SelectedSuggestionInfo(this.range,this.insertText,this.completionItemKind,this.isSnippetText)}toSingleTextEdit(){return new SingleTextEdit(this.range,this.insertText)}}function suggestItemInfoEquals(K,C){return K===C?!0:!K||!C?!1:K.equals(C)}var __decorate$x=globalThis&&globalThis.__decorate||function(K,C,W,V){var U=arguments.length,G=U<3?C:V===null?V=Object.getOwnPropertyDescriptor(C,W):V,Z;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")G=Reflect.decorate(K,C,W,V);else for(var X=K.length-1;X>=0;X--)(Z=K[X])&&(G=(U<3?Z(G):U>3?Z(C,W,G):Z(C,W))||G);return U>3&&G&&Object.defineProperty(C,W,G),G},__param$x=globalThis&&globalThis.__param||function(K,C){return function(W,V){C(W,V,K)}},InlineCompletionsController_1;let InlineCompletionsController=InlineCompletionsController_1=class extends Disposable{static get(C){return C.getContribution(InlineCompletionsController_1.ID)}constructor(C,W,V,U,G,Z,X,Q,J){super(),this.editor=C,this.instantiationService=W,this.contextKeyService=V,this.configurationService=U,this.commandService=G,this.debounceService=Z,this.languageFeaturesService=X,this.audioCueService=Q,this._keybindingService=J,this.model=disposableObservableValue("inlineCompletionModel",void 0),this.textModelVersionId=observableValue(this,-1),this.cursorPosition=observableValue(this,new Position$1(1,1)),this.suggestWidgetAdaptor=this._register(new SuggestWidgetAdaptor(this.editor,()=>{var ie,ne;return(ne=(ie=this.model.get())===null||ie===void 0?void 0:ie.selectedInlineCompletion.get())===null||ne===void 0?void 0:ne.toSingleTextEdit(void 0)},ie=>this.updateObservables(ie,VersionIdChangeReason.Other),ie=>{transaction(ne=>{var oe;this.updateObservables(ne,VersionIdChangeReason.Other),(oe=this.model.get())===null||oe===void 0||oe.handleSuggestAccepted(ie)})})),this._enabled=observableFromEvent(this.editor.onDidChangeConfiguration,()=>this.editor.getOption(62).enabled),this.ghostTextWidget=this._register(this.instantiationService.createInstance(GhostTextWidget,this.editor,{ghostText:this.model.map((ie,ne)=>ie==null?void 0:ie.ghostText.read(ne)),minReservedLineCount:constObservable(0),targetTextModel:this.model.map(ie=>ie==null?void 0:ie.textModel)})),this._debounceValue=this.debounceService.for(this.languageFeaturesService.inlineCompletionsProvider,"InlineCompletionsDebounce",{min:50,max:50}),this._register(new InlineCompletionContextKeys(this.contextKeyService,this.model)),this._register(Event$1.runAndSubscribe(C.onDidChangeModel,()=>transaction(ie=>{this.model.set(void 0,ie),this.updateObservables(ie,VersionIdChangeReason.Other);const ne=C.getModel();if(ne){const oe=W.createInstance(InlineCompletionsModel,ne,this.suggestWidgetAdaptor.selectedItem,this.cursorPosition,this.textModelVersionId,this._debounceValue,observableFromEvent(C.onDidChangeConfiguration,()=>C.getOption(117).preview),observableFromEvent(C.onDidChangeConfiguration,()=>C.getOption(117).previewMode),observableFromEvent(C.onDidChangeConfiguration,()=>C.getOption(62).mode),this._enabled);this.model.set(oe,ie)}})));const ee=ie=>{var ne;return ie.isUndoing?VersionIdChangeReason.Undo:ie.isRedoing?VersionIdChangeReason.Redo:!((ne=this.model.get())===null||ne===void 0)&&ne.isAcceptingPartially?VersionIdChangeReason.AcceptWord:VersionIdChangeReason.Other};this._register(C.onDidChangeModelContent(ie=>transaction(ne=>this.updateObservables(ne,ee(ie))))),this._register(C.onDidChangeCursorPosition(ie=>transaction(ne=>{var oe;this.updateObservables(ne,VersionIdChangeReason.Other),(ie.reason===3||ie.source==="api")&&((oe=this.model.get())===null||oe===void 0||oe.stop(ne))}))),this._register(C.onDidType(()=>transaction(ie=>{var ne;this.updateObservables(ie,VersionIdChangeReason.Other),this._enabled.get()&&((ne=this.model.get())===null||ne===void 0||ne.trigger(ie))}))),this._register(this.commandService.onDidExecuteCommand(ie=>{new Set([CoreEditingCommands.Tab.id,CoreEditingCommands.DeleteLeft.id,CoreEditingCommands.DeleteRight.id,inlineSuggestCommitId,"acceptSelectedSuggestion"]).has(ie.commandId)&&C.hasTextFocus()&&this._enabled.get()&&transaction(oe=>{var re;(re=this.model.get())===null||re===void 0||re.trigger(oe)})})),this._register(this.editor.onDidBlurEditorWidget(()=>{this.contextKeyService.getContextKeyValue("accessibleViewIsShown")||this.configurationService.getValue("editor.inlineSuggest.keepOnBlur")||C.getOption(62).keepOnBlur||InlineSuggestionHintsContentWidget.dropDownVisible||transaction(ie=>{var ne;(ne=this.model.get())===null||ne===void 0||ne.stop(ie)})})),this._register(autorun(ie=>{var ne;const oe=(ne=this.model.read(ie))===null||ne===void 0?void 0:ne.state.read(ie);oe!=null&&oe.suggestItem?oe.ghostText.lineCount>=2&&this.suggestWidgetAdaptor.forceRenderingAbove():this.suggestWidgetAdaptor.stopForceRenderingAbove()})),this._register(toDisposable(()=>{this.suggestWidgetAdaptor.stopForceRenderingAbove()}));let te;this._register(autorun(ie=>{const ne=this.model.read(ie),oe=ne==null?void 0:ne.state.read(ie);if(!ne||!oe||!oe.inlineCompletion){te=void 0;return}if(oe.inlineCompletion.semanticId!==te){te=oe.inlineCompletion.semanticId;const re=ne.textModel.getLineContent(oe.ghostText.lineNumber);this.audioCueService.playAudioCue(AudioCue.inlineSuggestion).then(()=>{this.editor.getOption(8)&&this.provideScreenReaderUpdate(oe.ghostText.renderForScreenReader(re))})}})),this._register(new InlineCompletionsHintsWidget(this.editor,this.model,this.instantiationService)),this._register(this.configurationService.onDidChangeConfiguration(ie=>{ie.affectsConfiguration("accessibility.verbosity.inlineCompletions")&&this.editor.updateOptions({inlineCompletionsAccessibilityVerbose:this.configurationService.getValue("accessibility.verbosity.inlineCompletions")})})),this.editor.updateOptions({inlineCompletionsAccessibilityVerbose:this.configurationService.getValue("accessibility.verbosity.inlineCompletions")})}provideScreenReaderUpdate(C){const W=this.contextKeyService.getContextKeyValue("accessibleViewIsShown"),V=this._keybindingService.lookupKeybinding("editor.action.accessibleView");let U;!W&&V&&this.editor.getOption(147)&&(U=localize("showAccessibleViewHint","Inspect this in the accessible view ({0})",V.getAriaLabel())),alert(U?C+", "+U:C)}updateObservables(C,W){var V,U;const G=this.editor.getModel();this.textModelVersionId.set((V=G==null?void 0:G.getVersionId())!==null&&V!==void 0?V:-1,C,W),this.cursorPosition.set((U=this.editor.getPosition())!==null&&U!==void 0?U:new Position$1(1,1),C)}shouldShowHoverAt(C){var W;const V=(W=this.model.get())===null||W===void 0?void 0:W.ghostText.get();return V?V.parts.some(U=>C.containsPosition(new Position$1(V.lineNumber,U.column))):!1}shouldShowHoverAtViewZone(C){return this.ghostTextWidget.ownsViewZone(C)}};InlineCompletionsController.ID="editor.contrib.inlineCompletionsController";InlineCompletionsController=InlineCompletionsController_1=__decorate$x([__param$x(1,IInstantiationService),__param$x(2,IContextKeyService),__param$x(3,IConfigurationService),__param$x(4,ICommandService),__param$x(5,ILanguageFeatureDebounceService),__param$x(6,ILanguageFeaturesService),__param$x(7,IAudioCueService),__param$x(8,IKeybindingService)],InlineCompletionsController);var __awaiter$o=globalThis&&globalThis.__awaiter||function(K,C,W,V){function U(G){return G instanceof W?G:new W(function(Z){Z(G)})}return new(W||(W=Promise))(function(G,Z){function X(ee){try{J(V.next(ee))}catch(te){Z(te)}}function Q(ee){try{J(V.throw(ee))}catch(te){Z(te)}}function J(ee){ee.done?G(ee.value):U(ee.value).then(X,Q)}J((V=V.apply(K,C||[])).next())})};class ShowNextInlineSuggestionAction extends EditorAction{constructor(){super({id:ShowNextInlineSuggestionAction.ID,label:localize("action.inlineSuggest.showNext","Show Next Inline Suggestion"),alias:"Show Next Inline Suggestion",precondition:ContextKeyExpr.and(EditorContextKeys.writable,InlineCompletionContextKeys.inlineSuggestionVisible),kbOpts:{weight:100,primary:606}})}run(C,W){var V;return __awaiter$o(this,void 0,void 0,function*(){const U=InlineCompletionsController.get(W);(V=U==null?void 0:U.model.get())===null||V===void 0||V.next()})}}ShowNextInlineSuggestionAction.ID=showNextInlineSuggestionActionId;class ShowPreviousInlineSuggestionAction extends EditorAction{constructor(){super({id:ShowPreviousInlineSuggestionAction.ID,label:localize("action.inlineSuggest.showPrevious","Show Previous Inline Suggestion"),alias:"Show Previous Inline Suggestion",precondition:ContextKeyExpr.and(EditorContextKeys.writable,InlineCompletionContextKeys.inlineSuggestionVisible),kbOpts:{weight:100,primary:604}})}run(C,W){var V;return __awaiter$o(this,void 0,void 0,function*(){const U=InlineCompletionsController.get(W);(V=U==null?void 0:U.model.get())===null||V===void 0||V.previous()})}}ShowPreviousInlineSuggestionAction.ID=showPreviousInlineSuggestionActionId;class TriggerInlineSuggestionAction extends EditorAction{constructor(){super({id:"editor.action.inlineSuggest.trigger",label:localize("action.inlineSuggest.trigger","Trigger Inline Suggestion"),alias:"Trigger Inline Suggestion",precondition:EditorContextKeys.writable})}run(C,W){var V;return __awaiter$o(this,void 0,void 0,function*(){const U=InlineCompletionsController.get(W);(V=U==null?void 0:U.model.get())===null||V===void 0||V.triggerExplicitly()})}}class AcceptNextWordOfInlineCompletion extends EditorAction{constructor(){super({id:"editor.action.inlineSuggest.acceptNextWord",label:localize("action.inlineSuggest.acceptNextWord","Accept Next Word Of Inline Suggestion"),alias:"Accept Next Word Of Inline Suggestion",precondition:ContextKeyExpr.and(EditorContextKeys.writable,InlineCompletionContextKeys.inlineSuggestionVisible),kbOpts:{weight:100+1,primary:2065,kbExpr:ContextKeyExpr.and(EditorContextKeys.writable,InlineCompletionContextKeys.inlineSuggestionVisible)},menuOpts:[{menuId:MenuId.InlineSuggestionToolbar,title:localize("acceptWord","Accept Word"),group:"primary",order:2}]})}run(C,W){var V;return __awaiter$o(this,void 0,void 0,function*(){const U=InlineCompletionsController.get(W);yield(V=U==null?void 0:U.model.get())===null||V===void 0?void 0:V.acceptNextWord(U.editor)})}}class AcceptNextLineOfInlineCompletion extends EditorAction{constructor(){super({id:"editor.action.inlineSuggest.acceptNextLine",label:localize("action.inlineSuggest.acceptNextLine","Accept Next Line Of Inline Suggestion"),alias:"Accept Next Line Of Inline Suggestion",precondition:ContextKeyExpr.and(EditorContextKeys.writable,InlineCompletionContextKeys.inlineSuggestionVisible),kbOpts:{weight:100+1},menuOpts:[{menuId:MenuId.InlineSuggestionToolbar,title:localize("acceptLine","Accept Line"),group:"secondary",order:2}]})}run(C,W){var V;return __awaiter$o(this,void 0,void 0,function*(){const U=InlineCompletionsController.get(W);yield(V=U==null?void 0:U.model.get())===null||V===void 0?void 0:V.acceptNextLine(U.editor)})}}class AcceptInlineCompletion extends EditorAction{constructor(){super({id:inlineSuggestCommitId,label:localize("action.inlineSuggest.accept","Accept Inline Suggestion"),alias:"Accept Inline Suggestion",precondition:InlineCompletionContextKeys.inlineSuggestionVisible,menuOpts:[{menuId:MenuId.InlineSuggestionToolbar,title:localize("accept","Accept"),group:"primary",order:1}],kbOpts:{primary:2,weight:200,kbExpr:ContextKeyExpr.and(InlineCompletionContextKeys.inlineSuggestionVisible,EditorContextKeys.tabMovesFocus.toNegated(),InlineCompletionContextKeys.inlineSuggestionHasIndentationLessThanTabSize,Context$1.Visible.toNegated(),EditorContextKeys.hoverFocused.toNegated())}})}run(C,W){var V;return __awaiter$o(this,void 0,void 0,function*(){const U=InlineCompletionsController.get(W);U&&((V=U.model.get())===null||V===void 0||V.accept(U.editor),U.editor.focus())})}}class HideInlineCompletion extends EditorAction{constructor(){super({id:HideInlineCompletion.ID,label:localize("action.inlineSuggest.hide","Hide Inline Suggestion"),alias:"Hide Inline Suggestion",precondition:InlineCompletionContextKeys.inlineSuggestionVisible,kbOpts:{weight:100,primary:9}})}run(C,W){return __awaiter$o(this,void 0,void 0,function*(){const V=InlineCompletionsController.get(W);transaction(U=>{var G;(G=V==null?void 0:V.model.get())===null||G===void 0||G.stop(U)})})}}HideInlineCompletion.ID="editor.action.inlineSuggest.hide";class ToggleAlwaysShowInlineSuggestionToolbar extends Action2{constructor(){super({id:ToggleAlwaysShowInlineSuggestionToolbar.ID,title:localize("action.inlineSuggest.alwaysShowToolbar","Always Show Toolbar"),f1:!1,precondition:void 0,menu:[{id:MenuId.InlineSuggestionToolbar,group:"secondary",order:10}],toggled:ContextKeyExpr.equals("config.editor.inlineSuggest.showToolbar","always")})}run(C,W){return __awaiter$o(this,void 0,void 0,function*(){const V=C.get(IConfigurationService),G=V.getValue("editor.inlineSuggest.showToolbar")==="always"?"onHover":"always";V.updateValue("editor.inlineSuggest.showToolbar",G)})}}ToggleAlwaysShowInlineSuggestionToolbar.ID="editor.action.inlineSuggest.toggleAlwaysShowToolbar";var __decorate$w=globalThis&&globalThis.__decorate||function(K,C,W,V){var U=arguments.length,G=U<3?C:V===null?V=Object.getOwnPropertyDescriptor(C,W):V,Z;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")G=Reflect.decorate(K,C,W,V);else for(var X=K.length-1;X>=0;X--)(Z=K[X])&&(G=(U<3?Z(G):U>3?Z(C,W,G):Z(C,W))||G);return U>3&&G&&Object.defineProperty(C,W,G),G},__param$w=globalThis&&globalThis.__param||function(K,C){return function(W,V){C(W,V,K)}};class InlineCompletionsHover{constructor(C,W,V){this.owner=C,this.range=W,this.controller=V}isValidForHoverAnchor(C){return C.type===1&&this.range.startColumn<=C.range.startColumn&&this.range.endColumn>=C.range.endColumn}}let InlineCompletionsHoverParticipant=class{constructor(C,W,V,U,G,Z){this._editor=C,this._languageService=W,this._openerService=V,this.accessibilityService=U,this._instantiationService=G,this._telemetryService=Z,this.hoverOrdinal=4}suggestHoverAnchor(C){const W=InlineCompletionsController.get(this._editor);if(!W)return null;const V=C.target;if(V.type===8){const U=V.detail;if(W.shouldShowHoverAtViewZone(U.viewZoneId))return new HoverForeignElementAnchor(1e3,this,Range$2.fromPositions(this._editor.getModel().validatePosition(U.positionBefore||U.position)),C.event.posx,C.event.posy,!1)}return V.type===7&&W.shouldShowHoverAt(V.range)?new HoverForeignElementAnchor(1e3,this,V.range,C.event.posx,C.event.posy,!1):V.type===6&&V.detail.mightBeForeignElement&&W.shouldShowHoverAt(V.range)?new HoverForeignElementAnchor(1e3,this,V.range,C.event.posx,C.event.posy,!1):null}computeSync(C,W){if(this._editor.getOption(62).showToolbar==="always")return[];const V=InlineCompletionsController.get(this._editor);return V&&V.shouldShowHoverAt(C.range)?[new InlineCompletionsHover(this,C.range,V)]:[]}renderHoverParts(C,W){const V=new DisposableStore,U=W[0];this._telemetryService.publicLog2("inlineCompletionHover.shown"),this.accessibilityService.isScreenReaderOptimized()&&!this._editor.getOption(8)&&this.renderScreenReaderText(C,U,V);const G=U.controller.model.get(),Z=this._instantiationService.createInstance(InlineSuggestionHintsContentWidget,this._editor,!1,constObservable(null),G.selectedInlineCompletionIndex,G.inlineCompletionsCount,G.selectedInlineCompletion.map(X=>{var Q;return(Q=X==null?void 0:X.inlineCompletion.source.inlineCompletions.commands)!==null&&Q!==void 0?Q:[]}));return C.fragment.appendChild(Z.getDomNode()),G.triggerExplicitly(),V.add(Z),V}renderScreenReaderText(C,W,V){const U=$$d,G=U("div.hover-row.markdown-hover"),Z=append$3(G,U("div.hover-contents",{"aria-live":"assertive"})),X=V.add(new MarkdownRenderer({editor:this._editor},this._languageService,this._openerService)),Q=J=>{V.add(X.onDidRenderAsync(()=>{Z.className="hover-contents code-hover-contents",C.onContentsChanged()}));const ee=localize("inlineSuggestionFollows","Suggestion:"),te=V.add(X.render(new MarkdownString().appendText(ee).appendCodeblock("text",J)));Z.replaceChildren(te.element)};V.add(autorun(J=>{var ee;const te=(ee=W.controller.model.read(J))===null||ee===void 0?void 0:ee.ghostText.read(J);if(te){const ie=this._editor.getModel().getLineContent(te.lineNumber);Q(te.renderForScreenReader(ie))}else reset(Z)})),C.fragment.appendChild(G)}};InlineCompletionsHoverParticipant=__decorate$w([__param$w(1,ILanguageService),__param$w(2,IOpenerService),__param$w(3,IAccessibilityService),__param$w(4,IInstantiationService),__param$w(5,ITelemetryService)],InlineCompletionsHoverParticipant);registerEditorContribution(InlineCompletionsController.ID,InlineCompletionsController,3);registerEditorAction(TriggerInlineSuggestionAction);registerEditorAction(ShowNextInlineSuggestionAction);registerEditorAction(ShowPreviousInlineSuggestionAction);registerEditorAction(AcceptNextWordOfInlineCompletion);registerEditorAction(AcceptNextLineOfInlineCompletion);registerEditorAction(AcceptInlineCompletion);registerEditorAction(HideInlineCompletion);registerAction2(ToggleAlwaysShowInlineSuggestionToolbar);HoverParticipantRegistry.register(InlineCompletionsHoverParticipant);function getSpaceCnt(K,C){let W=0;for(let V=0;V<K.length;V++)K.charAt(V)==="	"?W+=C:W++;return W}function generateIndent(K,C,W){K=K<0?0:K;let V="";if(!W){const U=Math.floor(K/C);K=K%C;for(let G=0;G<U;G++)V+="	"}for(let U=0;U<K;U++)V+=" ";return V}var __decorate$v=globalThis&&globalThis.__decorate||function(K,C,W,V){var U=arguments.length,G=U<3?C:V===null?V=Object.getOwnPropertyDescriptor(C,W):V,Z;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")G=Reflect.decorate(K,C,W,V);else for(var X=K.length-1;X>=0;X--)(Z=K[X])&&(G=(U<3?Z(G):U>3?Z(C,W,G):Z(C,W))||G);return U>3&&G&&Object.defineProperty(C,W,G),G},__param$v=globalThis&&globalThis.__param||function(K,C){return function(W,V){C(W,V,K)}};function getReindentEditOperations(K,C,W,V,U){if(K.getLineCount()===1&&K.getLineMaxColumn(1)===1)return[];const G=C.getLanguageConfiguration(K.getLanguageId()).indentationRules;if(!G)return[];for(V=Math.min(V,K.getLineCount());W<=V&&G.unIndentedLinePattern;){const ae=K.getLineContent(W);if(!G.unIndentedLinePattern.test(ae))break;W++}if(W>V-1)return[];const{tabSize:Z,indentSize:X,insertSpaces:Q}=K.getOptions(),J=(ae,se)=>(se=se||1,ShiftCommand.shiftIndent(ae,ae.length+se,Z,X,Q)),ee=(ae,se)=>(se=se||1,ShiftCommand.unshiftIndent(ae,ae.length+se,Z,X,Q)),te=[];let ie;const ne=K.getLineContent(W);let oe=ne;if(U!=null){ie=U;const ae=getLeadingWhitespace(ne);oe=ie+ne.substring(ae.length),G.decreaseIndentPattern&&G.decreaseIndentPattern.test(oe)&&(ie=ee(ie),oe=ie+ne.substring(ae.length)),ne!==oe&&te.push(EditOperation.replaceMove(new Selection$1(W,1,W,ae.length+1),normalizeIndentation(ie,X,Q)))}else ie=getLeadingWhitespace(ne);let re=ie;G.increaseIndentPattern&&G.increaseIndentPattern.test(oe)?(re=J(re),ie=J(ie)):G.indentNextLinePattern&&G.indentNextLinePattern.test(oe)&&(re=J(re)),W++;for(let ae=W;ae<=V;ae++){const se=K.getLineContent(ae),le=getLeadingWhitespace(se),ce=re+se.substring(le.length);G.decreaseIndentPattern&&G.decreaseIndentPattern.test(ce)&&(re=ee(re),ie=ee(ie)),le!==re&&te.push(EditOperation.replaceMove(new Selection$1(ae,1,ae,le.length+1),normalizeIndentation(re,X,Q))),!(G.unIndentedLinePattern&&G.unIndentedLinePattern.test(se))&&(G.increaseIndentPattern&&G.increaseIndentPattern.test(ce)?(ie=J(ie),re=ie):G.indentNextLinePattern&&G.indentNextLinePattern.test(ce)?re=J(re):re=ie)}return te}class IndentationToSpacesAction extends EditorAction{constructor(){super({id:IndentationToSpacesAction.ID,label:localize("indentationToSpaces","Convert Indentation to Spaces"),alias:"Convert Indentation to Spaces",precondition:EditorContextKeys.writable})}run(C,W){const V=W.getModel();if(!V)return;const U=V.getOptions(),G=W.getSelection();if(!G)return;const Z=new IndentationToSpacesCommand(G,U.tabSize);W.pushUndoStop(),W.executeCommands(this.id,[Z]),W.pushUndoStop(),V.updateOptions({insertSpaces:!0})}}IndentationToSpacesAction.ID="editor.action.indentationToSpaces";class IndentationToTabsAction extends EditorAction{constructor(){super({id:IndentationToTabsAction.ID,label:localize("indentationToTabs","Convert Indentation to Tabs"),alias:"Convert Indentation to Tabs",precondition:EditorContextKeys.writable})}run(C,W){const V=W.getModel();if(!V)return;const U=V.getOptions(),G=W.getSelection();if(!G)return;const Z=new IndentationToTabsCommand(G,U.tabSize);W.pushUndoStop(),W.executeCommands(this.id,[Z]),W.pushUndoStop(),V.updateOptions({insertSpaces:!1})}}IndentationToTabsAction.ID="editor.action.indentationToTabs";class ChangeIndentationSizeAction extends EditorAction{constructor(C,W,V){super(V),this.insertSpaces=C,this.displaySizeOnly=W}run(C,W){const V=C.get(IQuickInputService),U=C.get(IModelService),G=W.getModel();if(!G)return;const Z=U.getCreationOptions(G.getLanguageId(),G.uri,G.isForSimpleWidget),X=G.getOptions(),Q=[1,2,3,4,5,6,7,8].map(ee=>({id:ee.toString(),label:ee.toString(),description:ee===Z.tabSize&&ee===X.tabSize?localize("configuredTabSize","Configured Tab Size"):ee===Z.tabSize?localize("defaultTabSize","Default Tab Size"):ee===X.tabSize?localize("currentTabSize","Current Tab Size"):void 0})),J=Math.min(G.getOptions().tabSize-1,7);setTimeout(()=>{V.pick(Q,{placeHolder:localize({key:"selectTabWidth",comment:["Tab corresponds to the tab key"]},"Select Tab Size for Current File"),activeItem:Q[J]}).then(ee=>{if(ee&&G&&!G.isDisposed()){const te=parseInt(ee.label,10);this.displaySizeOnly?G.updateOptions({tabSize:te}):G.updateOptions({tabSize:te,indentSize:te,insertSpaces:this.insertSpaces})}})},50)}}class IndentUsingTabs extends ChangeIndentationSizeAction{constructor(){super(!1,!1,{id:IndentUsingTabs.ID,label:localize("indentUsingTabs","Indent Using Tabs"),alias:"Indent Using Tabs",precondition:void 0})}}IndentUsingTabs.ID="editor.action.indentUsingTabs";class IndentUsingSpaces extends ChangeIndentationSizeAction{constructor(){super(!0,!1,{id:IndentUsingSpaces.ID,label:localize("indentUsingSpaces","Indent Using Spaces"),alias:"Indent Using Spaces",precondition:void 0})}}IndentUsingSpaces.ID="editor.action.indentUsingSpaces";class ChangeTabDisplaySize extends ChangeIndentationSizeAction{constructor(){super(!0,!0,{id:ChangeTabDisplaySize.ID,label:localize("changeTabDisplaySize","Change Tab Display Size"),alias:"Change Tab Display Size",precondition:void 0})}}ChangeTabDisplaySize.ID="editor.action.changeTabDisplaySize";class DetectIndentation extends EditorAction{constructor(){super({id:DetectIndentation.ID,label:localize("detectIndentation","Detect Indentation from Content"),alias:"Detect Indentation from Content",precondition:void 0})}run(C,W){const V=C.get(IModelService),U=W.getModel();if(!U)return;const G=V.getCreationOptions(U.getLanguageId(),U.uri,U.isForSimpleWidget);U.detectIndentation(G.insertSpaces,G.tabSize)}}DetectIndentation.ID="editor.action.detectIndentation";class ReindentLinesAction extends EditorAction{constructor(){super({id:"editor.action.reindentlines",label:localize("editor.reindentlines","Reindent Lines"),alias:"Reindent Lines",precondition:EditorContextKeys.writable})}run(C,W){const V=C.get(ILanguageConfigurationService),U=W.getModel();if(!U)return;const G=getReindentEditOperations(U,V,1,U.getLineCount());G.length>0&&(W.pushUndoStop(),W.executeEdits(this.id,G),W.pushUndoStop())}}class ReindentSelectedLinesAction extends EditorAction{constructor(){super({id:"editor.action.reindentselectedlines",label:localize("editor.reindentselectedlines","Reindent Selected Lines"),alias:"Reindent Selected Lines",precondition:EditorContextKeys.writable})}run(C,W){const V=C.get(ILanguageConfigurationService),U=W.getModel();if(!U)return;const G=W.getSelections();if(G===null)return;const Z=[];for(const X of G){let Q=X.startLineNumber,J=X.endLineNumber;if(Q!==J&&X.endColumn===1&&J--,Q===1){if(Q===J)continue}else Q--;const ee=getReindentEditOperations(U,V,Q,J);Z.push(...ee)}Z.length>0&&(W.pushUndoStop(),W.executeEdits(this.id,Z),W.pushUndoStop())}}class AutoIndentOnPasteCommand{constructor(C,W){this._initialSelection=W,this._edits=[],this._selectionId=null;for(const V of C)V.range&&typeof V.text=="string"&&this._edits.push(V)}getEditOperations(C,W){for(const U of this._edits)W.addEditOperation(Range$2.lift(U.range),U.text);let V=!1;Array.isArray(this._edits)&&this._edits.length===1&&this._initialSelection.isEmpty()&&(this._edits[0].range.startColumn===this._initialSelection.endColumn&&this._edits[0].range.startLineNumber===this._initialSelection.endLineNumber?(V=!0,this._selectionId=W.trackSelection(this._initialSelection,!0)):this._edits[0].range.endColumn===this._initialSelection.startColumn&&this._edits[0].range.endLineNumber===this._initialSelection.startLineNumber&&(V=!0,this._selectionId=W.trackSelection(this._initialSelection,!1))),V||(this._selectionId=W.trackSelection(this._initialSelection))}computeCursorState(C,W){return W.getTrackedSelection(this._selectionId)}}let AutoIndentOnPaste=class{constructor(C,W){this.editor=C,this._languageConfigurationService=W,this.callOnDispose=new DisposableStore,this.callOnModel=new DisposableStore,this.callOnDispose.add(C.onDidChangeConfiguration(()=>this.update())),this.callOnDispose.add(C.onDidChangeModel(()=>this.update())),this.callOnDispose.add(C.onDidChangeModelLanguage(()=>this.update()))}update(){this.callOnModel.clear(),!(this.editor.getOption(12)<4||this.editor.getOption(55))&&this.editor.hasModel()&&this.callOnModel.add(this.editor.onDidPaste(({range:C})=>{this.trigger(C)}))}trigger(C){const W=this.editor.getSelections();if(W===null||W.length>1)return;const V=this.editor.getModel();if(!V||!V.tokenization.isCheapToTokenize(C.getStartPosition().lineNumber))return;const U=this.editor.getOption(12),{tabSize:G,indentSize:Z,insertSpaces:X}=V.getOptions(),Q=[],J={shiftIndent:ne=>ShiftCommand.shiftIndent(ne,ne.length+1,G,Z,X),unshiftIndent:ne=>ShiftCommand.unshiftIndent(ne,ne.length+1,G,Z,X)};let ee=C.startLineNumber;for(;ee<=C.endLineNumber;){if(this.shouldIgnoreLine(V,ee)){ee++;continue}break}if(ee>C.endLineNumber)return;let te=V.getLineContent(ee);if(!/\S/.test(te.substring(0,C.startColumn-1))){const ne=getGoodIndentForLine(U,V,V.getLanguageId(),ee,J,this._languageConfigurationService);if(ne!==null){const oe=getLeadingWhitespace(te),re=getSpaceCnt(ne,G),ae=getSpaceCnt(oe,G);if(re!==ae){const se=generateIndent(re,G,X);Q.push({range:new Range$2(ee,1,ee,oe.length+1),text:se}),te=se+te.substr(oe.length)}else{const se=getIndentMetadata(V,ee,this._languageConfigurationService);if(se===0||se===8)return}}}const ie=ee;for(;ee<C.endLineNumber;){if(!/\S/.test(V.getLineContent(ee+1))){ee++;continue}break}if(ee!==C.endLineNumber){const oe=getGoodIndentForLine(U,{tokenization:{getLineTokens:re=>V.tokenization.getLineTokens(re),getLanguageId:()=>V.getLanguageId(),getLanguageIdAtPosition:(re,ae)=>V.getLanguageIdAtPosition(re,ae)},getLineContent:re=>re===ie?te:V.getLineContent(re)},V.getLanguageId(),ee+1,J,this._languageConfigurationService);if(oe!==null){const re=getSpaceCnt(oe,G),ae=getSpaceCnt(getLeadingWhitespace(V.getLineContent(ee+1)),G);if(re!==ae){const se=re-ae;for(let le=ee+1;le<=C.endLineNumber;le++){const ce=V.getLineContent(le),de=getLeadingWhitespace(ce),ge=getSpaceCnt(de,G)+se,he=generateIndent(ge,G,X);he!==de&&Q.push({range:new Range$2(le,1,le,de.length+1),text:he})}}}}if(Q.length>0){this.editor.pushUndoStop();const ne=new AutoIndentOnPasteCommand(Q,this.editor.getSelection());this.editor.executeCommand("autoIndentOnPaste",ne),this.editor.pushUndoStop()}}shouldIgnoreLine(C,W){C.tokenization.forceTokenization(W);const V=C.getLineFirstNonWhitespaceColumn(W);if(V===0)return!0;const U=C.tokenization.getLineTokens(W);if(U.getCount()>0){const G=U.findTokenIndexAtOffset(V);if(G>=0&&U.getStandardTokenType(G)===1)return!0}return!1}dispose(){this.callOnDispose.dispose(),this.callOnModel.dispose()}};AutoIndentOnPaste.ID="editor.contrib.autoIndentOnPaste";AutoIndentOnPaste=__decorate$v([__param$v(1,ILanguageConfigurationService)],AutoIndentOnPaste);function getIndentationEditOperations(K,C,W,V){if(K.getLineCount()===1&&K.getLineMaxColumn(1)===1)return;let U="";for(let Z=0;Z<W;Z++)U+=" ";const G=new RegExp(U,"gi");for(let Z=1,X=K.getLineCount();Z<=X;Z++){let Q=K.getLineFirstNonWhitespaceColumn(Z);if(Q===0&&(Q=K.getLineMaxColumn(Z)),Q===1)continue;const J=new Range$2(Z,1,Z,Q),ee=K.getValueInRange(J),te=V?ee.replace(/\t/ig,U):ee.replace(G,"	");C.addEditOperation(J,te)}}class IndentationToSpacesCommand{constructor(C,W){this.selection=C,this.tabSize=W,this.selectionId=null}getEditOperations(C,W){this.selectionId=W.trackSelection(this.selection),getIndentationEditOperations(C,W,this.tabSize,!0)}computeCursorState(C,W){return W.getTrackedSelection(this.selectionId)}}class IndentationToTabsCommand{constructor(C,W){this.selection=C,this.tabSize=W,this.selectionId=null}getEditOperations(C,W){this.selectionId=W.trackSelection(this.selection),getIndentationEditOperations(C,W,this.tabSize,!1)}computeCursorState(C,W){return W.getTrackedSelection(this.selectionId)}}registerEditorContribution(AutoIndentOnPaste.ID,AutoIndentOnPaste,2);registerEditorAction(IndentationToSpacesAction);registerEditorAction(IndentationToTabsAction);registerEditorAction(IndentUsingTabs);registerEditorAction(IndentUsingSpaces);registerEditorAction(ChangeTabDisplaySize);registerEditorAction(DetectIndentation);registerEditorAction(ReindentLinesAction);registerEditorAction(ReindentSelectedLinesAction);var __awaiter$n=globalThis&&globalThis.__awaiter||function(K,C,W,V){function U(G){return G instanceof W?G:new W(function(Z){Z(G)})}return new(W||(W=Promise))(function(G,Z){function X(ee){try{J(V.next(ee))}catch(te){Z(te)}}function Q(ee){try{J(V.throw(ee))}catch(te){Z(te)}}function J(ee){ee.done?G(ee.value):U(ee.value).then(X,Q)}J((V=V.apply(K,C||[])).next())})};class InlayHintAnchor{constructor(C,W){this.range=C,this.direction=W}}class InlayHintItem{constructor(C,W,V){this.hint=C,this.anchor=W,this.provider=V,this._isResolved=!1}with(C){const W=new InlayHintItem(this.hint,C.anchor,this.provider);return W._isResolved=this._isResolved,W._currentResolve=this._currentResolve,W}resolve(C){return __awaiter$n(this,void 0,void 0,function*(){if(typeof this.provider.resolveInlayHint=="function"){if(this._currentResolve)return yield this._currentResolve,C.isCancellationRequested?void 0:this.resolve(C);this._isResolved||(this._currentResolve=this._doResolve(C).finally(()=>this._currentResolve=void 0)),yield this._currentResolve}})}_doResolve(C){var W,V;return __awaiter$n(this,void 0,void 0,function*(){try{const U=yield Promise.resolve(this.provider.resolveInlayHint(this.hint,C));this.hint.tooltip=(W=U==null?void 0:U.tooltip)!==null&&W!==void 0?W:this.hint.tooltip,this.hint.label=(V=U==null?void 0:U.label)!==null&&V!==void 0?V:this.hint.label,this._isResolved=!0}catch(U){onUnexpectedExternalError(U),this._isResolved=!1}})}}class InlayHintsFragments{static create(C,W,V,U){return __awaiter$n(this,void 0,void 0,function*(){const G=[],Z=C.ordered(W).reverse().map(X=>V.map(Q=>__awaiter$n(this,void 0,void 0,function*(){try{const J=yield X.provideInlayHints(W,Q,U);J!=null&&J.hints.length&&G.push([J,X])}catch(J){onUnexpectedExternalError(J)}})));if(yield Promise.all(Z.flat()),U.isCancellationRequested||W.isDisposed())throw new CancellationError;return new InlayHintsFragments(V,G,W)})}constructor(C,W,V){this._disposables=new DisposableStore,this.ranges=C,this.provider=new Set;const U=[];for(const[G,Z]of W){this._disposables.add(G),this.provider.add(Z);for(const X of G.hints){const Q=V.validatePosition(X.position);let J="before";const ee=InlayHintsFragments._getRangeAtPosition(V,Q);let te;ee.getStartPosition().isBefore(Q)?(te=Range$2.fromPositions(ee.getStartPosition(),Q),J="after"):(te=Range$2.fromPositions(Q,ee.getEndPosition()),J="before"),U.push(new InlayHintItem(X,new InlayHintAnchor(te,J),Z))}}this.items=U.sort((G,Z)=>Position$1.compare(G.hint.position,Z.hint.position))}dispose(){this._disposables.dispose()}static _getRangeAtPosition(C,W){const V=W.lineNumber,U=C.getWordAtPosition(W);if(U)return new Range$2(V,U.startColumn,V,U.endColumn);C.tokenization.tokenizeIfCheap(V);const G=C.tokenization.getLineTokens(V),Z=W.column-1,X=G.findTokenIndexAtOffset(Z);let Q=G.getStartOffset(X),J=G.getEndOffset(X);return J-Q===1&&(Q===Z&&X>1?(Q=G.getStartOffset(X-1),J=G.getEndOffset(X-1)):J===Z&&X<G.getCount()-1&&(Q=G.getStartOffset(X+1),J=G.getEndOffset(X+1))),new Range$2(V,Q+1,V,J+1)}}function asCommandLink(K){return URI.from({scheme:Schemas.command,path:K.id,query:K.arguments&&encodeURIComponent(JSON.stringify(K.arguments))}).toString()}var __awaiter$m=globalThis&&globalThis.__awaiter||function(K,C,W,V){function U(G){return G instanceof W?G:new W(function(Z){Z(G)})}return new(W||(W=Promise))(function(G,Z){function X(ee){try{J(V.next(ee))}catch(te){Z(te)}}function Q(ee){try{J(V.throw(ee))}catch(te){Z(te)}}function J(ee){ee.done?G(ee.value):U(ee.value).then(X,Q)}J((V=V.apply(K,C||[])).next())})};function showGoToContextMenu(K,C,W,V){var U;return __awaiter$m(this,void 0,void 0,function*(){const G=K.get(ITextModelService),Z=K.get(IContextMenuService),X=K.get(ICommandService),Q=K.get(IInstantiationService),J=K.get(INotificationService);if(yield V.item.resolve(CancellationToken.None),!V.part.location)return;const ee=V.part.location,te=[],ie=new Set(MenuRegistry.getMenuItems(MenuId.EditorContext).map(oe=>isIMenuItem(oe)?oe.command.id:generateUuid()));for(const oe of SymbolNavigationAction.all())ie.has(oe.desc.id)&&te.push(new Action(oe.desc.id,MenuItemAction.label(oe.desc,{renderShortTitle:!0}),void 0,!0,()=>__awaiter$m(this,void 0,void 0,function*(){const re=yield G.createModelReference(ee.uri);try{const ae=new SymbolNavigationAnchor(re.object.textEditorModel,Range$2.getStartPosition(ee.range)),se=V.item.anchor.range;yield Q.invokeFunction(oe.runEditorCommand.bind(oe),C,ae,se)}finally{re.dispose()}})));if(V.part.command){const{command:oe}=V.part;te.push(new Separator),te.push(new Action(oe.id,oe.title,void 0,!0,()=>__awaiter$m(this,void 0,void 0,function*(){var re;try{yield X.executeCommand(oe.id,...(re=oe.arguments)!==null&&re!==void 0?re:[])}catch(ae){J.notify({severity:Severity.Error,source:V.item.provider.displayName,message:ae})}})))}const ne=C.getOption(126);Z.showContextMenu({domForShadowRoot:ne&&(U=C.getDomNode())!==null&&U!==void 0?U:void 0,getAnchor:()=>{const oe=getDomNodePagePosition(W);return{x:oe.left,y:oe.top+oe.height+8}},getActions:()=>te,onHide:()=>{C.focus()},autoSelectFirstItem:!0})})}function goToDefinitionWithLocation(K,C,W,V){return __awaiter$m(this,void 0,void 0,function*(){const G=yield K.get(ITextModelService).createModelReference(V.uri);yield W.invokeWithinContext(Z=>__awaiter$m(this,void 0,void 0,function*(){const X=C.hasSideBySideModifier,Q=Z.get(IContextKeyService),J=PeekContext.inPeekEditor.getValue(Q),ee=!X&&W.getOption(87)&&!J;return new DefinitionAction({openToSide:X,openInPeek:ee,muteMessage:!0},{title:{value:"",original:""},id:"",precondition:void 0}).run(Z,new SymbolNavigationAnchor(G.object.textEditorModel,Range$2.getStartPosition(V.range)),Range$2.lift(V.range))})),G.dispose()})}var __decorate$u=globalThis&&globalThis.__decorate||function(K,C,W,V){var U=arguments.length,G=U<3?C:V===null?V=Object.getOwnPropertyDescriptor(C,W):V,Z;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")G=Reflect.decorate(K,C,W,V);else for(var X=K.length-1;X>=0;X--)(Z=K[X])&&(G=(U<3?Z(G):U>3?Z(C,W,G):Z(C,W))||G);return U>3&&G&&Object.defineProperty(C,W,G),G},__param$u=globalThis&&globalThis.__param||function(K,C){return function(W,V){C(W,V,K)}},__awaiter$l=globalThis&&globalThis.__awaiter||function(K,C,W,V){function U(G){return G instanceof W?G:new W(function(Z){Z(G)})}return new(W||(W=Promise))(function(G,Z){function X(ee){try{J(V.next(ee))}catch(te){Z(te)}}function Q(ee){try{J(V.throw(ee))}catch(te){Z(te)}}function J(ee){ee.done?G(ee.value):U(ee.value).then(X,Q)}J((V=V.apply(K,C||[])).next())})},InlayHintsController_1;class InlayHintsCache{constructor(){this._entries=new LRUCache(50)}get(C){const W=InlayHintsCache._key(C);return this._entries.get(W)}set(C,W){const V=InlayHintsCache._key(C);this._entries.set(V,W)}static _key(C){return`${C.uri.toString()}/${C.getVersionId()}`}}const IInlayHintsCache=createDecorator("IInlayHintsCache");registerSingleton(IInlayHintsCache,InlayHintsCache,1);class RenderedInlayHintLabelPart{constructor(C,W){this.item=C,this.index=W}get part(){const C=this.item.hint.label;return typeof C=="string"?{label:C}:C[this.index]}}class ActiveInlayHintInfo{constructor(C,W){this.part=C,this.hasTriggerModifier=W}}let InlayHintsController=InlayHintsController_1=class{static get(C){var W;return(W=C.getContribution(InlayHintsController_1.ID))!==null&&W!==void 0?W:void 0}constructor(C,W,V,U,G,Z,X){this._editor=C,this._languageFeaturesService=W,this._inlayHintsCache=U,this._commandService=G,this._notificationService=Z,this._instaService=X,this._disposables=new DisposableStore,this._sessionDisposables=new DisposableStore,this._decorationsMetadata=new Map,this._ruleFactory=new DynamicCssRules(this._editor),this._activeRenderMode=0,this._debounceInfo=V.for(W.inlayHintsProvider,"InlayHint",{min:25}),this._disposables.add(W.inlayHintsProvider.onDidChange(()=>this._update())),this._disposables.add(C.onDidChangeModel(()=>this._update())),this._disposables.add(C.onDidChangeModelLanguage(()=>this._update())),this._disposables.add(C.onDidChangeConfiguration(Q=>{Q.hasChanged(139)&&this._update()})),this._update()}dispose(){this._sessionDisposables.dispose(),this._removeAllDecorations(),this._disposables.dispose()}_update(){this._sessionDisposables.clear(),this._removeAllDecorations();const C=this._editor.getOption(139);if(C.enabled==="off")return;const W=this._editor.getModel();if(!W||!this._languageFeaturesService.inlayHintsProvider.has(W))return;const V=this._inlayHintsCache.get(W);V&&this._updateHintsDecorators([W.getFullModelRange()],V),this._sessionDisposables.add(toDisposable(()=>{W.isDisposed()||this._cacheHintsForFastRestore(W)}));let U;const G=new Set,Z=new RunOnceScheduler(()=>__awaiter$l(this,void 0,void 0,function*(){const X=Date.now();U==null||U.dispose(!0),U=new CancellationTokenSource$1;const Q=W.onWillDispose(()=>U==null?void 0:U.cancel());try{const J=U.token,ee=yield InlayHintsFragments.create(this._languageFeaturesService.inlayHintsProvider,W,this._getHintsRanges(),J);if(Z.delay=this._debounceInfo.update(W,Date.now()-X),J.isCancellationRequested){ee.dispose();return}for(const te of ee.provider)typeof te.onDidChangeInlayHints=="function"&&!G.has(te)&&(G.add(te),this._sessionDisposables.add(te.onDidChangeInlayHints(()=>{Z.isScheduled()||Z.schedule()})));this._sessionDisposables.add(ee),this._updateHintsDecorators(ee.ranges,ee.items),this._cacheHintsForFastRestore(W)}catch(J){onUnexpectedError(J)}finally{U.dispose(),Q.dispose()}}),this._debounceInfo.get(W));if(this._sessionDisposables.add(Z),this._sessionDisposables.add(toDisposable(()=>U==null?void 0:U.dispose(!0))),Z.schedule(0),this._sessionDisposables.add(this._editor.onDidScrollChange(X=>{(X.scrollTopChanged||!Z.isScheduled())&&Z.schedule()})),this._sessionDisposables.add(this._editor.onDidChangeModelContent(X=>{const Q=Math.max(Z.delay,1250);Z.schedule(Q)})),C.enabled==="on")this._activeRenderMode=0;else{let X,Q;C.enabled==="onUnlessPressed"?(X=0,Q=1):(X=1,Q=0),this._activeRenderMode=X,this._sessionDisposables.add(ModifierKeyEmitter.getInstance().event(J=>{if(!this._editor.hasModel())return;const ee=J.altKey&&J.ctrlKey&&!(J.shiftKey||J.metaKey)?Q:X;if(ee!==this._activeRenderMode){this._activeRenderMode=ee;const te=this._editor.getModel(),ie=this._copyInlayHintsWithCurrentAnchor(te);this._updateHintsDecorators([te.getFullModelRange()],ie),Z.schedule(0)}}))}this._sessionDisposables.add(this._installDblClickGesture(()=>Z.schedule(0))),this._sessionDisposables.add(this._installLinkGesture()),this._sessionDisposables.add(this._installContextMenu())}_installLinkGesture(){const C=new DisposableStore,W=C.add(new ClickLinkGesture(this._editor)),V=new DisposableStore;return C.add(V),C.add(W.onMouseMoveOrRelevantKeyDown(U=>{const[G]=U,Z=this._getInlayHintLabelPart(G),X=this._editor.getModel();if(!Z||!X){V.clear();return}const Q=new CancellationTokenSource$1;V.add(toDisposable(()=>Q.dispose(!0))),Z.item.resolve(Q.token),this._activeInlayHintPart=Z.part.command||Z.part.location?new ActiveInlayHintInfo(Z,G.hasTriggerModifier):void 0;const J=X.validatePosition(Z.item.hint.position).lineNumber,ee=new Range$2(J,1,J,X.getLineMaxColumn(J)),te=this._getInlineHintsForRange(ee);this._updateHintsDecorators([ee],te),V.add(toDisposable(()=>{this._activeInlayHintPart=void 0,this._updateHintsDecorators([ee],te)}))})),C.add(W.onCancel(()=>V.clear())),C.add(W.onExecute(U=>__awaiter$l(this,void 0,void 0,function*(){const G=this._getInlayHintLabelPart(U);if(G){const Z=G.part;Z.location?this._instaService.invokeFunction(goToDefinitionWithLocation,U,this._editor,Z.location):Command$1.is(Z.command)&&(yield this._invokeCommand(Z.command,G.item))}}))),C}_getInlineHintsForRange(C){const W=new Set;for(const V of this._decorationsMetadata.values())C.containsRange(V.item.anchor.range)&&W.add(V.item);return Array.from(W)}_installDblClickGesture(C){return this._editor.onMouseUp(W=>__awaiter$l(this,void 0,void 0,function*(){if(W.event.detail!==2)return;const V=this._getInlayHintLabelPart(W);if(V&&(W.event.preventDefault(),yield V.item.resolve(CancellationToken.None),isNonEmptyArray$2(V.item.hint.textEdits))){const U=V.item.hint.textEdits.map(G=>EditOperation.replace(Range$2.lift(G.range),G.text));this._editor.executeEdits("inlayHint.default",U),C()}}))}_installContextMenu(){return this._editor.onContextMenu(C=>__awaiter$l(this,void 0,void 0,function*(){if(!(C.event.target instanceof HTMLElement))return;const W=this._getInlayHintLabelPart(C);W&&(yield this._instaService.invokeFunction(showGoToContextMenu,this._editor,C.event.target,W))}))}_getInlayHintLabelPart(C){var W;if(C.target.type!==6)return;const V=(W=C.target.detail.injectedText)===null||W===void 0?void 0:W.options;if(V instanceof ModelDecorationInjectedTextOptions&&(V==null?void 0:V.attachedData)instanceof RenderedInlayHintLabelPart)return V.attachedData}_invokeCommand(C,W){var V;return __awaiter$l(this,void 0,void 0,function*(){try{yield this._commandService.executeCommand(C.id,...(V=C.arguments)!==null&&V!==void 0?V:[])}catch(U){this._notificationService.notify({severity:Severity.Error,source:W.provider.displayName,message:U})}})}_cacheHintsForFastRestore(C){const W=this._copyInlayHintsWithCurrentAnchor(C);this._inlayHintsCache.set(C,W)}_copyInlayHintsWithCurrentAnchor(C){const W=new Map;for(const[V,U]of this._decorationsMetadata){if(W.has(U.item))continue;const G=C.getDecorationRange(V);if(G){const Z=new InlayHintAnchor(G,U.item.anchor.direction),X=U.item.with({anchor:Z});W.set(U.item,X)}}return Array.from(W.values())}_getHintsRanges(){const W=this._editor.getModel(),V=this._editor.getVisibleRangesPlusViewportAboveBelow(),U=[];for(const G of V.sort(Range$2.compareRangesUsingStarts)){const Z=W.validateRange(new Range$2(G.startLineNumber-30,G.startColumn,G.endLineNumber+30,G.endColumn));U.length===0||!Range$2.areIntersectingOrTouching(U[U.length-1],Z)?U.push(Z):U[U.length-1]=Range$2.plusRange(U[U.length-1],Z)}return U}_updateHintsDecorators(C,W){var V,U;const G=[],Z=(re,ae,se,le,ce)=>{const de={content:se,inlineClassNameAffectsLetterSpacing:!0,inlineClassName:ae.className,cursorStops:le,attachedData:ce};G.push({item:re,classNameRef:ae,decoration:{range:re.anchor.range,options:{description:"InlayHint",showIfCollapsed:re.anchor.range.isEmpty(),collapseOnReplaceEdit:!re.anchor.range.isEmpty(),stickiness:0,[re.anchor.direction]:this._activeRenderMode===0?de:void 0}}})},X=(re,ae)=>{const se=this._ruleFactory.createClassNameRef({width:`${Q/3|0}px`,display:"inline-block"});Z(re,se," ",ae?InjectedTextCursorStops.Right:InjectedTextCursorStops.None)},{fontSize:Q,fontFamily:J,padding:ee,isUniform:te}=this._getLayoutInfo(),ie="--code-editorInlayHintsFontFamily";this._editor.getContainerDomNode().style.setProperty(ie,J);for(const re of W){re.hint.paddingLeft&&X(re,!1);const ae=typeof re.hint.label=="string"?[{label:re.hint.label}]:re.hint.label;for(let se=0;se<ae.length;se++){const le=ae[se],ce=se===0,de=se===ae.length-1,ue={fontSize:`${Q}px`,fontFamily:`var(${ie}), ${EDITOR_FONT_DEFAULTS.fontFamily}`,verticalAlign:te?"baseline":"middle",unicodeBidi:"isolate"};isNonEmptyArray$2(re.hint.textEdits)&&(ue.cursor="default"),this._fillInColors(ue,re.hint),(le.command||le.location)&&((V=this._activeInlayHintPart)===null||V===void 0?void 0:V.part.item)===re&&this._activeInlayHintPart.part.index===se&&(ue.textDecoration="underline",this._activeInlayHintPart.hasTriggerModifier&&(ue.color=themeColorFromId(editorActiveLinkForeground),ue.cursor="pointer")),ee&&(ce&&de?(ue.padding=`1px ${Math.max(1,Q/4)|0}px`,ue.borderRadius=`${Q/4|0}px`):ce?(ue.padding=`1px 0 1px ${Math.max(1,Q/4)|0}px`,ue.borderRadius=`${Q/4|0}px 0 0 ${Q/4|0}px`):de?(ue.padding=`1px ${Math.max(1,Q/4)|0}px 1px 0`,ue.borderRadius=`0 ${Q/4|0}px ${Q/4|0}px 0`):ue.padding="1px 0 1px 0"),Z(re,this._ruleFactory.createClassNameRef(ue),fixSpace(le.label),de&&!re.hint.paddingRight?InjectedTextCursorStops.Right:InjectedTextCursorStops.None,new RenderedInlayHintLabelPart(re,se))}if(re.hint.paddingRight&&X(re,!0),G.length>InlayHintsController_1._MAX_DECORATORS)break}const ne=[];for(const re of C)for(const{id:ae}of(U=this._editor.getDecorationsInRange(re))!==null&&U!==void 0?U:[]){const se=this._decorationsMetadata.get(ae);se&&(ne.push(ae),se.classNameRef.dispose(),this._decorationsMetadata.delete(ae))}const oe=StableEditorScrollState.capture(this._editor);this._editor.changeDecorations(re=>{const ae=re.deltaDecorations(ne,G.map(se=>se.decoration));for(let se=0;se<ae.length;se++){const le=G[se];this._decorationsMetadata.set(ae[se],le)}}),oe.restore(this._editor)}_fillInColors(C,W){W.kind===InlayHintKind$1.Parameter?(C.backgroundColor=themeColorFromId(editorInlayHintParameterBackground),C.color=themeColorFromId(editorInlayHintParameterForeground)):W.kind===InlayHintKind$1.Type?(C.backgroundColor=themeColorFromId(editorInlayHintTypeBackground),C.color=themeColorFromId(editorInlayHintTypeForeground)):(C.backgroundColor=themeColorFromId(editorInlayHintBackground),C.color=themeColorFromId(editorInlayHintForeground))}_getLayoutInfo(){const C=this._editor.getOption(139),W=C.padding,V=this._editor.getOption(52),U=this._editor.getOption(49);let G=C.fontSize;(!G||G<5||G>V)&&(G=V);const Z=C.fontFamily||U;return{fontSize:G,fontFamily:Z,padding:W,isUniform:!W&&Z===U&&G===V}}_removeAllDecorations(){this._editor.removeDecorations(Array.from(this._decorationsMetadata.keys()));for(const C of this._decorationsMetadata.values())C.classNameRef.dispose();this._decorationsMetadata.clear()}};InlayHintsController.ID="editor.contrib.InlayHints";InlayHintsController._MAX_DECORATORS=1500;InlayHintsController=InlayHintsController_1=__decorate$u([__param$u(1,ILanguageFeaturesService),__param$u(2,ILanguageFeatureDebounceService),__param$u(3,IInlayHintsCache),__param$u(4,ICommandService),__param$u(5,INotificationService),__param$u(6,IInstantiationService)],InlayHintsController);function fixSpace(K){const C=" ";return K.replace(/[ \t]/g,C)}CommandsRegistry.registerCommand("_executeInlayHintProvider",(K,...C)=>__awaiter$l(void 0,void 0,void 0,function*(){const[W,V]=C;assertType(URI.isUri(W)),assertType(Range$2.isIRange(V));const{inlayHintsProvider:U}=K.get(ILanguageFeaturesService),G=yield K.get(ITextModelService).createModelReference(W);try{const Z=yield InlayHintsFragments.create(U,G.object.textEditorModel,[Range$2.lift(V)],CancellationToken.None),X=Z.items.map(Q=>Q.hint);return setTimeout(()=>Z.dispose(),0),X}finally{G.dispose()}}));var __decorate$t=globalThis&&globalThis.__decorate||function(K,C,W,V){var U=arguments.length,G=U<3?C:V===null?V=Object.getOwnPropertyDescriptor(C,W):V,Z;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")G=Reflect.decorate(K,C,W,V);else for(var X=K.length-1;X>=0;X--)(Z=K[X])&&(G=(U<3?Z(G):U>3?Z(C,W,G):Z(C,W))||G);return U>3&&G&&Object.defineProperty(C,W,G),G},__param$t=globalThis&&globalThis.__param||function(K,C){return function(W,V){C(W,V,K)}},__awaiter$k=globalThis&&globalThis.__awaiter||function(K,C,W,V){function U(G){return G instanceof W?G:new W(function(Z){Z(G)})}return new(W||(W=Promise))(function(G,Z){function X(ee){try{J(V.next(ee))}catch(te){Z(te)}}function Q(ee){try{J(V.throw(ee))}catch(te){Z(te)}}function J(ee){ee.done?G(ee.value):U(ee.value).then(X,Q)}J((V=V.apply(K,C||[])).next())})},__asyncValues=globalThis&&globalThis.__asyncValues||function(K){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var C=K[Symbol.asyncIterator],W;return C?C.call(K):(K=typeof __values=="function"?__values(K):K[Symbol.iterator](),W={},V("next"),V("throw"),V("return"),W[Symbol.asyncIterator]=function(){return this},W);function V(G){W[G]=K[G]&&function(Z){return new Promise(function(X,Q){Z=K[G](Z),U(X,Q,Z.done,Z.value)})}}function U(G,Z,X,Q){Promise.resolve(Q).then(function(J){G({value:J,done:X})},Z)}};class InlayHintsHoverAnchor extends HoverForeignElementAnchor{constructor(C,W,V,U){super(10,W,C.item.anchor.range,V,U,!0),this.part=C}}let InlayHintsHover=class extends MarkdownHoverParticipant{constructor(C,W,V,U,G,Z){super(C,W,V,U,Z),this._resolverService=G,this.hoverOrdinal=6}suggestHoverAnchor(C){var W;if(!InlayHintsController.get(this._editor)||C.target.type!==6)return null;const U=(W=C.target.detail.injectedText)===null||W===void 0?void 0:W.options;return U instanceof ModelDecorationInjectedTextOptions&&U.attachedData instanceof RenderedInlayHintLabelPart?new InlayHintsHoverAnchor(U.attachedData,this,C.event.posx,C.event.posy):null}computeSync(){return[]}computeAsync(C,W,V){return C instanceof InlayHintsHoverAnchor?new AsyncIterableObject(U=>__awaiter$k(this,void 0,void 0,function*(){var G,Z,X,Q;const{part:J}=C;if(yield J.item.resolve(V),V.isCancellationRequested)return;let ee;typeof J.item.hint.tooltip=="string"?ee=new MarkdownString().appendText(J.item.hint.tooltip):J.item.hint.tooltip&&(ee=J.item.hint.tooltip),ee&&U.emitOne(new MarkdownHover(this,C.range,[ee],!1,0)),isNonEmptyArray$2(J.item.hint.textEdits)&&U.emitOne(new MarkdownHover(this,C.range,[new MarkdownString().appendText(localize("hint.dbl","Double-click to insert"))],!1,10001));let te;if(typeof J.part.tooltip=="string"?te=new MarkdownString().appendText(J.part.tooltip):J.part.tooltip&&(te=J.part.tooltip),te&&U.emitOne(new MarkdownHover(this,C.range,[te],!1,1)),J.part.location||J.part.command){let ae;const le=this._editor.getOption(77)==="altKey"?isMacintosh?localize("links.navigate.kb.meta.mac","cmd + click"):localize("links.navigate.kb.meta","ctrl + click"):isMacintosh?localize("links.navigate.kb.alt.mac","option + click"):localize("links.navigate.kb.alt","alt + click");J.part.location&&J.part.command?ae=new MarkdownString().appendText(localize("hint.defAndCommand","Go to Definition ({0}), right click for more",le)):J.part.location?ae=new MarkdownString().appendText(localize("hint.def","Go to Definition ({0})",le)):J.part.command&&(ae=new MarkdownString(`[${localize("hint.cmd","Execute Command")}](${asCommandLink(J.part.command)} "${J.part.command.title}") (${le})`,{isTrusted:!0})),ae&&U.emitOne(new MarkdownHover(this,C.range,[ae],!1,1e4))}const ie=yield this._resolveInlayHintLabelPartHover(J,V);try{for(var ne=!0,oe=__asyncValues(ie),re;re=yield oe.next(),G=re.done,!G;ne=!0){Q=re.value,ne=!1;const ae=Q;U.emitOne(ae)}}catch(ae){Z={error:ae}}finally{try{!ne&&!G&&(X=oe.return)&&(yield X.call(oe))}finally{if(Z)throw Z.error}}})):AsyncIterableObject.EMPTY}_resolveInlayHintLabelPartHover(C,W){return __awaiter$k(this,void 0,void 0,function*(){if(!C.part.location)return AsyncIterableObject.EMPTY;const{uri:V,range:U}=C.part.location,G=yield this._resolverService.createModelReference(V);try{const Z=G.object.textEditorModel;return this._languageFeaturesService.hoverProvider.has(Z)?getHover(this._languageFeaturesService.hoverProvider,Z,new Position$1(U.startLineNumber,U.startColumn),W).filter(X=>!isEmptyMarkdownString(X.hover.contents)).map(X=>new MarkdownHover(this,C.item.anchor.range,X.hover.contents,!1,2+X.ordinal)):AsyncIterableObject.EMPTY}finally{G.dispose()}})}};InlayHintsHover=__decorate$t([__param$t(1,ILanguageService),__param$t(2,IOpenerService),__param$t(3,IConfigurationService),__param$t(4,ITextModelService),__param$t(5,ILanguageFeaturesService)],InlayHintsHover);registerEditorContribution(InlayHintsController.ID,InlayHintsController,1);HoverParticipantRegistry.register(InlayHintsHover);class InPlaceReplaceCommand{constructor(C,W,V){this._editRange=C,this._originalSelection=W,this._text=V}getEditOperations(C,W){W.addTrackedEditOperation(this._editRange,this._text)}computeCursorState(C,W){const U=W.getInverseEditOperations()[0].range;return this._originalSelection.isEmpty()?new Selection$1(U.endLineNumber,Math.min(this._originalSelection.positionColumn,U.endColumn),U.endLineNumber,Math.min(this._originalSelection.positionColumn,U.endColumn)):new Selection$1(U.endLineNumber,U.endColumn-this._text.length,U.endLineNumber,U.endColumn)}}const inPlaceReplace="";var __decorate$s=globalThis&&globalThis.__decorate||function(K,C,W,V){var U=arguments.length,G=U<3?C:V===null?V=Object.getOwnPropertyDescriptor(C,W):V,Z;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")G=Reflect.decorate(K,C,W,V);else for(var X=K.length-1;X>=0;X--)(Z=K[X])&&(G=(U<3?Z(G):U>3?Z(C,W,G):Z(C,W))||G);return U>3&&G&&Object.defineProperty(C,W,G),G},__param$s=globalThis&&globalThis.__param||function(K,C){return function(W,V){C(W,V,K)}},InPlaceReplaceController_1;let InPlaceReplaceController=InPlaceReplaceController_1=class{static get(C){return C.getContribution(InPlaceReplaceController_1.ID)}constructor(C,W){this.editor=C,this.editorWorkerService=W,this.decorations=this.editor.createDecorationsCollection()}dispose(){}run(C,W){var V;(V=this.currentRequest)===null||V===void 0||V.cancel();const U=this.editor.getSelection(),G=this.editor.getModel();if(!G||!U)return;let Z=U;if(Z.startLineNumber!==Z.endLineNumber)return;const X=new EditorState$1(this.editor,5),Q=G.uri;return this.editorWorkerService.canNavigateValueSet(Q)?(this.currentRequest=createCancelablePromise(J=>this.editorWorkerService.navigateValueSet(Q,Z,W)),this.currentRequest.then(J=>{var ee;if(!J||!J.range||!J.value||!X.validate(this.editor))return;const te=Range$2.lift(J.range);let ie=J.range;const ne=J.value.length-(Z.endColumn-Z.startColumn);ie={startLineNumber:ie.startLineNumber,startColumn:ie.startColumn,endLineNumber:ie.endLineNumber,endColumn:ie.startColumn+J.value.length},ne>1&&(Z=new Selection$1(Z.startLineNumber,Z.startColumn,Z.endLineNumber,Z.endColumn+ne-1));const oe=new InPlaceReplaceCommand(te,Z,J.value);this.editor.pushUndoStop(),this.editor.executeCommand(C,oe),this.editor.pushUndoStop(),this.decorations.set([{range:ie,options:InPlaceReplaceController_1.DECORATION}]),(ee=this.decorationRemover)===null||ee===void 0||ee.cancel(),this.decorationRemover=timeout(350),this.decorationRemover.then(()=>this.decorations.clear()).catch(onUnexpectedError)}).catch(onUnexpectedError)):Promise.resolve(void 0)}};InPlaceReplaceController.ID="editor.contrib.inPlaceReplaceController";InPlaceReplaceController.DECORATION=ModelDecorationOptions.register({description:"in-place-replace",className:"valueSetReplacement"});InPlaceReplaceController=InPlaceReplaceController_1=__decorate$s([__param$s(1,IEditorWorkerService)],InPlaceReplaceController);class InPlaceReplaceUp extends EditorAction{constructor(){super({id:"editor.action.inPlaceReplace.up",label:localize("InPlaceReplaceAction.previous.label","Replace with Previous Value"),alias:"Replace with Previous Value",precondition:EditorContextKeys.writable,kbOpts:{kbExpr:EditorContextKeys.editorTextFocus,primary:3159,weight:100}})}run(C,W){const V=InPlaceReplaceController.get(W);return V?V.run(this.id,!1):Promise.resolve(void 0)}}class InPlaceReplaceDown extends EditorAction{constructor(){super({id:"editor.action.inPlaceReplace.down",label:localize("InPlaceReplaceAction.next.label","Replace with Next Value"),alias:"Replace with Next Value",precondition:EditorContextKeys.writable,kbOpts:{kbExpr:EditorContextKeys.editorTextFocus,primary:3161,weight:100}})}run(C,W){const V=InPlaceReplaceController.get(W);return V?V.run(this.id,!0):Promise.resolve(void 0)}}registerEditorContribution(InPlaceReplaceController.ID,InPlaceReplaceController,4);registerEditorAction(InPlaceReplaceUp);registerEditorAction(InPlaceReplaceDown);class ExpandLineSelectionAction extends EditorAction{constructor(){super({id:"expandLineSelection",label:localize("expandLineSelection","Expand Line Selection"),alias:"Expand Line Selection",precondition:void 0,kbOpts:{weight:0,kbExpr:EditorContextKeys.textInputFocus,primary:2090}})}run(C,W,V){if(V=V||{},!W.hasModel())return;const U=W._getViewModel();U.model.pushStackElement(),U.setCursorStates(V.source,3,CursorMoveCommands.expandLineSelection(U,U.getCursorStates())),U.revealPrimaryCursor(V.source,!0)}}registerEditorAction(ExpandLineSelectionAction);class TrimTrailingWhitespaceCommand{constructor(C,W){this._selection=C,this._cursors=W,this._selectionId=null}getEditOperations(C,W){const V=trimTrailingWhitespace(C,this._cursors);for(let U=0,G=V.length;U<G;U++){const Z=V[U];W.addEditOperation(Z.range,Z.text)}this._selectionId=W.trackSelection(this._selection)}computeCursorState(C,W){return W.getTrackedSelection(this._selectionId)}}function trimTrailingWhitespace(K,C){C.sort((Z,X)=>Z.lineNumber===X.lineNumber?Z.column-X.column:Z.lineNumber-X.lineNumber);for(let Z=C.length-2;Z>=0;Z--)C[Z].lineNumber===C[Z+1].lineNumber&&C.splice(Z,1);const W=[];let V=0,U=0;const G=C.length;for(let Z=1,X=K.getLineCount();Z<=X;Z++){const Q=K.getLineContent(Z),J=Q.length+1;let ee=0;if(U<G&&C[U].lineNumber===Z&&(ee=C[U].column,U++,ee===J)||Q.length===0)continue;const te=lastNonWhitespaceIndex(Q);let ie=0;if(te===-1)ie=1;else if(te!==Q.length-1)ie=te+2;else continue;ie=Math.max(ee,ie),W[V++]=EditOperation.delete(new Range$2(Z,ie,Z,J))}return W}class CopyLinesCommand{constructor(C,W,V){this._selection=C,this._isCopyingDown=W,this._noop=V||!1,this._selectionDirection=0,this._selectionId=null,this._startLineNumberDelta=0,this._endLineNumberDelta=0}getEditOperations(C,W){let V=this._selection;this._startLineNumberDelta=0,this._endLineNumberDelta=0,V.startLineNumber<V.endLineNumber&&V.endColumn===1&&(this._endLineNumberDelta=1,V=V.setEndPosition(V.endLineNumber-1,C.getLineMaxColumn(V.endLineNumber-1)));const U=[];for(let Z=V.startLineNumber;Z<=V.endLineNumber;Z++)U.push(C.getLineContent(Z));const G=U.join(`
`);G===""&&this._isCopyingDown&&(this._startLineNumberDelta++,this._endLineNumberDelta++),this._noop?W.addEditOperation(new Range$2(V.endLineNumber,C.getLineMaxColumn(V.endLineNumber),V.endLineNumber+1,1),V.endLineNumber===C.getLineCount()?"":`
`):this._isCopyingDown?W.addEditOperation(new Range$2(V.startLineNumber,1,V.startLineNumber,1),G+`
`):W.addEditOperation(new Range$2(V.endLineNumber,C.getLineMaxColumn(V.endLineNumber),V.endLineNumber,C.getLineMaxColumn(V.endLineNumber)),`
`+G),this._selectionId=W.trackSelection(V),this._selectionDirection=this._selection.getDirection()}computeCursorState(C,W){let V=W.getTrackedSelection(this._selectionId);if(this._startLineNumberDelta!==0||this._endLineNumberDelta!==0){let U=V.startLineNumber,G=V.startColumn,Z=V.endLineNumber,X=V.endColumn;this._startLineNumberDelta!==0&&(U=U+this._startLineNumberDelta,G=1),this._endLineNumberDelta!==0&&(Z=Z+this._endLineNumberDelta,X=1),V=Selection$1.createWithDirection(U,G,Z,X,this._selectionDirection)}return V}}var __decorate$r=globalThis&&globalThis.__decorate||function(K,C,W,V){var U=arguments.length,G=U<3?C:V===null?V=Object.getOwnPropertyDescriptor(C,W):V,Z;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")G=Reflect.decorate(K,C,W,V);else for(var X=K.length-1;X>=0;X--)(Z=K[X])&&(G=(U<3?Z(G):U>3?Z(C,W,G):Z(C,W))||G);return U>3&&G&&Object.defineProperty(C,W,G),G},__param$r=globalThis&&globalThis.__param||function(K,C){return function(W,V){C(W,V,K)}};let MoveLinesCommand=class{constructor(C,W,V,U){this._languageConfigurationService=U,this._selection=C,this._isMovingDown=W,this._autoIndent=V,this._selectionId=null,this._moveEndLineSelectionShrink=!1}getEditOperations(C,W){const V=C.getLineCount();if(this._isMovingDown&&this._selection.endLineNumber===V){this._selectionId=W.trackSelection(this._selection);return}if(!this._isMovingDown&&this._selection.startLineNumber===1){this._selectionId=W.trackSelection(this._selection);return}this._moveEndPositionDown=!1;let U=this._selection;U.startLineNumber<U.endLineNumber&&U.endColumn===1&&(this._moveEndPositionDown=!0,U=U.setEndPosition(U.endLineNumber-1,C.getLineMaxColumn(U.endLineNumber-1)));const{tabSize:G,indentSize:Z,insertSpaces:X}=C.getOptions(),Q=this.buildIndentConverter(G,Z,X),J={tokenization:{getLineTokens:ee=>C.tokenization.getLineTokens(ee),getLanguageId:()=>C.getLanguageId(),getLanguageIdAtPosition:(ee,te)=>C.getLanguageIdAtPosition(ee,te)},getLineContent:null};if(U.startLineNumber===U.endLineNumber&&C.getLineMaxColumn(U.startLineNumber)===1){const ee=U.startLineNumber,te=this._isMovingDown?ee+1:ee-1;C.getLineMaxColumn(te)===1?W.addEditOperation(new Range$2(1,1,1,1),null):(W.addEditOperation(new Range$2(ee,1,ee,1),C.getLineContent(te)),W.addEditOperation(new Range$2(te,1,te,C.getLineMaxColumn(te)),null)),U=new Selection$1(te,1,te,1)}else{let ee,te;if(this._isMovingDown){ee=U.endLineNumber+1,te=C.getLineContent(ee),W.addEditOperation(new Range$2(ee-1,C.getLineMaxColumn(ee-1),ee,C.getLineMaxColumn(ee)),null);let ie=te;if(this.shouldAutoIndent(C,U)){const ne=this.matchEnterRule(C,Q,G,ee,U.startLineNumber-1);if(ne!==null){const re=getLeadingWhitespace(C.getLineContent(ee)),ae=ne+getSpaceCnt(re,G);ie=generateIndent(ae,G,X)+this.trimStart(te)}else{J.getLineContent=ae=>ae===U.startLineNumber?C.getLineContent(ee):C.getLineContent(ae);const re=getGoodIndentForLine(this._autoIndent,J,C.getLanguageIdAtPosition(ee,1),U.startLineNumber,Q,this._languageConfigurationService);if(re!==null){const ae=getLeadingWhitespace(C.getLineContent(ee)),se=getSpaceCnt(re,G),le=getSpaceCnt(ae,G);se!==le&&(ie=generateIndent(se,G,X)+this.trimStart(te))}}W.addEditOperation(new Range$2(U.startLineNumber,1,U.startLineNumber,1),ie+`
`);const oe=this.matchEnterRuleMovingDown(C,Q,G,U.startLineNumber,ee,ie);if(oe!==null)oe!==0&&this.getIndentEditsOfMovingBlock(C,W,U,G,X,oe);else{J.getLineContent=ae=>ae===U.startLineNumber?ie:ae>=U.startLineNumber+1&&ae<=U.endLineNumber+1?C.getLineContent(ae-1):C.getLineContent(ae);const re=getGoodIndentForLine(this._autoIndent,J,C.getLanguageIdAtPosition(ee,1),U.startLineNumber+1,Q,this._languageConfigurationService);if(re!==null){const ae=getLeadingWhitespace(C.getLineContent(U.startLineNumber)),se=getSpaceCnt(re,G),le=getSpaceCnt(ae,G);if(se!==le){const ce=se-le;this.getIndentEditsOfMovingBlock(C,W,U,G,X,ce)}}}}else W.addEditOperation(new Range$2(U.startLineNumber,1,U.startLineNumber,1),ie+`
`)}else if(ee=U.startLineNumber-1,te=C.getLineContent(ee),W.addEditOperation(new Range$2(ee,1,ee+1,1),null),W.addEditOperation(new Range$2(U.endLineNumber,C.getLineMaxColumn(U.endLineNumber),U.endLineNumber,C.getLineMaxColumn(U.endLineNumber)),`
`+te),this.shouldAutoIndent(C,U)){J.getLineContent=ne=>ne===ee?C.getLineContent(U.startLineNumber):C.getLineContent(ne);const ie=this.matchEnterRule(C,Q,G,U.startLineNumber,U.startLineNumber-2);if(ie!==null)ie!==0&&this.getIndentEditsOfMovingBlock(C,W,U,G,X,ie);else{const ne=getGoodIndentForLine(this._autoIndent,J,C.getLanguageIdAtPosition(U.startLineNumber,1),ee,Q,this._languageConfigurationService);if(ne!==null){const oe=getLeadingWhitespace(C.getLineContent(U.startLineNumber)),re=getSpaceCnt(ne,G),ae=getSpaceCnt(oe,G);if(re!==ae){const se=re-ae;this.getIndentEditsOfMovingBlock(C,W,U,G,X,se)}}}}}this._selectionId=W.trackSelection(U)}buildIndentConverter(C,W,V){return{shiftIndent:U=>ShiftCommand.shiftIndent(U,U.length+1,C,W,V),unshiftIndent:U=>ShiftCommand.unshiftIndent(U,U.length+1,C,W,V)}}parseEnterResult(C,W,V,U,G){if(G){let Z=G.indentation;G.indentAction===IndentAction.None||G.indentAction===IndentAction.Indent?Z=G.indentation+G.appendText:G.indentAction===IndentAction.IndentOutdent?Z=G.indentation:G.indentAction===IndentAction.Outdent&&(Z=W.unshiftIndent(G.indentation)+G.appendText);const X=C.getLineContent(U);if(this.trimStart(X).indexOf(this.trimStart(Z))>=0){const Q=getLeadingWhitespace(C.getLineContent(U));let J=getLeadingWhitespace(Z);const ee=getIndentMetadata(C,U,this._languageConfigurationService);ee!==null&&ee&2&&(J=W.unshiftIndent(J));const te=getSpaceCnt(J,V),ie=getSpaceCnt(Q,V);return te-ie}}return null}matchEnterRuleMovingDown(C,W,V,U,G,Z){if(lastNonWhitespaceIndex(Z)>=0){const X=C.getLineMaxColumn(G),Q=getEnterAction(this._autoIndent,C,new Range$2(G,X,G,X),this._languageConfigurationService);return this.parseEnterResult(C,W,V,U,Q)}else{let X=U-1;for(;X>=1;){const ee=C.getLineContent(X);if(lastNonWhitespaceIndex(ee)>=0)break;X--}if(X<1||U>C.getLineCount())return null;const Q=C.getLineMaxColumn(X),J=getEnterAction(this._autoIndent,C,new Range$2(X,Q,X,Q),this._languageConfigurationService);return this.parseEnterResult(C,W,V,U,J)}}matchEnterRule(C,W,V,U,G,Z){let X=G;for(;X>=1;){let ee;if(X===G&&Z!==void 0?ee=Z:ee=C.getLineContent(X),lastNonWhitespaceIndex(ee)>=0)break;X--}if(X<1||U>C.getLineCount())return null;const Q=C.getLineMaxColumn(X),J=getEnterAction(this._autoIndent,C,new Range$2(X,Q,X,Q),this._languageConfigurationService);return this.parseEnterResult(C,W,V,U,J)}trimStart(C){return C.replace(/^\s+/,"")}shouldAutoIndent(C,W){if(this._autoIndent<4||!C.tokenization.isCheapToTokenize(W.startLineNumber))return!1;const V=C.getLanguageIdAtPosition(W.startLineNumber,1),U=C.getLanguageIdAtPosition(W.endLineNumber,1);return!(V!==U||this._languageConfigurationService.getLanguageConfiguration(V).indentRulesSupport===null)}getIndentEditsOfMovingBlock(C,W,V,U,G,Z){for(let X=V.startLineNumber;X<=V.endLineNumber;X++){const Q=C.getLineContent(X),J=getLeadingWhitespace(Q),te=getSpaceCnt(J,U)+Z,ie=generateIndent(te,U,G);ie!==J&&(W.addEditOperation(new Range$2(X,1,X,J.length+1),ie),X===V.endLineNumber&&V.endColumn<=J.length+1&&ie===""&&(this._moveEndLineSelectionShrink=!0))}}computeCursorState(C,W){let V=W.getTrackedSelection(this._selectionId);return this._moveEndPositionDown&&(V=V.setEndPosition(V.endLineNumber+1,1)),this._moveEndLineSelectionShrink&&V.startLineNumber<V.endLineNumber&&(V=V.setEndPosition(V.endLineNumber,2)),V}};MoveLinesCommand=__decorate$r([__param$r(3,ILanguageConfigurationService)],MoveLinesCommand);class SortLinesCommand{static getCollator(){return SortLinesCommand._COLLATOR||(SortLinesCommand._COLLATOR=new Intl.Collator),SortLinesCommand._COLLATOR}constructor(C,W){this.selection=C,this.descending=W,this.selectionId=null}getEditOperations(C,W){const V=sortLines(C,this.selection,this.descending);V&&W.addEditOperation(V.range,V.text),this.selectionId=W.trackSelection(this.selection)}computeCursorState(C,W){return W.getTrackedSelection(this.selectionId)}static canRun(C,W,V){if(C===null)return!1;const U=getSortData(C,W,V);if(!U)return!1;for(let G=0,Z=U.before.length;G<Z;G++)if(U.before[G]!==U.after[G])return!0;return!1}}SortLinesCommand._COLLATOR=null;function getSortData(K,C,W){const V=C.startLineNumber;let U=C.endLineNumber;if(C.endColumn===1&&U--,V>=U)return null;const G=[];for(let X=V;X<=U;X++)G.push(K.getLineContent(X));let Z=G.slice(0);return Z.sort(SortLinesCommand.getCollator().compare),W===!0&&(Z=Z.reverse()),{startLineNumber:V,endLineNumber:U,before:G,after:Z}}function sortLines(K,C,W){const V=getSortData(K,C,W);return V?EditOperation.replace(new Range$2(V.startLineNumber,1,V.endLineNumber,K.getLineMaxColumn(V.endLineNumber)),V.after.join(`
`)):null}class AbstractCopyLinesAction extends EditorAction{constructor(C,W){super(W),this.down=C}run(C,W){if(!W.hasModel())return;const V=W.getSelections().map((Z,X)=>({selection:Z,index:X,ignore:!1}));V.sort((Z,X)=>Range$2.compareRangesUsingStarts(Z.selection,X.selection));let U=V[0];for(let Z=1;Z<V.length;Z++){const X=V[Z];U.selection.endLineNumber===X.selection.startLineNumber&&(U.index<X.index?X.ignore=!0:(U.ignore=!0,U=X))}const G=[];for(const Z of V)G.push(new CopyLinesCommand(Z.selection,this.down,Z.ignore));W.pushUndoStop(),W.executeCommands(this.id,G),W.pushUndoStop()}}class CopyLinesUpAction extends AbstractCopyLinesAction{constructor(){super(!1,{id:"editor.action.copyLinesUpAction",label:localize("lines.copyUp","Copy Line Up"),alias:"Copy Line Up",precondition:EditorContextKeys.writable,kbOpts:{kbExpr:EditorContextKeys.editorTextFocus,primary:1552,linux:{primary:3600},weight:100},menuOpts:{menuId:MenuId.MenubarSelectionMenu,group:"2_line",title:localize({key:"miCopyLinesUp",comment:["&& denotes a mnemonic"]},"&&Copy Line Up"),order:1}})}}class CopyLinesDownAction extends AbstractCopyLinesAction{constructor(){super(!0,{id:"editor.action.copyLinesDownAction",label:localize("lines.copyDown","Copy Line Down"),alias:"Copy Line Down",precondition:EditorContextKeys.writable,kbOpts:{kbExpr:EditorContextKeys.editorTextFocus,primary:1554,linux:{primary:3602},weight:100},menuOpts:{menuId:MenuId.MenubarSelectionMenu,group:"2_line",title:localize({key:"miCopyLinesDown",comment:["&& denotes a mnemonic"]},"Co&&py Line Down"),order:2}})}}class DuplicateSelectionAction extends EditorAction{constructor(){super({id:"editor.action.duplicateSelection",label:localize("duplicateSelection","Duplicate Selection"),alias:"Duplicate Selection",precondition:EditorContextKeys.writable,menuOpts:{menuId:MenuId.MenubarSelectionMenu,group:"2_line",title:localize({key:"miDuplicateSelection",comment:["&& denotes a mnemonic"]},"&&Duplicate Selection"),order:5}})}run(C,W,V){if(!W.hasModel())return;const U=[],G=W.getSelections(),Z=W.getModel();for(const X of G)if(X.isEmpty())U.push(new CopyLinesCommand(X,!0));else{const Q=new Selection$1(X.endLineNumber,X.endColumn,X.endLineNumber,X.endColumn);U.push(new ReplaceCommandThatSelectsText(Q,Z.getValueInRange(X)))}W.pushUndoStop(),W.executeCommands(this.id,U),W.pushUndoStop()}}class AbstractMoveLinesAction extends EditorAction{constructor(C,W){super(W),this.down=C}run(C,W){const V=C.get(ILanguageConfigurationService),U=[],G=W.getSelections()||[],Z=W.getOption(12);for(const X of G)U.push(new MoveLinesCommand(X,this.down,Z,V));W.pushUndoStop(),W.executeCommands(this.id,U),W.pushUndoStop()}}class MoveLinesUpAction extends AbstractMoveLinesAction{constructor(){super(!1,{id:"editor.action.moveLinesUpAction",label:localize("lines.moveUp","Move Line Up"),alias:"Move Line Up",precondition:EditorContextKeys.writable,kbOpts:{kbExpr:EditorContextKeys.editorTextFocus,primary:528,linux:{primary:528},weight:100},menuOpts:{menuId:MenuId.MenubarSelectionMenu,group:"2_line",title:localize({key:"miMoveLinesUp",comment:["&& denotes a mnemonic"]},"Mo&&ve Line Up"),order:3}})}}class MoveLinesDownAction extends AbstractMoveLinesAction{constructor(){super(!0,{id:"editor.action.moveLinesDownAction",label:localize("lines.moveDown","Move Line Down"),alias:"Move Line Down",precondition:EditorContextKeys.writable,kbOpts:{kbExpr:EditorContextKeys.editorTextFocus,primary:530,linux:{primary:530},weight:100},menuOpts:{menuId:MenuId.MenubarSelectionMenu,group:"2_line",title:localize({key:"miMoveLinesDown",comment:["&& denotes a mnemonic"]},"Move &&Line Down"),order:4}})}}class AbstractSortLinesAction extends EditorAction{constructor(C,W){super(W),this.descending=C}run(C,W){const V=W.getSelections()||[];for(const G of V)if(!SortLinesCommand.canRun(W.getModel(),G,this.descending))return;const U=[];for(let G=0,Z=V.length;G<Z;G++)U[G]=new SortLinesCommand(V[G],this.descending);W.pushUndoStop(),W.executeCommands(this.id,U),W.pushUndoStop()}}class SortLinesAscendingAction extends AbstractSortLinesAction{constructor(){super(!1,{id:"editor.action.sortLinesAscending",label:localize("lines.sortAscending","Sort Lines Ascending"),alias:"Sort Lines Ascending",precondition:EditorContextKeys.writable})}}class SortLinesDescendingAction extends AbstractSortLinesAction{constructor(){super(!0,{id:"editor.action.sortLinesDescending",label:localize("lines.sortDescending","Sort Lines Descending"),alias:"Sort Lines Descending",precondition:EditorContextKeys.writable})}}class DeleteDuplicateLinesAction extends EditorAction{constructor(){super({id:"editor.action.removeDuplicateLines",label:localize("lines.deleteDuplicates","Delete Duplicate Lines"),alias:"Delete Duplicate Lines",precondition:EditorContextKeys.writable})}run(C,W){if(!W.hasModel())return;const V=W.getModel();if(V.getLineCount()===1&&V.getLineMaxColumn(1)===1)return;const U=[],G=[];let Z=0;for(const X of W.getSelections()){const Q=new Set,J=[];for(let ne=X.startLineNumber;ne<=X.endLineNumber;ne++){const oe=V.getLineContent(ne);Q.has(oe)||(J.push(oe),Q.add(oe))}const ee=new Selection$1(X.startLineNumber,1,X.endLineNumber,V.getLineMaxColumn(X.endLineNumber)),te=X.startLineNumber-Z,ie=new Selection$1(te,1,te+J.length-1,J[J.length-1].length);U.push(EditOperation.replace(ee,J.join(`
`))),G.push(ie),Z+=X.endLineNumber-X.startLineNumber+1-J.length}W.pushUndoStop(),W.executeEdits(this.id,U,G),W.pushUndoStop()}}class TrimTrailingWhitespaceAction extends EditorAction{constructor(){super({id:TrimTrailingWhitespaceAction.ID,label:localize("lines.trimTrailingWhitespace","Trim Trailing Whitespace"),alias:"Trim Trailing Whitespace",precondition:EditorContextKeys.writable,kbOpts:{kbExpr:EditorContextKeys.editorTextFocus,primary:KeyChord(2089,2102),weight:100}})}run(C,W,V){let U=[];V.reason==="auto-save"&&(U=(W.getSelections()||[]).map(X=>new Position$1(X.positionLineNumber,X.positionColumn)));const G=W.getSelection();if(G===null)return;const Z=new TrimTrailingWhitespaceCommand(G,U);W.pushUndoStop(),W.executeCommands(this.id,[Z]),W.pushUndoStop()}}TrimTrailingWhitespaceAction.ID="editor.action.trimTrailingWhitespace";class DeleteLinesAction extends EditorAction{constructor(){super({id:"editor.action.deleteLines",label:localize("lines.delete","Delete Line"),alias:"Delete Line",precondition:EditorContextKeys.writable,kbOpts:{kbExpr:EditorContextKeys.textInputFocus,primary:3113,weight:100}})}run(C,W){if(!W.hasModel())return;const V=this._getLinesToRemove(W),U=W.getModel();if(U.getLineCount()===1&&U.getLineMaxColumn(1)===1)return;let G=0;const Z=[],X=[];for(let Q=0,J=V.length;Q<J;Q++){const ee=V[Q];let te=ee.startLineNumber,ie=ee.endLineNumber,ne=1,oe=U.getLineMaxColumn(ie);ie<U.getLineCount()?(ie+=1,oe=1):te>1&&(te-=1,ne=U.getLineMaxColumn(te)),Z.push(EditOperation.replace(new Selection$1(te,ne,ie,oe),"")),X.push(new Selection$1(te-G,ee.positionColumn,te-G,ee.positionColumn)),G+=ee.endLineNumber-ee.startLineNumber+1}W.pushUndoStop(),W.executeEdits(this.id,Z,X),W.pushUndoStop()}_getLinesToRemove(C){const W=C.getSelections().map(G=>{let Z=G.endLineNumber;return G.startLineNumber<G.endLineNumber&&G.endColumn===1&&(Z-=1),{startLineNumber:G.startLineNumber,selectionStartColumn:G.selectionStartColumn,endLineNumber:Z,positionColumn:G.positionColumn}});W.sort((G,Z)=>G.startLineNumber===Z.startLineNumber?G.endLineNumber-Z.endLineNumber:G.startLineNumber-Z.startLineNumber);const V=[];let U=W[0];for(let G=1;G<W.length;G++)U.endLineNumber+1>=W[G].startLineNumber?U.endLineNumber=W[G].endLineNumber:(V.push(U),U=W[G]);return V.push(U),V}}class IndentLinesAction extends EditorAction{constructor(){super({id:"editor.action.indentLines",label:localize("lines.indent","Indent Line"),alias:"Indent Line",precondition:EditorContextKeys.writable,kbOpts:{kbExpr:EditorContextKeys.editorTextFocus,primary:2142,weight:100}})}run(C,W){const V=W._getViewModel();V&&(W.pushUndoStop(),W.executeCommands(this.id,TypeOperations.indent(V.cursorConfig,W.getModel(),W.getSelections())),W.pushUndoStop())}}class OutdentLinesAction extends EditorAction{constructor(){super({id:"editor.action.outdentLines",label:localize("lines.outdent","Outdent Line"),alias:"Outdent Line",precondition:EditorContextKeys.writable,kbOpts:{kbExpr:EditorContextKeys.editorTextFocus,primary:2140,weight:100}})}run(C,W){CoreEditingCommands.Outdent.runEditorCommand(C,W,null)}}class InsertLineBeforeAction extends EditorAction{constructor(){super({id:"editor.action.insertLineBefore",label:localize("lines.insertBefore","Insert Line Above"),alias:"Insert Line Above",precondition:EditorContextKeys.writable,kbOpts:{kbExpr:EditorContextKeys.editorTextFocus,primary:3075,weight:100}})}run(C,W){const V=W._getViewModel();V&&(W.pushUndoStop(),W.executeCommands(this.id,TypeOperations.lineInsertBefore(V.cursorConfig,W.getModel(),W.getSelections())))}}class InsertLineAfterAction extends EditorAction{constructor(){super({id:"editor.action.insertLineAfter",label:localize("lines.insertAfter","Insert Line Below"),alias:"Insert Line Below",precondition:EditorContextKeys.writable,kbOpts:{kbExpr:EditorContextKeys.editorTextFocus,primary:2051,weight:100}})}run(C,W){const V=W._getViewModel();V&&(W.pushUndoStop(),W.executeCommands(this.id,TypeOperations.lineInsertAfter(V.cursorConfig,W.getModel(),W.getSelections())))}}class AbstractDeleteAllToBoundaryAction extends EditorAction{run(C,W){if(!W.hasModel())return;const V=W.getSelection(),U=this._getRangesToDelete(W),G=[];for(let Q=0,J=U.length-1;Q<J;Q++){const ee=U[Q],te=U[Q+1];Range$2.intersectRanges(ee,te)===null?G.push(ee):U[Q+1]=Range$2.plusRange(ee,te)}G.push(U[U.length-1]);const Z=this._getEndCursorState(V,G),X=G.map(Q=>EditOperation.replace(Q,""));W.pushUndoStop(),W.executeEdits(this.id,X,Z),W.pushUndoStop()}}class DeleteAllLeftAction extends AbstractDeleteAllToBoundaryAction{constructor(){super({id:"deleteAllLeft",label:localize("lines.deleteAllLeft","Delete All Left"),alias:"Delete All Left",precondition:EditorContextKeys.writable,kbOpts:{kbExpr:EditorContextKeys.textInputFocus,primary:0,mac:{primary:2049},weight:100}})}_getEndCursorState(C,W){let V=null;const U=[];let G=0;return W.forEach(Z=>{let X;if(Z.endColumn===1&&G>0){const Q=Z.startLineNumber-G;X=new Selection$1(Q,Z.startColumn,Q,Z.startColumn)}else X=new Selection$1(Z.startLineNumber,Z.startColumn,Z.startLineNumber,Z.startColumn);G+=Z.endLineNumber-Z.startLineNumber,Z.intersectRanges(C)?V=X:U.push(X)}),V&&U.unshift(V),U}_getRangesToDelete(C){const W=C.getSelections();if(W===null)return[];let V=W;const U=C.getModel();return U===null?[]:(V.sort(Range$2.compareRangesUsingStarts),V=V.map(G=>{if(G.isEmpty())if(G.startColumn===1){const Z=Math.max(1,G.startLineNumber-1),X=G.startLineNumber===1?1:U.getLineLength(Z)+1;return new Range$2(Z,X,G.startLineNumber,1)}else return new Range$2(G.startLineNumber,1,G.startLineNumber,G.startColumn);else return new Range$2(G.startLineNumber,1,G.endLineNumber,G.endColumn)}),V)}}class DeleteAllRightAction extends AbstractDeleteAllToBoundaryAction{constructor(){super({id:"deleteAllRight",label:localize("lines.deleteAllRight","Delete All Right"),alias:"Delete All Right",precondition:EditorContextKeys.writable,kbOpts:{kbExpr:EditorContextKeys.textInputFocus,primary:0,mac:{primary:297,secondary:[2068]},weight:100}})}_getEndCursorState(C,W){let V=null;const U=[];for(let G=0,Z=W.length,X=0;G<Z;G++){const Q=W[G],J=new Selection$1(Q.startLineNumber-X,Q.startColumn,Q.startLineNumber-X,Q.startColumn);Q.intersectRanges(C)?V=J:U.push(J)}return V&&U.unshift(V),U}_getRangesToDelete(C){const W=C.getModel();if(W===null)return[];const V=C.getSelections();if(V===null)return[];const U=V.map(G=>{if(G.isEmpty()){const Z=W.getLineMaxColumn(G.startLineNumber);return G.startColumn===Z?new Range$2(G.startLineNumber,G.startColumn,G.startLineNumber+1,1):new Range$2(G.startLineNumber,G.startColumn,G.startLineNumber,Z)}return G});return U.sort(Range$2.compareRangesUsingStarts),U}}class JoinLinesAction extends EditorAction{constructor(){super({id:"editor.action.joinLines",label:localize("lines.joinLines","Join Lines"),alias:"Join Lines",precondition:EditorContextKeys.writable,kbOpts:{kbExpr:EditorContextKeys.editorTextFocus,primary:0,mac:{primary:296},weight:100}})}run(C,W){const V=W.getSelections();if(V===null)return;let U=W.getSelection();if(U===null)return;V.sort(Range$2.compareRangesUsingStarts);const G=[],Z=V.reduce((ie,ne)=>ie.isEmpty()?ie.endLineNumber===ne.startLineNumber?(U.equalsSelection(ie)&&(U=ne),ne):ne.startLineNumber>ie.endLineNumber+1?(G.push(ie),ne):new Selection$1(ie.startLineNumber,ie.startColumn,ne.endLineNumber,ne.endColumn):ne.startLineNumber>ie.endLineNumber?(G.push(ie),ne):new Selection$1(ie.startLineNumber,ie.startColumn,ne.endLineNumber,ne.endColumn));G.push(Z);const X=W.getModel();if(X===null)return;const Q=[],J=[];let ee=U,te=0;for(let ie=0,ne=G.length;ie<ne;ie++){const oe=G[ie],re=oe.startLineNumber,ae=1;let se=0,le,ce;const de=X.getLineLength(oe.endLineNumber)-oe.endColumn;if(oe.isEmpty()||oe.startLineNumber===oe.endLineNumber){const he=oe.getStartPosition();he.lineNumber<X.getLineCount()?(le=re+1,ce=X.getLineMaxColumn(le)):(le=he.lineNumber,ce=X.getLineMaxColumn(he.lineNumber))}else le=oe.endLineNumber,ce=X.getLineMaxColumn(le);let ue=X.getLineContent(re);for(let he=re+1;he<=le;he++){const fe=X.getLineContent(he),pe=X.getLineFirstNonWhitespaceColumn(he);if(pe>=1){let Se=!0;ue===""&&(Se=!1),Se&&(ue.charAt(ue.length-1)===" "||ue.charAt(ue.length-1)==="	")&&(Se=!1,ue=ue.replace(/[\s\uFEFF\xA0]+$/g," "));const Le=fe.substr(pe-1);ue+=(Se?" ":"")+Le,Se?se=Le.length+1:se=Le.length}else se=0}const ge=new Range$2(re,ae,le,ce);if(!ge.isEmpty()){let he;oe.isEmpty()?(Q.push(EditOperation.replace(ge,ue)),he=new Selection$1(ge.startLineNumber-te,ue.length-se+1,re-te,ue.length-se+1)):oe.startLineNumber===oe.endLineNumber?(Q.push(EditOperation.replace(ge,ue)),he=new Selection$1(oe.startLineNumber-te,oe.startColumn,oe.endLineNumber-te,oe.endColumn)):(Q.push(EditOperation.replace(ge,ue)),he=new Selection$1(oe.startLineNumber-te,oe.startColumn,oe.startLineNumber-te,ue.length-de)),Range$2.intersectRanges(ge,U)!==null?ee=he:J.push(he)}te+=ge.endLineNumber-ge.startLineNumber}J.unshift(ee),W.pushUndoStop(),W.executeEdits(this.id,Q,J),W.pushUndoStop()}}class TransposeAction extends EditorAction{constructor(){super({id:"editor.action.transpose",label:localize("editor.transpose","Transpose Characters around the Cursor"),alias:"Transpose Characters around the Cursor",precondition:EditorContextKeys.writable})}run(C,W){const V=W.getSelections();if(V===null)return;const U=W.getModel();if(U===null)return;const G=[];for(let Z=0,X=V.length;Z<X;Z++){const Q=V[Z];if(!Q.isEmpty())continue;const J=Q.getStartPosition(),ee=U.getLineMaxColumn(J.lineNumber);if(J.column>=ee){if(J.lineNumber===U.getLineCount())continue;const te=new Range$2(J.lineNumber,Math.max(1,J.column-1),J.lineNumber+1,1),ie=U.getValueInRange(te).split("").reverse().join("");G.push(new ReplaceCommand(new Selection$1(J.lineNumber,Math.max(1,J.column-1),J.lineNumber+1,1),ie))}else{const te=new Range$2(J.lineNumber,Math.max(1,J.column-1),J.lineNumber,J.column+1),ie=U.getValueInRange(te).split("").reverse().join("");G.push(new ReplaceCommandThatPreservesSelection(te,ie,new Selection$1(J.lineNumber,J.column+1,J.lineNumber,J.column+1)))}}W.pushUndoStop(),W.executeCommands(this.id,G),W.pushUndoStop()}}class AbstractCaseAction extends EditorAction{run(C,W){const V=W.getSelections();if(V===null)return;const U=W.getModel();if(U===null)return;const G=W.getOption(129),Z=[];for(const X of V)if(X.isEmpty()){const Q=X.getStartPosition(),J=W.getConfiguredWordAtPosition(Q);if(!J)continue;const ee=new Range$2(Q.lineNumber,J.startColumn,Q.lineNumber,J.endColumn),te=U.getValueInRange(ee);Z.push(EditOperation.replace(ee,this._modifyText(te,G)))}else{const Q=U.getValueInRange(X);Z.push(EditOperation.replace(X,this._modifyText(Q,G)))}W.pushUndoStop(),W.executeEdits(this.id,Z),W.pushUndoStop()}}class UpperCaseAction extends AbstractCaseAction{constructor(){super({id:"editor.action.transformToUppercase",label:localize("editor.transformToUppercase","Transform to Uppercase"),alias:"Transform to Uppercase",precondition:EditorContextKeys.writable})}_modifyText(C,W){return C.toLocaleUpperCase()}}class LowerCaseAction extends AbstractCaseAction{constructor(){super({id:"editor.action.transformToLowercase",label:localize("editor.transformToLowercase","Transform to Lowercase"),alias:"Transform to Lowercase",precondition:EditorContextKeys.writable})}_modifyText(C,W){return C.toLocaleLowerCase()}}class BackwardsCompatibleRegExp{constructor(C,W){this._pattern=C,this._flags=W,this._actual=null,this._evaluated=!1}get(){if(!this._evaluated){this._evaluated=!0;try{this._actual=new RegExp(this._pattern,this._flags)}catch{}}return this._actual}isSupported(){return this.get()!==null}}class TitleCaseAction extends AbstractCaseAction{constructor(){super({id:"editor.action.transformToTitlecase",label:localize("editor.transformToTitlecase","Transform to Title Case"),alias:"Transform to Title Case",precondition:EditorContextKeys.writable})}_modifyText(C,W){const V=TitleCaseAction.titleBoundary.get();return V?C.toLocaleLowerCase().replace(V,U=>U.toLocaleUpperCase()):C}}TitleCaseAction.titleBoundary=new BackwardsCompatibleRegExp("(^|[^\\p{L}\\p{N}']|((^|\\P{L})'))\\p{L}","gmu");class SnakeCaseAction extends AbstractCaseAction{constructor(){super({id:"editor.action.transformToSnakecase",label:localize("editor.transformToSnakecase","Transform to Snake Case"),alias:"Transform to Snake Case",precondition:EditorContextKeys.writable})}_modifyText(C,W){const V=SnakeCaseAction.caseBoundary.get(),U=SnakeCaseAction.singleLetters.get();return!V||!U?C:C.replace(V,"$1_$2").replace(U,"$1_$2$3").toLocaleLowerCase()}}SnakeCaseAction.caseBoundary=new BackwardsCompatibleRegExp("(\\p{Ll})(\\p{Lu})","gmu");SnakeCaseAction.singleLetters=new BackwardsCompatibleRegExp("(\\p{Lu}|\\p{N})(\\p{Lu})(\\p{Ll})","gmu");class CamelCaseAction extends AbstractCaseAction{constructor(){super({id:"editor.action.transformToCamelcase",label:localize("editor.transformToCamelcase","Transform to Camel Case"),alias:"Transform to Camel Case",precondition:EditorContextKeys.writable})}_modifyText(C,W){const V=CamelCaseAction.wordBoundary.get();if(!V)return C;const U=C.split(V);return U.shift()+U.map(Z=>Z.substring(0,1).toLocaleUpperCase()+Z.substring(1)).join("")}}CamelCaseAction.wordBoundary=new BackwardsCompatibleRegExp("[_\\s-]","gm");class KebabCaseAction extends AbstractCaseAction{static isSupported(){return[this.caseBoundary,this.singleLetters,this.underscoreBoundary].every(W=>W.isSupported())}constructor(){super({id:"editor.action.transformToKebabcase",label:localize("editor.transformToKebabcase","Transform to Kebab Case"),alias:"Transform to Kebab Case",precondition:EditorContextKeys.writable})}_modifyText(C,W){const V=KebabCaseAction.caseBoundary.get(),U=KebabCaseAction.singleLetters.get(),G=KebabCaseAction.underscoreBoundary.get();return!V||!U||!G?C:C.replace(G,"$1-$3").replace(V,"$1-$2").replace(U,"$1-$2").toLocaleLowerCase()}}KebabCaseAction.caseBoundary=new BackwardsCompatibleRegExp("(\\p{Ll})(\\p{Lu})","gmu");KebabCaseAction.singleLetters=new BackwardsCompatibleRegExp("(\\p{Lu}|\\p{N})(\\p{Lu}\\p{Ll})","gmu");KebabCaseAction.underscoreBoundary=new BackwardsCompatibleRegExp("(\\S)(_)(\\S)","gm");registerEditorAction(CopyLinesUpAction);registerEditorAction(CopyLinesDownAction);registerEditorAction(DuplicateSelectionAction);registerEditorAction(MoveLinesUpAction);registerEditorAction(MoveLinesDownAction);registerEditorAction(SortLinesAscendingAction);registerEditorAction(SortLinesDescendingAction);registerEditorAction(DeleteDuplicateLinesAction);registerEditorAction(TrimTrailingWhitespaceAction);registerEditorAction(DeleteLinesAction);registerEditorAction(IndentLinesAction);registerEditorAction(OutdentLinesAction);registerEditorAction(InsertLineBeforeAction);registerEditorAction(InsertLineAfterAction);registerEditorAction(DeleteAllLeftAction);registerEditorAction(DeleteAllRightAction);registerEditorAction(JoinLinesAction);registerEditorAction(TransposeAction);registerEditorAction(UpperCaseAction);registerEditorAction(LowerCaseAction);SnakeCaseAction.caseBoundary.isSupported()&&SnakeCaseAction.singleLetters.isSupported()&&registerEditorAction(SnakeCaseAction);CamelCaseAction.wordBoundary.isSupported()&&registerEditorAction(CamelCaseAction);TitleCaseAction.titleBoundary.isSupported()&&registerEditorAction(TitleCaseAction);KebabCaseAction.isSupported()&&registerEditorAction(KebabCaseAction);const linkedEditing="";var __decorate$q=globalThis&&globalThis.__decorate||function(K,C,W,V){var U=arguments.length,G=U<3?C:V===null?V=Object.getOwnPropertyDescriptor(C,W):V,Z;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")G=Reflect.decorate(K,C,W,V);else for(var X=K.length-1;X>=0;X--)(Z=K[X])&&(G=(U<3?Z(G):U>3?Z(C,W,G):Z(C,W))||G);return U>3&&G&&Object.defineProperty(C,W,G),G},__param$q=globalThis&&globalThis.__param||function(K,C){return function(W,V){C(W,V,K)}},__awaiter$j=globalThis&&globalThis.__awaiter||function(K,C,W,V){function U(G){return G instanceof W?G:new W(function(Z){Z(G)})}return new(W||(W=Promise))(function(G,Z){function X(ee){try{J(V.next(ee))}catch(te){Z(te)}}function Q(ee){try{J(V.throw(ee))}catch(te){Z(te)}}function J(ee){ee.done?G(ee.value):U(ee.value).then(X,Q)}J((V=V.apply(K,C||[])).next())})},LinkedEditingContribution_1;const CONTEXT_ONTYPE_RENAME_INPUT_VISIBLE=new RawContextKey("LinkedEditingInputVisible",!1),DECORATION_CLASS_NAME="linked-editing-decoration";let LinkedEditingContribution=LinkedEditingContribution_1=class extends Disposable{static get(C){return C.getContribution(LinkedEditingContribution_1.ID)}constructor(C,W,V,U,G){super(),this.languageConfigurationService=U,this._syncRangesToken=0,this._localToDispose=this._register(new DisposableStore),this._editor=C,this._providers=V.linkedEditingRangeProvider,this._enabled=!1,this._visibleContextKey=CONTEXT_ONTYPE_RENAME_INPUT_VISIBLE.bindTo(W),this._debounceInformation=G.for(this._providers,"Linked Editing",{max:200}),this._currentDecorations=this._editor.createDecorationsCollection(),this._languageWordPattern=null,this._currentWordPattern=null,this._ignoreChangeEvent=!1,this._localToDispose=this._register(new DisposableStore),this._rangeUpdateTriggerPromise=null,this._rangeSyncTriggerPromise=null,this._currentRequest=null,this._currentRequestPosition=null,this._currentRequestModelVersion=null,this._register(this._editor.onDidChangeModel(()=>this.reinitialize(!0))),this._register(this._editor.onDidChangeConfiguration(Z=>{(Z.hasChanged(69)||Z.hasChanged(92))&&this.reinitialize(!1)})),this._register(this._providers.onDidChange(()=>this.reinitialize(!1))),this._register(this._editor.onDidChangeModelLanguage(()=>this.reinitialize(!0))),this.reinitialize(!0)}reinitialize(C){const W=this._editor.getModel(),V=W!==null&&(this._editor.getOption(69)||this._editor.getOption(92))&&this._providers.has(W);if(V===this._enabled&&!C||(this._enabled=V,this.clearRanges(),this._localToDispose.clear(),!V||W===null))return;this._localToDispose.add(Event$1.runAndSubscribe(W.onDidChangeLanguageConfiguration,()=>{this._languageWordPattern=this.languageConfigurationService.getLanguageConfiguration(W.getLanguageId()).getWordDefinition()}));const U=new Delayer(this._debounceInformation.get(W)),G=()=>{var Q;this._rangeUpdateTriggerPromise=U.trigger(()=>this.updateRanges(),(Q=this._debounceDuration)!==null&&Q!==void 0?Q:this._debounceInformation.get(W))},Z=new Delayer(0),X=Q=>{this._rangeSyncTriggerPromise=Z.trigger(()=>this._syncRanges(Q))};this._localToDispose.add(this._editor.onDidChangeCursorPosition(()=>{G()})),this._localToDispose.add(this._editor.onDidChangeModelContent(Q=>{if(!this._ignoreChangeEvent&&this._currentDecorations.length>0){const J=this._currentDecorations.getRange(0);if(J&&Q.changes.every(ee=>J.intersectRanges(ee.range))){X(this._syncRangesToken);return}}G()})),this._localToDispose.add({dispose:()=>{U.dispose(),Z.dispose()}}),this.updateRanges()}_syncRanges(C){if(!this._editor.hasModel()||C!==this._syncRangesToken||this._currentDecorations.length===0)return;const W=this._editor.getModel(),V=this._currentDecorations.getRange(0);if(!V||V.startLineNumber!==V.endLineNumber)return this.clearRanges();const U=W.getValueInRange(V);if(this._currentWordPattern){const Z=U.match(this._currentWordPattern);if((Z?Z[0].length:0)!==U.length)return this.clearRanges()}const G=[];for(let Z=1,X=this._currentDecorations.length;Z<X;Z++){const Q=this._currentDecorations.getRange(Z);if(Q)if(Q.startLineNumber!==Q.endLineNumber)G.push({range:Q,text:U});else{let J=W.getValueInRange(Q),ee=U,te=Q.startColumn,ie=Q.endColumn;const ne=commonPrefixLength(J,ee);te+=ne,J=J.substr(ne),ee=ee.substr(ne);const oe=commonSuffixLength(J,ee);ie-=oe,J=J.substr(0,J.length-oe),ee=ee.substr(0,ee.length-oe),(te!==ie||ee.length!==0)&&G.push({range:new Range$2(Q.startLineNumber,te,Q.endLineNumber,ie),text:ee})}}if(G.length!==0)try{this._editor.popUndoStop(),this._ignoreChangeEvent=!0;const Z=this._editor._getViewModel().getPrevEditOperationType();this._editor.executeEdits("linkedEditing",G),this._editor._getViewModel().setPrevEditOperationType(Z)}finally{this._ignoreChangeEvent=!1}}dispose(){this.clearRanges(),super.dispose()}clearRanges(){this._visibleContextKey.set(!1),this._currentDecorations.clear(),this._currentRequest&&(this._currentRequest.cancel(),this._currentRequest=null,this._currentRequestPosition=null)}updateRanges(C=!1){return __awaiter$j(this,void 0,void 0,function*(){if(!this._editor.hasModel()){this.clearRanges();return}const W=this._editor.getPosition();if(!this._enabled&&!C||this._editor.getSelections().length>1){this.clearRanges();return}const V=this._editor.getModel(),U=V.getVersionId();if(this._currentRequestPosition&&this._currentRequestModelVersion===U){if(W.equals(this._currentRequestPosition))return;if(this._currentDecorations.length>0){const Z=this._currentDecorations.getRange(0);if(Z&&Z.containsPosition(W))return}}this.clearRanges(),this._currentRequestPosition=W,this._currentRequestModelVersion=U;const G=createCancelablePromise(Z=>__awaiter$j(this,void 0,void 0,function*(){try{const X=new StopWatch(!1),Q=yield getLinkedEditingRanges(this._providers,V,W,Z);if(this._debounceInformation.update(V,X.elapsed()),G!==this._currentRequest||(this._currentRequest=null,U!==V.getVersionId()))return;let J=[];Q!=null&&Q.ranges&&(J=Q.ranges),this._currentWordPattern=(Q==null?void 0:Q.wordPattern)||this._languageWordPattern;let ee=!1;for(let ie=0,ne=J.length;ie<ne;ie++)if(Range$2.containsPosition(J[ie],W)){if(ee=!0,ie!==0){const oe=J[ie];J.splice(ie,1),J.unshift(oe)}break}if(!ee){this.clearRanges();return}const te=J.map(ie=>({range:ie,options:LinkedEditingContribution_1.DECORATION}));this._visibleContextKey.set(!0),this._currentDecorations.set(te),this._syncRangesToken++}catch(X){isCancellationError(X)||onUnexpectedError(X),(this._currentRequest===G||!this._currentRequest)&&this.clearRanges()}}));return this._currentRequest=G,G})}};LinkedEditingContribution.ID="editor.contrib.linkedEditing";LinkedEditingContribution.DECORATION=ModelDecorationOptions.register({description:"linked-editing",stickiness:0,className:DECORATION_CLASS_NAME});LinkedEditingContribution=LinkedEditingContribution_1=__decorate$q([__param$q(1,IContextKeyService),__param$q(2,ILanguageFeaturesService),__param$q(3,ILanguageConfigurationService),__param$q(4,ILanguageFeatureDebounceService)],LinkedEditingContribution);class LinkedEditingAction extends EditorAction{constructor(){super({id:"editor.action.linkedEditing",label:localize("linkedEditing.label","Start Linked Editing"),alias:"Start Linked Editing",precondition:ContextKeyExpr.and(EditorContextKeys.writable,EditorContextKeys.hasRenameProvider),kbOpts:{kbExpr:EditorContextKeys.editorTextFocus,primary:3132,weight:100}})}runCommand(C,W){const V=C.get(ICodeEditorService),[U,G]=Array.isArray(W)&&W||[void 0,void 0];return URI.isUri(U)&&Position$1.isIPosition(G)?V.openCodeEditor({resource:U},V.getActiveCodeEditor()).then(Z=>{Z&&(Z.setPosition(G),Z.invokeWithinContext(X=>(this.reportTelemetry(X,Z),this.run(X,Z))))},onUnexpectedError):super.runCommand(C,W)}run(C,W){const V=LinkedEditingContribution.get(W);return V?Promise.resolve(V.updateRanges(!0)):Promise.resolve()}}const LinkedEditingCommand=EditorCommand.bindToContribution(LinkedEditingContribution.get);registerEditorCommand(new LinkedEditingCommand({id:"cancelLinkedEditingInput",precondition:CONTEXT_ONTYPE_RENAME_INPUT_VISIBLE,handler:K=>K.clearRanges(),kbOpts:{kbExpr:EditorContextKeys.editorTextFocus,weight:100+99,primary:9,secondary:[1033]}}));function getLinkedEditingRanges(K,C,W,V){const U=K.ordered(C);return first(U.map(G=>()=>__awaiter$j(this,void 0,void 0,function*(){try{return yield G.provideLinkedEditingRanges(C,W,V)}catch(Z){onUnexpectedExternalError(Z);return}})),G=>!!G&&isNonEmptyArray$2(G==null?void 0:G.ranges))}registerColor("editor.linkedEditingBackground",{dark:Color.fromHex("#f00").transparent(.3),light:Color.fromHex("#f00").transparent(.3),hcDark:Color.fromHex("#f00").transparent(.3),hcLight:Color.white},localize("editorLinkedEditingBackground","Background color when the editor auto renames on type."));registerModelAndPositionCommand("_executeLinkedEditingProvider",(K,C,W)=>{const{linkedEditingRangeProvider:V}=K.get(ILanguageFeaturesService);return getLinkedEditingRanges(V,C,W,CancellationToken.None)});registerEditorContribution(LinkedEditingContribution.ID,LinkedEditingContribution,1);registerEditorAction(LinkedEditingAction);const links="";var __awaiter$i=globalThis&&globalThis.__awaiter||function(K,C,W,V){function U(G){return G instanceof W?G:new W(function(Z){Z(G)})}return new(W||(W=Promise))(function(G,Z){function X(ee){try{J(V.next(ee))}catch(te){Z(te)}}function Q(ee){try{J(V.throw(ee))}catch(te){Z(te)}}function J(ee){ee.done?G(ee.value):U(ee.value).then(X,Q)}J((V=V.apply(K,C||[])).next())})};let Link$1=class{constructor(C,W){this._link=C,this._provider=W}toJSON(){return{range:this.range,url:this.url,tooltip:this.tooltip}}get range(){return this._link.range}get url(){return this._link.url}get tooltip(){return this._link.tooltip}resolve(C){return __awaiter$i(this,void 0,void 0,function*(){return this._link.url?this._link.url:typeof this._provider.resolveLink=="function"?Promise.resolve(this._provider.resolveLink(this._link,C)).then(W=>(this._link=W||this._link,this._link.url?this.resolve(C):Promise.reject(new Error("missing")))):Promise.reject(new Error("missing"))})}};class LinksList{constructor(C){this._disposables=new DisposableStore;let W=[];for(const[V,U]of C){const G=V.links.map(Z=>new Link$1(Z,U));W=LinksList._union(W,G),isDisposable(V)&&this._disposables.add(V)}this.links=W}dispose(){this._disposables.dispose(),this.links.length=0}static _union(C,W){const V=[];let U,G,Z,X;for(U=0,Z=0,G=C.length,X=W.length;U<G&&Z<X;){const Q=C[U],J=W[Z];if(Range$2.areIntersectingOrTouching(Q.range,J.range)){U++;continue}Range$2.compareRangesUsingStarts(Q.range,J.range)<0?(V.push(Q),U++):(V.push(J),Z++)}for(;U<G;U++)V.push(C[U]);for(;Z<X;Z++)V.push(W[Z]);return V}}function getLinks(K,C,W){const V=[],U=K.ordered(C).reverse().map((G,Z)=>Promise.resolve(G.provideLinks(C,W)).then(X=>{X&&(V[Z]=[X,G])},onUnexpectedExternalError));return Promise.all(U).then(()=>{const G=new LinksList(coalesce(V));return W.isCancellationRequested?(G.dispose(),new LinksList([])):G})}CommandsRegistry.registerCommand("_executeLinkProvider",(K,...C)=>__awaiter$i(void 0,void 0,void 0,function*(){let[W,V]=C;assertType(W instanceof URI),typeof V!="number"&&(V=0);const{linkProvider:U}=K.get(ILanguageFeaturesService),G=K.get(IModelService).getModel(W);if(!G)return[];const Z=yield getLinks(U,G,CancellationToken.None);if(!Z)return[];for(let Q=0;Q<Math.min(V,Z.links.length);Q++)yield Z.links[Q].resolve(CancellationToken.None);const X=Z.links.slice(0);return Z.dispose(),X}));var __decorate$p=globalThis&&globalThis.__decorate||function(K,C,W,V){var U=arguments.length,G=U<3?C:V===null?V=Object.getOwnPropertyDescriptor(C,W):V,Z;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")G=Reflect.decorate(K,C,W,V);else for(var X=K.length-1;X>=0;X--)(Z=K[X])&&(G=(U<3?Z(G):U>3?Z(C,W,G):Z(C,W))||G);return U>3&&G&&Object.defineProperty(C,W,G),G},__param$p=globalThis&&globalThis.__param||function(K,C){return function(W,V){C(W,V,K)}},__awaiter$h=globalThis&&globalThis.__awaiter||function(K,C,W,V){function U(G){return G instanceof W?G:new W(function(Z){Z(G)})}return new(W||(W=Promise))(function(G,Z){function X(ee){try{J(V.next(ee))}catch(te){Z(te)}}function Q(ee){try{J(V.throw(ee))}catch(te){Z(te)}}function J(ee){ee.done?G(ee.value):U(ee.value).then(X,Q)}J((V=V.apply(K,C||[])).next())})},LinkDetector_1;let LinkDetector=LinkDetector_1=class extends Disposable{static get(C){return C.getContribution(LinkDetector_1.ID)}constructor(C,W,V,U,G){super(),this.editor=C,this.openerService=W,this.notificationService=V,this.languageFeaturesService=U,this.providers=this.languageFeaturesService.linkProvider,this.debounceInformation=G.for(this.providers,"Links",{min:1e3,max:4e3}),this.computeLinks=this._register(new RunOnceScheduler(()=>this.computeLinksNow(),1e3)),this.computePromise=null,this.activeLinksList=null,this.currentOccurrences={},this.activeLinkDecorationId=null;const Z=this._register(new ClickLinkGesture(C));this._register(Z.onMouseMoveOrRelevantKeyDown(([X,Q])=>{this._onEditorMouseMove(X,Q)})),this._register(Z.onExecute(X=>{this.onEditorMouseUp(X)})),this._register(Z.onCancel(X=>{this.cleanUpActiveLinkDecoration()})),this._register(C.onDidChangeConfiguration(X=>{X.hasChanged(70)&&(this.updateDecorations([]),this.stop(),this.computeLinks.schedule(0))})),this._register(C.onDidChangeModelContent(X=>{this.editor.hasModel()&&this.computeLinks.schedule(this.debounceInformation.get(this.editor.getModel()))})),this._register(C.onDidChangeModel(X=>{this.currentOccurrences={},this.activeLinkDecorationId=null,this.stop(),this.computeLinks.schedule(0)})),this._register(C.onDidChangeModelLanguage(X=>{this.stop(),this.computeLinks.schedule(0)})),this._register(this.providers.onDidChange(X=>{this.stop(),this.computeLinks.schedule(0)})),this.computeLinks.schedule(0)}computeLinksNow(){return __awaiter$h(this,void 0,void 0,function*(){if(!this.editor.hasModel()||!this.editor.getOption(70))return;const C=this.editor.getModel();if(!C.isTooLargeForSyncing()&&this.providers.has(C)){this.activeLinksList&&(this.activeLinksList.dispose(),this.activeLinksList=null),this.computePromise=createCancelablePromise(W=>getLinks(this.providers,C,W));try{const W=new StopWatch(!1);if(this.activeLinksList=yield this.computePromise,this.debounceInformation.update(C,W.elapsed()),C.isDisposed())return;this.updateDecorations(this.activeLinksList.links)}catch(W){onUnexpectedError(W)}finally{this.computePromise=null}}})}updateDecorations(C){const W=this.editor.getOption(77)==="altKey",V=[],U=Object.keys(this.currentOccurrences);for(const Z of U){const X=this.currentOccurrences[Z];V.push(X.decorationId)}const G=[];if(C)for(const Z of C)G.push(LinkOccurrence.decoration(Z,W));this.editor.changeDecorations(Z=>{const X=Z.deltaDecorations(V,G);this.currentOccurrences={},this.activeLinkDecorationId=null;for(let Q=0,J=X.length;Q<J;Q++){const ee=new LinkOccurrence(C[Q],X[Q]);this.currentOccurrences[ee.decorationId]=ee}})}_onEditorMouseMove(C,W){const V=this.editor.getOption(77)==="altKey";if(this.isEnabled(C,W)){this.cleanUpActiveLinkDecoration();const U=this.getLinkOccurrence(C.target.position);U&&this.editor.changeDecorations(G=>{U.activate(G,V),this.activeLinkDecorationId=U.decorationId})}else this.cleanUpActiveLinkDecoration()}cleanUpActiveLinkDecoration(){const C=this.editor.getOption(77)==="altKey";if(this.activeLinkDecorationId){const W=this.currentOccurrences[this.activeLinkDecorationId];W&&this.editor.changeDecorations(V=>{W.deactivate(V,C)}),this.activeLinkDecorationId=null}}onEditorMouseUp(C){if(!this.isEnabled(C))return;const W=this.getLinkOccurrence(C.target.position);W&&this.openLinkOccurrence(W,C.hasSideBySideModifier,!0)}openLinkOccurrence(C,W,V=!1){if(!this.openerService)return;const{link:U}=C;U.resolve(CancellationToken.None).then(G=>{if(typeof G=="string"&&this.editor.hasModel()){const Z=this.editor.getModel().uri;if(Z.scheme===Schemas.file&&G.startsWith(`${Schemas.file}:`)){const X=URI.parse(G);if(X.scheme===Schemas.file){const Q=originalFSPath(X);let J=null;Q.startsWith("/./")?J=`.${Q.substr(1)}`:Q.startsWith("//./")&&(J=`.${Q.substr(2)}`),J&&(G=joinPath(Z,J))}}}return this.openerService.open(G,{openToSide:W,fromUserGesture:V,allowContributedOpeners:!0,allowCommands:!0,fromWorkspace:!0})},G=>{const Z=G instanceof Error?G.message:G;Z==="invalid"?this.notificationService.warn(localize("invalid.url","Failed to open this link because it is not well-formed: {0}",U.url.toString())):Z==="missing"?this.notificationService.warn(localize("missing.url","Failed to open this link because its target is missing.")):onUnexpectedError(G)})}getLinkOccurrence(C){if(!this.editor.hasModel()||!C)return null;const W=this.editor.getModel().getDecorationsInRange({startLineNumber:C.lineNumber,startColumn:C.column,endLineNumber:C.lineNumber,endColumn:C.column},0,!0);for(const V of W){const U=this.currentOccurrences[V.id];if(U)return U}return null}isEnabled(C,W){return!!(C.target.type===6&&(C.hasTriggerModifier||W&&W.keyCodeIsTriggerKey))}stop(){var C;this.computeLinks.cancel(),this.activeLinksList&&((C=this.activeLinksList)===null||C===void 0||C.dispose(),this.activeLinksList=null),this.computePromise&&(this.computePromise.cancel(),this.computePromise=null)}dispose(){super.dispose(),this.stop()}};LinkDetector.ID="editor.linkDetector";LinkDetector=LinkDetector_1=__decorate$p([__param$p(1,IOpenerService),__param$p(2,INotificationService),__param$p(3,ILanguageFeaturesService),__param$p(4,ILanguageFeatureDebounceService)],LinkDetector);const decoration={general:ModelDecorationOptions.register({description:"detected-link",stickiness:1,collapseOnReplaceEdit:!0,inlineClassName:"detected-link"}),active:ModelDecorationOptions.register({description:"detected-link-active",stickiness:1,collapseOnReplaceEdit:!0,inlineClassName:"detected-link-active"})};class LinkOccurrence{static decoration(C,W){return{range:C.range,options:LinkOccurrence._getOptions(C,W,!1)}}static _getOptions(C,W,V){const U=Object.assign({},V?decoration.active:decoration.general);return U.hoverMessage=getHoverMessage(C,W),U}constructor(C,W){this.link=C,this.decorationId=W}activate(C,W){C.changeDecorationOptions(this.decorationId,LinkOccurrence._getOptions(this.link,W,!0))}deactivate(C,W){C.changeDecorationOptions(this.decorationId,LinkOccurrence._getOptions(this.link,W,!1))}}function getHoverMessage(K,C){const W=K.url&&/^command:/i.test(K.url.toString()),V=K.tooltip?K.tooltip:W?localize("links.navigate.executeCmd","Execute command"):localize("links.navigate.follow","Follow link"),U=C?isMacintosh?localize("links.navigate.kb.meta.mac","cmd + click"):localize("links.navigate.kb.meta","ctrl + click"):isMacintosh?localize("links.navigate.kb.alt.mac","option + click"):localize("links.navigate.kb.alt","alt + click");if(K.url){let G="";if(/^command:/i.test(K.url.toString())){const X=K.url.toString().match(/^command:([^?#]+)/);if(X){const Q=X[1];G=localize("tooltip.explanation","Execute command {0}",Q)}}return new MarkdownString("",!0).appendLink(K.url.toString(!0).replace(/ /g,"%20"),V,G).appendMarkdown(` (${U})`)}else return new MarkdownString().appendText(`${V} (${U})`)}class OpenLinkAction extends EditorAction{constructor(){super({id:"editor.action.openLink",label:localize("label","Open Link"),alias:"Open Link",precondition:void 0})}run(C,W){const V=LinkDetector.get(W);if(!V||!W.hasModel())return;const U=W.getSelections();for(const G of U){const Z=V.getLinkOccurrence(G.getEndPosition());Z&&V.openLinkOccurrence(Z,!1)}}}registerEditorContribution(LinkDetector.ID,LinkDetector,1);registerEditorAction(OpenLinkAction);class LongLinesHelper extends Disposable{constructor(C){super(),this._editor=C,this._register(this._editor.onMouseDown(W=>{const V=this._editor.getOption(116);V>=0&&W.target.type===6&&W.target.position.column>=V&&this._editor.updateOptions({stopRenderingLineAfter:-1})}))}}LongLinesHelper.ID="editor.contrib.longLinesHelper";registerEditorContribution(LongLinesHelper.ID,LongLinesHelper,2);const highlightDecorations="",wordHighlightBackground=registerColor("editor.wordHighlightBackground",{dark:"#575757B8",light:"#57575740",hcDark:null,hcLight:null},localize("wordHighlight","Background color of a symbol during read-access, like reading a variable. The color must not be opaque so as not to hide underlying decorations."),!0);registerColor("editor.wordHighlightStrongBackground",{dark:"#004972B8",light:"#0e639c40",hcDark:null,hcLight:null},localize("wordHighlightStrong","Background color of a symbol during write-access, like writing to a variable. The color must not be opaque so as not to hide underlying decorations."),!0);registerColor("editor.wordHighlightTextBackground",{light:wordHighlightBackground,dark:wordHighlightBackground,hcDark:wordHighlightBackground,hcLight:wordHighlightBackground},localize("wordHighlightText","Background color of a textual occurrence for a symbol. The color must not be opaque so as not to hide underlying decorations."),!0);const wordHighlightBorder=registerColor("editor.wordHighlightBorder",{light:null,dark:null,hcDark:activeContrastBorder,hcLight:activeContrastBorder},localize("wordHighlightBorder","Border color of a symbol during read-access, like reading a variable."));registerColor("editor.wordHighlightStrongBorder",{light:null,dark:null,hcDark:activeContrastBorder,hcLight:activeContrastBorder},localize("wordHighlightStrongBorder","Border color of a symbol during write-access, like writing to a variable."));registerColor("editor.wordHighlightTextBorder",{light:wordHighlightBorder,dark:wordHighlightBorder,hcDark:wordHighlightBorder,hcLight:wordHighlightBorder},localize("wordHighlightTextBorder","Border color of a textual occurrence for a symbol."));const overviewRulerWordHighlightForeground=registerColor("editorOverviewRuler.wordHighlightForeground",{dark:"#A0A0A0CC",light:"#A0A0A0CC",hcDark:"#A0A0A0CC",hcLight:"#A0A0A0CC"},localize("overviewRulerWordHighlightForeground","Overview ruler marker color for symbol highlights. The color must not be opaque so as not to hide underlying decorations."),!0),overviewRulerWordHighlightStrongForeground=registerColor("editorOverviewRuler.wordHighlightStrongForeground",{dark:"#C0A0C0CC",light:"#C0A0C0CC",hcDark:"#C0A0C0CC",hcLight:"#C0A0C0CC"},localize("overviewRulerWordHighlightStrongForeground","Overview ruler marker color for write-access symbol highlights. The color must not be opaque so as not to hide underlying decorations."),!0),overviewRulerWordHighlightTextForeground=registerColor("editorOverviewRuler.wordHighlightTextForeground",{dark:overviewRulerSelectionHighlightForeground,light:overviewRulerSelectionHighlightForeground,hcDark:overviewRulerSelectionHighlightForeground,hcLight:overviewRulerSelectionHighlightForeground},localize("overviewRulerWordHighlightTextForeground","Overview ruler marker color of a textual occurrence for a symbol. The color must not be opaque so as not to hide underlying decorations."),!0),_WRITE_OPTIONS=ModelDecorationOptions.register({description:"word-highlight-strong",stickiness:1,className:"wordHighlightStrong",overviewRuler:{color:themeColorFromId(overviewRulerWordHighlightStrongForeground),position:OverviewRulerLane.Center},minimap:{color:themeColorFromId(minimapSelectionOccurrenceHighlight),position:MinimapPosition.Inline}}),_TEXT_OPTIONS=ModelDecorationOptions.register({description:"word-highlight-text",stickiness:1,className:"wordHighlightText",overviewRuler:{color:themeColorFromId(overviewRulerWordHighlightTextForeground),position:OverviewRulerLane.Center},minimap:{color:themeColorFromId(minimapSelectionOccurrenceHighlight),position:MinimapPosition.Inline}}),_SELECTION_HIGHLIGHT_OPTIONS=ModelDecorationOptions.register({description:"selection-highlight-overview",stickiness:1,className:"selectionHighlight",overviewRuler:{color:themeColorFromId(overviewRulerSelectionHighlightForeground),position:OverviewRulerLane.Center},minimap:{color:themeColorFromId(minimapSelectionOccurrenceHighlight),position:MinimapPosition.Inline}}),_SELECTION_HIGHLIGHT_OPTIONS_NO_OVERVIEW=ModelDecorationOptions.register({description:"selection-highlight",stickiness:1,className:"selectionHighlight"}),_REGULAR_OPTIONS=ModelDecorationOptions.register({description:"word-highlight",stickiness:1,className:"wordHighlight",overviewRuler:{color:themeColorFromId(overviewRulerWordHighlightForeground),position:OverviewRulerLane.Center},minimap:{color:themeColorFromId(minimapSelectionOccurrenceHighlight),position:MinimapPosition.Inline}});function getHighlightDecorationOptions(K){return K===DocumentHighlightKind$1.Write?_WRITE_OPTIONS:K===DocumentHighlightKind$1.Text?_TEXT_OPTIONS:_REGULAR_OPTIONS}function getSelectionHighlightDecorationOptions(K){return K?_SELECTION_HIGHLIGHT_OPTIONS_NO_OVERVIEW:_SELECTION_HIGHLIGHT_OPTIONS}registerThemingParticipant((K,C)=>{const W=K.getColor(editorSelectionHighlight);W&&C.addRule(`.monaco-editor .selectionHighlight { background-color: ${W.transparent(.5)}; }`)});var __decorate$o=globalThis&&globalThis.__decorate||function(K,C,W,V){var U=arguments.length,G=U<3?C:V===null?V=Object.getOwnPropertyDescriptor(C,W):V,Z;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")G=Reflect.decorate(K,C,W,V);else for(var X=K.length-1;X>=0;X--)(Z=K[X])&&(G=(U<3?Z(G):U>3?Z(C,W,G):Z(C,W))||G);return U>3&&G&&Object.defineProperty(C,W,G),G},__param$o=globalThis&&globalThis.__param||function(K,C){return function(W,V){C(W,V,K)}},SelectionHighlighter_1;function announceCursorChange(K,C){const W=C.filter(V=>!K.find(U=>U.equals(V)));if(W.length>=1){const V=W.map(G=>`line ${G.viewState.position.lineNumber} column ${G.viewState.position.column}`).join(", "),U=W.length===1?localize("cursorAdded","Cursor added: {0}",V):localize("cursorsAdded","Cursors added: {0}",V);status(U)}}class InsertCursorAbove extends EditorAction{constructor(){super({id:"editor.action.insertCursorAbove",label:localize("mutlicursor.insertAbove","Add Cursor Above"),alias:"Add Cursor Above",precondition:void 0,kbOpts:{kbExpr:EditorContextKeys.editorTextFocus,primary:2576,linux:{primary:1552,secondary:[3088]},weight:100},menuOpts:{menuId:MenuId.MenubarSelectionMenu,group:"3_multi",title:localize({key:"miInsertCursorAbove",comment:["&& denotes a mnemonic"]},"&&Add Cursor Above"),order:2}})}run(C,W,V){if(!W.hasModel())return;let U=!0;V&&V.logicalLine===!1&&(U=!1);const G=W._getViewModel();if(G.cursorConfig.readOnly)return;G.model.pushStackElement();const Z=G.getCursorStates();G.setCursorStates(V.source,3,CursorMoveCommands.addCursorUp(G,Z,U)),G.revealTopMostCursor(V.source),announceCursorChange(Z,G.getCursorStates())}}class InsertCursorBelow extends EditorAction{constructor(){super({id:"editor.action.insertCursorBelow",label:localize("mutlicursor.insertBelow","Add Cursor Below"),alias:"Add Cursor Below",precondition:void 0,kbOpts:{kbExpr:EditorContextKeys.editorTextFocus,primary:2578,linux:{primary:1554,secondary:[3090]},weight:100},menuOpts:{menuId:MenuId.MenubarSelectionMenu,group:"3_multi",title:localize({key:"miInsertCursorBelow",comment:["&& denotes a mnemonic"]},"A&&dd Cursor Below"),order:3}})}run(C,W,V){if(!W.hasModel())return;let U=!0;V&&V.logicalLine===!1&&(U=!1);const G=W._getViewModel();if(G.cursorConfig.readOnly)return;G.model.pushStackElement();const Z=G.getCursorStates();G.setCursorStates(V.source,3,CursorMoveCommands.addCursorDown(G,Z,U)),G.revealBottomMostCursor(V.source),announceCursorChange(Z,G.getCursorStates())}}class InsertCursorAtEndOfEachLineSelected extends EditorAction{constructor(){super({id:"editor.action.insertCursorAtEndOfEachLineSelected",label:localize("mutlicursor.insertAtEndOfEachLineSelected","Add Cursors to Line Ends"),alias:"Add Cursors to Line Ends",precondition:void 0,kbOpts:{kbExpr:EditorContextKeys.editorTextFocus,primary:1575,weight:100},menuOpts:{menuId:MenuId.MenubarSelectionMenu,group:"3_multi",title:localize({key:"miInsertCursorAtEndOfEachLineSelected",comment:["&& denotes a mnemonic"]},"Add C&&ursors to Line Ends"),order:4}})}getCursorsForSelection(C,W,V){if(!C.isEmpty()){for(let U=C.startLineNumber;U<C.endLineNumber;U++){const G=W.getLineMaxColumn(U);V.push(new Selection$1(U,G,U,G))}C.endColumn>1&&V.push(new Selection$1(C.endLineNumber,C.endColumn,C.endLineNumber,C.endColumn))}}run(C,W){if(!W.hasModel())return;const V=W.getModel(),U=W.getSelections(),G=W._getViewModel(),Z=G.getCursorStates(),X=[];U.forEach(Q=>this.getCursorsForSelection(Q,V,X)),X.length>0&&W.setSelections(X),announceCursorChange(Z,G.getCursorStates())}}class InsertCursorAtEndOfLineSelected extends EditorAction{constructor(){super({id:"editor.action.addCursorsToBottom",label:localize("mutlicursor.addCursorsToBottom","Add Cursors To Bottom"),alias:"Add Cursors To Bottom",precondition:void 0})}run(C,W){if(!W.hasModel())return;const V=W.getSelections(),U=W.getModel().getLineCount(),G=[];for(let Q=V[0].startLineNumber;Q<=U;Q++)G.push(new Selection$1(Q,V[0].startColumn,Q,V[0].endColumn));const Z=W._getViewModel(),X=Z.getCursorStates();G.length>0&&W.setSelections(G),announceCursorChange(X,Z.getCursorStates())}}class InsertCursorAtTopOfLineSelected extends EditorAction{constructor(){super({id:"editor.action.addCursorsToTop",label:localize("mutlicursor.addCursorsToTop","Add Cursors To Top"),alias:"Add Cursors To Top",precondition:void 0})}run(C,W){if(!W.hasModel())return;const V=W.getSelections(),U=[];for(let X=V[0].startLineNumber;X>=1;X--)U.push(new Selection$1(X,V[0].startColumn,X,V[0].endColumn));const G=W._getViewModel(),Z=G.getCursorStates();U.length>0&&W.setSelections(U),announceCursorChange(Z,G.getCursorStates())}}class MultiCursorSessionResult{constructor(C,W,V){this.selections=C,this.revealRange=W,this.revealScrollType=V}}class MultiCursorSession{static create(C,W){if(!C.hasModel())return null;const V=W.getState();if(!C.hasTextFocus()&&V.isRevealed&&V.searchString.length>0)return new MultiCursorSession(C,W,!1,V.searchString,V.wholeWord,V.matchCase,null);let U=!1,G,Z;const X=C.getSelections();X.length===1&&X[0].isEmpty()?(U=!0,G=!0,Z=!0):(G=V.wholeWord,Z=V.matchCase);const Q=C.getSelection();let J,ee=null;if(Q.isEmpty()){const te=C.getConfiguredWordAtPosition(Q.getStartPosition());if(!te)return null;J=te.word,ee=new Selection$1(Q.startLineNumber,te.startColumn,Q.startLineNumber,te.endColumn)}else J=C.getModel().getValueInRange(Q).replace(/\r\n/g,`
`);return new MultiCursorSession(C,W,U,J,G,Z,ee)}constructor(C,W,V,U,G,Z,X){this._editor=C,this.findController=W,this.isDisconnectedFromFindController=V,this.searchText=U,this.wholeWord=G,this.matchCase=Z,this.currentMatch=X}addSelectionToNextFindMatch(){if(!this._editor.hasModel())return null;const C=this._getNextMatch();if(!C)return null;const W=this._editor.getSelections();return new MultiCursorSessionResult(W.concat(C),C,0)}moveSelectionToNextFindMatch(){if(!this._editor.hasModel())return null;const C=this._getNextMatch();if(!C)return null;const W=this._editor.getSelections();return new MultiCursorSessionResult(W.slice(0,W.length-1).concat(C),C,0)}_getNextMatch(){if(!this._editor.hasModel())return null;if(this.currentMatch){const U=this.currentMatch;return this.currentMatch=null,U}this.findController.highlightFindOptions();const C=this._editor.getSelections(),W=C[C.length-1],V=this._editor.getModel().findNextMatch(this.searchText,W.getEndPosition(),!1,this.matchCase,this.wholeWord?this._editor.getOption(129):null,!1);return V?new Selection$1(V.range.startLineNumber,V.range.startColumn,V.range.endLineNumber,V.range.endColumn):null}addSelectionToPreviousFindMatch(){if(!this._editor.hasModel())return null;const C=this._getPreviousMatch();if(!C)return null;const W=this._editor.getSelections();return new MultiCursorSessionResult(W.concat(C),C,0)}moveSelectionToPreviousFindMatch(){if(!this._editor.hasModel())return null;const C=this._getPreviousMatch();if(!C)return null;const W=this._editor.getSelections();return new MultiCursorSessionResult(W.slice(0,W.length-1).concat(C),C,0)}_getPreviousMatch(){if(!this._editor.hasModel())return null;if(this.currentMatch){const U=this.currentMatch;return this.currentMatch=null,U}this.findController.highlightFindOptions();const C=this._editor.getSelections(),W=C[C.length-1],V=this._editor.getModel().findPreviousMatch(this.searchText,W.getStartPosition(),!1,this.matchCase,this.wholeWord?this._editor.getOption(129):null,!1);return V?new Selection$1(V.range.startLineNumber,V.range.startColumn,V.range.endLineNumber,V.range.endColumn):null}selectAll(C){if(!this._editor.hasModel())return[];this.findController.highlightFindOptions();const W=this._editor.getModel();return C?W.findMatches(this.searchText,C,!1,this.matchCase,this.wholeWord?this._editor.getOption(129):null,!1,1073741824):W.findMatches(this.searchText,!0,!1,this.matchCase,this.wholeWord?this._editor.getOption(129):null,!1,1073741824)}}class MultiCursorSelectionController extends Disposable{static get(C){return C.getContribution(MultiCursorSelectionController.ID)}constructor(C){super(),this._sessionDispose=this._register(new DisposableStore),this._editor=C,this._ignoreSelectionChange=!1,this._session=null}dispose(){this._endSession(),super.dispose()}_beginSessionIfNeeded(C){if(!this._session){const W=MultiCursorSession.create(this._editor,C);if(!W)return;this._session=W;const V={searchString:this._session.searchText};this._session.isDisconnectedFromFindController&&(V.wholeWordOverride=1,V.matchCaseOverride=1,V.isRegexOverride=2),C.getState().change(V,!1),this._sessionDispose.add(this._editor.onDidChangeCursorSelection(U=>{this._ignoreSelectionChange||this._endSession()})),this._sessionDispose.add(this._editor.onDidBlurEditorText(()=>{this._endSession()})),this._sessionDispose.add(C.getState().onFindReplaceStateChange(U=>{(U.matchCase||U.wholeWord)&&this._endSession()}))}}_endSession(){if(this._sessionDispose.clear(),this._session&&this._session.isDisconnectedFromFindController){const C={wholeWordOverride:0,matchCaseOverride:0,isRegexOverride:0};this._session.findController.getState().change(C,!1)}this._session=null}_setSelections(C){this._ignoreSelectionChange=!0,this._editor.setSelections(C),this._ignoreSelectionChange=!1}_expandEmptyToWord(C,W){if(!W.isEmpty())return W;const V=this._editor.getConfiguredWordAtPosition(W.getStartPosition());return V?new Selection$1(W.startLineNumber,V.startColumn,W.startLineNumber,V.endColumn):W}_applySessionResult(C){C&&(this._setSelections(C.selections),C.revealRange&&this._editor.revealRangeInCenterIfOutsideViewport(C.revealRange,C.revealScrollType))}getSession(C){return this._session}addSelectionToNextFindMatch(C){if(this._editor.hasModel()){if(!this._session){const W=this._editor.getSelections();if(W.length>1){const U=C.getState().matchCase;if(!modelRangesContainSameText(this._editor.getModel(),W,U)){const Z=this._editor.getModel(),X=[];for(let Q=0,J=W.length;Q<J;Q++)X[Q]=this._expandEmptyToWord(Z,W[Q]);this._editor.setSelections(X);return}}}this._beginSessionIfNeeded(C),this._session&&this._applySessionResult(this._session.addSelectionToNextFindMatch())}}addSelectionToPreviousFindMatch(C){this._beginSessionIfNeeded(C),this._session&&this._applySessionResult(this._session.addSelectionToPreviousFindMatch())}moveSelectionToNextFindMatch(C){this._beginSessionIfNeeded(C),this._session&&this._applySessionResult(this._session.moveSelectionToNextFindMatch())}moveSelectionToPreviousFindMatch(C){this._beginSessionIfNeeded(C),this._session&&this._applySessionResult(this._session.moveSelectionToPreviousFindMatch())}selectAll(C){if(!this._editor.hasModel())return;let W=null;const V=C.getState();if(V.isRevealed&&V.searchString.length>0&&V.isRegex){const U=this._editor.getModel();V.searchScope?W=U.findMatches(V.searchString,V.searchScope,V.isRegex,V.matchCase,V.wholeWord?this._editor.getOption(129):null,!1,1073741824):W=U.findMatches(V.searchString,!0,V.isRegex,V.matchCase,V.wholeWord?this._editor.getOption(129):null,!1,1073741824)}else{if(this._beginSessionIfNeeded(C),!this._session)return;W=this._session.selectAll(V.searchScope)}if(W.length>0){const U=this._editor.getSelection();for(let G=0,Z=W.length;G<Z;G++){const X=W[G];if(X.range.intersectRanges(U)){W[G]=W[0],W[0]=X;break}}this._setSelections(W.map(G=>new Selection$1(G.range.startLineNumber,G.range.startColumn,G.range.endLineNumber,G.range.endColumn)))}}}MultiCursorSelectionController.ID="editor.contrib.multiCursorController";class MultiCursorSelectionControllerAction extends EditorAction{run(C,W){const V=MultiCursorSelectionController.get(W);if(!V)return;const U=W._getViewModel();if(U){const G=U.getCursorStates(),Z=CommonFindController.get(W);if(Z)this._run(V,Z);else{const X=C.get(IInstantiationService).createInstance(CommonFindController,W);this._run(V,X),X.dispose()}announceCursorChange(G,U.getCursorStates())}}}class AddSelectionToNextFindMatchAction extends MultiCursorSelectionControllerAction{constructor(){super({id:"editor.action.addSelectionToNextFindMatch",label:localize("addSelectionToNextFindMatch","Add Selection To Next Find Match"),alias:"Add Selection To Next Find Match",precondition:void 0,kbOpts:{kbExpr:EditorContextKeys.focus,primary:2082,weight:100},menuOpts:{menuId:MenuId.MenubarSelectionMenu,group:"3_multi",title:localize({key:"miAddSelectionToNextFindMatch",comment:["&& denotes a mnemonic"]},"Add &&Next Occurrence"),order:5}})}_run(C,W){C.addSelectionToNextFindMatch(W)}}class AddSelectionToPreviousFindMatchAction extends MultiCursorSelectionControllerAction{constructor(){super({id:"editor.action.addSelectionToPreviousFindMatch",label:localize("addSelectionToPreviousFindMatch","Add Selection To Previous Find Match"),alias:"Add Selection To Previous Find Match",precondition:void 0,menuOpts:{menuId:MenuId.MenubarSelectionMenu,group:"3_multi",title:localize({key:"miAddSelectionToPreviousFindMatch",comment:["&& denotes a mnemonic"]},"Add P&&revious Occurrence"),order:6}})}_run(C,W){C.addSelectionToPreviousFindMatch(W)}}class MoveSelectionToNextFindMatchAction extends MultiCursorSelectionControllerAction{constructor(){super({id:"editor.action.moveSelectionToNextFindMatch",label:localize("moveSelectionToNextFindMatch","Move Last Selection To Next Find Match"),alias:"Move Last Selection To Next Find Match",precondition:void 0,kbOpts:{kbExpr:EditorContextKeys.focus,primary:KeyChord(2089,2082),weight:100}})}_run(C,W){C.moveSelectionToNextFindMatch(W)}}class MoveSelectionToPreviousFindMatchAction extends MultiCursorSelectionControllerAction{constructor(){super({id:"editor.action.moveSelectionToPreviousFindMatch",label:localize("moveSelectionToPreviousFindMatch","Move Last Selection To Previous Find Match"),alias:"Move Last Selection To Previous Find Match",precondition:void 0})}_run(C,W){C.moveSelectionToPreviousFindMatch(W)}}class SelectHighlightsAction extends MultiCursorSelectionControllerAction{constructor(){super({id:"editor.action.selectHighlights",label:localize("selectAllOccurrencesOfFindMatch","Select All Occurrences of Find Match"),alias:"Select All Occurrences of Find Match",precondition:void 0,kbOpts:{kbExpr:EditorContextKeys.focus,primary:3114,weight:100},menuOpts:{menuId:MenuId.MenubarSelectionMenu,group:"3_multi",title:localize({key:"miSelectHighlights",comment:["&& denotes a mnemonic"]},"Select All &&Occurrences"),order:7}})}_run(C,W){C.selectAll(W)}}class CompatChangeAll extends MultiCursorSelectionControllerAction{constructor(){super({id:"editor.action.changeAll",label:localize("changeAll.label","Change All Occurrences"),alias:"Change All Occurrences",precondition:ContextKeyExpr.and(EditorContextKeys.writable,EditorContextKeys.editorTextFocus),kbOpts:{kbExpr:EditorContextKeys.editorTextFocus,primary:2108,weight:100},contextMenuOpts:{group:"1_modification",order:1.2}})}_run(C,W){C.selectAll(W)}}class SelectionHighlighterState{constructor(C,W,V,U,G){this._model=C,this._searchText=W,this._matchCase=V,this._wordSeparators=U,this._modelVersionId=this._model.getVersionId(),this._cachedFindMatches=null,G&&this._model===G._model&&this._searchText===G._searchText&&this._matchCase===G._matchCase&&this._wordSeparators===G._wordSeparators&&this._modelVersionId===G._modelVersionId&&(this._cachedFindMatches=G._cachedFindMatches)}findMatches(){return this._cachedFindMatches===null&&(this._cachedFindMatches=this._model.findMatches(this._searchText,!0,!1,this._matchCase,this._wordSeparators,!1).map(C=>C.range),this._cachedFindMatches.sort(Range$2.compareRangesUsingStarts)),this._cachedFindMatches}}let SelectionHighlighter=SelectionHighlighter_1=class extends Disposable{constructor(C,W){super(),this._languageFeaturesService=W,this.editor=C,this._isEnabled=C.getOption(107),this._decorations=C.createDecorationsCollection(),this.updateSoon=this._register(new RunOnceScheduler(()=>this._update(),300)),this.state=null,this._register(C.onDidChangeConfiguration(U=>{this._isEnabled=C.getOption(107)})),this._register(C.onDidChangeCursorSelection(U=>{this._isEnabled&&(U.selection.isEmpty()?U.reason===3?(this.state&&this._setState(null),this.updateSoon.schedule()):this._setState(null):this._update())})),this._register(C.onDidChangeModel(U=>{this._setState(null)})),this._register(C.onDidChangeModelContent(U=>{this._isEnabled&&this.updateSoon.schedule()}));const V=CommonFindController.get(C);V&&this._register(V.getState().onFindReplaceStateChange(U=>{this._update()})),this.updateSoon.schedule()}_update(){this._setState(SelectionHighlighter_1._createState(this.state,this._isEnabled,this.editor))}static _createState(C,W,V){if(!W||!V.hasModel())return null;const U=V.getSelection();if(U.startLineNumber!==U.endLineNumber)return null;const G=MultiCursorSelectionController.get(V);if(!G)return null;const Z=CommonFindController.get(V);if(!Z)return null;let X=G.getSession(Z);if(!X){const ee=V.getSelections();if(ee.length>1){const ie=Z.getState().matchCase;if(!modelRangesContainSameText(V.getModel(),ee,ie))return null}X=MultiCursorSession.create(V,Z)}if(!X||X.currentMatch||/^[ \t]+$/.test(X.searchText)||X.searchText.length>200)return null;const Q=Z.getState(),J=Q.matchCase;if(Q.isRevealed){let ee=Q.searchString;J||(ee=ee.toLowerCase());let te=X.searchText;if(J||(te=te.toLowerCase()),ee===te&&X.matchCase===Q.matchCase&&X.wholeWord===Q.wholeWord&&!Q.isRegex)return null}return new SelectionHighlighterState(V.getModel(),X.searchText,X.matchCase,X.wholeWord?V.getOption(129):null,C)}_setState(C){if(this.state=C,!this.state){this._decorations.clear();return}if(!this.editor.hasModel())return;const W=this.editor.getModel();if(W.isTooLargeForTokenization())return;const V=this.state.findMatches(),U=this.editor.getSelections();U.sort(Range$2.compareRangesUsingStarts);const G=[];for(let Q=0,J=0,ee=V.length,te=U.length;Q<ee;){const ie=V[Q];if(J>=te)G.push(ie),Q++;else{const ne=Range$2.compareRangesUsingStarts(ie,U[J]);ne<0?((U[J].isEmpty()||!Range$2.areIntersecting(ie,U[J]))&&G.push(ie),Q++):(ne>0||Q++,J++)}}const Z=this._languageFeaturesService.documentHighlightProvider.has(W)&&this.editor.getOption(80),X=G.map(Q=>({range:Q,options:getSelectionHighlightDecorationOptions(Z)}));this._decorations.set(X)}dispose(){this._setState(null),super.dispose()}};SelectionHighlighter.ID="editor.contrib.selectionHighlighter";SelectionHighlighter=SelectionHighlighter_1=__decorate$o([__param$o(1,ILanguageFeaturesService)],SelectionHighlighter);function modelRangesContainSameText(K,C,W){const V=getValueInRange(K,C[0],!W);for(let U=1,G=C.length;U<G;U++){const Z=C[U];if(Z.isEmpty())return!1;const X=getValueInRange(K,Z,!W);if(V!==X)return!1}return!0}function getValueInRange(K,C,W){const V=K.getValueInRange(C);return W?V.toLowerCase():V}class FocusNextCursor extends EditorAction{constructor(){super({id:"editor.action.focusNextCursor",label:localize("mutlicursor.focusNextCursor","Focus Next Cursor"),description:{description:localize("mutlicursor.focusNextCursor.description","Focuses the next cursor"),args:[]},alias:"Focus Next Cursor",precondition:void 0})}run(C,W,V){if(!W.hasModel())return;const U=W._getViewModel();if(U.cursorConfig.readOnly)return;U.model.pushStackElement();const G=Array.from(U.getCursorStates()),Z=G.shift();Z&&(G.push(Z),U.setCursorStates(V.source,3,G),U.revealPrimaryCursor(V.source,!0),announceCursorChange(G,U.getCursorStates()))}}class FocusPreviousCursor extends EditorAction{constructor(){super({id:"editor.action.focusPreviousCursor",label:localize("mutlicursor.focusPreviousCursor","Focus Previous Cursor"),description:{description:localize("mutlicursor.focusPreviousCursor.description","Focuses the previous cursor"),args:[]},alias:"Focus Previous Cursor",precondition:void 0})}run(C,W,V){if(!W.hasModel())return;const U=W._getViewModel();if(U.cursorConfig.readOnly)return;U.model.pushStackElement();const G=Array.from(U.getCursorStates()),Z=G.pop();Z&&(G.unshift(Z),U.setCursorStates(V.source,3,G),U.revealPrimaryCursor(V.source,!0),announceCursorChange(G,U.getCursorStates()))}}registerEditorContribution(MultiCursorSelectionController.ID,MultiCursorSelectionController,4);registerEditorContribution(SelectionHighlighter.ID,SelectionHighlighter,1);registerEditorAction(InsertCursorAbove);registerEditorAction(InsertCursorBelow);registerEditorAction(InsertCursorAtEndOfEachLineSelected);registerEditorAction(AddSelectionToNextFindMatchAction);registerEditorAction(AddSelectionToPreviousFindMatchAction);registerEditorAction(MoveSelectionToNextFindMatchAction);registerEditorAction(MoveSelectionToPreviousFindMatchAction);registerEditorAction(SelectHighlightsAction);registerEditorAction(CompatChangeAll);registerEditorAction(InsertCursorAtEndOfLineSelected);registerEditorAction(InsertCursorAtTopOfLineSelected);registerEditorAction(FocusNextCursor);registerEditorAction(FocusPreviousCursor);var __awaiter$g=globalThis&&globalThis.__awaiter||function(K,C,W,V){function U(G){return G instanceof W?G:new W(function(Z){Z(G)})}return new(W||(W=Promise))(function(G,Z){function X(ee){try{J(V.next(ee))}catch(te){Z(te)}}function Q(ee){try{J(V.throw(ee))}catch(te){Z(te)}}function J(ee){ee.done?G(ee.value):U(ee.value).then(X,Q)}J((V=V.apply(K,C||[])).next())})};const Context={Visible:new RawContextKey("parameterHintsVisible",!1),MultipleSignatures:new RawContextKey("parameterHintsMultipleSignatures",!1)};function provideSignatureHelp(K,C,W,V,U){return __awaiter$g(this,void 0,void 0,function*(){const G=K.ordered(C);for(const Z of G)try{const X=yield Z.provideSignatureHelp(C,W,U,V);if(X)return X}catch(X){onUnexpectedExternalError(X)}})}CommandsRegistry.registerCommand("_executeSignatureHelpProvider",(K,...C)=>__awaiter$g(void 0,void 0,void 0,function*(){const[W,V,U]=C;assertType(URI.isUri(W)),assertType(Position$1.isIPosition(V)),assertType(typeof U=="string"||!U);const G=K.get(ILanguageFeaturesService),Z=yield K.get(ITextModelService).createModelReference(W);try{const X=yield provideSignatureHelp(G.signatureHelpProvider,Z.object.textEditorModel,Position$1.lift(V),{triggerKind:SignatureHelpTriggerKind$1.Invoke,isRetrigger:!1,triggerCharacter:U},CancellationToken.None);return X?(setTimeout(()=>X.dispose(),0),X.value):void 0}finally{Z.dispose()}}));var __awaiter$f=globalThis&&globalThis.__awaiter||function(K,C,W,V){function U(G){return G instanceof W?G:new W(function(Z){Z(G)})}return new(W||(W=Promise))(function(G,Z){function X(ee){try{J(V.next(ee))}catch(te){Z(te)}}function Q(ee){try{J(V.throw(ee))}catch(te){Z(te)}}function J(ee){ee.done?G(ee.value):U(ee.value).then(X,Q)}J((V=V.apply(K,C||[])).next())})},ParameterHintState;(function(K){K.Default={type:0};class C{constructor(U,G){this.request=U,this.previouslyActiveHints=G,this.type=2}}K.Pending=C;class W{constructor(U){this.hints=U,this.type=1}}K.Active=W})(ParameterHintState||(ParameterHintState={}));class ParameterHintsModel extends Disposable{constructor(C,W,V=ParameterHintsModel.DEFAULT_DELAY){super(),this._onChangedHints=this._register(new Emitter$1),this.onChangedHints=this._onChangedHints.event,this.triggerOnType=!1,this._state=ParameterHintState.Default,this._pendingTriggers=[],this._lastSignatureHelpResult=this._register(new MutableDisposable),this.triggerChars=new CharacterSet,this.retriggerChars=new CharacterSet,this.triggerId=0,this.editor=C,this.providers=W,this.throttledDelayer=new Delayer(V),this._register(this.editor.onDidBlurEditorWidget(()=>this.cancel())),this._register(this.editor.onDidChangeConfiguration(()=>this.onEditorConfigurationChange())),this._register(this.editor.onDidChangeModel(U=>this.onModelChanged())),this._register(this.editor.onDidChangeModelLanguage(U=>this.onModelChanged())),this._register(this.editor.onDidChangeCursorSelection(U=>this.onCursorChange(U))),this._register(this.editor.onDidChangeModelContent(U=>this.onModelContentChange())),this._register(this.providers.onDidChange(this.onModelChanged,this)),this._register(this.editor.onDidType(U=>this.onDidType(U))),this.onEditorConfigurationChange(),this.onModelChanged()}get state(){return this._state}set state(C){this._state.type===2&&this._state.request.cancel(),this._state=C}cancel(C=!1){this.state=ParameterHintState.Default,this.throttledDelayer.cancel(),C||this._onChangedHints.fire(void 0)}trigger(C,W){const V=this.editor.getModel();if(!V||!this.providers.has(V))return;const U=++this.triggerId;this._pendingTriggers.push(C),this.throttledDelayer.trigger(()=>this.doTrigger(U),W).catch(onUnexpectedError)}next(){if(this.state.type!==1)return;const C=this.state.hints.signatures.length,W=this.state.hints.activeSignature,V=W%C===C-1,U=this.editor.getOption(85).cycle;if((C<2||V)&&!U){this.cancel();return}this.updateActiveSignature(V&&U?0:W+1)}previous(){if(this.state.type!==1)return;const C=this.state.hints.signatures.length,W=this.state.hints.activeSignature,V=W===0,U=this.editor.getOption(85).cycle;if((C<2||V)&&!U){this.cancel();return}this.updateActiveSignature(V&&U?C-1:W-1)}updateActiveSignature(C){this.state.type===1&&(this.state=new ParameterHintState.Active(Object.assign(Object.assign({},this.state.hints),{activeSignature:C})),this._onChangedHints.fire(this.state.hints))}doTrigger(C){return __awaiter$f(this,void 0,void 0,function*(){const W=this.state.type===1||this.state.type===2,V=this.getLastActiveHints();if(this.cancel(!0),this._pendingTriggers.length===0)return!1;const U=this._pendingTriggers.reduce(mergeTriggerContexts);this._pendingTriggers=[];const G={triggerKind:U.triggerKind,triggerCharacter:U.triggerCharacter,isRetrigger:W,activeSignatureHelp:V};if(!this.editor.hasModel())return!1;const Z=this.editor.getModel(),X=this.editor.getPosition();this.state=new ParameterHintState.Pending(createCancelablePromise(Q=>provideSignatureHelp(this.providers,Z,X,G,Q)),V);try{const Q=yield this.state.request;return C!==this.triggerId?(Q==null||Q.dispose(),!1):!Q||!Q.value.signatures||Q.value.signatures.length===0?(Q==null||Q.dispose(),this._lastSignatureHelpResult.clear(),this.cancel(),!1):(this.state=new ParameterHintState.Active(Q.value),this._lastSignatureHelpResult.value=Q,this._onChangedHints.fire(this.state.hints),!0)}catch(Q){return C===this.triggerId&&(this.state=ParameterHintState.Default),onUnexpectedError(Q),!1}})}getLastActiveHints(){switch(this.state.type){case 1:return this.state.hints;case 2:return this.state.previouslyActiveHints;default:return}}get isTriggered(){return this.state.type===1||this.state.type===2||this.throttledDelayer.isTriggered()}onModelChanged(){this.cancel(),this.triggerChars.clear(),this.retriggerChars.clear();const C=this.editor.getModel();if(C)for(const W of this.providers.ordered(C)){for(const V of W.signatureHelpTriggerCharacters||[])if(V.length){const U=V.charCodeAt(0);this.triggerChars.add(U),this.retriggerChars.add(U)}for(const V of W.signatureHelpRetriggerCharacters||[])V.length&&this.retriggerChars.add(V.charCodeAt(0))}}onDidType(C){if(!this.triggerOnType)return;const W=C.length-1,V=C.charCodeAt(W);(this.triggerChars.has(V)||this.isTriggered&&this.retriggerChars.has(V))&&this.trigger({triggerKind:SignatureHelpTriggerKind$1.TriggerCharacter,triggerCharacter:C.charAt(W)})}onCursorChange(C){C.source==="mouse"?this.cancel():this.isTriggered&&this.trigger({triggerKind:SignatureHelpTriggerKind$1.ContentChange})}onModelContentChange(){this.isTriggered&&this.trigger({triggerKind:SignatureHelpTriggerKind$1.ContentChange})}onEditorConfigurationChange(){this.triggerOnType=this.editor.getOption(85).enabled,this.triggerOnType||this.cancel()}dispose(){this.cancel(!0),super.dispose()}}ParameterHintsModel.DEFAULT_DELAY=120;function mergeTriggerContexts(K,C){switch(C.triggerKind){case SignatureHelpTriggerKind$1.Invoke:return C;case SignatureHelpTriggerKind$1.ContentChange:return K;case SignatureHelpTriggerKind$1.TriggerCharacter:default:return C}}const parameterHints="";var __decorate$n=globalThis&&globalThis.__decorate||function(K,C,W,V){var U=arguments.length,G=U<3?C:V===null?V=Object.getOwnPropertyDescriptor(C,W):V,Z;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")G=Reflect.decorate(K,C,W,V);else for(var X=K.length-1;X>=0;X--)(Z=K[X])&&(G=(U<3?Z(G):U>3?Z(C,W,G):Z(C,W))||G);return U>3&&G&&Object.defineProperty(C,W,G),G},__param$n=globalThis&&globalThis.__param||function(K,C){return function(W,V){C(W,V,K)}},ParameterHintsWidget_1;const $=$$d,parameterHintsNextIcon=registerIcon("parameter-hints-next",Codicon.chevronDown,localize("parameterHintsNextIcon","Icon for show next parameter hint.")),parameterHintsPreviousIcon=registerIcon("parameter-hints-previous",Codicon.chevronUp,localize("parameterHintsPreviousIcon","Icon for show previous parameter hint."));let ParameterHintsWidget=ParameterHintsWidget_1=class extends Disposable{constructor(C,W,V,U,G){super(),this.editor=C,this.model=W,this.renderDisposeables=this._register(new DisposableStore),this.visible=!1,this.announcedLabel=null,this.allowEditorOverflow=!0,this.markdownRenderer=this._register(new MarkdownRenderer({editor:C},G,U)),this.keyVisible=Context.Visible.bindTo(V),this.keyMultipleSignatures=Context.MultipleSignatures.bindTo(V)}createParameterHintDOMNodes(){const C=$(".editor-widget.parameter-hints-widget"),W=append$3(C,$(".phwrapper"));W.tabIndex=-1;const V=append$3(W,$(".controls")),U=append$3(V,$(".button"+ThemeIcon.asCSSSelector(parameterHintsPreviousIcon))),G=append$3(V,$(".overloads")),Z=append$3(V,$(".button"+ThemeIcon.asCSSSelector(parameterHintsNextIcon)));this._register(addDisposableListener(U,"click",ie=>{EventHelper.stop(ie),this.previous()})),this._register(addDisposableListener(Z,"click",ie=>{EventHelper.stop(ie),this.next()}));const X=$(".body"),Q=new DomScrollableElement(X,{alwaysConsumeMouseWheel:!0});this._register(Q),W.appendChild(Q.getDomNode());const J=append$3(X,$(".signature")),ee=append$3(X,$(".docs"));C.style.userSelect="text",this.domNodes={element:C,signature:J,overloads:G,docs:ee,scrollbar:Q},this.editor.addContentWidget(this),this.hide(),this._register(this.editor.onDidChangeCursorSelection(ie=>{this.visible&&this.editor.layoutContentWidget(this)}));const te=()=>{if(!this.domNodes)return;const ie=this.editor.getOption(50);this.domNodes.element.style.fontSize=`${ie.fontSize}px`,this.domNodes.element.style.lineHeight=`${ie.lineHeight/ie.fontSize}`};te(),this._register(Event$1.chain(this.editor.onDidChangeConfiguration.bind(this.editor),ie=>ie.filter(ne=>ne.hasChanged(50)))(te)),this._register(this.editor.onDidLayoutChange(ie=>this.updateMaxHeight())),this.updateMaxHeight()}show(){this.visible||(this.domNodes||this.createParameterHintDOMNodes(),this.keyVisible.set(!0),this.visible=!0,setTimeout(()=>{var C;(C=this.domNodes)===null||C===void 0||C.element.classList.add("visible")},100),this.editor.layoutContentWidget(this))}hide(){var C;this.renderDisposeables.clear(),this.visible&&(this.keyVisible.reset(),this.visible=!1,this.announcedLabel=null,(C=this.domNodes)===null||C===void 0||C.element.classList.remove("visible"),this.editor.layoutContentWidget(this))}getPosition(){return this.visible?{position:this.editor.getPosition(),preference:[1,2]}:null}render(C){var W;if(this.renderDisposeables.clear(),!this.domNodes)return;const V=C.signatures.length>1;this.domNodes.element.classList.toggle("multiple",V),this.keyMultipleSignatures.set(V),this.domNodes.signature.innerText="",this.domNodes.docs.innerText="";const U=C.signatures[C.activeSignature];if(!U)return;const G=append$3(this.domNodes.signature,$(".code")),Z=this.editor.getOption(50);G.style.fontSize=`${Z.fontSize}px`,G.style.fontFamily=Z.fontFamily;const X=U.parameters.length>0,Q=(W=U.activeParameter)!==null&&W!==void 0?W:C.activeParameter;if(X)this.renderParameters(G,U,Q);else{const te=append$3(G,$("span"));te.textContent=U.label}const J=U.parameters[Q];if(J!=null&&J.documentation){const te=$("span.documentation");if(typeof J.documentation=="string")te.textContent=J.documentation;else{const ie=this.renderMarkdownDocs(J.documentation);te.appendChild(ie.element)}append$3(this.domNodes.docs,$("p",{},te))}if(U.documentation!==void 0)if(typeof U.documentation=="string")append$3(this.domNodes.docs,$("p",{},U.documentation));else{const te=this.renderMarkdownDocs(U.documentation);append$3(this.domNodes.docs,te.element)}const ee=this.hasDocs(U,J);if(this.domNodes.signature.classList.toggle("has-docs",ee),this.domNodes.docs.classList.toggle("empty",!ee),this.domNodes.overloads.textContent=String(C.activeSignature+1).padStart(C.signatures.length.toString().length,"0")+"/"+C.signatures.length,J){let te="";const ie=U.parameters[Q];Array.isArray(ie.label)?te=U.label.substring(ie.label[0],ie.label[1]):te=ie.label,ie.documentation&&(te+=typeof ie.documentation=="string"?`, ${ie.documentation}`:`, ${ie.documentation.value}`),U.documentation&&(te+=typeof U.documentation=="string"?`, ${U.documentation}`:`, ${U.documentation.value}`),this.announcedLabel!==te&&(alert(localize("hint","{0}, hint",te)),this.announcedLabel=te)}this.editor.layoutContentWidget(this),this.domNodes.scrollbar.scanDomNode()}renderMarkdownDocs(C){const W=this.renderDisposeables.add(this.markdownRenderer.render(C,{asyncRenderCallback:()=>{var V;(V=this.domNodes)===null||V===void 0||V.scrollbar.scanDomNode()}}));return W.element.classList.add("markdown-docs"),W}hasDocs(C,W){return!!(W&&typeof W.documentation=="string"&&assertIsDefined(W.documentation).length>0||W&&typeof W.documentation=="object"&&assertIsDefined(W.documentation).value.length>0||C.documentation&&typeof C.documentation=="string"&&assertIsDefined(C.documentation).length>0||C.documentation&&typeof C.documentation=="object"&&assertIsDefined(C.documentation.value).length>0)}renderParameters(C,W,V){const[U,G]=this.getParameterLabelOffsets(W,V),Z=document.createElement("span");Z.textContent=W.label.substring(0,U);const X=document.createElement("span");X.textContent=W.label.substring(U,G),X.className="parameter active";const Q=document.createElement("span");Q.textContent=W.label.substring(G),append$3(C,Z,X,Q)}getParameterLabelOffsets(C,W){const V=C.parameters[W];if(V){if(Array.isArray(V.label))return V.label;if(V.label.length){const U=new RegExp(`(\\W|^)${escapeRegExpCharacters(V.label)}(?=\\W|$)`,"g");U.test(C.label);const G=U.lastIndex-V.label.length;return G>=0?[G,U.lastIndex]:[0,0]}else return[0,0]}else return[0,0]}next(){this.editor.focus(),this.model.next()}previous(){this.editor.focus(),this.model.previous()}getDomNode(){return this.domNodes||this.createParameterHintDOMNodes(),this.domNodes.element}getId(){return ParameterHintsWidget_1.ID}updateMaxHeight(){if(!this.domNodes)return;const W=`${Math.max(this.editor.getLayoutInfo().height/4,250)}px`;this.domNodes.element.style.maxHeight=W;const V=this.domNodes.element.getElementsByClassName("phwrapper");V.length&&(V[0].style.maxHeight=W)}};ParameterHintsWidget.ID="editor.widget.parameterHintsWidget";ParameterHintsWidget=ParameterHintsWidget_1=__decorate$n([__param$n(2,IContextKeyService),__param$n(3,IOpenerService),__param$n(4,ILanguageService)],ParameterHintsWidget);registerColor("editorHoverWidget.highlightForeground",{dark:listHighlightForeground,light:listHighlightForeground,hcDark:listHighlightForeground,hcLight:listHighlightForeground},localize("editorHoverWidgetHighlightForeground","Foreground color of the active item in the parameter hint."));var __decorate$m=globalThis&&globalThis.__decorate||function(K,C,W,V){var U=arguments.length,G=U<3?C:V===null?V=Object.getOwnPropertyDescriptor(C,W):V,Z;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")G=Reflect.decorate(K,C,W,V);else for(var X=K.length-1;X>=0;X--)(Z=K[X])&&(G=(U<3?Z(G):U>3?Z(C,W,G):Z(C,W))||G);return U>3&&G&&Object.defineProperty(C,W,G),G},__param$m=globalThis&&globalThis.__param||function(K,C){return function(W,V){C(W,V,K)}},ParameterHintsController_1;let ParameterHintsController=ParameterHintsController_1=class extends Disposable{static get(C){return C.getContribution(ParameterHintsController_1.ID)}constructor(C,W,V){super(),this.editor=C,this.model=this._register(new ParameterHintsModel(C,V.signatureHelpProvider)),this._register(this.model.onChangedHints(U=>{var G;U?(this.widget.value.show(),this.widget.value.render(U)):(G=this.widget.rawValue)===null||G===void 0||G.hide()})),this.widget=new Lazy(()=>this._register(W.createInstance(ParameterHintsWidget,this.editor,this.model)))}cancel(){this.model.cancel()}previous(){var C;(C=this.widget.rawValue)===null||C===void 0||C.previous()}next(){var C;(C=this.widget.rawValue)===null||C===void 0||C.next()}trigger(C){this.model.trigger(C,0)}};ParameterHintsController.ID="editor.controller.parameterHints";ParameterHintsController=ParameterHintsController_1=__decorate$m([__param$m(1,IInstantiationService),__param$m(2,ILanguageFeaturesService)],ParameterHintsController);class TriggerParameterHintsAction extends EditorAction{constructor(){super({id:"editor.action.triggerParameterHints",label:localize("parameterHints.trigger.label","Trigger Parameter Hints"),alias:"Trigger Parameter Hints",precondition:EditorContextKeys.hasSignatureHelpProvider,kbOpts:{kbExpr:EditorContextKeys.editorTextFocus,primary:3082,weight:100}})}run(C,W){const V=ParameterHintsController.get(W);V==null||V.trigger({triggerKind:SignatureHelpTriggerKind$1.Invoke})}}registerEditorContribution(ParameterHintsController.ID,ParameterHintsController,2);registerEditorAction(TriggerParameterHintsAction);const weight$1=100+75,ParameterHintsCommand=EditorCommand.bindToContribution(ParameterHintsController.get);registerEditorCommand(new ParameterHintsCommand({id:"closeParameterHints",precondition:Context.Visible,handler:K=>K.cancel(),kbOpts:{weight:weight$1,kbExpr:EditorContextKeys.focus,primary:9,secondary:[1033]}}));registerEditorCommand(new ParameterHintsCommand({id:"showPrevParameterHint",precondition:ContextKeyExpr.and(Context.Visible,Context.MultipleSignatures),handler:K=>K.previous(),kbOpts:{weight:weight$1,kbExpr:EditorContextKeys.focus,primary:16,secondary:[528],mac:{primary:16,secondary:[528,302]}}}));registerEditorCommand(new ParameterHintsCommand({id:"showNextParameterHint",precondition:ContextKeyExpr.and(Context.Visible,Context.MultipleSignatures),handler:K=>K.next(),kbOpts:{weight:weight$1,kbExpr:EditorContextKeys.focus,primary:18,secondary:[530],mac:{primary:18,secondary:[530,300]}}}));const renameInputField="";var __decorate$l=globalThis&&globalThis.__decorate||function(K,C,W,V){var U=arguments.length,G=U<3?C:V===null?V=Object.getOwnPropertyDescriptor(C,W):V,Z;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")G=Reflect.decorate(K,C,W,V);else for(var X=K.length-1;X>=0;X--)(Z=K[X])&&(G=(U<3?Z(G):U>3?Z(C,W,G):Z(C,W))||G);return U>3&&G&&Object.defineProperty(C,W,G),G},__param$l=globalThis&&globalThis.__param||function(K,C){return function(W,V){C(W,V,K)}};const CONTEXT_RENAME_INPUT_VISIBLE=new RawContextKey("renameInputVisible",!1,localize("renameInputVisible","Whether the rename input widget is visible"));let RenameInputField=class{constructor(C,W,V,U,G){this._editor=C,this._acceptKeybindings=W,this._themeService=V,this._keybindingService=U,this._disposables=new DisposableStore,this.allowEditorOverflow=!0,this._visibleContextKey=CONTEXT_RENAME_INPUT_VISIBLE.bindTo(G),this._editor.addContentWidget(this),this._disposables.add(this._editor.onDidChangeConfiguration(Z=>{Z.hasChanged(50)&&this._updateFont()})),this._disposables.add(V.onDidColorThemeChange(this._updateStyles,this))}dispose(){this._disposables.dispose(),this._editor.removeContentWidget(this)}getId(){return"__renameInputWidget"}getDomNode(){return this._domNode||(this._domNode=document.createElement("div"),this._domNode.className="monaco-editor rename-box",this._input=document.createElement("input"),this._input.className="rename-input",this._input.type="text",this._input.setAttribute("aria-label",localize("renameAriaLabel","Rename input. Type new name and press Enter to commit.")),this._domNode.appendChild(this._input),this._label=document.createElement("div"),this._label.className="rename-label",this._domNode.appendChild(this._label),this._updateFont(),this._updateStyles(this._themeService.getColorTheme())),this._domNode}_updateStyles(C){var W,V,U,G;if(!this._input||!this._domNode)return;const Z=C.getColor(widgetShadow),X=C.getColor(widgetBorder);this._domNode.style.backgroundColor=String((W=C.getColor(editorWidgetBackground))!==null&&W!==void 0?W:""),this._domNode.style.boxShadow=Z?` 0 0 8px 2px ${Z}`:"",this._domNode.style.border=X?`1px solid ${X}`:"",this._domNode.style.color=String((V=C.getColor(inputForeground))!==null&&V!==void 0?V:""),this._input.style.backgroundColor=String((U=C.getColor(inputBackground))!==null&&U!==void 0?U:"");const Q=C.getColor(inputBorder);this._input.style.borderWidth=Q?"1px":"0px",this._input.style.borderStyle=Q?"solid":"none",this._input.style.borderColor=(G=Q==null?void 0:Q.toString())!==null&&G!==void 0?G:"none"}_updateFont(){if(!this._input||!this._label)return;const C=this._editor.getOption(50);this._input.style.fontFamily=C.fontFamily,this._input.style.fontWeight=C.fontWeight,this._input.style.fontSize=`${C.fontSize}px`,this._label.style.fontSize=`${C.fontSize*.8}px`}getPosition(){return this._visible?{position:this._position,preference:[2,1]}:null}beforeRender(){var C,W;const[V,U]=this._acceptKeybindings;return this._label.innerText=localize({key:"label",comment:['placeholders are keybindings, e.g "F2 to Rename, Shift+F2 to Preview"']},"{0} to Rename, {1} to Preview",(C=this._keybindingService.lookupKeybinding(V))===null||C===void 0?void 0:C.getLabel(),(W=this._keybindingService.lookupKeybinding(U))===null||W===void 0?void 0:W.getLabel()),null}afterRender(C){C||this.cancelInput(!0)}acceptInput(C){var W;(W=this._currentAcceptInput)===null||W===void 0||W.call(this,C)}cancelInput(C){var W;(W=this._currentCancelInput)===null||W===void 0||W.call(this,C)}getInput(C,W,V,U,G,Z){this._domNode.classList.toggle("preview",G),this._position=new Position$1(C.startLineNumber,C.startColumn),this._input.value=W,this._input.setAttribute("selectionStart",V.toString()),this._input.setAttribute("selectionEnd",U.toString()),this._input.size=Math.max((C.endColumn-C.startColumn)*1.1,20);const X=new DisposableStore;return new Promise(Q=>{this._currentCancelInput=J=>(this._currentAcceptInput=void 0,this._currentCancelInput=void 0,Q(J),!0),this._currentAcceptInput=J=>{if(this._input.value.trim().length===0||this._input.value===W){this.cancelInput(!0);return}this._currentAcceptInput=void 0,this._currentCancelInput=void 0,Q({newName:this._input.value,wantsPreview:G&&J})},X.add(Z.onCancellationRequested(()=>this.cancelInput(!0))),X.add(this._editor.onDidBlurEditorWidget(()=>{var J;return this.cancelInput(!(!((J=this._domNode)===null||J===void 0)&&J.ownerDocument.hasFocus()))})),this._show()}).finally(()=>{X.dispose(),this._hide()})}_show(){this._editor.revealLineInCenterIfOutsideViewport(this._position.lineNumber,0),this._visible=!0,this._visibleContextKey.set(!0),this._editor.layoutContentWidget(this),setTimeout(()=>{this._input.focus(),this._input.setSelectionRange(parseInt(this._input.getAttribute("selectionStart")),parseInt(this._input.getAttribute("selectionEnd")))},100)}_hide(){this._visible=!1,this._visibleContextKey.reset(),this._editor.layoutContentWidget(this)}};RenameInputField=__decorate$l([__param$l(2,IThemeService),__param$l(3,IKeybindingService),__param$l(4,IContextKeyService)],RenameInputField);var __decorate$k=globalThis&&globalThis.__decorate||function(K,C,W,V){var U=arguments.length,G=U<3?C:V===null?V=Object.getOwnPropertyDescriptor(C,W):V,Z;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")G=Reflect.decorate(K,C,W,V);else for(var X=K.length-1;X>=0;X--)(Z=K[X])&&(G=(U<3?Z(G):U>3?Z(C,W,G):Z(C,W))||G);return U>3&&G&&Object.defineProperty(C,W,G),G},__param$k=globalThis&&globalThis.__param||function(K,C){return function(W,V){C(W,V,K)}},__awaiter$e=globalThis&&globalThis.__awaiter||function(K,C,W,V){function U(G){return G instanceof W?G:new W(function(Z){Z(G)})}return new(W||(W=Promise))(function(G,Z){function X(ee){try{J(V.next(ee))}catch(te){Z(te)}}function Q(ee){try{J(V.throw(ee))}catch(te){Z(te)}}function J(ee){ee.done?G(ee.value):U(ee.value).then(X,Q)}J((V=V.apply(K,C||[])).next())})},RenameController_1;class RenameSkeleton{constructor(C,W,V){this.model=C,this.position=W,this._providerRenameIdx=0,this._providers=V.ordered(C)}hasProvider(){return this._providers.length>0}resolveRenameLocation(C){return __awaiter$e(this,void 0,void 0,function*(){const W=[];for(this._providerRenameIdx=0;this._providerRenameIdx<this._providers.length;this._providerRenameIdx++){const U=this._providers[this._providerRenameIdx];if(!U.resolveRenameLocation)break;const G=yield U.resolveRenameLocation(this.model,this.position,C);if(G){if(G.rejectReason){W.push(G.rejectReason);continue}return G}}const V=this.model.getWordAtPosition(this.position);return V?{range:new Range$2(this.position.lineNumber,V.startColumn,this.position.lineNumber,V.endColumn),text:V.word,rejectReason:W.length>0?W.join(`
`):void 0}:{range:Range$2.fromPositions(this.position),text:"",rejectReason:W.length>0?W.join(`
`):void 0}})}provideRenameEdits(C,W){return __awaiter$e(this,void 0,void 0,function*(){return this._provideRenameEdits(C,this._providerRenameIdx,[],W)})}_provideRenameEdits(C,W,V,U){return __awaiter$e(this,void 0,void 0,function*(){const G=this._providers[W];if(!G)return{edits:[],rejectReason:V.join(`
`)};const Z=yield G.provideRenameEdits(this.model,this.position,C,U);if(Z){if(Z.rejectReason)return this._provideRenameEdits(C,W+1,V.concat(Z.rejectReason),U)}else return this._provideRenameEdits(C,W+1,V.concat(localize("no result","No result.")),U);return Z})}}function rename(K,C,W,V){return __awaiter$e(this,void 0,void 0,function*(){const U=new RenameSkeleton(C,W,K),G=yield U.resolveRenameLocation(CancellationToken.None);return G!=null&&G.rejectReason?{edits:[],rejectReason:G.rejectReason}:U.provideRenameEdits(V,CancellationToken.None)})}let RenameController=RenameController_1=class{static get(C){return C.getContribution(RenameController_1.ID)}constructor(C,W,V,U,G,Z,X,Q){this.editor=C,this._instaService=W,this._notificationService=V,this._bulkEditService=U,this._progressService=G,this._logService=Z,this._configService=X,this._languageFeaturesService=Q,this._disposableStore=new DisposableStore,this._cts=new CancellationTokenSource$1,this._renameInputField=this._disposableStore.add(this._instaService.createInstance(RenameInputField,this.editor,["acceptRenameInput","acceptRenameInputWithPreview"]))}dispose(){this._disposableStore.dispose(),this._cts.dispose(!0)}run(){var C,W;return __awaiter$e(this,void 0,void 0,function*(){if(this._cts.dispose(!0),this._cts=new CancellationTokenSource$1,!this.editor.hasModel())return;const V=this.editor.getPosition(),U=new RenameSkeleton(this.editor.getModel(),V,this._languageFeaturesService.renameProvider);if(!U.hasProvider())return;const G=new EditorStateCancellationTokenSource(this.editor,5,void 0,this._cts.token);let Z;try{const oe=U.resolveRenameLocation(G.token);this._progressService.showWhile(oe,250),Z=yield oe}catch(oe){(C=MessageController.get(this.editor))===null||C===void 0||C.showMessage(oe||localize("resolveRenameLocationFailed","An unknown error occurred while resolving rename location"),V);return}finally{G.dispose()}if(!Z)return;if(Z.rejectReason){(W=MessageController.get(this.editor))===null||W===void 0||W.showMessage(Z.rejectReason,V);return}if(G.token.isCancellationRequested)return;const X=new EditorStateCancellationTokenSource(this.editor,5,Z.range,this._cts.token),Q=this.editor.getSelection();let J=0,ee=Z.text.length;!Range$2.isEmpty(Q)&&!Range$2.spansMultipleLines(Q)&&Range$2.containsRange(Z.range,Q)&&(J=Math.max(0,Q.startColumn-Z.range.startColumn),ee=Math.min(Z.range.endColumn,Q.endColumn)-Z.range.startColumn);const te=this._bulkEditService.hasPreviewHandler()&&this._configService.getValue(this.editor.getModel().uri,"editor.rename.enablePreview"),ie=yield this._renameInputField.getInput(Z.range,Z.text,J,ee,te,X.token);if(typeof ie=="boolean"){ie&&this.editor.focus(),X.dispose();return}this.editor.focus();const ne=raceCancellation(U.provideRenameEdits(ie.newName,X.token),X.token).then(oe=>__awaiter$e(this,void 0,void 0,function*(){if(!(!oe||!this.editor.hasModel())){if(oe.rejectReason){this._notificationService.info(oe.rejectReason);return}this.editor.setSelection(Range$2.fromPositions(this.editor.getSelection().getPosition())),this._bulkEditService.apply(oe,{editor:this.editor,showPreview:ie.wantsPreview,label:localize("label","Renaming '{0}' to '{1}'",Z==null?void 0:Z.text,ie.newName),code:"undoredo.rename",quotableLabel:localize("quotableLabel","Renaming {0} to {1}",Z==null?void 0:Z.text,ie.newName),respectAutoSaveConfig:!0}).then(re=>{re.ariaSummary&&alert(localize("aria","Successfully renamed '{0}' to '{1}'. Summary: {2}",Z.text,ie.newName,re.ariaSummary))}).catch(re=>{this._notificationService.error(localize("rename.failedApply","Rename failed to apply edits")),this._logService.error(re)})}}),oe=>{this._notificationService.error(localize("rename.failed","Rename failed to compute edits")),this._logService.error(oe)}).finally(()=>{X.dispose()});return this._progressService.showWhile(ne,250),ne})}acceptRenameInput(C){this._renameInputField.acceptInput(C)}cancelRenameInput(){this._renameInputField.cancelInput(!0)}};RenameController.ID="editor.contrib.renameController";RenameController=RenameController_1=__decorate$k([__param$k(1,IInstantiationService),__param$k(2,INotificationService),__param$k(3,IBulkEditService),__param$k(4,IEditorProgressService),__param$k(5,ILogService),__param$k(6,ITextResourceConfigurationService),__param$k(7,ILanguageFeaturesService)],RenameController);class RenameAction extends EditorAction{constructor(){super({id:"editor.action.rename",label:localize("rename.label","Rename Symbol"),alias:"Rename Symbol",precondition:ContextKeyExpr.and(EditorContextKeys.writable,EditorContextKeys.hasRenameProvider),kbOpts:{kbExpr:EditorContextKeys.editorTextFocus,primary:60,weight:100},contextMenuOpts:{group:"1_modification",order:1.1}})}runCommand(C,W){const V=C.get(ICodeEditorService),[U,G]=Array.isArray(W)&&W||[void 0,void 0];return URI.isUri(U)&&Position$1.isIPosition(G)?V.openCodeEditor({resource:U},V.getActiveCodeEditor()).then(Z=>{Z&&(Z.setPosition(G),Z.invokeWithinContext(X=>(this.reportTelemetry(X,Z),this.run(X,Z))))},onUnexpectedError):super.runCommand(C,W)}run(C,W){const V=RenameController.get(W);return V?V.run():Promise.resolve()}}registerEditorContribution(RenameController.ID,RenameController,4);registerEditorAction(RenameAction);const RenameCommand=EditorCommand.bindToContribution(RenameController.get);registerEditorCommand(new RenameCommand({id:"acceptRenameInput",precondition:CONTEXT_RENAME_INPUT_VISIBLE,handler:K=>K.acceptRenameInput(!1),kbOpts:{weight:100+99,kbExpr:ContextKeyExpr.and(EditorContextKeys.focus,ContextKeyExpr.not("isComposing")),primary:3}}));registerEditorCommand(new RenameCommand({id:"acceptRenameInputWithPreview",precondition:ContextKeyExpr.and(CONTEXT_RENAME_INPUT_VISIBLE,ContextKeyExpr.has("config.editor.rename.enablePreview")),handler:K=>K.acceptRenameInput(!0),kbOpts:{weight:100+99,kbExpr:ContextKeyExpr.and(EditorContextKeys.focus,ContextKeyExpr.not("isComposing")),primary:1024+3}}));registerEditorCommand(new RenameCommand({id:"cancelRenameInput",precondition:CONTEXT_RENAME_INPUT_VISIBLE,handler:K=>K.cancelRenameInput(),kbOpts:{weight:100+99,kbExpr:EditorContextKeys.focus,primary:9,secondary:[1033]}}));registerModelAndPositionCommand("_executeDocumentRenameProvider",function(K,C,W,...V){const[U]=V;assertType(typeof U=="string");const{renameProvider:G}=K.get(ILanguageFeaturesService);return rename(G,C,W,U)});registerModelAndPositionCommand("_executePrepareRename",function(K,C,W){return __awaiter$e(this,void 0,void 0,function*(){const{renameProvider:V}=K.get(ILanguageFeaturesService),G=yield new RenameSkeleton(C,W,V).resolveRenameLocation(CancellationToken.None);if(G!=null&&G.rejectReason)throw new Error(G.rejectReason);return G})});Registry.as(Extensions$6.Configuration).registerConfiguration({id:"editor",properties:{"editor.rename.enablePreview":{scope:5,description:localize("enablePreview","Enable/disable the ability to preview changes before renaming"),default:!0,type:"boolean"}}});function reverseEndianness(K){for(let C=0,W=K.length;C<W;C+=4){const V=K[C+0],U=K[C+1],G=K[C+2],Z=K[C+3];K[C+0]=Z,K[C+1]=G,K[C+2]=U,K[C+3]=V}}function toLittleEndianBuffer(K){const C=new Uint8Array(K.buffer,K.byteOffset,K.length*4);return isLittleEndian()||reverseEndianness(C),VSBuffer.wrap(C)}function encodeSemanticTokensDto(K){const C=new Uint32Array(encodeSemanticTokensDtoSize(K));let W=0;if(C[W++]=K.id,K.type==="full")C[W++]=1,C[W++]=K.data.length,C.set(K.data,W),W+=K.data.length;else{C[W++]=2,C[W++]=K.deltas.length;for(const V of K.deltas)C[W++]=V.start,C[W++]=V.deleteCount,V.data?(C[W++]=V.data.length,C.set(V.data,W),W+=V.data.length):C[W++]=0}return toLittleEndianBuffer(C)}function encodeSemanticTokensDtoSize(K){let C=0;if(C+=1+1,K.type==="full")C+=1+K.data.length;else{C+=1,C+=(1+1+1)*K.deltas.length;for(const W of K.deltas)W.data&&(C+=W.data.length)}return C}var __awaiter$d=globalThis&&globalThis.__awaiter||function(K,C,W,V){function U(G){return G instanceof W?G:new W(function(Z){Z(G)})}return new(W||(W=Promise))(function(G,Z){function X(ee){try{J(V.next(ee))}catch(te){Z(te)}}function Q(ee){try{J(V.throw(ee))}catch(te){Z(te)}}function J(ee){ee.done?G(ee.value):U(ee.value).then(X,Q)}J((V=V.apply(K,C||[])).next())})};function isSemanticTokens(K){return K&&!!K.data}function isSemanticTokensEdits(K){return K&&Array.isArray(K.edits)}class DocumentSemanticTokensResult{constructor(C,W,V){this.provider=C,this.tokens=W,this.error=V}}function hasDocumentSemanticTokensProvider(K,C){return K.has(C)}function getDocumentSemanticTokensProviders(K,C){const W=K.orderedGroups(C);return W.length>0?W[0]:[]}function getDocumentSemanticTokens(K,C,W,V,U){return __awaiter$d(this,void 0,void 0,function*(){const G=getDocumentSemanticTokensProviders(K,C),Z=yield Promise.all(G.map(X=>__awaiter$d(this,void 0,void 0,function*(){let Q,J=null;try{Q=yield X.provideDocumentSemanticTokens(C,X===W?V:null,U)}catch(ee){J=ee,Q=null}return(!Q||!isSemanticTokens(Q)&&!isSemanticTokensEdits(Q))&&(Q=null),new DocumentSemanticTokensResult(X,Q,J)})));for(const X of Z){if(X.error)throw X.error;if(X.tokens)return X}return Z.length>0?Z[0]:null})}function _getDocumentSemanticTokensProviderHighestGroup(K,C){const W=K.orderedGroups(C);return W.length>0?W[0]:null}class DocumentRangeSemanticTokensResult{constructor(C,W){this.provider=C,this.tokens=W}}function hasDocumentRangeSemanticTokensProvider(K,C){return K.has(C)}function getDocumentRangeSemanticTokensProviders(K,C){const W=K.orderedGroups(C);return W.length>0?W[0]:[]}function getDocumentRangeSemanticTokens(K,C,W,V){return __awaiter$d(this,void 0,void 0,function*(){const U=getDocumentRangeSemanticTokensProviders(K,C),G=yield Promise.all(U.map(Z=>__awaiter$d(this,void 0,void 0,function*(){let X;try{X=yield Z.provideDocumentRangeSemanticTokens(C,W,V)}catch(Q){onUnexpectedExternalError(Q),X=null}return(!X||!isSemanticTokens(X))&&(X=null),new DocumentRangeSemanticTokensResult(Z,X)})));for(const Z of G)if(Z.tokens)return Z;return G.length>0?G[0]:null})}CommandsRegistry.registerCommand("_provideDocumentSemanticTokensLegend",(K,...C)=>__awaiter$d(void 0,void 0,void 0,function*(){const[W]=C;assertType(W instanceof URI);const V=K.get(IModelService).getModel(W);if(!V)return;const{documentSemanticTokensProvider:U}=K.get(ILanguageFeaturesService),G=_getDocumentSemanticTokensProviderHighestGroup(U,V);return G?G[0].getLegend():K.get(ICommandService).executeCommand("_provideDocumentRangeSemanticTokensLegend",W)}));CommandsRegistry.registerCommand("_provideDocumentSemanticTokens",(K,...C)=>__awaiter$d(void 0,void 0,void 0,function*(){const[W]=C;assertType(W instanceof URI);const V=K.get(IModelService).getModel(W);if(!V)return;const{documentSemanticTokensProvider:U}=K.get(ILanguageFeaturesService);if(!hasDocumentSemanticTokensProvider(U,V))return K.get(ICommandService).executeCommand("_provideDocumentRangeSemanticTokens",W,V.getFullModelRange());const G=yield getDocumentSemanticTokens(U,V,null,null,CancellationToken.None);if(!G)return;const{provider:Z,tokens:X}=G;if(!X||!isSemanticTokens(X))return;const Q=encodeSemanticTokensDto({id:0,type:"full",data:X.data});return X.resultId&&Z.releaseDocumentSemanticTokens(X.resultId),Q}));CommandsRegistry.registerCommand("_provideDocumentRangeSemanticTokensLegend",(K,...C)=>__awaiter$d(void 0,void 0,void 0,function*(){const[W,V]=C;assertType(W instanceof URI);const U=K.get(IModelService).getModel(W);if(!U)return;const{documentRangeSemanticTokensProvider:G}=K.get(ILanguageFeaturesService),Z=getDocumentRangeSemanticTokensProviders(G,U);if(Z.length===0)return;if(Z.length===1)return Z[0].getLegend();if(!V||!Range$2.isIRange(V))return console.warn("provideDocumentRangeSemanticTokensLegend might be out-of-sync with provideDocumentRangeSemanticTokens unless a range argument is passed in"),Z[0].getLegend();const X=yield getDocumentRangeSemanticTokens(G,U,Range$2.lift(V),CancellationToken.None);if(X)return X.provider.getLegend()}));CommandsRegistry.registerCommand("_provideDocumentRangeSemanticTokens",(K,...C)=>__awaiter$d(void 0,void 0,void 0,function*(){const[W,V]=C;assertType(W instanceof URI),assertType(Range$2.isIRange(V));const U=K.get(IModelService).getModel(W);if(!U)return;const{documentRangeSemanticTokensProvider:G}=K.get(ILanguageFeaturesService),Z=yield getDocumentRangeSemanticTokens(G,U,Range$2.lift(V),CancellationToken.None);if(!(!Z||!Z.tokens))return encodeSemanticTokensDto({id:0,type:"full",data:Z.tokens.data})}));const SEMANTIC_HIGHLIGHTING_SETTING_ID="editor.semanticHighlighting";function isSemanticColoringEnabled(K,C,W){var V;const U=(V=W.getValue(SEMANTIC_HIGHLIGHTING_SETTING_ID,{overrideIdentifier:K.getLanguageId(),resource:K.uri}))===null||V===void 0?void 0:V.enabled;return typeof U=="boolean"?U:C.getColorTheme().semanticHighlighting}var __decorate$j=globalThis&&globalThis.__decorate||function(K,C,W,V){var U=arguments.length,G=U<3?C:V===null?V=Object.getOwnPropertyDescriptor(C,W):V,Z;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")G=Reflect.decorate(K,C,W,V);else for(var X=K.length-1;X>=0;X--)(Z=K[X])&&(G=(U<3?Z(G):U>3?Z(C,W,G):Z(C,W))||G);return U>3&&G&&Object.defineProperty(C,W,G),G},__param$j=globalThis&&globalThis.__param||function(K,C){return function(W,V){C(W,V,K)}},ModelSemanticColoring_1;let DocumentSemanticTokensFeature=class extends Disposable{constructor(C,W,V,U,G,Z){super(),this._watchers=Object.create(null);const X=ee=>{this._watchers[ee.uri.toString()]=new ModelSemanticColoring(ee,C,V,G,Z)},Q=(ee,te)=>{te.dispose(),delete this._watchers[ee.uri.toString()]},J=()=>{for(const ee of W.getModels()){const te=this._watchers[ee.uri.toString()];isSemanticColoringEnabled(ee,V,U)?te||X(ee):te&&Q(ee,te)}};this._register(W.onModelAdded(ee=>{isSemanticColoringEnabled(ee,V,U)&&X(ee)})),this._register(W.onModelRemoved(ee=>{const te=this._watchers[ee.uri.toString()];te&&Q(ee,te)})),this._register(U.onDidChangeConfiguration(ee=>{ee.affectsConfiguration(SEMANTIC_HIGHLIGHTING_SETTING_ID)&&J()})),this._register(V.onDidColorThemeChange(J))}dispose(){for(const C of Object.values(this._watchers))C.dispose();super.dispose()}};DocumentSemanticTokensFeature=__decorate$j([__param$j(0,ISemanticTokensStylingService),__param$j(1,IModelService),__param$j(2,IThemeService),__param$j(3,IConfigurationService),__param$j(4,ILanguageFeatureDebounceService),__param$j(5,ILanguageFeaturesService)],DocumentSemanticTokensFeature);let ModelSemanticColoring=ModelSemanticColoring_1=class extends Disposable{constructor(C,W,V,U,G){super(),this._semanticTokensStylingService=W,this._isDisposed=!1,this._model=C,this._provider=G.documentSemanticTokensProvider,this._debounceInformation=U.for(this._provider,"DocumentSemanticTokens",{min:ModelSemanticColoring_1.REQUEST_MIN_DELAY,max:ModelSemanticColoring_1.REQUEST_MAX_DELAY}),this._fetchDocumentSemanticTokens=this._register(new RunOnceScheduler(()=>this._fetchDocumentSemanticTokensNow(),ModelSemanticColoring_1.REQUEST_MIN_DELAY)),this._currentDocumentResponse=null,this._currentDocumentRequestCancellationTokenSource=null,this._documentProvidersChangeListeners=[],this._providersChangedDuringRequest=!1,this._register(this._model.onDidChangeContent(()=>{this._fetchDocumentSemanticTokens.isScheduled()||this._fetchDocumentSemanticTokens.schedule(this._debounceInformation.get(this._model))})),this._register(this._model.onDidChangeAttached(()=>{this._fetchDocumentSemanticTokens.isScheduled()||this._fetchDocumentSemanticTokens.schedule(this._debounceInformation.get(this._model))})),this._register(this._model.onDidChangeLanguage(()=>{this._currentDocumentResponse&&(this._currentDocumentResponse.dispose(),this._currentDocumentResponse=null),this._currentDocumentRequestCancellationTokenSource&&(this._currentDocumentRequestCancellationTokenSource.cancel(),this._currentDocumentRequestCancellationTokenSource=null),this._setDocumentSemanticTokens(null,null,null,[]),this._fetchDocumentSemanticTokens.schedule(0)}));const Z=()=>{dispose(this._documentProvidersChangeListeners),this._documentProvidersChangeListeners=[];for(const X of this._provider.all(C))typeof X.onDidChange=="function"&&this._documentProvidersChangeListeners.push(X.onDidChange(()=>{if(this._currentDocumentRequestCancellationTokenSource){this._providersChangedDuringRequest=!0;return}this._fetchDocumentSemanticTokens.schedule(0)}))};Z(),this._register(this._provider.onDidChange(()=>{Z(),this._fetchDocumentSemanticTokens.schedule(this._debounceInformation.get(this._model))})),this._register(V.onDidColorThemeChange(X=>{this._setDocumentSemanticTokens(null,null,null,[]),this._fetchDocumentSemanticTokens.schedule(this._debounceInformation.get(this._model))})),this._fetchDocumentSemanticTokens.schedule(0)}dispose(){this._currentDocumentResponse&&(this._currentDocumentResponse.dispose(),this._currentDocumentResponse=null),this._currentDocumentRequestCancellationTokenSource&&(this._currentDocumentRequestCancellationTokenSource.cancel(),this._currentDocumentRequestCancellationTokenSource=null),dispose(this._documentProvidersChangeListeners),this._documentProvidersChangeListeners=[],this._setDocumentSemanticTokens(null,null,null,[]),this._isDisposed=!0,super.dispose()}_fetchDocumentSemanticTokensNow(){if(this._currentDocumentRequestCancellationTokenSource)return;if(!hasDocumentSemanticTokensProvider(this._provider,this._model)){this._currentDocumentResponse&&this._model.tokenization.setSemanticTokens(null,!1);return}if(!this._model.isAttachedToEditor())return;const C=new CancellationTokenSource$1,W=this._currentDocumentResponse?this._currentDocumentResponse.provider:null,V=this._currentDocumentResponse&&this._currentDocumentResponse.resultId||null,U=getDocumentSemanticTokens(this._provider,this._model,W,V,C.token);this._currentDocumentRequestCancellationTokenSource=C,this._providersChangedDuringRequest=!1;const G=[],Z=this._model.onDidChangeContent(Q=>{G.push(Q)}),X=new StopWatch(!1);U.then(Q=>{if(this._debounceInformation.update(this._model,X.elapsed()),this._currentDocumentRequestCancellationTokenSource=null,Z.dispose(),!Q)this._setDocumentSemanticTokens(null,null,null,G);else{const{provider:J,tokens:ee}=Q,te=this._semanticTokensStylingService.getStyling(J);this._setDocumentSemanticTokens(J,ee||null,te,G)}},Q=>{Q&&(isCancellationError(Q)||typeof Q.message=="string"&&Q.message.indexOf("busy")!==-1)||onUnexpectedError(Q),this._currentDocumentRequestCancellationTokenSource=null,Z.dispose(),(G.length>0||this._providersChangedDuringRequest)&&(this._fetchDocumentSemanticTokens.isScheduled()||this._fetchDocumentSemanticTokens.schedule(this._debounceInformation.get(this._model)))})}static _copy(C,W,V,U,G){G=Math.min(G,V.length-U,C.length-W);for(let Z=0;Z<G;Z++)V[U+Z]=C[W+Z]}_setDocumentSemanticTokens(C,W,V,U){const G=this._currentDocumentResponse,Z=()=>{(U.length>0||this._providersChangedDuringRequest)&&!this._fetchDocumentSemanticTokens.isScheduled()&&this._fetchDocumentSemanticTokens.schedule(this._debounceInformation.get(this._model))};if(this._currentDocumentResponse&&(this._currentDocumentResponse.dispose(),this._currentDocumentResponse=null),this._isDisposed){C&&W&&C.releaseDocumentSemanticTokens(W.resultId);return}if(!C||!V){this._model.tokenization.setSemanticTokens(null,!1);return}if(!W){this._model.tokenization.setSemanticTokens(null,!0),Z();return}if(isSemanticTokensEdits(W)){if(!G){this._model.tokenization.setSemanticTokens(null,!0);return}if(W.edits.length===0)W={resultId:W.resultId,data:G.data};else{let X=0;for(const ie of W.edits)X+=(ie.data?ie.data.length:0)-ie.deleteCount;const Q=G.data,J=new Uint32Array(Q.length+X);let ee=Q.length,te=J.length;for(let ie=W.edits.length-1;ie>=0;ie--){const ne=W.edits[ie];if(ne.start>Q.length){V.warnInvalidEditStart(G.resultId,W.resultId,ie,ne.start,Q.length),this._model.tokenization.setSemanticTokens(null,!0);return}const oe=ee-(ne.start+ne.deleteCount);oe>0&&(ModelSemanticColoring_1._copy(Q,ee-oe,J,te-oe,oe),te-=oe),ne.data&&(ModelSemanticColoring_1._copy(ne.data,0,J,te-ne.data.length,ne.data.length),te-=ne.data.length),ee=ne.start}ee>0&&ModelSemanticColoring_1._copy(Q,0,J,0,ee),W={resultId:W.resultId,data:J}}}if(isSemanticTokens(W)){this._currentDocumentResponse=new SemanticTokensResponse(C,W.resultId,W.data);const X=toMultilineTokens2(W,V,this._model.getLanguageId());if(U.length>0)for(const Q of U)for(const J of X)for(const ee of Q.changes)J.applyEdit(ee.range,ee.text);this._model.tokenization.setSemanticTokens(X,!0)}else this._model.tokenization.setSemanticTokens(null,!0);Z()}};ModelSemanticColoring.REQUEST_MIN_DELAY=300;ModelSemanticColoring.REQUEST_MAX_DELAY=2e3;ModelSemanticColoring=ModelSemanticColoring_1=__decorate$j([__param$j(1,ISemanticTokensStylingService),__param$j(2,IThemeService),__param$j(3,ILanguageFeatureDebounceService),__param$j(4,ILanguageFeaturesService)],ModelSemanticColoring);class SemanticTokensResponse{constructor(C,W,V){this.provider=C,this.resultId=W,this.data=V}dispose(){this.provider.releaseDocumentSemanticTokens(this.resultId)}}registerEditorFeature(DocumentSemanticTokensFeature);var __decorate$i=globalThis&&globalThis.__decorate||function(K,C,W,V){var U=arguments.length,G=U<3?C:V===null?V=Object.getOwnPropertyDescriptor(C,W):V,Z;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")G=Reflect.decorate(K,C,W,V);else for(var X=K.length-1;X>=0;X--)(Z=K[X])&&(G=(U<3?Z(G):U>3?Z(C,W,G):Z(C,W))||G);return U>3&&G&&Object.defineProperty(C,W,G),G},__param$i=globalThis&&globalThis.__param||function(K,C){return function(W,V){C(W,V,K)}};let ViewportSemanticTokensContribution=class extends Disposable{constructor(C,W,V,U,G,Z){super(),this._semanticTokensStylingService=W,this._themeService=V,this._configurationService=U,this._editor=C,this._provider=Z.documentRangeSemanticTokensProvider,this._debounceInformation=G.for(this._provider,"DocumentRangeSemanticTokens",{min:100,max:500}),this._tokenizeViewport=this._register(new RunOnceScheduler(()=>this._tokenizeViewportNow(),100)),this._outstandingRequests=[];const X=()=>{this._editor.hasModel()&&this._tokenizeViewport.schedule(this._debounceInformation.get(this._editor.getModel()))};this._register(this._editor.onDidScrollChange(()=>{X()})),this._register(this._editor.onDidChangeModel(()=>{this._cancelAll(),X()})),this._register(this._editor.onDidChangeModelContent(Q=>{this._cancelAll(),X()})),this._register(this._provider.onDidChange(()=>{this._cancelAll(),X()})),this._register(this._configurationService.onDidChangeConfiguration(Q=>{Q.affectsConfiguration(SEMANTIC_HIGHLIGHTING_SETTING_ID)&&(this._cancelAll(),X())})),this._register(this._themeService.onDidColorThemeChange(()=>{this._cancelAll(),X()})),X()}_cancelAll(){for(const C of this._outstandingRequests)C.cancel();this._outstandingRequests=[]}_removeOutstandingRequest(C){for(let W=0,V=this._outstandingRequests.length;W<V;W++)if(this._outstandingRequests[W]===C){this._outstandingRequests.splice(W,1);return}}_tokenizeViewportNow(){if(!this._editor.hasModel())return;const C=this._editor.getModel();if(C.tokenization.hasCompleteSemanticTokens())return;if(!isSemanticColoringEnabled(C,this._themeService,this._configurationService)){C.tokenization.hasSomeSemanticTokens()&&C.tokenization.setSemanticTokens(null,!1);return}if(!hasDocumentRangeSemanticTokensProvider(this._provider,C)){C.tokenization.hasSomeSemanticTokens()&&C.tokenization.setSemanticTokens(null,!1);return}const W=this._editor.getVisibleRangesPlusViewportAboveBelow();this._outstandingRequests=this._outstandingRequests.concat(W.map(V=>this._requestRange(C,V)))}_requestRange(C,W){const V=C.getVersionId(),U=createCancelablePromise(Z=>Promise.resolve(getDocumentRangeSemanticTokens(this._provider,C,W,Z))),G=new StopWatch(!1);return U.then(Z=>{if(this._debounceInformation.update(C,G.elapsed()),!Z||!Z.tokens||C.isDisposed()||C.getVersionId()!==V)return;const{provider:X,tokens:Q}=Z,J=this._semanticTokensStylingService.getStyling(X);C.tokenization.setPartialSemanticTokens(W,toMultilineTokens2(Q,J,C.getLanguageId()))}).then(()=>this._removeOutstandingRequest(U),()=>this._removeOutstandingRequest(U)),U}};ViewportSemanticTokensContribution.ID="editor.contrib.viewportSemanticTokens";ViewportSemanticTokensContribution=__decorate$i([__param$i(1,ISemanticTokensStylingService),__param$i(2,IThemeService),__param$i(3,IConfigurationService),__param$i(4,ILanguageFeatureDebounceService),__param$i(5,ILanguageFeaturesService)],ViewportSemanticTokensContribution);registerEditorContribution(ViewportSemanticTokensContribution.ID,ViewportSemanticTokensContribution,1);class WordSelectionRangeProvider{constructor(C=!0){this.selectSubwords=C}provideSelectionRanges(C,W){const V=[];for(const U of W){const G=[];V.push(G),this.selectSubwords&&this._addInWordRanges(G,C,U),this._addWordRanges(G,C,U),this._addWhitespaceLine(G,C,U),G.push({range:C.getFullModelRange()})}return V}_addInWordRanges(C,W,V){const U=W.getWordAtPosition(V);if(!U)return;const{word:G,startColumn:Z}=U,X=V.column-Z;let Q=X,J=X,ee=0;for(;Q>=0;Q--){const te=G.charCodeAt(Q);if(Q!==X&&(te===95||te===45))break;if(isLowerAsciiLetter(te)&&isUpperAsciiLetter(ee))break;ee=te}for(Q+=1;J<G.length;J++){const te=G.charCodeAt(J);if(isUpperAsciiLetter(te)&&isLowerAsciiLetter(ee))break;if(te===95||te===45)break;ee=te}Q<J&&C.push({range:new Range$2(V.lineNumber,Z+Q,V.lineNumber,Z+J)})}_addWordRanges(C,W,V){const U=W.getWordAtPosition(V);U&&C.push({range:new Range$2(V.lineNumber,U.startColumn,V.lineNumber,U.endColumn)})}_addWhitespaceLine(C,W,V){W.getLineLength(V.lineNumber)>0&&W.getLineFirstNonWhitespaceColumn(V.lineNumber)===0&&W.getLineLastNonWhitespaceColumn(V.lineNumber)===0&&C.push({range:new Range$2(V.lineNumber,1,V.lineNumber,W.getLineMaxColumn(V.lineNumber))})}}var __decorate$h=globalThis&&globalThis.__decorate||function(K,C,W,V){var U=arguments.length,G=U<3?C:V===null?V=Object.getOwnPropertyDescriptor(C,W):V,Z;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")G=Reflect.decorate(K,C,W,V);else for(var X=K.length-1;X>=0;X--)(Z=K[X])&&(G=(U<3?Z(G):U>3?Z(C,W,G):Z(C,W))||G);return U>3&&G&&Object.defineProperty(C,W,G),G},__param$h=globalThis&&globalThis.__param||function(K,C){return function(W,V){C(W,V,K)}},__awaiter$c=globalThis&&globalThis.__awaiter||function(K,C,W,V){function U(G){return G instanceof W?G:new W(function(Z){Z(G)})}return new(W||(W=Promise))(function(G,Z){function X(ee){try{J(V.next(ee))}catch(te){Z(te)}}function Q(ee){try{J(V.throw(ee))}catch(te){Z(te)}}function J(ee){ee.done?G(ee.value):U(ee.value).then(X,Q)}J((V=V.apply(K,C||[])).next())})},SmartSelectController_1;class SelectionRanges{constructor(C,W){this.index=C,this.ranges=W}mov(C){const W=this.index+(C?1:-1);if(W<0||W>=this.ranges.length)return this;const V=new SelectionRanges(W,this.ranges);return V.ranges[W].equalsRange(this.ranges[this.index])?V.mov(C):V}}let SmartSelectController=SmartSelectController_1=class{static get(C){return C.getContribution(SmartSelectController_1.ID)}constructor(C,W){this._editor=C,this._languageFeaturesService=W,this._ignoreSelection=!1}dispose(){var C;(C=this._selectionListener)===null||C===void 0||C.dispose()}run(C){return __awaiter$c(this,void 0,void 0,function*(){if(!this._editor.hasModel())return;const W=this._editor.getSelections(),V=this._editor.getModel();if(this._state||(yield provideSelectionRanges(this._languageFeaturesService.selectionRangeProvider,V,W.map(G=>G.getPosition()),this._editor.getOption(112),CancellationToken.None).then(G=>{var Z;if(!(!isNonEmptyArray$2(G)||G.length!==W.length)&&!(!this._editor.hasModel()||!equals$5(this._editor.getSelections(),W,(X,Q)=>X.equalsSelection(Q)))){for(let X=0;X<G.length;X++)G[X]=G[X].filter(Q=>Q.containsPosition(W[X].getStartPosition())&&Q.containsPosition(W[X].getEndPosition())),G[X].unshift(W[X]);this._state=G.map(X=>new SelectionRanges(0,X)),(Z=this._selectionListener)===null||Z===void 0||Z.dispose(),this._selectionListener=this._editor.onDidChangeCursorPosition(()=>{var X;this._ignoreSelection||((X=this._selectionListener)===null||X===void 0||X.dispose(),this._state=void 0)})}})),!this._state)return;this._state=this._state.map(G=>G.mov(C));const U=this._state.map(G=>Selection$1.fromPositions(G.ranges[G.index].getStartPosition(),G.ranges[G.index].getEndPosition()));this._ignoreSelection=!0;try{this._editor.setSelections(U)}finally{this._ignoreSelection=!1}})}};SmartSelectController.ID="editor.contrib.smartSelectController";SmartSelectController=SmartSelectController_1=__decorate$h([__param$h(1,ILanguageFeaturesService)],SmartSelectController);class AbstractSmartSelect extends EditorAction{constructor(C,W){super(W),this._forward=C}run(C,W){return __awaiter$c(this,void 0,void 0,function*(){const V=SmartSelectController.get(W);V&&(yield V.run(this._forward))})}}class GrowSelectionAction extends AbstractSmartSelect{constructor(){super(!0,{id:"editor.action.smartSelect.expand",label:localize("smartSelect.expand","Expand Selection"),alias:"Expand Selection",precondition:void 0,kbOpts:{kbExpr:EditorContextKeys.editorTextFocus,primary:1553,mac:{primary:3345,secondary:[1297]},weight:100},menuOpts:{menuId:MenuId.MenubarSelectionMenu,group:"1_basic",title:localize({key:"miSmartSelectGrow",comment:["&& denotes a mnemonic"]},"&&Expand Selection"),order:2}})}}CommandsRegistry.registerCommandAlias("editor.action.smartSelect.grow","editor.action.smartSelect.expand");class ShrinkSelectionAction extends AbstractSmartSelect{constructor(){super(!1,{id:"editor.action.smartSelect.shrink",label:localize("smartSelect.shrink","Shrink Selection"),alias:"Shrink Selection",precondition:void 0,kbOpts:{kbExpr:EditorContextKeys.editorTextFocus,primary:1551,mac:{primary:3343,secondary:[1295]},weight:100},menuOpts:{menuId:MenuId.MenubarSelectionMenu,group:"1_basic",title:localize({key:"miSmartSelectShrink",comment:["&& denotes a mnemonic"]},"&&Shrink Selection"),order:3}})}}registerEditorContribution(SmartSelectController.ID,SmartSelectController,4);registerEditorAction(GrowSelectionAction);registerEditorAction(ShrinkSelectionAction);function provideSelectionRanges(K,C,W,V,U){return __awaiter$c(this,void 0,void 0,function*(){const G=K.all(C).concat(new WordSelectionRangeProvider(V.selectSubwords));G.length===1&&G.unshift(new BracketSelectionRangeProvider);const Z=[],X=[];for(const Q of G)Z.push(Promise.resolve(Q.provideSelectionRanges(C,W,U)).then(J=>{if(isNonEmptyArray$2(J)&&J.length===W.length)for(let ee=0;ee<W.length;ee++){X[ee]||(X[ee]=[]);for(const te of J[ee])Range$2.isIRange(te.range)&&Range$2.containsPosition(te.range,W[ee])&&X[ee].push(Range$2.lift(te.range))}},onUnexpectedExternalError));return yield Promise.all(Z),X.map(Q=>{if(Q.length===0)return[];Q.sort((ie,ne)=>Position$1.isBefore(ie.getStartPosition(),ne.getStartPosition())?1:Position$1.isBefore(ne.getStartPosition(),ie.getStartPosition())||Position$1.isBefore(ie.getEndPosition(),ne.getEndPosition())?-1:Position$1.isBefore(ne.getEndPosition(),ie.getEndPosition())?1:0);const J=[];let ee;for(const ie of Q)(!ee||Range$2.containsRange(ie,ee)&&!Range$2.equalsRange(ie,ee))&&(J.push(ie),ee=ie);if(!V.selectLeadingAndTrailingWhitespace)return J;const te=[J[0]];for(let ie=1;ie<J.length;ie++){const ne=J[ie-1],oe=J[ie];if(oe.startLineNumber!==ne.startLineNumber||oe.endLineNumber!==ne.endLineNumber){const re=new Range$2(ne.startLineNumber,C.getLineFirstNonWhitespaceColumn(ne.startLineNumber),ne.endLineNumber,C.getLineLastNonWhitespaceColumn(ne.endLineNumber));re.containsRange(ne)&&!re.equalsRange(ne)&&oe.containsRange(re)&&!oe.equalsRange(re)&&te.push(re);const ae=new Range$2(ne.startLineNumber,1,ne.endLineNumber,C.getLineMaxColumn(ne.endLineNumber));ae.containsRange(ne)&&!ae.equalsRange(re)&&oe.containsRange(ae)&&!oe.equalsRange(ae)&&te.push(ae)}te.push(oe)}return te})})}CommandsRegistry.registerCommand("_executeSelectionRangeProvider",function(K,...C){return __awaiter$c(this,void 0,void 0,function*(){const[W,V]=C;assertType(URI.isUri(W));const U=K.get(ILanguageFeaturesService).selectionRangeProvider,G=yield K.get(ITextModelService).createModelReference(W);try{return provideSelectionRanges(U,G.object.textEditorModel,V,{selectLeadingAndTrailingWhitespace:!0,selectSubwords:!0},CancellationToken.None)}finally{G.dispose()}})});const Categories=Object.freeze({View:{value:localize("view","View"),original:"View"},Help:{value:localize("help","Help"),original:"Help"},Test:{value:localize("test","Test"),original:"Test"},File:{value:localize("file","File"),original:"File"},Preferences:{value:localize("preferences","Preferences"),original:"Preferences"},Developer:{value:localize({key:"developer",comment:["A developer on Code itself or someone diagnosing issues in Code"]},"Developer"),original:"Developer"}}),stickyScroll="";var __awaiter$b=globalThis&&globalThis.__awaiter||function(K,C,W,V){function U(G){return G instanceof W?G:new W(function(Z){Z(G)})}return new(W||(W=Promise))(function(G,Z){function X(ee){try{J(V.next(ee))}catch(te){Z(te)}}function Q(ee){try{J(V.throw(ee))}catch(te){Z(te)}}function J(ee){ee.done?G(ee.value):U(ee.value).then(X,Q)}J((V=V.apply(K,C||[])).next())})};class StickyScrollWidgetState{constructor(C,W,V,U=null){this.startLineNumbers=C,this.endLineNumbers=W,this.lastLineRelativePosition=V,this.showEndForLine=U}equals(C){return!!C&&this.lastLineRelativePosition===C.lastLineRelativePosition&&this.showEndForLine===C.showEndForLine&&equals$5(this.startLineNumbers,C.startLineNumbers)&&equals$5(this.endLineNumbers,C.endLineNumbers)}}const _ttPolicy=createTrustedTypesPolicy("stickyScrollViewLayer",{createHTML:K=>K}),STICKY_INDEX_ATTR="data-sticky-line-index",STICKY_IS_LINE_ATTR="data-sticky-is-line",STICKY_IS_LINE_NUMBER_ATTR="data-sticky-is-line-number",STICKY_IS_FOLDING_ICON_ATTR="data-sticky-is-folding-icon";class StickyScrollWidget extends Disposable{constructor(C){super(),this._editor=C,this._foldingIconStore=new DisposableStore,this._rootDomNode=document.createElement("div"),this._lineNumbersDomNode=document.createElement("div"),this._linesDomNodeScrollable=document.createElement("div"),this._linesDomNode=document.createElement("div"),this._lineHeight=this._editor.getOption(66),this._stickyLines=[],this._lineNumbers=[],this._lastLineRelativePosition=0,this._minContentWidthInPx=0,this._isOnGlyphMargin=!1,this._lineNumbersDomNode.className="sticky-widget-line-numbers",this._lineNumbersDomNode.setAttribute("role","none"),this._linesDomNode.className="sticky-widget-lines",this._linesDomNode.setAttribute("role","list"),this._linesDomNodeScrollable.className="sticky-widget-lines-scrollable",this._linesDomNodeScrollable.appendChild(this._linesDomNode),this._rootDomNode.className="sticky-widget",this._rootDomNode.classList.toggle("peek",C instanceof EmbeddedCodeEditorWidget),this._rootDomNode.appendChild(this._lineNumbersDomNode),this._rootDomNode.appendChild(this._linesDomNodeScrollable);const W=()=>{this._linesDomNode.style.left=this._editor.getOption(114).scrollWithEditor?`-${this._editor.getScrollLeft()}px`:"0px"};this._register(this._editor.onDidChangeConfiguration(V=>{V.hasChanged(114)&&W(),V.hasChanged(66)&&(this._lineHeight=this._editor.getOption(66))})),this._register(this._editor.onDidScrollChange(V=>{V.scrollLeftChanged&&W(),V.scrollWidthChanged&&this._updateWidgetWidth()})),this._register(this._editor.onDidChangeModel(()=>{W(),this._updateWidgetWidth()})),this._register(this._foldingIconStore),W(),this._register(this._editor.onDidLayoutChange(V=>{this._updateWidgetWidth()})),this._updateWidgetWidth()}get lineNumbers(){return this._lineNumbers}get lineNumberCount(){return this._lineNumbers.length}getStickyLineForLine(C){return this._stickyLines.find(W=>W.lineNumber===C)}getCurrentLines(){return this._lineNumbers}setState(C,W,V=1/0){if((!this._previousState&&!C||this._previousState&&this._previousState.equals(C))&&V===1/0)return;this._previousState=C;const U=this._stickyLines;if(this._clearStickyWidget(),!C||!this._editor._getViewModel())return;if(C.startLineNumbers.length*this._lineHeight+C.lastLineRelativePosition>0){this._lastLineRelativePosition=C.lastLineRelativePosition;const Z=[...C.startLineNumbers];C.showEndForLine!==null&&(Z[C.showEndForLine]=C.endLineNumbers[C.showEndForLine]),this._lineNumbers=Z}else this._lastLineRelativePosition=0,this._lineNumbers=[];this._renderRootNode(U,W,V)}_updateWidgetWidth(){const C=this._editor.getLayoutInfo(),W=C.contentLeft;this._lineNumbersDomNode.style.width=`${W}px`,this._linesDomNodeScrollable.style.setProperty("--vscode-editorStickyScroll-scrollableWidth",`${this._editor.getScrollWidth()-C.verticalScrollbarWidth}px`),this._rootDomNode.style.width=`${C.width-C.verticalScrollbarWidth}px`}_clearStickyWidget(){this._stickyLines=[],this._foldingIconStore.clear(),clearNode(this._lineNumbersDomNode),clearNode(this._linesDomNode),this._rootDomNode.style.display="none"}_useFoldingOpacityTransition(C){this._lineNumbersDomNode.style.setProperty("--vscode-editorStickyScroll-foldingOpacityTransition",`opacity ${C?.5:0}s`)}_setFoldingIconsVisibility(C){for(const W of this._stickyLines){const V=W.foldingIcon;V&&V.setVisible(C?!0:V.isCollapsed)}}_renderRootNode(C,W,V=1/0){return __awaiter$b(this,void 0,void 0,function*(){const U=this._editor.getLayoutInfo();for(const[Z,X]of this._lineNumbers.entries()){const Q=C[Z],J=X>=V||(Q==null?void 0:Q.lineNumber)!==X?this._renderChildNode(Z,X,W,U):this._updateTopAndZIndexOfStickyLine(Q);J&&(this._linesDomNode.appendChild(J.lineDomNode),this._lineNumbersDomNode.appendChild(J.lineNumberDomNode),this._stickyLines.push(J))}W&&(this._setFoldingHoverListeners(),this._useFoldingOpacityTransition(!this._isOnGlyphMargin));const G=this._lineNumbers.length*this._lineHeight+this._lastLineRelativePosition;if(G===0){this._clearStickyWidget();return}this._rootDomNode.style.display="block",this._lineNumbersDomNode.style.height=`${G}px`,this._linesDomNodeScrollable.style.height=`${G}px`,this._rootDomNode.style.height=`${G}px`,this._rootDomNode.style.marginLeft="0px",this._updateMinContentWidth(),this._editor.layoutOverlayWidget(this)})}_setFoldingHoverListeners(){this._editor.getOption(109)==="mouseover"&&(this._foldingIconStore.add(addDisposableListener(this._lineNumbersDomNode,EventType$1.MOUSE_ENTER,W=>{this._isOnGlyphMargin=!0,this._setFoldingIconsVisibility(!0)})),this._foldingIconStore.add(addDisposableListener(this._lineNumbersDomNode,EventType$1.MOUSE_LEAVE,()=>{this._isOnGlyphMargin=!1,this._useFoldingOpacityTransition(!0),this._setFoldingIconsVisibility(!1)})))}_renderChildNode(C,W,V,U){const G=this._editor._getViewModel();if(!G)return;const Z=G.coordinatesConverter.convertModelPositionToViewPosition(new Position$1(W,1)).lineNumber,X=G.getViewLineRenderingData(Z),Q=this._editor.getOption(67);let J;try{J=LineDecoration.filter(X.inlineDecorations,Z,X.minColumn,X.maxColumn)}catch{J=[]}const ee=new RenderLineInput(!0,!0,X.content,X.continuesWithWrappedLine,X.isBasicASCII,X.containsRTL,0,X.tokens,J,X.tabSize,X.startVisibleColumn,1,1,1,500,"none",!0,!0,null),te=new StringBuilder(2e3),ie=renderViewLine(ee,te);let ne;_ttPolicy?ne=_ttPolicy.createHTML(te.build()):ne=te.build();const oe=document.createElement("span");oe.setAttribute(STICKY_INDEX_ATTR,String(C)),oe.setAttribute(STICKY_IS_LINE_ATTR,""),oe.setAttribute("role","listitem"),oe.tabIndex=0,oe.className="sticky-line-content",oe.classList.add(`stickyLine${W}`),oe.style.lineHeight=`${this._lineHeight}px`,oe.innerHTML=ne;const re=document.createElement("span");re.setAttribute(STICKY_INDEX_ATTR,String(C)),re.setAttribute(STICKY_IS_LINE_NUMBER_ATTR,""),re.className="sticky-line-number",re.style.lineHeight=`${this._lineHeight}px`;const ae=U.contentLeft;re.style.width=`${ae}px`;const se=document.createElement("span");Q.renderType===1||Q.renderType===3&&W%10===0?se.innerText=W.toString():Q.renderType===2&&(se.innerText=Math.abs(W-this._editor.getPosition().lineNumber).toString()),se.className="sticky-line-number-inner",se.style.lineHeight=`${this._lineHeight}px`,se.style.width=`${U.lineNumbersWidth}px`,se.style.paddingLeft=`${U.lineNumbersLeft}px`,re.appendChild(se);const le=this._renderFoldingIconForLine(V,W);le&&re.appendChild(le.domNode),this._editor.applyFontInfo(oe),this._editor.applyFontInfo(se),re.style.lineHeight=`${this._lineHeight}px`,oe.style.lineHeight=`${this._lineHeight}px`,re.style.height=`${this._lineHeight}px`,oe.style.height=`${this._lineHeight}px`;const ce=new RenderedStickyLine(C,W,oe,re,le,ie.characterMapping);return this._updateTopAndZIndexOfStickyLine(ce)}_updateTopAndZIndexOfStickyLine(C){var W;const V=C.index,U=C.lineDomNode,G=C.lineNumberDomNode,Z=V===this._lineNumbers.length-1,X="0",Q="1";U.style.zIndex=Z?X:Q,G.style.zIndex=Z?X:Q;const J=`${V*this._lineHeight+this._lastLineRelativePosition+(!((W=C.foldingIcon)===null||W===void 0)&&W.isCollapsed?1:0)}px`,ee=`${V*this._lineHeight}px`;return U.style.top=Z?J:ee,G.style.top=Z?J:ee,C}_renderFoldingIconForLine(C,W){const V=this._editor.getOption(109);if(!C||V==="never")return;const U=C.regions,G=U.findRange(W),Z=U.getStartLineNumber(G);if(!(W===Z))return;const Q=U.isCollapsed(G),J=new StickyFoldingIcon(Q,Z,U.getEndLineNumber(G),this._lineHeight);return J.setVisible(this._isOnGlyphMargin?!0:Q||V==="always"),J.domNode.setAttribute(STICKY_IS_FOLDING_ICON_ATTR,""),J}_updateMinContentWidth(){this._minContentWidthInPx=0;for(const C of this._stickyLines)C.lineDomNode.scrollWidth>this._minContentWidthInPx&&(this._minContentWidthInPx=C.lineDomNode.scrollWidth);this._minContentWidthInPx+=this._editor.getLayoutInfo().verticalScrollbarWidth}getId(){return"editor.contrib.stickyScrollWidget"}getDomNode(){return this._rootDomNode}getPosition(){return{preference:null}}getMinContentWidthInPx(){return this._minContentWidthInPx}focusLineWithIndex(C){0<=C&&C<this._stickyLines.length&&this._stickyLines[C].lineDomNode.focus()}getEditorPositionFromNode(C){if(!C||C.children.length>0)return null;const W=this._getRenderedStickyLineFromChildDomNode(C);if(!W)return null;const V=getColumnOfNodeOffset(W.characterMapping,C,0);return new Position$1(W.lineNumber,V)}getLineNumberFromChildDomNode(C){var W,V;return(V=(W=this._getRenderedStickyLineFromChildDomNode(C))===null||W===void 0?void 0:W.lineNumber)!==null&&V!==void 0?V:null}_getRenderedStickyLineFromChildDomNode(C){const W=this.getLineIndexFromChildDomNode(C);return W===null||W<0||W>=this._stickyLines.length?null:this._stickyLines[W]}getLineIndexFromChildDomNode(C){const W=this._getAttributeValue(C,STICKY_INDEX_ATTR);return W?parseInt(W,10):null}isInStickyLine(C){return this._getAttributeValue(C,STICKY_IS_LINE_ATTR)!==void 0}isInFoldingIconDomNode(C){return this._getAttributeValue(C,STICKY_IS_FOLDING_ICON_ATTR)!==void 0}_getAttributeValue(C,W){for(;C&&C!==this._rootDomNode;){const V=C.getAttribute(W);if(V!==null)return V;C=C.parentElement}}}class RenderedStickyLine{constructor(C,W,V,U,G,Z){this.index=C,this.lineNumber=W,this.lineDomNode=V,this.lineNumberDomNode=U,this.foldingIcon=G,this.characterMapping=Z}}class StickyFoldingIcon{constructor(C,W,V,U){this.isCollapsed=C,this.foldingStartLine=W,this.foldingEndLine=V,this.dimension=U,this.domNode=document.createElement("div"),this.domNode.style.width=`${U}px`,this.domNode.style.height=`${U}px`,this.domNode.className=ThemeIcon.asClassName(C?foldingCollapsedIcon:foldingExpandedIcon)}setVisible(C){this.domNode.style.cursor=C?"pointer":"default",this.domNode.style.opacity=C?"1":"0"}}class StickyRange{constructor(C,W){this.startLineNumber=C,this.endLineNumber=W}}class StickyElement{constructor(C,W,V){this.range=C,this.children=W,this.parent=V}}class StickyModel{constructor(C,W,V,U){this.uri=C,this.version=W,this.element=V,this.outlineProviderId=U}}var __decorate$g=globalThis&&globalThis.__decorate||function(K,C,W,V){var U=arguments.length,G=U<3?C:V===null?V=Object.getOwnPropertyDescriptor(C,W):V,Z;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")G=Reflect.decorate(K,C,W,V);else for(var X=K.length-1;X>=0;X--)(Z=K[X])&&(G=(U<3?Z(G):U>3?Z(C,W,G):Z(C,W))||G);return U>3&&G&&Object.defineProperty(C,W,G),G},__param$g=globalThis&&globalThis.__param||function(K,C){return function(W,V){C(W,V,K)}},__awaiter$a=globalThis&&globalThis.__awaiter||function(K,C,W,V){function U(G){return G instanceof W?G:new W(function(Z){Z(G)})}return new(W||(W=Promise))(function(G,Z){function X(ee){try{J(V.next(ee))}catch(te){Z(te)}}function Q(ee){try{J(V.throw(ee))}catch(te){Z(te)}}function J(ee){ee.done?G(ee.value):U(ee.value).then(X,Q)}J((V=V.apply(K,C||[])).next())})},ModelProvider;(function(K){K.OUTLINE_MODEL="outlineModel",K.FOLDING_PROVIDER_MODEL="foldingProviderModel",K.INDENTATION_MODEL="indentationModel"})(ModelProvider||(ModelProvider={}));var Status;(function(K){K[K.VALID=0]="VALID",K[K.INVALID=1]="INVALID",K[K.CANCELED=2]="CANCELED"})(Status||(Status={}));let StickyModelProvider=class extends Disposable{constructor(C,W,V,U){super(),this._editor=C,this._languageConfigurationService=W,this._languageFeaturesService=V,this._modelProviders=[],this._modelPromise=null,this._updateScheduler=this._register(new Delayer(300)),this._updateOperation=this._register(new DisposableStore);const G=new StickyModelFromCandidateOutlineProvider(V),Z=new StickyModelFromCandidateSyntaxFoldingProvider(this._editor,V),X=new StickyModelFromCandidateIndentationFoldingProvider(this._editor,W);switch(U){case ModelProvider.OUTLINE_MODEL:this._modelProviders.push(G),this._modelProviders.push(Z),this._modelProviders.push(X);break;case ModelProvider.FOLDING_PROVIDER_MODEL:this._modelProviders.push(Z),this._modelProviders.push(X);break;case ModelProvider.INDENTATION_MODEL:this._modelProviders.push(X);break}}_cancelModelPromise(){this._modelPromise&&(this._modelPromise.cancel(),this._modelPromise=null)}update(C,W,V){return __awaiter$a(this,void 0,void 0,function*(){return this._updateOperation.clear(),this._updateOperation.add({dispose:()=>{this._cancelModelPromise(),this._updateScheduler.cancel()}}),this._cancelModelPromise(),yield this._updateScheduler.trigger(()=>__awaiter$a(this,void 0,void 0,function*(){for(const U of this._modelProviders){const{statusPromise:G,modelPromise:Z}=U.computeStickyModel(C,W,V);this._modelPromise=Z;const X=yield G;if(this._modelPromise!==Z)return null;switch(X){case Status.CANCELED:return this._updateOperation.clear(),null;case Status.VALID:return U.stickyModel}}return null})).catch(U=>(onUnexpectedError(U),null))})}};StickyModelProvider=__decorate$g([__param$g(1,ILanguageConfigurationService),__param$g(2,ILanguageFeaturesService)],StickyModelProvider);class StickyModelCandidateProvider{constructor(){this._stickyModel=null}get stickyModel(){return this._stickyModel}_invalid(){return this._stickyModel=null,Status.INVALID}computeStickyModel(C,W,V){if(V.isCancellationRequested||!this.isProviderValid(C))return{statusPromise:this._invalid(),modelPromise:null};const U=createCancelablePromise(G=>this.createModelFromProvider(C,W,G));return{statusPromise:U.then(G=>this.isModelValid(G)?V.isCancellationRequested?Status.CANCELED:(this._stickyModel=this.createStickyModel(C,W,V,G),Status.VALID):this._invalid()).then(void 0,G=>(onUnexpectedError(G),Status.CANCELED)),modelPromise:U}}isModelValid(C){return!0}isProviderValid(C){return!0}}let StickyModelFromCandidateOutlineProvider=class extends StickyModelCandidateProvider{constructor(C){super(),this._languageFeaturesService=C}createModelFromProvider(C,W,V){return OutlineModel.create(this._languageFeaturesService.documentSymbolProvider,C,V)}createStickyModel(C,W,V,U){var G;const{stickyOutlineElement:Z,providerID:X}=this._stickyModelFromOutlineModel(U,(G=this._stickyModel)===null||G===void 0?void 0:G.outlineProviderId);return new StickyModel(C.uri,W,Z,X)}isModelValid(C){return C&&C.children.size>0}_stickyModelFromOutlineModel(C,W){let V;if(Iterable.first(C.children.values())instanceof OutlineGroup){const X=Iterable.find(C.children.values(),Q=>Q.id===W);if(X)V=X.children;else{let Q="",J=-1,ee;for(const[te,ie]of C.children.entries()){const ne=this._findSumOfRangesOfGroup(ie);ne>J&&(ee=ie,J=ne,Q=ie.id)}W=Q,V=ee.children}}else V=C.children;const U=[],G=Array.from(V.values()).sort((X,Q)=>{const J=new StickyRange(X.symbol.range.startLineNumber,X.symbol.range.endLineNumber),ee=new StickyRange(Q.symbol.range.startLineNumber,Q.symbol.range.endLineNumber);return this._comparator(J,ee)});for(const X of G)U.push(this._stickyModelFromOutlineElement(X,X.symbol.selectionRange.startLineNumber));return{stickyOutlineElement:new StickyElement(void 0,U,void 0),providerID:W}}_stickyModelFromOutlineElement(C,W){const V=[];for(const G of C.children.values())if(G.symbol.selectionRange.startLineNumber!==G.symbol.range.endLineNumber)if(G.symbol.selectionRange.startLineNumber!==W)V.push(this._stickyModelFromOutlineElement(G,G.symbol.selectionRange.startLineNumber));else for(const Z of G.children.values())V.push(this._stickyModelFromOutlineElement(Z,G.symbol.selectionRange.startLineNumber));V.sort((G,Z)=>this._comparator(G.range,Z.range));const U=new StickyRange(C.symbol.selectionRange.startLineNumber,C.symbol.range.endLineNumber);return new StickyElement(U,V,void 0)}_comparator(C,W){return C.startLineNumber!==W.startLineNumber?C.startLineNumber-W.startLineNumber:W.endLineNumber-C.endLineNumber}_findSumOfRangesOfGroup(C){let W=0;for(const V of C.children.values())W+=this._findSumOfRangesOfGroup(V);return C instanceof OutlineElement?W+C.symbol.range.endLineNumber-C.symbol.selectionRange.startLineNumber:W}};StickyModelFromCandidateOutlineProvider=__decorate$g([__param$g(0,ILanguageFeaturesService)],StickyModelFromCandidateOutlineProvider);class StickyModelFromCandidateFoldingProvider extends StickyModelCandidateProvider{constructor(C){super(),this._foldingLimitReporter=new RangesLimitReporter(C)}createStickyModel(C,W,V,U){const G=this._fromFoldingRegions(U);return new StickyModel(C.uri,W,G,void 0)}isModelValid(C){return C!==null}_fromFoldingRegions(C){const W=C.length,V=[],U=new StickyElement(void 0,[],void 0);for(let G=0;G<W;G++){const Z=C.getParentIndex(G);let X;Z!==-1?X=V[Z]:X=U;const Q=new StickyElement(new StickyRange(C.getStartLineNumber(G),C.getEndLineNumber(G)+1),[],X);X.children.push(Q),V.push(Q)}return U}}let StickyModelFromCandidateIndentationFoldingProvider=class extends StickyModelFromCandidateFoldingProvider{constructor(C,W){super(C),this._languageConfigurationService=W}createModelFromProvider(C,W,V){return new IndentRangeProvider(C,this._languageConfigurationService,this._foldingLimitReporter).compute(V)}};StickyModelFromCandidateIndentationFoldingProvider=__decorate$g([__param$g(1,ILanguageConfigurationService)],StickyModelFromCandidateIndentationFoldingProvider);let StickyModelFromCandidateSyntaxFoldingProvider=class extends StickyModelFromCandidateFoldingProvider{constructor(C,W){super(C),this._languageFeaturesService=W}isProviderValid(C){return FoldingController.getFoldingRangeProviders(this._languageFeaturesService,C).length>0}createModelFromProvider(C,W,V){const U=FoldingController.getFoldingRangeProviders(this._languageFeaturesService,C);return new SyntaxRangeProvider(C,U,()=>this.createModelFromProvider(C,W,V),this._foldingLimitReporter,void 0).compute(V)}};StickyModelFromCandidateSyntaxFoldingProvider=__decorate$g([__param$g(1,ILanguageFeaturesService)],StickyModelFromCandidateSyntaxFoldingProvider);var __decorate$f=globalThis&&globalThis.__decorate||function(K,C,W,V){var U=arguments.length,G=U<3?C:V===null?V=Object.getOwnPropertyDescriptor(C,W):V,Z;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")G=Reflect.decorate(K,C,W,V);else for(var X=K.length-1;X>=0;X--)(Z=K[X])&&(G=(U<3?Z(G):U>3?Z(C,W,G):Z(C,W))||G);return U>3&&G&&Object.defineProperty(C,W,G),G},__param$f=globalThis&&globalThis.__param||function(K,C){return function(W,V){C(W,V,K)}},__awaiter$9=globalThis&&globalThis.__awaiter||function(K,C,W,V){function U(G){return G instanceof W?G:new W(function(Z){Z(G)})}return new(W||(W=Promise))(function(G,Z){function X(ee){try{J(V.next(ee))}catch(te){Z(te)}}function Q(ee){try{J(V.throw(ee))}catch(te){Z(te)}}function J(ee){ee.done?G(ee.value):U(ee.value).then(X,Q)}J((V=V.apply(K,C||[])).next())})};class StickyLineCandidate{constructor(C,W,V){this.startLineNumber=C,this.endLineNumber=W,this.nestingDepth=V}}let StickyLineCandidateProvider=class extends Disposable{constructor(C,W,V){super(),this._languageFeaturesService=W,this._languageConfigurationService=V,this._onDidChangeStickyScroll=this._register(new Emitter$1),this.onDidChangeStickyScroll=this._onDidChangeStickyScroll.event,this._options=null,this._model=null,this._cts=null,this._stickyModelProvider=null,this._editor=C,this._sessionStore=this._register(new DisposableStore),this._updateSoon=this._register(new RunOnceScheduler(()=>this.update(),50)),this._register(this._editor.onDidChangeConfiguration(U=>{U.hasChanged(114)&&this.readConfiguration()})),this.readConfiguration()}readConfiguration(){this._stickyModelProvider=null,this._sessionStore.clear(),this._options=this._editor.getOption(114),this._options.enabled&&(this._stickyModelProvider=this._sessionStore.add(new StickyModelProvider(this._editor,this._languageConfigurationService,this._languageFeaturesService,this._options.defaultModel)),this._sessionStore.add(this._editor.onDidChangeModel(()=>{this._model=null,this._onDidChangeStickyScroll.fire(),this.update()})),this._sessionStore.add(this._editor.onDidChangeHiddenAreas(()=>this.update())),this._sessionStore.add(this._editor.onDidChangeModelContent(()=>this._updateSoon.schedule())),this._sessionStore.add(this._languageFeaturesService.documentSymbolProvider.onDidChange(()=>this.update())),this.update())}getVersionId(){var C;return(C=this._model)===null||C===void 0?void 0:C.version}update(){var C;return __awaiter$9(this,void 0,void 0,function*(){(C=this._cts)===null||C===void 0||C.dispose(!0),this._cts=new CancellationTokenSource$1,yield this.updateStickyModel(this._cts.token),this._onDidChangeStickyScroll.fire()})}updateStickyModel(C){return __awaiter$9(this,void 0,void 0,function*(){if(!this._editor.hasModel()||!this._stickyModelProvider||this._editor.getModel().isTooLargeForTokenization()){this._model=null;return}const W=this._editor.getModel(),V=W.getVersionId(),U=yield this._stickyModelProvider.update(W,V,C);C.isCancellationRequested||(this._model=U)})}updateIndex(C){return C===-1?C=0:C<0&&(C=-C-2),C}getCandidateStickyLinesIntersectingFromStickyModel(C,W,V,U,G){if(W.children.length===0)return;let Z=G;const X=[];for(let ee=0;ee<W.children.length;ee++){const te=W.children[ee];te.range&&X.push(te.range.startLineNumber)}const Q=this.updateIndex(binarySearch(X,C.startLineNumber,(ee,te)=>ee-te)),J=this.updateIndex(binarySearch(X,C.startLineNumber+U,(ee,te)=>ee-te));for(let ee=Q;ee<=J;ee++){const te=W.children[ee];if(!te)return;if(te.range){const ie=te.range.startLineNumber,ne=te.range.endLineNumber;C.startLineNumber<=ne+1&&ie-1<=C.endLineNumber&&ie!==Z&&(Z=ie,V.push(new StickyLineCandidate(ie,ne-1,U+1)),this.getCandidateStickyLinesIntersectingFromStickyModel(C,te,V,U+1,ie))}else this.getCandidateStickyLinesIntersectingFromStickyModel(C,te,V,U,G)}}getCandidateStickyLinesIntersecting(C){var W,V;if(!(!((W=this._model)===null||W===void 0)&&W.element))return[];let U=[];this.getCandidateStickyLinesIntersectingFromStickyModel(C,this._model.element,U,0,-1);const G=(V=this._editor._getViewModel())===null||V===void 0?void 0:V.getHiddenAreas();if(G)for(const Z of G)U=U.filter(X=>!(X.startLineNumber>=Z.startLineNumber&&X.endLineNumber<=Z.endLineNumber+1));return U}};StickyLineCandidateProvider=__decorate$f([__param$f(1,ILanguageFeaturesService),__param$f(2,ILanguageConfigurationService)],StickyLineCandidateProvider);var __decorate$e=globalThis&&globalThis.__decorate||function(K,C,W,V){var U=arguments.length,G=U<3?C:V===null?V=Object.getOwnPropertyDescriptor(C,W):V,Z;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")G=Reflect.decorate(K,C,W,V);else for(var X=K.length-1;X>=0;X--)(Z=K[X])&&(G=(U<3?Z(G):U>3?Z(C,W,G):Z(C,W))||G);return U>3&&G&&Object.defineProperty(C,W,G),G},__param$e=globalThis&&globalThis.__param||function(K,C){return function(W,V){C(W,V,K)}},__awaiter$8=globalThis&&globalThis.__awaiter||function(K,C,W,V){function U(G){return G instanceof W?G:new W(function(Z){Z(G)})}return new(W||(W=Promise))(function(G,Z){function X(ee){try{J(V.next(ee))}catch(te){Z(te)}}function Q(ee){try{J(V.throw(ee))}catch(te){Z(te)}}function J(ee){ee.done?G(ee.value):U(ee.value).then(X,Q)}J((V=V.apply(K,C||[])).next())})},StickyScrollController_1;let StickyScrollController=StickyScrollController_1=class extends Disposable{constructor(C,W,V,U,G,Z,X){super(),this._editor=C,this._contextMenuService=W,this._languageFeaturesService=V,this._instaService=U,this._contextKeyService=X,this._sessionStore=new DisposableStore,this._foldingModel=null,this._maxStickyLines=Number.MAX_SAFE_INTEGER,this._candidateDefinitionsLength=-1,this._focusedStickyElementIndex=-1,this._enabled=!1,this._focused=!1,this._positionRevealed=!1,this._onMouseDown=!1,this._endLineNumbers=[],this._showEndForLine=null,this._stickyScrollWidget=new StickyScrollWidget(this._editor),this._stickyLineCandidateProvider=new StickyLineCandidateProvider(this._editor,V,G),this._register(this._stickyScrollWidget),this._register(this._stickyLineCandidateProvider),this._widgetState=new StickyScrollWidgetState([],[],0),this._readConfiguration();const Q=this._stickyScrollWidget.getDomNode();this._register(this._editor.onDidChangeConfiguration(ee=>{(ee.hasChanged(114)||ee.hasChanged(72)||ee.hasChanged(66)||ee.hasChanged(109))&&this._readConfiguration()})),this._register(addDisposableListener(Q,EventType$1.CONTEXT_MENU,ee=>__awaiter$8(this,void 0,void 0,function*(){this._onContextMenu(ee)}))),this._stickyScrollFocusedContextKey=EditorContextKeys.stickyScrollFocused.bindTo(this._contextKeyService),this._stickyScrollVisibleContextKey=EditorContextKeys.stickyScrollVisible.bindTo(this._contextKeyService);const J=this._register(trackFocus(Q));this._register(J.onDidBlur(ee=>{this._positionRevealed===!1&&Q.clientHeight===0?(this._focusedStickyElementIndex=-1,this.focus()):this._disposeFocusStickyScrollStore()})),this._register(J.onDidFocus(ee=>{this.focus()})),this._registerMouseListeners(),this._register(addDisposableListener(Q,EventType$1.MOUSE_DOWN,ee=>{this._onMouseDown=!0}))}static get(C){return C.getContribution(StickyScrollController_1.ID)}_disposeFocusStickyScrollStore(){var C;this._stickyScrollFocusedContextKey.set(!1),(C=this._focusDisposableStore)===null||C===void 0||C.dispose(),this._focused=!1,this._positionRevealed=!1,this._onMouseDown=!1}focus(){if(this._onMouseDown){this._onMouseDown=!1,this._editor.focus();return}this._stickyScrollFocusedContextKey.get()!==!0&&(this._focused=!0,this._focusDisposableStore=new DisposableStore,this._stickyScrollFocusedContextKey.set(!0),this._focusedStickyElementIndex=this._stickyScrollWidget.lineNumbers.length-1,this._stickyScrollWidget.focusLineWithIndex(this._focusedStickyElementIndex))}focusNext(){this._focusedStickyElementIndex<this._stickyScrollWidget.lineNumberCount-1&&this._focusNav(!0)}focusPrevious(){this._focusedStickyElementIndex>0&&this._focusNav(!1)}selectEditor(){this._editor.focus()}_focusNav(C){this._focusedStickyElementIndex=C?this._focusedStickyElementIndex+1:this._focusedStickyElementIndex-1,this._stickyScrollWidget.focusLineWithIndex(this._focusedStickyElementIndex)}goToFocused(){const C=this._stickyScrollWidget.lineNumbers;this._disposeFocusStickyScrollStore(),this._revealPosition({lineNumber:C[this._focusedStickyElementIndex],column:1})}_revealPosition(C){this._reveaInEditor(C,()=>this._editor.revealPosition(C))}_revealLineInCenterIfOutsideViewport(C){this._reveaInEditor(C,()=>this._editor.revealLineInCenterIfOutsideViewport(C.lineNumber,0))}_reveaInEditor(C,W){this._focused&&this._disposeFocusStickyScrollStore(),this._positionRevealed=!0,W(),this._editor.setSelection(Range$2.fromPositions(C)),this._editor.focus()}_registerMouseListeners(){const C=this._register(new DisposableStore),W=this._register(new ClickLinkGesture(this._editor,{extractLineNumberFromMouseEvent:G=>{const Z=this._stickyScrollWidget.getEditorPositionFromNode(G.target.element);return Z?Z.lineNumber:0}})),V=G=>{if(!this._editor.hasModel()||G.target.type!==12||G.target.detail!==this._stickyScrollWidget.getId())return null;const Z=G.target.element;if(!Z||Z.innerText!==Z.innerHTML)return null;const X=this._stickyScrollWidget.getEditorPositionFromNode(Z);return X?{range:new Range$2(X.lineNumber,X.column,X.lineNumber,X.column+Z.innerText.length),textElement:Z}:null},U=this._stickyScrollWidget.getDomNode();this._register(addStandardDisposableListener(U,EventType$1.CLICK,G=>{if(G.ctrlKey||G.altKey||G.metaKey||!G.leftButton)return;if(G.shiftKey){const J=this._stickyScrollWidget.getLineIndexFromChildDomNode(G.target);if(J===null)return;const ee=new Position$1(this._endLineNumbers[J],1);this._revealLineInCenterIfOutsideViewport(ee);return}if(this._stickyScrollWidget.isInFoldingIconDomNode(G.target)){const J=this._stickyScrollWidget.getLineNumberFromChildDomNode(G.target);this._toggleFoldingRegionForLine(J);return}if(!this._stickyScrollWidget.isInStickyLine(G.target))return;let Q=this._stickyScrollWidget.getEditorPositionFromNode(G.target);if(!Q){const J=this._stickyScrollWidget.getLineNumberFromChildDomNode(G.target);if(J===null)return;Q=new Position$1(J,1)}this._revealPosition(Q)})),this._register(addStandardDisposableListener(U,EventType$1.MOUSE_MOVE,G=>{if(G.shiftKey){const Z=this._stickyScrollWidget.getLineIndexFromChildDomNode(G.target);if(Z===null||this._showEndForLine!==null&&this._showEndForLine===Z)return;this._showEndForLine=Z,this._renderStickyScroll();return}this._showEndForLine!==null&&(this._showEndForLine=null,this._renderStickyScroll())})),this._register(addDisposableListener(U,EventType$1.MOUSE_LEAVE,G=>{this._showEndForLine!==null&&(this._showEndForLine=null,this._renderStickyScroll())})),this._register(W.onMouseMoveOrRelevantKeyDown(([G,Z])=>{const X=V(G);if(!X||!G.hasTriggerModifier||!this._editor.hasModel()){C.clear();return}const{range:Q,textElement:J}=X;if(!Q.equalsRange(this._stickyRangeProjectedOnEditor))this._stickyRangeProjectedOnEditor=Q,C.clear();else if(J.style.textDecoration==="underline")return;const ee=new CancellationTokenSource$1;C.add(toDisposable(()=>ee.dispose(!0)));let te;getDefinitionsAtPosition(this._languageFeaturesService.definitionProvider,this._editor.getModel(),new Position$1(Q.startLineNumber,Q.startColumn+1),ee.token).then(ie=>{if(!ee.token.isCancellationRequested)if(ie.length!==0){this._candidateDefinitionsLength=ie.length;const ne=J;te!==ne?(C.clear(),te=ne,te.style.textDecoration="underline",C.add(toDisposable(()=>{te.style.textDecoration="none"}))):te||(te=ne,te.style.textDecoration="underline",C.add(toDisposable(()=>{te.style.textDecoration="none"})))}else C.clear()})})),this._register(W.onCancel(()=>{C.clear()})),this._register(W.onExecute(G=>__awaiter$8(this,void 0,void 0,function*(){if(G.target.type!==12||G.target.detail!==this._stickyScrollWidget.getId())return;const Z=this._stickyScrollWidget.getEditorPositionFromNode(G.target.element);Z&&(this._candidateDefinitionsLength>1&&(this._focused&&this._disposeFocusStickyScrollStore(),this._revealPosition({lineNumber:Z.lineNumber,column:1})),this._instaService.invokeFunction(goToDefinitionWithLocation,G,this._editor,{uri:this._editor.getModel().uri,range:this._stickyRangeProjectedOnEditor}))})))}_onContextMenu(C){const W=new StandardMouseEvent(C);this._contextMenuService.showContextMenu({menuId:MenuId.StickyScrollContext,getAnchor:()=>W})}_toggleFoldingRegionForLine(C){if(!this._foldingModel||C===null)return;const W=this._stickyScrollWidget.getStickyLineForLine(C),V=W==null?void 0:W.foldingIcon;if(!V)return;toggleCollapseState(this._foldingModel,Number.MAX_VALUE,[C]),V.isCollapsed=!V.isCollapsed;const U=(V.isCollapsed?this._editor.getTopForLineNumber(V.foldingEndLine):this._editor.getTopForLineNumber(V.foldingStartLine))-this._editor.getOption(66)*W.index+1;this._editor.setScrollTop(U),this._renderStickyScroll(C)}_readConfiguration(){const C=this._editor.getOption(114);if(C.enabled===!1){this._editor.removeOverlayWidget(this._stickyScrollWidget),this._sessionStore.clear(),this._enabled=!1;return}else C.enabled&&!this._enabled&&(this._editor.addOverlayWidget(this._stickyScrollWidget),this._sessionStore.add(this._editor.onDidScrollChange(V=>{V.scrollTopChanged&&(this._showEndForLine=null,this._renderStickyScroll())})),this._sessionStore.add(this._editor.onDidLayoutChange(()=>this._onDidResize())),this._sessionStore.add(this._editor.onDidChangeModelTokens(V=>this._onTokensChange(V))),this._sessionStore.add(this._stickyLineCandidateProvider.onDidChangeStickyScroll(()=>{this._showEndForLine=null,this._renderStickyScroll()})),this._enabled=!0);this._editor.getOption(67).renderType===2&&this._sessionStore.add(this._editor.onDidChangeCursorPosition(()=>{this._showEndForLine=null,this._renderStickyScroll()}))}_needsUpdate(C){const W=this._stickyScrollWidget.getCurrentLines();for(const V of W)for(const U of C.ranges)if(V>=U.fromLineNumber&&V<=U.toLineNumber)return!0;return!1}_onTokensChange(C){this._needsUpdate(C)&&this._renderStickyScroll(-1)}_onDidResize(){const W=this._editor.getLayoutInfo().height/this._editor.getOption(66);this._maxStickyLines=Math.round(W*.25)}_renderStickyScroll(C=1/0){var W,V;return __awaiter$8(this,void 0,void 0,function*(){const U=this._editor.getModel();if(!U||U.isTooLargeForTokenization()){this._foldingModel=null,this._stickyScrollWidget.setState(void 0,null,C);return}const G=this._stickyLineCandidateProvider.getVersionId();if(G===void 0||G===U.getVersionId())if(this._foldingModel=(V=yield(W=FoldingController.get(this._editor))===null||W===void 0?void 0:W.getFoldingModel())!==null&&V!==void 0?V:null,this._widgetState=this.findScrollWidgetState(),this._stickyScrollVisibleContextKey.set(this._widgetState.startLineNumbers.length!==0),!this._focused)this._stickyScrollWidget.setState(this._widgetState,this._foldingModel,C);else if(this._focusedStickyElementIndex===-1)this._stickyScrollWidget.setState(this._widgetState,this._foldingModel,C),this._focusedStickyElementIndex=this._stickyScrollWidget.lineNumberCount-1,this._focusedStickyElementIndex!==-1&&this._stickyScrollWidget.focusLineWithIndex(this._focusedStickyElementIndex);else{const Z=this._stickyScrollWidget.lineNumbers[this._focusedStickyElementIndex];this._stickyScrollWidget.setState(this._widgetState,this._foldingModel,C),this._stickyScrollWidget.lineNumberCount===0?this._focusedStickyElementIndex=-1:(this._stickyScrollWidget.lineNumbers.includes(Z)||(this._focusedStickyElementIndex=this._stickyScrollWidget.lineNumberCount-1),this._stickyScrollWidget.focusLineWithIndex(this._focusedStickyElementIndex))}})}findScrollWidgetState(){const C=this._editor.getOption(66),W=Math.min(this._maxStickyLines,this._editor.getOption(114).maxLineCount),V=this._editor.getScrollTop();let U=0;const G=[],Z=[],X=this._editor.getVisibleRanges();if(X.length!==0){const Q=new StickyRange(X[0].startLineNumber,X[X.length-1].endLineNumber),J=this._stickyLineCandidateProvider.getCandidateStickyLinesIntersecting(Q);for(const ee of J){const te=ee.startLineNumber,ie=ee.endLineNumber,ne=ee.nestingDepth;if(ie-te>0){const oe=(ne-1)*C,re=ne*C,ae=this._editor.getBottomForLineNumber(te)-V,se=this._editor.getTopForLineNumber(ie)-V,le=this._editor.getBottomForLineNumber(ie)-V;if(oe>se&&oe<=le){G.push(te),Z.push(ie+1),U=le-re;break}else re>ae&&re<=le&&(G.push(te),Z.push(ie+1));if(G.length===W)break}}}return this._endLineNumbers=Z,new StickyScrollWidgetState(G,Z,U,this._showEndForLine)}dispose(){super.dispose(),this._sessionStore.dispose()}};StickyScrollController.ID="store.contrib.stickyScrollController";StickyScrollController=StickyScrollController_1=__decorate$e([__param$e(1,IContextMenuService),__param$e(2,ILanguageFeaturesService),__param$e(3,IInstantiationService),__param$e(4,ILanguageConfigurationService),__param$e(5,ILanguageFeatureDebounceService),__param$e(6,IContextKeyService)],StickyScrollController);var __awaiter$7=globalThis&&globalThis.__awaiter||function(K,C,W,V){function U(G){return G instanceof W?G:new W(function(Z){Z(G)})}return new(W||(W=Promise))(function(G,Z){function X(ee){try{J(V.next(ee))}catch(te){Z(te)}}function Q(ee){try{J(V.throw(ee))}catch(te){Z(te)}}function J(ee){ee.done?G(ee.value):U(ee.value).then(X,Q)}J((V=V.apply(K,C||[])).next())})};class ToggleStickyScroll extends Action2{constructor(){super({id:"editor.action.toggleStickyScroll",title:{value:localize("toggleStickyScroll","Toggle Sticky Scroll"),mnemonicTitle:localize({key:"mitoggleStickyScroll",comment:["&& denotes a mnemonic"]},"&&Toggle Sticky Scroll"),original:"Toggle Sticky Scroll"},category:Categories.View,toggled:{condition:ContextKeyExpr.equals("config.editor.stickyScroll.enabled",!0),title:localize("stickyScroll","Sticky Scroll"),mnemonicTitle:localize({key:"miStickyScroll",comment:["&& denotes a mnemonic"]},"&&Sticky Scroll")},menu:[{id:MenuId.CommandPalette},{id:MenuId.MenubarAppearanceMenu,group:"4_editor",order:3},{id:MenuId.StickyScrollContext}]})}run(C){return __awaiter$7(this,void 0,void 0,function*(){const W=C.get(IConfigurationService),V=!W.getValue("editor.stickyScroll.enabled");return W.updateValue("editor.stickyScroll.enabled",V)})}}const weight=100;class FocusStickyScroll extends EditorAction2{constructor(){super({id:"editor.action.focusStickyScroll",title:{value:localize("focusStickyScroll","Focus Sticky Scroll"),mnemonicTitle:localize({key:"mifocusStickyScroll",comment:["&& denotes a mnemonic"]},"&&Focus Sticky Scroll"),original:"Focus Sticky Scroll"},precondition:ContextKeyExpr.and(ContextKeyExpr.has("config.editor.stickyScroll.enabled"),EditorContextKeys.stickyScrollVisible),menu:[{id:MenuId.CommandPalette}]})}runEditorCommand(C,W){var V;(V=StickyScrollController.get(W))===null||V===void 0||V.focus()}}class SelectNextStickyScrollLine extends EditorAction2{constructor(){super({id:"editor.action.selectNextStickyScrollLine",title:{value:localize("selectNextStickyScrollLine.title","Select next sticky scroll line"),original:"Select next sticky scroll line"},precondition:EditorContextKeys.stickyScrollFocused.isEqualTo(!0),keybinding:{weight,primary:18}})}runEditorCommand(C,W){var V;(V=StickyScrollController.get(W))===null||V===void 0||V.focusNext()}}class SelectPreviousStickyScrollLine extends EditorAction2{constructor(){super({id:"editor.action.selectPreviousStickyScrollLine",title:{value:localize("selectPreviousStickyScrollLine.title","Select previous sticky scroll line"),original:"Select previous sticky scroll line"},precondition:EditorContextKeys.stickyScrollFocused.isEqualTo(!0),keybinding:{weight,primary:16}})}runEditorCommand(C,W){var V;(V=StickyScrollController.get(W))===null||V===void 0||V.focusPrevious()}}class GoToStickyScrollLine extends EditorAction2{constructor(){super({id:"editor.action.goToFocusedStickyScrollLine",title:{value:localize("goToFocusedStickyScrollLine.title","Go to focused sticky scroll line"),original:"Go to focused sticky scroll line"},precondition:EditorContextKeys.stickyScrollFocused.isEqualTo(!0),keybinding:{weight,primary:3}})}runEditorCommand(C,W){var V;(V=StickyScrollController.get(W))===null||V===void 0||V.goToFocused()}}class SelectEditor extends EditorAction2{constructor(){super({id:"editor.action.selectEditor",title:{value:localize("selectEditor.title","Select Editor"),original:"Select Editor"},precondition:EditorContextKeys.stickyScrollFocused.isEqualTo(!0),keybinding:{weight,primary:9}})}runEditorCommand(C,W){var V;(V=StickyScrollController.get(W))===null||V===void 0||V.selectEditor()}}registerEditorContribution(StickyScrollController.ID,StickyScrollController,1);registerAction2(ToggleStickyScroll);registerAction2(FocusStickyScroll);registerAction2(SelectPreviousStickyScrollLine);registerAction2(SelectNextStickyScrollLine);registerAction2(GoToStickyScrollLine);registerAction2(SelectEditor);var __decorate$d=globalThis&&globalThis.__decorate||function(K,C,W,V){var U=arguments.length,G=U<3?C:V===null?V=Object.getOwnPropertyDescriptor(C,W):V,Z;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")G=Reflect.decorate(K,C,W,V);else for(var X=K.length-1;X>=0;X--)(Z=K[X])&&(G=(U<3?Z(G):U>3?Z(C,W,G):Z(C,W))||G);return U>3&&G&&Object.defineProperty(C,W,G),G},__param$d=globalThis&&globalThis.__param||function(K,C){return function(W,V){C(W,V,K)}},__awaiter$6=globalThis&&globalThis.__awaiter||function(K,C,W,V){function U(G){return G instanceof W?G:new W(function(Z){Z(G)})}return new(W||(W=Promise))(function(G,Z){function X(ee){try{J(V.next(ee))}catch(te){Z(te)}}function Q(ee){try{J(V.throw(ee))}catch(te){Z(te)}}function J(ee){ee.done?G(ee.value):U(ee.value).then(X,Q)}J((V=V.apply(K,C||[])).next())})},EditorContribution_1;class SuggestInlineCompletion{constructor(C,W,V,U,G,Z){this.range=C,this.insertText=W,this.filterText=V,this.additionalTextEdits=U,this.command=G,this.completion=Z}}let InlineCompletionResults=class extends RefCountedDisposable{constructor(C,W,V,U,G,Z){super(G.disposable),this.model=C,this.line=W,this.word=V,this.completionModel=U,this._suggestMemoryService=Z}canBeReused(C,W,V){return this.model===C&&this.line===W&&this.word.word.length>0&&this.word.startColumn===V.startColumn&&this.word.endColumn<V.endColumn&&this.completionModel.getIncompleteProvider().size===0}get items(){var C;const W=[],{items:V}=this.completionModel,U=this._suggestMemoryService.select(this.model,{lineNumber:this.line,column:this.word.endColumn+this.completionModel.lineContext.characterCountDelta},V),G=Iterable.slice(V,U),Z=Iterable.slice(V,0,U);let X=5;for(const Q of Iterable.concat(G,Z)){if(Q.score===FuzzyScore.Default)continue;const J=new Range$2(Q.editStart.lineNumber,Q.editStart.column,Q.editInsertEnd.lineNumber,Q.editInsertEnd.column+this.completionModel.lineContext.characterCountDelta),ee=Q.completion.insertTextRules&&Q.completion.insertTextRules&4?{snippet:Q.completion.insertText}:Q.completion.insertText;W.push(new SuggestInlineCompletion(J,ee,(C=Q.filterTextLow)!==null&&C!==void 0?C:Q.labelLow,Q.completion.additionalTextEdits,Q.completion.command,Q)),X-->=0&&Q.resolve(CancellationToken.None)}return W}};InlineCompletionResults=__decorate$d([__param$d(5,ISuggestMemoryService)],InlineCompletionResults);let SuggestInlineCompletions=class{constructor(C,W,V,U){this._getEditorOption=C,this._languageFeatureService=W,this._clipboardService=V,this._suggestMemoryService=U}provideInlineCompletions(C,W,V,U){var G;return __awaiter$6(this,void 0,void 0,function*(){if(V.selectedSuggestionInfo)return;const Z=this._getEditorOption(88,C);if(QuickSuggestionsOptions.isAllOff(Z))return;C.tokenization.tokenizeIfCheap(W.lineNumber);const X=C.tokenization.getLineTokens(W.lineNumber),Q=X.getStandardTokenType(X.findTokenIndexAtOffset(Math.max(W.column-1-1,0)));if(QuickSuggestionsOptions.valueFor(Z,Q)!=="inline")return;let J=C.getWordAtPosition(W),ee;if(J!=null&&J.word||(ee=this._getTriggerCharacterInfo(C,W)),!(J!=null&&J.word)&&!ee||(J||(J=C.getWordUntilPosition(W)),J.endColumn!==W.column))return;let te;const ie=C.getValueInRange(new Range$2(W.lineNumber,1,W.lineNumber,W.column));if(!ee&&(!((G=this._lastResult)===null||G===void 0)&&G.canBeReused(C,W.lineNumber,J))){const ne=new LineContext$1(ie,W.column-this._lastResult.word.endColumn);this._lastResult.completionModel.lineContext=ne,this._lastResult.acquire(),te=this._lastResult}else{const ne=yield provideSuggestionItems(this._languageFeatureService.completionProvider,C,W,new CompletionOptions(void 0,void 0,ee==null?void 0:ee.providers),ee&&{triggerKind:1,triggerCharacter:ee.ch},U);let oe;ne.needsClipboard&&(oe=yield this._clipboardService.readText());const re=new CompletionModel(ne.items,W.column,new LineContext$1(ie,0),WordDistance.None,this._getEditorOption(117,C),this._getEditorOption(111,C),{boostFullMatch:!1,firstMatchCanBeWeak:!1},oe);te=new InlineCompletionResults(C,W.lineNumber,J,re,ne,this._suggestMemoryService)}return this._lastResult=te,te})}handleItemDidShow(C,W){W.completion.resolve(CancellationToken.None)}freeInlineCompletions(C){C.release()}_getTriggerCharacterInfo(C,W){var V;const U=C.getValueInRange(Range$2.fromPositions({lineNumber:W.lineNumber,column:W.column-1},W)),G=new Set;for(const Z of this._languageFeatureService.completionProvider.all(C))!((V=Z.triggerCharacters)===null||V===void 0)&&V.includes(U)&&G.add(Z);if(G.size!==0)return{providers:G,ch:U}}};SuggestInlineCompletions=__decorate$d([__param$d(1,ILanguageFeaturesService),__param$d(2,IClipboardService),__param$d(3,ISuggestMemoryService)],SuggestInlineCompletions);let EditorContribution=EditorContribution_1=class{constructor(C,W,V,U){if(++EditorContribution_1._counter===1){const G=U.createInstance(SuggestInlineCompletions,(Z,X)=>{var Q;return((Q=V.listCodeEditors().find(ee=>ee.getModel()===X))!==null&&Q!==void 0?Q:C).getOption(Z)});EditorContribution_1._disposable=W.inlineCompletionsProvider.register("*",G)}}dispose(){var C;--EditorContribution_1._counter===0&&((C=EditorContribution_1._disposable)===null||C===void 0||C.dispose(),EditorContribution_1._disposable=void 0)}};EditorContribution._counter=0;EditorContribution=EditorContribution_1=__decorate$d([__param$d(1,ILanguageFeaturesService),__param$d(2,ICodeEditorService),__param$d(3,IInstantiationService)],EditorContribution);registerEditorContribution("suggest.inlineCompletionsProvider",EditorContribution,0);class ForceRetokenizeAction extends EditorAction{constructor(){super({id:"editor.action.forceRetokenize",label:localize("forceRetokenize","Developer: Force Retokenize"),alias:"Developer: Force Retokenize",precondition:void 0})}run(C,W){if(!W.hasModel())return;const V=W.getModel();V.tokenization.resetTokenization();const U=new StopWatch;V.tokenization.forceTokenization(V.getLineCount()),U.stop(),console.log(`tokenization took ${U.elapsed()}`)}}registerEditorAction(ForceRetokenizeAction);class ToggleTabFocusModeAction extends Action2{constructor(){super({id:ToggleTabFocusModeAction.ID,title:{value:localize({key:"toggle.tabMovesFocus",comment:["Turn on/off use of tab key for moving focus around VS Code"]},"Toggle Tab Key Moves Focus"),original:"Toggle Tab Key Moves Focus"},precondition:void 0,keybinding:{primary:2091,mac:{primary:1323},weight:100},f1:!0})}run(){const W=!TabFocus.getTabFocusMode();TabFocus.setTabFocusMode(W),alert(W?localize("toggle.tabMovesFocus.on","Pressing Tab will now move focus to the next focusable element"):localize("toggle.tabMovesFocus.off","Pressing Tab will now insert the tab character"))}}ToggleTabFocusModeAction.ID="editor.action.toggleTabFocusMode";registerAction2(ToggleTabFocusModeAction);const unicodeHighlighter="",bannerController="",link="";var __decorate$c=globalThis&&globalThis.__decorate||function(K,C,W,V){var U=arguments.length,G=U<3?C:V===null?V=Object.getOwnPropertyDescriptor(C,W):V,Z;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")G=Reflect.decorate(K,C,W,V);else for(var X=K.length-1;X>=0;X--)(Z=K[X])&&(G=(U<3?Z(G):U>3?Z(C,W,G):Z(C,W))||G);return U>3&&G&&Object.defineProperty(C,W,G),G},__param$c=globalThis&&globalThis.__param||function(K,C){return function(W,V){C(W,V,K)}};let Link=class extends Disposable{get enabled(){return this._enabled}set enabled(C){C?(this.el.setAttribute("aria-disabled","false"),this.el.tabIndex=0,this.el.style.pointerEvents="auto",this.el.style.opacity="1",this.el.style.cursor="pointer",this._enabled=!1):(this.el.setAttribute("aria-disabled","true"),this.el.tabIndex=-1,this.el.style.pointerEvents="none",this.el.style.opacity="0.4",this.el.style.cursor="default",this._enabled=!0),this._enabled=C}constructor(C,W,V={},U){var G;super(),this._link=W,this._enabled=!0,this.el=append$3(C,$$d("a.monaco-link",{tabIndex:(G=W.tabIndex)!==null&&G!==void 0?G:0,href:W.href,title:W.title},W.label)),this.el.setAttribute("role","button");const Z=this._register(new DomEmitter(this.el,"click")),X=this._register(new DomEmitter(this.el,"keypress")),Q=Event$1.chain(X.event,te=>te.map(ie=>new StandardKeyboardEvent(ie)).filter(ie=>ie.keyCode===3)),J=this._register(new DomEmitter(this.el,EventType.Tap)).event;this._register(Gesture.addTarget(this.el));const ee=Event$1.any(Z.event,Q,J);this._register(ee(te=>{this.enabled&&(EventHelper.stop(te,!0),V!=null&&V.opener?V.opener(this._link.href):U.open(this._link.href,{allowCommands:!0}))})),this.enabled=!0}};Link=__decorate$c([__param$c(3,IOpenerService)],Link);var __decorate$b=globalThis&&globalThis.__decorate||function(K,C,W,V){var U=arguments.length,G=U<3?C:V===null?V=Object.getOwnPropertyDescriptor(C,W):V,Z;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")G=Reflect.decorate(K,C,W,V);else for(var X=K.length-1;X>=0;X--)(Z=K[X])&&(G=(U<3?Z(G):U>3?Z(C,W,G):Z(C,W))||G);return U>3&&G&&Object.defineProperty(C,W,G),G},__param$b=globalThis&&globalThis.__param||function(K,C){return function(W,V){C(W,V,K)}};const BANNER_ELEMENT_HEIGHT=26;let BannerController=class extends Disposable{constructor(C,W){super(),this._editor=C,this.instantiationService=W,this.banner=this._register(this.instantiationService.createInstance(Banner))}hide(){this._editor.setBanner(null,0),this.banner.clear()}show(C){this.banner.show(Object.assign(Object.assign({},C),{onClose:()=>{var W;this.hide(),(W=C.onClose)===null||W===void 0||W.call(C)}})),this._editor.setBanner(this.banner.element,BANNER_ELEMENT_HEIGHT)}};BannerController=__decorate$b([__param$b(1,IInstantiationService)],BannerController);let Banner=class extends Disposable{constructor(C){super(),this.instantiationService=C,this.markdownRenderer=this.instantiationService.createInstance(MarkdownRenderer,{}),this.element=$$d("div.editor-banner"),this.element.tabIndex=0}getAriaLabel(C){if(C.ariaLabel)return C.ariaLabel;if(typeof C.message=="string")return C.message}getBannerMessage(C){if(typeof C=="string"){const W=$$d("span");return W.innerText=C,W}return this.markdownRenderer.render(C).element}clear(){clearNode(this.element)}show(C){clearNode(this.element);const W=this.getAriaLabel(C);W&&this.element.setAttribute("aria-label",W);const V=append$3(this.element,$$d("div.icon-container"));V.setAttribute("aria-hidden","true"),C.icon&&V.appendChild($$d(`div${ThemeIcon.asCSSSelector(C.icon)}`));const U=append$3(this.element,$$d("div.message-container"));if(U.setAttribute("aria-hidden","true"),U.appendChild(this.getBannerMessage(C.message)),this.messageActionsContainer=append$3(this.element,$$d("div.message-actions-container")),C.actions)for(const Z of C.actions)this._register(this.instantiationService.createInstance(Link,this.messageActionsContainer,Object.assign(Object.assign({},Z),{tabIndex:-1}),{}));const G=append$3(this.element,$$d("div.action-container"));this.actionBar=this._register(new ActionBar(G)),this.actionBar.push(this._register(new Action("banner.close","Close Banner",ThemeIcon.asClassName(widgetClose),!0,()=>{typeof C.onClose=="function"&&C.onClose()})),{icon:!0,label:!1}),this.actionBar.setFocusable(!1)}};Banner=__decorate$b([__param$b(0,IInstantiationService)],Banner);var __decorate$a=globalThis&&globalThis.__decorate||function(K,C,W,V){var U=arguments.length,G=U<3?C:V===null?V=Object.getOwnPropertyDescriptor(C,W):V,Z;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")G=Reflect.decorate(K,C,W,V);else for(var X=K.length-1;X>=0;X--)(Z=K[X])&&(G=(U<3?Z(G):U>3?Z(C,W,G):Z(C,W))||G);return U>3&&G&&Object.defineProperty(C,W,G),G},__param$a=globalThis&&globalThis.__param||function(K,C){return function(W,V){C(W,V,K)}},__awaiter$5=globalThis&&globalThis.__awaiter||function(K,C,W,V){function U(G){return G instanceof W?G:new W(function(Z){Z(G)})}return new(W||(W=Promise))(function(G,Z){function X(ee){try{J(V.next(ee))}catch(te){Z(te)}}function Q(ee){try{J(V.throw(ee))}catch(te){Z(te)}}function J(ee){ee.done?G(ee.value):U(ee.value).then(X,Q)}J((V=V.apply(K,C||[])).next())})};const warningIcon=registerIcon("extensions-warning-message",Codicon.warning,localize("warningIcon","Icon shown with a warning message in the extensions editor."));let UnicodeHighlighter=class extends Disposable{constructor(C,W,V,U){super(),this._editor=C,this._editorWorkerService=W,this._workspaceTrustService=V,this._highlighter=null,this._bannerClosed=!1,this._updateState=G=>{if(G&&G.hasMore){if(this._bannerClosed)return;const Z=Math.max(G.ambiguousCharacterCount,G.nonBasicAsciiCharacterCount,G.invisibleCharacterCount);let X;if(G.nonBasicAsciiCharacterCount>=Z)X={message:localize("unicodeHighlighting.thisDocumentHasManyNonBasicAsciiUnicodeCharacters","This document contains many non-basic ASCII unicode characters"),command:new DisableHighlightingOfNonBasicAsciiCharactersAction};else if(G.ambiguousCharacterCount>=Z)X={message:localize("unicodeHighlighting.thisDocumentHasManyAmbiguousUnicodeCharacters","This document contains many ambiguous unicode characters"),command:new DisableHighlightingOfAmbiguousCharactersAction};else if(G.invisibleCharacterCount>=Z)X={message:localize("unicodeHighlighting.thisDocumentHasManyInvisibleUnicodeCharacters","This document contains many invisible unicode characters"),command:new DisableHighlightingOfInvisibleCharactersAction};else throw new Error("Unreachable");this._bannerController.show({id:"unicodeHighlightBanner",message:X.message,icon:warningIcon,actions:[{label:X.command.shortLabel,href:`command:${X.command.id}`}],onClose:()=>{this._bannerClosed=!0}})}else this._bannerController.hide()},this._bannerController=this._register(U.createInstance(BannerController,C)),this._register(this._editor.onDidChangeModel(()=>{this._bannerClosed=!1,this._updateHighlighter()})),this._options=C.getOption(124),this._register(V.onDidChangeTrust(G=>{this._updateHighlighter()})),this._register(C.onDidChangeConfiguration(G=>{G.hasChanged(124)&&(this._options=C.getOption(124),this._updateHighlighter())})),this._updateHighlighter()}dispose(){this._highlighter&&(this._highlighter.dispose(),this._highlighter=null),super.dispose()}_updateHighlighter(){if(this._updateState(null),this._highlighter&&(this._highlighter.dispose(),this._highlighter=null),!this._editor.hasModel())return;const C=resolveOptions(this._workspaceTrustService.isWorkspaceTrusted(),this._options);if([C.nonBasicASCII,C.ambiguousCharacters,C.invisibleCharacters].every(V=>V===!1))return;const W={nonBasicASCII:C.nonBasicASCII,ambiguousCharacters:C.ambiguousCharacters,invisibleCharacters:C.invisibleCharacters,includeComments:C.includeComments,includeStrings:C.includeStrings,allowedCodePoints:Object.keys(C.allowedCharacters).map(V=>V.codePointAt(0)),allowedLocales:Object.keys(C.allowedLocales).map(V=>V==="_os"?new Intl.NumberFormat().resolvedOptions().locale:V==="_vscode"?language$1:V)};this._editorWorkerService.canComputeUnicodeHighlights(this._editor.getModel().uri)?this._highlighter=new DocumentUnicodeHighlighter(this._editor,W,this._updateState,this._editorWorkerService):this._highlighter=new ViewportUnicodeHighlighter(this._editor,W,this._updateState)}getDecorationInfo(C){return this._highlighter?this._highlighter.getDecorationInfo(C):null}};UnicodeHighlighter.ID="editor.contrib.unicodeHighlighter";UnicodeHighlighter=__decorate$a([__param$a(1,IEditorWorkerService),__param$a(2,IWorkspaceTrustManagementService),__param$a(3,IInstantiationService)],UnicodeHighlighter);function resolveOptions(K,C){return{nonBasicASCII:C.nonBasicASCII===inUntrustedWorkspace?!K:C.nonBasicASCII,ambiguousCharacters:C.ambiguousCharacters,invisibleCharacters:C.invisibleCharacters,includeComments:C.includeComments===inUntrustedWorkspace?!K:C.includeComments,includeStrings:C.includeStrings===inUntrustedWorkspace?!K:C.includeStrings,allowedCharacters:C.allowedCharacters,allowedLocales:C.allowedLocales}}let DocumentUnicodeHighlighter=class extends Disposable{constructor(C,W,V,U){super(),this._editor=C,this._options=W,this._updateState=V,this._editorWorkerService=U,this._model=this._editor.getModel(),this._decorations=this._editor.createDecorationsCollection(),this._updateSoon=this._register(new RunOnceScheduler(()=>this._update(),250)),this._register(this._editor.onDidChangeModelContent(()=>{this._updateSoon.schedule()})),this._updateSoon.schedule()}dispose(){this._decorations.clear(),super.dispose()}_update(){if(this._model.isDisposed())return;if(!this._model.mightContainNonBasicASCII()){this._decorations.clear();return}const C=this._model.getVersionId();this._editorWorkerService.computedUnicodeHighlights(this._model.uri,this._options).then(W=>{if(this._model.isDisposed()||this._model.getVersionId()!==C)return;this._updateState(W);const V=[];if(!W.hasMore)for(const U of W.ranges)V.push({range:U,options:Decorations.instance.getDecorationFromOptions(this._options)});this._decorations.set(V)})}getDecorationInfo(C){if(!this._decorations.has(C))return null;const W=this._editor.getModel();if(!isModelDecorationVisible(W,C))return null;const V=W.getValueInRange(C.range);return{reason:computeReason(V,this._options),inComment:isModelDecorationInComment(W,C),inString:isModelDecorationInString(W,C)}}};DocumentUnicodeHighlighter=__decorate$a([__param$a(3,IEditorWorkerService)],DocumentUnicodeHighlighter);class ViewportUnicodeHighlighter extends Disposable{constructor(C,W,V){super(),this._editor=C,this._options=W,this._updateState=V,this._model=this._editor.getModel(),this._decorations=this._editor.createDecorationsCollection(),this._updateSoon=this._register(new RunOnceScheduler(()=>this._update(),250)),this._register(this._editor.onDidLayoutChange(()=>{this._updateSoon.schedule()})),this._register(this._editor.onDidScrollChange(()=>{this._updateSoon.schedule()})),this._register(this._editor.onDidChangeHiddenAreas(()=>{this._updateSoon.schedule()})),this._register(this._editor.onDidChangeModelContent(()=>{this._updateSoon.schedule()})),this._updateSoon.schedule()}dispose(){this._decorations.clear(),super.dispose()}_update(){if(this._model.isDisposed())return;if(!this._model.mightContainNonBasicASCII()){this._decorations.clear();return}const C=this._editor.getVisibleRanges(),W=[],V={ranges:[],ambiguousCharacterCount:0,invisibleCharacterCount:0,nonBasicAsciiCharacterCount:0,hasMore:!1};for(const U of C){const G=UnicodeTextModelHighlighter.computeUnicodeHighlights(this._model,this._options,U);for(const Z of G.ranges)V.ranges.push(Z);V.ambiguousCharacterCount+=V.ambiguousCharacterCount,V.invisibleCharacterCount+=V.invisibleCharacterCount,V.nonBasicAsciiCharacterCount+=V.nonBasicAsciiCharacterCount,V.hasMore=V.hasMore||G.hasMore}if(!V.hasMore)for(const U of V.ranges)W.push({range:U,options:Decorations.instance.getDecorationFromOptions(this._options)});this._updateState(V),this._decorations.set(W)}getDecorationInfo(C){if(!this._decorations.has(C))return null;const W=this._editor.getModel(),V=W.getValueInRange(C.range);return isModelDecorationVisible(W,C)?{reason:computeReason(V,this._options),inComment:isModelDecorationInComment(W,C),inString:isModelDecorationInString(W,C)}:null}}let UnicodeHighlighterHoverParticipant=class{constructor(C,W,V){this._editor=C,this._languageService=W,this._openerService=V,this.hoverOrdinal=5}computeSync(C,W){if(!this._editor.hasModel()||C.type!==1)return[];const V=this._editor.getModel(),U=this._editor.getContribution(UnicodeHighlighter.ID);if(!U)return[];const G=[],Z=new Set;let X=300;for(const Q of W){const J=U.getDecorationInfo(Q);if(!J)continue;const te=V.getValueInRange(Q.range).codePointAt(0),ie=formatCodePointMarkdown(te);let ne;switch(J.reason.kind){case 0:{isBasicASCII(J.reason.confusableWith)?ne=localize("unicodeHighlight.characterIsAmbiguousASCII","The character {0} could be confused with the ASCII character {1}, which is more common in source code.",ie,formatCodePointMarkdown(J.reason.confusableWith.codePointAt(0))):ne=localize("unicodeHighlight.characterIsAmbiguous","The character {0} could be confused with the character {1}, which is more common in source code.",ie,formatCodePointMarkdown(J.reason.confusableWith.codePointAt(0)));break}case 1:ne=localize("unicodeHighlight.characterIsInvisible","The character {0} is invisible.",ie);break;case 2:ne=localize("unicodeHighlight.characterIsNonBasicAscii","The character {0} is not a basic ASCII character.",ie);break}if(Z.has(ne))continue;Z.add(ne);const oe={codePoint:te,reason:J.reason,inComment:J.inComment,inString:J.inString},re=localize("unicodeHighlight.adjustSettings","Adjust settings"),ae=`command:${ShowExcludeOptions.ID}?${encodeURIComponent(JSON.stringify(oe))}`,se=new MarkdownString("",!0).appendMarkdown(ne).appendText(" ").appendLink(ae,re);G.push(new MarkdownHover(this,Q.range,[se],!1,X++))}return G}renderHoverParts(C,W){return renderMarkdownHovers(C,W,this._editor,this._languageService,this._openerService)}};UnicodeHighlighterHoverParticipant=__decorate$a([__param$a(1,ILanguageService),__param$a(2,IOpenerService)],UnicodeHighlighterHoverParticipant);function codePointToHex(K){return`U+${K.toString(16).padStart(4,"0")}`}function formatCodePointMarkdown(K){let C=`\`${codePointToHex(K)}\``;return InvisibleCharacters.isInvisibleCharacter(K)||(C+=` "${`${renderCodePointAsInlineCode(K)}`}"`),C}function renderCodePointAsInlineCode(K){return K===96?"`` ` ``":"`"+String.fromCodePoint(K)+"`"}function computeReason(K,C){return UnicodeTextModelHighlighter.computeUnicodeHighlightReason(K,C)}class Decorations{constructor(){this.map=new Map}getDecorationFromOptions(C){return this.getDecoration(!C.includeComments,!C.includeStrings)}getDecoration(C,W){const V=`${C}${W}`;let U=this.map.get(V);return U||(U=ModelDecorationOptions.createDynamic({description:"unicode-highlight",stickiness:1,className:"unicode-highlight",showIfCollapsed:!0,overviewRuler:null,minimap:null,hideInCommentTokens:C,hideInStringTokens:W}),this.map.set(V,U)),U}}Decorations.instance=new Decorations;class DisableHighlightingInCommentsAction extends EditorAction{constructor(){super({id:DisableHighlightingOfAmbiguousCharactersAction.ID,label:localize("action.unicodeHighlight.disableHighlightingInComments","Disable highlighting of characters in comments"),alias:"Disable highlighting of characters in comments",precondition:void 0}),this.shortLabel=localize("unicodeHighlight.disableHighlightingInComments.shortLabel","Disable Highlight In Comments")}run(C,W,V){return __awaiter$5(this,void 0,void 0,function*(){const U=C==null?void 0:C.get(IConfigurationService);U&&this.runAction(U)})}runAction(C){return __awaiter$5(this,void 0,void 0,function*(){yield C.updateValue(unicodeHighlightConfigKeys.includeComments,!1,2)})}}class DisableHighlightingInStringsAction extends EditorAction{constructor(){super({id:DisableHighlightingOfAmbiguousCharactersAction.ID,label:localize("action.unicodeHighlight.disableHighlightingInStrings","Disable highlighting of characters in strings"),alias:"Disable highlighting of characters in strings",precondition:void 0}),this.shortLabel=localize("unicodeHighlight.disableHighlightingInStrings.shortLabel","Disable Highlight In Strings")}run(C,W,V){return __awaiter$5(this,void 0,void 0,function*(){const U=C==null?void 0:C.get(IConfigurationService);U&&this.runAction(U)})}runAction(C){return __awaiter$5(this,void 0,void 0,function*(){yield C.updateValue(unicodeHighlightConfigKeys.includeStrings,!1,2)})}}class DisableHighlightingOfAmbiguousCharactersAction extends EditorAction{constructor(){super({id:DisableHighlightingOfAmbiguousCharactersAction.ID,label:localize("action.unicodeHighlight.disableHighlightingOfAmbiguousCharacters","Disable highlighting of ambiguous characters"),alias:"Disable highlighting of ambiguous characters",precondition:void 0}),this.shortLabel=localize("unicodeHighlight.disableHighlightingOfAmbiguousCharacters.shortLabel","Disable Ambiguous Highlight")}run(C,W,V){return __awaiter$5(this,void 0,void 0,function*(){const U=C==null?void 0:C.get(IConfigurationService);U&&this.runAction(U)})}runAction(C){return __awaiter$5(this,void 0,void 0,function*(){yield C.updateValue(unicodeHighlightConfigKeys.ambiguousCharacters,!1,2)})}}DisableHighlightingOfAmbiguousCharactersAction.ID="editor.action.unicodeHighlight.disableHighlightingOfAmbiguousCharacters";class DisableHighlightingOfInvisibleCharactersAction extends EditorAction{constructor(){super({id:DisableHighlightingOfInvisibleCharactersAction.ID,label:localize("action.unicodeHighlight.disableHighlightingOfInvisibleCharacters","Disable highlighting of invisible characters"),alias:"Disable highlighting of invisible characters",precondition:void 0}),this.shortLabel=localize("unicodeHighlight.disableHighlightingOfInvisibleCharacters.shortLabel","Disable Invisible Highlight")}run(C,W,V){return __awaiter$5(this,void 0,void 0,function*(){const U=C==null?void 0:C.get(IConfigurationService);U&&this.runAction(U)})}runAction(C){return __awaiter$5(this,void 0,void 0,function*(){yield C.updateValue(unicodeHighlightConfigKeys.invisibleCharacters,!1,2)})}}DisableHighlightingOfInvisibleCharactersAction.ID="editor.action.unicodeHighlight.disableHighlightingOfInvisibleCharacters";class DisableHighlightingOfNonBasicAsciiCharactersAction extends EditorAction{constructor(){super({id:DisableHighlightingOfNonBasicAsciiCharactersAction.ID,label:localize("action.unicodeHighlight.disableHighlightingOfNonBasicAsciiCharacters","Disable highlighting of non basic ASCII characters"),alias:"Disable highlighting of non basic ASCII characters",precondition:void 0}),this.shortLabel=localize("unicodeHighlight.disableHighlightingOfNonBasicAsciiCharacters.shortLabel","Disable Non ASCII Highlight")}run(C,W,V){return __awaiter$5(this,void 0,void 0,function*(){const U=C==null?void 0:C.get(IConfigurationService);U&&this.runAction(U)})}runAction(C){return __awaiter$5(this,void 0,void 0,function*(){yield C.updateValue(unicodeHighlightConfigKeys.nonBasicASCII,!1,2)})}}DisableHighlightingOfNonBasicAsciiCharactersAction.ID="editor.action.unicodeHighlight.disableHighlightingOfNonBasicAsciiCharacters";class ShowExcludeOptions extends EditorAction{constructor(){super({id:ShowExcludeOptions.ID,label:localize("action.unicodeHighlight.showExcludeOptions","Show Exclude Options"),alias:"Show Exclude Options",precondition:void 0})}run(C,W,V){return __awaiter$5(this,void 0,void 0,function*(){const{codePoint:U,reason:G,inString:Z,inComment:X}=V,Q=String.fromCodePoint(U),J=C.get(IQuickInputService),ee=C.get(IConfigurationService);function te(oe){return InvisibleCharacters.isInvisibleCharacter(oe)?localize("unicodeHighlight.excludeInvisibleCharFromBeingHighlighted","Exclude {0} (invisible character) from being highlighted",codePointToHex(oe)):localize("unicodeHighlight.excludeCharFromBeingHighlighted","Exclude {0} from being highlighted",`${codePointToHex(oe)} "${Q}"`)}const ie=[];if(G.kind===0)for(const oe of G.notAmbiguousInLocales)ie.push({label:localize("unicodeHighlight.allowCommonCharactersInLanguage",'Allow unicode characters that are more common in the language "{0}".',oe),run:()=>__awaiter$5(this,void 0,void 0,function*(){excludeLocaleFromBeingHighlighted(ee,[oe])})});if(ie.push({label:te(U),run:()=>excludeCharFromBeingHighlighted(ee,[U])}),X){const oe=new DisableHighlightingInCommentsAction;ie.push({label:oe.label,run:()=>__awaiter$5(this,void 0,void 0,function*(){return oe.runAction(ee)})})}else if(Z){const oe=new DisableHighlightingInStringsAction;ie.push({label:oe.label,run:()=>__awaiter$5(this,void 0,void 0,function*(){return oe.runAction(ee)})})}if(G.kind===0){const oe=new DisableHighlightingOfAmbiguousCharactersAction;ie.push({label:oe.label,run:()=>__awaiter$5(this,void 0,void 0,function*(){return oe.runAction(ee)})})}else if(G.kind===1){const oe=new DisableHighlightingOfInvisibleCharactersAction;ie.push({label:oe.label,run:()=>__awaiter$5(this,void 0,void 0,function*(){return oe.runAction(ee)})})}else if(G.kind===2){const oe=new DisableHighlightingOfNonBasicAsciiCharactersAction;ie.push({label:oe.label,run:()=>__awaiter$5(this,void 0,void 0,function*(){return oe.runAction(ee)})})}else expectNever(G);const ne=yield J.pick(ie,{title:localize("unicodeHighlight.configureUnicodeHighlightOptions","Configure Unicode Highlight Options")});ne&&(yield ne.run())})}}ShowExcludeOptions.ID="editor.action.unicodeHighlight.showExcludeOptions";function excludeCharFromBeingHighlighted(K,C){return __awaiter$5(this,void 0,void 0,function*(){const W=K.getValue(unicodeHighlightConfigKeys.allowedCharacters);let V;typeof W=="object"&&W?V=W:V={};for(const U of C)V[String.fromCodePoint(U)]=!0;yield K.updateValue(unicodeHighlightConfigKeys.allowedCharacters,V,2)})}function excludeLocaleFromBeingHighlighted(K,C){var W;return __awaiter$5(this,void 0,void 0,function*(){const V=(W=K.inspect(unicodeHighlightConfigKeys.allowedLocales).user)===null||W===void 0?void 0:W.value;let U;typeof V=="object"&&V?U=Object.assign({},V):U={};for(const G of C)U[G]=!0;yield K.updateValue(unicodeHighlightConfigKeys.allowedLocales,U,2)})}function expectNever(K){throw new Error(`Unexpected value: ${K}`)}registerEditorAction(DisableHighlightingOfAmbiguousCharactersAction);registerEditorAction(DisableHighlightingOfInvisibleCharactersAction);registerEditorAction(DisableHighlightingOfNonBasicAsciiCharactersAction);registerEditorAction(ShowExcludeOptions);registerEditorContribution(UnicodeHighlighter.ID,UnicodeHighlighter,1);HoverParticipantRegistry.register(UnicodeHighlighterHoverParticipant);var __decorate$9=globalThis&&globalThis.__decorate||function(K,C,W,V){var U=arguments.length,G=U<3?C:V===null?V=Object.getOwnPropertyDescriptor(C,W):V,Z;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")G=Reflect.decorate(K,C,W,V);else for(var X=K.length-1;X>=0;X--)(Z=K[X])&&(G=(U<3?Z(G):U>3?Z(C,W,G):Z(C,W))||G);return U>3&&G&&Object.defineProperty(C,W,G),G},__param$9=globalThis&&globalThis.__param||function(K,C){return function(W,V){C(W,V,K)}},__awaiter$4=globalThis&&globalThis.__awaiter||function(K,C,W,V){function U(G){return G instanceof W?G:new W(function(Z){Z(G)})}return new(W||(W=Promise))(function(G,Z){function X(ee){try{J(V.next(ee))}catch(te){Z(te)}}function Q(ee){try{J(V.throw(ee))}catch(te){Z(te)}}function J(ee){ee.done?G(ee.value):U(ee.value).then(X,Q)}J((V=V.apply(K,C||[])).next())})};const ignoreUnusualLineTerminators="ignoreUnusualLineTerminators";function writeIgnoreState(K,C,W){K.setModelProperty(C.uri,ignoreUnusualLineTerminators,W)}function readIgnoreState(K,C){return K.getModelProperty(C.uri,ignoreUnusualLineTerminators)}let UnusualLineTerminatorsDetector=class extends Disposable{constructor(C,W,V){super(),this._editor=C,this._dialogService=W,this._codeEditorService=V,this._isPresentingDialog=!1,this._config=this._editor.getOption(125),this._register(this._editor.onDidChangeConfiguration(U=>{U.hasChanged(125)&&(this._config=this._editor.getOption(125),this._checkForUnusualLineTerminators())})),this._register(this._editor.onDidChangeModel(()=>{this._checkForUnusualLineTerminators()})),this._register(this._editor.onDidChangeModelContent(U=>{U.isUndoing||this._checkForUnusualLineTerminators()})),this._checkForUnusualLineTerminators()}_checkForUnusualLineTerminators(){return __awaiter$4(this,void 0,void 0,function*(){if(this._config==="off"||!this._editor.hasModel())return;const C=this._editor.getModel();if(!C.mightContainUnusualLineTerminators()||readIgnoreState(this._codeEditorService,C)===!0||this._editor.getOption(90))return;if(this._config==="auto"){C.removeUnusualLineTerminators(this._editor.getSelections());return}if(this._isPresentingDialog)return;let V;try{this._isPresentingDialog=!0,V=yield this._dialogService.confirm({title:localize("unusualLineTerminators.title","Unusual Line Terminators"),message:localize("unusualLineTerminators.message","Detected unusual line terminators"),detail:localize("unusualLineTerminators.detail","The file '{0}' contains one or more unusual line terminator characters, like Line Separator (LS) or Paragraph Separator (PS).\n\nIt is recommended to remove them from the file. This can be configured via `editor.unusualLineTerminators`.",basename(C.uri)),primaryButton:localize({key:"unusualLineTerminators.fix",comment:["&& denotes a mnemonic"]},"&&Remove Unusual Line Terminators"),cancelButton:localize("unusualLineTerminators.ignore","Ignore")})}finally{this._isPresentingDialog=!1}if(!V.confirmed){writeIgnoreState(this._codeEditorService,C,!0);return}C.removeUnusualLineTerminators(this._editor.getSelections())})}};UnusualLineTerminatorsDetector.ID="editor.contrib.unusualLineTerminatorsDetector";UnusualLineTerminatorsDetector=__decorate$9([__param$9(1,IDialogService),__param$9(2,ICodeEditorService)],UnusualLineTerminatorsDetector);registerEditorContribution(UnusualLineTerminatorsDetector.ID,UnusualLineTerminatorsDetector,1);var __decorate$8=globalThis&&globalThis.__decorate||function(K,C,W,V){var U=arguments.length,G=U<3?C:V===null?V=Object.getOwnPropertyDescriptor(C,W):V,Z;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")G=Reflect.decorate(K,C,W,V);else for(var X=K.length-1;X>=0;X--)(Z=K[X])&&(G=(U<3?Z(G):U>3?Z(C,W,G):Z(C,W))||G);return U>3&&G&&Object.defineProperty(C,W,G),G},__param$8=globalThis&&globalThis.__param||function(K,C){return function(W,V){C(W,V,K)}},WordHighlighterContribution_1;const ctxHasWordHighlights=new RawContextKey("hasWordHighlights",!1);function getOccurrencesAtPosition(K,C,W,V){const U=K.ordered(C);return first(U.map(G=>()=>Promise.resolve(G.provideDocumentHighlights(C,W,V)).then(void 0,onUnexpectedExternalError)),isNonEmptyArray$2)}class OccurenceAtPositionRequest{constructor(C,W,V){this._model=C,this._selection=W,this._wordSeparators=V,this._wordRange=this._getCurrentWordRange(C,W),this._result=null}get result(){return this._result||(this._result=createCancelablePromise(C=>this._compute(this._model,this._selection,this._wordSeparators,C))),this._result}_getCurrentWordRange(C,W){const V=C.getWordAtPosition(W.getPosition());return V?new Range$2(W.startLineNumber,V.startColumn,W.startLineNumber,V.endColumn):null}isValid(C,W,V){const U=W.startLineNumber,G=W.startColumn,Z=W.endColumn,X=this._getCurrentWordRange(C,W);let Q=!!(this._wordRange&&this._wordRange.equalsRange(X));for(let J=0,ee=V.length;!Q&&J<ee;J++){const te=V.getRange(J);te&&te.startLineNumber===U&&te.startColumn<=G&&te.endColumn>=Z&&(Q=!0)}return Q}cancel(){this.result.cancel()}}class SemanticOccurenceAtPositionRequest extends OccurenceAtPositionRequest{constructor(C,W,V,U){super(C,W,V),this._providers=U}_compute(C,W,V,U){return getOccurrencesAtPosition(this._providers,C,W.getPosition(),U).then(G=>G||[])}}class TextualOccurenceAtPositionRequest extends OccurenceAtPositionRequest{constructor(C,W,V){super(C,W,V),this._selectionIsEmpty=W.isEmpty()}_compute(C,W,V,U){return timeout(250,U).then(()=>{if(!W.isEmpty())return[];const G=C.getWordAtPosition(W.getPosition());return!G||G.word.length>1e3?[]:C.findMatches(G.word,!0,!1,!0,V,!1).map(X=>({range:X.range,kind:DocumentHighlightKind$1.Text}))})}isValid(C,W,V){const U=W.isEmpty();return this._selectionIsEmpty!==U?!1:super.isValid(C,W,V)}}function computeOccurencesAtPosition(K,C,W,V){return K.has(C)?new SemanticOccurenceAtPositionRequest(C,W,V,K):new TextualOccurenceAtPositionRequest(C,W,V)}registerModelAndPositionCommand("_executeDocumentHighlights",(K,C,W)=>{const V=K.get(ILanguageFeaturesService);return getOccurrencesAtPosition(V.documentHighlightProvider,C,W,CancellationToken.None)});class WordHighlighter{constructor(C,W,V,U){this.toUnhook=new DisposableStore,this.workerRequestTokenId=0,this.workerRequestCompleted=!1,this.workerRequestValue=[],this.lastCursorPositionChangeTime=0,this.renderDecorationsTimer=-1,this.editor=C,this.providers=W,this.linkedHighlighters=V,this._hasWordHighlights=ctxHasWordHighlights.bindTo(U),this._ignorePositionChangeEvent=!1,this.occurrencesHighlight=this.editor.getOption(80),this.model=this.editor.getModel(),this.toUnhook.add(C.onDidChangeCursorPosition(G=>{this._ignorePositionChangeEvent||this.occurrencesHighlight&&this._onPositionChanged(G)})),this.toUnhook.add(C.onDidChangeModelContent(G=>{this._stopAll()})),this.toUnhook.add(C.onDidChangeConfiguration(G=>{const Z=this.editor.getOption(80);this.occurrencesHighlight!==Z&&(this.occurrencesHighlight=Z,this._stopAll())})),this.decorations=this.editor.createDecorationsCollection(),this.workerRequestTokenId=0,this.workerRequest=null,this.workerRequestCompleted=!1,this.lastCursorPositionChangeTime=0,this.renderDecorationsTimer=-1}hasDecorations(){return this.decorations.length>0}restore(){this.occurrencesHighlight&&this._run()}_getSortedHighlights(){return this.decorations.getRanges().sort(Range$2.compareRangesUsingStarts)}moveNext(){const C=this._getSortedHighlights(),V=(C.findIndex(G=>G.containsPosition(this.editor.getPosition()))+1)%C.length,U=C[V];try{this._ignorePositionChangeEvent=!0,this.editor.setPosition(U.getStartPosition()),this.editor.revealRangeInCenterIfOutsideViewport(U);const G=this._getWord();if(G){const Z=this.editor.getModel().getLineContent(U.startLineNumber);alert(`${Z}, ${V+1} of ${C.length} for '${G.word}'`)}}finally{this._ignorePositionChangeEvent=!1}}moveBack(){const C=this._getSortedHighlights(),V=(C.findIndex(G=>G.containsPosition(this.editor.getPosition()))-1+C.length)%C.length,U=C[V];try{this._ignorePositionChangeEvent=!0,this.editor.setPosition(U.getStartPosition()),this.editor.revealRangeInCenterIfOutsideViewport(U);const G=this._getWord();if(G){const Z=this.editor.getModel().getLineContent(U.startLineNumber);alert(`${Z}, ${V+1} of ${C.length} for '${G.word}'`)}}finally{this._ignorePositionChangeEvent=!1}}_removeDecorations(){this.decorations.length>0&&(this.decorations.clear(),this._hasWordHighlights.set(!1))}_stopAll(){this._removeDecorations(),this.renderDecorationsTimer!==-1&&(clearTimeout(this.renderDecorationsTimer),this.renderDecorationsTimer=-1),this.workerRequest!==null&&(this.workerRequest.cancel(),this.workerRequest=null),this.workerRequestCompleted||(this.workerRequestTokenId++,this.workerRequestCompleted=!0)}_onPositionChanged(C){if(!this.occurrencesHighlight){this._stopAll();return}if(C.reason!==3){this._stopAll();return}this._run()}_getWord(){const C=this.editor.getSelection(),W=C.startLineNumber,V=C.startColumn;return this.model.getWordAtPosition({lineNumber:W,column:V})}_run(){const C=this.editor.getSelection();if(C.startLineNumber!==C.endLineNumber){this._stopAll();return}const W=C.startColumn,V=C.endColumn,U=this._getWord();if(!U||U.startColumn>W||U.endColumn<V){this._stopAll();return}const G=this.workerRequest&&this.workerRequest.isValid(this.model,C,this.decorations);if(this.lastCursorPositionChangeTime=new Date().getTime(),G)this.workerRequestCompleted&&this.renderDecorationsTimer!==-1&&(clearTimeout(this.renderDecorationsTimer),this.renderDecorationsTimer=-1,this._beginRenderDecorations());else{this._stopAll();const Z=++this.workerRequestTokenId;this.workerRequestCompleted=!1,this.workerRequest=computeOccurencesAtPosition(this.providers,this.model,this.editor.getSelection(),this.editor.getOption(129)),this.workerRequest.result.then(X=>{Z===this.workerRequestTokenId&&(this.workerRequestCompleted=!0,this.workerRequestValue=X||[],this._beginRenderDecorations())},onUnexpectedError)}}_beginRenderDecorations(){const C=new Date().getTime(),W=this.lastCursorPositionChangeTime+250;C>=W?(this.renderDecorationsTimer=-1,this.renderDecorations()):this.renderDecorationsTimer=setTimeout(()=>{this.renderDecorations()},W-C)}renderDecorations(){this.renderDecorationsTimer=-1;const C=[];for(const W of this.workerRequestValue)W.range&&C.push({range:W.range,options:getHighlightDecorationOptions(W.kind)});this.decorations.set(C),this._hasWordHighlights.set(this.hasDecorations());for(const W of this.linkedHighlighters())(W==null?void 0:W.editor.getModel())===this.editor.getModel()&&(W._stopAll(),W.decorations.set(C),W._hasWordHighlights.set(W.hasDecorations()))}dispose(){this._stopAll(),this.toUnhook.dispose()}}let WordHighlighterContribution=WordHighlighterContribution_1=class extends Disposable{static get(C){return C.getContribution(WordHighlighterContribution_1.ID)}constructor(C,W,V){super(),this.wordHighlighter=null,this.linkedContributions=new Set;const U=()=>{C.hasModel()&&!C.getModel().isTooLargeForTokenization()&&(this.wordHighlighter=new WordHighlighter(C,V.documentHighlightProvider,()=>Iterable.map(this.linkedContributions,G=>G.wordHighlighter),W))};this._register(C.onDidChangeModel(G=>{this.wordHighlighter&&(this.wordHighlighter.dispose(),this.wordHighlighter=null),U()})),U()}saveViewState(){return!!(this.wordHighlighter&&this.wordHighlighter.hasDecorations())}moveNext(){var C;(C=this.wordHighlighter)===null||C===void 0||C.moveNext()}moveBack(){var C;(C=this.wordHighlighter)===null||C===void 0||C.moveBack()}restoreViewState(C){this.wordHighlighter&&C&&this.wordHighlighter.restore()}dispose(){this.wordHighlighter&&(this.wordHighlighter.dispose(),this.wordHighlighter=null),super.dispose()}};WordHighlighterContribution.ID="editor.contrib.wordHighlighter";WordHighlighterContribution=WordHighlighterContribution_1=__decorate$8([__param$8(1,IContextKeyService),__param$8(2,ILanguageFeaturesService)],WordHighlighterContribution);class WordHighlightNavigationAction extends EditorAction{constructor(C,W){super(W),this._isNext=C}run(C,W){const V=WordHighlighterContribution.get(W);V&&(this._isNext?V.moveNext():V.moveBack())}}class NextWordHighlightAction extends WordHighlightNavigationAction{constructor(){super(!0,{id:"editor.action.wordHighlight.next",label:localize("wordHighlight.next.label","Go to Next Symbol Highlight"),alias:"Go to Next Symbol Highlight",precondition:ctxHasWordHighlights,kbOpts:{kbExpr:EditorContextKeys.editorTextFocus,primary:65,weight:100}})}}class PrevWordHighlightAction extends WordHighlightNavigationAction{constructor(){super(!1,{id:"editor.action.wordHighlight.prev",label:localize("wordHighlight.previous.label","Go to Previous Symbol Highlight"),alias:"Go to Previous Symbol Highlight",precondition:ctxHasWordHighlights,kbOpts:{kbExpr:EditorContextKeys.editorTextFocus,primary:1089,weight:100}})}}class TriggerWordHighlightAction extends EditorAction{constructor(){super({id:"editor.action.wordHighlight.trigger",label:localize("wordHighlight.trigger.label","Trigger Symbol Highlight"),alias:"Trigger Symbol Highlight",precondition:ctxHasWordHighlights.toNegated(),kbOpts:{kbExpr:EditorContextKeys.editorTextFocus,primary:0,weight:100}})}run(C,W,V){const U=WordHighlighterContribution.get(W);U&&U.restoreViewState(!0)}}registerEditorContribution(WordHighlighterContribution.ID,WordHighlighterContribution,0);registerEditorAction(NextWordHighlightAction);registerEditorAction(PrevWordHighlightAction);registerEditorAction(TriggerWordHighlightAction);class MoveWordCommand extends EditorCommand{constructor(C){super(C),this._inSelectionMode=C.inSelectionMode,this._wordNavigationType=C.wordNavigationType}runEditorCommand(C,W,V){if(!W.hasModel())return;const U=getMapForWordSeparators(W.getOption(129)),G=W.getModel(),X=W.getSelections().map(Q=>{const J=new Position$1(Q.positionLineNumber,Q.positionColumn),ee=this._move(U,G,J,this._wordNavigationType);return this._moveTo(Q,ee,this._inSelectionMode)});if(G.pushStackElement(),W._getViewModel().setCursorStates("moveWordCommand",3,X.map(Q=>CursorState$1.fromModelSelection(Q))),X.length===1){const Q=new Position$1(X[0].positionLineNumber,X[0].positionColumn);W.revealPosition(Q,0)}}_moveTo(C,W,V){return V?new Selection$1(C.selectionStartLineNumber,C.selectionStartColumn,W.lineNumber,W.column):new Selection$1(W.lineNumber,W.column,W.lineNumber,W.column)}}class WordLeftCommand extends MoveWordCommand{_move(C,W,V,U){return WordOperations.moveWordLeft(C,W,V,U)}}class WordRightCommand extends MoveWordCommand{_move(C,W,V,U){return WordOperations.moveWordRight(C,W,V,U)}}class CursorWordStartLeft extends WordLeftCommand{constructor(){super({inSelectionMode:!1,wordNavigationType:0,id:"cursorWordStartLeft",precondition:void 0})}}class CursorWordEndLeft extends WordLeftCommand{constructor(){super({inSelectionMode:!1,wordNavigationType:2,id:"cursorWordEndLeft",precondition:void 0})}}class CursorWordLeft extends WordLeftCommand{constructor(){var C;super({inSelectionMode:!1,wordNavigationType:1,id:"cursorWordLeft",precondition:void 0,kbOpts:{kbExpr:ContextKeyExpr.and(EditorContextKeys.textInputFocus,(C=ContextKeyExpr.and(CONTEXT_ACCESSIBILITY_MODE_ENABLED,IsWindowsContext))===null||C===void 0?void 0:C.negate()),primary:2063,mac:{primary:527},weight:100}})}}class CursorWordStartLeftSelect extends WordLeftCommand{constructor(){super({inSelectionMode:!0,wordNavigationType:0,id:"cursorWordStartLeftSelect",precondition:void 0})}}class CursorWordEndLeftSelect extends WordLeftCommand{constructor(){super({inSelectionMode:!0,wordNavigationType:2,id:"cursorWordEndLeftSelect",precondition:void 0})}}class CursorWordLeftSelect extends WordLeftCommand{constructor(){var C;super({inSelectionMode:!0,wordNavigationType:1,id:"cursorWordLeftSelect",precondition:void 0,kbOpts:{kbExpr:ContextKeyExpr.and(EditorContextKeys.textInputFocus,(C=ContextKeyExpr.and(CONTEXT_ACCESSIBILITY_MODE_ENABLED,IsWindowsContext))===null||C===void 0?void 0:C.negate()),primary:3087,mac:{primary:1551},weight:100}})}}class CursorWordAccessibilityLeft extends WordLeftCommand{constructor(){super({inSelectionMode:!1,wordNavigationType:3,id:"cursorWordAccessibilityLeft",precondition:void 0})}_move(C,W,V,U){return super._move(getMapForWordSeparators(EditorOptions.wordSeparators.defaultValue),W,V,U)}}class CursorWordAccessibilityLeftSelect extends WordLeftCommand{constructor(){super({inSelectionMode:!0,wordNavigationType:3,id:"cursorWordAccessibilityLeftSelect",precondition:void 0})}_move(C,W,V,U){return super._move(getMapForWordSeparators(EditorOptions.wordSeparators.defaultValue),W,V,U)}}class CursorWordStartRight extends WordRightCommand{constructor(){super({inSelectionMode:!1,wordNavigationType:0,id:"cursorWordStartRight",precondition:void 0})}}class CursorWordEndRight extends WordRightCommand{constructor(){var C;super({inSelectionMode:!1,wordNavigationType:2,id:"cursorWordEndRight",precondition:void 0,kbOpts:{kbExpr:ContextKeyExpr.and(EditorContextKeys.textInputFocus,(C=ContextKeyExpr.and(CONTEXT_ACCESSIBILITY_MODE_ENABLED,IsWindowsContext))===null||C===void 0?void 0:C.negate()),primary:2065,mac:{primary:529},weight:100}})}}class CursorWordRight extends WordRightCommand{constructor(){super({inSelectionMode:!1,wordNavigationType:2,id:"cursorWordRight",precondition:void 0})}}class CursorWordStartRightSelect extends WordRightCommand{constructor(){super({inSelectionMode:!0,wordNavigationType:0,id:"cursorWordStartRightSelect",precondition:void 0})}}class CursorWordEndRightSelect extends WordRightCommand{constructor(){var C;super({inSelectionMode:!0,wordNavigationType:2,id:"cursorWordEndRightSelect",precondition:void 0,kbOpts:{kbExpr:ContextKeyExpr.and(EditorContextKeys.textInputFocus,(C=ContextKeyExpr.and(CONTEXT_ACCESSIBILITY_MODE_ENABLED,IsWindowsContext))===null||C===void 0?void 0:C.negate()),primary:3089,mac:{primary:1553},weight:100}})}}class CursorWordRightSelect extends WordRightCommand{constructor(){super({inSelectionMode:!0,wordNavigationType:2,id:"cursorWordRightSelect",precondition:void 0})}}class CursorWordAccessibilityRight extends WordRightCommand{constructor(){super({inSelectionMode:!1,wordNavigationType:3,id:"cursorWordAccessibilityRight",precondition:void 0})}_move(C,W,V,U){return super._move(getMapForWordSeparators(EditorOptions.wordSeparators.defaultValue),W,V,U)}}class CursorWordAccessibilityRightSelect extends WordRightCommand{constructor(){super({inSelectionMode:!0,wordNavigationType:3,id:"cursorWordAccessibilityRightSelect",precondition:void 0})}_move(C,W,V,U){return super._move(getMapForWordSeparators(EditorOptions.wordSeparators.defaultValue),W,V,U)}}class DeleteWordCommand extends EditorCommand{constructor(C){super(C),this._whitespaceHeuristics=C.whitespaceHeuristics,this._wordNavigationType=C.wordNavigationType}runEditorCommand(C,W,V){const U=C.get(ILanguageConfigurationService);if(!W.hasModel())return;const G=getMapForWordSeparators(W.getOption(129)),Z=W.getModel(),X=W.getSelections(),Q=W.getOption(6),J=W.getOption(11),ee=U.getLanguageConfiguration(Z.getLanguageId()).getAutoClosingPairs(),te=W._getViewModel(),ie=X.map(ne=>{const oe=this._delete({wordSeparators:G,model:Z,selection:ne,whitespaceHeuristics:this._whitespaceHeuristics,autoClosingDelete:W.getOption(9),autoClosingBrackets:Q,autoClosingQuotes:J,autoClosingPairs:ee,autoClosedCharacters:te.getCursorAutoClosedCharacters()},this._wordNavigationType);return new ReplaceCommand(oe,"")});W.pushUndoStop(),W.executeCommands(this.id,ie),W.pushUndoStop()}}class DeleteWordLeftCommand extends DeleteWordCommand{_delete(C,W){const V=WordOperations.deleteWordLeft(C,W);return V||new Range$2(1,1,1,1)}}class DeleteWordRightCommand extends DeleteWordCommand{_delete(C,W){const V=WordOperations.deleteWordRight(C,W);if(V)return V;const U=C.model.getLineCount(),G=C.model.getLineMaxColumn(U);return new Range$2(U,G,U,G)}}class DeleteWordStartLeft extends DeleteWordLeftCommand{constructor(){super({whitespaceHeuristics:!1,wordNavigationType:0,id:"deleteWordStartLeft",precondition:EditorContextKeys.writable})}}class DeleteWordEndLeft extends DeleteWordLeftCommand{constructor(){super({whitespaceHeuristics:!1,wordNavigationType:2,id:"deleteWordEndLeft",precondition:EditorContextKeys.writable})}}class DeleteWordLeft extends DeleteWordLeftCommand{constructor(){super({whitespaceHeuristics:!0,wordNavigationType:0,id:"deleteWordLeft",precondition:EditorContextKeys.writable,kbOpts:{kbExpr:EditorContextKeys.textInputFocus,primary:2049,mac:{primary:513},weight:100}})}}class DeleteWordStartRight extends DeleteWordRightCommand{constructor(){super({whitespaceHeuristics:!1,wordNavigationType:0,id:"deleteWordStartRight",precondition:EditorContextKeys.writable})}}class DeleteWordEndRight extends DeleteWordRightCommand{constructor(){super({whitespaceHeuristics:!1,wordNavigationType:2,id:"deleteWordEndRight",precondition:EditorContextKeys.writable})}}class DeleteWordRight extends DeleteWordRightCommand{constructor(){super({whitespaceHeuristics:!0,wordNavigationType:2,id:"deleteWordRight",precondition:EditorContextKeys.writable,kbOpts:{kbExpr:EditorContextKeys.textInputFocus,primary:2068,mac:{primary:532},weight:100}})}}class DeleteInsideWord extends EditorAction{constructor(){super({id:"deleteInsideWord",precondition:EditorContextKeys.writable,label:localize("deleteInsideWord","Delete Word"),alias:"Delete Word"})}run(C,W,V){if(!W.hasModel())return;const U=getMapForWordSeparators(W.getOption(129)),G=W.getModel(),X=W.getSelections().map(Q=>{const J=WordOperations.deleteInsideWord(U,G,Q);return new ReplaceCommand(J,"")});W.pushUndoStop(),W.executeCommands(this.id,X),W.pushUndoStop()}}registerEditorCommand(new CursorWordStartLeft);registerEditorCommand(new CursorWordEndLeft);registerEditorCommand(new CursorWordLeft);registerEditorCommand(new CursorWordStartLeftSelect);registerEditorCommand(new CursorWordEndLeftSelect);registerEditorCommand(new CursorWordLeftSelect);registerEditorCommand(new CursorWordStartRight);registerEditorCommand(new CursorWordEndRight);registerEditorCommand(new CursorWordRight);registerEditorCommand(new CursorWordStartRightSelect);registerEditorCommand(new CursorWordEndRightSelect);registerEditorCommand(new CursorWordRightSelect);registerEditorCommand(new CursorWordAccessibilityLeft);registerEditorCommand(new CursorWordAccessibilityLeftSelect);registerEditorCommand(new CursorWordAccessibilityRight);registerEditorCommand(new CursorWordAccessibilityRightSelect);registerEditorCommand(new DeleteWordStartLeft);registerEditorCommand(new DeleteWordEndLeft);registerEditorCommand(new DeleteWordLeft);registerEditorCommand(new DeleteWordStartRight);registerEditorCommand(new DeleteWordEndRight);registerEditorCommand(new DeleteWordRight);registerEditorAction(DeleteInsideWord);class DeleteWordPartLeft extends DeleteWordCommand{constructor(){super({whitespaceHeuristics:!0,wordNavigationType:0,id:"deleteWordPartLeft",precondition:EditorContextKeys.writable,kbOpts:{kbExpr:EditorContextKeys.textInputFocus,primary:0,mac:{primary:769},weight:100}})}_delete(C,W){const V=WordPartOperations.deleteWordPartLeft(C);return V||new Range$2(1,1,1,1)}}class DeleteWordPartRight extends DeleteWordCommand{constructor(){super({whitespaceHeuristics:!0,wordNavigationType:2,id:"deleteWordPartRight",precondition:EditorContextKeys.writable,kbOpts:{kbExpr:EditorContextKeys.textInputFocus,primary:0,mac:{primary:788},weight:100}})}_delete(C,W){const V=WordPartOperations.deleteWordPartRight(C);if(V)return V;const U=C.model.getLineCount(),G=C.model.getLineMaxColumn(U);return new Range$2(U,G,U,G)}}class WordPartLeftCommand extends MoveWordCommand{_move(C,W,V,U){return WordPartOperations.moveWordPartLeft(C,W,V)}}class CursorWordPartLeft extends WordPartLeftCommand{constructor(){super({inSelectionMode:!1,wordNavigationType:0,id:"cursorWordPartLeft",precondition:void 0,kbOpts:{kbExpr:EditorContextKeys.textInputFocus,primary:0,mac:{primary:783},weight:100}})}}CommandsRegistry.registerCommandAlias("cursorWordPartStartLeft","cursorWordPartLeft");class CursorWordPartLeftSelect extends WordPartLeftCommand{constructor(){super({inSelectionMode:!0,wordNavigationType:0,id:"cursorWordPartLeftSelect",precondition:void 0,kbOpts:{kbExpr:EditorContextKeys.textInputFocus,primary:0,mac:{primary:1807},weight:100}})}}CommandsRegistry.registerCommandAlias("cursorWordPartStartLeftSelect","cursorWordPartLeftSelect");class WordPartRightCommand extends MoveWordCommand{_move(C,W,V,U){return WordPartOperations.moveWordPartRight(C,W,V)}}class CursorWordPartRight extends WordPartRightCommand{constructor(){super({inSelectionMode:!1,wordNavigationType:2,id:"cursorWordPartRight",precondition:void 0,kbOpts:{kbExpr:EditorContextKeys.textInputFocus,primary:0,mac:{primary:785},weight:100}})}}class CursorWordPartRightSelect extends WordPartRightCommand{constructor(){super({inSelectionMode:!0,wordNavigationType:2,id:"cursorWordPartRightSelect",precondition:void 0,kbOpts:{kbExpr:EditorContextKeys.textInputFocus,primary:0,mac:{primary:1809},weight:100}})}}registerEditorCommand(new DeleteWordPartLeft);registerEditorCommand(new DeleteWordPartRight);registerEditorCommand(new CursorWordPartLeft);registerEditorCommand(new CursorWordPartLeftSelect);registerEditorCommand(new CursorWordPartRight);registerEditorCommand(new CursorWordPartRightSelect);class ReadOnlyMessageController extends Disposable{constructor(C){super(),this.editor=C,this._register(this.editor.onDidAttemptReadOnlyEdit(()=>this._onDidAttemptReadOnlyEdit()))}_onDidAttemptReadOnlyEdit(){const C=MessageController.get(this.editor);if(C&&this.editor.hasModel()){let W=this.editor.getOptions().get(91);W||(this.editor.isSimpleWidget?W=new MarkdownString(localize("editor.simple.readonly","Cannot edit in read-only input")):W=new MarkdownString(localize("editor.readonly","Cannot edit in read-only editor"))),C.showMessage(W,this.editor.getPosition())}}}ReadOnlyMessageController.ID="editor.contrib.readOnlyMessageController";registerEditorContribution(ReadOnlyMessageController.ID,ReadOnlyMessageController,2);const iPadShowKeyboard="";class IPadShowKeyboard extends Disposable{constructor(C){super(),this.editor=C,this.widget=null,isIOS&&(this._register(C.onDidChangeConfiguration(()=>this.update())),this.update())}update(){const C=!this.editor.getOption(90);!this.widget&&C?this.widget=new ShowKeyboardWidget(this.editor):this.widget&&!C&&(this.widget.dispose(),this.widget=null)}dispose(){super.dispose(),this.widget&&(this.widget.dispose(),this.widget=null)}}IPadShowKeyboard.ID="editor.contrib.iPadShowKeyboard";class ShowKeyboardWidget extends Disposable{constructor(C){super(),this.editor=C,this._domNode=document.createElement("textarea"),this._domNode.className="iPadShowKeyboard",this._register(addDisposableListener(this._domNode,"touchstart",W=>{this.editor.focus()})),this._register(addDisposableListener(this._domNode,"focus",W=>{this.editor.focus()})),this.editor.addOverlayWidget(this)}dispose(){this.editor.removeOverlayWidget(this),super.dispose()}getId(){return ShowKeyboardWidget.ID}getDomNode(){return this._domNode}getPosition(){return{preference:1}}}ShowKeyboardWidget.ID="editor.contrib.ShowKeyboardWidget";registerEditorContribution(IPadShowKeyboard.ID,IPadShowKeyboard,3);const inspectTokens="";var __decorate$7=globalThis&&globalThis.__decorate||function(K,C,W,V){var U=arguments.length,G=U<3?C:V===null?V=Object.getOwnPropertyDescriptor(C,W):V,Z;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")G=Reflect.decorate(K,C,W,V);else for(var X=K.length-1;X>=0;X--)(Z=K[X])&&(G=(U<3?Z(G):U>3?Z(C,W,G):Z(C,W))||G);return U>3&&G&&Object.defineProperty(C,W,G),G},__param$7=globalThis&&globalThis.__param||function(K,C){return function(W,V){C(W,V,K)}},InspectTokensController_1;let InspectTokensController=InspectTokensController_1=class extends Disposable{static get(C){return C.getContribution(InspectTokensController_1.ID)}constructor(C,W,V){super(),this._editor=C,this._languageService=V,this._widget=null,this._register(this._editor.onDidChangeModel(U=>this.stop())),this._register(this._editor.onDidChangeModelLanguage(U=>this.stop())),this._register(TokenizationRegistry.onDidChange(U=>this.stop())),this._register(this._editor.onKeyUp(U=>U.keyCode===9&&this.stop()))}dispose(){this.stop(),super.dispose()}launch(){this._widget||this._editor.hasModel()&&(this._widget=new InspectTokensWidget(this._editor,this._languageService))}stop(){this._widget&&(this._widget.dispose(),this._widget=null)}};InspectTokensController.ID="editor.contrib.inspectTokens";InspectTokensController=InspectTokensController_1=__decorate$7([__param$7(1,IStandaloneThemeService),__param$7(2,ILanguageService)],InspectTokensController);class InspectTokens extends EditorAction{constructor(){super({id:"editor.action.inspectTokens",label:InspectTokensNLS.inspectTokensAction,alias:"Developer: Inspect Tokens",precondition:void 0})}run(C,W){const V=InspectTokensController.get(W);V==null||V.launch()}}function renderTokenText(K){let C="";for(let W=0,V=K.length;W<V;W++){const U=K.charCodeAt(W);switch(U){case 9:C+="→";break;case 32:C+="·";break;default:C+=String.fromCharCode(U)}}return C}function getSafeTokenizationSupport(K,C){const W=TokenizationRegistry.get(C);if(W)return W;const V=K.encodeLanguageId(C);return{getInitialState:()=>NullState,tokenize:(U,G,Z)=>nullTokenize(C,Z),tokenizeEncoded:(U,G,Z)=>nullTokenizeEncoded(V,Z)}}class InspectTokensWidget extends Disposable{constructor(C,W){super(),this.allowEditorOverflow=!0,this._editor=C,this._languageService=W,this._model=this._editor.getModel(),this._domNode=document.createElement("div"),this._domNode.className="tokens-inspect-widget",this._tokenizationSupport=getSafeTokenizationSupport(this._languageService.languageIdCodec,this._model.getLanguageId()),this._compute(this._editor.getPosition()),this._register(this._editor.onDidChangeCursorPosition(V=>this._compute(this._editor.getPosition()))),this._editor.addContentWidget(this)}dispose(){this._editor.removeContentWidget(this),super.dispose()}getId(){return InspectTokensWidget._ID}_compute(C){const W=this._getTokensAtLine(C.lineNumber);let V=0;for(let Q=W.tokens1.length-1;Q>=0;Q--){const J=W.tokens1[Q];if(C.column-1>=J.offset){V=Q;break}}let U=0;for(let Q=W.tokens2.length>>>1;Q>=0;Q--)if(C.column-1>=W.tokens2[Q<<1]){U=Q;break}const G=this._model.getLineContent(C.lineNumber);let Z="";if(V<W.tokens1.length){const Q=W.tokens1[V].offset,J=V+1<W.tokens1.length?W.tokens1[V+1].offset:G.length;Z=G.substring(Q,J)}reset(this._domNode,$$d("h2.tm-token",void 0,renderTokenText(Z),$$d("span.tm-token-length",void 0,`${Z.length} ${Z.length===1?"char":"chars"}`))),append$3(this._domNode,$$d("hr.tokens-inspect-separator",{style:"clear:both"}));const X=(U<<1)+1<W.tokens2.length?this._decodeMetadata(W.tokens2[(U<<1)+1]):null;append$3(this._domNode,$$d("table.tm-metadata-table",void 0,$$d("tbody",void 0,$$d("tr",void 0,$$d("td.tm-metadata-key",void 0,"language"),$$d("td.tm-metadata-value",void 0,`${X?X.languageId:"-?-"}`)),$$d("tr",void 0,$$d("td.tm-metadata-key",void 0,"token type"),$$d("td.tm-metadata-value",void 0,`${X?this._tokenTypeToString(X.tokenType):"-?-"}`)),$$d("tr",void 0,$$d("td.tm-metadata-key",void 0,"font style"),$$d("td.tm-metadata-value",void 0,`${X?this._fontStyleToString(X.fontStyle):"-?-"}`)),$$d("tr",void 0,$$d("td.tm-metadata-key",void 0,"foreground"),$$d("td.tm-metadata-value",void 0,`${X?Color.Format.CSS.formatHex(X.foreground):"-?-"}`)),$$d("tr",void 0,$$d("td.tm-metadata-key",void 0,"background"),$$d("td.tm-metadata-value",void 0,`${X?Color.Format.CSS.formatHex(X.background):"-?-"}`))))),append$3(this._domNode,$$d("hr.tokens-inspect-separator")),V<W.tokens1.length&&append$3(this._domNode,$$d("span.tm-token-type",void 0,W.tokens1[V].type)),this._editor.layoutContentWidget(this)}_decodeMetadata(C){const W=TokenizationRegistry.getColorMap(),V=TokenMetadata.getLanguageId(C),U=TokenMetadata.getTokenType(C),G=TokenMetadata.getFontStyle(C),Z=TokenMetadata.getForeground(C),X=TokenMetadata.getBackground(C);return{languageId:this._languageService.languageIdCodec.decodeLanguageId(V),tokenType:U,fontStyle:G,foreground:W[Z],background:W[X]}}_tokenTypeToString(C){switch(C){case 0:return"Other";case 1:return"Comment";case 2:return"String";case 3:return"RegEx";default:return"??"}}_fontStyleToString(C){let W="";return C&1&&(W+="italic "),C&2&&(W+="bold "),C&4&&(W+="underline "),C&8&&(W+="strikethrough "),W.length===0&&(W="---"),W}_getTokensAtLine(C){const W=this._getStateBeforeLine(C),V=this._tokenizationSupport.tokenize(this._model.getLineContent(C),!0,W),U=this._tokenizationSupport.tokenizeEncoded(this._model.getLineContent(C),!0,W);return{startState:W,tokens1:V.tokens,tokens2:U.tokens,endState:V.endState}}_getStateBeforeLine(C){let W=this._tokenizationSupport.getInitialState();for(let V=1;V<C;V++)W=this._tokenizationSupport.tokenize(this._model.getLineContent(V),!0,W).endState;return W}getDomNode(){return this._domNode}getPosition(){return{position:this._editor.getPosition(),preference:[2,1]}}}InspectTokensWidget._ID="editor.contrib.inspectTokensWidget";registerEditorContribution(InspectTokensController.ID,InspectTokensController,4);registerEditorAction(InspectTokens);var __decorate$6=globalThis&&globalThis.__decorate||function(K,C,W,V){var U=arguments.length,G=U<3?C:V===null?V=Object.getOwnPropertyDescriptor(C,W):V,Z;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")G=Reflect.decorate(K,C,W,V);else for(var X=K.length-1;X>=0;X--)(Z=K[X])&&(G=(U<3?Z(G):U>3?Z(C,W,G):Z(C,W))||G);return U>3&&G&&Object.defineProperty(C,W,G),G},__param$6=globalThis&&globalThis.__param||function(K,C){return function(W,V){C(W,V,K)}},HelpQuickAccessProvider_1;let HelpQuickAccessProvider=HelpQuickAccessProvider_1=class{constructor(C,W){this.quickInputService=C,this.keybindingService=W,this.registry=Registry.as(Extensions$2.Quickaccess)}provide(C){const W=new DisposableStore;return W.add(C.onDidAccept(()=>{const[V]=C.selectedItems;V&&this.quickInputService.quickAccess.show(V.prefix,{preserveValue:!0})})),W.add(C.onDidChangeValue(V=>{const U=this.registry.getQuickAccessProvider(V.substr(HelpQuickAccessProvider_1.PREFIX.length));U&&U.prefix&&U.prefix!==HelpQuickAccessProvider_1.PREFIX&&this.quickInputService.quickAccess.show(U.prefix,{preserveValue:!0})})),C.items=this.getQuickAccessProviders().filter(V=>V.prefix!==HelpQuickAccessProvider_1.PREFIX),W}getQuickAccessProviders(){return this.registry.getQuickAccessProviders().sort((W,V)=>W.prefix.localeCompare(V.prefix)).flatMap(W=>this.createPicks(W))}createPicks(C){return C.helpEntries.map(W=>{const V=W.prefix||C.prefix,U=V||"…";return{prefix:V,label:U,keybinding:W.commandId?this.keybindingService.lookupKeybinding(W.commandId):void 0,ariaLabel:localize("helpPickAriaLabel","{0}, {1}",U,W.description),description:W.description}})}};HelpQuickAccessProvider.PREFIX="?";HelpQuickAccessProvider=HelpQuickAccessProvider_1=__decorate$6([__param$6(0,IQuickInputService),__param$6(1,IKeybindingService)],HelpQuickAccessProvider);Registry.as(Extensions$2.Quickaccess).registerQuickAccessProvider({ctor:HelpQuickAccessProvider,prefix:"",helpEntries:[{description:QuickHelpNLS.helpQuickAccessActionLabel}]});class AbstractEditorNavigationQuickAccessProvider{constructor(C){this.options=C,this.rangeHighlightDecorationId=void 0}provide(C,W){var V;const U=new DisposableStore;C.canAcceptInBackground=!!(!((V=this.options)===null||V===void 0)&&V.canAcceptInBackground),C.matchOnLabel=C.matchOnDescription=C.matchOnDetail=C.sortByLabel=!1;const G=U.add(new MutableDisposable);return G.value=this.doProvide(C,W),U.add(this.onDidActiveTextEditorControlChange(()=>{G.value=void 0,G.value=this.doProvide(C,W)})),U}doProvide(C,W){var V;const U=new DisposableStore,G=this.activeTextEditorControl;if(G&&this.canProvideWithTextEditor(G)){const Z={editor:G},X=getCodeEditor(G);if(X){let Q=(V=G.saveViewState())!==null&&V!==void 0?V:void 0;U.add(X.onDidChangeCursorPosition(()=>{var J;Q=(J=G.saveViewState())!==null&&J!==void 0?J:void 0})),Z.restoreViewState=()=>{Q&&G===this.activeTextEditorControl&&G.restoreViewState(Q)},U.add(createSingleCallFunction(W.onCancellationRequested)(()=>{var J;return(J=Z.restoreViewState)===null||J===void 0?void 0:J.call(Z)}))}U.add(toDisposable(()=>this.clearDecorations(G))),U.add(this.provideWithTextEditor(Z,C,W))}else U.add(this.provideWithoutTextEditor(C,W));return U}canProvideWithTextEditor(C){return!0}gotoLocation({editor:C},W){C.setSelection(W.range),C.revealRangeInCenter(W.range,0),W.preserveFocus||C.focus();const V=C.getModel();V&&"getLineContent"in V&&status(`${V.getLineContent(W.range.startLineNumber)}`)}getModel(C){var W;return isDiffEditor(C)?(W=C.getModel())===null||W===void 0?void 0:W.modified:C.getModel()}addDecorations(C,W){C.changeDecorations(V=>{const U=[];this.rangeHighlightDecorationId&&(U.push(this.rangeHighlightDecorationId.overviewRulerDecorationId),U.push(this.rangeHighlightDecorationId.rangeHighlightId),this.rangeHighlightDecorationId=void 0);const G=[{range:W,options:{description:"quick-access-range-highlight",className:"rangeHighlight",isWholeLine:!0}},{range:W,options:{description:"quick-access-range-highlight-overview",overviewRuler:{color:themeColorFromId(overviewRulerRangeHighlight),position:OverviewRulerLane.Full}}}],[Z,X]=V.deltaDecorations(U,G);this.rangeHighlightDecorationId={rangeHighlightId:Z,overviewRulerDecorationId:X}})}clearDecorations(C){const W=this.rangeHighlightDecorationId;W&&(C.changeDecorations(V=>{V.deltaDecorations([W.overviewRulerDecorationId,W.rangeHighlightId],[])}),this.rangeHighlightDecorationId=void 0)}}class AbstractGotoLineQuickAccessProvider extends AbstractEditorNavigationQuickAccessProvider{constructor(){super({canAcceptInBackground:!0})}provideWithoutTextEditor(C){const W=localize("cannotRunGotoLine","Open a text editor first to go to a line.");return C.items=[{label:W}],C.ariaLabel=W,Disposable.None}provideWithTextEditor(C,W,V){const U=C.editor,G=new DisposableStore;G.add(W.onDidAccept(Q=>{const[J]=W.selectedItems;if(J){if(!this.isValidLineNumber(U,J.lineNumber))return;this.gotoLocation(C,{range:this.toRange(J.lineNumber,J.column),keyMods:W.keyMods,preserveFocus:Q.inBackground}),Q.inBackground||W.hide()}}));const Z=()=>{const Q=this.parsePosition(U,W.value.trim().substr(AbstractGotoLineQuickAccessProvider.PREFIX.length)),J=this.getPickLabel(U,Q.lineNumber,Q.column);if(W.items=[{lineNumber:Q.lineNumber,column:Q.column,label:J}],W.ariaLabel=J,!this.isValidLineNumber(U,Q.lineNumber)){this.clearDecorations(U);return}const ee=this.toRange(Q.lineNumber,Q.column);U.revealRangeInCenter(ee,0),this.addDecorations(U,ee)};Z(),G.add(W.onDidChangeValue(()=>Z()));const X=getCodeEditor(U);return X&&X.getOptions().get(67).renderType===2&&(X.updateOptions({lineNumbers:"on"}),G.add(toDisposable(()=>X.updateOptions({lineNumbers:"relative"})))),G}toRange(C=1,W=1){return{startLineNumber:C,startColumn:W,endLineNumber:C,endColumn:W}}parsePosition(C,W){const V=W.split(/,|:|#/).map(G=>parseInt(G,10)).filter(G=>!isNaN(G)),U=this.lineCount(C)+1;return{lineNumber:V[0]>0?V[0]:U+V[0],column:V[1]}}getPickLabel(C,W,V){if(this.isValidLineNumber(C,W))return this.isValidColumn(C,W,V)?localize("gotoLineColumnLabel","Go to line {0} and character {1}.",W,V):localize("gotoLineLabel","Go to line {0}.",W);const U=C.getPosition()||{lineNumber:1,column:1},G=this.lineCount(C);return G>1?localize("gotoLineLabelEmptyWithLimit","Current Line: {0}, Character: {1}. Type a line number between 1 and {2} to navigate to.",U.lineNumber,U.column,G):localize("gotoLineLabelEmpty","Current Line: {0}, Character: {1}. Type a line number to navigate to.",U.lineNumber,U.column)}isValidLineNumber(C,W){return!W||typeof W!="number"?!1:W>0&&W<=this.lineCount(C)}isValidColumn(C,W,V){if(!V||typeof V!="number")return!1;const U=this.getModel(C);if(!U)return!1;const G={lineNumber:W,column:V};return U.validatePosition(G).equals(G)}lineCount(C){var W,V;return(V=(W=this.getModel(C))===null||W===void 0?void 0:W.getLineCount())!==null&&V!==void 0?V:0}}AbstractGotoLineQuickAccessProvider.PREFIX=":";var __decorate$5=globalThis&&globalThis.__decorate||function(K,C,W,V){var U=arguments.length,G=U<3?C:V===null?V=Object.getOwnPropertyDescriptor(C,W):V,Z;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")G=Reflect.decorate(K,C,W,V);else for(var X=K.length-1;X>=0;X--)(Z=K[X])&&(G=(U<3?Z(G):U>3?Z(C,W,G):Z(C,W))||G);return U>3&&G&&Object.defineProperty(C,W,G),G},__param$5=globalThis&&globalThis.__param||function(K,C){return function(W,V){C(W,V,K)}};let StandaloneGotoLineQuickAccessProvider=class extends AbstractGotoLineQuickAccessProvider{constructor(C){super(),this.editorService=C,this.onDidActiveTextEditorControlChange=Event$1.None}get activeTextEditorControl(){var C;return(C=this.editorService.getFocusedCodeEditor())!==null&&C!==void 0?C:void 0}};StandaloneGotoLineQuickAccessProvider=__decorate$5([__param$5(0,ICodeEditorService)],StandaloneGotoLineQuickAccessProvider);let GotoLineAction$1=class ri extends EditorAction{constructor(){super({id:ri.ID,label:GoToLineNLS.gotoLineActionLabel,alias:"Go to Line/Column...",precondition:void 0,kbOpts:{kbExpr:EditorContextKeys.focus,primary:2085,mac:{primary:293},weight:100}})}run(C){C.get(IQuickInputService).quickAccess.show(StandaloneGotoLineQuickAccessProvider.PREFIX)}};GotoLineAction$1.ID="editor.action.gotoLine";registerEditorAction(GotoLineAction$1);Registry.as(Extensions$2.Quickaccess).registerQuickAccessProvider({ctor:StandaloneGotoLineQuickAccessProvider,prefix:StandaloneGotoLineQuickAccessProvider.PREFIX,helpEntries:[{description:GoToLineNLS.gotoLineActionLabel,commandId:GotoLineAction$1.ID}]});const NO_SCORE2=[void 0,[]];function scoreFuzzy2(K,C,W=0,V=0){const U=C;return U.values&&U.values.length>1?doScoreFuzzy2Multiple(K,U.values,W,V):doScoreFuzzy2Single(K,C,W,V)}function doScoreFuzzy2Multiple(K,C,W,V){let U=0;const G=[];for(const Z of C){const[X,Q]=doScoreFuzzy2Single(K,Z,W,V);if(typeof X!="number")return NO_SCORE2;U+=X,G.push(...Q)}return[U,normalizeMatches(G)]}function doScoreFuzzy2Single(K,C,W,V){const U=fuzzyScore(C.original,C.originalLowercase,W,K,K.toLowerCase(),V,{firstMatchCanBeWeak:!0,boostFullMatch:!0});return U?[U[0],createMatches(U)]:NO_SCORE2}function normalizeMatches(K){const C=K.sort((U,G)=>U.start-G.start),W=[];let V;for(const U of C)!V||!matchOverlaps(V,U)?(V=U,W.push(U)):(V.start=Math.min(V.start,U.start),V.end=Math.max(V.end,U.end));return W}function matchOverlaps(K,C){return!(K.end<C.start||C.end<K.start)}function queryExpectsExactMatch(K){return K.startsWith('"')&&K.endsWith('"')}const MULTIPLE_QUERY_VALUES_SEPARATOR=" ";function prepareQuery(K){typeof K!="string"&&(K="");const C=K.toLowerCase(),{pathNormalized:W,normalized:V,normalizedLowercase:U}=normalizeQuery(K),G=W.indexOf(sep)>=0,Z=queryExpectsExactMatch(K);let X;const Q=K.split(MULTIPLE_QUERY_VALUES_SEPARATOR);if(Q.length>1)for(const J of Q){const ee=queryExpectsExactMatch(J),{pathNormalized:te,normalized:ie,normalizedLowercase:ne}=normalizeQuery(J);ie&&(X||(X=[]),X.push({original:J,originalLowercase:J.toLowerCase(),pathNormalized:te,normalized:ie,normalizedLowercase:ne,expectContiguousMatch:ee}))}return{original:K,originalLowercase:C,pathNormalized:W,normalized:V,normalizedLowercase:U,values:X,containsPathSeparator:G,expectContiguousMatch:Z}}function normalizeQuery(K){let C;isWindows?C=K.replace(/\//g,sep):C=K.replace(/\\/g,sep);const W=stripWildcards(C).replace(/\s|"/g,"");return{pathNormalized:C,normalized:W,normalizedLowercase:W.toLowerCase()}}function pieceToQuery(K){return Array.isArray(K)?prepareQuery(K.map(C=>C.original).join(MULTIPLE_QUERY_VALUES_SEPARATOR)):prepareQuery(K.original)}var __decorate$4=globalThis&&globalThis.__decorate||function(K,C,W,V){var U=arguments.length,G=U<3?C:V===null?V=Object.getOwnPropertyDescriptor(C,W):V,Z;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")G=Reflect.decorate(K,C,W,V);else for(var X=K.length-1;X>=0;X--)(Z=K[X])&&(G=(U<3?Z(G):U>3?Z(C,W,G):Z(C,W))||G);return U>3&&G&&Object.defineProperty(C,W,G),G},__param$4=globalThis&&globalThis.__param||function(K,C){return function(W,V){C(W,V,K)}},__awaiter$3=globalThis&&globalThis.__awaiter||function(K,C,W,V){function U(G){return G instanceof W?G:new W(function(Z){Z(G)})}return new(W||(W=Promise))(function(G,Z){function X(ee){try{J(V.next(ee))}catch(te){Z(te)}}function Q(ee){try{J(V.throw(ee))}catch(te){Z(te)}}function J(ee){ee.done?G(ee.value):U(ee.value).then(X,Q)}J((V=V.apply(K,C||[])).next())})},AbstractGotoSymbolQuickAccessProvider_1;let AbstractGotoSymbolQuickAccessProvider=AbstractGotoSymbolQuickAccessProvider_1=class extends AbstractEditorNavigationQuickAccessProvider{constructor(C,W,V=Object.create(null)){super(V),this._languageFeaturesService=C,this._outlineModelService=W,this.options=V,this.options.canAcceptInBackground=!0}provideWithoutTextEditor(C){return this.provideLabelPick(C,localize("cannotRunGotoSymbolWithoutEditor","To go to a symbol, first open a text editor with symbol information.")),Disposable.None}provideWithTextEditor(C,W,V){const U=C.editor,G=this.getModel(U);return G?this._languageFeaturesService.documentSymbolProvider.has(G)?this.doProvideWithEditorSymbols(C,G,W,V):this.doProvideWithoutEditorSymbols(C,G,W,V):Disposable.None}doProvideWithoutEditorSymbols(C,W,V,U){const G=new DisposableStore;return this.provideLabelPick(V,localize("cannotRunGotoSymbolWithoutSymbolProvider","The active text editor does not provide symbol information.")),__awaiter$3(this,void 0,void 0,function*(){!(yield this.waitForLanguageSymbolRegistry(W,G))||U.isCancellationRequested||G.add(this.doProvideWithEditorSymbols(C,W,V,U))}),G}provideLabelPick(C,W){C.items=[{label:W,index:0,kind:14}],C.ariaLabel=W}waitForLanguageSymbolRegistry(C,W){return __awaiter$3(this,void 0,void 0,function*(){if(this._languageFeaturesService.documentSymbolProvider.has(C))return!0;const V=new DeferredPromise,U=W.add(this._languageFeaturesService.documentSymbolProvider.onDidChange(()=>{this._languageFeaturesService.documentSymbolProvider.has(C)&&(U.dispose(),V.complete(!0))}));return W.add(toDisposable(()=>V.complete(!1))),V.p})}doProvideWithEditorSymbols(C,W,V,U){var G;const Z=C.editor,X=new DisposableStore;X.add(V.onDidAccept(te=>{const[ie]=V.selectedItems;ie&&ie.range&&(this.gotoLocation(C,{range:ie.range.selection,keyMods:V.keyMods,preserveFocus:te.inBackground}),te.inBackground||V.hide())})),X.add(V.onDidTriggerItemButton(({item:te})=>{te&&te.range&&(this.gotoLocation(C,{range:te.range.selection,keyMods:V.keyMods,forceSideBySide:!0}),V.hide())}));const Q=this.getDocumentSymbols(W,U);let J;const ee=te=>__awaiter$3(this,void 0,void 0,function*(){J==null||J.dispose(!0),V.busy=!1,J=new CancellationTokenSource$1(U),V.busy=!0;try{const ie=prepareQuery(V.value.substr(AbstractGotoSymbolQuickAccessProvider_1.PREFIX.length).trim()),ne=yield this.doGetSymbolPicks(Q,ie,void 0,J.token);if(U.isCancellationRequested)return;if(ne.length>0){if(V.items=ne,te&&ie.original.length===0){const oe=findLast$2(ne,re=>!!(re.type!=="separator"&&re.range&&Range$2.containsPosition(re.range.decoration,te)));oe&&(V.activeItems=[oe])}}else ie.original.length>0?this.provideLabelPick(V,localize("noMatchingSymbolResults","No matching editor symbols")):this.provideLabelPick(V,localize("noSymbolResults","No editor symbols"))}finally{U.isCancellationRequested||(V.busy=!1)}});return X.add(V.onDidChangeValue(()=>ee(void 0))),ee((G=Z.getSelection())===null||G===void 0?void 0:G.getPosition()),X.add(V.onDidChangeActive(()=>{const[te]=V.activeItems;te&&te.range&&(Z.revealRangeInCenter(te.range.selection,0),this.addDecorations(Z,te.range.decoration))})),X}doGetSymbolPicks(C,W,V,U){var G,Z;return __awaiter$3(this,void 0,void 0,function*(){const X=yield C;if(U.isCancellationRequested)return[];const Q=W.original.indexOf(AbstractGotoSymbolQuickAccessProvider_1.SCOPE_PREFIX)===0,J=Q?1:0;let ee,te;W.values&&W.values.length>1?(ee=pieceToQuery(W.values[0]),te=pieceToQuery(W.values.slice(1))):ee=W;let ie;const ne=(Z=(G=this.options)===null||G===void 0?void 0:G.openSideBySideDirection)===null||Z===void 0?void 0:Z.call(G);ne&&(ie=[{iconClass:ne==="right"?ThemeIcon.asClassName(Codicon.splitHorizontal):ThemeIcon.asClassName(Codicon.splitVertical),tooltip:ne==="right"?localize("openToSide","Open to the Side"):localize("openToBottom","Open to the Bottom")}]);const oe=[];for(let se=0;se<X.length;se++){const le=X[se],ce=trim$2(le.name),de=`$(${SymbolKinds.toIcon(le.kind).id}) ${ce}`,ue=de.length-ce.length;let ge=le.containerName;V!=null&&V.extraContainerLabel&&(ge?ge=`${V.extraContainerLabel} • ${ge}`:ge=V.extraContainerLabel);let he,fe,pe,Se;if(W.original.length>J){let be=!1;if(ee!==W&&([he,fe]=scoreFuzzy2(de,Object.assign(Object.assign({},W),{values:void 0}),J,ue),typeof he=="number"&&(be=!0)),typeof he!="number"&&([he,fe]=scoreFuzzy2(de,ee,J,ue),typeof he!="number"))continue;if(!be&&te){if(ge&&te.original.length>0&&([pe,Se]=scoreFuzzy2(ge,te)),typeof pe!="number")continue;typeof he=="number"&&(he+=pe)}}const Le=le.tags&&le.tags.indexOf(1)>=0;oe.push({index:se,kind:le.kind,score:he,label:de,ariaLabel:getAriaLabelForSymbol(le.name,le.kind),description:ge,highlights:Le?void 0:{label:fe,description:Se},range:{selection:Range$2.collapseToStart(le.selectionRange),decoration:le.range},strikethrough:Le,buttons:ie})}const re=oe.sort((se,le)=>Q?this.compareByKindAndScore(se,le):this.compareByScore(se,le));let ae=[];if(Q){let de=function(){le&&typeof se=="number"&&ce>0&&(le.label=format(NLS_SYMBOL_KIND_CACHE[se]||FALLBACK_NLS_SYMBOL_KIND,ce))},se,le,ce=0;for(const ue of re)se!==ue.kind?(de(),se=ue.kind,ce=1,le={type:"separator"},ae.push(le)):ce++,ae.push(ue);de()}else re.length>0&&(ae=[{label:localize("symbols","symbols ({0})",oe.length),type:"separator"},...re]);return ae})}compareByScore(C,W){if(typeof C.score!="number"&&typeof W.score=="number")return 1;if(typeof C.score=="number"&&typeof W.score!="number")return-1;if(typeof C.score=="number"&&typeof W.score=="number"){if(C.score>W.score)return-1;if(C.score<W.score)return 1}return C.index<W.index?-1:C.index>W.index?1:0}compareByKindAndScore(C,W){const V=NLS_SYMBOL_KIND_CACHE[C.kind]||FALLBACK_NLS_SYMBOL_KIND,U=NLS_SYMBOL_KIND_CACHE[W.kind]||FALLBACK_NLS_SYMBOL_KIND,G=V.localeCompare(U);return G===0?this.compareByScore(C,W):G}getDocumentSymbols(C,W){return __awaiter$3(this,void 0,void 0,function*(){const V=yield this._outlineModelService.getOrCreate(C,W);return W.isCancellationRequested?[]:V.asListOfDocumentSymbols()})}};AbstractGotoSymbolQuickAccessProvider.PREFIX="@";AbstractGotoSymbolQuickAccessProvider.SCOPE_PREFIX=":";AbstractGotoSymbolQuickAccessProvider.PREFIX_BY_CATEGORY=`${AbstractGotoSymbolQuickAccessProvider_1.PREFIX}${AbstractGotoSymbolQuickAccessProvider_1.SCOPE_PREFIX}`;AbstractGotoSymbolQuickAccessProvider=AbstractGotoSymbolQuickAccessProvider_1=__decorate$4([__param$4(0,ILanguageFeaturesService),__param$4(1,IOutlineModelService)],AbstractGotoSymbolQuickAccessProvider);const FALLBACK_NLS_SYMBOL_KIND=localize("property","properties ({0})"),NLS_SYMBOL_KIND_CACHE={5:localize("method","methods ({0})"),11:localize("function","functions ({0})"),8:localize("_constructor","constructors ({0})"),12:localize("variable","variables ({0})"),4:localize("class","classes ({0})"),22:localize("struct","structs ({0})"),23:localize("event","events ({0})"),24:localize("operator","operators ({0})"),10:localize("interface","interfaces ({0})"),2:localize("namespace","namespaces ({0})"),3:localize("package","packages ({0})"),25:localize("typeParameter","type parameters ({0})"),1:localize("modules","modules ({0})"),6:localize("property","properties ({0})"),9:localize("enum","enumerations ({0})"),21:localize("enumMember","enumeration members ({0})"),14:localize("string","strings ({0})"),0:localize("file","files ({0})"),17:localize("array","arrays ({0})"),15:localize("number","numbers ({0})"),16:localize("boolean","booleans ({0})"),18:localize("object","objects ({0})"),19:localize("key","keys ({0})"),7:localize("field","fields ({0})"),13:localize("constant","constants ({0})")};var __decorate$3=globalThis&&globalThis.__decorate||function(K,C,W,V){var U=arguments.length,G=U<3?C:V===null?V=Object.getOwnPropertyDescriptor(C,W):V,Z;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")G=Reflect.decorate(K,C,W,V);else for(var X=K.length-1;X>=0;X--)(Z=K[X])&&(G=(U<3?Z(G):U>3?Z(C,W,G):Z(C,W))||G);return U>3&&G&&Object.defineProperty(C,W,G),G},__param$3=globalThis&&globalThis.__param||function(K,C){return function(W,V){C(W,V,K)}};let StandaloneGotoSymbolQuickAccessProvider=class extends AbstractGotoSymbolQuickAccessProvider{constructor(C,W,V){super(W,V),this.editorService=C,this.onDidActiveTextEditorControlChange=Event$1.None}get activeTextEditorControl(){var C;return(C=this.editorService.getFocusedCodeEditor())!==null&&C!==void 0?C:void 0}};StandaloneGotoSymbolQuickAccessProvider=__decorate$3([__param$3(0,ICodeEditorService),__param$3(1,ILanguageFeaturesService),__param$3(2,IOutlineModelService)],StandaloneGotoSymbolQuickAccessProvider);class GotoSymbolAction extends EditorAction{constructor(){super({id:GotoSymbolAction.ID,label:QuickOutlineNLS.quickOutlineActionLabel,alias:"Go to Symbol...",precondition:EditorContextKeys.hasDocumentSymbolProvider,kbOpts:{kbExpr:EditorContextKeys.focus,primary:3117,weight:100},contextMenuOpts:{group:"navigation",order:3}})}run(C){C.get(IQuickInputService).quickAccess.show(AbstractGotoSymbolQuickAccessProvider.PREFIX,{itemActivation:ItemActivation.NONE})}}GotoSymbolAction.ID="editor.action.quickOutline";registerEditorAction(GotoSymbolAction);Registry.as(Extensions$2.Quickaccess).registerQuickAccessProvider({ctor:StandaloneGotoSymbolQuickAccessProvider,prefix:AbstractGotoSymbolQuickAccessProvider.PREFIX,helpEntries:[{description:QuickOutlineNLS.quickOutlineActionLabel,prefix:AbstractGotoSymbolQuickAccessProvider.PREFIX,commandId:GotoSymbolAction.ID},{description:QuickOutlineNLS.quickOutlineByCategoryActionLabel,prefix:AbstractGotoSymbolQuickAccessProvider.PREFIX_BY_CATEGORY}]});function exceptionToErrorMessage(K,C){return C&&(K.stack||K.stacktrace)?localize("stackTrace.format","{0}: {1}",detectSystemErrorMessage(K),stackToString(K.stack)||stackToString(K.stacktrace)):detectSystemErrorMessage(K)}function stackToString(K){return Array.isArray(K)?K.join(`
`):K}function detectSystemErrorMessage(K){return K.code==="ERR_UNC_HOST_NOT_ALLOWED"?`${K.message}. Please update the 'security.allowedUNCHosts' setting if you want to allow this host.`:typeof K.code=="string"&&typeof K.errno=="number"&&typeof K.syscall=="string"?localize("nodeExceptionMessage","A system error occurred ({0})",K.message):K.message||localize("error.defaultMessage","An unknown error occurred. Please consult the log for more details.")}function toErrorMessage(K=null,C=!1){if(!K)return localize("error.defaultMessage","An unknown error occurred. Please consult the log for more details.");if(Array.isArray(K)){const W=coalesce(K),V=toErrorMessage(W[0],C);return W.length>1?localize("error.moreErrors","{0} ({1} errors in total)",V,W.length):V}if(isString$3(K))return K;if(K.detail){const W=K.detail;if(W.error)return exceptionToErrorMessage(W.error,C);if(W.exception)return exceptionToErrorMessage(W.exception,C)}return K.stack?exceptionToErrorMessage(K,C):K.message?K.message:localize("error.defaultMessage","An unknown error occurred. Please consult the log for more details.")}function countMapFrom(K){var C;const W=new Map;for(const V of K)W.set(V,((C=W.get(V))!==null&&C!==void 0?C:0)+1);return W}class TfIdfCalculator{constructor(){this.chunkCount=0,this.chunkOccurrences=new Map,this.documents=new Map}calculateScores(C,W){const V=this.computeEmbedding(C),U=new Map,G=[];for(const[Z,X]of this.documents){if(W.isCancellationRequested)return[];for(const Q of X.chunks){const J=this.computeSimilarityScore(Q,V,U);J>0&&G.push({key:Z,score:J})}}return G}static termFrequencies(C){return countMapFrom(TfIdfCalculator.splitTerms(C))}static*splitTerms(C){const W=V=>V.toLowerCase();for(const[V]of C.matchAll(/\b\p{Letter}[\p{Letter}\d]{2,}\b/gu)){yield W(V);const U=V.split(new RegExp("(?<=[a-z])(?=[A-Z])","g"));if(U.length>1)for(const G of U)G.length>2&&/\p{Letter}{3,}/gu.test(G)&&(yield W(G))}}updateDocuments(C){var W;for(const{key:V}of C)this.deleteDocument(V);for(const V of C){const U=[];for(const G of V.textChunks){const Z=TfIdfCalculator.termFrequencies(G);for(const X of Z.keys())this.chunkOccurrences.set(X,((W=this.chunkOccurrences.get(X))!==null&&W!==void 0?W:0)+1);U.push({text:G,tf:Z})}this.chunkCount+=U.length,this.documents.set(V.key,{chunks:U})}return this}deleteDocument(C){const W=this.documents.get(C);if(W){this.documents.delete(C),this.chunkCount-=W.chunks.length;for(const V of W.chunks)for(const U of V.tf.keys()){const G=this.chunkOccurrences.get(U);if(typeof G=="number"){const Z=G-1;Z<=0?this.chunkOccurrences.delete(U):this.chunkOccurrences.set(U,Z)}}}}computeSimilarityScore(C,W,V){let U=0;for(const[G,Z]of Object.entries(W)){const X=C.tf.get(G);if(!X)continue;let Q=V.get(G);typeof Q!="number"&&(Q=this.computeIdf(G),V.set(G,Q));const J=X*Q;U+=J*Z}return U}computeEmbedding(C){const W=TfIdfCalculator.termFrequencies(C);return this.computeTfidf(W)}computeIdf(C){var W;const V=(W=this.chunkOccurrences.get(C))!==null&&W!==void 0?W:0;return V>0?Math.log((this.chunkCount+1)/V):0}computeTfidf(C){const W=Object.create(null);for(const[V,U]of C){const G=this.computeIdf(V);G>0&&(W[V]=U*G)}return W}}function normalizeTfIdfScores(K){var C,W;const V=K.slice(0);V.sort((G,Z)=>Z.score-G.score);const U=(W=(C=V[0])===null||C===void 0?void 0:C.score)!==null&&W!==void 0?W:0;if(U>0)for(const G of V)G.score/=U;return V}var __awaiter$2=globalThis&&globalThis.__awaiter||function(K,C,W,V){function U(G){return G instanceof W?G:new W(function(Z){Z(G)})}return new(W||(W=Promise))(function(G,Z){function X(ee){try{J(V.next(ee))}catch(te){Z(te)}}function Q(ee){try{J(V.throw(ee))}catch(te){Z(te)}}function J(ee){ee.done?G(ee.value):U(ee.value).then(X,Q)}J((V=V.apply(K,C||[])).next())})},TriggerAction;(function(K){K[K.NO_ACTION=0]="NO_ACTION",K[K.CLOSE_PICKER=1]="CLOSE_PICKER",K[K.REFRESH_PICKER=2]="REFRESH_PICKER",K[K.REMOVE_ITEM=3]="REMOVE_ITEM"})(TriggerAction||(TriggerAction={}));function isPicksWithActive(K){const C=K;return Array.isArray(C.items)}function isFastAndSlowPicks(K){const C=K;return!!C.picks&&C.additionalPicks instanceof Promise}class PickerQuickAccessProvider extends Disposable{constructor(C,W){super(),this.prefix=C,this.options=W}provide(C,W,V){var U;const G=new DisposableStore;C.canAcceptInBackground=!!(!((U=this.options)===null||U===void 0)&&U.canAcceptInBackground),C.matchOnLabel=C.matchOnDescription=C.matchOnDetail=C.sortByLabel=!1;let Z;const X=G.add(new MutableDisposable),Q=()=>__awaiter$2(this,void 0,void 0,function*(){const J=X.value=new DisposableStore;Z==null||Z.dispose(!0),C.busy=!1,Z=new CancellationTokenSource$1(W);const ee=Z.token,te=C.value.substr(this.prefix.length).trim(),ie=this._getPicks(te,J,ee,V),ne=(re,ae)=>{var se;let le,ce;if(isPicksWithActive(re)?(le=re.items,ce=re.active):le=re,le.length===0){if(ae)return!1;(te.length>0||C.hideInput)&&(!((se=this.options)===null||se===void 0)&&se.noResultsPick)&&(isFunction$2(this.options.noResultsPick)?le=[this.options.noResultsPick(te)]:le=[this.options.noResultsPick])}return C.items=le,ce&&(C.activeItems=[ce]),!0},oe=re=>__awaiter$2(this,void 0,void 0,function*(){let ae=!1,se=!1;yield Promise.all([(()=>__awaiter$2(this,void 0,void 0,function*(){typeof re.mergeDelay=="number"&&(yield timeout(re.mergeDelay),ee.isCancellationRequested)||se||(ae=ne(re.picks,!0))}))(),(()=>__awaiter$2(this,void 0,void 0,function*(){C.busy=!0;try{const le=yield re.additionalPicks;if(ee.isCancellationRequested)return;let ce,de;isPicksWithActive(re.picks)?(ce=re.picks.items,de=re.picks.active):ce=re.picks;let ue,ge;if(isPicksWithActive(le)?(ue=le.items,ge=le.active):ue=le,ue.length>0||!ae){let he;if(!de&&!ge){const fe=C.activeItems[0];fe&&ce.indexOf(fe)!==-1&&(he=fe)}ne({items:[...ce,...ue],active:de||ge||he})}}finally{ee.isCancellationRequested||(C.busy=!1),se=!0}}))()])});if(ie!==null)if(isFastAndSlowPicks(ie))yield oe(ie);else if(!(ie instanceof Promise))ne(ie);else{C.busy=!0;try{const re=yield ie;if(ee.isCancellationRequested)return;isFastAndSlowPicks(re)?yield oe(re):ne(re)}finally{ee.isCancellationRequested||(C.busy=!1)}}});return G.add(C.onDidChangeValue(()=>Q())),Q(),G.add(C.onDidAccept(J=>{const[ee]=C.selectedItems;typeof(ee==null?void 0:ee.accept)=="function"&&(J.inBackground||C.hide(),ee.accept(C.keyMods,J))})),G.add(C.onDidTriggerItemButton(({button:J,item:ee})=>__awaiter$2(this,void 0,void 0,function*(){var te,ie;if(typeof ee.trigger=="function"){const ne=(ie=(te=ee.buttons)===null||te===void 0?void 0:te.indexOf(J))!==null&&ie!==void 0?ie:-1;if(ne>=0){const oe=ee.trigger(ne,C.keyMods),re=typeof oe=="number"?oe:yield oe;if(W.isCancellationRequested)return;switch(re){case TriggerAction.NO_ACTION:break;case TriggerAction.CLOSE_PICKER:C.hide();break;case TriggerAction.REFRESH_PICKER:Q();break;case TriggerAction.REMOVE_ITEM:{const ae=C.items.indexOf(ee);if(ae!==-1){const se=C.items.slice(),le=se.splice(ae,1),ce=C.activeItems.filter(ue=>ue!==le[0]),de=C.keepScrollPosition;C.keepScrollPosition=!0,C.items=se,ce&&(C.activeItems=ce),C.keepScrollPosition=de}break}}}}}))),G}}var __decorate$2=globalThis&&globalThis.__decorate||function(K,C,W,V){var U=arguments.length,G=U<3?C:V===null?V=Object.getOwnPropertyDescriptor(C,W):V,Z;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")G=Reflect.decorate(K,C,W,V);else for(var X=K.length-1;X>=0;X--)(Z=K[X])&&(G=(U<3?Z(G):U>3?Z(C,W,G):Z(C,W))||G);return U>3&&G&&Object.defineProperty(C,W,G),G},__param$2=globalThis&&globalThis.__param||function(K,C){return function(W,V){C(W,V,K)}},__awaiter$1=globalThis&&globalThis.__awaiter||function(K,C,W,V){function U(G){return G instanceof W?G:new W(function(Z){Z(G)})}return new(W||(W=Promise))(function(G,Z){function X(ee){try{J(V.next(ee))}catch(te){Z(te)}}function Q(ee){try{J(V.throw(ee))}catch(te){Z(te)}}function J(ee){ee.done?G(ee.value):U(ee.value).then(X,Q)}J((V=V.apply(K,C||[])).next())})},AbstractCommandsQuickAccessProvider_1,CommandsHistory_1;let AbstractCommandsQuickAccessProvider=AbstractCommandsQuickAccessProvider_1=class extends PickerQuickAccessProvider{constructor(C,W,V,U,G,Z){super(AbstractCommandsQuickAccessProvider_1.PREFIX,C),this.instantiationService=W,this.keybindingService=V,this.commandService=U,this.telemetryService=G,this.dialogService=Z,this.commandsHistory=this._register(this.instantiationService.createInstance(CommandsHistory)),this.options=C}_getPicks(C,W,V,U){var G,Z,X,Q;return __awaiter$1(this,void 0,void 0,function*(){const J=yield this.getCommandPicks(V);if(V.isCancellationRequested)return[];const ee=createSingleCallFunction(()=>{const se=new TfIdfCalculator;se.updateDocuments(J.map(ce=>({key:ce.commandId,textChunks:[ce.label+(ce.commandAlias?` ${ce.commandAlias}`:"")]})));const le=se.calculateScores(C,V);return normalizeTfIdfScores(le).filter(ce=>ce.score>AbstractCommandsQuickAccessProvider_1.TFIDF_THRESHOLD).slice(0,AbstractCommandsQuickAccessProvider_1.TFIDF_MAX_RESULTS)}),te=[];for(const se of J){const le=(G=AbstractCommandsQuickAccessProvider_1.WORD_FILTER(C,se.label))!==null&&G!==void 0?G:void 0,ce=se.commandAlias&&(Z=AbstractCommandsQuickAccessProvider_1.WORD_FILTER(C,se.commandAlias))!==null&&Z!==void 0?Z:void 0;if(le||ce)se.highlights={label:le,detail:this.options.showAlias?ce:void 0},te.push(se);else if(C===se.commandId)te.push(se);else if(C.length>=3){const de=ee();if(V.isCancellationRequested)return[];const ue=de.find(ge=>ge.key===se.commandId);ue&&(se.tfIdfScore=ue.score,te.push(se))}}const ie=new Map;for(const se of te){const le=ie.get(se.label);le?(se.description=se.commandId,le.description=le.commandId):ie.set(se.label,se)}te.sort((se,le)=>{if(se.tfIdfScore&&le.tfIdfScore)return se.tfIdfScore===le.tfIdfScore?se.label.localeCompare(le.label):le.tfIdfScore-se.tfIdfScore;if(se.tfIdfScore)return 1;if(le.tfIdfScore)return-1;const ce=this.commandsHistory.peek(se.commandId),de=this.commandsHistory.peek(le.commandId);if(ce&&de)return ce>de?-1:1;if(ce)return-1;if(de)return 1;if(this.options.suggestedCommandIds){const ue=this.options.suggestedCommandIds.has(se.commandId),ge=this.options.suggestedCommandIds.has(le.commandId);if(ue&&ge)return 0;if(ue)return-1;if(ge)return 1}return se.label.localeCompare(le.label)});const ne=[];let oe=!1,re=!0,ae=!!this.options.suggestedCommandIds;for(let se=0;se<te.length;se++){const le=te[se];se===0&&this.commandsHistory.peek(le.commandId)&&(ne.push({type:"separator",label:localize("recentlyUsed","recently used")}),oe=!0),re&&le.tfIdfScore!==void 0&&(ne.push({type:"separator",label:localize("suggested","similar commands")}),re=!1),ae&&le.tfIdfScore===void 0&&!this.commandsHistory.peek(le.commandId)&&(!((X=this.options.suggestedCommandIds)===null||X===void 0)&&X.has(le.commandId))&&(ne.push({type:"separator",label:localize("commonlyUsed","commonly used")}),oe=!0,ae=!1),oe&&le.tfIdfScore===void 0&&!this.commandsHistory.peek(le.commandId)&&!(!((Q=this.options.suggestedCommandIds)===null||Q===void 0)&&Q.has(le.commandId))&&(ne.push({type:"separator",label:localize("morecCommands","other commands")}),oe=!1),ne.push(this.toCommandPick(le,U))}return this.hasAdditionalCommandPicks(C,V)?{picks:ne,additionalPicks:(()=>__awaiter$1(this,void 0,void 0,function*(){var se;const le=yield this.getAdditionalCommandPicks(J,te,C,V);if(V.isCancellationRequested)return[];const ce=le.map(de=>this.toCommandPick(de,U));return re&&((se=ce[0])===null||se===void 0?void 0:se.type)!=="separator"&&ce.unshift({type:"separator",label:localize("suggested","similar commands")}),ce}))()}:ne})}toCommandPick(C,W){if(C.type==="separator")return C;const V=this.keybindingService.lookupKeybinding(C.commandId),U=V?localize("commandPickAriaLabelWithKeybinding","{0}, {1}",C.label,V.getAriaLabel()):C.label;return Object.assign(Object.assign({},C),{ariaLabel:U,detail:this.options.showAlias&&C.commandAlias!==C.label?C.commandAlias:void 0,keybinding:V,accept:()=>__awaiter$1(this,void 0,void 0,function*(){var G,Z;this.commandsHistory.push(C.commandId),this.telemetryService.publicLog2("workbenchActionExecuted",{id:C.commandId,from:(G=W==null?void 0:W.from)!==null&&G!==void 0?G:"quick open"});try{!((Z=C.args)===null||Z===void 0)&&Z.length?yield this.commandService.executeCommand(C.commandId,...C.args):yield this.commandService.executeCommand(C.commandId)}catch(X){isCancellationError(X)||this.dialogService.error(localize("canNotRun","Command '{0}' resulted in an error",C.label),toErrorMessage(X))}})})}};AbstractCommandsQuickAccessProvider.PREFIX=">";AbstractCommandsQuickAccessProvider.TFIDF_THRESHOLD=.5;AbstractCommandsQuickAccessProvider.TFIDF_MAX_RESULTS=5;AbstractCommandsQuickAccessProvider.WORD_FILTER=or$2(matchesPrefix,matchesWords,matchesContiguousSubString);AbstractCommandsQuickAccessProvider=AbstractCommandsQuickAccessProvider_1=__decorate$2([__param$2(1,IInstantiationService),__param$2(2,IKeybindingService),__param$2(3,ICommandService),__param$2(4,ITelemetryService),__param$2(5,IDialogService)],AbstractCommandsQuickAccessProvider);let CommandsHistory=CommandsHistory_1=class extends Disposable{constructor(C,W){super(),this.storageService=C,this.configurationService=W,this.configuredCommandsHistoryLength=0,this.updateConfiguration(),this.load(),this.registerListeners()}registerListeners(){this._register(this.configurationService.onDidChangeConfiguration(C=>this.updateConfiguration(C)))}updateConfiguration(C){C&&!C.affectsConfiguration("workbench.commandPalette.history")||(this.configuredCommandsHistoryLength=CommandsHistory_1.getConfiguredCommandHistoryLength(this.configurationService),CommandsHistory_1.cache&&CommandsHistory_1.cache.limit!==this.configuredCommandsHistoryLength&&(CommandsHistory_1.cache.limit=this.configuredCommandsHistoryLength,CommandsHistory_1.saveState(this.storageService)))}load(){const C=this.storageService.get(CommandsHistory_1.PREF_KEY_CACHE,0);let W;if(C)try{W=JSON.parse(C)}catch{}const V=CommandsHistory_1.cache=new LRUCache(this.configuredCommandsHistoryLength,1);if(W){let U;W.usesLRU?U=W.entries:U=W.entries.sort((G,Z)=>G.value-Z.value),U.forEach(G=>V.set(G.key,G.value))}CommandsHistory_1.counter=this.storageService.getNumber(CommandsHistory_1.PREF_KEY_COUNTER,0,CommandsHistory_1.counter)}push(C){CommandsHistory_1.cache&&(CommandsHistory_1.cache.set(C,CommandsHistory_1.counter++),CommandsHistory_1.saveState(this.storageService))}peek(C){var W;return(W=CommandsHistory_1.cache)===null||W===void 0?void 0:W.peek(C)}static saveState(C){if(!CommandsHistory_1.cache)return;const W={usesLRU:!0,entries:[]};CommandsHistory_1.cache.forEach((V,U)=>W.entries.push({key:U,value:V})),C.store(CommandsHistory_1.PREF_KEY_CACHE,JSON.stringify(W),0,0),C.store(CommandsHistory_1.PREF_KEY_COUNTER,CommandsHistory_1.counter,0,0)}static getConfiguredCommandHistoryLength(C){var W,V;const G=(V=(W=C.getValue().workbench)===null||W===void 0?void 0:W.commandPalette)===null||V===void 0?void 0:V.history;return typeof G=="number"?G:CommandsHistory_1.DEFAULT_COMMANDS_HISTORY_LENGTH}};CommandsHistory.DEFAULT_COMMANDS_HISTORY_LENGTH=50;CommandsHistory.PREF_KEY_CACHE="commandPalette.mru.cache";CommandsHistory.PREF_KEY_COUNTER="commandPalette.mru.counter";CommandsHistory.counter=1;CommandsHistory=CommandsHistory_1=__decorate$2([__param$2(0,IStorageService),__param$2(1,IConfigurationService)],CommandsHistory);class AbstractEditorCommandsQuickAccessProvider extends AbstractCommandsQuickAccessProvider{constructor(C,W,V,U,G,Z){super(C,W,V,U,G,Z)}getCodeEditorCommandPicks(){const C=this.activeTextEditorControl;if(!C)return[];const W=[];for(const V of C.getSupportedActions())W.push({commandId:V.id,commandAlias:V.alias,label:stripIcons(V.label)||V.id});return W}}var __decorate$1=globalThis&&globalThis.__decorate||function(K,C,W,V){var U=arguments.length,G=U<3?C:V===null?V=Object.getOwnPropertyDescriptor(C,W):V,Z;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")G=Reflect.decorate(K,C,W,V);else for(var X=K.length-1;X>=0;X--)(Z=K[X])&&(G=(U<3?Z(G):U>3?Z(C,W,G):Z(C,W))||G);return U>3&&G&&Object.defineProperty(C,W,G),G},__param$1=globalThis&&globalThis.__param||function(K,C){return function(W,V){C(W,V,K)}},__awaiter=globalThis&&globalThis.__awaiter||function(K,C,W,V){function U(G){return G instanceof W?G:new W(function(Z){Z(G)})}return new(W||(W=Promise))(function(G,Z){function X(ee){try{J(V.next(ee))}catch(te){Z(te)}}function Q(ee){try{J(V.throw(ee))}catch(te){Z(te)}}function J(ee){ee.done?G(ee.value):U(ee.value).then(X,Q)}J((V=V.apply(K,C||[])).next())})};let StandaloneCommandsQuickAccessProvider=class extends AbstractEditorCommandsQuickAccessProvider{get activeTextEditorControl(){var C;return(C=this.codeEditorService.getFocusedCodeEditor())!==null&&C!==void 0?C:void 0}constructor(C,W,V,U,G,Z){super({showAlias:!1},C,V,U,G,Z),this.codeEditorService=W}getCommandPicks(){return __awaiter(this,void 0,void 0,function*(){return this.getCodeEditorCommandPicks()})}hasAdditionalCommandPicks(){return!1}getAdditionalCommandPicks(){return __awaiter(this,void 0,void 0,function*(){return[]})}};StandaloneCommandsQuickAccessProvider=__decorate$1([__param$1(0,IInstantiationService),__param$1(1,ICodeEditorService),__param$1(2,IKeybindingService),__param$1(3,ICommandService),__param$1(4,ITelemetryService),__param$1(5,IDialogService)],StandaloneCommandsQuickAccessProvider);class GotoLineAction extends EditorAction{constructor(){super({id:GotoLineAction.ID,label:QuickCommandNLS.quickCommandActionLabel,alias:"Command Palette",precondition:void 0,kbOpts:{kbExpr:EditorContextKeys.focus,primary:59,weight:100},contextMenuOpts:{group:"z_commands",order:1}})}run(C){C.get(IQuickInputService).quickAccess.show(StandaloneCommandsQuickAccessProvider.PREFIX)}}GotoLineAction.ID="editor.action.quickCommand";registerEditorAction(GotoLineAction);Registry.as(Extensions$2.Quickaccess).registerQuickAccessProvider({ctor:StandaloneCommandsQuickAccessProvider,prefix:StandaloneCommandsQuickAccessProvider.PREFIX,helpEntries:[{description:QuickCommandNLS.quickCommandHelp,commandId:GotoLineAction.ID}]});var __decorate=globalThis&&globalThis.__decorate||function(K,C,W,V){var U=arguments.length,G=U<3?C:V===null?V=Object.getOwnPropertyDescriptor(C,W):V,Z;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")G=Reflect.decorate(K,C,W,V);else for(var X=K.length-1;X>=0;X--)(Z=K[X])&&(G=(U<3?Z(G):U>3?Z(C,W,G):Z(C,W))||G);return U>3&&G&&Object.defineProperty(C,W,G),G},__param=globalThis&&globalThis.__param||function(K,C){return function(W,V){C(W,V,K)}};let StandaloneReferencesController=class extends ReferencesController{constructor(C,W,V,U,G,Z,X){super(!0,C,W,V,U,G,Z,X)}};StandaloneReferencesController=__decorate([__param(1,IContextKeyService),__param(2,ICodeEditorService),__param(3,INotificationService),__param(4,IInstantiationService),__param(5,IStorageService),__param(6,IConfigurationService)],StandaloneReferencesController);registerEditorContribution(ReferencesController.ID,StandaloneReferencesController,4);class ToggleHighContrast extends EditorAction{constructor(){super({id:"editor.action.toggleHighContrast",label:ToggleHighContrastNLS.toggleHighContrast,alias:"Toggle High Contrast Theme",precondition:void 0}),this._originalThemeName=null}run(C,W){const V=C.get(IStandaloneThemeService),U=V.getColorTheme();isHighContrast(U.type)?(V.setTheme(this._originalThemeName||(isDark(U.type)?VS_DARK_THEME_NAME:VS_LIGHT_THEME_NAME)),this._originalThemeName=null):(V.setTheme(isDark(U.type)?HC_BLACK_THEME_NAME:HC_LIGHT_THEME_NAME),this._originalThemeName=U.themeName)}}registerEditorAction(ToggleHighContrast);const identity$2=K=>K,always$2=K=>()=>K;var Order;(function(K){K.LT="LT",K.EQ="EQ",K.GT="GT"})(Order||(Order={}));const compare=(K,C)=>K>C?Order.GT:K<C?Order.LT:Order.EQ,orderToNumber=K=>{switch(K){case Order.LT:return-1;case Order.EQ:return 0;case Order.GT:return 1}},curry$2=K=>function C(...W){return W.length>=K.length?K.apply(void 0,W):C.bind(void 0,...W)},NonEmptyListConstructor=K=>K,NonEmptyList=Object.assign(NonEmptyListConstructor,{fromArray:K=>NonEmptyList.isNonEmpty(K)?just(K):nothing,unsafeCoerce:K=>{if(NonEmptyList.isNonEmpty(K))return K;throw new Error("NonEmptyList#unsafeCoerce was ran on an empty array")},fromTuple:K=>NonEmptyList(K.toArray()),head:K=>K[0],last:K=>K[K.length-1],isNonEmpty:K=>K.length>0,tail:K=>K.slice(1)}),serializeValue=(K,C)=>typeof C=="bigint"?C.toString():C,isEmptySchema=K=>Object.keys(K).length===0,isObject$1=K=>typeof K=="object"&&K!==null&&!Array.isArray(K),reportError=(K,C)=>{let W="";switch(typeof C){case"undefined":W="undefined";break;case"object":W=C===null?"null":Array.isArray(C)?"an array with value "+JSON.stringify(C,serializeValue):"an object with value "+JSON.stringify(C,serializeValue);break;case"boolean":W="a boolean";break;case"symbol":W="a symbol";break;case"function":W="a function";break;case"bigint":W=`a bigint with value ${C.toString()}`}return W=W||`a ${typeof C} with value ${JSON.stringify(C,serializeValue)}`,`Expected ${K}, but received ${W}`},removeOneOfWithSingleElement=K=>{var W;return Object.keys(K).length===1&&((W=K.oneOf)==null?void 0:W.length)===1&&typeof K.oneOf[0]=="object"&&(Object.assign(K,K.oneOf[0]),delete K.oneOf),K},flattenNestedOneOf=K=>{if(Array.isArray(K.oneOf))for(let C=0;C<K.oneOf.length;C++){const W=K.oneOf[C];if(typeof W=="object"&&W.oneOf)return K.oneOf.splice(C,1),K.oneOf.push(...W.oneOf),optimizeSchema(K)}return K},optimizeSchema=K=>(flattenNestedOneOf(K),removeOneOfWithSingleElement(K),K),Codec={interface(K){const C=Object.keys(K),W=U=>{if(!isObject$1(U))return left(reportError("an object",U));const G={};for(const Z of C){if(!U.hasOwnProperty(Z)&&!K[Z]._isOptional)return left(`Problem with property "${Z}": it does not exist in received object ${JSON.stringify(U,serializeValue)}`);const X=K[Z].decode(U[Z]);if(X.isLeft())return left(`Problem with the value of property "${Z}": ${X.extract()}`);const Q=X.extract();Q!==void 0&&(G[Z]=Q)}return right(G)};return{decode:W,encode:U=>{const G={};for(const Z of C)G[Z]=K[Z].encode(U[Z]);return G},unsafeDecode:U=>W(U).mapLeft(Error).unsafeCoerce(),schema:()=>C.reduce((U,G)=>(K[G]._isOptional||U.required.push(G),U.properties[G]=optimizeSchema(K[G].schema()),U),{type:"object",properties:{},required:[]})}},custom({decode:K,encode:C,schema:W}){return{decode:K,encode:C,unsafeDecode:V=>K(V).mapLeft(Error).unsafeCoerce(),schema:W??(()=>({}))}}},string=Codec.custom({decode:K=>typeof K=="string"?right(K):left(reportError("a string",K)),encode:identity$2,schema:()=>({type:"string"})}),number=Codec.custom({decode:K=>typeof K=="number"?right(K):left(reportError("a number",K)),encode:identity$2,schema:()=>({type:"number"})}),nullType=Codec.custom({decode:K=>K===null?right(K):left(reportError("a null",K)),encode:identity$2,schema:()=>({type:"null"})}),undefinedType=Codec.custom({decode:K=>K===void 0?right(K):left(reportError("an undefined",K)),encode:identity$2}),optional=K=>({...oneOf([K,undefinedType]),schema:K.schema,_isOptional:!0}),nullable=K=>oneOf([K,nullType]),boolean=Codec.custom({decode:K=>typeof K=="boolean"?right(K):left(reportError("a boolean",K)),encode:identity$2,schema:()=>({type:"boolean"})}),unknown=Codec.custom({decode:right,encode:identity$2,schema:()=>({})}),enumeration=K=>{const C=Object.values(K);return Codec.custom({decode:W=>oneOf([string,number]).decode(W).chain(V=>{const U=C.indexOf(V);return U!==-1?right(C[U]):left(reportError("an enum member",W))}),encode:identity$2,schema:()=>({enum:C})})},oneOf=K=>Codec.custom({decode:C=>{let W=[];for(const V of K){const U=V.decode(C);if(U.isRight())return U;W.push(U.extract())}return left(`One of the following problems occured: ${W.map((V,U)=>`(${U}) ${V}`).join(", ")}`)},encode:C=>{for(const W of K)if(Either.encase(()=>W.encode(C)).mapLeft(U=>"").chain(W.decode).isRight())return W.encode(C);return C},schema:()=>({oneOf:K.map(C=>C.schema())})}),array=K=>Codec.custom({decode:C=>{if(Array.isArray(C)){const W=[];for(let V=0;V<C.length;V++){const U=K.decode(C[V]);if(U.isRight())W.push(U.extract());else return left(`Problem with the value at index ${V}: ${U.extract()}`)}return right(W)}else return left(reportError("an array",C))},encode:C=>C.map(K.encode),schema:()=>({type:"array",items:K.schema()})}),numberString=Codec.custom({decode:K=>string.decode(K).chain(C=>isFinite(+C)?right(C):left(reportError("a number",K))),encode:identity$2,schema:number.schema}),record=(K,C)=>Codec.custom({decode:W=>{const V={},U=K===number?numberString:K;if(!isObject$1(W))return left(reportError("an object",W));for(const G of Object.keys(W))if(W.hasOwnProperty(G)){const Z=U.decode(G),X=C.decode(W[G]);if(Z.isRight()&&X.isRight())V[Z.extract()]=X.extract();else{if(Z.isLeft())return left(`Problem with key type of property "${G}": ${Z.extract()}`);if(X.isLeft())return left(`Problem with the value of property "${G}": ${X.extract()}`)}}return right(V)},encode:W=>{const V={};for(const U in W)W.hasOwnProperty(U)&&(V[K.encode(U)]=C.encode(W[U]));return V},schema:()=>({type:"object",additionalProperties:C.schema()})}),exactly=(...K)=>Codec.custom({decode:C=>K.includes(C)?right(C):left(reportError(K.map(W=>JSON.stringify(W)).join(", "),C)),encode:identity$2,schema:()=>({oneOf:K.map(C=>({type:typeof C,enum:[C]}))})}),lazy=K=>Codec.custom({decode:C=>K().decode(C),encode:C=>K().encode(C),schema:()=>({$comment:"Lazy codecs are not supported when generating a JSON schema"})}),maybe=K=>({...Codec.custom({decode:W=>Maybe.fromNullable(W).caseOf({Just:V=>K.decode(V).map(just),Nothing:()=>right(nothing)}),encode:W=>W.map(K.encode).orDefault(void 0),schema:()=>isEmptySchema(K.schema())?{}:{oneOf:[K.schema(),{type:"null"}]}}),_isOptional:!0}),nonEmptyList=K=>{const C=array(K);return Codec.custom({decode:W=>C.decode(W).chain(V=>NonEmptyList.fromArray(V).toEither("Expected an array with one or more elements, but received an empty array")),encode:C.encode,schema:()=>({...C.schema(),minItems:1})})},tuple=K=>Codec.custom({decode:C=>{if(Array.isArray(C)){if(K.length!==C.length)return left(`Expected an array of length ${K.length}, but received an array with length of ${C.length}`);{const W=[];for(let V=0;V<K.length;V++){const U=K[V].decode(C[V]);if(U.isRight())W.push(U.extract());else return left(`Problem with the value at index ${V}: ${U.extract()}`)}return right(W)}}else return left(reportError("an array",C))},encode:C=>C.map((W,V)=>K[V].encode(W)),schema:()=>({type:"array",items:K.map(C=>C.schema()),additionalItems:!1,minItems:K.length,maxItems:K.length})}),date=Codec.custom({decode:K=>string.decode(K).mapLeft(C=>`Problem with date string: ${C}`).chain(C=>Number.isNaN(Date.parse(C))?left("Expected a valid date string, but received a string that cannot be parsed"):right(new Date(C))),encode:K=>K.toISOString(),schema:()=>({type:"string",format:"date-time"})}),intersect=(K,C)=>Codec.custom({decode:W=>{const V=K.decode(W);if(V.isLeft())return V;const U=C.decode(W);if(U.isLeft())return U;const G=V.extract(),Z=U.extract();return isObject$1(G)&&isObject$1(Z)?right(Object.assign(G,Z)):right(Z)},encode:W=>{const V=K.encode(W),U=C.encode(W);return isObject$1(V)&&isObject$1(U)?Object.assign(V,U):U},schema:()=>({allOf:[K,C].map(W=>W.schema())})}),map$3=(K,C)=>Codec.custom({decode:W=>array(tuple([K,C])).decode(W).map(V=>new Map(V)),encode:W=>Array.from(W.entries()).map(([V,U])=>[K.encode(V),C.encode(U)]),schema:()=>({type:"array",items:{type:"array",items:[K.schema(),C.schema()],additionalItems:!1,minItems:2,maxItems:2}})}),oneofRegex=/^(One of the following problems occured:)\s/,oneOfCounterRegex=/\(\d\)\s/,oneOfSeparatorRegex=/\, (?=\()/g,failureRegex=/^(Expected ).+(, but received )/,failureReceivedSeparator=" with value",missingPropertyMarker='Problem with property "',badPropertyMarker='Problem with the value of property "',badPropertyKeyMarker='Problem with key type of property "',dateFailureMarket="Problem with date string: ",indexMarker="Problem with the value at index ",expectedTypesMap={"an object":"object","a number":"number","a string":"string","an undefined":"undefined","a boolean":"boolean","an array":"array","a null":"null","an enum member":"enum"},receivedTypesMap={"a string":"string","a number":"number",null:"null",undefined:"undefined","a boolean":"boolean","an array":"array","an object":"object","a symbol":"symbol","a function":"function","a bigint":"bigint"},receivedTypesWithoutValue=["null","undefined","boolean","symbol","function","bigint"],parseError=K=>{const C=K.match(oneofRegex);if(C)return{type:"oneOf",errors:K.replace(C[0],"").split(oneOfSeparatorRegex).map(U=>parseError(U.replace(U.match(oneOfCounterRegex)[0],"")))};const W=K.match(failureRegex);if(W){const V=K.split(W[2]).pop(),U=receivedTypesMap[V.split(failureReceivedSeparator)[0]];if(U){const G=K.replace(W[1],"").split(W[2])[0];return{type:"failure",expectedType:expectedTypesMap[G],receivedType:U,receivedValue:receivedTypesWithoutValue.includes(U)?void 0:JSON.parse(V.split(failureReceivedSeparator).pop())}}}if(K.startsWith(missingPropertyMarker))return{type:"property",property:K.replace(missingPropertyMarker,"").split('": ')[0],error:{type:"failure",receivedType:"undefined"}};if(K.startsWith(badPropertyMarker)||K.startsWith(badPropertyKeyMarker)){const[V,...U]=K.replace(badPropertyMarker,"").replace(badPropertyKeyMarker,"").split(/": (.+)/);return{type:"property",property:V,error:parseError(U.join(""))}}if(K.startsWith(dateFailureMarket))return parseError(K.replace(dateFailureMarket,""));if(K.startsWith(indexMarker)){const[V,...U]=K.replace(indexMarker,"").split(/: (.+)/);return{type:"index",index:Number(V),error:parseError(U.join(""))}}return{type:"custom",message:K}};class TupleImpl{constructor(C,W){this.first=C,this.second=W,this.length=2,this["fantasy-land/equals"]=this.equals,this["fantasy-land/bimap"]=this.bimap,this["fantasy-land/map"]=this.map,this["fantasy-land/reduce"]=this.reduce,this["fantasy-land/ap"]=this.ap,this[0]=C,this[1]=W}*[Symbol.iterator](){yield this.first,yield this.second}toJSON(){return this.toArray()}inspect(){return`Tuple(${JSON.stringify(this.first)}, ${JSON.stringify(this.second)})`}toString(){return this.inspect()}fst(){return this.first}snd(){return this.second}equals(C){return this.first===C.fst()&&this.second===C.snd()}bimap(C,W){return Tuple(C(this.first),W(this.second))}mapFirst(C){return Tuple(C(this.first),this.second)}map(C){return Tuple(this.first,C(this.second))}reduce(C,W){return C(W,this.second)}toArray(){return[this.first,this.second]}swap(){return Tuple(this.second,this.first)}ap(C){return Tuple(this.first,C.snd()(this.second))}every(C){return C(this.first)&&C(this.second)}some(C){return C(this.first)||C(this.second)}}const Tuple=Object.assign((K,C)=>new TupleImpl(K,C),{fromArray:([K,C])=>Tuple(K,C),fanout:(...K)=>{const[C,W,V]=K;switch(K.length){case 3:return Tuple(C(V),W(V));case 2:return U=>Tuple.fanout(C,W,U);default:return U=>G=>Tuple.fanout(C,U,G)}}});TupleImpl.prototype.constructor=Tuple;const head$2=K=>K.length>0?just(K[0]):nothing,last$2=K=>K.length>0?just(K[K.length-1]):nothing,tail$2=K=>K.length>0?just(K.slice(1)):nothing,init$2=K=>K.length>0?just(K.slice(0,-1)):nothing,uncons=K=>K.length>0?just(Tuple(K[0],K.slice(1))):nothing,sum$2=K=>K.reduce((C,W)=>C+W,0);function find$2(K,C){switch(arguments.length){case 1:return W=>find$2(K,W);default:return Maybe.fromNullable(C.find(K))}}function findIndex$2(K,C){switch(arguments.length){case 1:return W=>findIndex$2(K,W);default:return Maybe.fromPredicate(W=>W!==-1,C.findIndex(K))}}function at(K,C){switch(arguments.length){case 1:return W=>at(K,W);default:return C[K]===void 0?nothing:just(C[K])}}function sort$2(K,C){switch(arguments.length){case 1:return W=>sort$2(K,W);default:return[...C].sort((W,V)=>orderToNumber(K(W,V)))}}const List={init:init$2,uncons,at,head:head$2,last:last$2,tail:tail$2,find:find$2,findIndex:findIndex$2,sum:sum$2,sort:sort$2},P=Object.freeze(Object.defineProperty({__proto__:null,Codec,Either,EitherAsync,Just:just,Left:left,List,Maybe,MaybeAsync,NonEmptyList,Nothing:nothing,get Order(){return Order},Right:right,Tuple,always:always$2,array,boolean,compare,curry:curry$2,date,enumeration,exactly,identity:identity$2,intersect,lazy,map:map$3,maybe,nonEmptyList,nullType,nullable,number,oneOf,optional,orderToNumber,parseError,record,string,tuple,unknown},Symbol.toStringTag,{value:"Module"}));var F=function(){return!1};const F$1=F;var T=function(){return!0};const T$1=T,__={"@@functional/placeholder":!0};function _isPlaceholder(K){return K!=null&&typeof K=="object"&&K["@@functional/placeholder"]===!0}function _curry1(K){return function C(W){return arguments.length===0||_isPlaceholder(W)?C:K.apply(this,arguments)}}function _curry2(K){return function C(W,V){switch(arguments.length){case 0:return C;case 1:return _isPlaceholder(W)?C:_curry1(function(U){return K(W,U)});default:return _isPlaceholder(W)&&_isPlaceholder(V)?C:_isPlaceholder(W)?_curry1(function(U){return K(U,V)}):_isPlaceholder(V)?_curry1(function(U){return K(W,U)}):K(W,V)}}}var add=_curry2(function(C,W){return Number(C)+Number(W)});const add$1=add;function _concat(K,C){K=K||[],C=C||[];var W,V=K.length,U=C.length,G=[];for(W=0;W<V;)G[G.length]=K[W],W+=1;for(W=0;W<U;)G[G.length]=C[W],W+=1;return G}function _arity(K,C){switch(K){case 0:return function(){return C.apply(this,arguments)};case 1:return function(W){return C.apply(this,arguments)};case 2:return function(W,V){return C.apply(this,arguments)};case 3:return function(W,V,U){return C.apply(this,arguments)};case 4:return function(W,V,U,G){return C.apply(this,arguments)};case 5:return function(W,V,U,G,Z){return C.apply(this,arguments)};case 6:return function(W,V,U,G,Z,X){return C.apply(this,arguments)};case 7:return function(W,V,U,G,Z,X,Q){return C.apply(this,arguments)};case 8:return function(W,V,U,G,Z,X,Q,J){return C.apply(this,arguments)};case 9:return function(W,V,U,G,Z,X,Q,J,ee){return C.apply(this,arguments)};case 10:return function(W,V,U,G,Z,X,Q,J,ee,te){return C.apply(this,arguments)};default:throw new Error("First argument to _arity must be a non-negative integer no greater than ten")}}function _curryN(K,C,W){return function(){for(var V=[],U=0,G=K,Z=0,X=!1;Z<C.length||U<arguments.length;){var Q;Z<C.length&&(!_isPlaceholder(C[Z])||U>=arguments.length)?Q=C[Z]:(Q=arguments[U],U+=1),V[Z]=Q,_isPlaceholder(Q)?X=!0:G-=1,Z+=1}return!X&&G<=0?W.apply(this,V):_arity(Math.max(0,G),_curryN(K,V,W))}}var curryN=_curry2(function(C,W){return C===1?_curry1(W):_arity(C,_curryN(C,[],W))});const curryN$1=curryN;var addIndex=_curry1(function(C){return curryN$1(C.length,function(){var W=0,V=arguments[0],U=arguments[arguments.length-1],G=Array.prototype.slice.call(arguments,0);return G[0]=function(){var Z=V.apply(this,_concat(arguments,[W,U]));return W+=1,Z},C.apply(this,G)})});const addIndex$1=addIndex;var addIndexRight=_curry1(function(C){return curryN$1(C.length,function(){var W=arguments[0],V=arguments[arguments.length-1],U=V.length-1,G=Array.prototype.slice.call(arguments,0);return G[0]=function(){var Z=W.apply(this,_concat(arguments,[U,V]));return U-=1,Z},C.apply(this,G)})});const addIndexRight$1=addIndexRight;function _curry3(K){return function C(W,V,U){switch(arguments.length){case 0:return C;case 1:return _isPlaceholder(W)?C:_curry2(function(G,Z){return K(W,G,Z)});case 2:return _isPlaceholder(W)&&_isPlaceholder(V)?C:_isPlaceholder(W)?_curry2(function(G,Z){return K(G,V,Z)}):_isPlaceholder(V)?_curry2(function(G,Z){return K(W,G,Z)}):_curry1(function(G){return K(W,V,G)});default:return _isPlaceholder(W)&&_isPlaceholder(V)&&_isPlaceholder(U)?C:_isPlaceholder(W)&&_isPlaceholder(V)?_curry2(function(G,Z){return K(G,Z,U)}):_isPlaceholder(W)&&_isPlaceholder(U)?_curry2(function(G,Z){return K(G,V,Z)}):_isPlaceholder(V)&&_isPlaceholder(U)?_curry2(function(G,Z){return K(W,G,Z)}):_isPlaceholder(W)?_curry1(function(G){return K(G,V,U)}):_isPlaceholder(V)?_curry1(function(G){return K(W,G,U)}):_isPlaceholder(U)?_curry1(function(G){return K(W,V,G)}):K(W,V,U)}}}var adjust=_curry3(function(C,W,V){var U=V.length;if(C>=U||C<-U)return V;var G=(U+C)%U,Z=_concat(V);return Z[G]=W(V[G]),Z});const adjust$1=adjust,_isArray=Array.isArray||function(C){return C!=null&&C.length>=0&&Object.prototype.toString.call(C)==="[object Array]"};function _isTransformer(K){return K!=null&&typeof K["@@transducer/step"]=="function"}function _dispatchable(K,C,W){return function(){if(arguments.length===0)return W();var V=arguments[arguments.length-1];if(!_isArray(V)){for(var U=0;U<K.length;){if(typeof V[K[U]]=="function")return V[K[U]].apply(V,Array.prototype.slice.call(arguments,0,-1));U+=1}if(_isTransformer(V)){var G=C.apply(null,Array.prototype.slice.call(arguments,0,-1));return G(V)}}return W.apply(this,arguments)}}function _reduced(K){return K&&K["@@transducer/reduced"]?K:{"@@transducer/value":K,"@@transducer/reduced":!0}}const _xfBase={init:function(){return this.xf["@@transducer/init"]()},result:function(K){return this.xf["@@transducer/result"](K)}};var XAll=function(){function K(C,W){this.xf=W,this.f=C,this.all=!0}return K.prototype["@@transducer/init"]=_xfBase.init,K.prototype["@@transducer/result"]=function(C){return this.all&&(C=this.xf["@@transducer/step"](C,!0)),this.xf["@@transducer/result"](C)},K.prototype["@@transducer/step"]=function(C,W){return this.f(W)||(this.all=!1,C=_reduced(this.xf["@@transducer/step"](C,!1))),C},K}();function _xall(K){return function(C){return new XAll(K,C)}}var all=_curry2(_dispatchable(["all"],_xall,function(C,W){for(var V=0;V<W.length;){if(!C(W[V]))return!1;V+=1}return!0}));const all$1=all;function _arrayFromIterator(K){for(var C=[],W;!(W=K.next()).done;)C.push(W.value);return C}function _includesWith(K,C,W){for(var V=0,U=W.length;V<U;){if(K(C,W[V]))return!0;V+=1}return!1}function _functionName(K){var C=String(K).match(/^function (\w*)/);return C==null?"":C[1]}function _has(K,C){return Object.prototype.hasOwnProperty.call(C,K)}function _objectIs(K,C){return K===C?K!==0||1/K===1/C:K!==K&&C!==C}const _objectIs$1=typeof Object.is=="function"?Object.is:_objectIs;var toString$3=Object.prototype.toString,_isArguments=function(){return toString$3.call(arguments)==="[object Arguments]"?function(C){return toString$3.call(C)==="[object Arguments]"}:function(C){return _has("callee",C)}}();const _isArguments$1=_isArguments;var hasEnumBug=!{toString:null}.propertyIsEnumerable("toString"),nonEnumerableProps=["constructor","valueOf","isPrototypeOf","toString","propertyIsEnumerable","hasOwnProperty","toLocaleString"],hasArgsEnumBug=function(){return arguments.propertyIsEnumerable("length")}(),contains=function(C,W){for(var V=0;V<C.length;){if(C[V]===W)return!0;V+=1}return!1},keys=_curry1(typeof Object.keys=="function"&&!hasArgsEnumBug?function(C){return Object(C)!==C?[]:Object.keys(C)}:function(C){if(Object(C)!==C)return[];var W,V,U=[],G=hasArgsEnumBug&&_isArguments$1(C);for(W in C)_has(W,C)&&(!G||W!=="length")&&(U[U.length]=W);if(hasEnumBug)for(V=nonEnumerableProps.length-1;V>=0;)W=nonEnumerableProps[V],_has(W,C)&&!contains(U,W)&&(U[U.length]=W),V-=1;return U});const keys$1=keys;var type$1=_curry1(function(C){return C===null?"Null":C===void 0?"Undefined":Object.prototype.toString.call(C).slice(8,-1)});const type$2=type$1;function _uniqContentEquals(K,C,W,V){var U=_arrayFromIterator(K),G=_arrayFromIterator(C);function Z(X,Q){return _equals(X,Q,W.slice(),V.slice())}return!_includesWith(function(X,Q){return!_includesWith(Z,Q,X)},G,U)}function _equals(K,C,W,V){if(_objectIs$1(K,C))return!0;var U=type$2(K);if(U!==type$2(C))return!1;if(typeof K["fantasy-land/equals"]=="function"||typeof C["fantasy-land/equals"]=="function")return typeof K["fantasy-land/equals"]=="function"&&K["fantasy-land/equals"](C)&&typeof C["fantasy-land/equals"]=="function"&&C["fantasy-land/equals"](K);if(typeof K.equals=="function"||typeof C.equals=="function")return typeof K.equals=="function"&&K.equals(C)&&typeof C.equals=="function"&&C.equals(K);switch(U){case"Arguments":case"Array":case"Object":if(typeof K.constructor=="function"&&_functionName(K.constructor)==="Promise")return K===C;break;case"Boolean":case"Number":case"String":if(!(typeof K==typeof C&&_objectIs$1(K.valueOf(),C.valueOf())))return!1;break;case"Date":if(!_objectIs$1(K.valueOf(),C.valueOf()))return!1;break;case"Error":return K.name===C.name&&K.message===C.message;case"RegExp":if(!(K.source===C.source&&K.global===C.global&&K.ignoreCase===C.ignoreCase&&K.multiline===C.multiline&&K.sticky===C.sticky&&K.unicode===C.unicode))return!1;break}for(var G=W.length-1;G>=0;){if(W[G]===K)return V[G]===C;G-=1}switch(U){case"Map":return K.size!==C.size?!1:_uniqContentEquals(K.entries(),C.entries(),W.concat([K]),V.concat([C]));case"Set":return K.size!==C.size?!1:_uniqContentEquals(K.values(),C.values(),W.concat([K]),V.concat([C]));case"Arguments":case"Array":case"Object":case"Boolean":case"Number":case"String":case"Date":case"Error":case"RegExp":case"Int8Array":case"Uint8Array":case"Uint8ClampedArray":case"Int16Array":case"Uint16Array":case"Int32Array":case"Uint32Array":case"Float32Array":case"Float64Array":case"ArrayBuffer":break;default:return!1}var Z=keys$1(K);if(Z.length!==keys$1(C).length)return!1;var X=W.concat([K]),Q=V.concat([C]);for(G=Z.length-1;G>=0;){var J=Z[G];if(!(_has(J,C)&&_equals(C[J],K[J],X,Q)))return!1;G-=1}return!0}var equals$1=_curry2(function(C,W){return _equals(C,W,[],[])});const equals$2=equals$1;function _indexOf(K,C,W){var V,U;if(typeof K.indexOf=="function")switch(typeof C){case"number":if(C===0){for(V=1/C;W<K.length;){if(U=K[W],U===0&&1/U===V)return W;W+=1}return-1}else if(C!==C){for(;W<K.length;){if(U=K[W],typeof U=="number"&&U!==U)return W;W+=1}return-1}return K.indexOf(C,W);case"string":case"boolean":case"function":case"undefined":return K.indexOf(C,W);case"object":if(C===null)return K.indexOf(C,W)}for(;W<K.length;){if(equals$2(K[W],C))return W;W+=1}return-1}function _includes(K,C){return _indexOf(C,K,0)>=0}function _map(K,C){for(var W=0,V=C.length,U=Array(V);W<V;)U[W]=K(C[W]),W+=1;return U}function _quote(K){var C=K.replace(/\\/g,"\\\\").replace(/[\b]/g,"\\b").replace(/\f/g,"\\f").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/\t/g,"\\t").replace(/\v/g,"\\v").replace(/\0/g,"\\0");return'"'+C.replace(/"/g,'\\"')+'"'}var pad=function(C){return(C<10?"0":"")+C},_toISOString=typeof Date.prototype.toISOString=="function"?function(C){return C.toISOString()}:function(C){return C.getUTCFullYear()+"-"+pad(C.getUTCMonth()+1)+"-"+pad(C.getUTCDate())+"T"+pad(C.getUTCHours())+":"+pad(C.getUTCMinutes())+":"+pad(C.getUTCSeconds())+"."+(C.getUTCMilliseconds()/1e3).toFixed(3).slice(2,5)+"Z"};const _toISOString$1=_toISOString;function _complement(K){return function(){return!K.apply(this,arguments)}}function _arrayReduce(K,C,W){for(var V=0,U=W.length;V<U;)C=K(C,W[V]),V+=1;return C}function _filter(K,C){for(var W=0,V=C.length,U=[];W<V;)K(C[W])&&(U[U.length]=C[W]),W+=1;return U}function _isObject(K){return Object.prototype.toString.call(K)==="[object Object]"}var XFilter=function(){function K(C,W){this.xf=W,this.f=C}return K.prototype["@@transducer/init"]=_xfBase.init,K.prototype["@@transducer/result"]=_xfBase.result,K.prototype["@@transducer/step"]=function(C,W){return this.f(W)?this.xf["@@transducer/step"](C,W):C},K}();function _xfilter(K){return function(C){return new XFilter(K,C)}}var filter=_curry2(_dispatchable(["fantasy-land/filter","filter"],_xfilter,function(K,C){return _isObject(C)?_arrayReduce(function(W,V){return K(C[V])&&(W[V]=C[V]),W},{},keys$1(C)):_filter(K,C)}));const filter$1=filter;var reject=_curry2(function(C,W){return filter$1(_complement(C),W)});const reject$1=reject;function _toString(K,C){var W=function(Z){var X=C.concat([K]);return _includes(Z,X)?"<Circular>":_toString(Z,X)},V=function(G,Z){return _map(function(X){return _quote(X)+": "+W(G[X])},Z.slice().sort())};switch(Object.prototype.toString.call(K)){case"[object Arguments]":return"(function() { return arguments; }("+_map(W,K).join(", ")+"))";case"[object Array]":return"["+_map(W,K).concat(V(K,reject$1(function(G){return/^\d+$/.test(G)},keys$1(K)))).join(", ")+"]";case"[object Boolean]":return typeof K=="object"?"new Boolean("+W(K.valueOf())+")":K.toString();case"[object Date]":return"new Date("+(isNaN(K.valueOf())?W(NaN):_quote(_toISOString$1(K)))+")";case"[object Map]":return"new Map("+W(Array.from(K))+")";case"[object Null]":return"null";case"[object Number]":return typeof K=="object"?"new Number("+W(K.valueOf())+")":1/K===-1/0?"-0":K.toString(10);case"[object Set]":return"new Set("+W(Array.from(K).sort())+")";case"[object String]":return typeof K=="object"?"new String("+W(K.valueOf())+")":_quote(K);case"[object Undefined]":return"undefined";default:if(typeof K.toString=="function"){var U=K.toString();if(U!=="[object Object]")return U}return"{"+V(K,keys$1(K)).join(", ")+"}"}}var toString$1=_curry1(function(C){return _toString(C,[])});const toString$2=toString$1;var max=_curry2(function(C,W){if(C===W)return W;function V(Q,J){if(Q>J!=J>Q)return J>Q?J:Q}var U=V(C,W);if(U!==void 0)return U;var G=V(typeof C,typeof W);if(G!==void 0)return G===typeof C?C:W;var Z=toString$2(C),X=V(Z,toString$2(W));return X!==void 0&&X===Z?C:W});const max$1=max;var XMap=function(){function K(C,W){this.xf=W,this.f=C}return K.prototype["@@transducer/init"]=_xfBase.init,K.prototype["@@transducer/result"]=_xfBase.result,K.prototype["@@transducer/step"]=function(C,W){return this.xf["@@transducer/step"](C,this.f(W))},K}(),_xmap=function(C){return function(W){return new XMap(C,W)}};const _xmap$1=_xmap;var map$1=_curry2(_dispatchable(["fantasy-land/map","map"],_xmap$1,function(C,W){switch(Object.prototype.toString.call(W)){case"[object Function]":return curryN$1(W.length,function(){return C.call(this,W.apply(this,arguments))});case"[object Object]":return _arrayReduce(function(V,U){return V[U]=C(W[U]),V},{},keys$1(W));default:return _map(C,W)}}));const map$2=map$1,_isInteger=Number.isInteger||function(C){return C<<0===C};function _isString(K){return Object.prototype.toString.call(K)==="[object String]"}var nth=_curry2(function(C,W){var V=C<0?W.length+C:C;return _isString(W)?W.charAt(V):W[V]});const nth$1=nth;var prop=_curry2(function(C,W){if(W!=null)return _isInteger(C)?nth$1(C,W):W[C]});const prop$1=prop;var pluck=_curry2(function(C,W){return map$2(prop$1(C),W)});const pluck$1=pluck;var _isArrayLike=_curry1(function(C){return _isArray(C)?!0:!C||typeof C!="object"||_isString(C)?!1:C.length===0?!0:C.length>0?C.hasOwnProperty(0)&&C.hasOwnProperty(C.length-1):!1});const _isArrayLike$1=_isArrayLike;var symIterator=typeof Symbol<"u"?Symbol.iterator:"@@iterator";function _createReduce(K,C,W){return function(U,G,Z){if(_isArrayLike$1(Z))return K(U,G,Z);if(Z==null)return G;if(typeof Z["fantasy-land/reduce"]=="function")return C(U,G,Z,"fantasy-land/reduce");if(Z[symIterator]!=null)return W(U,G,Z[symIterator]());if(typeof Z.next=="function")return W(U,G,Z);if(typeof Z.reduce=="function")return C(U,G,Z,"reduce");throw new TypeError("reduce: list must be array or iterable")}}function _xArrayReduce(K,C,W){for(var V=0,U=W.length;V<U;){if(C=K["@@transducer/step"](C,W[V]),C&&C["@@transducer/reduced"]){C=C["@@transducer/value"];break}V+=1}return K["@@transducer/result"](C)}var bind=_curry2(function(C,W){return _arity(C.length,function(){return C.apply(W,arguments)})});const bind$1=bind;function _xIterableReduce(K,C,W){for(var V=W.next();!V.done;){if(C=K["@@transducer/step"](C,V.value),C&&C["@@transducer/reduced"]){C=C["@@transducer/value"];break}V=W.next()}return K["@@transducer/result"](C)}function _xMethodReduce(K,C,W,V){return K["@@transducer/result"](W[V](bind$1(K["@@transducer/step"],K),C))}var _xReduce=_createReduce(_xArrayReduce,_xMethodReduce,_xIterableReduce);const _xReduce$1=_xReduce;var XWrap=function(){function K(C){this.f=C}return K.prototype["@@transducer/init"]=function(){throw new Error("init not implemented on XWrap")},K.prototype["@@transducer/result"]=function(C){return C},K.prototype["@@transducer/step"]=function(C,W){return this.f(C,W)},K}();function _xwrap(K){return new XWrap(K)}var reduce=_curry3(function(K,C,W){return _xReduce$1(typeof K=="function"?_xwrap(K):K,C,W)});const reduce$1=reduce;var allPass=_curry1(function(C){return curryN$1(reduce$1(max$1,0,pluck$1("length",C)),function(){for(var W=0,V=C.length;W<V;){if(!C[W].apply(this,arguments))return!1;W+=1}return!0})});const allPass$1=allPass;var always=_curry1(function(C){return function(){return C}});const always$1=always;var and=_curry2(function(C,W){return C&&W});const and$1=and;var XAny=function(){function K(C,W){this.xf=W,this.f=C,this.any=!1}return K.prototype["@@transducer/init"]=_xfBase.init,K.prototype["@@transducer/result"]=function(C){return this.any||(C=this.xf["@@transducer/step"](C,!1)),this.xf["@@transducer/result"](C)},K.prototype["@@transducer/step"]=function(C,W){return this.f(W)&&(this.any=!0,C=_reduced(this.xf["@@transducer/step"](C,!0))),C},K}();function _xany(K){return function(C){return new XAny(K,C)}}var any=_curry2(_dispatchable(["any"],_xany,function(C,W){for(var V=0;V<W.length;){if(C(W[V]))return!0;V+=1}return!1}));const any$1=any;var anyPass=_curry1(function(C){return curryN$1(reduce$1(max$1,0,pluck$1("length",C)),function(){for(var W=0,V=C.length;W<V;){if(C[W].apply(this,arguments))return!0;W+=1}return!1})});const anyPass$1=anyPass;function _iterableReduce(K,C,W){for(var V=W.next();!V.done;)C=K(C,V.value),V=W.next();return C}function _methodReduce(K,C,W,V){return W[V](K,C)}var _reduce=_createReduce(_arrayReduce,_methodReduce,_iterableReduce);const _reduce$1=_reduce;var ap$3=_curry2(function(C,W){return typeof W["fantasy-land/ap"]=="function"?W["fantasy-land/ap"](C):typeof C.ap=="function"?C.ap(W):typeof C=="function"?function(V){return C(V)(W(V))}:_reduce$1(function(V,U){return _concat(V,map$2(U,W))},[],C)});const ap$4=ap$3;function _aperture(K,C){for(var W=0,V=C.length-(K-1),U=new Array(V>=0?V:0);W<V;)U[W]=Array.prototype.slice.call(C,W,W+K),W+=1;return U}var XAperture=function(){function K(C,W){this.xf=W,this.pos=0,this.full=!1,this.acc=new Array(C)}return K.prototype["@@transducer/init"]=_xfBase.init,K.prototype["@@transducer/result"]=function(C){return this.acc=null,this.xf["@@transducer/result"](C)},K.prototype["@@transducer/step"]=function(C,W){return this.store(W),this.full?this.xf["@@transducer/step"](C,this.getCopy()):C},K.prototype.store=function(C){this.acc[this.pos]=C,this.pos+=1,this.pos===this.acc.length&&(this.pos=0,this.full=!0)},K.prototype.getCopy=function(){return _concat(Array.prototype.slice.call(this.acc,this.pos),Array.prototype.slice.call(this.acc,0,this.pos))},K}();function _xaperture(K){return function(C){return new XAperture(K,C)}}var aperture=_curry2(_dispatchable([],_xaperture,_aperture));const aperture$1=aperture;var append=_curry2(function(C,W){return _concat(W,[C])});const append$1=append;var apply=_curry2(function(C,W){return C.apply(this,W)});const apply$1=apply;var values=_curry1(function(C){for(var W=keys$1(C),V=W.length,U=[],G=0;G<V;)U[G]=C[W[G]],G+=1;return U});const values$1=values;function mapValues(K,C){return _isArray(C)?C.map(K):keys$1(C).reduce(function(W,V){return W[V]=K(C[V]),W},{})}var applySpec=_curry1(function K(C){return C=mapValues(function(W){return typeof W=="function"?W:K(W)},C),curryN$1(reduce$1(max$1,0,pluck$1("length",values$1(C))),function(){var W=arguments;return mapValues(function(V){return apply$1(V,W)},C)})});const applySpec$1=applySpec;var applyTo=_curry2(function(C,W){return W(C)});const applyTo$1=applyTo;var ascend=_curry3(function(C,W,V){var U=C(W),G=C(V);return U<G?-1:U>G?1:0});const ascend$1=ascend;function _assoc(K,C,W){if(_isInteger(K)&&_isArray(W)){var V=[].concat(W);return V[K]=C,V}var U={};for(var G in W)U[G]=W[G];return U[K]=C,U}var isNil=_curry1(function(C){return C==null});const isNil$1=isNil;var assocPath=_curry3(function K(C,W,V){if(C.length===0)return W;var U=C[0];if(C.length>1){var G=!isNil$1(V)&&_has(U,V)&&typeof V[U]=="object"?V[U]:_isInteger(C[1])?[]:{};W=K(Array.prototype.slice.call(C,1),W,G)}return _assoc(U,W,V)});const assocPath$1=assocPath;var assoc=_curry3(function(C,W,V){return assocPath$1([C],W,V)});const assoc$1=assoc;var nAry=_curry2(function(C,W){switch(C){case 0:return function(){return W.call(this)};case 1:return function(V){return W.call(this,V)};case 2:return function(V,U){return W.call(this,V,U)};case 3:return function(V,U,G){return W.call(this,V,U,G)};case 4:return function(V,U,G,Z){return W.call(this,V,U,G,Z)};case 5:return function(V,U,G,Z,X){return W.call(this,V,U,G,Z,X)};case 6:return function(V,U,G,Z,X,Q){return W.call(this,V,U,G,Z,X,Q)};case 7:return function(V,U,G,Z,X,Q,J){return W.call(this,V,U,G,Z,X,Q,J)};case 8:return function(V,U,G,Z,X,Q,J,ee){return W.call(this,V,U,G,Z,X,Q,J,ee)};case 9:return function(V,U,G,Z,X,Q,J,ee,te){return W.call(this,V,U,G,Z,X,Q,J,ee,te)};case 10:return function(V,U,G,Z,X,Q,J,ee,te,ie){return W.call(this,V,U,G,Z,X,Q,J,ee,te,ie)};default:throw new Error("First argument to nAry must be a non-negative integer no greater than ten")}});const nAry$1=nAry;var binary=_curry1(function(C){return nAry$1(2,C)});const binary$1=binary;function _isFunction(K){var C=Object.prototype.toString.call(K);return C==="[object Function]"||C==="[object AsyncFunction]"||C==="[object GeneratorFunction]"||C==="[object AsyncGeneratorFunction]"}var liftN=_curry2(function(C,W){var V=curryN$1(C,W);return curryN$1(C,function(){return _arrayReduce(ap$4,map$2(V,arguments[0]),Array.prototype.slice.call(arguments,1))})});const liftN$1=liftN;var lift=_curry1(function(C){return liftN$1(C.length,C)});const lift$1=lift;var both=_curry2(function(C,W){return _isFunction(C)?function(){return C.apply(this,arguments)&&W.apply(this,arguments)}:lift$1(and$1)(C,W)});const both$1=both;var call=_curry1(function(C){return C.apply(this,Array.prototype.slice.call(arguments,1))});const call$1=call;function _makeFlat$1(K){return function C(W){for(var V,U,G,Z=[],X=0,Q=W.length;X<Q;){if(_isArrayLike$1(W[X]))for(V=K?C(W[X]):W[X],G=0,U=V.length;G<U;)Z[Z.length]=V[G],G+=1;else Z[Z.length]=W[X];X+=1}return Z}}function _forceReduced(K){return{"@@transducer/value":K,"@@transducer/reduced":!0}}var tInit$1="@@transducer/init",tStep$1="@@transducer/step",tResult="@@transducer/result",XPreservingReduced=function(){function K(C){this.xf=C}return K.prototype[tInit$1]=_xfBase.init,K.prototype[tResult]=_xfBase.result,K.prototype[tStep$1]=function(C,W){var V=this.xf[tStep$1](C,W);return V["@@transducer/reduced"]?_forceReduced(V):V},K}(),XFlatCat=function(){function K(C){this.xf=new XPreservingReduced(C)}return K.prototype[tInit$1]=_xfBase.init,K.prototype[tResult]=_xfBase.result,K.prototype[tStep$1]=function(C,W){return _isArrayLike$1(W)?_xReduce$1(this.xf,C,W):_xArrayReduce(this.xf,C,[W])},K}(),_flatCat=function(C){return new XFlatCat(C)};const _flatCat$1=_flatCat;function _xchain(K){return function(C){return _xmap$1(K)(_flatCat$1(C))}}var chain$1=_curry2(_dispatchable(["fantasy-land/chain","chain"],_xchain,function(C,W){return typeof W=="function"?function(V){return C(W(V))(V)}:_makeFlat$1(!1)(map$2(C,W))}));const chain$2=chain$1;var clamp=_curry3(function(C,W,V){if(C>W)throw new Error("min must not be greater than max in clamp(min, max, value)");return V<C?C:V>W?W:V});const clamp$1=clamp;function _cloneRegExp(K){return new RegExp(K.source,K.flags?K.flags:(K.global?"g":"")+(K.ignoreCase?"i":"")+(K.multiline?"m":"")+(K.sticky?"y":"")+(K.unicode?"u":"")+(K.dotAll?"s":""))}function _clone(K,C,W){if(W||(W=new _ObjectMap),_isPrimitive(K))return K;var V=function(G){var Z=W.get(K);if(Z)return Z;W.set(K,G);for(var X in K)Object.prototype.hasOwnProperty.call(K,X)&&(G[X]=C?_clone(K[X],!0,W):K[X]);return G};switch(type$2(K)){case"Object":return V(Object.create(Object.getPrototypeOf(K)));case"Array":return V([]);case"Date":return new Date(K.valueOf());case"RegExp":return _cloneRegExp(K);case"Int8Array":case"Uint8Array":case"Uint8ClampedArray":case"Int16Array":case"Uint16Array":case"Int32Array":case"Uint32Array":case"Float32Array":case"Float64Array":case"BigInt64Array":case"BigUint64Array":return K.slice();default:return K}}function _isPrimitive(K){var C=typeof K;return K==null||C!="object"&&C!="function"}var _ObjectMap=function(){function K(){this.map={},this.length=0}return K.prototype.set=function(C,W){const V=this.hash(C);let U=this.map[V];U||(this.map[V]=U=[]),U.push([C,W]),this.length+=1},K.prototype.hash=function(C){let W=[];for(var V in C)W.push(Object.prototype.toString.call(C[V]));return W.join()},K.prototype.get=function(C){if(this.length<=180){for(const U in this.map){const G=this.map[U];for(let Z=0;Z<G.length;Z+=1){const X=G[Z];if(X[0]===C)return X[1]}}return}const W=this.hash(C),V=this.map[W];if(V)for(let U=0;U<V.length;U+=1){const G=V[U];if(G[0]===C)return G[1]}},K}(),clone=_curry1(function(C){return C!=null&&typeof C.clone=="function"?C.clone():_clone(C,!0)});const clone$1=clone;var collectBy=_curry2(function(C,W){var V=_reduce$1(function(Z,X){var Q=C(X);return Z[Q]===void 0&&(Z[Q]=[]),Z[Q].push(X),Z},{},W),U=[];for(var G in V)U.push(V[G]);return U});const collectBy$1=collectBy;var comparator=_curry1(function(C){return function(W,V){return C(W,V)?-1:C(V,W)?1:0}});const comparator$1=comparator;var not=_curry1(function(C){return!C});const not$1=not;var complement=lift$1(not$1);const complement$1=complement;function _pipe(K,C){return function(){return C.call(this,K.apply(this,arguments))}}function _checkForMethod(K,C){return function(){var W=arguments.length;if(W===0)return C();var V=arguments[W-1];return _isArray(V)||typeof V[K]!="function"?C.apply(this,arguments):V[K].apply(V,Array.prototype.slice.call(arguments,0,W-1))}}var slice=_curry3(_checkForMethod("slice",function(C,W,V){return Array.prototype.slice.call(V,C,W)}));const slice$1=slice;var tail=_curry1(_checkForMethod("tail",slice$1(1,1/0)));const tail$1=tail;function pipe(){if(arguments.length===0)throw new Error("pipe requires at least one argument");return _arity(arguments[0].length,reduce$1(_pipe,arguments[0],tail$1(arguments)))}var reverse=_curry1(function(C){return _isString(C)?C.split("").reverse().join(""):Array.prototype.slice.call(C,0).reverse()});const reverse$1=reverse;function compose(){if(arguments.length===0)throw new Error("compose requires at least one argument");return pipe.apply(this,reverse$1(arguments))}var head=nth$1(0);const head$1=head;function _identity(K){return K}var identity=_curry1(_identity);const identity$1=identity;var pipeWith=_curry2(function(C,W){if(W.length<=0)return identity$1;var V=head$1(W),U=tail$1(W);return _arity(V.length,function(){return _reduce$1(function(G,Z){return C.call(this,Z,G)},V.apply(this,arguments),U)})});const pipeWith$1=pipeWith;var composeWith=_curry2(function(C,W){return pipeWith$1.apply(this,[C,reverse$1(W)])});const composeWith$1=composeWith;var concat$1=_curry2(function(C,W){if(_isArray(C)){if(_isArray(W))return C.concat(W);throw new TypeError(toString$2(W)+" is not an array")}if(_isString(C)){if(_isString(W))return C+W;throw new TypeError(toString$2(W)+" is not a string")}if(C!=null&&_isFunction(C["fantasy-land/concat"]))return C["fantasy-land/concat"](W);if(C!=null&&_isFunction(C.concat))return C.concat(W);throw new TypeError(toString$2(C)+' does not have a method named "concat" or "fantasy-land/concat"')});const concat$2=concat$1;var cond=_curry1(function(C){var W=reduce$1(max$1,0,map$2(function(V){return V[0].length},C));return _arity(W,function(){for(var V=0;V<C.length;){if(C[V][0].apply(this,arguments))return C[V][1].apply(this,arguments);V+=1}})});const cond$1=cond;var curry=_curry1(function(C){return curryN$1(C.length,C)});const curry$1=curry;var constructN=_curry2(function(C,W){if(C>10)throw new Error("Constructor with greater than ten arguments");return C===0?function(){return new W}:curry$1(nAry$1(C,function(V,U,G,Z,X,Q,J,ee,te,ie){switch(C){case 1:return new W(V);case 2:return new W(V,U);case 3:return new W(V,U,G);case 4:return new W(V,U,G,Z);case 5:return new W(V,U,G,Z,X);case 6:return new W(V,U,G,Z,X,Q);case 7:return new W(V,U,G,Z,X,Q,J);case 8:return new W(V,U,G,Z,X,Q,J,ee);case 9:return new W(V,U,G,Z,X,Q,J,ee,te);case 10:return new W(V,U,G,Z,X,Q,J,ee,te,ie)}}))});const constructN$1=constructN;var construct=_curry1(function(C){return constructN$1(C.length,C)});const construct$1=construct;var converge=_curry2(function(C,W){return curryN$1(reduce$1(max$1,0,pluck$1("length",W)),function(){var V=arguments,U=this;return C.apply(U,_map(function(G){return G.apply(U,V)},W))})});const converge$1=converge;var count=curry$1(function(K,C){return _reduce$1(function(W,V){return K(V)?W+1:W},0,C)});const count$1=count;var XReduceBy=function(){function K(C,W,V,U){this.valueFn=C,this.valueAcc=W,this.keyFn=V,this.xf=U,this.inputs={}}return K.prototype["@@transducer/init"]=_xfBase.init,K.prototype["@@transducer/result"]=function(C){var W;for(W in this.inputs)if(_has(W,this.inputs)&&(C=this.xf["@@transducer/step"](C,this.inputs[W]),C["@@transducer/reduced"])){C=C["@@transducer/value"];break}return this.inputs=null,this.xf["@@transducer/result"](C)},K.prototype["@@transducer/step"]=function(C,W){var V=this.keyFn(W);return this.inputs[V]=this.inputs[V]||[V,_clone(this.valueAcc,!1)],this.inputs[V][1]=this.valueFn(this.inputs[V][1],W),C},K}();function _xreduceBy(K,C,W){return function(V){return new XReduceBy(K,C,W,V)}}var reduceBy=_curryN(4,[],_dispatchable([],_xreduceBy,function(C,W,V,U){var G=_xwrap(function(Z,X){var Q=V(X),J=C(_has(Q,Z)?Z[Q]:_clone(W,!1),X);return J&&J["@@transducer/reduced"]?_reduced(Z):(Z[Q]=J,Z)});return _xReduce$1(G,{},U)}));const reduceBy$1=reduceBy;var countBy=reduceBy$1(function(K,C){return K+1},0);const countBy$1=countBy;var dec=add$1(-1);const dec$1=dec;var defaultTo=_curry2(function(C,W){return W==null||W!==W?C:W});const defaultTo$1=defaultTo;var descend=_curry3(function(C,W,V){var U=C(W),G=C(V);return U>G?-1:U<G?1:0});const descend$1=descend;var _Set=function(){function K(){this._nativeSet=typeof Set=="function"?new Set:null,this._items={}}return K.prototype.add=function(C){return!hasOrAdd(C,!0,this)},K.prototype.has=function(C){return hasOrAdd(C,!1,this)},K}();function hasOrAdd(K,C,W){var V=typeof K,U,G;switch(V){case"string":case"number":return K===0&&1/K===-1/0?W._items["-0"]?!0:(C&&(W._items["-0"]=!0),!1):W._nativeSet!==null?C?(U=W._nativeSet.size,W._nativeSet.add(K),G=W._nativeSet.size,G===U):W._nativeSet.has(K):V in W._items?K in W._items[V]?!0:(C&&(W._items[V][K]=!0),!1):(C&&(W._items[V]={},W._items[V][K]=!0),!1);case"boolean":if(V in W._items){var Z=K?1:0;return W._items[V][Z]?!0:(C&&(W._items[V][Z]=!0),!1)}else return C&&(W._items[V]=K?[!1,!0]:[!0,!1]),!1;case"function":return W._nativeSet!==null?C?(U=W._nativeSet.size,W._nativeSet.add(K),G=W._nativeSet.size,G===U):W._nativeSet.has(K):V in W._items?_includes(K,W._items[V])?!0:(C&&W._items[V].push(K),!1):(C&&(W._items[V]=[K]),!1);case"undefined":return W._items[V]?!0:(C&&(W._items[V]=!0),!1);case"object":if(K===null)return W._items.null?!0:(C&&(W._items.null=!0),!1);default:return V=Object.prototype.toString.call(K),V in W._items?_includes(K,W._items[V])?!0:(C&&W._items[V].push(K),!1):(C&&(W._items[V]=[K]),!1)}}const _Set$1=_Set;var difference=_curry2(function(C,W){for(var V=[],U=0,G=C.length,Z=W.length,X=new _Set$1,Q=0;Q<Z;Q+=1)X.add(W[Q]);for(;U<G;)X.add(C[U])&&(V[V.length]=C[U]),U+=1;return V});const difference$1=difference;var differenceWith=_curry3(function(C,W,V){for(var U=[],G=0,Z=W.length;G<Z;)!_includesWith(C,W[G],V)&&!_includesWith(C,W[G],U)&&U.push(W[G]),G+=1;return U});const differenceWith$1=differenceWith;var remove=_curry3(function(C,W,V){var U=Array.prototype.slice.call(V,0);return U.splice(C,W),U});const remove$1=remove;function _dissoc(K,C){if(C==null)return C;if(_isInteger(K)&&_isArray(C))return remove$1(K,1,C);var W={};for(var V in C)W[V]=C[V];return delete W[K],W}function _shallowCloneObject(K,C){if(_isInteger(K)&&_isArray(C))return[].concat(C);var W={};for(var V in C)W[V]=C[V];return W}var dissocPath=_curry2(function K(C,W){if(W==null)return W;switch(C.length){case 0:return W;case 1:return _dissoc(C[0],W);default:var V=C[0],U=Array.prototype.slice.call(C,1);return W[V]==null?_shallowCloneObject(V,W):assoc$1(V,K(U,W[V]),W)}});const dissocPath$1=dissocPath;var dissoc=_curry2(function(C,W){return dissocPath$1([C],W)});const dissoc$1=dissoc;var divide=_curry2(function(C,W){return C/W});const divide$1=divide;var XDrop=function(){function K(C,W){this.xf=W,this.n=C}return K.prototype["@@transducer/init"]=_xfBase.init,K.prototype["@@transducer/result"]=_xfBase.result,K.prototype["@@transducer/step"]=function(C,W){return this.n>0?(this.n-=1,C):this.xf["@@transducer/step"](C,W)},K}();function _xdrop(K){return function(C){return new XDrop(K,C)}}var drop=_curry2(_dispatchable(["drop"],_xdrop,function(C,W){return slice$1(Math.max(0,C),1/0,W)}));const drop$1=drop;var XTake=function(){function K(C,W){this.xf=W,this.n=C,this.i=0}return K.prototype["@@transducer/init"]=_xfBase.init,K.prototype["@@transducer/result"]=_xfBase.result,K.prototype["@@transducer/step"]=function(C,W){this.i+=1;var V=this.n===0?C:this.xf["@@transducer/step"](C,W);return this.n>=0&&this.i>=this.n?_reduced(V):V},K}();function _xtake(K){return function(C){return new XTake(K,C)}}var take=_curry2(_dispatchable(["take"],_xtake,function(C,W){return slice$1(0,C<0?1/0:C,W)}));const take$1=take;function dropLast$2(K,C){return take$1(K<C.length?C.length-K:0,C)}var XDropLast=function(){function K(C,W){if(C<=0)return W;this.xf=W,this.pos=0,this.full=!1,this.acc=new Array(C)}return K.prototype["@@transducer/init"]=_xfBase.init,K.prototype["@@transducer/result"]=function(C){return this.acc=null,this.xf["@@transducer/result"](C)},K.prototype["@@transducer/step"]=function(C,W){return this.full&&(C=this.xf["@@transducer/step"](C,this.acc[this.pos])),this.store(W),C},K.prototype.store=function(C){this.acc[this.pos]=C,this.pos+=1,this.pos===this.acc.length&&(this.pos=0,this.full=!0)},K}();function _xdropLast(K){return function(C){return new XDropLast(K,C)}}var dropLast=_curry2(_dispatchable([],_xdropLast,dropLast$2));const dropLast$1=dropLast;function dropLastWhile$2(K,C){for(var W=C.length-1;W>=0&&K(C[W]);)W-=1;return slice$1(0,W+1,C)}var XDropLastWhile=function(){function K(C,W){this.f=C,this.retained=[],this.xf=W}return K.prototype["@@transducer/init"]=_xfBase.init,K.prototype["@@transducer/result"]=function(C){return this.retained=null,this.xf["@@transducer/result"](C)},K.prototype["@@transducer/step"]=function(C,W){return this.f(W)?this.retain(C,W):this.flush(C,W)},K.prototype.flush=function(C,W){return C=_xReduce$1(this.xf,C,this.retained),this.retained=[],this.xf["@@transducer/step"](C,W)},K.prototype.retain=function(C,W){return this.retained.push(W),C},K}();function _xdropLastWhile(K){return function(C){return new XDropLastWhile(K,C)}}var dropLastWhile=_curry2(_dispatchable([],_xdropLastWhile,dropLastWhile$2));const dropLastWhile$1=dropLastWhile;var XDropRepeatsWith=function(){function K(C,W){this.xf=W,this.pred=C,this.lastValue=void 0,this.seenFirstValue=!1}return K.prototype["@@transducer/init"]=_xfBase.init,K.prototype["@@transducer/result"]=_xfBase.result,K.prototype["@@transducer/step"]=function(C,W){var V=!1;return this.seenFirstValue?this.pred(this.lastValue,W)&&(V=!0):this.seenFirstValue=!0,this.lastValue=W,V?C:this.xf["@@transducer/step"](C,W)},K}();function _xdropRepeatsWith(K){return function(C){return new XDropRepeatsWith(K,C)}}var last=nth$1(-1);const last$1=last;var dropRepeatsWith=_curry2(_dispatchable([],_xdropRepeatsWith,function(C,W){var V=[],U=1,G=W.length;if(G!==0)for(V[0]=W[0];U<G;)C(last$1(V),W[U])||(V[V.length]=W[U]),U+=1;return V}));const dropRepeatsWith$1=dropRepeatsWith;var dropRepeats=_curry1(_dispatchable([],function(){return _xdropRepeatsWith(equals$2)},dropRepeatsWith$1(equals$2)));const dropRepeats$1=dropRepeats;var eqBy=_curry3(function(C,W,V){return equals$2(C(W),C(V))});const eqBy$1=eqBy;var dropRepeatsBy=_curry2(function(K,C){return _dispatchable([],function(){return _xdropRepeatsWith(eqBy$1(K))},dropRepeatsWith$1(eqBy$1(K)))(C)});const dropRepeatsBy$1=dropRepeatsBy;var XDropWhile=function(){function K(C,W){this.xf=W,this.f=C}return K.prototype["@@transducer/init"]=_xfBase.init,K.prototype["@@transducer/result"]=_xfBase.result,K.prototype["@@transducer/step"]=function(C,W){if(this.f){if(this.f(W))return C;this.f=null}return this.xf["@@transducer/step"](C,W)},K}();function _xdropWhile(K){return function(C){return new XDropWhile(K,C)}}var dropWhile=_curry2(_dispatchable(["dropWhile"],_xdropWhile,function(C,W){for(var V=0,U=W.length;V<U&&C(W[V]);)V+=1;return slice$1(V,1/0,W)}));const dropWhile$1=dropWhile;var or=_curry2(function(C,W){return C||W});const or$1=or;var either=_curry2(function(C,W){return _isFunction(C)?function(){return C.apply(this,arguments)||W.apply(this,arguments)}:lift$1(or$1)(C,W)});const either$1=either;function _isTypedArray(K){var C=Object.prototype.toString.call(K);return C==="[object Uint8ClampedArray]"||C==="[object Int8Array]"||C==="[object Uint8Array]"||C==="[object Int16Array]"||C==="[object Uint16Array]"||C==="[object Int32Array]"||C==="[object Uint32Array]"||C==="[object Float32Array]"||C==="[object Float64Array]"||C==="[object BigInt64Array]"||C==="[object BigUint64Array]"}var empty$1=_curry1(function(C){return C!=null&&typeof C["fantasy-land/empty"]=="function"?C["fantasy-land/empty"]():C!=null&&C.constructor!=null&&typeof C.constructor["fantasy-land/empty"]=="function"?C.constructor["fantasy-land/empty"]():C!=null&&typeof C.empty=="function"?C.empty():C!=null&&C.constructor!=null&&typeof C.constructor.empty=="function"?C.constructor.empty():_isArray(C)?[]:_isString(C)?"":_isObject(C)?{}:_isArguments$1(C)?function(){return arguments}():_isTypedArray(C)?C.constructor.from(""):void 0});const emptyR=empty$1;var takeLast=_curry2(function(C,W){return drop$1(C>=0?W.length-C:0,W)});const takeLast$1=takeLast;var endsWith=_curry2(function(K,C){return equals$2(takeLast$1(K.length,C),K)});const endsWith$1=endsWith;var eqProps=_curry3(function(C,W,V){return equals$2(W[C],V[C])});const eqProps$1=eqProps;var evolve=_curry2(function K(C,W){if(!_isObject(W)&&!_isArray(W))return W;var V=W instanceof Array?[]:{},U,G,Z;for(G in W)U=C[G],Z=typeof U,V[G]=Z==="function"?U(W[G]):U&&Z==="object"?K(U,W[G]):W[G];return V});const evolve$1=evolve;var XFind=function(){function K(C,W){this.xf=W,this.f=C,this.found=!1}return K.prototype["@@transducer/init"]=_xfBase.init,K.prototype["@@transducer/result"]=function(C){return this.found||(C=this.xf["@@transducer/step"](C,void 0)),this.xf["@@transducer/result"](C)},K.prototype["@@transducer/step"]=function(C,W){return this.f(W)&&(this.found=!0,C=_reduced(this.xf["@@transducer/step"](C,W))),C},K}();function _xfind(K){return function(C){return new XFind(K,C)}}var find=_curry2(_dispatchable(["find"],_xfind,function(C,W){for(var V=0,U=W.length;V<U;){if(C(W[V]))return W[V];V+=1}}));const find$1=find;var XFindIndex=function(){function K(C,W){this.xf=W,this.f=C,this.idx=-1,this.found=!1}return K.prototype["@@transducer/init"]=_xfBase.init,K.prototype["@@transducer/result"]=function(C){return this.found||(C=this.xf["@@transducer/step"](C,-1)),this.xf["@@transducer/result"](C)},K.prototype["@@transducer/step"]=function(C,W){return this.idx+=1,this.f(W)&&(this.found=!0,C=_reduced(this.xf["@@transducer/step"](C,this.idx))),C},K}();function _xfindIndex(K){return function(C){return new XFindIndex(K,C)}}var findIndex=_curry2(_dispatchable([],_xfindIndex,function(C,W){for(var V=0,U=W.length;V<U;){if(C(W[V]))return V;V+=1}return-1}));const findIndex$1=findIndex;var XFindLast=function(){function K(C,W){this.xf=W,this.f=C}return K.prototype["@@transducer/init"]=_xfBase.init,K.prototype["@@transducer/result"]=function(C){return this.xf["@@transducer/result"](this.xf["@@transducer/step"](C,this.last))},K.prototype["@@transducer/step"]=function(C,W){return this.f(W)&&(this.last=W),C},K}();function _xfindLast(K){return function(C){return new XFindLast(K,C)}}var findLast=_curry2(_dispatchable([],_xfindLast,function(C,W){for(var V=W.length-1;V>=0;){if(C(W[V]))return W[V];V-=1}}));const findLast$1=findLast;var XFindLastIndex=function(){function K(C,W){this.xf=W,this.f=C,this.idx=-1,this.lastIdx=-1}return K.prototype["@@transducer/init"]=_xfBase.init,K.prototype["@@transducer/result"]=function(C){return this.xf["@@transducer/result"](this.xf["@@transducer/step"](C,this.lastIdx))},K.prototype["@@transducer/step"]=function(C,W){return this.idx+=1,this.f(W)&&(this.lastIdx=this.idx),C},K}();function _xfindLastIndex(K){return function(C){return new XFindLastIndex(K,C)}}var findLastIndex=_curry2(_dispatchable([],_xfindLastIndex,function(C,W){for(var V=W.length-1;V>=0;){if(C(W[V]))return V;V-=1}return-1}));const findLastIndex$1=findLastIndex;var flatten=_curry1(_makeFlat$1(!0));const flatten$1=flatten;var flip=_curry1(function(C){return curryN$1(C.length,function(W,V){var U=Array.prototype.slice.call(arguments,0);return U[0]=V,U[1]=W,C.apply(this,U)})});const flip$1=flip;var forEach=_curry2(_checkForMethod("forEach",function(C,W){for(var V=W.length,U=0;U<V;)C(W[U]),U+=1;return W}));const forEach$1=forEach;var forEachObjIndexed=_curry2(function(C,W){for(var V=keys$1(W),U=0;U<V.length;){var G=V[U];C(W[G],G,W),U+=1}return W});const forEachObjIndexed$1=forEachObjIndexed;var fromPairs=_curry1(function(C){for(var W={},V=0;V<C.length;)W[C[V][0]]=C[V][1],V+=1;return W});const fromPairs$1=fromPairs;var groupBy=_curry2(_checkForMethod("groupBy",reduceBy$1(function(K,C){return K.push(C),K},[])));const groupBy$1=groupBy;var groupWith=_curry2(function(K,C){for(var W=[],V=0,U=C.length;V<U;){for(var G=V+1;G<U&&K(C[G-1],C[G]);)G+=1;W.push(C.slice(V,G)),V=G}return W});const groupWith$1=groupWith;var gt=_curry2(function(C,W){return C>W});const gt$1=gt;var gte=_curry2(function(C,W){return C>=W});const gte$1=gte;var hasPath=_curry2(function(C,W){if(C.length===0||isNil$1(W))return!1;for(var V=W,U=0;U<C.length;)if(!isNil$1(V)&&_has(C[U],V))V=V[C[U]],U+=1;else return!1;return!0});const hasPath$1=hasPath;var has=_curry2(function(C,W){return hasPath$1([C],W)});const has$1=has;var hasIn=_curry2(function(C,W){return isNil$1(W)?!1:C in W});const hasIn$1=hasIn;var identical=function(K,C){switch(arguments.length){case 0:return identical;case 1:return function(){return function W(V){switch(arguments.length){case 0:return W;default:return _objectIs$1(K,V)}}}();default:return _objectIs$1(K,C)}};const identical$1=identical;var ifElse=_curry3(function(C,W,V){return curryN$1(Math.max(C.length,W.length,V.length),function(){return C.apply(this,arguments)?W.apply(this,arguments):V.apply(this,arguments)})});const ifElse$1=ifElse;var inc=add$1(1);const inc$1=inc;var includes=_curry2(_includes);const includes$1=includes;var indexBy=reduceBy$1(function(K,C){return C},null);const indexBy$1=indexBy;var indexOf=_curry2(function(C,W){return typeof W.indexOf=="function"&&!_isArray(W)?W.indexOf(C):_indexOf(W,C,0)});const indexOf$1=indexOf;var init=slice$1(0,-1);const init$1=init;var innerJoin=_curry3(function(C,W,V){return _filter(function(U){return _includesWith(C,U,V)},W)});const innerJoin$1=innerJoin;var insert=_curry3(function(C,W,V){C=C<V.length&&C>=0?C:V.length;var U=Array.prototype.slice.call(V,0);return U.splice(C,0,W),U});const insert$1=insert;var insertAll=_curry3(function(C,W,V){return C=C<V.length&&C>=0?C:V.length,[].concat(Array.prototype.slice.call(V,0,C),W,Array.prototype.slice.call(V,C))});const insertAll$1=insertAll;var XUniqBy=function(){function K(C,W){this.xf=W,this.f=C,this.set=new _Set$1}return K.prototype["@@transducer/init"]=_xfBase.init,K.prototype["@@transducer/result"]=_xfBase.result,K.prototype["@@transducer/step"]=function(C,W){return this.set.add(this.f(W))?this.xf["@@transducer/step"](C,W):C},K}();function _xuniqBy(K){return function(C){return new XUniqBy(K,C)}}var uniqBy=_curry2(_dispatchable([],_xuniqBy,function(K,C){for(var W=new _Set$1,V=[],U=0,G,Z;U<C.length;)Z=C[U],G=K(Z),W.add(G)&&V.push(Z),U+=1;return V}));const uniqBy$1=uniqBy;var uniq=uniqBy$1(identity$1);const uniq$1=uniq;var intersection=_curry2(function(C,W){for(var V=new _Set$1,U=0;U<C.length;U+=1)V.add(C[U]);return uniq$1(_filter(V.has.bind(V),W))});const intersection$1=intersection;var intersperse=_curry2(_checkForMethod("intersperse",function(C,W){for(var V=[],U=0,G=W.length;U<G;)U===G-1?V.push(W[U]):V.push(W[U],C),U+=1;return V}));const intersperse$1=intersperse;function _objectAssign(K){if(K==null)throw new TypeError("Cannot convert undefined or null to object");for(var C=Object(K),W=1,V=arguments.length;W<V;){var U=arguments[W];if(U!=null)for(var G in U)_has(G,U)&&(C[G]=U[G]);W+=1}return C}const _objectAssign$1=typeof Object.assign=="function"?Object.assign:_objectAssign;var objOf=_curry2(function(C,W){var V={};return V[C]=W,V});const objOf$1=objOf;var _stepCatArray={"@@transducer/init":Array,"@@transducer/step":function(K,C){return K.push(C),K},"@@transducer/result":_identity},_stepCatString={"@@transducer/init":String,"@@transducer/step":function(K,C){return K+C},"@@transducer/result":_identity},_stepCatObject={"@@transducer/init":Object,"@@transducer/step":function(K,C){return _objectAssign$1(K,_isArrayLike$1(C)?objOf$1(C[0],C[1]):C)},"@@transducer/result":_identity};function _stepCat(K){if(_isTransformer(K))return K;if(_isArrayLike$1(K))return _stepCatArray;if(typeof K=="string")return _stepCatString;if(typeof K=="object")return _stepCatObject;throw new Error("Cannot create transformer for "+K)}var into=_curry3(function(C,W,V){var U=W(_isTransformer(C)?C:_stepCat(C));return _xReduce$1(U,U["@@transducer/init"](),V)});const into$1=into;var invert=_curry1(function(C){for(var W=keys$1(C),V=W.length,U=0,G={};U<V;){var Z=W[U],X=C[Z],Q=_has(X,G)?G[X]:G[X]=[];Q[Q.length]=Z,U+=1}return G});const invert$1=invert;var invertObj=_curry1(function(C){for(var W=keys$1(C),V=W.length,U=0,G={};U<V;){var Z=W[U];G[C[Z]]=Z,U+=1}return G});const invertObj$1=invertObj;var invoker=_curry2(function(C,W){return curryN$1(C+1,function(){var V=arguments[C];if(V!=null&&_isFunction(V[W]))return V[W].apply(V,Array.prototype.slice.call(arguments,0,C));throw new TypeError(toString$2(V)+' does not have a method named "'+W+'"')})});const invoker$1=invoker;var is=_curry2(function(C,W){return W instanceof C||W!=null&&(W.constructor===C||C.name==="Object"&&typeof W=="object")});const is$1=is;var isEmpty=_curry1(function(C){return C!=null&&equals$2(C,emptyR(C))});const isEmpty$1=isEmpty;var isNotNil$2=_curry1(function(C){return!isNil$1(C)});const isNotNil$3=isNotNil$2;var join=invoker$1(1,"join");const join$1=join;var juxt=_curry1(function(C){return converge$1(function(){return Array.prototype.slice.call(arguments,0)},C)});const juxt$1=juxt;var keysIn=_curry1(function(C){var W,V=[];for(W in C)V[V.length]=W;return V});const keysIn$1=keysIn;var lastIndexOf=_curry2(function(C,W){if(typeof W.lastIndexOf=="function"&&!_isArray(W))return W.lastIndexOf(C);for(var V=W.length-1;V>=0;){if(equals$2(W[V],C))return V;V-=1}return-1});const lastIndexOf$1=lastIndexOf;function _isNumber(K){return Object.prototype.toString.call(K)==="[object Number]"}var length=_curry1(function(C){return C!=null&&_isNumber(C.length)?C.length:NaN});const length$1=length;var lens=_curry2(function(C,W){return function(V){return function(U){return map$2(function(G){return W(G,U)},V(C(U)))}}});const lens$1=lens;var update=_curry3(function(C,W,V){return adjust$1(C,always$1(W),V)});const update$1=update;var lensIndex=_curry1(function(C){return lens$1(nth$1(C),update$1(C))});const lensIndex$1=lensIndex;var paths$2=_curry2(function(C,W){return C.map(function(V){for(var U=W,G=0,Z;G<V.length;){if(U==null)return;Z=V[G],U=_isInteger(Z)?nth$1(Z,U):U[Z],G+=1}return U})});const paths$3=paths$2;var path=_curry2(function(C,W){return paths$3([C],W)[0]});const path$1=path;var lensPath=_curry1(function(C){return lens$1(path$1(C),assocPath$1(C))});const lensPath$1=lensPath;var lensProp=_curry1(function(C){return lens$1(prop$1(C),assoc$1(C))});const lensProp$1=lensProp;var lt=_curry2(function(C,W){return C<W});const lt$1=lt;var lte$1=_curry2(function(C,W){return C<=W});const lte$2=lte$1;var mapAccum=_curry3(function(C,W,V){for(var U=0,G=V.length,Z=[],X=[W];U<G;)X=C(X[0],V[U]),Z[U]=X[1],U+=1;return[X[0],Z]});const mapAccum$1=mapAccum;var mapAccumRight=_curry3(function(C,W,V){for(var U=V.length-1,G=[],Z=[W];U>=0;)Z=C(Z[0],V[U]),G[U]=Z[1],U-=1;return[Z[0],G]});const mapAccumRight$1=mapAccumRight;var mapObjIndexed=_curry2(function(C,W){return _arrayReduce(function(V,U){return V[U]=C(W[U],U,W),V},{},keys$1(W))});const mapObjIndexed$1=mapObjIndexed;var match=_curry2(function(C,W){return W.match(C)||[]});const match$1=match;var mathMod=_curry2(function(C,W){return _isInteger(C)?!_isInteger(W)||W<1?NaN:(C%W+W)%W:NaN});const mathMod$1=mathMod;var maxBy=_curry3(function(C,W,V){var U=C(V);return max$1(C(W),U)===U?V:W});const maxBy$1=maxBy;var sum=reduce$1(add$1,0);const sum$1=sum;var mean=_curry1(function(C){return sum$1(C)/C.length});const mean$1=mean;var median=_curry1(function(C){var W=C.length;if(W===0)return NaN;var V=2-W%2,U=(W-V)/2;return mean$1(Array.prototype.slice.call(C,0).sort(function(G,Z){return G<Z?-1:G>Z?1:0}).slice(U,U+V))});const median$1=median;var memoizeWith=_curry2(function(C,W){var V={};return _arity(W.length,function(){var U=C.apply(this,arguments);return _has(U,V)||(V[U]=W.apply(this,arguments)),V[U]})});const memoizeWith$1=memoizeWith;var mergeAll=_curry1(function(C){return _objectAssign$1.apply(null,[{}].concat(C))});const mergeAll$1=mergeAll;var mergeWithKey=_curry3(function(C,W,V){var U={},G;W=W||{},V=V||{};for(G in W)_has(G,W)&&(U[G]=_has(G,V)?C(G,W[G],V[G]):W[G]);for(G in V)_has(G,V)&&!_has(G,U)&&(U[G]=V[G]);return U});const mergeWithKey$1=mergeWithKey;var mergeDeepWithKey=_curry3(function K(C,W,V){return mergeWithKey$1(function(U,G,Z){return _isObject(G)&&_isObject(Z)?K(C,G,Z):C(U,G,Z)},W,V)});const mergeDeepWithKey$1=mergeDeepWithKey;var mergeDeepLeft=_curry2(function(C,W){return mergeDeepWithKey$1(function(V,U,G){return U},C,W)});const mergeDeepLeft$1=mergeDeepLeft;var mergeDeepRight=_curry2(function(C,W){return mergeDeepWithKey$1(function(V,U,G){return G},C,W)});const mergeDeepRight$1=mergeDeepRight;var mergeDeepWith=_curry3(function(C,W,V){return mergeDeepWithKey$1(function(U,G,Z){return C(G,Z)},W,V)});const mergeDeepWith$1=mergeDeepWith;var mergeLeft=_curry2(function(C,W){return _objectAssign$1({},W,C)});const mergeLeft$1=mergeLeft;var mergeRight=_curry2(function(C,W){return _objectAssign$1({},C,W)});const mergeRight$1=mergeRight;var mergeWith=_curry3(function(C,W,V){return mergeWithKey$1(function(U,G,Z){return C(G,Z)},W,V)});const mergeWith$1=mergeWith;var min=_curry2(function(C,W){if(C===W)return C;function V(Q,J){if(Q<J!=J<Q)return J<Q?J:Q}var U=V(C,W);if(U!==void 0)return U;var G=V(typeof C,typeof W);if(G!==void 0)return G===typeof C?C:W;var Z=toString$2(C),X=V(Z,toString$2(W));return X!==void 0?X===Z?C:W:C});const min$1=min;var minBy=_curry3(function(C,W,V){var U=C(V);return min$1(C(W),U)===U?V:W});const minBy$1=minBy;function _modify(K,C,W){if(_isInteger(K)&&_isArray(W)){var V=[].concat(W);return V[K]=C(V[K]),V}var U={};for(var G in W)U[G]=W[G];return U[K]=C(U[K]),U}var modifyPath=_curry3(function K(C,W,V){if(!_isObject(V)&&!_isArray(V))return V;if(C.length===0)return W(V);var U=C[0];if(!_has(U,V))return V;if(C.length===1)return _modify(U,W,V);var G=K(Array.prototype.slice.call(C,1),W,V[U]);return G===V[U]?V:_assoc(U,G,V)});const modifyPath$1=modifyPath;var modify=_curry3(function(C,W,V){return modifyPath$1([C],W,V)});const modify$1=modify;var modulo=_curry2(function(C,W){return C%W});const modulo$1=modulo;var move$2=_curry3(function(K,C,W){var V=W.length,U=W.slice(),G=K<0?V+K:K,Z=C<0?V+C:C,X=U.splice(G,1);return G<0||G>=W.length||Z<0||Z>=W.length?W:[].concat(U.slice(0,Z)).concat(X).concat(U.slice(Z,W.length))});const move$3=move$2;var multiply=_curry2(function(C,W){return C*W});const multiply$1=multiply;var partialObject=_curry2((K,C)=>W=>K.call(globalThis,mergeDeepRight$1(C,W)));const partialObject$1=partialObject;var negate=_curry1(function(C){return-C});const negate$1=negate;var none=_curry2(function(C,W){return all$1(_complement(C),W)});const none$1=none;var nthArg=_curry1(function(C){var W=C<0?1:C+1;return curryN$1(W,function(){return nth$1(C,arguments)})});const nthArg$1=nthArg;var o$1=_curry3(function(C,W,V){return C(W(V))});const o$2=o$1;var of$1=_curry2(function(C,W){return typeof C["fantasy-land/of"]=="function"?C["fantasy-land/of"](W):typeof C.of=="function"?C.of(W):[W]});const of$2=of$1;var omit=_curry2(function(C,W){for(var V={},U={},G=0,Z=C.length;G<Z;)U[C[G]]=1,G+=1;for(var X in W)U.hasOwnProperty(X)||(V[X]=W[X]);return V});const omit$1=omit;var on=_curryN(4,[],function(C,W,V,U){return C(W(V),W(U))});const on$1=on;var once=_curry1(function(C){var W=!1,V;return _arity(C.length,function(){return W||(W=!0,V=C.apply(this,arguments)),V})});const once$1=once;function _assertPromise(K,C){if(C==null||!_isFunction(C.then))throw new TypeError("`"+K+"` expected a Promise, received "+_toString(C,[]))}var otherwise=_curry2(function(C,W){return _assertPromise("otherwise",W),W.then(null,C)});const otherwise$1=otherwise;var Identity$2=function(K){return{value:K,map:function(C){return Identity$2(C(K))}}},over=_curry3(function(C,W,V){return C(function(U){return Identity$2(W(U))})(V).value});const over$1=over;var pair=_curry2(function(C,W){return[C,W]});const pair$1=pair;function _createPartialApplicator(K){return _curry2(function(C,W){return _arity(Math.max(0,C.length-W.length),function(){return C.apply(this,K(W,arguments))})})}var partial=_createPartialApplicator(_concat);const partial$1=partial;var partialRight=_createPartialApplicator(flip$1(_concat));const partialRight$1=partialRight;var partition=juxt$1([filter$1,reject$1]);const partition$1=partition;var pathEq=_curry3(function(C,W,V){return equals$2(path$1(W,V),C)});const pathEq$1=pathEq;var pathOr=_curry3(function(C,W,V){return defaultTo$1(C,path$1(W,V))});const pathOr$1=pathOr;var pathSatisfies=_curry3(function(C,W,V){return C(path$1(W,V))});const pathSatisfies$1=pathSatisfies;var pick=_curry2(function(C,W){for(var V={},U=0;U<C.length;)C[U]in W&&(V[C[U]]=W[C[U]]),U+=1;return V});const pick$1=pick;var pickAll=_curry2(function(C,W){for(var V={},U=0,G=C.length;U<G;){var Z=C[U];V[Z]=W[Z],U+=1}return V});const pickAll$1=pickAll;var pickBy=_curry2(function(C,W){var V={};for(var U in W)C(W[U],U,W)&&(V[U]=W[U]);return V});const pickBy$1=pickBy;var prepend=_curry2(function(C,W){return _concat([C],W)});const prepend$1=prepend;var product=reduce$1(multiply$1,1);const product$1=product;var useWith=_curry2(function(C,W){return curryN$1(W.length,function(){for(var V=[],U=0;U<W.length;)V.push(W[U].call(this,arguments[U])),U+=1;return C.apply(this,V.concat(Array.prototype.slice.call(arguments,W.length)))})});const useWith$1=useWith;var project=useWith$1(_map,[pickAll$1,identity$1]);const project$1=project;function _promap(K,C,W){return function(V){return C(W(K(V)))}}var XPromap=function(){function K(C,W,V){this.xf=V,this.f=C,this.g=W}return K.prototype["@@transducer/init"]=_xfBase.init,K.prototype["@@transducer/result"]=_xfBase.result,K.prototype["@@transducer/step"]=function(C,W){return this.xf["@@transducer/step"](C,_promap(this.f,this.g,W))},K}();function _xpromap(K,C){return function(W){return new XPromap(K,C,W)}}var promap=_curry3(_dispatchable(["fantasy-land/promap","promap"],_xpromap,_promap));const promap$1=promap;var propEq=_curry3(function(C,W,V){return equals$2(C,prop$1(W,V))});const propEq$1=propEq;var propIs=_curry3(function(C,W,V){return is$1(C,prop$1(W,V))});const propIs$1=propIs;var propOr=_curry3(function(C,W,V){return defaultTo$1(C,prop$1(W,V))});const propOr$1=propOr;var propSatisfies=_curry3(function(C,W,V){return C(prop$1(W,V))});const propSatisfies$1=propSatisfies;var props=_curry2(function(C,W){return C.map(function(V){return path$1([V],W)})});const props$1=props;var range=_curry2(function(C,W){if(!(_isNumber(C)&&_isNumber(W)))throw new TypeError("Both arguments to range must be numbers");for(var V=[],U=C;U<W;)V.push(U),U+=1;return V});const range$1=range;var reduceRight=_curry3(function(C,W,V){for(var U=V.length-1;U>=0;){if(W=C(V[U],W),W&&W["@@transducer/reduced"]){W=W["@@transducer/value"];break}U-=1}return W});const reduceRight$1=reduceRight;var reduceWhile=_curryN(4,[],function(C,W,V,U){var G=_xwrap(function(Z,X){return C(Z,X)?W(Z,X):_reduced(Z)});return _xReduce$1(G,V,U)});const reduceWhile$1=reduceWhile;var reduced=_curry1(_reduced);const reduced$1=reduced;var times=_curry2(function(C,W){var V=Number(W),U=0,G;if(V<0||isNaN(V))throw new RangeError("n must be a non-negative number");for(G=[];U<V;)G.push(C(U)),U+=1;return G});const times$1=times;var repeat$2=_curry2(function(C,W){return times$1(always$1(C),W)});const repeat$3=repeat$2;var replace=_curry3(function(C,W,V){return V.replace(C,W)});const replace$1=replace;var tInit="@@transducer/init",tStep="@@transducer/step",XScan=function(){function K(C,W,V){this.xf=V,this.f=C,this.acc=W}return K.prototype[tInit]=function(){return this.xf[tStep](this.xf[tInit](),this.acc)},K.prototype["@@transducer/result"]=_xfBase.result,K.prototype[tStep]=function(C,W){return C["@@transducer/reduced"]?C:(this.acc=this.f(this.acc,W),this.xf[tStep](C,this.acc))},K}(),_xscan=_curry3(function(C,W,V){return new XScan(C,W,V)});const _xscan$1=_xscan;var scan=_curry3(_dispatchable([],_xscan$1,function(C,W,V){for(var U=0,G=V.length,Z=[W];U<G;)W=C(W,V[U]),Z[U+1]=W,U+=1;return Z}));const scan$1=scan;var sequence=_curry2(function(C,W){var V=typeof C["fantasy-land/of"]=="function"?C["fantasy-land/of"]:typeof C.of=="function"?C.of:C,U={"fantasy-land/of":V};return typeof W["fantasy-land/traverse"]=="function"?W["fantasy-land/traverse"](U,_identity):typeof W.traverse=="function"?W.traverse(U,_identity):reduceRight$1(function(G,Z){return ap$4(map$2(prepend$1,G),Z)},V([]),W)});const sequence$1=sequence;var set=_curry3(function(C,W,V){return over$1(C,always$1(W),V)});const set$1=set;var sort=_curry2(function(C,W){return Array.prototype.slice.call(W,0).sort(C)});const sort$1=sort;var sortBy=_curry2(function(C,W){return Array.prototype.slice.call(W,0).sort(function(V,U){var G=C(V),Z=C(U);return G<Z?-1:G>Z?1:0})});const sortBy$1=sortBy;var sortWith=_curry2(function(C,W){return Array.prototype.slice.call(W,0).sort(function(V,U){for(var G=0,Z=0;G===0&&Z<C.length;)G=C[Z](V,U),Z+=1;return G})});const sortWith$1=sortWith;var split=invoker$1(1,"split");const split$1=split;var splitAt=_curry2(function(C,W){return[slice$1(0,C,W),slice$1(C,length$1(W),W)]});const splitAt$1=splitAt;var splitEvery=_curry2(function(C,W){if(C<=0)throw new Error("First argument to splitEvery must be a positive integer");for(var V=[],U=0;U<W.length;)V.push(slice$1(U,U+=C,W));return V});const splitEvery$1=splitEvery;var splitWhen=_curry2(function(C,W){for(var V=0,U=W.length,G=[];V<U&&!C(W[V]);)G.push(W[V]),V+=1;return[G,Array.prototype.slice.call(W,V)]});const splitWhen$1=splitWhen;var splitWhenever=_curryN(2,[],function(C,W){for(var V=[],U=[],G=0;G<W.length;G=G+1)C(W[G])||U.push(W[G]),(G<W.length-1&&C(W[G+1])||G===W.length-1)&&U.length>0&&(V.push(U),U=[]);return V});const splitWhenever$1=splitWhenever;var startsWith=_curry2(function(K,C){return equals$2(take$1(K.length,C),K)});const startsWith$1=startsWith;var subtract=_curry2(function(C,W){return Number(C)-Number(W)});const subtract$1=subtract;var swapObject=function(K,C,W){var V=clone$1(W),U=Object.getOwnPropertyNames(V);if(U.includes(K)&&U.includes(C)){var G=V[K];V[K]=V[C],V[C]=G}return V},swapList=function(K,C,W){var V=W.length,U=W.slice(),G=K<0?V+K:K,Z=C<0?V+C:C,X=Math.min(G,Z),Q=Math.max(G,Z);return G<0||G>V||Z<0||Z>V||G===Z||(U=[].concat(U.slice(0,X)).concat([U[Q]]).concat(U.slice(X+1,Q)).concat([U[X]]).concat(U.slice(Q+1,V))),U},swapString=function(K,C,W){var V=swapList(K,C,W);return _isArray(V)?V.join(""):V},swap=_curry3(function(K,C,W){return _isArray(W)?swapList(K,C,W):_isString(W)?swapString(K,C,W):swapObject(K,C,W)});const swap$1=swap;var symmetricDifference=_curry2(function(C,W){return concat$2(difference$1(C,W),difference$1(W,C))});const symmetricDifference$1=symmetricDifference;var symmetricDifferenceWith=_curry3(function(C,W,V){return concat$2(differenceWith$1(C,W,V),differenceWith$1(C,V,W))});const symmetricDifferenceWith$1=symmetricDifferenceWith;var takeLastWhile=_curry2(function(C,W){for(var V=W.length-1;V>=0&&C(W[V]);)V-=1;return slice$1(V+1,1/0,W)});const takeLastWhile$1=takeLastWhile;var XTakeWhile=function(){function K(C,W){this.xf=W,this.f=C}return K.prototype["@@transducer/init"]=_xfBase.init,K.prototype["@@transducer/result"]=_xfBase.result,K.prototype["@@transducer/step"]=function(C,W){return this.f(W)?this.xf["@@transducer/step"](C,W):_reduced(C)},K}();function _xtakeWhile(K){return function(C){return new XTakeWhile(K,C)}}var takeWhile=_curry2(_dispatchable(["takeWhile"],_xtakeWhile,function(C,W){for(var V=0,U=W.length;V<U&&C(W[V]);)V+=1;return slice$1(0,V,W)}));const takeWhile$1=takeWhile;var XTap=function(){function K(C,W){this.xf=W,this.f=C}return K.prototype["@@transducer/init"]=_xfBase.init,K.prototype["@@transducer/result"]=_xfBase.result,K.prototype["@@transducer/step"]=function(C,W){return this.f(W),this.xf["@@transducer/step"](C,W)},K}();function _xtap(K){return function(C){return new XTap(K,C)}}var tap=_curry2(_dispatchable([],_xtap,function(C,W){return C(W),W}));const tap$1=tap;function _isRegExp(K){return Object.prototype.toString.call(K)==="[object RegExp]"}var test=_curry2(function(C,W){if(!_isRegExp(C))throw new TypeError("‘test’ requires a value of type RegExp as its first argument; received "+toString$2(C));return _cloneRegExp(C).test(W)});const test$1=test;var andThen=_curry2(function(C,W){return _assertPromise("andThen",W),W.then(C)});const andThen$1=andThen;var toLower=invoker$1(0,"toLowerCase");const toLower$1=toLower;var toPairs=_curry1(function(C){var W=[];for(var V in C)_has(V,C)&&(W[W.length]=[V,C[V]]);return W});const toPairs$1=toPairs;var toPairsIn=_curry1(function(C){var W=[];for(var V in C)W[W.length]=[V,C[V]];return W});const toPairsIn$1=toPairsIn;var toUpper=invoker$1(0,"toUpperCase");const toUpper$1=toUpper;var transduce=curryN$1(4,function(C,W,V,U){return _xReduce$1(C(typeof W=="function"?_xwrap(W):W),V,U)});const transduce$1=transduce;var transpose=_curry1(function(C){for(var W=0,V=[];W<C.length;){for(var U=C[W],G=0;G<U.length;)typeof V[G]>"u"&&(V[G]=[]),V[G].push(U[G]),G+=1;W+=1}return V});const transpose$1=transpose;var traverse=_curry3(function(C,W,V){var U=typeof C["fantasy-land/of"]=="function"?C["fantasy-land/of"]:typeof C.of=="function"?C.of:C,G={"fantasy-land/of":U};return typeof V["fantasy-land/traverse"]=="function"?V["fantasy-land/traverse"](G,W):typeof V.traverse=="function"?V.traverse(G,W):sequence$1(G,map$2(W,V))});const traverse$1=traverse;var ws=`	
\v\f\r                　\u2028\u2029\uFEFF`,zeroWidth="​",hasProtoTrim=typeof String.prototype.trim=="function",trim=_curry1(!hasProtoTrim||ws.trim()||!zeroWidth.trim()?function(C){var W=new RegExp("^["+ws+"]["+ws+"]*"),V=new RegExp("["+ws+"]["+ws+"]*$");return C.replace(W,"").replace(V,"")}:function(C){return C.trim()});const trim$1=trim;var tryCatch=_curry2(function(C,W){return _arity(C.length,function(){try{return C.apply(this,arguments)}catch(V){return W.apply(this,_concat([V],arguments))}})});const tryCatch$1=tryCatch;var unapply=_curry1(function(C){return function(){return C(Array.prototype.slice.call(arguments,0))}});const unapply$1=unapply;var unary=_curry1(function(C){return nAry$1(1,C)});const unary$1=unary;var uncurryN=_curry2(function(C,W){return curryN$1(C,function(){for(var V=1,U=W,G=0,Z;V<=C&&typeof U=="function";)Z=V===C?arguments.length:G+U.length,U=U.apply(this,Array.prototype.slice.call(arguments,G,Z)),V+=1,G=Z;return U})});const uncurryN$1=uncurryN;var unfold=_curry2(function(C,W){for(var V=C(W),U=[];V&&V.length;)U[U.length]=V[0],V=C(V[1]);return U});const unfold$1=unfold;var union=_curry2(compose(uniq$1,_concat));const union$1=union;var XUniqWith=function(){function K(C,W){this.xf=W,this.pred=C,this.items=[]}return K.prototype["@@transducer/init"]=_xfBase.init,K.prototype["@@transducer/result"]=_xfBase.result,K.prototype["@@transducer/step"]=function(C,W){return _includesWith(this.pred,W,this.items)?C:(this.items.push(W),this.xf["@@transducer/step"](C,W))},K}();function _xuniqWith(K){return function(C){return new XUniqWith(K,C)}}var uniqWith=_curry2(_dispatchable([],_xuniqWith,function(K,C){for(var W=0,V=C.length,U=[],G;W<V;)G=C[W],_includesWith(K,G,U)||(U[U.length]=G),W+=1;return U}));const uniqWith$1=uniqWith;var unionWith=_curry3(function(C,W,V){return uniqWith$1(C,_concat(W,V))});const unionWith$1=unionWith;var unless=_curry3(function(C,W,V){return C(V)?V:W(V)});const unless$1=unless;var unnest=chain$2(_identity);const unnest$1=unnest;var until=_curry3(function(C,W,V){for(var U=V;!C(U);)U=W(U);return U});const until$1=until;var unwind=_curry2(function(K,C){return K in C&&_isArray(C[K])?_map(function(W){return _assoc(K,W,C)},C[K]):[C]});const unwind$1=unwind;var valuesIn=_curry1(function(C){var W,V=[];for(W in C)V[V.length]=C[W];return V});const valuesIn$1=valuesIn;var Const=function(K){return{value:K,"fantasy-land/map":function(){return this}}},view=_curry2(function(C,W){return C(Const)(W).value});const view$1=view;var when=_curry3(function(C,W,V){return C(V)?W(V):V});const when$1=when;var where=_curry2(function(C,W){for(var V in C)if(_has(V,C)&&!C[V](W[V]))return!1;return!0});const where$1=where;var whereAny=_curry2(function(C,W){for(var V in C)if(_has(V,C)&&C[V](W[V]))return!0;return!1});const whereAny$1=whereAny;var whereEq=_curry2(function(C,W){return where$1(map$2(equals$2,C),W)});const whereEq$1=whereEq;var without=_curry2(function(C,W){for(var V=new _Set$1,U=0;U<C.length;U+=1)V.add(C[U]);return reject$1(V.has.bind(V),W)});const without$1=without;var xor=_curry2(function(C,W){return!!(!C^!W)});const xor$1=xor;var xprod=_curry2(function(C,W){for(var V=0,U=C.length,G,Z=W.length,X=[];V<U;){for(G=0;G<Z;)X[X.length]=[C[V],W[G]],G+=1;V+=1}return X});const xprod$1=xprod;var zip=_curry2(function(C,W){for(var V=[],U=0,G=Math.min(C.length,W.length);U<G;)V[U]=[C[U],W[U]],U+=1;return V});const zip$1=zip;var zipObj=_curry2(function(C,W){for(var V=0,U=Math.min(C.length,W.length),G={};V<U;)G[C[V]]=W[V],V+=1;return G});const zipObj$1=zipObj;var zipWith=_curry3(function(C,W,V){for(var U=[],G=0,Z=Math.min(W.length,V.length);G<Z;)U[G]=C(W[G],V[G]),G+=1;return U});const zipWith$1=zipWith;var thunkify=_curry1(function(C){return curryN$1(C.length,function(){var V=arguments;return function(){return C.apply(this,V)}})});const thunkify$1=thunkify,R=Object.freeze(Object.defineProperty({__proto__:null,F:F$1,T:T$1,__,add:add$1,addIndex:addIndex$1,addIndexRight:addIndexRight$1,adjust:adjust$1,all:all$1,allPass:allPass$1,always:always$1,and:and$1,andThen:andThen$1,any:any$1,anyPass:anyPass$1,ap:ap$4,aperture:aperture$1,append:append$1,apply:apply$1,applySpec:applySpec$1,applyTo:applyTo$1,ascend:ascend$1,assoc:assoc$1,assocPath:assocPath$1,binary:binary$1,bind:bind$1,both:both$1,call:call$1,chain:chain$2,clamp:clamp$1,clone:clone$1,collectBy:collectBy$1,comparator:comparator$1,complement:complement$1,compose,composeWith:composeWith$1,concat:concat$2,cond:cond$1,construct:construct$1,constructN:constructN$1,converge:converge$1,count:count$1,countBy:countBy$1,curry:curry$1,curryN:curryN$1,dec:dec$1,defaultTo:defaultTo$1,descend:descend$1,difference:difference$1,differenceWith:differenceWith$1,dissoc:dissoc$1,dissocPath:dissocPath$1,divide:divide$1,drop:drop$1,dropLast:dropLast$1,dropLastWhile:dropLastWhile$1,dropRepeats:dropRepeats$1,dropRepeatsBy:dropRepeatsBy$1,dropRepeatsWith:dropRepeatsWith$1,dropWhile:dropWhile$1,either:either$1,empty:emptyR,endsWith:endsWith$1,eqBy:eqBy$1,eqProps:eqProps$1,equals:equals$2,evolve:evolve$1,filter:filter$1,find:find$1,findIndex:findIndex$1,findLast:findLast$1,findLastIndex:findLastIndex$1,flatten:flatten$1,flip:flip$1,forEach:forEach$1,forEachObjIndexed:forEachObjIndexed$1,fromPairs:fromPairs$1,groupBy:groupBy$1,groupWith:groupWith$1,gt:gt$1,gte:gte$1,has:has$1,hasIn:hasIn$1,hasPath:hasPath$1,head:head$1,identical:identical$1,identity:identity$1,ifElse:ifElse$1,inc:inc$1,includes:includes$1,indexBy:indexBy$1,indexOf:indexOf$1,init:init$1,innerJoin:innerJoin$1,insert:insert$1,insertAll:insertAll$1,intersection:intersection$1,intersperse:intersperse$1,into:into$1,invert:invert$1,invertObj:invertObj$1,invoker:invoker$1,is:is$1,isEmpty:isEmpty$1,isNil:isNil$1,isNotNil:isNotNil$3,join:join$1,juxt:juxt$1,keys:keys$1,keysIn:keysIn$1,last:last$1,lastIndexOf:lastIndexOf$1,length:length$1,lens:lens$1,lensIndex:lensIndex$1,lensPath:lensPath$1,lensProp:lensProp$1,lift:lift$1,liftN:liftN$1,lt:lt$1,lte:lte$2,map:map$2,mapAccum:mapAccum$1,mapAccumRight:mapAccumRight$1,mapObjIndexed:mapObjIndexed$1,match:match$1,mathMod:mathMod$1,max:max$1,maxBy:maxBy$1,mean:mean$1,median:median$1,memoizeWith:memoizeWith$1,mergeAll:mergeAll$1,mergeDeepLeft:mergeDeepLeft$1,mergeDeepRight:mergeDeepRight$1,mergeDeepWith:mergeDeepWith$1,mergeDeepWithKey:mergeDeepWithKey$1,mergeLeft:mergeLeft$1,mergeRight:mergeRight$1,mergeWith:mergeWith$1,mergeWithKey:mergeWithKey$1,min:min$1,minBy:minBy$1,modify:modify$1,modifyPath:modifyPath$1,modulo:modulo$1,move:move$3,multiply:multiply$1,nAry:nAry$1,negate:negate$1,none:none$1,not:not$1,nth:nth$1,nthArg:nthArg$1,o:o$2,objOf:objOf$1,of:of$2,omit:omit$1,on:on$1,once:once$1,or:or$1,otherwise:otherwise$1,over:over$1,pair:pair$1,partial:partial$1,partialObject:partialObject$1,partialRight:partialRight$1,partition:partition$1,path:path$1,pathEq:pathEq$1,pathOr:pathOr$1,pathSatisfies:pathSatisfies$1,paths:paths$3,pick:pick$1,pickAll:pickAll$1,pickBy:pickBy$1,pipe,pipeWith:pipeWith$1,pluck:pluck$1,prepend:prepend$1,product:product$1,project:project$1,promap:promap$1,prop:prop$1,propEq:propEq$1,propIs:propIs$1,propOr:propOr$1,propSatisfies:propSatisfies$1,props:props$1,range:range$1,reduce:reduce$1,reduceBy:reduceBy$1,reduceRight:reduceRight$1,reduceWhile:reduceWhile$1,reduced:reduced$1,reject:reject$1,remove:remove$1,repeat:repeat$3,replace:replace$1,reverse:reverse$1,scan:scan$1,sequence:sequence$1,set:set$1,slice:slice$1,sort:sort$1,sortBy:sortBy$1,sortWith:sortWith$1,split:split$1,splitAt:splitAt$1,splitEvery:splitEvery$1,splitWhen:splitWhen$1,splitWhenever:splitWhenever$1,startsWith:startsWith$1,subtract:subtract$1,sum:sum$1,swap:swap$1,symmetricDifference:symmetricDifference$1,symmetricDifferenceWith:symmetricDifferenceWith$1,tail:tail$1,take:take$1,takeLast:takeLast$1,takeLastWhile:takeLastWhile$1,takeWhile:takeWhile$1,tap:tap$1,test:test$1,thunkify:thunkify$1,times:times$1,toLower:toLower$1,toPairs:toPairs$1,toPairsIn:toPairsIn$1,toString:toString$2,toUpper:toUpper$1,transduce:transduce$1,transpose:transpose$1,traverse:traverse$1,trim:trim$1,tryCatch:tryCatch$1,type:type$2,unapply:unapply$1,unary:unary$1,uncurryN:uncurryN$1,unfold:unfold$1,union:union$1,unionWith:unionWith$1,uniq:uniq$1,uniqBy:uniqBy$1,uniqWith:uniqWith$1,unless:unless$1,unnest:unnest$1,until:until$1,unwind:unwind$1,update:update$1,useWith:useWith$1,values:values$1,valuesIn:valuesIn$1,view:view$1,when:when$1,where:where$1,whereAny:whereAny$1,whereEq:whereEq$1,without:without$1,xor:xor$1,xprod:xprod$1,zip:zip$1,zipObj:zipObj$1,zipWith:zipWith$1},Symbol.toStringTag,{value:"Module"}));var stubUndefined=always$1(void 0);const stubUndefined$1=stubUndefined;var isUndefined=equals$2(stubUndefined$1());const isUndefined$1=isUndefined;var isNotUndefined=complement$1(isUndefined$1);const isNotUndefined$1=isNotUndefined;var isNull=equals$2(null);const isNull$1=isNull;var isNotNull=complement$1(isNull$1);const isNotNull$1=isNotNull;var isNotNil=complement$1(isNil$1);const isNotNil$1=isNotNil;var isGeneratorFunction=curryN$1(1,pipe(type$2,identical$1("GeneratorFunction")));const isGeneratorFunction$1=isGeneratorFunction;var isAsyncFunction=curryN$1(1,pipe(type$2,identical$1("AsyncFunction")));const isAsyncFunction$1=isAsyncFunction;var isFunction=anyPass$1([pipe(type$2,identical$1("Function")),isGeneratorFunction$1,isAsyncFunction$1]);const isFunction$1=isFunction;var isArray=curryN$1(1,isFunction$1(Array.isArray)?Array.isArray:pipe(type$2,identical$1("Array")));const isArray$1=isArray;var isIterable=curryN$1(1,function(K){return typeof Symbol>"u"?!1:hasIn$1(Symbol.iterator,Object(K))&&isFunction$1(K[Symbol.iterator])});const isIterable$1=isIterable;var isEmptyArray=both$1(isArray$1,isEmpty$1);const isEmptyArray$1=isEmptyArray;var isNotArray=complement$1(isArray$1);const isNotArray$1=isNotArray;var isNotEmpty=complement$1(isEmpty$1);const isNotEmpty$1=isNotEmpty;var isNonEmptyArray=both$1(isArray$1,isNotEmpty$1);const isNonEmptyArray$1=isNonEmptyArray;var isBoolean=curryN$1(1,pipe(type$2,identical$1("Boolean")));const isBoolean$1=isBoolean;var isNotBoolean=complement$1(isBoolean$1);const isNotBoolean$1=isNotBoolean;var isNilOrEmpty=curryN$1(1,either$1(isNil$1,isEmpty$1));const isNilOrEmpty$1=isNilOrEmpty;var isString=curryN$1(1,pipe(type$2,identical$1("String")));const isString$1=isString;var isEmptyString=equals$2("");const isEmptyString$1=isEmptyString;var isNotString=complement$1(isString$1);const isNotString$1=isNotString;function _typeof$7(K){"@babel/helpers - typeof";return _typeof$7=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(C){return typeof C}:function(C){return C&&typeof Symbol=="function"&&C.constructor===Symbol&&C!==Symbol.prototype?"symbol":typeof C},_typeof$7(K)}var isOfTypeObject=function(C){return _typeof$7(C)==="object"};const isOfTypeObject$1=isOfTypeObject;var isObj=curryN$1(1,both$1(isNotNull$1,either$1(isOfTypeObject$1,isFunction$1)));const isObj$1=isObj;var isNotObj=complement$1(isObj$1);const isNotObj$1=isNotObj;var isNonEmptyString=allPass$1([isString$1,isNotObj$1,isNotEmpty$1]);const isNonEmptyString$1=isNonEmptyString;function _typeof$6(K){"@babel/helpers - typeof";return _typeof$6=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(C){return typeof C}:function(C){return C&&typeof Symbol=="function"&&C.constructor===Symbol&&C!==Symbol.prototype?"symbol":typeof C},_typeof$6(K)}var isArrayLike=curryN$1(1,function(K){return isArray$1(K)?!0:!K||isString$1(K)||_typeof$6(K)!=="object"?!1:K.nodeType===1?!!K.length:K.length===0?!0:K.length>0?has$1(0,K)&&has$1(K.length-1,K):!1});const isArrayLike$1=isArrayLike;var isNotArrayLike=complement$1(isArrayLike$1);const isNotArrayLike$1=isNotArrayLike;var isNotGeneratorFunction=complement$1(isGeneratorFunction$1);const isNotGeneratorFunction$1=isNotGeneratorFunction;var isNotAsyncFunction=complement$1(isAsyncFunction$1);const isNotAsyncFunction$1=isNotAsyncFunction;var isNotFunction=complement$1(isFunction$1);const isNotFunction$1=isNotFunction;var isObjLike=curryN$1(1,both$1(isNotNull$1,isOfTypeObject$1));const isObjLike$1=isObjLike;var isNotObjLike=complement$1(isObjLike$1);const isNotObjLike$1=isNotObjLike;var isObject=pipe(type$2,identical$1("Object")),isObjectConstructor=pipe(toString$2,equals$2(toString$2(Object))),hasObjectConstructor=pathSatisfies$1(both$1(isFunction$1,isObjectConstructor),["constructor"]),isPlainObj=curryN$1(1,function(K){if(!isObjLike$1(K)||!isObject(K))return!1;var C=Object.getPrototypeOf(K);return isNull$1(C)?!0:hasObjectConstructor(C)});const isPlainObj$1=isPlainObj;var isNotPlainObj=complement$1(isPlainObj$1);const isNotPlainObj$1=isNotPlainObj;var isDate=curryN$1(1,pipe(type$2,identical$1("Date")));const isDate$1=isDate;var isNotDate=complement$1(isDate$1);const isNotDate$1=isNotDate;var isNumber=curryN$1(1,pipe(type$2,identical$1("Number")));const isNumber$1=isNumber;var isNaNPonyfill$1=both$1(isNumber$1,isNaN);const ponyfill$d=isNaNPonyfill$1;var isNaNPonyfill=curryN$1(1,ponyfill$d),_isNaN=isFunction$1(Number.isNaN)?curryN$1(1,Number.isNaN):isNaNPonyfill;const _isNaN$1=_isNaN;var isNotNaN=complement$1(_isNaN$1);const isNotNaN$1=isNotNaN;var isValidDate=curryN$1(1,both$1(isDate$1,pipe(invoker$1(0,"getTime"),isNotNaN$1)));const isValidDate$1=isValidDate;var isNotValidDate=complement$1(isValidDate$1);const isNotValidDate$1=isNotValidDate;var isNotNumber=complement$1(isNumber$1);const isNotNumber$1=isNotNumber;var isPositive=both$1(isNumber$1,lt$1(0));const isPositive$1=isPositive;var isNegative=curryN$1(1,both$1(isNumber$1,gt$1(0)));const isNegative$1=isNegative;var isPositiveZero=curryN$1(1,identical$1(0));const isPositiveZero$1=isPositiveZero;var isNegativeZero=curryN$1(1,identical$1(-0));const isNegativeZero$1=isNegativeZero;var isNotNilOrEmpty=complement$1(isNilOrEmpty$1);const isNotNilOrEmpty$1=isNotNilOrEmpty;var isNonPositive=curryN$1(1,both$1(isNumber$1,flip$1(lte$2)(0)));const isNonPositive$1=isNonPositive;var isNonNegative=curryN$1(1,both$1(isNumber$1,flip$1(gte$1)(0)));const isNonNegative$1=isNonNegative;var isMap=curryN$1(1,pipe(type$2,identical$1("Map")));const isMap$1=isMap;var isNotMap=complement$1(isMap$1);const isNotMap$1=isNotMap;var isFinitePonyfill$1=both$1(isNumber$1,isFinite);const ponyfill$c=isFinitePonyfill$1;var isFinitePonyfill=curryN$1(1,ponyfill$c),_isFinite=isFunction$1(Number.isFinite)?curryN$1(1,bind$1(Number.isFinite,Number)):isFinitePonyfill;const isFinite$1=_isFinite;var isNotFinite=complement$1(isFinite$1);const isNotFinite$1=isNotFinite;var isIntegerPonyfill$1=both$1(isFinite$1,converge$1(equals$2,[Math.floor,identity$1]));const ponyfill$b=isIntegerPonyfill$1;var isIntegerPonyfill=curryN$1(1,ponyfill$b),isInteger=isFunction$1(Number.isInteger)?curryN$1(1,bind$1(Number.isInteger,Number)):isIntegerPonyfill;const isInteger$1=isInteger;var toInteger32=curryN$1(1,function(K){return K>>0});const toInteger32$1=toInteger32;var isInteger32=curryN$1(1,function(K){return toInteger32$1(K)===K});const isInteger32$1=isInteger32;var toUinteger32=curryN$1(1,function(K){return K>>>0});const toUinteger32$1=toUinteger32;var isUinteger32=curryN$1(1,function(K){return toUinteger32$1(K)===K});const isUinteger32$1=isUinteger32;var isNotInteger=complement$1(isInteger$1);const isNotInteger$1=isNotInteger;var isBigInt=curryN$1(1,pipe(type$2,identical$1("BigInt")));const isBigInt$1=isBigInt;var isFloat=both$1(isFinite$1,complement$1(isInteger$1));const isFloat$1=isFloat;var isNotFloat=curryN$1(1,complement$1(isFloat$1));const isNotFloat$1=isNotFloat;var isValidNumber=curryN$1(1,either$1(isInteger$1,isFloat$1));const isValidNumber$1=isValidNumber;var isNotValidNumber=complement$1(isValidNumber$1);const isNotValidNumber$1=isNotValidNumber;var isOdd=curryN$1(1,both$1(isInteger$1,pipe(flip$1(modulo$1)(2),complement$1(equals$2)(0))));const isOdd$1=isOdd;var isEven=curryN$1(1,both$1(isInteger$1,complement$1(isOdd$1)));const isEven$1=isEven;var isPair=curryN$1(1,both$1(isArray$1,pipe(length$1,equals$2(2))));const isPair$1=isPair;var isNotPair=complement$1(isPair$1);const isNotPair$1=isNotPair;var isThenable=pathSatisfies$1(isFunction$1,["then"]);const isThenable$1=isThenable;var isPromise=curryN$1(1,both$1(isObj$1,pipe(toString$2,equals$2("[object Promise]"))));const isPromise$1=isPromise;var isTrue=curryN$1(1,identical$1(!0));const isTrue$1=isTrue;var isFalse=curryN$1(1,identical$1(!1));const isFalse$1=isFalse;var isTruthy=curryN$1(1,Boolean);const isTruthy$1=isTruthy;var isFalsy=complement$1(isTruthy$1);const isFalsy$1=isFalsy;var isRegExp=curryN$1(1,pipe(type$2,identical$1("RegExp")));const isRegExp$1=isRegExp;var isNotRegExp=complement$1(isRegExp$1);const isNotRegExp$1=isNotRegExp;var isSet=curryN$1(1,pipe(type$2,identical$1("Set")));const isSet$1=isSet;var isNotSet=complement$1(isSet$1);const isNotSet$1=isNotSet;var isSparseArray=both$1(isArray$1,converge$1(complement$1(identical$1),[pipe(values$1,length$1),length$1]));const isSparseArray$1=isSparseArray;function _typeof$5(K){"@babel/helpers - typeof";return _typeof$5=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(C){return typeof C}:function(C){return C&&typeof Symbol=="function"&&C.constructor===Symbol&&C!==Symbol.prototype?"symbol":typeof C},_typeof$5(K)}var isSymbol=curryN$1(1,function(K){return _typeof$5(K)==="symbol"||_typeof$5(K)==="object"&&type$2(K)==="Symbol"});const isSymbol$1=isSymbol;var MAX_SAFE_INTEGER=Number.MAX_SAFE_INTEGER||Math.pow(2,53)-1;const MAX_SAFE_INTEGER$1=MAX_SAFE_INTEGER;var isSafeIntegerPonyfill$1=both$1(isInteger$1,function(K){return Math.abs(K)<=MAX_SAFE_INTEGER$1});const ponyfill$a=isSafeIntegerPonyfill$1;var isSafeIntegerPonyfill=curryN$1(1,ponyfill$a),isSafeInteger=isFunction$1(Number.isSafeInteger)?curryN$1(1,bind$1(Number.isSafeInteger,Number)):isSafeIntegerPonyfill;const isSafeInteger$1=isSafeInteger;var isIndexed=curryN$1(1,either$1(isString$1,isArray$1));const isIndexed$1=isIndexed;var isError=curryN$1(1,pipe(type$2,identical$1("Error")));const isError$1=isError;var isNaturalNumber=curryN$1(1,both$1(isInteger$1,complement$1(isNegative$1)));const isNaturalNumber$1=isNaturalNumber;var isPrimitive=both$1(isNotObj$1,anyPass$1([isString$1,isNumber$1,isBigInt$1,isBoolean$1,isUndefined$1,isNull$1,isSymbol$1]));const isPrimitive$1=isPrimitive;var isNotPrimitive=curryN$1(1,complement$1(isPrimitive$1));const isNotPrimitive$1=isNotPrimitive;var isSentinelValue=curryN$1(1,function(K){return isInteger32$1(K)&&~K===0});const isSentinelValue$1=isSentinelValue;var isBlank=anyPass$1([isFalse$1,isNil$1,isEmpty$1,test$1(/^\s+$/gm)]);const isBlank$1=isBlank;var stubNull=always$1(null);const stubNull$1=stubNull;var stubObj=function(){return{}};const stubObj$1=stubObj;var stubString=always$1("");const stubString$1=stubString;var stubArray=function(){return[]};const stubArray$1=stubArray;var noop=always$1(stubUndefined$1());const noop$1=noop;var equals="fantasy-land/equals",lte="fantasy-land/lte",concat="fantasy-land/concat",empty="fantasy-land/empty",map="fantasy-land/map",contramap="fantasy-land/contramap",ap$2="fantasy-land/ap",of="fantasy-land/of",chain="fantasy-land/chain",isFunctor=either$1(pathSatisfies$1(isFunction$1,["map"]),pathSatisfies$1(isFunction$1,[map])),isApply=both$1(isFunctor,either$1(pathSatisfies$1(isFunction$1,["ap"]),pathSatisfies$1(isFunction$1,[ap$2]))),ap=curryN$1(2,function(K,C){if(!isApply(K)||!isApply(C))return ap$4(K,C);try{return K.ap(C)}catch{return C.ap(K)}});const ap$1=ap;var liftFN=curry$1(function(K,C){var W=curryN$1(K,C);return curryN$1(K,function(){for(var V=arguments.length,U=new Array(V),G=0;G<V;G++)U[G]=arguments[G];var Z=map$2(W,head$1(U)),X=slice$1(1,1/0,U);return reduce$1(ap$1,Z,X)})});const liftFN$1=liftFN;var liftF=curryN$1(1,function(K){return liftFN$1(K.length,K)});const liftF$1=liftF;var catamorphism=curry$1(function(K,C,W){if(isFunction$1(W.matchWith))return W.matchWith({Ok:function(Z){var X=Z.value;return C(X)},Error:function(Z){var X=Z.value;return K(X)},Just:function(Z){var X=Z.value;return C(X)},Nothing:function(){return K(void 0)},Success:function(Z){var X=Z.value;return C(X)},Failure:function(Z){var X=Z.value;return K(X)}});if(isFunction$1(W.cata))return W.cata(K,C);if(isFunction$1(W.getOrElse)){var V="RA.cata".concat(Math.random()),U=W.getOrElse(V);return U===V?K():C(U)}return W.either(K,C)});const catamorphism$1=catamorphism;var weave=curryN$1(2,function(K,C){return curryN$1(K.length,function(){return K.apply(void 0,arguments).run(C)})});const weave$1=weave;var weaveLazy=curryN$1(2,function(K,C){return curryN$1(K.length,function(){return K.apply(void 0,arguments).run(C())})});const weaveLazy$1=weaveLazy;var curryRightN=curryN$1(2,function(K,C){return curryN$1(K,function(){for(var V=arguments.length,U=new Array(V),G=0;G<V;G++)U[G]=arguments[G];return C.apply(this,reverse$1(U))})});const curryRightN$1=curryRightN;var curryRight=converge$1(curryRightN$1,[length$1,identity$1]);const curryRight$1=curryRight;var allP=curryN$1(1,bind$1(Promise.all,Promise));const allP$1=allP;var catchP=invoker$1(1,"catch");const catchP$1=catchP;var rejectP=bind$1(Promise.reject,Promise);const rejectP$1=rejectP;var resolveP=bind$1(Promise.resolve,Promise);const resolveP$1=resolveP;var noneP=curryN$1(1,pipe(map$2(resolveP$1),map$2(function(K){return K.then(rejectP$1,resolveP$1)}),allP$1));const noneP$1=noneP;var makeDelay=curry$1(function(K,C){var W,V;return isInteger$1(C)&&isNonNegative$1(C)?W=C:(W=propOr$1(0,"timeout",C),V=propOr$1(V,"value",C)),new Promise(function(){for(var U=arguments.length,G=new Array(U),Z=0;Z<U;Z++)G[Z]=arguments[Z];var X=K(G);setTimeout(partial$1(X,[V]),W)})}),delayP=makeDelay(nth$1(0));delayP.reject=makeDelay(nth$1(1));const delayP$1=delayP;var thenCatchP=invoker$1(2,"then");const thenCatchP$1=thenCatchP;function _toConsumableArray$5(K){return _arrayWithoutHoles$5(K)||_iterableToArray$6(K)||_unsupportedIterableToArray$8(K)||_nonIterableSpread$5()}function _nonIterableSpread$5(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function _unsupportedIterableToArray$8(K,C){if(K){if(typeof K=="string")return _arrayLikeToArray$8(K,C);var W=Object.prototype.toString.call(K).slice(8,-1);if(W==="Object"&&K.constructor&&(W=K.constructor.name),W==="Map"||W==="Set")return Array.from(K);if(W==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(W))return _arrayLikeToArray$8(K,C)}}function _iterableToArray$6(K){if(typeof Symbol<"u"&&K[Symbol.iterator]!=null||K["@@iterator"]!=null)return Array.from(K)}function _arrayWithoutHoles$5(K){if(Array.isArray(K))return _arrayLikeToArray$8(K)}function _arrayLikeToArray$8(K,C){(C==null||C>K.length)&&(C=K.length);for(var W=0,V=new Array(C);W<C;W++)V[W]=K[W];return V}var onFulfill=function(C){return{status:"fulfilled",value:C}},onReject=function(C){return{status:"rejected",reason:C}},allSettledPonyfill=function(C){var W=map$2(function(V){return resolveP$1(V).then(onFulfill).catch(onReject)},_toConsumableArray$5(C));return allP$1(W)};const ponyfill$9=allSettledPonyfill;var allSettledPPonyfill=curryN$1(1,ponyfill$9),allSettledP=isFunction$1(Promise.allSettled)?curryN$1(1,bind$1(Promise.allSettled,Promise)):allSettledPPonyfill;const allSettledP$1=allSettledP;var Y=curryN$1(1,function(K){return function(C){return C(C)}(function(C){return K(function(W){return C(C)(W)})})});const Y$1=Y;var seq=curry$1(function(K,C){return tap$1(function(W){return map$2(function(V){return V(W)})(K)})(C)});const seq$1=seq;function _toConsumableArray$4(K){return _arrayWithoutHoles$4(K)||_iterableToArray$5(K)||_unsupportedIterableToArray$7(K)||_nonIterableSpread$4()}function _nonIterableSpread$4(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function _unsupportedIterableToArray$7(K,C){if(K){if(typeof K=="string")return _arrayLikeToArray$7(K,C);var W=Object.prototype.toString.call(K).slice(8,-1);if(W==="Object"&&K.constructor&&(W=K.constructor.name),W==="Map"||W==="Set")return Array.from(K);if(W==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(W))return _arrayLikeToArray$7(K,C)}}function _iterableToArray$5(K){if(typeof Symbol<"u"&&K[Symbol.iterator]!=null||K["@@iterator"]!=null)return Array.from(K)}function _arrayWithoutHoles$4(K){if(Array.isArray(K))return _arrayLikeToArray$7(K)}function _arrayLikeToArray$7(K,C){(C==null||C>K.length)&&(C=K.length);for(var W=0,V=new Array(C);W<C;W++)V[W]=K[W];return V}var byArity=comparator$1(function(K,C){return K.length>C.length}),getMaxArity=pipe(sort$1(byArity),head$1,prop$1("length")),iteratorFn=curry$1(function(K,C,W){var V=W.apply(void 0,_toConsumableArray$4(K));return isNotNil$1(V)?reduced$1(V):C}),dispatchImpl=function(C){var W=getMaxArity(C);return curryN$1(W,function(){for(var V=arguments.length,U=new Array(V),G=0;G<V;G++)U[G]=arguments[G];return reduce$1(iteratorFn(U),void 0,C)})},dispatch=ifElse$1(isNonEmptyArray$1,dispatchImpl,stubUndefined$1);const dispatch$1=dispatch;var async=curryN$1(1,function(K){function C(){var W=bind$1(K,this).apply(void 0,arguments),V=function U(G){var Z=resolveP$1(G.value);return G.done?Z:Z.then(function(X){return U(W.next(X))},function(X){return U(W.throw(X))})};try{return V(W.next())}catch(U){return rejectP$1(U)}}return K.length>0?curryN$1(K.length,C):C});const async$1=async;function _typeof$4(K){"@babel/helpers - typeof";return _typeof$4=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(C){return typeof C}:function(C){return C&&typeof Symbol=="function"&&C.constructor===Symbol&&C!==Symbol.prototype?"symbol":typeof C},_typeof$4(K)}function _toConsumableArray$3(K){return _arrayWithoutHoles$3(K)||_iterableToArray$4(K)||_unsupportedIterableToArray$6(K)||_nonIterableSpread$3()}function _nonIterableSpread$3(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function _unsupportedIterableToArray$6(K,C){if(K){if(typeof K=="string")return _arrayLikeToArray$6(K,C);var W=Object.prototype.toString.call(K).slice(8,-1);if(W==="Object"&&K.constructor&&(W=K.constructor.name),W==="Map"||W==="Set")return Array.from(K);if(W==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(W))return _arrayLikeToArray$6(K,C)}}function _iterableToArray$4(K){if(typeof Symbol<"u"&&K[Symbol.iterator]!=null||K["@@iterator"]!=null)return Array.from(K)}function _arrayWithoutHoles$3(K){if(Array.isArray(K))return _arrayLikeToArray$6(K)}function _arrayLikeToArray$6(K,C){(C==null||C>K.length)&&(C=K.length);for(var W=0,V=new Array(C);W<C;W++)V[W]=K[W];return V}function _defineProperties$1(K,C){for(var W=0;W<C.length;W++){var V=C[W];V.enumerable=V.enumerable||!1,V.configurable=!0,"value"in V&&(V.writable=!0),Object.defineProperty(K,_toPropertyKey$4(V.key),V)}}function _createClass$1(K,C,W){return C&&_defineProperties$1(K.prototype,C),W&&_defineProperties$1(K,W),Object.defineProperty(K,"prototype",{writable:!1}),K}function _toPropertyKey$4(K){var C=_toPrimitive$4(K,"string");return _typeof$4(C)==="symbol"?C:String(C)}function _toPrimitive$4(K,C){if(_typeof$4(K)!=="object"||K===null)return K;var W=K[Symbol.toPrimitive];if(W!==void 0){var V=W.call(K,C||"default");if(_typeof$4(V)!=="object")return V;throw new TypeError("@@toPrimitive must return a primitive value.")}return(C==="string"?String:Number)(K)}function _classCallCheck$1(K,C){if(!(K instanceof C))throw new TypeError("Cannot call a class as a function")}function _inherits(K,C){if(typeof C!="function"&&C!==null)throw new TypeError("Super expression must either be null or a function");K.prototype=Object.create(C&&C.prototype,{constructor:{value:K,writable:!0,configurable:!0}}),Object.defineProperty(K,"prototype",{writable:!1}),C&&_setPrototypeOf(K,C)}function _createSuper(K){var C=_isNativeReflectConstruct();return function(){var V=_getPrototypeOf(K),U;if(C){var G=_getPrototypeOf(this).constructor;U=Reflect.construct(V,arguments,G)}else U=V.apply(this,arguments);return _possibleConstructorReturn(this,U)}}function _possibleConstructorReturn(K,C){if(C&&(_typeof$4(C)==="object"||typeof C=="function"))return C;if(C!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized(K)}function _assertThisInitialized(K){if(K===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return K}function _wrapNativeSuper(K){var C=typeof Map=="function"?new Map:void 0;return _wrapNativeSuper=function(V){if(V===null||!_isNativeFunction(V))return V;if(typeof V!="function")throw new TypeError("Super expression must either be null or a function");if(typeof C<"u"){if(C.has(V))return C.get(V);C.set(V,U)}function U(){return _construct(V,arguments,_getPrototypeOf(this).constructor)}return U.prototype=Object.create(V.prototype,{constructor:{value:U,enumerable:!1,writable:!0,configurable:!0}}),_setPrototypeOf(U,V)},_wrapNativeSuper(K)}function _construct(K,C,W){return _isNativeReflectConstruct()?_construct=Reflect.construct.bind():_construct=function(U,G,Z){var X=[null];X.push.apply(X,G);var Q=Function.bind.apply(U,X),J=new Q;return Z&&_setPrototypeOf(J,Z.prototype),J},_construct.apply(null,arguments)}function _isNativeReflectConstruct(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function _isNativeFunction(K){return Function.toString.call(K).indexOf("[native code]")!==-1}function _setPrototypeOf(K,C){return _setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(V,U){return V.__proto__=U,V},_setPrototypeOf(K,C)}function _getPrototypeOf(K){return _getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(W){return W.__proto__||Object.getPrototypeOf(W)},_getPrototypeOf(K)}var AggregatedError=function(K){_inherits(W,K);var C=_createSuper(W);function W(){var V,U=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],G=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";return _classCallCheck$1(this,W),V=C.call(this,G),V.errors=U,V}return _createClass$1(W)}(_wrapNativeSuper(Error)),anyPonyfill=function(C){var W=[];return new Promise(function(V,U){var G=function(X){W.push(X),W.length===C.length&&U(new AggregatedError(W))};map$2(function(Z){return resolveP$1(Z).then(V).catch(G)},_toConsumableArray$3(C))})};const ponyfill$8=anyPonyfill;var anyPPonyfill=curryN$1(1,ponyfill$8),anyP=isFunction$1(Promise.any)?curryN$1(1,bind$1(Promise.any,Promise)):anyPPonyfill;const anyP$1=anyP;var compareLength=curry$1(function(K,C,W){return compose(K(C),length$1)(W)});const compareLength$1=compareLength;var lengthEq=compareLength$1(equals$2);const lengthEq$1=lengthEq;var lengthGte=compareLength$1(flip$1(gte$1));const lengthGte$1=lengthGte;function _toConsumableArray$2(K){return _arrayWithoutHoles$2(K)||_iterableToArray$3(K)||_unsupportedIterableToArray$5(K)||_nonIterableSpread$2()}function _nonIterableSpread$2(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function _unsupportedIterableToArray$5(K,C){if(K){if(typeof K=="string")return _arrayLikeToArray$5(K,C);var W=Object.prototype.toString.call(K).slice(8,-1);if(W==="Object"&&K.constructor&&(W=K.constructor.name),W==="Map"||W==="Set")return Array.from(K);if(W==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(W))return _arrayLikeToArray$5(K,C)}}function _iterableToArray$3(K){if(typeof Symbol<"u"&&K[Symbol.iterator]!=null||K["@@iterator"]!=null)return Array.from(K)}function _arrayWithoutHoles$2(K){if(Array.isArray(K))return _arrayLikeToArray$5(K)}function _arrayLikeToArray$5(K,C){(C==null||C>K.length)&&(C=K.length);for(var W=0,V=new Array(C);W<C;W++)V[W]=K[W];return V}var lastP=curryN$1(1,function(K){var C=[],W=[],V=bind$1(C.push,C),U=bind$1(W.push,W),G=map$2(function(Z){return resolveP$1(Z).then(V).catch(U)},_toConsumableArray$2(K));return allP$1(G).then(function(){if(!(lengthEq$1(0,C)&&lengthEq$1(0,W)))return lengthGte$1(1,C)?last$1(C):rejectP$1(W)})});const lastP$1=lastP;var defaultWhen=curry$1(function(K,C,W){return K(W)?C:W});const defaultWhen$1=defaultWhen;var mapIndexed=addIndex$1(map$2);const mapIndexed$1=mapIndexed;var fnull=curry$1(function(K,C){return curryN$1(K.length,function(){for(var W=arguments.length,V=new Array(W),U=0;U<W;U++)V[U]=arguments[U];var G=mapIndexed$1(function(Z,X){return defaultWhen$1(isNil$1,C[X],Z)},V);return apply$1(K,G)})});const fnull$1=fnull;var reduceIndexed=addIndex$1(reduce$1);const reduceIndexed$1=reduceIndexed;var filterIndexed$1=addIndex$1(filter$1);const filterIndexed$2=filterIndexed$1;var filterIndexed=addIndex$1(filter$1),containsIndex$1=curry$1(function(K,C,W){return includes$1(W,K)}),pickIndexes=curry$1(function(K,C){return filterIndexed(containsIndex$1(K),C)});const pickIndexes$1=pickIndexes;var list=unapply$1(identity$1);const list$1=list;var ensureArray=when$1(isNotArray$1,of$2(Array));const ensureArray$1=ensureArray;var leftIdentitySemigroup={concat:identity$1},concatAll=pipe(reduce$1(concat$2,leftIdentitySemigroup),when$1(identical$1(leftIdentitySemigroup),stubUndefined$1));const concatAll$1=concatAll;var concatRight=flip$1(concat$2);const concatRight$1=concatRight;function _slicedToArray$1(K,C){return _arrayWithHoles$2(K)||_iterableToArrayLimit$1(K,C)||_unsupportedIterableToArray$4(K,C)||_nonIterableRest$2()}function _nonIterableRest$2(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function _unsupportedIterableToArray$4(K,C){if(K){if(typeof K=="string")return _arrayLikeToArray$4(K,C);var W=Object.prototype.toString.call(K).slice(8,-1);if(W==="Object"&&K.constructor&&(W=K.constructor.name),W==="Map"||W==="Set")return Array.from(K);if(W==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(W))return _arrayLikeToArray$4(K,C)}}function _arrayLikeToArray$4(K,C){(C==null||C>K.length)&&(C=K.length);for(var W=0,V=new Array(C);W<C;W++)V[W]=K[W];return V}function _iterableToArrayLimit$1(K,C){var W=K==null?null:typeof Symbol<"u"&&K[Symbol.iterator]||K["@@iterator"];if(W!=null){var V,U,G,Z,X=[],Q=!0,J=!1;try{if(G=(W=W.call(K)).next,C===0){if(Object(W)!==W)return;Q=!1}else for(;!(Q=(V=G.call(W)).done)&&(X.push(V.value),X.length!==C);Q=!0);}catch(ee){J=!0,U=ee}finally{try{if(!Q&&W.return!=null&&(Z=W.return(),Object(Z)!==Z))return}finally{if(J)throw U}}return X}}function _arrayWithHoles$2(K){if(Array.isArray(K))return K}var reduceP=curryN$1(3,function(K,C,W){return resolveP$1(W).then(function(V){var U=length$1(V);if(U===0)return C;var G=reduce$1(function(Z,X){return Z.then(function(Q){return allP$1([Q,X])}).then(function(Q){var J=_slicedToArray$1(Q,2),ee=J[0],te=J[1];return isUndefined$1(ee)&&U===1?te:K(ee,te)})});return G(resolveP$1(C),V)})});const reduceP$1=reduceP;function _slicedToArray(K,C){return _arrayWithHoles$1(K)||_iterableToArrayLimit(K,C)||_unsupportedIterableToArray$3(K,C)||_nonIterableRest$1()}function _nonIterableRest$1(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function _unsupportedIterableToArray$3(K,C){if(K){if(typeof K=="string")return _arrayLikeToArray$3(K,C);var W=Object.prototype.toString.call(K).slice(8,-1);if(W==="Object"&&K.constructor&&(W=K.constructor.name),W==="Map"||W==="Set")return Array.from(K);if(W==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(W))return _arrayLikeToArray$3(K,C)}}function _arrayLikeToArray$3(K,C){(C==null||C>K.length)&&(C=K.length);for(var W=0,V=new Array(C);W<C;W++)V[W]=K[W];return V}function _iterableToArrayLimit(K,C){var W=K==null?null:typeof Symbol<"u"&&K[Symbol.iterator]||K["@@iterator"];if(W!=null){var V,U,G,Z,X=[],Q=!0,J=!1;try{if(G=(W=W.call(K)).next,C===0){if(Object(W)!==W)return;Q=!1}else for(;!(Q=(V=G.call(W)).done)&&(X.push(V.value),X.length!==C);Q=!0);}catch(ee){J=!0,U=ee}finally{try{if(!Q&&W.return!=null&&(Z=W.return(),Object(Z)!==Z))return}finally{if(J)throw U}}return X}}function _arrayWithHoles$1(K){if(Array.isArray(K))return K}var flipArgs=pipe(reduceRight$1(concat$2,""),equals$2("ba"))(["a","b"]),reduceRightP=curryN$1(3,function(K,C,W){return resolveP$1(W).then(function(V){var U=length$1(V);if(U===0)return C;var G=reduceRight$1(function(Z,X){var Q,J;return flipArgs?(Q=Z,J=X):(Q=X,J=Z),Q.then(function(ee){return allP$1([ee,J])}).then(function(ee){var te=_slicedToArray(ee,2),ie=te[0],ne=te[1];return isUndefined$1(ie)&&U===1?ne:K(ne,ie)})});return G(resolveP$1(C),V)})});const reduceRightP$1=reduceRightP;var sliceFrom=slice$1(__,1/0);const sliceFrom$1=sliceFrom;var sliceTo=slice$1(0);const sliceTo$1=sliceTo;var rejectIndexed=addIndex$1(reject$1),containsIndex=curry$1(function(K,C,W){return includes$1(W,K)}),omitIndexes=curry$1(function(K,C){return rejectIndexed(containsIndex(K),C)});const omitIndexes$1=omitIndexes;var compact=reject$1(isFalsy$1);const compact$1=compact;var appendFlipped=flip$1(append$1);const appendFlipped$1=appendFlipped;var included=flip$1(includes$1);const included$1=included;var move=curry$1(function(K,C,W){return compose(insert$1(C,nth$1(K,W)),remove$1(K,1))(W)});const move$1=move;var lengthGt=compareLength$1(flip$1(gt$1));const lengthGt$1=lengthGt;var lengthLt=compareLength$1(flip$1(lt$1));const lengthLt$1=lengthLt;var lengthLte=compareLength$1(flip$1(lte$2));const lengthLte$1=lengthLte;var lengthNotEq=compareLength$1(complement$1(equals$2));const lengthNotEq$1=lengthNotEq;var allEqual=curryN$1(1,pipe(uniq$1,lengthLte$1(1)));const allEqual$1=allEqual;var repeat=function(C,W){var V=Number(W);if(V!==W&&(V=0),isNegative$1(V))throw new RangeError("repeat count must be non-negative");if(isNotFinite$1(V))throw new RangeError("repeat count must be less than infinity");if(V=Math.floor(V),C.length===0||V===0)return"";if(C.length*V>=1<<28)throw new RangeError("repeat count must not overflow maximum string size");var U=C.length*V;V=Math.floor(Math.log(V)/Math.log(2));for(var G=C;V;)G+=C,V-=1;return G+=G.substring(0,U-G.length),G};const repeat$1=repeat;var repeatStrPonyfill=curry$1(repeat$1),repeatStrInvoker=flip$1(invoker$1(1,"repeat")),repeatStr=isFunction$1(String.prototype.repeat)?repeatStrInvoker:repeatStrPonyfill;const repeatStr$1=repeatStr;var allIdentical=curryN$1(1,pipe(uniqWith$1(identical$1),lengthLte$1(1)));const allIdentical$1=allIdentical;var allIdenticalTo=curry$1(function(K,C){return all$1(identical$1(K),C)});const allIdenticalTo$1=allIdenticalTo;var allEqualTo=curry$1(function(K,C){return all$1(equals$2(K),C)});const allEqualTo$1=allEqualTo;var makeFlat=function(C){return function W(V){for(var U,G,Z,X=[],Q=0;Q<V.length;){if(isArrayLike$1(V[Q]))for(U=C?W(V[Q]):V[Q],Z=0,G=U.length;Z<G;)X[X.length]=U[Z],Z+=1;else X[X.length]=V[Q];Q+=1}return X}};const _makeFlat=makeFlat;function _toConsumableArray$1(K){return _arrayWithoutHoles$1(K)||_iterableToArray$2(K)||_unsupportedIterableToArray$2(K)||_nonIterableSpread$1()}function _nonIterableSpread$1(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function _unsupportedIterableToArray$2(K,C){if(K){if(typeof K=="string")return _arrayLikeToArray$2(K,C);var W=Object.prototype.toString.call(K).slice(8,-1);if(W==="Object"&&K.constructor&&(W=K.constructor.name),W==="Map"||W==="Set")return Array.from(K);if(W==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(W))return _arrayLikeToArray$2(K,C)}}function _iterableToArray$2(K){if(typeof Symbol<"u"&&K[Symbol.iterator]!=null||K["@@iterator"]!=null)return Array.from(K)}function _arrayWithoutHoles$1(K){if(Array.isArray(K))return _arrayLikeToArray$2(K)}function _arrayLikeToArray$2(K,C){(C==null||C>K.length)&&(C=K.length);for(var W=0,V=new Array(C);W<C;W++)V[W]=K[W];return V}var flatten1=_makeFlat(!1),flattenDepth=curry$1(function(K,C){for(var W=K,V=_toConsumableArray$1(C);W>0;)V=flatten1(V),W-=1;return V});const flattenDepth$1=flattenDepth;function _toConsumableArray(K){return _arrayWithoutHoles(K)||_iterableToArray$1(K)||_unsupportedIterableToArray$1(K)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function _unsupportedIterableToArray$1(K,C){if(K){if(typeof K=="string")return _arrayLikeToArray$1(K,C);var W=Object.prototype.toString.call(K).slice(8,-1);if(W==="Object"&&K.constructor&&(W=K.constructor.name),W==="Map"||W==="Set")return Array.from(K);if(W==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(W))return _arrayLikeToArray$1(K,C)}}function _iterableToArray$1(K){if(typeof Symbol<"u"&&K[Symbol.iterator]!=null||K["@@iterator"]!=null)return Array.from(K)}function _arrayWithoutHoles(K){if(Array.isArray(K))return _arrayLikeToArray$1(K)}function _arrayLikeToArray$1(K,C){(C==null||C>K.length)&&(C=K.length);for(var W=0,V=new Array(C);W<C;W++)V[W]=K[W];return V}var copyArray=function(C,W,V){var U=isNotUndefined$1(V)?bind$1(W,V):W;return isNotUndefined$1(W)?_toConsumableArray(C).map(U):_toConsumableArray(C)},fromArray$1=function(C,W,V){if(C==null)throw new TypeError("Array.from requires an array-like object - not null or undefined");if(isNotNil$1(W)&&isNotFunction$1(W))throw new TypeError("Array.from: when provided, the second argument must be a function");return isIterable$1(C)?copyArray(C,W,V):[]};const ponyfill$7=fromArray$1;var fromPonyfill=curryN$1(1,ponyfill$7),fromArray=isFunction$1(Array.from)?curryN$1(1,Array.from):fromPonyfill,toArray=ifElse$1(isIterable$1,fromArray,values$1);const toArray$1=toArray;var allUnique=converge$1(lengthEq$1,[length$1,uniq$1]);const allUnique$1=allUnique;var notAllUnique=complement$1(allUnique$1);const notAllUnique$1=notAllUnique;function _toArray(K){return _arrayWithHoles(K)||_iterableToArray(K)||_unsupportedIterableToArray(K)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function _unsupportedIterableToArray(K,C){if(K){if(typeof K=="string")return _arrayLikeToArray(K,C);var W=Object.prototype.toString.call(K).slice(8,-1);if(W==="Object"&&K.constructor&&(W=K.constructor.name),W==="Map"||W==="Set")return Array.from(K);if(W==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(W))return _arrayLikeToArray(K,C)}}function _arrayLikeToArray(K,C){(C==null||C>K.length)&&(C=K.length);for(var W=0,V=new Array(C);W<C;W++)V[W]=K[W];return V}function _iterableToArray(K){if(typeof Symbol<"u"&&K[Symbol.iterator]!=null||K["@@iterator"]!=null)return Array.from(K)}function _arrayWithHoles(K){if(Array.isArray(K))return K}var sortByProps=curry$1(function(K,C){var W=function(G){var Z=_toArray(G),X=Z[0],Q=Z.slice(1);return reduce$1(either$1,X,Q)},V=function(G){return comparator$1(function(Z,X){return lt$1(prop$1(G,Z),prop$1(G,X))})};return sort$1(W(map$2(V,K)),C)});const sortByProps$1=sortByProps;var addValueInAnArray=append$1(__,[]),sortByProp=useWith$1(sortByProps$1,[addValueInAnArray,identity$1]);const sortByProp$1=sortByProp;var pathToAscendSort=pipe(path$1,ascend$1),mapPathsToAscendSort=map$2(pathToAscendSort),sortByPaths=useWith$1(sortWith$1,[mapPathsToAscendSort,identity$1]);const sortByPaths$1=sortByPaths;var skipTake=curry$1(function(K,C){return addIndex$1(filter$1)(pipe(nthArg$1(1),modulo$1(__,K),identical$1(0)))(C)});const skipTake$1=skipTake;var floor=curryN$1(1,bind$1(Math.floor,Math));const floor$1=floor;var rangeStep=curryN$1(3,function(K,C,W){var V=K===0?always$1(C):function(G){return C+K*G},U=K===0?W-C:floor$1((W-C)/K);return map$2(V,range$1(0,U))});const rangeStep$1=rangeStep;var findOr=curry$1(function(K,C,W){return pipe(find$1(C),defaultTo$1(K))(W)});const findOr$1=findOr;var invokeArgs=curryN$1(3,function(K,C,W){var V=path$1(K,W),U=path$1(init$1(K),W);if(!isNotFunction$1(V)&&!isEmptyArray$1(K)){var G=bind$1(V,U);return apply$1(G,C)}});const invokeArgs$1=invokeArgs;var invoke=invokeArgs$1(__,[],__);const invoke$1=invoke;var paths=curry$1(function(K,C){return ap$4([path$1(__,C)],K)});const paths$1=paths;var renameKeysWith=curry$1(function(K,C){return pipe(toPairs$1,map$2(over$1(lensIndex$1(0),K)),fromPairs$1)(C)});const renameKeysWith$1=renameKeysWith;var valueOrKey=function(C){return function(W){return has$1(W,C)?C[W]:W}},renameKeys=curry$1(function(K,C){return renameKeysWith$1(valueOrKey(K),C)});const renameKeys$1=renameKeys;function _typeof$3(K){"@babel/helpers - typeof";return _typeof$3=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(C){return typeof C}:function(C){return C&&typeof Symbol=="function"&&C.constructor===Symbol&&C!==Symbol.prototype?"symbol":typeof C},_typeof$3(K)}function _defineProperty$2(K,C,W){return C=_toPropertyKey$3(C),C in K?Object.defineProperty(K,C,{value:W,enumerable:!0,configurable:!0,writable:!0}):K[C]=W,K}function _toPropertyKey$3(K){var C=_toPrimitive$3(K,"string");return _typeof$3(C)==="symbol"?C:String(C)}function _toPrimitive$3(K,C){if(_typeof$3(K)!=="object"||K===null)return K;var W=K[Symbol.toPrimitive];if(W!==void 0){var V=W.call(K,C||"default");if(_typeof$3(V)!=="object")return V;throw new TypeError("@@toPrimitive must return a primitive value.")}return(C==="string"?String:Number)(K)}var renameKey=curry$1(function(K,C,W){return renameKeys$1(_defineProperty$2({},K,C),W)});const renameKey$1=renameKey;var renameKeyWith=curry$1(function(K,C,W){return renameKeysWith$1(when$1(equals$2(C),K),W)});const renameKeyWith$1=renameKeyWith;function _typeof$2(K){"@babel/helpers - typeof";return _typeof$2=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(C){return typeof C}:function(C){return C&&typeof Symbol=="function"&&C.constructor===Symbol&&C!==Symbol.prototype?"symbol":typeof C},_typeof$2(K)}function ownKeys(K,C){var W=Object.keys(K);if(Object.getOwnPropertySymbols){var V=Object.getOwnPropertySymbols(K);C&&(V=V.filter(function(U){return Object.getOwnPropertyDescriptor(K,U).enumerable})),W.push.apply(W,V)}return W}function _objectSpread(K){for(var C=1;C<arguments.length;C++){var W=arguments[C]!=null?arguments[C]:{};C%2?ownKeys(Object(W),!0).forEach(function(V){_defineProperty$1(K,V,W[V])}):Object.getOwnPropertyDescriptors?Object.defineProperties(K,Object.getOwnPropertyDescriptors(W)):ownKeys(Object(W)).forEach(function(V){Object.defineProperty(K,V,Object.getOwnPropertyDescriptor(W,V))})}return K}function _defineProperty$1(K,C,W){return C=_toPropertyKey$2(C),C in K?Object.defineProperty(K,C,{value:W,enumerable:!0,configurable:!0,writable:!0}):K[C]=W,K}function _toPropertyKey$2(K){var C=_toPrimitive$2(K,"string");return _typeof$2(C)==="symbol"?C:String(C)}function _toPrimitive$2(K,C){if(_typeof$2(K)!=="object"||K===null)return K;var W=K[Symbol.toPrimitive];if(W!==void 0){var V=W.call(K,C||"default");if(_typeof$2(V)!=="object")return V;throw new TypeError("@@toPrimitive must return a primitive value.")}return(C==="string"?String:Number)(K)}var copyKeys=curryN$1(2,function(K,C){return _objectSpread(_objectSpread({},C),renameKeys$1(K,C))});const copyKeys$1=copyKeys;var mergeProps=curryN$1(2,pipe(props$1,mergeAll$1));const mergeProps$1=mergeProps;var mergePaths=curryN$1(2,pipe(paths$1,mergeAll$1));const mergePaths$1=mergePaths;var mergePath=curry$1(function(K,C,W){return over$1(lensPath$1(K),mergeLeft$1(C),W)});const mergePath$1=mergePath;var mergeProp=curry$1(function(K,C,W){return mergePath$1(of$2(Array,K),C,W)});const mergeProp$1=mergeProp;var omitBy=useWith$1(pickBy$1,[complement$1,identity$1]);const omitBy$1=omitBy;var pathOrLazy=curryN$1(3,function(K,C,W){return when$1(identical$1(K),partial$1(unary$1(K),[W]),pathOr$1(K,C,W))});const pathOrLazy$1=pathOrLazy;var viewOr=curryN$1(3,function(K,C,W){return defaultTo$1(K,view$1(C,W))});const viewOr$1=viewOr;var spreadPath=curryN$1(2,converge$1(mergeRight$1,[dissocPath$1,pathOr$1({})]));const spreadPath$1=spreadPath;var spreadProp=curry$1(function(K,C){return spreadPath$1(of$2(Array,K),C)});const spreadProp$1=spreadProp;var flattenPath=curry$1(function(K,C){return mergeRight$1(C,pathOr$1({},K,C))});const flattenPath$1=flattenPath;var flattenProp=curry$1(function(K,C){return flattenPath$1(of$2(Array,K),C)});const flattenProp$1=flattenProp;var unzipObjWith=curryN$1(2,function(K,C){return pipe(toPairs$1,map$2(pipe(flip$1,apply$1)(K)),transpose$1,when$1(lengthEq$1(0),function(){return[[],[]]}))(C)});const unzipObjWith$1=unzipObjWith;var zipObjWith=curryN$1(3,function(K,C,W){return pipe(zip$1,map$2(apply$1(K)),fromPairs$1)(W,C)});const zipObjWith$1=zipObjWith;var isPrototypeOf=curry$1(function(K,C){return!!invokeArgs$1(["prototype","isPrototypeOf"],[C],K)});const isPrototypeOf$1=isPrototypeOf;var lensEq=curryN$1(3,function(K,C,W){return pipe(view$1(K),equals$2(C))(W)});const lensEq$1=lensEq;var lensNotEq=complement$1(lensEq$1);const lensNotEq$1=lensNotEq;var lensSatisfies=curryN$1(3,function(K,C,W){return pipe(view$1(C),K,isTrue$1)(W)});const lensSatisfies$1=lensSatisfies;var lensNotSatisfy=complement$1(lensSatisfies$1);const lensNotSatisfy$1=lensNotSatisfy;var type=either$1(path$1(["@@type"]),path$1(["constructor","@@type"]));curry$1(function(K,C){return type(C)===K});var isSameType=curryN$1(2,useWith$1(equals$2,[type,type]));complement$1(isSameType);function _typeof$1(K){"@babel/helpers - typeof";return _typeof$1=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(C){return typeof C}:function(C){return C&&typeof Symbol=="function"&&C.constructor===Symbol&&C!==Symbol.prototype?"symbol":typeof C},_typeof$1(K)}function _defineProperty(K,C,W){return C=_toPropertyKey$1(C),C in K?Object.defineProperty(K,C,{value:W,enumerable:!0,configurable:!0,writable:!0}):K[C]=W,K}function _toPropertyKey$1(K){var C=_toPrimitive$1(K,"string");return _typeof$1(C)==="symbol"?C:String(C)}function _toPrimitive$1(K,C){if(_typeof$1(K)!=="object"||K===null)return K;var W=K[Symbol.toPrimitive];if(W!==void 0){var V=W.call(K,C||"default");if(_typeof$1(V)!=="object")return V;throw new TypeError("@@toPrimitive must return a primitive value.")}return(C==="string"?String:Number)(K)}var functorTrait=_defineProperty({},map,function(K){return this.constructor[of](K(this.value))}),applyTrait=_defineProperty({},ap$2,function(K){var C=this;return K.map(function(W){return W(C.value)})}),setoidTrait=_defineProperty({},equals,function(K){return isSameType(this,K)&&equals$2(this.value,K.value)}),semigroupTrait=_defineProperty({},concat,function(K){var C=this.value;return isString$1(this.value)||isNumber$1(this.value)?C=this.value+K.value:pathSatisfies$1(isFunction$1,["value",concat],this)?C=this.value[concat](K.value):pathSatisfies$1(isFunction$1,["value","concat"],this)&&(C=this.value.concat(K.value)),this.constructor[of](C)}),chainTrait=_defineProperty({},chain,function(K){var C=K(this.value);return isSameType(this,C)?C:this}),ordTrait=_defineProperty({},lte,function(K){return isSameType(this,K)&&(this.value<K.value||this[equals](K))});function _typeof(K){"@babel/helpers - typeof";return _typeof=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(C){return typeof C}:function(C){return C&&typeof Symbol=="function"&&C.constructor===Symbol&&C!==Symbol.prototype?"symbol":typeof C},_typeof(K)}function _classCallCheck(K,C){if(!(K instanceof C))throw new TypeError("Cannot call a class as a function")}function _defineProperties(K,C){for(var W=0;W<C.length;W++){var V=C[W];V.enumerable=V.enumerable||!1,V.configurable=!0,"value"in V&&(V.writable=!0),Object.defineProperty(K,_toPropertyKey(V.key),V)}}function _createClass(K,C,W){return C&&_defineProperties(K.prototype,C),W&&_defineProperties(K,W),Object.defineProperty(K,"prototype",{writable:!1}),K}function _toPropertyKey(K){var C=_toPrimitive(K,"string");return _typeof(C)==="symbol"?C:String(C)}function _toPrimitive(K,C){if(_typeof(K)!=="object"||K===null)return K;var W=K[Symbol.toPrimitive];if(W!==void 0){var V=W.call(K,C||"default");if(_typeof(V)!=="object")return V;throw new TypeError("@@toPrimitive must return a primitive value.")}return(C==="string"?String:Number)(K)}var Identity=function(K,C,W,V,U,G,Z,X,Q){function J(ee){_classCallCheck(this,J),this.value=ee}return _createClass(J,[{key:"get",value:function(){return this.value}},{key:C,value:function(te){return applyTrait[ap$2].call(this,te)}},{key:"ap",value:function(te){return this[ap$2](te)}},{key:W,value:function(te){return functorTrait[map].call(this,te)}},{key:"map",value:function(te){return this[map](te)}},{key:V,value:function(te){return setoidTrait[equals].call(this,te)}},{key:"equals",value:function(te){return this[equals](te)}},{key:U,value:function(te){return semigroupTrait[concat].call(this,te)}},{key:"concat",value:function(te){return this[concat](te)}},{key:G,value:function(te){return chainTrait[chain].call(this,te)}},{key:"chain",value:function(te){return this[chain](te)}},{key:Z,value:function(te){return ordTrait[lte].call(this,te)}},{key:"lte",value:function(te){return this[lte](te)}},{key:X,value:function(){return this.constructor.of(emptyR(this.value))}},{key:"empty",value:function(){return this[empty]()}},{key:Q,value:function(te){var ie=this;return this.constructor.of(function(ne){return ie.value(te(ne))})}},{key:"contramap",value:function(te){return this[contramap](te)}}],[{key:K,value:function(te){return new J(te)}},{key:"of",value:function(te){return new J(te)}},{key:"@@type",get:function(){return"RA/Identity"}}]),J}(of,ap$2,map,equals,concat,chain,lte,empty,contramap);const Identity$1=Identity;var lensTraverse=curryN$1(1,function(K){var C=typeof K["fantasy-land/of"]=="function"?K["fantasy-land/of"]:typeof K.of=="function"?K.of:K,W={"fantasy-land/of":C};return curry$1(function(V,U){return Identity$1.of(traverse$1(W,pipe(V,prop$1("value")),U))})});const lensTraverse$1=lensTraverse;var isomorphic=function(C,W){var V=function(G){return C(G)};return V.from=W,V},isomorphisms=function(C,W){return isomorphic(curry$1(function(V,U){return map$2(W,V(C(U)))}),curry$1(function(V,U){return map$2(C,V(W(U)))}))},from=curry$1(function(K,C){return K.from(C)}),lensIso=curry$1(isomorphisms);lensIso.from=from;const lensIso$1=lensIso;var propNotEq=complement$1(propEq$1);const propNotEq$1=propNotEq;var pathNotEq=complement$1(pathEq$1);const pathNotEq$1=pathNotEq;var inRangeImp=ifElse$1(gte$1,function(){throw new Error("low must not be greater than high in inRange(low, high, value)")},useWith$1(both$1,[lte$2,gt$1]));const inRange=curry$1(function(K,C,W){return inRangeImp(K,C)(W)});var notEqual=complement$1(equals$2);const notEqual$1=notEqual;var overlaps=curryN$1(2,function(K,C){return isEmpty$1(K)?!0:pipe(intersection$1,isNotEmpty$1)(K,C)});const overlaps$1=overlaps;var notBoth=curry$1(compose(complement$1,both$1));const notBoth$1=notBoth;var nand=complement$1(and$1);const nand$1=nand;var neither=curry$1(compose(complement$1,either$1));const neither$1=neither;var nor=complement$1(or$1);const nor$1=nor;var notAllPass=curry$1(compose(complement$1,allPass$1));const notAllPass$1=notAllPass;var nonePass=curryN$1(1,compose(complement$1,anyPass$1));const nonePass$1=nonePass;var argsPass=curry$1(function(K,C){return useWith$1(compose(K(isTruthy$1),list$1),C)});const argsPass$1=argsPass;var dropArgs=nAry$1(0);const dropArgs$1=dropArgs;var round=curryN$1(1,bind$1(Math.round,Math));const round$1=round;var ceil=curryN$1(1,bind$1(Math.ceil,Math));const ceil$1=ceil;var divideNum=flip$1(divide$1);const divideNum$1=divideNum;var truncPonyfill$1=function(C){var W=Number(C);return isFinite$1(W)?W-W%1||(W<0?-0:W===0?W:0):W};const ponyfill$6=truncPonyfill$1;var truncPonyfill=curryN$1(1,ponyfill$6),trunc=isFunction$1(Math.trunc)?curryN$1(1,bind$1(Math.trunc,Math)):truncPonyfill;const trunc$1=trunc;var signPonyfill$1=function(C){return(C>0)-(C<0)||+C};const ponyfill$5=signPonyfill$1;var signPonyfill=curryN$1(1,ponyfill$5),sign=isFunction$1(Math.sign)?curryN$1(1,bind$1(Math.sign,Math)):signPonyfill;const sign$1=sign;var subtractNum=flip$1(subtract$1);const subtractNum$1=subtractNum;var isCoercible=neither$1(isSymbol$1,both$1(isObj$1,neither$1(hasIn$1("toString"),hasIn$1("valueOf"))));const isCoercible$1=isCoercible;var toNumber=ifElse$1(isCoercible$1,Number,always$1(NaN));const toNumber$1=toNumber;var escapeRegExp=when$1(isString$1,replace$1(/[.*+?^${}()|[\]\\-]/g,"\\$&"));const escapeRegExp$1=escapeRegExp;var checkArguments=function(C,W,V){if(V==null||C==null||W==null)throw TypeError("Input values must not be `null` or `undefined`")},checkValue=function(C,W){if(typeof C!="string"&&!(C instanceof String))throw TypeError("`".concat(W,"` must be a string"))},checkSearchValue=function(C){if(typeof C!="string"&&!(C instanceof String)&&!(C instanceof RegExp))throw TypeError("`searchValue` must be a string or an regexp")},replaceAll$2=function(C,W,V){checkArguments(C,W,V),checkValue(V,"str"),checkValue(W,"replaceValue"),checkSearchValue(C);var U=new RegExp(isRegExp$1(C)?C:escapeRegExp$1(C),"g");return replace$1(U,W,V)};const ponyfill$4=replaceAll$2;var replaceAllPonyfill=curryN$1(3,ponyfill$4),replaceAllInvoker=invoker$1(2,"replaceAll"),replaceAll=isFunction$1(String.prototype.replaceAll)?replaceAllInvoker:replaceAllPonyfill;const replaceAll$1=replaceAll;var trimStart$3=replace$1(/^[\s\uFEFF\xA0]+/,"");const ponyfill$3=trimStart$3;var trimStartPonyfill=ponyfill$3,trimStartInvoker=invoker$1(0,"trimStart"),trimStart$1=isFunction$1(String.prototype.trimStart)?trimStartInvoker:trimStartPonyfill;const trimStart$2=trimStart$1;var trimStart=replace$1(/[\s\uFEFF\xA0]+$/,"");const ponyfill$2=trimStart;var trimEndPonyfill=ponyfill$2,trimEndInvoker=invoker$1(0,"trimEnd"),trimEnd=isFunction$1(String.prototype.trimEnd)?trimEndInvoker:trimEndPonyfill;const trimEnd$1=trimEnd;var trimCharsEnd=curry$1(function(K,C){return pipe(split$1(""),dropLastWhile$1(included$1(K)),join$1(""))(C)});const trimCharsEnd$1=trimCharsEnd;var trimCharsStart=curry$1(function(K,C){return pipe(split$1(""),dropWhile$1(included$1(K)),join$1(""))(C)});const trimCharsStart$1=trimCharsStart;var padStartPonyfill$1=function(C,W,V){var U=W>>0,G=String(isNotUndefined$1(C)?C:" ");if(V.length>=U)return String(V);if(U-=V.length,U>G.length){var Z=U/G.length;G+=isFunction$1(String.prototype.repeat)?G.repeat(Z):repeat$1(G,Z)}return G.slice(0,U)+String(V)};const ponyfill$1=padStartPonyfill$1;var padStartInvoker=flip$1(invoker$1(2,"padStart")),padStartPonyfill=curry$1(ponyfill$1),padCharsStart=isFunction$1(String.prototype.padStart)?padStartInvoker:padStartPonyfill;const padCharsStart$1=padCharsStart;var padEndPonyfill$1=function(C,W,V){var U=W>>0,G=String(isNotUndefined$1(C)?C:" ");if(V.length>U)return String(V);if(U-=V.length,U>G.length){var Z=U/G.length;G+=isFunction$1(String.prototype.repeat)?G.repeat(Z):repeat$1(G,Z)}return String(V)+G.slice(0,U)};const ponyfill=padEndPonyfill$1;var padEndPonyfill=curry$1(ponyfill),padEndInvoker=flip$1(invoker$1(2,"padEnd")),padCharsEnd=isFunction$1(String.prototype.padEnd)?padEndInvoker:padEndPonyfill;const padCharsEnd$1=padCharsEnd;var padEnd=padCharsEnd$1(" ");const padEnd$1=padEnd;var padStart=padCharsStart$1(" ");const padStart$1=padStart,RA=Object.freeze(Object.defineProperty({__proto__:null,Identity:Identity$1,Y:Y$1,allEqual:allEqual$1,allEqualTo:allEqualTo$1,allIdentical:allIdentical$1,allIdenticalTo:allIdenticalTo$1,allP:allP$1,allSettledP:allSettledP$1,allUnique:allUnique$1,anyP:anyP$1,appendFlipped:appendFlipped$1,argsPass:argsPass$1,async:async$1,cata:catamorphism$1,catchP:catchP$1,ceil:ceil$1,compact:compact$1,concatAll:concatAll$1,concatRight:concatRight$1,copyKeys:copyKeys$1,curryRight:curryRight$1,curryRightN:curryRightN$1,defaultWhen:defaultWhen$1,delayP:delayP$1,dispatch:dispatch$1,divideNum:divideNum$1,dropArgs:dropArgs$1,ensureArray:ensureArray$1,escapeRegExp:escapeRegExp$1,filterIndexed:filterIndexed$2,findOr:findOr$1,firstP:anyP$1,flattenDepth:flattenDepth$1,flattenPath:flattenPath$1,flattenProp:flattenProp$1,floor:floor$1,fnull:fnull$1,inRange,included:included$1,invoke:invoke$1,invokeArgs:invokeArgs$1,isArray:isArray$1,isArrayLike:isArrayLike$1,isAsyncFunction:isAsyncFunction$1,isBigInt:isBigInt$1,isBlank:isBlank$1,isBoolean:isBoolean$1,isDate:isDate$1,isEmptyArray:isEmptyArray$1,isEmptyString:isEmptyString$1,isError:isError$1,isEven:isEven$1,isFalse:isFalse$1,isFalsy:isFalsy$1,isFinite:isFinite$1,isFloat:isFloat$1,isFunction:isFunction$1,isGeneratorFunction:isGeneratorFunction$1,isIndexed:isIndexed$1,isInt32:isInteger32$1,isInteger:isInteger$1,isInteger32:isInteger32$1,isInvalidDate:isNotValidDate$1,isIterable:isIterable$1,isMap:isMap$1,isNaN:_isNaN$1,isNaturalNumber:isNaturalNumber$1,isNegative:isNegative$1,isNegativeZero:isNegativeZero$1,isNilOrEmpty:isNilOrEmpty$1,isNonEmptyArray:isNonEmptyArray$1,isNonEmptyString:isNonEmptyString$1,isNonNegative:isNonNegative$1,isNonPositive:isNonPositive$1,isNotArray:isNotArray$1,isNotArrayLike:isNotArrayLike$1,isNotAsyncFunction:isNotAsyncFunction$1,isNotBoolean:isNotBoolean$1,isNotDate:isNotDate$1,isNotEmpty:isNotEmpty$1,isNotFinite:isNotFinite$1,isNotFloat:isNotFloat$1,isNotFunction:isNotFunction$1,isNotGeneratorFunction:isNotGeneratorFunction$1,isNotInteger:isNotInteger$1,isNotMap:isNotMap$1,isNotNaN:isNotNaN$1,isNotNil:isNotNil$1,isNotNilOrEmpty:isNotNilOrEmpty$1,isNotNull:isNotNull$1,isNotNumber:isNotNumber$1,isNotObj:isNotObj$1,isNotObjLike:isNotObjLike$1,isNotObject:isNotObj$1,isNotObjectLike:isNotObjLike$1,isNotPair:isNotPair$1,isNotPlainObj:isNotPlainObj$1,isNotPlainObject:isNotPlainObj$1,isNotPrimitive:isNotPrimitive$1,isNotRegExp:isNotRegExp$1,isNotSet:isNotSet$1,isNotString:isNotString$1,isNotUndefined:isNotUndefined$1,isNotValidDate:isNotValidDate$1,isNotValidNumber:isNotValidNumber$1,isNull:isNull$1,isNumber:isNumber$1,isObj:isObj$1,isObjLike:isObjLike$1,isObject:isObj$1,isObjectLike:isObjLike$1,isOdd:isOdd$1,isPair:isPair$1,isPlainObj:isPlainObj$1,isPlainObject:isPlainObj$1,isPositive:isPositive$1,isPositiveZero:isPositiveZero$1,isPrimitive:isPrimitive$1,isPromise:isPromise$1,isPrototypeOf:isPrototypeOf$1,isRegExp:isRegExp$1,isSafeInteger:isSafeInteger$1,isSentinelValue:isSentinelValue$1,isSet:isSet$1,isSparseArray:isSparseArray$1,isString:isString$1,isSymbol:isSymbol$1,isThenable:isThenable$1,isTrue:isTrue$1,isTruthy:isTruthy$1,isUint32:isUinteger32$1,isUinteger32:isUinteger32$1,isUndefined:isUndefined$1,isValidDate:isValidDate$1,isValidNumber:isValidNumber$1,lastP:lastP$1,lengthEq:lengthEq$1,lengthGt:lengthGt$1,lengthGte:lengthGte$1,lengthLt:lengthLt$1,lengthLte:lengthLte$1,lengthNotEq:lengthNotEq$1,lensEq:lensEq$1,lensIso:lensIso$1,lensNotEq:lensNotEq$1,lensNotSatisfy:lensNotSatisfy$1,lensSatisfies:lensSatisfies$1,lensTraverse:lensTraverse$1,liftF:liftF$1,liftFN:liftFN$1,list:list$1,mapIndexed:mapIndexed$1,mergePath:mergePath$1,mergePaths:mergePaths$1,mergeProp:mergeProp$1,mergeProps:mergeProps$1,move:move$1,nand:nand$1,neither:neither$1,noneP:noneP$1,nonePass:nonePass$1,noop:noop$1,nor:nor$1,notAllPass:notAllPass$1,notAllUnique:notAllUnique$1,notBoth:notBoth$1,notEqual:notEqual$1,omitBy:omitBy$1,omitIndexes:omitIndexes$1,overlaps:overlaps$1,padCharsEnd:padCharsEnd$1,padCharsStart:padCharsStart$1,padEnd:padEnd$1,padStart:padStart$1,pathNotEq:pathNotEq$1,pathOrLazy:pathOrLazy$1,paths:paths$1,pickIndexes:pickIndexes$1,propNotEq:propNotEq$1,rangeStep:rangeStep$1,reduceIndexed:reduceIndexed$1,reduceP:reduceP$1,reduceRightP:reduceRightP$1,rejectP:rejectP$1,renameKey:renameKey$1,renameKeyWith:renameKeyWith$1,renameKeys:renameKeys$1,renameKeysWith:renameKeysWith$1,repeatStr:repeatStr$1,replaceAll:replaceAll$1,resolveP:resolveP$1,round:round$1,seq:seq$1,sequencing:seq$1,sign:sign$1,skipTake:skipTake$1,sliceFrom:sliceFrom$1,sliceTo:sliceTo$1,sortByPaths:sortByPaths$1,sortByProp:sortByProp$1,sortByProps:sortByProps$1,spreadPath:spreadPath$1,spreadProp:spreadProp$1,stubArray:stubArray$1,stubNull:stubNull$1,stubObj:stubObj$1,stubObject:stubObj$1,stubString:stubString$1,stubUndefined:stubUndefined$1,subtractNum:subtractNum$1,thenCatchP:thenCatchP$1,toArray:toArray$1,toInt32:toInteger32$1,toInteger32:toInteger32$1,toNumber:toNumber$1,toUint32:toUinteger32$1,toUinteger32:toUinteger32$1,trimCharsEnd:trimCharsEnd$1,trimCharsStart:trimCharsStart$1,trimEnd:trimEnd$1,trimLeft:trimStart$2,trimRight:trimEnd$1,trimStart:trimStart$2,trunc:trunc$1,unzipObjWith:unzipObjWith$1,viewOr:viewOr$1,weave:weave$1,weaveLazy:weaveLazy$1,zipObjWith:zipObjWith$1},Symbol.toStringTag,{value:"Module"})),base="vs-dark",inherit=!0,rules=[{token:"keyword",foreground:"#50fa7b"},{background:"282a36",token:""},{foreground:"6272a4",token:"comment"},{foreground:"f1fa8c",token:"string"},{foreground:"bd93f9",token:"constant.numeric"},{foreground:"bd93f9",token:"constant.language"},{foreground:"bd93f9",token:"constant.character"},{foreground:"bd93f9",token:"constant.other"},{foreground:"ffb86c",token:"variable.other.readwrite.instance"},{foreground:"ff79c6",token:"constant.character.escaped"},{foreground:"ff79c6",token:"constant.character.escape"},{foreground:"ff79c6",token:"string source"},{foreground:"ff79c6",token:"string source.ruby"},{foreground:"ff79c6",token:"keyword"},{foreground:"ff79c6",token:"storage"},{foreground:"8be9fd",fontStyle:"italic",token:"storage.type"},{foreground:"50fa7b",fontStyle:"underline",token:"entity.name.class"},{foreground:"50fa7b",fontStyle:"italic underline",token:"entity.other.inherited-class"},{foreground:"50fa7b",token:"entity.name.function"},{foreground:"ffb86c",fontStyle:"italic",token:"variable.parameter"},{foreground:"ff79c6",token:"entity.name.tag"},{foreground:"50fa7b",token:"entity.other.attribute-name"},{foreground:"8be9fd",token:"support.function"},{foreground:"6be5fd",token:"support.constant"},{foreground:"66d9ef",fontStyle:" italic",token:"support.type"},{foreground:"66d9ef",fontStyle:" italic",token:"support.class"},{foreground:"f8f8f0",background:"ff79c6",token:"invalid"},{foreground:"f8f8f0",background:"bd93f9",token:"invalid.deprecated"},{foreground:"cfcfc2",token:"meta.structure.dictionary.json string.quoted.double.json"},{foreground:"6272a4",token:"meta.diff"},{foreground:"6272a4",token:"meta.diff.header"},{foreground:"ff79c6",token:"markup.deleted"},{foreground:"50fa7b",token:"markup.inserted"},{foreground:"e6db74",token:"markup.changed"},{foreground:"bd93f9",token:"constant.numeric.line-number.find-in-files - match"},{foreground:"e6db74",token:"entity.name.filename"},{foreground:"f83333",token:"message.error"},{foreground:"eeeeee",token:"punctuation.definition.string.begin.json - meta.structure.dictionary.value.json"},{foreground:"eeeeee",token:"punctuation.definition.string.end.json - meta.structure.dictionary.value.json"},{foreground:"8be9fd",token:"meta.structure.dictionary.json string.quoted.double.json"},{foreground:"f1fa8c",token:"meta.structure.dictionary.value.json string.quoted.double.json"},{foreground:"50fa7b",token:"meta meta meta meta meta meta meta.structure.dictionary.value string"},{foreground:"ffb86c",token:"meta meta meta meta meta meta.structure.dictionary.value string"},{foreground:"ff79c6",token:"meta meta meta meta meta.structure.dictionary.value string"},{foreground:"bd93f9",token:"meta meta meta meta.structure.dictionary.value string"},{foreground:"50fa7b",token:"meta meta meta.structure.dictionary.value string"},{foreground:"ffb86c",token:"meta meta.structure.dictionary.value string"}],colors={"editor.foreground":"#f8f8f2","editor.background":"#282a36","editor.selectionBackground":"#44475a","editor.lineHighlightBackground":"#44475a","editorCursor.foreground":"#f8f8f0","editorWhitespace.foreground":"#3B3A32","editorIndentGuide.activeBackground":"#9D550FB0","editor.selectionHighlightBorder":"#222218"},theme={base,inherit,rules,colors},conf={wordPattern:/(-?\d*\.\d\w*)|([^\`\~\!\@\#\%\^\&\*\(\)\-\=\+\[\{\]\}\\\|\;\:\'\"\,\.\<\>\/\?\s]+)/g,comments:{lineComment:"//",blockComment:["/*","*/"]},brackets:[["{","}"],["[","]"],["(",")"]],onEnterRules:[{beforeText:/^\s*\/\*\*(?!\/)([^\*]|\*(?!\/))*$/,afterText:/^\s*\*\/$/,action:{indentAction:languages.IndentAction.IndentOutdent,appendText:" * "}},{beforeText:/^\s*\/\*\*(?!\/)([^\*]|\*(?!\/))*$/,action:{indentAction:languages.IndentAction.None,appendText:" * "}},{beforeText:/^(\t|(\ \ ))*\ \*(\ ([^\*]|\*(?!\/))*)?$/,action:{indentAction:languages.IndentAction.None,appendText:"* "}},{beforeText:/^(\t|(\ \ ))*\ \*\/\s*$/,action:{indentAction:languages.IndentAction.None,removeText:1}}],autoClosingPairs:[{open:"{",close:"}"},{open:"[",close:"]"},{open:"(",close:")"},{open:'"',close:'"',notIn:["string"]},{open:"'",close:"'",notIn:["string","comment"]},{open:"`",close:"`",notIn:["string","comment"]},{open:"/**",close:" */",notIn:["string"]}],folding:{markers:{start:new RegExp("^\\s*//\\s*#?region\\b"),end:new RegExp("^\\s*//\\s*#?endregion\\b")}}},keywords=[...Object.getOwnPropertyNames(R),...Object.getOwnPropertyNames(RA),...Object.getOwnPropertyNames(P)],language={defaultToken:"invalid",tokenPostfix:".ts",keywords:[...keywords,"abstract","any","as","asserts","bigint","boolean","break","case","catch","class","continue","const","constructor","debugger","declare","default","delete","do","else","enum","export","extends","false","finally","for","from","function","get","if","implements","import","in","infer","instanceof","interface","is","keyof","let","module","namespace","never","new","null","number","object","out","package","private","protected","public","override","readonly","require","global","return","satisfies","set","static","string","super","switch","symbol","this","throw","true","try","type","typeof","undefined","unique","unknown","var","void","while","with","yield","async","await","of"],operators:["<=",">=","==","!=","===","!==","=>","+","-","**","*","/","%","++","--","<<","</",">>",">>>","&","|","^","!","~","&&","||","??","?",":","=","+=","-=","*=","**=","/=","%=","<<=",">>=",">>>=","&=","|=","^=","@"],symbols:/[=><!~?:&|+\-*\/\^%]+/,escapes:/\\(?:[abfnrtv\\"']|x[0-9A-Fa-f]{1,4}|u[0-9A-Fa-f]{4}|U[0-9A-Fa-f]{8})/,digits:/\d+(_+\d+)*/,octaldigits:/[0-7]+(_+[0-7]+)*/,binarydigits:/[0-1]+(_+[0-1]+)*/,hexdigits:/[[0-9a-fA-F]+(_+[0-9a-fA-F]+)*/,regexpctl:/[(){}\[\]\$\^|\-*+?\.]/,regexpesc:/\\(?:[bBdDfnrstvwWn0\\\/]|@regexpctl|c[A-Z]|x[0-9a-fA-F]{2}|u[0-9a-fA-F]{4})/,tokenizer:{root:[[/[{}]/,"delimiter.bracket"],{include:"common"}],common:[[/#?[a-z_$][\w$]*/,{cases:{"@keywords":"keyword","@default":"identifier"}}],[/[A-Z][\w\$]*/,"type.identifier"],{include:"@whitespace"},[/\/(?=([^\\\/]|\\.)+\/([dgimsuy]*)(\s*)(\.|;|,|\)|\]|\}|$))/,{token:"regexp",bracket:"@open",next:"@regexp"}],[/[()\[\]]/,"@brackets"],[/[<>](?!@symbols)/,"@brackets"],[/!(?=([^=]|$))/,"delimiter"],[/@symbols/,{cases:{"@operators":"delimiter","@default":""}}],[/(@digits)[eE]([\-+]?(@digits))?/,"number.float"],[/(@digits)\.(@digits)([eE][\-+]?(@digits))?/,"number.float"],[/0[xX](@hexdigits)n?/,"number.hex"],[/0[oO]?(@octaldigits)n?/,"number.octal"],[/0[bB](@binarydigits)n?/,"number.binary"],[/(@digits)n?/,"number"],[/[;,.]/,"delimiter"],[/"([^"\\]|\\.)*$/,"string.invalid"],[/'([^'\\]|\\.)*$/,"string.invalid"],[/"/,"string","@string_double"],[/'/,"string","@string_single"],[/`/,"string","@string_backtick"]],whitespace:[[/[ \t\r\n]+/,""],[/\/\*\*(?!\/)/,"comment.doc","@jsdoc"],[/\/\*/,"comment","@comment"],[/\/\/.*$/,"comment"]],comment:[[/[^\/*]+/,"comment"],[/\*\//,"comment","@pop"],[/[\/*]/,"comment"]],jsdoc:[[/[^\/*]+/,"comment.doc"],[/\*\//,"comment.doc","@pop"],[/[\/*]/,"comment.doc"]],regexp:[[/(\{)(\d+(?:,\d*)?)(\})/,["regexp.escape.control","regexp.escape.control","regexp.escape.control"]],[/(\[)(\^?)(?=(?:[^\]\\\/]|\\.)+)/,["regexp.escape.control",{token:"regexp.escape.control",next:"@regexrange"}]],[/(\()(\?:|\?=|\?!)/,["regexp.escape.control","regexp.escape.control"]],[/[()]/,"regexp.escape.control"],[/@regexpctl/,"regexp.escape.control"],[/[^\\\/]/,"regexp"],[/@regexpesc/,"regexp.escape"],[/\\\./,"regexp.invalid"],[/(\/)([dgimsuy]*)/,[{token:"regexp",bracket:"@close",next:"@pop"},"keyword.other"]]],regexrange:[[/-/,"regexp.escape.control"],[/\^/,"regexp.invalid"],[/@regexpesc/,"regexp.escape"],[/[^\]]/,"regexp"],[/\]/,{token:"regexp.escape.control",next:"@pop",bracket:"@close"}]],string_double:[[/[^\\"]+/,"string"],[/@escapes/,"string.escape"],[/\\./,"string.escape.invalid"],[/"/,"string","@pop"]],string_single:[[/[^\\']+/,"string"],[/@escapes/,"string.escape"],[/\\./,"string.escape.invalid"],[/'/,"string","@pop"]],string_backtick:[[/\$\{/,{token:"delimiter.bracket",next:"@bracketCounting"}],[/[^\\`$]+/,"string"],[/@escapes/,"string.escape"],[/\\./,"string.escape.invalid"],[/`/,"string","@pop"]],bracketCounting:[[/\{/,"delimiter.bracket","@bracketCounting"],[/\}/,"delimiter.bracket","@pop"],{include:"common"}]}},myLang="ramda-typescript";editor$1.defineTheme("dracula",theme);languages.register({id:myLang});languages.setLanguageConfiguration(myLang,conf);languages.setMonarchTokensProvider(myLang,language);const editorOptions={theme:"dracula",showFoldingControls:"mouseover",minimap:{enabled:!1},lineNumbers:"off",renderLineHighlight:"none",language:myLang,fontFamily:"Fira Code",fontLigatures:!0,fontSize:14},options={jsc:{parser:{syntax:"typescript",dynamicImport:!0},target:"es2022"},module:{type:"commonjs"}},output$1="";var _=0;function o(K,C,W,V,U,G){var Z,X,Q={};for(X in C)X=="ref"?Z=C[X]:Q[X]=C[X];var J={type:K,props:Q,key:W,ref:Z,__k:null,__:null,__b:0,__e:null,__d:void 0,__c:null,__h:null,constructor:void 0,__v:--_,__source:U,__self:G};if(typeof K=="function"&&(Z=K.defaultProps))for(X in Z)Q[X]===void 0&&(Q[X]=Z[X]);return l$3.vnode&&l$3.vnode(J),J}const output=a(null),Output=()=>{const K=_$3(null);return p$2(()=>{K.current!=null&&(output.value=editor$1.create(K.current,{theme:"dracula",minimap:{enabled:!1},lineNumbers:"off",language:"javascript",renderLineHighlight:"none",fontFamily:"Fira Code",fontLigatures:!0,readOnly:!0,fontSize:14}))},[K]),o("div",{class:"box output",ref:K})},editor=a(null);keywords.forEach(K=>{window[K]||(window[K]=R[K]??RA[K]??P[K])});const handleCodeChange=()=>{var K,C;if(output.value&&editor.value)try{const js=transformSync(editor.value.getValue(),options),result=eval(js.code);result!==void 0?output.value.setValue(JSON.stringify(result,null,2).replace('"use strict"',"")):output.value.setValue("")}catch(W){W instanceof Error?(K=output.value.getModel())==null||K.setValue(`${W.message}
${W.stack??""}`):(C=output.value.getModel())==null||C.setValue(`${W}`),console.warn(W)}},debounced=K=>{let C=-1;return()=>{clearTimeout(C),C=setTimeout(K,500)}},App=()=>{const K=_$3(null);return p$2(()=>{K.current!=null&&(editor.value=editor$1.create(K.current,editorOptions),editor.value.onDidChangeModelContent(debounced(handleCodeChange)))},[K]),o(k$1,{children:[o("nav",{children:o("h2",{className:"title","data-title":"typescript ramda with extras",children:"typescript ramda with extras"})}),o("div",{class:"box editor",ref:K}),o(Output,{})]})};self.MonacoEnvironment={getWorker:(K,C)=>C==="json"?new WorkerWrapper$1:C==="css"||C==="scss"||C==="less"?new WorkerWrapper$3:C==="html"?new WorkerWrapper$2:C==="typescript"||C==="javascript"?new WorkerWrapper:new WorkerWrapper$4};const app=document.getElementById("app");MaybeAsync(()=>init$3()).chain(()=>MaybeAsync.liftMaybe(Maybe.fromNullable(app)).map(K=>B(o(App,{}),K))).run().catch(console.error);export{monaco_editor_core_star as m,typescriptDefaults as t};
